     H        1
      *****************************************************************
/*S*D****RPGBASE*******************************************************                     MD046294
/*STD *  RPGSQL                                                       *                     MD046294
/*EXI *  TEXT('Midas LE Fee accruals account key generation')         *
      *****************************************************************
     F*                                                               *
     F*  Midas - Customer Lending Module                              *
     F*                                                               *
     F*  LER130 - Non-calculated & loan-based fee Processing          *
     F*                                                               *
     F*  Function:  This program performs fee accruals for            *
     F*             non-calculated and loan-based fees and            *
     F*             generates corresponding account keys.             *
     F*                                                               *
     F*  (COB)                                                        *
     F*                                                               *
     F*  Called By: LERC13 - Fee Accruals Update & Account Key        *
     F*             Generation.                                       *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD026969           Date 23Oct19               *
      *  Prev Amend No. MD052216           Date 04Apr19               *
      *                 CER050             Date 16Jun19               *
      *                 MD053946           Date 17Jul19               *
      *                 MD051883           Date 04Apr19               *
      *                 MD053607           Date 19Jul19               *
      *                 MD053295           Date 13Apr19               *
      *                 MD050139           Date 23Mar18               *
      *                 MD050111           Date 26Apr18               *
      *                 MD051940           Date 09Oct18               *
      *                 CLE071             Date 18Jul18               *
      *                 MD049826           Date 21Mar18               *
      *                 CLE159             Date 18Jul18               *
      *                 MD051242           Date 25Jun18               *
      *                 MD046248           Date 27Oct17               *
      *                 MD046080           Date 17Sep17               *
      *                 MD046294           Date 28Jun17               *
      *                 MD029938A          Date 08May15               *
      *                 AR317401           Date 08May15               *
      *                 MD047993           Date 23Sep17               *
      *                 MD035545           Date 11Sep15               *
      *                 MD045509           Date 08May17               *
      *                 MD045010           Date 05Apr17               *
      *                 CGL184             Date 07Dec16               *
      *                 251069             Date 27Jul16               *
      *                 CLE141A            Date 28Apr16               *
      *                 CLE141             Date 08Feb16               *
      *                 CLE164             Date 28Nov14               *
      *                 MD030334           Date 27Oct14               *
      *                 MD025212           Date 10May14               *
      *                 MD023863           Date 06May14               *
      *                 MD025519           Date 13Mar14               *
      *                 MD020824A          Date 15Jun13               *
      *                 AR737558           Date 06Jun13               *
      *                 MD020824           Date 10Jun13               *
      *                 MD020212           Date 30Apr13               *
      *                 MD019852           Date 11Apr13               *
      *                 AR1076968B         Date 08Apr13               *
      *                 AR995302           Date 06Feb13               *
      *                 AR632102B          Date 06Feb13               *
      *                 AR632103A          Date 06Feb13               *
      *                 AR632103           Date 06Feb13               *
      *                 260961             Date 06Feb13               *
      *                 262298             Date 06Feb13               *
      *                 AR857632           Date 06Feb13               *
      *                 AR1080660          Date 26Jan13               *
      *                 AR1078443          Date 17Jan12               *
      *                 AR996895           Date 25Nov12               *
      *                 AR1056323          Date 14Nov12               *
      *                 258597             Date 22Oct12               *
      *                 AR785482           Date 14Oct12               *
      *                 AR741212           Date 14Oct12               *
      *                 AR997862           Date 14Oct12               *
      *                 259013             Date 31Aug12               *
      *                 AR574425           Date 01Aug12               *
      *                 AR571427           Date 01Aug12               *
      *                 AR402732           Date 01Aug12               *
      *                 AR217562           Date 01Aug12               *
      *                 263358             Date 01Aug12               *
      *                 263074             Date 01Aug12               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 AR800866           Date 27Jul12               *
      *                 AR821870           Date 07Sep11               *
      *                 AR821740           Date 29Aug11               *
      *                 CER049             Date 06Dec10               *
      *                 CRE073             Date 06Dec10               *
      *                 CLE143             Date 06Dec10               *
      *                 AR745249A          Date 15Jun11               *
      *                 AR787620           Date 10Jun11               *
      *                 AR750638           Date 31May11               *
      *                 AR750543A          Date 03May11               *
      *                 AR750543           Date 26Apr11               *
      *                 CLE139             Date 06Dec10               *
      *                 CLE064             Date 06Dec10               *
      *                 262573             Date 29Dec08               *
      *                 262553             Date 09Jan09               *
      *                 258222             Date 26Jan09               *
      *                 263666             Date 01Feb10               *
      *                 CER059             Date 19Jul10               *
      *                 CER016A            Date 19May08               *
      *                 CER020             Date 19May08               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 248821             Date 10Jul07               *
      *                 260345             Date 20May09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 CSW208             Date 15Apr08               *
      *                 242602             Date 02Apr07               *
      *                 247979             Date 23May07               *
      *                 246141             Date 26Mar07               *
      *                 CAS019             Date 24Mar07               *
      *                 238569             Date 22Feb06               *
      *                 CAS016             Date 28Feb06               *
      *                 CPK027             Date 18Apr07               *
      *                 164847             Date 30Nov06               *
      *                 243499             Date 08Nov06               *
      *                 BUG13140           Date 05Feb07               *
      *                 BUG13038           Date 18Jan07               *
      *                 BUG13031           Date 17Jan07               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242286             Date 26Sep06               *
      *                 240672             Date 17Aug06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 BUG9245            Date 16Nov05               *
      *                 BUG8762            Date 01Oct05               *
      *                 CLE106             Date 19Feb05               *
      *                 227716             Date 08Jun04               *
      *                 CLE038             Date 04Jun04               *
      *                 233545             Date 18May05               *
      *                 232348             Date 09Feb05               *
      *                 232320             Date 28Feb05               *
      *                 232319             Date 28Feb05               *
      *                 231710             Date 26Jan05               *
      *                 230521             Date 28Oct04               *
      *                 CAS009             Date 04May04               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 222373             Date 27Oct03               *
      *                 219275             Date 02Jul03               *
      *                 218782             Date 22Jun03               *
      *                 CLE034             Date 05May03               *
      *                 CLE031             Date 19Feb03               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      *                 CGL020             Date 12Dec02               *
      * Midas Release 4.01.03 ----------------------------------------*
      *                 210148             Date 21Nov01               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 204452             Date 02May02               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 179741             Date 27Mar01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CMX001             Data 18Apr01               *
      *                 CLE011             Date 07Nov00               *
      *                 184594             Date 08Nov00               *
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CLE009             Date 14Jun99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 158197             Date 06Apr99               *
      *                 156673             Date 16Mar99               *
      *                 156150             Date 10Mar99               *
      *                 156041             Date 02Mar99               *
      *                 155672             Date 25Feb99               *
      *                 155277             Date 25Feb99               *
      *                 155275             Date 25Feb99               *
      *                 154959             Date 25Feb99               *
      *                 154048             Date 25Feb99               *
      *                 142402             Date 25Feb99               *
      *                 141462             Date 18Feb99               *
      *                 141453             Date 05Oct98               *
     F*                 138419             Date 28SEP98               *
     F*                 133518             Date 22SEP98               *
     F*                 121541             DATE 01JUN98               *
     F*                 CLE007             Date 22May97               *
     F*                 CLE005             Date 22May97               *
     F*                 127966             Date 13Oct97               *
     F*                 100817 (065251)    DATE 16SEP97               *
     F*                  S01408             Date 05Sep96              *
     F*                  100374             Date 22May96              *
     F*                  100515             DATE 22MAY96              *
     F*                  090939             DATE 02AUG95              *
     F*                  S01408             DATE 25JUL95              *
     F*                  057249 (FB0156)    DATE 01JUL93              *
     F*                  052155             DATE 27APR93              *
     F*                  052986             DATE 27APR93              *
     F*                  E45703             DATE 21NOV92              *
     F*                  E45724             DATE 21NOV92              *
     F*                  BH3534             DATE 18SEP92              *
     F*                  BH3495             DATE 15SEP92              *
     F*                  BH3463             DATE 01SEP92              *
     F*                  BH3467             DATE 10AUG92              *
     F*                  BH3462             DATE 06AUG92              *
     F*                  BH3424             DATE 21JUL92              *
     F*                  E33591             DATE 20DEC91              *
     F*                  E30393             DATE 01OCT91              *
     F*                  E25573             DATE 23JUL91              *
     F*                  MOF60              DATE 14FEB92              *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  MD026969 - New Processing for Fee Settlement.                *
      *           - Applied for MD054354                              *
      *  MD052216 - Lending Fee's Payment Due and Taken Day           *
      *             (Recompile)                                       *
      *  CER050 - Annualised Percentage Rate (Recompile)              *
      *  MD053946 - Cross ccy settlement entries not generated for    *
      *             calculated loan fee, auto settle ‘C’ and settled  *
      *             against nostro account                            *
      *  MD051883 - CLE031: Changes to Value Date Account Keys        *
      *  MD053607 - Matured Fee did not appear on fees screen.        *
      *           - Recompile due to changes in LEFHSTL6.             *
      *  MD053295 - Lending loan with Interest Calculation Basis      *
      *             method 3 (30/360) has wrong interest payment      *
      *             amount for month of March (Recompile)             *
      *  MD050139- AOSARDR0 called every time causing performance     *
      *            issue. Recompile due to changes in /COPY           *
      *            ZFREQ/ZFRQ*.                                       *
      *  MD050111 - Component LEC0701 failed due to DBERR 18. CLE148  *
      *             introduced alphanumeric loan numbers and as such  *
      *             can no longer test for facility with 'F' in 1st   *
      *             character in LNFRA. Test with blank instead since *
      *             loan reference can never contain blanks.          *
      *  MD051940 - PDCL X, Y, Z amount is incorrect as a result of   *
      *             conversion rounding error.                        *
      *  CLE071 - Value Dating of Rate Changes to Fees (Recompile)    *
      *  MD049826 - Lending - Loan Fee reversal posted with           *
      *             incorrect Account Sequence                        *
      *  CLE159 - Lending Fee Amortisation Enhancement                *
      *  MD051242 - CLE031: COB: GLC0340 failed with Currency out of  *
      *             balance for fee with no settlement currency       *
      *  MD046248 - Finastra Rebranding                               *
      *  MD046080 - Gap between CLE031 (Settlement to different       *
      *             currency) and CLE134 (PDCL processing)            *
      *  MD046294 - Additional Fix due to redundated LEHISTV3.        *
      *             Patterned fix to MD031496                         *
      *  MD029938A - Added CLE148 changes on SR/FEECHG and formalised *
      *              reversal of MD023863.                            *
      *  AR317401 - Loan fee subtype change enhancement.              *
      *           - Applied for MD029938A                             *
      *  MD047993 - Modified MD035545. Removed dependency on Accrue   *
      *             on Last Day indicator.                            *
      *  MD035545 - LE: Interest Calculation in Leap year. Consider   *
      *             Accrue on Last Day Indicator for method 6.        *
      *  MD045509 - LE: Incorrect account sequence for loan fee       *
      *             reversal.                                         *
      *  MD045010 - Component LEC06A 10008 looping during COB caused  *
      *             by CGL184. Recompile due to changes in ZFRQB3.    *
      *  CGL184 - New Frequencies for Account Statements (Recompile)  *
      *  251069 - Some facility based feeds are generated with a      *
      *           class code (CLE042)                                 *
      *           Class code only req'd loan backed fees              *
      *         - Applied for MD039357.                               *
      *  CLE141A - CLE141 Change Control 1                            *
      *  CLE141 - Currency and Location Business Day Convention       *
      *           for LE Transactions                                 *
      *  CLE164 - CLE134 Enhancement F (Repayment Methodology)        *
      *  MD030334 - Added checking on account details before output to*
      *             PDCL file.  Patterned after AR217563 on LER135.   *
      *  MD025212 - Close of Business: LERC13 - file control          *
      *             out of balance                                    *
      *  MD023863 - EODPOPD reconciliation difference on value date   *
      *  MD025519 - LE one-off fee payment/due posting is missing     *
      *             even the a/c key was generated.                   *
      *  MD020824A - System still generated another PDCL with same    *
      *              amount for PDCL fee created on line. Skip the    *
      *              payment process for Payment On Ind='E' , Auto-   *
      *              settle='C' and PDCL exist in LEPDUFPD when the   *
      *              end date has been reached                        *
      *  AR737558 - Overdraft amount on accrual fee account           *
      *             Workaround fix: less FELPAM on calculated accrual *
      *             for auto-settle Calculated Loan Fees Reversed on  *
      *             Payment Date. (Child: AR737559)                   *
      *  MD020212 - Differences found in SEPCKM and SEPCKT due to     *
      *             incorrect field type of FELOAN field              *
      *  MD019852 - LEC06A 10014 in FOOB during Day 3 EN COB          *
      *  AR1076968B - System did not generate PDCL Fees for unpaid    *
      *               portion of fee due                              *
      *  AR995302 - Postings generated from lending fees do not have  *
      *             profit center. Initialise LKPRFC for field to     *
      *             contain correct profit center. (Child: AR995303)  *
      *  AR632102B - For matured fees, there are still records in PF/ *
      *              LEFHST with fee sequence not equal to '00'.      *
      *              Amended program to ensure that fee sequence of   *
      *              all records of a maturing fee will be updated to *
      *              '00'. (Child: AR632103)                          *
      *  AR632103A - Additional fix is needed to ensure that corres-  *
      *              ponding records of reversed fees are deleted in  *
      *              PF/LEFHST. Added condition in SR/REMOVE, to en-  *
      *              sure that when FERECI = '*' and will be dropped  *
      *              from LEFEED, records in LEFHST with HIRECI='D'   *
      *              will be dropped as well.                         *
      *  AR632103 - During COB, incorrect amount of accruals posted   *
      *             newly inserted fee. As preventative fix, added    *
      *             calling of LER136 in SR/REMOVE.                   *
      *  260961 - DBASE error on LERC13, loan not found in CLOANCL.   *
      *           Amend program to search records in reversal file    *
      *           RVLNSRV or PETEMPL0 (loan temp file before process) *
      *           Applied fix 257363, 248841 and part of fix 257109.  *
      *  262298 - Incorrect amount of accruals posted when rundate is *
      *           prior to fee end date. Add a validation such that   *
      *           when CAS009/CLE031 is switched ON & profit date is  *
      *           prior to fee end date, value of field FEADBP will be*
      *           used instead of FEADAT.                             *
      *         - Applied for AR1014862 (Child: AR1014865)            *
      *  AR857632 - Incorrect value date of the reversal posting of a *
      *             back-valued loan fee. Use fee start or end date   *
      *             for the value of FESDAT instead of rundate.       *
      *             Applied fix AR400054. (Child: AR857633)           *
      *  AR1080660 - Erroneous generated result with PDCL details     *
      *  AR1078443 - LEC000456 component failed during Day 2 COB      *
      *  AR996895 - Incorrect acrrual interest calculation            *
      *             (Child: AR996897) (Recompile)                     *
      *  AR1056323 - Revert back changes of CLE134 for LKEY1DP and    *
      *              LKEYFED (Recompile)                              *
      *  258597 - Global synchronization failed due to duplicate      *
      *           records in GZLEFEED. Do not zeroise the fee         *
      *           fee sequence in LEFEED if the fee is goint to be    *
      *           matured in this COB run                             *
      *  AR785482 - Fees are dropped with active PDCL's. Prevent      *
      *             purging of matured fee in LEFEED if it still has  *
      *             live PDCL. (Child: AR785483)                      *
      *  AR741212 - Manual Repayment settling against a nostro account*
      *             created a PDCL. Only output records into LEPK3DP  *
      *             if settlement account is Retail.                  *
      *             or if Settlement account is GL (this one is as    *
      *             per bank's request) (Child: AR741213)             *
      *  AR997862 - CLE148: KLNNO incorrectly defined as numeric      *
      *             SFDC 00724180 (Child: AR997863)                   *
      *  259013 - Skip processing for 210148 when fee has fee accrued *
      *           to date equal to negative fee amount                *
      *  AR574425 - When the Fee is deleted from LEFEED, all          *
      *             LEPDUFPD records must be deleted too              *
      *             (Child: AR574426)                                 *
      *  AR571427 - SEVDAT must contain the Fee start date            *
      *             (Child: AR571428)                                 *
      *  AR402732 - Bullet fee should not mature if autosettle is C   *
      *             (Child: AR402733)                                 *
      *  AR217562 - Set Suspended Fees allowed flag (Child: AR217563) *
      *  263358 - Trailer not updated correctly                       *
      *  263074 - Wrong Postings when interest and principal are paid *
      *           on the same day                                     *
      *           CLE134 / SWIFT                                      *
      *  CLE134 - Past Due Call Loan Processing                       *
      *  CLE148 - Alpha Loan Reference                                *
      *  AR800866 - Account sequence is wrong causing fees to be      *
      *             posted to wrong account. Output account sequence  *
      *             based on related loan/facility. (Child: AR800867) *
      *  AR821870 - Component LERC13 00003 failed due to FOOB         *
      *  AR821740 - COB - No stamp tax account keys generated         *
      *             (Recompile)                                       *
      *  CER049 - Stamp Tax (Recompile)                               *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  CLE143 - Original Loan Contract Date & Effective Interest    *
      *           Rate (Recompile)                                    *
      *  AR745249A - LEC06A 10014 failed due to 'XXXX' Loan Class     *
      *             (Child:AR745251)                                  *
      *  AR787620 - Hooks Incorporation                               *
      *             WNCPYSRC,LEH00326                                 *
      *             WNCPYSRC,LEH00327                                 *
      *  AR750638 - Fee record is being replicated in LE004621P2      *
      *             every cob run (Child:AR750639)                    *
      *  AR750543A - Additional fix for audit report to specify if    *
      *              report is either for Paid or Capitalised         *
      *              (Child: AR750544)                                *
      *  AR750543 - LERC13 00003 failed. FOOB error in audit report.  *
      *             (Child: AR750544)                                 *
      *  CLE139 - Lending Fee Capitalisation                          *
      *  CLE064 - Enhancement of Lending Frequencies (Recompile)      *
      *  262573 - Avoid duplication of fee totals on CLOANCL when     *
      *           LER130 is run twice on ANWD                         *
      *  262553 - Ensure cash flow for EIR purposes is produced       *
      *           on fee entry date and with correct data retrieved   *
      *           from loans file                                     *
      *  258222 - Fees to be amortised over period should be excluded *
      *           when updating TFAM in CLOANCL.                      *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *            to Midas Plus (Recompile)                          *
      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
      *           Midas Plus (Recompile)                              *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  248821 - Wrong Value Date                                    *
      *  260345 - Inability to insert fees, seq# already exists.      *
      *           Housekeep LEFEEDQD for reversed records.            *
      *  CSW208 - SWIFT 2008 Changes                                  *
      *  242602 - In dropping of fees, Amortisation Method should be  *
      *           considered only when CAS009 is on.                  *
      *  247979 - Postings for fees do not reflect the Profit Centre  *
      *           for the fee.                                        *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  CAS019 - Upgrade of CAS016 to Midas Plus                     *
      *  238569 - IAS18 Fee totals on the EIR record needs to be      *
      *           updated                                             *
      *  CAS016 - IAS18 EIR Recalculation (Fee Amortisation Over      *
      *           Whole Period)                                       *
      *  CPK027 - Error in 243499 - LKOLNO should now be 6A           *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  243499 - Set up new Original Borrower field in LKEYFED for   *
      *           Loan Fees.  Applied fix 213370.                     *
      *  BUG13140 - Doubling of amounts of Total Adj. to yield fees   *
      *             and Total FDP on LE004620P1 report                *
      *  BUG13038 - accruing fees Total recurred amount not displyed  *
      *  BUG13031 - Incorrect cashflow date is being written for fees *
      *             due to the increment in event date done by        *
      *             CLE025.  This is causing the incorrect EIR        *
      *             calculation in CAS009.                            *
      *             The code for CLE025 will be removed to avoid      *
      *             errors this may cause in other IAS modules. The   *
      *             "extra fee because of fee" scenario in CLE025     *
      *             will have to be accepted as a limitation.         *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  240672 - One day accrual always added if CAS009 is off.      *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type                              *
      *  BUG9245 - Linear account keys not being generated on cutover *
      *            (Applied fix 236267)                               *
      *  BUG8762 - Capture fee rates and amounts (HIFRTn and HIAMTn)  *
      *            to LEFHST from LEFEED (FEFRTn and FEAMTn).         *
      *            Applied fix 209513.                                *
      *  CLE106 - Syndication Manager                                 *
      *  227716 - The PC Reference of the settlement allocation needs *
      *           to be renamed so that it does not overwrite the     *
      *           field on the fee.                                   *
      *  CLE038 - Lending Enhancement for Nordea: Allocation by Amount*
      *  233545 - Cut-off Date (Recompile)                            *
      *  232348 - Introduce cut-off date for non-linear amortisation  *
      *  232320 - Loan Number is not populated in LECFLSPD            *
      *  232319 - Rate shown in LE004620 is incorrect                 *
      *  231710 - Dropping of fees should be done when fees have been *
      *           fully non linearly amortised (when Amortisation     *
      *           Method is either ' ' or 'N'). Also removed changing *
      *           interest rates for LEEIRAPD                         *
      *  230521 - Added Field for PF/LEPXTAB. Applied fix 215643      *
      *  CAS009 - Effective Interest Rate/Amortised Cost Accounting   *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines                                        *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222373 - Parameter mismatch.                                 *
      *  219275 - Amendment to CLE031. Amounts in settlement ccy on   *
      *           LER130P1 used wrong number of decimal places.       *
      *  CLE034 - Half adjust splitting of amount in SR34B.           *
      *         - Lending Enhancements Phase 1 Priority 1A            *
      *         - Amendment to CLE031. Records should be written to   *
      *           LEFHST for each period with payment on Next.        *
      *  CLE031 - Lending Enhancements.                               *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  CAS005 - Enahancements to CAS001, CAS002 and CAS004          *
      *           (Recompile)                                         *
      *  CGL020 - Compliance Watch - Additional A/C Postings          *
      *           Information                                         *
      *  210148 - Obtain absolute value of FEFAMT and FEADAT before   *
      *           determining the excess in amount.                   *
      *  204452 - Recompiled due to changed PF/LEFEED.                *
      *  179741 - Convert posted amount to Euro if a settlement       *
      *           currency has been entered & CEU004 is on.           *
      *  CMX001 - Meridian Export                                     *
      *  CLE011 - Rate Fixing Days for Lending Rollover Processing    *
      *           Recompile                                           *
      *  184594 - Total accrued amount is 0.01 greater than the fee   *
      *           amount.                                             *
     F*  CLE009 - Customer Lending Enhancements - SWIFT Message       *
     F*           Generation for fees                                 *
      *  158197 - Invalid A/c keys generated with 'L' or 'S' in pos 7 *
      *  156673 - Amend set-up of outstanding fee amount on settlement*
      *           so that negative o/s amounts are not generated      *
      *           Also amend profitability reporting.                 *
      *  156150 - Wrong amount shown in profitability.                *
      *  156041 - Fee settlement not the same as entered after run -  *
      *           ning COB due to similar fields in CLOAN.            *
      *  155672 - Record is written to LEPXTAB even when settlement   *
      *           type is not 08.                                     *
      *  155277 - Save value of FELPAM in DAYACR so that fuul amount  *
      *           of fee is reversed out on profatbility processing.  *
      *  155275 - OSAC (Our settlement nostro) not being filled on    *
      *           WRITE to LEPXTAB - causes database error in LE4510. *
      *  154959 - Remove hardcoding of european date format in fix    *
      *           141462. Also value for FEFAMT is saved in DAYACR    *
      *           for maturing fees.                                  *
      *  154048 - Wrong field written to sequence on pf/lepxtab;      *
      *           it should be the fee sequence.                      *
      *  142402 - Incorrect fees MTD amount in profitability report   *
      *           when fee is backvalued.                             *
      *  141462 - Fee Income Shows for Primary Facility but not for   *
      *           the participants.                                   *
      *  141453 - Recompiled due to changes in PF/LEFEED              *
     F*  138419 - Amortised fee early matured to rundate did not      *
     F*           generate enddate entries. Applied fixes 119277      *
     F*           and part of 108687.                                 *
     F*  133518 - Apply fix 121191.                                   *
     F*           Facility fee settlement date discrepancy in Fees    *
     F*           Activity Enquiry. Use Fee Settled Date when         *
     F*           writing fee record to Fee History File.             *
     F*  121541 - Amount past due (FEAMTP) still has a value even     *
     F*           after fee is settled. Fix is to zeroise FEAMTP after*
     F*           fee is settled in subroutine DETAIL for payment on  *
     F*           'S' and 'E'.                                        *
     F*  CLE007 - Customer Lending Enhancements - Others (T3)         *
     F*  CLE005 - Customer Lending Enhancements - Tranche 3           *
     F*  127966 - Profit Centre Accounting Development:               *
     F*         - Attach profit centre to lending fees.               *
     F*  100817 - Setup field LKSLID with the start of period date    *
     F*           field before any output to file LKEYFED.            *
     F*   S01408 - Addition of hook LER130CCP1                        *
     F*            Addition of hook LER130CCP2                        *
     F*            Addition of hook LER130CCP3                        *
     F*            Addition of hook LER130CCP4                        *
     F*            Addition of hook LER130CCP5                        *
     F*            Addition of hook LER130EEP1                        *
     F*            Addition of hook LER130FFP1                        *
     F*            Addition of hook LER130IIP1                        *
     F*   100374 - Recompiled due to changes in LER130P1.             *
     F*            Fee sequence is added.                             *
     F*   100515 - Recompile program due to changes in LEFEED.        *
     F*   090939 - For accrual frequencies other than 'D', the Event  *
     F*            Amount which should contain Fees Accrued Today is  *
     F*            being corrupted by the Accrued to Date amount.     *
     F*            Save the daily accrued amount, and restore this    *
     F*            value before updating LKEYFED.                     *
     F*   S01408 - Addition of hook LER130CPG1                        *
     F*            Addition of hook LER130CPG2                        *
     F*            Addition of hook LER130CPG3                        *
     F*   057249 - Report programs cannot distinguish whether the     *
     F*            generated entry is for a fee against a facility    *
     F*            or against a loan.  Fix is to amend this pgm to    *
     F*            output RECI as follows.  Output 'F' for a fee      *
     F*            against a facility and output 'L' for a fee        *
     F*            against a loan.                                    *
     F*   052155 - Ensure that adjustment amounts are reversed if     *
     F*            the fee is reversed                                *
     F*   052986 - Ensure PF/LEFEEZ always updated if 'M' or '*'      *
     F*            fee is deleted from PF/LEFEED.                     *
     F*   E45703 - Whilst looking at problem of non-appearing accrual *
     F*            keys, I spotted that date set-up was skwonky.      *
     F*   E45724 - O/S amount goes negative if amend start date to    *
     F*            before today for a bullet fee with auto settle 'Y'.*
     F*   BH3534 - Posting of accrual missed in some cases and to the *
     F*            settlement branch in others - oh-oh]               *
     F*   BH3495 - Changed to use fee settlement branch for account   *
     F*            key generation                                     *
     F*   BH3463 - This program now deals with fee deletions.         *
     F*            For Non-calculated fees, the posted and settled    *
     F*            amounts are reversed.                              *
     F*            For calculated fees, only the posted amount is     *
     F*            reversed, as calc'd fees cannot be reversed if any *
     F*            settlement has been made.                          *
     F*   BH3467 - FEES SHOULD ONLY POST IF ACCRUAL PROFIT DATE       *
     F*            OR FEE PAYMENT DATE                                *
     F*   BH3462 - ENSURE THAT THE BRANCH CODE & AMOUNT ARE OUTPUT    *
     F*   BH3424 - ENSURE THAT THE OUTSTANDING AMOUNT IS SETUP        *
     F*   E33591 - IF EOM IS FOLLOWED BY A NON-WORKING DAY, PGM       *
     F*            ADDS FEE AMOUNT ON NEXT MONTH.                     *
     F*   E30393 - WRONG ACCOUNT KEYS GENERATED (POS 7 : RECOURSE     *
     F*   (B10039) IND. = 'R' OR ' ' AND NOT 'Y' OR 'N').             *
     F*   E25573 - CONDITION ACCESS TO LOAN DETAILS SOLELY ON FEE     *
     F*            BEING A LOAN BASED FEE.                            *
     F*   MOF60  - CUSTOMER PROFITABILITY & FEES PROCESSING           *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*   F U N C T I O N    O F    I N D I C A T O R S               *
     F*                                                               *
     F* 13    Lokup of currency array for 'from' currency             *
     F* 14    Lokup of currency array for 'to' currency               *
     F* 15    Chain to LF/CLOAN                                       *
     F* 16    Work indicator for read of trailer files                *
     F* 17    Set up of currency array indicator                      *
     F* 18    Chain to LF/LEFEALL0                                    *                       CLE106
     F* 20    First cycle indicator                                   *
     F* 21    Details output to report                                *
     F* 30    Number of Decimal Places = 0                            *
     F* 31    Number of Decimal Places = 1                            *
     F* 32    Number of Decimal Places = 2                            *
     F* 33    Number of Decimal Places = 3                            *
     F* 34    Conditions output of either facility or loan reference  *
     F* 35    Multibranching indicator                                *
     F* 50    Control totals check for LEFEED records                 *
     F* 56    Lokup of currency array                                 *
     F* 60    Read of Fees Master File - LEFEED                       *
     F* 70    Read of LEPEFFD/LEPEFLD files                           *
     F* 80    Overflow indicator - LER130P1                           *
      * 88    Chain to LEPDUFL2                                       *                     MD02084A
     F*                                                               *
     F* 90-99 - Used by Standard Subroutines                          *
     F*                                                               *
     F* U7&U8 Database error                                          *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  DETAIL - To process detail type calculations                 *
     F*  REVERS - Deletion of records from PF/LEFEED                  *
     F*  REMOVE - Removal of expired records from PF/LEFEED           *
     F*  ACCRUE - Accrual processing                                  *
     F*  UPDAT  - Update of PF/LEFEED                                 *
     F*  SETTLE - Settlement processing                               *
     F*  OPNFIL - Open of print file                                  *
     F*  TRAIL  - Trailer processing & file update                    *
     F*  INIT   - Initial subroutine                                  *
     F*  SETDAT - Calculate next payment date.                        *                       CLE031
     F*  SETKEY - Output new settlement account keys                  *                       CLE031
     F*  SETCCY - Convert amount to settlement currency               *                       CLE031
     F*  PRINEV - Print settlement event                              *                       CLE031
     F*  CHKCCY - Check Currency Number of Decimal places             *                       219275
     F*  *PSSR  - Error handling subroutine                           *
     F*  ZCONV  - Convert Amount to Another Currency                  *
     F*  ZXRATE - Cross-exchange rate & multiply/dive indicator       *
     F*           between two currencies.                             *
     F*  ZDATE1 - Validate Date and Convert into Midas Day Number     *
     F*  ZDATE2 - Convert Midas Day Number into Date (DDMMYY/MMDDYY)  *
     F*  ZHASH  - Hash totalling subroutine                           *
     F*  ZFREQB - Calculate next payment date.                        *                       CLE031
     F*  ZCHKH  - Check for holiday in fee ccy                        *                       CLE031
     F*  ZACCH  - Access record from holiday file.                    *                       CLE031
     F*                                                               *
     F*****************************************************************
     FSDCURRL0IF  E           K        DISK
     FCLOAN   IF  E           K        DISK
     F            CLOANHHF                          KIGNORE
     F            CLOANCKF                          KIGNORE
     F            CLOANZ1F                          KIGNORE
     FPETEMPL0IF  E           K        DISK                                                   260961
     F            CLOANCLF                          KRENAMECLOANPE                            260961
     FMLOAN   IF  E           K        DISK                                                   260961
     F            CLOANHHF                          KIGNORE                                   260961
     F            CLOANCKF                          KIGNORE                                   260961
     F            CLOANZ1F                          KIGNORE                                   260961
     F            CLOANCLF                          KRENAMEMCLONCLF                           260961
     FFCLTY   IF  E           K        DISK                                                   CGL020
     F            FCLTYHHF                          KIGNORE                                   CGL020
     F            FCLTYFNF                          KIGNORE                                   CGL020
     F            FCLTYZZF                          KIGNORE                                   CGL020
     F***RVLNSL0 IF  E           K        DISK                                       260961 MD049826
     FLEFEED  UF  E           K        DISK         KINFSR *PSSR
     FLEFEEZ  UF  E                    DISK         KINFSR *PSSR
     FLEPEFLD UF  E           K        DISK         KINFSR *PSSR A
     FLEPEFFD UF  E           K        DISK         KINFSR *PSSR A
     FLEPEFLZ UF  E                    DISK         KINFSR *PSSR
     FLEPEFFZ UF  E                    DISK         KINFSR *PSSR
     F/COPY WNCPYSRC,LEH00550
     FLEFHSTL6UF  E           K        DISK         KINFSR *PSSR                           AR632103A
     F            LEFHSTF                           KRENAMELEFHSTR                         AR632103A
     FLEFEALL0UF  E           K        DISK         KINFSR *PSSR                              CLE106
     FLEFEEQL0UF  E           K        DISK         KINFSR *PSSR                              260345
     FLKEYFED O   E                    DISK         KINFSR *PSSR
     F/COPY WNCPYSRC,LEH01199
     FLKEYFEA O   E                    DISK         KINFSR *PSSR
     FLKEYFEZ O   E                    DISK         KINFSR *PSSR
     FLEFHST  O   E                    DISK         KINFSR *PSSR
     FLEPXTAA O   E                    DISK         KINFSR *PSSR      UC  CLE007
     FLEPXTAB O   E                    DISK         KINFSR *PSSR      UC  CLE007
     FLEPXTAC O   E                    DISK         KINFSR *PSSR      UC  CLE007
     F***LEHISTV3IF  E           K        DISK                                     AR317401 MD046294
     FLEPK3DPDO   E                    DISK         KINFSR *PSSR                              CLE134
     F            LKEYFEDF                          KRENAMELKEYF3DF                           CLE134
     FLEPK3HH IF  E                    DISK         KINFSR *PSSR A                            CLE134
     F            LKEYFEAF                          KRENAMELKEYF3AF                           CLE134
     FLEPK3ZZ UF  E                    DISK         KINFSR *PSSR A                            CLE134
     F            LKEYFEZF                          KRENAMELKEYF3ZF                           CLE134
     F***LEPDUFL2UF  E           K        DISK         KINFSR *PSSR                  CLE134 AR574425
     FLEPDUFL2IF  E           K        DISK         KINFSR *PSSR                            AR574425
     FLEPDUFLBUF  E           K        DISK         KINFSR *PSSR                            AR574425
     F            LEPDUFD0                          KRENAMELEPDUFDB                         AR574425
     F***LEACCNL6UF  E           K        DISK         KINFSR *PSSR                  AR574425 CLE164
     FLEFEEZI0UF  E           K        DISK         KINFSR *PSSR                              CLE164
     FLER130P1O   E             80     PRINTER      KINFDS SPOOL      UC
     FLER130AUO   E                    PRINTER      KINFDS SPOOLU
     F***LECFLSPDUF  E           K        DISK         KINFSR *PSSR A                  CAS009 CAS016
     FLECFLSL1UF  E           K        DISK         KINFSR *PSSR A                            CAS016
      ** Cash Flow file                                                                       CAS009
     FCLOANL4 UF  E           K        DISK         KINFSR *PSSR                              CAS009
     F            CLOANCLF                          KRENAMEZ9LNCLF                            CAS009
     F***LEEIRAL4UF  E           K        DISK         KINFSR *PSSR                    CAS009 231710
     F**********  LEEIRAD0                          KRENAMELEEIRAD4                    CAS009 231710
     FLEEIRDL5UF  E           K        DISK         KINFSR *PSSR                              CAS009
     F            LEEIRDD0                          KRENAMELEEIRDD5                           CAS009
     FLOAMS   UF  E           K        DISK         KINFSR *PSSR A                            CLE139
     F            LOAMSDHF                          KIGNORE                                   CLE139
     FLEFZASL1UF  E           K        DISK         KINFSR *PSSR                            MD026969
      *
     F/COPY WNCPYSRC,LER130FFP1                                           S01408
      /SPACE 3
     E********************AKY********10  1               A/C KEYS                             CLE042
     E                    AKY        14  1               A/C KEYS                             CLE042
     E                    WCYA      150  3               CURRENCIES
     E                    WDPA      150  1 0             DEC. PLACES
     E                    WSPA      150 13 8             SPOT RATES
     E                    WMDA      150  1               MULT/DIV INDS
     E                    FFD        12 15 0
     E                    FLD        12 15 0
     E***********         INT         1 15 0             ZHASH INTEGERS   CLE007
     E***********         DEC         1  3 0             ZHASH DECIMALS   CLE007
     E***********         INT         2 15 0             Zhash Integers                CLE007 CLE139
     E***********         DEC         2  3 0             Zhash Decimals                CLE007 CLE139
     E                    INT         4 15 0             Zhash Integers                       CLE139
     E                    DEC         4  3 0             Zhash Decimals                       CLE139
     E                    WINA      150  1               In Ccy Ind. array                    CLE031
     E********************SAVAKY*****10  1               Saved A/C KEY                 CLE031 CLE042
     E********************SVLKEY*****10  1               Saved A/C KEY                 CLE031 CLE042
     E                    SAVAKY     14  1               Saved A/C KEY                        CLE042
     E                    SVLKEY     14  1               Saved A/C KEY                        CLE042
     E                    CPY@    1   1 80
     E                    POWER   1   7  7 3             POWER ARRAY
     E                    ZFMD   12  12  2               Freq SR. Array                       CLE031
     E                    STAMP   1   1 26                                                    CLE034
     E                    SVAL    1   1 20                                                    218782
     E/COPY WNCPYSRC,LER130E001
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZDATE9Z1                                                                   CAS009
     E/COPY ZSRSRC,ZHOLE                                                                      CLE031
     E/COPY WNCPYSRC,LER130EEP1                                           S01408
      /EJECT
      **                                                                                      CLE134
     ILEPDUFD0                                                                                CLE134
      ** Rename fields                                                                        CLE134
     I              YTKPACL                         YTKPAC                                    CLE134
     I              YTKPABR                         YTKPAB                                    CLE134
     I              YTKPAAC                         YTKPAA                                    CLE134
     I              YTKPASE                         YTKPAS                                    CLE134
     I              YTKPACY                         YTKPCY                                    CLE134
      *                                                                   156041
      **                                                                                    AR574425
     ILEPDUFDB                                                                              AR574425
      ** Rename fields                                                                      AR574425
     I              YTKPACL                         YTKPAC                                  AR574425
     I              YTKPABR                         YTKPAB                                  AR574425
     I              YTKPAAC                         YTKPAA                                  AR574425
     I              YTKPASE                         YTKPAS                                  AR574425
     I              YTKPACY                         YTKPCY                                  AR574425
      *                                                                                     AR574425
      ** Rename Loan fields to avoid overriding LEFEED file               156041
      *                                                                   156041
     ICLOANCLF                                                            156041
     I              IUSR                            TPIUSR                156041
     I              AUSR                            TPAUSR                156041
     I              XUSR                            TPXUSR                156041
     I              PCRF                            TPPCRF                156041
     I              OSDB                            TPOSDB                156041
     I              OMDB                            TPOMDB                156041
     I              RSTM                            TPRSTM                156041
     I              RONS                            TPRONS                156041
     I              RIBN                            TPRIBN                156041
     I              RIBA                            TPRIBA                156041
     I              ROBN                            TPROBN                156041
     I              ROCN                            TPROCN                156041
     I              PSTM                            TPPSTM                156041
     I              PONS                            TPPONS                156041
     I              PIBN                            TPPIBN                156041
     I              PIBA                            TPPIBA                156041
     I              POBN                            TPPOBN                156041
     I              POCN                            TPPOCN                156041
     I              RCRN                            TPRCRN                156041
     I              RCRA                            TPRCRA                156041
     I              RVNO                            TPRVNO                156041
     I              AWBN                            TPAWBN                156041
     I              AWBA                            TPAWBA                156041
     I              BENN                            TPBENN                156041
     I              BENA                            TPBENA                156041
     I              DTP1                            TPDTP1                156041
     I              DTP2                            TPDTP2                156041
     I              DTP3                            TPDTP3                156041
     I              DTP4                            TPDTP4                156041
     I              DCHG                            TPDCHG                156041
     I              BTB1                            TPBTB1                156041
     I              BTB2                            TPBTB2                156041
     I              BTB3                            TPBTB3                156041
     I              BTB4                            TPBTB4                156041
     I              BTB5                            TPBTB5                156041
     I              BTB6                            TPBTB6                156041
     I              CVMR                            TPCVMR                156041
     I              PCOB                            TPPCOB                156041
     I              LSWC                            TPLSWC                156041
     I              LSWS                            TPLSWS                156041
     ICLOANPE                                                                                 260961
     I              IUSR                            PEIUSR                                    260961
     I              AUSR                            PEAUSR                                    260961
     I              XUSR                            PEXUSR                                    260961
     I              PCRF                            PEPCRF                                    260961
     I              OSDB                            PEOSDB                                    260961
     I              OMDB                            PEOMDB                                    260961
     I              RSTM                            PERSTM                                    260961
     I              RONS                            PERONS                                    260961
     I              RIBN                            PERIBN                                    260961
     I              RIBA                            PERIBA                                    260961
     I              ROBN                            PEROBN                                    260961
     I              ROCN                            PEROCN                                    260961
     I              PSTM                            PEPSTM                                    260961
     I              PONS                            PEPONS                                    260961
     I              PIBN                            PEPIBN                                    260961
     I              PIBA                            PEPIBA                                    260961
     I              POBN                            PEPOBN                                    260961
     I              POCN                            PEPOCN                                    260961
     I              RCRN                            PERCRN                                    260961
     I              RCRA                            PERCRA                                    260961
     I              RVNO                            PERVNO                                    260961
     I              AWBN                            PEAWBN                                    260961
     I              AWBA                            PEAWBA                                    260961
     I              BENN                            PEBENN                                    260961
     I              BENA                            PEBENA                                    260961
     I              DTP1                            PEDTP1                                    260961
     I              DTP2                            PEDTP2                                    260961
     I              DTP3                            PEDTP3                                    260961
     I              DTP4                            PEDTP4                                    260961
     I              DCHG                            PEDCHG                                    260961
     I              BTB1                            PEBTB1                                    260961
     I              BTB2                            PEBTB2                                    260961
     I              BTB3                            PEBTB3                                    260961
     I              BTB4                            PEBTB4                                    260961
     I              BTB5                            PEBTB5                                    260961
     I              BTB6                            PEBTB6                                    260961
     I              CVMR                            PECVMR                                    260961
     I              PCOB                            PEPCOB                                    260961
     I              LSWC                            PELSWC                                    260961
     I              LSWS                            PELSWS                                    260961
      *                                                                                       260961
     IMCLONCLF                                                                                260961
     I              IUSR                            MCIUSR                                    260961
     I              AUSR                            MCAUSR                                    260961
     I              XUSR                            MCXUSR                                    260961
     I              PCRF                            MCPCRF                                    260961
     I              OSDB                            MCOSDB                                    260961
     I              OMDB                            MCOMDB                                    260961
     I              RSTM                            MCRSTM                                    260961
     I              RONS                            MCRONS                                    260961
     I              RIBN                            MCRIBN                                    260961
     I              RIBA                            MCRIBA                                    260961
     I              ROBN                            MCROBN                                    260961
     I              ROCN                            MCROCN                                    260961
     I              PSTM                            MCPSTM                                    260961
     I              PONS                            MCPONS                                    260961
     I              PIBN                            MCPIBN                                    260961
     I              PIBA                            MCPIBA                                    260961
     I              POBN                            MCPOBN                                    260961
     I              POCN                            MCPOCN                                    260961
     I              RCRN                            MCRCRN                                    260961
     I              RCRA                            MCRCRA                                    260961
     I              RVNO                            MCRVNO                                    260961
     I              AWBN                            MCAWBN                                    260961
     I              AWBA                            MCAWBA                                    260961
     I              BENN                            MCBENN                                    260961
     I              BENA                            MCBENA                                    260961
     I              DTP1                            MCDTP1                                    260961
     I              DTP2                            MCDTP2                                    260961
     I              DTP3                            MCDTP3                                    260961
     I              DTP4                            MCDTP4                                    260961
     I              DCHG                            MCDCHG                                    260961
     I              BTB1                            MCBTB1                                    260961
     I              BTB2                            MCBTB2                                    260961
     I              BTB3                            MCBTB3                                    260961
     I              BTB4                            MCBTB4                                    260961
     I              BTB5                            MCBTB5                                    260961
     I              BTB6                            MCBTB6                                    260961
     I              CVMR                            MCCVMR                                    260961
     I              PCOB                            MCPCOB                                    260961
     I              LSWC                            MCLSWC                                    260961
     I              LSWS                            MCLSWS                                    260961
      *****************************************************************            AR317401 MD046294
     I***HISTSHPF                                                                  AR317401 MD046294
      *****************************************************************            AR317401 MD046294
      ***Rename*fields.************************************************            AR317401 MD046294
      *                                                                            AR317401 MD046294
     I**********    RECI                            RECIHP                         AR317401 MD046294
     I**********    RCDT                            RCDTHP                         AR317401 MD046294
     I**********    BRCA                            BRCAHP                         AR317401 MD046294
     I**********    CNUM                            CNUMHP                         AR317401 MD046294
     I**********    LNRF                            LNRFHP                         AR317401 MD046294
     I**********    VDAT                            VDATHP                         AR317401 MD046294
     I**********    PRSQ                            PRSQHP                         AR317401 MD046294
     I**********    LASN                            LASNHP                         AR317401 MD046294
     I**********    CCY                             CCYHP                          AR317401 MD046294
     I**********    AMTP                            AMTPHP                         AR317401 MD046294
     I**********    LTYP                            LTYPHP                         AR317401 MD046294
     I**********    SUTP                            SUTPHP                         AR317401 MD046294
     I**********    LCD                             LCDHP                          AR317401 MD046294
     I/COPY WNCPYSRC,LEH01080
      *                                                                                       CGL020
      ** Rename Facility fields                                                               CGL020
      *                                                                                       CGL020
     IFCLTYFMF                                                                                CGL020
     I              RECI                            FCRECI                                    CGL020
     I              CNUM                            FCCNUM                                    CGL020
     I              FACT                            FCFACT                                    CGL020
     I              FCNO                            FCFCNO                                    CGL020
     I              RCTP                            FCRCTP                                    CGL020
     I              BRCA                            FCBRCA                                    CGL020
     I              FCTI                            FCFCTI                                    CGL020
     I              FCCY                            FCFCCY                                    CGL020
     I              FAMT                            FCFAMT                                    CGL020
     I              OVPC                            FCOVPC                                    CGL020
     I              DTAP                            FCDTAP                                    CGL020
     I              DTEX                            FCDTEX                                    CGL020
     I              RVCR                            FCRVCR                                    CGL020
     I              SECI                            FCSECI                                    CGL020
     I              MCCY                            FCMCCY                                    CGL020
     I              MCSI                            FCMCSI                                    CGL020
     I              NACD                            FCNACD                                    CGL020
     I              CRSK                            FCCRSK                                    CGL020
     I              DLFS                            FCDLFS                                    CGL020
     I              NOMR                            FCNOMR                                    CGL020
     I              RVDT                            FCRVDT                                    CGL020
     I              RVFR                            FCRVFR                                    CGL020
     I              RVDY                            FCRVDY                                    CGL020
     I              NAR1                            FCNAR1                                    CGL020
     I              NAR2                            FCNAR2                                    CGL020
     I              NAR3                            FCNAR3                                    CGL020
     I              NAR4                            FCNAR4                                    CGL020
     I              MTDH                            FCMTDH                                    CGL020
     I              MTDL                            FCMTDL                                    CGL020
     I              MTDA                            FCMTDA                                    CGL020
     I              QTDA                            FCQTDA                                    CGL020
     I              YTDA                            FCYTDA                                    CGL020
     I              ACOF                            FCACOF                                    CGL020
     I              ORBR                            FCORBR                                    CGL020
     I              ZZ001                           FC001                                     CGL020
     I              RVCD                            FCRVCD                                    CGL020
     I              ZZ002A                          FC002A                                    CGL020
     I              ORED                            FCORED                                    CGL020
     I              LCD                             FCLCD                                     CGL020
     I              CHTP                            FCCHTP                                    CGL020
     I              TNLU                            FCTNLU                                    CGL020
     I              SYIN                            FCSYIN                                    CGL020
     I              ANUM                            FCANUM                                    CGL020
     I              DTPS                            FCDTPS                                    CGL020
     I              DICB                            FCDICB                                    CGL020
     I              RTPS                            FCRTPS                                    CGL020
     I              RLPD                            FCRLPD                                    CGL020
     I              CSEL                            FCCSEL                                    CGL020
     I              ALCY                            FCALCY                                    CGL020
     I              COMD                            FCCOMD                                    CGL020
     I              CDTE                            FCCDTE                                    CGL020
     I              AVLD                            FCAVLD                                    CGL020
     I              LPTP                            FCLPTP                                    CGL020
     I              LPBR                            FCLPBR                                    CGL020
     I              LPAM                            FCLPAM                                    CGL020
     I              LPPS                            FCLPPS                                    CGL020
     I              DFTP                            FCDFTP                                    CGL020
     I              DFST                            FCDFST                                    CGL020
     I              TRCA                            FCTRCA                                    CGL020
     I              CANM                            FCCANM                                    CGL020
     I              CAFT                            FCCAFT                                    CGL020
     I              CAFN                            FCCAFN                                    CGL020
     I              ACSQ                            FCACSQ                                    CGL020
     I              FSTS                            FCFSTS                                    CGL020
     I              IUSR                            FCIUSR                                    CGL020
     I              AUSR                            FCAUSR                                    CGL020
     I              XUSR                            FCXUSR                                    CGL020
     I              SYCP                            FCSYCP                                    CGL020
     I              PCRF                            FCPCRF                                    CGL020
     I              PRTR                            FCPRTR                                    CGL020
     I              PMFC                            FCPMFC                                    CGL020
     I              PMFT                            FCPMFT                                    CGL020
     I              PMFN                            FCPMFN                                    CGL020
     I              INUM                            FCINUM                                    CGL020
     I              JDTE                            FCJDTE                                    CGL020
     I              SHTP                            FCSHTP                                    CGL020
     I              SHPC                            FCSHPC                                    CGL020
     I              RCSI                            FCRCSI                                    CGL020
     I              SKIR                            FCSKIR                                    CGL020
     I              SKIS                            FCSKIS                                    CGL020
     I              SKFR                            FCSKFR                                    CGL020
     I              SKFS                            FCSKFS                                    CGL020
     I              VDTC                            FCVDTC                                    CGL020
     I              OSDB                            FCOSDB                                    CGL020
     I              OMDB                            FCOMDB                                    CGL020
     I              RSTM                            FCRSTM                                    CGL020
     I              RONS                            FCRONS                                    CGL020
     I              RIBN                            FCRIBN                                    CGL020
     I              RIBA                            FCRIBA                                    CGL020
     I              ROBN                            FCROBN                                    CGL020
     I              ROCN                            FCROCN                                    CGL020
     I              PSTM                            FCPSTM                                    CGL020
     I              PONS                            FCPONS                                    CGL020
     I              PIBN                            FCPIBN                                    CGL020
     I              PIBA                            FCPIBA                                    CGL020
     I              POBN                            FCPOBN                                    CGL020
     I              POCN                            FCPOCN                                    CGL020
     I              RCRN                            FCRCRN                                    CGL020
     I              RCRA                            FCRCRA                                    CGL020
     I              RVNO                            FCRVNO                                    CGL020
     I              AWBN                            FCAWBN                                    CGL020
     I              AWBA                            FCAWBA                                    CGL020
     I              BENN                            FCBENN                                    CGL020
     I              BENA                            FCBENA                                    CGL020
     I              DTP1                            FCDTP1                                    CGL020
     I              DTP2                            FCDTP2                                    CGL020
     I              DTP3                            FCDTP3                                    CGL020
     I              DTP4                            FCDTP4                                    CGL020
     I              DCHG                            FCDCHG                                    CGL020
     I              BTB1                            FCBTB1                                    CGL020
     I              BTB2                            FCBTB2                                    CGL020
     I              BTB3                            FCBTB3                                    CGL020
     I              BTB4                            FCBTB4                                    CGL020
     I              BTB5                            FCBTB5                                    CGL020
     I              BTB6                            FCBTB6                                    CGL020
     I              CVMR                            FCCVMR                                    CGL020
     I              PCOB                            FCPCOB                                    CGL020
     I              CAXR                            FCCAXR                                    CGL020
     I              CMDI                            FCCMDI                                    CGL020
     I              CACY                            FCCACY                                    CGL020
     I              PFTI                            FCPFTI                                    CGL020
     I              SCCY                            FCSCCY                                    CGL020
     I              ICCY                            FCICCY                                    CGL020
     I              LAID                            FCLAID                                    CGL020
     I              PASI                            FCPASI                                    CGL020
     I              REPI                            FCREPI                                    CGL020
     I              FRNT                            FCFRNT                                    CGL020
     I              AFRT                            FCAFRT                                    CGL020
     I              REPA                            FCREPA                                    CGL020
     I              STMP                            FCSTMP                                    CGL020
     I              DFCL                            FCDFCL                                    CLE042
     I              DTPX                            FCDTPX                                  AR800866
     I              COAG                            FCCOAG                                  AR800866
     I              FCAG                            FCFCAG                                  AR800866
     I              PHAG                            FCPHAG                                  AR800866
     I              SCAG                            FCSCAG                                  AR800866
     I              REXR                            FCREXR                                  AR800866
     I              REXI                            FCREXI                                  AR800866
     I              PSCY                            FCPSCY                                  AR800866
     I              PEXR                            FCPEXR                                  AR800866
     I              PEXI                            FCPEXI                                  AR800866
     I              OVAM                            FCOVAM                                  AR800866
     I              SVCD                            FCSVCD                                  AR800866
     I              LMTI                            FCLMTI                                  AR800866
     I              AUTH                            FCAUTH                                  AR800866
      *                                                                                       CLE106
      ** Rename Fields on Fee Allocations file:                                               CLE106
      *                                                                                       CLE106
     ILEFEALP0                                                                                CLE106
     I              CNUM                            ALCNUM                                    CLE106
     I              FACT                            ALFACT                                    CLE106
     I              PRTR                            ALPRTR                                    CLE106
     I              FSPA                            ALFSPA                                    CLE106
     I              PPRF                            ALPPRF                                    CLE106
     IZ9LNCLF                                                                                 CAS009
      ** Rename field                                                                         CAS009
     I              RECI                            Z9RECI                                    CAS009
     I              LNRF                            Z9LNRF                                    CAS009
     I              RCDT                            Z9RCDT                                    CAS009
     I              MRIN                            Z9MRIN                                    CAS009
     I              PTYP                            Z9PTYP                                    CAS009
     I              CNUM                            Z9CNUM                                    CAS009
     I              BRCA                            Z9BRCA                                    CAS009
     I              LTYP                            Z9LTYP                                    CAS009
     I              SUTP                            Z9SUTP                                    CAS009
     I              DDAT                            Z9DDAT                                    CAS009
     I              VDAT                            Z9VDAT                                    CAS009
     I              MDAT                            Z9MDAT                                    CAS009
     I              LASQ                            Z9LASQ                                    CAS009
     I              FCUS                            Z9FCUS                                    CAS009
     I              FTYP                            Z9FTYP                                    CAS009
     I              FSEQ                            Z9FSEQ                                    CAS009
     I              CCY                             Z9CCY                                     CAS009
     I              CPAM                            Z9CPAM                                    CAS009
     I              INTC                            Z9INTC                                    CAS009
     I              INTR                            Z9INTR                                    CAS009
     I              BRTT                            Z9BRTT                                    CAS009
     I              BRTE                            Z9BRTE                                    CAS009
     I              RTSP                            Z9RTSP                                    CAS009
     I              MARG                            Z9MARG                                    CAS009
     I              SPIN                            Z9SPIN                                    CAS009
     I              CHIN                            Z9CHIN                                    CAS009
     I              WTRT                            Z9WTRT                                    CAS009
     I              WTIN                            Z9WTIN                                    CAS009
     I              REPT                            Z9REPT                                    CAS009
     I              RAMT                            Z9RAMT                                    CAS009
     I              NRPD                            Z9NRPD                                    CAS009
     I              RFRQ                            Z9RFRQ                                    CAS009
     I              RDYN                            Z9RDYN                                    CAS009
     I              FCCY                            Z9FCCY                                    CAS009
     I              LIND                            Z9LIND                                    CAS009
     I              CRSK                            Z9CRSK                                    CAS009
     I              ACOF                            Z9ACOF                                    CAS009
     I              NACD                            Z9NACD                                    CAS009
     I              RELI                            Z9RELI                                    CAS009
     I              AUTO                            Z9AUTO                                    CAS009
     I              PSAM                            Z9PSAM                                    CAS009
     I              BCXR                            Z9BCXR                                    CAS009
     I              FCXR                            Z9FCXR                                    CAS009
     I              SDST                            Z9SDST                                    CAS009
     I              OSDA                            Z9OSDA                                    CAS009
     I              TSTN                            Z9TSTN                                    CAS009
     I              MDST                            Z9MDST                                    CAS009
     I              OMDA                            Z9OMDA                                    CAS009
     I              TMAN                            Z9TMAN                                    CAS009
     I              FACO                            Z9FACO                                    CAS009
     I              RLDT                            Z9RLDT                                    CAS009
     I              NROD                            Z9NROD                                    CAS009
     I              RLFQ                            Z9RLFQ                                    CAS009
     I              RLDY                            Z9RLDY                                    CAS009
     I              RDFC                            Z9RDFC                                    CAS009
     I              NBRA                            Z9NBRA                                    CAS009
     I              NRTS                            Z9NRTS                                    CAS009
     I              NSIN                            Z9NSIN                                    CAS009
     I              NCAS                            Z9NCAS                                    CAS009
     I              AWTP                            Z9AWTP                                    CAS009
     I              WTRD                            Z9WTRD                                    CAS009
     I              WTWD                            Z9WTWD                                    CAS009
     I              IWOD                            Z9IWOD                                    CAS009
     I              PWOD                            Z9PWOD                                    CAS009
     I              BMDI                            Z9BMDI                                    CAS009
     I              FMDI                            Z9FMDI                                    CAS009
     I              PDIN                            Z9PDIN                                    CAS009
     I              LSWC                            Z9LSWC                                    CAS009
     I              LSWS                            Z9LSWS                                    CAS009
     I              OSDB                            Z9OSDB                                    CAS009
     I              OMDB                            Z9OMDB                                    CAS009
     I              ORBR                            Z9ORBR                                    CAS009
     I              PRFC                            Z9PRFC                                    CAS009
     I              FCLB                            Z9FCLB                                    CAS009
     I              MLNR                            Z9MLNR                                    CAS009
     I              BTIN                            Z9BTIN                                    CAS009
     I              BLDY                            Z9BLDY                                    CAS009
     I              OLNO                            Z9OLNO                                    CAS009
     I              RCSI                            Z9RCSI                                    CAS009
     I              ICBS                            Z9ICBS                                    CAS009
     I              IPFR                            Z9IPFR                                    CAS009
     I              TOTI                            Z9TOTI                                    CAS009
     I              NIDT                            Z9NIDT                                    CAS009
     I              IBDT                            Z9IBDT                                    CAS009
     I              SLID                            Z9SLID                                    CAS009
     I              AIPD                            Z9AIPD                                    CAS009
     I              DLRC                            Z9DLRC                                    CAS009
     I              IACD                            Z9IACD                                    CAS009
     I              AITC                            Z9AITC                                    CAS009
     I              TFEP                            Z9TFEP                                    CAS009
     I              AIAP                            Z9AIAP                                    CAS009
     I              IPRD                            Z9IPRD                                    CAS009
     I              IPRM                            Z9IPRM                                    CAS009
     I              ICTD                            Z9ICTD                                    CAS009
     I              AIMN                            Z9AIMN                                    CAS009
     I              RBDT                            Z9RBDT                                    CAS009
     I              NOPS                            Z9NOPS                                    CAS009
     I              NCHI                            Z9NCHI                                    CAS009
     I              IFDY                            Z9IFDY                                    CAS009
     I              LONI                            Z9LONI                                    CAS009
     I              CNFI                            Z9CNFI                                    CAS009
     I              ACEI                            Z9ACEI                                    CAS009
     I              TLXI                            Z9TLXI                                    CAS009
     I              CBLI                            Z9CBLI                                    CAS009
     I              ORED                            Z9ORED                                    CAS009
     I              LCD                             Z9LCD                                     CAS009
     I              CHTP                            Z9CHTP                                    CAS009
     I              TNLU                            Z9TNLU                                    CAS009
     I              ADDI                            Z9ADDI                                    CAS009
     I              ORMD                            Z9ORMD                                    CAS009
     I              ORTI                            Z9ORTI                                    CAS009
     I              ZZ023A                          Z9023A                                    CAS009
     I              BOKC                            Z9BOKC                                    CAS009
     I              COCU                            Z9COCU                                    CAS009
     I              RECE                            Z9RECE                                    CAS009
     I              OMDT                            Z9OMDT                                    CAS009
     I              NIPD                            Z9NIPD                                    CAS009
     I              NMDT                            Z9NMDT                                    CAS009
     I              APMI                            Z9APMI                                    CAS009
     I              RSTM                            Z9RSTM                                    CAS009
     I              RONS                            Z9RONS                                    CAS009
     I              RIBN                            Z9RIBN                                    CAS009
     I              RIBA                            Z9RIBA                                    CAS009
     I              ROBN                            Z9ROBN                                    CAS009
     I              ROCN                            Z9ROCN                                    CAS009
     I              PSTM                            Z9PSTM                                    CAS009
     I              PONS                            Z9PONS                                    CAS009
     I              PIBN                            Z9PIBN                                    CAS009
     I              PIBA                            Z9PIBA                                    CAS009
     I              POBN                            Z9POBN                                    CAS009
     I              POCN                            Z9POCN                                    CAS009
     I              RCRN                            Z9RCRN                                    CAS009
     I              RCRA                            Z9RCRA                                    CAS009
     I              RVNO                            Z9RVNO                                    CAS009
     I              AWBN                            Z9AWBN                                    CAS009
     I              AWBA                            Z9AWBA                                    CAS009
     I              BENN                            Z9BENN                                    CAS009
     I              BENA                            Z9BENA                                    CAS009
     I              DTP1                            Z9DTP1                                    CAS009
     I              DTP2                            Z9DTP2                                    CAS009
     I              DTP3                            Z9DTP3                                    CAS009
     I              DTP4                            Z9DTP4                                    CAS009
     I              DCHG                            Z9DCHG                                    CAS009
     I              BTB1                            Z9BTB1                                    CAS009
     I              BTB2                            Z9BTB2                                    CAS009
     I              BTB3                            Z9BTB3                                    CAS009
     I              BTB4                            Z9BTB4                                    CAS009
     I              BTB5                            Z9BTB5                                    CAS009
     I              BTB6                            Z9BTB6                                    CAS009
     I              CVMR                            Z9CVMR                                    CAS009
     I              PTFR                            Z9PTFR                                    CAS009
     I              HLEX                            Z9HLEX                                    CAS009
     I              FSRP                            Z9FSRP                                    CAS009
     I              FSGN                            Z9FSGN                                    CAS009
     I              FPRC                            Z9FPRC                                    CAS009
     I              TCOF                            Z9TCOF                                    CAS009
     I              ACPD                            Z9ACPD                                    CAS009
     I              ACDA                            Z9ACDA                                    CAS009
     I              ACAJ                            Z9ACAJ                                    CAS009
     I              ACAP                            Z9ACAP                                    CAS009
     I              COFD                            Z9COFD                                    CAS009
     I              COFM                            Z9COFM                                    CAS009
     I              CFCD                            Z9CFCD                                    CAS009
     I              NFRS                            Z9NFRS                                    CAS009
     I              NFSN                            Z9NFSN                                    CAS009
     I              NFPC                            Z9NFPC                                    CAS009
     I              PDCF                            Z9PDCF                                    CAS009
     I              FCTD                            Z9FCTD                                    CAS009
     I              FWOD                            Z9FWOD                                    CAS009
     I              DFTP                            Z9DFTP                                    CAS009
     I              DFST                            Z9DFST                                    CAS009
     I              MCRA                            Z9MCRA                                    CAS009
     I              FCRA                            Z9FCRA                                    CAS009
     I              PDDI                            Z9PDDI                                    CAS009
     I              PTDI                            Z9PTDI                                    CAS009
     I              GDPR                            Z9GDPR                                    CAS009
     I              GDIN                            Z9GDIN                                    CAS009
     I              LNKS                            Z9LNKS                                    CAS009
     I              MNSG                            Z9MNSG                                    CAS009
     I              GASS                            Z9GASS                                    CAS009
     I              GPRT                            Z9GPRT                                    CAS009
     I              TOLN                            Z9TOLN                                    CAS009
     I              LSTS                            Z9LSTS                                    CAS009
     I              IUSR                            Z9IUSR                                    CAS009
     I              AUSR                            Z9AUSR                                    CAS009
     I              XUSR                            Z9XUSR                                    CAS009
     I              RATF                            Z9RATF                                    CAS009
     I              CNCF                            Z9CNCF                                    CAS009
     I              PCRF                            Z9PCRF                                    CAS009
     I              LPFI                            Z9LPFI                                    CAS009
     I              PTFC                            Z9PTFC                                    CAS009
     I              PTFT                            Z9PTFT                                    CAS009
     I              PTFN                            Z9PTFN                                    CAS009
     I              PCOB                            Z9PCOB                                    CAS009
     I              LRLD                            Z9LRLD                                    CAS009
     I              LMCD                            Z9LMCD                                    CAS009
     I              SCCY                            Z9SCCY                                    CAS009
     I              ICCY                            Z9ICCY                                    CAS009
     I              OINR                            Z9OINR                                    CAS009
     I              OIDT                            Z9OIDT                                    CAS009
     I              REPI                            Z9REPI                                    CAS009
     I              RFDY                            Z9RFDY                                    CAS009
     I              RFRI                            Z9RFRI                                    CAS009
     I              RFRT                            Z9RFRT                                    CAS009
     I              RFAR                            Z9RFAR                                    CAS009
     I              FSYLDC                          Z9YLDC                                    CAS009
     I              FSFYLD                          Z9FYLD                                    CAS009
     I              FSURPL                          Z9URPL                                    CAS009
     I              FSPLAM                          Z9PLAM                                    CAS009
     I              FSPLDT                          Z9PLDT                                    CAS009
     I              FSYUPL                          Z9YUPL                                    CAS009
     I              FSEFUP                          Z9EFUP                                    CAS009
     I              FSECUP                          Z9ECUP                                    CAS009
     I              AIPN                            Z9AIPN                                    CAS009
     I              AITN                            Z9AITN                                    CAS009
     I              AIAN                            Z9AIAN                                    CAS009
     I              IPRN                            Z9IPRN                                    CAS009
     I              AINN                            Z9AINN                                    CAS009
     I              TOTN                            Z9TOTN                                    CAS009
     I              ICTN                            Z9ICTN                                    CAS009
     I              IWON                            Z9IWON                                    CAS009
     I              IPNM                            Z9IPNM                                    CAS009
     I              PDNN                            Z9PDNN                                    CAS009
     I              FSCPAM                          Z9FSCP                                    CAS009
     I              TFDP                            Z9TFDP                                    CAS009
     I              TFDPA                           Z9FDPA                                    CAS009
     I              TFAM                            Z9TFAM                                    CAS009
     I              TFAC                            Z9TFAC                                    CAS009
     I              TFOF                            Z9TFOF                                    CAS009
     I              AFDP                            Z9AFDP                                    CAS009
     I              CFDP                            Z9CFDP                                    CAS009
     I              AMDS                            Z9AMDS                                    CAS009
     I              AMADJ                           Z9MADJ                                    CAS009
     I              ANADJ                           Z9NADJ                                    CAS009
     I              DSAM                            Z9DSAM                                    CAS009
     I              AMCOST                          Z9AMCO                                    CAS009
     I              YMCOST                          Z9YMCO                                    CAS009
     I              YAINT                           Z9YAIN                                    CAS009
     I              CLAS                            Z9CLAS                                    CLE042
     I              DFCL                            Z9DFCL                                    CLE042
      *                                                                                       CLE139
      ** Rename Fields on Loan Amendments File:                                               CLE139
      *                                                                                       CLE139
     ILOAMSDKF                                                                                CLE139
     I              RECI                            #RECI                                     CLE139
     I              LNRF                            #LNRF                                     CLE139
     I              VDAT                            #VDAT                                     CLE139
     I              LASN                            #LASN                                     CLE139
     I              MRIN                            #MRIN                                     CLE139
     I              LTYP                            #LTYP                                     CLE139
     I              SUTP                            #SUTP                                     CLE139
     I              PTYP                            #PTYP                                     CLE139
     I              AMTP                            #AMTP                                     CLE139
     I              PRSQ                            #PRSQ                                     CLE139
     I              BRTT                            #BRTT                                     CLE139
     I              RTSP                            #RTSP                                     CLE139
     I              CCY                             #CCY                                      CLE139
     I              PRAM                            #PRAM                                     CLE139
     I              INTA                            #INTA                                     CLE139
     I              WTXA                            #WTXA                                     CLE139
     I              FEAM                            #FEAM                                     CLE139
     I              TAMT                            #TAMT                                     CLE139
     I              BRCA                            #BRCA                                     CLE139
     I              CNUM                            #CNUM                                     CLE139
     I              REPT                            #REPT                                     CLE139
     I              AUTO                            #AUTO                                     CLE139
     I              STAI                            #STAI                                     CLE139
     I              SETP                            #SETP                                     CLE139
     I              OSACQQ                          #OSACQ                                    CLE139
     I              TSEN                            #TSEN                                     CLE139
     I              FACO                            #FACO                                     CLE139
     I              SPI1                            #SPI1                                     CLE139
     I              SPI2                            #SPI2                                     CLE139
     I              SPI3                            #SPI3                                     CLE139
     I              LAIN                            #LAIN                                     CLE139
     I              BRTE                            #BRTE                                     CLE139
     I              SPIN                            #SPIN                                     CLE139
     I              CALC                            #CALC                                     CLE139
     I              WTIN                            #WTIN                                     CLE139
     I              LLAG                            #LLAG                                     CLE139
     I              LWOI                            #LWOI                                     CLE139
     I              XAVD                            #XAVD                                     CLE139
     I              XASQ                            #XASQ                                     CLE139
     I              FCUS                            #FCUS                                     CLE139
     I              FTYP                            #FTYP                                     CLE139
     I              FSEQ                            #FSEQ                                     CLE139
     I              RLON                            #RLON                                     CLE139
     I              FECD                            #FECD                                     CLE139
     I              PONI                            #PONI                                     CLE139
     I              ACTI                            #ACTI                                     CLE139
     I              CNFY                            #CNFY                                     CLE139
     I              TLXY                            #TLXY                                     CLE139
     I              CBLY                            #CBLY                                     CLE139
     I              INTC                            #INTC                                     CLE139
     I              NACD                            #NACD                                     CLE139
     I              ACBI                            #ACBI                                     CLE139
     I              ZZ001                           #ZZ001                                    CLE139
     I              LSWCC                           #LSWCC                                    CLE139
     I              LSWSC                           #LSWSC                                    CLE139
     I              OSBR                            #OSBR                                     CLE139
     I              FCLB                            #FCLB                                     CLE139
     I              LSMD                            #LSMD                                     CLE139
     I              REBT                            #REBT                                     CLE139
     I              ZZ034                           #ZZ034                                    CLE139
     I              ORED                            #ORED                                     CLE139
     I              LCD                             #LCD                                      CLE139
     I              CHTP                            #CHTP                                     CLE139
     I              TNLU                            #TNLU                                     CLE139
     I              RSTM                            #RSTM                                     CLE139
     I              RONSQQ                          #RONSQ                                    CLE139
     I              RIBN                            #RIBN                                     CLE139
     I              RIBA                            #RIBA                                     CLE139
     I              ROBN                            #ROBN                                     CLE139
     I              ROCN                            #ROCN                                     CLE139
     I              PSTM                            #PSTM                                     CLE139
     I              PONSQQ                          #PONSQ                                    CLE139
     I              PIBN                            #PIBN                                     CLE139
     I              PIBA                            #PIBA                                     CLE139
     I              POBN                            #POBN                                     CLE139
     I              POCN                            #POCN                                     CLE139
     I              RCRN                            #RCRN                                     CLE139
     I              RCRA                            #RCRA                                     CLE139
     I              RVNO                            #RVNO                                     CLE139
     I              AWBN                            #AWBN                                     CLE139
     I              AWBA                            #AWBA                                     CLE139
     I              BENN                            #BENN                                     CLE139
     I              BENA                            #BENA                                     CLE139
     I              DTP1                            #DTP1                                     CLE139
     I              DTP2                            #DTP2                                     CLE139
     I              DTP3                            #DTP3                                     CLE139
     I              DTP4                            #DTP4                                     CLE139
     I              DCHG                            #DCHG                                     CLE139
     I              BTB1                            #BTB1                                     CLE139
     I              BTB2                            #BTB2                                     CLE139
     I              BTB3                            #BTB3                                     CLE139
     I              BTB4                            #BTB4                                     CLE139
     I              BTB5                            #BTB5                                     CLE139
     I              BTB6                            #BTB6                                     CLE139
     I              CVMR                            #CVMR                                     CLE139
     I              FSRP                            #FSRP                                     CLE139
     I              FSGN                            #FSGN                                     CLE139
     I              FPRC                            #FPRC                                     CLE139
     I              COFA                            #COFA                                     CLE139
     I              IRCF                            #IRCF                                     CLE139
     I              FRCF                            #FRCF                                     CLE139
     I              DFTP                            #DFTP                                     CLE139
     I              DFST                            #DFST                                     CLE139
     I              MNSG                            #MNSG                                     CLE139
     I              GASS                            #GASS                                     CLE139
     I              GPRT                            #GPRT                                     CLE139
     I              NRLI                            #NRLI                                     CLE139
     I              ROLN                            #ROLN                                     CLE139
     I              ROSN                            #ROSN                                     CLE139
     I              ROBR                            #ROBR                                     CLE139
     I              RORC                            #RORC                                     CLE139
     I              PDGN                            #PDGN                                     CLE139
     I              GRIN                            #GRIN                                     CLE139
     I              RLCY                            #RLCY                                     CLE139
     I              PNAM                            #PNAM                                     CLE139
     I              PAST                            #PAST                                     CLE139
     I              ASTS                            #ASTS                                     CLE139
     I              IUSR                            #IUSR                                     CLE139
     I              AUSR                            #AUSR                                     CLE139
     I              XUSR                            #XUSR                                     CLE139
     I              PCRF                            #PCRF                                     CLE139
     I              PCOB                            #PCOB                                     CLE139
     I              MTPD                            #MTPD                                     CLE139
     I              PDDI                            #PDDI                                     CLE139
     I              PTDI                            #PTDI                                     CLE139
     I              SCCY                            #SCCY                                     CLE139
     I              ICCY                            #ICCY                                     CLE139
     I              ECIN                            #ECIN                                     CLE139
     I              REPI                            #REPI                                     CLE139
     I              CHDU                            #CHDU                                     CLE139
     I              INTN                            #INTN                                     CLE139
     I              FSPRAM                          #SPRAM                                    CLE139
     I              REXR                            #REXR                                     CLE139
     I              REXI                            #REXI                                     CLE139
     I              PSCY                            #PSCY                                     CLE139
     I              PEXR                            #PEXR                                     CLE139
     I              PEXI                            #PEXI                                     CLE139
     I              STAL                            #STAL                                     CLE139
     I              FRNT                            #FRNT                                     CLE139
     I              AFRT                            #AFRT                                     CLE139
     I              REPA                            #REPA                                     CLE139
     I              TMST                            #TMST                                     CLE139
     I              OSAC                            #OSAC                                     CLE139
     I              RONS                            #RONS                                     CLE139
     I              PONS                            #PONS                                     CLE139
     I              AUTH                            #AUTH                                     CLE139
     I              FRCY                            #FRCY                                     CLE139
     I              FRAM                            #FRAM                                     CLE139
     I              FINT                            #FINT                                     CLE139
     I              FTXA                            #FTXA                                     CLE139
     I              FTOT                            #FTOT                                     CLE139
     I              FPEN                            #FPEN                                     CLE139
     I              BASR                            #BASR                                     CLE139
     I              SLTP                            #SLTP                                     CLE139
     I              SLST                            #SLST                                     CLE139
     I              CLAS                            #CLAS                                     CLE139
     I              DFCL                            #DFCL                                     CLE139
     I              SLCL                            #SLCL                                     CLE139
      *                                                                                       CLE139
      ** Rename Fields on Loan Amendments Trailer File:                                       CLE139
      *                                                                                       CLE139
     ILOAMSZ1F                                                                                CLE139
     I              RECI                            #RECIZ                                    CLE139
     I              LNRF                            #LNRFZ                                    CLE139
     I              VDAT                            #VDATZ                                    CLE139
     I              LASN                            #LASNZ                                    CLE139
     I              ZZ001                           #ZZ0Z1                                    CLE139
     I              NORE                            #NORE                                     CLE139
     I              ZZ003                           #ZZ003                                    CLE139
     I              NLRB                            #NLRB                                     CLE139
     I              NINS                            #NINS                                     CLE139
     I              NDEL                            #NDEL                                     CLE139
     I              NLRA                            #NLRA                                     CLE139
     I              VLBF                            #VLBF                                     CLE139
     I              VLBL                            #VLBL                                     CLE139
     I              VRIF                            #VRIF                                     CLE139
     I              VRIL                            #VRIL                                     CLE139
     I              VRDF                            #VRDF                                     CLE139
     I              VRDL                            #VRDL                                     CLE139
     I              VRAF                            #VRAF                                     CLE139
     I              VRAL                            #VRAL                                     CLE139
     I              VRRF                            #VRRF                                     CLE139
     I              VRRL                            #VRRL                                     CLE139
     I              ZZ229                           #ZZ229                                    CLE139
     I              LCD                             #LCDZ                                     CLE139
     I              CHTP                            #CHTPZ                                    CLE139
     I              TNLU                            #TNLUZ                                    CLE139
      *
     E/COPY WNCPYSRC,LER130E002
     IPSDS       SDS
      ** Program Status Data Structure - gives Job/Workstation name and
      ** User ID
      *
     I                                      244 253 JOB
     I                                      244 246 WSID
     I                                      254 263 USER
      *
     ISPOOL       DS
      *** File information data structure - detail report
     I                                       83  92 SFILE
     I                                    B 123 1240SFNUM
      *
     ISPOOLU      DS
      *** File information data structure - Audit report
     I                                       83  92 SFILEU
     I                                    B 123 1240SFNUMU
      *
     I            DS
      *** Split fld amounts for facility
     I                                    P   1  960FFD
     I                                    P   1   80FFDJAN
     I                                    P   9  160FFDFEB
     I                                    P  17  240FFDMAR
     I                                    P  25  320FFDAPR
     I                                    P  33  400FFDMAY
     I                                    P  41  480FFDJUN
     I                                    P  49  560FFDJUL
     I                                    P  57  640FFDAUG
     I                                    P  65  720FFDSEP
     I                                    P  73  800FFDOCT
     I                                    P  81  880FFDNOV
     I                                    P  89  960FFDDEC
     I            DS
      *** Split fld amounts for loan
     I                                    P   1  960FLD
     I                                    P   1   80FLDJAN
     I                                    P   9  160FLDFEB
     I                                    P  17  240FLDMAR
     I                                    P  25  320FLDAPR
     I                                    P  33  400FLDMAY
     I                                    P  41  480FLDJUN
     I                                    P  49  560FLDJUL
     I                                    P  57  640FLDAUG
     I                                    P  65  720FLDSEP
     I                                    P  73  800FLDOCT
     I                                    P  81  880FLDNOV
     I                                    P  89  960FLDDEC
     I            DS
      *** Split alpha date to get month
     I                                        1   7 GADATE
     I                                        3   5 MMM
     I                                        8  130DDMMYY
     I                                        8   90WDD
     I                                       10  110WMM
     I                                       12  130WYY
      *
     I            DS
      *** Divide up start of month date
     I                                        1   6 SMDT
     I                                        1   2 SMDD
     I                                        3   40SM
     I                                        5   60SY
      *
     I            DS
      *** Divide up start of month date for U.S.A. format
     I                                        1   6 SMDTUS
     I                                        1   20SMUS
     I                                        3   4 SMDDUS
     I            DS
      *** Set work fields
     I                                        1   20FEFCOD
     I                                        1   2 WFCOD
     I                                        3  150EAMT0
     I                                        3  151EAMT1
     I                                        3  152EAMT2
     I                                        3  153EAMT3
     I**********                             16  210LKLNNO                                    CLE148
     I                                       16  21 LKLNNO                                    CLE148
     I                                       17  190WFAC03
     I                                       20  210WFAC02
      *
     I            DS                                                      33591
      ** Divide Date                                                      33591
     I                                        1   60WWDAT                 33591
     I                                        1   20WWDT1                 33591
     I                                        3   40WWDT2                 33591
     I                                        5   60WWDT3                 33591
     IFHS2      E DSLEFHS2TD                                                                  CLE159
     ISTLNS1      DS                            110                                           CGL020
      ** Set work fields                                                                      CGL020
      *                                                                                       CGL020
     I**********                              1   60WWROCN                             CGL020 CSD027
     I**********                              7  120WWROBN                             CGL020 CSD027
     I**********                             13  180WWPOCN                             CGL020 CSD027
     I**********                             19  240WWPOBN                             CGL020 CSD027
     I                                        1   6 WWROCN                                    CSD027
     I                                        7  12 WWROBN                                    CSD027
     I                                       13  18 WWPOCN                                    CSD027
     I                                       19  24 WWPOBN                                    CSD027
     I                                       25  32 WWBENN                                    CGL020
     I                                       33  67 WWBENA                                    CGL020
     I                                       68  75 WWAWBN                                    CGL020
     I                                       76 110 WWAWBA                                    CGL020
     ISTLNS2      DS                            110                                           CGL020
      ** Set work fields from LEFEED                                                          CGL020
      *                                                                                       CGL020
     I**********                              1   60ROCN                               CGL020 CSD027
     I**********                              7  120ROBN                               CGL020 CSD027
     I**********                             13  180POCN                               CGL020 CSD027
     I**********                             19  240POBN                               CGL020 CSD027
     I                                        1   6 ROCN                                      CSD027
     I                                        7  12 ROBN                                      CSD027
     I                                       13  18 POCN                                      CSD027
     I                                       19  24 POBN                                      CSD027
     I                                       25  32 BENN                                      CGL020
     I                                       33  67 BENA                                      CGL020
     I                                       68  75 AWBN                                      CGL020
     I                                       76 110 AWBA                                      CGL020
     ISTLNS3      DS                            110                                           CGL020
      ** Set work fields from CLOANCL                                                         CGL020
      *                                                                                       CGL020
     I**********                              1   60TPROCN                             CGL020 CSD027
     I**********                              7  120TPROBN                             CGL020 CSD027
     I**********                             13  180TPPOCN                             CGL020 CSD027
     I**********                             19  240TPPOBN                             CGL020 CSD027
     I                                        1   6 TPROCN                                    CSD027
     I                                        7  12 TPROBN                                    CSD027
     I                                       13  18 TPPOCN                                    CSD027
     I                                       19  24 TPPOBN                                    CSD027
     I                                       25  32 TPBENN                                    CGL020
     I                                       33  67 TPBENA                                    CGL020
     I                                       68  75 TPAWBN                                    CGL020
     I                                       76 110 TPAWBA                                    CGL020
     ISTLNS4      DS                            110                                           CGL020
      ** Set work fields from FCLTYFM                                                         CGL020
      *                                                                                       CGL020
     I**********                              1   60FCROCN                             CGL020 CSD027
     I**********                              7  120FCROBN                             CGL020 CSD027
     I**********                             13  180FCPOCN                             CGL020 CSD027
     I**********                             19  240FCPOBN                             CGL020 CSD027
     I                                        1   6 FCROCN                                    CSD027
     I                                        7  12 FCROBN                                    CSD027
     I                                       13  18 FCPOCN                                    CSD027
     I                                       19  24 FCPOBN                                    CSD027
     I                                       25  32 FCBENN                                    CGL020
     I                                       33  67 FCBENA                                    CGL020
     I                                       68  75 FCAWBN                                    CGL020
     I                                       76 110 FCAWBA                                    CGL020
     IWFCKEY      DS                             12                                           CGL020
     I**********                              1   60FECNUM                             CGL020 CSD027
     I                                        1   6 FECNUM                                    CSD027
     I                                        7   90FCFTYP                                    CGL020
     I                                       10  110FCFNUM                                    CGL020
     I                                       12  12 FRCTP                                     CGL020
      *                                                                                       CGL020
     IACCY        DS                             30                                           CLE141
     I                                        1   3 C1PI                                      CLE141
     I                                        4   6 C2PI                                      CLE141
     I                                        7   9 C3PI                                      CLE141
     I                                       10  12 C4PI                                      CLE141
     I                                       13  15 C5PI                                      CLE141
     I                                       16  18 C6PI                                      CLE141
     I                                       19  21 C7PI                                      CLE141
     I                                       22  24 C8PI                                      CLE141
     I                                       25  27 C9PI                                      CLE141
     I                                       28  30 C0PI                                      CLE141
     IALOC        DS                             30                                           CLE141
     I                                        1   3 L1PI                                      CLE141
     I                                        4   6 L2PI                                      CLE141
     I                                        7   9 L3PI                                      CLE141
     I                                       10  12 L4PI                                      CLE141
     I                                       13  15 L5PI                                      CLE141
     I                                       16  18 L6PI                                      CLE141
     I                                       19  21 L7PI                                      CLE141
     I                                       22  24 L8PI                                      CLE141
     I                                       25  27 L9PI                                      CLE141
     I                                       28  30 L0PI                                      CLE141
      *
     I/COPY WNCPYSRC,LER130I001
     I/COPY ZSRSRC,ZHASHZ2
     I/COPY ZSRSRC,ZINTDYZ1                                                                   CAS009
     I/COPY ZSRSRC,ZDATE9Z2                                                                   CAS009
     I/COPY ZSRSRC,ZDAT10Z1                                                                   CAS009
     I/COPY ZSRSRC,ZHOLI                                                                      CLE031
      *
     IRUNDAT    E DS
      ** Multibranching Indicator.
     I              AGMBIN                          MBIN
      *
     ILDA       E DSLDA
      ** Database error
      *
     ISDFEE     E DSSDFEEPD                                                                   CLE134
      *                                                                                       CLE134
     ISDBANK    E DSSDBANKPD
      ** Bank details
      *
     ISDBRCH    E DSSDBRCHPD
      ** Branch name details
     I              A8BRNM                          BRNM
      *
     ISDGELR    E DSSDGELRPD
      ** General Ledger Details
      *                                                                   127966
     ISDMMOD    E DSSDMMODPD                                              127966
      ** Module Details                                                   127966
      *
     ISCSARD    E DSSCSARDPD                                              CLE005
      ***  External data structures for SAR Details                       CLE005
      *                                                                   CLE005
     ISDCUST    E DSSDCUSTPD                                              155672
      **  External data structures for Customer details                   155672
     I              QQDFAC                          DFACQQ                                    CGL029
      *                                                                   155672
     ISDNOST    E DSSDNOSTPD                                              155672
      **  External data structures for Nostro details                     155672
     I              QQACCD                          ACCDQQ                                    CGL029
      *                                                                   155672
     ILESTAL    E DSLESTALPD                                                                  CLE034
      ** External data structures for Settlement Allocation File                              CLE034
      *                                                                                       CLE034
     I              PSTM                            STPSTM                                    CLE034
     I              PONS                            STPONS                                    CLE034
     I              POBR                            STPOBR                                    CLE034
     I              RSTM                            STRSTM                                    CLE034
     I              RONS                            STRONS                                    CLE034
     I              ROBR                            STROBR                                    CLE034
     I              REXR                            STREXR                                    CLE034
     I              REXI                            STREXI                                    CLE034
     I              PEXR                            STPEXR                                    CLE034
     I              PEXI                            STPEXI                                    CLE034
     I              PSCY                            STPSCY                                    CLE034
     I              LASQ                            STLASQ                                    CLE034
     I              SEQ                             STSEQ                                     CLE034
     I              CCY                             STCCY                                     CLE038
     I              PCRF                            STPCRF                                    227716
     I              ROBN                            STROBN                                    CLE034
     I              ROCN                            STROCN                                    CLE034
     I              POBN                            STPOBN                                    CLE034
     I              POCN                            STPOCN                                    CLE034
     I              AWBN                            STAWBN                                    CLE034
     I              AWBA                            STAWBA                                    CLE034
     I              BENN                            STBENN                                    CLE034
     I              BENA                            STBENA                                    CLE034
      **********                                                                       218782 222373
     I*SDSVAL***E DSSDSVALPD                                                           218782 222373
      ****EXTERNAL*DS*FOR*SYSTEM*VALUES********************                            218782 222373
      **********                                                                       218782 222373
     ISDHEDG    E DSSDHEDGPD                                                                  CAS009
      ** Hedging ICD Data Structure                                                           CAS009
      *                                                                                       CAS009
     ISDCURR    E DSSDCURRPD                                                                  CAS009
      ** External DS for Currency Details                                                     CAS009
      *                                                                                       CAS009
     IDSACCT    E DSACCNTAB                                                                   CLE164
     I              LCD                             QQLCD                                     CLE164
     I              RECI                            QQRECI                                    CLE164
     I              CNUM                            QQCNUM                                    CLE164
     I              CCY                             QQCCY                                     CLE164
     I              TMST                            QQTMST                                    CLE164
     IWVCATC      DS                                                                          CLE164
     I                                        1   50PFCLTY                                    CLE164
     I                                        7   80PFESEQ                                    CLE164
     I                                        9  160PREPR                                     CLE164
     I                                       17  240PCAPR                                     CLE164
     IDSFDY     E DSDSFDY
      ** DS for access programs, short data structure
      *
     IDSSDY     E DSDSSDY
      ** Second DS for access programs, long data structure
      *
     IHISTHP    E DSHISTSHP                                                                 MD046294
      ** Rename fields.                                                                     MD046294
      *                                                                                     MD046294
     I              RECI                            RECIHP                                  MD046294
     I              RCDT                            RCDTHP                                  MD046294
     I              BRCA                            BRCAHP                                  MD046294
     I              CNUM                            CNUMHP                                  MD046294
     I              LNRF                            LNRFHP                                  MD046294
     I              VDAT                            VDATHX                                  MD046294
     I              PRSQ                            PRSQHP                                  MD046294
     I              LASN                            LASNHP                                  MD046294
     I              FCUS                            FCUSHP                                  MD046294
     I              FTYP                            FTYPHP                                  MD046294
     I              FSEQ                            FSEQHP                                  MD046294
     I              PTYP                            PTYPHP                                  MD046294
     I              CCY                             CCYHP                                   MD046294
     I              AMTP                            AMTPHP                                  MD046294
     I              PRAM                            PRAMHP                                  MD046294
     I              INTA                            INTAHP                                  MD046294
     I              WTXA                            WTXAHP                                  MD046294
     I              FEAM                            FEAMHP                                  MD046294
     I              FECD                            FECDHP                                  MD046294
     I              WOIN                            WOINHP                                  MD046294
     I              EXVD                            EXVDHP                                  MD046294
     I              LTYP                            LTYPHP                                  MD046294
     I              SUTP                            SUTPHX                                  MD046294
     I              LCD                             LCDHP                                   MD046294
     I              COFA                            COFAHP                                  MD046294
     I              CPAM                            CPAMHP                                  MD046294
     I              AITC                            AITCHP                                  MD046294
     I              INTR                            INTRHP                                  MD046294
     I              AIAP                            AIAPHP                                  MD046294
     I              IPRD                            IPRDHP                                  MD046294
     I              MNSG                            MNSGHP                                  MD046294
     I              GASS                            GASSHP                                  MD046294
     I              GPRT                            GPRTHP                                  MD046294
     I              ROLN                            ROLNHP                                  MD046294
     I              ACDA                            ACDAHP                                  MD046294
     I              COFR                            COFRHP                                  MD046294
     I              ACAP                            ACAPHP                                  MD046294
     I              COFD                            COFDHP                                  MD046294
     I              REPI                            REPIHP                                  MD046294
     I              CHDU                            CHDUHP                                  MD046294
     I              AITN                            AITNHP                                  MD046294
     I              AIAN                            AIANHP                                  MD046294
     I              IPRN                            IPRNHP                                  MD046294
     I              INTN                            INTNHP                                  MD046294
     I              FSPRAM                          FSPRHP                                  MD046294
     I              FSCPAM                          FSCPHP                                  MD046294
     I              CLAS                            CLASHP                                  MD046294
      *                                                                                     MD046294
     I              'ZAAMLSETLE'          C         AMLPRI                                    CGL020
     I              'LECalcBasis6LeapYear'C         WPARML                                  MD035545
     I/COPY WNCPYSRC,LER130IIP1                                           S01408
      *****************************************************************
     C/TITLE MAIN PROCESSING
      *****************************************************************
      *
      ** Receive input parameters.                                                            CLE139
      *                                                                                       CLE139
     C           *ENTRY    PLIST                                                              CLE139
     C                     PARM           CCAP    1                                           CLE139
     C/COPY WNCPYSRC,LEH00615
      *                                                                                       CLE139
      ** Initialisation
     C           *IN20     CASEQ'0'       INIT
     C                     END
      *
     C**********           Z-ADD0         LFCN                                         230521 CSD027
     C                     MOVE *BLANKS   LFCN                                                CSD027
      *                                                                                    AR750543A
      ** Set report header (either Paid or Capitalised)                                    AR750543A
     C           CCAP      IFEQ 'C'                                                        AR750543A
     C                     MOVE '0'       *IN25                                            AR750543A
     C                     ELSE                                                            AR750543A
     C                     MOVE '1'       *IN25                                            AR750543A
     C                     ENDIF                                                           AR750543A
      *
      ** Detail processing
     C                     READ LEFEED                   60
      *
     C           *IN60     DOWEQ'0'
     C           FECAPI    IFEQ 'Y'                                                           CLE139
     C           CCAP      ANDEQ'C'                                                           CLE139
     C           FECAPI    ORNE 'Y'                                                           CLE139
     C           CCAP      ANDEQ'P'                                                           CLE139
     C                     MOVE FEBRCA    REPBRC  3
     C                     Z-ADDFEFSEQ    LKBRTT                          CMX001
     C/COPY WNCPYSRC,LEH00477
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C           *INU2     ANDEQ*OFF                                                          262573
     C********** FELOAN    ANDGT0                                                      CAS009 CLE148
     C           FELOAN    ANDGT*BLANKS                                                       CLE148
     C/COPY WNCPYSRC,LEH01143
     C           FECAPI    ANDNE'Y'                                                           CLE139
     C                     EXSR TOTFEE                                                        CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CLE134
      ** if CLE134 is on, access SDFEEPD                                                      CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C                     MOVE FEFCOD    AUFECD           Name of                            CLE134
     C                     CALL 'AOFEER0'              99                                     CLE134
     C                     PARM '*MSG   ' @RTCD                                               CLE134
     C                     PARM '*KEY   ' @OPTN                                               CLE134
     C                     PARM AUFECD    FKEY    2                                           CLE134
     C           SDFEE     PARM SDFEE     DSFDY                                               CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     MOVE *BLANKS   LKPRFC                                            AR995302
      *                                                                                     AR995302
     C           FERECI    CASEQ'D'       DETAIL
     C           FERECI    CASEQ'R'       REVERS
     C                     CAS            REMOVE
     C                     END
     C                     ENDIF                                                            AR750543
     C           FECAPI    IFEQ 'Y'                                                        AR750543A
     C                     ADD  1         CPREC   50                                       AR750543A
     C                     ELSE                                                            AR750543A
     C                     ADD  1         WNREC   50
     C                     ENDIF                                                           AR750543A
     C**********           ENDIF                                                     CLE139 AR750543
     C                     READ LEFEED                   60
     C                     END
      *
      ** Final processing
     C                     EXSR TRAIL
      *                                                                   CLE007
      ** Writes a record to LE Pay/Receive Extract File Trailer if        CLE007
      ** CLE007 is switched on                                            CLE007
      *                                                                   CLE007
     C           CLE007    IFEQ 'Y'                                       CLE007
     C                     ADD  1         WRECTR                          CLE007
     C                     MOVE WRECTR    NORE                            CLE007
     C                     Z-ADDWHRWN     HRWN                            CLE007
     C                     Z-ADDWHRDC     HRDC                            CLE007
     C                     MOVE 'T'       RECI                            CLE007
     C                     WRITELEPXTACF                                  CLE007
     C                     ENDIF                                          CLE007
     C/COPY WNCPYSRC,LEH00844
      *
     C                     MOVE '1'       *INLR
      *
     C                     RETRN
      *
      ***************************************************************
     C/TITLE SR/DETAIL
      ********************************************************************
      *
      *  DETAIL -  TO PROCESS DETAIL TYPE CALCULATIONS
      *
      *  CALLED FROM: MAIN PROCESSING
      *
      *  CALLS: ACCRUE, SETTLE
      *
      ********************************************************************
      *
     C           DETAIL    BEGSR
      *                                                                                     AR317401
      ** Before any processing, check first if the loan has                                 AR317401
      ** LS amendment actioned today.                                                       AR317401
      *                                                                                     AR317401
     C/EXEC SQL                                                                             MD046294
     C+ declare ACursor insensitive scroll cursor for                                       MD046294
     C+ SELECT * FROM HISTSHP                                                               MD046294
     C+ where BRCA = :LKBRCD and CNUM = :LKCNUM and LNRF = :LKLNNO                          MD046294
     C+  and LCD = :BJRDNB and AMTP = 'LS'                                                  MD046294
     C+ order by BRCA, CNUM, LNRF, LCD                                                      MD046294
     C/END-EXEC                                                                             MD046294
      *                                                                                     MD046294
     C/EXEC SQL                                                                             MD046294
     C+ open ACursor                                                                        MD046294
     C/END-EXEC                                                                             MD046294
      *                                                                                     MD046294
     C/EXEC SQL                                                                             MD046294
     C+ fetch next from ACursor into :HISTHP                                                MD046294
     C/END-EXEC                                                                             MD046294
     C**********           MOVE '0'       *IN78                                    AR317401 MD046294
     C                     MOVE '1'       *IN78                                             MD046294
     C           SQLCOD    DOWEQ0                                                           MD046294
     C                     MOVE '0'       *IN78                                             MD046294
     C                     Z-ADDVDATHX    VDATHP  50                                        MD046294
     C                     MOVE SUTPHX    SUTPHP  2                                         MD046294
     C/EXEC SQL                                                                             MD046294
     C+ FETCH NEXT FROM ACURSOR INTO :HISTHP                                                MD046294
     C/END-EXEC                                                                             MD046294
     C                     ENDDO                                                            MD046294
      *                                                                                     MD046294
     C/EXEC SQL                                                                             MD046294
     C+ CLOSE ACURSOR                                                                       MD046294
     C/END-EXEC                                                                             MD046294
      *                                                                                     AR317401
     C********** KEYHP1    SETGTLEHISTV3                                           AR317401 MD046294
     C********** KEYHP1    REDPELEHISTV3                 78                        AR317401 MD046294
     C           *IN78     IFEQ '0'                                                         AR317401
     C           SUTPHP    ANDNEFESUTP                                                      AR317401
     C           FECALT    ANDEQ*BLANKS                                                     AR317401
     C           FEPYON    ANDNE'N'                                                         AR317401
      *                                                                                     AR317401
     C                     SELEC                                                            AR317401
      *                                                                                     AR317401
      ** Existing loan fees.                                                                AR317401
      *                                                                                     AR317401
     C           FEORED    WHLT BJRDNB                                                      AR317401
     C           FEPSTD    ANDLTWAPDAT                                                      AR317401
     C           FEPEND    ANDGEWAPDAT                                                      AR317401
     C           FEPYON    ANDEQ'E'                                                         AR317401
     C           FEORED    ORLT BJRDNB                                                      AR317401
     C           FEPSTD    ANDLTWAPDAT                                                      AR317401
     C           FEPEND    ANDLTWAPDAT                                                      AR317401
     C           FEPYON    ANDEQ'E'                                                         AR317401
     C           FEAUTO    ANDEQ'N'                                                         AR317401
     C           FEORED    ORLT BJRDNB                                                      AR317401
     C           FEPSTD    ANDLTWAPDAT                                                      AR317401
     C           FEPYON    ANDEQ'S'                                                         AR317401
     C           FEAUTO    ANDEQ'N'                                                         AR317401
     C           FEORED    ORLT BJRDNB                                                      AR317401
     C           FEPSTD    ANDLTWAPDAT                                                      AR317401
     C           FEPYON    ANDEQ' '                                                         AR317401
     C           FEAUTO    ANDEQ'N'                                                         AR317401
      *                                                                                     AR317401
      ** Setup amount to be reverse for the old subtype.                                    AR317401
      *                                                                                     AR317401
     C                     Z-ADD1         LKREVI                                            AR317401
     C                     EXSR FEECHG                                                      AR317401
      *                                                                                     AR317401
      ** Setup amount to be repost for the new subtype.                                     AR317401
      *                                                                                     AR317401
     C                     MOVE SUTPHP    FESUTP                                            AR317401
     C                     Z-ADD0         LKREVI                                            AR317401
     C                     EXSR FEECHG                                                      AR317401
      *                                                                                     AR317401
      ** Newly inserted loan fees.                                                          AR317401
      *                                                                                     AR317401
     C           FEORED    WHEQ BJRDNB                                                      AR317401
     C           FEPEND    ANDGEVDATHP                                                      AR317401
     C           FEPYON    ANDEQ'E'                                                         AR317401
     C           FEORED    OREQ BJRDNB                                                      AR317401
     C           FEPSTD    ANDGEVDATHP                                                      AR317401
     C           FEPYON    ANDNE'E'                                                         AR317401
     C           FEAUTO    ANDNE'N'                                                         AR317401
     C           FEORED    OREQ BJRDNB                                                      AR317401
     C           FEPSTD    ANDLTVDATHP                                                      AR317401
     C           FEPYON    ANDEQ'S'                                                         AR317401
     C           FEAUTO    ANDEQ'N'                                                         AR317401
     C           FEORED    OREQ BJRDNB                                                      AR317401
     C           FEPEND    ANDLTVDATHP                                                      AR317401
     C           FEAUTO    ANDEQ'N'                                                         AR317401
     C           FEPSTD    ORGE WAPDAT                                                      AR317401
     C                     MOVE SUTPHP    FESUTP                                            AR317401
      *                                                                                     AR317401
     C                     ENDSL                                                            AR317401
     C                     ENDIF                                                            AR317401
     C/COPY WNCPYSRC,LEH01081
     C********** CLE134    IFEQ 'Y'                                             AR1080660 AR1076968B
     C********** FEAUTO    ANDEQ'C'                                             AR1080660 AR1076968B
     C********** FEFAMT    ANDGTFEAMTS                                          AR1080660 AR1076968B
     C**********           GOTO ENDDTL                                          AR1080660 AR1076968B
     C**********           ENDIF                                                AR1080660 AR1076968B
      *
      ** Not a reversal record
     C                     MOVE '0'       LKREVI
      *
     C           FECALT    IFEQ *BLANKS
      *
     C                     MOVE *BLANK    FEDIND
      *
      ** Check if Fee has PDCLs                                                             AR402732
      *                                                                                     AR402732
     C                     MOVE 'N'       WPDCL   1                                         AR402732
     C           CLE134    IFEQ 'Y'                                                         AR402732
      *                                                                                     AR402732
     C                     MOVE FELOAN    ZLOAN                                             AR402732
     C                     MOVE FECNUM    ZCNUM                                             AR402732
     C                     MOVE FEFACL    ZFEFCL                                            AR402732
     C                     MOVE FEFSEQ    ZFSEQ                                             AR402732
      *                                                                                     AR402732
      ** Access Past Due Call Loans file                                                    AR402732
      *                                                                                     AR402732
     C           ZLEPD     CHAINLEPDUFL2             88                                     AR402732
     C           *IN88     IFEQ *OFF                                                        AR402732
     C                     MOVE 'A'       WRCDT                                             AR402732
     C           WLPDCL    CHAINCLOAN                88                                     AR402732
     C           *IN88     IFEQ *OFF                                                        AR402732
     C           CPAM      ANDNE*ZEROS                                                      AR402732
     C                     MOVE 'Y'       WPDCL   1                                         AR402732
     C                     ENDIF                                                            AR402732
     C                     ENDIF                                                            AR402732
     C           *LOVAL    SETLLCLOAN                                                       AR402732
      *                                                                                     AR402732
     C                     ENDIF                                                            AR402732
      *                                                                                     AR402732
      ** If payment on ind. blank then this is a bullet fee
      ** ==================================================
      *
     C           FEPYON    IFEQ ' '
     C/COPY WNCPYSRC,LEH00899
      *
      ** make fee amount past due zero
     C                     Z-ADD0         FEAMTP
      *
     C                     MOVE FEAUTO    WFEAUT  1                                           CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           WFEAUT    IFEQ 'C'                                                           CLE134
     C           FEAUT2    OREQ 'C'                                                           CLE134
     C                     MOVE 'Y'       WFEAUT                                              CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
      ** When the autosettle indicator is Y this is a confirmed fee
      *                                                                                       CLE134
     C********** FEAUTO    IFEQ 'Y'                                                           CLE134
     C           WFEAUT    IFEQ 'Y'                                                           CLE134
     C                     Z-ADDFEPSTD    WNWDAT  50                                          CLE134
      *                                                                                       CLE134
      ** check if grace days are to be added                                                  CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           AUGDPR    ANDNE0                                                             CLE134
     C           FEAUTO    IFEQ 'C'                                                           CLE134
     C           FEAUT2    OREQ 'C'                                                           CLE134
     C           FEPSTD    ADD  AUGDPR    WNWDAT                                              CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *
     C********** FEPSTD    IFLE WAPDAT                                                        CLE134
     C           WNWDAT    IFLE WAPDAT                                                        CLE134
     C                     Z-ADDFEFAMT    FEAMTO                          E45724
     C                     Z-ADDFEPSTD    LKEDAT
     C                     EXSR SETTLE
     C           FECAPI    IFEQ 'Y'                                                           CLE139
     C                     EXSR SRLOAM                                                        CLE139
     C                     ENDIF                                                              CLE139
     C                     END
      *
      ** If start date is equal to next working day set due indicator
     C           FEPSTD    IFEQ BJDNWD
     C                     MOVE 'B'       FEDIND
     C                     Z-ADDFEFAMT    FEAMTO                          BH3424
     C                     END
      *
     C                     END
      *
      ** When the autosettle indicator is 'N' this is an advice fee
     C           FEAUTO    IFEQ 'N'
      *
      ** If start date has passed set up past due, else blank out
     C           FEPSTD    IFLE WAPDAT
     C                     MOVE 'A'       FEDIND
     C                     Z-ADDFEPSTD    FEDDAT
     C                     Z-ADDFEFAMT    FEAMTO
     C                     Z-ADDFEFAMT    FEAMTP
     C           CAS016    IFEQ 'Y'                                                           CAS016
     C********** FELOAN    ANDGT0                                                      CAS016 CLE148
     C           FELOAN    ANDGT*BLANKS                                                       CLE148
     C                     Z-ADDFEPSTD    LKEDAT                                              262553
     C                     EXSR SRLECF                                                        CAS016
     C                     ENDIF                                                              CAS016
     C                     ELSE
     C                     Z-ADD0         FEDDAT
     C                     Z-ADD0         FEAMTO
     C                     Z-ADD0         FEAMTP
     C                     END
      *
      ** If start date is equal to the next working day set due ind.
     C           FEPSTD    IFEQ BJDNWD
     C                     MOVE 'C'       FEDIND
     C                     Z-ADDFEFAMT    FEAMTO                          BH3424
     C                     END
     C                     END
      *
     C/COPY WNCPYSRC,LEH00900
     C                     END
      *
      ** If payment on ind. is 'S' (start)
     C** =================================
      *
     C           FEPYON    IFEQ 'S'
      *
      ** Confirmed fee
     C                     MOVE FEAUTO    WFEAUT                                              CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           WFEAUT    IFEQ 'C'                                                           CLE134
     C           FEAUT2    OREQ 'C'                                                           CLE134
     C                     MOVE 'Y'       WFEAUT                                              CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
     C********** FEAUTO    IFEQ 'Y'                                                           CLE134
     C           WFEAUT    IFEQ 'Y'                                                           CLE134
     C                     Z-ADDFEPSTD    WNWDAT                                              CLE134
      *                                                                                       CLE134
      ** check if grace days are to be added                                                  CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           AUGDPR    ANDNE0                                                             CLE134
     C           FEAUTO    IFEQ 'C'                                                           CLE134
     C           FEAUT2    OREQ 'C'                                                           CLE134
     C           FEPSTD    ADD  AUGDPR    WNWDAT                                              CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *
      ** If start date has been reached
     C********** FEPSTD    IFLE WAPDAT                                                        CLE134
     C           WNWDAT    IFLE WAPDAT                                                        CLE134
     C                     EXSR ACCRUE
      *
      ** If settled amount is zero
     C           FEAMTS    IFEQ 0
     C                     Z-ADDFEPSTD    LKEDAT
     C                     EXSR SETTLE
     C           FECAPI    IFEQ 'Y'                                                           CLE139
     C                     EXSR SRLOAM                                                        CLE139
     C                     ENDIF                                                              CLE139
      *                                                                   121541
      ** Make fee amount past due zero                                    121541
      *                                                                   121541
     C                     Z-ADD0         FEAMTP                          121541
     C                     END
      *
      ** If fee period end is before accrual profit work date
     C           FEPEND    IFLE WAPDAT
      *                                                                                       CLE134
     C                     MOVE 'N'       WPDCL   1                                           CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
      *                                                                                       CLE134
     C                     MOVE FELOAN    ZLOAN                                               CLE134
     C                     MOVE FECNUM    ZCNUM                                               CLE134
     C                     MOVE FEFACL    ZFEFCL                                              CLE134
     C                     MOVE FEFSEQ    ZFSEQ                                               CLE134
      *                                                                                       CLE134
      ** access Past Due Call Loans file                                                      CLE134
      *                                                                                       CLE134
     C           ZLEPD     CHAINLEPDUFL2             88                                       CLE134
     C           *IN88     IFEQ *OFF                                                          CLE134
     C                     MOVE 'A'       WRCDT                                               CLE134
     C           WLPDCL    CHAINCLOAN                88                                       CLE134
     C           *IN88     IFEQ *OFF                                                          CLE134
     C           CPAM      ANDNE*ZEROS                                                        CLE134
     C**********           MOVE 'N'       WPDCL   1                                 CLE134  AR402732
     C                     MOVE 'Y'       WPDCL   1                                         AR402732
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
     C           WLNKEY    CHAINCLOAN                88                                       CLE134
      *                                                                                       CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C           WPDCL     IFEQ 'N'                                                           CLE134
     C           FEAUTO    IFNE 'C'                                                         AR402732
     C           FEAUTO    OREQ 'C'                                                         AR402732
     C           FEPSTD    ANDLTBJRDNB                                                      AR402732
     C           FELCHD    ANDLTBJRDNB                                                      AR402732
     C                     MOVE 'M'       FERECI
     C********** FEAUTO    IFEQ 'C'                                               AR1078443 MD020212
     C**********           MOVE 'D'       FERECI                                  AR1078443 MD020212
     C**********           ENDIF                                                  AR1078443 MD020212
     C                     Z-ADDBJRDNB    LKEDAT                          248821
     C                     ENDIF                                                            AR402732
     C                     ENDIF                                                              CLE134
     C                     END
     C                     END
      *
      ** If start date is equal to the next working day set due ind.
     C           FEPSTD    IFEQ BJDNWD
     C                     MOVE 'B'       FEDIND
     C                     Z-ADDFEFAMT    FEAMTO                          BH3424
     C                     END
     C                     END
      *
      ** Fee advice
     C           FEAUTO    IFEQ 'N'
      *
      ** If start date has been passed set up past due, else blank out
     C           FEPSTD    IFLE WAPDAT
     C                     EXSR ACCRUE
     C                     MOVE 'A'       FEDIND
     C                     Z-ADDFEPSTD    FEDDAT
     C                     Z-ADDFEFAMT    FEAMTO
     C                     Z-ADDFEFAMT    FEAMTP
     C           CAS016    IFEQ 'Y'                                                           CAS016
     C********** FELOAN    ANDGT0                                                      CAS016 CLE148
     C           FELOAN    ANDGT*BLANKS                                                       CLE148
     C                     Z-ADDFEPSTD    LKEDAT                                              262553
     C                     EXSR SRLECF                                                        CAS016
     C                     ENDIF                                                              CAS016
     C                     ELSE
     C                     Z-ADD0         FEDDAT
     C                     Z-ADD0         FEAMTO
     C                     Z-ADD0         FEAMTP
     C                     END
      *
      ** If start date is equal to the next working day set due ind.
     C           FEPSTD    IFEQ BJDNWD
     C                     MOVE 'C'       FEDIND
     C                     Z-ADDFEFAMT    FEAMTO                          BH3424
     C                     END
     C                     END
     C                     END
      *
      ** If payment on ind. is 'E' (End)
      *  ===============================
      *
     C           FEPYON    IFEQ 'E'
      *
      ** Process accrual (regardless of auto settle ind)
     C           FEPSTD    IFLE WAPDAT
     C                     EXSR ACCRUE
     C                     END
      *
     C                     MOVE FEAUTO    WFEAUT  1                                           CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           WFEAUT    IFEQ 'C'                                                           CLE134
     C           FEAUT2    OREQ 'C'                                                           CLE134
     C                     MOVE 'Y'       WFEAUT                                              CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
      ** Confirmed fee
      *                                                                                       CLE134
     C********** FEAUTO    IFEQ 'Y'                                                           CLE134
     C           WFEAUT    IFEQ 'Y'                                                           CLE134
      *
      ** check if grace days are to be added                                                  CLE134
      *                                                                                       CLE134
     C                     Z-ADDFEPEND    WNWDAT                                              CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           AUGDPR    ANDNE0                                                             CLE134
     C           FEAUTO    IFEQ 'C'                                                           CLE134
     C           FEAUT2    OREQ 'C'                                                           CLE134
     C           FEPEND    ADD  AUGDPR    WNWDAT                                              CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
      ** If end date has been reached & amount not settled
     C********** FEPEND    IFLE WAPDAT                                                        CLE134
     C           WNWDAT    IFLE WAPDAT                                                        CLE134
     C                     Z-ADDFEPEND    LKEDAT
      *                                                                                    MD020824A
      ** For Auto-settle='C', skip payment processing                                      MD020824A
      ** when a PDCL already exists in LEPDUFPD                                            MD020824A
      *                                                                                    MD020824A
     C           CLE134    IFEQ 'Y'                                                        MD020824A
     C           FEAUTO    IFEQ 'C'                                                        MD020824A
     C           FEAUT2    OREQ 'C'                                                        MD020824A
     C                     MOVE FELOAN    ZLOAN                                            MD020824A
     C                     MOVE FECNUM    ZCNUM                                            MD020824A
     C                     MOVE FEFACL    ZFEFCL                                           MD020824A
     C                     MOVE FEFSEQ    ZFSEQ                                            MD020824A
     C           ZLEPD     CHAINLEPDUFL2             88                                    MD020824A
     C           *IN88     IFEQ *OFF                                                       MD020824A
     C                     GOTO ENDDTL                                                     MD020824A
     C                     ENDIF                                                           MD020824A
     C                     ENDIF                                                           MD020824A
     C                     ENDIF                                                           MD020824A
      *                                                                                    MD020824A
     C                     EXSR SETTLE
     C           FECAPI    IFEQ 'Y'                                                           CLE139
     C                     EXSR SRLOAM                                                        CLE139
     C                     ENDIF                                                              CLE139
      *                                                                   121541
      ** Make fee amount past due zero                                    121541
      *                                                                   121541
     C                     Z-ADD0         FEAMTP                          121541
     C                     END
      *
      ** If end date is equal to the next working day set due ind.
     C           FEPEND    IFEQ BJDNWD
     C                     MOVE 'B'       FEDIND
     C                     Z-ADDFEFAMT    FEAMTO                          BH3424
     C                     END
     C                     END
      *
      ** Fee advice
     C           FEAUTO    IFEQ 'N'
      ** If end date has passed set up past due, else blank out
     C           FEPEND    IFLE WAPDAT
     C                     MOVE 'A'       FEDIND
     C                     Z-ADDFEPEND    FEDDAT
     C                     Z-ADDFEFAMT    FEAMTO
     C                     Z-ADDFEFAMT    FEAMTP
     C           CAS016    IFEQ 'Y'                                                           CAS016
     C********** FELOAN    ANDGT0                                                      CAS016 CLE148
     C           FELOAN    ANDGT*BLANKS                                                       CLE148
     C                     Z-ADDFEPEND    LKEDAT                                              262553
     C                     EXSR SRLECF                                                        CAS016
     C                     ENDIF                                                              CAS016
     C                     ELSE
     C                     Z-ADD0         FEDDAT
     C                     Z-ADD0         FEAMTP
     C                     END
      *
      ** If end date is equal to the next working day set due ind.
     C           FEPEND    IFEQ BJDNWD
     C                     MOVE 'C'       FEDIND
     C                     Z-ADDFEFAMT    FEAMTO                          BH3424
     C                     END
     C                     END
     C                     END
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           FEPYON    ANDEQ'N'                                                           CLE031
      *                                                                                       CLE031
      ** If Fee Start Date is less than Accrual Profit work date                              CLE031
      *                                                                                       CLE031
     C           FEPSTD    IFLE WAPDAT                                                        CLE031
     C                     EXSR ACCRUE                                                        CLE031
     C                     ENDIF                                                              CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE034
     C                     EXSR SRFHST                                                        CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE031
      ** If this is a confirmed fee:                                                          CLE031
      *                                                                                       CLE031
     C                     MOVE FEAUTO    WFEAUT  1                                           CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           WFEAUT    IFEQ 'C'                                                           CLE134
     C           FEAUT2    OREQ 'C'                                                           CLE134
     C                     MOVE 'Y'       WFEAUT                                              CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C********** FEAUTO    IFEQ 'Y'                                                    CLE031 CLE134
     C           WFEAUT    IFEQ 'Y'                                                           CLE134
      *                                                                                       CLE134
      ** check if grace days are to be added                                                  CLE134
      *                                                                                       CLE134
     C                     Z-ADDFENPYD    WNWDAT                                              CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           AUGDPR    ANDNE0                                                             CLE134
     C           FEAUTO    IFEQ 'C'                                                           CLE134
     C           FEAUT2    OREQ 'C'                                                           CLE134
     C           FENPYD    ADD  AUGDPR    WNWDAT                                              CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE031
      ** If Next payment date is less than Accrual Profit work date:                          CLE031
      *                                                                                       CLE031
     C********** FENPYD    IFLE WAPDAT                                                 CLE031 CLE134
     C           WNWDAT    IFLE WAPDAT                                                        CLE134
     C           FENPYD    ANDNE0                                                             CLE031
     C                     Z-ADDFENPYD    LKEDAT                                              CLE031
     C                     EXSR SETTLE                                                        CLE031
     C           FECAPI    IFEQ 'Y'                                                           CLE139
     C                     EXSR SRLOAM                                                        CLE139
     C                     ENDIF                                                              CLE139
     C                     Z-ADD0         FEAMTP                                              CLE031
     C                     Z-ADDFENPYD    FELPDT                                              CLE031
      *                                                                                       CLE031
      ** Calculate next payment date:                                                         CLE031
      *                                                                                       CLE031
     C                     EXSR SETDAT                                                        CLE031
     C                     Z-ADDNWNPYD    FENPYD                                              CLE031
     C           NWNPYD    IFEQ 0                                                             CLE031
     C                     MOVE *BLANKS   FEFREQ                                              CLE031
     C                     Z-ADD0         FEDYIM                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           FENPYD    IFEQ BJDNWD                                                        CLE031
     C                     MOVE 'B'       FEDIND                                              CLE031
     C                     Z-ADDFEFAMT    FEAMTO                                              CLE031
     C                     Z-ADDFENPYD    FEDDAT                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Else, FEAUTO = 'N' so this is an advice fee:                                         CLE031
      *                                                                                       CLE031
     C                     ELSE                                                               CLE031
      *                                                                                       CLE031
      ** If Next payment date is less than Accrual Profit work date:                          CLE031
      *                                                                                       CLE031
     C           FENPYD    IFLE WAPDAT                                                        CLE031
     C           FENPYD    ANDNE0                                                             CLE031
     C                     MOVE 'A'       FEDIND                                              CLE031
     C                     Z-ADDFENPYD    FEDDAT                                              CLE031
     C                     Z-ADDFEFAMT    FEAMTO                                              CLE031
     C                     Z-ADDFEFAMT    FEAMTP                                              CLE031
     C                     Z-ADDFENPYD    FELPDT                                              CLE031
      *                                                                                       CLE031
      ** Calculate next payment date:                                                         CLE031
      *                                                                                       CLE031
     C                     EXSR SETDAT                                                        CLE031
     C                     Z-ADDNWNPYD    FENPYD                                              CLE031
     C           NWNPYD    IFEQ 0                                                             CLE031
     C                     MOVE *BLANKS   FEFREQ                                              CLE031
     C                     Z-ADD0         FEDYIM                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ELSE                                                               CLE031
     C           FEAMTP    IFEQ 0                                                             CLE031
     C                     Z-ADD0         FEDDAT                                              CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE 'A'       FEDIND                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** If Next payment date is equal to the next working day:                               CLE031
      *                                                                                       CLE031
     C           FENPYD    IFEQ BJDNWD                                                        CLE031
     C                     MOVE 'C'       FEDIND                                              CLE031
     C                     Z-ADDFEFAMT    FEAMTO                                              CLE031
     C                     Z-ADDFENPYD    FEDDAT                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      *                                                                                       CAS009
      ** If payment on ind. is 'N' (Next)                                                     CAS009
      ** ================================                                                     CAS009
      *                                                                                       CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C/COPY WNCPYSRC,LEH00506
      *                                                                                       CAS009
     C           FEPYON    IFEQ 'N'                                                           CAS009
      *                                                                                       CAS009
      ** If Fee Start Date is less than Accrual Profit work date                              CAS009
      *                                                                                       CAS009
     C           FEPSTD    IFLE WAPDAT                                                        CAS009
     C                     EXSR ACCRUE                                                        CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** If this is a confirmed fee:                                                          CAS009
      *                                                                                       CAS009
     C                     MOVE FEAUTO    WFEAUT                                              CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           WFEAUT    IFEQ 'C'                                                           CLE134
     C           FEAUT2    OREQ 'C'                                                           CLE134
     C                     MOVE 'Y'       WFEAUT                                              CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
     C********** FEAUTO    IFEQ 'Y'                                                    CAS009 CLE134
     C           WFEAUT    IFEQ 'Y'                                                           CLE134
      *                                                                                       CLE134
      ** check if grace days are to be added                                                  CLE134
      *                                                                                       CLE134
     C                     Z-ADDFENPYD    WNWDAT                                              CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           AUGDPR    ANDNE0                                                             CLE134
     C           FEAUTO    IFEQ 'C'                                                           CLE134
     C           FEAUT2    OREQ 'C'                                                           CLE134
     C           FENPYD    ADD  AUGDPR    WNWDAT                                              CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CAS009
      ** If Next payment date is less than Accrual Profit work date:                          CAS009
      *                                                                                       CAS009
     C********** FENPYD    IFLE WAPDAT                                                 CAS009 CLE134
     C           WNWDAT    IFLE WAPDAT                                                        CLE134
     C           FENPYD    ANDNE0                                                             CAS009
     C/COPY WNCPYSRC,LEH01144
     C                     Z-ADDFENPYD    LKEDAT                                              CAS009
     C/COPY WNCPYSRC,LEH01145
     C                     EXSR SETTLE                                                        CAS009
     C           FECAPI    IFEQ 'Y'                                                           CLE139
     C                     EXSR SRLOAM                                                        CLE139
     C                     ENDIF                                                              CLE139
     C                     Z-ADD0         FEAMTP                                              CAS009
     C                     Z-ADDFENPYD    FELPDT                                              CAS009
      *                                                                                       CAS009
      ** Calculate next payment date:                                                         CAS009
      *                                                                                       CAS009
     C                     EXSR SETDAT                                                        CAS009
     C                     Z-ADDNWNPYD    FENPYD                                              CAS009
     C           NWNPYD    IFEQ 0                                                             CAS009
     C                     MOVE *BLANKS   FEFREQ                                              CAS009
     C                     Z-ADD0         FEDYIM                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C           FENPYD    IFEQ BJDNWD                                                        CAS009
     C                     MOVE 'B'       FEDIND                                              CAS009
     C                     Z-ADDFEFAMT    FEAMTO                                              CAS009
     C                     Z-ADDFENPYD    FEDDAT                                              CAS009
     C                     ENDIF                                                              CAS009
     C/COPY WNCPYSRC,LEH01142
      *                                                                                       CAS009
      ** Else, FEAUTO = 'N' so this is an advice fee:                                         CAS009
      *                                                                                       CAS009
     C                     ELSE                                                               CAS009
      *                                                                                       CAS009
      ** If Next payment date is less than Accrual Profit work date:                          CAS009
      *                                                                                       CAS009
     C           FENPYD    IFLE WAPDAT                                                        CAS009
     C           FENPYD    ANDNE0                                                             CAS009
     C                     MOVE 'A'       FEDIND                                              CAS009
     C                     Z-ADDFENPYD    FEDDAT                                              CAS009
     C                     Z-ADDFEFAMT    FEAMTO                                              CAS009
     C                     Z-ADDFEFAMT    FEAMTP                                              CAS009
     C                     Z-ADDFENPYD    FELPDT                                              CAS009
     C           CAS016    IFEQ 'Y'                                                           CAS016
     C********** FELOAN    ANDGT0                                                      CAS016 CLE148
     C           FELOAN    ANDGT*BLANKS                                                       CLE148
     C                     Z-ADDFENPYD    LKEDAT                                              262553
     C                     EXSR SRLECF                                                        CAS016
     C                     ENDIF                                                              CAS016
      *                                                                                       CAS009
      ** Calculate next payment date:                                                         CAS009
      *                                                                                       CAS009
     C                     EXSR SETDAT                                                        CAS009
     C                     Z-ADDNWNPYD    FENPYD                                              CAS009
     C           NWNPYD    IFEQ 0                                                             CAS009
     C                     MOVE *BLANKS   FEFREQ                                              CAS009
     C                     Z-ADD0         FEDYIM                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ELSE                                                               CAS009
     C           FEAMTP    IFEQ 0                                                             CAS009
     C                     Z-ADD0         FEDDAT                                              CAS009
     C                     ELSE                                                               CAS009
     C                     MOVE 'A'       FEDIND                                              CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** If Next payment date is equal to the next working day:                               CAS009
      *                                                                                       CAS009
     C           FENPYD    IFEQ BJDNWD                                                        CAS009
     C                     MOVE 'C'       FEDIND                                              CAS009
     C                     Z-ADDFEFAMT    FEAMTO                                              CAS009
     C                     Z-ADDFENPYD    FEDDAT                                              CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C/COPY WNCPYSRC,LER130CCP2                                           S01408
      *
     C                     END
      *
     C                     ADD  1         WNORE
     C                     UPDATLEFEEDF
      *
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           FERECI    ANDEQ'M'                                                           CLE034
      *                                                                                       CLE034
     C                     MOVE FELOAN    PLNRF                                               CLE034
     C                     MOVE FECNUM    PCNUM                                               CLE034
     C                     MOVE FEFACL    PFACL                                               CLE034
     C                     MOVE FEFSEQ    PFSEQ                                               CLE034
     C                     MOVEASTAMP,1   PTMST                                               CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSTALU0'                                                    CLE034
     C                     PARM *BLANKS   PRTCD                                               CLE034
     C                     PARM 'FEES'    PTYPE                                               CLE034
     C                     PARM 'M'       PACTN                                               CLE034
     C                     PARM           PLNRF                                               CLE034
     C                     PARM *BLANKS   PLAVD                                               CLE034
     C                     PARM *BLANKS   PLASQ                                               CLE034
     C                     PARM           PCNUM                                               CLE034
     C                     PARM           PFACL                                               CLE034
     C                     PARM           PFSEQ                                               CLE034
     C                     PARM           PTMST                                               CLE034
     C                     PARM *BLANKS   PPCRF  15                                           CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C********** ENDDTL    TAG                                                  AR1080660 AR1076968B
     C           ENDDTL    TAG                                                             MD020824A
     C                     ENDSR
      *
      *****************************************************************
     C/TITLE SR/REVERS
      ********************************************************************
      *
      *  REVERS -  PERFORM REVERSAL OF DELETED RECORDS FROM LEFEED
      *
      *  CALLED FROM: MAIN PROCESSING
      *
      *  CALLS: ACCRUE, SETTLE,
      *
      ********************************************************************
      *
     C           REVERS    BEGSR
      *
     C                     MOVE '*'       FERECI
      *
      ** If original entry date is today ignore processing
     C           FEORED    IFNE BJRDNB
      *
      ** Only process non-calculated or loan fees
     C           FECALT    IFEQ *BLANKS
     C/COPY WNCPYSRC,LEH00901
      *
      ** If amount has already been settled then reverse
     C           FEAMTS    IFNE 0
     C                     MOVE '1'       LKREVI
     C                     Z-ADDFESDAT    LKEDAT
     C/COPY WNCPYSRC,LEH01146
     C                     EXSR SETTLE
      *                                                                   CLE007
      ** Generate record to LEPXTAB only if settlement type is 08         155672
      *                                                                   155672
     C           CLE007    IFEQ 'Y'                                       CLE007
     C           CLE009    ANDEQ'N'                                       CLE009
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C                     EXSR SR34A                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'Y'       WKFLD                                               CLE034
     C                     MOVE '*EOF   ' PRTCD                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           WKFLD     DOWEQ'Y'                                                           CLE034
     C           PRTCD     OREQ *BLANKS                                                       CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C                     EXSR SR34B                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                   155672
     C           FESTTL    IFEQ 08                                        155672
     C           FEOURS    ANDNE*BLANKS                                   155672
     C                     MOVELFEOURS    WKEYE                           155672
     C                     MOVE FEFCCY    WKEYB                           155672
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
      *                                                                                       CLE031
      * If Participant Fee, and pay settlement currency not blank..    .                      CLE031
     C           PTFI      IFNE *BLANK                                                        CLE031
     C           FEPSCY    ANDNE*BLANK                                                        CLE031
     C                     MOVE FEPSCY    WKEYB                                               CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      * If not Participant Fee, and receive settlement ccy not blank...                       CLE031
     C           PTFI      IFEQ *BLANK                                                        CLE031
     C           FESCCY    ANDNE*BLANK                                                        CLE031
     C                     MOVE FESCCY    WKEYB                                               CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDIF                                                              CLE031
      *                                                                   155672
     C                     CALL 'AONOSTR0'PNOST                           155672
     C           WRTCD     IFNE *BLANKS                                   155672
     C           *LOCK     IN   LDA                                       155672
     C                     MOVEL'SDNOSTPD'DBFILE           ************   155672
     C                     MOVEL'017'     DBASE            * DBERR 17 *   155672
     C                     MOVELWKEYB     DBKEY            ************   155672
     C                     MOVE WKEYE     DBKEY                           155672
     C                     OUT  LDA                                       155672
     C                     EXSR *PSSR                                     155672
     C                     ENDIF                                          155672
      *                                                                   155672
     C                     MOVELA7CUST    WCKEY                           155672
     C                     MOVEL'*CNUM'   WKYSTS                          155672
      *                                                                   155672
     C                     CALL 'AOCUSTR0'PCUST                           155672
     C           WRTCD     IFNE *BLANKS                                   155672
     C           *LOCK     IN   LDA                                       155672
     C                     MOVEL'SDCUSTPD'DBFILE           ************   155672
     C                     MOVEL'018'     DBASE            * DBERR 18 *   155672
     C                     MOVELWCKEY     DBKEY            ************   155672
     C                     OUT  LDA                                       155672
     C                     EXSR *PSSR                                     155672
     C                     ENDIF                                          155672
      *                                                                   155672
     C           BBGSFM    IFEQ 'Y'                                       155672
     C                     EXSR RTLX                                      CLE007
     C                     ENDIF                                          155672
     C                     ENDIF                                          155672
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C                     EXSR SR34C                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE *BLANKS   WKFLD                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDDO                                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C                     EXSR SR34E                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                   155672
     C                     ENDIF                                          CLE007
      *                                                                   CLE007
     C                     END
      *
     C***If*amount*has*already*been*accrued*then*reverse****              BH3463
     C********** FEADAT    IFNE 0                                         BH3463
     C** If amount has already been posted then reverse                   BH3463
     C           FELPAM    IFNE 0                                         BH3463
     C*                                                                   052155
     C** Reverse adjustments that have been posted                        052155
     C*                                                                   052155
     C           FEAMTA    ORNE 0                                         052155
     C                     MOVE '1'       LKREVI
     C                     EXSR ACCRUE
     C                     END
     C/COPY WNCPYSRC,LEH00902
     C*                                                                   BH3463
     C***  If calculated fee -                                            BH3463
     C*                                                                   BH3463
     C                     ELSE                                           BH3463
     C*                                                                   BH3463
     C           FELPAM    IFNE 0                                         BH3463
     C           FEAMTP    ORNE 0                                         BH3463
     C                     Z-ADD1         LKREVI                          BH3463
     C                     EXSR ACCRUE                                    BH3463
     C                     END                                            BH3463
      *
     C/COPY WNCPYSRC,LER130CCP5                                           S01408
     C                     END
     C                     END
      *                                                                                       238569
     C           CAS009    IFEQ 'Y'                                                           238569
      *          FELOAN    IFGT 0                                                             238569
     C           KFEE2     CHAINLECFLSL1             22                                       238569
     C           *IN22     IFEQ '0'                                                           238569
     C                     DELETLECFLSD0                                                      238569
     C                     ENDIF                                                              238569
     C                     ENDIF                                                              238569
      *                                                                                       238569
      *
     C                     ADD  1         WNREV
     C                     UPDATLEFEEDF
      *
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
     C                     MOVE FELOAN    PLNRF   6                                           CLE034
     C                     MOVE FECNUM    PCNUM   6                                           CLE034
     C                     MOVE FEFACL    PFACL   5                                           CLE034
     C                     MOVE FEFSEQ    PFSEQ   2                                           CLE034
     C                     MOVEASTAMP,1   PTMST                                               CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSTALU0'                                                    CLE034
     C                     PARM *BLANKS   PRTCD                                               CLE034
     C                     PARM 'FEES'    PTYPE   4                                           CLE034
     C                     PARM 'D'       PACTN   1                                           CLE034
     C                     PARM           PLNRF                                               CLE034
     C                     PARM *BLANKS   PLAVD   5                                           CLE034
     C                     PARM *BLANKS   PLASQ   3                                           CLE034
     C                     PARM           PCNUM                                               CLE034
     C                     PARM           PFACL                                               CLE034
     C                     PARM           PFSEQ                                               CLE034
     C                     PARM           PTMST  26                                           CLE034
     C                     PARM *BLANKS   PPCRF                                               CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDSR
      *
      *****************************************************************
     C/TITLE SR/REMOVE
      ********************************************************************
      *
      *  REMOVE -  PERFORM REMOVAL OF EXPIRED RECORDS FROM LEFEED
      *            AFTER WRITING DETAILS TO FEE HISTORY RECORD
      *
      *  CALLED FROM: MAIN PROCESSING
      *
      *  CALLS: NOTHING
      *
      ********************************************************************
      *
     C           REMOVE    BEGSR
      *
      ** Do not delete MATURED records if it is linked to a live PDCL.                      AR785482
      *                                                                                     AR785482
     C                     MOVEL'N'       PDCLLF  1                                         AR785482
     C           FERECI    IFEQ 'M'                                                         AR785482
     C           FEAUTO    ANDEQ'C'                                                         AR785482
     C           CLE134    ANDEQ'Y'                                                         AR785482
      *                                                                                     AR785482
     C                     MOVE FELOAN    ZLOAN                                             AR785482
     C                     MOVE FECNUM    ZCNUM                                             AR785482
     C                     MOVE FEFACL    ZFEFCL                                            AR785482
     C                     MOVE FEFSEQ    ZFSEQ                                             AR785482
      *                                                                                     AR785482
     C                     MOVE *OFF      *IN88                                             AR785482
     C           ZLEPD     CHAINLEPDUFL2             88                                     AR785482
      *                                                                                     AR785482
     C           *IN88     IFEQ *OFF                                                        AR785482
     C                     MOVE 'A'       WRCDT                                             AR785482
     C                     MOVE *OFF      *IN87                                             AR785482
     C           WLPDCL    CHAINCLOAN                87                                     AR785482
      *                                                                                     AR785482
     C           *IN87     IFEQ *OFF                                                        AR785482
     C           RECI      IFNE 'M'                                                         AR785482
     C                     MOVEL'Y'       PDCLLF                                            AR785482
     C                     ENDIF                                                            AR785482
     C                     ENDIF                                                            AR785482
     C                     ENDIF                                                            AR785482
     C                     ENDIF                                                            AR785482
      *                                                                                     AR785482
     C           PDCLLF    IFEQ 'N'                                                         AR785482
     C/COPY WNCPYSRC,LER130C003
      ** Before deleting matured records from the fee master file
      ** write details to fee history file and add one to total
      ** fee history record count
      *
     C           FSAMRM    IFEQ 'L'                                                           231710
     C           CAS009    ANDEQ'Y'                                                           242602
     C           FERECI    OREQ '*'                                                           231710
     C           FERECI    OREQ 'M'                                                           231710
     C           FSAMRM    ANDEQ'N'                                                           231710
     C           FEFAMT    ANDEQFEAMTD                                                        231710
     C           CAS009    ANDEQ'Y'                                                           242602
     C           FERECI    OREQ 'M'                                                           231710
     C           FSAMRM    ANDEQ' '                                                           231710
     C           FEFAMT    ANDEQFEAMTD                                                        231710
     C           CAS009    ANDEQ'Y'                                                           242602
     C           CAS009    OREQ 'N'                                                           242602
      *                                                                                       231710
     C           FERECI    IFEQ 'M'
     C                     MOVE FERECI    HIRECI
     C                     MOVE FEBRCA    HIBRCA
     C                     MOVE FECNUM    HICNUM
     C                     MOVE FEFACL    HIFACL
     C                     MOVE FELOAN    HILNRF
     C**********           MOVE FEFSEQ    HIFSEQ                                              258597
     C                     Z-ADD0         HIFSEQ                                              258597
     C                     MOVE FEFCOD    HIFCOD
     C                     MOVE FEFCCY    HIFCCY
     C                     Z-ADDFEAMTS    HIAMTS
     C***********          Z-ADDBJRDNB    HIHDAT                          133518
     C                     Z-ADDFESDAT    HIHDAT                          133518
     C           CLE031    IFEQ 'Y'                                                           CLE034
     C           FELPDT    ANDNE0                                                             CLE034
     C                     Z-ADDFELPDT    HIHDAT                                              CLE034
     C                     END                                                                CLE034
     C                     Z-ADDBJRDNB    HILCHD
     C                     MOVE 'I'       HILCHT
      *                                                                                      BUG8762
      ** Move fee rates and amounts fields from LEFEED to LEFHST if CLE005                   BUG8762
      ** is on and FEINDC not 'Y'.                                                           BUG8762
      *                                                                                      BUG8762
     C           CLE005    IFEQ 'Y'                                                          BUG8762
     C           FEINDC    ANDNE'Y'                                                          BUG8762
     C                     Z-ADDFEFRT1    HIFRT1                                             BUG8762
     C                     Z-ADDFEFRT2    HIFRT2                                             BUG8762
     C                     Z-ADDFEFRT3    HIFRT3                                             BUG8762
     C                     Z-ADDFEFRT4    HIFRT4                                             BUG8762
     C                     Z-ADDFEFRT5    HIFRT5                                             BUG8762
     C                     Z-ADDFEAMT1    HIAMT1                                             BUG8762
     C                     Z-ADDFEAMT2    HIAMT2                                             BUG8762
     C                     Z-ADDFEAMT3    HIAMT3                                             BUG8762
     C                     Z-ADDFEAMT4    HIAMT4                                             BUG8762
     C                     Z-ADDFEAMT5    HIAMT5                                             BUG8762
     C                     ENDIF                                                             BUG8762
     C                     EXSR ADDFLD                                                        CSW208
     C                     ADD  1         HIRECS
     C                     WRITELEFHSTF
     C                     END
      *                                                                                     AR632103
      ** Program LER136 will be called to ensure that before a matured                      AR632103
      ** fees were dropped in LEFEED, all corresponding records in                          AR632103
      ** PF/LEFHST will be tagged as 'M' and FSEQ will be changed to 0.                     AR632103
      *                                                                                     AR632103
     C           FERECI    IFEQ 'M'                                                        AR632103A
     C                     CALL 'LER136'                                                    AR632103
     C                     PARM           FEBRCA                                            AR632103
     C                     PARM           FECNUM                                            AR632103
     C                     PARM           FEFACL                                           AR632103A
     C                     PARM           FELOAN                                            AR632103
     C                     PARM           FEFSEQ                                            AR632103
     C                     PARM '       ' WRTCD                                             AR632103
     C                     PARM 'LER130'  WPGM    6                                        AR632102B
      *                                                                                     AR632103
      ** Error was encountered.                                                             AR632103
      *                                                                                     AR632103
     C           WRTCD     IFNE *BLANKS                                                     AR632103
     C           *LOCK     IN   LDA                                                         AR632103
     C                     MOVEL'LER130'  DBPGM                                             AR632103
     C                     MOVELFEFACL    DBKEY                                             AR632103
     C                     MOVE FEFSEQ    DBKEY                                             AR632103
     C                     MOVEL'LEFHST'  DBFILE           ************                     AR632103
     C                     Z-ADD034       DBASE            * DBERR 34 *                     AR632103
     C                     OUT  LDA                        ************                     AR632103
     C                     EXSR *PSSR                                                       AR632103
     C                     ENDIF                                                            AR632103
     C                     ENDIF                                                           AR632103A
      *                                                                                    AR632103A
      ** Delete corresponding fee records in PF/LEFHST of fees                             AR632103A
      ** with FERECI = '*' and would be dropped from PF/LEFEED.                            AR632103A
      *                                                                                    AR632103A
     C           FERECI    IFEQ '*'                                                        AR632103A
     C           HFEE      SETLLLEFHSTR                                                    AR632103A
     C           HFEE      READELEFHSTR                  60                                AR632103A
     C           *IN60     DOWEQ'0'                                                        AR632103A
     C                     DELETLEFHSTR                                                    AR632103A
     C           HFEE      READELEFHSTR                  60                                AR632103A
     C                     ENDDO                                                           AR632103A
     C                     ENDIF                                                           AR632103A
     C/COPY WNCPYSRC,LEH00551
      *
     C                     DELETLEFEEDF
      *                                                                                       260345
     C           FEEQ      SETLLLEFEEQL0                                                      260345
     C           FEEQ      CHAINLEFEEQL0             23                                       260345
      *                                                                                       260345
      ** if found, delete record from LEFEEDQD                                                260345
      *                                                                                       260345
     C           *IN23     IFEQ '0'                                                           260345
     C                     DELETLEFEEQD0                                                      260345
     C                     ENDIF                                                              260345
      *                                                                                     MD026969
     C           FZAS      SETLLLEFZASL1                                                    MD026969
     C           FZAS      READELEFZASL1                 24                                 MD026969
     C           *IN24     DOWEQ'0'                                                         MD026969
     C                     DELETLEFZASD0                                                    MD026969
     C           FZAS      READELEFZASL1                 24                                 MD026969
     C                     ENDDO                                                            MD026969
      *                                                                                       CLE134
      ** if CLE134 is ON, delete records from LEPDUFPD linked to the loan                     CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
      *                                                                                       CLE134
     C                     MOVE FELOAN    ZLOAN                                               CLE134
     C                     MOVE FECNUM    ZCNUM                                               CLE134
     C                     MOVE FEFACL    ZFEFCL                                              CLE134
     C                     MOVE FEFSEQ    ZFSEQ                                               CLE134
     C**********           MOVE FEFCOD    ZFCOD                                      AR574425 CLE164
     C**********           MOVE FEBRCA    ZFBRC                                      AR574425 CLE164
     C                     MOVE FEBRCA    KFBRC                                               CLE164
      *                                                                                       CLE134
      ** access Past Due Call Loans file                                                      CLE134
      *                                                                                       CLE134
     C*******    ZLEPD     CHAINLEPDUFL2             88                              CLE134 AR574425
      *                                                                                     AR574425
     C                     MOVE *OFF      *IN88                                             AR574425
      *                                                                                     AR574425
     C           ZLEPD     SETLLLEPDUFLB                                                    AR574425
      *                                                                                     AR574425
     C           *IN88     DOWEQ*OFF                                                        AR574425
     C           ZLEPD     READELEPDUFLB                 88                                 AR574425
     C           *IN88     IFEQ *OFF                                                          CLE134
     C************         DELETLEPDUFD0                                             CLE134 AR574425
     C                     DELETLEPDUFDB                                                    AR574425
     C                     ENDIF                                                              CLE134
      *                                                                                     AR574425
     C                     ENDDO                                                            AR574425
      *****************************************************************              AR574425 CLE164
      ***Delete*records*from*LEACCNPD**********************************              AR574425 CLE164
      *****************************************************************              AR574425 CLE164
     C**********           MOVE *OFF      *IN88                                      AR574425 CLE164
      *****************************************************************              AR574425 CLE164
     C********** ZLEACC    SETLLLEACCNL6                                             AR574425 CLE164
      *****************************************************************              AR574425 CLE164
     C********** *IN88     DOWEQ*OFF                                                 AR574425 CLE164
     C********** ZLEACC    READELEACCNL6                 88                          AR574425 CLE164
     C********** *IN88     IFEQ *OFF                                                 AR574425 CLE164
     C**********           DELETLEACCND0                                             AR574425 CLE164
     C**********           ENDIF                                                     AR574425 CLE164
      *****************************************************************              AR574425 CLE164
     C**********           ENDDO                                                     AR574425 CLE164
     C                     MOVE *OFF      *IN88                                               CLE164
     C           KLEFEZ    SETLLLEFEEZI0                                                      CLE164
      *                                                                                       CLE164
     C           *IN88     DOWEQ*OFF                                                          CLE164
     C           KLEFEZ    READELEFEEZI0                 88                                   CLE164
     C           *IN88     IFEQ *OFF                                                          CLE164
     C                     DELETLEFEEZD0                                                      CLE164
     C                     ENDIF                                                              CLE164
      *                                                                                       CLE164
     C                     ENDDO                                                              CLE164
      *                                                                                       CLE164
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
      *                                                                                       260345
     C/COPY WNCPYSRC,LER130CCP3                                           S01408
     C           FECAPI    IFEQ 'Y'                                                        AR750543A
     C                     ADD  1         CPDEL                                            AR750543A
     C                     ELSE                                                            AR750543A
     C                     ADD  1         WNDEL
     C                     ENDIF                                                           AR750543A
      *                                                                                       231710
     C                     ENDIF                                                              231710
      *
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
     C                     MOVE FELOAN    PLNRF                                               CLE034
     C                     MOVE FECNUM    PCNUM                                               CLE034
     C                     MOVE FEFACL    PFACL                                               CLE034
     C                     MOVE FEFSEQ    PFSEQ                                               CLE034
     C                     MOVEASTAMP,1   PTMST                                               CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSTALU0'                                                    CLE034
     C                     PARM *BLANKS   PRTCD                                               CLE034
     C                     PARM 'FEES'    PTYPE                                               CLE034
     C                     PARM 'D'       PACTN                                               CLE034
     C                     PARM           PLNRF                                               CLE034
     C                     PARM *BLANKS   PLAVD                                               CLE034
     C                     PARM *BLANKS   PLASQ                                               CLE034
     C                     PARM           PCNUM                                               CLE034
     C                     PARM           PFACL                                               CLE034
     C                     PARM           PFSEQ                                               CLE034
     C                     PARM           PTMST                                               CLE034
     C                     PARM *BLANKS   PPCRF                                               CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      * Drop all related Fee Allocation records from LEFEALPD                                 CLE106
      *                                                                                       CLE106
     C           CLE106    IFEQ 'Y'                                                           CLE106
     C           *LOVAL    SETLLLEFEALP0                                                      CLE106
     C           *IN18     DOUEQ*ON                                                           CLE106
     C           PCRF      DELETLEFEALP0             18                                       CLE106
     C                     ENDDO                                                              CLE106
     C                     ENDIF                                                              CLE106
      *                                                                                       CLE106
     C/COPY WNCPYSRC,LER130C004
      *                                                                                     AR785482
     C                     ENDIF                                                            AR785482
      *                                                                                     AR785482
     C                     ENDSR
      *****************************************************************                       CLE034
     C/TITLE SR/SRFHST                                                                        CLE034
      ********************************************************************                    CLE034
      *                                                                                       CLE034
      *  SRFHST -  WRITE DETAILS TO FEE HISTORY RECORD                                        CLE034
      *                                                                                       CLE034
      *  CALLED FROM: DETAIL                                                                  CLE034
      *                                                                                       CLE034
      *  CALLS: NOTHING                                                                       CLE034
      *                                                                                       CLE034
      ********************************************************************                    CLE034
      *                                                                                       CLE034
     C           SRFHST    BEGSR                                                              CLE034
      *                                                                                       CLE034
      ** write details to fee history file                                                    CLE034
      *                                                                                       CLE034
     C           FEPYON    IFEQ 'N'                                                           CLE034
     C                     MOVE FERECI    HIRECI                                              CLE034
     C                     MOVE FEBRCA    HIBRCA                                              CLE034
     C                     MOVE FECNUM    HICNUM                                              CLE034
     C                     MOVE FEFACL    HIFACL                                              CLE034
     C                     MOVE FELOAN    HILNRF                                              CLE034
     C                     MOVE FEFSEQ    HIFSEQ                                              CLE034
     C                     MOVE FEFCOD    HIFCOD                                              CLE034
     C                     MOVE FEFCCY    HIFCCY                                              CLE034
     C                     Z-ADDFEAMTS    HIAMTS                                              CLE034
     C           FELPDT    IFNE 0                                                             CLE034
     C                     Z-ADDFELPDT    HIHDAT                          133518              CLE034
     C                     ELSE                                                               CLE034
     C                     Z-ADDFESDAT    HIHDAT                          133518              CLE034
     C                     ENDIF                                                              CLE034
     C                     Z-ADDBJRDNB    HILCHD                                              CLE034
     C                     MOVE 'I'       HILCHT                                              CLE034
     C                     ADD  1         HIRECS                                              CLE034
     C                     WRITELEFHSTF                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDSR                                                              CLE034
     C/COPY WNCPYSRC,LEH00552
      *****************************************************************                       CLE034
     C/TITLE SR/SR34A                                                                         CLE034
      *****************************************************************                       CLE034
      *                                                               *                       CLE034
      *  SR34A - Initial Setup for CLE034 Processing                  *                       CLE034
      *                                                               *                       CLE034
      *****************************************************************                       CLE034
      *                                                                                       CLE034
     C           SR34A     BEGSR                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE LKEAMT    WSAMT                                               CLE034
      *                                                                                       CLE034
     C           PTFI      IFEQ *BLANKS                                                       CLE034
     C                     MOVE 'R'       WKPREC  1                                           CLE034
     C                     ELSE                                                               CLE034
     C           PTFI      IFEQ 'P'                                                           CLE034
     C           PTFI      OREQ 'S'                                                           CLE106
     C           PTFI      OREQ 'R'                                                           CLE106
     C                     MOVE 'P'       WKPREC                                              CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     Z-ADD0         TOTAMT                                              CLE034
     C                     Z-ADD0         WKAMT                                               CLE034
     C                     MOVE *BLANKS   WKFLD                                               CLE034
      *                                                                                       CLE034
     C                     MOVE OSDB      WSOSDB                                              CLE034
     C                     MOVE OMDB      WSOMDB                                              CLE034
     C                     MOVE FEOURS    WSOURS                                              CLE034
     C                     MOVE FESTTL    WSSTTL                                              CLE034
     C                     MOVE FEOSBR    WSOSBR                                              CLE034
     C                     MOVE PSTM      WSPSTM                                              CLE034
     C                     MOVE PONS      WSPONS                                              CLE034
     C                     MOVE RSTM      WSRSTM                                              CLE034
     C                     MOVE RONS      WSRONS                                              CLE034
     C                     MOVE FESCCY    WSSCCY                                              CLE034
     C                     MOVE FEPSCY    WSPSCY                                              CLE034
     C                     MOVE FEREXR    WSREXR                                              CLE034
     C                     MOVE FEREXI    WSREXI                                              CLE034
     C                     MOVE FEPEXR    WSPEXR                                              CLE034
     C                     MOVE FEPEXI    WSPEXI                                              CLE034
      *                                                                                       CLE034
     C                     MOVE FELOAN    PLNRF                                               CLE034
     C                     MOVE FECNUM    PCNUM                                               CLE034
     C                     MOVE FEFACL    PFACL                                               CLE034
     C                     MOVE FEFSEQ    PFSEQ                                               CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSTALR2'                                                    CLE034
     C                     PARM *BLANKS   PRTCD   7                                           CLE034
     C                     PARM '*FIRST ' POPTN   7                                           CLE034
     C                     PARM 'FEES'    PTYPE                                               CLE034
     C                     PARM           PLNRF                                               CLE034
     C                     PARM *BLANKS   PLAVD                                               CLE034
     C                     PARM *BLANKS   PLASQ                                               CLE034
     C                     PARM           PCNUM                                               CLE034
     C                     PARM           PFACL                                               CLE034
     C                     PARM           PFSEQ                                               CLE034
     C                     PARM           WKPREC                                              CLE034
     C           LESTAL    PARM *BLANKS   DSSDY                                               CLE034
      *                                                                                       CLE034
     C           PRTCD     IFNE *BLANKS                                                       CLE034
     C           *LOCK     IN   LDA                                                           CLE034
     C                     MOVEL'LER130  'DBPGM                                               CLE034
     C                     MOVEL'AOSTALR2'DBFILE                                              CLE034
     C                     Z-ADD23        DBASE                                               CLE034
     C                     MOVELPOPTN     DBKEY                                               CLE034
     C                     OUT  LDA                                                           CLE034
     C                     EXSR *PSSR                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDSR                                                              CLE034
      *                                                                                       CLE034
      *****************************************************************                       CLE034
     C/TITLE SR/SR34B                                                                         CLE034
      *****************************************************************                       CLE034
      *                                                               *                       CLE034
      *  SR34B - Processing to Calculate Amount for Sett. Allocation  *                       CLE034
      *                                                               *                       CLE034
      *****************************************************************                       CLE034
      *                                                                                       CLE034
     C           SR34B     BEGSR                                                              CLE034
      *                                                                                       CLE034
     C           WKPREC    IFEQ 'P'                                                           CLE034
     C           WSAMT     MULT PYPC      WKAMT                                               CLE034
     C***********          DIV  100       WKAMT     H                                         CLE034
     C                     DIV  100       WKAMT     H                                         CLE034
     C                     ELSE                                                               CLE034
     C           WSAMT     MULT RCPC      WKAMT                                               CLE034
     C***********          DIV  100       WKAMT     H                                         CLE034
     C                     DIV  100       WKAMT     H                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ADD  WKAMT     TOTAMT                                              CLE034
      *                                                                                       CLE034
     C           WKFLD     IFEQ 'Y'                                                           CLE034
     C           TOTAMT    ANDNEWSAMT                                                         CLE034
     C           WSAMT     SUB  TOTAMT    WDIFF  130                                          CLE034
     C                     ADD  WDIFF     WKAMT                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     Z-ADDWKAMT     LKEAMT                                              CLE034
     C                     EXSR SR34D                                                         CLE034
      *                                                                                       CLE034
     C                     ENDSR                                                              CLE034
      *                                                                                       CLE034
      *****************************************************************                       CLE034
     C/TITLE SR/SR34C                                                                         CLE034
      *****************************************************************                       CLE034
      *                                                               *                       CLE034
      *  SR34C - Processing to Get Next Settlement Allocation         *                       CLE034
      *                                                               *                       CLE034
      *****************************************************************                       CLE034
      *                                                                                       CLE034
     C           SR34C     BEGSR                                                              CLE034
      *                                                                                       CLE034
     C           WKFLD     IFEQ 'Y'                                                           CLE034
     C                     MOVE *BLANKS   WKFLD                                               CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C                     MOVE FELOAN    PLNRF                                               CLE034
     C                     MOVE FECNUM    PCNUM                                               CLE034
     C                     MOVE FEFACL    PFACL                                               CLE034
     C                     MOVE FEFSEQ    PFSEQ                                               CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSTALR2'                                                    CLE034
     C                     PARM *BLANKS   PRTCD                                               CLE034
     C                     PARM '*NEXT  ' POPTN                                               CLE034
     C                     PARM 'FEES'    PTYPE                                               CLE034
     C                     PARM           PLNRF                                               CLE034
     C                     PARM *BLANKS   PLAVD                                               CLE034
     C                     PARM *BLANKS   PLASQ                                               CLE034
     C                     PARM           PCNUM                                               CLE034
     C                     PARM           PFACL                                               CLE034
     C                     PARM           PFSEQ                                               CLE034
     C                     PARM           WKPREC                                              CLE034
     C           LESTAL    PARM *BLANKS   DSSDY                                               CLE034
      *                                                                                       CLE034
     C           PRTCD     IFEQ '*EOF   '                                                     CLE034
     C                     MOVE 'Y'       WKFLD                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDSR                                                              CLE034
      *                                                                                       CLE034
      *****************************************************************                       CLE034
     C/TITLE SR/SR34D                                                                         CLE034
      *****************************************************************                       CLE034
      *                                                               *                       CLE034
      *  SR34D - Setup Fields from Settlement Allocation              *                       CLE034
      *                                                               *                       CLE034
      *****************************************************************                       CLE034
      *                                                                                       CLE034
     C           SR34D     BEGSR                                                              CLE034
      *                                                                                       CLE034
     C           WKPREC    IFEQ 'P'                                                           CLE034
     C                     MOVE STPSTM    FESTTL                                              CLE034
     C                     MOVE STPONS    FEOURS                                              CLE034
     C                     MOVE STPOBR    FEOSBR                                              CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE STRSTM    FESTTL                                              CLE034
     C                     MOVE STRONS    FEOURS                                              CLE034
     C                     MOVE STROBR    FEOSBR                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE STRSTM    RSTM                                                CLE034
     C                     MOVE STRONS    RONS                                                CLE034
     C                     MOVE STPSTM    PSTM                                                CLE034
     C                     MOVE STPONS    PONS                                                CLE034
     C                     MOVE STREXR    FEREXR                                              CLE034
     C                     MOVE STREXI    FEREXI                                              CLE034
     C                     MOVE STPEXR    FEPEXR                                              CLE034
     C                     MOVE STPEXI    FEPEXI                                              CLE034
     C                     MOVE STPSCY    FEPSCY                                              CLE034
     C                     MOVE RSCY      FESCCY                                              CLE034
      *                                                                                       CLE034
     C           CEU004    IFEQ 'Y'                                                           CLE034
     C           RSCY      ANDNE*BLANKS                                                       CLE034
     C                     MOVE RSCY      LKSCCY                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDSR                                                              CLE034
      *                                                                                       CLE034
      *****************************************************************                       CLE034
     C/TITLE SR/SR34E                                                                         CLE034
      *****************************************************************                       CLE034
      *                                                               *                       CLE034
      *  SR34E - Restore Original Fields                              *                       CLE034
      *                                                               *                       CLE034
      *****************************************************************                       CLE034
      *                                                                                       CLE034
     C           SR34E     BEGSR                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE WSAMT     LKEAMT                                              CLE034
     C                     MOVE WSOSDB    OSDB                                                CLE034
     C                     MOVE WSOMDB    OMDB                                                CLE034
     C                     MOVE WSPSTM    PSTM                                                CLE034
     C                     MOVE WSPONS    PONS                                                CLE034
     C                     MOVE WSRSTM    RSTM                                                CLE034
     C                     MOVE WSRONS    RONS                                                CLE034
     C                     MOVE WSOURS    FEOURS                                              CLE034
     C                     MOVE WSSTTL    FESTTL                                              CLE034
     C                     MOVE WSOSBR    FEOSBR                                              CLE034
     C                     MOVE WSSCCY    FESCCY                                              CLE034
     C                     MOVE WSPSCY    FEPSCY                                              CLE034
     C                     MOVE WSREXR    FEREXR                                              CLE034
     C                     MOVE WSREXI    FEREXI                                              CLE034
     C                     MOVE WSPEXR    FEPEXR                                              CLE034
     C                     MOVE WSPEXI    FEPEXI                                              CLE034
      *                                                                                       CLE034
     C                     ENDSR                                                              CLE034
      *                                                                                       CLE034
      *****************************************************************                       CSW208
     C/TITLE SR/ADDFLD                                                                        CSW208
      ********************************************************************                    CSW208
      *                                                                                       CSW208
      *  ADDFLD -  Populate new fields on history file LEFHST.                                CSW208
      *            These are part of SWIFT 2008 Changes.                                      CSW208
      *                                                                                       CSW208
      *  CALLED FROM: SR/REMOVE                                                               CSW208
      *                                                                                       CSW208
      *  CALLS: NOTHING                                                                       CSW208
      *                                                                                       CSW208
      ********************************************************************                    CSW208
      *                                                                                       CSW208
     C           ADDFLD    BEGSR                                                              CSW208
      *                                                                                       CSW208
     C           CSW208    IFEQ 'Y'                                                           CSW208
      *                                                                                       CSW208
      ** Populate additional fields on history file if CSW208 is switched ON                  CSW208
      *                                                                                       CSW208
     C                     MOVE OSDB      HIOSDB                                              CSW208
     C                     MOVE OMDB      HIOMDB                                              CSW208
     C                     Z-ADDRSTM      HIRSTM                                              CSW208
     C                     MOVE RONS      HIRONS                                              CSW208
     C                     MOVE RIBN      HIRIBN                                              CSW208
     C                     MOVE RIBA      HIRIBA                                              CSW208
     C**********           MOVE *ZERO     ROBN                                       CSW208 MD025212
     C                     MOVE *BLANK    ROBN                                              MD025212
     C                     MOVE ROBN      HIROBN                                              CSW208
     C                     MOVE *ZERO     ROCN                                                CSW208
     C                     MOVE ROCN      HIROCN                                              CSW208
     C                     Z-ADDPSTM      HIPSTM                                              CSW208
     C                     MOVE PONS      HIPONS                                              CSW208
     C                     MOVE PIBN      HIPIBN                                              CSW208
     C                     MOVE PIBA      HIPIBA                                              CSW208
     C                     MOVE *ZERO     POBN                                                CSW208
     C                     MOVE POBN      HIPOBN                                              CSW208
     C                     MOVE *ZERO     POCN                                                CSW208
     C                     MOVE POCN      HIPOCN                                              CSW208
     C                     MOVE RCRN      HIRCRN                                              CSW208
     C                     MOVE RCRA      HIRCRA                                              CSW208
     C                     MOVE RVNO      HIRVNO                                              CSW208
     C                     MOVE AWBN      HIAWBN                                              CSW208
     C                     MOVE AWBA      HIAWBA                                              CSW208
     C                     MOVE BENN      HIBENN                                              CSW208
     C                     MOVE BENA      HIBENA                                              CSW208
     C                     MOVE DTP1      HIDTP1                                              CSW208
     C                     MOVE DTP2      HIDTP2                                              CSW208
     C                     MOVE DTP3      HIDTP3                                              CSW208
     C                     MOVE DTP4      HIDTP4                                              CSW208
     C                     MOVE DCHG      HIDCHG                                              CSW208
     C                     MOVE BTB1      HIBTB1                                              CSW208
     C                     MOVE BTB2      HIBTB2                                              CSW208
     C                     MOVE BTB3      HIBTB3                                              CSW208
     C                     MOVE BTB4      HIBTB4                                              CSW208
     C                     MOVE BTB5      HIBTB5                                              CSW208
     C                     MOVE BTB6      HIBTB6                                              CSW208
     C                     MOVE CVMR      HICVMR                                              CSW208
     C                     MOVE FESCCY    HIFSCY                                              CSW208
     C                     MOVE FEICCY    HIFICY                                              CSW208
     C                     MOVE FESCCY    HIPSCY                                              CSW208
     C*                                                                                       CSW208
     C                     ENDIF                                                              CSW208
     C*                                                                                       CSW208
     C                     ENDSR                                                              CSW208
      *****************************************************************
     C/TITLE SR/ACCRUE
      ********************************************************************
      *
      *  ACCRUE - PERFORM ACCRUAL PROCESSING
      *
      *  CALLED FROM:  DETAIL, REVERS
      *
      *  CALLS: *PSSR, OPNFIL, UPDAT
      *
      ********************************************************************
      *
     C           ACCRUE    BEGSR
      *
      ** Reversal indicator is on
     C           LKREVI    IFEQ 1
      *
      ** Set up account key amount
     C*                                                                   BH3463
     C**********           Z-ADDFEADAT    LKEAMT                          BH3463
     C                     Z-ADDFELPAM    LKEAMT                          BH3463
      *                                                                   155277
      ** if Fee has been suspended, the suspended amount must be                              CLE134
      ** reversed out                                                                         CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FEFSFA    ANDEQ'Y'                                                           CLE134
     C           FESFA     ANDGT0                                                             CLE134
     C                     ADD  FESFA     LKEAMT                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
      ** Store value of fee amount so that correct amount is reversed     155277
      ** out of profitablity reports.                                     155277
      *                                                                   155277
     C                     Z-ADDFELPAM    DAYACR                          155277
      *                                                                   155277
     C           FECALT    IFNE *BLANKS                                   BH3463
     C                     ADD  FEAMTP    LKEAMT                          BH3463
      *                                                                                     AR737558
      ** If Auto-settle Calculated Loan Fee                                                 AR737558
      *                                                                                     AR737558
     C                     MOVE FEAUTO    WFEAUT                                            AR737558
     C           CLE134    IFEQ 'Y'                                                         AR737558
     C           FEAUTO    IFEQ 'C'                                                         AR737558
     C           FEAUT2    OREQ 'C'                                                         AR737558
     C                     MOVE 'Y'       WFEAUT  1                                         AR737558
     C                     ENDIF                                                            AR737558
     C                     ENDIF                                                            AR737558
      *                                                                                     AR737558
     C           FELOAN    IFNE *BLANKS                                                     AR737558
     C           WFEAUT    ANDEQ'Y'                                                         AR737558
      *                                                                                     AR737558
      ** FELPAM should be zero on Payment Date, reverse above ADD in FELPAM                 AR737558
      *                                                                                     AR737558
     C           FELPDT    IFEQ BJRDNB                                                      AR737558
     C                     SUB  FELPAM    LKEAMT                                            AR737558
     C                     ENDIF                                                            AR737558
      *                                                                                     AR737558
     C                     ENDIF                                                            AR737558
     C*                                                                   052155
     C* Add in the adjustment amount                                      052155
     C*                                                                   052155
     C                     ADD  FEAMTA    LKEAMT                          052155
     C                     Z-ADD0         FEAMTA                          052155
     C                     Z-ADD0         FEAMTP                          BH3463
     C                     END                                            BH3463
     C                     Z-ADD0         FEADAT
     C                     Z-ADD0         FELPAM                          BH3463
     C*                                                                   BH3463
     C                     ELSE
      *
      ** It is not a reversed record setup amount
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           CAS009    OREQ 'Y'                                                           CAS009
     C/COPY WNCPYSRC,LEH01147
     C                     Z-ADDFENPYD    WRKEND  50                                          CLE031
     C           FENPYD    IFEQ 0                                                             CLE031
     C                     Z-ADDFEPEND    WRKEND                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     Z-ADDFELPDT    WRKSTR  50                                          CLE031
     C           FELPDT    IFEQ 0                                                             CLE031
     C                     Z-ADDFEPSTD    WRKSTR                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           FEPEND    IFLE WAPDAT
     C           CLE031    ANDNE'Y'                                                           CLE031
     C/COPY WNCPYSRC,LEH01148
     C           FEPEND    ORLE WAPDAT                                                        CAS009
     C           CAS009    ANDNE'Y'                                                           CAS009
     C/COPY WNCPYSRC,LEH01149
     C           FEPEND    ORLE WAPDAT                                                        CLE031
     C           CLE031    ANDEQ'Y'                                                           CLE031
     C           BKALDI    ANDNE'Y'                                                           CLE031
     C           FEPEND    ORLE WAPDAT                                                        CAS009
     C           CAS009    ANDEQ'Y'                                                           CAS009
     C           BKALDI    ANDNE'Y'                                                           CAS009
     C/COPY WNCPYSRC,LEH01150
      *                                                                                       CLE031
     C***********FEFAMT    SUB  FEADAT    LKEAMT                          BH3467
     C                     Z-ADDFEFAMT    FEADAT
      *                                                                   154959
      ** Store value of fee amount so that correct amount is shown        154959
      ** on profitablity reports.                                         154959
      *                                                                   154959
     C                     Z-ADDFEFAMT    DAYACR                          154959
      *                                                                   156673
      ** Subtract fee amount accrued to date from day accrual figure      156673
      *                                                                   156673
     C           DAYACR    SUB  FEADAT    DAYACR                          156673
      *                                                                   154959
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           CAS009    OREQ 'Y'                                                           CAS009
     C                     ADD  FEADAT    FEADBP                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ELSE
     C           FEPEND    SUB  FEPSTD    WNODAY  50
     C           WAPDAT    SUB  FEPSTD    WACTDY  50
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           FEPYON    ANDEQ'N'                                                           CLE031
     C           WRKEND    SUB  WRKSTR    WNODAY                                              CLE031
     C           WAPDAT    SUB  WRKSTR    WACTDY                                              CLE031
     C                     ENDIF                                                              CLE031
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C           FEPYON    ANDEQ'N'                                                           CAS009
     C/COPY WNCPYSRC,LEH01151
     C                     Z-ADDWRKSTR    ZZBEG                                               CAS009
     C                     Z-ADDWRKEND    ZZEND                                               CAS009
     C                     EXSR ZINTDY                                                        CAS009
     C                     Z-ADDZZINDY    WNODAY                                              CAS009
     C/COPY WNCPYSRC,LEH01152
      *                                                                                       CAS009
     C                     Z-ADDWRKSTR    ZZBEG                                               CAS009
     C                     Z-ADDWAPDAT    ZZEND                                               CAS009
     C                     EXSR ZINTDY                                                        CAS009
     C                     Z-ADDZZINDY    WACTDY                                              CAS009
     C                     ENDIF                                                              CAS009
      *
      ** Check the last day accrual indicator on SDGELRPD before
      ** adding one to days.  If first day accrual increment number
      ** of days only if the fee period end is greater than the
      ** accural/profit date and fee period start date is less than
      ** or equal to the accrual/profit date and the last accrual
      ** profit date is zero.
     C           BKALDI    IFNE 'Y'
     C           FEPEND    ANDGTWAPDAT
     C           FEPSTD    ANDLEWAPDAT
     C           FELADT    ANDEQ0
     C           CLE031    ANDNE'Y'                                                           CLE031
     C/COPY WNCPYSRC,LEH01153
     C********** FELADT    OREQ 0                                                      CAS009 240672
     C           CAS009    ANDNE'Y'                                                           CAS009
     C/COPY WNCPYSRC,LEH01154
      *
      ** If last day accruals then fee period end date must be equal
      ** to accrual/profit date
     C           BKALDI    OREQ 'Y'
     C           FEPEND    ANDEQWAPDAT
     C           CLE031    ANDNE'Y'                                                           CLE031
     C/COPY WNCPYSRC,LEH01155
      *                                                                                       CLE031
     C           BKALDI    OREQ 'Y'                                                           CAS009
     C           FEPEND    ANDEQWAPDAT                                                        CAS009
     C           CAS009    ANDNE'Y'                                                           CAS009
     C/COPY WNCPYSRC,LEH01156
      *                                                                                       CAS009
     C           BKALDI    ORNE 'Y'                                                           CLE031
     C           WRKEND    ANDGTWAPDAT                                                        CLE031
     C           WRKSTR    ANDLEWAPDAT                                                        CLE031
     C           FELADT    ANDEQ0                                                             CLE031
     C           CLE031    ANDEQ'Y'                                                           CLE031
      *                                                                                       CLE031
     C           BKALDI    ORNE 'Y'                                                           CAS009
     C           WRKEND    ANDGTWAPDAT                                                        CAS009
     C           WRKSTR    ANDLEWAPDAT                                                        CAS009
     C           FELADT    ANDEQ0                                                             CAS009
     C           CAS009    ANDEQ'Y'                                                           CAS009
      *                                                                                       CAS009
     C/COPY WNCPYSRC,LEH01157
     C           BKALDI    OREQ 'Y'                                                           CLE031
     C           WRKEND    ANDEQWAPDAT                                                        CLE031
     C           CLE031    ANDEQ'Y'                                                           CLE031
      *                                                                                       CLE031
     C           BKALDI    OREQ 'Y'                                                           CAS009
     C           WRKEND    ANDEQWAPDAT                                                        CAS009
     C           CAS009    ANDEQ'Y'                                                           CAS009
      *                                                                                       CAS009
     C/COPY WNCPYSRC,LEH01158
     C                     ADD  1         WACTDY
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           WACTDY    ANDGTWNODAY                                                        CLE031
     C           CAS009    OREQ 'Y'                                                           CAS009
     C           WACTDY    ANDGTWNODAY                                                        CAS009
     C/COPY WNCPYSRC,LEH01159
     C                     EXSR SETDAT                                                        CLE031
      *                                                                                       CLE031
     C                     Z-ADDNWNPYD    WRKEND                                              CLE031
     C           NWNPYD    IFEQ 0                                                             CLE031
     C                     Z-ADDFEPEND    WRKEND                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     Z-ADDFENPYD    WRKSTR                                              CLE031
     C           FENPYD    IFEQ 0                                                             CLE031
     C                     Z-ADDFEPSTD    WRKSTR                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C/COPY WNCPYSRC,LEH01160
     C                     ADD  FEADAT    FEADBP                                              CLE031
     C                     Z-ADD0         FEADAT                                              CLE031
     C/COPY WNCPYSRC,LEH01161
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     END
     C********** FEFAMT    DIV  WNODAY    WWORK  152H                     184594
     C           FEFAMT    DIV  WNODAY    WWORK  229H                     184594
     C**********           Z-ADDWWORK     WWORK2 152H              142402 184594
     C                     Z-ADDWWORK     WWORK2 229H                     184594
     C           WWORK     MULT WACTDY    WWORK
     C           WWORK     SUB  FEADAT    LKEAMT    H
      *                                                                                       CLE159
     C           CLE159    IFEQ 'Y'                                                           CLE159
     C           FECALT    ANDEQ*BLANKS                                                       CLE159
     C           FELOAN    ANDEQ*BLANKS                                                       CLE159
     C                     EXSR SRAMTZ                                                        CLE159
     C                     ENDIF                                                              CLE159
      *                                                                   090939
      ** STORE VALUE OF DAILY ACCRUED FEE AMOUNT FOR LATER UPDATE TO FILE 090939
     C                     Z-ADDLKEAMT    DAYACR                          090939
      *                                                                   090939
     C                     Z-ADDFEADAT    WFEADA 130                                          259013
     C                     ADD  LKEAMT    FEADAT
      *                                                                   184594
      ** Ensure fee accrued will not exceed fee amount                    184594
      *                                                                   184594
      ** If saved fee accrued posted to date (FEADAT to WFEADA)                               259013
      ** is equal to fee amount, skip processing by fix 210148.                               259013
      *                                                                                       259013
     C           FEFAMT    IFLT 0                                                             210148
     C           FEFAMT    ANDNEWFEADA                                                        259013
      *                                                                                       210148
      ** Obtain the absolute value of FEADAT and FEFAMT to properly                           210148
      ** determine if there is an excess in computed amount and to                            210148
      ** correctly update FEADAT on file for non-calculated loans/                            210148
      ** facilities.                                                                          210148
      *                                                                                       210148
     C                     Z-SUBFEADAT    FEADT2 130                                          210148
     C                     Z-SUBFEFAMT    FEFAM2 130                                          210148
     C           FEADT2    SUB  FEFAM2    WEXCSS                                              210148
     C                     ELSE                                                               210148
      *                                                                                       210148
     C           FEADAT    SUB  FEFAMT    WEXCSS 130                      184594
     C                     ENDIF                                                              210148
      *                                                                                       210148
     C           WEXCSS    IFGT 0                                         184594
     C                     SUB  WEXCSS    FEADAT                          184594
     C                     SUB  WEXCSS    LKEAMT                          184594
     C                     END                                            184594
      *                                                                   142402
     C           FEORED    IFEQ BJRDNB                                    142402
     C           FEPSTD    ANDLTMSTD                                      142402
     C           CLE031    ANDNE'Y'                                                           CLE031
     C/COPY WNCPYSRC,LEH01162
     C           FEORED    OREQ BJRDNB                                                        CAS009
     C           FEPSTD    ANDLTMSTD                                                          CAS009
     C           CAS009    ANDNE'Y'                                                           CAS009
     C/COPY WNCPYSRC,LEH01163
     C           FEORED    OREQ BJRDNB                                                        CLE031
     C           WRKSTR    ANDLTMSTD                                                          CLE031
     C           CLE031    ANDEQ'Y'                                                           CLE031
     C           FEORED    OREQ BJRDNB                                                        CAS009
     C           WRKSTR    ANDLTMSTD                                                          CAS009
     C           CAS009    ANDEQ'Y'                                                           CAS009
     C/COPY WNCPYSRC,LEH01164
      *                                                                   142402
     C           MNTND     MULT WWORK2    WWORK2                          142402
     C           DAYACR    SUB  WWORK2    WWORK3 152H                     142402
      *                                                                   142402
     C                     ENDIF                                          142402
      *                                                                   142402
      ** If actual days equals number of days, have reached end of                            CLE031
      ** period. Reset FEADAT so next period is calculated correctly.                         CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           WACTDY    ANDEQWNODAY                                                        CLE031
     C           CAS009    OREQ 'Y'                                                           CAS009
     C           WACTDY    ANDEQWNODAY                                                        CAS009
     C/COPY WNCPYSRC,LEH01165
     C                     ADD  FEADAT    FEADBP                                              CLE031
     C/COPY WNCPYSRC,LEH01166
     C                     Z-ADD0         FEADAT                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     END
     C                     END
      *
      ** If fee is based on a loan
     C********** FELOAN    IFGT 0                                                             CLE148
     C           FELOAN    IFGT *BLANKS                                                       CLE148
     C           FELOAN    ANDNE'000000'                                                      CLE134
      *
      ** Get loan details
      *
      * Access to CLOAN should not be conditioned by anything other       E25573
      * than the fee being a loan based fee.                              E25573
      *                                                                   E25573
     C***********FELTYP    IFEQ '  '
     C*                                                                     0103
     C** Access to CLOAN not required if fee being reversed                 0103
     C*                                                                     0103
     C** Need CLOAN for account sequence, reversal too.                                     MD045509
     C********** LKREVI    IFNE 1                                                      0103 MD045509
     C           WLNKEY    CHAINCLOAN                15
      *                                                                                       260961
      ** Check if record is existing in matured loans file before                             260961
      ** issuing a database error.                                                            260961
      *                                                                                       260961
     C           *IN15     IFEQ '1'                                                           260961
     C           WLNKEY    CHAINMCLONCLF             15                                       260961
     C                     ENDIF                                                              260961
      *****************************************************************              260961 MD049826
      ***Check*if*record*is*existing*in*reversed*loans*file*before*****              260961 MD049826
      ***issuing*a*database*error.*************************************              260961 MD049826
      *****************************************************************              260961 MD049826
     C********** *IN15     IFEQ '1'                                                  260961 MD049826
     C********** FELOAN    CHAINRVLNSL0              15                              260961 MD049826
     C**********           ENDIF                                                     260961 MD049826
      *                                                                                       260961
     C           *IN15     IFEQ '1'                                                           260961
     C           FELOAN    CHAINCLOANPE              15                                       260961
     C                     ENDIF                                                              260961
      *
      ** Database error
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVELFELOAN    DBKEY            ************
     C                     MOVEL'001'     DBASE            * DBERR 01 *
     C                     MOVEL'CLOAN'   DBFILE           ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ELSE
     C                     MOVE LTYP      FELTYP
     C**********           MOVE SUTP      FESUTP                                            AR317401
     C                     MOVE CLAS      FECLAS                                              CLE042
     C                     END
     C**********           END                                                         0103 MD045509
     C***********          END                                            E25573
      *
     C                     MOVE '1'       *IN34
     C*********************MOVE 'D'       LKRECI                           00106
     C**********           MOVE 'F'       LKRECI                    00106 057249
     C                     MOVE 'L'       LKRECI                          057249
     C**********           Z-ADDFELOAN    LKLNNO                                              CLE148
     C                     MOVELFELOAN    LKLNNO                                              CLE148
     C                     MOVE 'A'       AKY,3
     C                     MOVEAFELTYP    AKY,1
     C                     MOVEAFESUTP    AKY,4
     C                     MOVEAFECLAS    AKY,11                                              CLE042
      *                                                                   E30393
      ** POS. 7 RECOURSE IND. (R = WITH RECOURSE)                         E30393
      *                                                                   E30393
     C*********************MOVEARCSI      AKY,7                           E30393
     C           RCSI      IFEQ 'R'                                       E30393
     C           RCSI      OREQ 'Y'                                       E30393
     C                     MOVE 'R'       AKY,7                           E30393
     C                     ELSE                                           E30393
     C                     MOVE ' '       AKY,7                           E30393
     C                     END                                            E30393
     C*                                                                   E30393
     C                     MOVEAWFCOD     AKY,8
     C                     MOVE 'F'       AKY,10
     C                     MOVE ' '       AKY,6
      *
     C           FEPYON    IFEQ 'S'
     C                     MOVE 'S'       AKY,6
     C                     END
      *
     C                     MOVEAAKY       LKAKEY
     C**********           Z-ADDOLNO      LKOLNO                                       243499 CPK027
     C                     MOVE OLNO      LKOLNO                                              CPK027
      *
     C                     ELSE
      *
      ** If not loan based fee must be facility type
      *                                                                                     AR800866
     C                     EXSR SRFCTY                                                      AR800866
      *                                                                                     AR800866
     C                     MOVE '0'       *IN34
     C                     MOVE 'F'       LKRECI
     C**********           Z-ADDFEFACL    LKLNNO                                              CLE148
     C                     MOVEL*BLANKS   LKLNNO                                              CLE148
     C                     MOVE FEFACL    LKLNNO                                              CLE148
     C                     MOVE 'A'       AKY,4
     C                     MOVELFEFACL    WFACT
     C                     MOVEAWFACT     AKY,1
     C                     MOVEAWFCOD     AKY,8
     C                     MOVE 'F'       AKY,10
     C                     MOVEA'   '     AKY,5
      *                                                                                       251069
      ** Ensure that the class code is blank for fees                                         251069
     C                     MOVEA'    '    AKY,11                                              251069
      *
     C           FEPYON    IFEQ 'S'
     C                     MOVE 'S'       AKY,6
     C                     END
     C/COPY WNCPYSRC,LEH00326
      *
     C                     MOVEAAKY       LKAKEY
     C**********           Z-ADD0         LKOLNO                                       243499 CPK027
     C                     MOVE *BLANKS   LKOLNO                                              CPK027
     C                     END
      *                                                                   CLE005
      **  Sets the value of position 7 of the Account key if CLE004       CLE005
      **  and CLE005 is switched on                                       CLE005
      *                                                                   CLE005
     C           CLE004    IFEQ 'Y'                                       CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C***********AKY,7     IFEQ 'R'                                CLE005 158197
     C***********PTFI      IFEQ 'I'                                CLE005 158197
     C***********          MOVE 'L'       AKY,7                    CLE005 158197
     C***********          ENDIF                                   CLE005 158197
     C***********PTFI      IFEQ 'P'                                CLE005 158197
     C***********          MOVE 'S'       AKY,7                    CLE005 158197
     C***********          ENDIF                                   CLE005 158197
     C***********          ELSE                                    CLE005 158197
     C           PTFI      IFEQ 'I'                                       CLE005
     C                     MOVE 'I'       AKY,7                           CLE005
     C                     ENDIF                                          CLE005
     C           PTFI      IFEQ 'P'                                       CLE005
     C           PTFI      OREQ 'S'                                                           CLE106
     C           PTFI      OREQ 'R'                                                           CLE106
     C                     MOVE 'P'       AKY,7                           CLE005
     C                     ENDIF                                          CLE005
     C***********          ENDIF                                   CLE005 158197
     C                     ENDIF                                          CLE005
     C/COPY WNCPYSRC,LEH00600
     C                     MOVEAAKY       LKAKEY                          CLE005
      *
      ** Set up fields for output
      *                                                                   179741
     C                     MOVE *BLANKS   LKSCCY                          179741
      *                                                                   179741
      ** If the settlement currency is entered and the amount is not 0    179741
      ** then output the settlement currency on the account key           179741
      * (however, if CLE033 is on, Settlement method 09 & System                              218782
      * value Set09 = 'T', then use transaction currency instead).                            218782
     C           FESTTL    IFNE 09                                                            218782
     C           CLE033    ORNE 'Y'                                                           218782
     C           SET09     ORNE 'T'                                                           218782
      *                                                                   179741
     C           CEU004    IFEQ 'Y'                        EMU ON         179741
     C           FESCCY    ANDNE'   '                      SETTLE. CCY    179741
     C           FESCCY    ANDNEFEFCCY                     CCY.           179741
     C           LKEAMT    ANDNE0                                         179741
     C                     MOVE FESCCY    LKSCCY                          179741
      *                                                                   179741
     C                     ENDIF                                          179741
     C                     ENDIF                                                              218782
      *                                                                   179741
     C**********           Z-ADDFECNUM    LKCNUM                                              CSD027
     C                     MOVE FECNUM    LKCNUM                                              CSD027
     C*********************Z-ADDLKEAMT    EAMT0                           BH3467
     C                     MOVE FEFCCY    LKECCY
     C                     MOVELFEOURS    LKOSAC
      *                                                                                       CGL020
      ** Determine AML Pay/Receive Instructions                                               CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C           FECAPI    ANDNE'Y'                                                           CLE139
     C                     EXSR SRAMLI                                                        CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     Z-ADDFESTTL    LKSETP
     C                     Z-ADDWAPDAT    LKEDAT
      *                                                                   100817
      * Setup start date or last interest date variable (LKSLID).         100817
      *                                                                   100817
     C                     Z-ADDFEPSTD    LKSLID                          100817
      *                                                                                       CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C                     Z-ADDWRKSTR    LKSLID                                              CAS009
     C                     ENDIF                                                              CAS009
     C*                                                                   BH3534
     C** This fix should not have been applied in the accrual sub-        BH3534
     C** routine only for the settlement                                  BH3534
     C*                                                                   BH3534
     C***********FEOSBR    IFNE *BLANKS                            BH3495 BH3534
     C***********          MOVE FEOSBR    LKBRCD                   BH3495 BH3534
     C***********          ELSE                                    BH3495 BH3534
     C                     MOVE FEBRCA    LKBRCD                          BH3495
     C***********          END                                     BH3495 BH3534
     C                     MOVE *BLANKS   LKOSBR                          BH3495
      *                                                                                     AR800866
      ** LASQ is for loan fees, FCACSQ is for facility fees.                                AR800866
      *                                                                                     AR800866
     C           FELOAN    IFGT *BLANKS                                                     AR800866
     C                     Z-ADDLASQ      LKACSQ
     C                     ELSE                                                             AR800866
     C                     Z-ADDFCACSQ    LKACSQ                                            AR800866
     C                     ENDIF                                                            AR800866
      *                                                                   100817
      * Setup start date or last interest date variable (LKSLID).         100817
      *                                                                   100817
     C                     Z-ADDFEPSTD    LKSLID                          100817
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     Z-ADDWRKSTR    LKSLID                                              CLE031
     C                     ENDIF                                                              CLE031
      *
      ** Set indicator for decimal places
     C                     Z-ADD1         B       30
     C           FEFCCY    LOKUPWCYA,B                   56
     C           WDPA,B    COMP 1                    323031
     C           WDPA,B    COMP 2                    33  32
     C*                                                                   BH3467
     C** Check the posting should be made today                           BH3467
     C*                                                                   BH3467
     C           BKAPDT    IFGE BJRDNB                                    BH3467
     C           BKAPDT    ANDLTBJDNWD                                    BH3467
     C           LKREVI    OREQ 1                                         BH3463
     C*                                                                   BH3534
     C** Should generate accrual key of the fee ends today as obviously   BH3534
     C** there will not be an accrual on accrual date                     BH3534
     C*                                                                   BH3534
     C***********FEPEND    OREQ BJDNWD                             BH3534 138419
     C*                                                                   BH3534
     C***********FEPEND    ORLT BJDNWD                             BH3534 138419
     C***********FEORED    ANDEQBJDNWD                             BH3534 138419
     C           FEPEND    ORLT BJDNWD                                    138419
     C           CLE031    ANDNE'Y'                                                           CLE031
     C/COPY WNCPYSRC,LEH01167
     C           FEPEND    ORLT BJDNWD                                                        CAS009
     C           CAS009    ANDNE'Y'                                                           CAS009
     C/COPY WNCPYSRC,LEH01168
     C           WRKEND    ORLT BJDNWD                                                        CLE031
     C           CLE031    ANDEQ'Y'                                                           CLE031
     C           WRKEND    ORLT BJDNWD                                                        CAS009
     C           CAS009    ANDEQ'Y'                                                           CAS009
     C/COPY WNCPYSRC,LEH01169
     C*                                                                   BH3463
     C*                                                                   BH3467
     C** Set up the amount to be posted                                   BH3467
     C*                                                                   BH3467
     C           LKREVI    IFNE 1                                         BH3463
     C/COPY WNCPYSRC,LEH01170
     C           FEADAT    SUB  FELPAM    LKEAMT                          BH3467
     C/COPY WNCPYSRC,LEH01173
      *                                                                                       262298
     C           BKALDI    IFNE 'Y'                                                           262298
     C           FEPEND    ANDGTWAPDAT                                                        262298
     C           FEPSTD    ANDLEWAPDAT                                                        262298
     C           FELADT    ANDEQ0                                                             262298
     C           CAS009    ANDNE'Y'                                                           262298
     C           CLE031    ANDNE'Y'                                                           262298
      *                                                                                       262298
     C           BKALDI    OREQ 'Y'                                                           262298
     C           FEPEND    ANDEQWAPDAT                                                        262298
     C           CAS009    ANDNE'Y'                                                           262298
     C           CLE031    ANDNE'Y'                                                           262298
      *                                                                                       262298
     C           BKALDI    ORNE 'Y'                                                           262298
     C           WRKEND    ANDGTWAPDAT                                                        262298
     C           WRKSTR    ANDLEWAPDAT                                                        262298
     C           FELADT    ANDEQ0                                                             262298
     C           CAS009    ANDEQ'Y'                                                           262298
      *                                                                                       262298
     C           BKALDI    ORNE 'Y'                                                           262298
     C           WRKEND    ANDGTWAPDAT                                                        262298
     C           WRKSTR    ANDLEWAPDAT                                                        262298
     C           FELADT    ANDEQ0                                                             262298
     C           CLE031    ANDEQ'Y'                                                           262298
      *                                                                                       262298
     C           BKALDI    OREQ 'Y'                                                           262298
     C           WRKEND    ANDEQWAPDAT                                                        262298
     C           CAS009    ANDEQ'Y'                                                           262298
      *                                                                                       262298
     C           BKALDI    OREQ 'Y'                                                           262298
     C           WRKEND    ANDEQWAPDAT                                                        262298
     C           CLE031    ANDEQ'Y'                                                           262298
      *                                                                                       262298
     C           CAS009    IFEQ 'Y'                                                           262298
     C           WACTDY    ANDEQWNODAY                                                        262298
     C           CLE031    OREQ 'Y'                                                           262298
     C           WACTDY    ANDEQWNODAY                                                        262298
     C           FEADBP    SUB  FELPAM    LKEAMT                                              262298
     C                     ENDIF                                                              262298
     C                     ENDIF                                                              262298
      *                                                                                       262298
     C                     ADD  LKEAMT    FELPAM                          BH3467
     C                     END                                            BH3463
      *
     C/COPY WNCPYSRC,LEH01171
     C           LKEAMT    IFNE 0
      *                                                                                       CAS009
      ** Do not post amortisation if method is                                                CAS009
      ** Non-Linear and Fee is Adjustment to Yield                                            CAS009
      *                                                                                       CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C********** FEPYON    ANDEQ'S'                                                    CAS009 232348
     C           FEADJY    ANDEQ'Y'                                                           CAS009
     C           FSAMRM    ANDEQ'N'                                                           CAS009
     C********** Z9VDAT    ANDGEFSNLAC                                                232348 BUG9245
     C           VDAT      ANDGEFSNLAC                                                       BUG9245
     C                     ELSE
     C*                                                                   S01408
     C/COPY WNCPYSRC,LER130CPG1                                           S01408
     C*                                                                   S01408
      ** Move the Profit Centre if Profit Centres are used.                                   247979
      *                                                                                       247979
      *
     C           BGN0ST    IFEQ 'Y'                                       127966
     C           BGN0ST    OREQ 'N'                                                           247979
     C           BKPRCU    ANDEQ'Y'                                                           247979
     C           FEPRFC    ANDNE*BLANKS                                                       247979
     C                     MOVE FEPRFC    LKPRFC                          127966
     C                     ENDIF                                          127966
      *                                                                   127966
     C                     EXSR OPNFIL
      *                                                                   CLE005
      **  If CLE005 is switched on, setup settlement details.             CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
      *                                                                   CLE005
     C           CLE004    IFEQ 'N'                                       CLE005
     C           CLE004    OREQ 'Y'                                       CLE005
     C           PTFI      ANDEQ*BLANK                                    CLE005
     C                     MOVE RONS      LKOSAC                          CLE005
     C                     MOVE RSTM      LKSETP                          CLE005
      *                                                                                       CGL020
      ** Determine AML Pay/Receive Instructions                                               CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C           FECAPI    ANDNE'Y'                                                           CLE139
     C                     MOVELSTLNS2    STLNS1                                              CGL020
     C                     EXSR SRAMPR                                                        CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     ENDIF                                          CLE005
     C           CLE004    IFEQ 'Y'                                       CLE005
     C           PTFI      IFEQ 'P'                                       CLE005
     C           PTFI      OREQ 'S'                                                           CLE106
     C           PTFI      OREQ 'R'                                                           CLE106
     C                     MOVE PONS      LKOSAC                          CLE005
     C                     MOVE PSTM      LKSETP                          CLE005
      *                                                                                       CGL020
      ** Determine AML Pay/Receive Instructions                                               CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C           FECAPI    ANDNE'Y'                                                           CLE139
     C                     MOVELSTLNS2    STLNS1                                              CGL020
     C                     EXSR SRAMPR                                                        CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     ENDIF                                          CLE005
     C           PTFI      IFEQ 'I'                                       CLE005
     C                     MOVE *BLANKS   LKOSAC                          CLE005
     C                     MOVE *BLANKS   LKSETP                          CLE005
      *                                                                                       CGL020
      ** Determine AML Pay/Receive Instructions                                               CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C           FECAPI    ANDNE'Y'                                                           CLE139
     C                     MOVEL*BLANKS   STLNS1                                              CGL020
     C                     EXSR SRAMPR                                                        CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
      **********                                                                     CLE025 BUG13031
      ***If*CLE025*is*on,*adjust*event*date*of*fees*posted*today                     CLE025 BUG13031
      **********                                                                     CLE025 BUG13031
     C********** CLE025    IFEQ 'Y'                                                  CLE025 BUG13031
     C********** LKEDAT    ADD  1         WEDAT   50                                 CLE025 BUG13031
     C********** BJRDNB    ADD  1         WRDNB   50                                 CLE025 BUG13031
      **********                                                                     CLE025 BUG13031
      ***Set*event*date*to*whichever*is*later*between                                CLE025 BUG13031
      ***event*date*+*1*and*rundate*+*1                                              CLE025 BUG13031
      **********                                                                     CLE025 BUG13031
     C********** WEDAT     IFGT WRDNB                                                CLE025 BUG13031
     C**********           Z-ADDWEDAT     LKEDAT                                     CLE025 BUG13031
     C**********           ELSE                                                      CLE025 BUG13031
     C**********           Z-ADDWRDNB     LKEDAT                                     CLE025 BUG13031
     C**********           ENDIF                                                     CLE025 BUG13031
     C**********           ENDIF                                                     CLE025 BUG13031
     C           FEPEND    IFLE WAPDAT                                    248821
     C********** FEPEND    ANDLEBJRDNB                                            MD023863 MD029938A
     C                     Z-ADDBJRDNB    LKEDAT                          248821
     C                     ENDIF                                          248821
      *                                                                   CLE005
      ** Write record to account key file then report details
     C                     WRITELKEYFEDF
     C/COPY WNCPYSRC,LEH01200
      *                                                                                       CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
      *                                                                                       CAS009
     C                     MOVE 'D'       Z9KYID                                              CAS009
     C**********           Z-ADDFELOAN    Z9LNRF                                       CAS009 CLE148
     C                     MOVELFELOAN    Z9LNRF                                              CLE148
      *                                                                                       CAS009
     C           Z9KEY     CHAINZ9LNCLF              18                                       CAS009
     C           *IN18     IFEQ *OFF                                                          CAS009
     C           FECAPI    ANDNE'Y'                                                           CLE139
     C           FEFCCY    IFEQ Z9CCY                                                         CAS009
     C                     Z-ADDLKEAMT    WKAMT                                               CAS009
     C                     ELSE                                                               CAS009
     C                     Z-ADDLKEAMT    ZAMTCI                                              CAS009
     C                     EXSR CNVF2L                                                        CAS009
     C                     Z-ADDZAMTCO    WKAMT                                               CAS009
     C                     ENDIF                                                              CAS009
     C                     ADD  WKAMT     Z9CFDP                                              CAS009
     C                     UPDATZ9LNCLF                                                       CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C           FELOAN    CHAINLEEIRDD5             19                                       CAS009
     C           *IN19     IFEQ *OFF                                                          CAS009
     C                     ADD  WKAMT     EIACTD                                              CAS009
     C                     UPDATLEEIRDD5                                                      CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ADD  LKEAMT    FEAFEE                                              CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
      *
     C                     EXSR CHKCCY                                                        219275
      *                                                                                       219275
     C                     Z-ADDLKEAMT    EAMT0                           BH3467
     C                     WRITELER130D1
      * Work field for number account keys generated
     C                     ADD  1         LKNOR0
      *
      ** If overflow indictor is on output headers for new page
     C           *IN80     IFEQ '1'
     C                     WRITELER130H1
     C                     WRITELER130H2
     C                     MOVE '0'       *IN80
     C                     END
      *
      ** Details on print file indicator
     C                     MOVE '1'       *IN21
      *
     C                     Z-ADD1         Z
     C                     Z-ADD1         S
      *
      ** Calculate hash total for trailer
     C           LKEAMT    DIV  1000      ZZAMT
     C                     Z-ADDLKVLRF    ZZTOTI
     C                     Z-ADDLKVLRL    ZZTOTD
     C                     EXSR ZHASH
     C                     Z-ADDZZTOTI    LKVLRF
     C                     Z-ADDZZTOTD    LKVLRL
     C                     ENDIF                                                              CAS009
     C                     END
     C                     END                                            BH3467
      *
      * RESTORE VALUE FOR DAILY ACCRUED FEE AMOUNT                        090939
     C                     Z-ADDDAYACR    LKEAMT                          090939
      *                                                                   CLE005
      *************************************************************CLE005 141462
      ***If*CLE004*and*CLE005*is*switched on,*do not*execute*SubrouCLE005 141462
      ***UPDAT*if*Participant*fee*indicator*is*'I'*or*'P'**********CLE005 141462
      *************************************************************CLE005 141462
     C***********CLE004    IFEQ 'Y'                                CLE005 141462
     C***********CLE005    ANDEQ'Y'                                CLE005 141462
     C***********PTFI      IFEQ 'P'                                CLE005 141462
     C***********PTFI      OREQ 'I'                                CLE005 141462
     C***********          ELSE                                    CLE005 141462
     C***********          EXSR UPDAT                              CLE005 141462
     C***********          ENDIF                                   CLE005 141462
     C***********          ELSE                                    CLE005 141462
      *                                                                                       CAS009
     C********** CAS009    IFNE 'Y'                                                    CAS009 238569
     C********** CAS009    OREQ 'Y'                                                    CAS009 238569
     C********** FELOAN    ANDEQ0                                                      CAS009 238569
     C           CAS009    IFEQ 'Y'                                                           238569
     C********** FELOAN    ANDGT0                                                      238569 CLE148
     C           FELOAN    ANDGT*BLANKS                                                       CLE148
     C           FEADJY    ANDEQ'Y'                                                           238569
     C           FSAMRM    ANDEQ'N'                                                           238569
     C           VDAT      ANDGEFSNLAC                                                        238569
     C                     ELSE                                                               238569
     C                     EXSR UPDAT
     C                     ENDIF                                                              238569
     C**********           ELSE                                                        CAS009 238569
      **********                                                                       CAS009 238569
      ***Update*only*when*fee*is:                                                      CAS009 238569
      *****1)*Non-amortising*OR                                                        CAS009 238569
      *****2)*Amortising*but*not*Adjustment*to*Yield*OR                                CAS009 238569
      *****3)*Amortising,*Adjustment*to*Yield*but                                      CAS009 238569
      ********Amortisation*method*is*Non-Linear                                        CAS009 238569
      **********                                                                       CAS009 238569
     C********** FEPYON    IFNE 'S'                                                    CAS009 238569
     C********** FEPYON    OREQ 'S'                                                    CAS009 238569
     C********** FEADJY    ANDEQ'N'                                                    CAS009 238569
     C********** FEPYON    OREQ 'S'                                                    CAS009 238569
     C********** FEADJY    ANDEQ'Y'                                                    CAS009 238569
     C********** FSAMRM    ANDEQ'N'                                                    CAS009 238569
     C**********           EXSR UPDAT                                                  CAS009 238569
     C**********           ENDIF                                                       CAS009 238569
     C**********           ENDIF                                                       CAS009 238569
     C***********          ENDIF                                   CLE005 141462
      *
     C                     ENDSR
      *
      ********************************************************************
     C/TITLE SR/UPDAT
      ********************************************************************
      *
      *  UPDAT - PERFORM UPDATING OF LEFEED
      *
      *  CALLED FROM:  ACCRUAL, SETTLE
      *
      *  CALLS: ZXRATE, ZCONV
      *
      ********************************************************************
      *
     C           UPDAT     BEGSR
      *
      ***  Currency conversion subroutine
      *
      ***  If currencies are different it is necessary
      ***  to first obtain the cross exchange rate between the two
      ***  currencies and use this to convert to appropriate
      ***  currency.
      *
     C           FEFCCY    IFNE BJCYCD                     ***B001
     C                     MOVE FEFCCY    INCCY   3
     C                     MOVE BJCYCD    OUTCCY  3
     C                     Z-ADD1         X
     C           INCCY     LOKUPWCYA,X                   13
     C           *IN13     IFEQ '1'                        ***B002
     C                     MOVE WMDA,X    ZMDI1   1
     C                     Z-ADDWSPA,X    ZRATE1 138
     C                     Z-ADDWDPA,X    ZNBDP1  10
     C                     END                             ***E002
      *
     C                     Z-ADD1         X
     C           OUTCCY    LOKUPWCYA,X                   14
     C           *IN14     IFEQ '1'                        ***B002
     C                     MOVE WMDA,X    ZMDI2   1
     C                     Z-ADDWSPA,X    ZRATE2 138
     C                     Z-ADDWDPA,X    ZNBDP2  10
     C                     END                             ***E002
      *
      ***  Obtain cross exchange rate & cross multiply/divide indicator
      *
     C                     EXSR ZXRATE
      *
      ***  Set up input fields for conversion SR
      *
     C                     Z-ADDZRATEX    ZEXCH  138
     C                     MOVE ZMDIX     ZMD     1
     C***********          Z-ADDLKEAMT    ZAMTCI 150                      142402
     C                     MOVE INCCY     ZCCYI   3
     C                     MOVE OUTCCY    ZCCYO   3
     C                     Z-ADDZNBDP1    ZCDPI   10
     C                     Z-ADDZNBDP2    ZCDPO   10
      *
     C           FEORED    IFEQ BJRDNB                                    142402
     C           FEPSTD    ANDLTMSTD                                      142402
      *                                                                   142402
     C           FEPYON    IFEQ ' '                                       156150
     C                     Z-ADD0         WWORK2                          156150
     C                     Z-ADDLKEAMT    WWORK3                          156150
     C                     ENDIF                                          156150
     C                     Z-ADDWWORK2    ZAMTCI                          142402
     C                     EXSR ZCONV                                     142402
     C                     Z-ADDZAMTCO    WBCEQ2 130                      142402
     C                     Z-ADDWWORK3    ZAMTCI                          142402
     C                     EXSR ZCONV                                     142402
     C                     Z-ADDZAMTCO    WBCEQ3 130                      142402
      *                                                                   142402
     C                     ELSE                                           142402
      *                                                                   142402
     C                     Z-ADDLKEAMT    ZAMTCI 150                      142402
     C                     EXSR ZCONV
      *
     C                     Z-ADDZAMTCO    WBCEQ  130
      *                                                                   142402
     C                     ENDIF                                          142402
     C*                                                                   BH3462
     C                     ELSE                                           BH3462
      *                                                                   142402
     C           FEORED    IFEQ BJRDNB                                    142402
     C           FEPSTD    ANDLTMSTD                                      142402
      *                                                                   142402
     C           FEPYON    IFEQ ' '                                       156150
     C                     Z-ADD0         WWORK2                          156150
     C                     Z-ADDLKEAMT    WWORK3                          156150
     C                     ENDIF                                          156150
     C                     Z-ADDWWORK2    WBCEQ2                          142402
     C                     Z-ADDWWORK3    WBCEQ3                          142402
      *                                                                   142402
     C                     ELSE                                           142402
      *                                                                   142402
     C                     Z-ADDLKEAMT    WBCEQ                           BH3462
      *                                                                   142402
     C                     ENDIF                                          142402
      *
     C                     END
      *
      ** Read relevant facility record
     C********** FELOAN    IFEQ 0                                                             CLE148
     C           FELOAN    IFEQ *BLANKS                                                       CLE148
     C           FAKEY     SETLLLEPEFFD
     C           FAKEY     READELEPEFFD                  70
      *
      ** If record not found set up a new one
     C           *IN70     IFEQ '1'
     C                     MOVE 'D'       FFDRCI
     C**********           Z-ADDFECNUM    FFDCNM                                              CSD027
     C                     MOVE FECNUM    FFDCNM                                              CSD027
     C                     Z-ADDFEFACL    FFDFAC
     C                     Z-ADDWCOD      FFDCOD
     C                     MOVE BJCYCD    FFDCCY
     C                     MOVE *BLANKS   FFDACO
     C                     MOVE *BLANKS   FFDDEP
     C                     MOVE FEBRCA    BRCA                            BH3462
     C                     Z-ADD0         FFD
      *
     C           LKREVI    IFEQ 1
      *                                                                   142402
     C           FEORED    IFEQ BJRDNB                                    142402
     C           FEPSTD    ANDLTMSTD                                      142402
      *                                                                   142402
     C                     SUB  WBCEQ2    FFD,A                           142402
     C                     SUB  WBCEQ3    FFD,A2                          142402
      *                                                                   142402
     C                     ELSE                                           142402
      *                                                                   142402
     C                     SUB  WBCEQ     FFD,A
      *                                                                   142402
     C                     ENDIF                                          142402
      *                                                                   142402
     C                     ELSE
      *                                                                   142402
     C           FEORED    IFEQ BJRDNB                                    142402
     C           FEPSTD    ANDLTMSTD                                      142402
      *                                                                   142402
     C                     ADD  WBCEQ2    FFD,A                           142402
     C                     ADD  WBCEQ3    FFD,A2                          142402
      *                                                                   142402
     C                     ELSE                                           142402
      *                                                                   142402
     C                     ADD  WBCEQ     FFD,A
      *                                                                   142402
     C                     ENDIF                                          142402
      *                                                                   142402
     C                     END
      *
     C                     WRITELEPEFFDF
     C                     ADD  1         WFNOR
      *
     C                     ELSE
      *
      ** Update old one
     C           LKREVI    IFEQ 1
      *                                                                   142402
     C           FEORED    IFEQ BJRDNB                                    142402
     C           FEPSTD    ANDLTMSTD                                      142402
      *                                                                   142402
     C                     SUB  WBCEQ2    FFD,A                           142402
     C                     SUB  WBCEQ3    FFD,A2                          142402
      *                                                                   142402
     C                     ELSE                                           142402
      *                                                                   142402
     C                     SUB  WBCEQ     FFD,A
      *                                                                   142402
     C                     ENDIF                                          142402
      *                                                                   142402
     C                     ELSE
      *                                                                   142402
     C           FEORED    IFEQ BJRDNB                                    142402
     C           FEPSTD    ANDLTMSTD                                      142402
      *                                                                   142402
     C                     ADD  WBCEQ2    FFD,A                           142402
     C                     ADD  WBCEQ3    FFD,A2                          142402
      *                                                                   142402
     C                     ELSE                                           142402
      *                                                                   142402
     C                     ADD  WBCEQ     FFD,A
      *                                                                   142402
     C                     ENDIF                                          142402
      *                                                                   142402
     C                     END
     C                     UPDATLEPEFFDF
     C                     END
      *
      *
     C                     ELSE
      *
     C           LNKEY     SETLLLEPEFLD
     C           LNKEY     READELEPEFLD                  70
      *
      ** If record not found set up a new one
     C           *IN70     IFEQ '1'
     C                     MOVE 'D'       FLDRCI
     C**********           Z-ADDFECNUM    FLDCNM                                              CSD027
     C                     MOVE FECNUM    FLDCNM                                              CSD027
     C**********           Z-ADDFELOAN    FLDLON                                              CLE148
     C                     MOVELFELOAN    FLDLON                                              CLE148
     C                     Z-ADD0         FLDCOD
     C                     MOVE BJCYCD    FLDCCY
     C                     MOVE *BLANKS   FLDACO
     C                     MOVE *BLANKS   FLDDEP
     C                     MOVE FEBRCA    BRCA                            BH3462
     C                     Z-ADD0         FLD
     C           LKREVI    IFEQ 1
      *                                                                   142402
     C           FEORED    IFEQ BJRDNB                                    142402
     C           FEPSTD    ANDLTMSTD                                      142402
      *                                                                   142402
     C                     SUB  WBCEQ2    FLD,A                           142402
     C                     SUB  WBCEQ3    FLD,A2                          142402
      *                                                                   142402
     C                     ELSE                                           142402
      *                                                                   142402
     C                     SUB  WBCEQ     FLD,A
      *                                                                   142402
     C                     ENDIF                                          142402
      *                                                                   142402
     C                     ELSE
      *                                                                   142402
     C           FEORED    IFEQ BJRDNB                                    142402
     C           FEPSTD    ANDLTMSTD                                      142402
      *                                                                   142402
     C                     ADD  WBCEQ2    FLD,A                           142402
     C                     ADD  WBCEQ3    FLD,A2                          142402
      *                                                                   142402
     C                     ELSE                                           142402
      *                                                                   142402
     C                     ADD  WBCEQ     FLD,A
      *                                                                   142402
     C                     ENDIF                                          142402
      *                                                                   142402
     C                     END
     C                     WRITELEPEFLDF
     C                     ADD  1         WLNOR
     C                     ELSE
      *
      ** Update old one
     C           LKREVI    IFEQ 1
      *                                                                   142402
     C           FEORED    IFEQ BJRDNB                                    142402
     C           FEPSTD    ANDLTMSTD                                      142402
      *                                                                   142402
     C                     SUB  WBCEQ2    FLD,A                           142402
     C                     SUB  WBCEQ3    FLD,A2                          142402
      *                                                                   142402
     C                     ELSE                                           142402
      *                                                                   142402
     C                     SUB  WBCEQ     FLD,A
      *                                                                   142402
     C                     ENDIF                                          142402
      *                                                                   142402
     C                     ELSE
      *                                                                   142402
     C           FEORED    IFEQ BJRDNB                                    142402
     C           FEPSTD    ANDLTMSTD                                      142402
      *                                                                   142402
     C                     ADD  WBCEQ2    FLD,A                           142402
     C                     ADD  WBCEQ3    FLD,A2                          142402
      *                                                                   142402
     C                     ELSE                                           142402
      *                                                                   142402
     C                     ADD  WBCEQ     FLD,A
      *                                                                   142402
     C                     ENDIF                                          142402
      *                                                                   142402
     C                     END
     C                     UPDATLEPEFLDF
     C                     END
     C                     END
      *
     C                     ENDSR
      *
      ********************************************************************
     C/TITLE SR/SETTLE
      ********************************************************************
      *
      *  SETTLE - PERFORM SETTLEMENT PROCESSING
      *
      *  CALLED FROM: DETAIL, REVERS
      *
      *  CALLS: *PSSR, OPNFIL, UPDAT
      *
      ********************************************************************
      *
     C           SETTLE    BEGSR
     C                     MOVEL'Y'       GENKY   1                                         MD051883
     C                     MOVEL'Y'       FCTYFL  1                                         MD051883
      *
      ** If a reversal
     C           LKREVI    IFEQ 1
     C                     Z-ADDFEAMTS    LKEAMT
     C                     Z-ADD0         FEAMTS
     C                     Z-ADD0         FESDAT
     C                     ADD  LKEAMT    FEAMTO
      *
     C                     ELSE
      *
     C                     Z-ADDFEFAMT    LKEAMT
     C*                                                                   BH3424
     C** If the fee has been entered today and is due to be settled       BH3424
     C** immediately, set up the outstanding amount as the full fee       BH3424
     C*                                                                   BH3424
     C           FEORED    IFEQ BJRDNB                                    BH3424
     C*                                                                   156673
     C** If the fee end date has been changed to today and is due to      156673
     C** be settled, set up the outstanding amount as the full fee        156673
     C*                                                                   156673
     C           FEAMTO    OREQ *ZERO                                     156673
     C           FEPEND    ANDLEBJRDNB                                    156673
     C                     Z-ADDFEFAMT    FEAMTO                          BH3424
     C                     END                                            BH3424
     C*                                                                   BH3424
     C                     ADD  FEFAMT    FEAMTS
     C**********           Z-ADDBJRDNB    FESDAT                                            AR857632
      *                                                                                     AR857632
      ** Use the fee start date or fee end date as FESDAT depending on                      AR857632
      ** the fee payment indicator.                                                         AR857632
      *                                                                                     AR857632
     C           FEPYON    IFEQ ' '                                                         AR857632
     C           FEPYON    OREQ 'S'                                                         AR857632
     C                     Z-ADDFEPSTD    FESDAT                                            AR857632
     C                     ELSE                                                             AR857632
     C                     Z-ADDFEPEND    FESDAT                                            AR857632
     C                     ENDIF                                                            AR857632
      *                                                                                     AR857632
     C/COPY WNCPYSRC,LEH01172
     C                     SUB  LKEAMT    FEAMTO
      *
     C                     END
      *
      ** If loan based fee
     C********** FELOAN    IFGT 0                                                             CLE148
     C           FELOAN    IFGT *BLANKS                                                       CLE148
     C           FELOAN    ANDNE'000000'                                                      CLE134
     C                     MOVEL'N'       FCTYFL                                            MD051883
      *
      ** Get loan details
     C********** FELTYP    IFEQ '  '                                                          232319
     C           WLNKEY    CHAINCLOAN                15
      *                                                                                       260961
      ** Check if record is existing in matured loans file before                             260961
      ** issuing a database error.                                                            260961
      *                                                                                       260961
     C           *IN15     IFEQ '1'                                                           260961
     C           WLNKEY    CHAINMCLONCLF             15                                       260961
     C                     ENDIF                                                              260961
      *****************************************************************              260961 MD049826
      ***Check*if*record*is*existing*in*reversed*loans*file*before*****              260961 MD049826
      ***issuing*a*database*error.*************************************              260961 MD049826
      *****************************************************************              260961 MD049826
     C********** *IN15     IFEQ '1'                                                  260961 MD049826
     C********** FELOAN    CHAINRVLNSL0              15                              260961 MD049826
     C**********           ENDIF                                                     260961 MD049826
      *                                                                                       260961
     C           *IN15     IFEQ '1'                                                           260961
     C           FELOAN    CHAINCLOANPE              15                                       260961
     C                     ENDIF                                                              260961
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVELFELOAN    DBKEY            ************
     C                     MOVEL'002'     DBASE            * DBERR 02 *
     C                     MOVEL'CLOAN'   DBFILE           ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ELSE
     C                     MOVE LTYP      FELTYP
     C**********           MOVE SUTP      FESUTP                                            AR317401
     C                     MOVE CLAS      FECLAS                                              CLE042
     C                     END
     C**********           ENDD                                                               232319
      *
     C**********           Z-ADDFELOAN    LKLNNO                                              CLE148
     C                     MOVELFELOAN    LKLNNO                                              CLE148
     C                     MOVE '1'       *IN34
     C*********************MOVE 'D'       LKRECI                           00106
     C**********           MOVE 'F'       LKRECI                    00106 057249
     C                     MOVE 'L'       LKRECI                          057249
     C           FECAPI    IFEQ 'Y'                                                           CLE139
     C                     MOVE 'C'       AKY,3                                               CLE139
     C                     ELSE                                                               CLE139
     C                     MOVE 'R'       AKY,3
     C                     ENDIF                                                              CLE139
     C                     MOVEAFELTYP    AKY,1
     C                     MOVEAFESUTP    AKY,4
     C                     MOVEAFECLAS    AKY,11                                              CLE042
     C*                                                                   E30393
     C* POS. 7 RECOURSE IND. (R = WITH RECOURSE)                          E30393
     C*                                                                   E30393
     C*********************MOVEARCSI      AKY,7                           E30393
     C           RCSI      IFEQ 'R'                                       E30393
     C           RCSI      OREQ 'Y'                                       E30393
     C                     MOVE 'R'       AKY,7                           E30393
     C                     ELSE                                           E30393
     C                     MOVE ' '       AKY,7                           E30393
     C                     END                                            E30393
      *                                                                   B10039
     C                     MOVEAWFCOD     AKY,8
     C                     MOVE 'F'       AKY,10
     C                     MOVEA' '       AKY,6
     C           FEPYON    IFEQ 'S'
     C                     MOVE 'S'       AKY,6
     C                     END
     C                     MOVEAAKY       LKAKEY
     C**********           Z-ADDOLNO      LKOLNO                                       243499 CPK027
     C                     MOVE OLNO      LKOLNO                                              CPK027
     C                     ELSE
      *                                                                                     AR800866
      ** Retrieve facility fee's account sequence from facility file.                       AR800866
      *                                                                                     AR800866
     C                     EXSR SRFCTY                                                      AR800866
      *
      ** If not loan based fee must be facility based
     C                     MOVE '0'       *IN34
     C**********           Z-ADDFEFACL    LKLNNO                                              CLE148
     C                     MOVEL*BLANKS   LKLNNO                                              CLE148
     C                     MOVE FEFACL    LKLNNO                                              CLE148
     C                     MOVE 'F'       LKRECI
     C                     MOVE 'R'       AKY,4
     C                     MOVELFEFACL    WFACT   3
     C                     MOVEAWFACT     AKY,1
     C                     MOVEAWFCOD     AKY,8
     C                     MOVE 'F'       AKY,10
     C                     MOVEA'   '     AKY,5
      *                                                                                       251069
      ** Ensure that the class code is blank for fees                                         251069
     C                     MOVEA'    '    AKY,11                                              251069
     C           FEPYON    IFEQ 'S'
     C                     MOVE 'S'       AKY,6
     C                     END
     C/COPY WNCPYSRC,LEH00327
     C                     MOVEAAKY       LKAKEY
     C**********           Z-ADD0         LKOLNO                                       243499 CPK027
     C                     MOVE *BLANKS   LKOLNO                                              CPK027
     C                     END
      *                                                                   CLE005
      **  Sets the value of position 7 of the Account key if CLE004       CLE005
      **  and CLE005 is switched on                                       CLE005
      *                                                                   CLE005
     C           CLE004    IFEQ 'Y'                                       CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C***********AKY,7     IFEQ 'R'                                CLE005 158197
     C***********PTFI      IFEQ 'I'                                CLE005 158197
     C***********          MOVE 'L'       AKY,7                    CLE005 158197
     C***********          ENDIF                                   CLE005 158197
     C***********PTFI      IFEQ 'P'                                CLE005 158197
     C***********          MOVE 'S'       AKY,7                    CLE005 158197
     C***********          ENDIF                                   CLE005 158197
     C***********          ELSE                                    CLE005 158197
     C           PTFI      IFEQ 'I'                                       CLE005
     C                     MOVE 'I'       AKY,7                           CLE005
     C                     ENDIF                                          CLE005
     C           PTFI      IFEQ 'P'                                       CLE005
     C           PTFI      OREQ 'S'                                                           CLE106
     C           PTFI      OREQ 'R'                                                           CLE106
     C                     MOVE 'P'       AKY,7                           CLE005
     C                     ENDIF                                          CLE005
     C***********          ENDIF                                   CLE005 158197
     C                     ENDIF                                          CLE005
     C/COPY WNCPYSRC,LEH00601
     C                     MOVEAAKY       LKAKEY                          CLE005
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           PTFI      ANDNE'I'                                                           CLE034
     C                     EXSR SR34A                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'Y'       WKFLD   1                                           CLE034
     C                     MOVE '*EOF   ' PRTCD                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           WKFLD     DOWEQ'Y'                                                           CLE034
     C           PRTCD     OREQ *BLANKS                                                       CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           PTFI      ANDNE'I'                                                           CLE034
     C                     EXSR SR34B                                                         CLE034
     C                     ENDIF                                                              CLE034
      *
      ** Set up fields for output
     C**********           Z-ADDFECNUM    LKCNUM                                              CSD027
     C                     MOVE FECNUM    LKCNUM                                              CSD027
     C                     Z-ADDLKEAMT    EAMT0
     C                     MOVE FEFCCY    LKECCY
     C                     MOVELFEOURS    LKOSAC
      *                                                                                       CGL020
      ** Determine AML Pay/Receive Instructions                                               CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C           FECAPI    ANDNE'Y'                                                           CLE139
     C                     EXSR SRAMLI                                                        CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     Z-ADDFESTTL    LKSETP
     C***********FEOSBR    IFNE *BLANKS                                   BH3495
     C***********          MOVE FEOSBR    LKBRCD                          BH3495
     C***********          ELSE                                           BH3495
     C                     MOVE FEBRCA    LKBRCD                          BH3495
     C***********          END                                            BH3495
     C                     MOVE FEOSBR    LKOSBR                          BH3495
      *                                                                                     AR800866
     C           FELOAN    IFGT *BLANKS                                                     AR800866
     C                     Z-ADDLASQ      LKACSQ
     C                     ELSE                                                             AR800866
     C                     Z-ADDFCACSQ    LKACSQ                                            AR800866
     C                     ENDIF                                                            AR800866
      *
      ** Set indicator for decimal places
     C                     Z-ADD1         B       30
     C           FEFCCY    LOKUPWCYA,B                   56
     C           WDPA,B    COMP 1                    323031
     C           WDPA,B    COMP 2                    33  32
     C*                                                                   S01408
     C/COPY WNCPYSRC,LER130CPG2                                           S01408
     C*                                                                   S01408
      ** Move the Profit Centre if Profit Centres are used.                                   247979
      *                                                                                       247979
      *
     C           BGN0ST    IFEQ 'Y'                                       127966
     C           BGN0ST    OREQ 'N'                                                           247979
     C           BKPRCU    ANDEQ'Y'                                                           247979
     C           FEPRFC    ANDNE*BLANKS                                                       247979
     C                     MOVE FEPRFC    LKPRFC                          127966
     C                     ENDIF                                          127966
      *                                                                   127966
     C                     EXSR OPNFIL
      *                                                                   CLE005
      ** If CLE005 is switched on, setup settlement details               CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
      *                                                                   CLE005
     C           CLE004    IFEQ 'N'                                       CLE005
     C           CLE004    OREQ 'Y'                                       CLE005
     C           PTFI      ANDEQ*BLANK                                    CLE005
     C                     MOVE OSDB      LKOSBR                          CLE005
     C                     MOVE RONS      LKOSAC                          CLE005
     C                     MOVE RSTM      LKSETP                          CLE005
      *                                                                                       CGL020
      ** Determine AML Pay/Receive Instructions                                               CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C           FECAPI    ANDNE'Y'                                                           CLE139
     C                     MOVELSTLNS2    STLNS1                                              CGL020
     C                     EXSR SRAMPR                                                        CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     ENDIF                                          CLE005
     C           CLE004    IFEQ 'Y'                                       CLE005
     C           PTFI      IFEQ 'P'                                       CLE005
     C           PTFI      OREQ 'S'                                                           CLE106
     C           PTFI      OREQ 'R'                                                           CLE106
     C                     MOVE OMDB      LKOSBR                          CLE005
     C                     MOVE PONS      LKOSAC                          CLE005
     C                     MOVE PSTM      LKSETP                          CLE005
      *                                                                                       CGL020
      ** Determine AML Pay/Receive Instructions                                               CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C           FECAPI    ANDNE'Y'                                                           CLE139
     C                     MOVELSTLNS2    STLNS1                                              CGL020
     C                     EXSR SRAMPR                                                        CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     ENDIF                                          CLE005
     C           PTFI      IFEQ 'I'                                       CLE005
     C                     MOVE *BLANKS   LKOSBR                          CLE005
     C                     MOVE *BLANKS   LKOSAC                          CLE005
     C                     MOVE *BLANKS   LKSETP                          CLE005
      *                                                                                       CGL020
      ** Determine AML Pay/Receive Instructions                                               CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C           FECAPI    ANDNE'Y'                                                           CLE139
     C                     MOVEL*BLANKS   STLNS1                                              CGL020
     C                     EXSR SRAMPR                                                        CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
      *                                                                                       238569
      ** Write Cash Flow records for Loan based fees                                          238569
      *                                                                                       238569
     C           CAS009    IFEQ 'Y'                                                           238569
     C********** FELOAN    ANDGT0                                                      238569 CLE148
     C           FELOAN    ANDGT*BLANKS                                                       CLE148
     C                     EXSR SRLECF                                                        238569
     C                     ENDIF                                                              238569
      *                                                                                       238569
     C           CAS009    IFEQ 'Y'                                                           238569
     C********** FELOAN    ANDGT0                                                      238569 CLE148
     C           FELOAN    ANDGT*BLANKS                                                       CLE148
     C           FEADJY    ANDEQ'Y'                                                           238569
     C           FSAMRM    ANDEQ'N'                                                           238569
     C           VDAT      ANDGEFSNLAC                                                        238569
     C                     ELSE                                                               238569
      *                                                                   CLE005
      *                                                                                       CGL020
      ** If Midas Compliance Watch (CGL020) is installed and Repayment,                       CGL020
      ** set Fee Flag = 'F', Fee Value = Posting Amount and Fee Percent = 100                 CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVE 'F'       F1FFLG                                              CGL020
     C                     Z-ADDLKEAMT    F1FVAL                                              CGL020
     C                     Z-ADD100       F1FPCT                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           FECAPI    ANDNE'Y'                                                           CLE139
     C                     EXSR SETCCY                                                        CLE031
     C                     ENDIF                                                              CLE031
      **********                                                                     CLE025 BUG13031
      ***If*CLE025*is*on,*adjust*event*date*of*fees*posted*today                     CLE025 BUG13031
      **********                                                                     CLE025 BUG13031
     C********** CLE025    IFEQ 'Y'                                                  CLE025 BUG13031
     C********** LKEDAT    ADD  1         WEDAT                                      CLE025 BUG13031
     C********** BJRDNB    ADD  1         WRDNB                                      CLE025 BUG13031
      **********                                                                     CLE025 BUG13031
      ***Set*event*date*to*whichever*is*later*between                                CLE025 BUG13031
      ***event*date*+*1*and*rundate*+*1                                              CLE025 BUG13031
      **********                                                                     CLE025 BUG13031
     C********** WEDAT     IFGT WRDNB                                                CLE025 BUG13031
     C**********           Z-ADDWEDAT     LKEDAT                                     CLE025 BUG13031
     C**********           ELSE                                                      CLE025 BUG13031
     C**********           Z-ADDWRDNB     LKEDAT                                     CLE025 BUG13031
     C**********           ENDIF                                                     CLE025 BUG13031
     C**********           ENDIF                                                     CLE025 BUG13031
      *                                                                                       CLE031
      ** Write record to A/C key file then report details
     C**********           MOVE 'N'       WNEWF   1                                  CLE134 MD019852
     C                     MOVE ' '       WNEWF   1                                         MD019852
     C                     MOVE *BLANKS   WTYPE   1                                           CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           LKRECI    IFEQ 'F'                                                           CLE134
     C           AKY,4     ANDEQ'R'                                                           CLE134
     C           LKRECI    OREQ 'L'                                                           CLE134
     C           AKY,3     ANDEQ'R'                                                           CLE134
     C                     MOVE 'R'       WTYPE   1                                           CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           WTYPE     ANDEQ'R'                                                           CLE134
     C           FEAUTO    IFEQ 'C'                                                           CLE134
     C           FEAUT2    OREQ 'C'                                                           CLE134
     C           FEAUTO    ORNE 'N'                                                           CLE134
     C           FEFSFA    ANDEQ'Y'                                                           CLE134
     C           LKRECI    IFEQ 'L'                                                           CLE134
     C**********           MOVE LKLNNO    KLNNO   60                                 CLE134 AR997862
     C                     MOVE LKLNNO    KLNNO   6                                         AR997862
     C                     ELSE                                                               CLE134
     C                     CLEARKLNNO                                                         CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     MOVE 'Y'       WNEWF                                               CLE134
     C                     Z-ADD*ZEROS    LKAAMT                                              CLE134
     C                     MOVE FECNUM    LKCNU2                                              CLE134
     C                     MOVE FELOAN    LKLOAN                                              CLE134
     C                     MOVE FEFACL    LKFACL                                              CLE134
     C                     MOVE FEFSEQ    LKFSE2                                              CLE134
     C                     MOVE FEFCOD    LKFCOD                                              CLE134
     C                     MOVE FEBRCA    LKFBRC                                              CLE134
     C                     MOVE FEFSFA    LKSFA                                             AR217562
     C                     MOVE *BLANKS   LKTYPE                                              CLE134
     C                     MOVE *BLANKS   LKIPFL                                              CLE134
      *                                                                                       CLE134
      ** retrieve sett account and priority                                                   CLE134
      *                                                                                       CLE134
     C                     Z-ADDFEFACL    WFACL   50                                          CLE134
     C                     Z-ADDFEFCOD    WFACOD  20                                          CLE134
     C                     CALL 'LE000458'                                                    CLE134
     C                     PARM *BLANKS   RETCOD  7                                           CLE134
     C                     PARM           LKAKEY                                              CLE134
     C                     PARM           LKECCY                                              CLE134
     C                     PARM           KLNNO                                               CLE134
     C                     PARM           FECNUM                                              CLE134
     C                     PARM           FELOAN                                              CLE134
     C                     PARM           WFACL                                               CLE134
     C                     PARM           FEFSEQ                                              CLE134
     C                     PARM           WFACOD                                              CLE134
     C                     PARM           LKSCCY                                              CLE134
     C                     PARM           LKOSAC                                              CLE134
     C                     PARM           LKSETP                                              CLE134
     C                     PARM           LKOLNO                                              CLE134
     C                     PARM           LKOSBR                                              CLE134
      *                                                                                       CLE134
     C                     PARM *BLANKS   SEBRCA                                              CLE134
     C                     PARM *BLANKS   SECNUM                                              CLE134
     C                     PARM *BLANKS   SEACCY                                              CLE134
     C                     PARM *ZEROS    SEACOD                                              CLE134
     C                     PARM *ZEROS    SEACSQ                                              CLE134
     C**********           PARM *ZEROS    SEPCKO                                       CLE134 CLE164
     C                     PARM *BLANKS   OATYP   1                                         AR741212
      *                                                                                     AR741212
     C           RETCOD    IFEQ '*ERROR'                                                      CLE134
     C           *LOCK     IN   LDA                                                           CLE134
     C                     MOVEL'LE000458'DBPGM                                               CLE134
     C                     MOVEL'020'     DBASE                                               CLE134
     C                     MOVE *BLANKS   DBKEY                                               CLE134
     C                     OUT  LDA                                                           CLE134
     C                     EXSR *PSSR                                                         CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                     AR741212
      ** Proceed in writing to LEPK3DP only if settlement account is                        AR741212
      ** Retail. Or if Settlement account is GL (this one is as per                         AR741212
      ** bank's request). Otherwise, write to LKEYFED.                                      AR741212
      *                                                                                     AR741212
     C           OATYP     IFNE 'N'                                                         AR741212
     C           SEBRCA    ANDNE*BLANKS                                                     MD030334
     C           SECNUM    ANDNE*BLANKS                                                     MD030334
     C           SEACCY    ANDNE*BLANKS                                                     MD030334
     C           SEACOD    ANDGT0                                                           MD030334
     C           SEACSQ    ANDGT0                                                           MD030334
      *                                                                                       CLE134
      ** Set fields                                                                           CLE134
      *                                                                                       CLE134
     C           FECALT    IFNE '90'                                                          CLE134
     C********** FELOAN    IFEQ *ZEROS                                               CLE134 MD020212
     C           FELOAN    IFEQ *BLANKS                                                     MD020212
     C**********           Z-ADD500       SEPCKM                                       CLE134 CLE164
     C**********           Z-ADD500       SEPCKT                                       263074 CLE164
     C                     MOVEL'FFEE'    SECATC                                              CLE164
     C                     ELSE                                                               CLE134
     C**********           Z-ADD600       SEPCKM                                       CLE134 CLE164
     C**********           Z-ADD600       SEPCKT                                       263074 CLE164
     C                     MOVEL'LFEE'    SECATC                                              CLE164
     C                     END                                                                CLE134
     C                     ELSE                                                               CLE134
     C**********           Z-ADD100       SEPCKM                                       CLE134 CLE164
     C**********           Z-ADD100       SEPCKT                                       263074 CLE164
     C                     MOVEL'Fee90'   SECATC                                              CLE164
     C                     ENDIF                                                              CLE134
     C                     MOVELLKLNNO    SELNRF                                              CLE134
     C                     Z-ADDLKEDAT    SEVDAT                                              CLE134
     C                     Z-ADDFEPSTD    SEVDAT                                            AR571427
     C**********           MOVE 'F3'      SEFILE                                       CLE134 CLE164
     C                     MOVEL'LEPK3DPD'SEFILE                                              CLE164
     C                     MOVEL*ZEROS    SEOVRD                                              CLE164
     C                     MOVELFEPSTD    SESDAT                                              CLE164
     C           FEPEND    IFEQ 0                                                             CLE164
     C                     MOVELFEPSTD    SEMDAT                                              CLE164
     C                     ELSE                                                               CLE164
     C                     MOVELFEPEND    SEMDAT                                              CLE164
     C                     ENDIF                                                              CLE164
     C                     MOVEL*ZEROS    SEVDPD                                              CLE164
     C                     MOVELLKEDAT    SEVDPY                                              CLE164
     C                     Z-ADDLKEAMT    SEPAMT                                              CLE164
     C                     MOVELSTMP      SETMST                                              CLE164
     C           SETRID    ADD  1         SETRID                                              CLE164
     C                     MOVEL*BLANKS   SETREF                                              CLE164
     C           FELOAN    IFEQ *BLANKS                                                       CLE164
     C                     MOVELFEFACL    WTREF   9                                           CLE164
     C                     MOVELFEFCOD    WWTREF  4                                           CLE164
     C                     MOVE FEFSEQ    WWTREF                                              CLE164
     C                     MOVE WWTREF    WTREF                                               CLE164
     C                     MOVELWTREF     SETREF                                              CLE164
     C                     ELSE                                                               CLE164
     C                     MOVELFELOAN    XTREF  10                                           CLE164
     C                     MOVELFEFCOD    WWTREF                                              CLE164
     C                     MOVE FEFSEQ    WWTREF                                              CLE164
     C                     MOVE WWTREF    XTREF                                               CLE164
     C                     MOVELXTREF     SETREF                                              CLE164
     C                     ENDIF                                                              CLE164
     C                     EXSR SRRPKY                                                        CLE164
      *                                                                                       CLE134
     C                     Z-ADDWRKAMT    LKOTHA                                            MD051242
     C                     WRITELKEYF3DF                                                      CLE134
     C                     CLEARLKOTHA                                                      MD051242
      *                                                                                     AR741212
     C                     ELSE                                                             AR741212
     C                     MOVE 'N'       WNEWF                                             AR741212
     C           PROCES    IFEQ 'Y'                                                         MD051883
     C                     MOVE 'V'       AKY,10                                            MD051883
     C                     MOVEAAKY       LKAKEY                                            MD051883
     C                     ENDIF                                                            MD051883
     C                     WRITELKEYFEDF                                                    AR741212
     C                     ENDIF                                                            AR741212
      *                                                                                       CLE134
     C                     ELSE                                                               CLE134
      *                                                                                       CLE134
     C           PROCES    IFEQ 'Y'                                                         MD051883
     C                     MOVE 'V'       AKY,10                                            MD051883
     C                     MOVEAAKY       LKAKEY                                            MD051883
     C                     ENDIF                                                            MD051883
     C                     WRITELKEYFEDF
     C                     MOVE 'N'       WNEWF                                             MD019852
      *                                                                                       CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                     MD025519
     C                     ELSE                                                             MD025519
     C                     WRITELKEYFEDF                                                    MD025519
     C                     MOVE 'N'       WNEWF                                             MD025519
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C/COPY WNCPYSRC,LER130C005
      *                                                                                       CGL020
      ** If Midas Compliance Watch (CGL020) is installed and Repayment,                       CGL020
      ** reset Fee Flag, Fee Value and Fee Percent.                                           CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVE *BLANK    F1FFLG                                              CGL020
     C                     Z-ADD0         F1FVAL                                              CGL020
     C                     Z-ADD0         F1FPCT                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
      *                                                                                       CAS009
      ***Write*Cash*Flow*records*for*Loan*based*fees*******                            CAS009 238569
      *****************************************************                            CAS009 238569
     C********** CAS009    IFEQ 'Y'                                                    CAS009 238569
     C********** FELOAN    ANDGT0                                                      CAS009 238569
     C**********           EXSR SRLECF                                                 CAS009 238569
     C**********           ENDIF                                                       CAS009 238569
      *                                                                                       CAS009
      * Work field for number account keys generated
     C           WNEWF     IFEQ 'Y'                                                           CLE134
     C**********           ADD  1         LKNOR0                                              263358
     C                     ADD  1         L3NORE                                              263358
     C                     ELSE                                                               CLE134
     C           WNEWF     IFEQ 'N'                                                         MD019852
     C                     ADD  1         LKNOR0
     C                     ENDIF                                                            MD019852
     C                     ENDIF                                                              CLE134
      *
     C                     EXSR CHKCCY                                                        219275
      *                                                                                       219275
     C                     Z-ADDLKEAMT    EAMT0                                             MD051883
     C                     WRITELER130D1
      *
      ** If overflow on output headers
     C           *IN80     IFEQ '1'
     C                     WRITELER130H1
     C                     WRITELER130H2
     C                     MOVE '0'       *IN80
     C                     END
      *
      ** Details on print file indicator
     C                     MOVE '1'       *IN21
      *
     C                     Z-ADD1         Z
     C                     Z-ADD1         S
      ** Calculate hash total for trailer
     C           WNEWF     IFEQ 'Y'                                                           CLE134
     C           LKEAMT    DIV  1000      ZZAMT  153                                          CLE134
     C                     Z-ADD1         Z                                                   CLE134
     C                     Z-ADD2         S                                                   CLE134
     C                     Z-ADDL3VLRF    INT,2                                               CLE134
     C                     Z-ADDL3VLRL    DEC,2                                               CLE134
     C                     Z-ADDL3VLRF    ZZTOTI                                              CLE134
     C                     Z-ADDL3VLRL    ZZTOTD                                              CLE134
     C                     EXSR ZHASH                                                         CLE134
     C                     Z-ADDZZTOTI    L3VLRF                                              CLE134
     C                     Z-ADDZZTOTD    L3VLRL                                              CLE134
     C                     ELSE                                                               CLE134
      *                                                                                       CLE134
     C           LKEAMT    DIV  1000      ZZAMT  153
     C                     Z-ADD1         S                                                   CLE134
     C                     Z-ADD1         Z                                                   CLE134
     C                     Z-ADDLKVLRF    ZZTOTI
     C                     Z-ADDLKVLRL    ZZTOTD
     C                     EXSR ZHASH
     C                     Z-ADDZZTOTI    LKVLRF
     C                     Z-ADDZZTOTD    LKVLRL
     C                     ENDIF                                                              CLE134
      *
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           FECAPI    ANDNE'Y'                                                           CLE139
     C           CLE134    ANDEQ'N'                                                         MD046080
     C           CLE031    OREQ 'Y'                                                         MD051242
     C           CLE134    ANDEQ'Y'                                                         MD051242
     C           FEAUTO    ANDEQ'Y'                                                         MD051242
     C           CLE031    OREQ 'Y'                                                         MD053946
     C           CLE134    ANDEQ'Y'                                                         MD053946
     C           FEAUTO    ANDEQ'C'                                                         MD053946
     C           OATYP     ANDEQ'N'                                                         MD053946
     C                     EXSR SETKEY                                                        CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDIF                                                              CAS019
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           PTFI      ANDNE'I'                                                           CLE034
     C                     EXSR SR34C                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE *BLANKS   WKFLD                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDDO                                                              CLE034
      *                                                                                       CLE034
     C           CAS009    IFEQ 'Y'                                                           CAS019
     C********** FELOAN    ANDGT0                                                      CAS019 CLE148
     C           FELOAN    ANDGT*BLANKS                                                       CLE148
     C           FEADJY    ANDEQ'Y'                                                           CAS019
     C           FSAMRM    ANDEQ'N'                                                           CAS019
     C           VDAT      ANDGEFSNLAC                                                        CAS019
     C                     ELSE                                                               CAS019
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C                     EXSR SR34E                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           FEPYON    IFEQ ' '
     C/COPY WNCPYSRC,LEH00955
      *
      ** Write record to A/C key file
     C********** FELOAN    IFEQ 0                                                             CLE148
     C           FELOAN    IFEQ *BLANKS                                                       CLE148
     C                     MOVE 'A'       AKY,4
     C                     ELSE
     C                     MOVE 'A'       AKY,3
     C                     END
     C                     MOVEAAKY       LKAKEY
     C*                                                                   S01408
     C/COPY WNCPYSRC,LER130CPG3                                           S01408
     C*                                                                   S01408
      *
      ** Move the Profit Centre if Profit Centres are used.                                   247979
      *                                                                                       247979
     C           BGN0ST    IFEQ 'Y'                                       127966
     C           BGN0ST    OREQ 'N'                                                           247979
     C           BKPRCU    ANDEQ'Y'                                                           247979
     C           FEPRFC    ANDNE*BLANKS                                                       247979
     C                     MOVE FEPRFC    LKPRFC                          127966
     C                     ENDIF                                          127966
      *                                                                   127966
     C                     EXSR OPNFIL
      ** Write record to A/C key file then report details
     C                     WRITELKEYFEDF
     C/COPY WNCPYSRC,LER130C006
      *
     C                     EXSR CHKCCY                                                        219275
      *                                                                                       219275
     C                     WRITELER130D1
      * Work field for number account keys generated
     C                     ADD  1         LKNOR0
      *
      ** Details on print file indicator
     C                     MOVE '1'       *IN21
      *
      ** Calculate hash total for trailer
     C                     Z-ADD1         S                                                   CLE134
     C                     Z-ADD1         Z                                                   CLE134
     C           LKEAMT    DIV  1000      ZZAMT  153
     C                     Z-ADDLKVLRF    ZZTOTI
     C                     Z-ADDLKVLRL    ZZTOTD
     C                     EXSR ZHASH
     C                     Z-ADDZZTOTI    LKVLRF
     C                     Z-ADDZZTOTD    LKVLRL
      *
      *                                                                   CLE005
      *************************************************************CLE005 141462
      ***If*CLE004*and*CLE005*is*switched*on,*do*not*execute*SubrouCLE005 141462
      ***UPDAT*if*Participant*fee*indicator*is*'I'*or*'P'**********CLE005 141462
      *************************************************************CLE005 141462
     C***********CLE004    IFEQ 'Y'                                CLE005 141462
     C***********CLE005    ANDEQ'Y'                                CLE005 141462
     C***********PTFI      IFEQ 'P'                                CLE005 141462
     C***********PTFI      OREQ 'I'                                CLE005 141462
     C***********          ELSE                                    CLE005 141462
     C***********          EXSR UPDAT                              CLE005 141462
     C***********          ENDIF                                   CLE005 141462
     C***********          ELSE                                    CLE005 141462
     C                     EXSR UPDAT
     C                     ENDIF                                                              238569
     C                     ENDIF                                                              238569
      *                                                                                       238569
     C***********          ENDIF                                   CLE005 141462
      *                                                                   CLE005
     C           LKREVI    IFNE 1                                         BH3463
     C           FEPYON    ANDEQ' '                                                           238569
     C/COPY WNCPYSRC,LEH00903
     C           WPDCL     IFEQ 'N'                                                         AR402732
     C           FEAUTO    IFNE 'C'                                                         AR402732
     C           FEAUTO    OREQ 'C'                                                         AR402732
     C           FEPSTD    ANDLTBJRDNB                                                      AR402732
     C           FELCHD    ANDLTBJRDNB                                                      AR402732
     C                     MOVE 'M'       FERECI
     C********** FEAUTO    IFEQ 'C'                                               AR1078443 MD020824
     C**********           MOVE 'D'       FERECI                                  AR1078443 MD020824
     C**********           ENDIF                                                  AR1078443 MD020824
     C                     ENDIF                                                            AR402732
     C                     ENDIF                                                            AR402732
     C/COPY WNCPYSRC,LEH00904
     C                     END                                            BH3463
     C**********           END                                                                238569
      *
     C           FEPYON    IFEQ 'E'
     C           LKREVI    ANDNE1                                         BH3463
     C           WPDCL     IFEQ 'N'                                                         AR402732
     C           FEAUTO    IFNE 'C'                                                         AR402732
     C           FEAUTO    OREQ 'C'                                                         AR402732
     C           FEPEND    ANDLTBJRDNB                                                      AR402732
     C           FELCHD    ANDLTBJRDNB                                                      AR402732
     C                     MOVE 'M'       FERECI
     C********** FEAUTO    IFEQ 'C'                                               AR1078443 MD020824
     C**********           MOVE 'D'       FERECI                                  AR1078443 MD020824
     C**********           ENDIF                                                  AR1078443 MD020824
     C                     ENDIF                                                            AR402732
     C                     ENDIF                                                            AR402732
     C                     END
      *                                                                   179741
     C                     MOVE *BLANKS   LKSCCY                          179741
      *
     C/COPY WNCPYSRC,LEH00882
     C                     MOVE *BLANKS   LKSCCY                          179741
     C                     MOVEL'N'       GENKY                                             MD051883
      *
     C                     ENDSR
      *
      ********************************************************************
     C/TITLE SR/OPNFIL
      ********************************************************************
      *
      *  OPNFIL -  SUBROUTINE TO OPEN P1 FILE
      *
      *  CALLED FROM: ACCRUE, SETTLE
      *
      *  CALLS:  ZSFILE
      *
      ********************************************************************
      *
     C           OPNFIL    BEGSR
      *
     C           MBIN      IFEQ 'Y'
     C           REPBRC    ANDNESTRBRC
      ** Write out total number of account keys generated for last
      ** branch and end of report message before opening new spool file
      ** LKNTOT is total number of account keys output to file.
     C           *IN21     IFEQ '1'
     C                     ADD  LKNOR0    LKNTOT
     C                     Z-ADDLKNOR0    LKNORE
     C                     WRITELER130T1
     C                     Z-ADD0         LKNOR0
     C                     MOVE '0'       *IN21
     C                     END
     C                     MOVE REPBRC    STRBRC  3
     C                     CLOSELER130P1
     C                     OPEN LER130P1
     C                     MOVE 'Y'       P1OP
     C                     Z-ADD0         PAGE
      ** Ensure report spool file recorded by RCF
     C                     Z-ADDSFNUM     ZSNUM
      *
     C                     CALL 'ZSFILE'
     C                     PARM           SEQ     5
     C                     PARM REPBRC    SENTY   3
     C                     PARM           SFILE
     C                     PARM           ZSNUM   60
     C                     PARM           ZSERR   1
      *
      ** If error during ZSFILE processing, return to calling program
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
      *
      ** Obtain branch name for output
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' WRTCD   7
     C                     PARM '*KEY   ' WOPTN   7
     C                     PARM REPBRC    WDSNB   3
     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           WRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVELREPBRC    DBKEY            ************
     C                     MOVEL'SDBRCHPD'DBFILE           * DBERR 03 *
     C                     MOVEL'003'     DBASE            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      ** Output headers
     C                     WRITELER130H1
     C                     WRITELER130H2
      *
      ** If system multibranching
     C                     END
      *
      ** If system is not multibranching set up single spool file
     C           MBIN      IFNE 'Y'
     C           P1OP      ANDNE'Y'
     C                     CLOSELER130P1
     C                     MOVE 'Y'       P1OP    1
     C                     OPEN LER130P1
     C                     Z-ADD0         PAGE
      ** Ensure report spool file recorded by RCF
     C                     Z-ADDSFNUM     ZSNUM
      *
     C                     CALL 'ZSFILE'
     C                     PARM           SEQ
     C                     PARM *BLANKS   SENTY
     C                     PARM           SFILE
     C                     PARM           ZSNUM
     C                     PARM           ZSERR
      *
      ** If error during ZSFILE processing, return to calling program
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
      *
      ** Output header
     C                     WRITELER130H1
     C                     WRITELER130H2
      *
      ** MBIN IFNE 'Y' end
     C                     END
      *
     C                     ENDSR
      *
      ********************************************************************
     C/TITLE SR/TRAIL
      ********************************************************************
      *
      *  TRAIL - PERFORM TRAILER PROCESSING & FILE UPDATE
      *
      *  CALLED FROM: MAIN PROCESSING
      *
      *  CALLS: *PSSR
      *
      ********************************************************************
      *
     C           TRAIL     BEGSR
      *
     C                     Z-ADD0         PAGE
      *
      ** Ensure report spool file recorded by RCF
     C                     Z-ADDSFNUMU    ZSNUMU  60
     C                     CALL 'ZSFILE'
     C                     PARM           SEQ
     C                     PARM *BLANKS   SENTY
     C                     PARM           SFILEU
     C                     PARM           ZSNUMU
     C                     PARM           ZSERR
      *
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
      *                                                                   052986
     C                     WRITELER130A1                                  052986
      *
      ** If no account keys have been generated output such a
      ** message to the audit report
      *
     C           P1OP      IFNE 'Y'
      *
     C***********          WRITELER130A1                                  052986
     C                     WRITELER130T3
     C                     END                                            052986
      *
     C***********          ELSE                                           052986
      *                                                                   052986
      ** Output number of account keys generated message to the last
      ** branch report.
     C                     Z-ADDLKNOR0    LKNORE
      *                                                                   052986
     C           P1OP      IFEQ 'Y'                                       052986
     C                     WRITELER130T1
     C                     END                                            052986
      *
      ** LKNTOT is total number of account keys generated field.
     C           LKNTOT    ADD  LKNOR0    LKNTOT
      *
     C***********LKNTOT    ADD  2         LKNORE                            0028
     C*                                                                     0028
     C***  SHOULD ALWAYS WRITE THIS TRAILER]                                0028
     C*                                                                     0028
     C**********           MOVE 'T'       LKRECI                            0028
     C**********           WRITELKEYFEZF                                    0028
      *
     C                     READ LEFEEZ                   16
      *
     C           *IN16     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'LEFEEZ  'DBFILE           ************
     C                     MOVEL'004'     DBASE            * DBERR 04 *
     C                     OUT  LDA                        ************
     C                     EXSR *PSSR
     C                     END
      *
     C           CCAP      IFEQ 'C'                                                        AR750543A
     C           CANRIC    SUB  CPDEL     WWRK                                             AR750543A
     C           WWRK      IFLT 0                                                           MD025212
     C                     ADD  100000    WWRK                                              MD025212
     C                     ENDIF                                                            MD025212
     C           WWRK      ADD  CANINT    CANORE                                           AR750543A
     C********** CANRIC    COMP CPREC                5050                         AR750543A AR821870
     C                     SUB  CPDEL     CPREC                                             AR821870
     C           CANORE    COMP CPREC                5050                                   AR821870
     C                     Z-ADDCPREC     WNREC                                            AR750543A
     C                     Z-ADDCPDEL     WNDEL                                            AR750543A
     C                     ELSE                                                            AR750543A
     C           FENRIC    SUB  WNDEL     WWRK    50
     C           WWRK      IFLT 0                                                           MD025212
     C                     ADD  100000    WWRK                                              MD025212
     C                     ENDIF                                                            MD025212
     C           WWRK      ADD  FENINT    FENORE
     C********** FENRIC    COMP WNREC                5050                                   AR821870
     C                     SUB  WNDEL     WNREC                                             AR821870
     C           WNREC     IFLT 0                                                           MD025212
     C                     ADD  100000    WNREC                                             MD025212
     C                     ENDIF                                                            MD025212
     C           FENORE    COMP WNREC                5050                                   AR821870
     C                     ENDIF                                                           AR750543A
      *
     C                     READ LEPEFLZF                 16
      *
     C           *IN16     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'LEPEFLZ 'DBFILE           ************
     C                     MOVEL'005'     DBASE            * DBERR 05 *
     C                     OUT  LDA                        ************
     C                     EXSR *PSSR
     C                     END
      *
     C                     Z-ADDFLDNOR    WLNORB
     C           FLDNOR    ADD  WLNOR     WLNORA
      *
     C                     READ LEPEFFZF                 16
      *
     C           *IN16     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'LEPEFFZ 'DBFILE           ************
     C                     MOVEL'006'     DBASE            * DBERR 06 *
     C                     OUT  LDA                        ************
     C                     EXSR *PSSR
     C                     END
      *
     C                     Z-ADDFFDNOR    WFNORB
     C           FFDNOR    ADD  WFNOR     WFNORA
      *
     C***********          WRITELER130A1                                  052986
     C                     Z-ADDL3NORE    LTNORE                                              CLE134
     C                     Z-ADDL3VLRF    LTVLRF                                              CLE134
     C                     Z-ADDL3VLRL    LTVLRL                                              CLE134
     C                     WRITELER130T2
      *
     C           *IN50     IFEQ '1'
     C**********           SETON                     U7U8                                   MD025212
     C                     SETON                     U8                                     MD025212
     C                     GOTO TREXIT
     C                     END
      *
      ** Reset trailer fields
     C           CCAP      IFEQ 'C'                                                        AR750543A
     C                     Z-ADDCANORE    CANRIC                                           AR750543A
     C                     Z-ADD0         CANINT                                           AR750543A
     C                     Z-ADD0         CANAMD                                           AR750543A
     C                     Z-ADD0         CANDEL                                           AR750543A
     C                     ELSE                                                            AR750543A
     C                     Z-ADDFENORE    FENRIC
     C                     Z-ADD0         FENINT
     C                     Z-ADD0         FENAMD
     C                     Z-ADD0         FENDEL
     C                     ENDIF                                                           AR750543A
     C                     UPDATLEFEEZF
     C                     Z-ADDWLNORA    FLDNOR
     C                     UPDATLEPEFLZF
     C                     Z-ADDWFNORA    FFDNOR
     C                     UPDATLEPEFFZF
     C***********          END                                            052986
      *
     C           TREXIT    TAG                                              0028
     C                     MOVE 'T'       LKRECI                            0028
     C           LKNTOT    ADD  2         LKNORE                            0028
     C                     WRITELKEYFEZF                                    0028
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           1         SETLLLEPK3ZZ                                                       CLE134
     C                     READ LEPK3ZZ                  88                                   CLE134
     C           *IN88     IFEQ *OFF                                                          CLE134
     C                     ADD  L3NORE    LKNORE                                              CLE134
     C                     ADD  L3VLRF    LKVLRF                                              CLE134
     C                     ADD  L3VLRL    LKVLRL                                              CLE134
     C                     UPDATLKEYF3ZF                                                      CLE134
     C                     ELSE                                                               CLE134
     C                     Z-ADDL3NORE    LKNORE                                              CLE134
     C                     ADD  2         LKNORE                                              CLE134
     C                     Z-ADDL3VLRF    LKVLRF                                              CLE134
     C                     Z-ADDL3VLRL    LKVLRL                                              CLE134
     C                     WRITELKEYF3ZF                                                      CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                     0028
     C********** TREXIT    ENDSR                                            0028
     C                     ENDSR                                            0028
      *
      ****************************************************************    CLE007
     C/EJECT                                                              CLE007
      ********************************************************************CLE007
      *                                                                   CLE007
      *  RTLX - Adds Record to LEPXTAB once a fee record is flagged       CLE007
      *         for reversal after facility/loan had been settled.        CLE007
      *                                                                   CLE007
      *  CALLED FROM: REVERS                                              CLE007
      *                                                                   CLE007
      *  CALLS:  ZHASH                                                    CLE007
      *                                                                   CLE007
      ********************************************************************CLE007
     C           RTLX      BEGSR                                          CLE007
     C                     MOVE 'R'       RECI                            CLE007
     C********** FELOAN    IFEQ 0                                                      CLE007 CLE148
     C           FELOAN    IFEQ *BLANKS                                                       CLE148
     C**********           MOVEL'F'       LNRFA                                      CLE007 MD050111
     C                     MOVEL' '       LNRFA                                             MD050111
     C                     MOVE FEFACL    LNRFA                           CLE007
     C                     MOVE 'F'       RCDT                            CLE007
     C                     ELSE                                           CLE007
     C                     MOVE FELOAN    LNRFA                           CLE007
     C                     MOVE *BLANK    RCDT                            CLE007
     C                     ENDIF                                          CLE007
     C                     Z-ADDLKEDAT    VDAT                            CLE007
     C***********          Z-ADDLASQ      LASNS                     CLE007154048
     C                     Z-ADDFEFSEQ    LASNS                           154048
     C                     MOVE *BLANKS   LTYP                            CLE007
     C                     MOVE *BLANKS   SUTP                            CLE007
     C                     MOVE *BLANKS   CLAS                                                CLE042
     C                     Z-ADD0         PTYP                            CLE007
     C                     MOVE 'LF'      AMTP                            CLE007
     C                     MOVE FEFCCY    CCY                             CLE007
     C                     Z-ADDLKEAMT    EAMT                            CLE007
     C                     MOVE 'N'       PROCES                                              CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
      *                                                                                       CLE031
      * If Participant Fee, and pay settlement currency not blank...                          CLE031
     C           PTFI      IFNE *BLANK                                                        CLE031
     C           FEPSCY    ANDNE*BLANKS                                                       CLE031
     C                     MOVE FEPSCY    WRKCCY                                              CLE031
     C                     Z-ADDFEPEXR    WRKEXR                                              CLE031
     C                     MOVE FEPEXI    WRKEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      * If not Participant Fee, and receive settlement ccy not blank...                       CLE031
     C           PTFI      IFEQ *BLANK                                                        CLE031
     C           FESCCY    ANDNE*BLANKS                                                       CLE031
     C                     MOVE FESCCY    WRKCCY                                              CLE031
     C                     Z-ADDFEREXR    WRKEXR                                              CLE031
     C                     MOVE FEREXI    WRKEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           WRKCCY    IFNE FEFCCY                                                        CLE031
     C                     MOVE 'Y'       PROCES                                              CLE031
     C                     Z-ADD1         Y       30                                          CLE031
     C           FEFCCY    LOKUPWCYA,Y                   13                                   CLE031
     C                     MOVELWINA,Y    FEINCY                                              CLE031
      *                                                                                       CLE031
     C                     Z-ADD1         Y       30                                          CLE031
     C           WRKCCY    LOKUPWCYA,Y                   13                                   CLE031
      *                                                                                       CLE031
      ** If settlement ccy is 'In', or if Fee ccy is 'In' & settlement                        CLE031
      *  ccy is EUR, ignore, as this will be processed in LE0470.                             CLE031
      * Or, if this is 'settlement method 09' with Set09 = 'T', ignore                        218782
      * as System Value Set09 = 'T' is use transaction currency instead                       218782
     C           WINA,Y    IFEQ 'Y'                                                           CLE031
     C           WRKCCY    OREQ BKEURO                                                        CLE031
     C           FEINCY    ANDEQ'Y'                                                           CLE031
     C           FESTTL    OREQ 09                                                            218782
     C           CLE033    ANDEQ'Y'                                                           218782
     C           SET09     ANDEQ'T'                                                           218782
     C                     MOVE 'N'       PROCES                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDIF                           END WRKCCY NE F                    CLE031
      *                                                                                       CLE031
     C           PROCES    IFEQ 'Y'                                                           CLE031
     C                     MOVE WRKCCY    CCY                                                 CLE031
     C           WRKEXI    IFEQ 'M'                                                           CLE031
     C           EAMT      MULT WRKEXR    EAMT                                                CLE031
     C                     ELSE                                                               CLE031
     C           EAMT      DIV  WRKEXR    EAMT                                                CLE031
     C                     ENDIF                           END WRKEXI = M                     CLE031
      *                                                                                       CLE031
     C                     ENDIF                           END PROCES = Y                     CLE031
      *                                                                                       CLE031
     C                     ENDIF                           END CLE031 = Y                     CLE031
      *                                                                                       CLE031
     C                     MOVE FEBRCA    BRCA                            CLE007
     C                     MOVE FECNUM    CNUM                            CLE007
     C           PTFI      IFEQ 'P'                                       CLE007
     C           PTFI      OREQ 'S'                                                           CLE106
     C           PTFI      OREQ 'R'                                                           CLE106
     C                     MOVE 'P'       PYRC                            CLE007
     C                     ENDIF                                          CLE007
     C           PTFI      IFEQ *BLANK                                    CLE007
     C                     MOVE 'R'       PYRC                            CLE007
     C                     ENDIF                                          CLE007
     C                     MOVE *BLANK    INTC                            CLE007
     C                     Z-ADD0         PRI1                            CLE007
     C                     Z-ADD0         PRI2                            CLE007
     C                     Z-ADD0         PRI3                            CLE007
     C                     Z-ADD0         PRI4                            CLE007
     C                     Z-ADD0         TIND                            CLE007
     C                     MOVE RSTM      RRST                            CLE007
     C                     MOVE RONS      RRON                            CLE007
     C                     MOVE RIBN      RRIB                            CLE007
     C                     MOVE RIBA      RRBA                            CLE007
     C                     MOVE ROBN      RROB                            CLE007
     C                     MOVE ROCN      RROC                            CLE007
     C                     MOVE FESTTL    SETP                            CLE007
     C                     MOVE FEOSBR    OSBR                            CLE007
     C                     MOVELFEOURS    OSAC                            155275
     C                     WRITELEPXTABF                                  CLE007
     C                     ADD  1         WRECTR                          CLE007
     C                     Z-ADD1         Z                               CLE007
     C                     Z-ADD2         S                               CLE007
     C           EAMT      DIV  1000      ZZAMT                           CLE007
     C                     Z-ADDWHRWN     ZZTOTI                          CLE007
     C                     Z-ADDWHRDC     ZZTOTD                          CLE007
     C                     EXSR ZHASH                                     CLE007
     C                     Z-ADDZZTOTI    WHRWN                           CLE007
     C                     Z-ADDZZTOTD    WHRDC                           CLE007
     C                     ENDSR                                          CLE007
      *                                                                   CLE007
      ****************************************************************
      /EJECT                                                                                  CGL020
      *****************************************************************                       CGL020
      *                                                               *                       CGL020
      *  SRAMLI - Determine AML Pay/Receive Instruction Control       *                       CGL020
      *                                                               *                       CGL020
      *****************************************************************                       CGL020
      *                                                                                       CGL020
     C           SRAMLI    BEGSR                                                              CGL020
      *                                                                                       CGL020
     C********** FELOAN    IFGT 0                                                      CGL020 CLE148
     C           FELOAN    IFGT *BLANKS                                                       CLE148
     C           FELOAN    ANDNE'000000'                                                      CLE134
      *                                                                                       CGL020
      ** Loan based                                                                           CGL020
      *                                                                                       CGL020
     C           WLNKEY    CHAINCLOAN                15                                       CGL020
      *                                                                                       CGL020
      ** Database error                                                                       CGL020
      *                                                                                       CGL020
     C           *IN15     IFEQ *ON                                                           CGL020
     C           *LOCK     IN   LDA                                                           CGL020
     C                     MOVELFELOAN    DBKEY                                               CGL020
     C                     Z-ADD21        DBASE                                               CGL020
     C                     MOVEL'CLOAN'   DBFILE                                              CGL020
     C                     OUT  LDA                                                           CGL020
     C                     EXSR *PSSR                                                         CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     MOVELSTLNS3    STLNS1                                              CGL020
     C                     EXSR SRAMPR                                                        CGL020
      *                                                                                       CGL020
     C                     ELSE                                                               CGL020
      *                                                                                       CGL020
      ** Facility based                                                                       CGL020
      *                                                                                       CGL020
     C                     MOVELFEFACL    FCFTYP                                              CGL020
     C                     MOVE FEFACL    FCFNUM                                              CGL020
      *                                                                                       CGL020
     C           FCKEY     CHAINFCLTY                15                                       CGL020
      *                                                                                       CGL020
      ** Database error                                                                       CGL020
      *                                                                                       CGL020
     C           *IN15     IFEQ *ON                                                           CGL020
     C           *LOCK     IN   LDA                                                           CGL020
     C                     MOVELWFCKEY    DBKEY                                               CGL020
     C                     Z-ADD22        DBASE                                               CGL020
     C                     MOVEL'FCLTYFM' DBFILE                                              CGL020
     C                     OUT  LDA                                                           CGL020
     C                     EXSR *PSSR                                                         CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     MOVELSTLNS4    STLNS1                                              CGL020
     C                     EXSR SRAMPR                                                        CGL020
      *                                                                                       CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     ENDSR                                                              CGL020
      *                                                                                       CGL020
      *****************************************************************                       CGL020
      /EJECT                                                                                  CGL020
      *****************************************************************                       CGL020
      *                                                               *                       CGL020
      *  SRAMPR - Determine AML Pay/Receive Instructions              *                       CGL020
      *                                                               *                       CGL020
      *****************************************************************                       CGL020
      *                                                                                       CGL020
     C           SRAMPR    BEGSR                                                              CGL020
      *                                                                                       CGL020
     C           LKOSAC    IFEQ *BLANKS                                                       CGL020
     C                     MOVE *BLANKS   F1RACT                                              CGL020
     C                     MOVE *BLANKS   F1RCTY                                              CGL020
     C                     MOVE *BLANKS   F1RBNK                                              CGL020
     C                     MOVE *BLANKS   F1RCDE                                              CGL020
     C                     MOVE *BLANKS   F1PACT                                              CGL020
     C                     MOVE *BLANKS   F1PCTY                                              CGL020
     C                     MOVE *BLANKS   F1PBNK                                              CGL020
     C                     MOVE *BLANKS   F1PCDE                                              CGL020
     C                     MOVE *BLANKS   F1DACT                                              CGL020
     C                     MOVE *BLANKS   F1DCTY                                              CGL020
     C                     MOVE *BLANKS   F1DBNK                                              CGL020
     C                     Z-ADD0         F1SDAT                                              CGL020
      *                                                                                       CGL020
     C                     ELSE                                                               CGL020
      *                                                                                       CGL020
     C                     CALL AMLPRI                                                        CGL020
     C                     PARM           WWROCN                                              CGL020
     C                     PARM           WWROBN                                              CGL020
     C                     PARM           WWPOCN                                              CGL020
     C                     PARM           WWPOBN                                              CGL020
     C                     PARM           WWBENN                                              CGL020
     C                     PARM           WWBENA                                              CGL020
     C                     PARM           WWAWBN                                              CGL020
     C                     PARM           WWAWBA                                              CGL020
     C                     PARM           F1RACT                                              CGL020
     C                     PARM           F1RCTY                                              CGL020
     C                     PARM           F1RBNK                                              CGL020
     C                     PARM           F1RCDE                                              CGL020
     C                     PARM           F1PACT                                              CGL020
     C                     PARM           F1PCTY                                              CGL020
     C                     PARM           F1PBNK                                              CGL020
     C                     PARM           F1PCDE                                              CGL020
     C                     PARM           F1DACT                                              CGL020
     C                     PARM           F1DCTY                                              CGL020
     C                     PARM           F1DBNK                                              CGL020
      *                                                                                       CGL020
     C                     Z-ADDFESDAT    F1SDAT                                              CGL020
      *                                                                                       CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     ENDSR                                                              CGL020
      *                                                                                       CGL020
      *****************************************************************                       CGL020
     C/TITLE SRLECF                                                                           CAS009
      *****************************************************************                       CAS009
      *                                                               *                       CAS009
      *  SRLECF - Record a cash flow event.                           *                       CAS009
      *                                                               *                       CAS009
      *  Called from:  DETAIL                                         *                       CAS009
      *                                                               *                       CAS009
      *  Calls:  ZFREQB                                               *                       CAS009
      *                                                               *                       CAS009
      *****************************************************************                       CAS009
     C           SRLECF    BEGSR                                                              CAS009
      *                                                                                       CAS009
     C                     MOVE FEAUTO    WFEAUT                                              CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           WFEAUT    IFEQ 'C'                                                           CLE134
     C           FEAUT2    OREQ 'C'                                                           CLE134
     C                     MOVE 'Y'       WFEAUT                                              CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     MOVE ' '       WEXIST                                              238569
     C           CAS009    IFEQ 'Y'                                                           238569
     C           FERECI    ANDEQ'*'                                                           238569
     C           CAS016    OREQ 'Y'                                                           CAS016
     C********** FEAUTO    ANDEQ'Y'                                                  CAS016 AR750638
     C           WFEAUT    ANDEQ'Y'                                                           CLE134
      *                                                                                       238569
     C           KFEE      CHAINLECFLSL1             22                                       CAS016
     C           FERECI    IFEQ '*'                                                           238569
     C           *IN22     OREQ '0'                                                           CAS016
     C                     MOVE 'Y'       WEXIST  1                                           238569
     C                     ENDIF                                                              238569
     C                     ENDIF                                                              238569
     C           WLNKEY    CHAINCLOAN                22                                       262553
      *                                                                                       238569
     C           WEXIST    IFEQ ' '                                                           238569
     C           *IN22     ANDEQ*OFF                                                          262553
     C                     CLEARLECFLSD0                                                      CAS009
      *                                                                                       CAS009
     C**********           Z-ADDLNRF      LFLNRF                                       CAS009 232320
     C**********           Z-ADDFELOAN    LFLNRF                                       232320 CLE148
     C                     MOVELFELOAN    LFLNRF                                              CLE148
     C                     Z-ADDFEFSEQ    LFFSEQ                                              CAS009
     C**********           MOVE LTYP      LFLTYP                                       CAS009 232319
     C**********           MOVE SUTP      LFLNST                                       CAS009 232319
     C                     MOVE FELTYP    LFLTYP                                              232319
     C                     MOVE FESUTP    LFLNST                                              232319
     C                     MOVE FECLAS    LFLNCL                                              CLE042
     C                     Z-ADDLKEDAT    LFFLDT                                              CAS009
      *                                                                                       CAS009
     C                     MOVE *BLANK    LFDATE                                              CAS009
     C********** FEDDAT    IFNE 0                                                      CAS016 262553
     C**********           Z-ADDFEDDAT    ZDAYNO                                       CAS016 262553
     C**********           ELSE                                                        CAS016 262553
     C                     Z-ADDLKEDAT    ZDAYNO                                              CAS009
     C**********           ENDIF                                                       CAS016 262553
     C                     EXSR ZDATE2                                                        CAS009
     C                     MOVE ZADATE    LFDATE                                              CAS009
      *                                                                                       CAS009
     C           FEFCCY    IFEQ CCY                                                           CAS009
     C                     Z-ADDFEFAMT    LFCAMT                                              CAS016
     C**********           Z-ADDLKEAMT    LFCAMT                                       CAS009 CAS016
     C                     ELSE                                                               CAS009
     C                     Z-ADDFEFAMT    ZAMTCI                                              CAS016
     C**********           Z-ADDLKEAMT    ZAMTCI                                       CAS009 CAS016
     C                     EXSR CNVF2L                                                        CAS009
     C                     Z-ADDZAMTCO    LFCAMT                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     SELEC                                                              CAS009
      *                                                                                       CAS009
     C           FEADJY    WHEQ 'Y'                                                           CAS009
     C           FEPYON    ANDEQ'E'                                                           CAS009
     C           FEADJY    OREQ 'Y'                                                           CAS009
     C           FEPYON    ANDEQ'N'                                                           CAS009
     C                     MOVE 'EFAC'    LFFTYP                                              CAS009
      *                                                                                       CAS009
     C           FEADJY    WHEQ 'Y'                                                           CAS009
     C           FEPYON    ANDEQ'S'                                                           CAS009
     C                     MOVE 'SFAM'    LFFTYP                                              CAS009
      *                                                                                       CAS009
     C           FEADJY    WHEQ 'Y'                                                           CAS009
     C           FEPYON    ANDEQ' '                                                           CAS009
     C                     MOVE 'SFBT'    LFFTYP                                              CAS009
      *                                                                                       CAS009
     C           FEADJY    WHNE 'Y'                                                           CAS009
     C           FEPYON    ANDEQ'E'                                                           CAS009
     C           FEADJY    ORNE 'Y'                                                           CAS009
     C           FEPYON    ANDEQ'N'                                                           CAS009
     C                     MOVE 'EFAN'    LFFTYP                                              CAS009
      *                                                                                       CAS009
     C           FEADJY    WHNE 'Y'                                                           CAS009
     C           FEPYON    ANDEQ'S'                                                           CAS009
     C                     MOVE 'SFAN'    LFFTYP                                              CAS009
      *                                                                                       CAS009
     C           FEADJY    WHNE 'Y'                                                           CAS009
     C           FEPYON    ANDEQ' '                                                           CAS009
     C                     MOVE 'SFBN'    LFFTYP                                              CAS009
      *                                                                                       CAS009
     C                     ENDSL                                                              CAS009
      *                                                                                       CAS009
     C                     MOVE 'I'       LFIOIN                                              CAS009
     C           FEDDAT    IFNE 0                                                             CAS016
     C           FEDDAT    SUB  BJRDNB    LFNDYP                                              CAS016
     C                     ELSE                                                               CAS016
     C           LKEDAT    SUB  BJRDNB    LFNDYP                                              CAS009
     C                     ENDIF                                                              CAS016
     C                     MOVE ICBS      LFICBS                                              CAS009
      *                                                                                       CAS009
      ** Calculation methods are:                                                             CAS009
      *                                                                                       CAS009
     C                     SELEC                                                              CAS009
      *                                                                                       CAS009
      ** 1 Actual/365, 4 365/365 (excluding 29/02)                                            CAS009
      *                                                                                       CAS009
     C           ICBS      WHEQ 1                                                             CAS009
     C           ICBS      OREQ 4                                                             CAS009
     C                     Z-ADD365       LFNDYY                                              CAS009
      *                                                                                       CAS009
      ** 2 Actual/360, 3 360/360 (sometimes called 30/360), 5 365/360 (excluding 29/02)       CAS009
      *                                                                                       CAS009
     C           ICBS      WHEQ 2                                                             CAS009
     C           ICBS      OREQ 3                                                             CAS009
     C           ICBS      OREQ 5                                                             CAS009
     C                     Z-ADD360       LFNDYY                                              CAS009
      *                                                                                       CAS009
      ** 6 Actual/366                                                                         CAS009
      *                                                                                       CAS009
     C           ICBS      WHEQ 6                                                             CAS009
     C                     Z-ADD366       LFNDYY                                              CAS009
      *                                                                                       CAS009
     C                     ENDSL                                                              CAS009
      *                                                                                       CAS009
     C**********           MOVE INTR      LFIRAT                                       CAS009 232319
     C                     Z-ADDINTR      LFIRAT                                              232319
     C**********           MOVE CNUM      LFCNUM                                       CAS009 232319
     C**********           MOVE BRCA      LFBRCA                                       CAS009 232319
     C**********           MOVE CCY       LFCYCD                                       CAS009 232319
     C                     MOVE FECNUM    LFCNUM                                              232319
     C                     MOVE FEBRCA    LFBRCA                                              232319
     C                     MOVE FEFCCY    LFCYCD                                              232319
     C                     MOVE BOKC      LFBKCD                                              CAS009
      *                                                                                       CAS009
     C**********           Z-ADDZ9CPAM    LFCPAM                                       CAS009 262553
     C                     Z-ADDCPAM      LFCPAM                                              262553
     C                     MOVE FSYLDC    LFYLDC                                              CAS009
     C                     MOVE FSFYLD    LFFYLD                                              CAS009
     C**********           MOVE RTSP      LFSPRR                                       CAS009 232319
     C                     Z-ADDRTSP      LFSPRR                                              232319
      *                                                                                       CAS009
     C                     WRITELECFLSD0                                                      CAS009
     C                     ENDIF                                                              238569
      *                                                                                       CAS009
     C********** FEFCCY    IFNE CCY                                                    CAS009 231710
      *****************************************************************                CAS009 231710
      ***Update*Amortisation*Details*if*Fee*Currency*is****************                CAS009 231710
      ***different*from*Loan*Currency.*********************************                CAS009 231710
      *****************************************************************                CAS009 231710
     C**********           Z-ADDLNRF      KTRAN                                        CAS009 231710
     C**********           Z-ADDFEFSEQ    KFSEQ                                        CAS009 231710
      *****************************************************************                CAS009 231710
     C********** FEPYON    IFNE 'N'                                                    CAS009 231710
      *****************************************************************                CAS009 231710
     C**********           Z-ADDFEPSTD    KSDAM                                        CAS009 231710
     C********** KEIRA     CHAINLEEIRAD4             22                                CAS009 231710
     C********** *IN22     IFEQ '0'                                                    CAS009 231710
     C**********           Z-ADDLFCAMT    EAAMNT                                       CAS009 231710
     C**********           Z-ADDZEXCH     EAXRAT                                       CAS009 231710
     C**********           MOVE ZMD       EAMDIN                                       CAS009 231710
     C**********           UPDATLEEIRAD4                                               CAS009 231710
     C**********           ENDIF                                                       CAS009 231710
      *****************************************************************                CAS009 231710
     C**********           ELSE                                                        CAS009 231710
      *****************************************************************                CAS009 231710
     C**********           Z-ADDLKEDAT    KSDAM                                        CAS009 231710
     C********** KEIRA     SETLLLEEIRAD4                                               CAS009 231710
     C**********           READPLEEIRAD4                 22                            CAS009 231710
     C********** *IN22     IFEQ '0'                                                    CAS009 231710
     C********** KTRAN     ANDEQEATRAN                                                 CAS009 231710
     C**********           Z-ADDLFCAMT    EAAMNT                                       CAS009 231710
     C**********           Z-ADDZEXCH     EAXRAT                                       CAS009 231710
     C**********           MOVE ZMD       EAMDIN                                       CAS009 231710
     C**********           UPDATLEEIRAD4                                               CAS009 231710
     C**********           ENDIF                                                       CAS009 231710
      *****************************************************************                CAS009 231710
     C**********           ENDIF                                                       CAS009 231710
      *****************************************************************                CAS009 231710
     C**********           ENDIF                                                       CAS009 231710
      *                                                                                       CAS009
     C                     ENDSR                                                              CAS009
      *****************************************************************                       CAS009
      /TITLE Convert Amount                                                                   CAS009
      *****************************************************************                       CAS009
      *                                                               *                       CAS009
      *  CNVF2L - Convert from Fee currency to Loan currency          *                       CAS009
      *                                                               *                       CAS009
      *  Called from:  DETAIL                                         *                       CAS009
      *                                                               *                       CAS009
      *  Calls:  ZCONVZ1                                              *                       CAS009
      *                                                               *                       CAS009
      *****************************************************************                       CAS009
      *                                                                                       CAS009
     C           CNVF2L    BEGSR                                                              CAS009
      *                                                                                       CAS009
     C                     CALL 'AOCURRR0'                                                    CAS009
     C                     PARM *BLANKS   WRTCD                                               CAS009
     C                     PARM '*KEY   ' WOPTN                                               CAS009
     C                     PARM           FEFCCY                                              CAS009
     C           SDCURR    PARM SDCURR    DSSDY                                               CAS009
      *                                                                                       CAS009
     C                     Z-ADDA6SPRT    WFEERT 138                                          CAS009
     C                     MOVE A6MDIN    WFEEMD  1                                           CAS009
     C                     Z-ADDA6NBDP    WFEEDP  10                                          CAS009
      *                                                                                       CAS009
     C                     CALL 'AOCURRR0'                                                    CAS009
     C                     PARM *BLANKS   WRTCD                                               CAS009
     C                     PARM '*KEY   ' WOPTN                                               CAS009
     C                     PARM           Z9CCY                                               CAS009
     C           SDCURR    PARM SDCURR    DSSDY                                               CAS009
      *                                                                                       CAS009
     C                     Z-ADDA6SPRT    WLONRT 138                                          CAS009
     C                     MOVE A6MDIN    WLONMD  1                                           CAS009
     C                     Z-ADDA6NBDP    WLONDP  10                                          CAS009
      *                                                                                       CAS009
     C                     Z-ADDWFEERT    ZRATE1                                              CAS009
     C                     MOVE WFEEMD    ZMDI1                                               CAS009
     C                     Z-ADDWLONRT    ZRATE2                                              CAS009
     C                     MOVE WLONMD    ZMDI2                                               CAS009
     C                     EXSR ZXRATE                                                        CAS009
     C                     Z-ADDZRATEX    ZEXCH                                               CAS009
     C                     MOVE ZMDIX     ZMD                                                 CAS009
      *                                                                                       CAS009
     C                     CALL 'ZCONVZ1'                                                     CAS009
     C                     PARM           ZAMTCI 150                                          CAS009
     C                     PARM           ZEXCH  138                                          CAS009
     C                     PARM           ZMD     1                                           CAS009
     C                     PARM FEFCCY    ZCCYI   3                                           CAS009
     C                     PARM Z9CCY     ZCCYO   3                                           CAS009
     C                     PARM WFEEDP    ZCDPI   10                                          CAS009
     C                     PARM WLONDP    ZCDPO   10                                          CAS009
     C                     PARM           ZAMTCO 150                                          CAS009
      *                                                                                       CAS009
     C                     ENDSR                                                              CAS009
      *                                                                                       CAS009
      *****************************************************************                       CAS009
      /TITLE Update Total Accruing/Amortising Fee                                             CAS009
      *****************************************************************                       CAS009
      *                                                               *                       CAS009
      *  TOTFEE - Update Total Accruing/Amortising Fee                *                       CAS009
      *                                                               *                       CAS009
      *  Called from:  DETAIL                                         *                       CAS009
      *                                                               *                       CAS009
      *  Calls:  ZCONVZ1                                              *                       CAS009
      *                                                               *                       CAS009
      *****************************************************************                       CAS009
      *                                                                                       CAS009
     C           TOTFEE    BEGSR                                                              CAS009
      *                                                                                       CAS009
      ** If fee is entered today or reverse today                                             CAS009
      *                                                                                       CAS009
     C           FEORED    IFEQ BJRDNB                                                        CAS009
     C           FELCHD    OREQ BJRDNB                                                        CAS009
     C           FERECI    ANDEQ'R'                                                           CAS009
      *                                                                                       CAS009
     C                     MOVE 'D'       Z9KYID                                              CAS009
     C**********           Z-ADDFELOAN    Z9LNRF                                       CAS009 CLE148
     C                     MOVELFELOAN    Z9LNRF                                              CLE148
      *                                                                                       CAS009
     C           Z9KEY     CHAINZ9LNCLF              18                                       CAS009
      *                                                                                       CAS009
     C           *IN18     IFEQ '0'                                                           CAS009
      *                                                                                       CAS009
     C           FEFCCY    IFEQ Z9CCY                                                         CAS009
     C                     Z-ADDFEFAMT    WFAMT  130                                          CAS009
     C                     ELSE                                                               CAS009
     C                     Z-ADDFEFAMT    ZAMTCI                                              CAS009
     C                     EXSR CNVF2L                                                        CAS009
     C                     Z-ADDZAMTCO    WFAMT                                               CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C********** FEORED    IFEQ BJRDNB                                               CAS009 BUG13140
     C           FEORED    IFEQ BKAPDT                                                      BUG13140
     C           FERECI    ANDEQ'D'                                                           CAS009
      *                                                                                       CAS009
     C           FEPYON    IFNE 'N'                                                         BUG13038
     C                     ADD  WFAMT     Z9TFDP                                              CAS009
     C                     ENDIF                                                            BUG13038
     C           FEADJY    IFEQ 'Y'                                                           CAS009
     C           FEPYON    IFNE 'N'                                                         BUG13038
     C                     ADD  WFAMT     Z9FDPA                                              CAS009
     C                     ENDIF                                                            BUG13038
      *                                                                                     BUG13038
     C**********           SELEC                                                       CAS009 238569
      *                                                                                       CAS009
     C********** FEPYON    WHEQ 'E'                                                    CAS009 238569
     C********** FEPYON    OREQ 'N'                                                    CAS009 238569
      ** Accruing fee                                                                         CAS009
     C**********           ADD  WFAMT     Z9TFAC                                       CAS009 238569
     C********** FEPYON    WHEQ 'S'                                                    CAS009 238569
      ** Amortising fee                                                                       CAS009
     C           FEAMRI    IFEQ 'N'                                                           258222
     C                     ADD  WFAMT     Z9TFAM                                              CAS009
     C                     ENDIF                                                              258222
     C********** FEPYON    WHEQ ' '                                                    CAS009 238569
      ** Bullet/One off fee                                                                   CAS009
     C**********           ADD  WFAMT     Z9TFOF                                       CAS009 238569
     C**********           ENDSL                                                       CAS009 238569
      *                                                                                       CAS009
     C                     UPDATZ9LNCLF                                                       CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C           FELCHD    IFEQ BJRDNB                                                        CAS009
     C           FEORED    ANDNEBJRDNB                                                        CAS009
     C           FERECI    ANDEQ'R'                                                           CAS009
     C           FSAMRM    ANDEQ'L'                                                           238569
     C                     SUB  WFAMT     Z9TFDP                                              CAS009
     C           FEADJY    IFEQ 'Y'                                                           CAS009
     C                     SUB  WFAMT     Z9FDPA                                              CAS009
     C**********           SELEC                                                       CAS009 238569
      *                                                                                       CAS009
     C********** FEPYON    WHEQ 'E'                                                    CAS009 238569
     C********** FEPYON    OREQ 'N'                                                    CAS009 238569
      ** Accruing fee                                                                         CAS009
     C**********           SUB  WFAMT     Z9TFAC                                       CAS009 238569
     C********** FEPYON    WHEQ 'S'                                                    CAS009 238569
      ** Amortising fee                                                                       CAS009
     C           FEAMRI    IFEQ 'N'                                                           258222
     C                     SUB  WFAMT     Z9TFAM                                              CAS009
     C                     ENDIF                                                              258222
     C********** FEPYON    WHEQ ' '                                                    CAS009 238569
      ** Bullet/One off fee                                                                   CAS009
     C**********           SUB  WFAMT     Z9TFOF                                       CAS009 238569
     C**********           ENDSL                                                       CAS009 238569
      *                                                                                       CAS009
     C                     UPDATZ9LNCLF                                                       CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDSR                                                              CAS009
      *                                                                                       CAS009
      *****************************************************************                       CAS009
     C/TITLE SR/INIT
      ********************************************************************
      *
      *  INIT - PERFORM FIRST CYCLE CALCS - ACCESS BANK DETAILS
      *
      *  CALLED FROM: MAIN PROCESSING
      *
      *  CALLS: *PSSR, ZDATE1, ZDATE2, LERDATEF
      *
      ********************************************************************
      *
     C           INIT      BEGSR
      *
      ** Set up copyright statement
     C                     MOVEACPY@      BIS@   80
      *
      ** Define LDA
     C           *NAMVAR   DEFN           LDA
      *
      ** Lock in dataarea RUNDAT
     C           *NAMVAR   DEFN           RUNDAT
     C           *LOCK     IN   RUNDAT
     C/COPY WNCPYSRC,LER130C001
      *
      ** Set sequence number to zero
     C                     MOVE *BLANKS   SEQ
      *
      ** If system is not multibranching do not output branch details
      ** on print report
      *
     C           MBIN      IFNE 'Y'
     C                     SETON                     35
     C                     END
      *
      ** Set up work fields
     C           *LIKE     DEFN FEFCOD    WCOD
     C           *LIKE     DEFN LKEAMT    DAYACR                          090939
     C           *LIKE     DEFN LKEAMT    WSAMT                                               CLE034
     C           *LIKE     DEFN LKEAMT    TOTAMT                                              CLE034
     C           *LIKE     DEFN LKEAMT    WKAMT                                               CLE034
     C           *LIKE     DEFN FEOURS    WSOURS                                              CLE034
     C           *LIKE     DEFN FESTTL    WSSTTL                                              CLE034
     C           *LIKE     DEFN FEOSBR    WSOSBR                                              CLE034
     C           *LIKE     DEFN FESCCY    WSSCCY                                              CLE034
     C           *LIKE     DEFN FEPSCY    WSPSCY                                              CLE034
     C           *LIKE     DEFN FEREXR    WSREXR                                              CLE034
     C           *LIKE     DEFN FEREXI    WSREXI                                              CLE034
     C           *LIKE     DEFN FEPEXR    WSPEXR                                              CLE034
     C           *LIKE     DEFN FEPEXI    WSPEXI                                              CLE034
     C           *LIKE     DEFN OSDB      WSOSDB                                              CLE034
     C           *LIKE     DEFN OMDB      WSOMDB                                              CLE034
     C           *LIKE     DEFN PSTM      WSPSTM                                              CLE034
     C           *LIKE     DEFN PONS      WSPONS                                              CLE034
     C           *LIKE     DEFN RSTM      WSRSTM                                              CLE034
     C           *LIKE     DEFN RONS      WSRONS                                              CLE034
     C                     Z-ADD0         WCOD
     C                     Z-ADD0         WNORE   50
     C                     Z-ADD0         WNDEL   50
     C                     Z-ADD0         CPDEL   50                                       AR750543A
     C                     Z-ADD0         LKNORE  50
     C                     Z-ADD0         LKNOR0  50
     C                     Z-ADD0         LKNTOT  50
     C/COPY WNCPYSRC,LEH00616
     C                     Z-ADD0         WNREV   50
     C                     Z-ADD0         WLNOR   50
     C                     Z-ADD0         WFNOR   50
     C                     Z-ADD0         HIRECS  50
     C                     MOVE '1'       *IN20
     C                     MOVEL'LER130  'DBPGM
      *
      ** Access bank details
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' WRTCD   7
     C                     PARM '*FIRST ' WOPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
     C           WRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDBANKPD'DBFILE           ************
     C                     MOVEL'007'     DBASE            * DBERR 07 *
     C                     OUT  LDA                        ************
     C                     EXSR *PSSR
     C                     END
      *                                                                   127966
      ** Access Module details                                            127966
     C                     CALL 'AOMMODR0'                                127966
     C                     PARM '*MSG   ' WRTCD                           127966
     C                     PARM '*FIRST ' WOPTN                           127966
     C           SDMMOD    PARM SDMMOD    DSFDY                           127966
     C           WRTCD     IFNE *BLANKS                                   127966
     C           *LOCK     IN   LDA                                       127966
     C                     MOVEL'SDMMODPD'DBFILE           ************   127966
     C                     MOVEL'013'     DBASE            * DBERR 13 *   127966
     C                     OUT  LDA                        ************   127966
     C                     EXSR *PSSR                                     127966
     C                     END                                            127966
      *
      ** Access general ledger details
     C**********           CALL 'AOGELRR0'                                                    CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*MSG   ' WRTCD   7
     C                     PARM '*FIRST ' WOPTN   7
     C********** SDGELR    PARM SDGELR    DSFDY                                               CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C           WRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA                        ************
     C                     MOVEL'SDGELRPD'DBFILE           * DBERR 08 *
     C                     MOVEL'008'     DBASE            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *                                                                                       CLE134
      ** CLE134 - Past Due Call Loans                                                         CLE134
      *                                                                                       CLE134
     C                     CALL 'AOSARDR0'                                                    CLE134
     C                     PARM *BLANKS   WRTCD                                               CLE134
     C                     PARM '*KEY   ' WOPTN                                               CLE134
     C                     PARM 'CLE134'  WSARD   6                                           CLE134
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE134
      *                                                                                       CLE134
     C           WRTCD     IFEQ *BLANKS                                                       CLE134
     C                     MOVE 'Y'       CLE134  1                                           CLE134
     C                     ELSE                                                               CLE134
     C                     MOVE 'N'       CLE134                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                   CLE005
      ** Check the switchable features file for the presence of CLE004    CLE005
      ** and CLE005. Set a flag to say if it is switched on               CLE005
      *                                                                   CLE005
     C                     CALL 'AOSARDR0'                                CLE005
     C                     PARM *BLANKS   WRTCD                           CLE005
     C                     PARM '*KEY   ' WOPTN                           CLE005
     C                     PARM 'CLE004'  WSARD   6                       CLE005
     C           SCSARD    PARM SCSARD    DSFDY                           CLE005
      *                                                                   CLE005
     C           WRTCD     IFEQ *BLANKS                                   CLE005
     C                     MOVE 'Y'       CLE004  1                       CLE005
     C                     ELSE                                           CLE005
     C                     MOVE 'N'       CLE004                          CLE005
      *                                                                   CLE005
      ** Handle Database Error                                            CLE005
      *                                                                   CLE005
     C           WRTCD     IFNE '*NRF    '                                CLE005
     C           *LOCK     IN   LDA                        ************   CLE005
     C                     MOVEL'SCSARDPD'DBFILE           ************   CLE005
     C                     MOVEL'016'     DBASE            * DBERR 16 *   CLE005
     C                     MOVEL'CLE004'  DBKEY            ************   CLE005
     C                     OUT  LDA                                       CLE005
     C                     EXSR *PSSR                                     CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     CALL 'AOSARDR0'                                CLE005
     C                     PARM *BLANKS   WRTCD                           CLE005
     C                     PARM '*KEY   ' WOPTN                           CLE005
     C                     PARM 'CLE005'  WSARD   6                       CLE005
     C           SCSARD    PARM SCSARD    DSFDY                           CLE005
      *                                                                   CLE005
     C           WRTCD     IFEQ *BLANKS                                   CLE005
     C                     MOVE 'Y'       CLE005  1                       CLE005
     C                     ELSE                                           CLE005
     C                     MOVE 'N'       CLE005                          CLE005
      *                                                                   CLE005
      ** Handle Database Error                                            CLE005
      *                                                                   CLE005
     C           WRTCD     IFNE '*NRF    '                                CLE005
     C           *LOCK     IN   LDA                        ************   CLE005
     C                     MOVEL'SCSARDPD'DBFILE           ************   CLE005
     C                     MOVEL'014'     DBASE            * DBERR 14 *   CLE005
     C                     MOVEL'CLE005'  DBKEY            ************   CLE005
     C                     OUT  LDA                                       CLE005
     C                     EXSR *PSSR                                     CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE007
      ** Check the switchable features file for the presence of CLE007.   CLE007
      ** Set a flag to say if it is switched on                           CLE007
      *                                                                   CLE007
     C                     CALL 'AOSARDR0'                                CLE007
     C                     PARM *BLANKS   WRTCD                           CLE007
     C                     PARM '*KEY   ' WOPTN                           CLE007
     C                     PARM 'CLE007'  WSARD   6                       CLE007
     C           SCSARD    PARM SCSARD    DSFDY                           CLE007
      *                                                                   CLE007
     C           WRTCD     IFEQ *BLANKS                                   CLE007
      *                                                                   CLE009
      ** Check the switchable features file for the presence of CLE009.   CLE009
      ** Set a flag to say if it is switched on                           CLE009
      *                                                                   CLE009
     C                     MOVE 'N'       CLE009  1                       CLE009
     C                     CALL 'AOSARDR0'                                CLE009
     C                     PARM *BLANKS   WRTCD                           CLE009
     C                     PARM '*VERIFY' WOPTN                           CLE009
     C                     PARM 'CLE009'  WSARD                           CLE009
     C           SCSARD    PARM SCSARD    DSFDY                           CLE009
      *                                                                   CLE009
     C           WRTCD     IFEQ *BLANKS                                   CLE009
     C                     MOVE 'Y'       CLE009                          CLE009
     C                     END                                            CLE009
      *                                                                   CLE009
     C           WRTCD     IFNE *BLANKS                                   CLE009
     C           WRTCD     ANDNE'*NRF   '                                 CLE009
      *                                                                   CLE009
      ** Call to program ended in error                                   CLE009
      *                                                                   CLE009
     C           *LOCK     IN   LDA                                       CLE009
     C                     MOVE *BLANKS   DBKEY                           CLE009
     C                     MOVEL'CLE009'  DBKEY            ************   CLE009
     C                     MOVE 'SCSARDPD'DBFILE           * DBERR 19 *   CLE009
     C                     Z-ADD19        DBASE            ************   CLE009
     C                     MOVEL'LER130'  DBPGM                           CLE009
     C                     OUT  LDA                                       CLE009
     C                     EXSR *PSSR                                     CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     MOVE 'Y'       CLE007  1                       CLE007
     C                     OPEN LEPXTAA                                   CLE007
     C                     OPEN LEPXTAB                                   CLE007
     C                     OPEN LEPXTAC                                   CLE007
     C                     MOVE 'H'       RECI                            CLE007
     C                     WRITELEPXTAAF                                  CLE007
     C                     Z-ADD1         WRECTR  50                      CLE007
     C                     Z-ADD0         WHRWN  150                      CLE007
     C                     Z-ADD0         WHRDC   30                      CLE007
     C                     ELSE                                           CLE007
     C                     MOVE 'N'       CLE007                          CLE007
      *                                                                   CLE007
      ** Handle Database Error                                            CLE007
      *                                                                   CLE007
     C           WRTCD     IFNE '*NRF    '                                CLE007
     C           *LOCK     IN   LDA                        ************   CLE007
     C                     MOVEL'SCSARDPD'DBFILE           ************   CLE007
     C                     MOVEL'015'     DBASE            * DBERR 15 *   CLE007
     C                     MOVEL'CLE007'  DBKEY            ************   CLE007
     C                     OUT  LDA                                       CLE007
     C                     EXSR *PSSR                                     CLE007
     C                     ENDIF                                          CLE007
      *                                                                   CLE007
     C                     ENDIF                                          CLE007
      *                                                                   179741
      ** Determine if Settlement Currency Conversion Upgrade              179741
      ** feature is installed                                             179741
      *                                                                   179741
     C                     CALL 'AOSARDR0'                                179741
     C                     PARM *BLANKS   WRTCD                           179741
     C                     PARM '*KEY   ' WOPTN                           179741
     C                     PARM 'CEU004'  WSARD                           179741
     C           SCSARD    PARM SCSARD    DSFDY                           179741
      *                                                                   179741
     C           WRTCD     IFEQ *BLANKS                                   179741
     C                     MOVE 'Y'       CEU004  1                       179741
     C                     ELSE                                           179741
     C                     MOVE 'N'       CEU004                          179741
      *                                                                   179741
     C           WRTCD     IFNE '*NRF    '                                179741
     C           *LOCK     IN   LDA                                       179741
     C                     MOVEL'LE0492  'DBPGM                           179741
     C                     MOVEL'SCSARDPD'DBFILE           ************   179741
     C                     Z-ADD51        DBASE            * DBERR 51 *   179741
     C                     MOVEL'CEU004'  DBKEY     P      ************   179741
     C                     OUT  LDA                                       179741
     C                     EXSR *PSSR                                     179741
     C                     ENDIF                                          179741
      *                                                                   179741
     C                     ENDIF                                          179741
     C/COPY WNCPYSRC,LEH00553
      *                                                                                       CSW208
      ** Access Switchable Features file for CSW208                                           CSW208
      *                                                                                       CSW208
     C                     CALL 'SWIF2008'                                                    CSW208
     C                     PARM *BLANKS   WRTCD                                               CSW208
      *                                                                                       CSW208
     C           WRTCD     IFEQ 'CSW2008'                                                     CSW208
     C                     MOVE 'Y'       CSW208  1                                           CSW208
     C                     ELSE                                                               CSW208
     C                     MOVE 'N'       CSW208                                              CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CGL020
      ** Determine if Midas Compliance Watch - Additional                                     CGL020
      ** Account Postings Information is installed                                            CGL020
      *                                                                                       CGL020
     C                     MOVE 'N'       CGL020  1                                           CGL020
     C                     CALL 'AOSARDR0'                                                    CGL020
     C                     PARM *BLANKS   WRTCD                                               CGL020
     C                     PARM '*VERIFY' WOPTN                                               CGL020
     C                     PARM 'CGL020'  WSARD                                               CGL020
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL020
      *                                                                                       CGL020
     C           WRTCD     IFNE *BLANKS                                                       CGL020
     C           WRTCD     ANDNE'*NRF   '                                                     CGL020
     C           *LOCK     IN   LDA                                                           CGL020
     C                     MOVEL'LER130'  DBPGM                                               CGL020
     C                     MOVEL'SCSARDPD'DBFILE                                              CGL020
     C                     Z-ADD20        DBASE                                               CGL020
     C                     MOVELWSARD     DBKEY                                               CGL020
     C                     OUT  LDA                                                           CGL020
     C                     EXSR *PSSR                                                         CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C           WRTCD     IFEQ *BLANKS                                                       CGL020
     C                     MOVE 'Y'       CGL020                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     MOVE *BLANK    F1FFLG                                              CGL020
     C                     Z-ADD0         F1FVAL                                              CGL020
     C                     Z-ADD0         F1FPCT                                              CGL020
      *                                                                                       CGL020
      ** Determine if Lending Enhancements                                                    CLE031
      ** (Switchable feature CLE031) is installed                                             CLE031
      *                                                                                       CLE031
     C                     CALL 'AOSARDR0'                                                    CLE031
     C                     PARM *BLANKS   WRTCD                                               CLE031
     C                     PARM '*KEY   ' WOPTN                                               CLE031
     C                     PARM 'CLE031'  WSARD                                               CLE031
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE031
      *                                                                                       CLE031
     C           WRTCD     IFEQ *BLANKS                                                       CLE031
     C                     MOVE 'Y'       CLE031  1                                           CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE 'N'       CLE031                                              CLE031
      *                                                                                       CLE031
     C           WRTCD     IFNE '*NRF    '                                                    CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'LER130  'DBPGM                                               CLE031
     C                     MOVEL'SCSARDPD'DBFILE           ************                       CLE031
     C                     Z-ADD21        DBASE            * DBERR 21 *                       CLE031
     C                     MOVEL'CLE031'  DBKEY     P      ************                       CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE034
      ** Determine if Lending Enhancements Phase 1 Priority 1A                                CLE034
      ** (Switchable feature CLE034) is installed                                             CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSARDR0'                                                    CLE034
     C                     PARM *BLANKS   WRTCD                                               CLE034
     C                     PARM '*KEY   ' WOPTN                                               CLE034
     C                     PARM 'CLE034'  WSARD                                               CLE034
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE034
      *                                                                                       CLE034
     C           WRTCD     IFNE *BLANKS                                                       CLE034
     C           WRTCD     ANDNE'*NRF    '                                                    CLE034
     C           *LOCK     IN   LDA                                                           CLE034
     C                     MOVEL'LER130  'DBPGM                                               CLE034
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE034
     C                     Z-ADD22        DBASE                                               CLE034
     C                     MOVEL'CLE034'  DBKEY                                               CLE034
     C                     OUT  LDA                                                           CLE034
     C                     EXSR *PSSR                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           WRTCD     IFEQ *BLANKS                                                       CLE034
     C                     MOVE 'Y'       CLE034  1                                           CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'N'       CLE034                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C*                                                                                       218782
     C**  Read switchable features file SCSARDPD using access object                          218782
     C**  to determine if switchable feature (CLE033) is switched ON                          218782
     C*                                                                                       218782
     C                     MOVE 'N'       CLE033  1                                           218782
     C*                                                                                       218782
     C                     CALL 'AOSARDR0'                                                    218782
     C                     PARM *BLANKS   WRTCD                                               218782
     C                     PARM '*VERIFY' WOPTN                                               218782
     C                     PARM 'CLE033'  WSARD                                               218782
     C           SCSARD    PARM SCSARD    DSFDY                                               218782
     C*                                                                                       218782
     C**  If feature is on, set up CLE033 variable                                            218782
     C*                                                                                       218782
     C           WRTCD     IFEQ *BLANKS                                                       218782
      *                                                                                       218782
     C                     MOVE 'Y'       CLE033                                              218782
      *                                                                                       218782
      * Check System Value Settle09Postings:                                                  218782
     C                     CALL 'AOSVALR0'                                                    218782
     C                     PARM *BLANKS   WRTCD                                               218782
     C                     PARM SVAL,1    P@OP01 20                                           218782
     C                     PARM *BLANKS   P@VL01200                                           218782
     C                     PARM *BLANKS   P@OP02 20                                           218782
     C                     PARM *BLANKS   P@VL02200                                           218782
     C                     PARM *BLANKS   P@OP03 20                                           218782
     C                     PARM *BLANKS   P@VL03200                                           218782
     C                     PARM *BLANKS   P@OP04 20                                           218782
     C                     PARM *BLANKS   P@VL04200                                           218782
     C                     PARM *BLANKS   P@OP05 20                                           218782
     C                     PARM *BLANKS   P@VL05200                                           218782
     C                     PARM *BLANKS   P@OP06 20                                           218782
     C                     PARM *BLANKS   P@VL06200                                           218782
     C                     PARM *BLANKS   P@OP07 20                                           218782
     C                     PARM *BLANKS   P@VL07200                                           218782
     C                     PARM *BLANKS   P@OP08 20                                           218782
     C                     PARM *BLANKS   P@VL08200                                           218782
     C                     PARM *BLANKS   P@OP09 20                                           218782
     C                     PARM *BLANKS   P@VL09200                                           218782
     C                     PARM *BLANKS   P@OP10 20                                           218782
     C                     PARM *BLANKS   P@VL10200                                           218782
     C********** SDSVAL    PARM SDSVAL    DSSDY                                        218782 222373
      *                                                                                       218782
     C           WRTCD     IFNE *BLANKS                                                       218782
     C           *LOCK     IN   LDA                                                           218782
     C                     MOVELSVAL,1    DBKEY                                               218782
     C                     MOVEL'LER130  'DBPGM     P                                         218782
     C                     MOVEL'SDSVALPD'DBFILE                                              218782
     C                     Z-ADD24        DBASE                                               218782
     C                     OUT  LDA                                                           218782
     C                     EXSR *PSSR                                                         218782
     C                     ELSE                                                               218782
      *                                                                                       218782
      ** Save value of Settlement09Postings in a one character field                          218782
     C                     MOVELP@VL01    SET09   1                                           218782
     C                     ENDIF                                                              218782
     C                     ENDIF                                                              218782
      **********                                                                     CLE025 BUG13031
      ***Check*if*CLE025*(Credit*Lines)*is*switched*on                               CLE025 BUG13031
      **********                                                                     CLE025 BUG13031
     C**********           CALL 'AOSARDR0'                                           CLE025 BUG13031
     C**********           PARM *BLANKS   PRTCD   7                                  CLE025 BUG13031
     C**********           PARM '*VERIFY' POPTN   7                                  CLE025 BUG13031
     C**********           PARM 'CLE025'  PSARD   6                                  CLE025 BUG13031
     C********** SCSARD    PARM SCSARD    DSFDY                                      CLE025 BUG13031
      **********                                                                     CLE025 BUG13031
     C********** PRTCD     IFNE *BLANKS                                              CLE025 BUG13031
     C********** PRTCD     ANDNE'*NRF   '                                            CLE025 BUG13031
     C********** *LOCK     IN   LDA                                                  CLE025 BUG13031
     C**********           MOVEL'SCSARDPD'DBFILE                                     CLE025 BUG13031
     C**********           MOVEL'CLE025'  DBKEY                                      CLE025 BUG13031
     C**********           Z-ADD23        DBASE                                      CLE025 BUG13031
     C**********           OUT  LDA                                                  CLE025 BUG13031
     C**********           EXSR *PSSR                                                CLE025 BUG13031
     C**********           ENDIF                                                     CLE025 BUG13031
      **********                                                                     CLE025 BUG13031
     C********** PRTCD     IFEQ *BLANKS                                              CLE025 BUG13031
     C**********           MOVE 'Y'       CLE025  1                                  CLE025 BUG13031
     C**********           ELSE                                                      CLE025 BUG13031
     C**********           MOVE 'N'       CLE025                                     CLE025 BUG13031
     C**********           ENDIF                                                     CLE025 BUG13031
      *                                                                                       CLE025
      ** Check if CLE106 (Syndications Manager) is switched on                                CLE106
      *                                                                                       CLE106
     C                     CALL 'AOSARDR0'                                                    CLE106
     C                     PARM *BLANKS   PRTCD   7                                           CLE106
     C                     PARM '*VERIFY' POPTN   7                                           CLE106
     C                     PARM 'CLE106'  PSARD   6                                           CLE106
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE106
      *                                                                                       CLE106
     C           PRTCD     IFNE *BLANKS                                                       CLE106
     C           PRTCD     ANDNE'*NRF   '                                                     CLE106
     C           *LOCK     IN   LDA                                                           CLE106
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE106
     C                     MOVEL'CLE106'  DBKEY                                               CLE106
     C                     Z-ADD24        DBASE                                               CLE106
     C                     OUT  LDA                                                           CLE106
     C                     EXSR *PSSR                                                         CLE106
     C                     ENDIF                                                              CLE106
      *                                                                                       CLE106
     C           PRTCD     IFEQ *BLANKS                                                       CLE106
     C                     MOVE 'Y'       CLE106  1                                           CLE106
     C                     ELSE                                                               CLE106
     C                     MOVE 'N'       CLE106                                              CLE106
     C                     ENDIF                                                              CLE106
      *                                                                                       CAS009
      ** Determine if SAR CAS009 is installed                                                 CAS009
      *                                                                                       CAS009
     C                     CALL 'AOSARDR0'                                                    CAS009
     C                     PARM *BLANKS   WRTCD                                               CAS009
     C                     PARM '*VERIFY 'WOPTN                                               CAS009
     C                     PARM 'CAS009'  WSARD   6                                           CAS009
     C           SCSARD    PARM SCSARD    DSFDY                                               CAS009
      *                                                                                       CAS009
     C           WRTCD     IFNE *BLANKS                                                       CAS009
     C           WRTCD     ANDNE'*NRF   '                                                     CAS009
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS009
     C                     Z-ADD52        DBASE                                               CAS009
     C                     MOVEL'CAS009'  DBKEY                                               CAS009
     C                     EXSR *PSSR                                                         CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C           WRTCD     IFEQ *BLANKS                                                       CAS009
     C                     MOVE 'Y'       CAS009  1                                           CAS009
     C                     ELSE                                                               CAS009
     C                     MOVE 'N'       CAS009                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS016
      ** Determine if SAR CAS016 is installed                                                 CAS016
      *                                                                                       CAS016
     C                     CALL 'AOSARDR0'                                                    CAS016
     C                     PARM *BLANKS   WRTCD                                               CAS016
     C                     PARM '*VERIFY 'WOPTN                                               CAS016
     C                     PARM 'CAS016'  WSARD   6                                           CAS016
     C           SCSARD    PARM SCSARD    DSFDY                                               CAS016
      *                                                                                       CAS016
     C           WRTCD     IFNE *BLANKS                                                       CAS016
     C           WRTCD     ANDNE'*NRF   '                                                     CAS016
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS016
     C                     Z-ADD54        DBASE                                               CAS016
     C                     MOVEL'CAS016'  DBKEY                                               CAS016
     C                     EXSR *PSSR                                                         CAS016
     C                     ENDIF                                                              CAS016
      *                                                                                       CAS016
     C           WRTCD     IFEQ *BLANKS                                                       CAS016
     C                     MOVE 'Y'       CAS016  1                                           CAS016
     C                     ELSE                                                               CAS016
     C                     MOVE 'N'       CAS016                                              CAS016
     C                     ENDIF                                                              CAS016
      *                                                                                       CLE141
      ** Determine if CLE141 ins installed                                                    CLE141
      *                                                                                       CLE141
     C                     MOVEL'N'       CLE141  1                                           CLE141
     C                     CALL 'AOSARDR0'                                                    CLE141
     C                     PARM *BLANKS   WRTCD                                               CLE141
     C                     PARM '*VERIFY 'WOPTN                                               CLE141
     C                     PARM 'CLE141'  WSARD                                               CLE141
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE141
     C           WRTCD     IFEQ *BLANKS                                                       CLE141
     C                     MOVEL'Y'       CLE141                                              CLE141
     C                     ENDIF                                                              CLE141
      *                                                                                       CLE141
     C/COPY WNCPYSRC,LEH01260
      *                                                                                       CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
      *                                                                                       CAS009
      ** Mandatory read so read 1st record.                                                   CAS009
      *                                                                                       CAS009
     C**********           READ LECFLSPD                 45                            CAS009 CAS016
     C                     READ LECFLSL1                 45                                   CAS016
      *                                                                                       CAS009
      ** Access hedging details if CAS009 is enabled.                                         CAS009
      *                                                                                       CAS009
     C                     CALL 'AOHEDGR0'                                                    CAS009
     C                     PARM *BLANKS   WRTCD                                               CAS009
     C                     PARM '*FIRST ' WOPTN                                               CAS009
     C           SDHEDG    PARM SDHEDG    DSFDY                                               CAS009
      *                                                                                       CAS009
     C           WRTCD     IFNE *BLANKS                                                       CAS009
     C                     MOVEL'SCHEDGPD'DBFILE                                              CAS009
     C                     Z-ADD53        DBASE                                               CAS009
     C                     MOVELWOPTN     DBKEY                                               CAS009
     C                     OUT  LDA                                                           CAS009
     C                     EXSR *PSSR                                                         CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** Calculate Event Control Date                                                         CAS009
      ** The lesser of - Next Working Day - 1                                                 CAS009
      **               - Accrual Profit Date                                                  CAS009
      *                                                                                       CAS009
     C           BJDNWD    SUB  1         EVCD    50                                          CAS009
     C           BKAPDT    IFLT EVCD                                                          CAS009
     C                     MOVE BKAPDT    EVCD                                                CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** Key list for CLOANL4                                                                 CAS009
     C           Z9KEY     KLIST                                                              CAS009
     C                     KFLD           Z9KYID  1                                           CAS009
     C**********           KFLD           Z9LNRF  60                                   CAS009 CLE148
     C                     KFLD           Z9LNRF  6                                           CLE148
      *                                                                                       CAS009
      ** Key list for LEEIRAL4                                                                CAS009
     C           KEIRA     KLIST                                                              CAS009
     C**********           KFLD           KTRAN   60                                   CAS009 CLE148
     C                     KFLD           KTRAN   6                                           CLE148
     C                     KFLD           KFSEQ   20                                          CAS009
     C                     KFLD           KSDAM   50                                          CAS009
      *                                                                                       CAS009
      ** Key list for LEPDUFL2                                                                CLE134
      *                                                                                       CLE134
     C           ZLEPD     KLIST                                                              CLE134
     C                     KFLD           ZLOAN   6                                           CLE134
     C                     KFLD           ZCNUM   6                                           CLE134
     C                     KFLD           ZFEFCL  50                                          CLE134
     C                     KFLD           ZFSEQ   20                                          CLE134
      *                                                                                       CLE134
      *                                                                                       CLE159
      ** Check if CLE159 is installed                                                         CLE159
      *                                                                                       CLE159
     C                     MOVEL'N'       CLE159  1                                           CLE159
     C                     CALL 'AOSARDR0'                                                    CLE159
     C                     PARM *BLANKS   WRTCD                                               CLE159
     C                     PARM '*VERIFY 'WOPTN                                               CLE159
     C                     PARM 'CLE159'  WSARD                                               CLE159
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE159
      *                                                                                       CLE159
     C           WRTCD     IFEQ *BLANKS                                                       CLE159
     C                     MOVEL'Y'       CLE159                                              CLE159
     C                     ENDIF                                                              CLE159
      *                                                                                       CLE159
      ***Key*list*for*LEACCNL6*****************************************              AR574425 CLE164
      *****************************************************************              AR574425 CLE164
     C********** ZLEACC    KLIST                                                     AR574425 CLE164
     C**********           KFLD           ZCNUM                                      AR574425 CLE164
     C**********           KFLD           ZLOAN                                      AR574425 CLE164
     C**********           KFLD           ZFEFCL                                     AR574425 CLE164
     C**********           KFLD           ZFSEQ                                      AR574425 CLE164
     C**********           KFLD           ZFCOD   20                                 AR574425 CLE164
     C**********           KFLD           ZFBRC   3                                  AR574425 CLE164
      *****************************************************************              AR574425 CLE164
      *                                                                                       CLE164
      ** Key list for LEFEEZI0                                                                CLE164
      *                                                                                       CLE164
     C           KLEFEZ    KLIST                                                              CLE164
     C                     KFLD           KFBRC   3                                           CLE164
     C                     KFLD           ZCNUM                                               CLE164
     C                     KFLD           ZFEFCL                                              CLE164
     C                     KFLD           ZLOAN                                               CLE164
     C                     KFLD           ZFSEQ                                               CLE164
     C/COPY WNCPYSRC,LER130C002
      *                                                                                     MD035545
      ** Retrieve system value setting                                                      MD035545
      *                                                                                     MD035545
     C                     MOVELWPARML    P@OP01                                            MD035545
     C                     CALL 'AOSVALR0'                                                  MD035545
     C                     PARM *BLANKS   WRTCD                                             MD035545
     C                     PARM           P@OP01                                            MD035545
     C                     PARM           P@VL01                                            MD035545
     C                     PARM           P@OP02                                            MD035545
     C                     PARM           P@VL02                                            MD035545
     C                     PARM           P@OP03                                            MD035545
     C                     PARM           P@VL03                                            MD035545
     C                     PARM           P@OP04                                            MD035545
     C                     PARM           P@VL04                                            MD035545
     C                     PARM           P@OP05                                            MD035545
     C                     PARM           P@VL05                                            MD035545
     C                     PARM           P@OP06                                            MD035545
     C                     PARM           P@VL06                                            MD035545
     C                     PARM           P@OP07                                            MD035545
     C                     PARM           P@VL07                                            MD035545
     C                     PARM           P@OP08                                            MD035545
     C                     PARM           P@VL08                                            MD035545
     C                     PARM           P@OP09                                            MD035545
     C                     PARM           P@VL09                                            MD035545
     C                     PARM           P@OP10                                            MD035545
     C                     PARM           P@VL10                                            MD035545
      *                                                                                     MD035545
      ** If system value is not found then default value to 'N'                             MD035545
      *                                                                                     MD035545
     C           WRTCD     IFNE '       '                                                   MD035545
     C                     MOVE 'N'       WCALC6                                            MD035545
     C                     ELSE                                                             MD035545
     C                     MOVELP@VL01    WCALC6                                            MD035545
     C********** WCALC6    IFEQ 'Y'                                                MD035545 MD047993
     C********** BKALDI    ANDEQ'Y'                                                MD035545 MD047993
     C**********           MOVE 'Y'       WCALC6                                   MD035545 MD047993
     C**********           ELSE                                                    MD035545 MD047993
     C**********           MOVE 'N'       WCALC6                                   MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
     C                     ENDIF                                                            MD035545
      *
      ***  Check System Date Format, DDMMYY (*IN98 off)
      ***                            MMDDYY (*IN98 on).
      *
     C           AGDFF     IFEQ 'M'
     C                     SETON                     98
     C                     END
     C/COPY WNCPYSRC,LEH00897
      *
      ** Use previous end of year and month of RUNDAY to check whether
      ** the current month should be used for the array index
     C           BJPEYD    ADD  1         START   50
     C                     Z-ADDSTART     ZDAYNO
     C                     EXSR ZDATE2
     C           ZDATE     IFEQ *ZEROS
     C           ZADATE    ANDEQ*BLANKS
     C           *LOCK     IN   LDA
     C                     MOVELSTART     DBKEY            ************
     C                     MOVEL'ZDATE2  'DBFILE           * DBERR 09 *
     C                     MOVEL'009'     DBASE            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     Z-ADDZDATE     STDTN   60
     C                     MOVE ZADATE    STDTA   7
      *
      ** Store the day fields of the start of year date
     C                     MOVELSTDTA     DDSY    2
      *
      * Set up next working day minus 1
     C           BJDNWD    SUB  1         WNWDS1  50
      *
      ** Calculate the start of month date by converting the date of
      ** next working day to date format and inserting the start of
      ** year day number
     C                     Z-ADDBJDNWD    ZDAYNO
     C                     EXSR ZDATE2
     C           ZDATE     IFEQ *ZEROS
     C           ZADATE    ANDEQ*BLANKS
     C           *LOCK     IN   LDA
     C                     MOVELBJDNWD    DBKEY            ************
     C                     MOVEL'ZDATE2  'DBFILE           * DBERR 10 *
     C                     MOVEL'010'     DBASE            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     Z-ADDZDATE     WDATE   60
     C                     MOVE ZADATE    GADATE  7
      *
      ** If the date format is to be European (DDMMYY) then use the
      ** correct data structure
     C                     MOVE WDATE     SMDT    6
     C           BJDFIN    IFEQ 'D'
     C                     MOVELDDSY      SMDT
     C*                                                                   E45703
     C** Divide WDATE (converted date of next working day) by 10000       E45703
     C** to get the day number (2 DIGITS)                                 E45703
     C*                                                                   E45703
     C           WDATE     DIV  10000     DNWDDD  20                      E45703
      *
     C                     ELSE
      *
      ** Otherwise use the U.S.A.-defined date data structure
      ** (MMDDYY) for manipulation.
     C                     MOVE WDATE     SMDTUS  6
     C                     MOVE DDSY      SMDDUS
     C                     MOVE SMDDUS    SMDD
     C                     MOVE SMUS      SM
     C*                                                                   E45703
     C** Divide WDATE (converted date of next working day) by 100         E45703
     C** to get the day number (2 DIGITS) by putting the result in a      E45703
     C** 2 digit field.                                                   E45703
     C*                                                                   E45703
     C           WDATE     DIV  100       DNWDDD  20                      E45703
     C*                                                                   E45703
     C                     END
      *
     C***Divide*WDATE*(converted*date*of*next*working*day)*by*10000****** E45703
     C***to*get*the*day*number*(2*DIGITS)*and*move*the*start*of*year***** E45703
     C***day*into*a*two*digit*work*field*for*later*comparison.*********** E45703
     C*
     C***********WDATE     DIV  10000     DNWDDD  20                      E45703
     C*                                                                   E45703
     C** Move the start of year day into a 2 digit field for later comp   E45703
     C*                                                                   E45703
     C                     MOVELDDSY      WKDDSY  20
      *
      ** If the day number of the date of next working
      ** day is less than the start of month day subtract
      ** one from the month number of the date of next working day
      ** this ensures that the conversion and checking of the start
      ** of month date is performed on the current month & not the next
      *
     C           WKDDSY    IFGT DNWDDD
     C                     SUB  1         SM
     C           SM        IFEQ 0
     C                     Z-ADD12        SM
     C                     SUB  1         SY
     C                     END
     C                     END
      *
     C                     MOVE SMDT      GDATE   60
      **                                                                  MOF60
      ** Convert the constructed start date to day format                 MOF60
      **                                                                  MOF60
     C                     MOVE '0'       GRTCD                           MOF60
     C                     CALL 'LERDATEF'                                MOF60
     C                     PARM           GDATE                           MOF60
     C                     PARM           GDAYNO  50                      MOF60
     C                     PARM           GRTCD   1                       MOF60
     C                     Z-ADDGDAYNO    SMDY    50                      MOF60
      *
      ** Check whether the start of the new month falls after RUND
      ** and on or before the date of next working day and if so
      ** use the last day of the month as the accrual/profit day.
     C           SMDY      IFGT BJRDNB
     C           SMDY      ANDLEBJDNWD
     C           BKAPDT    ANDEQBJRDNB
     C           SMDY      SUB  1         WAPDAT
     C           SM        SUB  1         A       20
      *
     C                     ELSE
     C                     Z-ADDSM        A
      *
      ** Find the lesser of next working day minus 1 and accrual profit
      ** day
     C           BKAPDT    IFLT WNWDS1
     C                     Z-ADDBKAPDT    WAPDAT  50
     C                     ELSE
     C                     Z-ADDWNWDS1    WAPDAT
     C                     END
     C                     END
      *
      ** Find the month of the APDAT field for historic file
     C                     Z-ADDWAPDAT    ZDAYNO
     C                     EXSR ZDATE2
     C           ZDATE     IFEQ *ZEROS
     C           ZADATE    ANDEQ*BLANKS
     C           *LOCK     IN   LDA
     C                     MOVELWAPDAT    DBKEY                         *
     C                     MOVEL'ZDATE2  'DBFILE           ************
     C                     MOVEL'012'     DBASE            * DBERR 12 *
     C                     OUT  LDA                        ************
     C                     EXSR *PSSR
     C                     END
     C                     Z-ADDZDATE     WDATE   60
     C                     MOVE ZDATE     SMDT    6                       154959
     C                     MOVE ZDATE     SMDTUS  6                       154959
      *                                                                   154959
      * Check which date format is being used and set up the date to      154959
      * be converted accordingly.                                         154959
      *                                                                   154959
     C           AGDFF     IFEQ 'D'                                       154959
     C                     MOVE SMDD      MNTND   20                      154959
     C                     ELSE                                           154959
     C                     MOVE SMDDUS    MNTND                           154959
     C                     END                                            154959
      *                                                                   142402
      ** Compute the total number of days from start date of the month    142402
      ** up to the accrual profit date.  Also, get the value of the       142402
      ** start date of the month in Midas format.                         142402
      *                                                                   142402
     C***********WDATE     DIV  10000     MNTND   20                142402154959
     C           WAPDAT    SUB  MNTND     MSTD    50                      142402
     C           MSTD      ADD  1         MSTD                            142402
      *                                                                   142402
     C                     MOVE ZADATE    GADATE  7
      *
      ** Check that the month number for the array setup is not now
      ** zero and adjust if it is
     C           A         IFEQ 0
     C                     Z-ADD12        A
     C                     END
      *
      ** Retrieve month where the fee amount must be added                E33591
      *                                                                   E33591
     C           WKDDSY    IFEQ 01                                        E33591
      *                                                                   E33591
      ** If the date format is to be European (DDMMYY)                    E33591
      *                                                                   E33591
     C                     Z-ADDWDATE     WWDAT                           E33591
      *                                                                   E33591
     C           BJDFIN    IFEQ 'D'                                       E33591
     C                     Z-ADDWWDT2     A                               E33591
     C                     ELSE                                           E33591
      ** Otherwise use the U.S.A.-defined date data structure             E33591
     C                     Z-ADDWWDT1     A                               E33591
     C                     END                                            E33591
      *
     C                     END                                            E33591
      *                                                                   142402
      ** Get the value of the previous month for the array setup          142402
      *                                                                   142402
     C           A         SUB  1         A2      20                      142402
      *                                                                   142402
     C           A2        IFEQ 0                                         142402
      *                                                                   142402
     C                     Z-ADD12        A2                              142402
      *                                                                   142402
     C                     ENDIF                                          142402
      *
      ** Write fee accrual a/c keys header
     C                     MOVE 'H'       LKRECI
     C                     WRITELKEYFEAF
     C                     MOVE 'A'       WRCDT   1
      *
      ** Key list for LEPEFLD
     C           LNKEY     KLIST
     C                     KFLD           FEBRCA
     C                     KFLD           FECNUM
     C                     KFLD           FELOAN
     C                     KFLD           WCOD
     C                     KFLD           BJCYCD
      *
      ** Key list for LEPEFFD
     C           FAKEY     KLIST
     C                     KFLD           FEBRCA
     C                     KFLD           FECNUM
     C                     KFLD           FEFACL
     C                     KFLD           WCOD
     C                     KFLD           BJCYCD
      *
      ** Key list for CLOAN
     C           WLNKEY    KLIST
     C                     KFLD           FELOAN
     C                     KFLD           WRCDT
      *                                                                                       CLE134
      ** Key list for CLOAN                                                                   CLE134
      *                                                                                       CLE134
     C           WLPDCL    KLIST                                                              CLE134
     C                     KFLD           YPLON                                               CLE134
     C                     KFLD           WRCDT                                               CLE134
     C/COPY WNCPYSRC,LEH01082
      *                                                                                       CAS016
     C           KFEE      KLIST                                                              CAS016
     C                     KFLD           FELOAN                                              CAS016
     C                     KFLD           FEFSEQ                                              CAS016
     C                     KFLD           LKEDAT                                              CAS016
      *                                                                                       CAS016
     C           KFEE2     KLIST                                                              238569
     C                     KFLD           FELOAN                                              238569
     C                     KFLD           FEFSEQ                                              238569
      *                                                                                       CGL020
      ** Key list for FCLTY                                                                   CGL020
      *                                                                                       CGL020
     C                     MOVE 'A'       FRCTP                                               CGL020
     C           FCKEY     KLIST                                                              CGL020
     C                     KFLD           FECNUM                                              CGL020
     C                     KFLD           FCFTYP                                              CGL020
     C                     KFLD           FCFNUM                                              CGL020
     C                     KFLD           FRCTP                                               CGL020
      *                                                                   155672
     C           FEEQ      KLIST                                                              260345
     C                     KFLD           FECNUM                                              260345
     C                     KFLD           FEFACL                                              260345
     C                     KFLD           FELOAN                                              260345
     C                     KFLD           FEFSEQ                                              260345
      * Key to retrieve LS in HISTSHP.                                             AR317401 MD046294
      *                                                                            AR317401 MD046294
     C********** KEYHP1    KLIST                                                   AR317401 MD046294
     C**********           KFLD           FEBRCA                                   AR317401 MD046294
     C**********           KFLD           FECNUM                                   AR317401 MD046294
     C**********           KFLD           FELOAN                                   AR317401 MD046294
     C**********           KFLD           BJRDNB                                   AR317401 MD046294
      *                                                                            AR317401 MD046294
      ** Keylist for LEFHST                                                                AR632103A
      *                                                                                    AR632103A
     C           HFEE      KLIST                                                           AR632103A
     C                     KFLD           FEBRCA                                           AR632103A
     C                     KFLD           FECNUM                                           AR632103A
     C                     KFLD           FEFACL                                           AR632103A
     C                     KFLD           FELOAN                                           AR632103A
     C                     KFLD           FEFSEQ                                           AR632103A
      *                                                                                    AR632103A
     C           FZAS      KLIST                                                            MD026969
     C                     KFLD           HICNUM                                            MD026969
     C                     KFLD           HIFACL                                            MD026969
     C                     KFLD           HIFSEQ                                            MD026969
      *                                                                                     MD026969
      *                                                                                       260345
      ** Parameter list for program AONOSTR0                              155672
      *                                                                   155672
     C           PNOST     PLIST                                          155672
     C                     PARM '*MSG   ' WRTCD                           155672
     C                     PARM '*KEY   ' WOPTN                           155672
     C                     PARM           WKEYA   6                       155672
     C                     PARM           WKEYB   3                       155672
     C**********           PARM           WKEYC   4                                    155672 CGL029
     C                     PARM           WKEYC  10                                           CGL029
     C                     PARM           WKEYD   2                       155672
     C                     PARM           WKEYE   2                       155672
     C                     PARM           WKEYF   3                       155672
     C                     PARM           WKEYG  10                       155672
     C                     PARM           WKEYH   1                       155672
     C           SDNOST    PARM SDNOST    DSFDY                           155672
      *                                                                   155672
      ** Parameter list for program AOCUSTR0                              155672
      *                                                                   155672
     C           PCUST     PLIST                                          155672
     C                     PARM '*MSG   ' WRTCD                           155672
     C                     PARM '*KEY   ' WOPTN                           155672
     C                     PARM           WCKEY  10                       155672
     C                     PARM           WKYSTS  7                       155672
     C           SDCUST    PARM SDCUST    DSSDY                           155672
      *                                                                                       CLE141
      ** Parameter list for program LEZBDYCD                                                  CLE141
      *                                                                                       CLE141
     C           BDCHK     PLIST                                                              CLE141
     C                     PARM           ZDAYNO                                              CLE141
     C                     PARM           ACCY                                                CLE141
     C                     PARM           ALOC                                                CLE141
     C                     PARM           PAYIND  1                                           CLE141
     C                     PARM           BJDFIN                                              CLE141
     C                     PARM           CCYLL   3                                          CLE141A
     C                     PARM *BLANKS   LOCLL   3                                          CLE141A
     C                     PARM *ZEROS    ZADJDT  50                                          CLE141
      *                                                                                       CLE141
      *
      ** Reset array
     C                     Z-ADD0         X       30
      *
     C           *IN17     DOWEQ'0'
      *
      ** While not end of file read all currency records
     C                     READ SDCURRL0                 17
      ** Increment array index
     C                     ADD  1         X
      ** Move data into arrays
     C                     MOVE A6CYCD    WCYA,X
     C                     MOVE A6NBDP    WDPA,X
     C                     MOVE A6SPRT    WSPA,X
     C                     MOVE A6MDIN    WMDA,X
     C                     MOVE A6INCY    WINA,X                                              CLE031
      ** Check for full array
     C           X         COMP 150                      17
     C                     END
     C/COPY WNCPYSRC,LER130CCP1                                           S01408
      *
     C           *LIKE     DEFN LKVLRF    L3VLRF                                              CLE134
     C           *LIKE     DEFN LKVLRL    L3VLRL                                              CLE134
     C           *LIKE     DEFN LKNORE    L3NORE                                              CLE134
     C                     Z-ADD*ZEROS    L3VLRF                                              CLE134
     C                     Z-ADD*ZEROS    L3VLRL                                              CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           1         SETLLLEPK3ZZ                                                       CLE134
     C                     READ LEPK3ZZ                  88                                   CLE134
     C           *IN88     IFEQ *OFF                                                          CLE134
     C                     Z-ADDLKNORE    L3NORE                                              CLE134
     C                     Z-ADDLKVLRF    L3VLRF                                              CLE134
     C                     Z-ADDLKVLRL    L3VLRL                                              CLE134
     C                     ENDIF                                                              CLE134
     C           1         SETLLLEPK3HH                                                       CLE134
     C                     READ LEPK3HH                  88                                   CLE134
     C           *IN88     IFEQ *ON                                                           CLE134
     C                     MOVE 'H'       LKRECI                                              CLE134
     C                     WRITELKEYF3AF                                                      CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     ENDSR
      *
      ********************************************************************                    CLE031
     C/TITLE SR/SETDAT                                                                        CLE031
      ********************************************************************                    CLE031
      *                                                                                       CLE031
      * SETDAT - CALCULATE NEXT PAYMENT DATE FROM A FREQUENCY                                 CLE031
      *                                                                                       CLE031
      *  CALLED FROM:  DETAIL, ACCRUE                                                         CLE031
      *                                                                                       CLE031
      *  CALLS:  ZFREQB                                                                       CLE031
      *                                                                                       CLE031
      ********************************************************************                    CLE031
      *                                                                                       CLE031
     C           SETDAT    BEGSR                                                              CLE031
      *                                                                                       CLE031
      * If Frequency is not blank, calculate next payment date:                               CLE031
     C           FEFREQ    IFNE *BLANKS                                                       CLE031
     C                     MOVE FEFREQ    ZFREQ   1                                           CLE031
     C                     Z-ADDFENPYD    ZDAYNO  50                                          CLE031
     C                     Z-ADDFEDYIM    ZMDAY   20                                          CLE031
     C                     MOVE BJLCCY    ZCCY    3                                           CLE031
     C**********           MOVE *BLANKS   ZZERR   7                                    CLE031 CLE141
     C                     MOVE *BLANKS   ZZERR@                                              CLE141
     C           CLE141    IFEQ 'Y'                                                           CLE141
     C********** FESTTL    ANDEQ1                                                     CLE141 CLE141A
     C           FELOAN    ANDNE*BLANKS                                                       CLE141
     C********** CLE141    OREQ 'Y'                                                   CLE141 CLE141A
     C********** FESTTL    ANDEQ7                                                     CLE141 CLE141A
     C********** FELOAN    ANDNE*BLANKS                                               CLE141 CLE141A
     C********** CLE141    OREQ 'Y'                                                   CLE141 CLE141A
     C********** FESTTL    ANDEQ8                                                     CLE141 CLE141A
     C********** FELOAN    ANDNE*BLANKS                                               CLE141 CLE141A
     C                     EXSR ZFRQB3                                                        CLE141
     C                     MOVELZCCY      CCYLL                                              CLE141A
     C                     MOVEL*BLANKS   PAYIND                                              CLE141
     C                     CALL 'LEZBDYCD'BDCHK                                               CLE141
     C                     MOVELZADJDT    ZDAYNO                                              CLE141
     C                     ELSE                                                               CLE141
     C                     EXSR ZFREQB                                                        CLE031
     C                     ENDIF                                                              CLE141
      *                                                                                       CLE031
     C********** ZZERR     IFNE *BLANK                                                 CLE031 CLE141
     C           ZZERR@    IFNE *BLANK                                                        CLE141
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'LER130'  DBPGM                                               CLE031
     C                     MOVEL'ZFREQB'  DBFILE           ************                       CLE031
     C                     MOVELFENPYD    DBKEY            * DBERR 20 *                       CLE031
     C                     MOVEL'020'     DBASE            ************                       CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** If calculated next payment date is beyond end date of the fee:                       CLE031
     C           ZDAYNO    IFGT FEPEND                                                        CLE031
      *                                                                                       CLE031
      ** If end date of fee is greater than Accrual Profit work date:                         CLE031
     C           FEPEND    IFGT WAPDAT                                                        CLE031
     C                     Z-ADDFEPEND    NWNPYD  50                                          CLE031
     C                     ELSE                                                               CLE031
     C                     Z-ADD0         NWNPYD                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ELSE                                                               CLE031
     C           FENPYD    IFLE WAPDAT                                                        CLE031
     C                     Z-ADDZDAYNO    NWNPYD                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      **  Else, Frequency is blank:                                                           CLE031
     C                     ELSE                                                               CLE031
     C           FEPEND    IFGT WAPDAT                                                        CLE031
     C           FENPYD    IFLE WAPDAT                                                        CLE031
     C                     Z-ADDFEPEND    NWNPYD                                              CLE031
     C                     ELSE                                                               CLE031
     C                     Z-ADD0         NWNPYD                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDSR                                                              CLE031
      *                                                                                       CLE031
      ********************************************************************                    CLE031
     C/TITLE SR/SETCCY                                                                        CLE031
      ********************************************************************                    CLE031
      *                                                                                       CLE031
      * SETCCY - PROCESS FEES SETTLED IN ANOTHER CURRENCY                                     CLE031
      *                                                                                       CLE031
      *  CALLED FROM:  SETTLE                                                                 CLE031
      *                                                                                       CLE031
      *  CALLS: NOTHING                                                                       CLE031
      *                                                                                       CLE031
      ********************************************************************                    CLE031
      *                                                                                       CLE031
     C           SETCCY    BEGSR                                                              CLE031
      *                                                                                       CLE031
     C                     Z-ADD0         WRKAMT                                            MD051940
     C                     Z-ADD1         Y       30                                          CLE031
     C           FEFCCY    LOKUPWCYA,Y                   13                                   CLE031
      *                                                                                       CLE031
     C           *IN13     IFEQ '1'                                                           CLE031
     C                     MOVELWMDA,Y    FEMDI   1                                           CLE031
     C                     Z-ADDWSPA,Y    FESPOT 138                                          CLE031
     C                     MOVELWINA,Y    FEINCY  1                                           CLE031
     C                     Z-ADDWDPA,Y    FENBDP  10                                          CLE031
     C                     END                                                                CLE031
      *                                                                                       CLE031
     C                     MOVELFEFCCY    WKFCCY  3        Work Fee Ccy                       CLE031
     C                     MOVEL*BLANKS   WRKCCY  3        Work Currency                      CLE031
     C                     MOVEL'Y'       PROCES  1                                           CLE031
      *                                                                                       CLE031
      ** If settlement method is 09 and postings are to use Transaction                       218782
      ** currency, do not set up WRKCCY.                                                      218782
      *                                                                                       218782
     C           CLE033    IFEQ 'Y'                                                           218782
     C           FESTTL    ANDEQ09                                                            218782
     C           SET09     ANDEQ'T'                                                           218782
     C                     MOVE *BLANKS   WRKCCY                                              218782
     C                     Z-ADD*ZEROS    WRKEXR                                              218782
     C                     MOVE *BLANKS   WRKEXI                                              218782
     C                     ELSE                                                               218782
      *                                                                                       CLE031
     C           PTFI      IFEQ *BLANK                                                        CLE031
     C                     MOVELFESCCY    WRKCCY                                              CLE031
     C                     Z-ADDFEREXR    WRKEXR 138                                          CLE031
     C                     MOVELFEREXI    WRKEXI  1                                           CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           PTFI      IFEQ 'P'                        Participant                        CLE031
     C           PTFI      OREQ 'S'                                                           CLE106
     C           PTFI      OREQ 'R'                                                           CLE106
     C                     MOVELFEPSCY    WRKCCY                                              CLE031
     C                     Z-ADDFEPEXR    WRKEXR                                              CLE031
     C                     MOVELFEPEXI    WRKEXI  1                                           CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           PTFI      IFEQ 'I'                        Internal                           CLE031
     C                     MOVEL*BLANKS   WRKCCY                                              CLE031
     C                     Z-ADD0         WRKEXR                                              CLE031
     C                     MOVEL*BLANKS   WRKEXI  1                                           CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              218782
      *                                                                                       CLE031
     C           WRKCCY    IFEQ *BLANKS                                                       CLE031
     C                     MOVEL'N'       PROCES                                              CLE031
     C                     ELSE                                                               CLE031
     C                     Z-ADD1         Y       30                                          CLE031
     C           WRKCCY    LOKUPWCYA,Y                   13                                   CLE031
     C                     Z-ADDWDPA,Y    WKNBDP  10                                          CLE031
      *                                                                                       CLE031
      ** If settlement ccy is 'In', or if Fee ccy is 'In' & settlement                        CLE031
      *  ccy is EUR, ignore, as will be processed in LE0470.                                  CLE031
     C           WINA,Y    IFEQ 'Y'                                                           CLE031
     C           WRKCCY    OREQ BKEURO                                                        CLE031
     C           FEINCY    ANDEQ'Y'                                                           CLE031
     C                     MOVEL'N'       PROCES                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           PROCES    IFEQ 'Y'                                                           CLE031
     C                     MOVELLKECCY    SVECCY  3                                           CLE031
     C                     MOVELLKSCCY    SVSCCY  3                                           CLE031
     C                     MOVELWRKCCY    LKECCY                                              CLE031
     C                     MOVEL*BLANKS   LKSCCY                                              CLE031
     C                     Z-ADDLKEAMT    WRKAMT 130                                          CLE031
      *                                                                                       CLE031
     C                     Z-ADDWRKEXR    ZEXCH                                               CLE031
     C                     MOVE WRKEXI    ZMD                                                 CLE031
     C                     Z-ADDWRKAMT    ZAMTCI                                              CLE031
     C                     MOVE FEFCCY    ZCCYI                                               CLE031
     C                     MOVE WRKCCY    ZCCYO                                               CLE031
     C                     Z-ADDFENBDP    ZCDPI                                               CLE031
     C                     Z-ADDWKNBDP    ZCDPO                                               CLE031
     C                     EXSR ZCONV                                                         CLE031
     C                     Z-ADDZAMTCO    SETAMT 130                                          CLE031
      *                                                                                       CLE031
     C                     Z-ADDSETAMT    LKEAMT                                              CLE031
     C                     MOVE 'S'       LKSIND                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDSR                                                              CLE031
      *                                                                                       CLE031
      ********************************************************************                    CLE031
     C/TITLE SR/SETKEY                                                                        CLE031
      ********************************************************************                    CLE031
      *                                                                                       CLE031
      * SETKEY - PRODUCE 4 NEW KEYS IF SETTLING IN ANOTHER CURRENCY                           CLE031
      *                                                                                       CLE031
      *  CALLED FROM:  SETTLE                                                                 CLE031
      *                                                                                       CLE031
      *  CALLS:PRINEV                                                                         CLE031
      *                                                                                       CLE031
      ********************************************************************                    CLE031
      *                                                                                       CLE031
     C           SETKEY    BEGSR                                                              CLE031
      *                                                                                       CLE031
     C                     MOVEAAKY       SAVAKY                                              CLE031
     C                     MOVELLKAKEY    SVLKEY                                              CLE031
      *                                                                                       CLE031
     C           PROCES    IFEQ 'Y'                                                           CLE031
     C                     MOVEAAKY       LKOKEY                                              CLE031
     C           FELOAN    IFGT *BLANKS                                                     MD051242
     C                     MOVE ' '       AKY,6                                             MD051242
     C                     ELSE                                                             MD051242
     C                     MOVE ' '       AKY,5                                               CLE031
     C                     ENDIF                                                            MD051242
     C           FEPYON    IFEQ 'S'                                                           CLE031
     C                     MOVE 'S'       AKY,6                                               CLE031
     C                     ENDIF                                                              CLE031
     C********** FELOAN    IFGT 0                                                      CLE031 CLE148
     C           FELOAN    IFGT *BLANKS                                                       CLE148
     C           FELOAN    ANDNE'000000'                                                      CLE134
     C                     MOVE 'S'       AKY,3                                               CLE031
     C           PTYP      IFNE 66                                                            CLE031
     C           PTYP      ANDNE67                                                            CLE031
     C           PTYP      ANDNE69                                                            CLE031
     C           PTYP      ANDNE72                                                            CLE031
     C                     MOVE 'S'       WKPURT  1        Purchase Type                      CLE031
     C                     MOVE WRKCCY    WKPURC  3        Purchase Ccy                       CLE031
     C                     MOVE WKFCCY    WKSALC  3        Sale currency                      CLE031
     C                     ELSE                            Part Sold                          CLE031
     C                     MOVE 'F'       WKPURT           Purchase Type                      CLE031
     C                     MOVE WKFCCY    WKPURC           Purchase Ccy                       CLE031
     C                     MOVE WRKCCY    WKSALC           Sale currency                      CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ELSE                            Facility Fee                       CLE031
     C                     MOVE 'S'       AKY,4            Settlement                         CLE031
      *                                                                                       CLE031
     C           PTFI      IFEQ 'P'                        If Participant                     CLE031
     C           PTFI      OREQ 'S'                                                           CLE106
     C           PTFI      OREQ 'R'                                                           CLE106
     C                     MOVE 'F'       WKPURT           Purchase Type                      CLE031
     C                     MOVE WKFCCY    WKPURC           Purchase Ccy                       CLE031
     C                     MOVE WRKCCY    WKSALC           Sale currency                      CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE 'S'       WKPURT           Purchase Type                      CLE031
     C                     MOVE WRKCCY    WKPURC           Purchase Ccy                       CLE031
     C                     MOVE WKFCCY    WKSALC           Sale currency                      CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Format key for amount in Purchase currency:                                          CLE031
      *                                                                                       CLE031
     C                     MOVE 'B'       AKY,10                                              CLE031
     C           WKPURC    IFEQ BJCYCD                                                        CLE031
     C                     MOVE 'B'       AKY,7                                               CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE 'F'       AKY,7                                               CLE031
     C                     ENDIF                                                              CLE031
     C           WKPURT    IFEQ 'F'                                                           CLE031
     C                     Z-ADDWRKAMT    LKEAMT                                              CLE031
     C                     ELSE                                                               CLE031
     C                     Z-ADDSETAMT    LKEAMT                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVE WKPURC    LKECCY                                              CLE031
     C                     MOVEAAKY       LKAKEY                                              CLE031
     C                     WRITELKEYFEDF                                                      CLE031
     C                     EXSR PRINEV                                                        CLE031
      *                                                                                       CLE031
      ** Format key for amount in Sale currency:                                              CLE031
      *                                                                                       CLE031
     C                     MOVE 'C'       AKY,10                                              CLE031
     C           WKSALC    IFEQ BJCYCD                                                        CLE031
     C                     MOVE 'B'       AKY,7                                               CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE 'F'       AKY,7                                               CLE031
     C                     ENDIF                                                              CLE031
     C           WKPURT    IFEQ 'F'                                                           CLE031
     C                     Z-ADDSETAMT    LKEAMT                                              CLE031
     C                     ELSE                                                               CLE031
     C                     Z-ADDWRKAMT    LKEAMT                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     MOVE WKSALC    LKECCY                                              CLE031
     C                     MOVEAAKY       LKAKEY                                              CLE031
     C                     WRITELKEYFEDF                                                      CLE031
     C                     EXSR PRINEV                                                        CLE031
     C           GENKY     IFEQ 'Y'                                                         MD051883
     C                     MOVE AKY,10    SAV10   1                                         MD051883
     C                     MOVE AKY,7     SAV7    1                                         MD051883
     C           FCTYFL    IFEQ 'Y'                                                         MD051883
     C                     MOVE AKY,4     SAV4    1                                         MD051883
     C                     MOVE 'R'       AKY,4                                             MD051883
     C                     ELSE                                                             MD051883
     C                     MOVE AKY,3     SAV3    1                                         MD051883
     C                     MOVE 'R'       AKY,3                                             MD051883
     C                     ENDIF                                                            MD051883
     C                     MOVE ' '       AKY,7                                             MD051883
     C                     MOVE 'J'       AKY,10                                            MD051883
     C                     MOVEAAKY       LKAKEY                                            MD051883
     C                     WRITELKEYFEDF                                                    MD051883
     C                     MOVE SAV10     AKY,10                                            MD051883
     C                     MOVE SAV7      AKY,7                                             MD051883
     C           FCTYFL    IFEQ 'Y'                                                         MD051883
     C                     MOVE SAV4      AKY,4                                             MD051883
     C                     ELSE                                                             MD051883
     C                     MOVE SAV3      AKY,3                                             MD051883
     C                     ENDIF                                                            MD051883
     C                     EXSR PRINEV                                                      MD051883
     C                     ENDIF                                                            MD051883
      *                                                                                       CLE031
     C           WKFCCY    IFEQ BJCYCD                                                        CLE031
     C                     Z-ADDWRKAMT    BASAMT 130                                          CLE031
     C                     ELSE                                                               CLE031
     C                     Z-ADD1         Y                                                   CLE031
     C           BJCYCD    LOKUPWCYA,Y                   13                                   CLE031
     C                     Z-ADDWDPA,Y    BANBDP  10                                          CLE031
     C                     Z-ADDFESPOT    ZEXCH                                               CLE031
     C                     MOVE FEMDI     ZMD                                                 CLE031
     C                     Z-ADDWRKAMT    ZAMTCI                                              CLE031
     C                     MOVE FEFCCY    ZCCYI                                               CLE031
     C                     MOVE BJCYCD    ZCCYO                                               CLE031
     C                     Z-ADDFENBDP    ZCDPI                                               CLE031
     C                     Z-ADDBANBDP    ZCDPO                                               CLE031
     C                     EXSR ZCONV                                                         CLE031
     C                     Z-ADDZAMTCO    BASAMT                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Format key for Base Currency Equivalent                                              CLE031
      ** of Spot Trade Account in Purchase Currency                                           CLE031
      *                                                                                       CLE031
     C                     MOVE 'P'       AKY,10                                              CLE031
     C           FELOAN    IFGT *BLANKS                                                     MD051242
     C                     MOVEAWKPURC    AKY,6                                             MD051242
     C                     MOVEA' '       AKY,9                                             MD051242
     C                     ELSE                                                             MD051242
     C                     MOVEAWKPURC    AKY,5                                               CLE031
     C                     MOVEA'  '      AKY,8                                               CLE031
     C                     ENDIF                                                            MD051242
     C                     MOVE BJCYCD    LKECCY                                              CLE031
     C                     Z-ADDBASAMT    LKEAMT                                              CLE031
     C                     MOVEAAKY       LKAKEY                                              CLE031
     C                     WRITELKEYFEDF                                                      CLE031
     C                     EXSR PRINEV                                                        CLE031
      *                                                                                       CLE031
      ** Format key for Base Currency Equivalent                                              CLE031
      ** of Spot Trade Account in Sale Currency                                               CLE031
      *                                                                                       CLE031
     C                     MOVE 'S'       AKY,10                                              CLE031
     C           FELOAN    IFGT *BLANKS                                                     MD051242
     C                     MOVEAWKSALC    AKY,6                                             MD051242
     C                     MOVEA' '       AKY,9                                             MD051242
     C                     ELSE                                                             MD051242
     C                     MOVEAWKSALC    AKY,5                                               CLE031
     C                     MOVEA'  '      AKY,8                                               CLE031
     C                     ENDIF                                                            MD051242
     C                     MOVEAAKY       LKAKEY                                              CLE031
     C                     WRITELKEYFEDF                                                      CLE031
     C                     EXSR PRINEV                                                        CLE031
      *                                                                                       CLE031
      ** Restore saved values:                                                                CLE031
      *                                                                                       CLE031
     C                     MOVEASAVAKY    AKY                                                 CLE031
     C                     MOVEASVLKEY    LKAKEY                                              CLE031
     C                     MOVE SVECCY    LKECCY                                              CLE031
     C                     MOVE SVSCCY    LKSCCY                                              CLE031
     C                     Z-ADDWRKAMT    LKEAMT                                              CLE031
     C                     MOVE *BLANK    LKSIND                                              CLE031
     C                     MOVE *BLANKS   LKOKEY                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDSR                                                              CLE031
      *                                                                                       CLE031
      ********************************************************************                    CLE031
     C/TITLE SR/PRINEV                                                                        CLE031
      ********************************************************************                    CLE031
      *                                                                                       CLE031
      * PRINEV - PRINT SETTLEMENT EVENT                                                       CLE031
      *                                                                                       CLE031
      *  CALLED FROM:  SETKEY                                                                 CLE031
      *                                                                                       CLE031
      *  CALLS: ZHASH                                                                         CLE031
      *                                                                                       CLE031
      ********************************************************************                    CLE031
      *                                                                                       CLE031
     C           PRINEV    BEGSR                                                              CLE031
      *                                                                                       CLE031
     C                     EXSR CHKCCY                                                        219275
      *                                                                                       219275
     C                     MOVE LKEAMT    EAMT0                                               CLE031
     C                     WRITELER130D1                                                      CLE031
     C                     ADD  1         LKNOR0                                              CLE031
      *                                                                                       CLE031
      ** If overflow indictor is on output headers for new page                               CLE031
     C           *IN80     IFEQ '1'                                                           CLE031
     C                     WRITELER130H1                                                      CLE031
     C                     WRITELER130H2                                                      CLE031
     C                     MOVE '0'       *IN80                                               CLE031
     C                     END                                                                CLE031
      ** Details on print file indicator                                                      CLE031
     C                     MOVE '1'       *IN21                                               CLE031
      *                                                                                       CLE031
     C                     Z-ADD1         Z                                                   CLE031
     C                     Z-ADD1         S                                                   CLE031
      *                                                                                       CLE031
      ** Calculate hash total for trailer                                                     CLE031
     C           LKEAMT    DIV  1000      ZZAMT                                               CLE031
     C                     Z-ADDLKVLRF    ZZTOTI                                              CLE031
     C                     Z-ADDLKVLRL    ZZTOTD                                              CLE031
     C                     EXSR ZHASH                                                         CLE031
     C                     Z-ADDZZTOTI    LKVLRF                                              CLE031
     C                     Z-ADDZZTOTD    LKVLRL                                              CLE031
      *                                                                                       CLE031
     C                     ENDSR                                                              CLE031
      *                                                                                       CLE031
      ********************************************************************                    CLE139
     C/TITLE SR/SRLOAM                                                                        CLE139
      ********************************************************************                    CLE139
      *                                                                                       CLE139
      * SRLOAM - WRITE RECORD IN LOAMSDK FILE                                                 CLE139
      *                                                                                       CLE139
      *  CALLED FROM: DETAIL                                                                  CLE139
      *                                                                                       CLE139
      *  CALLS: SRGNSQ                                                                        CLE139
      *                                                                                       CLE139
      ********************************************************************                    CLE139
      *                                                                                       CLE139
     C           SRLOAM    BEGSR                                                              CLE139
      *                                                                                       CLE139
      ** Write record in Loan Amendments file                                                 CLE139
      *                                                                                       CLE139
     C           WLNKEY    CHAINCLOAN                15                                       CLE139
      *                                                                                       CLE139
      ** Database error                                                                       CLE139
      *                                                                                       CLE139
     C           *IN15     IFEQ '1'                                                           CLE139
     C           *LOCK     IN   LDA                                                           CLE139
     C                     MOVELFELOAN    DBKEY                                               CLE139
     C                     MOVEL'025'     DBASE                                               CLE139
     C                     MOVEL'CLOAN'   DBFILE                                              CLE139
     C                     OUT  LDA                                                           CLE139
     C                     EXSR *PSSR                                                         CLE139
      *                                                                                       CLE139
     C                     ELSE                                                               CLE139
      *                                                                                       CLE139
     C                     EXSR SRGNSQ                                                        CLE139
     C                     CLEARLOAMSDKF                                                      CLE139
     C                     MOVELFELOAN    #LNRF                                               CLE139
     C                     MOVELLKEDAT    #VDAT                                               CLE139
     C                     Z-ADD#LAS1     #LASN                                               CLE139
     C                     Z-ADD2         #MRIN                                               CLE139
     C                     MOVELLTYP      #LTYP                                               CLE139
     C                     MOVELSUTP      #SUTP                                               CLE139
     C                     MOVELPTYP      #PTYP                                               CLE139
     C                     MOVEL'PI'      #AMTP                                               CLE139
     C                     MOVELCCY       #CCY                                                CLE139
     C                     MOVELLKEAMT    #PRAM                                               CLE139
     C                     MOVELLKEAMT    #TAMT                                               CLE139
     C                     MOVELBRCA      #BRCA                                               CLE139
     C                     MOVELCNUM      #CNUM                                               CLE139
     C                     MOVEL'Y'       #AUTO                                               CLE139
     C                     MOVEL'A'       #LLAG                                               CLE139
     C                     MOVELFCUS      #FCUS                                               CLE139
     C                     MOVELFTYP      #FTYP                                               CLE139
     C                     MOVELFSEQ      #FSEQ                                               CLE139
     C                     MOVELFCLB      #FCLB                                               CLE139
     C                     MOVELBJRDNB    #ORED                                               CLE139
     C                     MOVELBJRDNB    #LCD                                                CLE139
     C                     MOVEASTAMP,1   #TMST                                               CLE139
     C**********           MOVEL'XXXX'    #CLAS                                     CLE139 AR745249A
     C                     MOVELCLAS      #CLAS                                            AR745249A
     C                     MOVEL'F'       #GPRT                                               CLE139
     C                     MOVELRECI      #RECI                                               CLE139
      *                                                                                       CLE139
     C                     WRITELOAMSDKF                                                      CLE139
      *                                                                                       CLE139
     C                     END                                                                CLE139
      *                                                                                       CLE139
      ** Update trailer file                                                                  CLE139
      *                                                                                       CLE139
     C           KHASH     KLIST                                                              CLE139
     C**********           KFLD           KLOAN   60                                   CLE139 CLE148
     C                     KFLD           KLOAN   6                                           CLE148
     C                     KFLD           KVDAT   50                                          CLE139
     C                     KFLD           KSEQ    30                                          CLE139
      *                                                                                       CLE139
     C**********           Z-ADD999999    KLOAN                                        CLE139 CLE148
     C                     MOVEL'999999'  KLOAN                                               CLE148
     C                     Z-ADD99999     KVDAT                                               CLE139
     C                     Z-ADD999       KSEQ                                                CLE139
      *                                                                                       CLE139
     C           KHASH     CHAINLOAMS                15                                       CLE139
     C           *IN15     IFEQ '1'                                                           CLE139
     C           *LOCK     IN   LDA                                                           CLE139
     C                     MOVELKLOAN     DBKEY                                               CLE139
     C                     MOVEL'026'     DBASE                                               CLE139
     C                     MOVEL'LOAMS'   DBFILE                                              CLE139
     C                     OUT  LDA                                                           CLE139
     C                     EXSR *PSSR                                                         CLE139
      *                                                                                       CLE139
     C                     ELSE                                                               CLE139
      *                                                                                       CLE139
     C                     ADD  1         #NORE                                               CLE139
     C                     Z-ADD1         Z                                                   CLE139
     C                     Z-ADD3         S                                                   CLE139
     C           #PRAM     DIV  1000      ZZAMT                                               CLE139
     C                     Z-ADD#VRIF     INT,S                                               CLE139
     C                     Z-ADD#VRIL     DEC,S                                               CLE139
     C                     EXSR ZHASH                                                         CLE139
     C                     Z-ADDZZTOTI    #VRIF                                               CLE139
     C                     Z-ADDZZTOTD    #VRIL                                               CLE139
     C                     Z-ADD4         S                                                   CLE139
     C                     Z-ADD#VRRF     INT,S                                               CLE139
     C                     Z-ADD#VRRL     DEC,S                                               CLE139
     C                     EXSR ZHASH                                                         CLE139
     C                     Z-ADDZZTOTI    #VRRF                                               CLE139
     C                     Z-ADDZZTOTD    #VRRL                                               CLE139
     C                     UPDATLOAMSZ1F                                                      CLE139
     C                     ENDIF                                                              CLE139
      *                                                                                       CLE139
     C                     ENDSR                                                              CLE139
      ********************************************************************                    CLE139
     C/TITLE SR/SRGNSQ                                                                        CLE139
      ********************************************************************                    CLE139
      *                                                                                       CLE139
      * SRGNSQ - GENERATE NEXT AMEND SEQUENCE NUMBER                                          CLE139
      *                                                                                       CLE139
      *  CALLED FROM: SRLOAM                                                                  CLE139
      *                                                                                       CLE139
      *  CALLS: NONE                                                                          CLE139
      *                                                                                       CLE139
      ********************************************************************                    CLE139
      *                                                                                       CLE139
     C           SRGNSQ    BEGSR                                                              CLE139
      *                                                                                       CLE139
     C           KLAKEY    KLIST                                                              CLE139
     C**********           KFLD           #LNR1   60                                   CLE139 CLE148
     C                     KFLD           #LNR1   6                                           CLE148
     C                     KFLD           #VDA1   50                                          CLE139
     C                     KFLD           #LAS1   30                                          CLE139
      *                                                                                       CLE139
     C                     MOVE FELOAN    #LNR1                                               CLE139
     C                     Z-ADDBJRDNB    #VDA1                                               CLE139
     C                     Z-ADD*ZERO     #LAS1                                               CLE139
     C           KLAKEY    SETLLLOAMS                                                         CLE139
     C                     READ LOAMS                    99                                   CLE139
     C           *IN99     DOWEQ*OFF                                                          CLE139
     C           #RECIZ    IFEQ 'T'                                                           CLE139
     C                     LEAVE                                                              CLE139
     C                     ENDIF                                                              CLE139
     C           #LNR1     IFNE #LNRF                                                         CLE139
     C           #VDA1     ORNE #VDAT                                                         CLE139
     C                     LEAVE                                                              CLE139
     C                     ENDIF                                                              CLE139
     C                     Z-ADD#LASN     #LAS1                                               CLE139
     C                     READ LOAMS                    99                                   CLE139
     C                     ENDDO                                                              CLE139
     C                     ADD  1         #LAS1                                               CLE139
      *                                                                                       CLE139
     C                     ENDSR                                                              CLE139
     C/COPY WNCPYSRC,LEH01083
      ********************************************************************
     C/TITLE SR/*PSSR
      ********************************************************************
      *
      * *PSSR  - Program exception error routine
      *          Called automatically if a program error occurs,
      *          or directly by the program code using EXSR.
      *          This subroutine DUMPs the program just once.
      *
      *  CALLED FROM:  Any Error Situation
      *
      *  CALLS:  ZSFILE
      *
      ********************************************************************
      *
     C           *PSSR     BEGSR
      *
     C           WRUN      IFEQ *BLANKS
     C                     MOVE 'Y'       WRUN    1
     C                     SETON                     U7U8                 S01117
     C                     DUMP
      *
     C                     Z-ADD0         PAGE
      *
     C                     Z-ADDSFNUMU    ZSNUMU
     C                     CALL 'ZSFILE'
     C                     PARM           SEQ
     C                     PARM *BLANKS   SENTY
     C                     PARM           SFILEU
     C                     PARM           ZSNUMU
     C                     PARM           ZSERR
      *
     C           ZSERR     IFEQ 'Y'
      ** Error during ZSFILE processing, return to calling program
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
      *
      ** Write error report details                                       S01117
     C                     WRITELER130A1
     C                     WRITEERROR
     C                     END
      *
      **  IF *PSSR already run, then just end the program here.           S01117
     C                     SETON                     U7U8LR               S01117
     C                     RETRN                                          S01117
     C                     ENDSR
      *
      ********************************************************************                    219275
     C/TITLE SR/CHKCCY                                                                        219275
      ********************************************************************                    219275
      *                                                                                       219275
      * CHKCCY - CHECK CURRENCY NUMBER OF DECIMAL PLACES                                      219275
      *                                                                                       219275
      *  CALLED FROM: ACCRUE, SETTLE, PRINEV,                                                 219275
      *                                                                                       219275
      *  CALLS:                                                                               219275
      *                                                                                       219275
      ********************************************************************                    219275
      *                                                                                       219275
     C           CHKCCY    BEGSR                                                              219275
      *                                                                                       219275
      *Check number of decimal places in currency:                                            219275
     C                     Z-ADD1         Y       30                                          219275
     C           LKECCY    LOKUPWCYA,Y                   13                                   219275
     C           WDPA,Y    COMP 1                    323031                                   219275
     C           WDPA,Y    COMP 2                    33  32                                   219275
      *                                                                                       219275
     C                     ENDSR                                                              219275
      *                                                                                       219275
      *****************************************************************                     AR317401
     C/TITLE SR/FEECHG                                                *                     AR317401
      *****************************************************************                     AR317401
      *                                                               *                     AR317401
      *  FEECHG - Loan Fee subtype change processing.                 *                     AR317401
      *                                                               *                     AR317401
      *  This SR will add the functionality of reversing fee accruals *                     AR317401
      *  posted but not paid from the old subtype and repost the      *                     AR317401
      *  total amount to the new subtype. Valid for loan fees only.   *                     AR317401
      *                                                               *                     AR317401
      *  CALLED FROM: SR/DETAIL                                       *                     AR317401
      *                                                               *                     AR317401
      *  CALLS: OPNFIL, CHKCCY                                        *                     AR317401
      *                                                               *                     AR317401
      *****************************************************************                     AR317401
      *                                                                                     AR317401
     C           FEECHG    BEGSR                                                            AR317401
      *                                                                                     AR317401
     C                     Z-ADD0         LKEAMT                                            AR317401
     C                     Z-ADDFELPAM    LKEAMT                                            AR317401
      *                                                                                     AR317401
     C           LKEAMT    IFNE 0                                                           AR317401
     C                     MOVE '1'       *IN34                                             AR317401
     C                     MOVE 'L'       LKRECI                                            AR317401
     C**********           Z-ADDFELOAN    LKLNNO                                  AR317401 MD029938A
     C                     MOVELFELOAN    LKLNNO                                           MD029938A
     C                     MOVE 'A'       AKY,3                                             AR317401
     C                     MOVEAFELTYP    AKY,1                                             AR317401
     C                     MOVEAFESUTP    AKY,4                                             AR317401
     C                     MOVEAFECLAS    AKY,11                                            AR317401
      *                                                                                     AR317401
      ** Pos. 7 Recourse Ind. (R = With Recourse).                                          AR317401
      *                                                                                     AR317401
     C           RCSI      IFEQ 'R'                                                         AR317401
     C           RCSI      OREQ 'Y'                                                         AR317401
     C                     MOVE 'R'       AKY,7                                             AR317401
     C                     ELSE                                                             AR317401
     C                     MOVE ' '       AKY,7                                             AR317401
     C                     END                                                              AR317401
     C*                                                                                     AR317401
     C                     MOVEAWFCOD     AKY,8                                             AR317401
     C                     MOVE 'F'       AKY,10                                            AR317401
     C                     MOVE ' '       AKY,6                                             AR317401
      *                                                                                     AR317401
     C           FEPYON    IFEQ 'S'                                                         AR317401
     C                     MOVE 'S'       AKY,6                                             AR317401
     C                     END                                                              AR317401
      *                                                                                     AR317401
     C                     MOVEAAKY       LKAKEY                                            AR317401
     C                     MOVE OLNO      LKOLNO                                            AR317401
      *                                                                                     AR317401
     C           CLE004    IFEQ 'Y'                                                         AR317401
     C           CLE005    ANDEQ'Y'                                                         AR317401
     C           PTFI      IFEQ 'I'                                                         AR317401
     C                     MOVE 'I'       AKY,7                                             AR317401
     C                     ENDIF                                                            AR317401
     C           PTFI      IFEQ 'P'                                                         AR317401
     C           PTFI      OREQ 'S'                                                         AR317401
     C           PTFI      OREQ 'R'                                                         AR317401
     C                     MOVE 'P'       AKY,7                                             AR317401
     C                     ENDIF                                                            AR317401
     C                     ENDIF                                                            AR317401
     C                     MOVEAAKY       LKAKEY                                            AR317401
      *                                                                                     AR317401
      ** Set up fields for output.                                                          AR317401
      *                                                                                     AR317401
     C                     MOVE *BLANKS   LKSCCY                                            AR317401
      *                                                                                     AR317401
     C           FESTTL    IFNE 09                                                          AR317401
     C           CLE033    ORNE 'Y'                                                         AR317401
     C           SET09     ORNE 'T'                                                         AR317401
      *                                                                                     AR317401
     C           CEU004    IFEQ 'Y'                                                         AR317401
     C           FESCCY    ANDNE'   '                                                       AR317401
     C           FESCCY    ANDNEFEFCCY                                                      AR317401
     C           LKEAMT    ANDNE0                                                           AR317401
     C                     MOVE FESCCY    LKSCCY                                            AR317401
      *                                                                                     AR317401
     C                     ENDIF                                                            AR317401
     C                     ENDIF                                                            AR317401
     C                     MOVE FECNUM    LKCNUM                                            AR317401
     C                     MOVE FEFCCY    LKECCY                                            AR317401
     C                     MOVELFEOURS    LKOSAC                                            AR317401
      *                                                                                     AR317401
      ** Determine AML Pay/Receive Instructions.                                            AR317401
      *                                                                                     AR317401
     C           CGL020    IFEQ 'Y'                                                         AR317401
     C                     EXSR SRAMLI                                                      AR317401
     C                     ENDIF                                                            AR317401
      *                                                                                     AR317401
     C                     Z-ADDFESTTL    LKSETP                                            AR317401
     C                     Z-ADDWAPDAT    LKEDAT                                            AR317401
      *                                                                                     AR317401
      * Setup start date or last interest date variable (LKSLID).                           AR317401
      *                                                                                     AR317401
     C                     Z-ADDFEPSTD    LKSLID                                            AR317401
      *                                                                                     AR317401
     C           CAS009    IFEQ 'Y'                                                         AR317401
     C                     Z-ADDWRKSTR    LKSLID                                            AR317401
     C                     ENDIF                                                            AR317401
     C                     MOVE FEBRCA    LKBRCD                                            AR317401
     C                     MOVE *BLANKS   LKOSBR                                            AR317401
     C                     Z-ADDLASQ      LKACSQ                                            AR317401
      *                                                                                     AR317401
      * Setup start date or last interest date variable (LKSLID).                           AR317401
      *                                                                                     AR317401
     C                     Z-ADDFEPSTD    LKSLID                                            AR317401
      *                                                                                     AR317401
     C           CLE031    IFEQ 'Y'                                                         AR317401
     C                     Z-ADDWRKSTR    LKSLID                                            AR317401
     C                     ENDIF                                                            AR317401
      *                                                                                     AR317401
      ** Set indicator for decimal places.                                                  AR317401
      *                                                                                     AR317401
     C                     Z-ADD1         B       30                                        AR317401
     C           FEFCCY    LOKUPWCYA,B                   56                                 AR317401
     C           WDPA,B    COMP 1                    323031                                 AR317401
     C           WDPA,B    COMP 2                    33  32                                 AR317401
      *                                                                                     AR317401
     C           BGN0ST    IFEQ 'Y'                                                         AR317401
     C           BGN0ST    OREQ 'N'                                                         AR317401
     C           BKPRCU    ANDEQ'Y'                                                         AR317401
     C           FEPRFC    ANDNE*BLANKS                                                     AR317401
     C                     MOVE FEPRFC    LKPRFC                                            AR317401
     C                     ENDIF                                                            AR317401
      *                                                                                     AR317401
     C                     EXSR OPNFIL                                                      AR317401
      *                                                                                     AR317401
      **  If CLE005 is switched on, setup settlement details.                               AR317401
      *                                                                                     AR317401
     C           CLE005    IFEQ 'Y'                                                         AR317401
      *                                                                                     AR317401
     C           CLE004    IFEQ 'N'                                                         AR317401
     C           CLE004    OREQ 'Y'                                                         AR317401
     C           PTFI      ANDEQ*BLANK                                                      AR317401
     C                     MOVE RONS      LKOSAC                                            AR317401
     C                     MOVE RSTM      LKSETP                                            AR317401
      *                                                                                     AR317401
      ** Determine AML Pay/Receive Instructions.                                            AR317401
      *                                                                                     AR317401
     C           CGL020    IFEQ 'Y'                                                         AR317401
     C                     MOVELSTLNS2    STLNS1                                            AR317401
     C                     EXSR SRAMPR                                                      AR317401
     C                     ENDIF                                                            AR317401
      *                                                                                     AR317401
     C                     ENDIF                                                            AR317401
     C           CLE004    IFEQ 'Y'                                                         AR317401
     C           PTFI      IFEQ 'P'                                                         AR317401
     C           PTFI      OREQ 'S'                                                         AR317401
     C           PTFI      OREQ 'R'                                                         AR317401
     C                     MOVE PONS      LKOSAC                                            AR317401
     C                     MOVE PSTM      LKSETP                                            AR317401
      *                                                                                     AR317401
      ** Determine AML Pay/Receive Instructions.                                            AR317401
      *                                                                                     AR317401
     C           CGL020    IFEQ 'Y'                                                         AR317401
     C                     MOVELSTLNS2    STLNS1                                            AR317401
     C                     EXSR SRAMPR                                                      AR317401
     C                     ENDIF                                                            AR317401
      *                                                                                     AR317401
     C                     ENDIF                                                            AR317401
     C           PTFI      IFEQ 'I'                                                         AR317401
     C                     MOVE *BLANKS   LKOSAC                                            AR317401
     C                     MOVE *BLANKS   LKSETP                                            AR317401
      *                                                                                     AR317401
      ** Determine AML Pay/Receive Instructions.                                            AR317401
      *                                                                                     AR317401
     C           CGL020    IFEQ 'Y'                                                         AR317401
     C                     MOVEL*BLANKS   STLNS1                                            AR317401
     C                     EXSR SRAMPR                                                      AR317401
     C                     ENDIF                                                            AR317401
      *                                                                                     AR317401
     C                     ENDIF                                                            AR317401
     C                     ENDIF                                                            AR317401
     C                     ENDIF                                                            AR317401
      *                                                                                     AR317401
      ** Write record to account key file then report details.                              AR317401
      *                                                                                     AR317401
     C                     WRITELKEYFEDF                                                    AR317401
      *                                                                                     AR317401
     C                     EXSR CHKCCY                                                      AR317401
      *                                                                                     AR317401
     C                     Z-ADDLKEAMT    EAMT0                                             AR317401
     C                     WRITELER130D1                                                    AR317401
      *                                                                                     AR317401
      ** Work field for number account keys generated.                                      AR317401
      *                                                                                     AR317401
     C                     ADD  1         LKNOR0                                            AR317401
      *                                                                                     AR317401
      ** If overflow indictor is on output headers for new page.                            AR317401
      *                                                                                     AR317401
     C           *IN80     IFEQ '1'                                                         AR317401
     C                     WRITELER130H1                                                    AR317401
     C                     WRITELER130H2                                                    AR317401
     C                     MOVE '0'       *IN80                                             AR317401
     C                     END                                                              AR317401
      *                                                                                     AR317401
      ** Details on print file indicator.                                                   AR317401
      *                                                                                     AR317401
     C                     MOVE '1'       *IN21                                             AR317401
      *                                                                                     AR317401
     C                     Z-ADD1         Z                                                 AR317401
     C                     Z-ADD1         S                                                 AR317401
      *                                                                                     AR317401
      ** Calculate hash total for trailer.                                                  AR317401
      *                                                                                     AR317401
     C           LKEAMT    DIV  1000      ZZAMT                                             AR317401
     C                     Z-ADDLKVLRF    ZZTOTI                                            AR317401
     C                     Z-ADDLKVLRL    ZZTOTD                                            AR317401
     C                     EXSR ZHASH                                                       AR317401
     C                     Z-ADDZZTOTI    LKVLRF                                            AR317401
     C                     Z-ADDZZTOTD    LKVLRL                                            AR317401
     C                     ENDIF                                                            AR317401
      *                                                                                     AR317401
     C                     ENDSR                                                            AR317401
      *                                                                                     AR317401
      *****************************************************************                     AR800866
     C/TITLE SR/SRFCTY                                                *                     AR800866
      *****************************************************************                     AR800866
      *                                                               *                     AR800866
      *  SRFCTY - Retrieve account sequence from facility file.       *                     AR800866
      *                                                               *                     AR800866
      *  CALLED FROM: ACCRUE, SETTLE                                  *                     AR800866
      *                                                               *                     AR800866
      *  CALLS: NONE                                                  *                     AR800866
      *                                                               *                     AR800866
      *****************************************************************                     AR800866
      *                                                                                     AR800866
     C           SRFCTY    BEGSR                                                            AR800866
      *                                                                                     AR800866
      ** Chain to LF/FCLTY and check for the account sequence.                              AR800866
      *                                                                                     AR800866
     C                     MOVELFEFACL    FCFTYP                                            AR800866
     C                     MOVE FEFACL    FCFNUM                                            AR800866
      *                                                                                     AR800866
     C           *LOVAL    SETLLFCLTY                                                       AR800866
     C           FCKEY     CHAINFCLTY               N01                                     AR800866
      *                                                                                     AR800866
     C           *IN01     IFEQ '1'                                                         AR800866
     C           *LOCK     IN   LDA                                                         AR800866
     C                     MOVEL'LER130'  DBPGM                                             AR800866
     C                     MOVELWFCKEY    DBKEY            ************                     AR800866
     C                     Z-ADD11        DBASE            * DBERR 011*                     AR800866
     C                     MOVEL'FCLTYFM' DBFILE           ************                     AR800866
     C                     OUT  LDA                                                         AR800866
     C                     EXSR *PSSR                                                       AR800866
     C                     ENDIF                                                            AR800866
      *                                                                                     AR800866
     C                     ENDSR                                                            AR800866
      *                                                                                     AR800866
      ****************************************************************
      *    SRRETRPKY - Retrieve LEACCTPD Repayment Priorities         *                       CLE164
      *****************************************************************                       CLE164
     C           SRRPKY    BEGSR                                                              CLE164
      *                                                                                       CLE164
     C                     CALL 'LE000801'                                                    CLE164
     C                     PARM *BLANKS   PRETC   7                                           CLE164
     C                     PARM SECATC    PCATC   5                                           CLE164
     C                     PARM 'LEFEEZTD'PFILE  10                                           CLE164
     C                     PARM FELOAN    PLOAN   6                                           CLE164
     C                     PARM FEBRCA    PBRCH   3                                           CLE164
     C                     PARM FECNUM    PCNUM   6                                           CLE164
     C                     PARM FEFACL    PFCLTY                                              CLE164
     C                     PARM FEFSEQ    PFESEQ                                              CLE164
     C                     PARM *ZEROS    PREPR                                               CLE164
     C                     PARM *ZEROS    PCAPR                                               CLE164
     C                     PARM *BLANKS   SEOVFL                                              CLE164
      *                                                                                       CLE164
     C                     MOVELPREPR     SEREPR                                              CLE164
     C                     MOVELPCAPR     SECAPR                                              CLE164
      *                                                                                       CLE164
     C                     ENDSR                                                              CLE164
      *****************************************************************                       CLE164
      *****************************************************************                       CLE159
      *                                                               *                       CLE159
      *  SRAMTZ - Retrieve Daily accrual amt from Fee Amortisation    *                       CLE159
      *           Extract - Detailcility file.                        *                       CLE159
      *                                                               *                       CLE159
      *  CALLED FROM: ACCRUE                                          *                       CLE159
      *                                                               *                       CLE159
      *  CALLS: NONE                                                  *                       CLE159
      *                                                               *                       CLE159
      *****************************************************************                       CLE159
     C           SRAMTZ    BEGSR                                                              CLE159
      *                                                                                       CLE159
     C           *LIKE     DEFN F2DAFA    TODAFA                                              CLE159
     C                     Z-ADD*ZEROS    TODAFA                                              CLE159
      *                                                                                       CLE159
     C/EXEC SQL                                                                               CLE159
     C+ SELECT SUM(F2DAFA) INTO :TODAFA                                                       CLE159
     C+   FROM LEFHS2TD                                                                       CLE159
      ** Midas LE Fee Amortization Extract                                                    CLE159
     C+   WHERE F2BRCA = :FEBRCA AND                                                          CLE159
     C+   F2CNUM = :FECNUM AND                                                                CLE159
     C+   F2FACL = :FEFACL AND                                                                CLE159
     C+   F2FSEQ = :FEFSEQ AND                                                                CLE159
     C+   F2DATE = :WAPDAT                                                                    CLE159
     C/END-EXEC                                                                               CLE159
      *                                                                                       CLE159
      * Use recalculated daily accrual fee                                                    CLE159
     C                     Z-ADDTODAFA    LKEAMT                                              CLE159
      *                                                                                       CLE159
     C                     ENDSR                                                              CLE159
      *****************************************************************                       CLE159
      /TITLE SR/ZCONV
     C/COPY ZSRSRC,ZCONVZ1
      /TITLE SR/ZXRATEZ1
     C/COPY ZSRSRC,ZXRATEZ1
      /TITLE SR/ZDATE1
     C/COPY ZSRSRC,ZDATE1Z2
      /TITLE SR/ZDATE2
     C/COPY ZSRSRC,ZDATE2Z2
      /TITLE SR/ZHASH
     C/COPY ZSRSRC,ZHASHZ3
      /TITLE SR/ZFREQB                                                                        CLE031
     C/COPY ZSRSRC,ZFREQBZ2                                                                   CLE031
      /TITLE SR/ZCHKH                                                                         CLE031
     C/COPY ZSRSRC,ZCHKH                                                                      CLE031
      /TITLE SR/ZACCH                                                                         CLE031
     C/COPY ZSRSRC,ZACCH                                                                      CLE031
      /TITLE SR/ZINTDY                                                                        CAS009
     C/COPY ZSRSRC,ZINTDYZ2                                                                   CAS009
      /TITLE SR/ZDATE9                                                                        CAS009
     C/COPY ZSRSRC,ZDATE9Z3                                                                   CAS009
      /TITLE SR/ZDAT10                                                                        CAS009
     C/COPY ZSRSRC,ZDAT10Z2                                                                   CAS009
     C/COPY ZSRSRC,ZFRQB3                                                                     CLE141
     C/COPY WNCPYSRC,LER130CCP4                                           S01408
      ****************************************************************
**  CPY@
(c) Finastra International Limited 2001
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**   ZFMD  -  NUMBER OF DAYS IN THE MONTH                                                     CLE031
312831303130313130313031                                                                      CLE031
** STAMP - Dummy timestamp                                                                    CLE034
0001-01-01-00.00.00.000000                                                                    CLE034
**   SVAL  -  SYSTEM VALUES ARRAY                                                             218782
Settlement09Postings                                                                          218782
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365