     H        1
      *****************************************************************
/*S*D****RPGBASE*******************************************************                     MD031496
/*STD *  RPGSQL                                                       *                     MD031496
/*EXI *  TEXT('Midas LE Fee accruals, update and a/c key gen')        *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Customer Lending Module                              *
     F*                                                               *
     F*  LER135 - Processing for Calculated Fees                      *
     F*                                                               *
     F*  Function:  This program performs accruals for calculated     *
     F*             facility fees and generates corresponding         *
     F*             account keys.  Accrual is performed on a          *
     F*             daily basis until a fee payment is due then       *
     F*             payment processing takes place and a report       *
     F*             is produced showing how the fee amount is         *
     F*             calculated.                                       *
     F*  (COB)                                                        *
     F*                                                               *
     F*  Called By: LERC135 - Fee Calculations & Accruals.            *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD053375           Date 11Oct19               *
      *  Prev Amend No. MD055481           Date 04Sep20               *
      *                 AR820690           Date 12Oct12               *
      *                 AR956619           Date 28Jun12               *
      *                 AR911591           Date 03May12               *
      *                 MD055733           Date 03Jul20               * 
      *                 MD056223           Date 15Jul20               *
      *                 MD054240           Date 22Apr20               *
      *                 MD055069           Date 26Feb20               *
      *                 AR674226           Date 04Dec19               *
      *                 MD054703           Date 14Jan20               *
      *                 MD023855           Date 14Jan20               *
      *                 MD025983           Date 06Nov19               *
      *                 MD054354           Date 23Oct19               *
      *                 MD033473           Date 23Oct19               *
      *                 MD026969A          Date 23Oct19               *
      *                 MD026969           Date 23Oct19               *
      *                 MD054101           Date 08Aug19               *
      *                 MD053873           Date 10Jul19               *
      *                 MD052216           Date 04Apr19               *
      *                 MD047522           Date 21Nov19               *
      *                 CER050             Date 16Jun19               *
      *                 MD054318           Date 10Sep19               *
      *                 MD053946           Date 17Jul19               *
      *                 MD051883           Date 04Apr19               *
      *                 261205A            Date 20Aug19               *
      *                 MD053295           Date 13Apr19               *
      *                 MD052410           Date 16May19               *
      *                 MD052952           Date 25Mar19               *
      *                 MD050139           Date 23Mar18               *
      *                 MD050111           Date 17Apr18               *
      *                 MD051940           Date 09Oct18               *
      *                 MD051969           Date 24Jun18               *
      *                 258414             Date 18Jul18               *
      *                 CLE071A            Date 18Jul18               *
      *                 CLE071             Date 18Jul18               *
      *                 MD051242           Date 25Jun18               *
      *                 MD046370           Date 16Nov17               *
      *                 MD046248           Date 27Oct17               *
      *                 MD046080           Date 17Sep17               *
      *                 MD047474           Date 16Oct17               *
      *                 MD047993           Date 23Sep17               *
      *                 MD035545           Date 11Sep15               *
      *                 MD037173           Date 12Feb16               *
      *                 MD046351           Date 23Aug17               *
      *                 MD031473A          Date 14Dec16               *
      *                 MD031473           Date 24Feb16               *
      *                 MD045479           Date 21Jun17               *
      *                 MD036064           Date 26Jul17               *
      *                 MD045010           Date 05Apr17               *
      *                 CGL184             Date 07Dec16               *
      *                 CLE154             Date 10Aug12               *
      *                 CLE141A            Date 28Apr16               *
      *                 CLE141             Date 08Feb16               *
      *                 MD033613           Date 18Jun15               *
      *                 MD031496           Date 06Jan15               *
      *                 CLE164             Date 18Aug14               *
      *                 AR317401           Date 19Aug14               *
      *                 MD020563           Date 21May13               *
      *                 MD020212           Date 30Apr13               *
      *                 AR1047943          Date 24Apr13               *
      *                 AR823503           Date 24Apr13               *
      *                 AR1097176          Date 22Mar13               *
      *                 CFC006             Date 06Aug12               *
      *                 AR750601           Date 07Feb13               *
      *                 AR753180           Date 07Feb13               *
      *                 AR995302           Date 07Feb13               *
      *                 AR632102B          Date 07Feb13               *
      *                 259030             Date 07Feb13               *
      *                 AR1078443          Date 17Jan12               *
      *                 AR1069056          Date 23Dec12               *
      *                 AR996895           Date 25Nov12               *
      *                 AR1055539          Date 12Nov12               *
      *                 AR1056323          Date 14Nov12               *
      *                 AR740063A          Date 25Oct12               *
      *                 261129A            Date 22Oct12               *
      *                 261129             Date 22Oct12               *
      *                 258597             Date 22Oct12               *
      *                 260881             Date 09Oct12               *
      *                 AR634880           Date 20Oct12               *
      *                 AR741212           Date 14Oct12               *
      *                 AR738695           Date 14Oct12               *
      *                 AR734175           Date 14Oct12               *
      *                 AR997862           Date 14Oct12
      *                 AR810483           Date 14Oct12               *
      *                 AR750305           Date 14Oct12               *
      *                 AR699396           Date 14Oct12               *
      *                 262735             Date 17Aug12               *
      *                 261084             Date 17Aug12               *
      *                 AR738130           Date 01Aug12               *
      *                 AR707261           Date 01Aug12               *
      *                 AR571427           Date 01Aug12               *
      *                 AR567790           Date 01Aug12               *
      *                 AR402543           Date 01Aug12               *
      *                 AR318650           Date 01Aug12               *
      *                 AR217562           Date 01Aug12               *
      *                 263074             Date 01Aug12               *
      *                 262506             Date 01Aug12               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 AR800866           Date 27Jul12               *
      *                 AR640738           Date 27Jul12               *
      *                 261128             Date 27Jul12               *
      *                 AR326180           Date 27Jul12               *
      *                 AR852475           Date 03Nov11               *
      *                 AR821740           Date 29Aug11               *
      *                 CER049             Date 06Dec10               *
      *                 AR745249A          Date 15Jun11               *
      *                 AR787620           Date 10Jun11               *
      *                 AR745249           Date 19May11               *
      *                 CLE139             Date 06Dec10               *
      *                 CLE064             Date 06Dec10               *
      *                 260472             Date 27May09               *
      *                 CLE073             Date 13May08               *
      *                 263666             Date 01Feb10               *
      *                 CER059             Date 19Jul10               *
      *                 CER016A            Date 19May08               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 BUG23174           Date 24Mar09               *
      *                 BUG23244           Date 17Mar09               *
      *                 BUG22790           Date 17Feb09               *
      *                 260472             Date 27May09               *
      *                 CSC042             Date 16Feb09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 CSW208             Date 15Apr08               *
      *                 250628             Date 08Oct07               *
      *                 CPK027             Date 18Apr07               *
      *                 249023             Date 20Jul07               *
      *                 248697             Date 27Jun07               *
      *                 248440             Date 18Jun07               *
      *                 248358             Date 12Jun07               *
      *                 247979             Date 23May07               *
      *                 247821             Date 23May07               *
      *                 247644             Date 14May07               *
      *                 243496B            Date 12Apr07               *
      *                 246141             Date 29Mar07               *
      *                 244411B            Date 05JAN07               *
      *                 244411             Date 14DEC06               *
      *                 246018             Date 27Feb07               *
      *                 245803             Date 20Feb07               *
      *                 245081             Date 30Jan07               *
      *                 243843             Date 18Jan07               *
      *                 245093             Date 18Jan06               *
      *                 243496             Date 24Nov06               *
      *                 164847             Date 30Nov06               *
      *                 243717             Date 16Nov06               *
      *                 243499             Date 09Nov06               *
      *                 BUG13031           Date 17Jan07               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242777             Date 04Oct06               *
      *                 242286             Date 26Sep06               *
      *                 214208             Date 18Sep06               *
      *                 239961             Data 19Jun06               *
      *                 212048             Data 06Jun06               *
      *                 218648             Date 06Jun06               *
      *                 220555             Date 06Jun06               *
      *                 233823             Date 26May06               *
      *                 227253             Date 28Jun04               *
      *                 209380             Date 23Oct02               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 BUG8762            Date 01Oct05               *
      *                 CLE106             Date 01Aug04               *
      *                 227716             Date 08Jun04               *
      *                 CLE038             Date 04Jun04               *
      *                 CIR013             Date 25Apr05               *
      *                 230521             Date 28Oct04               *
      *                 CSW037A            Date 02May05               *
      *                 BUG6213            Date 04Apr05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 222373             Date 27Oct03               *
      *                 218992             Date 03Sep03               *
      *                 214120             Date 03Sep03               *
      *                 218782             Date 23Jun03               *
      *                 CLE034             Date 19Jun03               *
      *                 CLE031             Date 10Mar03               *
      *                 CGL020             Date 12Dec02               *
      *                 CLE028             Date 27Jun02               *
      * Midas Release 4.01.03 ----------------------------------------*
      *                 213377             Date 10Jan03               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 206539             Date 15Oct02               *
      *                 205529             Date 07Jun02               *
      *                 196612             Date 02May02               *
      *                 204866             Date 02May02               *
      *                 204452             Date 02May02               *
      *                 204467             Date 02May02               *
      *                 204444             Date 01May02               *
      *                 202954             Date 02May02               *
      *                 204354             Date 25Apr02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CLE023             Date 19Nov01               *
      *                 200289             Date 19Nov01               *
      *                 194912             Date 19Nov01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 181727             Date 28Jun01               *
      *                 177910             Date 11Jun01               *
      *                 CDE002             Date 04Apr00               *
      *                 179741             Date 27Mar01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CMX001             Data 01Jan00               *
      *                 CLE013             Date 06Nov00               *
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CLE009             Date 10Jun99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 155514             Date 09Jun99               *
      *                 155912             Date 03Mar99               *
      *                 155672             Date 25Feb99               *
      *                 154799             Date 24Feb99               *
      *                 151295             Date 18Feb99               *
      *                 153736             Date 25Feb99               *
      *                 153672             Date 25Feb99               *
      *                 152166             Date 21Jan99               *
      *                 142402             Date 18Feb99               *
      *                 141462             Date 18Feb99               *
      *                 141453             Date 17Feb99               *
     F*                 144257             DATE 08MAR99               *
     F*                 132877             DATE 29SEP98               *
     F*                 138165             DATE 29SEP98               *
     F*                 138421             DATE 28SEP98               *
     F*                 123004             DATE 23JAN98               *
     F*                 128725             Date 12Jan98               *
     F*                 CLE005             Date 22May97               *
     F*                 CLE007             Date 22May97               *
     F*                 127966             Date 13Oct97               *
     F*                 100817 (065251)    Date 17Sep97               *
     F*                 S01408             Date 05Sep96               *
     F*                 093212             Date 24Jun96               *
     F*                 103122             DATE 22MAY96               *
     F*                 102005             DATE 22MAY96               *
     F*                 101859             DATE 22MAY96               *
     F*                 101843             DATE 22MAY96               *
     F*                 100525             DATE 22MAY96               *
     F*                 101321             DATE 22MAY96               *
     F*                 100516             DATE 22MAY96               *
     F*                 100429             DATE 22MAY96               *
     F*                 100428             DATE 22MAY96               *
     F*                 100515             DATE 22MAY96               *
     F*                 090939             DATE 16JAN96               *
     F*                 091657             DATE 19OCT95               *
     F*                 056073             DATE 02MAR94               *
     F*                 046303             DATE 13JAN94               *
     F*                 052703             DATE 05APR93               *
     F*                 E52119             DATE 25MAR93               *
     F*                 052449             DATE 22MAR93               *
     F*                 BH3579             DATE 19OCT92               *
     F*                 E45504             DATE 23NOV92               *
     F*                 E45504             DATE 09NOV92               *
     F*                 BH3465             DATE 18SEP92               *
     F*                 BHBPC2             DATE 11SEP92               *
     F*                 BH3495             DATE 04SEP92               *
     F*                 BH3503             DATE 27AUG92               *
     F*                 BH3491             DATE 27AUG92               *
     F*                 BH3504             DATE 27AUG92               *
     F*                 BH3480             DATE 20AUG92               *
     F*                 BH3484             DATE 19AUG92               *
     F*                 BHBPC1             DATE 19AUG92               *
     F*                 BH3481             DATE 17AUG92               *
     F*                 BH3479             DATE 14AUG92               *
     F*                 BH3467             DATE 10AUG92               *
     F*                 BH3462             DATE 06AUG92               *
     F*                 BH3417             DATE 30JUL92               *
     F*                 BH3451             DATE 27JUL92               *
     F*                 BH0131             DATE 23JUL92               *
     F*                 BH3433             DATE 22JUL92               *
     F*                 E33591             DATE 13APR92               *
     F*                 MOF60              DATE 23FEB92               *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  MD053375 - Incorrect fee settlement amount in LER170 report. *
      *             Write copy of fee record in LEFECPPD when fee has *
      *             manual and auto settlement.                       *
      *  MD055481 - Show the original borrower on the report for loan *
      *             fees attached to a participation purchased if the *
      *             system value 'LoanCustOriginPurch' is equal to 'O'*
      *  AR820690 - Missing LEFHST record. Ensure that when payment   *
      *             falls on a holiday and ANWD=2, LEFHST record will *
      *             be generated on next working day. Applied fix     *
      *             242283A.                                          *
      *           - Applied for AR1007302. (Child: AR1007303)         *
      *  AR956619 - No accrual posting was generated for fees with    *
      *             FECALT is 01/02/03/11/12/13/21. Applied part of   *
      *             fix 263473 to ensure that accrual postings would  *
      *             be generated. Also, part of 261129 was applied.   *
      *             (Child: AR956620)                                 *
      *  AR911591 - No Debit advice generated due to field FEPBTI not *
      *             initialised to blank when settlement date falls on*
      *             a holiday. Amended program wherein field FEPBTI   *
      *             will be set to blank when FELPDT LE BJRDNB.       *
      *             (Child: AR911592)                                 *
      *  MD055733 - COB: Multiple UTCHOBJEX calls in LEC06A           *
      *             components.                                       *
      *           - Redeliver of MD050139.                            *  
      *  MD056223 - CLE031: Incorrect Posting narratives in           *
      *             Fee postings with conversion                      *
      *           - The amount and currency of the posting narratives *
      *             of Cross currency settlements P and S records     *
      *             whose narrative codes defined as 03 are now       *
      *             formatted based on the format string defined in   *
      *             Narrative Codes File SDNARRPD.                    *
      *  MD054240 - Lending fees incorrect calculation of accruals    *
      *             when GL accrual indicator is changed. Reverse     *
      *             part of fixes 245081 and MD052410.                *
      *  MD055069 - LER160P1 shows incorrect amount. Add condition to *
      *             check which date to be used in the calculation.   *
      *           - FEAMTO is not adjusted of recalculated total fee  *
      *             due amount from RECALC/RECALL. Update fee outst.  *
      *             amount the same way FEAMTP is adjusted.           *
      *  AR674226 - Manual transaction reached 999. Increase the size *
      *             of utilisation sequence no. and transaction       *
      *             sequence. (Child: AR674227)                       *
      *           - Applied for MD054782.                             *
      *  MD054703 - Fees with interest calculation method 6 use wrong *
      *             divisor basis                                     *
      *  MD023855 - Wrong accrual with calculation basis 6            *
      *             Addapt old coding found in previous version under *
      *             ref CI2135 and BT1960                             *
      *          - Applied for MD054703                               *
      *  MD025983 - Reversal of accrual posting due to changed FEPEND *
      *             backvalued to previous year caused the system to  *
      *             generate Transfer B/CCY P/L entries.              *
      *           - Patterned the concept of fix 238081.              *
      *  MD054354 - Settlement of fee accrual for prior period for    *
      *             backdated notional change                         *
      *  MD033473 - DBASE 012 IS ISSUED WHEN FEE SETTLEMENT DATE      *
      *             FZSDAT from LEFZASPD is zero. Do not execute      *
      *             ZDATE2 when FZSDAT is zero.                       *
      *           - Applied for MD054354                              *
      *  MD026969A - Further modifications.                           *
      *           - Applied for MD054354                              *
      *  MD026969 - New Processing for Fee Settlement.                *
      *           - Applied for MD054354                              *
      *  MD054101 - When loan fee and CLE141 is ON, access CLOAN to   *
      *             ensure that correct currency/location combination *
      *             was used in holiday checking.                     *
      *  MD053873 - Set fee currency as first basis for checking      *
      *             currency holiday setup. Then, use settlement      *
      *             currency when CLE031 is ON and value is not blank *
      *  MD052216 - Lending Fee's Payment Due and Taken Day           *
      *  MD047522 - Renamed FARECI of LEFEEAD to FARECC to            *
      *             differentiate FARECI of LEFEEAD and FACHISA       *
      *           - Added condition for old fees to properly          *
      *             execute the calculation of adjustments            *
      *           - Applied for MD052131                              *
      *  CER050 - Annualised Percentage Rate (Recompile)              *
      *  MD054318 - Back-valued repayment does not generate a reversal*
      *             for accrual. Applied fix MD-52410                 *
      *  MD053946 - Cross ccy settlement entries not generated for    *
      *             calculated loan fee, auto settle ‘C’ and settled  *
      *             against nostro account                            *
      *  MD051883 - CLE031: Changes to Value Date Account Keys        *
      *  261205A - Incorrect lending fee accrual for calc basis 6.    *
      *            Consider the decimal numbers of INT6DY if fee has  *
      *            calculation basis 6.                               *
      *          - Applied for MD053920 (Data structure only)         *
      *  MD053295 - Lending loan with Interest Calculation Basis      *
      *             method 3 (30/360) has wrong interest payment      *
      *             amount for month of March (Recompile)             *
      *  MD052410 - Back-valued repayment does not generate a reversal*
      *             for accrual.                                      *
      *  MD052952 - LE Fees Type 06 Calculated on Facility Amount     *
      *             and not Undrawn Amount.                           *
      *           - WKPIND not set before executing subroutine ACCRUE *
      *            in HISRED. Value previously blanked out by HIPIND  *
      *            introduced by CLE071.                              *
      *  MD050139 - AOSARDR0 called every time causing performance    *
      *             issue. Recompile due to changes in /COPY          *
      *             ZFREQ/ZFRQ*.                                      *
      *  MD050111 - Component LEC0701 failed due to DBERR 18. CLE148  *
      *             introduced alphanumeric loan numbers and as such  *
      *             can no longer test for facility with 'F' in 1st   *
      *             character in LNFRA. Test with blank instead since *
      *             loan reference can never contain blanks.          *
      *  MD051940 - PDCL X, Y, Z amount is incorrect as a result of   *
      *             conversion rounding error.                        *
      *  MD051969 - Accrual account key was considered as a repayment *
      *             key                                               *
      *  258414 - 1. Remove fix 209380 which caused LER135P2 being    *
      *              created in phase 00002 instead of phase 00001.   *
      *           2. The event date of auto payment should be on the  *
      *              payment date instead of DNWD-1.                  *
      *           3. Not using the correct rate in both subr RECALC.  *
      *              and HISRED.                                      *
      *           4. Add rate Change on payment due processing.       *
      *           5. Only calculate fee payment from current period.  *
      *  CLE071A - Initilaise new fields when writing Fee History     *
      *            records                                            *
      *  CLE071 - Value Dating of Rate Changes to Fees                *
      *  MD051242 - CLE031: COB: GLC0340 failed with Currency out of  *
      *             balance for fee with no settlement currency       *
      *  MD046370 - Component LERC135 is looping in COB. If system    *
      *             value AutoEndCalcLoanFee is 'Y', ensure that fee  *
      *             start date does not fall after fee end date/next  *
      *             payment date.  If value is 'N', fee end date/next *
      *             payment date should not be changed at all.        *
      *             Applicable for all calculated loan fees.          *
      *           - Remove fix 262735 as this causes fee not to early *
      *             mature if loan principal is zero, system value Y  *
      *             and fee last payment date is greater than zero.   *
      *  MD046248 - Finastra Rebranding                               *
      *  MD046080 - Gap between CLE031 (Settlement to different       *
      *             currency) and CLE134 (PDCL processing)            *
      *  MD047474 - Exchange rate conversion occurs for loan fees with*
      *             calculation type 99. Skip exchange rate           *
      *             calculation if FECALT = 99.                       *
      *  MD047993 - Modified MD035545. Removed dependency on Accrue   *
      *             on Last Day indicator.                            *
      *  MD035545 - LE: Interest Calculation in Leap year. Consider   *
      *             Accrue on Last Day Indicator for method 6.        *
      *  MD037173 - Formalise HOTFIX code.                            *
      *           - ROBN is now Alpha set to balnk instread of 00000  *
      *  MD046351 - Rounding and truncation in fee accrual            *
      *             calculations due to mult/div using 15,9 fields    *
      *             being placed into 13,0/15,0 result fields.        *
      *  MD031473A - Revise RECALL so that TDUE is the recalculated   *
      *              amount from start date upto last payment date.   *
      *  MD031473 - LE Incorrect fee accrual calculation (rate chg)   *
      *  MD045479 - For the migrated fees, the HIFRT's and HIAMT's    *
      *             should be set to zero before writing to LEFHST    *
      *  MD036064 - System created incorrect PDCL for FEE. Define     *
      *             WLONSV as alphanumeric instead of numeric.        *
      *  MD045010 - Component LEC06A 10008 looping during COB caused  *
      *             by CGL184. Recompile due to changes in ZFRQB3.    *
      *  CGL184 - New Frequencies for Account Statements (Recompile)  *
      *  CLE154 - Loan Repayment Schedule Enhancement (Recompile)     *
      *  CLE141A - CLE141 Change Control 1                            *
      *  CLE141 - Currency and Location Business Day Convention       *
      *           for LE Transactions                                 *
      *  MD033613 - Reset FELPAM for loan fees on SR/UPDFEE regardless*
      *             of auto-settlement indicator.                     *
      *  MD031496 - Component LERC135 in MSGW                         *
      *           - Enhanced FIX AR317401. Use embedded SQL instead   *
      *             of a new logical file.                            *
      *  CLE164 - CLE134 Enhancement F (Repayment Methodology)        *
      *  AR317401 - Loan fee subtype change enhancement               *
      *           - Applied for MD025682                              *
      *  MD020563 - CFC006 issues                                     *
      *  MD020212 - Differences found in SEPCKM and SEPCKT due to     *
      *             incorrect field type of FELOAN field              *
      *  AR1047943 - Negative accrual was produced for a facility fee.*
      *              For BKALDI = 'Y' setup, FELADT is 0 on start date*
      *              of the fee (if FEPSTD = CODT) thus only execute  *
      *              WACRY routine if FELADT > 0. (Child: AR1047944)  *
      *  AR823503 - Wrong accrual fee posting when auto-settlement    *
      *             change from 'N' to 'C'. Restore the value of      *
      *             FELPAM if no fee due settlement on rundate. Also, *
      *             use the value of ENDATE in updating FELADT to     *
      *             continue calculation of accrual and in LKEDAT for *
      *             correct accrual event date. (Child: AR823504)     *
      *  AR1097176 - Accessing AOCOMR0 multiple times slows down the  *
      *              system                                           *
      *  CFC006 - COB Restructure - Remove reports from COB           *
      *  AR750601 - Fields in LEFHST introduced by CSW208 are being   *
      *             populated incorrectly. Call SR/ADDFLD before      *
      *             writing records to LEFHST. (Child: AR750602)      *
      *  AR753180 - Duplicate fee history records displayed for       *
      *             matured fees. Additional check when writing       *
      *             records on LEFHST. (Child: AR753181)              *
      *  AR995302 - Postings generated from lending fees do not have  *
      *             profit center. For calculated loan fee, populate  *
      *             profit center if Profit Center is used. Also,     *
      *             initialise LKPRFC for field to contain correct    *
      *             profit center. (Child: AR995303)                  *
      *  AR632102B - For matured fees, there are still records in PF/ *
      *              LEFHST with fee sequence not equal to '00'.      *
      *              Amended program to ensure that fee sequence of   *
      *              all records of a maturing fee will be updated to *
      *              '00'. (Child: AR632103)                          *
      *  259030 - GL -Incorrect account balances migrated from R4.    *
      *           Additional fix for 259013.                          *
      *           (Reversed part of fix 250628)                       *
      *  AR1078443 - LEC000456 component failed during Day 2 COB      *
      *  AR1069056 - LERC135 component failed during COB run          *
      *  AR996895 - Incorrect acrrual interest calculation            *
      *             (Child: AR996897) (Recompile)                     *
      *  AR1055539 - Various errors encountered in COB during         *
      *              Link Test                                        *
      *  AR1056323 - Revert back changes of CLE134 for LKEY1DP and    *
      *              LKEYFED (Recompile)                              *
      *  AR740063A - Backvalued frequency payments does not work for  *
      *              loan fees. Compute and generate accrual account  *
      *              keys per fee period. (Child: AR740064A)          *
      *              NOTE: This is a reopen fix. The initial fix was  *
      *              pulled out from the source hierarchy             *
      *  261129A - LE: Maintenance fee generated incorrect accruals.  *
      *            Re-instated part of fix for fee payment date.      *
      *            Apparently, CLE073(calculated loan fees) is also   *
      *            using it.                                          *
      *  261129 - Double/added fee accruals were generated when fee   *
      *           next payment date or end date is amended equal to   *
      *           rundate. Corrected processing of fee last accrual   *
      *           date, computation of adjustment amount and applied  *
      *           fix concept of 259392 to ENDATE processing.         *
      *  258597 - preventative fix for possible LE Fees data          *
      *           corruption. Applied fixes 247761, 247761A, 248855,  *
      *           252917, 255741, 256257, 256257A and AR856977        *
      *  260881 - Fee amount settled on history is double the amount  *
      *           of actual fee amount settled on LEFEED              *
      *  AR634880 - ±0.01 difference between recalculated amount and  *
      *             total settled amount causing incorrect FEAMTP.    *
      *             Adjust WFEE and TDUE calculation accordingly to   *
      *             avoid the difference. (Child: AR634881)           *
      *  AR741212 - Manual Repayment settling against a nostro account*
      *             created a PDCL. Only output records into LEPK2DP  *
      *             if settlement account is Retail.                  *
      *             or if Settlement account is GL (this one is as    *
      *             per banks's request) (Child: AR741213)            *
      *  AR738695 - Incorrect calculation of FEAMTP if the previous   *
      *             outstanding amount is not paid for AUTO = 'N'     *
      *             facility fees. Remove conditioning of auto-settle *
      *             indicator in sr/RECALC. (Child: AR738696)         *
      *  AR734175 - Calt97 past due calculation error and wrong       *
      *             processing of write-offs for Calt99 fees.         *
      *           - add write-off to FEWOFF directly for calt99       *
      *             as the amount should not be accrued anymore       *
      *           - only add ADDUE if fee is against a facility       *
      *             in sr/UPDFEE (Child: AR734176)                    *
      *  AR997862 - CLE148: KLNNO incorrectly defined as numeric      *
      *             SFDC 00724180 (Child: AR997863)                   *
      *  AR810483 - Repayment account key has incorrect settlement    *
      *             account details which caused generation of PDCL.  *
      *             Setup WSTYPE for Full settlement. Also, do not    *
      *             equate FEPAMP as the update of this field is not  *
      *             linear on payment due processing.                 *
      *             (Child: AR810484)                                 *
      *  AR750305 - Fee is settling on a suspense account. Cause by   *
      *             incomplete fix AR699396. Include in the fix       *
      *             Advice/confirmed indicator = Y. (Child: AR750306) *
      *  AR699396 - Wrong set up of LKOSAC, LKOSBR, LKSETP            *
      *             (Child: AR699397)                                 *
      *  262735 - No projection of fees when maturity date of loan    *
      *           amended. Amended if condition when populating       *
      *           FEPEND and FENPYD.                                  *
      *  261084 - When a loan is early matured, the maturity date     *
      *           should not be less than the last payment date.      *
      *           Added condition to correctly update fee end date    *
      *           and fee next payment date.                          *
      *  AR738130 - Fee status is 'matured' but fee's account balance *
      *             <> 0. Amended program to ensure that reversal     *
      *             postings for accrual equivalent to write off      *
      *             amount would be posted upon COB. (Child: AR738131)*
      *  AR707261 - LEC06A 10014 and LEC0471B failed due to trailer   *
      *             out of balance. Update LKEYFEZ trailer value      *
      *             instead of LEPK2ZZ if settlement account is not   *
      *             defined. Enhance fix AR402544. (Child: AR707262)  *
      *  AR571427 - SEVDAT must contain Fee start date                *
      *             (Child: AR571428)                                 *
      *  AR567790 - Clear LKOSAC when account key is not repayment    *
      *             wrong check on FEAUTO caused a/c to be output to  *
      *             LEPKTPD instead of PSTTOM. (Child: AR567791)      *
      *  AR402543 - Wrong update of LEPK2DPD trailer when the         *
      *             settlement account is missing                     *
      *             (Child: AR402544)                                 *
      *  AR318650 - Fee should mature only when fee end date < rundat *
      *             (Child: AR318651)                                 *
      *  AR217562 - Wrong Repayment Methodology (Child: AR217563)     *
      *  263074 - Wrong Postings when interest and principal are paid *
      *           on the same day                                     *
      *           CLE134 / SWIFT                                      *
      *  262506 - LERC135 in loop due to wrong test on FELADT         *
      *  CLE134 - Past Due Call Loan Processing                       *
      *         - CC01: Fee Settlement Feature                        *
      *  CLE148 - Alpha Loan Reference                                *
      *  AR800866 - Account sequence is wrong causing fees to be      *
      *             posted to wrong account. Output account sequence  *
      *             based on related loan/facility. (Child: AR800867) *
      *  AR640738 - Wrong settlement date posted for a calculated     *
      *             loan fee. Ensure that FAVDAT will be used as the  *
      *             event date of account keys for fee settlements.   *
      *  261128 - Missing repayment account key for a full settlement.*
      *           Further check on fee settlement event (*IN61= '1'), *
      *           to prevent the ackey from being written on PSTTOM.  *
      *  AR326180 - COB looping on LERC315. Prevent looping when fee  *
      *             due date is on a holiday. Applied R4 fix 213399.  *
      *  AR852475 - Posting generated with wrong value date           *
      *             (Child:AR852476)                                  *
      *  AR821740 - COB - No stamp tax account keys generated         *
      *             (Recompile)                                       *
      *  CER049 - Stamp Tax (Recompile)                               *
      *  AR745249A - LEC06A 10014 failed due to 'XXXX' Loan Class     *
      *             (Child: AR745251)                                 *
      *  AR787620 - Hooks Incorporation                               *
      *             WNCPYSRC,LEH00378                                 *
      *             WNCPYSRC,LEH00379                                 *
      *             WNCPYSRC,LEH00380                                 *
      *             WNCPYSRC,LEH00381                                 *
      *  AR745249 - LEC06A 10014 failed due to blank Loan Class       *
      *             (Child: AR745251)                                 *
      *  CLE139 - Lending Fee Capitalisation                          *
      *  CLE064 - Enhancement of Lending Frequencies (Recompile)      *
      *  260472 - When early closing a fee, posted amount is incorrect*
      *           Reset ADDUE so as not to corrupt fee details of     *
      *           succeeding fee with no recalculation (RECALL/RECALC)*
      *  CLE073 - Calculated Loan Based Fees                          *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *            to Midas Plus (Recompile)                          *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  BUG23174 - Fees Details are showing incorrect details in     *
      *             "amount due/Past Due" when FECALC = 6             *
      *  BUG23244 - Outstanding Fee today report showing incorrect    *
      *             fee outstanding                                   *
      *  BUG22790 - Fee Amount Due/Past due showning wrong amount,    *
      *             hence unable to settle fee                        *
      *  260472 - When early closing a fee, posted amount is incorrect*
      *           Reset ADDUE so as not to corrupt fee details of     *
      *           succeeding fee with no recalculation (RECALL/RECALC)*
      *  CSC042 - COB performance fix - Use array already built in    *
      *           first cycle to get ccy details rather than make     *
      *           >100K calls to AOCURRR*                             *
      *  CSW208 - SWIFT 2008 Changes                                  *
      *  250628 - Existing history records on previous fee payments  *
      *           when there is newly entered fee and it just reused  *
      *           a fee sequence number. Applied Fix 247761A          *
      *          -If fee was matured, matured all live fee settlement *
      *           details on PF/LEFHST thru LER136. Applied fix 240073*
      *  CPK027 - Error in 243499 - LKOLNO should now be 6A           *
      *  249023 - Incorrect calculation of accruals as work field     *
      *           WTOT is too small.                                  *
      *  248697 - Unexpected due amount printed on financial loans    *
      *           diary.                                              *
      *  248440 - Accrual should be reversed when fee end date is     *
      *           backvalued.  Applied fix 232247.                    *
      *  248358 - Negative interest settlement amount postings were   *
      *           generated for migrated fees.                        *
      *  247979 - Postings for fees do not reflect the Profit Centre  *
      *           for the fee.                                        *
      *  247821 - Calculate accrual from previous fee period even     *
      *           when no LEFHST record is available. This will ensure*
      *           correct amount due is repaid on next settlement date*
      *  247644 - Incorrect accrual account keys generated for fees   *
      *           with settlements.                                   *
      *  243496B- Reinstated fix 243496.                              *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  244411B- Accrual for fee with calculation type 15 still wrong*
      *  244411 - Wrong accrual for fee with calculation type 15      *
      *           Due to 214208                                       *
      *  246018 - Divide by zero error.                               *
      *  245803 - Reverse fix 243496.                                 *
      *  245081 - Set up accrual amount if accrual non-working day    *
      *           indicator is not equal to '2'                       *
      *  243843 - Corrected processing of core fix 214208.            *
     F*  245093 - Applied BUG13031                                    *
      *  243496 - Update FEDIND to 'A' instead of 'C' when last fee   *
      *           payment date is less than or equal to rundate.      *
      *           Apply 199724.                                       *
      *         - Use the Fee Adjustment Amount FEAMTA from PF/LEFEAM *
      *           Applied 216123 (plus re-open & 221326 correction).  *
      *         - Output fee adjustment amount to file LEFEAM.  Also  *
      *           Considered the adjustment amount in the Total       *
      *           Outstanding amount field in LER135P2 report.        *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  243717 - When fee is matured earlier, reversal of accrual is *
      *           posted twice.                                       *
      *  243499 - Set up new Original Borrower field in LKEYFED.      *
      *  BUG13031 - Incorrect cashflow date is being written for fees *
      *             due to the increment in event date done by        *
      *             CLE025.  This is causing the incorrect EIR        *
      *             calculation in CAS009.                            *
      *             The code for CLE025 will be removed to avoid      *
      *             errors this may cause in other IAS modules. The   *
      *             "extra fee because of fee" scenario in CLE025     *
      *             will have to be accepted as a limitation.         *
      *             This fix was intended for fixed fees but was also *
      *             applied to calculated fees for consistency.       *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242777 - Incorrect posting for Nostro settlements due to     *
      *           220555.                                             *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  214208 - No division operation when CFAMT is equal to zero   *
      *           and FEPIND is equal to 'P'.                         *
      *  239961 - Re-instated codes reversed by BUG6213.  Without the *
      *           codes, new fees lack one day accrual. Fix for       *
      *           BUG6213 should have corrected FEAD and FCDT (for    *
      *           fees) programs.                                     *
      *  212048 - If calc method 6 then INT6DY contains the number    *
      *           of days from ZINTDY.                                *
      *  218648 - A negative accrual account key is produced          *
      *           when payment date is amended to today.              *
      *           Incorrect accrual and repayment a/c keys generated  *
      *           on fee payment date. FENPYD field should be updated *
      *           a day before the actual payment date, together with *
      *           other fee amount and date fields.                   *
      *  220555 - Settlement details should still be taken from       *
      *           LEFEEAD when auto settle is not 'Y', even if        *
      *           CLE004 and CLE005 are on.                           *
      *  233823 - Difference on the fees. Exclude previous fee        *
      *           period in calculating current average amount.       *
      *  227253 - When fee fell due, it past incorrect amount.        *
      *           Include fee adjustment to outstanding fee amount.   *
      *  209380 - If next payment date or fee end date is due on the  *
      *           next working date, setup the fee details (ATYP='H') *
      *           if control date is 1 day before the next working    *
      *           date.                                               *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type                              *
      *  BUG8762 - Amending Fee Rate has caused recalculation of fee  *
      *            accrual. Amended LEFHST to store rates and amounts *
      *            for a specific fee period. Applied fix 209513.     *
      *  CLE106 - Syndications Manager.                               *
      *  227716 - The PC Reference of the settlement allocation needs *
      *           to be renamed so that it does not overwrite the     *
      *           field on the fee.                                   *
      *  CLE038 - Lending Enhancement for Nordea: Allocation by Amount*
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over ZINTDY.                              *
      *  230521 - Initialise new field added on PF/LEPXTAB.           *
      *           Recompile over changes in physical file LEPXTAB     *
      *           Applied fix 215643.                                 *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  BUG6213- Applied fix 220906 from R4                          *
      *           Accrued to date amount has an excess of one day     *
      *           accrual because the program adds 1 to NDAYS.        *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines                                        *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222373 - Parameter Mismatch                                  *
      *  218992 - Improve output of Fee events. Check if the          *
      *           settlement type of the fee is 09, rather than SETP. *
      *  214120 - Missing fee accruals and Next Payment Date was not  *
      *           updated in LER140 report.                           *
      *  218782 - Check system value Settlement09Postings to decide   *
      *           whether to use Settlement or Transaction Ccy.       *
      *  CLE034 - (REVISED) Half adjust splitting of amount in SR34B  *
      *           The check to make sure the settlement details are   *
      *           for method 08 before calling RTLX should be using   *
      *           the fee settlement details                          *
      *           The setup of the type used to call AOSTALR2 needs   *
      *           to be set to FSET if FATYPE is not blanks.          *
      *           Settlement allocation processing wasnot being done  *
      *           for fully settled                                   *
      *         - Lending Enhancements Phase 1 Priority 1A            *
      *  CLE031 - Lending Enhancements.                               *
      *           This allows settlement in a different currency to   *
      *           the fee currency. If this is a participant fee, ie  *
      *           a fee for a participant facility, the settlement    *
      *           currency is the pay settlement currency. If this is *
      *           a non participant fee, the settlement currency is   *
      *           the receive settlement currency.                    *
      *  CGL020 - Compliance Watch - Additional A/C Postings          *
      *           Information                                         *
      *  CLE028 - Flat Rate Personal Loans (Rule of 78s)              *
      *  213377 - LER135 loop during COB due to fix 204866.           *
      *  206539 - Some calculated fees did not accrue on 1st COB run  *
      *           after migrating to R4.                              *
      *  205529 - Looping error when next payment date is less than   *
      *           next working day but greater than run date.         *
      *  196612 - Backvalued fee with payment on 'N' only processed   *
      *           the first period for each end-of-day processing.    *
      *           Fix is to check if next payment date is still       *
      *           less than the next working day. Applied fix 185673. *
      *  204866 - Incorrect breakdown of fee accruals when fee is     *
      *           inserted back-valued.                               *
      *  204452 - Include processing of fee amount written off.       *
      *           Part of SR/RECALC was reversed cause it corrupts the*
      *           value of fee amount past due. Field FEAMTW added to *
      *           PF LEFEED.                                          *
      *  204467 - Total Outstanding incorrect. Also, incorrect extra  *
      *           fee accrual generated when a full settlement was    *
      *           inserted against a fee.                             *
      *  204444 - Adjustments to date incorrect. Changed part of      *
      *           153736.                                             *
      *  202954 - Total Outstanding amount is incorrect in LER135P2   *
      *           whenever a write-off settlement is made. Also       *
      *           WRITE LER135BC for both '+' and '-' adjustments.    *
      *  204354 - Non autosettle fee with 0 fee amount was still      *
      *           written to fee historic file, which should not.     *
      *  CLE023 - Lending Facility History Improvements.              *
      *  200289 - Increase facility sequence number in FACHISA from   *
      *           2N to 3N.                                           *
      *  194912 - Change multi-ccy action from 'ST' to 'MC'           *
      *  181727 - Page numbering of LER135P1 is out of sequence.      *
      *  177910 - Autosettle facility fee and zero amount was reported*
      *           on LER160P3 (Fees Due for Settlement Report - Manual*
      *           Settlement) because FEDIND = 'C'.  Fix is to check  *
      *           FEAUTO = 'N' in SR/UPDFEE.                          *
      *  CDE002 - Data Export - CCRM Revenue Analysis.                *
      *  179741 - Convert posted amount to Euros if a settlement      *
      *           currency has been entered & CEU004 is on.           *
      *  CMX001 - Meridian Export                                     *
      *  CLE013 - Customer Lending Fees Enhancements - Phase I        *
      *  CLE009 - LE I/C Swift Message Generation for Fees            *
      *  155514 - Incorrect value of fields FEAMTP, FEPAMP, FEADBP    *
      *  155912 - Fee entered backvalued, due date shown as date input*
      *           Fix is based on 139118.                             *
      *  155672 - Record is written to LEPXTAB even when settlement   *
      *           type is not 08.                                     *
      *  154799 - Recompiled due to changes in /COPY,ZACCH            *
      *  151295 - Problems authorising repayment schedules            *
      *           Recompiled due to changes in ZCHKH                  *
      *  153736 - New record format produced to show Total Adjustment *
      *           to Date on LER135P2. On the same report Total Fee   *
      *           Calculated and Total Outstanding amended to acount  *
      *           for total adjustments to date.                      *
      *  153672 - Backvalued maturity date on fee but accrual not     *
      *           reversed                                            *
      *  152166 - Fees calculated as 2 days to next due date when it  *
      *           should be 1.                                        *
      *  142402 - Program does not update fees profitability file when*
      *           CLE005 or CLE004 is *ON.  Also, incorrect fees MTD  *
      *           result when fee is backvalued.                      *
      *  141462 - Fee Income Shows for Primary Facility but not for   *
      *           the participants.                                   *
      *  141453 - Keep write-off amount for fees recalculation.       *
      *           Also, do not recalculate if a fee record is flagged *
      *           as old fee, as this kind of fee does not have any   *
      *           previous record of its write-offs.                  *
     F*  144257 - Year 2000(Y2K) problem when processing dates in     *
     F*           initialisation subroutine.                          *
     F*  132877 - Repayment entry for fee is posted early with        *
     F*           incorrect value date.                               *
     F*  138165 - Accrual Processing should consider the first day    *
     F*           accrual indicator but not for the Fee Payment       *
     F*           Processing.  Remove fix 100525, applied fix 129834. *
     F*  138421 - Accrued amount in LER180P1 lacks one day if fee     *
     F*           period starts from Last Payment Date.  Fix is       *
     F*           to add 1 day to NDAYS if STRDT1 is equal to FELPDT  *
     F*           STRDT1 is fee period start date (FEPSTD or FELPDT). *
     F*           This fix should always go together with fix 138165  *
     F*           and 123004.                                         *
     F*  123004 - Commitment fees are computed incorrectly.  The fix  *
     F*           allows the calculation of fees to cater for back    *
     F*           valuation as well as limit the rounding-off of      *
     F*           figures.  Applied fix 116048.                       *
     F*  128725 - AMTP should be LS not FS                            *
     F*  CLE005 - Customer Lending Enhancements - Tranche 3           *
     F*  CLE007 - Customer Lending Enhancements - Others (T3)         *
     F*  127966 - Profit Centre Accounting Development:               *
     F*         - Attach profit centre to lending fees.               *
     F*  100817 - Setup field LKSLID with the start of period date    *
     F*           field before any output to file LKEYFED.            *
     F*  S01408 - Add core hooks LER135CCP1                           *
     F*         - Add core hooks LER135CCP2                           *
     F*         - Add core hooks LER135FFP1                           *
     F*  093212 - Value date of fee payment entries incorrect if      *
     F*           payment date is entered today and is equal to       *
     F*           rundate and the next day is a non-working day.      *
     F*           If last payment date is less than DNWD, use last    *
     F*           payment date as value date for the payment entry.   *
     F*  103122 - Accrued to date shown in LER150 (non-daily accrual) *
     F*           is incorrect. Remove unnecessary condition when     *
     F*           calculating the accrued amount before payment       *
     F*           processing.                                         *
     F*  102005 - Make sure that when calculating for the accrual     *
     F*           of fee, accrual period will not exceed payment      *
     F*           date.                                               *
     F*  101859 - Make sure that even if there is zero amount past    *
     F*           due the necessary fields will be updated so that    *
     F*           LER170P1 will show the correct settled amount.      *
     F*  101843 - When a write-off is processed, do not changed the   *
     F*           fee due date to zero if fee amount past due is      *
     F*           not zero.                                           *
     F*  100525 - Fee accrued and fee due lacks one day for first     *
     F*           day accrual.                                        *
     F*  101321 - Change the output of the report such that it will   *
     F*           be easier to understand the amounts.                *
     F*  100516 - Past due amount should be shown on the report.      *
     F*  100429 - Fee due on payment date posted one day earlier      *
     F*           and accruals are posted one day late.               *
     F*  100428 - Amounts and due date in LER160P2 is incorrect.      *
     F*           Auto-settle fees should not be settled on the       *
     F*           date before due date; hence, FEAMTP and FEDDAT      *
     F*           should not be zeroised when it's not yet due.       *
     F*  100515 - Add new fields to LEFEED. Move the past due         *
     F*           amount, amount settled and accrued/amortised to     *
     F*           date to the new fields.                             *
     F*  090939 - Take Accrue on Last Day indicator into account      *
     F*           when calculating fee period.                        *
     F*  091657 - Account officer is not a mandatory field: no        *
     F*           database error when this field is blank             *
     F*  056073 - Set up auto-settle fees to report on LER160 and     *
     F*           reset indicator next day                            *
     F*  046303 - /COPY source subr. ZFWDT amended to prevent array   *
     F*           error if no holiday record found - fixed by S01434. *
     F*           Program recompiled.                                 *
     F*  E52703 - Output accrual amount to key for fees due to settle *
     F*           tomorrow for use in LER180                          *
     F*  E52119 - An auto settle fee entered today to settle today did*
     F*           not settle. Conditioning on past due created today  *
     F*           not neccesary, as it should be settled this run.    *
     F*  052449 - Mature fees that are past the end date and have     *
     F*           nothing to settle                                   *
     F*  BH3579 - Only write 'End of Report' to LER135P2 if file      *
     F*           open. Won't be if only adjustments processed.       *
     F*  E45504 - Corrected problem with settlement branch for auto-  *
     F*           settle fees. While doing so, spotted a problem with *
     F*           non-auto settlement. Never used settlement instructs*
     F*           input via LER120 (method and OURS).                 *
     F*  E45504 - System should allow automatic settlement of         *
     F*           calculated fees.                                    *
     F*           Within this program, generate settlement for a fee  *
     F*           if the auto-settle flag is on and there is an amount*
     F*           past due.                                           *
     F*           Furthermore, fee seq added to PF/PSTTOM for LER134. *
     F*  BHBPC3 - Program tries to write to P2 when it hasn't been    *
     F*           opened.                                             *
     F*  BH3465 - Posting of accrual missed in some cases and to the  *
     F*           settlement branch in others - oh-oh!                *
     F*  BHBPC2 - Writes to closed P1 if no details.                  *
     F*  BH3495 - Settle type 14 posting to suspense account as branch*
     F*           is wrong                                            *
     F*  BH3503 - Settled amount not updated on full settlement       *
     F*  BH3491 - Fees backdated with end dates before run date do not*
     F*           do anything.                                        *
     F*           Oh, by the way, BH3499 is BH3504. (Or is BH3504....)*
     F*           Also, ensure do Accrual Profit Date posting before  *
     F*           Payment Due Date posting.                           *
     F*  BH3504 - While doing the fee accruals report, I discovered   *
     F*           that fix 3451 for Tiers was a lot of rubbish.       *
     F*  BH3480 - Actual amount accruals on days when a payment is not*
     F*           due tomorrow, doesn't work for back valued fees.    *
     F*           FACHSAL1 is searched with STDATE, but this is the   *
     F*           end of the period. Not much use really.             *
     F*           Swapped values in STDATE and ENDATE for 'Daily accr'*
     F*           processing, and lots more stuff.                    *
     F*  BH3484 - Put out FEE PERIOD START if start date for reporting*
     F*           is actually last payment date. Also put out a total *
     F*           fees outstanding field.                             *
     F*  BHBPC1 - If first fee adjustment is RECI '*', pgm doesn't    *
     F*           bother reading on for a 'D' record                  *
     F*  BH3481 - Confusion over fix with FELPAM, and also accruing   *
     F*           some extra days after end date                      *
     F*  BH3479 - Payment processing results in posting one day early *
     F*  BH3467 - Fees should only post if accrual profit date        *
     F*            or fee payment date                                *
     F*  BH3462 - Ensure that the branch code & amount are output     *
     F*  BH3417 - Frequency no longer mandatory in Fees Input pgm     *
     F*           (default to end date of fee when calc NPYD)         *
     F*  BH3451 - Adjustment amount effectively ignored due to double *
     F*           posting of amount & tiered amounts incorrect        *
     F*  BH0131 - 'Write Off' details appear instead of 'Payment Due  *
     F*           Date' if no detail record except FS on FACHISA.     *
     F*           If last event on FACHISA is before the payment due  *
     F*           date, or there is nothing but the FS record on      *
     F*           FACHISA, output a 'To Payment Due Date' to cover    *
     F*           period.                                             *
     F*  BH3433 - IF THE NEXT PAYMENT DATE IS EARLIER THAN THE        *
     F*           CURRENT CONTROL DATE, BLANKS OUT THE DETAILS        *
     F*  E33591 - IF EOM IS FOLLOWED BY A NON-WORKING DAY, PGM        *
     F*           ADDS FEE AMOUNT ON NEXT MONTH.                      *
     F*  MOF60  - CUSTOMER PROFITABILITY & FEES PROCESSING            *
     F*                                                               *
     F*****************************************************************
     F/SPACE 3
     FLEFEADL1IF  E           K        DISK
     F/COPY WNCPYSRC,LER135FFP1                                           S01408
     FFACHISH IF  E           K        DISK
     FFACHSAL1IF  E           K        DISK
     F***SDCURRPDIF  E           K        DISK                                                CSC042
     FSDCURRPDIF  E           K        DISK                           UC                      CSC042
     FCLOAN   IF  E           K        DISK                                                   CGL020
     F            CLOANHHF                          KIGNORE                                   CGL020
     F            CLOANCKF                          KIGNORE                                   CGL020
     F            CLOANZ1F                          KIGNORE                                   CGL020
     FFCLTY   IF  E           K        DISK                                                   CGL020
     F            FCLTYHHF                          KIGNORE                                   CGL020
     F            FCLTYFNF                          KIGNORE                                   CGL020
     F            FCLTYZZF                          KIGNORE                                   CGL020
     FLEFHSTLBIF  E           K        DISK                                                   CLE071
     F            LEFHSTF                           KRENAMELEFHSTFB                           CLE071
     F***LEFHSTL2UF**E**         K        DISK         KINFSR *PSSR A        CLE005           204452
     F***LEFHSTL2O***E**         K        DISK         KINFSR *PSSR A                 204452 BUG8762
     F***LEFHSTL2UF**E**         K        DISK         KINFSR *PSSR A                 BUG8762 250628
     FLEFHSTL7UF  E           K        DISK         KINFSR *PSSR A                            250628
     FLEFHSTLAIF  E           K        DISK         KINFSR *PSSR                            MD031473
     F            LEFHSTF                           KRENAMELEFHSTA                          MD031473
     FLEFEEQL0UF  E           K        DISK         KINFSR *PSSR                            MD052216
     FLEFEED  UF  E           K        DISK         KINFSR *PSSR
     FLEPEFFD UF  E           K        DISK         KINFSR *PSSR A
     FLEPEFFZ UF  E                    DISK         KINFSR *PSSR
     FLKEYFEZ UF  E                    DISK         KINFSR *PSSR
     F*LEFEAM**O***E           K        DISK         KINFSR *PSSR                      243496 245803
     FLEFEAM  O   E           K        DISK         KINFSR *PSSR                             243496B
     FLEPXTAC UF  E                    DISK         KINFSR *PSSR A    UC  CLE007
     FLEPXTAB O   E                    DISK         KINFSR *PSSR      UC  CLE007
     FLKEYFED O   E                    DISK         KINFSR *PSSR
     F/COPY WNCPYSRC,LEH01203
     FPSTTOM  O   E                    DISK         KINFSR *PSSR          BH3479
     F**********  LKEYFEDF                          KRENAMEPSTTOMF        E45504
     FLEFECPPDO   E                    DISK         KINFSR *PSSR                            MD053375
     F            LEFEEDF                           KRENAMELEFECPD0                         MD053375
      *                                                                                       CLE073
     FLELOANLGIF  E           K        DISK                                                   CLE073
     F            CLOANCLF                          KRENAMECLONCLF                            CLE073
     FCLOANK  IF  E           K        DISK                                                   CLE073
     F            CLOANCKF                          KRENAMECLONCKF                            CLE073
     F***LEHISTV3IF  E           K        DISK                                     AR317401 MD031496
     F**********  HISTSHPF                          KRENAMEHISTHPF                 AR317401 MD031496
     FLEHISTLAIF  E           K        DISK                                                   CLE073
     FLEHISTLBIF  E           K        DISK                                                   CLE073
      *                                                                                       CLE073
     FLOAMS   UF  E           K        DISK         KINFSR *PSSR A                            CLE139
     F            LOAMSDHF                          KIGNORE                                   CLE139
     FLEPK2DPDO   E                    DISK         KINFSR *PSSR                              CLE134
     F            LKEYFEDF                          KRENAMELKEYF2DF                           CLE134
     FLEPK2HH IF  E                    DISK         KINFSR *PSSR A                            CLE134
     F            LKEYFEAF                          KRENAMELKEYF2AF                           CLE134
     FLEPK2ZZ UF  E                    DISK         KINFSR *PSSR A                            CLE134
     F            LKEYFEZF                          KRENAMELKEYF2ZF                           CLE134
     FLEPDUFL2IF  E           K        DISK         KINFSR *PSSR                              CLE134
     FLEPDUFL5IF  E           K        DISK         KINFSR *PSSR                              CLE134
     F            LEPDUFD0                          KRENAMELEPDUFD5                           CLE134
     FLEPDUEL2IF  E           K        DISK         KINFSR *PSSR                              CLE134
     FLEPDUEL5IF  E           K        DISK         KINFSR *PSSR                              CLE134
     F            LEPDUED0                          KRENAMELEPDUED5                           CLE134
     FLEPKTDPDO   E                    DISK         KINFSR *PSSR                              CLE134
     F            LKEYFEDF                          KRENAMELKEYFTDF                           CLE134
     FLEFADJL0UF  E           K        DISK         KINFSR *PSSR A                          AR634880
     FFACACTL2IF  E           K        DISK         KINFSR *PSSR                            MD026969
     F***LEFZASPDUF  E           K        DISK         KINFSR *PSSR A             MD026969 MD026969A
     FLEFZASPDIF  E                    DISK         KINFSR *PSSR A                         MD026969A
     FLEFZASL2UF  E           K        DISK         KINFSR *PSSR                           MD026969A
     F            LEFZASD0                          KRENAMELEFZAS2                         MD026969A
     FLER135P3O   E             82     PRINTER      KINFDS SPOOL3     UC                    MD026969
     FLER135P1O   E             80     PRINTER      KINFDS SPOOL1     UC
     FLER135P2O   E             81     PRINTER      KINFDS SPOOL2     UC
     FLER135AUO   E                    PRINTER      KINFDS SPOOLU
     F/SPACE 3
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
      *  08    - Read of Fee Detail Extension File                    *                     MD052216
     F*  10    - First time through indicator                         *
     F*  11    - Set up of currency array                             *
     F*  13    - LOKUP of from currency in currency conversion        *
     F*  14    - LOKUP of to currency in currency conversion          *
     F*  15    - Read of Fee Settlement/adjustment file               *
     F*  16    - Read of trailer files                                *
     F*  17    - Chain to Fee extract for facilities file (LEPEFFD)   *
     F*  18    - Retrieval of records from facilities history file    *
     F*  19    - Work field                                           *
     F*  20    - Retrieval of records from facilities history file    *
     F*  21    - Details on Account Keys Generated report             *
     F*  22    - Details on Fee Calculation Report                    *
     F*  24    - Multibranching Indicator                             *
     F*  25    - Used in various LOKUP operations.                    *
     F*  26    - Used in LOKUP for action narrative                   *
      *  28    - Work Indicator                                       *   142402
     F*  30    - '0' Decimal Place                                    *
     F*  31    - '1' Decimal Place                                    *
     F*  32    - '2' Decimal Place                                    *
     F*  33    - '3' Decimal Place                                    *
     F*  40    - '0' Decimal Place   }                                *
     F*  41    - '1' Decimal Place   } output on LER135P2             *
     F*  42    - '2' Decimal Place   }                                *
     F*  43    - '3' Decimal Place   }                                *
     F*  44    - Multi-customer indicator                             *
     F*  45    - Multi-currency indicator                             *
     F***48****-*Work*Indicator                                       *                243496 245803
     F*  50    - Read of Fees Master File PF/LEFEED                   *
     F*  60    - Fully settled fee                                    *
     F*  61    - Account key generated                                *
     F*  70    - Fee calculated on actual amount of facility          *
     F*  72    - Actual amount rather than percentage used            *
     F*  73    - Output of narrative on LER135P2                      *
     F*  75    - Average calculation, percentage type used and the    *
     F*          facility amount changed during calc. period.         *
     F*  79    - Details printed                                      *
     F*  80    - Overflow indicator on P1 report                      *
     F*  81    - Overflow indicator on P2 report                      *
     F*  90    - Overflow indicator on P2 report                      *
     F*  90-99 - Used by Standard Subroutines                         *
     F*  U7+U8 - Database Error                                       *
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  INIT   - Program Initialisation                              *
     F*  PROCES - Detail Processing                                   *
     F*  SETTLE - Settlement Processing for calculated facility fees. *
     F*  DETLSR - Selection of detail records for display.            *
     F*  SRTXDT - Calculate telex notice date                         *   CLE009
     F*  RTLX2  - Output fee details to pay/receive telex files       *   CLE009
     F*  DETSCR - Display of expanded detail fee records.             *
     F*  AUDIT  - Audit report processed through RCF.                 *
     F*  *PSSR  - Program exception error routine.                    *
     F*                                                               *
     F*****************************************************************
      *
     E                    CPY@    1   1 80
     E                    AGB        12 15 0             AGG BALANCES
     E********************AKY********10  1               A/C KEYS                             CLE042
     E                    AKY        14  1               A/C KEYS                             CLE042
     E                    FAMT        5 11 0A            FEE AMOUNTS
     E                    FAM         5 13 0A            FEE AMOUNTS
     E                    FRT         5  7 5A            FEE RATES
     E                    FPC         5  6 3A            FEE PERCENTAGE
     E                    @HAMT       5 11 0A            FEE AMOUNTS - HISTORY               BUG8762
     E                    @HRT        5  7 5A            FEE RATES - HISTORY                 BUG8762
     E                    @WAMT       5 11 0A            FEE AMOUNTS - WORK ARRAY            BUG8762
     E                    @WRT        5  7 5A            FEE RATES - WORK ARRAY              BUG8762
     E                    @HLAMT      5 11 0A            FEE AMOUNTS - HISTORY (LOAN)       MD031473
     E                    @HLRT       5  7 5A            FEE RATES - HISTORY (LOAN)         MD031473
     E********************INT         1 15 0             ZHASH INTEGERS    0056
     E********************DEC         1  3 0             ZHASH DECIMALS    0056
     E***********         INT         2 15 0             ZHASH INTEGERS    0056               CLE139
     E***********         DEC         2  3 0             ZHASH DECIMALS    0056               CLE139
     E                    INT         4 15 0             ZHASH INTEGERS                       CLE139
     E                    DEC         4  3 0             ZHASH DECIMALS                       CLE139
     E                    CURR      150  3               ALL CCYS
     E                    CSPT      150 13 8             SPOT RATES/CCY
     E                    MTDV      150  1               M/D INDICATOR/CCY
     E                    CCDP      150  1 0             DEC PLACES/CCY
     E                    CCNO      150  2 0             SORT SEQ.NO/CCY
     E                    CIND      150  1               IN IND/CCY                           CLE031
     E                    TABCAL  6   6  1 0 TABCBS  5 0 CALC.BASES
     E***********         TABACC  1  12  2   TABACN 26   FACILITY ACTIONS CLE005
     E**********          TABACC  1  20  2   TABACN 26   FACILITY ACTIONS              CLE005 194912
     E**********          TABACC  1  21  2   TABACN 26   FACILITY ACTIONS              194912 CLE023
     E**********          TABACC  1  22  2   TABACN 26   FACILITY ACTIONS              CLE023 CLE028
     E/COPY WNCPYSRC,LER135E002
     E**********          TABACC  1  24  2   TABACN 26   FACILITY ACTIONS              CLE028 258414
     E                    TABACC  1  25  2   TABACN 26   FACILITY ACTIONS                     258414
     E/COPY WNCPYSRC,LER135E003
     E                    POWER   1   7  7 3             POWER ARRAY
     E/COPY WNCPYSRC,LEH00667
      *                                                                                       CLE073
     E******************  MSG     1  14 43               FEE TYPES                            CLE073
     E**********          MSG     1  17 43               FEE TYPES                     CLE073 CLE134
     E                    MSG     1  18 43               FEE TYPES                            CLE134
     E/COPY WNCPYSRC,LEH00668
      *                                                                                       CLE073
     E                    ZFMD   12  12  2               FREQ SR.ARRAY    S01195
     E                    STAMP   1   1 26                                                    CLE034
     E**********          SVAL    1   1 20                                             218782 CLE134
     E**********          SVAL    1   2 20                                           CLE134 MD026969
     E                    SVAL    1   3 20                                                  MD026969
     E/COPY ZSRSRC,ZHOLE                                                  S01195
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZDATE9Z1                                               CLE013
     E/EJECT
     E/COPY WNCPYSRC,LER135E001
     E                    WARY     9999  5 0                                                AR753180
     ILEPDUFD0                                                                                CLE134
      *                                                                                       CLE134
      ** Rename fields                                                                        CLE134
      *                                                                                       CLE134
     I              YTKPACL                         YTKPAC                                    CLE134
     I              YTKPABR                         YTKPAB                                    CLE134
     I              YTKPAAC                         YTKPAA                                    CLE134
     I              YTKPASE                         YTKPAS                                    CLE134
     I              YTKPACY                         YTKPCY                                    CLE134
     ILEPDUFD5                                                                                CLE134
      *                                                                                       CLE134
      ** Rename fields                                                                        CLE134
      *                                                                                       CLE134
     I              YTKPACL                         YTKPAC                                    CLE134
     I              YTKPABR                         YTKPAB                                    CLE134
     I              YTKPAAC                         YTKPAA                                    CLE134
     I              YTKPASE                         YTKPAS                                    CLE134
     I              YTKPACY                         YTKPCY                                    CLE134
     ILEPDUED0                                                                                CLE134
      *                                                                                       CLE134
      ** Rename fields                                                                        CLE134
      *                                                                                       CLE134
     I              YTKPACL                         YTKPAC                                    CLE134
     I              YTKPABR                         YTKPAB                                    CLE134
     I              YTKPAAC                         YTKPAA                                    CLE134
     I              YTKPASE                         YTKPAS                                    CLE134
     I              YTKPACY                         YTKPCY                                    CLE134
      *                                                                                       CLE134
     I              YTKIACL                         YTKIAC                                    CLE134
     I              YTKIABR                         YTKIAB                                    CLE134
     I              YTKIAAC                         YTKIAA                                    CLE134
     I              YTKIASE                         YTKIAS                                    CLE134
     I              YTKIACY                         YTKICY                                    CLE134
     ILEPDUED5                                                                                CLE134
      *                                                                                       CLE134
      ** Rename fields                                                                        CLE134
      *                                                                                       CLE134
     I              YTKPACL                         YTKPAC                                    CLE134
     I              YTKPABR                         YTKPAB                                    CLE134
     I              YTKPAAC                         YTKPAA                                    CLE134
     I              YTKPASE                         YTKPAS                                    CLE134
     I              YTKPACY                         YTKPCY                                    CLE134
      *                                                                                       CLE134
     I              YTKIACL                         YTKIAC                                    CLE134
     I              YTKIABR                         YTKIAB                                    CLE134
     I              YTKIAAC                         YTKIAA                                    CLE134
     I              YTKIASE                         YTKIAS                                    CLE134
     I              YTKIACY                         YTKICY                                    CLE134
      *                                                                                       CLE073
      *                                                                                       CLE073
     ICLONCLF                                                                                 CLE073
      ** Rename fields                                                                        CLE073
     I              RECI                            RECIL                                     CLE073
     I              LNRF                            LNRFL                                     CLE073
     I              CNUM                            CNUML                                     CLE073
     I              CPAM                            CPAML                                     CLE073
     I              ACOF                            ACOFL                                     CLE073
     I              RCSI                            RCSIL                                     CLE073
     I              CCY                             CCYL                                      CLE073
     I              BRCA                            BRCAL                                     CLE073
     I              MDAT                            MDATL                                     CLE073
      *                                                                                       CLE073
     ICLONCKF                                                                                 CLE073
      ** Rename fields                                                                        CLE073
     I              RECI                            RECIK                                     CLE073
     I              LNRF                            LNRFK                                     CLE073
     I              OPAM                            OPAMK                                     CLE073
     I              ABLC                            ABLCK                                     CLE073
      *                                                                                       CLE073
     IHISTSHPF                                                                                CLE073
      ** Rename fields                                                                        CLE073
     I              RECI                            RECIP                                     CLE073
     I              RCDT                            RCDTP                                     CLE073
     I              BRCA                            BRCAP                                     CLE073
     I              CNUM                            CNUMP                                     CLE073
     I              LNRF                            LNRFP                                     CLE073
     I              VDAT                            VDATP                                     CLE073
     I              PRSQ                            PRSQP                                     CLE073
     I              LASN                            LASNP                                     CLE073
     I              CCY                             CCYP                                      CLE073
     I              AMTP                            AMTPP                                     CLE073
     I              PRAM                            PRAMP                                     CLE073
     I              LCD                             LCDP                                      CLE073
     I              CPAM                            CPAMP                                     CLE073
      *                                                                                       CLE073
     I**HISTHPF*                                                                   AR317401 MD031496
      **********                                                                   AR317401 MD031496
      ***Rename*fields.                                                            AR317401 MD031496
      **********                                                                   AR317401 MD031496
     I**********    RECI                            RECIP1                         AR317401 MD031496
     I**********    RCDT                            RCDTP1                         AR317401 MD031496
     I**********    BRCA                            BRCAP1                         AR317401 MD031496
     I**********    CNUM                            CNUMP1                         AR317401 MD031496
     I**********    LNRF                            LNRFP1                         AR317401 MD031496
     I**********    VDAT                            VDATP1                         AR317401 MD031496
     I**********    PRSQ                            PRSQP1                         AR317401 MD031496
     I**********    LASN                            LASNP1                         AR317401 MD031496
     I**********    CCY                             CCYP1                          AR317401 MD031496
     I**********    AMTP                            AMTPP1                         AR317401 MD031496
     I**********    LTYP                            LTYPP1                         AR317401 MD031496
     I**********    SUTP                            SUTPP1                         AR317401 MD031496
     I**********    LCD                             LCDP1                          AR317401 MD031496
      **********                                                                   AR317401 MD031496
     IHISTSHMF                                                                                CLE073
      ** Rename fields                                                                        CLE073
     I              RECI                            RECIM                                     CLE073
     I              RCDT                            RCDTM                                     CLE073
     I              BRCA                            BRCAM                                     CLE073
     I              CNUM                            CNUMM                                     CLE073
     I              LNRF                            LNRFM                                     CLE073
     I              VDAT                            VDATM                                     CLE073
     I              PRSQ                            PRSQM                                     CLE073
     I              LASN                            LASNM                                     CLE073
     I              CCY                             CCYM                                      CLE073
     I              AMTP                            AMTPM                                     CLE073
     I              PRAM                            PRAMM                                     CLE073
     I              LCD                             LCDM                                      CLE073
     I              CPAM                            CPAMM                                     CLE073
      *                                                                                       CLE073
      *                                                                                       CLE073
      *                                                                   CLE009
     ILEFEEADF                                                            CLE009
      *                                                                   CLE009
      ** Rename settlement fields to avoid them being overwritten         CLE009
      ** by the settlement fields on LEFEED                               CLE009
      *                                                                   CLE009
     I              FARECI                          FARECC                                  MD047522
     I              SSTS                            FASSTS                CLE009
     I              IUSR                            FAIUSR                CLE009
     I              AUSR                            FAAUSR                CLE009
     I              XUSR                            FAXUSR                CLE009
     I              PCRF                            FAPCRF                CLE009
     I              PTFI                            FAPTFI                CLE009
     I              OSDB                            FAOSDB                CLE009
     I              OMDB                            FAOMDB                CLE009
     I              RSTM                            FARSTM                CLE009
     I              RONS                            FARONS                CLE009
     I              RIBN                            FARIBN                CLE009
     I              RIBA                            FARIBA                CLE009
     I              ROBN                            FAROBN                CLE009
     I              ROCN                            FAROCN                CLE009
     I              PSTM                            FAPSTM                CLE009
     I              PONS                            FAPONS                CLE009
     I              PIBN                            FAPIBN                CLE009
     I              PIBA                            FAPIBA                CLE009
     I              POBN                            FAPOBN                CLE009
     I              POCN                            FAPOCN                CLE009
     I              RCRN                            FARCRN                CLE009
     I              RCRA                            FARCRA                CLE009
     I              RVNO                            FARVNO                CLE009
     I              AWBN                            FAAWBN                CLE009
     I              AWBA                            FAAWBA                CLE009
     I              BENN                            FABENN                CLE009
     I              BENA                            FABENA                CLE009
     I              DTP1                            FADTP1                CLE009
     I              DTP2                            FADTP2                CLE009
     I              DTP3                            FADTP3                CLE009
     I              DTP4                            FADTP4                CLE009
     I              DCHG                            FADCHG                CLE009
     I              BTB1                            FABTB1                CLE009
     I              BTB2                            FABTB2                CLE009
     I              BTB3                            FABTB3                CLE009
     I              BTB4                            FABTB4                CLE009
     I              BTB5                            FABTB5                CLE009
     I              BTB6                            FABTB6                CLE009
     I              CVMR                            FACVMR                CLE009
     I              PCOB                            FAPCOB                CLE009
      *                                                                                       CGL020
      ** Rename Loan fields to avoid overriding LEFEED file                                   CGL020
      *                                                                                       CGL020
     ICLOANCLF                                                                                CGL020
     I              RECI                            TPRECI                                    CGL020
     I              LNRF                            TPLNRF                                    CGL020
     I              RCDT                            TPRCDT                                    CGL020
     I              MRIN                            TPMRIN                                    CGL020
     I              PTYP                            TPPTYP                                    CGL020
     I              CNUM                            TPCNUM                                    CGL020
     I              BRCA                            TPBRCA                                    CGL020
     I              LTYP                            TPLTYP                                    CGL020
     I              SUTP                            TPSUTP                                    CGL020
     I              DDAT                            TPDDAT                                    CGL020
     I              VDAT                            TPVDAT                                    CGL020
     I              MDAT                            TPMDAT                                    CGL020
     I              LASQ                            TPLASQ                                    CGL020
     I              FCUS                            TPFCUS                                    CGL020
     I              FTYP                            TPFTYP                                    CGL020
     I              FSEQ                            TPFSEQ                                    CGL020
     I              CCY                             TPCCY                                     CGL020
     I              CPAM                            TPCPAM                                    CGL020
     I              INTC                            TPINTC                                    CGL020
     I              INTR                            TPINTR                                    CGL020
     I              BRTT                            TPBRTT                                    CGL020
     I              BRTE                            TPBRTE                                    CGL020
     I              RTSP                            TPRTSP                                    CGL020
     I              MARG                            TPMARG                                    CGL020
     I              SPIN                            TPSPIN                                    CGL020
     I              CHIN                            TPCHIN                                    CGL020
     I              WTRT                            TPWTRT                                    CGL020
     I              WTIN                            TPWTIN                                    CGL020
     I              REPT                            TPREPT                                    CGL020
     I              RAMT                            TPRAMT                                    CGL020
     I              NRPD                            TPNRPD                                    CGL020
     I              RFRQ                            TPRFRQ                                    CGL020
     I              RDYN                            TPRDYN                                    CGL020
     I              FCCY                            TPFCCY                                    CGL020
     I              LIND                            TPLIND                                    CGL020
     I              CRSK                            TPCRSK                                    CGL020
     I              ACOF                            TPACOF                                    CGL020
     I              NACD                            TPNACD                                    CGL020
     I              RELI                            TPRELI                                    CGL020
     I              AUTO                            TPAUTO                                    CGL020
     I              PSAM                            TPPSAM                                    CGL020
     I              BCXR                            TPBCXR                                    CGL020
     I              FCXR                            TPFCXR                                    CGL020
     I              SDST                            TPSDST                                    CGL020
     I              OSDA                            TPOSDA                                    CGL020
     I              TSTN                            TPTSTN                                    CGL020
     I              MDST                            TPMDST                                    CGL020
     I              OMDA                            TPOMDA                                    CGL020
     I              TMAN                            TPTMAN                                    CGL020
     I              FACO                            TPFACO                                    CGL020
     I              RLDT                            TPRLDT                                    CGL020
     I              NROD                            TPNROD                                    CGL020
     I              RLFQ                            TPRLFQ                                    CGL020
     I              RLDY                            TPRLDY                                    CGL020
     I              RDFC                            TPRDFC                                    CGL020
     I              NBRA                            TPNBRA                                    CGL020
     I              NRTS                            TPNRTS                                    CGL020
     I              NSIN                            TPNSIN                                    CGL020
     I              NCAS                            TPNCAS                                    CGL020
     I              AWTP                            TPAWTP                                    CGL020
     I              WTRD                            TPWTRD                                    CGL020
     I              WTWD                            TPWTWD                                    CGL020
     I              IWOD                            TPIWOD                                    CGL020
     I              PWOD                            TPPWOD                                    CGL020
     I              BMDI                            TPBMDI                                    CGL020
     I              FMDI                            TPFMDI                                    CGL020
     I              PDIN                            TPPDIN                                    CGL020
     I              LSWC                            TPLSWC                                    CGL020
     I              LSWS                            TPLSWS                                    CGL020
     I              OSDB                            TPOSDB                                    CGL020
     I              OMDB                            TPOMDB                                    CGL020
     I              ORBR                            TPORBR                                    CGL020
     I              PRFC                            TPPRFC                                    CGL020
     I              FCLB                            TPFCLB                                    CGL020
     I              MLNR                            TPMLNR                                    CGL020
     I              BTIN                            TPBTIN                                    CGL020
     I              BLDY                            TPBLDY                                    CGL020
     I              OLNO                            TPOLNO                                    CGL020
     I              RCSI                            TPRCSI                                    CGL020
     I              ICBS                            TPICBS                                    CGL020
     I              IPFR                            TPIPFR                                    CGL020
     I              TOTI                            TPTOTI                                    CGL020
     I              NIDT                            TPNIDT                                    CGL020
     I              IBDT                            TPIBDT                                    CGL020
     I              SLID                            TPSLID                                    CGL020
     I              AIPD                            TPAIPD                                    CGL020
     I              DLRC                            TPDLRC                                    CGL020
     I              IACD                            TPIACD                                    CGL020
     I              AITC                            TPAITC                                    CGL020
     I              TFEP                            TPTFEP                                    CGL020
     I              AIAP                            TPAIAP                                    CGL020
     I              IPRD                            TPIPRD                                    CGL020
     I              IPRM                            TPIPRM                                    CGL020
     I              ICTD                            TPICTD                                    CGL020
     I              AIMN                            TPAIMN                                    CGL020
     I              RBDT                            TPRBDT                                    CGL020
     I              NOPS                            TPNOPS                                    CGL020
     I              NCHI                            TPNCHI                                    CGL020
     I              ZZ001A                          TP001A                                    CGL020
     I              IFDY                            TPIFDY                                    CGL020
     I              LONI                            TPLONI                                    CGL020
     I              CNFI                            TPCNFI                                    CGL020
     I              ACEI                            TPACEI                                    CGL020
     I              TLXI                            TPTLXI                                    CGL020
     I              CBLI                            TPCBLI                                    CGL020
     I              ORED                            TPORED                                    CGL020
     I              LCD                             TPLCD                                     CGL020
     I              CHTP                            TPCHTP                                    CGL020
     I              TNLU                            TPTNLU                                    CGL020
     I              ADDI                            TPADDI                                    CGL020
     I              ORMD                            TPORMD                                    CGL020
     I              ORTI                            TPORTI                                    CGL020
     I              ZZ023A                          TP023A                                    CGL020
     I              BOKC                            TPBOKC                                    CGL020
     I              COCU                            TPCOCU                                    CGL020
     I              RECE                            TPRECE                                    CGL020
     I              OMDT                            TPOMDT                                    CGL020
     I              NIPD                            TPNIPD                                    CGL020
     I              NMDT                            TPNMDT                                    CGL020
     I              APMI                            TPAPMI                                    CGL020
     I              RSTM                            TPRSTM                                    CGL020
     I              RONS                            TPRONS                                    CGL020
     I              RIBN                            TPRIBN                                    CGL020
     I              RIBA                            TPRIBA                                    CGL020
     I              ROBN                            TPROBN                                    CGL020
     I              ROCN                            TPROCN                                    CGL020
     I              PSTM                            TPPSTM                                    CGL020
     I              PONS                            TPPONS                                    CGL020
     I              PIBN                            TPPIBN                                    CGL020
     I              PIBA                            TPPIBA                                    CGL020
     I              POBN                            TPPOBN                                    CGL020
     I              POCN                            TPPOCN                                    CGL020
     I              RCRN                            TPRCRN                                    CGL020
     I              RCRA                            TPRCRA                                    CGL020
     I              RVNO                            TPRVNO                                    CGL020
     I              AWBN                            TPAWBN                                    CGL020
     I              AWBA                            TPAWBA                                    CGL020
     I              BENN                            TPBENN                                    CGL020
     I              BENA                            TPBENA                                    CGL020
     I              DTP1                            TPDTP1                                    CGL020
     I              DTP2                            TPDTP2                                    CGL020
     I              DTP3                            TPDTP3                                    CGL020
     I              DTP4                            TPDTP4                                    CGL020
     I              DCHG                            TPDCHG                                    CGL020
     I              BTB1                            TPBTB1                                    CGL020
     I              BTB2                            TPBTB2                                    CGL020
     I              BTB3                            TPBTB3                                    CGL020
     I              BTB4                            TPBTB4                                    CGL020
     I              BTB5                            TPBTB5                                    CGL020
     I              BTB6                            TPBTB6                                    CGL020
     I              CVMR                            TPCVMR                                    CGL020
     I              PTFR                            TPPTFR                                    CGL020
     I              HLEX                            TPHLEX                                    CGL020
     I              FSRP                            TPFSRP                                    CGL020
     I              FSGN                            TPFSGN                                    CGL020
     I              FPRC                            TPFPRC                                    CGL020
     I              TCOF                            TPTCOF                                    CGL020
     I              ACPD                            TPACPD                                    CGL020
     I              ACDA                            TPACDA                                    CGL020
     I              ACAJ                            TPACAJ                                    CGL020
     I              ACAP                            TPACAP                                    CGL020
     I              COFD                            TPCOFD                                    CGL020
     I              COFM                            TPCOFM                                    CGL020
     I              CFCD                            TPCFCD                                    CGL020
     I              NFRS                            TPNFRS                                    CGL020
     I              NFSN                            TPNFSN                                    CGL020
     I              NFPC                            TPNFPC                                    CGL020
     I              PDCF                            TPPDCF                                    CGL020
     I              FCTD                            TPFCTD                                    CGL020
     I              FWOD                            TPFWOD                                    CGL020
     I              DFTP                            TPDFTP                                    CGL020
     I              DFST                            TPDFST                                    CGL020
     I              MCRA                            TPMCRA                                    CGL020
     I              FCRA                            TPFCRA                                    CGL020
     I              PDDI                            TPPDDI                                    CGL020
     I              PTDI                            TPPTDI                                    CGL020
     I              GDPR                            TPGDPR                                    CGL020
     I              GDIN                            TPGDIN                                    CGL020
     I              LNKS                            TPLNKS                                    CGL020
     I              MNSG                            TPMNSG                                    CGL020
     I              GASS                            TPGASS                                    CGL020
     I              GPRT                            TPGPRT                                    CGL020
     I              TOLN                            TPTOLN                                    CGL020
     I              LSTS                            TPLSTS                                    CGL020
     I              IUSR                            TPIUSR                                    CGL020
     I              AUSR                            TPAUSR                                    CGL020
     I              XUSR                            TPXUSR                                    CGL020
     I              RATF                            TPRATF                                    CGL020
     I              CNCF                            TPCNCF                                    CGL020
     I              PCRF                            TPPCRF                                    CGL020
     I              LPFI                            TPLPFI                                    CGL020
     I              PTFC                            TPPTFC                                    CGL020
     I              PTFT                            TPPTFT                                    CGL020
     I              PTFN                            TPPTFN                                    CGL020
     I              PCOB                            TPPCOB                                    CGL020
     I              LRLD                            TPLRLD                                    CGL020
     I              LMCD                            TPLMCD                                    CGL020
     I              SCCY                            TPSCCY                                    CGL020
     I              ICCY                            TPICCY                                    CGL020
     I              OINR                            TPOINR                                    CGL020
     I              OIDT                            TPOIDT                                    CGL020
     I              REPI                            TPREPI                                    CGL020
     I              RFDY                            TPRFDY                                    CGL020
     I              RFRI                            TPRFRI                                    CGL020
     I              RFRT                            TPRFRT                                    CGL020
     I              RFAR                            TPRFAR                                    CGL020
     I              FSYLDC                          TPYLDC                                    CGL020
     I              FSFYLD                          TPFYLD                                    CGL020
     I              FSURPL                          TPURPL                                    CGL020
     I              FSPLAM                          TPPLAM                                    CGL020
     I              FSPLDT                          TPPLDT                                    CGL020
     I              FSYUPL                          TPYUPL                                    CGL020
     I              CLAS                            TPCLAS                                    CLE042
     I              DFCL                            TPDFCL                                    CLE042
     I              ADIF                            TPADIF                                  AR800866
     I              ADCF                            TPADCF                                  AR800866
     I              CHGA                            TPCHGA                                  AR800866
     I              ICIF                            TPICIF                                  AR800866
     I              FLTI                            TPFLTI                                  AR800866
     I              FRPD                            TPFRPD                                  AR800866
     I              ACCH                            TPACCH                                  AR800866
     I              FSEFUP                          TPEFUP                                  AR800866
     I              FSECUP                          TPECUP                                  AR800866
     I              AIPN                            TPAIPN                                  AR800866
     I              AITN                            TPAITN                                  AR800866
     I              AIAN                            TPAIAN                                  AR800866
     I              IPRN                            TPIPRN                                  AR800866
     I              AINN                            TPAINN                                  AR800866
     I              TOTN                            TPTOTN                                  AR800866
     I              ICTN                            TPICTN                                  AR800866
     I              IWON                            TPIWON                                  AR800866
     I              IPNM                            TPIPNM                                  AR800866
     I              PDNN                            TPPDNN                                  AR800866
     I              FSCPAM                          TPSCPM                                  AR800866
     I              FPAM                            TPFPAM                                  AR800866
     I              REXR                            TPREXR                                  AR800866
     I              REXI                            TPREXI                                  AR800866
     I              PSCY                            TPPSCY                                  AR800866
     I              PEXR                            TPPEXR                                  AR800866
     I              PEXI                            TPPEXI                                  AR800866
     I              STAL                            TPSTAL                                  AR800866
     I              FRNT                            TPFRNT                                  AR800866
     I              AFRT                            TPAFRT                                  AR800866
     I              REPA                            TPREPA                                  AR800866
     I              TMST                            TPTMST                                  AR800866
     I              AUTH                            TPAUTH                                  AR800866
     I              TFDP                            TPTFDP                                  AR800866
     I              TFDPA                           TPTFDA                                  AR800866
     I              TFAM                            TPTFAM                                  AR800866
     I              TFAC                            TPTFAC                                  AR800866
     I              TFOF                            TPTFOF                                  AR800866
     I              AFDP                            TPAFDP                                  AR800866
     I              CFDP                            TPCFDP                                  AR800866
     I              AMDS                            TPAMDS                                  AR800866
     I              AMADJ                           TPAMDJ                                  AR800866
     I              ANADJ                           TPANDJ                                  AR800866
     I              DSAM                            TPDSAM                                  AR800866
     I              AMCOST                          TPACST                                  AR800866
     I              YMCOST                          TPYCST                                  AR800866
     I              YAINT                           TPYINT                                  AR800866
     I              BASR                            TPBASR                                  AR800866
     I              NBSR                            TPNBSR                                  AR800866
     I              SLTP                            TPSLTP                                  AR800866
     I              SLST                            TPSLST                                  AR800866
     I              SLCL                            TPSLCL                                  AR800866
     I              FAMU                            TPFAMU                                  AR800866
     I              FPNR                            TPFPNR                                  AR800866
     I              RIDT                            TPRIDT                                  AR800866
     I              RIDC                            TPRIDC                                  AR800866
     I              RCAT                            TPRCAT                                  AR800866
     I              RCAC                            TPRCAC                                  AR800866
     I              RCSD                            TPRCSD                                  AR800866
     I              RCDY                            TPRCDY                                  AR800866
     I              RICC                            TPRICC                                  AR800866
     I              BIDT                            TPBIDT                                  AR800866
     I              BIDC                            TPBIDC                                  AR800866
     I              BCAT                            TPBCAT                                  AR800866
     I              BCAC                            TPBCAC                                  AR800866
     I              BCSD                            TPBCSD                                  AR800866
     I              BCDY                            TPBCDY                                  AR800866
     I              BICC                            TPBICC                                  AR800866
     I              XRFI                            TPXRFI                                  AR800866
     I              XRFN                            TPXRFN                                  AR800866
      *                                                                                       CGL020
      ** Rename Facility fields                                                               CGL020
      *                                                                                       CGL020
     IFCLTYFMF                                                                                CGL020
     I              RECI                            FCRECI                                    CGL020
     I              CNUM                            FCCNUM                                    CGL020
     I              FACT                            FCFACT                                    CGL020
     I              FCNO                            FCFCNO                                    CGL020
     I              RCTP                            FCRCTP                                    CGL020
     I              BRCA                            FCBRCA                                    CGL020
     I              FCTI                            FCFCTI                                    CGL020
     I              FCCY                            FCFCCY                                    CGL020
     I              FAMT                            FCFAMT                                    CGL020
     I              OVPC                            FCOVPC                                    CGL020
     I              DTAP                            FCDTAP                                    CGL020
     I              DTEX                            FCDTEX                                    CGL020
     I              RVCR                            FCRVCR                                    CGL020
     I              SECI                            FCSECI                                    CGL020
     I              MCCY                            FCMCCY                                    CGL020
     I              MCSI                            FCMCSI                                    CGL020
     I              NACD                            FCNACD                                    CGL020
     I              CRSK                            FCCRSK                                    CGL020
     I              DLFS                            FCDLFS                                    CGL020
     I              NOMR                            FCNOMR                                    CGL020
     I              RVDT                            FCRVDT                                    CGL020
     I              RVFR                            FCRVFR                                    CGL020
     I              RVDY                            FCRVDY                                    CGL020
     I              NAR1                            FCNAR1                                    CGL020
     I              NAR2                            FCNAR2                                    CGL020
     I              NAR3                            FCNAR3                                    CGL020
     I              NAR4                            FCNAR4                                    CGL020
     I              MTDH                            FCMTDH                                    CGL020
     I              MTDL                            FCMTDL                                    CGL020
     I              MTDA                            FCMTDA                                    CGL020
     I              QTDA                            FCQTDA                                    CGL020
     I              YTDA                            FCYTDA                                    CGL020
     I              ACOF                            FCACOF                                    CGL020
     I              ORBR                            FCORBR                                    CGL020
     I              ZZ001                           FC001                                     CGL020
     I              RVCD                            FCRVCD                                    CGL020
     I              ZZ002A                          FC002A                                    CGL020
     I              ORED                            FCORED                                    CGL020
     I              LCD                             FCLCD                                     CGL020
     I              CHTP                            FCCHTP                                    CGL020
     I              TNLU                            FCTNLU                                    CGL020
     I              SYIN                            FCSYIN                                    CGL020
     I              ANUM                            FCANUM                                    CGL020
     I              DTPS                            FCDTPS                                    CGL020
     I              DICB                            FCDICB                                    CGL020
     I              RTPS                            FCRTPS                                    CGL020
     I              RLPD                            FCRLPD                                    CGL020
     I              CSEL                            FCCSEL                                    CGL020
     I              ALCY                            FCALCY                                    CGL020
     I              COMD                            FCCOMD                                    CGL020
     I              CDTE                            FCCDTE                                    CGL020
     I              AVLD                            FCAVLD                                    CGL020
     I              LPTP                            FCLPTP                                    CGL020
     I              LPBR                            FCLPBR                                    CGL020
     I              LPAM                            FCLPAM                                    CGL020
     I              LPPS                            FCLPPS                                    CGL020
     I              DFTP                            FCDFTP                                    CGL020
     I              DFST                            FCDFST                                    CGL020
     I              TRCA                            FCTRCA                                    CGL020
     I              CANM                            FCCANM                                    CGL020
     I              CAFT                            FCCAFT                                    CGL020
     I              CAFN                            FCCAFN                                    CGL020
     I              ACSQ                            FCACSQ                                    CGL020
     I              FSTS                            FCFSTS                                    CGL020
     I              IUSR                            FCIUSR                                    CGL020
     I              AUSR                            FCAUSR                                    CGL020
     I              XUSR                            FCXUSR                                    CGL020
     I              SYCP                            FCSYCP                                    CGL020
     I              PCRF                            FCPCRF                                    CGL020
     I              PRTR                            FCPRTR                                    CGL020
     I              PMFC                            FCPMFC                                    CGL020
     I              PMFT                            FCPMFT                                    CGL020
     I              PMFN                            FCPMFN                                    CGL020
     I              INUM                            FCINUM                                    CGL020
     I              JDTE                            FCJDTE                                    CGL020
     I              SHTP                            FCSHTP                                    CGL020
     I              SHPC                            FCSHPC                                    CGL020
     I              RCSI                            FCRCSI                                    CGL020
     I              SKIR                            FCSKIR                                    CGL020
     I              SKIS                            FCSKIS                                    CGL020
     I              SKFR                            FCSKFR                                    CGL020
     I              SKFS                            FCSKFS                                    CGL020
     I              VDTC                            FCVDTC                                    CGL020
     I              OSDB                            FCOSDB                                    CGL020
     I              OMDB                            FCOMDB                                    CGL020
     I              RSTM                            FCRSTM                                    CGL020
     I              RONS                            FCRONS                                    CGL020
     I              RIBN                            FCRIBN                                    CGL020
     I              RIBA                            FCRIBA                                    CGL020
     I              ROBN                            FCROBN                                    CGL020
     I              ROCN                            FCROCN                                    CGL020
     I              PSTM                            FCPSTM                                    CGL020
     I              PONS                            FCPONS                                    CGL020
     I              PIBN                            FCPIBN                                    CGL020
     I              PIBA                            FCPIBA                                    CGL020
     I              POBN                            FCPOBN                                    CGL020
     I              POCN                            FCPOCN                                    CGL020
     I              RCRN                            FCRCRN                                    CGL020
     I              RCRA                            FCRCRA                                    CGL020
     I              RVNO                            FCRVNO                                    CGL020
     I              AWBN                            FCAWBN                                    CGL020
     I              AWBA                            FCAWBA                                    CGL020
     I              BENN                            FCBENN                                    CGL020
     I              BENA                            FCBENA                                    CGL020
     I              DTP1                            FCDTP1                                    CGL020
     I              DTP2                            FCDTP2                                    CGL020
     I              DTP3                            FCDTP3                                    CGL020
     I              DTP4                            FCDTP4                                    CGL020
     I              DCHG                            FCDCHG                                    CGL020
     I              BTB1                            FCBTB1                                    CGL020
     I              BTB2                            FCBTB2                                    CGL020
     I              BTB3                            FCBTB3                                    CGL020
     I              BTB4                            FCBTB4                                    CGL020
     I              BTB5                            FCBTB5                                    CGL020
     I              BTB6                            FCBTB6                                    CGL020
     I              CVMR                            FCCVMR                                    CGL020
     I              PCOB                            FCPCOB                                    CGL020
     I              CAXR                            FCCAXR                                    CGL020
     I              CMDI                            FCCMDI                                    CGL020
     I              CACY                            FCCACY                                    CGL020
     I              PFTI                            FCPFTI                                    CGL020
     I              SCCY                            FCSCCY                                    CGL020
     I              ICCY                            FCICCY                                    CGL020
     I              LAID                            FCLAID                                    CGL020
     I              PASI                            FCPASI                                    CGL020
     I              REPI                            FCREPI                                    CGL020
     I              FRNT                            FCFRNT                                    CGL020
     I              AFRT                            FCAFRT                                    CGL020
     I              REPA                            FCREPA                                    CGL020
     I              STMP                            FCSTMP                                    CGL020
     I              DFCL                            FCDFCL                                    CLE042
      *                                                                                       CLE139
      ** Rename Fields on Loan Amendments File:                                               CLE139
      *                                                                                       CLE139
     ILOAMSDKF                                                                                CLE139
     I              RECI                            #RECI                                     CLE139
     I              LNRF                            #LNRF                                     CLE139
     I              VDAT                            #VDAT                                     CLE139
     I              LASN                            #LASN                                     CLE139
     I              MRIN                            #MRIN                                     CLE139
     I              LTYP                            #LTYP                                     CLE139
     I              SUTP                            #SUTP                                     CLE139
     I              PTYP                            #PTYP                                     CLE139
     I              AMTP                            #AMTP                                     CLE139
     I              PRSQ                            #PRSQ                                     CLE139
     I              BRTT                            #BRTT                                     CLE139
     I              RTSP                            #RTSP                                     CLE139
     I              CCY                             #CCY                                      CLE139
     I              PRAM                            #PRAM                                     CLE139
     I              INTA                            #INTA                                     CLE139
     I              WTXA                            #WTXA                                     CLE139
     I              FEAM                            #FEAM                                     CLE139
     I              TAMT                            #TAMT                                     CLE139
     I              BRCA                            #BRCA                                     CLE139
     I              CNUM                            #CNUM                                     CLE139
     I              REPT                            #REPT                                     CLE139
     I              AUTO                            #AUTO                                     CLE139
     I              STAI                            #STAI                                     CLE139
     I              SETP                            #SETP                                     CLE139
     I              OSACQQ                          #OSACQ                                    CLE139
     I              TSEN                            #TSEN                                     CLE139
     I              FACO                            #FACO                                     CLE139
     I              SPI1                            #SPI1                                     CLE139
     I              SPI2                            #SPI2                                     CLE139
     I              SPI3                            #SPI3                                     CLE139
     I              LAIN                            #LAIN                                     CLE139
     I              BRTE                            #BRTE                                     CLE139
     I              SPIN                            #SPIN                                     CLE139
     I              CALC                            #CALC                                     CLE139
     I              WTIN                            #WTIN                                     CLE139
     I              LLAG                            #LLAG                                     CLE139
     I              LWOI                            #LWOI                                     CLE139
     I              XAVD                            #XAVD                                     CLE139
     I              XASQ                            #XASQ                                     CLE139
     I              FCUS                            #FCUS                                     CLE139
     I              FTYP                            #FTYP                                     CLE139
     I              FSEQ                            #FSEQ                                     CLE139
     I              RLON                            #RLON                                     CLE139
     I              FECD                            #FECD                                     CLE139
     I              PONI                            #PONI                                     CLE139
     I              ACTI                            #ACTI                                     CLE139
     I              CNFY                            #CNFY                                     CLE139
     I              TLXY                            #TLXY                                     CLE139
     I              CBLY                            #CBLY                                     CLE139
     I              INTC                            #INTC                                     CLE139
     I              NACD                            #NACD                                     CLE139
     I              ACBI                            #ACBI                                     CLE139
     I              ZZ001                           #ZZ001                                    CLE139
     I              LSWCC                           #LSWCC                                    CLE139
     I              LSWSC                           #LSWSC                                    CLE139
     I              OSBR                            #OSBR                                     CLE139
     I              FCLB                            #FCLB                                     CLE139
     I              LSMD                            #LSMD                                     CLE139
     I              REBT                            #REBT                                     CLE139
     I              ZZ034                           #ZZ034                                    CLE139
     I              ORED                            #ORED                                     CLE139
     I              LCD                             #LCD                                      CLE139
     I              CHTP                            #CHTP                                     CLE139
     I              TNLU                            #TNLU                                     CLE139
     I              RSTM                            #RSTM                                     CLE139
     I              RONSQQ                          #RONSQ                                    CLE139
     I              RIBN                            #RIBN                                     CLE139
     I              RIBA                            #RIBA                                     CLE139
     I              ROBN                            #ROBN                                     CLE139
     I              ROCN                            #ROCN                                     CLE139
     I              PSTM                            #PSTM                                     CLE139
     I              PONSQQ                          #PONSQ                                    CLE139
     I              PIBN                            #PIBN                                     CLE139
     I              PIBA                            #PIBA                                     CLE139
     I              POBN                            #POBN                                     CLE139
     I              POCN                            #POCN                                     CLE139
     I              RCRN                            #RCRN                                     CLE139
     I              RCRA                            #RCRA                                     CLE139
     I              RVNO                            #RVNO                                     CLE139
     I              AWBN                            #AWBN                                     CLE139
     I              AWBA                            #AWBA                                     CLE139
     I              BENN                            #BENN                                     CLE139
     I              BENA                            #BENA                                     CLE139
     I              DTP1                            #DTP1                                     CLE139
     I              DTP2                            #DTP2                                     CLE139
     I              DTP3                            #DTP3                                     CLE139
     I              DTP4                            #DTP4                                     CLE139
     I              DCHG                            #DCHG                                     CLE139
     I              BTB1                            #BTB1                                     CLE139
     I              BTB2                            #BTB2                                     CLE139
     I              BTB3                            #BTB3                                     CLE139
     I              BTB4                            #BTB4                                     CLE139
     I              BTB5                            #BTB5                                     CLE139
     I              BTB6                            #BTB6                                     CLE139
     I              CVMR                            #CVMR                                     CLE139
     I              FSRP                            #FSRP                                     CLE139
     I              FSGN                            #FSGN                                     CLE139
     I              FPRC                            #FPRC                                     CLE139
     I              COFA                            #COFA                                     CLE139
     I              IRCF                            #IRCF                                     CLE139
     I              FRCF                            #FRCF                                     CLE139
     I              DFTP                            #DFTP                                     CLE139
     I              DFST                            #DFST                                     CLE139
     I              MNSG                            #MNSG                                     CLE139
     I              GASS                            #GASS                                     CLE139
     I              GPRT                            #GPRT                                     CLE139
     I              NRLI                            #NRLI                                     CLE139
     I              ROLN                            #ROLN                                     CLE139
     I              ROSN                            #ROSN                                     CLE139
     I              ROBR                            #ROBR                                     CLE139
     I              RORC                            #RORC                                     CLE139
     I              PDGN                            #PDGN                                     CLE139
     I              GRIN                            #GRIN                                     CLE139
     I              RLCY                            #RLCY                                     CLE139
     I              PNAM                            #PNAM                                     CLE139
     I              PAST                            #PAST                                     CLE139
     I              ASTS                            #ASTS                                     CLE139
     I              IUSR                            #IUSR                                     CLE139
     I              AUSR                            #AUSR                                     CLE139
     I              XUSR                            #XUSR                                     CLE139
     I              PCRF                            #PCRF                                     CLE139
     I              PCOB                            #PCOB                                     CLE139
     I              MTPD                            #MTPD                                     CLE139
     I              PDDI                            #PDDI                                     CLE139
     I              PTDI                            #PTDI                                     CLE139
     I              SCCY                            #SCCY                                     CLE139
     I              ICCY                            #ICCY                                     CLE139
     I              ECIN                            #ECIN                                     CLE139
     I              REPI                            #REPI                                     CLE139
     I              CHDU                            #CHDU                                     CLE139
     I              INTN                            #INTN                                     CLE139
     I              FSPRAM                          #SPRAM                                    CLE139
     I              REXR                            #REXR                                     CLE139
     I              REXI                            #REXI                                     CLE139
     I              PSCY                            #PSCY                                     CLE139
     I              PEXR                            #PEXR                                     CLE139
     I              PEXI                            #PEXI                                     CLE139
     I              STAL                            #STAL                                     CLE139
     I              FRNT                            #FRNT                                     CLE139
     I              AFRT                            #AFRT                                     CLE139
     I              REPA                            #REPA                                     CLE139
     I              TMST                            #TMST                                     CLE139
     I              OSAC                            #OSAC                                     CLE139
     I              RONS                            #RONS                                     CLE139
     I              PONS                            #PONS                                     CLE139
     I              AUTH                            #AUTH                                     CLE139
     I              FRCY                            #FRCY                                     CLE139
     I              FRAM                            #FRAM                                     CLE139
     I              FINT                            #FINT                                     CLE139
     I              FTXA                            #FTXA                                     CLE139
     I              FTOT                            #FTOT                                     CLE139
     I              FPEN                            #FPEN                                     CLE139
     I              BASR                            #BASR                                     CLE139
     I              SLTP                            #SLTP                                     CLE139
     I              SLST                            #SLST                                     CLE139
     I              CLAS                            #CLAS                                     CLE139
     I              DFCL                            #DFCL                                     CLE139
     I              SLCL                            #SLCL                                     CLE139
      *                                                                                       CLE139
      ** Rename Fields on Loan Amendments Trailer File:                                       CLE139
      *                                                                                       CLE139
     ILOAMSZ1F                                                                                CLE139
     I              RECI                            #RECIZ                                    CLE139
     I              LNRF                            #LNRFZ                                    CLE139
     I              VDAT                            #VDATZ                                    CLE139
     I              LASN                            #LASNZ                                    CLE139
     I              ZZ001                           #ZZ0Z1                                    CLE139
     I              NORE                            #NORE                                     CLE139
     I              ZZ003                           #ZZ003                                    CLE139
     I              NLRB                            #NLRB                                     CLE139
     I              NINS                            #NINS                                     CLE139
     I              NDEL                            #NDEL                                     CLE139
     I              NLRA                            #NLRA                                     CLE139
     I              VLBF                            #VLBF                                     CLE139
     I              VLBL                            #VLBL                                     CLE139
     I              VRIF                            #VRIF                                     CLE139
     I              VRIL                            #VRIL                                     CLE139
     I              VRDF                            #VRDF                                     CLE139
     I              VRDL                            #VRDL                                     CLE139
     I              VRAF                            #VRAF                                     CLE139
     I              VRAL                            #VRAL                                     CLE139
     I              VRRF                            #VRRF                                     CLE139
     I              VRRL                            #VRRL                                     CLE139
     I              ZZ229                           #ZZ229                                    CLE139
     I              LCD                             #LCDZ                                     CLE139
     I              CHTP                            #CHTPZ                                    CLE139
     I              TNLU                            #TNLUZ                                    CLE139
     I/COPY WNCPYSRC,LEH00378
     ILEFHSTA                                                                               MD031473
      ** Rename fields                                                                      MD031473
     I              HIRECI                          LORECI                                  MD031473
     I              HIBRCA                          LOBRCA                                  MD031473
     I              HICNUM                          LOCNUM                                  MD031473
     I              HIFACL                          LOFACL                                  MD031473
     I              HILNRF                          LOLNRF                                  MD031473
     I              HIFSEQ                          LOFSEQ                                  MD031473
     I              HIFCOD                          LOFCOD                                  MD031473
     I              HIFCCY                          LOFCCY                                  MD031473
     I              HIAMTS                          LOAMTS                                  MD031473
     I              HIHDAT                          LOHDAT                                  MD031473
     I              HILCHD                          LOLCHD                                  MD031473
     I              HILCHT                          LOLCHT                                  MD031473
     I              HIFRT1                          LOFRT1                                  MD031473
     I              HIFRT2                          LOFRT2                                  MD031473
     I              HIFRT3                          LOFRT3                                  MD031473
     I              HIFRT4                          LOFRT4                                  MD031473
     I              HIFRT5                          LOFRT5                                  MD031473
     I              HIAMT1                          LOAMT1                                  MD031473
     I              HIAMT2                          LOAMT2                                  MD031473
     I              HIAMT3                          LOAMT3                                  MD031473
     I              HIAMT4                          LOAMT4                                  MD031473
     I              HIAMT5                          LOAMT5                                  MD031473
      *                                                                   CLE013
     I/COPY ZSRSRC,ZINTDYZ1                                               CLE013
     I/COPY ZSRSRC,ZDATE9Z2                                               CLE013
     I/COPY ZSRSRC,ZDAT10Z1                                               CLE013
      *
     I            DS
      ** Split run date into month & year
     I                                        1   7 WCODTA
     I                                        3   5 MMM
     I                                        6   7 YY
      *
     I            DS
      ** Divide up UK start of month date
     I                                        1   6 SMDT
     I                                        1   2 SMDD
     I                                        3   40SM
     I                                        5   60SY                    MOF60
      *
     I            DS
      ** Divide up US start of month date
     I                                        1   6 SMDTUS
     I                                        1   20SMUS
     I                                        3   4 SMDDUS
      *
     I            DS
      ** Aggregate balances date structure
     I                                    P   1  960AGB
     I                                    P   1   80FFDJAN
     I                                    P   9  160FFDFEB
     I                                    P  17  240FFDMAR
     I                                    P  25  320FFDAPR
     I                                    P  33  400FFDMAY
     I                                    P  41  480FFDJUN
     I                                    P  49  560FFDJUL
     I                                    P  57  640FFDAUG
     I                                    P  65  720FFDSEP
     I                                    P  73  800FFDOCT
     I                                    P  81  880FFDNOV
     I                                    P  89  960FFDDEC
      *
     I            DS
      ** Fee amounts data structure
     I                                    P   1  300FAMT
     I                                    P   1   60FEAMT1
     I                                    P   7  120FEAMT2
     I                                    P  13  180FEAMT3
     I                                    P  19  240FEAMT4
     I                                    P  25  300FEAMT5
      *
     I            DS
      ** Fee rates data structure
     I                                    P   1  205FRT
     I                                    P   1   45FEFRT1
     I                                    P   5   85FEFRT2
     I                                    P   9  125FEFRT3
     I                                    P  13  165FEFRT4
     I                                    P  17  205FEFRT5
     I            DS                                                                         BUG8762
      ** Fee amounts data structure                                                          BUG8762
     I                                    P   1  300@HAMT                                    BUG8762
     I                                    P   1   60HIAMT1                                   BUG8762
     I                                    P   7  120HIAMT2                                   BUG8762
     I                                    P  13  180HIAMT3                                   BUG8762
     I                                    P  19  240HIAMT4                                   BUG8762
     I                                    P  25  300HIAMT5                                   BUG8762
      *                                                                                      BUG8762
     I            DS                                                                         BUG8762
      ** Fee rates data structure                                                            BUG8762
     I                                    P   1  205@HRT                                     BUG8762
     I                                    P   1   45HIFRT1                                   BUG8762
     I                                    P   5   85HIFRT2                                   BUG8762
     I                                    P   9  125HIFRT3                                   BUG8762
     I                                    P  13  165HIFRT4                                   BUG8762
     I                                    P  17  205HIFRT5                                   BUG8762
      *                                                                                      261205A
      ** NUMBER OF DAYS DATA STRUCTURE                                                       261205A
      *                                                                                      261205A
     I            DS                                                                         261205A
     I                                        1  159WDAYS                                    261205A
     I                                        1   60WDAYSP                                   261205A
     I            DS                                                                        MD031473
      ** Loan Fee Amounts Data structure                                                    MD031473
     I                                    P   1  300@HLAMT                                  MD031473
     I                                    P   1   60LOAMT1                                  MD031473
     I                                    P   7  120LOAMT2                                  MD031473
     I                                    P  13  180LOAMT3                                  MD031473
     I                                    P  19  240LOAMT4                                  MD031473
     I                                    P  25  300LOAMT5                                  MD031473
     I            DS                                                                        MD031473
      ** Loan Fee rates data structure                                                      MD031473
     I                                    P   1  205@HLRT                                   MD031473
     I                                    P   1   45LOFRT1                                  MD031473
     I                                    P   5   85LOFRT2                                  MD031473
     I                                    P   9  125LOFRT3                                  MD031473
     I                                    P  13  165LOFRT4                                  MD031473
     I                                    P  17  205LOFRT5                                  MD031473
      *                                                                                     MD031473
      *
     I            DS
      ** Format fields for account key
     I                                        1  130EAMT0
     I                                        1  131EAMT1
     I                                        1  132EAMT2
     I                                        1  133EAMT3
      *
     I            DS
      ** Format original facility amount
     I                                        1  130OFAM0
     I                                        1  131OFAM1
     I                                        1  132OFAM2
     I                                        1  133OFAM3
      *
     I            DS
      ** Format fee base amount
     I                                        1  130AAMT0
     I                                        1  131AAMT1
     I                                        1  132AAMT2
     I                                        1  133AAMT3
      *
     I            DS
      ** Format average amount
     I                                        1  130WAVG0
     I                                        1  131WAVG1
     I                                        1  132WAVG2
     I                                        1  133WAVG3
      *
     I            DS
      ** Format fee amount
     I                                        1  130WTOT0
     I                                        1  131WTOT1
     I                                        1  132WTOT2
     I                                        1  133WTOT3
      *                                                                   BH3484
     I            DS                                                      BH3484
      ** Format total past due now amount                                 BH3484
     I                                        1  130WOSA0                 BH3484
     I                                        1  131WOSA1                 BH3484
     I                                        1  132WOSA2                 BH3484
     I                                        1  133WOSA3                 BH3484
      *
      ** Format suspended amount                                                              CLE134
      *                                                                                       CLE134
     I                                        1  130WSUS0                                     CLE134
     I                                        1  131WSUS1                                     CLE134
     I                                        1  132WSUS2                                     CLE134
     I                                        1  133WSUS3                                     CLE134
      *                                                                                       CLE134
     I            DS                                                      100516
     I** Format past due amount                                           100516
     I                                        1  130WPOA0                 100516
     I                                        1  131WPOA1                 100516
     I                                        1  132WPOA2                 100516
     I                                        1  133WPOA3                 100516
     I            DS
      ** Redefine fee details.
     I                                        1   2 FECALT
     I**********                              1   20CALT                                    MD031496
     I                                        3   40FEFCOD
     I                                        3   4 WFCOD
     I                                        5   90FEFACL
     I                                        5   70FTYP
     I                                        5   7 WFTYP
     I                                        8   90FSEQ
      *
     I            DS                                                      33591
      ** Divide Date                                                      33591
     I                                        1   60WWDAT                 33591
     I                                        1   20WWDT1                 33591
     I                                        3   40WWDT2                 33591
     I                                        5   60WWDT3                 33591
      *                                                                                       CLE073
     IFACLOA      DS                                                                          CLE073
     I                                        1   3 OFTYP                                     CLE073
     I                                        4   4 OSEP                                      CLE073
     I                                        5   6 OFSEQ                                     CLE073
      *                                                                                       CLE073
      *                                                                                       CLE073
     IACCY        DS                             30                                           CLE141
     I                                        1   3 C1PI                                      CLE141
     I                                        4   6 C2PI                                      CLE141
     I                                        7   9 C3PI                                      CLE141
     I                                       10  12 C4PI                                      CLE141
     I                                       13  15 C5PI                                      CLE141
     I                                       16  18 C6PI                                      CLE141
     I                                       19  21 C7PI                                      CLE141
     I                                       22  24 C8PI                                      CLE141
     I                                       25  27 C9PI                                      CLE141
     I                                       28  30 C0PI                                      CLE141
     IALOC        DS                             30                                           CLE141
     I                                        1   3 L1PI                                      CLE141
     I                                        4   6 L2PI                                      CLE141
     I                                        7   9 L3PI                                      CLE141
     I                                       10  12 L4PI                                      CLE141
     I                                       13  15 L5PI                                      CLE141
     I                                       16  18 L6PI                                      CLE141
     I                                       19  21 L7PI                                      CLE141
     I                                       22  24 L8PI                                      CLE141
     I                                       25  27 L9PI                                      CLE141
     I                                       28  30 L0PI                                      CLE141
      *                                                                                       CLE141
     I/COPY WNCPYSRC,LEH00669
     I            DS                                                                        MD026969
      ** Format recalculated amount                                                         MD026969
     I                                        1  130RAMTP0                                  MD026969
     I                                        1  131RAMTP1                                  MD026969
     I                                        1  132RAMTP2                                  MD026969
     I                                        1  133RAMTP3                                  MD026969
     ISPOOL3      DS                                                                        MD026969
      ** File information data structures                                                   MD026969
     I                                       83  92 SFILE3                                  MD026969
     I                                    B 123 1240SFNUM3                                  MD026969
      *                                                                                     AR820690
     IJNSTAT      DS                            200                                         AR820690
     I                                    P 103 1050PRUN                                    AR820690
      ** DATA AREA TO READ PREVIOUS RUNDATE                                                 AR820690
      *
     ISPOOL1      DS
      ** File information data structures
     I                                       83  92 SFILE1
     I                                    B 123 1240SFNUM1
      *
     ISPOOL2      DS
     I                                       83  92 SFILE2
     I                                    B 123 1240SFNUM2
      *
     ISPOOLU      DS
     I                                       83  92 SFILEU
     I                                    B 123 1240SFNUMU
      *
     I/COPY ZSRSRC,ZHOLI
      *
     I/COPY ZSRSRC,ZHASHZ2
      *
     ILDA       E DSLDA
      ** Database error DS
      *
     ILESTAT    E DSLESTAT
      **  Data Structure to obtain control date
     I              FLSETUP                         SETUP
     I              HSTPROC                         HIST
     I              CODT                            WCODT
      *
     ISTLNS1      DS                            110                                           CGL020
      ** Set work fields                                                                      CGL020
      *                                                                                       CGL020
     I**********                              1   60WWROCN                             CGL020 CSD027
     I**********                              7  120WWROBN                             CGL020 CSD027
     I**********                             13  180WWPOCN                             CGL020 CSD027
     I**********                             19  240WWPOBN                             CGL020 CSD027
     I                                        1   6 WWROCN                                    CSD027
     I                                        7  12 WWROBN                                    CSD027
     I                                       13  18 WWPOCN                                    CSD027
     I                                       19  24 WWPOBN                                    CSD027
     I                                       25  32 WWBENN                                    CGL020
     I                                       33  67 WWBENA                                    CGL020
     I                                       68  75 WWAWBN                                    CGL020
     I                                       76 110 WWAWBA                                    CGL020
     ISTLNS2      DS                            110                                           CGL020
      ** Set work fields from LEFEED                                                          CGL020
      *                                                                                       CGL020
     I**********                              1   60ROCN                               CGL020 CSD027
     I**********                              7  120ROBN                               CGL020 CSD027
     I**********                             13  180POCN                               CGL020 CSD027
     I**********                             19  240POBN                               CGL020 CSD027
     I                                        1   6 ROCN                                      CSD027
     I                                        7  12 ROBN                                      CSD027
     I                                       13  18 POCN                                      CSD027
     I                                       19  24 POBN                                      CSD027
     I                                       25  32 BENN                                      CGL020
     I                                       33  67 BENA                                      CGL020
     I                                       68  75 AWBN                                      CGL020
     I                                       76 110 AWBA                                      CGL020
     ISTLNS3      DS                            110                                           CGL020
      ** Set work fields from CLOANCL                                                         CGL020
      *                                                                                       CGL020
     I**********                              1   60TPROCN                             CGL020 CSD027
     I**********                              7  120TPROBN                             CGL020 CSD027
     I**********                             13  180TPPOCN                             CGL020 CSD027
     I**********                             19  240TPPOBN                             CGL020 CSD027
     I                                        1   6 TPROCN                                    CSD027
     I                                        7  12 TPROBN                                    CSD027
     I                                       13  18 TPPOCN                                    CSD027
     I                                       19  24 TPPOBN                                    CSD027
     I                                       25  32 TPBENN                                    CGL020
     I                                       33  67 TPBENA                                    CGL020
     I                                       68  75 TPAWBN                                    CGL020
     I                                       76 110 TPAWBA                                    CGL020
     ISTLNS4      DS                            110                                           CGL020
      ** Set work fields from FCLTYFM                                                         CGL020
      *                                                                                       CGL020
     I**********                              1   60FCROCN                             CGL020 CSD027
     I**********                              7  120FCROBN                             CGL020 CSD027
     I**********                             13  180FCPOCN                             CGL020 CSD027
     I**********                             19  240FCPOBN                             CGL020 CSD027
     I                                        1   6 FCROCN                                    CSD027
     I                                        7  12 FCROBN                                    CSD027
     I                                       13  18 FCPOCN                                    CSD027
     I                                       19  24 FCPOBN                                    CSD027
     I                                       25  32 FCBENN                                    CGL020
     I                                       33  67 FCBENA                                    CGL020
     I                                       68  75 FCAWBN                                    CGL020
     I                                       76 110 FCAWBA                                    CGL020
     IWFCKEY      DS                             12                                           CGL020
     I**********                              1   60FECNUM                             CGL020 CSD027
     I                                        1   6 FECNUM                                    CSD027
     I                                        7   90FCFTYP                                    CGL020
     I                                       10  110FCFNUM                                    CGL020
     I                                       12  12 WRCDT                                     CGL020
      *                                                                                       CGL020
     IHISTHP    E DSHISTSHP                                                                 MD031496
      ** Rename fields.                                                                     MD031496
     I              RECI                            RECIP1                                  MD031496
     I              RCDT                            RCDTP1                                  MD031496
     I              BRCA                            BRCAP1                                  MD031496
     I              CNUM                            CNUMP1                                  MD031496
     I              LNRF                            LNRFP1                                  MD031496
     I              VDAT                            VDATP1                                  MD031496
     I              PRSQ                            PRSQP1                                  MD031496
     I              LASN                            LASNP1                                  MD031496
     I              FCUS                            FCUS1                                   MD031496
     I              FTYP                            FTYP1                                   MD031496
     I              FSEQ                            FSEQ1                                   MD031496
     I              PTYP                            PTYP1                                   MD031496
     I              CCY                             CCYP1                                   MD031496
     I              AMTP                            AMTPP1                                  MD031496
     I              PRAM                            PRAM1                                   MD031496
     I              INTA                            INTA1                                   MD031496
     I              WTXA                            WTXA1                                   MD031496
     I              FEAM                            FEAM1                                   MD031496
     I              FECD                            FECD1                                   MD031496
     I              WOIN                            WOIN1                                   MD031496
     I              EXVD                            EXVD1                                   MD031496
     I              LTYP                            LTYPP1                                  MD031496
     I              SUTP                            SUTPP1                                  MD031496
     I              LCD                             LCDP1                                   MD031496
     I              COFA                            COFA1                                   MD031496
     I              CPAM                            CPAM1                                   MD031496
     I              AITC                            AITC1                                   MD031496
     I              INTR                            INTR1                                   MD031496
     I              AIAP                            AIAP1                                   MD031496
     I              IPRD                            IPRD1                                   MD031496
     I              MNSG                            MNSG1                                   MD031496
     I              GASS                            GASS1                                   MD031496
     I              GPRT                            GPRT1                                   MD031496
     I              ROLN                            ROLN1                                   MD031496
     I              ACDA                            ACDA1                                   MD031496
     I              COFR                            COFR1                                   MD031496
     I              ACAP                            ACAP1                                   MD031496
     I              COFD                            COFD1                                   MD031496
     I              REPI                            REPI1                                   MD031496
     I              CHDU                            CHDU1                                   MD031496
     I              AITN                            AITN1                                   MD031496
     I              AIAN                            AIAN1                                   MD031496
     I              IPRN                            IPRN1                                   MD031496
     I              INTN                            INTN1                                   MD031496
     I              FSPRAM                          FSPRA1                                  MD031496
     I              FSCPAM                          FSCPA1                                  MD031496
     I              CLAS                            CLAS1                                   MD031496
      *                                                                                     MD031496
     IRUNDAT    E DSRUNDAT
      ** Data Area giving Installation Control Details
     I              AGMBIN                          MBIN
      *
     ISDFEE     E DSSDFEEPD                                                                   CLE134
      *                                                                                       CLE134
     ISDBANK    E DSSDBANKPD
      ** Bank details
      *
     I              BJEYD                           LEYD                                    MD025983
      *                                                                                     MD025983
     ISDCURR    E DSSDCURRPD
      ** Currency Type
     I              A6MDIN                          MDIN
     I              A6SPRT                          SPOT
     I              A6NBDP                          CDP
     I              A6CYCD                          CCY
     I              A6SSNB                          CSNO
      * Field not used and not compiled into object so remove                                 CSC042
      * to make code clearer.                                                                 CSC042
     I**********    A6TXND                          TXND                                      CSC042
      *
     ISDCUST    E DSSDCUSTPD
      ** Customer Code Details
      *
     ISDACOF    E DSSDACOFPD
      ** Account Officer Details
      *
     ISDBRCH    E DSSDBRCHPD
      ** Branch name details
     I              A8BRNM                          BRNM
     I              QQDFAC                          DFACQQ                                    CGL029
      *
     ISDGELR    E DSSDGELRPD
      ** General Ledger Details
     I              QQACCD                          ACCDQQ                                    CGL029
      *                                                                   127966
     ISCSARD    E DSSCSARDPD                                              CLE007
      ** Switchable Features File                                         CLE007
      *                                                                   CLE007
     ISDMMOD    E DSSDMMODPD                                              127966
      ** Module Details                                                   127966
      *
     ISDNOST    E DSSDNOSTPD                                              155672
      **   External data structures for Nostro details                    155672
      *                                                                   155672
      **********                                                                       218782 222373
     I*SDSVAL***E DSSDSVALPD                                                           218782 222373
      ****EXTERNAL DS FOR SYSTEM VALUES                                                218782 222373
      **********                                                                       218782 222373
     ILESTAL    E DSLESTALPD                                                                  CLE034
      ** External data structures for Settlement Allocation File                              CLE034
      *                                                                                       CLE034
     I              PSTM                            STPSTM                                    CLE034
     I              PONS                            STPONS                                    CLE034
     I              POBR                            STPOBR                                    CLE034
     I              PIBN                            STPIBN                                    CLE034
     I              RSTM                            STRSTM                                    CLE034
     I              RONS                            STRONS                                    CLE034
     I              ROBR                            STROBR                                    CLE034
     I              RIBN                            STRIBN                                    CLE034
     I              REXR                            STREXR                                    CLE034
     I              REXI                            STREXI                                    CLE034
     I              PEXR                            STPEXR                                    CLE034
     I              PEXI                            STPEXI                                    CLE034
     I              PSCY                            STPSCY                                    CLE034
     I              RIBA                            STRIBA                                    CLE034
     I              ROBN                            STROBN                                    CLE034
     I              ROCN                            STROCN                                    CLE034
     I              CVMR                            STCVMR                                    CLE034
     I              BENN                            STBENN                                    CLE034
     I              BTB1                            STBTB1                                    CLE034
     I              BTB2                            STBTB2                                    CLE034
     I              BTB3                            STBTB3                                    CLE034
     I              BTB4                            STBTB4                                    CLE034
     I              SEQ                             STSEQ                                     CLE034
     I              CCY                             STCCY                                     CLE038
     I              PCRF                            STPCRF                                    227716
     I              POBN                            STPOBN                                    CLE034
     I              POCN                            STPOCN                                    CLE034
     I              AWBN                            STAWBN                                    CLE034
     I              AWBA                            STAWBA                                    CLE034
     I              BENA                            STBENA                                    CLE034
     IDSACCT    E DSACCNTAB                                                                   CLE164
     I              LCD                             QQLCD                                     CLE164
     I              RECI                            QQRECI                                    CLE164
     I              CNUM                            QQCNUM                                    CLE164
     I              CCY                             QQCCY                                     CLE164
     I              TMST                            QQTMST                                    CLE164
     IDSFDY     E DSDSFDY
      ** First DS for access programs, short data structure
      *
     IDSSDY     E DSDSSDY
      ** Second DS for access programs, long data structure
      *                                                                                       CGL020
     I              'ZAAMLSETLE'          C         AMLPRI                                    CGL020
      *                                                                                       CGL020
     I***/COPY*WNCPYSRC,LER135I001***                                                         CFC006
     I/COPY WNCPYSRC,LER135I001                                                             MD020563
     I              'LER135001'           C         SECTN1                                    CFC006
     I              'LER135002'           C         SECTN2                                    CFC006
     I              'LECalcBasis6LeapYear'C         WPARML                                  MD035545
     I              'AutoEndCalcLoanFee'  C         WPARM1                                  MD046370
     I              'LoanCustOriginPurch' C         WPARM                                   MD055481
      *
     IWVCATC      DS                                                                          CLE164
     I                                        1   50PFCLTY                                    CLE164
     I                                        7   80PFESEQ                                    CLE164
     I                                        9  160PREPR                                     CLE164
     I                                       17  240PCAPR                                     CLE164
      *****************************************************************
     C/TITLE MAIN PROCESSING
      *****************************************************************
     C/COPY WNCPYSRC,LEH01137
      *                                                                                       CLE139
      ** Receive input parameters.                                                            CLE139
      *                                                                                       CLE139
     C           *ENTRY    PLIST                                                              CLE139
     C                     PARM           CCAP    1                                           CLE139
     C                     PARM           WPNAM  10                                           CLE134
      *
      ** Perform initial processing.
      *
     C           *IN10     CASEQ'0'       INIT
     C                     END
      *                                                                                       230521
      ** Initialise field.                                                                    230521
      *                                                                                       230521
     C**********           Z-ADD0         LFCN    60                                   230521 CSD027
     C                     MOVE *BLANKS   LFCN    6                                           CSD027
      *
      ** Read fees master file
     C           *IN50     DOWEQ'0'
      *
     C                     READ LEFEED                   50
     C                     MOVE FECALT    CALT    20                                        MD031496
     C                     Z-ADD0         ADDUE                                               CLE134
     C                     Z-ADD0         ADJTOT                                              227253
     C                     Z-ADD0         ADDUE                                               260472
     C**********           Z-ADD0         FEOAMT                                       243496 245803
     C                     Z-ADD0         FEOAMT                                             243496B
     C                     Z-ADD0         FEPOST                                            MD054703
     C                     MOVE 'N'       WBFREQ  1                                        AR740063A
     C                     MOVE *BLANKS   LKPRFC                                            AR995302
     C                     Z-ADD0         WARY                                              AR753180
     C                     Z-ADD0         R       40                                        AR753180
     C                     MOVE *BLANKS   WFZASF  1                                         MD026969
     C                     Z-ADD0         WLOANA 130                                        MD055069
     C                     Z-ADD0         FEPOST                                            MD047522
     C                     MOVEL*BLANK    WPAYTD  1                                         MD052216
      *                                                                                     MD055481
     C                     SETOF                     36                                     MD055481
     C           FELOAN    IFNE *BLANKS                                                     MD055481
     C           PPCUST    ANDEQ'O'                                                         MD055481
      *                                                                                     MD055481
     C           WLNKEY    CHAINCLOAN                88                                     MD055481
     C           *IN88     IFEQ '0'                                                         MD055481
     C                     MOVE TPOLNO    WOLNO   6                                         MD055481
     C                     MOVE TPPTYP    WPTYP   20                                        MD055481
     C                     EXSR ORIGB                                                       MD055481
     C                     ENDIF                                                            MD055481
     C                     ENDIF                                                            MD055481
      *                                                                                     MD055481
     C/COPY WNCPYSRC,LER135CCP2                                           S01408
      *
     C                     MOVE *BLANKS   LKSCCY                          179741
      *                                                                   179741
     C           *IN50     IFEQ '0'
     C           FERECI    ANDEQ'D'
     C                     MOVE FEBRCA    REPBRC  3
     C                     Z-ADDFEFSEQ    LKBRTT                          CMX001
     C                     MOVE ' '       WPROC                           153672
     C                     MOVE ' '       WFLAG                           153672
     C                     Z-ADDFEAMTO    W#AMTO 130                      153736
     C                     Z-ADD0         @WRK1                                               202954
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C                     MOVE 'FEES'    WKTYPE  4                                           CLE034
     C                     ENDIF                                                              CLE034
      *
      ** Non-calculated and loan fees are not processed by this program
      ** - calculated fees are identifed by data in the fee
      ** calculation type field (FECALT).
      *
     C           FECAPI    IFEQ 'Y'                                                           CLE139
     C           CCAP      ANDEQ'C'                                                           CLE139
     C           FECAPI    ORNE 'Y'                                                           CLE139
     C           CCAP      ANDEQ'P'                                                           CLE139
      *                                                                                       CLE139
     C           FECALT    IFNE *BLANKS
     C           CLE134    ANDNE'Y'                                                           262506
     C           FECALT    ORNE *BLANKS                                                       262506
     C           FECALT    ANDNE'90'                                                          262506
     C           CLE134    ANDEQ'Y'                                                           262506
     C           NEWCOB    ANDNE'Y'                                                           262506
     C           FECALT    OREQ '90'                                                          262506
     C           CLE134    ANDEQ'Y'                                                           262506
     C           NEWCOB    ANDEQ'Y'                                                           262506
      *                                                                                       CLE134
     C                     MOVE 'N'       WPDCLL  1                                           CLE134
     C                     MOVE 'N'       WPSUSP  1                                           CLE134
     C                     MOVE 'N'       WFLATE  1                                           CLE134
     C                     Z-ADD0         WNXREP  50                                          CLE134
     C                     Z-ADD0         FESUSP                                              CLE134
      *                                                                                       CLE134
      ** Process done if CLE134 is ON                                                         CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
      *                                                                                       CLE134
      ** Check if Fee is suspended                                                            CLE134
      *                                                                                       CLE134
     C           FEFSFA    IFEQ 'Y'                                                           CLE134
     C           FESFA     ANDNE0                                                             CLE134
     C                     MOVE 'Y'       WPSUSP                                              CLE134
     C                     Z-ADDFESFA     FESUSP                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
      ** Check whether there are PDCLs for the fee                                            CLE134
      *                                                                                       CLE134
     C           FEAUTO    IFEQ 'C'                                                           CLE134
     C           FEAUT2    OREQ 'C'                                                           CLE134
      *                                                                                       CLE134
      ** 1 live PDCL (with CPAM > 0) the fee cannot mature                                    CLE134
      ** read LEPDUFPD which contains fees PDCL                                               CLE134
      *                                                                                       CLE134
     C           WKPDCL    SETLLLEPDUFL2                                                      CLE134
     C                     MOVE *OFF      *IN88                                               CLE134
     C           *IN88     DOWEQ*OFF                                                          CLE134
     C           WKPDCL    READELEPDUFL2                 88                                   CLE134
     C           *IN88     IFEQ *OFF                                                          CLE134
     C                     MOVE YBRCA     WBRCA                                               CLE134
     C                     MOVE YPLON     WLOAN                                               CLE134
     C                     Z-ADD0         CPAML                                               CLE134
      *                                                                                       CLE134
      ** Check if PDCL CPAM is greater than zero                                              CLE134
      *                                                                                       CLE134
     C           KEYLOA    CHAINLELOANLG             19                                       CLE134
     C           CPAML     IFNE *ZEROS                                                        CLE134
     C                     MOVE 'Y'       WPDCLL                                              CLE134
     C                     MOVE *ON       *IN88                                               CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDDO                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C           FECALT    IFEQ '90'                                                          CLE134
      *                                                                                       CLE134
      ** 1 live PDCL (with CPAM > 0) the fee cannot mature                                    CLE134
      ** read LEPDUEPD which contains fees LOAN                                               CLE134
      *                                                                                       CLE134
     C           FELOAN    SETLLLEPDUEL2                                                      CLE134
     C                     MOVE *OFF      *IN88                                               CLE134
     C           FELOAN    READELEPDUEL2                 88                                   CLE134
     C           *IN88     IFEQ *OFF                                                          CLE134
     C                     MOVE YBRCA     WBRCA                                               CLE134
     C                     MOVE YPLON     WLOAN                                               CLE134
     C                     Z-ADD0         CPAML                                               CLE134
      *                                                                                       CLE134
      ** Check if PDCL CPAM is greater than zero                                              CLE134
      *                                                                                       CLE134
     C           KEYLOA    CHAINLELOANLG             19                                       CLE134
     C           CPAML     IFNE *ZEROS                                                        CLE134
     C                     MOVE 'Y'       WPDCLL                                              CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
      ** IF Fee type 90 and a PDCL exists, check whether next payment                         CLE134
      ** date needs to be set up = run date. On the day before                                CLE134
      ** the payment is due, the next payment date is updated to next                         CLE134
      ** frequency and the accrued up to date is moved to past due                            CLE134
      *                                                                                       CLE134
     C           WPDCLL    IFEQ 'Y'                                                           CLE134
      *                                                                                       CLE134
     C                     Z-ADDFELPDT    KPDVDT  50                                          CLE134
     C                     MOVE *OFF      *IN88                                               CLE134
     C           WKDUE     SETLLLEPDUEL5                                                      CLE134
     C           *IN88     DOWEQ*OFF                                                          CLE134
     C           WKDUEP    READELEPDUEL5                 88                                   CLE134
     C           *IN88     IFEQ *OFF                                                          CLE134
     C           YPDVDT    IFGE FELPDT                                                        CLE134
     C           YPDCT     ANDNE'I'                                                           CLE134
     C                     Z-ADDYPDVDT    FENPYD                                              CLE134
     C                     MOVE 'Y'       WFLATE                                              CLE134
     C                     MOVE *ON       *IN88                                               CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDDO                                                              CLE134
      *                                                                                       CLE134
      ** Retrieve Original loan next repayment date                                           CLE134
      *                                                                                       CLE134
     C           WLNKEY    CHAINCLOAN                88                                       CLE134
     C           *IN88     IFEQ *OFF                                                          CLE134
     C                     Z-ADDTPNRPD    WNXREP                                              CLE134
     C                     ADD  TPGDPR    WNXREP                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
      ** Access AOFEER0                                                                       CLE134
      *                                                                                       CLE134
     C                     MOVE FEFCOD    AUFECD                                              CLE134
     C                     CALL 'AOFEER0'              99                                     CLE134
     C                     PARM '*MSG   ' @RTCD                                               CLE134
     C                     PARM '*KEY   ' @OPTN                                               CLE134
     C                     PARM AUFECD    FKEY    2                                           CLE134
     C           SDFEE     PARM SDFEE     DSFDY                                               CLE134
      *                                                                                       CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C/COPY WNCPYSRC,LEH00670
      *                                                                                     MD052216
      ** Get Pay Due Ind and Pay Taken Ind from Fee Extension File                          MD052216
      ** Default value for PDDI and PTDI is M (Modified)                                    MD052216
      *                                                                                     MD052216
     C                     MOVEL'M'       WPDDI   1                                         MD052216
     C                     MOVEL'M'       WPTDI   1                                         MD052216
     C           *LIKE     DEFN FQFPBD    WFPBDT                                            MD052216
     C                     Z-ADD*ZEROS    WFPBDT                                            MD052216
     C           KEYFXT    CHAINLEFEEQL0             08                                     MD052216
     C           *IN08     IFEQ *OFF                                                        MD052216
     C                     Z-ADDFQFPBD    WFPBDT                                            MD052216
     C                     MOVELFQPDDI    WPDDI                                             MD052216
     C                     MOVELFQPTDI    WPTDI                                             MD052216
     C                     ENDIF                                                            MD052216
      *                                                                                       CLE073
      * Access facilities file only if the fee is not loan based                              CLE073
      * IF CLE073 is on and loan based fee then process GENKYL                                CLE073
      *                                                                                       CLE073
     C                     MOVE 'Y'       WFACLF  1                                           CLE073
     C           CLE073    IFEQ 'Y'                                                           CLE073
     C           FECALT    IFEQ '97'                                                          CLE073
     C           FECALT    OREQ '98'                                                          CLE073
     C           FECALT    OREQ '99'                                                          CLE073
     C                     MOVE 'N'       WFACLF                                              CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** If Late fees (calc type 90) then set WFACLF = 'N'                                    CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FECALT    ANDEQ'90'                                                          CLE134
     C                     MOVE 'N'       WFACLF                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C           WFACLF    IFEQ 'Y'                                                           CLE073
      *
      ** Obtain original facility details from facility history header.
      *
     C           HSHKEY    CHAINFACHISH              20
      *
     C           *IN20     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'LER135'  DBPGM
     C                     MOVELFECNUM    DBKEY
     C                     MOVE FEFACL    DBKEY
     C                     MOVEL'FACHISH' DBFILE           ************
     C                     Z-ADD001       DBASE            * DBERR 01 *
     C                     OUT  LDA                        ************
     C                     EXSR *PSSR
     C                     END
      *                                                                                     MD026969
      ** Check if the associated facility had movements                                     MD026969
      ** Facility date should be backvalued and *LT FELPDT                                  MD026969
      ** Fee as at today has FEAMTP = 0 and FENPYD > BJDNWD                                 MD026969
      *                                                                                     MD026969
     C           HSAKY2    CHAINFACACTL2             20                                     MD026969
     C           *IN20     IFEQ '0'                                                         MD026969
     C           WKFZAS    ANDEQ'Y'                                                         MD026969
     C           FEFACL    ANDNE0                                                           MD054354
     C           FESYIN    ANDNE'Y'                                                         MD054354
     C           FEAUTO    ANDNE'C'                                                         MD054354
     C           FCDATE    IFLT FELPDT                                                      MD026969
     C           FCDATE    ANDLTBJRDNB                                                      MD026969
     C           FEAMTP    ANDEQ0                                                           MD026969
     C           FENPYD    ANDGTBJDNWD                                                      MD026969
     C           FEPEND    ANDGTBJDNWD                                                      MD026969
     C           FEINDC    ANDNE'Y'                                                        MD026969A
     C                     MOVE 'Y'       WFZASF                                            MD026969
     C                     Z-ADDFELPAM    SVLPAM 130                                        MD026969
     C                     Z-ADDFEAMTO    SVAMTO 130                                        MD026969
     C                     MOVE ATYP      SVATYP  1                                         MD026969
     C                     Z-ADDADDUE     SVADDU 130                                        MD026969
     C                     Z-ADD0         WAMT                                              MD026969
     C                     Z-ADD0         WPCT                                              MD026969
     C                     MOVE '0'       *IN70                                             MD026969
     C           CALT      IFGE 4                                                           MD026969
     C           CALT      ANDLE6                                                           MD026969
     C           CALT      ORGE 14                                                          MD026969
     C           CALT      ANDLE16                                                          MD026969
     C           CALT      OREQ 22                                                          MD026969
      ** Actual amounts used indicator                                                      MD026969
     C                     MOVE '1'       *IN70                                             MD026969
     C                     ENDIF                                                            MD026969
     C                     EXSR RECALC                                                      MD026969
     C                     EXSR SRFZAS                                                      MD026969
     C                     Z-ADDSVLPAM    FELPAM                                            MD026969
     C                     Z-ADDSVAMTO    FEAMTO                                            MD026969
     C                     MOVE SVATYP    ATYP                                              MD026969
     C                     Z-ADDSVADDU    ADDUE                                             MD026969
     C                     ENDIF                                                            MD026969
     C                     ENDIF                                                            MD026969
     C/COPY WNCPYSRC,LEH00671
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      * If loan based fees, then access CLOANCL to get Ccy and Principal Amount               CLE073
      *                                                                                       CLE073
     C           CLE073    IFEQ 'Y'                                                           CLE073
     C           WFACLF    ANDEQ'N'                                                           CLE073
     C           CLE134    OREQ 'Y'                                                           CLE134
     C           WFACLF    ANDEQ'N'                                                           CLE134
     C                     MOVE FEBRCA    WBRCA                                               CLE073
     C                     MOVE FECNUM    WCNUM                                               CLE073
     C                     MOVE FELOAN    WLOAN                                               CLE073
     C           KEYLOA    CHAINLELOANLG             20                                       CLE073
      *                                                                                       CLE073
     C           *IN20     IFEQ '1'                                                           CLE073
     C           *LOCK     IN   LDA                                                           CLE073
     C                     MOVEL'LER135'  DBPGM                                               CLE073
     C                     MOVELFECNUM    DBKEY                                               CLE073
     C                     MOVE FELOAN    DBKEY                                               CLE073
     C                     MOVEL'LELOANLG'DBFILE                                              CLE073
     C                     Z-ADD025       DBASE                                               CLE073
     C                     OUT  LDA                                                           CLE073
     C                     EXSR *PSSR                                                         CLE073
     C                     ENDIF                                                              CLE073
      * set currency                                                                          CLE073
      * (CCYP is from HISTSHP which is only processed for type 97)                            CLE073
      * (CCYP is used for conversion to fee currency)                                         CLE073
      *                                                                                       CLE073
     C                     MOVE CCYL      CCYP                                                CLE073
      *                                                                                       CLE073
      * IF Type 98, then access CLOANCK to get original principal amount                      CLE073
     C           FECALT    IFEQ '98'                                                          CLE073
     C           FECALT    OREQ '97'                                                          CLE073
     C           FELOAN    CHAINCLOANK               20                                       CLE073
     C           KEYPHS    CHAINLEHISTLB             27                                       CLE073
     C           *IN27     IFEQ *OFF                                                          CLE073
     C                     Z-ADDPRAMM     OPAMK                                               CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      *  Check if maturity of the loan is earlier than next payment date or if CPAM has       CLE073
      *  become zero.                                                                         CLE073
      *                                                                                       CLE073
     C                     MOVE 'N'       WPAID   1                                           CLE134
     C           CPAML     IFEQ 0                                                             CLE073
     C           MDATL     ORLT FENPYD                                                        CLE073
     C           MDATL     ANDNE0                                                             CLE073
     C           MDATL     ORLT FEPEND                                                        CLE073
     C           MDATL     ANDNE0                                                             CLE073
     C                     EXSR CHKDTE                                                        CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     MOVE *BLANKS   SUTPP1                                            MD031496
      *                                                                                     MD031496
     C/EXEC SQL                                                                             MD031496
     C+ declare ACursor insensitive scroll cursor for                                       MD031496
     C+ SELECT * FROM HISTSHP                                                               MD031496
     C+ where BRCA = :WBRCA and CNUM = :WCNUM and LNRF = :FELOAN                            MD031496
     C+  and LCD = :BJRDNB                                                                  MD031496
     C+ order by BRCA, CNUM, LNRF, LCD                                                      MD031496
     C/END-EXEC                                                                             MD031496
      *                                                                                     MD031496
     C/EXEC SQL                                                                             MD031496
     C+ open ACursor                                                                        MD031496
     C/END-EXEC                                                                             MD031496
      *                                                                                     MD031496
     C/EXEC SQL                                                                             MD031496
     C+ fetch next from ACursor into :HISTHP                                                MD031496
     C/END-EXEC                                                                             MD031496
      *                                                                                     MD031496
     C**********           MOVE '0'       *IN78                                    AR317401 MD031496
     C                     MOVE ' '       FEELS   1                                         AR317401
      *                                                                                     AR317401
     C********** KEYHP1    SETGTLEHISTV3                                           AR317401 MD031496
     C********** KEYHP1    REDPELEHISTV3                 78                        AR317401 MD031496
     C********** *IN78     IFEQ '0'                                                AR317401 MD031496
     C********** SUTPP1    ANDNEFESUTP                                             AR317401 MD031496
     C           SQLCOD    DOWEQ0                                                           MD031496
     C           SUTPP1    IFNE FESUTP                                                      MD031496
     C           NEWCOB    ANDNE'Y'                                                         AR317401
      *                                                                                     AR317401
     C                     SELEC                                                            AR317401
      *                                                                                     AR317401
      ** Existing loan fees.                                                                AR317401
      *                                                                                     AR317401
     C           FEORED    WHLT BJRDNB                                                      AR317401
     C           FEPSTD    ANDLTCODT                                                        AR317401
     C           FEPEND    ANDGECODT                                                        AR317401
     C           FEORED    ORLT BJRDNB                                                      AR317401
     C           FEPSTD    ANDLTCODT                                                        AR317401
     C           FEPEND    ANDLTCODT                                                        AR317401
     C           FEAMTP    ANDGT0                                                           AR317401
     C                     EXSR FEECHG                                                      AR317401
      *                                                                                     AR317401
      ** Newly inserted loan fees.                                                          AR317401
      *                                                                                     AR317401
     C           FEORED    WHEQ BJRDNB                                                      AR317401
     C           FEPEND    ANDGEVDATP1                                                      AR317401
     C           FEORED    OREQ BJRDNB                                                      AR317401
     C           FEPEND    ANDLTVDATP1                                                      AR317401
     C           FEAUTO    ANDEQ'N'                                                         AR317401
     C           FEPSTD    ORGE CODT                                                        AR317401
     C                     MOVE SUTPP1    FESUTP                                            AR317401
      *                                                                                     AR317401
     C                     ENDSL                                                            AR317401
     C                     ENDIF                                                            AR317401
      *                                                                                     AR317401
     C/EXEC SQL                                                                             MD031496
     C+ FETCH NEXT FROM ACURSOR INTO :HISTHP                                                MD031496
     C/END-EXEC                                                                             MD031496
     C                     ENDDO                                                            MD031496
     C/EXEC SQL                                                                             MD031496
     C+ CLOSE ACURSOR                                                                       MD031496
     C/END-EXEC                                                                             MD031496
     C                     ENDIF                                                              CLE073
      *
      ** Get decimal places for fee currency and set power array
      ** element for use in accrual routine.
      *
     C**********           CALL 'AOCURRR0'                                                    CSC042
     C**********           PARM '*MSG   ' WRTCD   7                                           CSC042
     C**********           PARM '*KEY   ' WOPTN   7                                           CSC042
     C**********           PARM FEFCCY    WAJCD   3                                           CSC042
     C********** SDCURR    PARM SDCURR    DSSDY                                               CSC042
     C********** WRTCD     IFNE *BLANKS                                                       CSC042
     C                     MOVELFEFCCY    ##KC                                                CSC042
     C                     EXSR ##CHKC                                                        CSC042
     C           ##FIC     IFEQ 'Y'                                                           CSC042
     C                     MOVE CURR,Q    CCY                                                 CSC042
     C                     Z-ADDCCDP,Q    CDP                                                 CSC042
     C                     Z-ADDCSPT,Q    SPOT                                                CSC042
     C                     MOVE MTDV,Q    MDIN                                                CSC042
     C                     Z-ADDCCNO,Q    CSNO                                                CSC042
     C                     MOVE CIND,Q    A6INCY                                              CSC042
     C                     ELSE                                                               CSC042
     C           *LOCK     IN   LDA
     C                     MOVEL'LER135'  DBPGM
     C**********           MOVEL'SDCURRPD'DBFILE           ************                       CSC042
     C                     MOVEL'CURR,Q  'DBFILE           ************                       CSC042
     C                     Z-ADD002       DBASE            * DBERR 02 *
     C                     MOVELFEFCCY    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
     C                     Z-ADDCDP       DP
     C           DP        ADD  4         P
     C                     MOVEA'0000'    *IN,30
     C                     ADD  30        DP      20
     C                     MOVE '1'       *IN,DP
      *
      ** Zeroize work fields/indicators.
      *
     C                     Z-ADD0         WAGG
     C                     Z-ADD0         WAGG2                           142402
     C                     MOVEA'00'      *IN,60
     C                     MOVE *BLANKS   WSTYPE  3                                         AR699396
      *
      **********************************
      *** FEE ADJUSTMENT PROCESSING: ***
      **********************************
      *
      ** Search for match on fee adjustments file (can only be one
      ** settlement/adjustment on file for a fee)  If found
      ** process according to fee settlement/adjustment type.
      *
     C                     Z-ADD0         ADJTOT 130                                          204444
     C**********           Z-ADD0         FEOAMT                                       243496 245803
     C                     Z-ADD0         FEOAMT                                             243496B
      *                                                                                       204444
     C                     MOVE '0'       *IN15                           BHBPC1
     C*                                                                   BHBPC1
     C           FEEKEY    SETLLLEFEADL1
     C*                                                                   BHBPC1
     C           *IN15     DOWEQ'0'                                       BHBPC1
     C*                                                                   BHBPC1
     C           FEEKEY    READELEFEADL1                 15
      *
     C           *IN15     IFEQ '0'
     C********** FARECI    ANDNE'*'                                                         MD047522
     C           FARECC    ANDNE'*'                                                         MD047522
      *                                                                                     MD053375
     C                     WRITELEFECPD0                                                    MD053375
     C                     MOVE 'ADJ'     WSTYPE                                            AR699396
      *                                                                                     MD026969
      ** Check if record exist in LEFZASPD                                                  MD026969
      *                                                                                     MD026969
     C                     MOVE '1'       *IN77                                             MD026969
     C           FATYPE    IFEQ 'P'                                                         MD026969
     C           FEAMTP    ANDEQ0                                                           MD026969
     C           WKFZAS    ANDEQ'Y'                                                         MD026969
     C           FEFACL    ANDNE0                                                           MD054354
     C           FESYIN    ANDNE'Y'                                                         MD054354
     C           FEAUTO    ANDNE'C'                                                         MD054354
     C********** LEFKEY    CHAINLEFZASPD             77                           MD026969 MD026969A
     C           LEFKEY    CHAINLEFZASL2             77                                    MD026969A
     C           *IN77     IFEQ '0'                                                         MD026969
     C           FZAMTP    IFLT 0                                                           MD026969
     C                     Z-SUBFZAMTP    WKASGN 130                                        MD026969
     C                     ELSE                                                             MD026969
     C                     Z-ADDFZAMTP    WKASGN                                            MD026969
     C                     ENDIF                                                            MD026969
     C           WKASGN    IFEQ FASADJ                                                      MD026969
     C           FZRPRO    ANDEQ' '                                                         MD026969
     C                     MOVE '0'       *IN77                                             MD026969
     C                     ELSE                                                             MD026969
     C                     MOVE '1'       *IN77                                             MD026969
     C                     ENDIF                                                            MD026969
     C                     ENDIF                                                            MD026969
     C                     ENDIF                                                            MD026969
      *
      ** Process according to whether an adjustment (FATYPE = blank)
      ** or settlement (types of settlement are full, partial or
      ** write off).
      *
     C           FATYPE    IFEQ ' '
      *                                                                                       CLE034
     C           FESTAL    IFEQ 'Y'                                                           CLE034
     C                     MOVE 'FEES'    WKTYPE                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                   CLE009
      ** If CLE009 is on and confirmed indicator is yes and fee swift     CLE009
      ** message regeneration indicator is processed and fee adjustment   CLE009
      ** swift message regeneration indicator is amend                    CLE009
      *                                                                                       CLE134
     C                     MOVE FEAUTO    WFEAUT  1                                           CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           WFEAUT    IFEQ 'C'                                                           CLE134
     C           FEAUT2    OREQ 'C'                                                           CLE134
     C                     MOVE 'Y'       WFEAUT                                              CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                   CLE009
     C           CLE009    IFEQ 'Y'                                       CLE009
     C********** FEAUTO    ANDEQ'Y'                                                    CLE009 CLE134
     C           WFEAUT    ANDEQ'Y'                                                           CLE134
     C           FESWRI    ANDEQ'X'                                       CLE009
     C           FASWRI    ANDEQ'A'                                       CLE009
      *                                                                   CLE009
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
     C           PTFI      IFNE *BLANKS                                                       CLE034
     C                     MOVE 'E'       WRKSTM  1                                           CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'S'       WRKSTM                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     Z-ADDBJRDNB    PDAY    50                                          CLE034
     C                     MOVE FELOAN    PLNRF   6                                           CLE034
     C                     MOVE FECNUM    PCNUM   6                                           CLE034
     C                     MOVE FEFACL    PFACL   5                                           CLE034
     C                     MOVE FEFSEQ    PFSEQ   2                                           CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSTALR1'                                                    CLE034
     C                     PARM *BLANKS   PRTCD                                               CLE034
     C                     PARM '*TXDT  ' POPTN                                               CLE034
     C                     PARM           PDAY                                                CLE034
     C                     PARM *ZEROS    PPTYPE                                              CLE034
     C                     PARM           WRKSTM                                              CLE034
     C                     PARM FEFCCY    PTCCY   3                                           CLE034
     C                     PARM 'N'       PNCHK   1                                           CLE034
     C                     PARM 'FEES'    PTYPE   4                                           CLE034
     C                     PARM           PLNRF                                               CLE034
     C                     PARM *BLANKS   PLAVD   5                                           CLE034
     C                     PARM *BLANKS   PLASQ   3                                           CLE034
     C                     PARM           PCNUM                                               CLE034
     C                     PARM           PFACL                                               CLE034
     C                     PARM           PFSEQ                                               CLE034
     C                     PARM *ZEROS    PTNOTD  50                                          CLE034
     C                     PARM *BLANKS   PNOSTR  1                                           CLE034
      *                                                                                       CLE034
     C                     Z-ADDPTNOTD    TXDT                                                CLE034
     C                     ELSE                                                               CLE034
     C                     EXSR SRTXDT                                    CLE009
     C                     ENDIF                                                              CLE034
      *                                                                   CLE009
      ** If the next payment date is before or the same as the telex      CLE009
      ** notice date or the period end date is before or the same as      CLE009
      ** the telex notice date                                            CLE009
      *                                                                   CLE009
     C           FENPYD    IFLE TXDT                                      CLE009
     C           FEPEND    ORLE TXDT                                      CLE009
      *                                                                   CLE009
     C           FESTTL    IFEQ 08                                        CLE009
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C                     EXSR SR34A                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'Y'       WKFLD   1                                           CLE034
     C                     MOVE '*EOF   ' PRTCDE                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           WKFLD     DOWEQ'Y'                                                           CLE034
     C           PRTCDE    OREQ *BLANKS                                                       CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C                     EXSR SR34B                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     CALL 'AOCUSTR0'                                CLE009
     C                     PARM 'MSG    ' WRTCD                           CLE009
     C                     PARM '*KEY   ' WOPTN                           CLE009
     C                     PARM A7CUST    KEYC                            CLE009
     C                     PARM           KEYSTS  7                       CLE009
     C           SDCUST    PARM SDCUST    DSSDY                           CLE009
      *                                                                   CLE009
     C           WRTCD     IFNE *BLANKS                                   CLE009
     C           *LOCK     IN   LDA                                       CLE009
     C                     MOVEL'LER135'  DBPGM                           CLE009
     C                     MOVELCNUM      DBKEY            ************   CLE009
     C                     MOVEL'SDCUSTPD'DBFILE           * DBERR 33 *   CLE009
     C                     Z-ADD033       DBASE            ************   CLE009
     C                     OUT  LDA                                       CLE009
     C                     EXSR *PSSR                                     CLE009
      *                                                                   CLE009
     C                     ELSE                                           CLE009
      *                                                                   CLE009
     C           BBGSFM    IFEQ 'Y'                                       CLE009
     C                     MOVE 'R'       RTTYPE  1                       CLE009
     C                     EXSR RTLX2                                     CLE009
     C                     MOVE 'Y'       RTADJ   1                       CLE009
     C                     Z-ADDFASADJ    RTAMT  130                      CLE009
     C                     MOVE FASIGN    RTSIGN  1                       CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C                     EXSR SR34C                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE *BLANKS   WKFLD                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDDO                                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C                     EXSR SR34E                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE008
     C                     ENDIF                                          CLE009
      *
      ** If fee adjustment sign '+' add adjustment amount to fee
      ** adjustment amount on file, and set up event amount field
      ** with the adjustment amound.  If sign is negative do opposite.
      *
     C           FASIGN    IFEQ '+'                                                           204444
     C           FASIGN    OREQ ' '                                                           204444
     C                     ADD  FASADJ    ADJTOT                                              204444
     C                     ELSE                                                               204444
     C                     SUB  FASADJ    ADJTOT                                              204444
     C                     END                                                                204444
      *                                                                                       204444
     C           FASIGN    IFEQ '+'
     C           FASIGN    OREQ ' '                                       E45504
     C                     ADD  FASADJ    FEAMTA
     C                     Z-ADDFASADJ    LKEAMT
     C                     ELSE
     C                     SUB  FASADJ    FEAMTA
     C                     Z-SUBFASADJ    LKEAMT
     C                     END
      *                                                                   CLE005
      ** If fee adjustment sign '+' add Adjustment Amount to Fee          CLE005
      ** Accrued Posted to Date , otherwise, subtruct Adjustment          CLE005
      ** Amount from the Fee Accured Posted to Date.                      CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C           FASIGN    IFEQ '+'                                       CLE005
     C           FASIGN    OREQ ' '                                       CLE005
     C                     ADD  FASADJ    FELPAM                          CLE005
     C                     ELSE                                           CLE005
     C                     SUB  FASADJ    FELPAM                          CLE005
     C                     END                                            CLE005
     C                     END                                            CLE005
      *
      ** Not a reversal
      *
     C                     Z-ADD0         LKREVI
      *
      ** Generate account key for the adjustment event.
      *
     C                     EXSR GENKEY
      *
     C                     ADD  LKEAMT    WAGG
      *
     C                     END
      *
      *
      ** If total fee or part of the fee is being written off
      ** then this amount must be 'reversed'.  Set up event amount
      ** and reversal indicator on account keys file.
      *
     C                     MOVE *BLANKS   WATYPE  1                                           CLE134
     C           FATYPE    IFEQ 'W'
     C                     MOVE 'W'       WATYPE                                              CLE134
      *                                                                                       CLE034
     C           FASTAL    IFEQ 'Y'                                                           CLE034
     C                     MOVE 'FSET'    WKTYPE                                              CLE034
     C                     ENDIF                                                              CLE034
     C                     MOVE ' '       FEDIND
      *                                                                                       CLE134
      ** IF CLE134 is ON and Fee is suspended (Flag FEFSFA is Y and                           CLE134
      ** suspended amount FESFA is not zero), then subtract Fee                               CLE134
      ** Write-off from Fee Suspended amount instead of Fee past due.                         CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FESFA     ANDNE0                                                             CLE134
     C           FASADJ    IFLE FESFA                                                         CLE134
     C           FESFA     SUB  FASADJ    FESFA                                               CLE134
     C                     ELSE                                                               CLE134
     C                     Z-ADD0         FESFA                                               CLE134
     C                     ENDIF                                                              CLE134
     C                     ELSE                                                               CLE134
     C                     Z-ADDFEAMTP    FEPAMP                          100515
     C                     SUB  FASADJ    FEAMTP
     C                     SUB  FASADJ    FEAMTO
     C**********           ADD  FASADJ    FEWOFF                          141453              204452
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C           FECALT    IFEQ '99'                                                        AR734175
     C                     ADD  FASADJ    FEWOFF                                            AR734175
     C                     ELSE                                                             AR734175
     C                     ADD  FASADJ    FEAMTW                                              204452
     C                     ENDIF                                                            AR734175
     C                     Z-ADDFASADJ    LKEAMT
     C                     Z-ADD1         LKREVI
      *                                                                   CLE005
      ** If CLE005 is on, set Manual Settlement Flag to 'Y'.              CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C                     MOVE 'Y'       MSFLAG  1                       CLE005
     C                     ENDIF                                          CLE005
      *
      ** Generate account key for write off event.
      *
     C                     EXSR GENKEY
      *
     C                     SUB  LKEAMT    WAGG
      *
      ** If fee period end date is LE start of next month minus one
      ** (i.e., last day of this month) and there is no fee amount
      ** past due this record can be matured.
      *
     C           FEPEND    IFLE CODT
     C           FEAMTP    ANDEQ0
     C           WPDCLL    ANDNE'Y'                                                           CLE134
     C           FEAUTO    ANDNE'C'                                                         AR318650
      *                                                                                     AR318650
      ** If Fee has Auto-settle = 'C' and End date less than run date                       AR318650
      ** and Last change date equal run date the fee cannot mature                          AR318650
      *                                                                                     AR318650
     C           FEAUTO    OREQ 'C'                                                         AR318650
     C           FEPEND    ANDLTBJRDNB                                                      AR318650
     C           FELCHD    ANDNEBJRDNB                                                      AR318650
     C           FEAMTP    ANDEQ0                                                           AR318650
     C           WPDCLL    ANDNE'Y'                                                         AR318650
     C                     MOVE 'M'       FERECI
     C********** FEAUTO    IFEQ 'C'                                               AR1078443 MD020212
     C**********           MOVE 'D'       FERECI                                  AR1078443 MD020212
     C**********           ENDIF                                                  AR1078443 MD020212
     C                     END
      *
      ** Fee due date is reset to zero.
      *
     C           FEAMTP    IFEQ 0                                         101843
     C                     Z-ADD0         FEDDAT
     C                     END                                            101843
      *
     C                     END
      *
      ** Partially settled:
      *
     C           FATYPE    IFEQ 'P'
     C           *IN77     ANDEQ'1'                                                         MD026969
     C                     MOVE 'P'       WATYPE                                              CLE134
      *                                                                                       CLE034
     C           FASTAL    IFEQ 'Y'                                                           CLE034
     C                     MOVE 'FSET'    WKTYPE                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                   CLE007
     C           CLE007    IFEQ 'Y'                                       CLE007
     C           FAVDAT    ANDEQBJRDNB                                    CLE007
     C           PTFI      ANDNE'I'                                       CLE007
      *                                                                   155672
      ** Generate record to LEPXTAB only if settlement type is 08         155672
      *                                                                   155672
     C***********FESTTL    IFEQ 08                                                     155672 CLE034
     C***********FEOURS    ANDNE*BLANKS                                                155672 CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FASTAL    ANDEQ'Y'                                                           CLE034
     C                     EXSR SR34A                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'Y'       WKFLD                                               CLE034
     C                     MOVE '*EOF   ' PRTCDE                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           WKFLD     DOWEQ'Y'                                                           CLE034
     C           PRTCDE    OREQ *BLANKS                                                       CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FASTAL    ANDEQ'Y'                                                           CLE034
     C                     EXSR SR34B                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           FAMETH    IFEQ 08                                                            CLE034
     C           FAOURS    ANDNE*BLANKS                                                       CLE034
     C***********          MOVELFEOURS    WKEYE                                        155672 CLE034
     C***********          MOVE FEFCCY    WKEYB                                        155672 CLE034
     C                     MOVELFAOURS    WKEYE                                               CLE034
     C                     MOVE FAFCCY    WKEYB                                               CLE034
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           PTFI      IFEQ *BLANKS                                                       CLE031
     C           FASCCY    ANDNE*BLANKS                                                       CLE034
     C***********FESCCY    ANDNE*BLANKS                                                 CLE031CLE034
     C***********          MOVE FESCCY    WKEYB                                         CLE031CLE034
     C                     MOVE FASCCY    WKEYB                                               CLE034
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           PTFI      IFNE *BLANKS                                                       CLE031
     C           FAPSCY    ANDNE*BLANKS                                                       CLE034
     C***********FEPSCY    ANDNE*BLANKS                                                 CLE031CLE034
     C***********          MOVE FEPSCY    WKEYB                                         CLE031CLE034
     C                     MOVE FAPSCY    WKEYB                                               CLE034
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                   155672
     C                     CALL 'AONOSTR0'PNOST                           155672
      *                                                                   155672
     C           WRTCD     IFNE *BLANKS                                   155672
     C           *LOCK     IN   LDA                                       155672
     C                     MOVELWKEYB     DBKEY                           155672
     C                     MOVE WKEYE     DBKEY                           155672
     C                     MOVEL'SDNOSTPD'DBFILE           ************   155672
     C                     Z-ADD025       DBASE            * DBERR 25 *   155672
     C                     OUT  LDA                        ************   155672
     C                     EXSR *PSSR                                     155672
      *                                                                   155672
     C                     ENDIF                                          155672
      *                                                                   155672
     C                     MOVELA7CUST    WCKEY                           155672
     C                     MOVEL'*CNUM'   WKYSTS                          155672
      *                                                                   155672
     C                     CALL 'AOCUSTR0'PCUST                           155672
     C           WRTCD     IFNE *BLANKS                                   155672
     C           *LOCK     IN   LDA                                       155672
     C                     MOVELWCKEY     DBKEY                           155672
     C                     MOVEL'SDCUSTPD'DBFILE           ************   155672
     C                     Z-ADD026       DBASE            * DBERR 26 *   155672
     C                     OUT  LDA                        ************   155672
     C                     EXSR *PSSR                                     155672
     C                     ENDIF                                          155672
      *                                                                   155672
     C           BBGSFM    IFEQ 'Y'                                       155672
     C                     EXSR RTLX                                      CLE007
     C                     ENDIF                                          155672
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FASTAL    ANDEQ'Y'                                                           CLE034
     C                     EXSR SR34C                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE *BLANKS   WKFLD                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDDO                                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FASTAL    ANDEQ'Y'                                                           CLE034
     C                     EXSR SR34E                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                   155672
     C***********          ENDIF                                          155672              CLE034
      *                                                                   155672
     C                     ENDIF                                          CLE007
      *
      ** Update fee amount past due, fee amount settled and fee
      ** amount outstanding fields on LEFEED with the settlement
      ** amount.
      *
      ** IF CLE134 is ON and Fee is suspended (Flag FEFSFA is Y and                           CLE134
      ** suspended amount FESFA is not zero), then subtract Fee payment                       CLE134
      ** from Fee Suspended amount instead of Fee past due.                                   CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FESFA     ANDNE0                                                             CLE134
     C           FASADJ    IFLE FESFA                                                         CLE134
     C           FESFA     SUB  FASADJ    FESFA                                               CLE134
     C                     ELSE                                                               CLE134
     C                     Z-ADD0         FESFA                                               CLE134
     C                     ENDIF                                                              CLE134
     C                     ADD  FASADJ    FEAMTS                                              CLE134
     C                     ELSE                                                               CLE134
     C                     Z-ADDFEAMTP    FEPAMP                          100515
     C                     SUB  FASADJ    FEAMTP
     C                     ADD  FASADJ    FEAMTS
     C                     SUB  FASADJ    FEAMTO
     C                     ENDIF                                                              CLE134
      *
      ** Run date becomes fee settled date and fee settled amount
      ** becomes event amount of account keys file
      *
     C                     Z-ADDBJRDNB    FESDAT
     C                     Z-ADDFASADJ    LKEAMT
      *
      ** Not a reversal
      *
     C                     Z-ADD0         LKREVI
     C                     MOVE '1'       *IN61
      *                                                                   CLE005
      ** If CLE005 is on, set Manual Settlement Flag to 'Y'.              CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C                     MOVE 'Y'       MSFLAG  1                       CLE005
     C                     ENDIF                                          CLE005
      *
      ** Generate account key for partially settled fee.
      *
     C                     EXSR GENKEY
     C                     MOVE '0'       *IN61
      *
     C                     END
      *                                                                                     MD026969
      ** New fee settlement processing                                                      MD026969
      *                                                                                     MD026969
     C           FATYPE    IFEQ 'P'                                                         MD026969
     C           *IN77     ANDEQ'0'                                                         MD026969
      *                                                                                     MD026969
      ** Update fee amount settled on LEFEED with the settlement                            MD026969
      ** amount. Settlement date will remain the same (as at                                MD026969
      ** previous date)                                                                     MD026969
      *                                                                                     MD026969
     C           FASIGN    IFEQ '+'                                                         MD026969
     C           FASIGN    OREQ ' '                                                         MD026969
     C**********           ADD  FASADJ    FEAMTS                                  MD026969 MD026969A
     C                     Z-ADDFASADJ    LKEAMT                                            MD026969
     C                     ELSE                                                             MD026969
     C**********           SUB  FASADJ    FEAMTS                                  MD026969 MD026969A
     C                     Z-SUBFASADJ    LKEAMT                                            MD026969
     C                     ENDIF                                                            MD026969
     C                     Z-ADDFASADJ    WKSADJ 130                                       MD026969A
     C                     MOVE FASIGN    WKSIGN  1                                        MD026969A
     C                     MOVE 'Y'       WKADJY  1                                        MD026969A
      *                                                                                     MD026969
     C                     Z-ADDFZSDAT    FESDAT                                            MD026969
      *                                                                                     MD026969
      ** Not a reversal                                                                     MD026969
      *                                                                                     MD026969
     C                     Z-ADD0         LKREVI                                            MD026969
     C                     MOVE '1'       *IN61                                             MD026969
      *                                                                                     MD026969
      ** If CLE005 is on, set Manual Settlement Flag to 'Y'.                                MD026969
      *                                                                                     MD026969
     C           CLE005    IFEQ 'Y'                                                         MD026969
     C                     MOVE 'Y'       MSFLAG  1                                         MD026969
     C                     ENDIF                                                            MD026969
      *                                                                                     MD026969
      ** Generate account key for partially settled fee.                                    MD026969
      *                                                                                     MD026969
     C                     EXSR GENKEY                                                      MD026969
     C                     MOVE '0'       *IN61                                             MD026969
      *                                                                                     MD026969
      ** Update LEFZASPD.FZRPRO                                                             MD026969
      *                                                                                     MD026969
     C                     MOVE 'Y'       FZRPRO                                            MD026969
     C**********           UPDATLEFZASD0                                          MD026969 MD026969A
     C                     UPDATLEFZAS2                                                    MD026969A
      *                                                                                     MD026969
     C                     ENDIF                                                            MD026969
      *
      ** Fully settled amount (seton indicator 60)
      ** N.B. do processing after fee accruals.
      *
     C           FATYPE    IFEQ 'F'
     C                     MOVE 'F'       WATYPE                                              CLE134
      *                                                                                       CLE034
     C           FASTAL    IFEQ 'Y'                                                           CLE034
     C                     MOVE 'FSET'    WKTYPE                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                   141453
     C                     Z-ADDFASADJ    WFASAD 130                                          204866
      *                                                                                       CLE134
      ** IF CLE134 is ON and Fee is suspended (Flag FEFSFA is Y and                           CLE134
      ** suspended amount FESFA is not zero), then subtract Fee Payment                       CLE134
      ** from Fee Suspended amount instead of Fee past due.                                   CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FESFA     ANDNE0                                                             CLE134
     C           FESFA     SUB  FASADJ    @WRK1                                               CLE134
     C                     ADD  @WRK1     FEAMTW                                              CLE134
     C                     ADD  FASADJ    FEAMTS                                              CLE134
     C                     ELSE                                                               CLE134
      *                                                                                       CLE134
     C           FASADJ    IFGT FEAMTP                                    141453
     C           FASADJ    ORLT FEAMTP                                    141453
      *                                                                   141453
     C           FEAMTP    SUB  FASADJ    @WRK1  130                      141453
     C**********           ADD  @WRK1     FEWOFF                          141453              204452
     C                     ADD  @WRK1     FEAMTW                                              204452
      *                                                                   141453
     C                     ENDIF                                          141453
      *                                                                   141453
     C                     Z-ADDFEAMTP    FEPAMP                                              204467
     C                     Z-ADDFEAMTP    FEFULL 130                                        AR810483
     C                     Z-ADD0         FEAMTP                                              204467
     C                     ADD  FASADJ    FEAMTS                                              204467
     C                     SUB  FASADJ    FEAMTO                                              204467
     C                     ENDIF                                                              CLE134
      *                                                                                       204467
     C                     MOVE '1'       *IN60
      *                                                                   CLE007
     C           CLE007    IFEQ 'Y'                                       CLE007
     C           FAVDAT    ANDEQBJRDNB                                    CLE007
     C           PTFI      ANDNE'I'                                       CLE007
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FASTAL    ANDEQ'Y'                                                           CLE034
     C                     EXSR SR34A                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'Y'       WKFLD                                               CLE034
     C                     MOVE '*EOF   ' PRTCDE                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           WKFLD     DOWEQ'Y'                                                           CLE034
     C           PRTCDE    OREQ *BLANKS                                                       CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FASTAL    ANDEQ'Y'                                                           CLE034
     C                     EXSR SR34B                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                   155672
      ** Generate record to LEPXTAB only if settlement type is 08         155672
      *                                                                   155672
     C***********FESTTL    IFEQ 08                                                     155672 CLE034
     C***********FEOURS    ANDNE*BLANKS                                                155672 CLE034
     C***********          MOVELFEOURS    WKEYE                                        155672 CLE034
     C***********          MOVE FEFCCY    WKEYB                                        155672 CLE034
     C           FAMETH    IFEQ 08                                                            CLE034
     C           FAOURS    ANDNE*BLANKS                                                       CLE034
     C                     MOVELFAOURS    WKEYE                                               CLE034
     C                     MOVE FAFCCY    WKEYB                                               CLE034
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           PTFI      IFEQ *BLANKS                                                       CLE031
     C           FASCCY    ANDNE*BLANKS                                                       CLE034
     C***********FESCCY    ANDNE*BLANKS                                                 CLE031CLE034
     C***********          MOVE FESCCY    WKEYB                                         CLE031CLE034
     C                     MOVE FASCCY    WKEYB                                               CLE034
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           PTFI      IFNE *BLANKS                                                       CLE031
     C           FAPSCY    ANDNE*BLANKS                                                       CLE034
     C***********FEPSCY    ANDNE*BLANKS                                                 CLE031CLE034
     C***********          MOVE FEPSCY    WKEYB                                         CLE031CLE034
     C                     MOVE FAPSCY    WKEYB                                               CLE034
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                   155672
     C                     CALL 'AONOSTR0'PNOST                           155672
      *                                                                   155672
     C           WRTCD     IFNE *BLANKS                                   155672
     C           *LOCK     IN   LDA                                       155672
     C                     MOVELWKEYB     DBKEY                           155672
     C                     MOVE WKEYE     DBKEY                           155672
     C                     MOVEL'SDNOSTPD'DBFILE           ************   155672
     C                     Z-ADD027       DBASE            * DBERR 27 *   155672
     C                     OUT  LDA                        ************   155672
     C                     EXSR *PSSR                                     155672
      *                                                                   155672
     C                     ENDIF                                          155672
      *                                                                   155672
     C                     MOVELA7CUST    WCKEY                           155672
     C                     MOVEL'*CNUM'   WKYSTS                          155672
      *                                                                   155672
     C                     CALL 'AOCUSTR0'PCUST                           155672
     C           WRTCD     IFNE *BLANKS                                   155672
     C           *LOCK     IN   LDA                                       155672
     C                     MOVELWCKEY     DBKEY                           155672
     C                     MOVEL'SDNOSTPD'DBFILE           ************   155672
     C                     Z-ADD028       DBASE            * DBERR 28 *   155672
     C                     OUT  LDA                        ************   155672
     C                     EXSR *PSSR                                     155672
     C                     ENDIF                                          155672
      *                                                                   155672
     C           BBGSFM    IFEQ 'Y'                                       155672
     C                     EXSR RTLX                                      CLE007
     C                     ENDIF                                          155672
      *                                                                   155672
     C                     ENDIF                                          155672
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FASTAL    ANDEQ'Y'                                                           CLE034
     C                     EXSR SR34C                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE *BLANKS   WKFLD                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDDO                                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FASTAL    ANDEQ'Y'                                                           CLE034
     C                     EXSR SR34E                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                   155672
     C                     ENDIF                                          CLE007
      *                                                                   CLE007
     C                     END
      *
     C                     END
      *                                                                   BHBPC1
     C                     END                                            BHBPC1
      *                                                                                       CLE034
     C                     MOVE *BLANKS   WSTYPE                                            AR699396
      *                                                                                     AR699396
     C           FESTAL    IFEQ 'Y'                                                           CLE034
     C                     MOVE 'FEES'    WKTYPE                                              CLE034
     C                     ENDIF                                                              CLE034
     C*                                                                   E45504
     C****************************************                            E45504
     C***  Automatic settlement processing ***                            E45504
     C****************************************                            E45504
     C*                                                                   E45504
     C***  This section is to cover normal case fees, where they've       E45504
     C***  been entered before the day before the due date, and also      E45504
     C***  those entered on the day before due date and due date is not   E45504
     C***  a non-working day. It also covers fees switched to             E45504
     C***  auto-settle after they've gone past due.                       E45504
     C*                                                                   E45504
     C                     MOVE 'N'       FREQ    1                                           196612
      *                                                                                       196612
      ** Loop to check all the payment periods to be processed                                196612
      *                                                                                       196612
     C           FREQ      DOWEQ'N'                                                           196612
      *                                                                                       CLE134
     C                     MOVE FEAUTO    WFEAUT                                              CLE134
      *                                                                                       CLE134
      ** Set date for grace days check                                                        CLE134
      *                                                                                       CLE134
     C                     Z-ADDFELPDT    WNWDAT  50                                          CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           WFEAUT    IFEQ 'C'                                                           CLE134
     C           FEAUT2    OREQ 'C'                                                           CLE134
     C                     MOVE 'Y'       WFEAUT                                              CLE134
      *                                                                                       CLE134
      ** Grace days                                                                           CLE134
      *                                                                                       CLE134
     C           AUGDPR    IFNE 0                                                             CLE134
     C           FELPDT    ADD  AUGDPR    WNWDAT                                              CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       196612
      ** Consider payment taken day indicator on fee settlement                             MD052216
      ** if due date falls on a holiday                                                     MD052216
      *                                                                                     MD052216
     C           FEAMTP    IFNE *ZEROS                                                      MD052216
     C           WFEAUT    ANDEQ'Y'                                                         MD052216
     C                     EXSR CHKPAY                                                      MD052216
     C                     Z-ADDWNPAYD    WNWDAT                                            MD052216
     C                     ENDIF                                                            MD052216
      *                                                                                     MD052216
     C           FEAMTP    IFNE 0                                         E45504
     C********** FEAUTO    ANDEQ'Y'                                                    E45504 CLE134
     C           WFEAUT    ANDEQ'Y'                                                           CLE134
     C********** FELPDT    ANDLECODT                                                   155912 CLE134
     C********** FELPDT    ANDLEFEPEND                                                 153672 CLE134
     C           WNWDAT    ANDLECODT                                                          CLE134
     C           WNWDAT    ANDLEFEPEND                                                        CLE134
     C           FENPYD    ANDEQ0                                         153672
     C           FEAMTP    ORNE 0                                         153672
     C********** FEAUTO    ANDEQ'Y'                                                    153672 CLE134
     C           WFEAUT    ANDEQ'Y'                                                           CLE134
     C********** FELPDT    ANDLECODT                                                   155912 CLE134
     C********** FELPDT    ANDLEFENPYD                                                 153672 CLE134
     C           WNWDAT    ANDLECODT                                                          CLE134
     C           WNWDAT    ANDLEFENPYD                                                        CLE134
     C           FENPYD    ANDNE0                                         153672
     C           FEAMTP    ORNE *ZEROS                                                      MD052216
     C           WFEAUT    ANDEQ'Y'                                                         MD052216
     C           WNWDAT    ANDLECODT                                                        MD052216
     C           FELPDT    ANDEQFEPEND                                                      MD052216
      *                                                                                     AR823503
      ** Save the value of FELPAM                                                           AR823503
      *                                                                                     AR823503
     C                     Z-ADDFELPAM    WFLPAM 130                                        AR823503
      *                                                                                     MD052216
      ** Set work variable Payment Today Indicator to Y                                     MD052216
      *                                                                                     MD052216
     C                     MOVEL'Y'       WPAYTD                                            MD052216
      *                                                                                       CLE134
      ** If suspended fee, then generate an additional a/c key to pay                         CLE134
      ** the suspended amount                                                                 CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FESUSP    ANDNE0                                                             CLE134
     C                     Z-ADDFESUSP    LKEAMT                                              CLE134
     C                     Z-ADD0         FESUSP                                              CLE134
     C                     Z-ADD0         LKREVI                                              CLE134
     C                     MOVE '1'       *IN61                                               CLE134
     C                     MOVE 'S'       WATYPE                                              CLE134
     C                     EXSR GENKEY                                                        CLE134
     C                     MOVE *BLANKS   WATYPE                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     Z-ADDFEAMTP    LKEAMT                          E45504
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FECALT    ANDEQ'99'                                                          CLE134
     C           FESUSP    ANDEQ0                                                             CLE134
     C           FEFAMT    ANDNE0                                                             CLE134
     C                     Z-ADDFEFAMT    LKEAMT                                              CLE134
     C                     ENDIF                                                              CLE134
     C                     Z-ADD0         LKREVI                          E45504
     C                     MOVE '1'       *IN61                           E45504
     C                     EXSR GENKEY                                    E45504
     C                     MOVE '0'       *IN61                           E45504
      *                                                                                     AR823503
      ** Restore the value of FELPAM if no fee settlement on rundate                        AR823503
      ** or back-value next payment date.                                                   AR823503
      *                                                                                     AR823503
     C           WFACLF    IFEQ 'N'                                                         AR823503
     C           FEAUTO    ANDNE'N'                                                         AR823503
      *                                                                                     AR823503
     C           FELPDT    IFLE FENPYD                                                      AR823503
     C           FELPDT    ANDLTBJRDNB                                                      AR823503
     C           FENPYD    ANDNE0                                                           AR823503
      *                                                                                     AR823503
     C                     Z-ADDWFLPAM    FELPAM                                            AR823503
      *                                                                                     AR823503
     C                     ENDIF                                                            AR823503
     C                     ENDIF                                                            AR823503
     C*                                                                   E45504
     C***  If fee period end date on or before control date mature        E45504
     C***  this fee record.                                               E45504
     C*                                                                   E45504
     C           FEPEND    IFLE CODT                                      E45504
     C           WPDCLL    ANDNE'Y'                                                           CLE134
     C           FEAUTO    ANDNE'C'                                                         AR318650
      *                                                                                     AR318650
      ** If Fee has Auto-settle = 'C' and End date less than run date                       AR318650
      ** and Last change date equal run date the fee cannot mature                          AR318650
      *                                                                                     AR318650
     C           FEAUTO    OREQ 'C'                                                         AR318650
     C           FEPEND    ANDLTBJRDNB                                                      AR318650
     C           FELCHD    ANDNEBJRDNB                                                      AR318650
     C           WPDCLL    ANDNE'Y'                                                         AR318650
     C                     MOVE 'M'       FERECI                          E45504
     C********** FEAUTO    IFEQ 'C'                                               AR1078443 MD020212
     C**********           MOVE 'D'       FERECI                                  AR1078443 MD020212
     C**********           ENDIF                                                  AR1078443 MD020212
     C                     END                                            E45504
      *                                                                   CLE005
      **  If CLE005 is on, add adjustment amount to Total Fee             CLE005
      **  Adjustment amount.                                              CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C**********           ADD  FEAMTA    FETADJ                                       CLE005 227253
     C**********           ADD  FEAMTW    FEWOFF                                       204452 227253
     C**********           Z-ADD0         FEAMTA                                       204452 227253
     C**********           Z-ADD0         FEAMTW                                       204452 258597
     C                     ENDIF                                          CLE005
     C*                                                                   E45504
     C***  Reset fee amounts/dates                                        E45504
     C*                                                                   E45504
     C                     ADD  FEAMTP    FEAMTS                          E45504
     C                     Z-ADDFEAMTP    FEPAMS                          100515
     C***********          Z-ADDCODT      FESDAT                   E45504 155912
     C                     Z-ADDFELPDT    FESDAT                          155912
     C                     Z-ADDFEAMTP    FEPAMP                          100515
     C**********           Z-ADD0         FEAMTA                          E45504              204452
     C                     Z-ADD0         FEAMTP                          E45504
     C                     Z-ADD0         FEAMTO                          E45504
     C***********          MOVE ' '       FEDIND                   E45504 056073
     C***********          MOVE 'B'       FEDIND                   056073 100428
     C                     MOVE ' '       FEDIND                          100428
     C                     Z-ADD0         FEDDAT                          E45504
      *                                                                                     MD053375
     C                     WRITELEFECPD0                                                    MD053375
      *                                                                                     MD053375
     C                     END                                            E45504
      *                                                                   155912
     C           FELPDT    IFGT CODT                                      155912
     C           FEAMTP    SUB  FEPAMP    FEADBP                          155912
     C                     ENDIF                                          155912
     C*                                                                   101859
     C** Make sure that the report fields are updated even if past        101859
     C** due amount is zero.                                              101859
     C*                                                                   101859
     C                     MOVE FEAUTO    WFEAUT                                              CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           WFEAUT    IFEQ 'C'                                                           CLE134
     C           FEAUT2    OREQ 'C'                                                           CLE134
     C                     MOVE 'Y'       WFEAUT                                              CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C           FEAMTP    IFEQ 0                                         101859
     C********** FEAUTO    ANDEQ'Y'                                                    101859 CLE134
     C           WFEAUT    ANDEQ'Y'                                                           CLE134
     C           FEDDAT    ANDNE0                                         101859
     C                     Z-ADD0         FEPAMP                          101859
     C                     Z-ADD0         FEPAMS                          101859
     C                     Z-ADD0         FEDDAT                          101859
     C                     END                                            101859
      *
      ****************************************
      *** FEE ACCRUALS/PAYMENT PROCESSING: ***
      ****************************************
      *
      ** If there is an amount past due set up fee due indicator.
      *
     C           FEAMTP    IFNE 0
     C                     MOVE 'A'       FEDIND
     C                     ELSE
     C                     MOVE ' '       FEDIND
     C                     END
      *
      ** If fee period start date is LE than control date and fee
      ** period end has not been reached.
      *
     C           FEPSTD    IFLE CODT
     C           FEPEND    ANDGEBJRDNB
     C           FEPSTD    ORLE CODT                                      BH3491
     C           FEPEND    ANDLTBJRDNB                                    BH3491
     C********** FEPEND    ANDNEFELPDT                                                 BH3491 248440
      *
      ** If fee period end date is different from last payment date
      ** and next payment date or fee period end date is less than or
      ** equal to next working day calculate amount of accrual since
      ** last payment.  Initialise bill/telex indicators for use
      ** in LE0490.
      *
     C           FEPEND    IFNE FELPDT
     C           FEPEND    ORGE FELPDT                                                        248440
     C           FEPEND    ANDLEBJRDNB                                                        248440
     C           FEPEND    ANDNEFELADT                                                        248440
      *
     C********** FELPDT    IFEQ BJRDNB                                                      AR911591
     C           FELPDT    IFLE BJRDNB                                                      AR911591
     C                     MOVE *BLANK    FEPPTI
     C                     MOVE *BLANK    FEPBTI
     C                     END
      *
      ***If*next*payment*date*or*fee*period*end*date*is*less*than******                       209380
      ***or*equal*to*date*of*next*working*date*then*calculate*final****                       209380
      ***correct*accrual*figure*between*a*specific*period.**Up*until***                       209380
      ***this*date*the*program*accrues*on*a*daily*basis.***************                       209380
      **
      *****************************************************************                209380 258414
      ***If*next*payment*date*or*fee*period*end*date*is*less*than*next*                209380 258414
      ***working*date,*then*calculate*final*correct*accrual*figure*****                209380 258414
      ***between*specific*period.**************************************                209380 258414
      *****************************************************************                209380 258414
      ***If*next*payment*date*or*fee*period*end*date*is*equal*to*next**                209380 258414
      ***working*date,*check*if*there*is*a*holiday*between*control*date                209380 258414
      ***and*next*working*date.**Calculate*the*final*accrual*figure****                209380 258414
      ***only*when*control*date*is*1*day*before*next*working*date*and**                209380 258414
      ***BKANWD*is*not*2*(in*arrears).*********************************                209380 258414
      ***Otherwise,*normal*daily*accrual*will*be*generated.************                209380 258414
      *****************************************************************                209380 258414
     C********** CODT      ADD  1         OMCODT  50                                   209380 258414
     C********** FENPYD    IFLE BJDNWD                                                        209380
     C********** FENPYD    IFLT BJDNWD                                                 209380 258414
     C********** FENPYD    ANDNE0                                                             258414
     C********** FENPYD    OREQ BJDNWD                                                 209380 258414
     C********** OMCODT    ANDEQBJDNWD                                                 209380 258414
     C********** FENPYD    ANDNE0                                                      209380 258414
     C********** FENPYD    OREQ BJDNWD                                                 209380 258414
     C********** FENPYD    ANDNE0                                                      209380 258414
     C********** BKANWD    ANDEQ'2'                                                    209380 258414
     C********** FEPEND    ORLE BJDNWD                                                        209380
     C********** FEPEND    ORLT BJDNWD                                                 209380 258414
     C********** FEPEND    OREQ BJDNWD                                                 209380 258414
     C********** OMCODT    ANDEQBJDNWD                                                 209380 258414
     C********** FEPEND    OREQ BJDNWD                                                 209380 258414
     C********** BKANWD    ANDEQ'2'                                                    209380 258414
      *                                                                                       258414
      ** If next payment date or fee period end date is less than                             258414
      ** or equal to date of next working date then calculate final                           258414
      ** correct accrual figure between a specific period.  Up until                          258414
      ** this date the program accrues on a daily basis.                                      258414
      *                                                                                       258414
     C           FENPYD    IFLE BJDNWD                                                        258414
     C           FENPYD    ANDNE0                                                             258414
     C           FEPEND    ORLE BJDNWD                                                        258414
      *****************************************************************                209380 258414
     C/COPY WNCPYSRC,LER135C002
     C*                                                                   100428
     C                     Z-ADDFENPYD    @NPYD   50                      100428
     C***********                                                  BH3491 103122
     C*****If*accrual*profit*date*before*next*working*day*and*on*orBH3491 103122
     C*****before*Next*Payment*Date,*do*accrual*profit*date*postingBH3491 103122
     C***********                                                  BH3491 103122
     C***********BKAPDT    IFLT BJDNWD                             BH3491 103122
     C***********BKAPDT    ANDLEFENPYD                             BH3491 103122
     C***********BKAPDT    ORLT BJDNWD                             100525 103122
     C***********BKAPDT    ANDLEFEPEND                             100525 103122
     C*                                                                   BH3491
     C           FEPEND    IFGE BJRDNB                                                        243717
     C           CALT      IFGE 4                                         BH3491
     C           CALT      ANDLE6                                         BH3491
     C           CALT      ORGE 14                                        BH3491
     C           CALT      ANDLE16                                        BH3491
     C           CALT      OREQ 22                                        BH3491
     C/COPY WNCPYSRC,LEH00672
     C           WFACLF    OREQ 'N'                                                           CLE073
     C                     MOVE ' '       ATYP                            BH3491
     C                     MOVE 'Y'       @CHKD   1                       102005
     C                     EXSR AMTACC                                    BH3491
     C                     MOVE ' '       @CHKD                           102005
     C*                                                                   BH3491
     C***  Don't do start date if last day accruals                       BH3491
     C*                                                                   BH3491
     C           BKALDI    IFEQ 'Y'                                       BH3491
     C           FEPSTD    ANDLTCODT                                      BH3491
     C           BKALDI    ORNE 'Y'                                       BH3491
     C                     EXSR UPDFEE                                    BH3491
     C                     END                                            BH3491
     C                     END                                            BH3491
     C*                                                                   BH3491
     C                     ENDIF                                                              243717
     C***********          END                                     BH3491 103122
     C*                                                                   BH3491
     C***  Do Payment Due Date processing                                 BH3491
     C*                                                                   BH3491
     C           FELPDT    IFGT FEPEND                                    153672
     C           FENPYD    ANDEQ0                                         153672
     C           FELPDT    ORGT FENPYD                                    153672
     C           FENPYD    ANDNE0                                         153672
     C                     MOVE 'Y'       WPROC   1                       153672
     C                     ENDIF                                          153672
     C                     MOVE 'Y'       WFLAG   1                       153672
     C                     MOVE 'H'       ATYP
     C                     EXSR AMTACC
     C                     EXSR UPDFEE
     C                     MOVE ' '       WPROC                           153672
     C                     MOVE ' '       WFLAG                           153672
     C*                                                                   E45504
     C****************************************                            E45504
     C***  Automatic settlement processing ***                            E45504
     C****************************************                            E45504
     C*                                                                   E45504
     C***  This section is for fees entered on due date or after, and     E45504
     C***  those entered on the day before due date, but where due date   E45504
     C***  is a non-working day.                                          E45504
      *                                                                                       CLE134
     C                     MOVE FEAUTO    WFEAUT  1                                           CLE134
      *                                                                                       CLE134
      ** Set date for grace days check                                                        CLE134
      *                                                                                       CLE134
     C                     Z-ADDFELPDT    WNWDAT  50                                          CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           WFEAUT    IFEQ 'C'                                                           CLE134
     C           FEAUT2    OREQ 'C'                                                           CLE134
     C                     MOVE 'Y'       WFEAUT                                              CLE134
      *                                                                                       CLE134
      ** Grace days                                                                           CLE134
      *                                                                                       CLE134
     C           AUGDPR    IFNE 0                                                             CLE134
     C           FELPDT    ADD  AUGDPR    WNWDAT                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                     MD052216
      ** Consider Payment Taken Indicator on Fee Settlement                                 MD052216
      ** if due date falls on a holiday                                                     MD052216
      *                                                                                     MD052216
     C           FEAMTP    IFNE *ZEROS                                                      MD052216
     C           WFEAUT    ANDEQ'Y'                                                         MD052216
     C                     EXSR CHKPAY                                                      MD052216
     C                     Z-ADDWNPAYD    WNWDAT                                            MD052216
     C                     ENDIF                                                            MD052216
     C*                                                                   E45504
     C           FEAMTP    IFNE 0                                         E45504
     C********** FEAUTO    ANDEQ'Y'                                                    E45504 CLE134
     C           WFEAUT    ANDEQ'Y'                                                           CLE134
     C********** FELPDT    ANDLECODT                                                   155912 CLE134
     C           WNWDAT    ANDLECODT                                                          CLE134
     C*                                                                   E52119
     C***  None of these conditions are required. The last auto-settle    E52119
     C***  bit will pick up any past due already in LEFEED. This bit      E52119
     C***  will pick up any amount made past due by AMTACC/UPDFEE         E52119
     C***  immediately before this piece of code.                         E52119
     C*                                                                   E52119
     C********** FENPYD    IFLT BJDNWD                              E45504E52119
     C********** FENPYD    ANDNE0                                   E45504E52119
     C********** FEPEND    ORLT BJDNWD                              E45504E52119
     C           @NPYD     IFLT BJDNWD                                    100428
     C           @NPYD     ANDNE0                                         100428
     C           FEPEND    ORLT BJDNWD                                    100428
      *                                                                                       CLE134
      ** If suspended fee, then generate an additional a/c key to pay the                     CLE134
      ** the suspended amount                                                                 CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FESUSP    ANDNE0                                                             CLE134
     C                     Z-ADDFESUSP    LKEAMT                                              CLE134
     C                     Z-ADD0         FESUSP                                              CLE134
     C                     Z-ADD0         LKREVI                                              CLE134
     C                     MOVE '1'       *IN61                                               CLE134
     C                     MOVE 'S'       WATYPE                                              CLE134
     C                     EXSR GENKEY                                                        CLE134
     C                     MOVE *BLANKS   WATYPE                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     Z-ADDFEAMTP    LKEAMT                          E45504
     C                     Z-ADD0         LKREVI                          E45504
     C                     MOVE '1'       *IN61                           E45504
     C                     EXSR GENKEY                                    E45504
     C                     MOVE '0'       *IN61                           E45504
     C*                                                                   E45504
     C***  If fee period end date on or before control date mature        E45504
     C***  this fee record.                                               E45504
     C*                                                                   E45504
     C           FEPEND    IFLE CODT                                      E45504
     C           WPDCLL    ANDNE'Y'                                                           CLE134
     C           FEAUTO    ANDNE'C'                                                         AR318650
      *                                                                                     AR318650
      ** If Fee has Auto-settle = 'C' and End date less than run date                       AR318650
      ** and Last change date equal run date the fee cannot mature                          AR318650
      *                                                                                     AR318650
     C           FEAUTO    OREQ 'C'                                                         AR318650
     C           FEPEND    ANDLTBJRDNB                                                      AR318650
     C           FELCHD    ANDNEBJRDNB                                                      AR318650
     C           WPDCLL    ANDNE'Y'                                                         AR318650
     C                     MOVE 'M'       FERECI                          E45504
     C********** FEAUTO    IFEQ 'C'                                               AR1078443 MD020212
     C**********           MOVE 'D'       FERECI                                  AR1078443 MD020212
     C**********           ENDIF                                                  AR1078443 MD020212
     C                     END                                            E45504
     C*                                                                   E45504
     C***  Reset fee amounts/dates                                        E45504
     C*                                                                   E45504
     C                     ADD  FEAMTP    FEAMTS                          E45504
     C                     Z-ADDFEAMTP    FEPAMS                          100515
     C***********          Z-ADDCODT      FESDAT                   E45504 155912
     C                     Z-ADDFELPDT    FESDAT                          155912
     C                     Z-ADDFEAMTP    FEPAMP                          100515
     C                     Z-ADD0         FEAMTA                          E45504
     C                     Z-ADD0         FEAMTP                          E45504
     C                     Z-ADD0         FEAMTO                          E45504
     C***********          MOVE ' '       FEDIND                   E45504 056073
     C***********          MOVE 'B'       FEDIND                   056073 100428
     C                     MOVE ' '       FEDIND                          100428
     C                     Z-ADD0         FEDDAT                          E45504
      *                                                                                     MD053375
     C                     WRITELEFECPD0                                                    MD053375
      *                                                                                     MD053375
     C**********           END                                      E45504E52119
     C                     ELSE                                           100428
     C           @NPYD     IFEQ BJDNWD                                    100428
     C           FEPEND    OREQ BJDNWD                                    100428
     C                     MOVE 'B'       FEDIND                          100428
     C                     END                                            100428
     C                     END                                            100428
     C                     END                                            E45504
      *
      ** If last accrued date is LE control date do further accrual
      ** processing for fees that are calculated on the actual
      ** facility (rather than average amount)
      *
     C           FELADT    IFLT CODT
     C           FELADT    ANDNEFEPEND                                    BH3481
     C           FELADT    ANDGT0                                                          AR1047943
     C/COPY WNCPYSRC,LER135C003
      *
     C                     MOVE 'Y'       WACRY   1                                           204866
      *                                                                                       204866
      ** process accruals and settlement if still required for back-valued fees               204866
      *                                                                                       204866
     C********** WACRY     DOWEQ'Y'                                                  204866 AR326180
     C           CALT      IFGE 4
     C           CALT      ANDLE6
     C           CALT      ORGE 14
     C           CALT      ANDLE16
     C           CALT      OREQ 22
     C/COPY WNCPYSRC,LEH00673
     C           WFACLF    OREQ 'N'                                                           CLE073
     C           WACRY     DOWEQ'Y'                                                         AR326180
     C                     MOVE ' '       ATYP
     C           FENPYD    IFLE BJDNWD                                                        204866
     C           FENPYD    ANDGT0                                                             204866
     C           FEPEND    ORLE BJDNWD                                                        204866
     C                     MOVE 'Y'       @CHKD                                               204866
     C                     ENDIF                                                              204866
      *                                                                                       204866
     C                     EXSR AMTACC
      *                                                                                       204866
     C           FENPYD    IFLE BJDNWD                                                        204866
     C           FENPYD    ANDGT0                                                             204866
     C           FEPEND    ORLE BJDNWD                                                        204866
     C                     MOVE ' '       @CHKD                                               204866
     C                     ENDIF                                                              204866
     C                     EXSR UPDFEE
      *                                                                                       204866
      ** Do payment due date processing for fees with next payment date                       204866
      ** less than or equal to next working day.                                              204866
      *                                                                                       204866
     C           FENPYD    IFLE BJDNWD                                                        204866
     C           FENPYD    ANDGT0                                                             204866
     C           FEPEND    ORLE BJDNWD                                                        204866
      *                                                                                       204866
     C           FELPDT    IFGT FEPEND                                                        204866
     C           FENPYD    ANDEQ0                                                             204866
     C           FELPDT    ORGT FENPYD                                                        204866
     C           FENPYD    ANDNE0                                                             204866
     C                     MOVE 'Y'       WPROC                                               204866
     C                     ENDIF                                                              204866
     C                     MOVE 'Y'       WFLAG                                               204866
     C                     MOVE 'H'       ATYP                                                204866
     C                     EXSR AMTACC                                                        204866
     C                     EXSR UPDFEE                                                        204866
     C                     MOVE ' '       WPROC                                               204866
     C                     MOVE ' '       WFLAG                                               204866
      *                                                                                       204866
      ** For back-valued fees autosettle fees                                                 204866
      *                                                                                       204866
     C                     MOVE FEAUTO    WFEAUT                                              CLE134
      *                                                                                       CLE134
      ** Set date for grace days check                                                        CLE134
      *                                                                                       CLE134
     C                     Z-ADDFELPDT    WNWDAT  50                                          CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           WFEAUT    IFEQ 'C'                                                           CLE134
     C           FEAUT2    OREQ 'C'                                                           CLE134
     C                     MOVE 'Y'       WFEAUT                                              CLE134
      *                                                                                       CLE134
      ** Grace days                                                                           CLE134
      *                                                                                       CLE134
     C           AUGDPR    IFNE 0                                                             CLE134
     C           FELPDT    ADD  AUGDPR    WNWDAT                                              CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C           FEAMTP    IFNE 0                                                             204866
     C********** FEAUTO    ANDEQ'Y'                                                    204866 CLE134
     C           WFEAUT    ANDEQ'Y'                                                           CLE134
     C********** FELPDT    ANDLECODT                                                   204866 CLE134
     C           WNWDAT    ANDLECODT                                                          CLE134
     C           @NPYD     IFLT BJDNWD                                                        204866
     C           @NPYD     ANDNE0                                                             204866
     C           FEPEND    ORLT BJDNWD                                                        204866
      *                                                                                       CLE134
      ** If suspended fee, then generate an additional a/c key                                CLE134
      ** to pay the suspended amount                                                          CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FESUSP    ANDNE0                                                             CLE134
     C                     Z-ADDFESUSP    LKEAMT                                              CLE134
     C                     Z-ADD0         FESUSP                                              CLE134
     C                     Z-ADD0         LKREVI                                              CLE134
     C                     MOVE '1'       *IN61                                               CLE134
     C                     MOVE 'S'       WATYPE                                              CLE134
     C                     EXSR GENKEY                                                        CLE134
     C                     MOVE *BLANKS   WATYPE                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     Z-ADDFEAMTP    LKEAMT                                              204866
     C                     Z-ADD0         LKREVI                                              204866
     C                     MOVE '1'       *IN61                                               204866
     C                     EXSR GENKEY                                                        204866
     C                     MOVE '0'       *IN61                                               204866
     C           FEPEND    IFLE CODT                                                          204866
     C           WPDCLL    ANDNE'Y'                                                           CLE134
     C           FEAUTO    ANDNE'C'                                                         AR318650
      *                                                                                     AR318650
      ** If Fee has Auto-settle = 'C' and End date less than run date                       AR318650
      ** and Last change date equal run date the fee cannot mature                          AR318650
      *                                                                                     AR318650
     C           FEAUTO    OREQ 'C'                                                         AR318650
     C           FEPEND    ANDLTBJRDNB                                                      AR318650
     C           FELCHD    ANDNEBJRDNB                                                      AR318650
     C           WPDCLL    ANDNE'Y'                                                         AR318650
     C                     MOVE 'M'       FERECI                                              204866
     C********** FEAUTO    IFEQ 'C'                                               AR1078443 MD020212
     C**********           MOVE 'D'       FERECI                                  AR1078443 MD020212
     C**********           ENDIF                                                  AR1078443 MD020212
     C                     END                                                                204866
      *                                                                                       204866
      ** Reset fee amounts/dates                                                              204866
      *                                                                                       204866
     C                     ADD  FEAMTP    FEAMTS                                              204866
     C                     Z-ADDFEAMTP    FEPAMS                                              204866
     C                     Z-ADDFELPDT    FESDAT                                              204866
     C                     Z-ADDFEAMTP    FEPAMP                                              204866
     C                     Z-ADD0         FEAMTA                                              204866
     C                     Z-ADD0         FEAMTP                                              204866
     C                     Z-ADD0         FEAMTO                                              204866
     C                     MOVE ' '       FEDIND                                              204866
     C                     Z-ADD0         FEDDAT                                              204866
      *                                                                                     MD053375
     C                     WRITELEFECPD0                                                    MD053375
      *                                                                                     MD053375
     C                     ELSE                                                               204866
     C           @NPYD     IFEQ BJDNWD                                                        204866
     C           FEPEND    OREQ BJDNWD                                                        204866
     C                     MOVE 'B'       FEDIND                                              204866
     C                     END                                                                204866
     C                     END                                                                204866
     C                     END                                                                204866
      *                                                                                       204866
     C                     ENDIF                                                              204866
      *                                                                                       204866
      ** Repeat accruals processing while FELADT is less than COD, otherwise                  204866
      ** terminate the processing.                                                            204866
      *                                                                                       204866
     C           FELADT    IFGE CODT                                                          204866
     C/COPY WNCPYSRC,LEH00674
      *                                                                                       CLE073
     C********** FECALT    OREQ '97'                                                CLE073 AR740063A
     C********** FECALT    OREQ '98'                                                CLE073 AR740063A
     C********** FECALT    OREQ '99'                                                CLE073 AR740063A
      *                                                                                       CLE073
     C           FELADT    OREQ ENDATE                                                      AR326180
     C                     MOVE 'N'       WACRY                                               204866
     C                     ENDIF                                                              204866
     C                     ENDDO                                                            AR326180
      *                                                                                       213377
      ** Different calculation type                                                           213377
      *                                                                                       213377
     C                     ELSE                                                               213377
     C                     MOVE 'N'       WACRY                                               213377
     C                     END
     C**********           ENDDO                                                     204866 AR326180
      *
     C                     END
      *
      ** If final accrual not yet required continue to accrue
      ** daily
      *
     C                     ELSE
     C/COPY WNCPYSRC,LER135C024
      *
      ** If calculated on on actual amount of facility then accrue
      ** daily - this is not required for average type calculations,
      *
     C           CALT      IFGE 4
     C           CALT      ANDLE6
     C           CALT      ORGE 14
     C           CALT      ANDLE16
     C           CALT      OREQ 22
     C/COPY WNCPYSRC,LEH00675
     C           WFACLF    OREQ 'N'                                                           CLE073
     C                     MOVE ' '       ATYP
     C                     EXSR AMTACC
     C*                                                                   BH3480
     C***  Don't do start date if last day accruals                       BH3480
     C*                                                                   BH3480
     C           BKALDI    IFEQ 'Y'                                       BH3480
     C           FEPSTD    ANDLTCODT                                      BH3480
     C           BKALDI    ORNE 'Y'                                       BH3480
     C                     EXSR UPDFEE
     C                     END                                            BH3480
     C                     END
      *
     C                     END
      *
     C                     END
      *
     C                     END
      *                                                                                       196612
      ** End processing of fee if next payment date is greater                                196612
      ** than or equal to next working day or equal to zero                                   196612
      ** or enddate is less than next working day. This loop                                  196612
      ** will process backvalued payment periods.                                             196612
      *                                                                                       196612
     C           WFACLF    IFEQ 'Y'                                                           CLE134
     C           FENPYD    IFGE BJDNWD                                                        196612
     C           FENPYD    OREQ 0                                                             196612
      *                                                                                       205529
      ** or fee next payment date is greater than run date but not greater than next          205529
      ** working day.                                                                         205529
      *                                                                                       205529
     C           FENPYD    ORGT BJRDNB                                                        205529
     C           FEPEND    ORLT BJDNWD                                                        196612
     C                     MOVE 'Y'       FREQ                                                196612
     C                     ENDIF                                                              196612
      *                                                                                       CLE134
     C                     ELSE                                                               CLE134
      *                                                                                       CLE134
      ** If Fee is loan based                                                                 CLE134
      *                                                                                       CLE134
     C           FENPYD    IFGT BJRDNB                                                        CLE134
     C********** FELADT    ANDGEBJRDNB                                                 CLE134 262506
     C           FEPSTD    ANDLEBJRDNB                                                        CLE134
      *                                                                                       CLE134
     C           FENPYD    ORGT BJRDNB                                                        CLE134
     C           FEPSTD    ANDGTBJRDNB                                                        CLE134
      *                                                                                       CLE134
     C           FENPYD    OREQ 0                                                             CLE134
      *                                                                                       CLE134
     C           FEPEND    ORLT BJDNWD                                                        CLE134
     C           FELPDT    ANDEQFEPEND                                                        CLE134
      *                                                                                       CLE134
     C                     MOVE 'Y'       FREQ                                                CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       196612
     C                     ENDDO                                                              196612
      *
      ** If fully settled amount on adjustment file add settlement
      ** amount to event amount and generate account key for
      ** this amount.
      *
     C           *IN60     IFEQ '1'
     C                     Z-ADDWFASAD    FASADJ                                              204866
     C                     Z-ADDFASADJ    LKEAMT
     C                     Z-ADD0         LKREVI
     C                     MOVE '1'       *IN61
     C                     MOVE 'ADJ'     WSTYPE                                            AR810483
      *                                                                   CLE005
      ** If CLE005 is on, set Manual Settlement Flag to 'Y'.              CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C                     MOVE 'Y'       MSFLAG  1                       CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     EXSR GENKEY
     C                     MOVE '0'       *IN61
     C                     MOVE *BLANKS   WSTYPE                                            AR810483
      *                                                                                       250628
      * If fee due date processing taking place and full settlement also, this                250628
      * will have been for the previous period so skip updates to new past due                250628
      *                                                                                       250628
     C           ATYP      IFNE 'H'                                                           250628
     C           FEPEND    ORLE CODT                                                          250628
      *
      ** If fee past due amount is greater than the event amount then
      ** an account key must be generated for the difference and
      ** treated as a reversal.
      *
     C********** FEAMTP    IFGT LKEAMT                                                        204467
     C********** FEAMTP    SUB  LKEAMT    LKEAMT                                              204467
      *                                                                                       204467
      ** Use FEPAMP instead of FEAMTP  because FEAMTP is already updated                      204467
      *                                                                                       204467
     C********** FEPAMP    IFGT LKEAMT                                               204467 AR810483
     C********** FEPAMP    SUB  LKEAMT    LKEAMT                                     204467 AR810483
      *                                                                                     AR810483
      ** Use saved value of original past due amount (FEFULL).                              AR810483
      *                                                                                     AR810483
     C           FEFULL    IFGT LKEAMT                                                      AR810483
     C           FEFULL    SUB  LKEAMT    LKEAMT                                            AR810483
     C                     Z-ADD1         LKREVI
     C                     EXSR GENKEY
     C                     SUB  LKEAMT    WAGG
     C                     END
      *
      ** If the event amount is greater than the past due amount
      ** an account key must be generated for the difference in the
      ** two figures.
      *
     C********** LKEAMT    IFGT FEAMTP                                                        204467
     C**********           SUB  FEAMTP    LKEAMT                                              204467
     C********** LKEAMT    IFGT FEPAMP                                               204467 AR810483
     C**********           SUB  FEPAMP    LKEAMT                                     204467 AR810483
      *                                                                                       204467
      ***Use*FEPAMP*instead*of*FEAMTP**because*FEAMTP*is*already*updated             204467 AR810483
      *                                                                                       204467
      ** Use saved value of original past due amount (FEFULL).                              AR810483
      *                                                                                     AR810483
     C           LKEAMT    IFGT FEFULL                                                      AR810483
     C                     SUB  FEFULL    LKEAMT                                            AR810483
     C                     Z-ADD0         LKREVI
     C                     EXSR GENKEY
     C                     ADD  LKEAMT    WAGG
     C                     END
      *
      ** If fee period end date on or before control date mature
      ** this fee record.
      *
     C           FEPEND    IFLE CODT
     C           WPDCLL    ANDNE'Y'                                                           CLE134
     C           FEAUTO    ANDNE'C'                                                         AR318650
      *                                                                                     AR318650
      ** If Fee has Auto-settle = 'C' and End date less than run date                       AR318650
      ** and Last change date equal run date the fee cannot mature                          AR318650
      *                                                                                     AR318650
     C           FEAUTO    OREQ 'C'                                                         AR318650
     C           FEPEND    ANDLTBJRDNB                                                      AR318650
     C           FELCHD    ANDNEBJRDNB                                                      AR318650
     C           WPDCLL    ANDNE'Y'                                                         AR318650
     C                     MOVE 'M'       FERECI
     C********** FEAUTO    IFEQ 'C'                                               AR1078443 MD020212
     C**********           MOVE 'D'       FERECI                                  AR1078443 MD020212
     C**********           ENDIF                                                  AR1078443 MD020212
     C                     END
      *
      ** Reset fee amounts/dates
      *
     C                     Z-ADDFEAMTP    FEPAMP                          100515
     C**********           Z-ADD0         FEAMTA                                              204452
     C                     Z-ADD0         FEAMTP
     C                     Z-ADD0         FEAMTO
      *                                                                                       204452
      ** reverse loading of FASADJ to FEAMTS since this has been done                         204452
      ** in the Full amount processing FATYPE=F                                               204452
      *                                                                                       204452
     C**********           ADD  FASADJ    FEAMTS                          BH3503              204452
     C                     Z-ADDCODT      FESDAT
     C                     MOVE ' '       FEDIND
     C                     Z-ADD0         FEDDAT
      *
      * Else just update fee settlment date with value date of settlement.                    250628
      *                                                                                       250628
     C                     ELSE                                                               250628
     C                     Z-ADDFAVDAT    FESDAT                                              250628
     C                     ENDIF                                                              250628
     C                     END
      *                                                                   CLE009
      ** If CLE009 is on and adjustment telex flag is not blank           CLE009
      *                                                                   CLE009
     C           CLE009    IFEQ 'Y'                                       CLE009
     C           RTADJ     ANDNE*BLANKS                                   CLE009
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C                     EXSR SR34A                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'Y'       WKFLD                                               CLE034
     C                     MOVE '*EOF   ' PRTCDE                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           WKFLD     DOWEQ'Y'                                                           CLE034
     C           PRTCDE    OREQ *BLANKS                                                       CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C                     EXSR SR34B                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE 'L'       RTTYPE                          CLE009
     C                     EXSR RTLX2                                     CLE009
     C                     MOVE *BLANKS   RTADJ                           CLE009
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C                     EXSR SR34C                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE *BLANKS   WKFLD                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDDO                                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C                     EXSR SR34E                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                          CLE009
      *
      ** END OF MAIN LOOP:
      *
      *                                                                   CLE005
      *************************************************************CLE005 141462
      ***Skip*the*part*where*SR/EXTUPD*is*called*if*CLE005*and*****CLE005 141462
      ***CLE004*is*on,*and*if*Participant*Fee*indicator*is*'I'*****CLE005 141462
      ***or*'P'.***************************************************CLE005 141462
      *************************************************************CLE005 141462
     C***********CLE005    IFNE 'Y'                                CLE005 142402
     C***********CLE004    ANDNE'Y'                                CLE005 142402
     C***********PTFI      ANDNE'I'                                CLE005 142402
     C***********PTFI      ANDNE'P'                                CLE005 142402
     C***********CLE005    IFEQ 'Y'                                142402 141462
     C***********PTFI      ANDEQ' '                                142402 141462
     C***********CLE004    OREQ 'Y'                                142402 141462
     C***********PTFI      ANDEQ' '                                142402 141462
     C***********CLE004    ORNE 'Y'                                142402 141462
     C***********CLE005    ANDNE'Y'                                142402 141462
      *
     C           WAGG      CASNE0         EXTUPD
     C                     END
      *                                                                   CLE005
     C***********          ENDIF                                   CLE005 141462
     C*                                                                   052449
     C** Fees that have a final payment of zero never matured because     052449
     C** they cannot be settled and are never reprocessed after the       052449
     C** day before due date                                              052449
     C*                                                                   052449
     C           FEPEND    IFLE CODT                                      052449
     C           FEAMTO    ANDEQ0                                         052449
     C           FEAMTP    ANDEQ0                                         052449
     C           WPDCLL    ANDNE'Y'                                                           CLE134
     C           FEAUTO    ANDNE'C'                                                         AR318650
      *                                                                                     AR318650
      ** If Fee has Auto-settle = 'C' and End date less than run date                       AR318650
      ** and Last change date equal run date the fee cannot mature                          AR318650
      *                                                                                     AR318650
     C           FEAUTO    OREQ 'C'                                                         AR318650
     C           FEPEND    ANDLTBJRDNB                                                      AR318650
     C           FELCHD    ANDNEBJRDNB                                                      AR318650
     C           FEAMTO    ANDEQ0                                                           AR318650
     C           FEAMTP    ANDEQ0                                                           AR318650
     C           WPDCLL    ANDNE'Y'                                                         AR318650
     C                     MOVE 'M'       FERECI                          052449
     C********** FEAUTO    IFEQ 'C'                                               AR1078443 MD020212
     C**********           MOVE 'D'       FERECI                                  AR1078443 MD020212
     C**********           ENDIF                                                  AR1078443 MD020212
     C                     END                                            052449
      *
      ** Update Fee Extension File                                                          MD052216
      *                                                                                     MD052216
     C           *IN08     IFEQ *OFF                                                        MD052216
     C                     Z-ADDWFPBDT    FQFPBD                                            MD052216
     C                     MOVELWPDDI     FQPDDI                                            MD052216
     C                     MOVELWPTDI     FQPTDI                                            MD052216
     C                     UPDATLEFEEQD0                                                    MD052216
     C                     ENDIF                                                            MD052216
      *                                                                                     MD052216
     C                     END
     C                     ENDIF                                                              CLE139
      ******************************************************************               243496 245803
      ***Save*the*fee*adjustment*amount*for*PF/LEFEAM*******************               243496 245803
      ******************************************************************               243496 245803
     C********** FEAMTA    IFNE 0                                                      243496 245803
     C**********           Z-ADDFEAMTA    FEOAMT                                       243496 245803
     C**********           ENDIF                                                       243496 245803
      ******************************************************************               243496 245803
      ***Write*to*fee*adjustment*file.**********************************               243496 245803
      ******************************************************************               243496 245803
     C********** FEOAMT    IFNE 0                                                      243496 245803
     C**********           WRITELEFEAMF                                                243496 245803
     C**********           ENDIF                                                       243496 245803
      *                                                                                      243496B
      ** Save the fee adjustment amount for PF/LEFEAM                                        243496B
      *                                                                                      243496B
     C           FEAMTA    IFNE 0                                                            243496B
     C                     Z-ADDFEAMTA    FEOAMT                                             243496B
     C                     ENDIF                                                             243496B
      *                                                                                      243496B
      ** Write to fee adjustment file.                                                       243496B
      *                                                                                      243496B
     C           FEOAMT    IFNE 0                                                            243496B
     C                     WRITELEFEAMF                                                      243496B
     C                     ENDIF                                                             243496B
      *                                                                                      BUG8762
      ** Write to LEFHST when payment date is reached.                                       BUG8762
      *                                                                                      BUG8762
     C           CALT      IFGE 1                                                            BUG8762
     C           CALT      ANDLE3                                                            BUG8762
     C           CALT      ORGE 11                                                           BUG8762
     C           CALT      ANDLE13                                                           BUG8762
     C           CALT      OREQ 21                                                           BUG8762
     C           FELPDT    OREQ FEPEND                                                      MD052216
     C           WPAYTD    ANDEQ'Y'                                                         MD052216
      *                                                                                     MD052216
     C                     MOVEL*BLANK    WPAYTD                                            MD052216
      *                                                                                      BUG8762
     C           FELPDT    IFNE *ZEROS                                                      MD052216
     C                     Z-ADDFELPDT    WNWDAT                                            MD052216
     C                     EXSR CHKPAY                                                      MD052216
     C                     Z-ADDWNPAYD    @PAYTD  50                                        MD052216
     C                     ENDIF                                                            MD052216
      *                                                                                     MD052216
     C********** FELPDT    IFEQ CODT                                                BUG8762 MD052216
     C********** FELPDT    ORLT CODT                                                BUG8762 MD052216
     C********** FELPDT    ANDGTBJRDNB                                                BUG8762 258597
     C********** FELPDT    ANDGEBJRDNB                                               258597 MD052216
     C********** FELPDT    ORLT BJRDNB                                              BUG8762 MD052216
     C********** FELPDT    ANDGTCODT                                                BUG8762 MD052216
     C           @PAYTD    IFEQ CODT                                                        MD052216
     C           @PAYTD    ORLE CODT                                                        MD052216
     C           @PAYTD    ANDGEBJRDNB                                                      MD052216
     C           BKANWD    OREQ '2'                                                         AR820690
     C           FELPDT    ANDLTCODT                                                        AR820690
     C           FELPDT    ANDGTPRUN                                                        AR820690
      *                                                                                      BUG8762
      ** If CLE005 or CDE002 is on, setup details for writing a                              BUG8762
      ** record in LEFHST.                                                                   BUG8762
      *                                                                                      BUG8762
     C           CLE005    IFEQ 'Y'                                                          BUG8762
     C           FEPYON    ANDEQ'N'                                                          BUG8762
     C           CDE002    OREQ 'Y'                                                          BUG8762
     C/COPY WNCPYSRC,LEH00612
      *                                                                                      BUG8762
     C                     MOVE 'D'       HIRECI                                             BUG8762
     C                     MOVE FEBRCA    HIBRCA                                             BUG8762
     C                     MOVE FECNUM    HICNUM                                             BUG8762
     C                     MOVE FEFACL    HIFACL                                             BUG8762
     C                     MOVE FELOAN    HILNRF                                             BUG8762
     C                     MOVE FEFSEQ    HIFSEQ                                             BUG8762
     C                     MOVE FEFCOD    HIFCOD                                             BUG8762
     C                     MOVE FEFCCY    HIFCCY                                             BUG8762
      *                                                                                      BUG8762
      ** Add settled amount and any settlements today to historical                          BUG8762
      ** settled amount.                                                                     BUG8762
      *                                                                                      BUG8762
     C                     Z-ADDFEAMTS    HIAMTS                                             BUG8762
     C********** FATYPE    IFEQ 'P'                                                   BUG8762 260881
     C********** FATYPE    OREQ 'F'                                                   BUG8762 260881
     C**********           ADD  FASADJ    HIAMTS                                      BUG8762 260881
     C**********           ENDIF                                                      BUG8762 260881
      *                                                                                      BUG8762
     C                     Z-ADDFELPDT    HIHDAT                                             BUG8762
     C                     Z-ADDFELPDT    HILCHD                                             BUG8762
     C                     MOVE 'I'       HILCHT                                             BUG8762
      *                                                                                      BUG8762
      ** Move fee rates and amounts fields from LEFEED to LEFHST if CLE005                   BUG8762
      ** is on and FEINDC not 'Y'.                                                           BUG8762
      *                                                                                      BUG8762
     C           CLE005    IFEQ 'Y'                                                          BUG8762
     C           FEINDC    ANDNE'Y'                                                          BUG8762
     C                     Z-ADDFEFRT1    HIFRT1                                             BUG8762
     C                     Z-ADDFEFRT2    HIFRT2                                             BUG8762
     C                     Z-ADDFEFRT3    HIFRT3                                             BUG8762
     C                     Z-ADDFEFRT4    HIFRT4                                             BUG8762
     C                     Z-ADDFEFRT5    HIFRT5                                             BUG8762
     C                     Z-ADDFEAMT1    HIAMT1                                             BUG8762
     C                     Z-ADDFEAMT2    HIAMT2                                             BUG8762
     C                     Z-ADDFEAMT3    HIAMT3                                             BUG8762
     C                     Z-ADDFEAMT4    HIAMT4                                             BUG8762
     C                     Z-ADDFEAMT5    HIAMT5                                             BUG8762
     C                     ELSE                                                             MD045479
     C                     Z-ADD*ZEROS    HIFRT1                                            MD045479
     C                     Z-ADD*ZEROS    HIFRT2                                            MD045479
     C                     Z-ADD*ZEROS    HIFRT3                                            MD045479
     C                     Z-ADD*ZEROS    HIFRT4                                            MD045479
     C                     Z-ADD*ZEROS    HIFRT5                                            MD045479
     C                     Z-ADD*ZEROS    HIAMT1                                            MD045479
     C                     Z-ADD*ZEROS    HIAMT2                                            MD045479
     C                     Z-ADD*ZEROS    HIAMT3                                            MD045479
     C                     Z-ADD*ZEROS    HIAMT4                                            MD045479
     C                     Z-ADD*ZEROS    HIAMT5                                            MD045479
     C                     ENDIF                                                             BUG8762
      *                                                                                     AR750601
     C                     EXSR ADDFLD                                                      AR750601
      *                                                                                      BUG8762
     C********** HIAMTS    IFNE 0                                                     BUG8762 248358
     C********** FEAUTO    OREQ 'Y'                                                   BUG8762 248358
     C                     Z-ADD*ZERO     HIRCVD                                             CLE071A
     C                     MOVEL*BLANKS   HIRCTP                                             CLE071A
     C                     WRITELEFHSTF                                                      BUG8762
     C**********           ENDIF                                                      BUG8762 248358
     C                     ENDIF                                                             BUG8762
     C                     ENDIF                                                             BUG8762
     C                     ENDIF                                                             BUG8762
      *                                                                                       250628
      ** If fee was to be matured, matured all settlement records on                          250628
      ** on LEFHST thru LER136.                                                               250628
      *                                                                                       250628
     C           FERECI    IFEQ 'M'                                                           250628
     C                     Z-ADDFEFACL    WFACL   50                                          250628
     C                     CALL 'LER136'                                                      250628
     C                     PARM           FEBRCA                                              250628
     C                     PARM           FECNUM                                              250628
     C                     PARM           WFACL                                               250628
     C                     PARM           FELOAN                                              250628
     C                     PARM           FEFSEQ                                              250628
     C                     PARM '       ' WRTCD                                               250628
     C                     PARM 'LER135'  WPGM    6                                        AR632102B
      *                                                                                       250628
      ** Error was encountered.                                                               250628
      *                                                                                       250628
     C           WRTCD     IFNE *BLANKS                                                       250628
     C           *LOCK     IN   LDA                                                           250628
     C                     MOVEL'LER135'  DBPGM                                               250628
     C                     MOVELFEFACL    DBKEY                                               250628
     C                     MOVE FEFSEQ    DBKEY                                               250628
     C                     MOVEL'LEFHST'  DBFILE           ************                       250628
     C                     Z-ADD034       DBASE            * DBERR 34 *                       250628
     C                     OUT  LDA                        ************                       250628
     C                     EXSR *PSSR                                                         250628
     C**********           ELSE                                                        250628 258597
      *****************************************************************                250628 258597
      ***For*matured*fee, set fee sequence to zero.                                    250628 258597
      *****************************************************************                250628 258597
     C**********           Z-ADD0         FEFSEQ                                       250628 258597
     C                     ENDIF                                                              250628
      *                                                                                     AR634880
     C           WKPDCL    CHAINLEFADJL0             51                                     AR634880
     C           *IN51     IFEQ '0'                                                         AR634880
     C                     DELETLEFADJD0                                                    AR634880
     C                     ENDIF                                                            AR634880
     C                     ENDIF                                                              250628
      *                                                                                    MD026969A
     C           WKADJY    IFEQ 'Y'                                                        MD026969A
     C           WKSIGN    IFEQ '-'                                                        MD026969A
     C                     SUB  WKSADJ    FEAMTS                                           MD026969A
     C                     ADD  WKSADJ    FELPAM                                           MD026969A
     C                     ELSE                                                            MD026969A
     C                     ADD  WKSADJ    FEAMTS                                           MD026969A
     C                     SUB  WKSADJ    FELPAM                                           MD026969A
     C                     ENDIF                                                           MD026969A
     C                     ENDIF                                                           MD026969A
      *                                                                                    MD026969A
     C                     Z-ADD0         WKSADJ                                           MD026969A
     C                     CLEARWKSIGN                                                     MD026969A
     C                     CLEARWKADJY                                                     MD026969A
      *
      ** Update fees master file.
      *
     C                     UPDATLEFEEDF
      *
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           FERECI    ANDEQ'M'                                                           CLE034
      *                                                                                       CLE034
     C                     MOVE FELOAN    PLNRF                                               CLE034
     C                     MOVE FECNUM    PCNUM                                               CLE034
     C                     MOVE FEFACL    PFACL                                               CLE034
     C                     MOVE FEFSEQ    PFSEQ                                               CLE034
     C                     MOVEASTAMP,1   PTMST                                               CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSTALU0'                                                    CLE034
     C                     PARM *BLANKS   PRTCD                                               CLE034
     C                     PARM 'FEES'    PTYPE                                               CLE034
     C                     PARM 'M'       PACTN   1                                           CLE034
     C                     PARM           PLNRF                                               CLE034
     C                     PARM *BLANKS   PLAVD                                               CLE034
     C                     PARM *BLANKS   PLASQ                                               CLE034
     C                     PARM           PCNUM                                               CLE034
     C                     PARM           PFACL                                               CLE034
     C                     PARM           PFSEQ                                               CLE034
     C                     PARM           PTMST  26                                           CLE034
     C                     PARM *BLANKS   PPCRF  15                                           CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     Z-ADD0         FASADJ                          153736
     C                     END
      *
     C                     END
      *
      ** PROCESSING COMPLETE:
      *
      *                                                                   CLE007
      ** Check if CLE007 is on.                                           CLE007
      *                                                                   CLE007
     C           CLE007    IFEQ 'Y'                                       CLE007
     C           CCAP      ANDNE'C'                                                           CLE139
     C                     READ LEPXTAC                  65               CLE007
     C           *IN65     IFEQ '0'                                       CLE007
     C                     MOVE RCOUNT    NORE                            CLE007
     C                     ADD  XHRWN     HRWN                            CLE007
     C                     ADD  XHRDC     HRDC                            CLE007
     C                     MOVE 'T'       RECI                            CLE007
     C                     UPDATLEPXTACF                                  CLE007
      *                                                                   CLE007
     C                     ELSE                                           CLE007
     C                     MOVE RCOUNT    NORE                            CLE007
     C                     ADD  XHRWN     HRWN                            CLE007
     C                     ADD  XHRDC     HRDC                            CLE007
     C                     MOVE 'T'       RECI                            CLE007
      *                                                                   CLE007
     C                     WRITELEPXTACF                                  CLE007
     C                     ENDIF                                          CLE007
     C                     ENDIF                                          CLE007
      *                                                                   CLE007
      ** Update account keys trailer.
      *
     C           CLE134    IFNE 'Y'                                                           CLE134
     C           NEWCOB    ORNE 'Y'                                                           CLE134
     C                     READ LKEYFEZ                  16
      *
     C           *IN16     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'LER135'  DBPGM
     C                     MOVEL'LKEYFEZ 'DBFILE           ************
     C                     Z-ADD003       DBASE            * DBERR 03 *
     C                     OUT  LDA                        ************
     C                     EXSR *PSSR
     C                     END
      *
      ** Obtain before value of file control fields for output to
      ** report
      *
     C                     Z-ADDLKNORE    NORE
     C                     Z-ADDLKVLRF    VLRF
     C                     Z-ADDLKVLRL    VLRL
      *
      ** LKNTOT is total number of account keys generated field.
     C********** LKNTOT    ADD  NKEY      LKNORE                            0069
     C*                                                                     0069
     C***  Add total for last branch to what is on the trailer already      0069
     C*                                                                     0069
     C                     ADD  NKEY      LKNORE                            0069
     C*                                                                     0069
     C***  Add running total to what is on the trailer already              0069
     C***  (the last branch has not been added to the running total)        0069
     C*                                                                     0069
     C                     ADD  LKNTOT    LKNORE                            0069
     C*                                                                     0069
     C                     Z-ADDTOTI      ZZAMT
     C                     MOVE TOTD      ZZAMT
     C**********           Z-ADDLKVLRF    ZZTOTI                            0069
     C**********           Z-ADDLKVLRL    ZZTOTD                            0069
     C                     Z-ADDLKVLRF    INT,2                             0069
     C                     Z-ADDLKVLRL    DEC,2                             0069
     C                     Z-ADD1         Z
     C*********************Z-ADD1         S                               0056
     C                     Z-ADD2         S                               0056
     C                     EXSR ZHASH
     C                     Z-ADDZZTOTI    LKVLRF
     C                     Z-ADDZZTOTD    LKVLRL
      *
     C                     UPDATLKEYFEZF
     C                     Z-ADDLKNORE    LTNORE                                              CLE134
     C                     Z-ADDLKVLRF    LTVLRF                                              CLE134
     C                     Z-ADDLKVLRL    LTVLRL                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           1         SETLLLEPK2ZZ                                                       CLE134
     C                     READ LEPK2ZZ                  88                                   CLE134
      *                                                                                       CLE134
     C********** NEWCOB    IFEQ 'Y'                                                 CLE134 AR1055539
     C           NEWCOB    IFEQ 'Y'                                                        AR1069056
     C                     Z-ADDLKNORE    NORE                                                CLE134
     C                     Z-ADDLKVLRF    VLRF                                                CLE134
     C                     Z-ADDLKVLRL    VLRL                                                CLE134
      *                                                                                       CLE134
      ** LKNTOT is total number of account keys generated field.                              CLE134
      *                                                                                       CLE134
      ** Add total for last branch to what is on the trailer already                          CLE134
      *                                                                                       CLE134
     C                     ADD  NKEY      LKNORE                                              CLE134
      *                                                                                       CLE134
      ** Add running total to what is on the trailer already                                  CLE134
      ** (the last branch has not been added to the running total) )                          CLE134
      *                                                                                       CLE134
     C                     ADD  LKNTOT    LKNORE                                              CLE134
      *                                                                                       CLE134
     C                     Z-ADDTOTI      ZZAMT                                               CLE134
     C                     MOVE TOTD      ZZAMT                                               CLE134
     C                     Z-ADDLKVLRF    INT,2                                               CLE134
     C                     Z-ADDLKVLRL    DEC,2                                               CLE134
     C                     Z-ADD1         Z                                                   CLE134
     C                     Z-ADD2         S                                                   CLE134
     C                     EXSR ZHASH                                                         CLE134
     C                     Z-ADDZZTOTI    LKVLRF                                              CLE134
     C                     Z-ADDZZTOTD    LKVLRL                                              CLE134
     C                     Z-ADDLKNORE    LTNORE                                              CLE134
     C                     Z-ADDLKVLRF    LTVLRF                                              CLE134
     C                     Z-ADDLKVLRL    LTVLRL                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C           *IN88     IFEQ *OFF                                                          CLE134
     C                     ADD  L2NORE    LKNORE                                              CLE134
     C                     ADD  L2VLRF    LKVLRF                                              CLE134
     C                     ADD  L2VLRL    LKVLRL                                              CLE134
     C                     UPDATLKEYF2ZF                                                      CLE134
     C                     ELSE                                                               CLE134
     C                     Z-ADDL2NORE    LKNORE                                              CLE134
     C                     ADD  2         LKNORE                                              CLE134
     C                     Z-ADDL2VLRF    LKVLRF                                              CLE134
     C                     Z-ADDL2VLRL    LKVLRL                                              CLE134
     C                     WRITELKEYF2ZF                                                      CLE134
     C**********           ENDIF                                                    CLE134 AR1055539
     C                     ENDIF                                                           AR1069056
     C                     Z-ADDLKNORE    LPNORE                                              CLE134
     C                     Z-ADDLKVLRF    LPVLRF                                              CLE134
     C                     Z-ADDLKVLRL    LPVLRL                                              CLE134
     C                     ENDIF                                                              CLE134
      *
      ** Update fee extract file trailer.
      *
     C                     READ LEPEFFZ                  16
      *
     C           *IN16     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'LER135'  DBPGM
     C                     MOVEL'LEPEFFZ 'DBFILE           ************
     C                     Z-ADD004       DBASE            * DBERR 04 *
     C                     OUT  LDA                        ************
     C                     EXSR *PSSR
     C                     END
      *
     C                     Z-ADDFFDNOR    NPREV
     C                     ADD  NFFD      FFDNOR
      *
     C                     UPDATLEPEFFZF
      *
      **  Output control date to data area for use in LE0490
      *
     C           *LOCK     IN   LESTAT
     C                     Z-ADDCODT      WCODT
     C                     OUT  LESTAT
      *
      **  If no details have been output to either detail report
      **  out 'No Details' message on audit report
      *
     C           *IN21     IFEQ '0'
     C           *IN22     ANDEQ'0'
     C                     EXSR AUDIT
     C                     WRITELER135C1
     C                     WRITELER135C3
      *
     C                     ELSE
      *
     C                     Z-ADDLTNORE    LKNORE                                              CLE134
     C                     Z-ADDLTVLRF    LKVLRF                                              CLE134
     C                     Z-ADDLTVLRL    LKVLRL                                              CLE134
      ** Write totals to account keys generated report (P1)
      *
     C***  But not if it was never opened as it had nothing to report     BHBPC2
     C*                                                                   BHBPC2
     C           P1OP      IFEQ 'Y'                                       BHBPC2
     C***/COPY*WNCPYSRC,LEH00982***                                                           CFC006
     C/COPY WNCPYSRC,LEH00982                                                               MD020563
     C           SUPFLG    ANDNE'Y'                                                           CFC006
     C                     WRITELER135A4
     C                     END                                            BHBPC2
      *
      ** Write out end of report for branch on P2 report
      *
     C           P2OP      IFEQ 'Y'                                       BH3579
     C***/COPY*WNCPYSRC,LEH01030***                                                           CFC006
     C/COPY WNCPYSRC,LEH01030                                                               MD020563
     C           SUPFL2    ANDNE'Y'                                                           CFC006
     C                     WRITELER135BR
     C                     END                                            BH3579
      *
      *
      ** Write header & hash totals to audit report
      *
     C                     EXSR AUDIT
     C                     WRITELER135C1
     C                     WRITELER135C2
      *
     C                     END
      *
      ** Generate Adjustment reports with backvalued transactions                           MD054354
     C           CCAP      IFNE 'C'                                                         MD026969
     C           NEWCOB    ANDNE'Y'                                                         MD054354
     C           WKFZAS    ANDEQ'Y'                                                         MD054354
     C                     EXSR SRFZAR                                                      MD026969
     C                     ENDIF                                                            MD026969
      *                                                                                     MD054354
     C                     MOVE '1'       *INLR
     C                     RETRN
      *
      *****************************************************************
     C/TITLE SR/AMTACC
      *****************************************************************
      *
      *  AMTACC - SUBROUTINE TO CALCULATE AMOUNT FOR ACCRUALS
      *
      *  In case of changes to this sub-routine, verify whether these apply to              MD031473
      *  SR/AMTACC as well, as sr/AMTACL is based on sr/AMTACC.                             MD031473
      *                                                                                     MD031473
      *  CALLED FROM: MAIN PROCESSING
      *
      *  CALLS: HISRED, REPHDR, ACCRUE
      *
      *****************************************************************
      *
     C           AMTACC    BEGSR
     C/COPY WNCPYSRC,LEH00676
      *                                                                                       CLE073
      ** If fee is loan based, then call AMTACL                                               CLE073
      *                                                                                       CLE073
     C           WFACLF    IFEQ 'N'                                                           CLE073
     C                     EXSR AMTACL                                                        CLE073
     C                     END                                                                CLE073
      *                                                                                       CLE073
     C           WFACLF    IFEQ 'Y'                                                           CLE073
      *
      ** Facility details are from facility history header (FACHISH)
      *
      ** Zeroize work fields & determine if actual amount to be used
      ** rather than average amount (depends on calculation type)
      *
     C                     Z-ADD0         WAMT
     C                     Z-ADD0         WPCT
     C                     MOVE '0'       *IN70
     C           CALT      IFGE 4
     C           CALT      ANDLE6
     C           CALT      ORGE 14
     C           CALT      ANDLE16
     C           CALT      OREQ 22
      ** Actual amounts used indicator
     C                     MOVE '1'       *IN70
     C                     END
      *
      ** If payment due set up start and end dates so amounts can
      ** be accrued correctly between these dates.
      *
     C           ATYP      IFEQ 'H'
      *                                                                                       258414
     C                     Z-ADD0         ADDUE                                               258414
      *                                                                   CLE005
      ** If CLE005 is on and last payment date is not zero, call          CLE005
      ** SR/RECALC.                                                       CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C           FELPDT    ANDNE0                                         CLE005
     C           FEINDC    ANDNE'Y'                                                           248358
     C********** FEINDC    ANDNE'Y'                                                    141453 227253
     C********** CLE005    OREQ 'Y'                                                    243496 245803
     C********** FENPYD    ANDNE0                                                      243496 245803
     C           CLE005    OREQ 'Y'                                                          243496B
     C           FELPDT    ANDNE0                                                             258414
     C           FENPYD    ANDNE0                                                            243496B
     C           FEINDC    ANDNE'Y'                                                           248358
     C           WFLAG     IFEQ *BLANK                                    153672
     C           WFLAG     OREQ 'Y'                                       153672
     C           FELPDT    ANDLEFEPEND                                    153672
     C           FENPYD    ANDEQ0                                         153672
     C           WFLAG     OREQ 'Y'                                       153672
     C           FELPDT    ANDLEFENPYD                                    153672
     C           FENPYD    ANDNE0                                         153672
     C                     EXSR RECALC                                    CLE005
     C                     ENDIF                                          153672
     C                     ENDIF                                          CLE005
     C                     Z-ADDFEAMTO    W#AMTO                                              258597
     C                     ADD  ADDUE     W#AMTO                                            MD055069
      *
     C                     Z-ADDFELPDT    STDATE         19
     C   19                Z-ADDFEPSTD    STDATE
     C/COPY WNCPYSRC,LER135C004
     C                     Z-ADDFENPYD    ENDATE         19
     C   19                Z-ADDFEPEND    ENDATE
      *                                                                                       233823
     C           *IN70     IFEQ '0'                                                           233823
     C                     Z-ADD0         WAMT                                                233823
     C                     ENDIF                                                              233823
      *
      ** If fee period end less than or equal to next working day
      ** make it the work end date.
      *
     C           FEPEND    IFLE BJDNWD
     C           FENPYD    ANDEQ0                                                           MD052216
     C           FEPEND    ORLE BJDNWD                                                      MD052216
     C           FENPYD    ANDEQFEPEND                                                      MD052216
     C                     Z-ADDFEPEND    ENDATE
     C                     END
      *
      ** If calculation is to be done on the average amount
      ** obtain number of days to use.
      *
     C           *IN70     IFEQ '0'
     C***********ENDATE    SUB  STDATE    WDAYS                           CLE013
     C                     Z-ADDSTDATE    ZZBEG                           CLE013
     C                     Z-ADDENDATE    ZZEND                           CLE013
     C                     MOVE FECALC    ZZCALC                          CLE013
     C                     EXSR ZINTDY                                    CLE013
     C           FECALC    IFEQ 6                                                             212048
     C                     Z-ADDINT6DY    WDAYS                                               212048
     C                     ELSE                                                               212048
     C                     Z-ADDZZINDY    WDAYS                           CLE013
     C                     END                                                                212048
      *                                                                   152166
      ** BKALDI should not be considered when calculating fees due        152166
      ** to be paid.                                                      152166
      *                                                                   152166
     C***********                                                  100525 138165
     C***Check*Accrue*on*Last*Day*indicator,*if*it*is*necessarry*to100525 138165
     C***add*or*subtract*the*the*total*no.*of*days*of*the*period.**100525 138165
     C***********                                                  100525 138165
     C***********FEPYON    IFEQ 'N'                                100525 138165
     C***********BKALDI    ANDNE'Y'                                100525 138165
     C***********FELPDT    IFEQ 0                                  100525 138165
     C***********          ADD  1         WDAYS                    100525 138165
     C***********          END                                     100525 138165
     C***********ENDATE    IFEQ FEPEND                             100525 138165
     C***********          SUB  1         WDAYS                    100525 138165
     C***********          END                                     100525 138165
     C***********          END                                     100525 138165
     C***********                                                  100525 138165
     C                     END
      *
      ** - daily accrual processing
      *
     C                     ELSE
      *
      ***Set*up*start*date*and*end*date*to*accrue*between.**End********   BH3480
      ***date*will*be*either*the*last*accrual*date*or*the*fee**********   BH3480
      ***period*start*date.********************************************   BH3480
      *****************************************************************   BH3480
     C**********           Z-ADDCODT      STDATE                          BH3480
     C**********           Z-ADDFELADT    ENDATE         19               BH3480
     C***19*****           Z-ADDFEPSTD    ENDATE                          BH3480
      *                                                                   BH3480
      ***  Set up start date and end date to accrue between.              BH3480
      *                                                                   BH3480
     C                     Z-ADDCODT      ENDATE                          BH3480
     C*                                                                   102005
     C** If payment processing is to be done today, make sure the         102005
     C** accrual period to be calculated will not exceed the payment      102005
     C** date.                                                            102005
     C*                                                                   102005
     C           @CHKD     IFEQ 'Y'                                       102005
     C********** CODT      IFGT FENPYD                                                 102005 258597
     C********** FENPYD    ANDNE0                                                      102005 258597
     C**********           Z-ADDFENPYD    ENDATE                                       102005 258597
     C**********           ELSE                                                        102005 258597
     C           CODT      IFGT FENPYD                                                        261129
     C           FENPYD    ANDNE0                                                             261129
     C           ATYP      ANDEQ'H'                                                           261129
     C                     Z-ADDFENPYD    ENDATE                                              261129
     C                     ELSE                                                               261129
     C           CODT      IFGT FEPEND                                    102005
     C                     Z-ADDFEPEND    ENDATE                          102005
     C                     END                                            102005
     C                     ENDIF                                                              261129
     C**********           END                                                         102005 258597
     C                     END                                            102005
      *                                                                   CLE005
      ** If CLE005 is on, start date should always be setup to            CLE005
      ** Fee Period Start Date.                                           CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C           FEINDC    ANDNE'Y'                                       141453
     C                     Z-ADDFEPSTD    STDATE                          CLE005
     C                     ELSE                                           CLE005
     C*                                                                   102005
     C**********           Z-ADDFELADT    STDATE                   BH3480 123004
     C                     Z-ADDFELPDT    STDATE                          123004
     C           STDATE    IFEQ 0                                         BH3480
     C                     Z-ADDFEPSTD    STDATE                          BH3480
     C                     END                                            BH3480
      *                                                                   CLE005
     C                     Z-ADDSTDATE    WSTDTE  50                      123004
      *                                                                   CLE005
     C                     ENDIF                                          CLE005
      *
      ***Control*date*less*end*date*gives*number*of*days*to*accrue.****   BH3480
      *****************************************************************   BH3480
     C********** CODT      SUB  ENDATE    WDAYS                           BH3480
      *****************************************************************   BH3480
      *****End*date*less*start*date*gives*number*of*days*to*accrue.****   BH3480
      *****************************************************************   BH3480
     C********** ENDATE    SUB  STDATE    WDAYS                           BH3480
      *****************************************************************   BH3480
      ***Check*last*day*accrual*indicator*on*SDGELRPD.**If*last********   BH3480
      ***day*accrual*increment*number*of*days*only*if*today*is*also****   BH3480
      ***the*end*of*the*fee*period.**If*first*day*accrual*add*one*day.*   BH3480
      *****************************************************************   BH3480
     C********** ENDATE    IFEQ FEPSTD                                    BH3480
     C********** STDATE    IFEQ FEPSTD                                    BH3480
     C********** BKALDI    ANDNE'Y'                                       BH3480
     C********** FELADT    ANDEQ0                                         BH3480
     C********** BKALDI    OREQ 'Y'                                       BH3480
     C********** CODT      ANDEQFEPEND                                    BH3480
     C**********           ADD  1         WDAYS                           BH3480
     C**********           END                                            BH3480
      *
     C                     END
      *                                                                   CLE005
      ** If CLE005 is on, save value of STDATE.                           CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C           FEINDC    IFNE 'Y'                                                           227253
     C                     Z-ADDSTDATE    STRDTE  50                      CLE005
     C                     ELSE                                                               227253
     C                     Z-ADDFEPSTD    STRDTE                                              227253
     C                     ENDIF                                                              227253
     C                     ENDIF                                          CLE005
     C*                                                                   138421
     C                     Z-ADDSTDATE    STRDT1  50                      138421
     C*                                                                   138421
      *
      ** Get starting amount from facility history amount file.
      ** If payment due, from history record prior to start date.
      ***If*daily*accrual,*from*latest*history*record*for*facility.****   BH3480
      *** If daily accrual, from history record for facility on or
      *** before the last accrual date for the fee.
      *
     C           HSAKY1    SETGTFACHSAL1
     C                     READPFACHSAL1                 20
      *
      ** Set up current facility amount from file.
      *
     C                     Z-ADDFACFAM    CFAMT
      *
      ** Set up amount for accrual according to calculation type.
      ** Calculation types 01 to 06 use available facility amount,
      ** types 11 to 16 use outstanding facility amount and
      ** types 21 and 22 use the current facility amount.
      *
     C           CALT      IFLE 6
     C           FAUNDR    IFGE 0
     C                     Z-ADDFAUNDR    AAMT
     C                     ELSE
     C                     Z-ADD0         AAMT
     C                     END
     C                     ELSE
     C           CALT      IFLE 16
     C                     Z-ADDFADRAM    AAMT
     C                     ELSE
     C           CALT      IFLE 22
     C                     Z-ADDFACFAM    AAMT
     C                     END
     C                     END
     C                     END
      *
      ** Initialise work fee field.
      *
     C                     Z-ADDWFEE      WFEE1  130                      153672
     C                     Z-ADD0         WFEE
     C           FELPDT    IFGT FEPEND                                    153672
     C           FENPYD    ANDEQ0                                         153672
     C           FELPDT    ORGT FENPYD                                    153672
     C           FENPYD    ANDNE0                                         153672
     C           ATYP      IFEQ 'H'                                       153672
     C                     Z-ADDWFEE1     WFEE                            153672
     C                     ELSE                                           153672
     C                     Z-ADDFELPAM    WLPAM  130                      153672
     C                     Z-ADDFEAMTP    FELPAM                          153672
     C                     Z-ADDWLPAM     FEAMTP                          153672
     C                     Z-ADDWLPAM     FEAMTO                          153672
     C                     ENDIF                                          153672
     C                     ENDIF                                          153672
     C*                                                                   BH3465
     C** Don't output the header details if there are no details to       BH3465
     C** report                                                           BH3465
     C*                                                                   BH3465
     C***Set*up*&*output headings to fee calculation report - output      BH3465
     C***even*when there are no details to report.                        BH3465
     C************                                                        BH3465
     C************         EXSR REPHDR                                    BH3465
      *
      ** For payment processing (i.e., final correct accrual figures)
      ** read through history to calculate amount.
      *
     C           ATYP      IFEQ 'H'
     C*                                                                   BH3465
     C                     EXSR REPHDR                                    BH3465
     C/COPY WNCPYSRC,LER135C025
      *
     C                     EXSR HISRED
      *
     C***For*straight*daily*accrual,*amount*can*be*taken*from*the******   BH3480
     C***last*accrual*amount*calculated.*******************************   BH3480
      *
     C***  For straight daily accrual, must take account of non-working   BH3480
     C***  days, and back dated fees                                      BH3480
     C*                                                                   BH3480
     C                     ELSE
      *
     C**********           Z-ADDAAMT      WAMT                            BH3480
     C*                                                                   BH3480
     C***  Don't do start date of fee for last day accruals               BH3480
     C*                                                                   BH3480
     C           FEPSTD    IFLT CODT                                      BH3480
     C           BKALDI    ANDEQ'Y'                                       BH3480
     C           BKALDI    ORNE 'Y'                                       BH3480
      *                                                                                      BUG8762
     C           CLE005    IFEQ 'Y'                        IF1                               BUG8762
     C           FEINDC    ANDNE'Y'                                                          BUG8762
     C           CLE071    OREQ 'Y'                                                           CLE071
     C           FEINDC    ANDNE'Y'                                                           CLE071
     C                     EXSR AMTAC2                                                       BUG8762
     C                     ELSE                                                              BUG8762
     C/COPY WNCPYSRC,LER135C026
     C*                                                                   BH3480
     C** Read file until date read is greater than date of end of         BH3480
     C** this accrual period.  This processing can be done more           BH3480
     C** than once for actual type calculations so it is necessary        BH3480
     C** to reset FADATE each time.   NDAYS is the number of              BH3480
     C** number of days in this accrual.                                  BH3480
     C*                                                                   BH3480
     C                     MOVE '0'       *IN28                           142402
     C                     MOVE '0'       *IN18                           BH3480
     C           *IN18     DOWEQ'0'                                       BH3480
     C           HSAKY2    READEFACHSAL1                 18               BH3480
     C*                                                                   BH3480
     C           *IN18     IFEQ '1'                                       BH3480
     C           FADATE    ORGT ENDATE                                    BH3480
     C           BKALDI    ANDNE'Y'                                       BH3480
     C           FADATE    ORGE ENDATE                                    BH3480
     C           BKALDI    ANDEQ'Y'                                       BH3480
     C                     Z-ADDENDATE    FADATE                          BH3480
     C                     MOVE '1'       *IN18                           BH3480
     C/COPY WNCPYSRC,LER135C027
     C                     END                                            BH3480
     C*                                                                   BH3480
     C***********FADATE    SUB  STDATE    NDAYS                    BH3480 CLE013
     C                     Z-ADDSTDATE    ZZBEG                           CLE013
     C                     Z-ADDFADATE    ZZEND                           CLE013
     C                     MOVE FECALC    ZZCALC                          CLE013
     C**********           EXSR ZINTDY                                               CLE013 MD023855
     C********** FECALC    IFEQ 6                                                    212048 MD023855
     C**********           Z-ADDINT6DY    NDAYS                                      212048 MD023855
     C**********           ELSE                                                      212048 MD023855
     C**********           Z-ADDZZINDY    NDAYS                                      CLE013 MD023855
     C**********           END                                                       212048 MD023855
     C***********                                                  090939 100525
     C***Check*Accrue*on*Last*Day*Indicator*on*SDGELRPD.**Add*1*day090939 100525
     C***fee*period*if*(i)*system*on*first*day*accruals*and*fee*sta090939 100525
     C***date*is*same*as*period*start*date*or*(ii)*system*on*last*d090939 100525
     C***accruals*and*fee*end*date*is*same*as*period*end*date.*****090939 100525
     C***********FADATE    IFEQ FEPSTD                             090939 100525
     C***********STDATE    IFEQ FEPSTD                             090939 100525
     C***********BKALDI    ANDNE'Y'                                090939 100525
     C***********FELADT    ANDEQ0                                  090939 100525
     C***********BKALDI    OREQ 'Y'                                090939 100525
     C***********CODT      ANDEQFEPEND                             090939 100525
     C***********          ADD  1         NDAYS                    090939 100525
     C***********          END                                     090939 100525
     C***********          END                                     090939 100525
     C**********                                                                       BH3480BUG6213
     C***Check*Accrue*in*Last*Day*indicator*in*SDGELRPD.*Add*1*day*****                100525BUG6213
     C***torfeeaperiod*if*systemein*first*day*accrual*and*it*is*the****                100525BUG6213
     C***first*accrual*of*the*fee.*************************************                100525BUG6213
     C**********                                                                       100525BUG6213
      ***Check*if*CLE005*is*on.****************************************                CLE005BUG6213
      **********                                                                       CLE005BUG6213
     C********** CLE005    IFEQ 'Y'                                                    CLE005BUG6213
     C********** FEINDC    ANDNE'Y'                                                    206539 206539
     C********** BKALDI    IFNE 'Y'                                                    CLE005BUG6213
     C********** FEPSTD    ANDEQSTRDTE                                                 CLE005BUG6213
     C********** FADATE    ANDEQENDATE                                                 CLE005BUG6213
     C********** FEPEND    ANDGTCODT                                                   CLE005BUG6213
     C********** *IN18     ANDEQ'1'                                                    CLE005BUG6213
     C**********           ADD  1         NDAYS                                        CLE005BUG6213
     C**********           ENDIF                                                       CLE005BUG6213
     C**********           ELSE                                                        CLE005BUG6213
      **********                                                                       CLE005BUG6213
     C********** BKALDI    IFNE 'Y'                                                    100525BUG6213
     C***********FELADT    ANDEQ0                                  100525 123004
     C********** FEPSTD    ANDEQWSTDTE                                                 123004BUG6213
     C********** FADATE    ANDEQENDATE                                                 100525BUG6213
     C********** FEPEND    ANDGTCODT                                                   100525BUG6213
     C********** *IN18     ANDEQ'1'                                                    100525BUG6213
     C**********           ADD  1         NDAYS                                        100525BUG6213
     C**********           END                                                         100525BUG6213
     C**********                                                                       100525BUG6213
      **********                                                                       CLE005BUG6213
     C***If*Start*date*is*equal*to*Last*Payment*Date*add*1*day.********                138421BUG6213
     C**********                                                                       138421BUG6213
     C********** BKALDI    IFNE 'Y'                                                    138421BUG6213
     C********** FELPDT    ANDNE0                                                      138421BUG6213
     C********** FELPDT    ANDEQSTRDT1                                                 138421BUG6213
     C********** FADATE    ANDEQENDATE                                                 138421BUG6213
     C********** FEPEND    ANDGTCODT                                                   138421BUG6213
     C********** *IN18     ANDEQ'1'                                                    138421BUG6213
     C**********           ADD  1         NDAYS                                        138421BUG6213
     C**********           END                                                         138421BUG6213
     C**********                                                                       138421BUG6213
     C**********           ENDIF                                                       CLE005BUG6213
      *                                                                                       239961
      ** Check Accrue in Last Day indicator in SDGELRPD. Add 1 day                            239961
      ** to fee period if system in first day accrual and it is the                           239961
      ** first accrual of the fee.                                                            239961
      *                                                                                       239961
      ** Check if CLE005 is on.                                                               239961
      *                                                                                       239961
     C           CLE005    IFEQ 'Y'                                                           239961
     C           FEINDC    ANDNE'Y'                                                           239961
     C           BKALDI    IFNE 'Y'                                                           239961
     C           FEPSTD    ANDEQSTRDTE                                                        239961
     C           FADATE    ANDEQENDATE                                                        239961
     C           FEPEND    ANDGTCODT                                                          239961
     C           *IN18     ANDEQ'1'                                                           239961
     C**********           ADD  1         NDAYS                                      239961 MD023855
     C                     ADD  1         ZZEND                                             MD023855
     C                     ENDIF                                                              239961
      ** IF START DATE IS EQUAL TO LAST PAYMENT DATE ADD 1 DAY.                             MD023855
      *                                                                                     MD023855
     C           BKALDI    IFNE 'Y'                                                         MD023855
     C           FELPDT    ANDNE0                                                           MD023855
     C           FELPDT    ANDEQSTRDT1                                                      MD023855
     C           FADATE    ANDEQENDATE                                                      MD023855
     C           FEPEND    ANDGTCODT                                                        MD023855
     C           *IN18     ANDEQ'1'                                                         MD023855
     C                     ADD  1         ZZEND                                             MD023855
     C                     END                                                              MD023855
     C*                                                                                     MD023855
     C                     ELSE                                                               239961
      *                                                                                       239961
     C           BKALDI    IFNE 'Y'                                                           239961
     C           FEPSTD    ANDEQWSTDTE                                                        239961
     C           FADATE    ANDEQENDATE                                                        239961
     C           FEPEND    ANDGTCODT                                                          239961
     C           *IN18     ANDEQ'1'                                                           239961
     C**********           ADD  1         NDAYS                                      239961 MD023855
     C                     ADD  1         ZZEND                                             MD023855
     C                     END                                                                239961
      *                                                                                       239961
      ** If Start date is equal to Last Payment Date add 1 day.                               239961
      *                                                                                       239961
     C           BKALDI    IFNE 'Y'                                                           239961
     C           FELPDT    ANDNE0                                                             239961
     C           FELPDT    ANDEQSTRDT1                                                        239961
     C           FADATE    ANDEQENDATE                                                        239961
     C           FEPEND    ANDGTCODT                                                          239961
     C           *IN18     ANDEQ'1'                                                           239961
     C**********           ADD  1         NDAYS                                      239961 MD023855
     C                     ADD  1         ZZEND                                             MD023855
     C                     END                                                                239961
      *                                                                                       239961
     C                     ENDIF                                                              239961
      *                                                                                     MD023855
     C                     EXSR ZINTDY                                                      MD023855
     C           FECALC    IFEQ 6                                                           MD023855
     C                     Z-ADDINT6DY    NDAYS                                             MD023855
     C                     ELSE                                                             MD023855
     C                     Z-ADDZZINDY    NDAYS                                             MD023855
     C                     END                                                              MD023855
      *                                                                                     MD023855
     C/COPY WNCPYSRC,LER135C005
     C           NDAYS     IFGT 0                                         BH3480
     C*                                                                   BH3480
     C           FEORED    IFEQ BJRDNB                                    142402
     C           FEPSTD    ANDLTMSTD                                      142402
     C           *IN28     ANDEQ'0'                                       142402
      *                                                                   142402
     C**********           Z-ADDNDAYS     WDAYS2  50                                 142402 BUG23174
     C                     Z-ADDNDAYS     WDAYS2 159                                        BUG23174
      *                                                                   142402
     C           FADATE    IFGT MSTD                                      142402
      *                                                                   142402
     C           FADATE    SUB  MSTD      DIFF    50                      142402
     C           DIFF      ADD  1         DIFF                            142402
     C           WDAYS2    SUB  DIFF      WDAYS2                          142402
     C                     MOVE '1'       *IN28                           142402
      *                                                                   142402
     C                     ENDIF                                          142402
      *                                                                   142402
     C                     Z-ADDWDAYS2    WDAYS                           142402
     C                     Z-ADDAAMT      WAMT                            142402
     C                     MOVELFEPIND    WKPIND                                              CLE071
     C/COPY WNCPYSRC,LER135C028
     C                     EXSR ACCRUE                                    142402
     C/COPY WNCPYSRC,LER135C029
     C                     ADD  WTOT      WAGG2  130                      142402
      *                                                                   142402
     C                     ENDIF                                          142402
      *                                                                   142402
     C/COPY WNCPYSRC,LER135C030
     C                     Z-ADDNDAYS     WDAYS                           BH3480
     C                     Z-ADDAAMT      WAMT                            BH3480
     C                     MOVELFEPIND    WKPIND                                              CLE071
     C                     EXSR ACCRUE
     C                     ADD  WTOT      WFEE                            BH3480
     C                     Z-ADDFADATE    STDATE                          BH3480
     C/COPY WNCPYSRC,LER135C031
     C                     END                                            BH3480
     C*                                                                   BH3480
     C** Reset amount to accrue - comes from next record on amounts       BH3480
     C** file.                                                            BH3480
     C*                                                                   BH3480
     C/COPY WNCPYSRC,LER135C032
     C                     Z-ADDFACFAM    CFAMT                           BH3480
     C           CALT      IFLE 6                                         BH3480
     C           FAUNDR    IFGE 0                                         BH3480
     C                     Z-ADDFAUNDR    AAMT                            BH3480
     C                     ELSE                                           BH3480
     C                     Z-ADD0         AAMT                            BH3480
     C                     END                                            BH3480
     C                     ELSE                                           BH3480
     C           CALT      IFLE 16                                        BH3480
     C                     Z-ADDFADRAM    AAMT                            BH3480
     C                     ELSE                                           BH3480
     C           CALT      IFLE 22                                        BH3480
     C                     Z-ADDFACFAM    AAMT                            BH3480
     C                     END                                            BH3480
     C                     END                                            BH3480
     C                     END                                            BH3480
     C*                                                                   BH3480
     C                     END                                            BH3480
      *                                                                                      BUG8762
     C                     ENDIF                           ENDIF1                            BUG8762
     C*                                                                   BH3480
     C                     END                                            BH3480
     C*                                                                   BH3480
     C**********           Z-ADDWTOT      WFEE                            BH3480
      *
     C/COPY WNCPYSRC,LER135C033
     C                     END
      *
      ** Output end of report for customer when record changes.
      *
     C*                                                                   BH3465
     C** Check the flag before the write of the end of fee message        BH3465
     C*                                                                   BH3465
     C           FLAGR     IFEQ 'Y'                                       BH3465
     C***/COPY*WNCPYSRC,LEH01031***                                                           CFC006
     C/COPY WNCPYSRC,LEH01031                                                               MD020563
     C           SUPFL2    ANDNE'Y'                                                           CFC006
     C                     WRITELER135B9
     C*                                                                   BH3465
     C** and reset the flag after                                         BH3465
     C*                                                                   BH3465
     C                     MOVE ' '       FLAGR                           BH3465
     C                     END                                            BH3465
     C/COPY WNCPYSRC,LEH00677
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
      *
     C                     ENDSR
      *                                                                                      BUG8762
      *****************************************************************                      BUG8762
     C/TITLE SR/AMTAC2                                                                       BUG8762
      *****************************************************************                      BUG8762
      *                                                                                      BUG8762
      *  AMTAC2 - SUBROUTINE TO CALCULATE AMOUNT FOR ACCRUALS                                BUG8762
      *                                                                                      BUG8762
      *  CALLED FROM: AMTACC                                                                 BUG8762
      *                                                                                      BUG8762
      *  CALLS: AMTAC3                                                                       BUG8762
      *                                                                                      BUG8762
      *****************************************************************                      BUG8762
      *                                                                                      BUG8762
     C           AMTAC2    BEGSR                                                             BUG8762
      *                                                                                      BUG8762
      ** Note that this SR is called with CLE005 on and FEINDC *NE 'Y'.                      BUG8762
      *                                                                                      BUG8762
      ** Processing when CLE071 is Disabled                                                   CLE071
      *                                                                                       CLE071
     C           CLE071    IFEQ 'N'                                                           CLE071
      *                                                                                      BUG8762
      ** Move rates and amounts from LEFEED to working arrays.                               BUG8762
      *                                                                                      BUG8762
     C                     Z-ADDFAMT      @WAMT                                              BUG8762
     C                     Z-ADDFRT       @WRT                                               BUG8762
     C                     MOVELFEPIND    WKPIND                                              CLE071
      *                                                                                      BUG8762
      ** Read LEFHST to get the right rates and amounts for                                  BUG8762
      ** for specific fee period.                                                            BUG8762
      *                                                                                      BUG8762
     C********** LEFKEY    SETLLLEFHSTL2                                              BUG8762 250628
     C********** LEFKEY    READELEFHSTL2            N    27                           BUG8762 250628
     C           LEFKEY    SETLLLEFHSTL7                                                      250628
     C           LEFKEY    READELEFHSTL7            N    27                                   250628
     C           *IN27     IFEQ '0'                                                          BUG8762
     C           *IN27     DOWEQ'0'                                                          BUG8762
      *                                                                                      BUG8762
      ** Move rates and amounts from historical file to FAMT & FRT.                          BUG8762
      *                                                                                      BUG8762
     C                     Z-ADD@HAMT     FAMT                                               BUG8762
     C                     Z-ADD@HRT      FRT                                                BUG8762
     C                     Z-ADDHIHDAT    ENDATE                                             BUG8762
      *                                                                                      BUG8762
     C           HSAKY1    SETGTFACHSAL1                                                     BUG8762
     C                     READPFACHSAL1                 20                                  BUG8762
      *                                                                                      BUG8762
     C                     EXSR AMTAC3                                                       BUG8762
     C                     Z-ADDENDATE    STDATE                                             BUG8762
     C********** LEFKEY    READELEFHSTL2            N    27                           BUG8762 250628
     C           LEFKEY    READELEFHSTL7            N    27                                   250628
     C                     ENDDO                                                             BUG8762
      *                                                                                      BUG8762
      ** Move rates and amounts from working arrays back to FAMT & FRT.                      BUG8762
      *                                                                                      BUG8762
     C                     Z-ADD@WAMT     FAMT                                               BUG8762
     C                     Z-ADD@WRT      FRT                                                BUG8762
      *                                                                                      BUG8762
     C           *IN27     IFEQ '1'                                                          BUG8762
     C           CODT      ANDGTENDATE                                                       BUG8762
     C                     Z-ADDCODT      ENDATE                                             BUG8762
      *                                                                                       258597
     C           @CHKD     IFEQ 'Y'                                                           258597
     C           CODT      IFGT FEPEND                                                        258597
     C                     Z-ADDFEPEND    ENDATE                                              258597
     C                     ELSE                                                               261129
     C           ATYP      IFEQ 'H'                                                           261129
     C           FENPYD    ANDLTCODT                                                          261129
     C           FENPYD    ANDNE0                                                             261129
     C                     Z-ADDFENPYD    ENDATE                                              261129
     C                     ENDIF                                                              261129
     C                     ENDIF                                                              258597
     C                     ENDIF                                                              258597
      *                                                                                       258597
     C           HSAKY1    SETGTFACHSAL1                                                     BUG8762
     C                     READPFACHSAL1                 20                                  BUG8762
     C                     EXSR AMTAC3                                                       BUG8762
     C                     ENDIF                                                             BUG8762
      *                                                                                      BUG8762
     C                     ELSE                                                              BUG8762
     C                     Z-ADDCODT      ENDATE                                             BUG8762
      *                                                                                       258597
     C           @CHKD     IFEQ 'Y'                                                           258597
     C           CODT      IFGT FEPEND                                                        258597
     C                     Z-ADDFEPEND    ENDATE                                              258597
     C                     ELSE                                                               261129
     C           ATYP      IFEQ 'H'                                                           261129
     C           FENPYD    ANDLTCODT                                                          261129
     C           FENPYD    ANDGT0                                                             261129
     C                     Z-ADDFENPYD    ENDATE                                              261129
     C                     ENDIF                                                              261129
     C                     ENDIF                                                              258597
     C                     ENDIF                                                              258597
      *                                                                                       258597
     C           HSAKY1    SETGTFACHSAL1                                                     BUG8762
     C                     READPFACHSAL1                 20                                  BUG8762
     C                     EXSR AMTAC3                                                       BUG8762
     C                     ENDIF                                                             BUG8762
      *                                                                                      BUG8762
     C                     ELSE                                                               CLE071
      *                                                                                       CLE071
      ** Processing when CLE071 is Enabled                                                    CLE071
      *                                                                                       CLE071
      ** Move rates and amounts from LEFEED to working arrays.                                CLE071
      *                                                                                       CLE071
     C                     Z-ADDFAMT      @WAMT                                               CLE071
     C                     Z-ADDFRT       @WRT                                                CLE071
     C                     MOVELFEPIND    WKPIND                                              CLE071
      *                                                                                       CLE071
      ** Read LEFHST to get rate change for specific period                                   CLE071
      *                                                                                       CLE071
     C           LFKEY2    SETGTLEFHSTFB                                                      CLE071
     C           LFKEY3    REDPELEFHSTFB                 27                                   CLE071
      *                                                                                       CLE071
     C                     Z-ADD@HAMT     FAMT                                                CLE071
     C                     Z-ADD@HRT      FRT                                                 CLE071
     C                     MOVELHIPIND    WKPIND                                              CLE071
      *                                                                                       CLE071
     C           LFKEY3    READELEFHSTFB                 27                                   CLE071
      *                                                                                       CLE071
     C           *IN27     IFEQ '0'                                                           CLE071
      *                                                                                       CLE071
     C           *IN27     DOWEQ'0'                                                           CLE071
     C                     Z-ADDHIRCVD    ENDATE                                              CLE071
     C           HSAKY1    SETGTFACHSAL1                                                      CLE071
     C                     READPFACHSAL1                 20                                   CLE071
     C                     MOVEL'N'       WKADDY  1                                           CLE071
      *                                                                                       258414
     C           HIRCTP    IFEQ 'RC'                                                          258414
     C                     MOVE 'RD'      RCACT   2                                           258414
     C                     Z-ADDHIRCVD    RCDAT   50                                          258414
     C                     ELSE                                                               258414
     C                     MOVE *BLANKS   RCACT                                               258414
     C                     Z-ADD*ZEROS    RCDAT   50                                          258414
     C                     ENDIF                                                              258414
      *                                                                                       258414
     C                     EXSR AMTAC3                                                        CLE071
     C                     MOVELENDATE    STDATE                                              CLE071
     C                     MOVEL@HAMT     FAMT                                                CLE071
     C                     MOVEL@HRT      FRT                                                 CLE071
     C                     MOVELHIPIND    WKPIND                                              CLE071
     C           LFKEY3    READELEFHSTFB                 27                                   CLE071
     C                     ENDDO                                                              CLE071
      *                                                                                       CLE071
     C           ATYP      IFEQ 'H'                                                           258414
     C                     Z-ADDFENPYD    ENDATE         19                                   258414
     C   19                Z-ADDFEPEND    ENDATE                                              258414
     C           FEPEND    IFLE BJDNWD                                                        258414
     C                     Z-ADDFEPEND    ENDATE                                              258414
     C                     END                                                                258414
      *                                                                                       258414
     C           ENDATE    IFGE STDATE                                                        258414
     C                     MOVEL'Y'       WKADDY                                              258414
     C           HSAKY1    SETGTFACHSAL1                                                      258414
     C                     READPFACHSAL1                 20                                   258414
     C                     EXSR AMTAC3                                                        258414
     C                     ENDIF                                                              258414
      *                                                                                       258414
     C                     ELSE                                                               258414
     C           CODT      IFGE STDATE                                                        CLE071
     C                     MOVEL'Y'       WKADDY                                              CLE071
     C                     MOVELCODT      ENDATE                                              CLE071
     C           HSAKY1    SETGTFACHSAL1                                                      CLE071
     C                     READPFACHSAL1                 20                                   CLE071
     C                     EXSR AMTAC3                                                        CLE071
     C                     ENDIF                                                              CLE071
     C                     ENDIF                                                              258414
      *                                                                                       CLE071
     C                     MOVEL@WAMT     FAMT                                                CLE071
     C                     MOVEL@WRT      FRT                                                 CLE071
      *                                                                                       CLE071
     C                     ELSE                                                               CLE071
      *                                                                                       CLE071
     C           ATYP      IFEQ 'H'                                                           258414
     C                     Z-ADDFENPYD    ENDATE         19                                   258414
     C   19                Z-ADDFEPEND    ENDATE                                              258414
     C           FEPEND    IFLE BJDNWD                                                        258414
     C                     Z-ADDFEPEND    ENDATE                                              258414
     C                     END                                                                258414
      *                                                                                       258414
     C           ENDATE    IFGE STDATE                                                        258414
     C                     MOVEL'Y'       WKADDY                                              258414
     C           HSAKY1    SETGTFACHSAL1                                                      258414
     C                     READPFACHSAL1                 20                                   258414
     C                     EXSR AMTAC3                                                        258414
     C                     ENDIF                                                              258414
      *                                                                                       258414
     C                     ELSE                                                               258414
      *                                                                                       258414
     C           CODT      IFGE STDATE                                                        CLE071
     C                     MOVEL'Y'       WKADDY                                              CLE071
     C                     MOVELCODT      ENDATE                                              CLE071
     C           HSAKY1    SETGTFACHSAL1                                                      CLE071
     C                     READPFACHSAL1                 20                                   CLE071
     C                     EXSR AMTAC3                                                        CLE071
     C                     ENDIF                                                              CLE071
     C                     ENDIF                                                              258414
     C                     ENDIF                                                              CLE071
     C                     ENDIF                                                              CLE071
      *                                                                                       CLE071
     C                     ENDSR                                                             BUG8762
      *                                                                                      BUG8762
      *****************************************************************                      BUG8762
     C/TITLE SR/AMTAC3                                                                       BUG8762
      *****************************************************************                      BUG8762
      *                                                                                      BUG8762
      *  AMTAC3 - SUBROUTINE TO CALCULATE AMOUNT FOR ACCRUALS                                BUG8762
      *                                                                                      BUG8762
      *  CALLED FROM: AMTAC2                                                                 BUG8762
      *                                                                                      BUG8762
      *  CALLS: ACCRUE                                                                       BUG8762
      *                                                                                      BUG8762
      *****************************************************************                      BUG8762
      *                                                                                      BUG8762
     C           AMTAC3    BEGSR                                                             BUG8762
      *                                                                                      BUG8762
     C                     Z-ADDFACFAM    CFAMT                                              BUG8762
     C           CALT      IFLE 6                                                            BUG8762
     C           FAUNDR    IFGE 0                                                            BUG8762
     C                     Z-ADDFAUNDR    AAMT                                               BUG8762
     C                     ELSE                                                              BUG8762
     C                     Z-ADD0         AAMT                                               BUG8762
     C                     ENDIF                                                             BUG8762
     C                     ELSE                                                              BUG8762
     C           CALT      IFLE 16                                                           BUG8762
     C                     Z-ADDFADRAM    AAMT                                               BUG8762
     C                     ELSE                                                              BUG8762
     C           CALT      IFLE 22                                                           BUG8762
     C                     Z-ADDFACFAM    AAMT                                               BUG8762
     C                     ENDIF                                                             BUG8762
     C                     ENDIF                                                             BUG8762
     C                     ENDIF                                                             BUG8762
      *                                                                                      BUG8762
      ** Read file until date read is greater than date of end of                            BUG8762
      ** this accrual period.                                                                BUG8762
      *                                                                                      BUG8762
     C                     MOVE '0'       *IN18                                              BUG8762
     C           *IN18     DOWEQ'0'                                                          BUG8762
     C           HSAKY2    READEFACHSAL1                 18                                  BUG8762
      *                                                                                      BUG8762
     C           *IN18     IFEQ '1'                                                          BUG8762
     C           FADATE    ORGT ENDATE                                                       BUG8762
     C           BKALDI    ANDNE'Y'                                                          BUG8762
     C           FADATE    ORGE ENDATE                                                       BUG8762
     C           BKALDI    ANDEQ'Y'                                                          BUG8762
     C                     Z-ADDENDATE    FADATE                                             BUG8762
     C                     MOVE '1'       *IN18                                              BUG8762
     C                     ENDIF                                                             BUG8762
      *                                                                                       258414
     C  N18                Z-ADDFADATE    FDAT1   50                                          258414
     C  N18                MOVELFAACTN    ACT1    2                                           258414
     C           RCDAT     IFLE FADATE                                                        258414
     C           RCACT     ANDEQ'RD'                                                          258414
     C                     Z-ADDRCDAT     FDAT1   50                                          258414
     C                     MOVELRCACT     ACT1    2                                           258414
     C                     ENDIF                                                              258414
      *                                                                                      BUG8762
      ** Fee Calculation Basis should be considered when computing                           BUG8762
      ** for the no. of days to be accrued.                                                  BUG8762
      *                                                                                      BUG8762
     C                     Z-ADD0         ZZINDY                                             BUG8762
     C                     Z-ADDFADATE    ZZEND                                              BUG8762
     C                     Z-ADDSTDATE    ZZBEG                                              BUG8762
     C                     MOVE FECALC    ZZCALC                                             BUG8762
     C**********           EXSR ZINTDY                                              BUG8762 MD054703
     C********** FECALC    IFEQ 6                                                    212048 MD054703
     C**********           Z-ADDINT6DY    NDAYS                                      212048 MD054703
     C**********           ELSE                                                      212048 MD054703
     C**********           Z-ADDZZINDY    NDAYS                                     BUG8762 MD054703
     C**********           END                                                       212048 MD054703
      *                                                                                      BUG8762
      ** Add 1 day if first day accrual.                                                     BUG8762
      *                                                                                      BUG8762
     C           BKALDI    IFNE 'Y'                                                          BUG8762
     C           FEPSTD    ANDEQSTRDTE                                                       BUG8762
     C           FADATE    ANDEQENDATE                                                       BUG8762
     C           CODT      ANDEQENDATE                                                       BUG8762
     C           FEPEND    ANDGTCODT                                                         BUG8762
     C           *IN18     ANDEQ'1'                                                          BUG8762
     C           CLE071    IFNE 'Y'                                                           CLE071
     C           WKADDY    OREQ 'Y'                                                           CLE071
     C**********           ADD  1         NDAYS                                     BUG8762 MD054703
     C                     ADD  1         ZZEND                                             MD054703
     C                     ENDIF                                                              CLE071
     C                     ENDIF                                                             BUG8762
      *                                                                                      BUG8762
     C                     EXSR ZINTDY                                                      MD054703
     C           FECALC    IFEQ 6                                                           MD054703
     C                     Z-ADDINT6DY    NDAYS                                             MD054703
     C                     ELSE                                                             MD054703
     C                     Z-ADDZZINDY    NDAYS                                             MD054703
     C                     END                                                              MD054703
      *                                                                                     MD054703
     C           NDAYS     IFGT 0                                                            BUG8762
     C           FEORED    IFEQ BJRDNB                                                       BUG8762
     C           FEPSTD    ANDLTMSTD                                                         BUG8762
      *                                                                                      BUG8762
      ** Only perform calculation if not called from HISRED                                   CLE071
      *                                                                                       CLE071
     C           FLAGR     IFEQ ' '                                                           CLE071
     C**********           Z-ADDNDAYS     WDAYS2  50                                BUG8762 BUG23174
     C                     Z-ADDNDAYS     WDAYS2 159                                        BUG23174
     C           FADATE    IFGT MSTD                                                         BUG8762
     C           FADATE    SUB  MSTD      DIFF    50                                         BUG8762
     C           DIFF      ADD  1         DIFF                                               BUG8762
     C           WDAYS2    SUB  DIFF      WDAYS2                                             BUG8762
     C                     MOVE '1'       *IN28                                              BUG8762
     C                     ENDIF                                                             BUG8762
      *                                                                                      BUG8762
     C                     Z-ADDWDAYS2    WDAYS                                              BUG8762
     C                     Z-ADDAAMT      WAMT                                               BUG8762
     C                     EXSR ACCRUE                                                       BUG8762
     C                     ADD  WTOT      WAGG2  130                                         BUG8762
     C                     ENDIF                                                              CLE071
     C                     ENDIF                                                             BUG8762
      *                                                                                      BUG8762
     C           FLAGR     IFEQ 'Y'                                                           258414
     C                     Z-ADD0         RPT                                                 258414
     C                     EXSR REPDTL                                                        258414
     C           ACT1      LOKUPTABACC    TABACN         26                                   258414
     C                     MOVELTABACN    ACTN                                                258414
     C                     Z-ADDFDAT1     @FDATE                                              258414
     C                     MOVELACT1      @FACTN                                              CLE071
      *                                                                                       258414
     C           ACT1      IFEQ 'RD'                                                          258414
     C                     MOVE *BLANKS   RCACT                                               258414
     C                     Z-ADD0         RCDAT                                               258414
     C                     ENDIF                                                              258414
      *                                                                                       258414
     C                     ENDIF                                                              258414
      *                                                                                       258414
     C                     Z-ADDNDAYS     WDAYS                                              BUG8762
     C                     Z-ADDAAMT      WAMT                                               BUG8762
     C                     EXSR ACCRUE                                                       BUG8762
     C                     ADD  WTOT      WFEE                                               BUG8762
     C                     Z-ADDFADATE    STDATE                                             BUG8762
     C                     ENDIF                                                             BUG8762
      *                                                                                      BUG8762
      ** Reset amount to accrue - comes from next record on amounts                          BUG8762
      ** file.                                                                               BUG8762
      *                                                                                      BUG8762
     C                     Z-ADDFACFAM    CFAMT                                              244411B
     C           CALT      IFLE 6                                                            BUG8762
     C           FAUNDR    IFGE 0                                                            BUG8762
     C                     Z-ADDFAUNDR    AAMT                                               BUG8762
     C                     ELSE                                                              BUG8762
     C                     Z-ADD0         AAMT                                               BUG8762
     C                     ENDIF                                                             BUG8762
     C                     ELSE                                                              BUG8762
     C           CALT      IFLE 16                                                           BUG8762
     C                     Z-ADDFADRAM    AAMT                                               BUG8762
     C                     ELSE                                                              BUG8762
     C           CALT      IFLE 22                                                           BUG8762
     C                     Z-ADDFACFAM    AAMT                                               BUG8762
     C                     ENDIF                                                             BUG8762
     C                     ENDIF                                                             BUG8762
     C                     ENDIF                                                             BUG8762
      *                                                                                      BUG8762
     C                     ENDDO                                                             BUG8762
      *                                                                                      BUG8762
     C                     ENDSR                                                             BUG8762
      *
      ***************************************************************
      /EJECT                                                                                  CSC042
     C********************************************************************                    CSC042
     C*                                                                                       CSC042
     C*  ##CHKC  - Check the currency details                                                 CSC042
     C*                                                                                       CSC042
     C********************************************************************                    CSC042
     C           ##CHKC    BEGSR                                                              CSC042
      *                                                                                       CSC042
     C           *LIKE     DEFN BJCYCD    ##KC                                                CSC042
     C           *LIKE     DEFN Q         ##QSV                                               CSC042
      *                                                                                       CSC042
      * Set off the currency found indicator                                                  CSC042
     C                     MOVEL*BLANK    ##FIC   1                                           CSC042
      *                                                                                       CSC042
      * Save the state of indicator 87 so it can be reset at the end                          CSC042
      * of the SR as it may be used elsewhere in the code                                     CSC042
     C           *IN87     IFEQ *ON                                                           CSC042
     C                     MOVEL'Y'       #IN87   1                                           CSC042
     C                     ELSE                                                               CSC042
     C                     MOVEL'N'       #IN87                                               CSC042
     C                     END                                                                CSC042
      *                                                                                       CSC042
     C                     SETOF                         87                                   CSC042
      *                                                                                       CSC042
      * Restore Q from ##QSV in case Q is used elsewhere in the code                          CSC042
     C                     Z-ADD##QSV     Q       40                                          CSC042
      *                                                                                       CSC042
      * Are we looking for the same details as the last time this                             CSC042
      * subroutine was called i.e. is Q already set correctly?                                CSC042
      * If so then use the data rather than do another LOKUP                                  CSC042
      * First make sure that we don't reference the 0th array element                         CSC042
     C           Q         IFEQ 0                                                             CSC042
     C                     Z-ADD1         Q                                                   CSC042
     C                     END                                                                CSC042
      * Now see if this search is same as last one performed                                  CSC042
      * If we have a match then seton 87 so the code after this                               CSC042
      * subroutine knows it can use Q directly                                                CSC042
     C           ##KC      IFEQ CURR,Q                                                        CSC042
     C                     SETON                         87                                   CSC042
     C                     ELSE                                                               CSC042
      * Otherwise hunt in the array and seton 87 if found                                     CSC042
     C                     Z-ADD1         Q                                                   CSC042
     C           ##KC      LOKUPCURR,Q                   87                                   CSC042
     C                     END                                                                CSC042
      *                                                                                       CSC042
      * Save Q for next time                                                                  CSC042
     C           *IN87     IFEQ *ON                                                           CSC042
     C                     Z-ADDQ         ##QSV                                               CSC042
      * Set the indicator to show the data was found                                          CSC042
     C                     MOVEL'Y'       ##FIC                                               CSC042
     C                     END                                                                CSC042
      *                                                                                       CSC042
      * Reset the state of indicator 87.                                                      CSC042
     C           #IN87     IFEQ 'Y'                                                           CSC042
     C                     MOVEL*ON       *IN87                                               CSC042
     C                     ELSE                                                               CSC042
     C                     MOVEL*OFF      *IN87                                               CSC042
     C                     END                                                                CSC042
      *                                                                                       CSC042
     C                     ENDSR                                                              CSC042
      *                                                                                       CSC042
     C********************************************************************                    CSC042
      /EJECT                                                                                  CSC042
     C/TITLE SR/HISRED
      ********************************************************************
      *
      *  HISRED - SUBROUTINE TO CALCULATE AMOUNTS FOR PAYMENTS DUE.
      *           N.B. *IN70 ON = ACTUAL AMOUNT USED, OFF = AVERAGE.
      *                                                                                     MD031473
      *  In case of changes to this sub-routine, verify whether these apply to              MD031473
      *  SR/HISREL as well, as sr/HISREL is based on sr/HISRED.                             MD031473
      *
      *  CALLED FROM: AMTACC
      *
      *  CALLS: REPDTL, ACCRUE
      *
      *****************************************************************
      *
     C           HISRED    BEGSR
     C*                                                                   BH3465
     C** Set the flag on to show that a fee has been processed            BH3465
     C*                                                                   BH3465
     C                     MOVE 'Y'       FLAGR   1                       BH3465
      *
      ** Output dummy line to print fee start.
      *
     C                     Z-ADD5         RPT
     C                     EXSR REPDTL
      *                                                                                       258414
     C           *IN70     IFEQ '1'                                                           258414
     C           CLE071    ANDEQ'Y'                                                           CLE071
     C                     Z-ADDFENPYD    ENDATE         19                                   258414
     C   19                Z-ADDFEPEND    ENDATE                                              258414
     C           FEPEND    IFLE BJDNWD                                                        258414
     C                     Z-ADDFEPEND    ENDATE                                              258414
     C                     END                                                                258414
     C                     EXSR AMTAC2                                                        258414
     C                     ELSE                                                               258414
      *
      ** Read file until date read is greater than date of end of
      ** this accrual period.  This processing can be done more
      ** than once for actual type calculations so it is necessary
      ** to reset FADATE each time.   NDAYS is the number of
      ** number of days in this accrual.
      *
     C                     MOVE '0'       *IN18
     C           *IN18     DOWEQ'0'
     C           HSAKY2    READEFACHSAL1                 18
      *
     C           *IN18     IFEQ '1'
     C           FADATE    ORGT ENDATE
     C                     Z-ADDENDATE    FADATE
     C                     MOVE 'PY'      FAACTN                          BH0131
     C                     MOVE '1'       *IN18
     C                     END
      *
     C***********FADATE    SUB  STDATE    NDAYS                           CLE013
     C                     Z-ADDSTDATE    ZZBEG                           CLE013
     C                     Z-ADDFADATE    ZZEND                           CLE013
     C                     MOVE FECALC    ZZCALC                          CLE013
     C                     EXSR ZINTDY                                    CLE013
     C           FECALC    IFEQ 6                                                             212048
     C                     Z-ADDINT6DY    NDAYS                                               212048
     C                     ELSE                                                               212048
     C                     Z-ADDZZINDY    NDAYS                           CLE013
     C                     END                                                                212048
     C/COPY WNCPYSRC,LER135C006
     C*                                                                   100525
      *                                                                   152166
      ** BKALDI should not be considered when calculating fees due        152166
      ** to be paid.                                                      152166
      *                                                                   152166
     C***********FADATE    IFEQ ENDATE                             100525 138165
     C************IN18     ANDEQ'1'                                100525 138165
     C***********                                                  100525 138165
     C***Check*Accrue*on*Last*Day*indicator,*if*it*is*necessarry*to100525 138165
     C***add*or*subtract*the*the*total*no.*of*days*of*the*period.**100525 138165
     C***********                                                  100525 138165
     C***********FEPYON    IFEQ 'N'                                100525 138165
     C***********BKALDI    ANDNE'Y'                                100525 138165
     C***********FELPDT    IFEQ 0                                  100525 138165
     C***********          ADD  1         NDAYS                    100525 138165
     C***********          END                                     100525 138165
     C***********ENDATE    IFEQ FEPEND                             100525 138165
     C***********          SUB  1         NDAYS                    100525 138165
     C***********          END                                     100525 138165
     C***********          END                                     100525 138165
     C***********          END                                     100525 138165
     C***********                                                  100525 138165
     C/COPY WNCPYSRC,LER135C007
      *
     C           NDAYS     IFGT 0
      *
      ** Average amount used (only does accrual once)
      *
     C           *IN70     IFEQ '0'
     C                     Z-ADDAAMT      AAMT0
     C                     MULT NDAYS     AAMT
     C                     DIV  WDAYS     AAMT      H
     C                     ADD  AAMT      WAMT
     C                     Z-ADD0         RPT
     C                     EXSR REPDTL
     C                     Z-ADDFADATE    STDATE
      ** Actual amount used
     C                     ELSE
     C                     Z-ADD0         RPT
     C                     EXSR REPDTL
     C                     Z-ADDNDAYS     WDAYS
     C                     Z-ADDAAMT      WAMT
     C                     EXSR ACCRUE
     C                     ADD  WTOT      WFEE
     C                     Z-ADDFADATE    STDATE
     C                     END
     C                     END
      *
      ** Reset amount to accrue - comes from next record on amounts
      ** file.
      *
     C/COPY WNCPYSRC,LER135C034
     C                     Z-ADDFACFAM    CFAMT
     C                     Z-ADDFADATE    @FDATE  50                      101321
     C                     MOVELFAACTN    @FACTN  2                       101321
     C           CALT      IFLE 6
     C           FAUNDR    IFGE 0
     C                     Z-ADDFAUNDR    AAMT
     C                     ELSE
     C                     Z-ADD0         AAMT
     C                     END
     C                     ELSE
     C           CALT      IFLE 16
     C                     Z-ADDFADRAM    AAMT
     C                     ELSE
     C           CALT      IFLE 22
     C                     Z-ADDFACFAM    AAMT
     C                     END
     C                     END
     C                     END
      *
     C                     END
     C                     ENDIF                                                              258414
     C*                                                                   101321
     C** Print the fee due date and payment narrative.                    101321
     C*                                                                   101321
     C                     Z-ADD6         RPT                             101321
     C                     EXSR REPDTL                                    101321
      *
      ** If average was used perform accrual on total calculated.
      ** and report total amount and number of days.
      *
     C           *IN70     IFEQ '0'
     C                     Z-ADD1         RPT
     C                     EXSR REPDTL
     C                     MOVELFEPIND    WKPIND                                              CLE071
     C                     EXSR ACCRUE
     C                     Z-ADDWTOT      WFEE
      *
     C                     ELSE
      *
      ** If actual was used output additional line for total fee.
      *
     C                     Z-ADD4         RPT
     C                     EXSR REPDTL
     C                     END
      *
      ** Print warning message if average calculation, percentage
      ** used and facility amount changed during calculation period.
      *
     C           *IN75     IFEQ '1'
     C***/COPY*WNCPYSRC,LEH01032***                                                           CFC006
     C/COPY WNCPYSRC,LEH01032                                                               MD020563
     C           SUPFL2    ANDNE'Y'                                                           CFC006
     C                     WRITELER135B8
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
     C/TITLE SR/ACCRUE
      *****************************************************************
      *
      *  ACCRUE - SUBROUTINE TO CALCULATE ACCRUAL AMOUNT
      *
      *  In case of changes to this sub-routine, verify whether these apply to              MD031473
      *  SR/ACCRUL as well, as sr/ACCRUL is based on sr/ACCRUE.                             MD031473
      *                                                                                     MD031473
      *  CALLED FROM: AMTACC, HISRED
      *
      *  CALLS: ZXRATE, ZCONV, REPDTL, LSTRAT, AOCURRR0
      *
      *****************************************************************
      *
     C           ACCRUE    BEGSR
      *
     C                     Z-ADD0         WTOT
     C                     MOVE '0'       *IN73
      *
      ** Calculate percentage if required.
      ** Use original facility amount for average, current for actual.
      *
     C********** FEPIND    IFNE 'A'                                                           CLE071
     C           WKPIND    IFNE 'A'                                                           CLE071
     C           *IN70     IFEQ '0'
     C           FHOFAM    IFGT 0                                                             246018
     C*                                                                                     BUG22790
     C** Increase WRK155 decimal places to 9 for computing                                  BUG22790
     C** average balance to align with changes on enquiry                                   BUG22790
     C********** WAMT      DIV  FHOFAM    WRK155    H                                       BUG22790
     C           WAMT      DIV  FHOFAM    WRK199    H                                       BUG22790
     C                     ELSE                                                               246018
     C**********           Z-ADD0         WRK155                                     246018 BUG22790
     C                     Z-ADD0         WRK199                                            BUG22790
     C                     ENDIF                                                              246018
     C********** WRK155    MULT 100       WPCT                                              BUG22790
     C           WRK199    MULT 100       WPCT                                              BUG22790
     C                     Z-ADDFHOFAM    WAMT
     C                     ELSE
     C**********           Z-ADD*ZERO     WPCT                                         214208 244411
     C******               Z-ADD*ZERO     WAMT                                         214208 244411
     C**********           Z-ADD*ZERO     WAMT                                         214208 243843
     C           CFAMT     IFNE *ZERO                                                         214208
     C********** WAMT      DIV  CFAMT     WRK155    H                                       BUG22790
     C********** WRK155    MULT 100       WPCT                                              BUG22790
     C           WAMT      DIV  CFAMT     WRK199    H                                       BUG22790
     C           WRK199    MULT 100       WPCT                                              BUG22790
     C                     Z-ADDCFAMT     WAMT
     C                     ELSE                                                               244411
     C                     Z-ADD*ZERO     WPCT                                                244411
     C                     Z-ADD*ZERO     WAMT                                                244411
     C                     ENDIF                                                              214208
     C                     END
     C           WPCT      IFGT 100
     C                     Z-ADD100       WPCT
     C                     END
     C                     END
      *
      ** Convert from facility to fee currency if required.
      ** If exchange rate field on fees master file is blank
      ** obtain cross-currency exchange rate for these
      ** two currencies from the standing data files otherwise use
      ** exchange rate on fees master file.
      *
     C           FHFCCY    IFNE FEFCCY
     C                     Z-ADDWAMT      CAMT   130
     C           FEERAT    IFEQ 0
     C                     MOVE FHFCCY    INCCY   3
     C                     MOVE FEFCCY    OUTCCY  3
     C                     Z-ADD1         X
     C           INCCY     LOKUPCURR,X                   13
     C           *IN13     IFEQ '1'
     C                     MOVE MTDV,X    ZMDI1   1
     C                     Z-ADDCSPT,X    ZRATE1 138
     C                     Z-ADDCCDP,X    ZNBDP1  10
     C                     END
      *
     C                     Z-ADD1         X
     C           OUTCCY    LOKUPCURR,X                   14
     C           *IN14     IFEQ '1'
     C                     MOVE MTDV,X    ZMDI2   1
     C                     Z-ADDCSPT,X    ZRATE2 138
     C                     Z-ADDCCDP,X    ZNBDP2  10
     C                     END
      *
      ** Obtain cross exchange rate & cross multiply/divide indicator.
      *
     C                     EXSR ZXRATE
      *
      ** Set up input fields for conversion subroutine.
      *
     C                     Z-ADDZRATEX    ZEXCH  138
     C                     MOVE ZMDIX     ZMD     1
     C                     Z-ADDCAMT      ZAMTCI 150
     C                     MOVE INCCY     ZCCYI   3
     C                     MOVE OUTCCY    ZCCYO   3
     C                     Z-ADDZNBDP1    ZCDPI   10
     C                     Z-ADDZNBDP2    ZCDPO   10
      *
     C                     EXSR ZCONV
      *
     C                     Z-ADDZAMTCO    CAMT
      *
      ** Exchange rate not blank
      *
     C                     ELSE
      *
     C**********           CALL 'AOCURRR0'                                                    CSC042
     C**********           PARM '*MSG   ' WRTCD   7                                           CSC042
     C**********           PARM '*KEY   ' WOPTN   7                                           CSC042
     C**********           PARM FHFCCY    WAJCD   3                                           CSC042
     C********** SDCURR    PARM SDCURR    DSSDY                                               CSC042
     C********** WRTCD     IFNE *BLANKS                                                       CSC042
     C                     MOVELFHFCCY    ##KC                                                CSC042
     C                     EXSR ##CHKC                                                        CSC042
     C           ##FIC     IFEQ 'Y'                                                           CSC042
     C                     MOVE CURR,Q    CCY                                                 CSC042
     C                     Z-ADDCCDP,Q    CDP                                                 CSC042
     C                     Z-ADDCSPT,Q    SPOT                                                CSC042
     C                     MOVE MTDV,Q    MDIN                                                CSC042
     C                     Z-ADDCCNO,Q    CSNO                                                CSC042
     C                     MOVE CIND,Q    A6INCY                                              CSC042
     C                     ELSE                                                               CSC042
     C           *LOCK     IN   LDA
     C                     MOVEL'LER135'  DBPGM
     C**********           MOVEL'SDCURRPD'DBFILE           ************                       CSC042
     C                     MOVEL'CURR,Q  'DBFILE           ************                       CSC042
     C                     Z-ADD005       DBASE            * DBERR 05 *
     C                     MOVELFHFCCY    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      ** Set up currency decimal place power position.
      *
     C           CDP       ADD  4         FD      10
      *
      ** Fee currency decimal places + 1.
      *
     C                     Z-ADDP         TD      10
      *
      ** Adjust incoming amount for from CCY decimal places.
      *
     C           CAMT      DIV  POWER,FD  WRK153
      *
      ** Exchange rate conversion.
      *
     C           FEMDIN    IFEQ 'M'
     C                     MULT FEERAT    WRK153
     C                     ELSE
     C                     DIV  FEERAT    WRK153    H
     C                     END
      *
      ** Adjust calculated amount for to currency decimal places.
      *
     C           WRK153    MULT POWER,TD  CAMT
      *
     C                     END
     C                     Z-ADDCAMT      WAMT
     C                     END
      *
      ** Look up factor for division corresponding to calc. basis
      *
     C                     MOVE '0'       *IN25
     C           FECALC    LOKUPTABCAL    TABCBS         25
     C                     MOVE TABCBS    WCBS
      *
      ** TIERED CALCULATION:
      ** ------------------
      *
     C           CALT      IFEQ 1
     C           CALT      OREQ 4
     C           CALT      OREQ 11
     C           CALT      OREQ 14
      *
      ** Amount (not percentage)
      *
     C********** FEPIND    IFEQ 'A'                                                           CLE071
     C           WKPIND    IFEQ 'A'                                                           CLE071
      *
      ** Convert limit amounts for fee decimal places.
      *
     C           FAMT      MULT POWER,P   FAM
     C                     Z-ADD0         WFAM
     C                     Z-ADDWAMT      WOAMT
     C                     Z-ADD1         X
     C           WAMT      DOWGT0
     C           X         ANDLT6
      *
     C           WOAMT     IFLT FAM,X
     C           FAM,X     OREQ 0
     C                     Z-ADDWAMT      AAMT0
     C           WAMT      MULT FRT,X     WRK15
     C                     ELSE
     C           FAM,X     SUB  WFAM      WRK15
     C                     Z-ADDWRK15     AAMT0
     C                     MULT FRT,X     WRK15
     C                     END
     C                     ADD  WRK15     WTOT
     C                     SUB  FAM,X     WAMT
     C                     ADD  WFAM      WAMT
     C                     Z-ADDFAM,X     WFAM
     C**********                                                   BH3451 BH3504
     C***Calculate*final*accrual*amount.*                          BH3451 BH3504
     C**********                                                   BH3451 BH3504
     C**********           MULT WDAYS     WTOT                     BH3451 BH3504
     C**********           DIV  WCBS      WTOT      H              BH3451 BH3504
     C*                                                                   BH3504
     C** Calculate final accrual amount.                                  BH3504
     C*                                                                   BH3504
     C********** WRK15     MULT WDAYS     WTOTRP 130                                 BH3504 MD046351
     C**********           DIV  WCBS      WTOTRP    H                                BH3504 MD046351
      *                                                                                     MD046351
     C           WRK15     MULT WDAYS     ZWK309 309                                        MD046351
     C                     DIV  WCBS      ZWK309    H                                       MD046351
     C                     Z-ADDZWK309    WTOTRP 130H                                       MD046351
      *
      ** Set up report details if final payment accrual processing.
      *
     C           ATYP      IFEQ 'H'
     C           FRT,X     ANDNE0
     C           ATYP      OREQ 'H'
     C           FAM,X     ANDNE0
     C/COPY WNCPYSRC,LER135C035
     C                     Z-ADDFRT,X     RATE
     C***********          Z-ADDWRK15     WTOT0                           BH3451
     C**********           Z-ADDWTOT      WTOT0                    BH3451 BH3504
     C                     Z-ADDWTOTRP    WTOT0                           BH3504
     C/COPY WNCPYSRC,LER135C012
     C                     Z-ADD2         RPT
     C                     EXSR REPDTL
     C                     END
      *
     C                     ADD  1         X
      *
     C                     END
      *********************************                                   BH3451
      ***Calculate*final*accrual*amount.                                  BH3451
      *********************************                                   BH3451
     C***********          MULT WDAYS     WTOT                            BH3451
     C***********          DIV  WCBS      WTOT      H                     BH3451
     C*                                                                   BH3504
     C** Calculate final accrual amount.                                  BH3504
     C*                                                                   BH3504
     C                     MULT WDAYS     WTOT                            BH3504
     C                     DIV  WCBS      WTOT      H                     BH3504
     C/COPY WNCPYSRC,LER135C013
      *
     C                     ELSE
      *
      ** - PERCENTAGE:
      *
     C           FAMT      DIV  1000      FPC
      *
     C                     Z-ADD0         WFPC
     C                     Z-ADDWPCT      WOPCT
     C                     Z-ADD1         X
     C           WPCT      DOWGT0
     C           X         ANDLT6
      *
     C           WOPCT     IFLT FPC,X
     C           FPC,X     OREQ 0
     C                     Z-ADDWPCT      PCNT
     C           WAMT      MULT WPCT      WRK15
     C                     ELSE
     C           FPC,X     SUB  WFPC      WRK63
     C                     Z-ADDWRK63     PCNT
     C           WAMT      MULT WRK63     WRK15
     C                     END
     C                     MULT FRT,X     WRK15
     C                     DIV  100       WRK15     H
     C                     ADD  WRK15     WTOT
     C                     SUB  FPC,X     WPCT
     C                     ADD  WFPC      WPCT
     C                     Z-ADDFPC,X     WFPC
     C**********                                                   BH3451 BH3504
     C***Calculate*final*accrual*amount.*                          BH3451 BH3504
     C**********                                                   BH3451 BH3504
     C**********           MULT WDAYS     WTOT                     BH3451 BH3504
     C**********           DIV  WCBS      WTOT      H              BH3451 BH3504
     C*                                                                   BH3504
     C** Calculate final accrual amount.                                  BH3504
     C*                                                                   BH3504
     C********** WRK15     MULT WDAYS     WTOTRP 130                                 BH3504 MD046351
     C**********           DIV  WCBS      WTOTRP    H                                BH3504 MD046351
      *                                                                                     MD046351
     C           WRK15     MULT WDAYS     ZWK309                                            MD046351
     C                     DIV  WCBS      ZWK309    H                                       MD046351
     C                     Z-ADDZWK309    WTOTRP    H                                       MD046351
      *
      ** Set up report details if final payment accrual processing.
      *
     C           ATYP      IFEQ 'H'
     C           FRT,X     ANDNE0
     C           ATYP      OREQ 'H'
     C           FPC,X     ANDNE0
     C/COPY WNCPYSRC,LER135C036
     C                     Z-ADDFRT,X     RATE
     C***********          Z-ADDWRK15     WTOT0                           BH3451
     C**********           Z-ADDWTOT      WTOT0                    BH3451 BH3504
     C                     Z-ADDWTOTRP    WTOT0                           BH3504
     C/COPY WNCPYSRC,LER135C014
     C                     Z-ADD2         RPT
     C                     EXSR REPDTL
     C                     END
      *
     C                     ADD  1         X
      *
     C                     END
      *********************************                                   BH3451
      ***Calculate*final*accrual*amount.                                  BH3451
      *********************************                                   BH3451
     C***********          MULT WDAYS     WTOT                            BH3451
     C***********          DIV  WCBS      WTOT      H                     BH3451
     C*                                                                   BH3504
     C** Calculate final accrual amount.                                  BH3504
     C*                                                                   BH3504
     C**********           MULT WDAYS     WTOT                                       BH3504 MD046351
     C**********           DIV  WCBS      WTOT      H                                BH3504 MD046351
      *                                                                                     MD046351
     C           WTOT      MULT WDAYS     ZWK309                                            MD046351
     C                     DIV  WCBS      ZWK309    H                                       MD046351
     C                     Z-ADDZWK309    WTOT      H                                       MD046351
     C/COPY WNCPYSRC,LER135C015
      *
     C                     END
      *
     C                     END
      *
      ** THRESHOLD CALCULATION:
      ** ---------------------
      *
     C           CALT      IFEQ 2
     C           CALT      OREQ 5
     C           CALT      OREQ 12
     C           CALT      OREQ 15
      *
      ** - AMOUNT:
      *
     C********** FEPIND    IFEQ 'A'                                                           CLE071
     C           WKPIND    IFEQ 'A'                                                           CLE071
      *
     C                     Z-ADDWAMT      AAMT0
      *
      ** Convert limit amounts for fee decimal places.
      *
     C           FAMT      MULT POWER,P   FAM
      *
      ** Search amount array to find value larger or equal.
      *
     C                     Z-ADD1         X
     C                     MOVE '0'       *IN25
      *
     C           WAMT      LOKUPFAM,X                25  25
     C           *IN25     IFEQ '0'
     C                     EXSR LSTRAT
     C                     END
      *
     C           *IN25     IFEQ '0'
     C           Y         ANDEQ0
     C                     MULT 0         WAMT
     C                     ELSE
     C                     MULT FRT,X     WAMT
     C                     END
      *
     C********** WAMT      MULT WDAYS     WTOT                                              MD046351
     C**********           DIV  WCBS      WTOT      H                                       MD046351
      *                                                                                     MD046351
     C           WAMT      MULT WDAYS     ZWK309                                            MD046351
     C                     DIV  WCBS      ZWK309    H                                       MD046351
     C                     Z-ADDZWK309    WTOT      H                                       MD046351
     C/COPY WNCPYSRC,LER135C016
      *
     C                     ELSE
      *
      ** - PERCENTAGE:
      *
     C           FAMT      DIV  1000      FPC
      *
      ** Search percentage array to find value larger or equal.
      *
     C                     Z-ADD1         X
     C                     MOVE '0'       *IN25
     C           WPCT      LOKUPFPC,X                25  25
     C           *IN25     IFEQ '0'
     C                     EXSR LSTRAT
     C                     END
     C**********           MULT WPCT      WAMT                                              BUG23244
     C                     MULT 100       WRK199                                            BUG23244
     C                     MULT WRK199    WAMT                                              BUG23244
      *
     C           *IN25     IFEQ '0'
     C           Y         ANDEQ0
     C                     MULT 0         WAMT
     C                     ELSE
     C                     MULT FRT,X     WAMT
     C                     END
      *
     C           WAMT      MULT WDAYS     ZWK309                                            MD046351
     C                     DIV  WCBS      ZWK309    H                                       MD046351
     C                     DIV  100       ZWK309    H                                       MD046351
     C                     Z-ADDZWK309    WTOT      H                                       MD046351
      *
     C                     DIV  100       WAMT      H
     C********** WAMT      MULT WDAYS     WTOT                                              MD046351
     C**********           DIV  WCBS      WTOT      H                                       MD046351
     C/COPY WNCPYSRC,LER135C017
      *
     C                     END
      *
      ** Set up report details if final payment accrual processing due.
      *
     C           ATYP      IFEQ 'H'
     C/COPY WNCPYSRC,LER135C037
     C                     Z-ADDWPCT      PCNT
     C                     Z-ADDFRT,X     RATE
     C           *IN25     IFEQ '0'
     C           Y         ANDEQ0
     C                     Z-ADD0         RATE
     C                     END
     C                     Z-ADDWTOT      WTOT0
     C                     Z-ADD2         RPT
     C                     EXSR REPDTL
     C                     END
      *
     C                     END
      *
      ** SINGLE CALCULATION:
      ** ------------------
      *
     C           CALT      IFEQ 3
     C           CALT      OREQ 6
     C           CALT      OREQ 13
     C           CALT      OREQ 16
     C           CALT      OREQ 21
     C           CALT      OREQ 22
      *
     C           WAMT      MULT FRT,1     ZWK309                                            MD046351
     C                     MULT WDAYS     ZWK309                                            MD046351
     C                     DIV  WCBS      ZWK309    H                                       MD046351
     C                     Z-ADDZWK309    WTOT      H                                       MD046351
      *                                                                                     MD046351
     C********** WAMT      MULT FRT,1     WTOT                                              MD046351
     C**********           MULT WDAYS     WTOT                                              MD046351
      **********                                                                     258597 MD046351
     C**********           Z-ADDWTOT      WTOTX  174                                 258597 MD046351
      **********                                                                     258597 MD046351
     C**********           DIV  WCBS      WTOT      H                                       MD046351
      **********                                                                     258597 MD046351
      ***Sometimes,*if*the*number*to*be*dropped*is*5*and*the*last*****               258597 MD046351
      ***figure*to*be*kept*is*even*number,*it*is*increased.*This******               258597 MD046351
      ***should*be*double-checked*to*avoid*adding*1*when*this*********               258597 MD046351
      ***case*is*encountered*and*rounded*off.*************************               258597 MD046351
      **********                                                                     258597 MD046351
     C********** WTOTX     DIV  WCBS      WTOTX                                      258597 MD046351
     C**********           Z-ADDWTOTX     WTOT5  130                                 258597 MD046351
     C**********           Z-ADDWTOTX     WTOTY   44                                 258597 MD046351
     C**********           Z-ADDWTOTX     WTOTL   10                                 258597 MD046351
     C********** WTOTL     DIV  2         WTOTM   21                                 258597 MD046351
     C**********           Z-ADDWTOTM     WTOTN   11                                 258597 MD046351
     C********** WTOTY     IFEQ 0.5                                                  258597 MD046351
     C********** WTOTN     ANDEQ0.0                                                  258597 MD046351
     C********** WTOT      ANDGTWTOT5                                                258597 MD046351
     C**********           Z-ADDWTOT5     WTOT                                       258597 MD046351
     C**********           ENDIF                                                     258597 MD046351
      **********                                                                     258597 MD046351
     C/COPY WNCPYSRC,LER135C018
      *
      ** Set up report details if final payment accrual processing.
      *
     C           ATYP      IFEQ 'H'
     C/COPY WNCPYSRC,LER135C038
     C                     Z-ADDWAMT      AAMT0
     C                     Z-ADDFRT,1     RATE
     C                     Z-ADDWTOT      WTOT0
     C                     Z-ADD2         RPT
     C                     EXSR REPDTL
     C                     END
      *
     C                     END
      *
      ** Write total line to fee calculation report if final
      ** payment accrual processing.
      *
     C           ATYP      IFEQ 'H'
     C/COPY WNCPYSRC,LER135C039
     C                     Z-ADD3         RPT
     C                     EXSR REPDTL
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
     C/TITLE SR/LSTRAT
      *****************************************************************
      *
      *  LSTRAT SUBROUTINE TO FIND LAST RATE IN AMOUNT/%AGE ARRAY.
      *
      *  CALLED FROM:  ACCRUE
      *
      *  CALLS:  NOTHING
      *
      *****************************************************************
      *
     C           LSTRAT    BEGSR
      *
     C                     Z-ADD5         Y       20
     C           Y         DOWGT0
     C           FAMT,Y    IFEQ 0
     C           FRT,Y     ANDNE0
     C                     Z-ADDY         X
     C                     Z-ADD0         Y
     C                     END
     C                     SUB  1         Y
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
     C/TITLE SR/UPDFEE
      *****************************************************************
      *
      *  UPDFEE SUBROUTINE TO UPDATE FEE MASTER DETAILS.
      *
      *  CALLED FROM:  MAIN PROCESSING
      *
      *  CALLS:  ZFREQB, GENKEY
      *
      *****************************************************************
      *
     C           UPDFEE    BEGSR
      *
      ** If final payment accrual processing
      *
     C                     MOVE *HIVAL    @NPAYD                                             BUG8762
      *                                                                                      BUG8762
     C           ATYP      IFEQ 'H'
      *
     C***********          Z-ADDWFEE      LKEAMT                          BH3467
     C***********          SUB  FEADAT    LKEAMT                          BH3467
     C                     ADD  ADJTOT    WFEE                                                227253
     C                     Z-ADD0         NEGAMT                                              227253
     C                     Z-ADDLKEAMT    NEGAMT                                              227253
     C           WFEE      SUB  FELPAM    LKEAMT                          BH3467
     C********** WFEE      IFNE FELPAM                                                 243496 245803
     C**********           ADD  FEAMTA    LKEAMT                                       243496 245803
     C**********           ENDIF                                                       243496 245803
     C           WFEE      IFNE FELPAM                                                       243496B
     C                     ADD  FEAMTA    LKEAMT                                             243496B
     C                     ENDIF                                                             243496B
      *                                                                                       227253
     C           NEGAMT    IFNE 0                                                             227253
     C           LKEAMT    IFEQ 1                                                             227253
     C                     Z-ADD0         LKEAMT                                              227253
     C                     ELSE                                                               227253
     C                     Z-ADD0         NEGAMT                                              227253
     C                     Z-SUBLKEAMT    NEGAMT 130                                          227253
     C           NEGAMT    IFEQ 1                                                             227253
     C                     Z-ADD0         LKEAMT                                              227253
     C                     ENDIF                                                              227253
     C                     ENDIF                                                              227253
     C                     ENDIF                                                              227253
      *                                                                                       227253
     C***********          Z-ADDLKEAMT    FELPAM                   BH3467 BH3481
     C                     Z-ADDFELPAM    FEADBP                          100515
      *                                                                                       258597
      ** If there are any adjustments from RECALC                                             258597
      ** add it on FEADBP (total accruals).                                                   258597
      *                                                                                       258597
     C                     ADD  FEAMTP    FEADBP                                              258597
     C********** FELCHD    IFNE BJRDNB                                                 218648 261129
     C********** FENPYD    ORGT BJRDNB                                                 218648 261129
     C           FELOAN    IFEQ *BLANKS                                                       261129
     C/COPY WNCPYSRC,LEH00678
      **********                                                                     CLE073 MD033613
     C********** FEAUTO    OREQ 'N'                                                  CLE073 MD033613
     C********** FECALT    ANDEQ'97'                                                 CLE073 MD033613
     C********** FEAUTO    OREQ 'N'                                                  CLE073 MD033613
     C********** FECALT    ANDEQ'98'                                                 CLE073 MD033613
     C********** FEAUTO    OREQ 'N'                                                  CLE073 MD033613
     C********** FECALT    ANDEQ'99'                                                 CLE073 MD033613
     C           FECALT    OREQ '97'                                                        MD033613
     C           FECALT    OREQ '98'                                                        MD033613
     C           FECALT    OREQ '99'                                                        MD033613
      *                                                                                       CLE073
     C                     ADD  FEADAT    FEADBP                          100515
     C           FENPYD    IFGT CODT                                                          261129
     C           FENPYD    ORLE CODT                                                       AR740063A
     C           FENPYD    ANDLEFEPEND                                                     AR740063A
     C********** FELOAN    ANDGT*BLANKS                                           AR740063A MD052410
     C                     Z-ADD0         FELPAM                          BH3481
     C                     ELSE                                                               218648
     C**********           Z-ADDFEADAT    FELPAM                                       218648 261129
     C           CALT      IFGE 4                                                           AR956619
     C           CALT      ANDLE6                                                           AR956619
     C           CALT      ORGE 14                                                          AR956619
     C           CALT      ANDLE16                                                          AR956619
     C           CALT      OREQ 22                                                          AR956619
     C           FECALT    OREQ '97'                                                        AR956619
     C           FECALT    OREQ '98'                                                        AR956619
     C           FECALT    OREQ '99'                                                        AR956619
     C                     Z-ADD0         LKEAMT                                              261129
     C           FEADBP    SUB  WFEE      FELPAM                                              261129
     C                     ENDIF                                                            AR956619
     C                     ENDIF                                                              261129
     C                     ENDIF                                                              218648
     C/COPY WNCPYSRC,LER135C008
     C                     Z-ADD0         FEADAT                          BH3467
     C                     SUB  ADJTOT    WFEE                                                227253
     C***********          SUB  FEAMTA    LKEAMT                          BH3451
     C**********           ADD  WFEE      FEAMTP                                       209380 258414
     C/COPY WNCPYSRC,LEH00679
      *                                                                                       CLE073
     C           FECALT    IFEQ '99'                                                          CLE073
     C           FEAUTO    ANDEQ'N'                                                           CLE073
     C                     ADD  FEAMTA    FEAMTP                                              CLE073
     C                     ADD  FEAMTA    FETADJ                                              CLE073
     C                     Z-ADD0         FEAMTA                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C********** FEAMTP    IFEQ 0                                                             209380
     C           FEAMTP    IFEQ 0                                                             258414
      ** If fee amount past due is zero, check FEAUTO to decide which     177910
      ** LER160 report this fee should appear on ('B' for LER160P2 -      177910
      ** Autosettled Report & 'C' for LER160P3 - Manual Settlement)       177910
     C           FEAUTO    IFEQ 'N'                                       177910
      **Only*apply*199724*to*the*non*autosettle*case.*******************               243496 245803
     C********** ENDATE    IFLE BJRDNB                                                 243496 245803
     C**********           MOVE 'A'       FEDIND                                       243496 245803
     C**********           ELSE                                                        243496 245803
      * Only apply 199724 to the non autosettle case.                                        243496B
     C           ENDATE    IFLE BJRDNB                                                       243496B
     C                     MOVE 'A'       FEDIND                                             243496B
     C                     ELSE                                                              243496B
     C                     MOVE 'C'       FEDIND
     C                     ENDIF                                                             243496B
     C**********           ENDIF                                                       243496 245803
     C                     ELSE                                           177910
     C                     MOVE 'B'       FEDIND                          177910
     C                     ENDIF                                          177910
     C**********           END                                                                209380
     C                     ENDIF                                                              258414
     C********** FELPDT    IFGT 0                                                      243496 245803
     C           FELPDT    IFGT 0                                                            243496B
     C                     Z-ADDFEAMTP    FEPAMP                          100515
     C**********           SUB  WFEE      FEPAMP                                       248697 258414
     C                     ENDIF                                                             243496B
     C**********           ENDIF                                                       243496 245803
     C**********           ADD  WFEE      FEAMTP                                              209380
     C                     ADD  WFEE      FEAMTP                                              258414
     C                     ADD  ADJTOT    FEAMTP                                              227253
     C**********           ADD  ADDUE     FEAMTP                                       243496 245803
     C           FELOAN    IFEQ *BLANKS                                                     AR734175
     C                     ADD  ADDUE     FEAMTP                                             243496B
     C                     ADD  ADDUE     FEAMTO                                            MD055069
     C                     ELSE                                                             MD055069
     C                     ADD  WLOANA    FEAMTO                                            MD055069
     C                     Z-ADD0         WLOANA                                            MD055069
     C                     ENDIF                                                            AR734175
     C                     ADD  WFEE      FEAMTO
     C                     ADD  ADJTOT    FEAMTO                                              227253
      ******************************************************************               243496 245803
     C********** FEPEND    IFLE BJDNWD                                                 243496 245803
     C********** FEAUTO    ANDEQ'N'                                                    243496 245803
     C**********           Z-ADDFEAMTP    FEAMTO                                       243496 245803
     C**********           Z-ADD0         FEPAMP                                       243496 245803
     C**********           ENDIF                                                       243496 245803
      *                                                                                      243496B
     C           FEPEND    IFLE BJDNWD                                                       243496B
     C           FEAUTO    ANDEQ'N'                                                          243496B
     C                     Z-ADDFEAMTP    FEAMTO                                             243496B
     C                     Z-ADD0         FEPAMP                                             243496B
     C                     ENDIF                                                             243496B
      *                                                                   CLE005
      ** If CLE005 is on, add adjustment amount to Total Fee              CLE005
      ** adjustment amount.                                               CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C           FENPYD    IFLE CODT                                                          204452
     C           FENPYD    ANDGT0                                                             204452
     C           FEPEND    ORLE CODT                                                          204452
     C                     ADD  FEAMTA    FETADJ                          CLE005
     C                     ADD  FEAMTW    FEWOFF                                              204452
     C           ADJTOT    IFEQ 0                                                             227253
     C                     Z-ADDFEAMTA    ADJTOT                                              227253
     C                     ELSE                                                               227253
     C           FEAMTA    IFNE 0                                                             227253
     C                     ADD  FEAMTA    ADJTOT                                              227253
     C                     ENDIF                                                              227253
     C                     ENDIF                                                              227253
     C                     Z-ADD0         FEAMTW                                              204452
     C                     Z-ADD0         FEAMTA                                              204452
     C                     ENDIF                                                              204452
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
      ******************************************************************               243496 245803
     C********** CLE005    IFEQ 'N'                                                    243496 245803
     C********** FEAMTA    ANDNE0                                                      243496 245803
     C**********           ADD  FEAMTA    FEAMTO                                       243496 245803
     C**********           ADD  FEAMTA    FEAMTP                                       243496 245803
     C**********           ENDIF                                                       243496 245803
      ******************************************************************               243496 245803
      ***Save*original*fee*adjustment*amount*before*it*is*zeroised******               243496 245803
      ******************************************************************               243496 245803
     C**********           Z-ADDFEAMTA    FEOAMT                                       243496 245803
     C           CLE005    IFEQ 'N'                                                          243496B
     C           FEAMTA    ANDNE0                                                            243496B
     C                     ADD  FEAMTA    FEAMTO                                             243496B
     C                     ADD  FEAMTA    FEAMTP                                             243496B
     C                     ENDIF                                                             243496B
      *                                                                                      243496B
      ** Save original fee adjustment amount before it is zeroised                           243496B
      *                                                                                      243496B
     C                     Z-ADDFEAMTA    FEOAMT                                             243496B
     C                     Z-ADD0         FEADAT
     C**********           Z-ADD0         FEAMTA                                              204452
     C                     ADD  LKEAMT    WAGG
      *
      **  Save last payment date in previous last payment date field
      **  for output to LEFEED
      *
     C                     Z-ADDFELPDT    FEPLPD
      *
     C                     Z-ADDENDATE    FELPDT
     C                     Z-ADDENDATE    FEDDAT
     C**********           Z-ADDENDATE    FELADT                                       E32516 261129
      *                                                                   CLE005
      ***If*CLE005*is*on,*setup*details*for*writing*a*record*in********               CLE005 BUG8762
      ***LFHST.********************************************************               CLE005 BUG8762
      ***Also,*if*CDE002*is*on,*write*record*to*LEFHST.****************               CDE002 BUG8762
      *****************************************************************               CLE005 BUG8762
     C/COPY WNCPYSRC,LEH00680
     C********** CLE005    IFEQ 'Y'                                                   CLE005 BUG8762
     C********** FEPYON    ANDEQ'N'                                                   CLE005 BUG8762
     C********** CDE002    OREQ 'Y'                                                   CDE002 BUG8762
     C*****************************************************************               153736 BUG8762
     C***History*records*should*be*written*for*all*calculation*types***               153736 BUG8762
     C*****************************************************************               153736 BUG8762
     C************IN70     ANDEQ'0'                                 CLE005153736
     C*****************************************************************               CLE005 BUG8762
     C**********           MOVE 'D'       HIRECI                                      CLE005 BUG8762
     C**********           MOVE FEBRCA    HIBRCA                                      CLE005 BUG8762
     C**********           MOVE FECNUM    HICNUM                                      CLE005 BUG8762
     C**********           MOVE FEFACL    HIFACL                                      CLE005 BUG8762
     C**********           MOVE FELOAN    HILNRF                                      CLE005 BUG8762
     C**********           MOVE FEFSEQ    HIFSEQ                                      CLE005 BUG8762
     C**********           MOVE FEFCOD    HIFCOD                                      CLE005 BUG8762
     C**********           MOVE FEFCCY    HIFCCY                                      CLE005 BUG8762
     C*****************************************************************               153736 BUG8762
     C***Add*settled*amount*and*any*settlements*today*to*historical****               153736 BUG8762
     C***settled*amount.***********************************************               153736 BUG8762
     C*                                                                   153736
     C***********          Z-ADDWFEE      HIAMTS                    CLE005153736
     C**********           Z-ADDFEAMTS    HIAMTS                                      153736 BUG8762
     C********** FATYPE    IFEQ 'P'                                                   153736 BUG8762
     C********** FATYPE    OREQ 'F'                                                   153736 BUG8762
     C**********           ADD  FASADJ    HIAMTS                                      153736 BUG8762
     C**********           ENDIF                                                      153736 BUG8762
     C*                                                                   153736
     C**********           Z-ADDFELPDT    HIHDAT                                      CLE005 BUG8762
     C**********           Z-ADDFELPDT    HILCHD                                      CLE005 BUG8762
     C**********           MOVE 'I'       HILCHT                                      CLE005 BUG8762
     C**********           EXSR ADDFLD                                               CSW208 AR750601
     C*                                                                   CLE005
     C********** HIAMTS    IFNE 0                                                     204354 BUG8762
     C**********           WRITELEFHSTF                                               CLE005 BUG8762
     C**********           ENDIF                                                      204354 BUG8762
     C**********           ENDIF                                                      CLE005 BUG8762
     C/COPY WNCPYSRC,LER135C009
      *
      ** Reset record to live if past due now not zero.
      *
     C           FERECI    IFEQ 'M'
     C           FEAMTP    ANDNE0
     C                     MOVE 'D'       FERECI
     C********** FEAUTO    IFEQ 'C'                                               AR1078443 MD020212
     C**********           MOVE 'D'       FERECI                                  AR1078443 MD020212
     C**********           ENDIF                                                  AR1078443 MD020212
     C                     END
      *
      ** Set up next payment date on file
      *
     C                     Z-ADDFENPYD    @NPAYD  50                                         BUG8762
      *                                                                                      BUG8762
     C***  (If blank frequency, change NPYD to end date of fee)           BH3417
     C*                                                                   BH3417
     C           FEFREQ    IFNE *BLANKS                                   BH3417
     C*                                                                   BH3417
     C                     MOVE FEFREQ    ZFREQ   1
     C                     Z-ADDENDATE    ZDAYNO  50
     C                     MOVE FEDYIM    ZMDAY   20
     C                     MOVE BJLCCY    ZCCY    3
     C                     MOVE *BLANK    ZZERR   7
     C                     Z-ADD*ZERO     ZNRDYS                                            MD052216
     C                     EXSR CCYLOC                                                      MD052216
      *
      ** IF CLE134 is On and type is 90, set fee next repayment date                          CLE134
      ** = loan principal next repayment date.                                                CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FECALT    ANDEQ'90'                                                          CLE134
     C           FEFREQ    ANDEQ'P'                                                           CLE134
      *                                                                                       CLE134
      ** If next payment date is in the past, get next payment date                           CLE134
      ** from LEPDUFPD else from the loan file                                                CLE134
      *                                                                                       CLE134
     C           WNXREP    IFGT 0                                                             CLE134
     C                     Z-ADDWNXREP    ZDAYNO                                              CLE134
     C                     ELSE                                                               CLE134
     C                     Z-ADDFEPEND    ZDAYNO                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     Z-ADDFELPDT    KPDVDT  50                                          CLE134
     C           WK90      SETLLLEPDUFL5                                                      CLE134
     C                     MOVE *OFF      *IN88                                               CLE134
     C           *IN88     DOWEQ*OFF                                                          CLE134
     C           WKPDCL    READELEPDUFL5                 88                                   CLE134
     C           *IN88     IFEQ *OFF                                                          CLE134
     C           YPDVDT    ANDGTFELPDT                                                        CLE134
     C                     Z-ADDYPDVDT    ZDAYNO                                              CLE134
     C                     MOVE *ON       *IN88                                               CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDDO                                                              CLE134
      *                                                                                       CLE134
     C                     ELSE                                                               CLE134
      *                                                                                       CLE134
     C           *IN08     IFEQ *OFF                                                        MD052216
     C           WFPBDT    ANDNE*ZEROS                                                      MD052216
     C                     Z-ADDWFPBDT    ZDAYNO                                            MD052216
     C                     ENDIF                                                            MD052216
      *                                                                                     MD052216
     C           CLE141    IFEQ 'Y'                                                           CLE141
     C********** FESTTL    ANDEQ1                                                     CLE141 CLE141A
     C           FELOAN    ANDNE*BLANKS                                                       CLE141
     C********** CLE141    OREQ 'Y'                                                   CLE141 CLE141A
     C********** FESTTL    ANDEQ7                                                     CLE141 CLE141A
     C********** FELOAN    ANDNE*BLANKS                                               CLE141 CLE141A
     C********** CLE141    OREQ 'Y'                                                   CLE141 CLE141A
     C********** FESTTL    ANDEQ8                                                     CLE141 CLE141A
     C********** FELOAN    ANDNE*BLANKS                                               CLE141 CLE141A
     C                     EXSR ZFRQB3                                                        CLE141
     C                     MOVELZCCY      CCYLL                                              CLE141A
     C                     MOVELZLOC      LOCLL                                              CLE141A
     C           FELOAN    CHAINCLOAN                95                                     MD054101
     C**********           MOVEL*BLANKS   PAYIND                                     CLE141 MD052216
     C           WPDDI     IFEQ *BLANK                                                      MD052216
     C                     MOVEL'M'       PAYIND                                            MD052216
     C                     ELSE                                                             MD052216
     C                     MOVELWPDDI     PAYIND                                            MD052216
     C                     ENDIF                                                            MD052216
     C                     MOVELZDAYNO    WFPBDT                                            MD052216
     C                     CALL 'LEZBDYCD'BDCHK                                               CLE141
     C                     MOVELZADJDT    ZDAYNO                                              CLE141
     C                     ELSE                                                               CLE141
     C                     EXSR ZFRQB3                                                      MD052216
     C                     Z-ADDZDAYNO    WFPBDT                                            MD052216
     C                     EXSR NXTPAY                                                      MD052216
     C                     Z-ADDZDYNBR    ZDAYNO                                            MD052216
     C**********           EXSR ZFREQB                                                      MD052216
      **********                                                                            MD052216
     C********** ZZERR     IFNE *BLANK                                                      MD052216
     C********** *LOCK     IN   LDA                                                         MD052216
     C**********           MOVEL'LER135'  DBPGM                                             MD052216
     C**********           MOVEL'ZFREQB'  DBFILE           ************                     MD052216
     C**********           MOVELENDATE    DBKEY            * DBERR 06 *                     MD052216
     C**********           Z-ADD006       DBASE            ************                     MD052216
     C**********           OUT  LDA                                                         MD052216
     C**********           EXSR *PSSR                                                       MD052216
     C**********           END                                                              MD052216
     C                     ENDIF                                                              CLE141
     C                     ENDIF                                                              CLE134
      *
      ** If the next fee payment base date equals fee end date,                             MD052216
      ** set fee next payment date to fee end date                                          MD052216
      *                                                                                     MD052216
     C           WFPBDT    IFEQ FEPEND                                                      MD052216
     C                     Z-ADDWFPBDT    ZDAYNO                                            MD052216
     C                     ENDIF                                                            MD052216
      *                                                                                     MD052216
     C           ZDAYNO    IFGE CODT                                                        MD031473
     C           FECALT    ANDEQ'97'                                                        MD031473
     C           ZDAYNO    ORGE CODT                                                        MD031473
     C           FECALT    ANDEQ'98'                                                        MD031473
     C           ZDAYNO    ORGE CODT                                                        MD031473
     C           FECALT    ANDEQ'99'                                                        MD031473
     C                     Z-ADDCODT      ENDATE                                            MD031473
     C                     ENDIF                                                            MD031473
      *
      **  If the next payment date calculated will be after
      **  the fee period end date then make the end date the date
      **  of next payment.
      *
     C           ZDAYNO    IFGT FEPEND
     C*                                                                   BH3433
     C** If the end date for the fee has already passed blank out the     BH3433
     C** details on the file                                              BH3433
     C*                                                                   BH3433
     C           FEPEND    IFGT CODT                                      BH3433
     C/COPY WNCPYSRC,LEH00681
      *                                                                                       CLE073
     C           FECALT    OREQ '97'                                      CLE073
     C           FECALT    OREQ '98'                                      CLE073
     C           FECALT    OREQ '99'                                      CLE073
      *                                                                                       CLE073
     C                     Z-ADDFEPEND    FENPYD                          BH3433
     C                     Z-ADDFEPEND    WFPBDT                                            MD052216
     C                     ELSE                                           BH3433
     C                     Z-ADD0         FENPYD                          BH3433
     C                     Z-ADD*ZEROS    WFPBDT                                            MD052216
     C                     MOVE *BLANKS   FEFREQ                          BH3433
     C                     Z-ADD0         FEDYIM                          BH3433
     C                     END                                            BH3433
     C*                                                                   BH3433
     C                     ELSE
     C********** FENPYD    IFLE CODT                                                   204452 214120
     C                     Z-ADDZDAYNO    FENPYD
     C**********           ENDIF                                                       204452 214120
     C                     END
      *                                                                                    AR740063A
     C********** FELOAN    IFGT *BLANKS                                           AR740063A MD052410
     C           FENPYD    IFLT BJRDNB                                                     AR740063A
     C           FENPYD    ANDLEFEPEND                                                     AR740063A
     C           FENPYD    ANDGT0                                                          AR740063A
     C                     Z-ADDFENPYD    FELADT                                           AR740063A
     C                     MOVE 'Y'       WBFREQ                                           AR740063A
     C                     ELSE                                                            AR740063A
      *                                                                                    AR740063A
      ** If FENPYD is already greater than or equal to next working day                    AR740063A
      ** but final accrual has yet to generate (WBVPAY ='Y').                              AR740063A
      *                                                                                    AR740063A
     C           FENPYD    IFGE BJDNWD                                                     AR740063A
     C           FELADT    ANDEQCODT                                                       AR740063A
     C           WBFREQ    ANDEQ'Y'                                                        AR740063A
     C           CODT      SUB  1         FELADT                                           AR740063A
     C                     MOVE 'N'       WBFREQ                                           AR740063A
     C                     ENDIF                                                           AR740063A
     C                     ENDIF                                                           AR740063A
     C**********           ENDIF                                                  AR740063A MD052410
     C*                                                                   BH3417
     C***  ELSE IT'S A BLANK FREQUENCY :                                  BH3417
     C*                                                                   BH3417
     C                     ELSE                                           BH3417
     C*                                                                   BH3417
     C** If the end date for the fee has already passed blank out the     BH3417
     C** details on the file                                              BH3417
     C*                                                                   BH3417
     C           FEPEND    IFGT CODT                                      BH3417
     C/COPY WNCPYSRC,LEH00682
      *                                                                                       CLE073
     C           FECALT    OREQ '97'                                      CLE073
     C           FECALT    OREQ '98'                                      CLE073
     C           FECALT    OREQ '99'                                      CLE073
     C           FECALT    OREQ '90'                                                          CLE134
      *                                                                                       CLE073
     C*                                                                   E45504
     C***  Only set the next payment date to the end date if the fee      E45504
     C***  is payment on Next.                                            E45504
     C*                                                                   E45504
     C           FEPYON    IFEQ 'N'                                       E45504
      ***********                                                                      204452 218992
      ***change*the*next*payment*date*only*of*if*is*already*less*than*********         204452 218992
      ***or*eqyal*to*control*date.********************************************         204452 218992
      **********                                                                       204452 218992
     C********** FENPYD    IFLE CODT                                                   204452 218992
     C                     Z-ADDFEPEND    FENPYD                          BH3417
     C                     Z-ADDFEPEND    WFPBDT                                            MD052216
     C**********           ENDIF                                                       204452 218992
      **********                                                                       204452 218992
     C                     END                                            E45504
     C*                                                                   E45504
     C                     ELSE                                           BH3417
     C                     Z-ADD0         FENPYD                          BH3417
     C                     MOVE *BLANKS   FEFREQ                          BH3417
     C                     Z-ADD0         FEDYIM                          BH3417
     C                     Z-ADD*ZEROS    WFPBDT                                            MD052216
     C                     END                                            BH3417
     C*                                                                   BH3417
     C                     END                                            BH3417
      *
      ** If daily type accrual
      *
     C                     ELSE
     C/COPY WNCPYSRC,LER135C010
      *                                                                                       214120
     C           CLE005    IFEQ 'Y'                                                           214120
     C********** FELPDT    ANDEQCODT                                                   214120 227253
     C           FELPDT    ANDLECODT                                                          227253
     C           FEPEND    ORLE CODT                                                          227253
     C           ADJTOT    IFEQ 0                                                             227253
     C                     Z-ADDFEAMTA    ADJTOT                                              227253
     C                     ELSE                                                               227253
     C           FEAMTA    IFNE 0                                                             227253
     C                     Z-ADDFEAMTA    ADJTOT                                              227253
     C                     ENDIF                                                              227253
     C                     ENDIF                                                              227253
     C           FELPDT    IFLE CODT                                                          227253
     C           FELPDT    ANDGEBJRDNB                                                        227253
     C                     ADD  FEAMTA    FETADJ                                              214120
     C                     ADD  FEAMTW    FEWOFF                                              214120
     C                     Z-ADD0         FEAMTW                                              214120
     C                     Z-ADD0         FEAMTA                                              214120
     C                     ENDIF                                                              227253
     C                     ENDIF                                                              214120
      *                                                                   CLE005
      ** If CLE005 is on, calculate for LKEAMT.                           CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C           FEINDC    ANDNE'Y'                                       141453
     C           WFEE      ADD  FEAMTA    XTOTAL 130                      CLE005
     C/COPY WNCPYSRC,LEH00683
      *                                                                                       CLE073
     C           FECALT    IFNE '99'                                                          CLE073
     C           FECALT    ANDNE'90'                                                          CLE134
      *                                                                                       CLE073
     C                     ADD  FETADJ    XTOTAL                          CLE005
     C                     SUB  FEAMTS    XTOTAL                          CLE005
     C                     SUB  FEAMTP    XTOTAL                          CLE005
     C                     SUB  FESFA     XTOTAL                                              CLE134
     C/COPY WNCPYSRC,LEH00684
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     SUB  FEAMTW    XTOTAL                                              204452
     C/COPY WNCPYSRC,LEH00685
      *                                                                                       CLE073
     C           FECALT    IFNE '99'                                                          CLE073
     C           FECALT    ANDNE'90'                                                          CLE134
      *                                                                                       CLE073
     C                     SUB  FEWOFF    XTOTAL                                              202954
     C/COPY WNCPYSRC,LEH00686
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     SUB  FELPAM    XTOTAL                          CLE005
     C           XTOTAL    SUB  FEADAT    LKEAMT                          CLE005
     C                     ADD  LKEAMT    WAGG                            CLE005
      *                                                                   CLE005
      ** Calculate for the Total Fees accrued to date.                    CLE005
     C                     Z-ADDXTOTAL    FEADAT                          CLE005
     C                     ELSE                                           CLE005
      *
     C***********          Z-ADDWFEE      LKEAMT                          123004
     C           WFEE      SUB  FELPAM    LKEAMT                          123004
     C                     SUB  FEADAT    LKEAMT                          123004
     C********** CLE005    IFEQ 'N'                                                    243496 245803
     C********** FEAMTA    ANDNE0                                                      243496 245803
     C********** FEINDC    OREQ 'Y'                                                    243496 245803
     C********** FEAMTA    ANDNE0                                                      243496 245803
     C**********           Z-ADDFEAMTA    FEPOST 130                                   243496 245803
     C**********           MOVE '0'       *IN48                                        243496 245803
     C********** FASADJ    IFNE 0                                                      243496 245803
     C********** FASIGN    IFEQ '+'                                                    243496 245803
     C********** FASIGN    OREQ ' '                                                    243496 245803
     C********** FEPOST    SUB  FASADJ    FEPOST                                       243496 245803
     C**********           ELSE                                                        243496 245803
     C********** FEPOST    ADD  FASADJ    FEPOST                                       243496 245803
     C**********           ENDIF                                                       243496 245803
     C********** FEPOST    IFEQ 0                                                      243496 245803
     C**********           MOVE '1'       *IN48                                        243496 245803
     C**********           Z-ADDFEAMTA    FEPOST                                       243496 245803
     C**********           ENDIF                                                       243496 245803
     C**********           ENDIF                                                       243496 245803
     C********** *IN48     IFEQ '0'                                                    243496 245803
     C**********           ADD  FEPOST    LKEAMT                                       243496 245803
     C**********           ENDIF                                                       243496 245803
     C**********           ENDIF                                                       243496 245803
     C           CLE005    IFEQ 'N'                                                          243496B
     C           FEAMTA    ANDNE0                                                            243496B
     C           FEINDC    OREQ 'Y'                                                          243496B
     C           FEAMTA    ANDNE0                                                            243496B
     C                     Z-ADDFEAMTA    FEPOST 130                                         243496B
     C                     MOVE '0'       *IN48                                              243496B
     C           FASADJ    IFNE 0                                                            243496B
     C           FASIGN    IFEQ '+'                                                          243496B
     C           FASIGN    OREQ ' '                                                          243496B
     C           FEPOST    SUB  FASADJ    FEPOST                                             243496B
     C                     ELSE                                                              243496B
     C           FEPOST    ADD  FASADJ    FEPOST                                             243496B
     C                     ENDIF                                                             243496B
     C           FEPOST    IFEQ 0                                                            243496B
     C                     MOVE '1'       *IN48                                              243496B
     C                     Z-ADDFEAMTA    FEPOST                                             243496B
     C                     ENDIF                                                             243496B
     C                     ENDIF                                                             243496B
     C           *IN48     IFEQ '0'                                                          243496B
     C                     ADD  FEPOST    LKEAMT                                             243496B
     C                     ENDIF                                                             243496B
     C                     ENDIF                                                             243496B
     C                     ADD  LKEAMT    WAGG
     C***********          ADD  LKEAMT    FEADAT                          123004
     C           WFEE      SUB  FELPAM    FEADAT                          123004
     C********** CLE005    IFEQ 'N'                                                    243496 245803
     C********** *IN48     ANDEQ'0'                                                    243496 245803
     C********** FEPOST    ANDNE0                                                      243496 245803
     C********** FEINDC    OREQ 'Y'                                                    243496 245803
     C********** *IN48     ANDEQ'0'                                                    243496 245803
     C********** FEPOST    ANDNE0                                                      243496 245803
     C**********           ADD  FEPOST    FEADAT                                       243496 245803
     C**********           ENDIF                                                       243496 245803
     C           CLE005    IFEQ 'N'                                                          243496B
     C           *IN48     ANDEQ'0'                                                          243496B
     C           FEPOST    ANDNE0                                                            243496B
     C           FEINDC    OREQ 'Y'                                                          243496B
     C           *IN48     ANDEQ'0'                                                          243496B
     C           FEPOST    ANDNE0                                                            243496B
     C                     ADD  FEPOST    FEADAT                                             243496B
     C                     ENDIF                                                             243496B
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     Z-ADDFEADAT    LKADAT                          052703
     C                     ADD  FELPAM    LKADAT                          052703
     C                     ADD  FEAMTP    LKADAT                          052703
     C           CODT      IFLE FEPEND                                                        261129
     C                     Z-ADDCODT      FELADT
      *                                                                                     AR823503
      ** Missing accrual when last payment date is less than CODT.                          AR823503
      ** Update FELADT equal to ENDATE to continue with accrual.                            AR823503
      *                                                                                     AR823503
     C           ENDATE    IFLT CODT                                                        AR823503
     C                     Z-ADDENDATE    FELADT                                            AR823503
     C                     ENDIF                                                            AR823503
      *                                                                                     AR823503
     C                     ELSE                                                               261129
     C                     Z-ADDFEPEND    FELADT                                              261129
     C                     ENDIF                                                              261129
     C/COPY WNCPYSRC,LER135C019
     C*
     C** If this is accrual profit processing, set up the posting and
     C** accrual amount
     C*
     C           BKAPDT    IFGE BJRDNB                                    BH3467
     C           BKAPDT    ANDLTBJDNWD                                    BH3467
     C********** BKANWD    IFNE '2'                                                  245081 MD054240
     C                     Z-ADDFEADAT    LKEAMT                          BH3467
     C**********           ENDIF                                                   MD052410 MD054240
      *                                                                                     MD052410
     C/COPY WNCPYSRC,LEH00687
      *                                                                                       CLE073
     C                     MOVE 'Y'       UFELPM  1                                           CLE073
     C           FECALT    IFEQ '97'                                                          CLE073
     C           FECALT    OREQ '98'                                                          CLE073
     C           FECALT    OREQ '99'                                                          CLE073
     C           FECALT    OREQ '90'                                                          CLE134
     C                     MOVE 'N'       UFELPM                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C**********           ENDIF                                                     245081 MD052410
      *                                                                                       227253
      ** Do not include adjustment in computing accrued to date for                           227253
      ** old fees                                                                             227253
      *                                                                                       227253
     C           FEINDC    IFEQ 'Y'                                                           227253
     C********** FARECI    ANDEQ'A'                                                  247644 MD047522
     C           FARECC    ANDEQ'A'                                                         MD047522
     C           FASIGN    IFEQ '+'                                                           227253
     C           FASIGN    OREQ ' '                                                           227253
     C                     ADD  FASADJ    LKEAMT                                              227253
     C                     ELSE                                                               227253
     C                     SUB  FASADJ    LKEAMT                                              227253
     C                     ENDIF                                                              227253
     C                     ENDIF                                                              227253
      *                                                                                       227253
     C***********          Z-ADDFEADAT    FELPAM                   BH3467 BH3481
     C********** FELCHD    IFNE BJRDNB                                                 218648 261129
     C/COPY WNCPYSRC,LEH00688
      *                                                                                       CLE073
     C********** UFELPM    ANDEQ'Y'                                                    CLE073 261129
     C           UFELPM    IFEQ 'Y'                                                           261129
     C           WFACLF    ANDEQ'Y'                                                           CLE134
      *                                                                                       CLE073
     C********** FENPYD    ORGT BJRDNB                                                 218648 261129
      *                                                                                      261129A
      ** Re-instate part of fix for payment date, CLE073 uses it (UFELPM -'N')               261129A
      *                                                                                      261129A
     C           UFELPM    OREQ 'N'                                                          261129A
     C           FENPYD    ANDGTBJRDNB                                                       261129A
     C           UFELPM    OREQ 'N'                                                          261129A
     C           FEPEND    ANDLTBJRDNB                                                       261129A
     C           FEPEND    ORLT BJRDNB                                                        CLE134
     C           FELPDT    ANDEQFEPEND                                                        CLE134
     C           WFACLF    ANDEQ'N'                                                           CLE134
     C                     ADD  FEADAT    FELPAM                          BH3481
     C                     Z-ADD0         FEADAT                          BH3467
     C                     ENDIF                                                              218648
     C********** CLE005    IFEQ 'N'                                                    243496 245803
     C********** FATYPE    ANDEQ' '                                                    243496 245803
     C********** FASADJ    ANDNE0                                                      243496 245803
     C********** FASIGN    IFEQ '+'                                                    243496 245803
     C********** FASIGN    OREQ ' '                                                    243496 245803
     C**********           ADD  FASADJ    FELPAM                                       243496 245803
     C**********           ELSE                                                        243496 245803
     C**********           SUB  FASADJ    FELPAM                                       243496 245803
     C**********           ENDIF                                                       243496 245803
     C**********           ENDIF                                                       243496 245803
     C           CLE005    IFEQ 'N'                                                          243496B
     C           FATYPE    ANDEQ' '                                                          243496B
     C           FASADJ    ANDNE0                                                            243496B
     C           FEINDC    OREQ 'Y'                                                         MD047522
     C           FATYPE    ANDEQ' '                                                         MD047522
     C           FASADJ    ANDNE0                                                           MD047522
     C           FASIGN    IFEQ '+'                                                          243496B
     C           FASIGN    OREQ ' '                                                          243496B
     C                     ADD  FASADJ    FELPAM                                             243496B
     C                     ELSE                                                              243496B
     C                     SUB  FASADJ    FELPAM                                             243496B
     C                     ENDIF                                                             243496B
     C                     ENDIF                                                             243496B
     C                     END                                            BH3467
      *
     C                     END
      *                                                                                      BUG8762
      ** Write to LEFHST when payment date is reached.                                       BUG8762
      *                                                                                      BUG8762
     C           FELPDT    IFNE *ZEROS                                                      MD052216
     C                     Z-ADDFELPDT    WNWDAT                                            MD052216
     C                     EXSR CHKPAY                                                      MD052216
     C                     Z-ADDWNPAYD    @PAYTD                                            MD052216
     C                     ENDIF                                                            MD052216
      *                                                                                     MD052216
     C********** FELPDT    IFEQ CODT                                                BUG8762 MD052216
     C********** FELPDT    ORLT CODT                                                BUG8762 MD052216
     C********** FELPDT    ANDGTBJRDNB                                                BUG8762 250628
     C********** FELPDT    ANDGEBJRDNB                                               250628 MD052216
     C********** ATYP      ANDNE'H'                                                  250628 MD052216
     C           @PAYTD    IFEQ CODT                                                        MD052216
     C           @PAYTD    ORLE CODT                                                        MD052216
     C           @PAYTD    ANDGEBJRDNB                                                      MD052216
     C           ATYP      ANDNE'H'                                                         MD052216
     C           WPAYTD    OREQ 'Y'                                                         MD052216
     C           ATYP      ANDNE'H'                                                         MD052216
     C********** @NPAYD    ORLT CODT                                                 250628 MD052216
     C           @PAYTD    ORLE CODT                                                        MD052216
     C           ATYP      ANDEQ'H'                                                           250628
     C           BKANWD    OREQ '2'                                                         AR820690
     C           FELPDT    ANDLTCODT                                                        AR820690
     C           FELPDT    ANDGTPRUN                                                        AR820690
     C********** FELPDT    ORLT BJRDNB                                                BUG8762 250628
     C********** FELPDT    ANDGTCODT                                                  BUG8762 250628
     C********** FELCHD    OREQ CODT                                                  BUG8762 250628
     C********** @NPAYD    ANDLECODT                                                  BUG8762 250628
     C********** ATYP      ANDEQ'H'                                                   BUG8762 250628
      *                                                                                     MD052216
     C                     MOVEL*BLANK    WPAYTD                                            MD052216
      *                                                                                      BUG8762
      ** If CLE005 or CDE002 is on, setup details for writing a                              BUG8762
      ** record in LEFHST.                                                                   BUG8762
      *                                                                                      BUG8762
     C           FELPDT    LOKUPWARY                     82                                 AR753180
      *                                                                                     AR753180
     C           CLE005    IFEQ 'Y'                                                          BUG8762
     C           FEPYON    ANDEQ'N'                                                          BUG8762
     C           *IN82     ANDEQ'0'                                                         AR753180
     C           CDE002    OREQ 'Y'                                                          BUG8762
     C           *IN82     ANDEQ'0'                                                         AR753180
     C/COPY WNCPYSRC,LEH00613
      *                                                                                      BUG8762
     C                     MOVE 'D'       HIRECI                                             BUG8762
     C                     MOVE FEBRCA    HIBRCA                                             BUG8762
     C                     MOVE FECNUM    HICNUM                                             BUG8762
     C                     MOVE FEFACL    HIFACL                                             BUG8762
     C                     MOVE FELOAN    HILNRF                                             BUG8762
     C                     MOVE FEFSEQ    HIFSEQ                                             BUG8762
     C                     MOVE FEFCOD    HIFCOD                                             BUG8762
     C                     MOVE FEFCCY    HIFCCY                                             BUG8762
     C*                                                                                      BUG8762
     C** Add settled amount and any settlements today to historical                          BUG8762
     C** settled amount.                                                                     BUG8762
     C*                                                                                      BUG8762
     C                     Z-ADDFEAMTS    HIAMTS                                             BUG8762
     C********** FATYPE    IFEQ 'P'                                                   BUG8762 260881
     C********** FATYPE    OREQ 'F'                                                   BUG8762 260881
     C**********           ADD  FASADJ    HIAMTS                                      BUG8762 260881
     C**********           ENDIF                                                      BUG8762 260881
     C********** FELCHD    IFEQ CODT                                                BUG8762 MD052216
     C********** @NPAYD    ANDLECODT                                                BUG8762 MD052216
     C********** @NPAYD    ANDNEFEPEND                                              BUG8762 MD052216
     C           @PAYTD    IFLE CODT                                                        MD052216
     C           ATYP      ANDEQ'H'                                                          BUG8762
     C                     ADD  FEAMTP    HIAMTS                                             BUG8762
     C                     ENDIF                                                             BUG8762
     C*                                                                                      BUG8762
     C                     Z-ADDFELPDT    HIHDAT                                             BUG8762
     C                     Z-ADDFELPDT    HILCHD                                             BUG8762
     C                     MOVE 'I'       HILCHT                                             BUG8762
     C                     ADD  1         R                                                 AR753180
     C                     Z-ADDFELPDT    WARY,R                                            AR753180
      *                                                                                      BUG8762
      ** Move fee rates and amounts fields from LEFEED to LEFHST if CLE005                   BUG8762
      ** is on and FEINDC not 'Y'.                                                           BUG8762
      *                                                                                      BUG8762
     C           CLE005    IFEQ 'Y'                                                          BUG8762
     C           FEINDC    ANDNE'Y'                                                          BUG8762
     C                     Z-ADDFEFRT1    HIFRT1                                             BUG8762
     C                     Z-ADDFEFRT2    HIFRT2                                             BUG8762
     C                     Z-ADDFEFRT3    HIFRT3                                             BUG8762
     C                     Z-ADDFEFRT4    HIFRT4                                             BUG8762
     C                     Z-ADDFEFRT5    HIFRT5                                             BUG8762
     C                     Z-ADDFEAMT1    HIAMT1                                             BUG8762
     C                     Z-ADDFEAMT2    HIAMT2                                             BUG8762
     C                     Z-ADDFEAMT3    HIAMT3                                             BUG8762
     C                     Z-ADDFEAMT4    HIAMT4                                             BUG8762
     C                     Z-ADDFEAMT5    HIAMT5                                             BUG8762
     C                     ELSE                                                             MD045479
     C                     Z-ADD*ZEROS    HIFRT1                                            MD045479
     C                     Z-ADD*ZEROS    HIFRT2                                            MD045479
     C                     Z-ADD*ZEROS    HIFRT3                                            MD045479
     C                     Z-ADD*ZEROS    HIFRT4                                            MD045479
     C                     Z-ADD*ZEROS    HIFRT5                                            MD045479
     C                     Z-ADD*ZEROS    HIAMT1                                            MD045479
     C                     Z-ADD*ZEROS    HIAMT2                                            MD045479
     C                     Z-ADD*ZEROS    HIAMT3                                            MD045479
     C                     Z-ADD*ZEROS    HIAMT4                                            MD045479
     C                     Z-ADD*ZEROS    HIAMT5                                            MD045479
     C                     ENDIF                                                             BUG8762
      *                                                                                     AR750601
     C                     EXSR ADDFLD                                                      AR750601
     C*                                                                                      BUG8762
     C********** HIAMTS    IFNE 0                                                     BUG8762 248358
     C********** FEAUTO    OREQ 'Y'                                                   BUG8762 248358
     C                     Z-ADD*ZERO     HIRCVD                                             CLE071A
     C                     MOVEL*BLANKS   HIRCTP                                             CLE071A
     C                     WRITELEFHSTF                                                      BUG8762
     C**********           ENDIF                                                      BUG8762 248358
     C                     ENDIF                                                             BUG8762
     C                     ENDIF                                                             BUG8762
      *
      ** Generate account key - if accrual profit date or payment date    BH3467
      *
     C           ATYP      IFEQ 'H'                                       BH3467
     C           WPROC     ANDEQ*BLANK                                    153672
     C           BKAPDT    ORGE BJRDNB                                    BH3467
     C           BKAPDT    ANDLTBJDNWD                                    BH3467
     C           WPROC     ANDEQ*BLANK                                    153672
     C/COPY WNCPYSRC,LEH00689
      *                                                                                       CLE073
     C           FECALT    IFNE '99'                                                          CLE073
     C           FECALT    ANDNE'90'                                                          CLE134
     C           FECALT    OREQ '99'                                                          CLE073
     C           ATYP      ANDEQ'H'                                                           CLE073
     C           FECALT    OREQ '99'                                                          CLE073
     C           FENPYD    ANDGEBJRDNB                                                        CLE073
     C           FECALT    OREQ '90'                                                          CLE134
     C           ATYP      ANDEQ'H'                                                           CLE134
     C           FECALT    OREQ '90'                                                          CLE134
     C           FENPYD    ANDGEBJRDNB                                                        CLE134
      *                                                                                       CLE073
     C                     Z-ADD0         LKREVI
     C                     EXSR GENKEY
     C/COPY WNCPYSRC,LEH00690
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     END                                            BH3467
      *
     C                     ENDSR
      *
      *****************************************************************                       CSW208
     C/TITLE SR/ADDFLD                                                                        CSW208
      ********************************************************************                    CSW208
      *                                                                                       CSW208
      *  ADDFLD -  Populate new fields on history file LEFHST.                                CSW208
      *            These are part of SWIFT 2008 Changes.                                      CSW208
      *                                                                                       CSW208
      *  CALLED FROM: SR/UPDFEE                                                               CSW208
      *                                                                                       CSW208
      *  CALLS: NOTHING                                                                       CSW208
      *                                                                                       CSW208
      ********************************************************************                    CSW208
      *                                                                                       CSW208
     C           ADDFLD    BEGSR                                                              CSW208
      *                                                                                       CSW208
     C           CSW208    IFEQ 'Y'                                                           CSW208
      *                                                                                       CSW208
      ** Populate additional fields on history file if CSW208 is switched ON                  CSW208
      *                                                                                       CSW208
     C                     MOVE OSDB      HIOSDB                                              CSW208
     C                     MOVE OMDB      HIOMDB                                              CSW208
     C                     Z-ADDRSTM      HIRSTM                                              CSW208
     C                     MOVE RONS      HIRONS                                              CSW208
     C                     MOVE RIBN      HIRIBN                                              CSW208
     C                     MOVE RIBA      HIRIBA                                              CSW208
     C**********           MOVE *ZERO     ROBN                                       CSW208 MD037173
     C                     MOVE *BLANK    ROBN                                              MD037173
     C                     MOVE ROBN      HIROBN                                              CSW208
     C                     MOVE ROCN      HIROCN                                              CSW208
     C                     MOVE ROCN      HIROCN                                              CSW208
     C                     Z-ADDPSTM      HIPSTM                                              CSW208
     C                     MOVE PONS      HIPONS                                              CSW208
     C                     MOVE PIBN      HIPIBN                                              CSW208
     C                     MOVE PIBA      HIPIBA                                              CSW208
     C                     MOVE *ZERO     POBN                                                CSW208
     C                     MOVE POBN      HIPOBN                                              CSW208
     C                     MOVE *ZERO     POCN                                                CSW208
     C                     MOVE POCN      HIPOCN                                              CSW208
     C                     MOVE RCRN      HIRCRN                                              CSW208
     C                     MOVE RCRA      HIRCRA                                              CSW208
     C                     MOVE RVNO      HIRVNO                                              CSW208
     C                     MOVE AWBN      HIAWBN                                              CSW208
     C                     MOVE AWBA      HIAWBA                                              CSW208
     C                     MOVE BENN      HIBENN                                              CSW208
     C                     MOVE BENA      HIBENA                                              CSW208
     C                     MOVE DTP1      HIDTP1                                              CSW208
     C                     MOVE DTP2      HIDTP2                                              CSW208
     C                     MOVE DTP3      HIDTP3                                              CSW208
     C                     MOVE DTP4      HIDTP4                                              CSW208
     C                     MOVE DCHG      HIDCHG                                              CSW208
     C                     MOVE BTB1      HIBTB1                                              CSW208
     C                     MOVE BTB2      HIBTB2                                              CSW208
     C                     MOVE BTB3      HIBTB3                                              CSW208
     C                     MOVE BTB4      HIBTB4                                              CSW208
     C                     MOVE BTB5      HIBTB5                                              CSW208
     C                     MOVE BTB6      HIBTB6                                              CSW208
     C                     MOVE CVMR      HICVMR                                              CSW208
     C                     MOVE FESCCY    HIFSCY                                              CSW208
     C                     MOVE FEICCY    HIFICY                                              CSW208
     C                     MOVE FESCCY    HIPSCY                                              CSW208
     C*                                                                                       CSW208
     C                     ENDIF                                                              CSW208
     C*                                                                                       CSW208
     C                     ENDSR                                                              CSW208
      *****************************************************************
     C/TITLE SR/GENKEY
      *****************************************************************
      *
      *  GENKEY SUBROUTINE TO GENERATE ACCOUNT KEY
      *
      *  In case of changes to this sub-routine, verify whether these apply to              MD031473
      *  SR/GENKYL as well, as sr/GENKYL is based on sr/GENKEY.                             MD031473
      *                                                                                     MD031473
      *  CALLED FROM:  MAIN PROCESSING, UPDFEE
      *
      *  CALLS:  ZSFILE, AOBRCHR0, ZHASH
      *
      *****************************************************************
      *
     C           GENKEY    BEGSR
     C/COPY WNCPYSRC,LEH00691
     C                     MOVEL'Y'       GENKY   1                                         MD051883
     C                     MOVEL'Y'       FCTYFL  1                                         MD051883
      *                                                                                     AR567790
      ** Clear LKOSAC to prevent the field to contain                                       AR567790
      ** the previous account key LKOSAC                                                    AR567790
      *                                                                                     AR567790
     C           FEAUTO    IFEQ 'C'                                                         AR567790
     C           CLE134    ANDEQ'Y'                                                         AR567790
     C           *IN61     ANDEQ*OFF                                                        AR567790
     C                     CLEARLKOSAC                                                      AR567790
     C                     CLEARLKSETP                                                      AR567790
     C                     ENDIF                                                            AR567790
      *                                                                                       CLE073
      ** If CLE073 is on and loan based fee then process GENKYL                               CLE073
      *                                                                                       CLE073
     C           WFACLF    IFEQ 'N'                                                           CLE073
     C                     EXSR GENKYL                                                        CLE073
      *                                                                                       CLE139
     C           FECAPI    IFEQ 'Y'                                                           CLE139
     C           *IN61     ANDEQ'1'                                                           CLE139
     C                     EXSR SRLOAM                                                        CLE139
     C                     ENDIF                                                              CLE139
      *                                                                                       CLE139
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C           WFACLF    IFEQ 'Y'                                                           CLE073
      *                                                                                       CLE073
      *
      ** Ignore if key amount zero.
      *
     C           LKEAMT    IFNE 0
      *
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C                     MOVE FEFSFA    LKSFA                                               CLE134
     C                     MOVE WATYPE    LKTYPE                                              CLE134
     C                     Z-ADD*ZEROS    LKAAMT                                              CLE134
     C                     MOVE FECNUM    LKCNU2                                              CLE134
     C                     MOVE FELOAN    LKLOAN                                              CLE134
     C                     MOVE FEFACL    LKFACL                                              CLE134
     C                     MOVE FEFCOD    LKFCOD                                              CLE134
     C                     MOVE FEBRCA    LKFBRC                                              CLE134
     C                     MOVE *BLANKS   LKIPFL                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
      ** Set up account key.
      *
     C                     MOVE 'F'       LKRECI
     C**********           Z-ADDFEFACL    LKLNNO                                              CLE148
     C                     MOVEL*BLANKS   LKLNNO                                              CLE148
     C                     MOVE FEFACL    LKLNNO                                              CLE148
     C           *IN61     IFEQ '1'
     C                     MOVE 'R'       AKY,4
     C                     ELSE
     C                     MOVE 'A'       AKY,4
     C                     END
     C                     MOVEAWFTYP     AKY,1
     C                     MOVEAWFCOD     AKY,8
     C                     MOVE 'F'       AKY,10
     C                     MOVEA'   '     AKY,5
     C                     MOVE ' '       AKY,6
      *                                                                   CLE005
      ** If CLE004 and CLE005 is on, setup Pos. 7 of account key.         CLE005
      *                                                                   CLE005
     C           CLE004    IFEQ 'Y'                                       CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           PTFI      IFEQ 'I'                                       CLE005
     C                     MOVE 'I'       AKY,7                           CLE005
     C                     ELSE                                           CLE005
     C           PTFI      IFEQ 'P'                                       CLE005
     C           PTFI      OREQ 'S'                                                           CLE106
     C           PTFI      OREQ 'R'                                                           CLE106
     C                     MOVE 'P'       AKY,7                           CLE005
     C                     ELSE                                           CLE005
     C                     MOVE ' '       AKY,7                           CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
      *                                                                                     AR745249
      ** Add the Loan Class to the account key                                              AR745249
      *                                                                                     AR745249
     C                     MOVEAFECLAS    AKY,11                                            AR745249
      *
     C/COPY WNCPYSRC,LEH00379
     C                     MOVEAAKY       LKAKEY
     C**********           Z-ADDFECNUM    LKCNUM                                              CSD027
     C                     MOVE FECNUM    LKCNUM                                              CSD027
     C                     MOVE FEFCCY    LKECCY
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C                     EXSR SR34A                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'Y'       WKFLD                                               CLE034
     C                     MOVE '*EOF   ' PRTCDE                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           WKFLD     DOWEQ'Y'                                                           CLE034
     C           PRTCDE    OREQ *BLANKS                                                       CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C                     EXSR SR34B                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                   CLE005
      ** If CLE005 is off, perform previous processing for                CLE005
      ** settlement details.                                              CLE005
      *                                                                   CLE005
     C           CLE005    IFNE 'Y'                                       CLE005
      *                                                                   CLE005
     C                     MOVE FEAUTO    WFEAUT                                              CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           WFEAUT    IFEQ 'C'                                                           CLE134
     C           FEAUT2    OREQ 'C'                                                           CLE134
     C                     MOVE 'Y'       WFEAUT                                              CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C           *IN61     IFEQ '1'                                       E45504
     C********** FEAUTO    ANDNE'Y'                                                    E45504 CLE134
     C           WFEAUT    ANDNE'Y'                                                           CLE134
     C           *IN61     OREQ '1'                                                           CLE134
     C           WFEAUT    ANDEQ'Y'                                                           CLE134
     C           FSETAC    ANDEQ'Y'                                                           CLE134
     C           WSTYPE    ANDEQ'ADJ'                                                       AR699396
     C                     MOVELFAOURS    LKOSAC                          E45504
     C                     Z-ADDFAMETH    LKSETP                          E45504
     C                     ELSE                                           E45504
     C                     MOVELFEOURS    LKOSAC
     C                     Z-ADDFESTTL    LKSETP
     C                     END                                            E45504
      *                                                                                       CGL020
      ** Determine AML Pay/Receive Instructions                                               CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     EXSR SRAMLI                                                        CGL020
     C                     ENDIF                                                              CGL020
      *                                                                   CLE005
     C                     ENDIF                                          CLE005
      *                                                                                       261128
      ** Set up workfield                                                                     261128
      *                                                                                       261128
     C           *IN61     IFEQ '1'                                                           261128
     C           MSFLAG    ANDEQ'Y'                                                           261128
     C                     MOVE 'Y'       FEESET  1                                           261128
     C                     ELSE                                                               261128
     C                     MOVE ' '       FEESET                                              261128
     C                     ENDIF                                                              261128
      *                                                                   CLE005
      ** If CLE005 is on and Manual settlement flag is 'Y'.               CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C           MSFLAG    ANDEQ'Y'                                       CLE005
     C                     Z-ADDFAVDAT    LKEDAT                          CLE005
     C                     MOVE ' '       MSFLAG                          CLE005
     C                     ELSE                                           CLE005
     C                     Z-ADDCODT      LKEDAT
     C           ENDATE    IFLT CODT                                                        AR823503
     C                     Z-ADDENDATE    LKEDAT                                            AR823503
     C                     ENDIF                                                            AR823503
     C                     ENDIF                                          CLE005
      *
      ** Use branch code from FACHISH to set up field LKBRCD
      ** & zeroise the a/c sequence no. (LKACSQ) in LF/LKEYFED
      ***  If this is a settlement, use settlement branch code.           BH3495
      *
     C                     MOVE FHBRCH    LKBRCD
      *                                                                   CLE005
      ** If CLE005 is off, perform previous processing for                CLE005
      ** settlement details.                                              CLE005
      *                                                                   CLE005
     C           CLE005    IFNE 'Y'                                       CLE005
      *                                                                   CLE005
     C           *IN61     IFEQ '1'                                       BH3495
     C*                                                                   E45504
     C***  Ensure correct settlement branch output for settlement.        E45504
     C*                                                                   E45504
     C           FEAUTO    IFNE 'Y'                                       E45504
     C           FEAUTO    ANDNE'C'                                                           CLE134
     C                     MOVE FAOSBR    LKOSBR                          BH3495
     C                     ELSE                                           E45504
     C           FEOSBR    IFNE *BLANKS                                   E45504
     C                     MOVE FEOSBR    LKOSBR                          E45504
     C                     ELSE                                           E45504
     C                     MOVE FEBRCA    LKOSBR                          E45504
     C                     END                                            E45504
     C                     END                                            E45504
     C*                                                                   E45504
     C                     ELSE                                           BH3495
     C                     MOVE *BLANKS   LKOSBR                          BH3495
     C                     END                                            BH3495
      *                                                                   CLE005
     C                     ENDIF                                          CLE005
      *                                                                                     AR800866
      ** Chain to PF/FCLTYFM and check for the account sequence.                            AR800866
      *                                                                                     AR800866
     C                     MOVELFEFACL    FCFTYP                                            AR800866
     C                     MOVE FEFACL    FCFNUM                                            AR800866
      *                                                                                     AR800866
     C           *LOVAL    SETLLFCLTY                                                       AR800866
     C           FCKEY     CHAINFCLTY               N01                                     AR800866
     C           *IN01     IFEQ '0'                                                         AR800866
     C                     Z-ADDFCACSQ    LKACSQ                                            AR800866
     C                     ELSE                                                             AR800866
     C                     Z-ADD*ZEROS    LKACSQ
     C                     ENDIF                                                            AR800866
     C**********           Z-ADD*ZEROS    LKOLNO                                       243499 CPK027
     C                     MOVE *BLANKS   LKOLNO                                              CPK027
      *
      ** Set up amount for output
      *
      *                                                                   179741
      ** If settlement method is 09 and postings are to use Transaction                       218782
      ** currency, do not set up LKSCCY.                                                      218782
      *                                                                                       218782
     C           CLE033    IFEQ 'Y'                                                           218782
     C********** SETP      ANDEQ09                                                     218782 218992
     C           FESTTL    ANDEQ09                                                            218992
     C           SET09     ANDEQ'T'                                                           218782
     C                     ELSE                                                               218782
      *                                                                                       218782
      ** If the settlement currency is entered and the amount is not      179741
      ** zero, fill in the settlement currency.                           179741
      *                                                                   179741
     C           CEU004    IFEQ 'Y'                        EMU ON         179741
     C           FESCCY    ANDNE'   '                      SETTLE. CCY    179741
     C           FESCCY    ANDNEFEFCCY                     CCY            179741
     C           LKEAMT    ANDNE0                                         179741
     C                     MOVE FESCCY    LKSCCY                          179741
     C                     ENDIF                                          179741
     C                     ENDIF                                                              218782
     C                     Z-ADDLKEAMT    EAMT0
      *                                                                   CLE005
      ** If CLE005 is on and *IN61 is on, setup settlement details.       CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C           *IN61     ANDEQ'1'                                       CLE005
      *                                                                                       220555
     C           FEAUTO    IFNE 'Y'                                                           220555
     C           FEAUTO    ANDNE'C'                                                           CLE134
     C           FEAUT2    ANDNE'C'                                                           CLE134
      *                                                                                       CLE134
     C           FEAUTO    OREQ 'Y'                                                           CLE134
     C           FSETAC    ANDEQ'Y'                                                           CLE134
     C           WSTYPE    ANDEQ'ADJ'                                                       AR750305
     C           FEAUTO    OREQ 'C'                                                           CLE134
     C           FSETAC    ANDEQ'Y'                                                           CLE134
     C           WSTYPE    ANDEQ'ADJ'                                                       AR699396
     C                     MOVELFAOURS    LKOSAC                                              220555
     C                     Z-ADDFAMETH    LKSETP                                              220555
     C                     MOVE FAOSBR    LKOSBR                                              220555
      *                                                                                       220555
      ** Determine AML Pay/Receive Instructions                                               220555
      *                                                                                       220555
     C           CGL020    IFEQ 'Y'                                                           220555
     C                     MOVELSTLNS2    STLNS1                                              220555
     C                     EXSR SRAMPR                                                        220555
     C                     ENDIF                                                              220555
      *                                                                                       220555
     C                     ELSE                                                               220555
      *                                                                   CLE005
     C           CLE004    IFEQ 'Y'                                       CLE005
     C           CLE004    OREQ 'N'                                       CLE005
     C           PTFI      ANDEQ' '                                       CLE005
     C                     MOVE OSDB      LKOSBR                          CLE005
     C                     MOVE RONS      LKOSAC                          CLE005
     C                     MOVE RSTM      LKSETP                          CLE005
      *                                                                                       CGL020
      ** Determine AML Pay/Receive Instructions                                               CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVELSTLNS2    STLNS1                                              CGL020
     C                     EXSR SRAMPR                                                        CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C           CLE004    IFEQ 'Y'                                       CLE005
     C********** PTFI      ANDEQ'P'                                                    CLE005 CLE106
     C           PTFI      IFEQ 'P'                                                           CLE106
     C           PTFI      OREQ 'S'                                                           CLE106
     C           PTFI      OREQ 'R'                                                           CLE106
     C                     MOVE OMDB      LKOSBR                          CLE005
     C                     MOVE PONS      LKOSAC                          CLE005
     C                     MOVE PSTM      LKSETP                          CLE005
      *                                                                                       CGL020
      ** Determine AML Pay/Receive Instructions                                               CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVELSTLNS2    STLNS1                                              CGL020
     C                     EXSR SRAMPR                                                        CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     ENDIF                                                              CLE106
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C           CLE004    IFEQ 'Y'                                       CLE005
     C           PTFI      ANDEQ'I'                                       CLE005
     C                     MOVE *BLANK    LKOSBR                          CLE005
     C                     MOVE *BLANK    LKOSAC                          CLE005
      *                                                                                       CGL020
      ** Determine AML Pay/Receive Instructions                                               CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVEL*BLANKS   STLNS1                                              CGL020
     C                     EXSR SRAMPR                                                        CGL020
     C                     ENDIF                                                              CGL020
     C**********           ENDIF                                                       220555 242777
      *                                                                                       CGL020
     C                     MOVE *BLANK    LKSETP                          CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                                              242777
      *                                                                                       CGL020
      ** If Midas Compliance Watch (CGL020) is installed and Repayment,                       CGL020
      ** set Fee Flag = 'F', Fee Value = Posting Amount and Fee Percent = 100                 CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVE 'F'       F1FFLG                                              CGL020
     C                     Z-ADDLKEAMT    F1FVAL                                              CGL020
     C                     Z-ADD100       F1FPCT                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                   CLE005
     C                     ENDIF                                          CLE005
      *                                                                   127966
      ** Move the Profit Centre if Profit Centres are used.                                   247979
      *                                                                                       247979
     C           BGN0ST    IFEQ 'Y'                                       127966
     C           BGN0ST    OREQ 'N'                                                           247979
     C           BKPRCU    ANDEQ'Y'                                                           247979
     C           FEPRFC    ANDNE*BLANKS                                                       247979
     C                     MOVE FEPRFC    LKPRFC                          127966
     C                     ENDIF                                          127966
      *                                                                   100817
      * Setup start date or last interest date variable (LKSLID).         100817
      *                                                                   100817
     C                     Z-ADDFEPSTD    LKSLID                          100817
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           *IN61     ANDEQ'1'                                                           CLE031
     C                     EXSR SETCCY                                                        CLE031
     C                     ENDIF                                                              CLE031
     C*                                                                   BH3479
     C** Payment processing, therefore posting should be processed        BH3479
     C** tomorrow                                                         BH3479
     C*                                                                   BH3479
     C           ATYP      IFEQ 'H'                                       BH3479
     C           FELPDT    ANDGEBJDNWD                                    BH3479
     C********** FEAUTO    ANDEQ'Y'                                                    250628 259030
     C           FEESET    ANDEQ' '                                                           261128
     C*                                                                   E45504
     C***  But put settlement straight to LKEYFED                         E45504
     C*                                                                   E45504
     C************IN61     ANDEQ'0'                                E45504 100429
     C*                                                                   E45504
      *                                                                   132877
      ** If Fee Last Payment Date equal to Fee End Date and Accrue        132877
      ** on Last Day indicator is not equal to 'Y', subtract one          132877
      ** to get the correct event date.                                   132877
      *                                                                   132877
     C           FELPDT    IFEQ FEPEND                                    132877
     C           BKALDI    ANDNE'Y'                                       132877
     C           BJDNWD    SUB  1         LKEDAT                          132877
     C                     ELSE                                           132877
     C                     Z-ADDBJDNWD    LKEDAT                          BH3479
     C                     END                                            132877
      *                                                                   132877
     C                     Z-ADDFEFSEQ    LKFSEQ                          E45504
      *                                                                                       CLE134
      ** If CLE134 is On and a/ck is repayment (event R) and FEAUTO                           CLE134
      ** is C or CLE134 is On and a/c key is repayment and FEAUTO                             CLE134
      ** = 'Y' and fee is a suspense fee, then output to LEPTKDP                              CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           AKY,4     ANDEQ'R'                                                           CLE134
     C           FEAUTO    ANDEQ'C'                                                           CLE134
      *                                                                                       CLE134
      ** Suspended fee                                                                        CLE134
      *                                                                                       CLE134
     C           CLE134    OREQ 'Y'                                                           CLE134
     C           AKY,4     ANDEQ'R'                                                           CLE134
     C********** FEAUTO    ORNE 'N'                                                  CLE134 AR567790
     C           FEAUTO    ANDNE'N'                                                         AR567790
     C           FEFSFA    ANDEQ'Y'                                                           CLE134
     C                     WRITELKEYFTDF                                                      CLE134
     C                     ELSE                                                               CLE134
     C                     WRITEPSTTOMF                                   BH3479
     C                     ENDIF                                                              CLE134
     C                     ELSE                                           BH3479
     C*                                                                   093212
     C           ATYP      IFEQ 'H'                                       093212
     C           FELPDT    ANDLTBJDNWD                                    093212
     C           FEESET    ANDEQ' '                                                         AR640738
     C           *IN61     OREQ '1'                                       132877
     C********** FELPDT    ANDEQBJDNWD                                               132877 AR852475
     C********** FELPDT    ANDGEBJRDNB                                             AR852475 MD052216
     C           FELPDT    ANDLTBJDNWD                                                      MD052216
     C           FELPDT    ANDLECODT                                      155912
     C           FEESET    ANDEQ' '                                                         AR640738
     C                     Z-ADDFELPDT    LKEDAT                          093212
      *                                                                                     MD025983
      ** Check if backvalued to previous year when Analytical                               MD025983
      ** Accounting is on, to prevent reversal of accrued fee                               MD025983
      ** amount to be posted to retained earnings account.                                  MD025983
      *                                                                                     MD025983
     C           BGN0ST    IFEQ 'Y'                                                         MD025983
     C           AKY,4     ANDEQ'A'                                                         MD025983
     C           LKEDAT    IFLE JAN1                                                        MD025983
     C                     Z-ADDBJRDNB    LKEDAT                                            MD025983
     C                     ENDIF                                                            MD025983
     C                     ENDIF                                                            MD025983
      *                                                                                     MD025983
     C                     END                                            093212
      **********                                                                     CLE025 BUG13031
      ***If*CLE025*is*on,*adjust*event*date*of*fees*posted*today                     CLE025 BUG13031
      **********                                                                     CLE025 BUG13031
     C********** CLE025    IFEQ 'Y'                                                  CLE025 BUG13031
     C********** LKEDAT    ADD  1         WEDAT   50                                 CLE025 BUG13031
     C********** BJRDNB    ADD  1         WRDNB   50                                 CLE025 BUG13031
      **********                                                                     CLE025 BUG13031
      ***Set*event*date*to*whichever*is*later*between                                CLE025 BUG13031
      ***event*date*+*1*and*rundate*+*1                                              CLE025 BUG13031
      **********                                                                     CLE025 BUG13031
     C********** WEDAT     IFGT WRDNB                                                CLE025 BUG13031
     C**********           Z-ADDWEDAT     LKEDAT                                     CLE025 BUG13031
     C**********           ELSE                                                      CLE025 BUG13031
     C**********           Z-ADDWRDNB     LKEDAT                                     CLE025 BUG13031
     C**********           ENDIF                                                     CLE025 BUG13031
     C**********           ENDIF                                                     CLE025 BUG13031
      *
      ** Write to account keys file
      *
     C                     MOVE 'N'       WNEWF   1                                           CLE134
     C                     MOVE *BLANKS   WTYPE   1                                           CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           LKRECI    IFEQ 'F'                                                           CLE134
     C           AKY,4     ANDEQ'R'                                                           CLE134
     C           LKRECI    OREQ 'L'                                                           CLE134
     C           AKY,3     ANDEQ'R'                                                           CLE134
     C                     MOVE 'R'       WTYPE   1                                           CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
      ** If auto-settle is 'C' (funds pre-check) or is Y and fee is                           CLE134
      ** allowed to be suspended, then output to new account keys file                        CLE134
      *                                                                                       CLE134
     C           FEAUTO    IFEQ 'C'                                                           CLE134
     C           WTYPE     ANDEQ'R'                                                           CLE134
     C           FECALT    ANDNE'90'                                                          CLE134
      *                                                                                       CLE134
     C           FEAUT2    OREQ 'C'                                                           CLE134
     C           WTYPE     ANDEQ'R'                                                           CLE134
     C           FECALT    ANDNE'90'                                                          CLE134
      *                                                                                       CLE134
      ** Fee allowed to be suspended                                                          CLE134
      *                                                                                       CLE134
     C           FEAUTO    ORNE 'N'                                                           CLE134
     C           WTYPE     ANDEQ'R'                                                           CLE134
     C           FEFSFA    ANDEQ'Y'                                                           CLE134
     C           FECALT    ANDNE'90'                                                          CLE134
      *                                                                                       CLE134
     C                     MOVE 'Y'       WNEWF                                               CLE134
     C           LKRECI    IFEQ 'L'                                                           CLE134
     C**********           MOVE LKLNNO    KLNNO   60                                 CLE134 AR997862
     C                     MOVE LKLNNO    KLNNO   6                                         AR997862
     C                     ELSE                                                               CLE134
     C                     CLEARKLNNO                                                         CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
      ** Retrieve sett account and priority                                                   CLE134
      *                                                                                       CLE134
     C                     Z-ADDFEFACL    WFACL                                               CLE134
     C                     Z-ADDFEFCOD    WFACOD  20                                          CLE134
     C                     CALL 'LE000458'                                                    CLE134
     C                     PARM *BLANKS   RETCOD  7                                           CLE134
     C                     PARM           LKAKEY                                              CLE134
     C                     PARM           LKECCY                                              CLE134
     C                     PARM           KLNNO                                               CLE134
     C                     PARM           FECNUM                                              CLE134
     C                     PARM           FELOAN                                              CLE134
     C                     PARM           WFACL                                               CLE134
     C                     PARM           FEFSEQ                                              CLE134
     C                     PARM           WFACOD                                              CLE134
     C                     PARM           LKSCCY                                              CLE134
     C                     PARM           LKOSAC                                              CLE134
     C                     PARM           LKSETP                                              CLE134
     C                     PARM           LKOLNO                                              CLE134
     C                     PARM           LKOSBR                                              CLE134
      *                                                                                       CLE134
     C                     PARM *BLANKS   SEBRCA                                              CLE134
     C                     PARM *BLANKS   SECNUM                                              CLE134
     C                     PARM *BLANKS   SEACCY                                              CLE134
     C                     PARM *ZEROS    SEACOD                                              CLE134
     C                     PARM *ZEROS    SEACSQ                                              CLE134
     C**********           PARM *ZEROS    SEPCKO                                       CLE134 CLE164
     C                     PARM *BLANKS   OATYP   1                                         AR741212
     C           RETCOD    IFEQ '*ERROR'                                                      CLE134
     C           *LOCK     IN   LDA                                                           CLE134
     C                     MOVEL'LE000458'DBPGM                                               CLE134
     C                     MOVEL'110'     DBASE                                               CLE134
     C                     MOVE *BLANKS   DBKEY                                               CLE134
     C                     OUT  LDA                                                           CLE134
     C                     EXSR *PSSR                                                         CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     Z-ADDFEFSEQ    LKFSE2                                              CLE134
      *                                                                                     AR217562
     C                     MOVE 'Y'       WACCNT  1                                         AR217562
     C           SEBRCA    IFEQ *BLANKS                                                     AR217562
     C           SECNUM    OREQ *BLANKS                                                     AR217562
     C           SEACCY    OREQ *BLANKS                                                     AR217562
     C           SEACOD    OREQ 0                                                           AR217562
     C           SEACSQ    OREQ 0                                                           AR217562
     C           OATYP     OREQ 'N'                                                         AR741212
     C                     MOVE 'N'       WNEWF                                             AR741212
     C                     MOVE 'N'       WACCNT                                            AR217562
     C                     ENDIF                                                            AR217562
      *                                                                                     AR402543
      ***Always*output*to*LEPK2DPD*although*account*is*missing*********            AR402544 AR741212
      *                                                                                     AR402543
     C**********           MOVE 'Y'       WACCNT  1                                AR402543 AR741212
      *                                                                                     AR217562
      ** Set fields                                                                           CLE134
      *                                                                                       CLE134
     C                     MOVEL*BLANKS   SECATC                                              CLE164
     C           FECALT    IFNE '90'                                                          CLE134
     C********** FELOAN    IFEQ *ZEROS                                               CLE134 MD020212
     C           FELOAN    IFEQ *BLANKS                                                     MD020212
     C**********           Z-ADD500       SEPCKM                                       CLE134 CLE164
     C**********           Z-ADD500       SEPCKT                                       263074 CLE164
     C           WSTYPE    IFEQ 'ADJ'                                                         CLE164
     C                     MOVEL'FFEM'    SECATC                                              CLE164
     C                     ELSE                                                               CLE164
     C                     MOVEL'FFEE'    SECATC                                              CLE164
     C                     ENDIF                                                              CLE164
     C                     ELSE                                                               CLE134
     C**********           Z-ADD600       SEPCKM                                       CLE134 CLE164
     C**********           Z-ADD600       SEPCKT                                       263074 CLE164
     C           WSTYPE    IFEQ 'ADJ'                                                         CLE164
     C                     MOVEL'LFEM'    SECATC                                              CLE164
     C                     ELSE                                                               CLE164
     C                     MOVEL'LFEE'    SECATC                                              CLE164
     C                     ENDIF                                                              CLE164
     C                     ENDIF                                                              CLE134
     C                     ELSE                                                               CLE134
     C**********           Z-ADD100       SEPCKM                                       CLE134 CLE164
     C**********           Z-ADD100       SEPCKT                                       263074 CLE164
     C           WSTYPE    IFEQ 'ADJ'                                                         CLE164
     C                     MOVEL'Fee9M'   SECATC                                              CLE164
     C                     ELSE                                                               CLE164
     C                     MOVEL'Fee90'   SECATC                                              CLE164
     C                     ENDIF                                                              CLE164
     C                     ENDIF                                                              CLE134
     C                     MOVELLKLNNO    SELNRF                                              CLE134
     C                     Z-ADDLKEDAT    SEVDAT                                              CLE134
     C                     Z-ADDFEPSTD    SEVDAT                                            AR571427
     C**********           MOVE 'F2'      SEFILE                                       CLE134 CLE164
     C                     MOVEL'LEPK2DPD'SEFILE                                              CLE164
     C                     MOVEL*ZEROS    SEOVRD                                              CLE164
     C                     MOVELFEPSTD    SESDAT                                              CLE164
     C           FEPEND    IFEQ 0                                                             CLE164
     C                     MOVELFEPSTD    SEMDAT                                              CLE164
     C                     ELSE                                                               CLE164
     C                     MOVELFEPEND    SEMDAT                                              CLE164
     C                     ENDIF                                                              CLE164
     C                     MOVEL*ZEROS    SEVDPD                                              CLE164
     C                     MOVELLKEDAT    SEVDPY                                              CLE164
     C                     Z-ADDLKEAMT    SEPAMT                                              CLE164
     C                     MOVELSTMP      SETMST                                              CLE164
     C           SETRID    ADD  1         SETRID                                              CLE164
     C                     MOVEL*BLANKS   SETREF                                              CLE164
     C           FELOAN    IFEQ *BLANKS                                                       CLE164
     C                     MOVELFEFACL    WTREF   9                                           CLE164
     C                     MOVELFEFCOD    WWTREF  4                                           CLE164
     C                     MOVE FEFSEQ    WWTREF                                              CLE164
     C                     MOVE WWTREF    WTREF                                               CLE164
     C                     MOVELWTREF     SETREF                                              CLE164
     C                     ELSE                                                               CLE164
     C                     MOVELFELOAN    XTREF  10                                           CLE164
     C                     MOVELFEFCOD    WWTREF                                              CLE164
     C                     MOVE FEFSEQ    WWTREF                                              CLE164
     C                     MOVE WWTREF    XTREF                                               CLE164
     C                     MOVELXTREF     SETREF                                              CLE164
     C                     ENDIF                                                              CLE164
     C                     EXSR SRRPKY                                                        CLE164
      *                                                                                       CLE134
      ** If settlement account is defined, then output LEPK2DPD,                            AR217562
      ** else output to LKEYFED                                                             AR217562
      *                                                                                     AR217562
     C           WACCNT    IFEQ 'Y'                                                         AR217562
     C                     Z-ADDWRKAMT    LKOTHA                                            MD051242
     C                     WRITELKEYF2DF                                                      CLE134
     C                     CLEARLKOTHA                                                      MD051242
     C                     ELSE                                                             AR217562
     C           WRKPRC    IFEQ 'Y'                                                         MD051883
     C           AKY,4     ANDEQ'R'                                                         MD051883
     C                     MOVE 'V'       AKY,10                                            MD051883
     C                     MOVEAAKY       LKAKEY                                            MD051883
     C                     ENDIF                                                            MD051883
     C                     WRITELKEYFEDF                                                    AR217562
     C                     ENDIF                                                            AR217562
      *                                                                                     AR217562
     C                     ELSE                                                               CLE134
     C           WRKPRC    IFEQ 'Y'                                                         MD051883
     C           AKY,4     ANDEQ'R'                                                         MD051883
     C                     MOVE 'V'       AKY,10                                            MD051883
     C                     MOVEAAKY       LKAKEY                                            MD051883
     C                     ENDIF                                                            MD051883
     C                     WRITELKEYFEDF
     C                     ENDIF                                                              CLE134
     C/COPY WNCPYSRC,LEH01204
      *                                                                                       CGL020
      ** If Midas Compliance Watch (CGL020) is installed and Repayment,                       CGL020
      ** reset Fee Flag, Fee Value and Fee Percent.                                           CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVE *BLANKS   F1FFLG                                              CGL020
     C                     Z-ADD0         F1FVAL                                              CGL020
     C                     Z-ADD0         F1FPCT                                              CGL020
     C                     ENDIF                                                              CGL020
      *
      *  WRITE TO REPORT FILE
      *
      ** If system is multibranching and branch code changes open
      ** new spool file.
      *
     C           MBIN      IFEQ 'Y'
     C           REPBRC    ANDNESTRBRC
      ** Write out total number of account keys generated for last
      ** branch and end of report message before opening new spool file
     C           *IN21     IFEQ '1'
     C                     ADD  NKEY      LKNTOT
     C                     Z-ADDNKEY      LKNORE
     C***/COPY*WNCPYSRC,LEH00983***                                                           CFC006
     C/COPY WNCPYSRC,LEH00983                                                               MD020563
     C           SUPFLG    IFNE 'Y'                                                           CFC006
     C                     WRITELER135A4
     C***/COPY*WNCPYSRC,LEH00984***                                                           CFC006
     C/COPY WNCPYSRC,LEH00984                                                               MD020563
     C                     ENDIF                                                              CFC006
     C                     Z-ADD0         NKEY
     C                     END
     C                     MOVE REPBRC    STRBRC  3
     C                     CLOSELER135P1
     C                     OPEN LER135P1
     C*                                                                   BHBPC2
     C                     MOVE 'Y'       P1OP                            BHBPC2
     C*                                                                   BHBPC2
     C                     Z-ADD0         PAGE
      ** Ensure report spool file recorded by RCF
     C                     Z-ADDSFNUM1    ZSNUM1
      *
     C                     CALL 'ZSFILE'
     C                     PARM           SEQ     5
     C                     PARM REPBRC    SENTY   3
     C                     PARM           SFILE1
     C                     PARM           ZSNUM1  60
     C                     PARM           ZSERR   1
      *
      ** If error during ZSFILE processing, return to calling program
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
      *
      ** Obtain branch name for output
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' WRTCD   7
     C                     PARM '*KEY   ' WOPTN   7
     C                     PARM REPBRC    WDSNB   3
     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           WRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'LER135'  DBPGM
     C                     MOVELREPBRC    DBKEY            ************
     C                     MOVEL'SDBRCHPD'DBFILE           * DBERR 07 *
     C                     Z-ADD007       DBASE            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      ** Output headers
     C***/COPY*WNCPYSRC,LEH00985***                                                           CFC006
     C/COPY WNCPYSRC,LEH00985                                                               MD020563
     C           SUPFLG    IFNE 'Y'                                                           CFC006
     C                     WRITELER135A1
     C                     WRITELER135A2
     C***/COPY*WNCPYSRC,LEH00986***                                                           CFC006
     C/COPY WNCPYSRC,LEH00986                                                               MD020563
     C                     ENDIF                                                              CFC006
      *
      ** If system multibranching
     C                     END
      *
      ** If system is not multibranching set up single spool file
     C           MBIN      IFNE 'Y'
     C           P1OP      ANDNE'Y'
     C                     MOVE 'Y'       P1OP    1
     C                     CLOSELER135P1
     C                     OPEN LER135P1
     C                     Z-ADD0         PAGE
      ** Ensure report spool file recorded by RCF
     C                     Z-ADDSFNUM1    ZSNUM1
      *
     C                     CALL 'ZSFILE'
     C                     PARM           SEQ
     C                     PARM *BLANKS   SENTY
     C                     PARM           SFILE1
     C                     PARM           ZSNUM1
     C                     PARM           ZSERR
      *
      ** If error during ZSFILE processing, return to calling program
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
      *
      ** Output header
     C***/COPY*WNCPYSRC,LEH00987***                                                           CFC006
     C/COPY WNCPYSRC,LEH00987                                                               MD020563
     C           SUPFLG    IFNE 'Y'                                                           CFC006
     C                     WRITELER135A1
     C                     WRITELER135A2
     C***/COPY*WNCPYSRC,LEH00988***                                                           CFC006
     C/COPY WNCPYSRC,LEH00988                                                               MD020563
     C                     ENDIF                                                              CFC006
      *
      ** MBIN IFNE 'Y' end
     C                     END
      *
      ** If overflow indicator is on output headings on new page.
     C           *IN80     IFEQ '1'
     C***/COPY*WNCPYSRC,LEH00989***                                                           CFC006
     C/COPY WNCPYSRC,LEH00989                                                               MD020563
     C           SUPFLG    ANDNE'Y'                                                           CFC006
     C                     WRITELER135A1
     C                     WRITELER135A2
     C                     MOVE '0'       *IN80
     C                     END
      *
     C                     EXSR CHKCCY                                                        218992
     C/COPY WNCPYSRC,LEH00692
      *                                                                                       CLE073
      *                                                                                       CLE073
     C                     MOVE FTYP      OFTYP                                               CLE073
     C                     MOVE '/'       OSEP                                                CLE073
     C                     MOVE FSEQ      OFSEQ                                               CLE073
      *                                                                                       CLE073
      ** Output account key generated details.
     C***/COPY*WNCPYSRC,LEH00990***                                                           CFC006
     C/COPY WNCPYSRC,LEH00990                                                               MD020563
     C           SUPFLG    IFNE 'Y'                                                           CFC006
     C                     Z-ADDLKEAMT    EAMT0                                             MD051883
     C                     WRITELER135A3
     C***/COPY*WNCPYSRC,LEH00991***                                                           CFC006
     C/COPY WNCPYSRC,LEH00991                                                               MD020563
     C                     ENDIF                                                              CFC006
      *
      ** Details on print file indicator
     C                     MOVE '1'       *IN21
     C           WNEWF     IFEQ 'Y'                                                           CLE134
     C           LKEAMT    DIV  1000      ZZAMT  153                                          CLE134
     C                     Z-ADD1         Z                                                   CLE134
     C                     Z-ADD2         S                                                   CLE134
     C                     Z-ADDL2VLRF    INT,2                                               CLE134
     C                     Z-ADDL2VLRL    DEC,2                                               CLE134
     C                     Z-ADDL2VLRF    ZZTOTI                                              CLE134
     C                     Z-ADDL2VLRL    ZZTOTD                                              CLE134
     C                     EXSR ZHASH                                                         CLE134
     C                     Z-ADDZZTOTI    L2VLRF                                              CLE134
     C                     Z-ADDZZTOTD    L2VLRL                                              CLE134
     C                     ELSE                                                               CLE134
      *                                                                                       CLE134
      *
      ** Add event amount to hash total for trailer
      *
     C           LKEAMT    DIV  1000      ZZAMT
     C                     Z-ADD1         Z
     C                     Z-ADD1         S
     C                     Z-ADDTOTI      ZZTOTI
     C                     Z-ADDTOTD      ZZTOTD
     C                     EXSR ZHASH
     C                     Z-ADDZZTOTI    TOTI
     C                     Z-ADDZZTOTD    TOTD
     C                     ENDIF                                                              CLE134
      *
     C           WNEWF     IFEQ 'Y'                                                           CLE134
     C                     ADD  1         L2NORE                                              CLE134
     C                     ELSE                                                               CLE134
     C                     ADD  1         NKEY
     C                     ENDIF                                                              CLE134
      *
     C                     END
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           *IN61     ANDEQ'1'                                                           CLE031
     C           CLE134    ANDEQ'N'                                                         MD046080
     C           CLE031    OREQ 'Y'                                                         MD051242
     C           *IN61     ANDEQ'1'                                                         MD051969
     C           CLE134    ANDEQ'Y'                                                         MD051969
     C********** FEAUTO    ANDEQ'Y'                                                MD051242 MD051969
     C           FEAUTO    ANDNE'C'                                                         MD051959
     C           CLE031    OREQ 'Y'                                                         MD053946
     C           *IN61     ANDEQ'1'                                                         MD053946
     C           CLE134    ANDEQ'Y'                                                         MD053946
     C           FEAUTO    ANDEQ'C'                                                         MD053946
     C           OATYP     ANDEQ'N'                                                         MD053946
     C                     EXSR SETTLE                                                        CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C                     EXSR SR34C                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE *BLANKS   WKFLD                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDDO                                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C                     EXSR SR34E                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     END                                            BH3479
     C/COPY WNCPYSRC,LEH00693
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     MOVE *BLANKS   WATYPE                                              CLE134
     C                     MOVEL'N'       GENKY                                             MD051883
      *
     C                     ENDSR
      *
      *****************************************************************                       CLE034
     C/TITLE SR/SR34A                                                                         CLE034
      *****************************************************************                       CLE034
      *                                                               *                       CLE034
      *  SR34A - Initial Setup for CLE034 Processing                  *                       CLE034
      *                                                               *                       CLE034
      *****************************************************************                       CLE034
      *                                                                                       CLE034
     C           SR34A     BEGSR                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE LKEAMT    WSAMT                                               CLE034
      *                                                                                       CLE034
     C           PTFI      IFEQ *BLANKS                                                       CLE034
     C                     MOVE 'R'       WKPREC  1                                           CLE034
     C                     ELSE                                                               CLE034
     C           PTFI      IFEQ 'P'                                                           CLE034
     C           PTFI      OREQ 'S'                                                           CLE106
     C           PTFI      OREQ 'R'                                                           CLE106
     C                     MOVE 'P'       WKPREC                                              CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     Z-ADD0         TOTAMT                                              CLE034
     C                     Z-ADD0         WKAMT                                               CLE034
     C                     MOVE *BLANKS   WKFLD                                               CLE034
      *                                                                                       CLE034
     C           WKTYPE    IFEQ 'FEES'                                                        CLE034
     C                     MOVE *BLANKS   WKVDAT                                              CLE034
     C                     MOVE FEOURS    WEOURS                                              CLE034
     C                     MOVE FESTTL    WESTTL                                              CLE034
     C                     MOVE FEOSBR    WEOSBR                                              CLE034
     C                     MOVE FETHER    WETHER                                              CLE034
     C                     MOVE FESCCY    WESCCY                                              CLE034
     C                     MOVE FEPSCY    WEPSCY                                              CLE034
     C                     MOVE FEREXR    WEREXR                                              CLE034
     C                     MOVE FEREXI    WEREXI                                              CLE034
     C                     MOVE FEPEXR    WEPEXR                                              CLE034
     C                     MOVE FEPEXI    WEPEXI                                              CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE FAVDAT    WKVDAT                                              CLE034
     C                     MOVE FAOURS    WAOURS                                              CLE034
     C                     MOVE FAMETH    WAMETH                                              CLE034
     C                     MOVE FAOSBR    WAOSBR                                              CLE034
     C                     MOVE FATHER    WATHER                                              CLE034
     C                     MOVE FASCCY    WASCCY                                              CLE034
     C                     MOVE FAPSCY    WAPSCY                                              CLE034
     C                     MOVE FAREXR    WAREXR                                              CLE034
     C                     MOVE FAREXI    WAREXI                                              CLE034
     C                     MOVE FAPEXR    WAPEXR                                              CLE034
     C                     MOVE FAPEXI    WAPEXI                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE OSDB      WSOSDB                                              CLE034
     C                     MOVE OMDB      WSOMDB                                              CLE034
     C                     MOVE PSTM      WSPSTM                                              CLE034
     C                     MOVE PONS      WSPONS                                              CLE034
     C                     MOVE PIBN      WSPIBN                                              CLE034
     C                     MOVE RSTM      WSRSTM                                              CLE034
     C                     MOVE RONS      WSRONS                                              CLE034
     C                     MOVE RIBN      WSRIBN                                              CLE034
     C                     MOVE RIBA      WSRIBA                                              CLE034
     C                     MOVE ROBN      WSROBN                                              CLE034
     C                     MOVE ROCN      WSROCN                                              CLE034
     C                     MOVE CVMR      WSCVMR                                              CLE034
     C                     MOVE BENN      WSBENN                                              CLE034
     C                     MOVE BTB1      WSBTB1                                              CLE034
     C                     MOVE BTB2      WSBTB2                                              CLE034
     C                     MOVE BTB3      WSBTB3                                              CLE034
     C                     MOVE BTB4      WSBTB4                                              CLE034
      *                                                                                       CLE034
     C                     MOVE FELOAN    PLNRF                                               CLE034
     C                     MOVE WKVDAT    PLAVD                                               CLE034
     C                     MOVE FECNUM    PCNUM                                               CLE034
     C                     MOVE FEFACL    PFACL                                               CLE034
     C                     MOVE FEFSEQ    PFSEQ                                               CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSTALR2'                                                    CLE034
     C                     PARM *BLANKS   PRTCDE  7                                           CLE034
     C                     PARM '*FIRST ' POPTN                                               CLE034
     C                     PARM           WKTYPE                                              CLE034
     C                     PARM           PLNRF                                               CLE034
     C                     PARM           PLAVD                                               CLE034
     C                     PARM *BLANKS   PLASQ                                               CLE034
     C                     PARM           PCNUM                                               CLE034
     C                     PARM           PFACL                                               CLE034
     C                     PARM           PFSEQ                                               CLE034
     C                     PARM           WKPREC                                              CLE034
     C           LESTAL    PARM *BLANKS   DSSDY                                               CLE034
      *                                                                                       CLE034
     C           PRTCDE    IFNE *BLANKS                                                       CLE034
     C           *LOCK     IN   LDA                                                           CLE034
     C                     MOVEL'LER135'  DBPGM                                               CLE034
     C                     MOVEL'AOSTALR2'DBFILE                                              CLE034
     C                     Z-ADD36        DBASE                                               CLE034
     C                     MOVELPOPTN     DBKEY                                               CLE034
     C                     OUT  LDA                                                           CLE034
     C                     EXSR *PSSR                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDSR                                                              CLE034
      *                                                                                       CLE034
      *****************************************************************                       CLE034
     C/TITLE SR/SR34B                                                                         CLE034
      *****************************************************************                       CLE034
      *                                                               *                       CLE034
      *  SR34B - Processing to Calculate Amount for Sett. Allocation  *                       CLE034
      *                                                               *                       CLE034
      *****************************************************************                       CLE034
      *                                                                                       CLE034
     C           SR34B     BEGSR                                                              CLE034
      *                                                                                       CLE034
     C           WKPREC    IFEQ 'P'                                                           CLE034
     C           WSAMT     MULT PYPC      WKAMT                                               CLE034
     C***********          DIV  100       WKAMT     H                                         CLE034
     C                     DIV  100       WKAMT     H                                         CLE034
     C                     ELSE                                                               CLE034
     C           WSAMT     MULT RCPC      WKAMT                                               CLE034
     C***********          DIV  100       WKAMT     H                                         CLE034
     C                     DIV  100       WKAMT     H                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ADD  WKAMT     TOTAMT                                              CLE034
      *                                                                                       CLE034
     C           WKFLD     IFEQ 'Y'                                                           CLE034
     C           TOTAMT    ANDNEWSAMT                                                         CLE034
     C           WSAMT     SUB  TOTAMT    WDIFF  130                                          CLE034
     C                     ADD  WDIFF     WKAMT                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     Z-ADDWKAMT     LKEAMT                                              CLE034
     C                     EXSR SR34D                                                         CLE034
      *                                                                                       CLE034
     C                     ENDSR                                                              CLE034
      *                                                                                       CLE034
      *****************************************************************                       CLE034
     C/TITLE SR/SR34C                                                                         CLE034
      *****************************************************************                       CLE034
      *                                                               *                       CLE034
      *  SR34C - Processing to Get Next Settlement Allocation         *                       CLE034
      *                                                               *                       CLE034
      *****************************************************************                       CLE034
      *                                                                                       CLE034
     C           SR34C     BEGSR                                                              CLE034
      *                                                                                       CLE034
     C           WKFLD     IFEQ 'Y'                                                           CLE034
     C                     MOVE *BLANKS   WKFLD                                               CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C                     MOVE FELOAN    PLNRF                                               CLE034
     C                     MOVE WKVDAT    PLAVD                                               CLE034
     C                     MOVE FECNUM    PCNUM                                               CLE034
     C                     MOVE FEFACL    PFACL                                               CLE034
     C                     MOVE FEFSEQ    PFSEQ                                               CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSTALR2'                                                    CLE034
     C                     PARM *BLANKS   PRTCDE                                              CLE034
     C                     PARM '*NEXT  ' POPTN                                               CLE034
     C                     PARM           WKTYPE                                              CLE034
     C                     PARM           PLNRF                                               CLE034
     C                     PARM           PLAVD                                               CLE034
     C                     PARM *BLANKS   PLASQ                                               CLE034
     C                     PARM           PCNUM                                               CLE034
     C                     PARM           PFACL                                               CLE034
     C                     PARM           PFSEQ                                               CLE034
     C                     PARM           WKPREC                                              CLE034
     C           LESTAL    PARM *BLANKS   DSSDY                                               CLE034
      *                                                                                       CLE034
     C           PRTCDE    IFEQ '*EOF   '                                                     CLE034
     C                     MOVE 'Y'       WKFLD                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDSR                                                              CLE034
      *                                                                                       CLE034
      *****************************************************************                       CLE034
     C/TITLE SR/SR34D                                                                         CLE034
      *****************************************************************                       CLE034
      *                                                               *                       CLE034
      *  SR34D - Setup Fields from Settlement Allocation              *                       CLE034
      *                                                               *                       CLE034
      *****************************************************************                       CLE034
      *                                                                                       CLE034
     C           SR34D     BEGSR                                                              CLE034
      *                                                                                       CLE034
     C           WKTYPE    IFEQ 'FEES'                                                        CLE034
      *                                                                                       CLE034
     C           WKPREC    IFEQ 'P'                                                           CLE034
     C                     MOVE STPSTM    FESTTL                                              CLE034
     C                     MOVE STPONS    FEOURS                                              CLE034
     C                     MOVE STPOBR    FEOSBR                                              CLE034
     C                     MOVE STPIBN    FETHER                                              CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE STRSTM    FESTTL                                              CLE034
     C                     MOVE STRONS    FEOURS                                              CLE034
     C                     MOVE STROBR    FEOSBR                                              CLE034
     C                     MOVE STRIBN    FETHER                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE STREXR    FEREXR                                              CLE034
     C                     MOVE STREXI    FEREXI                                              CLE034
     C                     MOVE STPEXR    FEPEXR                                              CLE034
     C                     MOVE STPEXI    FEPEXI                                              CLE034
     C                     MOVE STPSCY    FEPSCY                                              CLE034
     C                     MOVE RSCY      FESCCY                                              CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C           WKPREC    IFEQ 'P'                                                           CLE034
     C                     MOVE STPSTM    FAMETH                                              CLE034
     C                     MOVE STPONS    FAOURS                                              CLE034
     C                     MOVE STPOBR    FAOSBR                                              CLE034
     C                     MOVE STPIBN    FATHER                                              CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE STRSTM    FAMETH                                              CLE034
     C                     MOVE STRONS    FAOURS                                              CLE034
     C                     MOVE STROBR    FAOSBR                                              CLE034
     C                     MOVE STRIBN    FATHER                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE STREXR    FAREXR                                              CLE034
     C                     MOVE STREXI    FAREXI                                              CLE034
     C                     MOVE STPEXR    FAPEXR                                              CLE034
     C                     MOVE STPEXI    FAPEXI                                              CLE034
     C                     MOVE STPSCY    FAPSCY                                              CLE034
     C                     MOVE RSCY      FASCCY                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE OSDB      OSDB                                                CLE034
     C                     MOVE OMDB      OMDB                                                CLE034
     C                     MOVE STRSTM    RSTM                                                CLE034
     C                     MOVE STRONS    RONS                                                CLE034
     C                     MOVE STPSTM    PSTM                                                CLE034
     C                     MOVE STPONS    PONS                                                CLE034
     C                     MOVE STPIBN    PIBN                                                CLE034
     C                     MOVE STRIBN    RIBN                                                CLE034
     C                     MOVE STRIBA    RIBA                                                CLE034
     C                     MOVE STROBN    ROBN                                                CLE034
     C                     MOVE STROCN    ROCN                                                CLE034
     C                     MOVE STCVMR    CVMR                                                CLE034
     C                     MOVE STBENN    BENN                                                CLE034
     C                     MOVE STBTB1    BTB1                                                CLE034
     C                     MOVE STBTB2    BTB2                                                CLE034
     C                     MOVE STBTB3    BTB3                                                CLE034
     C                     MOVE STBTB4    BTB4                                                CLE034
      *                                                                                       CLE034
      ** If settlement method is 09 and postings are to use Transaction                       218782
      ** currency, do not set up LKSCCY.                                                      218782
      *                                                                                       218782
     C           CLE033    IFEQ 'Y'                                                           218782
     C********** SETP      ANDEQ09                                                     218782 218992
     C           FESTTL    ANDEQ09                                                            218992
     C           SET09     ANDEQ'T'                                                           218782
     C                     ELSE                                                               218782
      *                                                                                       218782
     C           CEU004    IFEQ 'Y'                                                           CLE034
     C           RSCY      ANDNE*BLANKS                                                       CLE034
     C                     MOVE RSCY      LKSCCY                                              CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              218782
      *                                                                                       CLE034
     C                     ENDSR                                                              CLE034
      *                                                                                       CLE034
      *****************************************************************                       CLE034
     C/TITLE SR/SR34E                                                                         CLE034
      *****************************************************************                       CLE034
      *                                                               *                       CLE034
      *  SR34E - Restore Original Fields                              *                       CLE034
      *                                                               *                       CLE034
      *****************************************************************                       CLE034
      *                                                                                       CLE034
     C           SR34E     BEGSR                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE WSAMT     LKEAMT                                              CLE034
      *                                                                                       CLE034
     C           WKTYPE    IFEQ 'FEES'                                                        CLE034
     C                     MOVE WEOURS    FEOURS                                              CLE034
     C                     MOVE WESTTL    FESTTL                                              CLE034
     C                     MOVE WEOSBR    FEOSBR                                              CLE034
     C                     MOVE WETHER    FETHER                                              CLE034
     C                     MOVE WESCCY    FESCCY                                              CLE034
     C                     MOVE WEPSCY    FEPSCY                                              CLE034
     C                     MOVE WEREXR    FEREXR                                              CLE034
     C                     MOVE WEREXI    FEREXI                                              CLE034
     C                     MOVE WEPEXR    FEPEXR                                              CLE034
     C                     MOVE WEPEXI    FEPEXI                                              CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE WAOURS    FAOURS                                              CLE034
     C                     MOVE WAMETH    FAMETH                                              CLE034
     C                     MOVE WAOSBR    FAOSBR                                              CLE034
     C                     MOVE WATHER    FATHER                                              CLE034
     C                     MOVE WASCCY    FASCCY                                              CLE034
     C                     MOVE WAPSCY    FAPSCY                                              CLE034
     C                     MOVE WAREXR    FAREXR                                              CLE034
     C                     MOVE WAREXI    FAREXI                                              CLE034
     C                     MOVE WAPEXR    FAPEXR                                              CLE034
     C                     MOVE WAPEXI    FAPEXI                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE WSOSDB    OSDB                                                CLE034
     C                     MOVE WSOMDB    OMDB                                                CLE034
     C                     MOVE WSPSTM    PSTM                                                CLE034
     C                     MOVE WSPONS    PONS                                                CLE034
     C                     MOVE WSRSTM    RSTM                                                CLE034
     C                     MOVE WSRONS    RONS                                                CLE034
     C                     MOVE WSPIBN    PIBN                                                CLE034
     C                     MOVE WSRIBN    RIBN                                                CLE034
     C                     MOVE WSRIBA    RIBA                                                CLE034
     C                     MOVE WSROBN    ROBN                                                CLE034
     C                     MOVE WSROCN    ROCN                                                CLE034
     C                     MOVE WSCVMR    CVMR                                                CLE034
     C                     MOVE WSBENN    BENN                                                CLE034
     C                     MOVE WSBTB1    BTB1                                                CLE034
     C                     MOVE WSBTB2    BTB2                                                CLE034
     C                     MOVE WSBTB3    BTB3                                                CLE034
     C                     MOVE WSBTB4    BTB4                                                CLE034
      *                                                                                       CLE034
     C                     ENDSR                                                              CLE034
      *                                                                                       CLE034
      *****************************************************************
     C/TITLE SR/EXTUPD
      *****************************************************************
      *
      *  EXTUPD SUBROUTINE TO UPDATE FEES EXTRACT FILE.
      *
      *  CALLED FROM:  MAIN PROCESSING
      *
      *  CALLS:  ZXRATE, ZCONV
      *
      *****************************************************************
      *
     C           EXTUPD    BEGSR
      *
      ** Convert key amount to base currency if required.
      *
     C           FEFCCY    IFNE BJCYCD
     C                     MOVE FEFCCY    INCCY
     C                     MOVE BJCYCD    OUTCCY
      *
     C                     Z-ADD1         X
     C           INCCY     LOKUPCURR,X                   13
     C           *IN13     IFEQ '1'
     C                     MOVE MTDV,X    ZMDI1   1
     C                     Z-ADDCSPT,X    ZRATE1 138
     C                     Z-ADDCCDP,X    ZNBDP1  10
     C                     END
      *
     C                     Z-ADD1         X
     C           OUTCCY    LOKUPCURR,X                   14
     C           *IN14     IFEQ '1'
     C                     MOVE MTDV,X    ZMDI2   1
     C                     Z-ADDCSPT,X    ZRATE2 138
     C                     Z-ADDCCDP,X    ZNBDP2  10
     C                     END
      *
      ***  Obtain cross exchange rate & cross multiply/divide indicator
      *
     C                     EXSR ZXRATE
      *
      ***  Set up input fields for conversion SR
      *
     C                     Z-ADDZRATEX    ZEXCH  138
     C                     MOVE ZMDIX     ZMD     1
     C                     Z-ADDWAGG      ZAMTCI 150
     C                     MOVE INCCY     ZCCYI   3
     C                     MOVE OUTCCY    ZCCYO   3
     C                     Z-ADDZNBDP1    ZCDPI   10
     C                     Z-ADDZNBDP2    ZCDPO   10
      *
     C                     EXSR ZCONV
      *
     C                     Z-ADDZAMTCO    WAGG
      *                                                                   142402
     C           FEORED    IFEQ BJRDNB                                    142402
     C           FEPSTD    ANDLTMSTD                                      142402
      *                                                                   142402
     C                     Z-ADDZRATEX    ZEXCH  138                      142402
     C                     MOVE ZMDIX     ZMD     1                       142402
     C                     Z-ADDWAGG2     ZAMTCI 150                      142402
     C                     MOVE INCCY     ZCCYI   3                       142402
     C                     MOVE OUTCCY    ZCCYO   3                       142402
     C                     Z-ADDZNBDP1    ZCDPI   10                      142402
     C                     Z-ADDZNBDP2    ZCDPO   10                      142402
      *                                                                   142402
     C                     EXSR ZCONV                                     142402
      *                                                                   142402
     C                     Z-ADDZAMTCO    WAGG2                           142402
      *                                                                   142402
     C                     ENDIF                                          142402
      *                                                                   142402
      *
     C                     END
      *
      ** Update/write fee extract file.
      *
     C           FFDKEY    CHAINLEPEFFD              17
     C           *IN17     IFEQ '0'
      *                                                                   142402
     C           FEORED    IFEQ BJRDNB                                    142402
     C           FEPSTD    ANDLTMSTD                                      142402
      *                                                                   142402
     C                     Z-ADDWAGG2     AGB,M2                          142402
     C           WAGG      SUB  WAGG2     WAGG                            142402
      *                                                                   142402
     C                     ENDIF                                          142402
      *                                                                   142402
     C                     ADD  WAGG      AGB,MN
     C                     UPDATLEPEFFDF
     C                     ELSE
     C                     MOVE 'D'       FFDRCI
     C                     MOVE BJCYCD    FFDCCY
     C                     MOVE *BLANKS   FFDACO
     C                     MOVE *BLANKS   FFDDEP
     C**********           Z-ADDFECNUM    FFDCNM                                              CSD027
     C                     MOVE FECNUM    FFDCNM                                              CSD027
     C                     Z-ADDFEFACL    FFDFAC
     C                     Z-ADD0         FFDCOD
     C                     Z-ADD0         AGB
      *                                                                   142402
     C           FEORED    IFEQ BJRDNB                                    142402
     C           FEPSTD    ANDLTMSTD                                      142402
      *                                                                   142402
     C                     Z-ADDWAGG2     AGB,M2                          142402
     C           WAGG      SUB  WAGG2     WAGG                            142402
      *                                                                   142402
     C                     ENDIF                                          142402
      *                                                                   142402
     C                     Z-ADDWAGG      AGB,MN
     C                     MOVE FEBRCA    BRCA                            BH3462
     C                     WRITELEPEFFDF
     C                     ADD  1         NFFD
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
     C/TITLE SR/REPHDR
      *****************************************************************
      *
      *  REPHDR SUBROUTINE TO WRITE HEADING TO FEE CALCULATION REPORT
      *
      *  CALLED FROM:  AMTACC
      *
      *  CALLS:  ZSFILE, AOBRCHR0, AOCUSTR0, AOACOFR0, AOCURRR0
      *
      *****************************************************************
      *
     C           REPHDR    BEGSR
      *
      ** Write main heading for calculation report (P2)
      *
      ** If system is multibranching and branch code changes open
      ** new spool file.
     C           MBIN      IFEQ 'Y'
     C           REPBRC    ANDNESTRBRA
     C/COPY WNCPYSRC,LEH01033
     C           *IN22     IFEQ '1'
     C***/COPY*WNCPYSRC,LEH01075***                                                           CFC006
     C/COPY WNCPYSRC,LEH01075                                                               MD020563
     C           SUPFL2    ANDNE'Y'                                                           CFC006
      ** End of report for branch message
     C                     WRITELER135BR
     C                     END
     C                     MOVE REPBRC    STRBRA  3
     C                     CLOSELER135P2
     C                     OPEN LER135P2
     C*                                                                   BHBPC2
     C                     MOVE 'Y'       P2OP    1                       BHBPC2
     C*                                                                   BHBPC2
     C**********           Z-ADD0         PAGE                            181727
     C                     Z-ADD0         PAGE1                           181727
      ** Ensure report spool file recorded by RCF
     C                     Z-ADDSFNUM2    ZSNUM2
      *
     C                     CALL 'ZSFILE'
     C                     PARM           SEQ
     C                     PARM STRBRA    SENTY
     C                     PARM           SFILE2
     C                     PARM           ZSNUM2  60
     C                     PARM           ZSERR
      *
      ** If error during ZSFILE processing, return to calling program
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
      *
      ** Obtain branch name for output
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' WRTCD   7
     C                     PARM '*KEY   ' WOPTN   7
     C                     PARM STRBRA    WDSNB   3
     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           WRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'LER135'  DBPGM
     C                     MOVELSTRBRA    DBKEY            ************
     C                     MOVEL'SDBRCHPD'DBFILE           * DBERR 08 *
     C                     Z-ADD008       DBASE            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      ** If system multibranching
     C                     END
      *
      ** If system is not multibranching set up single spool file
     C           MBIN      IFNE 'Y'
     C           P2OP      ANDNE'Y'
     C                     MOVE 'Y'       P2OP    1
     C                     CLOSELER135P2
     C                     OPEN LER135P2
     C**********           Z-ADD0         PAGE                            181727
     C                     Z-ADD0         PAGE1                           181727
      ** Ensure report spool file recorded by RCF
     C                     Z-ADDSFNUM2    ZSNUM2
      *
     C                     CALL 'ZSFILE'
     C                     PARM           SEQ
     C                     PARM *BLANKS   SENTY
     C                     PARM           SFILE2
     C                     PARM           ZSNUM2
     C                     PARM           ZSERR
      *
      ** If error during ZSFILE processing, return to calling program
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
      *
      ** MBIN IFNE 'Y' end
     C                     END
      *
      ** Output header
     C***/COPY*WNCPYSRC,LEH01034***                                                           CFC006
     C/COPY WNCPYSRC,LEH01034                                                               MD020563
     C           SUPFL2    IFNE 'Y'                                                           CFC006
     C                     WRITELER135B1
     C***/COPY*WNCPYSRC,LEH01035***                                                           CFC006
     C/COPY WNCPYSRC,LEH01035                                                               MD020563
     C                     ENDIF                                                              CFC006
      *
     C                     MOVE '0'       *IN81
     C                     MOVE '0'       *IN75
      *
      ** Get customer name.
     C                     MOVEL*BLANKS   KEYC   10
     C                     MOVELFECNUM    KEYC
     C                     CALL 'AOCUSTR0'
     C                     PARM '*BLANKS' WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM           KEYC
     C                     PARM           KEYSTS  7
     C           SDCUST    PARM SDCUST    DSSDY
     C           WRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'LER135'  DBPGM
     C                     MOVELFECNUM    DBKEY            ************
     C                     MOVEL'SDCUSTPD'DBFILE           * DBERR 09 *
     C                     Z-ADD009       DBASE            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      ** Get account officer name.
      *
     C           FHACOF    IFNE *BLANKS                                   091657
     C                     CALL 'AOACOFR0'
     C                     PARM '*BLANKS' WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM FHACOF    ACOKEY  2
     C           SDACOF    PARM SDACOF    DSFDY
     C           WRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'LER135'  DBPGM
     C                     MOVELFHACOF    DBKEY            ************
     C                     MOVEL'SDACOFPD'DBFILE           * DBERR 10 *
     C                     Z-ADD010       DBASE            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     ELSE                                           091657
     C                     MOVE *BLANKS   AZACON                          091657
     C                     END                                            091657
      *
      ** Get decimal places for facility currency and set up
      ** original facility amount.
      *
     C**********           CALL 'AOCURRR0'                                                    CSC042
     C**********           PARM '*MSG   ' WRTCD   7                                           CSC042
     C**********           PARM '*KEY   ' WOPTN   7                                           CSC042
     C**********           PARM FHFCCY    K101    3                                           CSC042
     C********** SDCURR    PARM SDCURR    DSSDY                                               CSC042
     C********** WRTCD     IFNE *BLANKS                                                       CSC042
     C                     MOVELFHFCCY    ##KC                                                CSC042
     C                     EXSR ##CHKC                                                        CSC042
     C           ##FIC     IFEQ 'Y'                                                           CSC042
     C                     MOVE CURR,Q    CCY                                                 CSC042
     C                     Z-ADDCCDP,Q    CDP                                                 CSC042
     C                     Z-ADDCSPT,Q    SPOT                                                CSC042
     C                     MOVE MTDV,Q    MDIN                                                CSC042
     C                     Z-ADDCCNO,Q    CSNO                                                CSC042
     C                     MOVE CIND,Q    A6INCY                                              CSC042
     C                     ELSE                                                               CSC042
     C           *LOCK     IN   LDA
     C                     MOVEL'LER135'  DBPGM
     C                     MOVELFHFCCY    DBKEY            ************
     C**********           MOVEL'SDCURRPD'DBFILE           * DBERR 11 *                       CSC042
     C                     MOVEL'CURR,Q  'DBFILE           * DBERR 11 *                       CSC042
     C                     Z-ADD011       DBASE            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
     C           CDP       ADD  40        FH
     C                     MOVEA'000000'  *IN,40
     C                     MOVE '1'       *IN,FH
     C                     Z-ADDFHOFAM    OFAM0
      *
      ** Multi customer/currency
      *
     C           FHMCUS    COMP 'Y'                      44
     C           FHMCCY    COMP 'Y'                      45
      *
      ** Set up fee type name.
      *
     C                     Z-ADDCALT      V
     C           V         IFGT 6
     C                     SUB  4         V
     C           V         IFGT 16
     C                     SUB  4         V
     C                     END
     C/COPY WNCPYSRC,LEH00694
      *                                                                                       CLE073
     C           WFACLF    IFEQ 'N'                                                           CLE073
      *                                                                                       CLE073
     C           FECALT    IFEQ '97'                                                          CLE073
     C                     Z-ADD17        V                                                   CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C           FECALT    IFEQ '98'                                                          CLE073
     C                     Z-ADD16        V                                                   CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C           FECALT    IFEQ '99'                                                          CLE073
     C                     Z-ADD15        V                                                   CLE073
     C                     ENDIF                                                              CLE073
     C           FECALT    IFEQ '90'                                                          CLE134
     C                     Z-ADD18        V                                                   CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     END
     C                     MOVELMSG,V     FTYPE
      *
      ** Write report
     C/COPY WNCPYSRC,LEH00695
      *
      *                                                                                       CLE073
     C           WFACLF    IFEQ 'N'                                                           CLE073
     C                     MOVE FELOAN    FACLOA                                              CLE073
     C                     ELSE                                                               CLE073
     C                     MOVE FHFTYP    OFTYP                                               CLE073
     C                     MOVE '/'       OSEP                                                CLE073
     C                     MOVE FHFSEQ    OFSEQ                                               CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C***/COPY*WNCPYSRC,LEH01036***                                                           CFC006
     C/COPY WNCPYSRC,LEH01036                                                               MD020563
     C           SUPFL2    IFNE 'Y'                                                           CFC006
     C                     WRITELER135B2
     C***/COPY*WNCPYSRC,LEH01037***                                                           CFC006
     C/COPY WNCPYSRC,LEH01037                                                               MD020563
     C                     ENDIF                                                              CFC006
      *
     C                     ENDSR
      *
      *****************************************************************
     C/TITLE SR/REPDTL
      *****************************************************************
      *
      *  REPDTL SUBROUTINE TO WRITE DETAILS TO FEE CALCULATION REPORT
      *
      *  CALLED FROM:  HISRED, ACCRUE
      *
      *  CALLS:  ZDATE2
      *
      *****************************************************************
      *
     C           REPDTL    BEGSR
      *
     C/COPY WNCPYSRC,LEH00696
      *                                                                                       CLE073
     C           WFACLF    IFEQ 'N'                                                           CLE073
     C                     MOVE FELOAN    FACLOA                                              CLE073
     C                     ELSE                                                               CLE073
     C                     MOVE FHFTYP    OFTYP                                               CLE073
     C                     MOVE '/'       OSEP                                                CLE073
     C                     MOVE FHFSEQ    OFSEQ                                               CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Details printed indicator
      *
     C                     MOVE '1'       *IN79
      *
      ** Check for overflow.
      *
     C           *IN81     IFEQ '1'
     C***/COPY*WNCPYSRC,LEH01038***                                                           CFC006
     C/COPY WNCPYSRC,LEH01038                                                               MD020563
     C           SUPFL2    ANDNE'Y'                                                           CFC006
     C                     WRITELER135B1
     C                     WRITELER135B2
     C                     MOVE '0'       *IN81
     C                     END
      *
      ** DETAIL LINE B1
      *
     C           RPT       IFEQ 0
      *
     C                     Z-ADDNDAYS     DAYS
      *
      ** If average amount used, set up amount for each period.
      *
     C           *IN70     IFEQ '0'
     C                     Z-ADDAAMT      WAVG0
     C                     ELSE
     C                     Z-ADDAAMT      AAMT0
     C                     Z-ADD0         WAVG0
     C                     END
      *
      ** Get action narrative
      *
     C********** *IN94     IFEQ '1'                                       BH0131
     C**********           MOVE 'PY'      ACT                             BH0131
     C**********           ELSE                                           BH0131
     C***********          MOVE FAACTN    ACT                             101321
     C                     MOVE @FACTN    ACT                             101321
     C**********           END                                            BH0131
     C           @START    IFEQ 'N'                                       101321
     C                     MOVE '0'       *IN26
      *                                                                                       CLE028
      ** If action is 'IC' and flat rate personal loan, the narrative                         CLE028
      ** should be 'Interest added on'.                                                       CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           FAPTYP    ANDEQ80                                                            CLE028
     C           ACT       ANDEQ'IC'                                                          CLE028
     C                     MOVE 'IA'      ACT                                                 CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C           ACT       LOKUPTABACC    TABACN         26
     C                     MOVELTABACN    ACTN
     C                     ELSE                                           101321
     C                     MOVEL*BLANKS   ACTN                            101321
     C                     MOVELSTNARR    ACTN                            101321
     C                     MOVE 'N'       @START                          101321
     C                     END                                            101321
     C/COPY WNCPYSRC,LER135C040
      *
      ** Convert action date.
      *
     C***********          Z-ADDFADATE    ZDAYNO                          101321
     C                     Z-ADD@FDATE    ZDAYNO                          101321
     C                     EXSR ZDATE2
     C           ZDATE     IFEQ *ZEROS
     C           ZADATE    ANDEQ*BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'LER135'  DBPGM
     C                     MOVEL'ZDATE2  'DBFILE           ************
     C                     Z-ADD012       DBASE            * DBERR 12 *
     C                     OUT  LDA                        ************
     C                     EXSR *PSSR
     C                     END
     C                     MOVE ZADATE    FADAT   7
      *
      ** Set indicator for later printing if average calculation,
      ** percentage used and facility amount changed during period.
      *
     C           FEPIND    IFNE 'A'
     C           CALT      IFEQ 1
     C           CALT      OREQ 2
     C           CALT      OREQ 11
     C           CALT      OREQ 12
     C           ACT       IFEQ 'FI'
     C           ACT       OREQ 'FD'
     C                     MOVE '1'       *IN75
     C                     END
     C                     END
     C                     END
      *
     C***/COPY*WNCPYSRC,LEH01039***                                                           CFC006
     C/COPY WNCPYSRC,LEH01039                                                               MD020563
     C           SUPFL2    IFNE 'Y'                                                           CFC006
     C                     WRITELER135B3
     C***/COPY*WNCPYSRC,LEH01040***                                                           CFC006
     C/COPY WNCPYSRC,LEH01040                                                               MD020563
     C                     ENDIF                                                              CFC006
     C*
      ** Details on print file indicator
     C                     MOVE '1'       *IN22
      *
     C                     END
      *
      ** Total line 1
      *
     C           RPT       IFEQ 1
      *
     C                     Z-ADDWDAYS     DAYS
     C                     Z-ADDWAMT      WAVG0
     C                     Z-ADD0         AAMT0
      *
      ** Blank out date & put comment into action narrative.
      *
     C                     MOVE *BLANKS   FADAT
     C                     MOVE *BLANKS   ACTN
     C                     MOVEL'OVERALL' BK15
     C                     MOVE 'AVERAGE' BK15
     C                     MOVELBK15      ACTN
      *
     C***/COPY*WNCPYSRC,LEH01041***                                                           CFC006
     C/COPY WNCPYSRC,LEH01041                                                               MD020563
     C           SUPFL2    IFNE 'Y'                                                           CFC006
     C                     WRITELER135B3
     C***/COPY*WNCPYSRC,LEH01042***                                                           CFC006
     C/COPY WNCPYSRC,LEH01042                                                               MD020563
     C                     ENDIF                                                              CFC006
      *
      ** Details on print file indicator
     C                     MOVE '1'       *IN22
      *
     C                     END
      *
      * DETAIL LINE 2
      *
     C           RPT       IFEQ 2
      *
     C           FEPIND    IFNE 'A'
     C                     MOVE '0'       *IN72
     C                     ELSE
     C                     MOVE '1'       *IN72
     C                     END
      *
     C***/COPY*WNCPYSRC,LEH01043***                                                           CFC006
     C/COPY WNCPYSRC,LEH01043                                                               MD020563
     C           SUPFL2    IFNE 'Y'                                                           CFC006
     C                     WRITELER135B4
     C***/COPY*WNCPYSRC,LEH01044***                                                           CFC006
     C/COPY WNCPYSRC,LEH01044                                                               MD020563
     C                     ENDIF                                                              CFC006
     C                     MOVE '1'       *IN73
      *
     C                     END
      *
      * TOTAL LINE 3
      *
     C           RPT       IFEQ 3
      *
     C                     Z-ADDWTOT      WTOT0
      *
     C***/COPY*WNCPYSRC,LEH01045***                                                           CFC006
     C/COPY WNCPYSRC,LEH01045                                                               MD020563
     C           SUPFL2    IFNE 'Y'                                                           CFC006
     C                     WRITELER135B5
     C***/COPY*WNCPYSRC,LEH01046***                                                           CFC006
     C/COPY WNCPYSRC,LEH01046                                                               MD020563
     C                     ENDIF                                                              CFC006
     C*                                                                   BH3484
     C***  If Average, put out total past due now                         BH3484
     C*                                                                   BH3484
     C           *IN70     IFEQ '0'                                       BH3484
      *                                                                                       CLE134
      ** If fee is suspended print suspended amount                                           CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FEFSFA    ANDEQ'Y'                                                           CLE134
     C           FESFA     ANDNE0                                                             CLE134
     C                     Z-ADDFESFA     WSUS0                                               CLE134
     C                     WRITELER135BS                                                      CLE134
     C                     ENDIF                                                              CLE134
      *                                                                   153736
      ** Use previous outstanding amount to update current outstanding    153736
      ** amount.                                                          153736
      *                                                                   153736
     C***********FEAMTP    ADD  WTOT      WOSA0                     BH3484153736
     C           W#AMTO    ADD  WTOT      WOSA0                           153736
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FEFSFA    ANDEQ'Y'                                                           CLE134
     C           FESFA     ANDNE0                                                             CLE134
     C                     ADD  FESFA     WOSA0                                               CLE134
     C                     ENDIF                                                              CLE134
     C***/COPY*WNCPYSRC,LEH01047***                                                           CFC006
     C/COPY WNCPYSRC,LEH01047                                                               MD020563
     C           SUPFL2    IFNE 'Y'                                                           CFC006
     C                     WRITELER135BO                                  BH3484
     C***/COPY*WNCPYSRC,LEH01048***                                                           CFC006
     C/COPY WNCPYSRC,LEH01048                                                               MD020563
     C                     ENDIF                                                              CFC006
     C                     END                                            BH3484
      *
     C                     END
      *
      ** TOTAL LINE 4
      *
     C           RPT       IFEQ 4
      *                                                                   153736
      ** If fee adjustment exists on file produce record to               153736
      ** show total adjustments to date and include adjustments           153736
      ** in totals.                                                       153736
      *                                                                   153736
     C********** ADJTOT    IFEQ 0                                                      243496 245803
     C********** FEAMTA    ANDNE0                                                      243496 245803
     C**********           Z-ADDFEAMTA    ADJTOT                                       243496 245803
     C**********           ENDIF                                                       243496 245803
     C           ADJTOT    IFEQ 0                                                            243496B
     C           FEAMTA    ANDNE0                                                            243496B
     C                     Z-ADDFEAMTA    ADJTOT                                             243496B
     C                     ENDIF                                                             243496B
      *                                                                                      243496B
     C           ADJTOT    IFNE 0                                                             204444
     C                     Z-ADDADJTOT    WTOT0                                               204444
     C***/COPY*WNCPYSRC,LEH01049***                                                           CFC006
     C/COPY WNCPYSRC,LEH01049                                                               MD020563
     C           SUPFL2    IFNE 'Y'                                                           CFC006
     C                     WRITELER135BC                                                      204444
     C***/COPY*WNCPYSRC,LEH01050***                                                           CFC006
     C/COPY WNCPYSRC,LEH01050                                                               MD020563
     C                     ENDIF                                                              CFC006
     C**********           Z-ADDADJTOT    FEOAMT                                       243496 245803
     C**********           ELSE                                                        243496 245803
     C**********           Z-ADD0         FEOAMT                                       243496 245803
     C                     Z-ADDADJTOT    FEOAMT                                             243496B
     C                     ELSE                                                              243496B
     C                     Z-ADD0         FEOAMT                                             243496B
     C                     ENDIF                                                              204444
      *                                                                                       204444
     C********** FASADJ    IFNE 0                                         153736              204444
     C********** FASIGN    IFEQ '-'                                       153736              204444
     C**********           Z-SUBFASADJ    WTOT0                           153736              204444
     C**********           ELSE                                           153736              204444
     C**********           Z-ADDFASADJ    WTOT0                           153736              204444
     C**********           WRITELER135BC                                  153736              204444
     C**********           ENDIF                                          153736              204444
     C**********           ENDIF                                          153736              204444
      *
     C                     Z-ADDWFEE      WTOT0
      *                                                                   153736
      ** Total Fee Calculated should only be reduced by Adjustments                           202954
      *                                                                                       202954
     C********** FATYPE    IFEQ ' '                                                    202954 227253
     C********** FASIGN    IFEQ '-'                                                    153736 227253
     C**********           SUB  FASADJ    WTOT0                                        153736 227253
     C**********           ELSE                                                        153736 227253
     C**********           ADD  FASADJ    WTOT0                                        153736 227253
     C**********           ENDIF                                                       153736 227253
     C**********           ENDIF                                                       202954 227253
      *                                                                                       227253
     C                     ADD  ADJTOT    WTOT0                                               227253
      *
     C***/COPY*WNCPYSRC,LEH01051***                                                           CFC006
     C/COPY WNCPYSRC,LEH01051                                                               MD020563
     C           SUPFL2    IFNE 'Y'                                                           CFC006
     C                     WRITELER135B6
     C***/COPY*WNCPYSRC,LEH01052***                                                           CFC006
     C/COPY WNCPYSRC,LEH01052                                                               MD020563
     C                     ENDIF                                                              CFC006
     C*                                                                   BH3484
     C***  If Actual, put out total past due now                          BH3484
     C*                                                                   BH3484
     C           *IN70     IFEQ '1'                                       BH3484
      *                                                                   153736
      ** If fee is suspended print suspended amount                                           CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FEFSFA    ANDEQ'Y'                                                           CLE134
     C           FESFA     ANDNE0                                                             CLE134
     C                     Z-ADDFESFA     WSUS0                                               CLE134
     C                     WRITELER135BS                                                      CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
      ** Use previous outstanding amount to update current outstanding    153736
      ** amount.                                                          153736
      *                                                                   153736
     C***********FEAMTP    ADD  WFEE      WOSA0                     BH3484153736
     C********** W#AMTO    ADD  WFEE      WOSA0                           153736              202954
      *                                                                                       202954
     C                     Z-ADDWFEE      WOSA0                                               202954
      *                                                                                       202954
      ** Use previous outstanding amount whenever the LER135P2 report                         202954
      ** doesn't start from Fee start date.                                                   202954
      *                                                                                       202954
     C           STNARR    IFEQ STPERD                                                        202954
     C                     ADD  W#AMTO    WOSA0                                               202954
     C                     ENDIF                                                              202954
      *                                                                                       202954
      ** Total Fee Outstanding adjusted by SETTLEMENT/Write off amount                        202954
      *                                                                                       202954
     C           STNARR    IFEQ STSTAR                                                        202954
     C                     SUB  FEAMTS    WOSA0                                               202954
     C                     SUB  FEWOFF    WOSA0                                               204866
     C                     SUB  FEAMTW    WOSA0                                               204452
     C**********           ADD  FEAMTA    WOSA0                                        204467 227253
      *                                                                                       202954
      ** Field FEAMTS and FEWOFF is not yet updated for Full Settlement                       202954
      *                                                                                       202954
     C                     ENDIF                                                              202954
      *                                                                                       227253
     C                     ADD  ADJTOT    WOSA0                                               227253
      *                                                                                       202954
      ** Total Fee Outstanding adjusted by ADJUSTMENT Amount                                  202954
      *                                                                                       202954
     C********** FASIGN    IFEQ '-'                                       153736              204467
     C**********           SUB  FASADJ    WOSA0                           153736              204467
     C**********           ELSE                                           153736              204467
     C**********           ADD  FASADJ    WOSA0                           153736              204467
     C**********           ENDIF                                          153736              204467
      *                                                                                       204467
     C***********          ADD  ADJTOT    WOSA0                                        243496 245803
     C                     ADD  ADJTOT    WOSA0                                              243496B
     C           WFEE      SUB  FELPAM    DIFF1  130                                          258597
     C           DIFF1     IFEQ 1                                                             258597
     C                     SUB  1         WOSA0                                               258597
     C                     ELSE                                                               258597
     C           DIFF1     IFEQ -1                                                            258597
     C                     ADD  1         WOSA0                                               258597
     C                     ENDIF                                                              258597
     C                     ENDIF                                                              258597
      *                                                                                       258597
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FEFSFA    ANDEQ'Y'                                                           CLE134
     C           FESFA     ANDNE0                                                             CLE134
     C                     ADD  FESFA     WOSA0                                               CLE134
     C                     ENDIF                                                              CLE134
     C***/COPY*WNCPYSRC,LEH01053***                                                           CFC006
     C/COPY WNCPYSRC,LEH01053                                                               MD020563
     C           SUPFL2    IFNE 'Y'                                                           CFC006
     C                     WRITELER135BO                                  BH3484
     C***/COPY*WNCPYSRC,LEH01054***                                                           CFC006
     C/COPY WNCPYSRC,LEH01054                                                               MD020563
     C                     ENDIF                                                              CFC006
     C                     END                                            BH3484
      *
     C                     END
      *
      ** DUMMY LINE 5
      *
     C           RPT       IFEQ 5
      ***********                                                         101321
      ***Convert*start*date*******************************************    101321
      ***********                                                         101321
     C***********          Z-ADDSTDATE    ZDAYNO                          101321
     C***********          EXSR ZDATE2                                    101321
     C***********ZDATE     IFEQ *ZEROS                                    101321
     C***********ZADATE    ANDEQ*BLANKS                                   101321
     C************LOCK     IN   LDA                                       101321
     C***********          MOVEL'LER135'  DBPGM                           101321
     C***********          MOVEL'ZDATE2  'DBFILE           ************   101321
     C***********          Z-ADD013       DBASE            * DBERR 13 *   101321
     C***********          OUT  LDA                        ************   101321
     C***********          EXSR *PSSR                                     101321
     C***********          END                                            101321
      ***********                                                         101321
     C***********          MOVE ZADATE    STDAT   7                       101321
     C                     Z-ADDSTDATE    @FDATE                          101321
     C                     MOVE 'Y'       @START  1                       101321
     C                     MOVEL*BLANKS   STNARR 16                       101321
      *
     C***  Put out FEE START if really start. If last payment date, put   BH3484
     C***  out FEE PERIOD START                                           BH3484
     C*                                                                   BH3484
     C           STDATE    IFEQ FEPSTD                                    BH3484
     C                     MOVEL'FEE STAR'STNARR                          BH3484
     C                     MOVE 'T       'STNARR                          BH3484
     C                     MOVELSTNARR    STSTAR 16                                           202954
     C                     ELSE                                           BH3484
     C                     MOVEL'FEE PERI'STNARR                          BH3484
     C                     MOVE 'OD START'STNARR                          BH3484
     C                     MOVELSTNARR    STPERD 16                                           202954
     C                     END                                            BH3484
     C*                                                                   BH3484
     C***********          WRITELER135B7                                  101321
     C*                                                                   100516
     C** Put out the past due amount (if any)                             100516
      ** and if only the report starts from last fee period                                   202954
     C*                                                                   100516
     C***********FEAMTP    IFNE 0                                   100516153736
     C           W#AMTO    IFNE 0                                         153736
     C           STNARR    ANDEQSTPERD                                                        202954
     C***********          Z-ADDFEAMTP    WPOA0                     100516153736
     C                     Z-ADDW#AMTO    WPOA0                           153736
     C***/COPY*WNCPYSRC,LEH01055***                                                           CFC006
     C/COPY WNCPYSRC,LEH01055                                                               MD020563
     C           SUPFL2    IFNE 'Y'                                                           CFC006
     C                     WRITELER135BA                                  100516
     C***/COPY*WNCPYSRC,LEH01056***                                                           CFC006
     C/COPY WNCPYSRC,LEH01056                                                               MD020563
     C                     ENDIF                                                              CFC006
     C                     END                                            100516
      *
     C                     END
     C*                                                                   101321
     C**  Payment due line                                                101321
     C*                                                                   101321
     C           RPT       IFEQ 6                                         101321
     C*                                                                   101321
     C** Convert end date                                                 101321
     C*                                                                   101321
     C                     Z-ADDENDATE    ZDAYNO                          101321
     C                     EXSR ZDATE2                                    101321
     C           ZDATE     IFEQ *ZEROS                                    101321
     C           ZADATE    ANDEQ*BLANKS                                   101321
     C           *LOCK     IN   LDA                                       101321
     C                     MOVEL'LER135'  DBPGM                           101321
     C                     MOVEL'ZDATE2  'DBFILE           ************   101321
     C                     Z-ADD013       DBASE            * DBERR 13 *   101321
     C                     OUT  LDA                        ************   101321
     C                     EXSR *PSSR                                     101321
     C                     END                                            101321
     C                     MOVE ZADATE    FADAT                           101321
     C*                                                                   101321
     C** Put out the Fee due date and payment narrative                   101321
     C*                                                                   101321
     C***/COPY*WNCPYSRC,LEH01057***                                                           CFC006
     C/COPY WNCPYSRC,LEH01057                                                               MD020563
     C           SUPFL2    IFNE 'Y'                                                           CFC006
     C                     WRITELER135BB                                  101321
     C***/COPY*WNCPYSRC,LEH01058***                                                           CFC006
     C/COPY WNCPYSRC,LEH01058                                                               MD020563
     C                     ENDIF                                                              CFC006
     C                     END                                            101321
     C/COPY WNCPYSRC,LER135C041
      *
     C                     ENDSR
      *
      *****************************************************************
     C/TITLE SR/INIT
      *****************************************************************
      *
      ** INIT SUBROUTINE TO PERFORM FIRST CYCLE CALCS.
      *
      *  CALLED FROM:  MAIN PROCESSING
      *
      *  CALLS:  AOBANKR0, ZDATE2, AOGELRR0, LERDATEF,
      *
      *****************************************************************
      *
     C           INIT      BEGSR
      *
     C                     MOVE '1'       *IN10
      *
      ** Set up copyright statement
     C                     MOVEACPY@      BIS@   80
     C/COPY WNCPYSRC,LER135CCP1                                           S01408
      *
      ** Define LDA
     C           *NAMVAR   DEFN           LDA
      *
      ** Define lending customer data area which holds control date
     C           *NAMVAR   DEFN           LESTAT
      *
      ** Lock in dataarea RUNDAT
     C           *NAMVAR   DEFN           RUNDAT
     C                     IN   RUNDAT
      *                                                                                     AR820690
      ** Read JNSTAT data area for previous run date                                        AR820690
      *                                                                                     AR820690
     C           *NAMVAR   DEFN           JNSTAT                                            AR820690
     C                     IN   JNSTAT                                                      AR820690
      *
      ** Set Date Format Indicator *IN98  on if date format is MMDDYY
      *
     C           AGDFF     IFEQ 'M'
     C                     SETON                     98
     C                     END
      *
      ** Set sequence number to zero
      *
     C                     MOVE *BLANKS   SEQ
      *
      ** If system is not multibranching do not output branch details
      ** on print report
      *
     C           MBIN      IFNE 'Y'
     C                     SETON                     24
     C                     END
     C/COPY WNCPYSRC,LEH00697
      *                                                                                       CLE073
      *                                                                                       CLE073
      ** Define keys for CLE073                                                               CLE073
      *                                                                                       CLE073
     C           KEYLOA    KLIST                                                              CLE073
     C                     KFLD           WBRCA                                               CLE073
     C**********           KFLD           WLOAN   60                                   CLE073 CLE148
     C                     KFLD           WLOAN   6                                           CLE148
      *                                                                                       CLE073
      * Key to access HISTSHP                                                                 CLE073
      *                                                                                       CLE073
     C           KEYHST    KLIST                                                              CLE073
     C                     KFLD           WBRCA   3                                           CLE073
     C                     KFLD           WCNUM   6                                           CLE073
     C                     KFLD           WLOAN                                               CLE073
     C                     KFLD           WVDAT   50                                          CLE073
     C                     KFLD           WLASN   30                                          CLE073
     C                     Z-ADD999       WLASN   30                                          CLE073
      *                                                                                       CLE073
      * Partial Key to process HISTSHP                                                        CLE073
      *                                                                                       CLE073
     C           KEYPHS    KLIST                                                              CLE073
     C                     KFLD           WBRCA                                               CLE073
     C                     KFLD           WCNUM                                               CLE073
     C                     KFLD           WLOAN                                               CLE073
      *                                                                                       CLE073
      *                                                                                     AR317401
      ** Key to retrieve LS in HISTSHP.                                                     AR317401
      *                                                                                     AR317401
     C           KEYHP1    KLIST                                                            AR317401
     C                     KFLD           WBRCA                                             AR317401
     C                     KFLD           WCNUM                                             AR317401
     C                     KFLD           FELOAN                                            AR317401
     C                     KFLD           BJRDNB                                            AR317401
      *                                                                                     MD052216
      ** Key to access Fee Extension LEFEEDQD                                               MD052216
      *                                                                                     MD052216
     C           KEYFXT    KLIST                                                            MD052216
     C                     KFLD           FECNUM                                            MD052216
     C                     KFLD           FEFACL                                            MD052216
     C                     KFLD           FELOAN                                            MD052216
     C                     KFLD           FEFSEQ                                            MD052216
      *                                                                                     MD052216
      ** Check if CLE073 is switched *ON.                                                     CLE073
      *                                                                                       CLE073
     C                     MOVE 'N'       CLE073  1                                           CLE073
     C                     MOVEL'FACILITY'OFACLN                                              CLE073
     C                     MOVE *OFF      *IN35                                               CLE073
     C                     CALL 'AOSARDR0'                                                    CLE073
     C                     PARM *BLANKS   WRTCD   7                                           CLE073
     C                     PARM '*VERIFY' WOPTN   7                                           CLE073
     C                     PARM 'CLE073'  WSARD   6                                           CLE073
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE073
      *                                                                                       CLE073
     C           WRTCD     IFEQ *BLANKS                                                       CLE073
     C                     MOVE 'Y'       CLE073                                              CLE073
     C                     MOVE *ON       *IN35                                               CLE073
     C                     MOVEL'FAC/LOAN'OFACLN                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                   CLE007
      ** Check if CLE007 is switched *ON.                                 CLE007
      *                                                                   CLE007
     C                     MOVE 'N'       CLE007  1                       CLE007
     C                     CALL 'AOSARDR0'                                CLE007
     C                     PARM *BLANKS   WRTCD   7                       CLE007
     C                     PARM '*VERIFY' WOPTN   7                       CLE007
     C                     PARM 'CLE007'  WSARD   6                       CLE007
     C           SCSARD    PARM SCSARD    DSFDY                           CLE007
      *                                                                   CLE007
     C           WRTCD     IFEQ *BLANKS                                   CLE007
     C                     MOVE 'Y'       CLE007                          CLE007
      *                                                                   CLE009
      ** Check if CLE009 is switched *ON.                                 CLE009
      *                                                                   CLE009
     C                     CALL 'AOSARDR0'                                CLE009
     C                     PARM *BLANKS   PRTCD                           CLE009
     C                     PARM '*KEY   ' POPTN                           CLE009
     C                     PARM 'CLE009'  PSARD   6                       CLE009
     C           SCSARD    PARM SCSARD    DSFDY                           CLE009
      *                                                                   CLE009
     C           PRTCD     IFEQ *BLANKS                                   CLE009
     C                     MOVE 'Y'       CLE009  1                       CLE009
     C                     ELSE                                           CLE009
     C                     MOVE 'N'       CLE009                          CLE009
      *                                                                   CLE009
     C           PRTCD     IFNE '*NRF    '                                CLE009
     C           *LOCK     IN   LDA                                       CLE009
     C                     MOVEL'SCSARDPD'DBFILE           ************   CLE009
     C                     Z-ADD29        DBASE            * DBERR 29 *   CLE009
     C                     MOVEL'CLE009'  DBKEY            ************   CLE009
     C                     OUT  LDA                                       CLE009
     C                     EXSR *PSSR                                     CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
     C                     END                                            CLE007
      *                                                                   CLE007
     C           WRTCD     IFNE *BLANKS                                   CLE007
     C           WRTCD     ANDNE'*NRF  '                                  CLE007
     C           *LOCK     IN   LDA                                       CLE007
     C                     MOVEL'LER135'  DBPGM                           CLE007
     C                     MOVEL'SCSARDPD'DBFILE           ************   CLE007
     C                     Z-ADD014       DBASE            * DBERR 14 *   CLE007
     C                     OUT  LDA                        ************   CLE007
     C                     EXSR *PSSR                                     CLE007
     C                     END                                            CLE007
      *                                                                   CLE007
      ** CLE134 - Past Due Call Loans                                                         CLE134
      *                                                                                       CLE134
     C                     CALL 'AOSARDR0'                                                    CLE134
     C                     PARM *BLANKS   WRTCD                                               CLE134
     C                     PARM '*KEY   ' WOPTN                                               CLE134
     C                     PARM 'CLE134'  WSARD                                               CLE134
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE134
      *                                                                                       CLE134
     C           WRTCD     IFEQ *BLANKS                                                       CLE134
     C                     MOVE 'Y'       CLE134  1                                           CLE134
      *                                                                                       CLE134
     C                     CALL 'AOSVALR0'                                                    CLE134
     C                     PARM *BLANKS   @RTCD                                               CLE134
     C                     PARM SVAL,2    P@OP01 20                                           CLE134
     C                     PARM *BLANKS   P@VL01200                                           CLE134
     C                     PARM *BLANKS   P@OP02 20                                           CLE134
     C                     PARM *BLANKS   P@VL02200                                           CLE134
     C                     PARM *BLANKS   P@OP03 20                                           CLE134
     C                     PARM *BLANKS   P@VL03200                                           CLE134
     C                     PARM *BLANKS   P@OP04 20                                           CLE134
     C                     PARM *BLANKS   P@VL04200                                           CLE134
     C                     PARM *BLANKS   P@OP05 20                                           CLE134
     C                     PARM *BLANKS   P@VL05200                                           CLE134
     C                     PARM *BLANKS   P@OP06 20                                           CLE134
     C                     PARM *BLANKS   P@VL06200                                           CLE134
     C                     PARM *BLANKS   P@OP07 20                                           CLE134
     C                     PARM *BLANKS   P@VL07200                                           CLE134
     C                     PARM *BLANKS   P@OP08 20                                           CLE134
     C                     PARM *BLANKS   P@VL08200                                           CLE134
     C                     PARM *BLANKS   P@OP09 20                                           CLE134
     C                     PARM *BLANKS   P@VL09200                                           CLE134
     C                     PARM *BLANKS   P@OP10 20                                           CLE134
     C                     PARM *BLANKS   P@VL10200                                           CLE134
      *                                                                                       CLE134
     C           @RTCD     IFNE *BLANKS                                                       CLE134
     C                     MOVEL'LER135  'DBPGM                                               CLE134
     C                     MOVEL'SDSVALPD'DBFILE                                              CLE134
     C                     MOVELSVAL,2    DBKEY                                               CLE134
     C                     Z-ADD999       DBASE                                               CLE134
     C                     EXSR *PSSR                                                         CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     MOVELP@VL01    FSETAC  1                                           CLE134
      *                                                                                       CLE134
     C                     ELSE                                                               CLE134
     C                     MOVE 'N'       CLE134                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           WPNAM     ANDEQ'NEWCOB'                                                      CLE134
     C                     MOVE 'Y'       NEWCOB  1                                           CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
      ** Open files LEPXTAB and LEPXTAC if CLE007 is on.                  CLE007
      *                                                                   CLE007
     C           CLE007    IFEQ 'Y'                                       CLE007
     C                     OPEN LEPXTAB                                   CLE007
     C                     OPEN LEPXTAC                                   CLE007
     C                     Z-ADD0         RCOUNT  50                      CLE007
     C                     Z-ADD*ZEROS    XHRWN  150                      CLE007
     C                     Z-ADD*ZEROS    XHRDC   30                      CLE007
     C                     Z-ADD*ZEROS    HRWN                            CLE007
     C                     Z-ADD*ZEROS    HRDC                            CLE007
     C                     ENDIF                                          CLE007
      *                                                                   CLE004
      ** Check if CLE004 is switched *ON.                                 CLE004
      *                                                                   CLE004
     C                     MOVE 'N'       CLE004  1                       CLE004
     C                     CALL 'AOSARDR0'                                CLE004
     C                     PARM *BLANKS   WRTCD   7                       CLE004
     C                     PARM '*VERIFY' WOPTN   7                       CLE004
     C                     PARM 'CLE004'  WSARD   6                       CLE004
     C           SCSARD    PARM SCSARD    DSFDY                           CLE004
      *                                                                   CLE004
     C           WRTCD     IFEQ *BLANKS                                   CLE004
     C                     MOVE 'Y'       CLE004                          CLE004
     C                     END                                            CLE004
      *                                                                   CLE004
     C           WRTCD     IFNE *BLANKS                                   CLE004
     C           WRTCD     ANDNE'*NRF  '                                  CLE004
     C           *LOCK     IN   LDA                                       CLE004
     C                     MOVEL'LER135'  DBPGM                           CLE004
     C                     MOVEL'SCSARDPD'DBFILE           ************   CLE004
     C                     Z-ADD023       DBASE            * DBERR 23 *   CLE004
     C                     OUT  LDA                        ************   CLE004
     C                     EXSR *PSSR                                     CLE004
     C                     END                                            CLE004
      *                                                                   CLE005
      ** Check if CLE005 is switched *ON.                                 CLE005
      *                                                                   CLE005
     C                     MOVE 'N'       CLE005  1                       CLE005
     C                     CALL 'AOSARDR0'                                CLE005
     C                     PARM *BLANKS   WRTCD   7                       CLE005
     C                     PARM '*VERIFY' WOPTN   7                       CLE005
     C                     PARM 'CLE005'  WSARD   6                       CLE005
     C           SCSARD    PARM SCSARD    DSFDY                           CLE005
      *                                                                   CLE005
     C           WRTCD     IFEQ *BLANKS                                   CLE005
     C                     MOVE 'Y'       CLE005                          CLE005
     C                     END                                            CLE005
      *                                                                   CLE005
     C           WRTCD     IFNE *BLANKS                                   CLE005
     C           WRTCD     ANDNE'*NRF  '                                  CLE005
     C           *LOCK     IN   LDA                                       CLE005
     C                     MOVEL'LER135'  DBPGM                           CLE005
     C                     MOVEL'SCSARDPD'DBFILE           ************   CLE005
     C                     Z-ADD024       DBASE            * DBERR 24 *   CLE005
     C                     OUT  LDA                        ************   CLE005
     C                     EXSR *PSSR                                     CLE005
     C                     END                                            CLE005
      *                                                                   CDE002
      ** Check if CDE002 is switched *ON.                                 CDE002
      *                                                                   CDE002
     C                     MOVE 'N'       CDE002  1                       CDE002
     C                     CALL 'AOSARDR0'                                CDE002
     C                     PARM *BLANKS   WRTCD                           CDE002
     C                     PARM '*VERIFY' WOPTN                           CDE002
     C                     PARM 'CDE002'  WSARD                           CDE002
     C           SCSARD    PARM SCSARD    DSFDY                           CDE002
      *                                                                   CDE002
     C           WRTCD     IFEQ *BLANKS                                   CDE002
     C                     MOVE 'Y'       CDE002                          CDE002
     C                     ENDIF                                          CDE002
      *                                                                   CDE002
     C           WRTCD     IFNE *BLANKS                                   CDE002
     C           WRTCD     ANDNE'*NRF  '                                  CDE002
     C           *LOCK     IN   LDA                                       CDE002
     C                     MOVEL'LER135'  DBPGM                           CDE002
     C                     MOVEL'SCSARDPD'DBFILE           ************   CDE002
     C                     Z-ADD029       DBASE            * DBERR 29 *   CDE002
     C                     OUT  LDA                        ************   CDE002
     C                     EXSR *PSSR                                     CDE002
     C                     ENDIF                                          CDE002
      *                                                                   179741
      ** Determine if Settlement Currency Conversion Upgrade              179741
      ** feature is installed                                             179741
      *                                                                   179741
     C                     CALL 'AOSARDR0'                                179741
     C                     PARM *BLANKS   WRTCD                           179741
     C                     PARM '*KEY   ' WOPTN                           179741
     C                     PARM 'CEU004'  WSARD                           179741
     C           SCSARD    PARM SCSARD    DSFDY                           179741
      *                                                                   179741
     C           WRTCD     IFEQ *BLANKS                                   179741
     C                     MOVE 'Y'       CEU004  1                       179741
     C                     ELSE                                           179741
     C                     MOVE 'N'       CEU004                          179741
      *                                                                   179741
     C           WRTCD     IFNE '*NRF    '                                179741
     C           *LOCK     IN   LDA                                       179741
     C                     MOVEL'LE0492  'DBPGM                           179741
     C                     MOVEL'SCSARDPD'DBFILE           ************   179741
     C                     Z-ADD51        DBASE            * DBERR 51 *   179741
     C                     MOVEL'CEU004'  DBKEY     P      ************   179741
     C                     OUT  LDA                                       179741
     C                     EXSR *PSSR                                     179741
     C                     ENDIF                                          179741
      *                                                                   179741
     C                     ENDIF                                          179741
      *                                                                                       CLE028
      ** Check if CLE028 is switched *ON.                                                     CLE028
      *                                                                                       CLE028
     C                     MOVE 'N'       CLE028  1                                           CLE028
     C                     CALL 'AOSARDR0'                                                    CLE028
     C                     PARM *BLANKS   WRTCD                                               CLE028
     C                     PARM '*VERIFY' WOPTN                                               CLE028
     C                     PARM 'CLE028'  WSARD                                               CLE028
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE028
      *                                                                                       CLE028
     C           WRTCD     IFEQ *BLANKS                                                       CLE028
     C                     MOVE 'Y'       CLE028                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C           WRTCD     IFNE *BLANKS                                                       CLE028
     C           WRTCD     ANDNE'*NRF  '                                                      CLE028
     C           *LOCK     IN   LDA                                                           CLE028
     C                     MOVEL'LER135'  DBPGM                                               CLE028
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE028
     C                     Z-ADD036       DBASE                                               CLE028
     C                     OUT  LDA                                                           CLE028
     C                     EXSR *PSSR                                                         CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
      ** Determine if Midas Compliance Watch Additional                                       CGL020
      ** Account Postings Information is installed                                            CGL020
      *                                                                                       CGL020
     C                     MOVE 'N'       CGL020  1                                           CGL020
     C                     CALL 'AOSARDR0'                                                    CGL020
     C                     PARM *BLANKS   WRTCD                                               CGL020
     C                     PARM '*VERIFY' WOPTN                                               CGL020
     C                     PARM 'CGL020'  WSARD                                               CGL020
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL020
      *                                                                                       CGL020
     C           WRTCD     IFNE *BLANKS                                                       CGL020
     C           WRTCD     ANDNE'*NRF   '                                                     CGL020
     C           *LOCK     IN   LDA                                                           CGL020
     C                     MOVEL'LER135'  DBPGM                                               CGL020
     C                     MOVEL'SCSARDPD'DBFILE                                              CGL020
     C                     Z-ADD52        DBASE                                               CGL020
     C                     MOVELWSARD     DBKEY                                               CGL020
     C                     OUT  LDA                                                           CGL020
     C                     EXSR *PSSR                                                         CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C           WRTCD     IFEQ *BLANKS                                                       CGL020
     C                     MOVE 'Y'       CGL020                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     MOVE *BLANKS   F1FFLG                                              CGL020
     C                     Z-ADD0         F1FVAL                                              CGL020
     C                     Z-ADD0         F1FPCT                                              CGL020
      *                                                                                       CLE031
      ** Check if CLE031 is switched *ON.                                                     CLE031
      *                                                                                       CLE031
     C                     MOVE 'N'       CLE031  1                                           CLE031
     C                     CALL 'AOSARDR0'                                                    CLE031
     C                     PARM *BLANKS   WRTCD                                               CLE031
     C                     PARM '*VERIFY' WOPTN                                               CLE031
     C                     PARM 'CLE031'  WSARD                                               CLE031
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE031
      *                                                                                       CLE031
     C           WRTCD     IFEQ *BLANKS                                                       CLE031
     C                     MOVE 'Y'       CLE031                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           WRTCD     IFNE *BLANKS                                                       CLE031
     C           WRTCD     ANDNE'*NRF  '                                                      CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'LER135'  DBPGM                                               CLE031
     C                     MOVEL'SCSARDPD'DBFILE           ************                       CLE031
     C                     Z-ADD034       DBASE            * DBERR 34 *                       CLE031
     C                     MOVEL'CLE031'  DBKEY            ************                       CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Check if CLE034 is switched *ON.                                                     CLE034
      *                                                                                       CLE034
     C                     MOVE 'N'       CLE034  1                                           CLE034
     C                     CALL 'AOSARDR0'                                                    CLE034
     C                     PARM *BLANKS   WRTCD                                               CLE034
     C                     PARM '*VERIFY' WOPTN                                               CLE034
     C                     PARM 'CLE034'  WSARD                                               CLE034
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE034
      *                                                                                       CLE034
     C           WRTCD     IFNE *BLANKS                                                       CLE034
     C           WRTCD     ANDNE'*NRF  '                                                      CLE034
     C           *LOCK     IN   LDA                                                           CLE034
     C                     MOVEL'LER135'  DBPGM                                               CLE034
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE034
     C                     Z-ADD35        DBASE                                               CLE034
     C                     MOVEL'CLE034'  DBKEY                                               CLE034
     C                     OUT  LDA                                                           CLE034
     C                     EXSR *PSSR                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           WRTCD     IFEQ *BLANKS                                                       CLE034
     C                     MOVE 'Y'       CLE034                                              CLE034
     C                     ENDIF                                                              CLE034
     C*                                                                                       218782
     C**  Read switchable features file SCSARDPD using access object                          218782
     C**  to determine if switchable feature (CLE033) is switched ON                          218782
     C*                                                                                       218782
     C                     MOVE 'N'       CLE033  1                                           218782
     C*                                                                                       218782
     C                     CALL 'AOSARDR0'                                                    218782
     C                     PARM *BLANKS   @RTCD                                               218782
     C                     PARM '*VERIFY' @OPTN                                               218782
     C                     PARM 'CLE033'  @SARD                                               218782
     C           SCSARD    PARM SCSARD    DSFDY                                               218782
     C*                                                                                       218782
     C**  If feature is on, set up CLE033 variable                                            218782
     C*                                                                                       218782
     C           @RTCD     IFEQ *BLANKS                                                       218782
      *                                                                                       218782
     C                     MOVE 'Y'       CLE033                                              218782
      *                                                                                       218782
     C                     CALL 'AOSVALR0'                                                    218782
     C                     PARM *BLANKS   @RTCD                                               218782
     C                     PARM SVAL,1    P@OP01 20                                           218782
     C                     PARM *BLANKS   P@VL01200                                           218782
     C                     PARM *BLANKS   P@OP02 20                                           218782
     C                     PARM *BLANKS   P@VL02200                                           218782
     C                     PARM *BLANKS   P@OP03 20                                           218782
     C                     PARM *BLANKS   P@VL03200                                           218782
     C                     PARM *BLANKS   P@OP04 20                                           218782
     C                     PARM *BLANKS   P@VL04200                                           218782
     C                     PARM *BLANKS   P@OP05 20                                           218782
     C                     PARM *BLANKS   P@VL05200                                           218782
     C                     PARM *BLANKS   P@OP06 20                                           218782
     C                     PARM *BLANKS   P@VL06200                                           218782
     C                     PARM *BLANKS   P@OP07 20                                           218782
     C                     PARM *BLANKS   P@VL07200                                           218782
     C                     PARM *BLANKS   P@OP08 20                                           218782
     C                     PARM *BLANKS   P@VL08200                                           218782
     C                     PARM *BLANKS   P@OP09 20                                           218782
     C                     PARM *BLANKS   P@VL09200                                           218782
     C                     PARM *BLANKS   P@OP10 20                                           218782
     C                     PARM *BLANKS   P@VL10200                                           218782
     C********** SDSVAL    PARM SDSVAL    DSSDY                                        218782 222373
      *                                                                                       218782
     C           @RTCD     IFNE *BLANKS                                                       218782
     C                     MOVEL'LER135  'DBPGM                                               218782
     C                     MOVEL'SDSVALPD'DBFILE                                              218782
     C                     MOVELSVAL,1    DBKEY                                               218782
     C                     Z-ADD999       DBASE                                               218782
     C                     EXSR *PSSR                                                         218782
     C                     ENDIF                                                              218782
      *                                                                                       218782
      ** Save value of Settlement09Postings in a one character field                          218782
     C                     MOVELP@VL01    SET09   1                                           218782
     C                     ENDIF                                                              218782
      **********                                                                     CLE025 BUG13031
      ***Check*if*CLE025*(Credit*Lines)*is*switched*on                               CLE025 BUG13031
      **********                                                                     CLE025 BUG13031
     C**********           CALL 'AOSARDR0'                                           CLE025 BUG13031
     C**********           PARM *BLANKS   PRTCD   7                                  CLE025 BUG13031
     C**********           PARM '*VERIFY' POPTN   7                                  CLE025 BUG13031
     C**********           PARM 'CLE025'  PSARD   6                                  CLE025 BUG13031
     C********** SCSARD    PARM SCSARD    DSFDY                                      CLE025 BUG13031
      **********                                                                     CLE025 BUG13031
     C********** PRTCD     IFNE *BLANKS                                              CLE025 BUG13031
     C********** PRTCD     ANDNE'*NRF   '                                            CLE025 BUG13031
     C********** *LOCK     IN   LDA                                                  CLE025 BUG13031
     C**********           MOVEL'SCSARDPD'DBFILE                                     CLE025 BUG13031
     C**********           MOVEL'CLE025'  DBKEY                                      CLE025 BUG13031
     C**********           Z-ADD34        DBASE                                      CLE025 BUG13031
     C**********           OUT  LDA                                                  CLE025 BUG13031
     C**********           EXSR *PSSR                                                CLE025 BUG13031
     C**********           ENDIF                                                     CLE025 BUG13031
      **********                                                                     CLE025 BUG13031
     C********** PRTCD     IFEQ *BLANKS                                              CLE025 BUG13031
     C**********           MOVE 'Y'       CLE025  1                                  CLE025 BUG13031
     C**********           ELSE                                                      CLE025 BUG13031
     C**********           MOVE 'N'       CLE025                                     CLE025 BUG13031
     C**********           ENDIF                                                     CLE025 BUG13031
     C***/COPY*WNCPYSRC,LEH00992***                                                           CFC006
     C/COPY WNCPYSRC,LEH00992                                                               MD020563
      *****************************************************************           AR1097176 MD020563
      ***Check*if*CFC006*is*switched**ON.******************************           AR1097176 MD020563
      *****************************************************************           AR1097176 MD020563
     C**********           MOVE 'N'       CFC006  1                               AR1097176 MD020563
     C**********           CALL 'AOSARDR0'                                        AR1097176 MD020563
     C**********           PARM *BLANKS   WRTCD                                   AR1097176 MD020563
     C**********           PARM '*VERIFY' WOPTN                                   AR1097176 MD020563
     C**********           PARM 'CFC006'  WSARD                                   AR1097176 MD020563
     C********** SCSARD    PARM SCSARD    DSFDY                                   AR1097176 MD020563
      *****************************************************************           AR1097176 MD020563
     C********** WRTCD     IFEQ *BLANKS                                           AR1097176 MD020563
     C**********           MOVE 'Y'       CFC006                                  AR1097176 MD020563
     C**********           ENDIF                                                  AR1097176 MD020563
      *                                                                                       CLE071
      ** Check if CLE071 is switched ON                                                       CLE071
      *                                                                                       CLE071
     C                     MOVE 'N'       CLE071  1                                           CLE071
     C                     CALL 'AOSARDR0'                                                    CLE071
     C                     PARM *BLANKS   WRTCD   7                                           CLE071
     C                     PARM '*VERIFY' WOPTN   7                                           CLE071
     C                     PARM 'CLE071'  WSARD   6                                           CLE071
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE071
      *                                                                                       CLE071
     C           WRTCD     IFEQ *BLANKS                                                       CLE071
     C                     MOVE 'Y'       CLE071                                              CLE071
     C                     ENDIF                                                              CLE071
      *                                                                                       CLE141
      ** Determine if CLE141 is switched on                                                   CLE141
      *                                                                                       CLE141
     C                     MOVE 'N'       CLE141  1                                           CLE141
     C                     CALL 'AOSARDR0'                                                    CLE141
     C                     PARM *BLANKS   @RTCD                                               CLE141
     C                     PARM '*VERIFY' @OPTN                                               CLE141
     C                     PARM 'CLE141'  @SARD                                               CLE141
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE141
     C           @RTCD     IFEQ *BLANKS                                                       CLE141
     C                     MOVEL'Y'       CLE141                                              CLE141
     C                     ENDIF                                                              CLE141
      *                                                                                       CFC006
      ** Enable output indicator for LER135P1 and LER135P2                                    CFC006
      *                                                                                       CFC006
     C                     MOVEL'N'       SUPFLG  1                                           CFC006
     C                     MOVEL'N'       SUPFL2  1                                           CFC006
     C********** CFC006    IFEQ 'Y'                                               AR1097176 MD020563
     C                     CALL 'AOCOMR0'                                                     CFC006
     C                     PARM 'LERC135' PNAME  10                                           CFC006
     C                     PARM '*ALL '   PCSEQ   5                                           CFC006
     C                     PARM SECTN1    PSCTN  50                                           CFC006
     C                     PARM *BLANKS   PRTCD                                               CFC006
      *                                                                                       CFC006
     C           PRTCD     IFEQ 'Y      '                                                     CFC006
     C                     MOVEL'Y'       SUPFLG                                              CFC006
     C                     ENDIF                                                              CFC006
      *                                                                                       CFC006
     C                     CALL 'AOCOMR0'                                                     CFC006
     C                     PARM 'LERC135' PNAME                                               CFC006
     C                     PARM '*ALL '   PCSEQ                                               CFC006
     C                     PARM SECTN2    PSCTN                                               CFC006
     C                     PARM *BLANKS   PRTCD                                               CFC006
      *                                                                                       CFC006
     C           PRTCD     IFEQ 'Y      '                                                     CFC006
     C                     MOVEL'Y'       SUPFL2                                              CFC006
     C                     ENDIF                                                              CFC006
     C**********           ENDIF                                                  AR1097176 MD020563
      *                                                                                     MD026969
      ** Retrieve current value of ZeroPDFeeSettlements                                     MD026969
      *                                                                                     MD026969
     C                     CALL 'AOSVALR0'                                                  MD026969
     C                     PARM *BLANKS   @RTCD                                             MD026969
     C                     PARM SVAL,3    P@OP01 20                                         MD026969
     C                     PARM *BLANKS   P@VL01200                                         MD026969
     C                     PARM *BLANKS   P@OP02 20                                         MD026969
     C                     PARM *BLANKS   P@VL02200                                         MD026969
     C                     PARM *BLANKS   P@OP03 20                                         MD026969
     C                     PARM *BLANKS   P@VL03200                                         MD026969
     C                     PARM *BLANKS   P@OP04 20                                         MD026969
     C                     PARM *BLANKS   P@VL04200                                         MD026969
     C                     PARM *BLANKS   P@OP05 20                                         MD026969
     C                     PARM *BLANKS   P@VL05200                                         MD026969
     C                     PARM *BLANKS   P@OP06 20                                         MD026969
     C                     PARM *BLANKS   P@VL06200                                         MD026969
     C                     PARM *BLANKS   P@OP07 20                                         MD026969
     C                     PARM *BLANKS   P@VL07200                                         MD026969
     C                     PARM *BLANKS   P@OP08 20                                         MD026969
     C                     PARM *BLANKS   P@VL08200                                         MD026969
     C                     PARM *BLANKS   P@OP09 20                                         MD026969
     C                     PARM *BLANKS   P@VL09200                                         MD026969
     C                     PARM *BLANKS   P@OP10 20                                         MD026969
     C                     PARM *BLANKS   P@VL10200                                         MD026969
      *                                                                                     MD026969
     C                     MOVE 'N'       WKFZAS  1                                         MD026969
      *                                                                                     MD026969
     C           @RTCD     IFEQ *BLANKS                                                     MD026969
     C                     MOVELP@VL01    WKFZAS                                            MD026969
     C                     ELSE                                                             MD026969
     C           @RTCD     IFNE '*NRF'                                                      MD026969
     C                     MOVEL'LER135  'DBPGM                                             MD026969
     C                     MOVEL'SDSVALPD'DBFILE                                            MD026969
     C                     MOVELSVAL,2    DBKEY                                             MD026969
     C                     Z-ADD998       DBASE                                             MD026969
     C                     EXSR *PSSR                                                       MD026969
     C                     ENDIF                                                            MD026969
     C                     ENDIF                                                            MD026969
      *                                                                                       CSW208
      ** Access Switchable Features file for CSW208                                           CSW208
      *                                                                                       CSW208
     C                     CALL 'SWIF2008'                                                    CSW208
     C                     PARM *BLANKS   WRTCD                                               CSW208
      *                                                                                       CSW208
     C           WRTCD     IFEQ 'CSW2008'                                                     CSW208
     C                     MOVE 'Y'       CSW208  1                                           CSW208
     C                     ELSE                                                               CSW208
     C                     MOVE 'N'       CSW208                                              CSW208
     C                     ENDIF                                                              CSW208
     C/COPY WNCPYSRC,LEH00614
      *
      ** Access bank details
      *
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' WRTCD   7
     C                     PARM '*FIRST ' WOPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
     C           WRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'LER135'  DBPGM
     C                     MOVEL'SDBANKPD'DBFILE           ************
     C                     Z-ADD015       DBASE            * DBERR 15 *
     C                     OUT  LDA                        ************
     C                     EXSR *PSSR
     C                     END
      *                                                                                     MD025983
     C           LEYD      ADD  1         JAN1    50                                        MD025983
      *                                                                   127966
      ** Access Module details                                            127966
      *                                                                   127966
     C                     CALL 'AOMMODR0'                                127966
     C                     PARM '*MSG   ' WRTCD                           127966
     C                     PARM '*FIRST ' WOPTN                           127966
     C           SDMMOD    PARM SDMMOD    DSFDY                           127966
     C           WRTCD     IFNE *BLANKS                                   127966
     C           *LOCK     IN   LDA                                       127966
     C                     MOVEL'LER135'  DBPGM                           127966
     C                     MOVEL'SDMMODPD'DBFILE           ************   127966
     C                     Z-ADD21        DBASE            * DBERR 21 *   127966
     C                     OUT  LDA                        ************   127966
     C                     EXSR *PSSR                                     127966
     C                     END                                            127966
      *
      ** Convert the previous end of year date + 1 to the start of
      ** year date in DDMMYY format and store the SOY day field
      *
     C                     Z-ADD0         ZDAYNO
     C           BJPEYD    ADD  1         ZDAYNO
     C                     EXSR ZDATE2
     C           ZDATE     IFEQ *ZEROS
     C           ZADATE    ANDEQ*BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'LER135'  DBPGM
     C                     MOVEL'ZDATE2  'DBFILE           ************
     C                     Z-ADD016       DBASE            * DBERR 16 *
     C                     OUT  LDA                        ************
     C                     EXSR *PSSR
     C                     END
      *
      ** Use the alphanumeric date format passed back from GADATE
      ** to get the start of year field as this always has the day
      ** number in the first two positions regardless of the date
      ** format being used.
      *
     C                     MOVELZADATE    SOYDD   20
      *
      ** Access SDGELRPD for accrual profit day
      *
     C**********           CALL 'AOGELRR0'                                                    CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*MSG   ' WRTCD   7
     C                     PARM '*FIRST ' WOPTN   7
     C********** SDGELR    PARM SDGELR    DSFDY                                               CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C           WRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA                        ************
     C                     MOVEL'LER135'  DBPGM
     C                     MOVEL'SDGELRPD'DBFILE           * DBERR 17 *
     C                     Z-ADD017       DBASE            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *                                                                                     MD035545
      ** Retrieve system value setting.                                                     MD035545
      *                                                                                     MD035545
     C                     MOVELWPARML    P@OP01                                            MD035545
     C                     CALL 'AOSVALR0'                                                  MD035545
     C                     PARM *BLANKS   @RTCD                                             MD035545
     C                     PARM           P@OP01                                            MD035545
     C                     PARM           P@VL01                                            MD035545
     C                     PARM           P@OP02                                            MD035545
     C                     PARM           P@VL02                                            MD035545
     C                     PARM           P@OP03                                            MD035545
     C                     PARM           P@VL03                                            MD035545
     C                     PARM           P@OP04                                            MD035545
     C                     PARM           P@VL04                                            MD035545
     C                     PARM           P@OP05                                            MD035545
     C                     PARM           P@VL05                                            MD035545
     C                     PARM           P@OP06                                            MD035545
     C                     PARM           P@VL06                                            MD035545
     C                     PARM           P@OP07                                            MD035545
     C                     PARM           P@VL07                                            MD035545
     C                     PARM           P@OP08                                            MD035545
     C                     PARM           P@VL08                                            MD035545
     C                     PARM           P@OP09                                            MD035545
     C                     PARM           P@VL09                                            MD035545
     C                     PARM           P@OP10                                            MD035545
     C                     PARM           P@VL10                                            MD035545
      *                                                                                     MD035545
      ** If system value is not found then default value to 'N'.                            MD035545
      *                                                                                     MD035545
     C           @RTCD     IFNE '       '                                                   MD035545
     C                     MOVE 'N'       WCALC6                                            MD035545
     C                     ELSE                                                             MD035545
     C                     MOVELP@VL01    WCALC6                                            MD035545
     C********** WCALC6    IFEQ 'Y'                                                MD035545 MD047993
     C********** BKALDI    ANDEQ'Y'                                                MD035545 MD047993
     C**********           MOVE 'Y'       WCALC6                                   MD035545 MD047993
     C**********           ELSE                                                    MD035545 MD047993
     C**********           MOVE 'N'       WCALC6                                   MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
     C                     ENDIF                                                            MD035545
      *                                                                                     MD046370
     C                     CALL 'AOSVALR0'                                                  MD046370
     C                     PARM *BLANKS   @RTCD                                             MD046370
     C                     PARM WPARM1    P@OP01                                            MD046370
     C                     PARM *BLANKS   P@VL01                                            MD046370
     C                     PARM *BLANKS   P@OP02                                            MD046370
     C                     PARM *BLANKS   P@VL02                                            MD046370
     C                     PARM *BLANKS   P@OP03                                            MD046370
     C                     PARM *BLANKS   P@VL03                                            MD046370
     C                     PARM *BLANKS   P@OP04                                            MD046370
     C                     PARM *BLANKS   P@VL04                                            MD046370
     C                     PARM *BLANKS   P@OP05                                            MD046370
     C                     PARM *BLANKS   P@VL05                                            MD046370
     C                     PARM *BLANKS   P@OP06                                            MD046370
     C                     PARM *BLANKS   P@VL06                                            MD046370
     C                     PARM *BLANKS   P@OP07                                            MD046370
     C                     PARM *BLANKS   P@VL07                                            MD046370
     C                     PARM *BLANKS   P@OP08                                            MD046370
     C                     PARM *BLANKS   P@VL08                                            MD046370
     C                     PARM *BLANKS   P@OP09                                            MD046370
     C                     PARM *BLANKS   P@VL09                                            MD046370
     C                     PARM *BLANKS   P@OP10                                            MD046370
     C                     PARM *BLANKS   P@VL10                                            MD046370
      *                                                                                     MD046370
     C           @RTCD     IFNE *BLANKS                                                     MD046370
     C                     MOVEL'LER135  'DBPGM                                             MD046370
     C                     MOVEL'SDSVALPD'DBFILE                                            MD046370
     C                     MOVELWPARM1    DBKEY                                             MD046370
     C                     Z-ADD112       DBASE                                             MD046370
     C                     EXSR *PSSR                                                       MD046370
     C                     ELSE                                                             MD046370
     C                     MOVELP@VL01    AUENFE  1                                         MD046370
     C                     ENDIF                                                            MD046370
      *                                                                                     MD055481
      ** Check System Value: Use Original Borrower or Purchased From?                       MD055481
      ** Set up parameter so access object checks LoanCustOriginPurch                       MD055481
      *                                                                                     MD055481
     C                     MOVELWPARM     SVALK1                                            MD055481
      *                                                                                     MD055481
     C                     CALL 'AOSVALR0'                                                  MD055481
     C                     PARM           RTNCDE  7                                         MD055481
     C                     PARM           SVALK1 20                                         MD055481
     C                     PARM           SVAL1 200                                         MD055481
     C                     PARM           SVALK2 20                                         MD055481
     C                     PARM           SVAL2 200                                         MD055481
     C                     PARM           SVALK3 20                                         MD055481
     C                     PARM           SVAL3 200                                         MD055481
     C                     PARM           SVALK4 20                                         MD055481
     C                     PARM           SVAL4 200                                         MD055481
     C                     PARM           SVALK5 20                                         MD055481
     C                     PARM           SVAL5 200                                         MD055481
     C                     PARM           SVALK6 20                                         MD055481
     C                     PARM           SVAL6 200                                         MD055481
     C                     PARM           SVALK7 20                                         MD055481
     C                     PARM           SVAL7 200                                         MD055481
     C                     PARM           SVALK8 20                                         MD055481
     C                     PARM           SVAL8 200                                         MD055481
     C                     PARM           SVALK9 20                                         MD055481
     C                     PARM           SVAL9 200                                         MD055481
     C                     PARM           SVALK0 20                                         MD055481
     C                     PARM           SVAL10200                                         MD055481
      *                                                                                     MD055481
      ** If the system value is not found then default value to 'P'                         MD055481
      *                                                                                     MD055481
     C           RTNCDE    IFNE *BLANKS                                                     MD055481
     C                     MOVE 'P'       PPCUST                                            MD055481
     C                     ELSE                                                             MD055481
      *                                                                                     MD055481
      ** Isolate the first character of SVAL1 which = 'P' or 'O'.                           MD055481
      *                                                                                     MD055481
     C                     MOVELSVAL1     PPCUST  1                                         MD055481
     C                     ENDIF                                                            MD055481
      *
      ** Calculate the start of month date by converting the date of
      ** next working day to date format and inserting the start of
      ** year day number
      **
     C                     Z-ADDBJDNWD    ZDAYNO  50
     C                     EXSR ZDATE2
     C           ZDATE     IFEQ *ZEROS
     C           ZADATE    ANDEQ*BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'LER135'  DBPGM
     C                     MOVEL'ZDATE2  'DBFILE           ************
     C                     Z-ADD018       DBASE            * DBERR 18 *
     C                     OUT  LDA                        ************
     C                     EXSR *PSSR
     C                     END
     C                     MOVE ZDATE     SMDT    6
     C                     MOVE ZDATE     SMDTUS  6
      *
      * Check which date format is being used and set up the date to
      * be converted accordingly.
      *
     C           AGDFF     IFEQ 'D'
     C                     MOVELSOYDD     SMDD
     C                     ELSE
     C                     MOVELSOYDD     SMDDUS
     C                     MOVE SMDDUS    SMDD
     C                     MOVE SMUS      SM
     C                     END
      *
      ** Divide GDATE (converted date of next working day) by 10000
      ** to get the day number (2 DIGITS) and move the start of year
      ** day into a two digit work field for later comparison.
      *
     C           ZDATE     DIV  10000     DNWDDD  20
     C                     MOVELSOYDD     WKDDSY  20
      *
      ** If the day number of the date of next working
      ** day is less than the start of month day subtract
      ** one from the month number of the date of next working day
      ** this ensures that the conversion and checking of the start
      ** of month date is performed on the current month & not the next
      *
     C           WKDDSY    IFGT DNWDDD
     C                     SUB  1         SM
     C           SM        IFEQ 0
     C                     Z-ADD12        SM
     C                     SUB  1         SY
     C           SY        IFLT *ZERO                                     144257
     C                     Z-ADD99        SY                              144257
     C                     END                                            144257
     C                     END
     C                     END
      *
     C                     MOVE SMDT      GDATE   60
     C                     MOVE '0'       GRTCD                           MOF60
     C                     CALL 'LERDATEF'                                MOF60
     C                     PARM           GDATE   60                      MOF60
     C                     PARM           GDAYNO  50                      MOF60
     C                     PARM           GRTCD   1                       MOF60
      *
     C           GRTCD     IFNE '0'
     C           *LOCK     IN   LDA
     C                     MOVEL'LER135'  DBPGM
     C                     MOVEL'LERDATEF'DBFILE           ************
     C                     Z-ADD019       DBASE            * DBERR 19 *
     C                     OUT  LDA                        ************
     C                     EXSR *PSSR
     C                     END
      *
     C                     Z-ADDGDAYNO    SMDY    50                      MOF60
      *
      ** Check whether the start of the new month falls between RUND
      ** and the date of next working day and if so make the start of
      ** next working day less one the end date.
      *
     C           SMDY      IFGT BJRDNB
     C           SMDY      ANDLEBJDNWD
     C           BKAPDT    ANDEQBJRDNB
     C           SMDY      SUB  1         CODT    50
     C           SM        SUB  1         MN      20
      *
     C                     ELSE
     C                     Z-ADDSM        MN
      *
      ** Calc. earlier of accruals/profit date & (next working day - 1)
      *
     C           BJDNWD    SUB  1         CODT
     C           BKAPDT    IFLT CODT
     C                     Z-ADDBKAPDT    CODT
     C                     END
     C                     END
      *
      ** Find the month of the CODT field for historic file
      *
     C                     Z-ADDCODT      ZDAYNO
     C                     EXSR ZDATE2
     C           ZDATE     IFEQ *ZEROS
     C           ZADATE    ANDEQ*BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'LER135'  DBPGM
     C                     MOVEL'ZDATE2  'DBFILE           ************
     C                     Z-ADD020       DBASE            * DBERR 20 *
     C                     OUT  LDA                        ************
     C                     EXSR *PSSR
     C                     END
     C                     Z-ADDZDATE     WDATE   60
     C                     MOVE ZADATE    WCODTA  7
      *                                                                   142402
      ** Compute the total number of days from start date of the month    142402
      ** up to the accrual profit date.  Also, get the value of the       142402
      ** start date of the month in Midas format.                         142402
      *                                                                   142402
     C           WDATE     DIV  10000     MNTND   20                      142402
     C           CODT      SUB  MNTND     MSTD    50                      142402
     C           MSTD      ADD  1         MSTD                            142402
      *
      ** Check if the result is zero (month was January) and if it is
      ** move December's month number (12) into the month field.
      *
     C           MN        IFEQ 0
     C                     Z-ADD12        MN
     C                     END
      *                                                                   142402
      ** Get the value of the previous month for the array setup          142402
      *                                                                   142402
     C           MN        SUB  1         M2      20                      142402
      *                                                                   142402
     C           M2        IFEQ 0                                         142402
      *                                                                   142402
     C                     Z-ADD12        M2                              142402
      *                                                                   142402
     C                     ENDIF                                          142402
      *
      ** Retrieve month where the fee amount must be added.               E33591
      *                                                                   E33591
     C           WKDDSY    IFEQ 01                                        E33591
      *                                                                   E33591
      ** If the date format is to be European (DDMMYY):                   E33591
      *                                                                   E33591
     C                     Z-ADDWDATE     WWDAT                           E33591
      *                                                                   E33591
     C           BJDFIN    IFEQ 'D'                                       E33591
     C                     Z-ADDWWDT2     MN                              E33591
     C                     ELSE                                           E33591
      ** Otherwise use the U.S.A.-Defined date data structure             E33591
     C                     Z-ADDWWDT1     MN                              E33591
     C                     END                                            E33591
      *                                                                   E33591
     C                     END                                            E33591
      *
      ***  Set up currency arrays
      *
     C                     Z-ADD0         X       30
     C                     OPEN SDCURRPD                                                      CSC042
     C                     READ SDCURRPD                 11
      *
     C           *IN11     DOWEQ'0'
      *
     C           X         IFLE 150
     C           X         ADD  1         X
     C                     MOVE A6CYCD    CURR,X
     C                     Z-ADDA6SPRT    CSPT,X
     C                     MOVELA6MDIN    MTDV,X
     C                     Z-ADDA6NBDP    CCDP,X
     C                     Z-ADDA6SSNB    CCNO,X
     C                     MOVE A6INCY    CIND,X                                              CLE031
     C                     END
      *
     C                     READ SDCURRPD                 11
      *
     C                     END
     C                     CLOSESDCURRPD                                                      CSC042
      *
      ** DEFINE WORK FIELDS.
      *
     C                     Z-ADD0         WRK63   63
     C                     Z-ADD0         WRK15  150
     C                     Z-ADD0         WRK153 153
     C**********           Z-ADD0         WRK155 155                                        BUG22790
     C                     Z-ADD0         WRK199 199                                        BUG22790
     C                     Z-ADD0         NKEY    50
     C                     Z-ADD0         LKNTOT  50
     C                     Z-ADD0         NFFD    50
     C                     Z-ADD0         RPT     10
     C                     Z-ADD0         P       10
     C                     Z-ADD0         X       30
     C                     Z-ADD0         V       20
     C                     Z-ADD0         FD      10
     C                     Z-ADD0         TD      10
     C                     Z-ADD0         FH      20
     C                     Z-ADD0         FCOD    20
     C                     Z-ADD0         STDATE  50
     C                     Z-ADD0         ENDATE  50
     C**********           Z-ADD99        STFSEQ  20                                          200289
     C**********           Z-ADD999       STFSEQ  30                                 200289 AR674226
     C                     Z-ADD9999      STFSEQ  40                                        AR674226
     C/COPY WNCPYSRC,LER135C001
     C                     Z-ADD0         CFAMT  130
     C                     Z-ADD0         AAMT   130
     C**********           Z-ADD0         WTOT   130                                          249023
     C                     Z-ADD0         WTOT   150                                          249023
     C                     Z-ADD0         WFEE   130
     C                     Z-ADD0         WAMT   130
     C                     Z-ADD0         WOAMT  130
     C                     Z-ADD0         WFAM   130
     C                     Z-ADD0         WAGG   130
     C                     Z-ADD0         WPCT    63
     C                     Z-ADD0         WOPCT   63
     C                     Z-ADD0         WFPC    63
     C                     Z-ADD0         WCBS    50
     C**********           Z-ADD0         WDAYS   50                                        BUG23174
     C                     Z-ADD0         WDAYS  159                                        BUG23174
     C**********           Z-ADD0         NDAYS   50                                        BUG23174
     C                     Z-ADD0         NDAYS  159                                        BUG23174
     C                     Z-ADD0         TOTI   150
     C                     Z-ADD0         TOTD    30
     C                     MOVE *BLANK    ATYP    1
     C                     MOVE *BLANKS   ACT     2
     C                     MOVE *BLANKS   CNUMA   6
     C                     MOVE *BLANKS   BK15   15
     C                     MOVE *BLANKS   FTYPE  43
     C                     MOVE *BLANK    WRKPRC  1                                           CLE031
      *                                                                                       CLE031
      ** Set up work fields                                                                   CLE031
     C           *LIKE     DEFN FEFAMT    FESUSP                                              CLE134
     C           *LIKE     DEFN LKVLRF    L2VLRF                                              CLE134
     C           *LIKE     DEFN LKVLRL    L2VLRL                                              CLE134
     C           *LIKE     DEFN LKNORE    L2NORE                                              CLE134
     C           *LIKE     DEFN LKVLRF    LTVLRF                                              CLE134
     C           *LIKE     DEFN LKVLRL    LTVLRL                                              CLE134
     C           *LIKE     DEFN LKNORE    LTNORE                                              CLE134
     C                     Z-ADD*ZEROS    L2VLRF                                              CLE134
     C                     Z-ADD*ZEROS    L2VLRL                                              CLE134
     C           *LIKE     DEFN LKEAMT    WRKAMT                                              CLE031
     C           *LIKE     DEFN LKEAMT    BASAMT                                              CLE031
     C           *LIKE     DEFN LKEAMT    SETAMT                                              CLE031
     C           *LIKE     DEFN LKECCY    WRKCCY                                              CLE031
     C           *LIKE     DEFN LKECCY    WRKFCY                                              CLE031
     C           *LIKE     DEFN LKECCY    WRKLEC                                              CLE031
     C           *LIKE     DEFN LKECCY    WRKLSC                                              CLE031
     C           *LIKE     DEFN LKECCY    WRKPCY                                              CLE031
     C           *LIKE     DEFN LKECCY    WRKSCY                                              CLE031
     C           *LIKE     DEFN LKAKEY    WRKLAK                                              CLE031
     C           *LIKE     DEFN AKY       WRKAKY                                              CLE031
     C           *LIKE     DEFN FEREXI    WRKEXI                                              CLE031
     C           *LIKE     DEFN FEREXR    WRKEXR                                              CLE031
     C           *LIKE     DEFN A6INCY    WRKFIN                                              CLE031
     C           *LIKE     DEFN A6MDIN    WRKMDI                                              CLE031
     C           *LIKE     DEFN A6SPRT    WRKSPT                                              CLE031
     C           *LIKE     DEFN LKEAMT    WSAMT                                               CLE034
     C           *LIKE     DEFN LKEAMT    TOTAMT                                              CLE034
     C           *LIKE     DEFN LKEAMT    WKAMT                                               CLE034
     C           *LIKE     DEFN FEOURS    WEOURS                                              CLE034
     C           *LIKE     DEFN FESTTL    WESTTL                                              CLE034
     C           *LIKE     DEFN FEOSBR    WEOSBR                                              CLE034
     C           *LIKE     DEFN FETHER    WETHER                                              CLE034
     C           *LIKE     DEFN FESCCY    WESCCY                                              CLE034
     C           *LIKE     DEFN FEPSCY    WEPSCY                                              CLE034
     C           *LIKE     DEFN FEREXR    WEREXR                                              CLE034
     C           *LIKE     DEFN FEREXI    WEREXI                                              CLE034
     C           *LIKE     DEFN FEPEXR    WEPEXR                                              CLE034
     C           *LIKE     DEFN FEPEXI    WEPEXI                                              CLE034
     C           *LIKE     DEFN FAVDAT    WKVDAT                                              CLE034
     C           *LIKE     DEFN FAOURS    WAOURS                                              CLE034
     C           *LIKE     DEFN FAMETH    WAMETH                                              CLE034
     C           *LIKE     DEFN FAOSBR    WAOSBR                                              CLE034
     C           *LIKE     DEFN FATHER    WATHER                                              CLE034
     C           *LIKE     DEFN FASCCY    WASCCY                                              CLE034
     C           *LIKE     DEFN FAPSCY    WAPSCY                                              CLE034
     C           *LIKE     DEFN FAREXR    WAREXR                                              CLE034
     C           *LIKE     DEFN FAREXI    WAREXI                                              CLE034
     C           *LIKE     DEFN FAPEXR    WAPEXR                                              CLE034
     C           *LIKE     DEFN FAPEXI    WAPEXI                                              CLE034
     C           *LIKE     DEFN OSDB      WSOSDB                                              CLE034
     C           *LIKE     DEFN OMDB      WSOMDB                                              CLE034
     C           *LIKE     DEFN PSTM      WSPSTM                                              CLE034
     C           *LIKE     DEFN PONS      WSPONS                                              CLE034
     C           *LIKE     DEFN PIBN      WSPIBN                                              CLE034
     C           *LIKE     DEFN RSTM      WSRSTM                                              CLE034
     C           *LIKE     DEFN RONS      WSRONS                                              CLE034
     C           *LIKE     DEFN RIBN      WSRIBN                                              CLE034
     C           *LIKE     DEFN RIBA      WSRIBA                                              CLE034
     C           *LIKE     DEFN ROBN      WSROBN                                              CLE034
     C           *LIKE     DEFN ROCN      WSROCN                                              CLE034
     C           *LIKE     DEFN CVMR      WSCVMR                                              CLE034
     C           *LIKE     DEFN BENN      WSBENN                                              CLE034
     C           *LIKE     DEFN BTB1      WSBTB1                                              CLE034
     C           *LIKE     DEFN BTB2      WSBTB2                                              CLE034
     C           *LIKE     DEFN BTB3      WSBTB3                                              CLE034
     C           *LIKE     DEFN BTB4      WSBTB4                                              CLE034
     C           *LIKE     DEFN PTYP      PPTYPE                                              CLE034
     C           *LIKE     DEFN FEPIND    WKPIND                                              CLE071
      *
      ** Define key list for read of LEFEADL1 file.
      *
     C           FEEKEY    KLIST
     C                     KFLD           FECNUM
     C                     KFLD           FEFACL
     C                     KFLD           FELOAN
     C                     KFLD           FEFSEQ
      *
      ** Define key list for read of FACHISH file.
      *
     C           HSHKEY    KLIST
     C                     KFLD           FECNUM
     C                     KFLD           FTYP
     C                     KFLD           FSEQ
      *
      ** Define key list for read of FACHSAL1 file - full key.
      *
     C           HSAKY1    KLIST
     C                     KFLD           FECNUM
     C                     KFLD           FEFACL
     C                     KFLD           STDATE
     C                     KFLD           STFSEQ
      *
      ** Define key list for read of FACHSAL1 file - partial key.
      *
     C           HSAKY2    KLIST
     C                     KFLD           FECNUM
     C                     KFLD           FEFACL
      *
      ** Key list for LEPEFFD
      *
     C           FFDKEY    KLIST
     C                     KFLD           FEBRCA
     C                     KFLD           FECNUM
     C                     KFLD           FEFACL
     C                     KFLD           FCOD
     C                     KFLD           BJCYCD
      *                                                                   CLE005
     C/COPY WNCPYSRC,LER135C011
      ** Define key list for read of LEFHSTL2 file.                       CLE005
      *                                                                   CLE005
     C           LEFKEY    KLIST                                          CLE005
     C                     KFLD           FECNUM                          CLE005
     C                     KFLD           FEFACL                          CLE005
     C                     KFLD           FEFSEQ                          CLE005
      *                                                                                       CLE071
      ** Define key list for read of LEFHSTLB file.                                           CLE071
      *                                                                                       CLE071
     C           LFKEY2    KLIST                                                              CLE071
     C                     KFLD           FEBRCA                                              CLE071
     C                     KFLD           FECNUM                                              CLE071
     C                     KFLD           FEFACL                                              CLE071
     C                     KFLD           FELOAN                                              CLE071
     C                     KFLD           FEFSEQ                                              CLE071
     C                     KFLD           STDATE                                              CLE071
      *                                                                                       CLE071
     C           LFKEY3    KLIST                                                              CLE071
     C                     KFLD           FEBRCA                                              CLE071
     C                     KFLD           FECNUM                                              CLE071
     C                     KFLD           FEFACL                                              CLE071
     C                     KFLD           FELOAN                                              CLE071
     C                     KFLD           FEFSEQ                                              CLE071
      *                                                                                       CGL020
      ** Key list for CLOAN                                                                   CGL020
      *                                                                                       CGL020
     C                     MOVE 'A'       WRCDT                                               CGL020
     C           WLNKEY    KLIST                                                              CGL020
     C                     KFLD           FELOAN                                              CGL020
     C                     KFLD           WRCDT                                               CGL020
      *                                                                                       CGL020
     C           WKPDCL    KLIST                                                              CLE134
     C                     KFLD           FELOAN                                              CLE134
     C                     KFLD           FECNUM                                              CLE134
     C                     KFLD           FEFACL                                              CLE134
     C                     KFLD           FEFSEQ                                              CLE134
     C                     KFLD           FEBRCA                                              CLE134
      *                                                                                       CLE134
     C           WK90      KLIST                                                              CLE134
     C                     KFLD           FELOAN                                              CLE134
     C                     KFLD           FECNUM                                              CLE134
     C                     KFLD           FEFACL                                              CLE134
     C                     KFLD           FEFSEQ                                              CLE134
     C                     KFLD           FEBRCA                                              CLE134
     C                     KFLD           KPDVDT                                              CLE134
     C                     Z-ADD0         KPDVDT  50                                          CLE134
      *                                                                                       CLE134
      ** LEPDUEPD                                                                             CLE134
      *                                                                                       CLE134
     C           WKDUE     KLIST                                                              CLE134
     C                     KFLD           WBRCA                                               CLE134
     C                     KFLD           FELOAN                                              CLE134
     C                     KFLD           KPDVDT                                              CLE134
      *                                                                                       CLE134
      ** LEPDUEPD                                                                             CLE134
      *                                                                                       CLE134
     C           WKDUEP    KLIST                                                              CLE134
     C                     KFLD           WBRCA                                               CLE134
     C                     KFLD           FELOAN                                              CLE134
      *                                                                                       CLE134
     C                     Z-ADD0         KPDVDT  50                                          CLE134
     C                     Z-ADD0         KPOSEQ  50                                          CLE134
      *                                                                                       CLE134
      ** Key list for FCLTY                                                                   CGL020
      *                                                                                       CGL020
     C           FCKEY     KLIST                                                              CGL020
     C                     KFLD           FECNUM                                              CGL020
     C                     KFLD           FCFTYP                                              CGL020
     C                     KFLD           FCFNUM                                              CGL020
     C                     KFLD           WRCDT                                               CGL020
      *                                                                   155672
      ** Parameter list for program AONOSTR0                              155672
      *                                                                   155672
     C           PNOST     PLIST                                          155672
     C                     PARM '*MSG   ' WRTCD                           155672
     C                     PARM '*KEY   ' WOPTN                           155672
     C                     PARM           WKEYA   6                       155672
     C                     PARM           WKEYB   3                       155672
     C**********           PARM           WKEYC   4                                    155672 CGL029
     C                     PARM           WKEYC  10                                           CGL029
     C                     PARM           WKEYD   2                       155672
     C                     PARM           WKEYE   2                       155672
     C                     PARM           WKEYF   3                       155672
     C                     PARM           WKEYG  10                       155672
     C                     PARM           WKEYH   1                       155672
     C           SDNOST    PARM SDNOST    DSFDY                           155672
      *                                                                   155672
      ** Parameter list for program AOCUSTR0                              155672
      *                                                                   155672
     C           PCUST     PLIST                                          155672
     C                     PARM '*MSG   ' WRTCD                           155672
     C                     PARM '*KEY   ' WOPTN                           155672
     C                     PARM           WCKEY  10                       155672
     C                     PARM           WKYSTS  7                       155672
     C           SDCUST    PARM SDCUST    DSSDY                           155672
      *
     C           BDCHK     PLIST                                                              CLE141
     C                     PARM           ZDAYNO                                              CLE141
     C                     PARM           ACCY                                                CLE141
     C                     PARM           ALOC                                                CLE141
     C                     PARM           PAYIND  1                                           CLE141
     C                     PARM           BJDFIN                                              CLE141
     C                     PARM           CCYLL   3                                          CLE141A
     C                     PARM           LOCLL   3                                          CLE141A
     C                     PARM *ZEROS    ZADJDT  50                                          CLE141
      *                                                                                       CLE141
     C                     Z-ADD0         L2NORE                                              CLE134
     C                     Z-ADD0         L2VLRF                                              CLE134
     C                     Z-ADD0         L2VLRL                                              CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           1         SETLLLEPK2ZZ                                                       CLE134
     C                     READ LEPK2ZZ                  88                                   CLE134
     C           *IN88     IFEQ *OFF                                                          CLE134
     C                     ENDIF                                                              CLE134
     C           1         SETLLLEPK2HH                                                       CLE134
     C                     READ LEPK2HH                  88                                   CLE134
     C           *IN88     IFEQ *ON                                                           CLE134
     C                     MOVE 'H'       LKRECI                                              CLE134
     C                     WRITELKEYF2AF                                                      CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
      ** Check the next transaction ID of LEPK2DPD                                            CLE164
      *                                                                                       CLE164
     C                     Z-ADDLKNORE    SETRID                                              CLE164
     C           SETRID    SUB  2         SETRID                                              CLE164
      *                                                                                       CLE164
     C                     ENDSR
      *
      *****************************************************************
     C/TITLE SR/RTLX                                                      CLE007
      *****************************************************************   CLE007
      *                                                                   CLE007
      *  RTLX  -                                                          CLE007
      *                                                                   CLE007
      *  CALLED FROM:  Main Processing                                    CLE007
      *                                                                   CLE007
      *  CALLS:  ZHASH                                                    CLE007
      *                                                                   CLE007
      *****************************************************************   CLE007
      *                                                                   CLE007
     C           RTLX      BEGSR                                          CLE007
      *                                                                   CLE009
      ** If CLE009 is on and settlement date telex indicator is blank     CLE009
      ** or CLE009 is off                                                 CLE009
      *                                                                   CLE009
     C           CLE009    IFEQ 'Y'                                       CLE009
     C           FASTTI    ANDEQ*BLANKS                                   CLE009
     C           CLE009    OREQ 'N'                                       CLE009
     C*                                                                   CLE007
     C                     MOVE 'D'       RECI                            CLE007
     C**********           MOVEL'F'       LNRFA                                      CLE007 MD050111
     C                     MOVEL' '       LNRFA                                             MD050111
     C                     MOVE FAFACL    LNRFA                           CLE007
     C                     MOVE FAVDAT    VDAT                            CLE007
     C                     Z-ADDFAFSEQ    LASNS                           CLE007
     C                     MOVE *BLANK    LTYP                            CLE007
     C                     MOVE *BLANK    SUTP                            CLE007
     C                     MOVE *BLANK    CLAS                                                CLE042
     C                     Z-ADD*ZEROS    PTYP                            CLE007
     C***********          MOVE 'FS'      AMTP                     CLE007 128725
     C                     MOVE 'LS'      AMTP                            128725
     C                     MOVE FAFCCY    CCY                             CLE007
     C                     MOVE FASADJ    EAMT                            CLE007
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           PTFI      IFEQ *BLANKS                                                       CLE031
     C           FASCCY    ANDNE*BLANKS                                                       CLE031
     C                     MOVE FASCCY    WRKCCY                                              CLE031
     C                     Z-ADDFAREXR    WRKEXR                                              CLE031
     C                     MOVE FAREXI    WRKEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           PTFI      IFNE *BLANKS                                                       CLE031
     C           FAPSCY    ANDNE*BLANKS                                                       CLE031
     C                     MOVE FAPSCY    WRKCCY                                              CLE031
     C                     Z-ADDFAPEXR    WRKEXR                                              CLE031
     C                     MOVE FAPEXI    WRKEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           FAFCCY    IFNE WRKCCY                                                        CLE031
     C           WRKCCY    ANDNE*BLANKS                                                       CLE034
     C                     MOVE 'Y'       WRKPRC                                              CLE031
     C                     Z-ADD1         X                                                   CLE031
     C           FAFCCY    LOKUPCURR,X                   13                                   CLE031
     C                     MOVE CIND,X    WRKFIN                                              CLE031
      *                                                                                       CLE031
     C                     Z-ADD1         X                                                   CLE031
     C           WRKCCY    LOKUPCURR,X                   13                                   CLE031
      *                                                                                       CLE031
     C           CIND,X    IFEQ 'Y'                                                           CLE031
     C           WRKCCY    OREQ BKEURO                                                        CLE031
     C           WRKFIN    ANDEQ'Y'                                                           CLE031
     C                     MOVE 'N'       WRKPRC                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           WRKPRC    IFEQ 'Y'                                                           CLE031
     C                     MOVE WRKCCY    CCY                                                 CLE031
     C           WRKEXI    IFEQ 'M'                                                           CLE031
     C           EAMT      MULT WRKEXR    EAMT                                                CLE031
     C                     ELSE                                                               CLE031
     C           EAMT      DIV  WRKEXR    EAMT                                                CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     MOVE FABRCA    BRCA                            CLE007
     C                     MOVE FACNUM    CNUM                            CLE007
     C                     MOVE 'F'       RCDT                            CLE007
     C           PTFI      IFEQ 'P'                                       CLE007
     C           PTFI      OREQ 'S'                                                           CLE106
     C           PTFI      OREQ 'R'                                                           CLE106
     C                     MOVE 'P'       PYRC                            CLE007
     C                     ENDIF                                          CLE007
     C           PTFI      IFEQ ' '                                       CLE007
     C                     MOVE 'R'       PYRC                            CLE007
     C                     ENDIF                                          CLE007
     C                     MOVE *BLANK    INTC                            CLE007
     C                     Z-ADD0         PRI1                            CLE007
     C                     Z-ADD0         PRI2                            CLE007
     C                     Z-ADD0         PRI3                            CLE007
     C                     Z-ADD0         PRI4                            CLE007
     C                     Z-ADD0         TIND                            CLE007
     C                     MOVE FAOSBR    OSBR                            CLE007
     C                     MOVE FAMETH    SETP                            CLE007
     C                     MOVE FAOURS    OSAC                            CLE007
     C                     MOVE FATHER    TSEN                            CLE007
     C*********************MOVE BENN      FACO                      CLE007CLE009
     C*********************MOVE BTB1      SPI1                      CLE007CLE009
     C*********************MOVE BTB2      SPI2                      CLE007CLE009
     C*********************MOVE BTB3      SPI3                      CLE007CLE009
     C                     MOVE FABENN    FACO                            CLE009
     C                     MOVE FABTB1    SPI1                            CLE009
     C                     MOVE FABTB2    SPI2                            CLE009
     C                     MOVE FABTB3    SPI3                            CLE009
      *                                                                   CLE007
      ** Obtain Customer Swift Id. for output.                            CLE007
     C                     MOVE *BLANKS   KEYC   10                       CLE007
     C                     MOVELCNUM      KEYC                            CLE007
     C                     CALL 'AOCUSTR0'                                CLE007
     C                     PARM 'MSG    ' WRTCD                           CLE007
     C                     PARM '*KEY   ' WOPTN                           CLE007
     C                     PARM           KEYC                            CLE007
     C                     PARM           KEYSTS  7                       CLE007
     C           SDCUST    PARM SDCUST    DSSDY                           CLE007
     C           WRTCD     IFNE *BLANKS                                   CLE007
     C           *LOCK     IN   LDA                                       CLE007
     C                     MOVEL'LER135'  DBPGM                           CLE007
     C                     MOVELCNUM      DBKEY            ************   CLE007
     C                     MOVEL'SDCUSTPD'DBFILE           * DBERR 21 *   CLE007
     C                     Z-ADD021       DBASE            ************   CLE007
     C                     OUT  LDA                                       CLE007
     C                     EXSR *PSSR                                     CLE007
     C                     ELSE                                           CLE007
     C                     MOVE BBCSID    CSID                            CLE007
     C                     ENDIF                                          CLE007
      *                                                                   CLE007
      **  Obtain Branch Internal Cust. for output.                        CLE007
     C**********           CALL 'AOBRCHR0'                                             CLE007 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' WRTCD   7                       CLE007
     C                     PARM '*KEY   ' WOPTN   7                       CLE007
     C                     PARM BRCA      WBRCD   3                       CLE007
     C           SDBRCH    PARM SDBRCH    DSSDY                           CLE007
     C           WRTCD     IFNE *BLANKS                                   CLE007
     C           *LOCK     IN   LDA                                       CLE007
     C                     MOVEL'LER135'  DBPGM                           CLE007
     C                     MOVELBRCA      DBKEY            ************   CLE007
     C                     MOVEL'SDBRCHPD'DBFILE           * DBERR 22 *   CLE007
     C                     Z-ADD022       DBASE            ************   CLE007
     C                     OUT  LDA                                       CLE007
     C                     EXSR *PSSR                                     CLE007
     C                     END                                            CLE007
     C                     MOVE A8BICN    BICN                            CLE007
      *                                                                   CLE007
     C*********************MOVE CVMR      CVMI                      CLE007CLE009
     C*********************MOVE RSTM      RRST                      CLE007CLE009
     C*********************MOVE RONS      RRON                      CLE007CLE009
     C*********************MOVE RIBN      RRIB                      CLE007CLE009
     C*********************MOVE RIBA      RRBA                      CLE007CLE009
     C*********************MOVE ROBN      RROB                      CLE007CLE009
     C*********************MOVE ROCN      RROC                      CLE007CLE009
     C                     MOVE FACVMR    CVMI                            CLE009
     C                     MOVE FARSTM    RRST                            CLE009
     C                     MOVE FARONS    RRON                            CLE009
     C                     MOVE FARIBN    RRIB                            CLE009
     C                     MOVE FARIBA    RRBA                            CLE009
     C                     MOVE FAROBN    RROB                            CLE009
     C                     MOVE FAROCN    RROC                            CLE009
      *                                                                   CLE007
      ** Add 1 to record counter                                          CLE007
     C                     ADD  1         RCOUNT                          CLE007
      *  Update Hash accumulator with the EAMT of the record.             CLE007
     C                     Z-ADDEAMT      ZZAMT                           CLE007
     C                     Z-ADDHRWN      INT,2                           CLE007
     C                     Z-ADDHRDC      DEC,2                           CLE007
     C                     Z-ADD1         Z                               CLE007
     C                     Z-ADD2         S                               CLE007
     C                     EXSR ZHASH                                     CLE007
     C                     Z-ADDZZTOTI    XHRWN                           CLE007
     C                     Z-ADDZZTOTD    XHRDC                           CLE007
      *  Output record to LEPXTAB.                                        CLE007
     C                     WRITELEPXTABF                                  CLE007
      *                                                                   CLE007
     C                     ENDIF                                          CLE009
     C                     ENDSR                                          CLE007
      *****************************************************************   CLE007
      *****************************************************************   CLE009
      *                                                                   CLE009
      *  RTLX2 - Output fee details to pay/receive telex files            CLE009
      *                                                                   CLE009
      *  CALLED FROM: MAIN                                                CLE009
      *                                                                   CLE009
      *  CALLS:                                                           CLE009
      *                                                                   CLE009
      *****************************************************************   CLE009
      *                                                                   CLE009
     C           RTLX2     BEGSR                                          CLE009
      *                                                                   CLE009
      ** If telex type is live                                            CLE009
      *                                                                   CLE009
     C           RTTYPE    IFEQ 'L'                                       CLE009
     C                     MOVE 'D'       RECI                            CLE009
      *                                                                   CLE009
      ** If adjustment sign is '+'                                        CLE009
      *                                                                   CLE009
     C           RTSIGN    IFEQ '+'                                       CLE009
     C           WFEE      ADD  RTAMT     EAMT                            CLE009
     C                     ELSE                                           CLE009
     C           WFEE      SUB  RTAMT     EAMT                            CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ELSE                                           CLE009
     C                     MOVE 'R'       RECI                            CLE009
     C                     Z-ADDFASADJ    EAMT                            CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     MOVE 'LF'      AMTP                            CLE009
     C                     Z-ADDBJRDNB    VDAT                            CLE009
     C                     Z-ADDFEFSEQ    LASNS                           CLE009
     C                     MOVE FEFCCY    CCY                             CLE009
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           PTFI      IFEQ *BLANKS                                                       CLE031
     C           FESCCY    ANDNE*BLANKS                                                       CLE031
     C                     MOVE FESCCY    WRKCCY                                              CLE031
     C                     Z-ADDFEREXR    WRKEXR                                              CLE031
     C                     MOVE FEREXI    WRKEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           PTFI      IFNE *BLANKS                                                       CLE031
     C           FEPSCY    ANDNE*BLANKS                                                       CLE031
     C                     MOVE FEPSCY    WRKCCY                                              CLE031
     C                     Z-ADDFEPEXR    WRKEXR                                              CLE031
     C                     MOVE FEPEXI    WRKEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           FEFCCY    IFNE WRKCCY                                                        CLE031
     C                     MOVE 'Y'       WRKPRC                                              CLE031
     C                     Z-ADD1         X                                                   CLE031
     C           FEFCCY    LOKUPCURR,X                   13                                   CLE031
     C                     MOVE CIND,X    WRKFIN                                              CLE031
      *                                                                                       CLE031
     C                     Z-ADD1         X                                                   CLE031
     C           WRKCCY    LOKUPCURR,X                   13                                   CLE031
      *                                                                                       CLE031
     C           CIND,X    IFEQ 'Y'                                                           CLE031
     C           WRKCCY    OREQ BKEURO                                                        CLE031
     C           WRKFIN    ANDEQ'Y'                                                           CLE031
     C                     MOVE 'N'       WRKPRC                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           WRKPRC    IFEQ 'Y'                                                           CLE031
     C                     MOVE WRKCCY    CCY                                                 CLE031
     C           WRKEXI    IFEQ 'M'                                                           CLE031
     C           EAMT      MULT WRKEXR    EAMT                                                CLE031
     C                     ELSE                                                               CLE031
     C           EAMT      DIV  WRKEXR    EAMT                                                CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     MOVE FEOSBR    OSBR                            CLE009
     C                     Z-ADDFESTTL    SETP                            CLE009
     C                     MOVE FEOURS    OSAC                            CLE009
     C                     MOVE BENN      FACO                            CLE009
     C                     MOVE BTB1      SPI1                            CLE009
     C                     MOVE BTB2      SPI2                            CLE009
     C                     MOVE BTB3      SPI3                            CLE009
     C                     MOVE CVMR      CVMI                            CLE009
     C                     MOVE RSTM      RRST                            CLE009
     C                     MOVE RONS      RRON                            CLE009
     C                     MOVE RIBN      RRIB                            CLE009
     C                     MOVE RIBA      RRBA                            CLE009
     C                     MOVE ROBN      RROB                            CLE009
     C                     MOVE ROCN      RROC                            CLE009
     C*                                                                   CLE009
     C**********           MOVEL'F'       LNRFA                                      CLE009 MD050111
     C                     MOVEL' '       LNRFA                                             MD050111
     C                     MOVE FAFACL    LNRFA                           CLE009
     C                     MOVE *BLANK    LTYP                            CLE009
     C                     MOVE *BLANK    SUTP                            CLE009
     C                     MOVE *BLANK    CLAS                                                CLE042
     C/COPY WNCPYSRC,LEH00380
     C                     Z-ADD*ZEROS    PTYP                            CLE009
     C                     MOVE FABRCA    BRCA                            CLE009
     C                     MOVE FACNUM    CNUM                            CLE009
     C                     MOVE 'F'       RCDT                            CLE009
     C           PTFI      IFEQ 'P'                                       CLE009
     C           PTFI      OREQ 'S'                                                           CLE106
     C           PTFI      OREQ 'R'                                                           CLE106
     C                     MOVE 'P'       PYRC                            CLE009
     C                     ENDIF                                          CLE009
     C           PTFI      IFEQ ' '                                       CLE009
     C                     MOVE 'R'       PYRC                            CLE009
     C                     ENDIF                                          CLE009
     C                     MOVE *BLANK    INTC                            CLE009
     C                     Z-ADD0         PRI1                            CLE009
     C                     Z-ADD0         PRI2                            CLE009
     C                     Z-ADD0         PRI3                            CLE009
     C                     Z-ADD0         PRI4                            CLE009
     C                     Z-ADD0         TIND                            CLE009
     C                     MOVE FETHER    TSEN                            CLE009
      *                                                                   CLE009
      ** Obtain Customer Swift Id. for output.                            CLE009
     C                     MOVE *BLANKS   KEYC   10                       CLE009
     C                     MOVELCNUM      KEYC                            CLE009
     C                     CALL 'AOCUSTR0'                                CLE009
     C                     PARM 'MSG    ' WRTCD                           CLE009
     C                     PARM '*KEY   ' WOPTN                           CLE009
     C                     PARM           KEYC                            CLE009
     C                     PARM           KEYSTS  7                       CLE009
     C           SDCUST    PARM SDCUST    DSSDY                           CLE009
     C           WRTCD     IFNE *BLANKS                                   CLE009
     C           *LOCK     IN   LDA                                       CLE009
     C                     MOVEL'LER135'  DBPGM                           CLE009
     C                     MOVELCNUM      DBKEY            ************   CLE009
     C                     MOVEL'SDCUSTPD'DBFILE           * DBERR 31 *   CLE009
     C                     Z-ADD031       DBASE            ************   CLE009
     C                     OUT  LDA                                       CLE009
     C                     EXSR *PSSR                                     CLE009
     C                     ELSE                                           CLE009
     C                     MOVE BBCSID    CSID                            CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      **  Obtain Branch Internal Cust. for output.                        CLE009
     C**********           CALL 'AOBRCHR0'                                             CLE009 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' WRTCD   7                       CLE009
     C                     PARM '*KEY   ' WOPTN   7                       CLE009
     C                     PARM BRCA      WBRCD   3                       CLE009
     C           SDBRCH    PARM SDBRCH    DSSDY                           CLE009
     C           WRTCD     IFNE *BLANKS                                   CLE009
     C           *LOCK     IN   LDA                                       CLE009
     C                     MOVEL'LER135'  DBPGM                           CLE009
     C                     MOVELBRCA      DBKEY            ************   CLE009
     C                     MOVEL'SDBRCHPD'DBFILE           * DBERR 32 *   CLE009
     C                     Z-ADD032       DBASE            ************   CLE009
     C                     OUT  LDA                                       CLE009
     C                     EXSR *PSSR                                     CLE009
     C                     END                                            CLE009
     C                     MOVE A8BICN    BICN                            CLE009
      *                                                                   CLE009
      ** Add 1 to record counter                                          CLE009
     C                     ADD  1         RCOUNT                          CLE009
      *  Update Hash accumulator with the EAMT of the record.             CLE009
     C                     Z-ADDEAMT      ZZAMT                           CLE009
     C                     Z-ADDHRWN      INT,2                           CLE009
     C                     Z-ADDHRDC      DEC,2                           CLE009
     C                     Z-ADD1         Z                               CLE009
     C                     Z-ADD2         S                               CLE009
     C                     EXSR ZHASH                                     CLE009
     C                     Z-ADDZZTOTI    XHRWN                           CLE009
     C                     Z-ADDZZTOTD    XHRDC                           CLE009
      *  Output record to LEPXTAB.                                        CLE009
     C                     WRITELEPXTABF                                  CLE009
      *                                                                   CLE009
     C                     ENDSR                                          CLE009
      *****************************************************************   CLE009
      *                                                                   CLE009
      *  SRTXDT- Calculate telex notice date                              CLE009
      *                                                                   CLE009
      *  CALLED FROM: MAIN                                                CLE009
      *                                                                   CLE009
      *  CALLS:                                                           CLE009
      *                                                                   CLE009
      *****************************************************************   CLE009
      *                                                                   CLE009
     C           SRTXDT    BEGSR                                          CLE009
     C                     MOVE FEFCCY    ZCCY                            CLE009
     C                     Z-ADDBJRDNB    ZDAYNO                          CLE009
      *                                                                                       CLE031
      ** If settlement method is 09 and postings are to use Transaction                       218782
      ** currency, do not set up settlement currency                                          218782
      *                                                                                       218782
     C           CLE033    IFEQ 'Y'                                                           218782
     C           SETP      ANDEQ09                                                            218782
     C           SET09     ANDEQ'T'                                                           218782
     C                     ELSE                                                               218782
      *                                                                                       218782
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           PTFI      IFNE *BLANKS                                                       CLE031
     C           FESCCY    ANDNE*BLANKS                                                       CLE031
     C                     MOVE FESCCY    ZCCY                                                CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           PTFI      IFEQ *BLANKS                                                       CLE031
     C           FEPSCY    ANDNE*BLANKS                                                       CLE031
     C                     MOVE FEPSCY    ZCCY                                                CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              218782
     C                     MOVE ZCCY      PCURR                                               CLE031
      *                                                                   CLE009
      ** If Fee Settlement type is '01', '02', '07', '08' or '12'         CLE009
      *                                                                   CLE009
     C           FESTTL    IFEQ 01                                        CLE009
     C           FESTTL    OREQ 02                                        CLE009
     C           FESTTL    OREQ 07                                        CLE009
     C           FESTTL    OREQ 08                                        CLE009
     C           FESTTL    OREQ 12                                        CLE009
      *                                                                   CLE009
     C                     CALL 'AONOSTR0'                                CLE009
     C                     PARM *BLANKS   PRTCD   7                       CLE009
     C                     PARM '*KEY   ' POPTN   7                       CLE009
     C                     PARM           PCUSN   6                       CLE009
     C************         PARM FEFCCY    PCURR   3                       CLE009              CLE031
     C                     PARM           PCURR   3                                           CLE031
     C**********           PARM           PACCD   4                                    CLE009 CGL029
     C                     PARM           PACCD  10                                           CGL029
     C                     PARM           PACSN   2                       CLE009
     C                     PARM FEOURS    PNONB   2                       CLE009
     C                     PARM           PBRCA   3                       CLE009
     C                     PARM           PCSSN  10                       CLE009
     C                     PARM           PPNOI   1                       CLE009
     C           SDNOST    PARM SDNOST    DSFDY                           CLE009
      *                                                                   CLE009
     C           PRTCD     IFNE *BLANKS                                   CLE009
     C           *LOCK     IN   LDA                                       CLE009
     C                     MOVEL'AONOSTR0'DBFILE           ************   CLE009
     C                     Z-ADD30        DBASE            * DBERR 30 *   CLE009
     C                     MOVELFEFCCY    DBKEY            ************   CLE009
     C                     OUT  LDA                                       CLE009
     C                     EXSR *PSSR                                     CLE009
      *                                                                   CLE009
     C                     ELSE                                           CLE009
      *                                                                   CLE009
      ** Set Location to Nostro Location                                  CLE009
      *                                                                   CLE009
     C                     MOVE A7NOSN    ZLOC                            CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
     C                     ELSE                                           CLE009
      *                                                                   CLE009
     C                     MOVE *BLANKS   ZLOC                            CLE009
      *                                                                   CLE009
     C                     ENDIF                                          CLE009
      *                                                                   CLE009
      ** Calculate number of working days forward                         CLE009
      *                                                                   CLE009
     C                     EXSR ZFWDT                                     CLE009
      *                                                                   CLE009
      ** Set Telex Notice date to day number                              CLE009
      *                                                                   CLE009
     C                     Z-ADDZDYNBR    TXDT    50                      CLE009
     C                     ENDSR                                          CLE009
     C/TITLE SR/RECALC                                                    CLE005
      *****************************************************************   CLE005
      *                                                                   CLE005
      *  RECALC - Recalculating the total fee due from start.             CLE005
      *                                                                   CLE005
      *  In case of changes to this sub-routine, verify whether these     MD031473
      *  apply to SR/RECALL as well, as sr/RECALL is based on sr/RECALC.  MD031473
      *                                                                   MD031473
      *  CALLED FROM:  SR/AMTACC                                          CLE005
      *                                                                   CLE005
      *  CALLS: SR/HISCAL                                                 CLE005
      *                                                                   CLE005
      *****************************************************************   CLE005
      *                                                                   CLE005
     C           RECALC    BEGSR                                          CLE005
      *                                                                   CLE005
     C* Recalculate the total fee due from start.                         CLE005
     C                     MOVE *BLANK    ATYP                            CLE005
     C                     Z-ADDFEPSTD    STDATE                          CLE005
     C                     Z-ADDFELPDT    ENDATE                          CLE005
     C                     Z-ADD0         WFEE                            CLE005
     C                     Z-ADD0         ADJBAK 130                                          258597
     C                     Z-ADD0         TDUE   130                      CLE005
      *                                                                   CLE005
      ***If*ind.*70*is*off,*calculate wdays.***                           CLE005              204452
      ** Calculate WDAYS.                                                                     204452
     C********** *IN70     IFEQ '0'                                       CLE005              204452
      *                                                                   CLE005
     C***********ENDATE    SUB  STDATE    WDAYS                    CLE005 CLE013
     C**********           Z-ADDSTDATE    ZZBEG                                       CLE013 BUG8762
     C**********           Z-ADDENDATE    ZZEND                                       CLE013 BUG8762
     C**********           MOVE FECALC    ZZCALC                                      CLE013 BUG8762
     C**********           EXSR ZINTDY                                                CLE013 BUG8762
     C**********           Z-ADDZZINDY    WDAYS                                       CLE013 BUG8762
     C********** BKALDI    IFNE 'Y'                                                    CLE005 214120
     C**********           ADD  1         WDAYS                                        CLE005 214120
     C**********           ENDIF                                                       CLE005 214120
     C********** HSAKY1    SETGTFACHSAL1                                              CLE005 BUG8762
     C**********           READPFACHSAL1                 68                           CLE005 BUG8762
     C**********           Z-ADDFACFAM    CFAMT                                       CLE005 BUG8762
      **********                                                                      CLE005 BUG8762
     C***Setup*field*AAMT.*********************************************               CLE005 BUG8762
     C********** CALT      IFLE 6                                                     CLE005 BUG8762
     C********** FAUNDR    IFGT 0                                                     CLE005 BUG8762
     C**********           Z-ADDFAUNDR    AAMT                                        CLE005 BUG8762
     C**********           ELSE                                                       CLE005 BUG8762
     C**********           Z-ADD0         AAMT                                        CLE005 BUG8762
     C**********           ENDIF                                                      CLE005 BUG8762
     C**********           ELSE                                                       CLE005 BUG8762
     C********** CALT      IFLE 16                                                    CLE005 BUG8762
     C**********           Z-ADDFADRAM    AAMT                                        CLE005 BUG8762
     C**********           ELSE                                                       CLE005 BUG8762
     C********** CALT      IFLE 22                                                    CLE005 BUG8762
     C**********           Z-ADDFACFAM    AAMT                                        CLE005 BUG8762
     C**********           ENDIF                                                      CLE005 BUG8762
     C**********           ENDIF                                                      CLE005 BUG8762
     C**********           ENDIF                                                      CLE005 BUG8762
     C**********           EXSR HISCAL                                                CLE005 BUG8762
     C**********           Z-ADDWFEE      TDUE                                        CLE005 BUG8762
      *                                                                   CLE005
     C**********           ELSE                                           CLE005              204452
     C********** LEFKEY    SETLLLEFHSTL2                                  CLE005              204452
     C********** LEFKEY    READELEFHSTL2                 27               CLE005              204452
     C********** *IN27     DOWEQ'0'                                       CLE005              204452
     C**********           Z-ADDHIHDAT    ENDATE                          CLE005              204452
     C***Compute*for*WDAYS.***                                            CLE005              204452
     C***********ENDATE    SUB  STDATE    WDAYS                    CLE005 CLE013
     C**********           Z-ADDSTDATE    ZZBEG                           CLE013              204452
     C**********           Z-ADDENDATE    ZZEND                           CLE013              204452
     C**********           MOVE FECALC    ZZCALC                          CLE013              204452
     C**********           EXSR ZINTDY                                    CLE013              204452
     C**********           Z-ADDZZINDY    WDAYS                           CLE013              204452
     C********** HSAKY1    SETGTFACHSAL1                                  CLE005              204452
     C**********           READPFACHSAL1                 69               CLE005              204452
     C**********           Z-ADDFACFAM    CFAMT                           CLE005              204452
     C***Setup*field*AAMT.***                                             CLE005              204452
     C********** CALT      IFLE 6                                         CLE005              204452
     C********** FAUNDR    IFGT 0                                         CLE005              204452
     C**********           Z-ADDFAUNDR    AAMT                            CLE005              204452
     C**********           ELSE                                           CLE005              204452
     C**********           Z-ADD0         AAMT                            CLE005              204452
     C**********           ENDIF                                          CLE005              204452
     C**********           ELSE                                           CLE005              204452
     C********** CALT      IFLE 16                                        CLE005              204452
     C**********           Z-ADDFADRAM    AAMT                            CLE005              204452
     C**********           ELSE                                           CLE005              204452
     C********** CALT      IFLE 22                                        CLE005              204452
     C**********           Z-ADDFACFAM    AAMT                            CLE005              204452
     C**********           ENDIF                                          CLE005              204452
     C**********           ENDIF                                          CLE005              204452
     C**********           ENDIF                                          CLE005              204452
     C**********           EXSR HISCAL                                    CLE005              204452
     C**********           ADD  WFEE      TDUE                            CLE005              204452
     C**********           Z-ADD0         WFEE                            CLE005              204452
     C**********           Z-ADDENDATE    STDATE                          CLE005              204452
     C********** LEFKEY    READELEFHSTL2                 27               CLE005              204452
      **********                                                          CLE005              204452
     C**********           ENDDO                                          CLE005              204452
      ***Endif*for**IN70.***                                              CLE005              204452
     C**********           ENDIF                                          CLE005              204452
      *                                                                                      BUG8762
      ** Move rates and amounts from LEFEED to working arrays.                               BUG8762
      *                                                                                      BUG8762
     C           CLE071    IFEQ 'N'                                                           CLE071
     C                     Z-ADDFAMT      @WAMT                                              BUG8762
     C                     Z-ADDFRT       @WRT                                               BUG8762
     C********** LEFKEY    SETLLLEFHSTL2                                              BUG8762 250628
     C********** LEFKEY    READELEFHSTL2                 27                           BUG8762 250628
     C           LEFKEY    SETLLLEFHSTL7                                                      250628
     C           LEFKEY    READELEFHSTL7                 27                                   250628
      *                                                                                       CLE071
     C                     ELSE                                                               CLE071
      *                                                                                       CLE071
     C                     SETOF                     2729                                     258414
     C           LFKEY2    SETGTLEFHSTFB                                                      CLE071
     C           LFKEY3    REDPELEFHSTFB                 27                                   CLE071
     C           *IN27     IFEQ *OFF                                                          258414
     C                     Z-ADD@HAMT     FAMT                                                CLE071
     C                     Z-ADD@HRT      FRT                                                 CLE071
     C                     MOVELHIPIND    WKPIND                                              CLE071
     C                     SETOF                     27                                       CLE071
     C           LFKEY3    READELEFHSTFB                 29                                   CLE071
     C                     ENDIF                                                              258414
      *                                                                                       CLE071
     C           *IN29     IFEQ *OFF                                                          258414
     C           HIRCVD    IFLT FELPDT                                                      MD055069
     C                     MOVELHIRCVD    ENDATE                                              CLE071
     C                     ELSE                                                             MD055069
     C                     MOVELFELPDT    ENDATE                                            MD055069
     C                     ENDIF                                                            MD055069
     C                     ELSE                                                               CLE071
     C                     MOVELFELPDT    ENDATE                                              CLE071
     C                     ENDIF                                                              CLE071
     C                     ENDIF                                                              CLE071
      *                                                                                       CLE071
     C********** *IN27     DOWEQ'0'                                                   BUG8762 247821
     C           *IN27     DOUEQ'1'                                                           247821
     C           *IN27     IFEQ '0'                                                           247821
     C           CLE071    IFEQ 'N'                                                           CLE071
     C                     Z-ADDHIHDAT    ENDATE                                             BUG8762
      *                                                                                      BUG8762
      ** Move rates and amounts from historical file to FAMT and FRT.                        BUG8762
      *                                                                                      BUG8762
     C                     Z-ADD@HAMT     FAMT                                               BUG8762
     C                     Z-ADD@HRT      FRT                                                BUG8762
     C                     MOVELFEPIND    WKPIND                                              CLE071
     C                     ENDIF                                                              CLE071
     C                     ENDIF                                                              247821
      *                                                                                      BUG8762
      ** Fee Calculation Basis should be considered when computing                           BUG8762
      ** for the no. of days to be accrued.                                                  BUG8762
      *                                                                                      BUG8762
     C                     Z-ADD0         ZZINDY                                             BUG8762
     C                     Z-ADDENDATE    ZZEND                                              BUG8762
     C                     Z-ADDSTDATE    ZZBEG                                              BUG8762
     C                     MOVE FECALC    ZZCALC                                             BUG8762
     C                     EXSR ZINTDY                                                       BUG8762
     C           FECALC    IFEQ 6                                                             212048
     C                     Z-ADDINT6DY    WDAYS                                               212048
     C                     ELSE                                                               212048
     C                     Z-ADDZZINDY    WDAYS                                              BUG8762
     C                     END                                                                212048
      *                                                                                      BUG8762
     C           HSAKY1    SETGTFACHSAL1                                                     BUG8762
     C                     READPFACHSAL1                 69                                  BUG8762
     C                     Z-ADDFACFAM    CFAMT                                              BUG8762
     C*  Setup field AAMT.                                                                   BUG8762
     C           CALT      IFLE 6                                                            BUG8762
     C           FAUNDR    IFGT 0                                                            BUG8762
     C                     Z-ADDFAUNDR    AAMT                                               BUG8762
     C                     ELSE                                                              BUG8762
     C                     Z-ADD0         AAMT                                               BUG8762
     C                     ENDIF                                                             BUG8762
     C                     ELSE                                                              BUG8762
     C           CALT      IFLE 16                                                           BUG8762
     C                     Z-ADDFADRAM    AAMT                                               BUG8762
     C                     ELSE                                                              BUG8762
     C           CALT      IFLE 22                                                           BUG8762
     C                     Z-ADDFACFAM    AAMT                                               BUG8762
     C                     ENDIF                                                             BUG8762
     C                     ENDIF                                                             BUG8762
     C                     ENDIF                                                             BUG8762
     C                     EXSR HISCAL                                                       BUG8762
     C                     ADD  WFEE      TDUE                                               BUG8762
     C                     Z-ADD0         WFEE                                               BUG8762
     C                     Z-ADDENDATE    STDATE                                             BUG8762
     C********** LEFKEY    READELEFHSTL2                 27                           BUG8762 250628
     C           CLE071    IFEQ 'N'                                                           CLE071
     C           LEFKEY    READELEFHSTL7                 27                                   250628
      *                                                                                      BUG8762
     C                     Z-ADD@HAMT     FAMT                                                CLE071
     C                     Z-ADD@HRT      FRT                                                 CLE071
     C**********           MOVELHIPIND    WKPIND                                     CLE071 MD052952
     C                     MOVELFEPIND    WKPIND                                            MD052952
      *                                                                                       CLE071
     C                     ELSE                                                               258414
      *                                                                                       258414
     C                     Z-ADD@HAMT     FAMT                                                258414
     C                     Z-ADD@HRT      FRT                                                 258414
     C                     MOVELHIPIND    WKPIND                                              258414
      *                                                                                       258414
     C           *IN29     IFEQ *ON                                                           CLE071
     C                     SETON                     27                                       CLE071
     C                     ELSE                                                               CLE071
     C           LFKEY3    READELEFHSTFB                 29                                   CLE071
     C           *IN29     IFEQ *OFF                                                          258414
     C           HIRCVD    IFLT FELPDT                                                      MD055069
     C                     MOVELHIRCVD    ENDATE                                              258414
     C                     ELSE                                                             MD055069
     C                     MOVELFELPDT    ENDATE                                            MD055069
     C                     ENDIF                                                            MD055069
     C                     ELSE                                                               258414
     C                     MOVELFELPDT    ENDATE                                              258414
     C                     ENDIF                                                              258414
     C                     ENDIF                                                              258414
     C                     ENDIF                                                              CLE071
      *                                                                                       CLE071
     C                     ENDDO                                                             BUG8762
      *                                                                                      BUG8762
      ** Move rates and amounts from working arrays back to FAMT & FRT.                      BUG8762
      *                                                                                      BUG8762
     C                     Z-ADD@WAMT     FAMT                                               BUG8762
     C                     Z-ADD@WRT      FRT                                                BUG8762
      *                                                                   CLE005
      ** Recalculate Fee amount past due amount.                          CLE005
     C           TDUE      ADD  FETADJ    ADDUE  130                      CLE005
     C                     ADD  FEAMTA    ADDUE                           CLE005
     C                     SUB  FEAMTS    ADDUE                           CLE005
      *                                                                                       227253
     C           FELPDT    IFLE CODT                                                          227253
     C           CLE005    ANDEQ'Y'                                                           227253
     C                     SUB  ADJTOT    ADDUE                                               227253
     C                     ENDIF                                                              227253
      *                                                                                       227253
     C                     SUB  FEWOFF    ADDUE                                               258597
     C                     SUB  FEAMTW    ADDUE                                               258597
      *                                                                                       258597
      ** On RECALC, subtract existing PD with recomputed amount                               261129
      ** to determine the correct adjustment amount                                           261129
      *                                                                                       261129
     C********** FEAUTO    IFEQ 'Y'                                                    155514 261129
     C********** FEAUTO    OREQ 'C'                                                    CLE134 261129
     C********** FEAUTO    IFEQ 'C'                                                  261129 AR738695
     C********** CLE134    ANDEQ'Y'                                                  CLE134 AR738695
     C********** FEAUT2    OREQ 'C'                                                  CLE134 AR738695
     C********** CLE134    ANDEQ'Y'                                                  CLE134 AR738695
     C                     SUB  FEAMTP    ADDUE                           CLE005
     C**********           ENDIF                                                       155514 261129
     C**********           ENDIF                                                     CLE134 AR738695
      *                                                                   153736
      ** FEAMTP should be set to amount outstanding on previous fee       153736
      ** period only.                                                     153736
      *                                                                   153736
     C***********          ADD  ADDUE     FEAMTP                    CLE005153736
      *                                                                                       250628
      * Update FEAMTO with change in value of FEAMTP as the amount will already               250628
      * have been accrued, otherwise amount is reversed.                                      250628
      *                                                                                       250628
     C                     ADD  FEAMTP    FELPAM                                              250628
     C                     SUB  FEAMTP    FEAMTO                                              250628
     C**********           Z-ADDADDUE     FEAMTP                                       153736 243496
     C**********           Z-ADDADDUE     FEAMTP                                      245803 243496B
     C**********           SUB  FEWOFF    FEAMTP                                       141453 258597
     C**********           SUB  FEAMTW    FEAMTP                                       204452 258597
     C                     MOVE 'H'       ATYP                            CLE005
     C                     SUB  FEAMTP    FELPAM                                              250628
     C                     ADD  FEAMTP    FEAMTO                                              250628
     C                     ADD  FEAMTP    ADJBAK                                              258597
      *                                                                                       258597
     C           FEAMTP    IFNE 0                                                             258597
     C                     Z-ADDFEAMTP    W#AMTO                                              258597
     C                     ENDIF                                                              258597
      *                                                                   CLE005
     C                     ENDSR                                          CLE005
      *****************************************************************   CLE007
     C/TITLE SR/HISCAL                                                    CLE005
      *****************************************************************   CLE005
      *                                                                   CLE005
      *  HISCAL - Recalculating the total fee due from start.             CLE005
      *                                                                   CLE005
      *  In case of changes to this sub-routine, verify whether these     MD031473
      *  apply to SR/HISCLL as well, as sr/HISCLL is based on sr/HISCAL.  MD031473
      *                                                                   MD031473
      *  CALLED FROM:  SR/RECALC                                          CLE005
      *                                                                   CLE005
      *  CALLS: SR/ACCRUE                                                 CLE005
      *                                                                   CLE005
      *****************************************************************   CLE005
      *                                                                   CLE005
     C           HISCAL    BEGSR                                          CLE005
     C*                                                                   CLE005
     C                     SETOF                         18               CLE005
     C*                                                                   CLE005
     C           *IN18     DOWEQ'0'                                       CLE005
     C           HSAKY2    READEFACHSAL1                 18               CLE005
     C*                                                                   CLE005
     C           *IN18     IFEQ '1'                                       CLE005
     C           FADATE    ORGT ENDATE                                    CLE005
     C                     Z-ADDENDATE    FADATE                          CLE005
     C                     SETON                         18               CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
      ** Calculate for number of days.                                    CLE005
     C***********FADATE    SUB  STDATE    NDAYS                    CLE005 CLE013
     C                     Z-ADDSTDATE    ZZBEG                           CLE013
     C                     Z-ADDFADATE    ZZEND                           CLE013
     C                     MOVE FECALC    ZZCALC                          CLE013
     C                     EXSR ZINTDY                                    CLE013
     C           FECALC    IFEQ 6                                                             212048
     C                     Z-ADDINT6DY    NDAYS                                               212048
     C                     ELSE                                                               212048
     C                     Z-ADDZZINDY    NDAYS                           CLE013
     C                     END                                                                212048
      *                                                                   CLE005
     C********** FADATE    IFEQ ENDATE                                                 CLE005 214120
     C********** *IN18     ANDEQ'1'                                                    CLE005 214120
     C********** BKALDI    ANDNE'Y'                                                    CLE005 214120
     C**********           ADD  1         NDAYS                                        CLE005 214120
     C**********           ENDIF                                                       CLE005 214120
      *                                                                   CLE005
     C           NDAYS     IFGT 0                                         CLE005
     C           *IN70     IFEQ '0'                                       CLE005
     C           AAMT      MULT NDAYS     AAMT                            CLE005
     C                     DIV  WDAYS     AAMT      H                     CLE005
     C                     ADD  AAMT      WAMT                            CLE005
     C                     Z-ADDFADATE    STDATE                          CLE005
     C                     ELSE                                           CLE005
     C                     Z-ADDNDAYS     WDAYS                           CLE005
     C                     Z-ADDAAMT      WAMT                            CLE005
     C/COPY WNCPYSRC,LER135C042
     C                     EXSR ACCRUE                                    CLE005
     C/COPY WNCPYSRC,LER135C043
     C                     ADD  WTOT      WFEE                            CLE005
     C                     Z-ADDFADATE    STDATE                          CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
     C*  setup field AAMT.                                                CLE005
     C                     Z-ADDFACFAM    CFAMT                                              244411B
     C           CALT      IFLE 6                                         CLE005
     C           FAUNDR    IFGT 0                                         CLE005
     C                     Z-ADDFAUNDR    AAMT                            CLE005
     C                     ELSE                                           CLE005
     C                     Z-ADD0         AAMT                            CLE005
     C                     ENDIF                                          CLE005
     C                     ELSE                                           CLE005
     C           CALT      IFLE 16                                        CLE005
     C                     Z-ADDFADRAM    AAMT                            CLE005
     C                     ELSE                                           CLE005
     C           CALT      IFLE 22                                        CLE005
     C                     Z-ADDFACFAM    AAMT                            CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
     C*                                                                   CLE005
     C                     ENDDO                                          CLE005
     C           *IN70     IFEQ '0'                                       CLE005
     C                     EXSR ACCRUE                                    CLE005
     C**********           Z-ADDWTOT      WFEE                                        CLE005 BUG8762
     C                     ADD  WTOT      WFEE                                               BUG8762
     C                     Z-ADD0         WAMT                                               BUG8762
     C                     ENDIF                                          CLE005
     C*                                                                   CLE005
     C                     ENDSR                                          CLE005
      *****************************************************************
      /EJECT                                                                                  CGL020
      *****************************************************************                       CGL020
      *                                                               *                       CGL020
      *  SRAMLI - Determine AML Pay/Receive Instruction Control       *                       CGL020
      *                                                               *                       CGL020
      *****************************************************************                       CGL020
      *                                                                                       CGL020
     C           SRAMLI    BEGSR                                                              CGL020
      *                                                                                       CGL020
     C********** FELOAN    IFGT 0                                                      CGL020 CLE148
     C           FELOAN    IFGT *BLANKS                                                       CLE148
      *                                                                                       CGL020
      ** Loan based                                                                           CGL020
      *                                                                                       CGL020
     C           WLNKEY    CHAINCLOAN                19                                       CGL020
      *                                                                                       CGL020
      ** Database error                                                                       CGL020
      *                                                                                       CGL020
     C           *IN19     IFEQ *ON                                                           CGL020
     C           *LOCK     IN   LDA                                                           CGL020
     C                     MOVELFELOAN    DBKEY                                               CGL020
     C                     Z-ADD53        DBASE                                               CGL020
     C                     MOVEL'CLOAN'   DBFILE                                              CGL020
     C                     OUT  LDA                                                           CGL020
     C                     EXSR *PSSR                                                         CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     MOVELSTLNS3    STLNS1                                              CGL020
     C                     EXSR SRAMPR                                                        CGL020
      *                                                                                       CGL020
     C                     ELSE                                                               CGL020
      *                                                                                       CGL020
      ** Facility based                                                                       CGL020
      *                                                                                       CGL020
     C                     MOVELFEFACL    FCFTYP                                              CGL020
     C                     MOVE FEFACL    FCFNUM                                              CGL020
      *                                                                                       CGL020
     C           FCKEY     CHAINFCLTY                19                                       CGL020
      *                                                                                       CGL020
      ** Database error                                                                       CGL020
      *                                                                                       CGL020
     C           *IN19     IFEQ *ON                                                           CGL020
     C           *LOCK     IN   LDA                                                           CGL020
     C                     MOVELWFCKEY    DBKEY                                               CGL020
     C                     Z-ADD54        DBASE                                               CGL020
     C                     MOVEL'FCLTY'   DBFILE                                              CGL020
     C                     OUT  LDA                                                           CGL020
     C                     EXSR *PSSR                                                         CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     MOVELSTLNS4    STLNS1                                              CGL020
     C                     EXSR SRAMPR                                                        CGL020
      *                                                                                       CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     ENDSR                                                              CGL020
      *                                                                                       CGL020
      *****************************************************************                       CGL020
      /EJECT                                                                                  CGL020
      *****************************************************************                       CGL020
      *                                                               *                       CGL020
      *  SRAMPR - Determine AML Pay/Receive Instructions              *                       CGL020
      *                                                               *                       CGL020
      *****************************************************************                       CGL020
      *                                                                                       CGL020
     C           SRAMPR    BEGSR                                                              CGL020
      *                                                                                       CGL020
     C           LKOSAC    IFEQ *BLANKS                                                       CGL020
     C                     MOVE *BLANKS   F1RACT                                              CGL020
     C                     MOVE *BLANKS   F1RCTY                                              CGL020
     C                     MOVE *BLANKS   F1RBNK                                              CGL020
     C                     MOVE *BLANKS   F1RCDE                                              CGL020
     C                     MOVE *BLANKS   F1PACT                                              CGL020
     C                     MOVE *BLANKS   F1PCTY                                              CGL020
     C                     MOVE *BLANKS   F1PBNK                                              CGL020
     C                     MOVE *BLANKS   F1PCDE                                              CGL020
     C                     MOVE *BLANKS   F1DACT                                              CGL020
     C                     MOVE *BLANKS   F1DCTY                                              CGL020
     C                     MOVE *BLANKS   F1DBNK                                              CGL020
      *                                                                                       CGL020
     C                     ELSE                                                               CGL020
      *                                                                                       CGL020
     C                     CALL AMLPRI                                                        CGL020
     C                     PARM           WWROCN                                              CGL020
     C                     PARM           WWROBN                                              CGL020
     C                     PARM           WWPOCN                                              CGL020
     C                     PARM           WWPOBN                                              CGL020
     C                     PARM           WWBENN                                              CGL020
     C                     PARM           WWBENA                                              CGL020
     C                     PARM           WWAWBN                                              CGL020
     C                     PARM           WWAWBA                                              CGL020
     C                     PARM           F1RACT                                              CGL020
     C                     PARM           F1RCTY                                              CGL020
     C                     PARM           F1RBNK                                              CGL020
     C                     PARM           F1RCDE                                              CGL020
     C                     PARM           F1PACT                                              CGL020
     C                     PARM           F1PCTY                                              CGL020
     C                     PARM           F1PBNK                                              CGL020
     C                     PARM           F1PCDE                                              CGL020
     C                     PARM           F1DACT                                              CGL020
     C                     PARM           F1DCTY                                              CGL020
     C                     PARM           F1DBNK                                              CGL020
      *                                                                                       CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     Z-ADDFESDAT    F1SDAT                                              CGL020
      *                                                                                       CGL020
     C                     ENDSR                                                              CGL020
      *                                                                                       CGL020
      *****************************************************************                       CGL020
     C/TITLE SR/SETCCY                                                                        CLE031
      *****************************************************************                       CLE031
      *                                                                                       CLE031
      *  SETCCY - SET UP THE SETTLEMENT CURRENCY                                              CLE031
      *                                                                                       CLE031
      *  CALLED FROM: GENKEY                                                                  CLE031
      *                                                                                       CLE031
      *  CALLS:                                                                               CLE031
      *                                                                                       CLE031
      *****************************************************************                       CLE031
      *                                                                                       CLE031
     C           SETCCY    BEGSR                                                              CLE031
      *                                                                                       CLE031
     C                     Z-ADD0         WRKAMT                                            MD051940
     C                     Z-ADD1         X                                                   CLE031
     C           FEFCCY    LOKUPCURR,X                   13                                   CLE031
     C                     MOVE FEFCCY    WRKFCY                                              CLE031
     C                     MOVE CIND,X    WRKFIN                                              CLE031
     C                     MOVE MTDV,X    WRKMDI                                              CLE031
     C                     Z-ADDCSPT,X    WRKSPT                                              CLE031
     C                     Z-ADDCCDP,X    FENBDP  10                                          CLE031
     C                     MOVE 'Y'       WRKPRC                                              CLE031
     C                     MOVE *BLANKS   WRKCCY                                              CLE031
      *                                                                                       CLE031
      ** If settlement method is 09 and postings are to use Transaction                       218782
      ** currency, do not set up WRKCCY.                                                      218782
      *                                                                                       218782
     C           CLE033    IFEQ 'Y'                                                           218782
     C********** SETP      ANDEQ09                                                     218782 218992
     C           LKSETP    ANDEQ09                                                            218992
     C           SET09     ANDEQ'T'                                                           218782
     C                     MOVE *BLANKS   WRKCCY                                              218782
     C                     Z-ADD*ZEROS    WRKEXR                                              218782
     C                     MOVE *BLANKS   WRKEXI                                              218782
     C                     ELSE                                                               218782
      *                                                                                       218782
     C           PTFI      IFEQ *BLANKS                                                       CLE031
     C                     MOVE FESCCY    WRKCCY                                              CLE031
     C                     Z-ADDFEREXR    WRKEXR                                              CLE031
     C                     MOVE FEREXI    WRKEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           PTFI      IFEQ 'P'                                                           CLE031
     C           PTFI      OREQ 'S'                                                           CLE106
     C           PTFI      OREQ 'R'                                                           CLE106
     C                     MOVE FEPSCY    WRKCCY                                              CLE031
     C                     Z-ADDFEPEXR    WRKEXR                                              CLE031
     C                     MOVE FEPEXI    WRKEXI                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           PTFI      IFEQ 'I'                                                           CLE031
     C                     MOVE *BLANKS   WRKCCY                                              CLE031
     C                     Z-ADD*ZEROS    WRKEXR                                              CLE031
     C                     MOVE *BLANKS   WRKEXI                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              218782
      *                                                                                       CLE031
     C           WRKCCY    IFEQ *BLANKS                                                       CLE031
     C                     MOVE 'N'       WRKPRC                                              CLE031
     C                     ELSE                                                               CLE031
      *                                                                                       CLE031
     C                     Z-ADD1         X                                                   CLE031
     C           WRKCCY    LOKUPCURR,X                   13                                   CLE031
     C                     Z-ADDCCDP,X    WKNBDP  10                                          CLE031
      *                                                                                       CLE031
     C           CIND,X    IFEQ 'Y'                                                           CLE031
     C           WRKCCY    OREQ BKEURO                                                        CLE031
     C           WRKFIN    ANDEQ'Y'                                                           CLE031
     C                     MOVE 'N'       WRKPRC                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           WRKPRC    IFEQ 'Y'                                                           CLE031
     C                     MOVE LKECCY    WRKLEC                                              CLE031
     C                     MOVE LKSCCY    WRKLSC                                              CLE031
     C                     MOVE WRKCCY    LKECCY                                              CLE031
     C                     MOVE *BLANKS   LKSCCY                                              CLE031
     C                     Z-ADDLKEAMT    WRKAMT                                              CLE031
      *                                                                                       CLE031
     C                     Z-ADDWRKEXR    ZEXCH                                               CLE031
     C                     MOVE WRKEXI    ZMD                                                 CLE031
     C                     Z-ADDWRKAMT    ZAMTCI                                              CLE031
     C                     MOVE FEFCCY    ZCCYI                                               CLE031
     C                     MOVE WRKCCY    ZCCYO                                               CLE031
     C                     Z-ADDFENBDP    ZCDPI                                               CLE031
     C                     Z-ADDWKNBDP    ZCDPO                                               CLE031
     C                     EXSR ZCONV                                                         CLE031
     C                     Z-ADDZAMTCO    SETAMT                                              CLE031
     C                     Z-ADDSETAMT    LKEAMT                                              CLE031
     C                     MOVE 'S'       LKSIND                                              CLE031
      *                                                                                       CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDSR                                                              CLE031
      *****************************************************************                       CLE031
     C/TITLE SR/SETTLE                                                                        CLE031
      *****************************************************************                       CLE031
      *                                                                                       CLE031
      *  SETTLE - SET UP NEW ACCOUNT KEYS DUE TO SETTLEMENT IN                                CLE031
      *           ANOTHER CURRENCY                                                            CLE031
      *                                                                                       CLE031
      *  CALLED FROM: GENKEY                                                                  CLE031
      *                                                                                       CLE031
      *  CALLS:                                                                               CLE031
      *                                                                                       CLE031
      *****************************************************************                       CLE031
      *                                                                                       CLE031
     C           SETTLE    BEGSR                                                              CLE031
      *                                                                                       CLE031
     C           WRKPRC    IFEQ 'Y'                                                           CLE031
     C                     MOVEAAKY       WRKAKY                                              CLE031
     C                     MOVE LKAKEY    WRKLAK                                              CLE031
     C                     MOVEAAKY       LKOKEY                                              CLE031
      *                                                                                       CLE031
      ** Set up account key.                                                                  CLE031
      *                                                                                       CLE031
     C**********           MOVE 'S'       AKY,4                                      CLE031 MD051242
     C           FELOAN    IFGT *BLANKS                                                     MD051242
     C                     MOVE 'S'       AKY,3                                             MD051242
     C                     MOVE ' '       AKY,6                                             MD051242
     C                     ELSE                                                             MD051242
     C                     MOVE 'S'       AKY,4                                             MD051242
     C                     MOVEA'  '      AKY,5                                               CLE031
     C                     ENDIF                                                            MD051242
      *                                                                                       CLE031
     C           PTFI      IFEQ 'P'                                                           CLE031
     C           PTFI      OREQ 'S'                                                           CLE106
     C           PTFI      OREQ 'R'                                                           CLE106
     C                     MOVE WRKFCY    WRKPCY                                              CLE031
     C                     MOVE WRKCCY    WRKSCY                                              CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE WRKCCY    WRKPCY                                              CLE031
     C                     MOVE WRKFCY    WRKSCY                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Format nnnSbbFffB or nnnSbbBffB for Amount in Purchase Ccy                           CLE031
      *                                                                                       CLE031
     C                     MOVE 'B'       AKY,10                                              CLE031
     C           WRKPCY    IFEQ BJCYCD                                                        CLE031
     C                     MOVE 'B'       AKY,7                                               CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE 'F'       AKY,7                                               CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           PTFI      IFEQ 'P'                                                           CLE031
     C           PTFI      OREQ 'S'                                                           CLE106
     C           PTFI      OREQ 'R'                                                           CLE106
     C                     Z-ADDWRKAMT    LKEAMT                                              CLE031
     C                     Z-ADDSETAMT    SALAMT 130                                        MD056223
     C                     ELSE                                                               CLE031
     C                     Z-ADDSETAMT    LKEAMT                                              CLE031
     C                     Z-ADDWRKAMT    SALAMT                                            MD056223
     C                     ENDIF                                                              CLE031
     C                     MOVE WRKPCY    LKECCY                                              CLE031
      *                                                                                       CLE031
     C           ATYP      IFEQ 'H'                                                           CLE031
     C           FELPDT    ANDGEBJDNWD                                                        CLE031
     C********** FEAUTO    ANDEQ'Y'                                                    250628 259030
      *                                                                                       CLE031
     C                     Z-ADDFEFSEQ    LKFSEQ                                              CLE031
     C                     WRITEPSTTOMF                                                       CLE031
     C                     ELSE                                                               CLE031
      *                                                                                       CLE031
      ** Write to account keys file                                                           CLE031
      *                                                                                       CLE031
     C                     Z-ADDSALAMT    LKOTHA                                            MD056223
     C                     MOVELWRKSCY    LKOTHC                                            MD056223
     C                     MOVEAAKY       LKAKEY                                              CLE031
     C                     WRITELKEYFEDF                                                      CLE031
     C                     EXSR PRTEVT                                                        CLE031
     C                     END                                                                CLE031
      *                                                                                       CLE031
      ** Format nnnSbbFffC or nnnSbbBffC for Amount in Sale Ccy                               CLE031
      *                                                                                       CLE031
     C                     MOVE 'C'       AKY,10                                              CLE031
     C           WRKSCY    IFEQ BJCYCD                                                        CLE031
     C                     MOVE 'B'       AKY,7                                               CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE 'F'       AKY,7                                               CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C           PTFI      IFEQ 'P'                                                           CLE031
     C           PTFI      OREQ 'S'                                                           CLE106
     C           PTFI      OREQ 'R'                                                           CLE106
     C                     Z-ADDSETAMT    LKEAMT                                              CLE031
     C                     Z-ADDWRKAMT    PURAMT 130                                        MD056223
     C                     ELSE                                                               CLE031
     C                     Z-ADDWRKAMT    LKEAMT                                              CLE031
     C                     Z-ADDSETAMT    PURAMT 130                                        MD056223
     C                     ENDIF                                                              CLE031
     C                     MOVE WRKSCY    LKECCY                                              CLE031
      *                                                                                       CLE031
     C           ATYP      IFEQ 'H'                                                           CLE031
     C           FELPDT    ANDGEBJDNWD                                                        CLE031
     C********** FEAUTO    ANDEQ'Y'                                                    250628 259030
      *                                                                                       CLE031
     C                     Z-ADDFEFSEQ    LKFSEQ                                              CLE031
     C                     WRITEPSTTOMF                                                       CLE031
     C                     ELSE                                                               CLE031
      *                                                                                       CLE031
      ** Write to account keys file                                                           CLE031
      *                                                                                       CLE031
     C                     MOVEAAKY       LKAKEY                                              CLE031
     C                     Z-ADDPURAMT    LKOTHA                                            MD056223
     C                     MOVELWRKPCY    LKOTHC                                            MD056223
     C                     WRITELKEYFEDF                                                      CLE031
     C                     EXSR PRTEVT                                                        CLE031
     C                     END                                                                CLE031
     C           GENKY     IFEQ 'Y'                                                         MD051883
     C                     MOVE AKY,7     SAV7    1                                         MD051883
     C                     MOVE AKY,10    SAV10   1                                         MD051883
     C           FCTYFL    IFEQ 'Y'                                                         MD051883
     C                     MOVE AKY,4     SAV4    1                                         MD051883
     C                     MOVE 'R'       AKY,4                                             MD051883
     C                     ELSE                                                             MD051883
     C                     MOVE AKY,3     SAV3    1                                         MD051883
     C                     MOVE 'R'       AKY,3                                             MD051883
     C                     ENDIF                                                            MD051883
     C                     MOVE ' '       AKY,7                                             MD051883
     C                     MOVE 'J'       AKY,10                                            MD051883
     C                     MOVEAAKY       LKAKEY                                            MD051883
     C                     Z-ADD0         LKOTHA                                            MD056223
     C                     MOVEL*BLANKS   LKOTHC                                            MD056223
     C                     WRITELKEYFEDF                                                    MD051883
     C                     MOVE SAV7      AKY,7                                             MD051883
     C                     MOVE SAV10     AKY,10                                            MD051883
     C           FCTYFL    IFEQ 'Y'                                                         MD051883
     C                     MOVE SAV4      AKY,4                                             MD051883
     C                     ELSE                                                             MD051883
     C                     MOVE SAV3      AKY,3                                             MD051883
     C                     ENDIF                                                            MD051883
     C                     EXSR PRTEVT                                                      MD051883
     C                     ENDIF                                                            MD051883
      *                                                                                       CLE031
     C           WRKFCY    IFEQ BJCYCD                                                        CLE031
     C                     Z-ADDWRKAMT    BASAMT                                              CLE031
     C                     ELSE                                                               CLE031
     C                     Z-ADD1         X                                                   CLE031
     C           BJCYCD    LOKUPCURR,X                   13                                   CLE031
     C                     Z-ADDCCDP,X    BANBDP  10                                          CLE031
     C                     Z-ADDWRKSPT    ZEXCH                                               CLE031
     C                     MOVE WRKMDI    ZMD                                                 CLE031
     C                     Z-ADDWRKAMT    ZAMTCI                                              CLE031
     C                     MOVE FEFCCY    ZCCYI                                               CLE031
     C                     MOVE BJCYCD    ZCCYO                                               CLE031
     C                     Z-ADDFENBDP    ZCDPI                                               CLE031
     C                     Z-ADDBANBDP    ZCDPO                                               CLE031
     C                     EXSR ZCONV                                                         CLE031
     C                     Z-ADDZAMTCO    BASAMT                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
      ** Format nnnSbbcccP for Base Currency Equivalent of Spot Trade                         CLE031
      ** Account in Purchase Currency                                                         CLE031
      *                                                                                       CLE031
      *
     C                     MOVE 'P'       AKY,10                                              CLE031
     C           FELOAN    IFGT *BLANKS                                                     MD051242
     C                     MOVEAWRKPCY    AKY,6                                             MD051242
     C                     MOVEA' '       AKY,9                                             MD051242
     C                     ELSE                                                             MD051242
     C                     MOVEAWRKPCY    AKY,5                                               CLE031
     C                     MOVEA'  '      AKY,8                                             MD051242
     C                     ENDIF                                                            MD051242
     C                     MOVE BJCYCD    LKECCY                                              CLE031
     C                     Z-ADDBASAMT    LKEAMT                                              CLE031
      *                                                                                       CLE031
     C           ATYP      IFEQ 'H'                                                           CLE031
     C           FELPDT    ANDGEBJDNWD                                                        CLE031
     C********** FEAUTO    ANDEQ'Y'                                                    250628 259030
      *                                                                                       CLE031
     C                     Z-ADDFEFSEQ    LKFSEQ                                              CLE031
     C                     WRITEPSTTOMF                                                       CLE031
     C                     ELSE                                                               CLE031
      *                                                                                       CLE031
      ** Write to account keys file                                                           CLE031
      *                                                                                       CLE031
     C                     MOVEAAKY       LKAKEY                                              CLE031
     C                     Z-ADDSALAMT    LKOTHA                                            MD056223
     C                     MOVELWRKSCY    LKOTHC                                            MD056223
     C                     WRITELKEYFEDF                                                      CLE031
     C                     EXSR PRTEVT                                                        CLE031
     C                     END                                                                CLE031
      *                                                                                       CLE031
      *                                                                                       CLE031
      ** Format nnnSbbcccS for Base Currency Equivalent of Spot Trade                         CLE031
      ** Account in Sale Currency                                                             CLE031
      *                                                                                       CLE031
     C                     MOVE 'S'       AKY,10                                              CLE031
     C           FELOAN    IFGT *BLANKS                                                     MD051242
     C                     MOVEAWRKSCY    AKY,6                                             MD051242
     C                     MOVEA' '       AKY,9                                             MD051242
     C                     ELSE                                                             MD051242
     C**********           MOVEAWRKSCY    AKY,6                                      CLE031 MD051242
     C                     MOVEAWRKSCY    AKY,5                                               CLE031
     C                     MOVEA'  '      AKY,8                                             MD051242
     C                     ENDIF                                                            MD051242
      *                                                                                       CLE031
     C           ATYP      IFEQ 'H'                                                           CLE031
     C           FELPDT    ANDGEBJDNWD                                                        CLE031
     C********** FEAUTO    ANDEQ'Y'                                                    250628 259030
      *                                                                                       CLE031
     C                     Z-ADDFEFSEQ    LKFSEQ                                              CLE031
     C                     WRITEPSTTOMF                                                       CLE031
     C                     ELSE                                                               CLE031
      *                                                                                       CLE031
      ** Write to account keys file                                                           CLE031
      *                                                                                       CLE031
     C                     MOVEAAKY       LKAKEY                                              CLE031
     C                     Z-ADDPURAMT    LKOTHA                                            MD056223
     C                     MOVELWRKPCY    LKOTHC                                            MD056223
     C                     WRITELKEYFEDF                                                      CLE031
     C                     EXSR PRTEVT                                                        CLE031
     C                     END                                                                CLE031
      *                                                                                       CLE031
     C                     MOVEAWRKAKY    AKY                                                 CLE031
     C                     MOVE WRKLAK    LKAKEY                                              CLE031
     C                     MOVE WRKLEC    LKECCY                                              CLE031
     C                     MOVE WRKLSC    LKSCCY                                              CLE031
     C                     Z-ADDWRKAMT    LKEAMT                                              CLE031
     C                     MOVE *BLANKS   LKOKEY                                              CLE031
     C                     MOVE *BLANKS   LKSIND                                              CLE031
     C                     ENDIF                                                              CLE031
     C                     Z-ADD0         LKOTHA                                            MD056223
     C                     MOVEL*BLANKS   LKOTHC                                            MD056223
      *                                                                                       CLE031
     C                     ENDSR                                                              CLE031
      *****************************************************************                       CLE031
     C/TITLE SR/PRTEVT                                                                        CLE031
      *****************************************************************                       CLE031
      *                                                                                       CLE031
      *  PRTEVT - PRINT EVENT ON PRINTER FILE                                                 CLE031
      *                                                                                       CLE031
      *  CALLED FROM: SETTLE                                                                  CLE031
      *                                                                                       CLE031
      *  CALLS:                                                                               CLE031
      *                                                                                       CLE031
      *****************************************************************                       CLE031
      *                                                                                       CLE031
     C           PRTEVT    BEGSR                                                              CLE031
      *                                                                                       CLE031
     C                     Z-ADDLKEAMT    EAMT0                                               CLE031
      *                                                                                       CLE031
      ** If overflow indicator is on output headings on new page.                             CLE031
     C           *IN80     IFEQ '1'                                                           CLE031
     C***/COPY*WNCPYSRC,LEH00993***                                                           CFC006
     C/COPY WNCPYSRC,LEH00993                                                               MD020563
     C           SUPFLG    ANDNE'Y'                                                           CFC006
     C                     WRITELER135A1                                                      CLE031
     C                     WRITELER135A2                                                      CLE031
     C                     MOVE '0'       *IN80                                               CLE031
     C                     END                                                                CLE031
      *                                                                                       CLE031
     C                     EXSR CHKCCY                                                        218992
      *                                                                                       218992
      ** Output account key generated details.                                                CLE031
     C***/COPY*WNCPYSRC,LEH00994***                                                           CFC006
     C/COPY WNCPYSRC,LEH00994                                                               MD020563
     C           SUPFLG    IFNE 'Y'                                                           CFC006
     C                     WRITELER135A3                                                      CLE031
     C***/COPY*WNCPYSRC,LEH00995***                                                           CFC006
     C/COPY WNCPYSRC,LEH00995                                                               MD020563
     C                     ENDIF                                                              CFC006
      *                                                                                       CLE031
      ** Details on print file indicator                                                      CLE031
     C                     MOVE '1'       *IN21                                               CLE031
      *                                                                                       CLE031
      ** Add event amount to hash total for trailer                                           CLE031
      *                                                                                       CLE031
     C           LKEAMT    DIV  1000      ZZAMT                                               CLE031
     C                     Z-ADD1         Z                                                   CLE031
     C                     Z-ADD1         S                                                   CLE031
     C                     Z-ADDTOTI      ZZTOTI                                              CLE031
     C                     Z-ADDTOTD      ZZTOTD                                              CLE031
     C                     EXSR ZHASH                                                         CLE031
     C                     Z-ADDZZTOTI    TOTI                                                CLE031
     C                     Z-ADDZZTOTD    TOTD                                                CLE031
      *                                                                                       CLE031
     C                     ADD  1         NKEY                                                CLE031
      *                                                                                       CLE031
     C                     ENDSR                                                              CLE031
      *                                                                                       CLE073
      *****************************************************************                       CLE073
      *                                                                                       CLE073
      *    CHKDTE - Check Loan Maturity date and principal amount                             CLE073
      *             update Next Pay date and End date equal to Loan maturity date             CLE073
      *             or to date loan amount became zero.                                       CLE073
      *                                                                                       CLE073
      *    CALLED BY: NEWCAL - Calculate Amounts for types 97, 98 and 99                      CLE073
      *    CALLS    :                                                                         CLE073
      *                                                                                       CLE073
      ********************************************************************                    CLE073
      *                                                                                       CLE073
     C           CHKDTE    BEGSR                                                              CLE073
      *                                                                                       CLE073
     C           AUENFE    IFEQ 'N'                                                         MD046370
     C           FECALT    IFEQ '97'                                                        MD046370
     C           FECALT    OREQ '98'                                                        MD046370
     C           FECALT    OREQ '99'                                                        MD046370
     C                     GOTO ENDCHK                                                      MD046370
     C                     ENDIF                                                            MD046370
     C                     ENDIF                                                            MD046370
      *                                                                                     MD046370
     C           MDATL     IFNE 0                                                             CLE073
     C           MDATL     IFLT FENPYD                                                        CLE073
     C           FENPYD    ANDGTBJRDNB                                                        CLE073
     C********** FELPDT    ANDLEMDATL                                                262735 MD046370
     C                     Z-ADDMDATL     FENPYD                                              CLE073
     C                     ENDIF
      *                                                                                       CLE073
     C           MDATL     IFLT FEPEND                                                        CLE073
     C           FEPEND    ANDGTBJRDNB                                                        CLE073
     C********** FELPDT    ANDLEMDATL                                                262735 MD046370
     C                     Z-ADDMDATL     FEPEND                                              CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** If principal amount is zero, retrieve date it became zero                            CLE073
      *                                                                                       CLE073
     C                     MOVE '0'       *IN78                                               CLE073
     C                     Z-ADD999       WLASN                                               CLE073
     C**********           Z-ADDFENPYD    WVDAT                                        CLE073 261084
     C                     Z-ADD99999     WVDAT                                               261084
     C                     Z-ADDFENPYD    NWMAT   50                                          CLE073
      *                                                                                       CLE134
      ** IF Fee calculation type is 90 then set WLOAN =                                       CLE134
      ** Past Due Call Loan                                                                   CLE134
      *                                                                                       CLE134
     C**********           MOVE WLOAN     WLONSV  60                                 CLE134 MD036064
     C                     MOVE WLOAN     WLONSV  6                                         MD036064
     C           FECALT    IFEQ '90'                                                          CLE134
     C                     MOVE YPLON     WLOAN                                               CLE134
     C                     ENDIF                                                              CLE134
     C           CPAML     IFEQ 0                                                             CLE073
     C           KEYHST    SETGTLEHISTLA                                                      CLE073
     C           KEYPHS    REDPELEHISTLA                 78                                   CLE073
     C           *IN78     DOWEQ'0'                                                           CLE073
     C           CPAMP     ANDEQ0                                                             CLE073
     C           CPAMP     IFEQ 0                                                             CLE073
     C                     Z-ADDVDATP     NWMAT                                               CLE073
     C                     MOVE 'Y'       WPAID   1                                           CLE134
     C                     ENDIF                                                              CLE073
     C           KEYPHS    REDPELEHISTLA                 78                                   CLE073
     C                     ENDDO                                                              CLE073
      *                                                                                       CLE073
     C                     MOVE WLONSV    WLOAN                                               CLE134
      *                                                                                       CLE134
     C           FECALT    IFNE '90'                                                          CLE134
     C           NWMAT     IFLT FEPEND                                                        CLE073
     C           FEPEND    ANDGTBJRDNB                                                        CLE073
     C********** FELPDT    ANDLENWMAT                                                262735 MD046370
     C                     Z-ADDNWMAT     FEPEND                                              CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE073
     C           NWMAT     IFLT FENPYD                                                        CLE073
     C           FENPYD    ANDGTBJRDNB                                                        CLE073
     C********** FELPDT    ANDLENWMAT                                                262735 MD046370
     C                     Z-ADDNWMAT     FENPYD                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                     MD046370
     C           AUENFE    IFEQ 'Y'                                                         MD046370
     C           FECALT    IFEQ '97'                                                        MD046370
     C           FECALT    OREQ '98'                                                        MD046370
     C           FECALT    OREQ '99'                                                        MD046370
      *                                                                                     MD046370
     C           FEPEND    IFLE FEPSTD                                                      MD046370
     C           FELPDT    IFGT 0                                                           MD046370
     C                     Z-ADDFELPDT    FEPEND                                            MD046370
     C                     ENDIF                                                            MD046370
     C           FELPDT    IFEQ 0                                                           MD046370
     C                     SELEC                                                            MD046370
     C           FEPSTD    WHEQ BJRDNB                                                      MD046370
     C           FEPSTD    ADD  1         FEPEND                                            MD046370
      *                                                                                     MD046370
     C           FEPSTD    WHGT BJRDNB                                                      MD046370
     C           FEPSTD    ADD  1         FEPEND                                            MD046370
      *                                                                                     MD046370
     C           FEPSTD    WHLT BJRDNB                                                      MD046370
     C           FEPSTD    ADD  1         FEPEND                                            MD046370
     C                     ENDSL                                                            MD046370
     C                     ENDIF                                                            MD046370
     C                     ENDIF                                                            MD046370
      *                                                                                     MD046370
     C           FENPYD    IFLE FEPSTD                                                      MD046370
     C           FELPDT    IFGT 0                                                           MD046370
     C                     Z-ADDFELPDT    FENPYD                                            MD046370
     C                     ENDIF                                                            MD046370
     C           FELPDT    IFEQ 0                                                           MD046370
     C                     SELEC                                                            MD046370
     C           FEPSTD    WHEQ BJRDNB                                                      MD046370
     C           FEPSTD    ADD  1         FENPYD                                            MD046370
      *                                                                                     MD046370
     C           FEPSTD    WHGT BJRDNB                                                      MD046370
     C           FEPSTD    ADD  1         FENPYD                                            MD046370
      *                                                                                     MD046370
     C           FEPSTD    WHLT BJRDNB                                                      MD046370
     C           FEPSTD    ADD  1         FENPYD                                            MD046370
     C                     ENDSL                                                            MD046370
     C                     ENDIF                                                            MD046370
     C                     ENDIF                                                            MD046370
      *                                                                                     MD046370
     C                     ENDIF                                                            MD046370
     C                     ENDIF                                                            MD046370
      *                                                                                     MD046370
     C           ENDCHK    TAG                                                              MD046370
      *                                                                                     MD046370
     C                     Z-ADD0         WVDAT                                               CLE073
     C                     Z-ADD0         VDATP                                               CLE073
     C                     Z-ADD0         CPAMP                                               CLE073
      *                                                                                       CLE073
     C                     ENDSR                                                              CLE073
      ***************************************************************                         CLE073
     C/TITLE SR/AMTACL                                                                        CLE073
      *****************************************************************                       CLE073
      *                                                                                       CLE073
      *  AMTACL - Sr to calculate Amount for Accruals for LOAN based fees                     CLE073
      *                                                                                       CLE073
      *  This subroutine is based on sr/AMTACC. Sr/AMTACC processes facility historic         CLE073
      *  file while sr/AMTACL processes Loans Files (Loans and Historic file).                CLE073
      *  In case of upgrade of this car, or in case of new fixes/changes to                   CLE073
      *  to sr/AMTACC, verify whether these are to be applied to sr/AMTACL as well.           CLE073
      *                                                                                       CLE073
      *                                                                                       CLE073
      *  CALLED FROM: AMTACC                                                                  CLE073
      *                                                                                       CLE073
      *  CALLS: HISREL, REPHDR, ACCRUL                                                        CLE073
      *                                                                                       CLE073
      *****************************************************************                       CLE073
      *                                                                                       CLE073
     C           AMTACL    BEGSR                                                              CLE073
      *                                                                                       CLE073
      ** Zeroize work fields & determine if actual amount to be used                          CLE073
      ** rather than average amount (depends on calculation type)                             CLE073
      *                                                                                       CLE073
     C                     Z-ADD0         WAMT                                                CLE073
     C                     Z-ADD0         WPCT                                                CLE073
     C                     MOVE '1'       *IN70                                               CLE073
      *                                                                                       CLE073
      ** If payment due set up start and end dates so amounts can                             CLE073
      ** be accrued correctly between these dates.                                            CLE073
      *                                                                                       CLE073
     C           ATYP      IFEQ 'H'                                                           CLE073
      *                                                                                       CLE073
      ** If CLE005 is on and last payment date is not zero, call                              CLE073
      ** SR/RECALC.                                                                           CLE073
      *                                                                                       CLE073
     C           CLE005    IFEQ 'Y'                                                           CLE073
     C           FELPDT    ANDNE0                                                             CLE073
     C           FEINDC    ANDNE'Y'                                                           CLE073
     C           WFLAG     IFEQ *BLANK                                                        CLE073
     C           WFLAG     OREQ 'Y'                                                           CLE073
     C           FELPDT    ANDLEFEPEND                                                        CLE073
     C           FENPYD    ANDEQ0                                                             CLE073
     C           WFLAG     OREQ 'Y'                                                           CLE073
     C           FELPDT    ANDLEFENPYD                                                        CLE073
     C           FENPYD    ANDNE0                                                             CLE073
     C                     EXSR RECALL                                                        CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
     C                     Z-ADDFEAMTO    W#AMTO                                            MD052216
     C                     ADD  WLOANA    W#AMTO                                            MD055069
      *                                                                                       CLE073
     C                     Z-ADDFELPDT    STDATE         19                                   CLE073
     C   19                Z-ADDFEPSTD    STDATE                                              CLE073
     C                     Z-ADDFENPYD    ENDATE         19                                   CLE073
     C   19                Z-ADDFEPEND    ENDATE                                              CLE073
      *                                                                                       CLE073
      ** If fee period end less than or equal to next working day                             CLE073
      ** make it the work end date.                                                           CLE073
      *                                                                                       CLE073
     C           FEPEND    IFLE BJDNWD                                                        CLE073
     C           FEPEND    ANDLTFENPYD                                                        CLE073
     C                     Z-ADDFEPEND    ENDATE                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** - daily accrual processing                                                           CLE073
      *                                                                                       CLE073
     C                     ELSE                                                               CLE073
      *                                                                                       CLE073
      ***  Set up start date and end date to accrue between.                                  CLE073
      *                                                                                       CLE073
     C                     Z-ADDCODT      ENDATE                                              CLE073
      *                                                                                       CLE073
      ** If payment processing is to be done today, make sure the                             CLE073
      ** accrual period to be calculated will not exceed the payment                          CLE073
      ** date.                                                                                CLE073
      *                                                                                       CLE073
     C           @CHKD     IFEQ 'Y'                                                           CLE073
     C           CODT      IFGT FENPYD                                                        CLE073
     C           FENPYD    ANDNE0                                                             CLE073
     C                     Z-ADDFENPYD    ENDATE                                              CLE073
     C                     ELSE                                                               CLE073
     C           CODT      IFGT FEPEND                                                        CLE073
     C                     Z-ADDFEPEND    ENDATE                                              CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** If CLE005 is on, start date should always be setup to                                CLE073
      ** Fee Period Start Date.                                                               CLE073
      *                                                                                       CLE073
     C           CLE005    IFEQ 'Y'                                                           CLE073
     C           FEINDC    ANDNE'Y'                                                           CLE073
     C           FECALT    ANDNE'99'                                                          CLE073
     C           FECALT    ANDNE'90'                                                          CLE134
     C                     Z-ADDFEPSTD    STDATE                                              CLE073
     C                     ELSE                                                               CLE073
      *                                                                                       CLE073
     C                     Z-ADDFELPDT    STDATE                                              CLE073
     C           STDATE    IFEQ 0                                                             CLE073
     C                     Z-ADDFEPSTD    STDATE                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     Z-ADDSTDATE    WSTDTE  50                                          CLE073
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** If CLE005 is on, save value of STDATE.                                               CLE073
      *                                                                                       CLE073
     C           CLE005    IFEQ 'Y'                                                           CLE073
     C                     Z-ADDSTDATE    STRDTE  50                                          CLE073
     C                     ENDIF                                                              CLE073
     C*                                                                                       CLE073
     C                     Z-ADDSTDATE    STRDT1  50                                          CLE073
     C*                                                                                       CLE073
      *                                                                                       CLE073
      ** Get starting amount from CLOANCK  if type 98, from fees file if 99                   CLE073
      ** and from historical loan file if 97                                                  CLE073
      *                                                                                       CLE073
     C           FECALT    IFEQ '99'                                                          CLE073
     C           FECALT    OREQ '90'                                                          CLE134
     C                     Z-ADDFEFAMT    CFAMT                                               CLE073
     C                     Z-ADDFEFAMT    AAMT                                                CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Type 98: Loan Original Amount                                                        CLE073
      *                                                                                       CLE073
     C           FECALT    IFEQ '98'                                                          CLE073
     C                     Z-ADDOPAMK     CFAMT                                               CLE073
     C                     Z-ADDOPAMK     AAMT                                                CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C           FECALT    IFEQ '97'                        B* CALCT 97                       CLE073
     C                     Z-ADDSTDATE    WVDAT                                               CLE073
     C                     Z-ADDOPAMK     CFAMT                                               CLE073
     C                     Z-ADDOPAMK     AAMT                                                CLE073
     C                     Z-ADD999       WLASN   30                                          CLE073
     C           KEYHST    SETGTLEHISTLA                                                      CLE073
     C           KEYPHS    REDPELEHISTLA                 18                                   CLE073
     C           *IN18     IFEQ *OFF                                                          CLE073
     C                     Z-ADDCPAMP     CFAMT                                               CLE073
     C                     Z-ADDCPAMP     AAMT                                                CLE073
     C                     ELSE                                                               CLE073
     C                     Z-ADD001       WLASN   30                                          CLE073
     C           KEYHST    SETLLLEHISTLA                 18                                   CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Initialise work fee field.                                                           CLE073
      *                                                                                       CLE073
     C                     Z-ADDWFEE      WFEE1  130                                          CLE073
     C                     Z-ADD0         WFEE                                                CLE073
     C           FELPDT    IFGT FEPEND                                                        CLE073
     C           FENPYD    ANDEQ0                                                             CLE073
     C           FELPDT    ORGT FENPYD                                                        CLE073
     C           FENPYD    ANDNE0                                                             CLE073
     C           ATYP      IFEQ 'H'                                                           CLE073
     C                     Z-ADDWFEE1     WFEE                                                CLE073
     C                     ELSE                                                               CLE073
     C                     Z-ADDFELPAM    WLPAM  130                                          CLE073
     C                     Z-ADDFEAMTP    FELPAM                                              CLE073
     C                     Z-ADDWLPAM     FEAMTP                                              CLE073
     C                     Z-ADDWLPAM     FEAMTO                                              CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** For payment processing (i.e., final correct accrual figures)                         CLE073
      ** read through history to calculate amount.                                            CLE073
      *                                                                                       CLE073
     C           ATYP      IFEQ 'H'                                         B1                CLE073
      *                                                                                       CLE073
     C                     MOVE ACOFL     FHACOF                                              CLE073
     C                     MOVE CCYL      FHFCCY                                              CLE073
     C                     Z-ADD0         FHOFAM                                              CLE073
     C                     EXSR REPHDR                                                        CLE073
      *                                                                                       CLE073
     C                     EXSR HISREL                                                        CLE073
      *                                                                                       CLE073
     C                     ELSE                                             X1                CLE073
      *                                                                                       CLE073
     C***  Don't do start date of fee for last day accruals                                   CLE073
      *                                                                                       CLE073
     C           FEPSTD    IFLT CODT                                       B2                 CLE073
     C           BKALDI    ANDEQ'Y'                                                           CLE073
     C           BKALDI    ORNE 'Y'                                                           CLE073
      *                                                                                     MD031473
     C           CLE005    IFEQ 'Y'                                                         MD031473
     C           FEINDC    ANDNE'Y'                                                         MD031473
     C           FECALT    ANDNE'90'                                                        MD031473
     C           FECALT    ANDNE'99'                                                        MD031473
     C           CLE071    OREQ 'Y'                                                           CLE071
     C           FEINDC    ANDNE'Y'                                                           CLE071
     C           FECALT    ANDNE'90'                                                          CLE071
     C           FECALT    ANDNE'99'                                                          CLE071
     C                     EXSR AMTAL2                                                      MD031473
     C                     ELSE                                                             MD031473
      *                                                                                       CLE073
      ** Read file until date read is greater than date of end of                             CLE073
      ** this accrual period.  This processing can be done more                               CLE073
      ** than once for actual type calculations so it is necessary                            CLE073
      ** to reset VDATP  each time.   NDAYS is the number of                                  CLE073
      ** number of days in this accrual.                                                      CLE073
      *                                                                                       CLE073
     C                     MOVE '0'       *IN28                                               CLE073
     C                     MOVE '0'       *IN18                                               CLE073
     C           *IN18     DOWEQ'0'                                         B* DO             CLE073
     C           FECALT    IFEQ '97'                                                          CLE073
     C           KEYPHS    READELEHISTLA                 18                                   CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C           FECALT    IFNE '97'                                                          CLE073
     C                     MOVE '1'       *IN18                                               CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C           *IN18     IFEQ '1'                                                           CLE073
     C           VDATP     ORGT ENDATE                                                        CLE073
     C           BKALDI    ANDNE'Y'                                                           CLE073
     C           VDATP     ORGE ENDATE                                                        CLE073
     C           BKALDI    ANDEQ'Y'                                                           CLE073
     C                     Z-ADDENDATE    VDATP                                               CLE073
     C                     MOVE '1'       *IN18                                               CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     Z-ADDSTDATE    ZZBEG                                               CLE073
     C           VDATP     IFGT STDATE                                                        CLE073
     C                     Z-ADDVDATP     ZZEND                                               CLE073
     C                     ELSE                                                               CLE073
     C                     Z-ADDSTDATE    ZZEND                                               CLE073
     C                     ENDIF                                                              CLE073
     C                     MOVE FECALC    ZZCALC                                              CLE073
     C**********           EXSR ZINTDY                                               CLE073 MD054703
     C********** FECALC    IFEQ 6                                                    CLE073 MD054703
     C**********           Z-ADDINT6DY    NDAYS                                      CLE073 MD054703
     C**********           ELSE                                                      CLE073 MD054703
     C**********           Z-ADDZZINDY    NDAYS                                      CLE073 MD054703
     C**********           ENDIF                                                     CLE073 MD054703
      *                                                                                       CLE073
      ** Check if CLE005 is on.                                                               CLE073
      *                                                                                       CLE073
     C           CLE005    IFEQ 'Y'                                                           CLE073
     C           FEINDC    ANDNE'Y'                                                           CLE073
     C           BKALDI    IFNE 'Y'                                                           CLE073
     C           FEPSTD    ANDEQSTRDTE                                                        CLE073
     C           VDATP     ANDEQENDATE                                                        CLE073
     C           FEPEND    ANDGTCODT                                                          CLE073
     C           *IN18     ANDEQ'1'                                                           CLE073
     C**********           ADD  1         NDAYS                                      CLE073 MD054703
     C                     ADD  1         ZZEND                                             MD054703
     C                     ENDIF                                                              CLE073
     C                     ELSE                                                               CLE073
      *                                                                                       CLE073
     C           BKALDI    IFNE 'Y'                                                           CLE073
     C           FEPSTD    ANDEQWSTDTE                                                        CLE073
     C           VDATP     ANDEQENDATE                                                        CLE073
     C           FEPEND    ANDGTCODT                                                          CLE073
     C           *IN18     ANDEQ'1'                                                           CLE073
     C**********           ADD  1         NDAYS                                      CLE073 MD054703
     C                     ADD  1         ZZEND                                             MD054703
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** If Start date is equal to Last Payment Date add 1 day.                               CLE073
      *                                                                                       CLE073
     C           BKALDI    IFNE 'Y'                                                           CLE073
     C           FELPDT    ANDNE0                                                             CLE073
     C           FELPDT    ANDEQSTRDT1                                                        CLE073
     C           VDATP     ANDEQENDATE                                                        CLE073
     C           FEPEND    ANDGTCODT                                                          CLE073
     C           *IN18     ANDEQ'1'                                                           CLE073
     C**********           ADD  1         NDAYS                                      CLE073 MD054703
     C                     ADD  1         ZZEND                                             MD054703
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     EXSR ZINTDY                                                      MD054703
     C           FECALC    IFEQ 6                                                           MD054703
     C                     Z-ADDINT6DY    NDAYS                                             MD054703
     C                     ELSE                                                             MD054703
     C                     Z-ADDZZINDY    NDAYS                                             MD054703
     C                     ENDIF                                                            MD054703
      *                                                                                     MD054703
     C           NDAYS     IFGT 0                                                             CLE073
      *                                                                                       CLE073
     C           FEORED    IFEQ BJRDNB                                                        CLE073
     C           FEPSTD    ANDLTMSTD                                                          CLE073
     C           *IN28     ANDEQ'0'                                                           CLE073
      *                                                                                       CLE073
     C                     Z-ADDNDAYS     WDAYS2                                              CLE073
      *                                                                                       CLE073
     C           VDATP     IFGT MSTD                                                          CLE073
      *                                                                                       CLE073
     C           VDATP     SUB  MSTD      DIFF    50                                          CLE073
     C           DIFF      ADD  1         DIFF                                                CLE073
     C           WDAYS2    SUB  DIFF      WDAYS2                                              CLE073
     C                     MOVE '1'       *IN28                                               CLE073
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     Z-ADDWDAYS2    WDAYS                                               CLE073
     C                     Z-ADDAAMT      WAMT                                                CLE073
     C                     EXSR ACCRUL                                                        CLE073
     C                     ADD  WTOT      WAGG2  130                                          CLE073
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     Z-ADDNDAYS     WDAYS                                               CLE073
     C                     Z-ADDAAMT      WAMT                                                CLE073
     C                     EXSR ACCRUL                                                        CLE073
     C                     ADD  WTOT      WFEE                                                CLE073
     C           VDATP     IFGT STDATE                                                        CLE073
     C                     Z-ADDVDATP     STDATE                                              CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Reset amount to accrue - comes from next record on amounts                           CLE073
      ** file.                                                                                CLE073
      *                                                                                       CLE073
     C                     Z-ADDCPAMP     CFAMT                                               CLE073
     C                     Z-ADDCPAMP     AAMT                                                CLE073
     C                     ENDDO                                                              CLE073
      *                                                                                       CLE073
     C                     ENDIF                                                            MD031473
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C           WFEE      SUB  FEAMTS    WDIFF2                                            AR634880
     C                     SUB  FEAMTP    WDIFF2                                            AR634880
     C                     ADD  FETADJ    WDIFF2                                            AR634880
     C                     ADD  FEAMTA    WDIFF2                                            AR634880
     C                     SUB  FEWOFF    WDIFF2                                            AR634880
     C                     SUB  FEAMTW    WDIFF2                                            AR634880
     C                     SUB  FELPAM    WDIFF2                                            AR634880
     C           ATYP      IFEQ ' '                                                         AR634880
     C           FEAMTS    ANDGT0                                                           AR634880
     C           FECALT    ANDEQ'97'                                                        AR634880
     C           WDIFF2    ANDNE0                                                           AR634880
      *                                                                                     AR634880
     C           WKPDCL    CHAINLEFADJL0             51                                     AR634880
     C           *IN51     IFEQ '1'                                                         AR634880
     C           WDIFF2    IFEQ 1                                                           AR634880
     C           WDIFF2    OREQ -1                                                          AR634880
     C                     MOVELFELOAN    ADLOAN                                            AR634880
     C                     MOVE FECNUM    ADCNUM                                            AR634880
     C                     Z-ADDFEFACL    ADFACL                                            AR634880
     C                     Z-ADDFEFSEQ    ADFSEQ                                            AR634880
     C                     MOVE FEBRCA    ADBRCA                                            AR634880
     C                     Z-ADDFEORED    ADORED                                            AR634880
     C                     Z-ADDWDIFF2    ADDIFF                                            AR634880
     C                     WRITELEFADJD0                                                    AR634880
     C           WDIFF2    IFEQ 1                                                           AR634880
     C                     SUB  1         WFEE                                              AR634880
     C                     ELSE                                                             AR634880
     C                     ADD  1         WFEE                                              AR634880
     C                     ENDIF                                                            AR634880
     C                     ENDIF                                                            AR634880
     C                     ELSE                                                             AR634880
     C           ADORED    IFEQ FEORED                                                      AR634880
     C           ADDIFF    IFEQ 1                                                           AR634880
     C                     SUB  1         WFEE                                              AR634880
     C                     ELSE                                                             AR634880
     C                     ADD  1         WFEE                                              AR634880
     C                     ENDIF                                                            AR634880
     C                     ELSE                                                             AR634880
     C                     DELETLEFADJD0                                                    AR634880
     C                     ENDIF                                                            AR634880
     C                     ENDIF                                                            AR634880
     C                     ENDIF                                                            AR634880
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Check the flag before the write of the end of fee message                            CLE073
      *                                                                                       CLE073
     C           FLAGR     IFEQ 'Y'                                                           CLE073
     C***/COPY*WNCPYSRC,LEH01059***                                                           CFC006
     C/COPY WNCPYSRC,LEH01059                                                               MD020563
     C           SUPFL2    IFNE 'Y'                                                           CFC006
     C                     WRITELER135B9                                                      CLE073
     C***/COPY*WNCPYSRC,LEH01060***                                                           CFC006
     C/COPY WNCPYSRC,LEH01060                                                               MD020563
     C                     ENDIF                                                              CFC006
      *                                                                                       CLE073
      ** and reset the flag after                                                             CLE073
      *                                                                                       CLE073
     C                     MOVE ' '       FLAGR                                               CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     ENDSR                                                              CLE073
      *                                                                                     MD031473
      *****************************************************************                     MD031473
     C/TITLE SR/AMTAL2                                                                      MD031473
      *****************************************************************                     MD031473
      *                                                                                     MD031473
      *  AMTAL2 - SUBROUTINE TO CALCULATE AMOUNT FOR ACCRUALS                               MD031473
      *                                                                                     MD031473
      *  CALLED FROM: AMTACL                                                                MD031473
      *                                                                                     MD031473
      *  CALLS: AMTAL3                                                                      MD031473
      *                                                                                     MD031473
      *****************************************************************                     MD031473
      *                                                                                     MD031473
     C           AMTAL2    BEGSR                                                            MD031473
      *                                                                                     MD031473
      ** Note that this SR is called with CLE005 on and FEINDC *NE 'Y'.                     MD031473
      *                                                                                     MD031473
      ** Processing when CLE071 is Disabled                                                   CLE071
      *                                                                                       CLE071
     C           CLE071    IFEQ 'N'                                                           CLE071
      *                                                                                       CLE071
      ** Move rates and amounts from LEFEED to working arrays.                              MD031473
      *                                                                                     MD031473
     C                     Z-ADDFAMT      @WAMT                                             MD031473
     C                     Z-ADDFRT       @WRT                                              MD031473
      *                                                                                     MD031473
      ** Read LEFHST to get the right rates and amounts for                                 MD031473
      ** for specific fee period.                                                           MD031473
      *                                                                                     MD031473
     C           LELKEY    SETLLLEFHSTLA                                                    MD031473
     C           LELKEY    READELEFHSTLA            N    27                                 MD031473
     C           *IN27     IFEQ '0'                                                         MD031473
     C           *IN27     DOWEQ'0'                                                         MD031473
      *                                                                                     MD031473
      ** Move rates and amounts from historical file to FAMT & FRT.                         MD031473
      *                                                                                     MD031473
     C                     Z-ADD@HLAMT    FAMT                                              MD031473
     C                     Z-ADD@HLRT     FRT                                               MD031473
     C                     Z-ADDLOHDAT    ENDATE                                            MD031473
      *                                                                                     MD031473
     C                     Z-ADDSTDATE    WVDAT                                             MD031473
     C           KEYHST    SETGTLEHISTLA                                                    MD031473
     C           KEYPHS    REDPELEHISTLA                 20                                 MD031473
      *                                                                                     MD031473
     C                     EXSR AMTAL3                                                      MD031473
     C                     Z-ADDENDATE    STDATE                                            MD031473
     C           LELKEY    READELEFHSTLA            N    27                                 MD031473
     C                     ENDDO                                                            MD031473
      *                                                                                     MD031473
      ** Move rates and amounts from working arrays back to FAMT & FRT.                     MD031473
      *                                                                                     MD031473
     C                     Z-ADD@WAMT     FAMT                                              MD031473
     C                     Z-ADD@WRT      FRT                                               MD031473
      *                                                                                     MD031473
     C           *IN27     IFEQ '1'                                                         MD031473
     C           CODT      ANDGTENDATE                                                      MD031473
     C                     Z-ADDCODT      ENDATE                                            MD031473
      *                                                                                     MD031473
     C           @CHKD     IFEQ 'Y'                                                         MD031473
     C           CODT      IFGT FEPEND                                                      MD031473
     C                     Z-ADDFEPEND    ENDATE                                            MD031473
     C                     ELSE                                                             MD031473
     C           ATYP      IFEQ 'H'                                                         MD031473
     C           FENPYD    ANDLTCODT                                                        MD031473
     C           FENPYD    ANDNE0                                                           MD031473
     C                     Z-ADDFENPYD    ENDATE                                            MD031473
     C                     ENDIF                                                            MD031473
     C                     ENDIF                                                            MD031473
     C                     ENDIF                                                            MD031473
      *                                                                                     MD031473
     C                     Z-ADDSTDATE    WVDAT                                             MD031473
     C           KEYHST    SETGTLEHISTLA                                                    MD031473
     C           KEYPHS    REDPELEHISTLA                 20                                 MD031473
     C                     EXSR AMTAL3                                                      MD031473
     C                     ENDIF                                                            MD031473
      *                                                                                     MD031473
     C                     ELSE                                                             MD031473
     C***                  Z-ADDCODT      ENDATE                                            MD031473
      *                                                                                     MD031473
     C           @CHKD     IFEQ 'Y'                                                         MD031473
     C           CODT      IFGT FEPEND                                                      MD031473
     C                     Z-ADDFEPEND    ENDATE                                            MD031473
     C                     ELSE                                                             MD031473
     C           ATYP      IFEQ 'H'                                                         MD031473
     C           FENPYD    ANDLTCODT                                                        MD031473
     C           FENPYD    ANDGT0                                                           MD031473
     C                     Z-ADDFENPYD    ENDATE                                            MD031473
     C                     ENDIF                                                            MD031473
     C                     ENDIF                                                            MD031473
     C                     ENDIF                                                            MD031473
      *                                                                                     MD031473
     C                     Z-ADDSTDATE    WVDAT                                             MD031473
     C           KEYHST    SETGTLEHISTLA                                                    MD031473
     C           KEYPHS    REDPELEHISTLA                 20                                 MD031473
     C                     EXSR AMTAL3                                                      MD031473
     C                     ENDIF                                                            MD031473
      *                                                                                     MD031473
     C                     ELSE                                                               CLE071
      *                                                                                       CLE071
      ** Processing when CLE071 is Enabled                                                    CLE071
      *                                                                                       CLE071
      ** Move rates and amounts from LEFEED to working arrays.                                CLE071
      *                                                                                       CLE071
     C                     Z-ADDFAMT      @WAMT                                               CLE071
     C                     Z-ADDFRT       @WRT                                                CLE071
      *                                                                                       CLE071
     C           LFKEY2    SETGTLEFHSTFB                                                      CLE071
     C           LFKEY3    REDPELEFHSTFB                 27                                   CLE071
     C                     Z-ADD@HAMT     FAMT                                                CLE071
     C                     Z-ADD@HRT      FRT                                                 CLE071
     C           LFKEY3    READELEFHSTFB                 27                                   CLE071
      *                                                                                       CLE071
     C           *IN27     IFEQ '0'                                                           CLE071
      *                                                                                       CLE071
     C           *IN27     DOWEQ'0'                                                           CLE071
     C                     Z-ADDHIRCVD    ENDATE                                              CLE071
     C                     Z-ADDSTDATE    WVDAT                                               CLE071
     C           KEYHST    SETGTLEHISTLA                                                      CLE071
     C           KEYPHS    REDPELEHISTLA                 20                                   CLE071
      *                                                                                       CLE071
     C           HIRCTP    IFEQ 'RC'                                                          CLE071
     C                     MOVE 'RD'      RCACT                                               CLE071
     C                     Z-ADDHIRCVD    RCDAT                                               CLE071
     C                     ELSE                                                               CLE071
     C                     MOVE *BLANKS   RCACT                                               CLE071
     C                     Z-ADD*ZEROS    RCDAT                                               CLE071
     C                     ENDIF                                                              CLE071
      *                                                                                       CLE071
     C                     EXSR AMTAL3                                                        CLE071
     C                     MOVELENDATE    STDATE                                              CLE071
     C                     MOVEL@HAMT     FAMT                                                CLE071
     C                     MOVEL@HRT      FRT                                                 CLE071
     C           LFKEY3    READELEFHSTFB                 27                                   CLE071
     C                     ENDDO                                                              CLE071
      *                                                                                       CLE071
     C           ATYP      IFEQ 'H'                                                           CLE071
     C                     Z-ADDFENPYD    ENDATE         19                                   CLE071
     C   19                Z-ADDFEPEND    ENDATE                                              CLE071
     C           FEPEND    IFLE BJDNWD                                                        CLE071
     C                     Z-ADDFEPEND    ENDATE                                              CLE071
     C                     END                                                                CLE071
      *                                                                                       CLE071
     C           ENDATE    IFGE STDATE                                                        CLE071
     C           KEYHST    SETGTLEHISTLA                                                      CLE071
     C           KEYPHS    REDPELEHISTLA                 20                                   CLE071
     C                     EXSR AMTAL3                                                        CLE071
     C                     ENDIF                                                              CLE071
      *                                                                                       CLE071
     C                     ELSE                                                               CLE071
     C           CODT      IFGE STDATE                                                        CLE071
     C                     MOVELCODT      ENDATE                                              CLE071
     C           KEYHST    SETGTLEHISTLA                                                      CLE071
     C           KEYPHS    REDPELEHISTLA                 20                                   CLE071
     C                     EXSR AMTAL3                                                        CLE071
     C                     ENDIF                                                              CLE071
     C                     ENDIF                                                              CLE071
      *                                                                                       CLE071
     C                     MOVEL@WAMT     FAMT                                                CLE071
     C                     MOVEL@WRT      FRT                                                 CLE071
      *                                                                                       CLE071
     C                     ELSE                                                               CLE071
      *                                                                                       CLE071
     C           ATYP      IFEQ 'H'                                                           CLE071
     C                     Z-ADDFENPYD    ENDATE         19                                   CLE071
     C   19                Z-ADDFEPEND    ENDATE                                              CLE071
     C           FEPEND    IFLE BJDNWD                                                        CLE071
     C                     Z-ADDFEPEND    ENDATE                                              CLE071
     C                     END                                                                CLE071
      *                                                                                       CLE071
     C           ENDATE    IFGE STDATE                                                        CLE071
     C           KEYHST    SETGTLEHISTLA                                                      CLE071
     C           KEYPHS    REDPELEHISTLA                 20                                   CLE071
     C                     EXSR AMTAL3                                                        CLE071
     C                     ENDIF                                                              CLE071
      *                                                                                       CLE071
     C                     ELSE                                                               CLE071
      *                                                                                       CLE071
     C           CODT      IFGE STDATE                                                        CLE071
     C                     MOVELCODT      ENDATE                                              CLE071
     C           KEYHST    SETGTLEHISTLA                                                      CLE071
     C           KEYPHS    REDPELEHISTLA                 20                                   CLE071
     C                     EXSR AMTAL3                                                        CLE071
     C                     ENDIF                                                              CLE071
     C                     ENDIF                                                              CLE071
     C                     ENDIF                                                              CLE071
     C                     ENDIF                                                              CLE071
      *                                                                                       CLE071
     C                     ENDSR                                                            MD031473
      *                                                                                     MD031473
      *****************************************************************                     MD031473
     C/TITLE SR/AMTAL3                                                                      MD031473
      *****************************************************************                     MD031473
      *                                                                                     MD031473
      *  AMTAL3 - SUBROUTINE TO CALCULATE AMOUNT FOR ACCRUALS                               MD031473
      *                                                                                     MD031473
      *  CALLED FROM: AMTAL2                                                                MD031473
      *                                                                                     MD031473
      *  CALLS: ACCRUL                                                                      MD031473
      *                                                                                     MD031473
      *****************************************************************                     MD031473
      *                                                                                     MD031473
     C           AMTAL3    BEGSR                                                            MD031473
      *                                                                                     MD031473
     C           FECALT    IFEQ '98'                                                        MD031473
     C                     Z-ADDOPAMK     CFAMT                                             MD031473
     C                     Z-ADDOPAMK     AAMT                                              MD031473
     C                     ENDIF                                                            MD031473
      *                                                                                     MD031473
     C           FECALT    IFEQ '97'                        B* CALCT 97                     MD031473
     C                     Z-ADDOPAMK     CFAMT                                             MD031473
     C                     Z-ADDOPAMK     AAMT                                              MD031473
     C           *IN20     IFEQ *OFF                                                        MD031473
     C                     Z-ADDCPAMP     CFAMT                                             MD031473
     C                     Z-ADDCPAMP     AAMT                                              MD031473
     C                     ELSE                                                             MD031473
     C                     Z-ADD001       WLASN                                             MD031473
     C           KEYHST    SETLLLEHISTLA                 20                                 MD031473
     C                     ENDIF                                                            MD031473
     C                     ENDIF                                                            MD031473
      *                                                                                     MD031473
      ** Read file until date read is greater than date of end of                           MD031473
      ** this accrual period.                                                               MD031473
      *                                                                                     MD031473
     C                     MOVE '0'       *IN20                                             MD031473
     C                     Z-ADDSTDATE    WVDAT                                             MD031473
     C           *IN20     DOWEQ'0'                                                         MD031473
     C           FECALT    IFEQ '97'                                                        MD031473
     C**                   Z-ADDSTDATE    WVDAT                                             MD031473
     C           KEYPHS    READELEHISTLA                 20                                 MD031473
     C                     ENDIF                                                            MD031473
      *                                                                                     MD031473
     C           FECALT    IFNE '97'                                                        MD031473
     C                     MOVE '1'       *IN20                                             MD031473
     C                     ENDIF                                                            MD031473
      *                                                                                     MD031473
     C           *IN20     IFEQ '1'                                                         MD031473
     C           VDATP     ORGT ENDATE                                                      MD031473
     C           BKALDI    ANDNE'Y'                                                         MD031473
     C           VDATP     ORGE ENDATE                                                      MD031473
     C           BKALDI    ANDEQ'Y'                                                         MD031473
     C                     Z-ADDENDATE    VDATP                                             MD031473
     C                     MOVE '1'       *IN20                                             MD031473
     C                     ENDIF                                                            MD031473
      *                                                                                       CLE071
     C  N20                Z-ADDVDATP     FDAT1                                               CLE071
     C  N20                MOVELAMTPP     ACT1                                                CLE071
     C           RCDAT     IFLE VDATP                                                         CLE071
     C           RCACT     ANDEQ'RD'                                                          CLE071
     C                     Z-ADDRCDAT     FDAT1                                               CLE071
     C                     MOVELRCACT     ACT1                                                CLE071
     C                     ENDIF                                                              CLE071
      *                                                                                     MD031473
      ** Fee Calculation Basis should be considered when computing                          MD031473
      ** for the no. of days to be accrued.                                                 MD031473
      *                                                                                     MD031473
     C                     Z-ADD0         ZZINDY                                            MD031473
     C                     Z-ADDVDATP     ZZEND                                             MD031473
     C                     Z-ADDSTDATE    ZZBEG                                             MD031473
     C                     MOVE FECALC    ZZCALC                                            MD031473
     C**********           EXSR ZINTDY                                             MD031473 MD054703
     C********** FECALC    IFEQ 6                                                  MD031473 MD054703
     C**********           Z-ADDINT6DY    NDAYS                                    MD031473 MD054703
     C**********           ELSE                                                    MD031473 MD054703
     C**********           Z-ADDZZINDY    NDAYS                                    MD031473 MD054703
     C**********           END                                                     MD031473 MD054703
      *                                                                                     MD031473
      ** Add 1 day if first day accrual.                                                    MD031473
      *                                                                                     MD031473
     C           BKALDI    IFNE 'Y'                                                         MD031473
     C           FEPSTD    ANDEQSTRDTE                                                      MD031473
     C           VDATP     ANDEQENDATE                                                      MD031473
     C           CODT      ANDEQENDATE                                                      MD031473
     C           FEPEND    ANDGTCODT                                                        MD031473
     C           *IN20     ANDEQ'1'                                                         MD031473
     C**********           ADD  1         NDAYS                                    MD031473 MD054703
     C                     ADD  1         ZZEND                                             MD054703
     C                     ENDIF                                                            MD031473
      *                                                                                     MD031473
     C                     EXSR ZINTDY                                                      MD054703
     C           FECALC    IFEQ 6                                                           MD054703
     C                     Z-ADDINT6DY    NDAYS                                             MD054703
     C                     ELSE                                                             MD054703
     C                     Z-ADDZZINDY    NDAYS                                             MD054703
     C                     END                                                              MD054703
      *                                                                                     MD054703
     C           NDAYS     IFGT 0                                                           MD031473
     C           FEORED    IFEQ BJRDNB                                                      MD031473
     C           FEPSTD    ANDLTMSTD                                                        MD031473
      *                                                                                     MD031473
      ** Only perform calculation if not called from HISREL                                   CLE071
      *                                                                                       CLE071
     C           FLAGR     IFEQ ' '                                                           CLE071
     C                     Z-ADDNDAYS     WDAYS2 159                                        MD031473
     C           VDATP     IFGT MSTD                                                        MD031473
     C           VDATP     SUB  MSTD      DIFF    50                                        MD031473
     C           DIFF      ADD  1         DIFF                                              MD031473
     C           WDAYS2    SUB  DIFF      WDAYS2                                            MD031473
     C                     MOVE '1'       *IN28                                             MD031473
     C                     ENDIF                                                            MD031473
      *                                                                                     MD031473
     C                     Z-ADDWDAYS2    WDAYS                                             MD031473
     C                     Z-ADDAAMT      WAMT                                              MD031473
     C                     EXSR ACCRUL                                                      MD031473
     C                     ADD  WTOT      WAGG2  130                                        MD031473
     C                     ENDIF                                                              CLE071
     C                     ENDIF                                                            MD031473
      *                                                                                     MD031473
     C           FLAGR     IFEQ 'Y'                                                           CLE071
     C                     Z-ADD0         RPT                                                 CLE071
     C                     EXSR REPDTL                                                        CLE071
     C           ACT1      LOKUPTABACC    TABACN         26                                   CLE071
     C                     MOVELTABACN    ACTN                                                CLE071
     C                     Z-ADDFDAT1     @FDATE                                              CLE071
     C                     MOVELACT1      @FACTN                                              CLE071
      *                                                                                       CLE071
     C           ACT1      IFEQ 'RD'                                                          CLE071
     C                     MOVE *BLANKS   RCACT                                               CLE071
     C                     Z-ADD0         RCDAT                                               CLE071
     C                     ENDIF                                                              CLE071
      *                                                                                       CLE071
     C                     ENDIF                                                              CLE071
      *                                                                                       CLE071
     C                     Z-ADDNDAYS     WDAYS                                             MD031473
     C                     Z-ADDAAMT      WAMT                                              MD031473
     C                     EXSR ACCRUL                                                      MD031473
     C                     ADD  WTOT      WFEE                                              MD031473
     C                     Z-ADDVDATP     STDATE                                            MD031473
     C                     ENDIF                                                            MD031473
      *                                                                                     MD031473
      ** Reset amount to accrue - comes from next record on amounts                         MD031473
      ** file.                                                                              MD031473
      *                                                                                     MD031473
     C           FECALT    IFEQ '97'                        B* CALCT 97                     MD031473
     C                     Z-ADDOPAMK     CFAMT                                             MD031473
     C                     Z-ADDOPAMK     AAMT                                              MD031473
     C           *IN20     IFEQ *OFF                                                        MD031473
     C                     Z-ADDCPAMP     CFAMT                                             MD031473
     C                     Z-ADDCPAMP     AAMT                                              MD031473
     C                     ELSE                                                             MD031473
     C                     Z-ADD001       WLASN                                             MD031473
     C                     ENDIF                                                            MD031473
     C                     ENDIF                                                            MD031473
      *                                                                                     MD031473
     C                     ENDDO                                                            MD031473
      *                                                                                     MD031473
     C                     ENDSR                                                            MD031473
      *                                                                                       CLE073
      ***************************************************************                         CLE073
     C/TITLE SR/HISREL                                                                        CLE073
      ********************************************************************                    CLE073
      *                                                                                       CLE073
      *  HISREL - Subroutine to calculate amounts for Payments Due.                           CLE073
      *                                                                                       CLE073
      *  This subroutine is based on sr/HISRED.                                               CLE073
      *  In case of upgrade of this car, or in case of new fixes/changes to                   CLE073
      *  to sr/HISRED, verify whether these are to be applied to sr/HISREL as well.           CLE073
      *  CALLED FROM: AMTACL                                                                  CLE073
      *                                                                                       CLE073
      *  CALLS: REPDTL, ACCRUL                                                                CLE073
      *                                                                                       CLE073
      *****************************************************************                       CLE073
      *                                                                                       CLE073
     C           HISREL    BEGSR                                                              CLE073
      *                                                                                       CLE073
      ** Set the flag on to show that a fee has been processed                                CLE073
      *                                                                                       CLE073
     C                     MOVE 'Y'       FLAGR   1                                           CLE073
      *                                                                                       CLE073
      ** Output dummy line to print fee start.                                                CLE073
      *                                                                                       CLE073
     C                     Z-ADD5         RPT                                                 CLE073
     C                     EXSR REPDTL                                                        CLE073
      *                                                                                       CLE071
     C           CLE071    IFEQ 'Y'                                                           CLE071
     C           FECALT    ANDNE'90'                                                          CLE071
     C           FECALT    ANDNE'99'                                                          CLE071
     C                     Z-ADDFENPYD    ENDATE         19                                   CLE071
     C   19                Z-ADDFEPEND    ENDATE                                              CLE071
     C           FEPEND    IFLE BJDNWD                                                        CLE071
     C                     Z-ADDFEPEND    ENDATE                                              CLE071
     C                     END                                                                CLE071
     C                     EXSR AMTAL2                                                        CLE071
     C                     ELSE                                                               CLE071
      *                                                                                       CLE073
      ** Read file until date read is greater than date of end of                             CLE073
      ** this accrual period.  This processing can be done more                               CLE073
      ** than once for actual type calculations so it is necessary                            CLE073
      ** to reset VDATP  each time.   NDAYS is the number of                                  CLE073
      ** number of days in this accrual.                                                      CLE073
      *                                                                                       CLE073
     C                     MOVE '0'       *IN18                                               CLE073
     C           *IN18     DOWEQ'0'                                                           CLE073
     C           FECALT    IFEQ '97'                                                          CLE073
     C           KEYPHS    READELEHISTLA                 18                                   CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C           FECALT    IFNE '97'                                                          CLE073
     C                     MOVE *ON       *IN18                                               CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C           *IN18     IFEQ '1'                                                           CLE073
     C           VDATP     ORGT ENDATE                                                        CLE073
     C                     Z-ADDENDATE    VDATP                                               CLE073
     C                     MOVE 'PY'      FAACTN                                              CLE073
     C                     MOVE '1'       *IN18                                               CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     Z-ADDSTDATE    ZZBEG                                               CLE073
     C           VDATP     IFGT STDATE                                                        CLE073
     C                     Z-ADDVDATP     ZZEND                                               CLE073
     C                     ELSE                                                               CLE073
     C                     Z-ADDSTDATE    ZZEND                                               CLE073
     C                     ENDIF                                                              CLE073
     C                     MOVE FECALC    ZZCALC                                              CLE073
     C                     EXSR ZINTDY                                                        CLE073
     C           FECALC    IFEQ 6                                                             CLE073
     C                     Z-ADDINT6DY    NDAYS                                               CLE073
     C                     ELSE                                                               CLE073
     C                     Z-ADDZZINDY    NDAYS                                               CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C           NDAYS     IFGT 0                                                             CLE073
      *                                                                                       CLE073
     C                     Z-ADD0         RPT                                                 CLE073
     C                     EXSR REPDTL                                                        CLE073
     C                     Z-ADDNDAYS     WDAYS                                               CLE073
     C                     Z-ADDAAMT      WAMT                                                CLE073
     C                     EXSR ACCRUL                                                        CLE073
     C                     ADD  WTOT      WFEE                                                CLE073
     C           VDATP     IFGT STDATE                                                        CLE073
     C                     Z-ADDVDATP     STDATE                                              CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Reset amount to accrue - comes from next record on amounts                           CLE073
      ** file.                                                                                CLE073
      *                                                                                       CLE073
     C                     Z-ADDCPAMP     CFAMT                                               CLE073
     C                     Z-ADDCPAMP     AAMT                                                CLE073
     C                     Z-ADDVDATP     @FDATE  50                                          CLE073
     C                     MOVELAMTPP     @FACTN  2                                           CLE073
      *                                                                                       CLE073
     C                     ENDDO                                                              CLE073
     C                     ENDIF                                                              CLE071
      *                                                                                       CLE073
      ** Print the fee due date and payment narrative.                                        CLE073
      *                                                                                       CLE073
     C                     Z-ADD6         RPT                                                 CLE073
     C                     EXSR REPDTL                                                        CLE073
      *                                                                                       CLE073
      ** If actual was used output additional line for total fee.                             CLE073
      *                                                                                       CLE073
     C                     Z-ADD4         RPT                                                 CLE073
     C                     EXSR REPDTL                                                        CLE073
      *                                                                                       CLE073
      ** Print warning message if average calculation, percentage                             CLE073
      ** used and facility amount changed during calculation period.                          CLE073
      *                                                                                       CLE073
     C           *IN75     IFEQ '1'                                                           CLE073
     C***/COPY*WNCPYSRC,LEH01061***                                                           CFC006
     C/COPY WNCPYSRC,LEH01061                                                               MD020563
     C           SUPFL2    ANDNE'Y'                                                           CFC006
     C                     WRITELER135B8                                                      CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     ENDSR                                                              CLE073
      *                                                                                       CLE073
      *                                                                                       CLE073
      *****************************************************************                       CLE073
      /TITLE SR/ACCRUL                                                                        CLE073
      *****************************************************************                       CLE073
      *                                                                                       CLE073
      *  ACCRUL - Sr to calculate ACcrual Amount                                              CLE073
      *                                                                                       CLE073
      *  This subroutine is based on sr/ACCRUE.                                               CLE073
      *  In case of upgrade of this car, or in case of new fixes/changes to                   CLE073
      *  to sr/ACCRUE, verify whether these are to be applied to sr/ACCRUL as well.           CLE073
      *  CALLED FROM:                                                                         CLE073
      *                                                                                       CLE073
      *  CALLS: ZXRATE, ZCONV, LSTRAT, AOCURRR0                                               CLE073
      *                                                                                       CLE073
      *****************************************************************                       CLE073
      *                                                                                       CLE073
     C           ACCRUL    BEGSR                                                              CLE073
      *                                                                                       CLE073
     C********** CLE134    IFEQ 'Y'                                                  CLE134 MD020212
     C********** FECALT    ANDEQ'99'                                                 CLE134 MD020212
     C**********           Z-ADD1         WDAYS                                      CLE134 MD020212
     C**********           ENDIF                                                     CLE134 MD020212
     C                     Z-ADD0         WRK15                                               CLE073
     C                     Z-ADD0         WTOTRP                                              CLE073
     C                     Z-ADD0         WTOT                                                CLE073
     C                     MOVE '0'       *IN73                                               CLE073
     C           WAMT      IFNE 0                                            B* AMNT          CLE073
      *                                                                                       CLE073
      ** Convert from Loan ccy to fee currency if required.                                   CLE073
      ** If exchange rate field on fees master file is blank                                  CLE073
      ** obtain cross-currency exchange rate for these                                        CLE073
      ** two currencies from the standing data files otherwise use                            CLE073
      ** exchange rate on fees master file.                                                   CLE073
      *                                                                                       CLE073
     C           CCYP      IFNE FEFCCY                                                        CLE073
     C           FECALT    ANDNE'99'                                                        MD047474
     C                     Z-ADDWAMT      CAMT   130                                          CLE073
     C           FEERAT    IFEQ 0                                                             CLE073
     C                     MOVE CCYP      INCCY   3                                           CLE073
     C                     MOVE FEFCCY    OUTCCY  3                                           CLE073
     C                     Z-ADD1         X                                                   CLE073
     C           INCCY     LOKUPCURR,X                   13                                   CLE073
     C           *IN13     IFEQ '1'                                                           CLE073
     C                     MOVE MTDV,X    ZMDI1   1                                           CLE073
     C                     Z-ADDCSPT,X    ZRATE1 138                                          CLE073
     C                     Z-ADDCCDP,X    ZNBDP1  10                                          CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     Z-ADD1         X                                                   CLE073
     C           OUTCCY    LOKUPCURR,X                   14                                   CLE073
     C           *IN14     IFEQ '1'                                                           CLE073
     C                     MOVE MTDV,X    ZMDI2   1                                           CLE073
     C                     Z-ADDCSPT,X    ZRATE2 138                                          CLE073
     C                     Z-ADDCCDP,X    ZNBDP2  10                                          CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Obtain cross exchange rate & cross multiply/divide indicator.                        CLE073
      *                                                                                       CLE073
     C                     EXSR ZXRATE                                                        CLE073
      *                                                                                       CLE073
      ** Set up input fields for conversion subroutine.                                       CLE073
      *                                                                                       CLE073
     C                     Z-ADDZRATEX    ZEXCH  138                                          CLE073
     C                     MOVE ZMDIX     ZMD     1                                           CLE073
     C                     Z-ADDCAMT      ZAMTCI 150                                          CLE073
     C                     MOVE INCCY     ZCCYI   3                                           CLE073
     C                     MOVE OUTCCY    ZCCYO   3                                           CLE073
     C                     Z-ADDZNBDP1    ZCDPI   10                                          CLE073
     C                     Z-ADDZNBDP2    ZCDPO   10                                          CLE073
      *                                                                                       CLE073
     C                     EXSR ZCONV                                                         CLE073
      *                                                                                       CLE073
     C                     Z-ADDZAMTCO    CAMT                                                CLE073
      *                                                                                       CLE073
      ** Exchange rate not blank                                                              CLE073
      *                                                                                       CLE073
     C                     ELSE                                                               CLE073
      *                                                                                       CLE073
      ** Set up currency decimal place power position.                                        CLE073
      *                                                                                       CLE073
     C           CDP       ADD  4         FD      10                                          CLE073
      *                                                                                       CLE073
      ** Fee currency decimal places + 1.                                                     CLE073
      *                                                                                       CLE073
     C                     Z-ADDP         TD      10                                          CLE073
      *                                                                                       CLE073
      ** Adjust incoming amount for from CCY decimal places.                                  CLE073
      *                                                                                       CLE073
     C           CAMT      DIV  POWER,FD  WRK153                                              CLE073
      *                                                                                       CLE073
      ** Exchange rate conversion.                                                            CLE073
      *                                                                                       CLE073
     C           FEMDIN    IFEQ 'M'                                                           CLE073
     C                     MULT FEERAT    WRK153                                              CLE073
     C                     ELSE                                                               CLE073
     C                     DIV  FEERAT    WRK153    H                                         CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Adjust calculated amount for to currency decimal places.                             CLE073
      *                                                                                       CLE073
     C           WRK153    MULT POWER,TD  CAMT                                                CLE073
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
     C                     Z-ADDCAMT      WAMT                                                CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Look up factor for division corresponding to calc. basis                             CLE073
      *                                                                                       CLE073
     C                     MOVE '0'       *IN25                                               CLE073
     C           FECALC    LOKUPTABCAL    TABCBS         25                                   CLE073
     C                     MOVE TABCBS    WCBS    50                                          CLE073
      *                                                                                       CLE073
      ** Apply rate                                                                           CLE073
      *                                                                                       CLE073
     C           FECALT    IFEQ '97'                                                          CLE073
     C           FECALT    OREQ '98'                                                          CLE073
     C           WAMT      IFGT 0                                                             CLE073
     C           FRT,1     ANDGT0                                                             CLE073
     C           WAMT      MULT FRT,1     WRK15                                               CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C           FECALT    IFEQ '99'                                                          CLE073
     C           FECALT    OREQ '90'                                                          CLE134
     C                     Z-ADDWAMT      WRK15                                               CLE073
     C                     Z-ADDFELPDT    ZZBEG          19                                   CLE073
     C   19                Z-ADDFEPSTD    ZZBEG                                               CLE073
     C                     Z-ADDFENPYD    ZZEND   50                                          CLE073
     C           ENDATE    IFLT BJRDNB                                                        CLE073
     C           ENDATE    ANDEQFELPDT                                                        CLE073
     C                     Z-ADDFEPEND    ZZEND                                               CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Obtain number of days to use.                                                        CLE073
      *                                                                                       CLE073
     C                     MOVE FECALC    ZZCALC                                              CLE073
     C                     EXSR ZINTDY                                                        CLE073
     C********** CLE134    IFEQ 'Y'                                               AR1078443 MD020212
     C********** FECALT    ANDEQ'99'                                              AR1078443 MD020212
     C**********           Z-ADD1         ZZINDY                                  AR1078443 MD020212
     C**********           Z-ADD1         WDAYS9                                  AR1078443 MD020212
     C**********           ENDIF                                                  AR1078443 MD020212
     C           FECALC    IFEQ 6                                                             CLE073
     C                     Z-ADDINT6DY    WDAYS9                                              CLE073
     C                     ELSE                                                               CLE073
     C**********           Z-ADDZZINDY    WDAYS9  50                                 CLE073 MD031473
     C                     Z-ADDZZINDY    WDAYS9 159                                        MD031473
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Calculate final accrual amount.                                                      CLE073
      *                                                                                       CLE073
     C********** WRK15     MULT WDAYS     WTOTRP                                     CLE073 MD046351
     C********** WRK15     MULT WDAYS     WTOT                                       CLE073 MD046351
      **********                                                                     CLE073 MD046351
     C********** FECALT    IFNE '99'                                                 CLE073 MD046351
     C********** FECALT    ANDNE'90'                                                 CLE134 MD046351
     C**********           DIV  WCBS      WTOTRP    H                                CLE073 MD046351
     C**********           DIV  WCBS      WTOT      H                                CLE073 MD046351
     C**********           ELSE                                                      CLE073 MD046351
     C**********           DIV  WDAYS9    WTOTRP    H                                CLE073 MD046351
     C**********           DIV  WDAYS9    WTOT      H                                CLE073 MD046351
     C**********           ENDIF                                                     CLE073 MD046351
      *                                                                                     MD046351
     C           WRK15     MULT WDAYS     ZWK309                                            MD046351
     C           FECALT    IFNE '99'                                                        MD046351
     C           FECALT    ANDNE'90'                                                        MD046351
     C                     DIV  WCBS      ZWK309    H                                       MD046351
     C                     ELSE                                                             MD046351
     C                     DIV  WDAYS9    ZWK309    H                                       MD046351
     C                     ENDIF                                                            MD046351
     C                     Z-ADDZWK309    WTOTRP    H                                       MD046351
     C                     Z-ADDZWK309    WTOT      H                                       MD046351
      *                                                                                       CLE073
     C           ATYP      IFEQ 'H'                                                           CLE073
     C           FRT,1     ANDNE0                                                             CLE073
     C           ATYP      OREQ 'H'                                                           CLE073
     C           FAM,1     ANDNE0                                                             CLE073
     C                     Z-ADDFRT,1     RATE                                                CLE073
     C                     Z-ADDWTOTRP    WTOT0                                               CLE073
     C                     Z-ADD2         RPT                                                 CLE073
     C                     EXSR REPDTL                                                        CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C           ATYP      IFEQ 'H'                                                           CLE073
     C                     Z-ADD3         RPT                                                 CLE073
     C                     EXSR REPDTL                                                        CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE134
      ** IF Original Loan is not linked to a PDCL,                                            CLE134
      ** then do not accrue fee 90                                                            CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FECALT    IFEQ '90'                                                          CLE134
     C           WFLATE    ANDNE'Y'                                                           CLE134
     C           WPAID     ANDNE'Y'                                                           CLE134
     C                     Z-ADD0         WTOT                                                CLE134
     C                     Z-ADD0         WTOTRP                                              CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE073
     C                     ENDSR                                                              CLE073
      *                                                                                       CLE073
      *****************************************************************                       CLE073
     C/TITLE SR/GENKYL                                                                        CLE073
      *****************************************************************                       CLE073
      *                                                                                       CLE073
      *  GENKYL - SR to generate account keys for loan based fees                             CLE073
      *                                                                                       CLE073
      *  This subroutine is based on sr/GENKEY.                                               CLE073
      *  In case of upgrade of this car, or in case of new fixes/cha nges to                  CLE073
      *  to sr/GENKEY, verify whether these are to be applied to sr/GENKYL as well.           CLE073
      *                                                                                       CLE073
      *  CALLED FROM:  GENKEY                                                                 CLE073
      *                                                                                       CLE073
      *  CALLS:  ZSFILE, AOBRCHR0, ZHASH                                                      CLE073
      *                                                                                       CLE073
      *****************************************************************                       CLE073
      *                                                                                       CLE073
     C           GENKYL    BEGSR                                                              CLE073
     C                     MOVEL'Y'       GENKY                                             MD051883
     C                     MOVEL'N'       FCTYFL                                            MD051883
      *                                                                                       CLE073
      ** Ignore if key amount zero.                                                           CLE073
      *                                                                                       CLE073
      ** For write-off settlement skip processing of zeroising LKEAMT.                      AR738130
      *                                                                                     AR738130
     C           *IN15     IFEQ '0'                                                         AR738130
     C           FATYPE    ANDEQ'W'                                                         AR738130
     C                     ELSE                                                             AR738130
     C           ATYP      IFNE 'H'                                                           CLE073
     C           *IN61     ANDEQ*OFF                                                          CLE073
     C           FENPYD    ANDLEBJRDNB                                                        CLE073
     C           FEELS     ANDEQ' '                                                         AR317401
     C                     Z-ADD0         LKEAMT                                              CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                            AR738130
      *                                                                                     AR738130
     C           LKEAMT    IFNE 0                                                             CLE073
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C                     MOVE FEFSFA    LKSFA                                               CLE134
     C                     MOVE WATYPE    LKTYPE                                              CLE134
     C                     Z-ADD*ZEROS    LKAAMT                                              CLE134
     C                     MOVE FECNUM    LKCNU2                                              CLE134
     C                     MOVE FELOAN    LKLOAN                                              CLE134
     C                     MOVE FEFACL    LKFACL                                              CLE134
     C                     MOVE FEFCOD    LKFCOD                                              CLE134
     C                     MOVE FEBRCA    LKFBRC                                              CLE134
     C                     MOVE *BLANKS   LKIPFL                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE073
      ** Set up account key.                                                                  CLE073
      *                                                                                       CLE073
     C                     MOVE 'L'       LKRECI                                              CLE073
     C**********           Z-ADDFELOAN    LKLNNO                                       CLE073 CLE148
     C                     MOVELFELOAN    LKLNNO                                              CLE148
     C           *IN61     IFEQ '1'                                                           CLE073
     C           FECAPI    IFEQ 'Y'                                                           CLE139
     C                     MOVE 'C'       AKY,3                                               CLE139
     C                     ELSE                                                               CLE139
     C                     MOVE 'R'       AKY,3                                               CLE073
     C                     ENDIF                                                              CLE139
     C           FECALT    IFEQ '99'                                                          CLE073
     C           FECALT    OREQ '98'                                                          CLE073
     C           FECALT    OREQ '97'                                                          CLE073
     C           FECALT    OREQ '90'                                                          CLE134
     C           MSFLAG    IFNE 'Y'                                                           CLE073
     C                     Z-ADD0         FELPAM                                              CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
     C           FECALT    IFEQ '99'                                                          CLE073
     C           FECALT    OREQ '90'                                                          CLE134
     C           MSFLAG    IFEQ 'Y'                                                           CLE073
     C           FATYPE    ANDEQ'F'                                                           CLE073
     C                     ADD  FEAMTW    FEWOFF                                              CLE073
     C                     Z-ADD0         FEAMTW                                              CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
     C                     ELSE                                                               CLE073
     C                     MOVE 'A'       AKY,3                                               CLE073
     C                     ENDIF                                                              CLE073
     C                     MOVEAFELTYP    AKY,1                                               CLE073
     C                     MOVEAFESUTP    AKY,4                                               CLE073
     C                     MOVEAWFCOD     AKY,8                                               CLE073
     C                     MOVE 'F'       AKY,10                                              CLE073
     C                     MOVE ' '       AKY,6                                               CLE073
      *                                                                                       CLE073
      ** POS 7 of account keys                                                                CLE073
      *                                                                                       CLE073
     C           RCSIL     IFEQ 'R'                                                           CLE073
     C           RCSIL     OREQ 'Y'                                                           CLE073
     C                     MOVE 'R'       AKY,7                                               CLE073
     C                     ELSE                                                               CLE073
     C                     MOVE ' '       AKY,7                                               CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                     AR745249
      ** Add the Loan Class to the account key                                              AR745249
      *                                                                                     AR745249
     C                     MOVEAFECLAS    AKY,11                                            AR745249
      *                                                                                       CLE073
     C                     MOVEAAKY       LKAKEY                                              CLE073
     C                     MOVE FECNUM    LKCNUM                                              CLE073
     C                     MOVE FEFCCY    LKECCY                                              CLE073
      *                                                                                       CLE073
      ** If CLE005 is off, perform previous processing for                                    CLE073
      ** settlement details.                                                                  CLE073
      *                                                                                       CLE134
     C                     MOVE FEAUTO    WFEAUT                                              CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           WFEAUT    IFEQ 'C'                                                           CLE134
     C           FEAUT2    OREQ 'C'                                                           CLE134
     C                     MOVE 'Y'       WFEAUT                                              CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
      *                                                                                       CLE073
     C           CLE005    IFNE 'Y'                                                           CLE073
      *                                                                                       CLE073
     C           *IN61     IFEQ '1'                                                           CLE073
     C********** FEAUTO    ANDNE'Y'                                                    CLE073 CLE134
     C           WFEAUT    ANDNE'Y'                                                           CLE134
      *                                                                                       CLE134
     C           *IN61     OREQ '1'                                                           CLE134
     C           WFEAUT    ANDEQ'Y'                                                           CLE134
     C           FSETAC    ANDEQ'Y'                                                           CLE134
     C           WSTYPE    ANDEQ'ADJ'                                                       AR699396
     C                     MOVELFAOURS    LKOSAC                                              CLE073
     C                     Z-ADDFAMETH    LKSETP                                              CLE073
     C                     ELSE                                                               CLE073
     C                     MOVELFEOURS    LKOSAC                                              CLE073
     C                     Z-ADDFESTTL    LKSETP                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       261128
      ** Set up workfield                                                                     261128
      *                                                                                       261128
     C           *IN61     IFEQ '1'                                                           261128
     C           MSFLAG    ANDEQ'Y'                                                           261128
     C                     MOVE 'Y'       FEESET                                              261128
     C                     ELSE                                                               261128
     C                     MOVE ' '       FEESET                                              261128
     C                     ENDIF                                                              261128
      *                                                                                       CLE073
      ** If CLE005 is on and Manual settlement flag is 'Y'.                                   CLE073
      *                                                                                       CLE073
     C           CLE005    IFEQ 'Y'                                                           CLE073
     C           MSFLAG    ANDEQ'Y'                                                           CLE073
     C                     Z-ADDFAVDAT    LKEDAT                                              CLE073
     C                     MOVE ' '       MSFLAG                                              CLE073
     C                     ELSE                                                               CLE073
     C                     Z-ADDCODT      LKEDAT                                              CLE073
     C           ENDATE    IFLT CODT                                                        AR823503
     C                     Z-ADDENDATE    LKEDAT                                            AR823503
     C                     ENDIF                                                            AR823503
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      *                                                                                       CLE073
     C                     MOVE BRCAL     LKBRCD                                              CLE073
      *                                                                                       CLE073
      ** If CLE005 is off, perform previous processing for                                    CLE073
      ** settlement details.                                                                  CLE073
      *                                                                                       CLE073
     C           CLE005    IFNE 'Y'                                                           CLE073
      *                                                                                       CLE073
     C           *IN61     IFEQ '1'                                                           CLE073
      *                                                                                       CLE073
      ** Ensure correct settlement branch output for settlement.                              CLE073
      *                                                                                       CLE073
     C********** FEAUTO    IFNE 'Y'                                                    CLE073 CLE134
     C           WFEAUT    IFNE 'Y'                                                           CLE134
     C                     MOVE FAOSBR    LKOSBR                                              CLE073
     C                     ELSE                                                               CLE073
     C           FEOSBR    IFNE *BLANKS                                                       CLE073
     C                     MOVE FEOSBR    LKOSBR                                              CLE073
     C                     ELSE                                                               CLE073
     C                     MOVE FEBRCA    LKOSBR                                              CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
     C*                                                                                       CLE073
     C                     ELSE                                                               CLE073
     C                     MOVE *BLANKS   LKOSBR                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
     C**********           Z-ADD*ZEROS    LKACSQ                                     CLE073 AR800866
      *                                                                                     AR800866
      ** Calculated loan fees should also have account sequence no.                         AR800866
      *                                                                                     AR800866
     C           *LOVAL    SETLLCLOAN                                                       AR800866
     C           WLNKEY    CHAINCLOAN               N01                                     AR800866
     C           *IN01     IFEQ '0'                                                         AR800866
     C                     Z-ADDTPLASQ    LKACSQ                                            AR800866
     C                     ENDIF                                                            AR800866
      *                                                                                       CLE073
      ** Set up amount for output                                                             CLE073
      *                                                                                       CLE073
      ** If the settlement currency is entered and the amount is not                          CLE073
      ** zero, fill in the settlement currency.                                               CLE073
      *                                                                                       CLE073
     C           CEU004    IFEQ 'Y'                                                           CLE073
     C           FESCCY    ANDNE'   '                                                         CLE073
     C           FESCCY    ANDNEFEFCCY                                                        CLE073
     C           LKEAMT    ANDNE0                                                             CLE073
     C                     MOVE FESCCY    LKSCCY                                              CLE073
     C                     ENDIF                                                              CLE073
     C                     Z-ADDLKEAMT    EAMT0                                               CLE073
      *                                                                                       CLE073
      ** If CLE005 is on and *IN61 is on, setup settlement details.                           CLE073
      *                                                                                       CLE073
     C           CLE005    IFEQ 'Y'                                                           CLE073
     C           *IN61     ANDEQ'1'                                                           CLE073
      *                                                                                       CLE073
     C********** FEAUTO    IFNE 'Y'                                                    CLE073 CLE134
     C           WFEAUT    IFNE 'Y'                                                           CLE134
      *                                                                                       CLE134
     C           WFEAUT    OREQ 'Y'                                                           CLE134
     C           FSETAC    ANDEQ'Y'                                                           CLE134
     C           WSTYPE    ANDEQ'ADJ'                                                       AR699396
     C                     MOVELFAOURS    LKOSAC                                              CLE073
     C                     Z-ADDFAMETH    LKSETP                                              CLE073
     C                     MOVE FAOSBR    LKOSBR                                              CLE073
     C                     ELSE                                                               CLE073
     C           CLE004    IFEQ 'Y'                                                           CLE073
     C           CLE004    OREQ 'N'                                                           CLE073
     C           PTFI      ANDEQ' '                                                           CLE073
     C                     MOVE OSDB      LKOSBR                                              CLE073
     C                     MOVE RONS      LKOSAC                                              CLE073
     C                     MOVE RSTM      LKSETP                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C           CLE004    IFEQ 'Y'                                                           CLE073
     C           PTFI      ANDEQ'P'                                                           CLE073
     C                     MOVE OMDB      LKOSBR                                              CLE073
     C                     MOVE PONS      LKOSAC                                              CLE073
     C                     MOVE PSTM      LKSETP                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C           CLE004    IFEQ 'Y'                                                           CLE073
     C           PTFI      ANDEQ'I'                                                           CLE073
     C                     MOVE *BLANK    LKOSBR                                              CLE073
     C                     MOVE *BLANK    LKOSAC                                              CLE073
     C                     MOVE *BLANK    LKSETP                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C           BGN0ST    IFEQ 'Y'                                                           CLE073
     C           BKPRCU    OREQ 'Y'                                                         AR995302
     C                     MOVE FEPRFC    LKPRFC                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Setup start date or last interest date variable (LKSLID).                            CLE073
      *                                                                                       CLE073
     C                     Z-ADDFEPSTD    LKSLID                                              CLE073
      *                                                                                     MD046080
     C           CLE031    IFEQ 'Y'                                                         MD046080
     C           *IN61     ANDEQ'1'                                                         MD046080
     C                     EXSR SETCCY                                                      MD046080
     C                     ENDIF                                                            MD046080
      *                                                                                       CLE073
      ** Payment processing, therefore posting should be processed                            CLE073
      ** tomorrow                                                                             CLE073
      *                                                                                       CLE073
     C           ATYP      IFEQ 'H'                                                           CLE073
     C           FELPDT    ANDGEBJDNWD                                                        CLE073
     C           FEESET    ANDEQ' '                                                           261128
      *                                                                                       CLE073
      ** But put settlement straight to LKEYFED                                               CLE073
      *                                                                                       CLE073
      ** If Fee Last Payment Date equal to Fee End Date and Accrue                            CLE073
      ** on Last Day indicator is not equal to 'Y', subtract one                              CLE073
      ** to get the correct event date.                                                       CLE073
      *                                                                                       CLE073
     C           FELPDT    IFEQ FEPEND                                                        CLE073
     C           BKALDI    ANDNE'Y'                                                           CLE073
     C           BJDNWD    SUB  1         LKEDAT                                              CLE073
     C                     ELSE                                                               CLE073
     C                     Z-ADDBJDNWD    LKEDAT                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     Z-ADDFEFSEQ    LKFSEQ                                              CLE073
      *                                                                                       CLE134
      ** If CLE134 is On and a/ck is repayment (event R) and FEAUTO                           CLE134
      ** is C or CLE134 is On and a/c key is repayment and FEAUTO                             CLE134
      ** = 'Y' and fee is a suspense fee, then output to LEPTKDP                              CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           AKY,3     ANDEQ'R'                                                           CLE134
     C           FEAUTO    ANDEQ'C'                                                           CLE134
     C           CLE134    OREQ 'Y'                                                           CLE134
     C           AKY,3     ANDEQ'R'                                                           CLE134
     C           FEAUT2    ANDEQ'C'                                                           CLE134
      *                                                                                       CLE134
      ** Suspended fee                                                                        CLE134
      *                                                                                       CLE134
     C           CLE134    OREQ 'Y'                                                           CLE134
     C           AKY,3     ANDEQ'R'                                                           CLE134
     C           FEAUTO    ANDNE'N'                                                           CLE134
     C           FEFSFA    ANDEQ'Y'                                                           CLE134
     C                     WRITELKEYFTDF                                                      CLE134
     C                     ELSE                                                               CLE134
     C                     WRITEPSTTOMF                                                       CLE073
     C                     ENDIF                                                              CLE134
     C                     ELSE                                                               CLE073
      *                                                                                       CLE073
     C           ATYP      IFEQ 'H'                                                           CLE073
     C           FELPDT    ANDLTBJDNWD                                                        CLE073
     C           FEESET    ANDEQ' '                                                         AR640738
     C           *IN61     OREQ '1'                                                           CLE073
     C           FELPDT    ANDLTBJDNWD                                                        CLE073
     C           FELPDT    ANDLECODT                                                          CLE073
     C           FEESET    ANDEQ' '                                                         AR640738
     C                     Z-ADDFELPDT    LKEDAT                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Write to account keys file                                                           CLE073
      *                                                                                       CLE073
      ** If auto-settle is 'C' (funds pre-check) or is Y and fee is                           CLE134
      ** allowed to be suspended, then output to new account keys file                        CLE134
      *                                                                                       CLE134
     C                     MOVE 'N'       WNEWF                                               CLE134
      *                                                                                       CLE134
     C           FEAUTO    IFEQ 'C'                                                           CLE134
     C           AKY,3     ANDEQ'R'                                                           CLE134
     C           FECALT    ANDNE'90'                                                          CLE134
      *                                                                                       CLE134
     C           FEAUT2    OREQ 'C'                                                           CLE134
     C           AKY,3     ANDEQ'R'                                                           CLE134
     C           FECALT    ANDNE'90'                                                          CLE134
      *                                                                                       CLE134
      ** Fee allowed to be suspended                                                          CLE134
      *                                                                                       CLE134
     C           FEAUTO    ORNE 'N'                                                           CLE134
     C           AKY,3     ANDEQ'R'                                                           CLE134
     C           FEFSFA    ANDEQ'Y'                                                           CLE134
     C           FECALT    ANDNE'90'                                                          CLE134
      *                                                                                       CLE134
     C                     MOVE 'Y'       WNEWF                                               CLE134
     C           LKRECI    IFEQ 'L'                                                           CLE134
     C**********           MOVE LKLNNO    KLNNO   60                                 CLE134 AR997862
     C                     MOVE LKLNNO    KLNNO                                             AR997862
     C                     ELSE                                                               CLE134
     C                     CLEARKLNNO                                                         CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
      ** Retrieve sett account and priority                                                   CLE134
      *                                                                                       CLE134
     C                     Z-ADDFEFACL    WFACL                                               CLE134
     C                     Z-ADDFEFCOD    WFACOD  20                                          CLE134
     C                     CALL 'LE000458'                                                    CLE134
     C                     PARM *BLANKS   RETCOD  7                                           CLE134
     C                     PARM           LKAKEY                                              CLE134
     C                     PARM           LKECCY                                              CLE134
     C                     PARM           KLNNO                                               CLE134
     C                     PARM           FECNUM                                              CLE134
     C                     PARM           FELOAN                                              CLE134
     C                     PARM           WFACL                                               CLE134
     C                     PARM           FEFSEQ                                              CLE134
     C                     PARM           WFACOD                                              CLE134
     C                     PARM           LKSCCY                                              CLE134
     C                     PARM           LKOSAC                                              CLE134
     C                     PARM           LKSETP                                              CLE134
     C                     PARM           LKOLNO                                              CLE134
     C                     PARM           LKOSBR                                              CLE134
      *                                                                                       CLE134
     C                     PARM *BLANKS   SEBRCA                                              CLE134
     C                     PARM *BLANKS   SECNUM                                              CLE134
     C                     PARM *BLANKS   SEACCY                                              CLE134
     C                     PARM *ZEROS    SEACOD                                              CLE134
     C                     PARM *ZEROS    SEACSQ                                              CLE134
     C**********           PARM *ZEROS    SEPCKO                                       CLE134 CLE164
     C                     PARM *BLANKS   OATYP   1                                         AR741212
     C                     Z-ADDFEFSEQ    LKFSE2                                              CLE134
     C           RETCOD    IFEQ '*ERROR'                                                      CLE134
     C           *LOCK     IN   LDA                                                           CLE134
     C                     MOVEL'LE000458'DBPGM                                               CLE134
     C                     MOVEL'111'     DBASE                                               CLE134
     C                     MOVE *BLANKS   DBKEY                                               CLE134
     C                     OUT  LDA                                                           CLE134
     C                     EXSR *PSSR                                                         CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                     AR217562
     C                     MOVE 'Y'       WACCNT  1                                         AR217562
     C           SEBRCA    IFEQ *BLANKS                                                     AR217562
     C           SECNUM    OREQ *BLANKS                                                     AR217562
     C           SEACCY    OREQ *BLANKS                                                     AR217562
     C           SEACOD    OREQ 0                                                           AR217562
     C           SEACSQ    OREQ 0                                                           AR217562
     C           OATYP     OREQ 'N'                                                         AR741212
     C                     MOVE 'N'       WNEWF                                             AR741212
     C                     MOVE 'N'       WACCNT                                            AR217562
     C                     ENDIF                                                            AR217562
      *                                                                                     AR217562
      ** Set fields                                                                           CLE134
      *                                                                                       CLE134
     C                     MOVEL*BLANKS   SECATC                                              CLE164
     C           FECALT    IFNE '90'                                                          CLE134
     C           FELOAN    IFEQ *ZEROS                                                        CLE134
     C**********           Z-ADD500       SEPCKM                                       CLE134 CLE164
     C**********           Z-ADD500       SEPCKT                                       263074 CLE164
     C           WSTYPE    IFEQ 'ADJ'                                                         CLE164
     C                     MOVEL'FFEM'    SECATC                                              CLE164
     C                     ELSE                                                               CLE164
     C                     MOVEL'FFEE'    SECATC                                              CLE164
     C                     ENDIF                                                              CLE164
     C                     ELSE                                                               CLE134
     C**********           Z-ADD600       SEPCKM                                       CLE134 CLE164
     C**********           Z-ADD600       SEPCKT                                       263074 CLE164
     C           WSTYPE    IFEQ 'ADJ'                                                         CLE164
     C                     MOVEL'LFEM'    SECATC                                              CLE164
     C                     ELSE                                                               CLE164
     C                     MOVEL'LFEE'    SECATC                                              CLE164
     C                     ENDIF                                                              CLE164
     C                     ENDIF                                                              CLE134
     C                     ELSE                                                               CLE134
     C**********           Z-ADD100       SEPCKM                                       CLE134 CLE164
     C**********           Z-ADD100       SEPCKT                                       263074 CLE164
     C           WSTYPE    IFEQ 'ADJ'                                                         CLE164
     C                     MOVEL'Fee9M'   SECATC                                              CLE164
     C                     ELSE                                                               CLE164
     C                     MOVEL'Fee90'   SECATC                                              CLE164
     C                     ENDIF                                                              CLE164
     C                     ENDIF                                                              CLE134
     C                     MOVELLKLNNO    SELNRF                                              CLE134
     C                     Z-ADDLKEDAT    SEVDAT                                              CLE134
     C                     Z-ADDFEPSTD    SEVDAT                                            AR571427
     C**********           MOVE 'F2'      SEFILE                                       CLE134 CLE164
     C                     MOVEL'LEPK2DPD'SEFILE                                              CLE164
     C                     MOVEL*BLANKS   SEOVRD                                              CLE164
     C                     MOVELFEPSTD    SESDAT                                              CLE164
     C           FEPEND    IFEQ 0                                                             CLE164
     C                     MOVELFEPSTD    SEMDAT                                              CLE164
     C                     ELSE                                                               CLE164
     C                     MOVELFEPEND    SEMDAT                                              CLE164
     C                     ENDIF                                                              CLE164
     C                     MOVEL*ZEROS    SEVDPD                                              CLE164
     C                     MOVELLKEDAT    SEVDPY                                              CLE164
     C                     Z-ADDLKEAMT    SEPAMT                                              CLE164
     C                     MOVELSTMP      SETMST                                              CLE164
     C           SETRID    ADD  1         SETRID                                              CLE164
     C                     MOVEL*BLANKS   SETREF                                              CLE164
     C           FELOAN    IFEQ *BLANKS                                                       CLE164
     C                     MOVELFEFACL    WTREF   9                                           CLE164
     C                     MOVELFEFCOD    WWTREF  4                                           CLE164
     C                     MOVE FEFSEQ    WWTREF                                              CLE164
     C                     MOVE WWTREF    WTREF                                               CLE164
     C                     MOVELWTREF     SETREF                                              CLE164
     C                     ELSE                                                               CLE164
     C                     MOVELFELOAN    XTREF  10                                           CLE164
     C                     MOVELFEFCOD    WWTREF                                              CLE164
     C                     MOVE FEFSEQ    WWTREF                                              CLE164
     C                     MOVE WWTREF    XTREF                                               CLE164
     C                     MOVELXTREF     SETREF                                              CLE164
     C                     ENDIF                                                              CLE164
     C                     EXSR SRRPKY                                                        CLE164
      *                                                                                       CLE134
      ** If settlement account is defined, then output LEPK2DPD,                            AR217562
      ** else output to LKEYFED                                                             AR217562
      *                                                                                     AR217562
     C           WACCNT    IFEQ 'Y'                                                         AR217562
     C                     Z-ADDWRKAMT    LKOTHA                                            MD051242
     C                     WRITELKEYF2DF                                                      CLE134
     C                     CLEARLKOTHA                                                      MD051242
     C                     ELSE                                                             AR217562
     C           WRKPRC    IFEQ 'Y'                                                         MD051883
     C           AKY,3     ANDEQ'R'                                                         MD051883
     C                     MOVE 'V'       AKY,10                                            MD051883
     C                     MOVEAAKY       LKAKEY                                            MD051883
     C                     ENDIF                                                            MD051883
     C                     WRITELKEYFEDF                                                    AR217562
     C                     ENDIF                                                            AR217562
     C                     ELSE                                                               CLE134
     C           WRKPRC    IFEQ 'Y'                                                         MD051883
     C           AKY,3     ANDEQ'R'                                                         MD051883
     C                     MOVE 'V'       AKY,10                                            MD051883
     C                     MOVEAAKY       LKAKEY                                            MD051883
     C                     ENDIF                                                            MD051883
     C                     WRITELKEYFEDF                                                      CLE073
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE073
      ** WRITE TO REPORT FILE                                                                 CLE073
      *                                                                                       CLE073
      ** If system is multibranching and branch code changes open                             CLE073
      ** new spool file.                                                                      CLE073
      *                                                                                       CLE073
     C           MBIN      IFEQ 'Y'                                                           CLE073
     C           REPBRC    ANDNESTRBRC                                                        CLE073
      *                                                                                       CLE073
      ** Write out total number of account keys generated for last                            CLE073
      ** branch and end of report message before opening new spool file                       CLE073
      *                                                                                       CLE073
     C           *IN21     IFEQ '1'                                                           CLE073
     C                     ADD  NKEY      LKNTOT                                              CLE073
     C                     Z-ADDNKEY      LKNORE                                              CLE073
     C***/COPY*WNCPYSRC,LEH00996***                                                           CFC006
     C/COPY WNCPYSRC,LEH00996                                                               MD020563
     C           SUPFLG    IFNE 'Y'                                                           CFC006
     C                     WRITELER135A4                                                      CLE073
     C***/COPY*WNCPYSRC,LEH00997***                                                           CFC006
     C/COPY WNCPYSRC,LEH00997                                                               MD020563
     C                     ENDIF                                                              CFC006
     C                     Z-ADD0         NKEY                                                CLE073
     C                     ENDIF                                                              CLE073
     C                     MOVE REPBRC    STRBRC  3                                           CLE073
     C                     CLOSELER135P1                                                      CLE073
     C                     OPEN LER135P1                                                      CLE073
      *                                                                                       CLE073
     C                     MOVE 'Y'       P1OP                                                CLE073
      *                                                                                       CLE073
     C                     Z-ADD0         PAGE                                                CLE073
      *                                                                                       CLE073
      ** Ensure report spool file recorded by RCF                                             CLE073
      *                                                                                       CLE073
     C                     Z-ADDSFNUM1    ZSNUM1                                              CLE073
      *                                                                                       CLE073
     C                     CALL 'ZSFILE'                                                      CLE073
     C                     PARM           SEQ     5                                           CLE073
     C                     PARM REPBRC    SENTY   3                                           CLE073
     C                     PARM           SFILE1                                              CLE073
     C                     PARM           ZSNUM1  60                                          CLE073
     C                     PARM           ZSERR   1                                           CLE073
      *                                                                                       CLE073
      ** If error during ZSFILE processing, return to calling program                         CLE073
      *                                                                                       CLE073
     C           ZSERR     IFEQ 'Y'                                                           CLE073
     C                     SETON                     U7U8LR                                   CLE073
     C                     RETRN                                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Obtain branch name for output                                                        CLE073
      *                                                                                       CLE073
     C                     CALL 'AOBRCHR0'                                                    CLE073
     C                     PARM '*MSG   ' WRTCD   7                                           CLE073
     C                     PARM '*KEY   ' WOPTN   7                                           CLE073
     C                     PARM REPBRC    WDSNB   3                                           CLE073
     C           SDBRCH    PARM SDBRCH    DSFDY                                               CLE073
     C           WRTCD     IFNE *BLANKS                                                       CLE073
     C           *LOCK     IN   LDA                                                           CLE073
     C                     MOVEL'LER135'  DBPGM                                               CLE073
     C                     MOVELREPBRC    DBKEY                                               CLE073
     C                     MOVEL'SDBRCHPD'DBFILE                                              CLE073
     C                     Z-ADD026       DBASE                                               CLE073
     C                     OUT  LDA                                                           CLE073
     C                     EXSR *PSSR                                                         CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Output headers                                                                       CLE073
      *                                                                                       CLE073
     C***/COPY*WNCPYSRC,LEH00998***                                                           CFC006
     C/COPY WNCPYSRC,LEH00998                                                               MD020563
     C           SUPFLG    IFNE 'Y'                                                           CFC006
     C                     WRITELER135A1                                                      CLE073
     C                     WRITELER135A2                                                      CLE073
     C***/COPY*WNCPYSRC,LEH00999***                                                           CFC006
     C/COPY WNCPYSRC,LEH00999                                                               MD020563
     C                     ENDIF                                                              CFC006
      *                                                                                       CLE073
      ** If system multibranching                                                             CLE073
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** If system is not multibranching set up single spool file                             CLE073
      *                                                                                       CLE073
     C           MBIN      IFNE 'Y'                                                           CLE073
     C           P1OP      ANDNE'Y'                                                           CLE073
     C                     MOVE 'Y'       P1OP    1                                           CLE073
     C                     CLOSELER135P1                                                      CLE073
     C                     OPEN LER135P1                                                      CLE073
     C                     Z-ADD0         PAGE                                                CLE073
      *                                                                                       CLE073
      ** Ensure report spool file recorded by RCF                                             CLE073
      *                                                                                       CLE073
     C                     Z-ADDSFNUM1    ZSNUM1                                              CLE073
      *                                                                                       CLE073
     C                     CALL 'ZSFILE'                                                      CLE073
     C                     PARM           SEQ                                                 CLE073
     C                     PARM *BLANKS   SENTY                                               CLE073
     C                     PARM           SFILE1                                              CLE073
     C                     PARM           ZSNUM1                                              CLE073
     C                     PARM           ZSERR                                               CLE073
      *                                                                                       CLE073
      ** If error during ZSFILE processing, return to calling program                         CLE073
      *                                                                                       CLE073
     C           ZSERR     IFEQ 'Y'                                                           CLE073
     C                     SETON                     U7U8LR                                   CLE073
     C                     RETRN                                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Output header                                                                        CLE073
      *                                                                                       CLE073
     C***/COPY*WNCPYSRC,LEH01000***                                                           CFC006
     C/COPY WNCPYSRC,LEH01000                                                               MD020563
     C           SUPFLG    IFNE 'Y'                                                           CFC006
     C                     WRITELER135A1                                                      CLE073
     C                     WRITELER135A2                                                      CLE073
     C***/COPY*WNCPYSRC,LEH01001***                                                           CFC006
     C/COPY WNCPYSRC,LEH01001                                                               MD020563
     C                     ENDIF                                                              CFC006
      *                                                                                       CLE073
      ** MBIN IFNE 'Y' end                                                                    CLE073
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** If overflow indicator is on output headings on new page.                             CLE073
      *                                                                                       CLE073
     C           *IN80     IFEQ '1'                                                           CLE073
     C***/COPY*WNCPYSRC,LEH01002***                                                           CFC006
     C/COPY WNCPYSRC,LEH01002                                                               MD020563
     C           SUPFLG    ANDNE'Y'                                                           CFC006
     C                     WRITELER135A1                                                      CLE073
     C                     WRITELER135A2                                                      CLE073
     C                     MOVE '0'       *IN80                                               CLE073
     C                     ENDIF                                                              CLE073
     C                     MOVE FELOAN    FACLOA                                              CLE073
      *                                                                                       CLE073
      ** Output account key generated details.                                                CLE073
      *                                                                                       CLE073
     C***/COPY*WNCPYSRC,LEH01003***                                                           CFC006
     C/COPY WNCPYSRC,LEH01003                                                               MD020563
     C           SUPFLG    IFNE 'Y'                                                           CFC006
     C                     Z-ADDLKEAMT    EAMT0                                             MD051883
     C                     WRITELER135A3                                                      CLE073
     C***/COPY*WNCPYSRC,LEH01004***                                                           CFC006
     C/COPY WNCPYSRC,LEH01004                                                               MD020563
     C                     ENDIF                                                              CFC006
      *                                                                                       CLE073
      ** Details on print file indicator                                                      CLE073
      *                                                                                       CLE073
     C                     MOVE '1'       *IN21                                               CLE073
      *                                                                                       CLE073
      ** Add event amount to hash total for trailer                                           CLE073
      *                                                                                       CLE134
     C           WNEWF     IFEQ 'Y'                                                           CLE134
     C********** WACCNT    ANDEQ'Y'                                                AR707261 AR741212
     C           LKEAMT    DIV  1000      ZZAMT  153                                          CLE134
     C                     Z-ADD1         Z                                                   CLE134
     C                     Z-ADD2         S                                                   CLE134
     C                     Z-ADDL2VLRF    INT,2                                               CLE134
     C                     Z-ADDL2VLRL    DEC,2                                               CLE134
     C                     Z-ADDL2VLRF    ZZTOTI                                              CLE134
     C                     Z-ADDL2VLRL    ZZTOTD                                              CLE134
     C                     EXSR ZHASH                                                         CLE134
     C                     Z-ADDZZTOTI    L2VLRF                                              CLE134
     C                     Z-ADDZZTOTD    L2VLRL                                              CLE134
     C                     ELSE                                                               CLE134
      *                                                                                       CLE073
     C           LKEAMT    DIV  1000      ZZAMT                                               CLE073
     C                     Z-ADD1         Z                                                   CLE073
     C                     Z-ADD1         S                                                   CLE073
     C                     Z-ADDTOTI      ZZTOTI                                              CLE073
     C                     Z-ADDTOTD      ZZTOTD                                              CLE073
     C                     EXSR ZHASH                                                         CLE073
     C                     Z-ADDZZTOTI    TOTI                                                CLE073
     C                     Z-ADDZZTOTD    TOTD                                                CLE073
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE073
     C           WNEWF     IFEQ 'Y'                                                           CLE134
     C********** WACCNT    ANDEQ'Y'                                                AR402543 AR741212
     C                     ADD  1         L2NORE                                              CLE134
     C                     ELSE                                                               CLE134
     C                     ADD  1         NKEY                                                CLE073
     C                     ENDIF                                                              CLE134
      *                                                                                     MD051242
     C           CLE031    IFEQ 'Y'                                                         MD051242
     C           *IN61     ANDEQ'1'                                                         MD051242
     C           CLE134    ANDEQ'N'                                                         MD051242
     C           CLE031    OREQ 'Y'                                                         MD051242
     C           *IN61     ANDEQ'1'                                                         MD051969
     C           CLE134    ANDEQ'Y'                                                         MD051242
     C********** FEAUTO    ANDEQ'Y'                                                MD051242 MD051969
     C           FEAUTO    ANDNE'C'                                                         MD051969
     C           CLE031    OREQ 'Y'                                                         MD053946
     C           *IN61     ANDEQ'1'                                                         MD053946
     C           CLE134    ANDEQ'Y'                                                         MD053946
     C           FEAUTO    ANDEQ'C'                                                         MD053946
     C           OATYP     ANDEQ'N'                                                         MD053946
     C                     EXSR SETTLE                                                      MD051242
     C                     ENDIF                                                            MD051242
      *                                                                                     MD051242
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     MOVE *BLANKS   WATYPE                                              CLE134
     C                     MOVEL'N'       GENKY                                             MD051883
      *                                                                                       CLE134
     C                     ENDSR                                                              CLE073
      *                                                                                       CLE073
      *****************************************************************                       CLE073
     C/TITLE SR/RECALL                                                                        CLE073
      *****************************************************************                       CLE073
      *                                                                                       CLE073
      *  RECALL - Recalculating the total fee due from start.                                 CLE073
      *                                                                                       CLE073
      *  This subroutine is based on sr/RECALC. Sr/RECALL processes facility historic         CLE073
      *  file while sr/RECALL processes Loans Files (Loans and Historic file).                CLE073
      *  In case of upgrade of this car, or in case of new fixes/changes to                   CLE073
      *  to sr/AMTACC, verify whether these are to be applied to sr/AMTACL as well.           CLE073
      *                                                                                       CLE073
      *  CALLED FROM:  SR/AMTACL                                                              CLE073
      *                                                                                       CLE073
      *  CALLS: SR/HISCAL                                                                     CLE073
      *                                                                                       CLE073
      *****************************************************************                       CLE073
      *                                                                                       CLE073
     C           RECALL    BEGSR                                                              CLE073
      *                                                                                       CLE073
      ** Recalculate the total fee due from start.                                            CLE073
      *                                                                                       CLE073
     C                     MOVE *BLANK    ATYP                                                CLE073
     C                     Z-ADDFEPSTD    STDATE                                              CLE073
     C                     Z-ADDFELPDT    ENDATE                                              CLE073
     C                     Z-ADD0         WFEE                                                CLE073
     C                     Z-ADD0         TDUE   130                                          CLE073
      *                                                                                       CLE073
     C           FEORED    IFNE BJRDNB                                                      MD031473
      *                                                                                     MD031473
      ** Store end date and move rates/amounts from LEFEED to working array                 MD031473
     C                     Z-ADDFAMT      @WAMT                                             MD031473
     C                     Z-ADDFRT       @WRT                                              MD031473
      *                                                                                     MD031473
      ** Read LEFHST to get the right rates and amounts for specific fee period.            MD031473
      *                                                                                     MD031473
     C           LELKEY    KLIST                                                            MD031473
     C                     KFLD           FECNUM                                            MD031473
     C                     KFLD           FELOAN                                            MD031473
     C                     KFLD           FEFSEQ                                            MD031473
      *                                                                                     MD031473
     C           CLE071    IFEQ 'Y'                                                           CLE071
     C           LFKEY2    SETGTLEFHSTFB                                                      CLE071
     C           LFKEY3    REDPELEFHSTFB                 27                                   CLE071
     C                     Z-ADD@HAMT     FAMT                                                CLE071
     C                     Z-ADD@HRT      FRT                                                 CLE071
     C           LFKEY3    READELEFHSTFB                 27                                   CLE071
     C                     ELSE                                                               CLE071
     C           LELKEY    SETLLLEFHSTLA                                                    MD031473
     C           LELKEY    READELEFHSTLA                 27                                 MD031473
     C                     ENDIF                                                              CLE071
      *                                                                                       CLE071
     C           *IN27     DOUEQ'1'                                                         MD031473
     C           *IN27     IFEQ '0'                                                         MD031473
     C           CLE071    IFEQ 'Y'                                                           CLE071
     C           HIRCVD    IFLT FELPDT                                                      MD055069
     C                     Z-ADDHIRCVD    ENDATE                                            MD031473
     C                     ELSE                                                             MD055069
     C                     Z-ADDFELPDT    ENDATE                                            MD055069
     C                     ENDIF                                                            MD055069
     C                     ELSE                                                               CLE071
     C                     Z-ADD@HLAMT    FAMT                                              MD031473
     C                     Z-ADD@HLRT     FRT                                               MD031473
     C                     Z-ADDLOHDAT    ENDATE                                            MD031473
     C                     ENDIF                                                              CLE071
     C                     ENDIF                                                            MD031473
      *                                                                                     MD031473
      ** Calculate WDAYS.                                                                   MD031473
      *                                                                                     MD031473
     C                     Z-ADDSTDATE    ZZBEG                                             MD031473
     C                     Z-ADDENDATE    ZZEND                                             MD031473
     C                     MOVE FECALC    ZZCALC                                            MD031473
     C                     EXSR ZINTDY                                                      MD031473
     C           FECALC    IFEQ 6                                                           MD031473
     C                     Z-ADDINT6DY    WDAYS                                             MD031473
     C                     ELSE                                                             MD031473
     C                     Z-ADDZZINDY    WDAYS                                             MD031473
     C                     ENDIF                                                            MD031473
      *                                                                                     MD031473
      ** Set amount                                                                         MD031473
      *                                                                                     MD031473
     C           FECALT    IFEQ '99'                                                        MD031473
     C           FECALT    OREQ '90'                                                        MD031473
     C                     Z-ADDFEFAMT    CFAMT                                             MD031473
     C                     Z-ADDFEFAMT    AAMT                                              MD031473
     C                     ENDIF                                                            MD031473
      *                                                                                     MD031473
      ** Type 98: Loan Original Amount                                                      MD031473
      *                                                                                     MD031473
     C           FECALT    IFEQ '98'                                                        MD031473
     C                     Z-ADDOPAMK     CFAMT                                             MD031473
     C                     Z-ADDOPAMK     AAMT                                              MD031473
     C                     ENDIF                                                            MD031473
      *                                                                                     MD031473
      ** Caculation type 97: get amount from loan history file                              MD031473
      *                                                                                     MD031473
     C                     Z-ADD999       WLASN                                             MD031473
     C           FECALT    IFEQ '97'                                                        MD031473
     C                     Z-ADDSTDATE    WVDAT                                             MD031473
     C                     Z-ADDOPAMK     CFAMT                                             MD031473
     C                     Z-ADDOPAMK     AAMT                                              MD031473
     C                     Z-ADD999       WLASN   30                                        MD031473
     C           KEYHST    SETGTLEHISTLA                                                    MD031473
     C           KEYPHS    REDPELEHISTLA                 18                                 MD031473
     C           *IN18     IFEQ *OFF                                                        MD031473
     C                     Z-ADDCPAMP     CFAMT                                             MD031473
     C                     Z-ADDCPAMP     AAMT                                              MD031473
     C                     ELSE                                                             MD031473
     C                     Z-ADD001       WLASN                                             MD031473
     C           KEYHST    SETLLLEHISTLA                 18                                 MD031473
     C                     ENDIF                                                            MD031473
     C                     ENDIF                                                            MD031473
      *                                                                                     MD031473
     C           FECALT    IFNE '99'                                                        MD031473
     C           FECALT    ANDNE'90'                                                        MD031473
     C                     EXSR HISCLL                                                      MD031473
     C**********           Z-ADDWFEE      TDUE                                    MD031473 MD031473A
     C                     ADD  WFEE      TDUE                                             MD031473A
     C                     Z-ADD0         WFEE                                             MD031473A
     C           TDUE      IFNE FEAMTS                                                      MD031473
     C           FECALT    ANDEQ'97'                                                        MD031473
     C           TDUE      SUB  FEAMTS    WDIFF2 130                                        MD031473
     C                     SUB  FEAMTP    WDIFF2                                            MD031473
     C                     ADD  FETADJ    WDIFF2                                            MD031473
     C                     ADD  FEAMTA    WDIFF2                                            MD031473
     C                     SUB  FEWOFF    WDIFF2                                            MD031473
     C                     SUB  FEAMTW    WDIFF2                                            MD031473
     C           WDIFF2    IFEQ 1                                                           MD031473
     C                     SUB  1         TDUE                                              MD031473
     C                     ENDIF                                                            MD031473
     C           WDIFF2    IFEQ -1                                                          MD031473
     C                     ADD  1         TDUE                                              MD031473
     C                     ENDIF                                                            MD031473
     C                     ENDIF                                                            MD031473
     C                     ENDIF                                                           MD031473A
      *                                                                                    MD031473A
     C                     Z-ADDENDATE    STDATE                                           MD031473A
     C           CLE071    IFEQ 'Y'                                                           CLE071
     C                     Z-ADD@HAMT     FAMT                                                CLE071
     C                     Z-ADD@HRT      FRT                                                 CLE071
     C           LFKEY3    READELEFHSTFB                 27                                   CLE071
     C                     ELSE                                                               CLE071
     C           LELKEY    READELEFHSTLA                 27                                MD031473A
     C                     ENDIF                                                              CLE071
      *                                                                                       CLE071
     C                     ENDDO                                                           MD031473A
      *                                                                                     MD031473
     C           FECALT    IFNE '99'                                                       MD031473A
     C           FECALT    ANDNE'90'                                                       MD031473A
      *                                                                                    MD031473A
      ** Recalculate Fee amount past due amount.                                            MD031473
      *                                                                                     MD031473
     C           TDUE      ADD  FETADJ    ADDUE  130                                        MD031473
     C                     ADD  FEAMTA    ADDUE                                             MD031473
     C                     SUB  FEAMTS    ADDUE                                             MD031473
     C           ADDUE     SUB  FEAMTP    WLOANA                                            MD055069
     C                     SUB  FEWOFF    WLOANA                                            MD055069
     C                     SUB  FEAMTW    WLOANA                                            MD055069
     C           FEAUTO    IFEQ 'Y'                                                         MD031473
     C           FEAUTO    OREQ 'C'                                                         MD031473
     C           CLE134    ANDEQ'Y'                                                         MD031473
     C           FEAUT2    OREQ 'C'                                                         MD031473
     C           CLE134    ANDEQ'Y'                                                         MD031473
     C                     SUB  FEAMTP    ADDUE                                             MD031473
     C                     ENDIF                                                            MD031473
      *                                                                                     MD031473
      ** FEAMTP should be set to amount outstanding on previous fee                         MD031473
      ** period only.                                                                       MD031473
      *                                                                                     MD031473
     C                     Z-ADDADDUE     FEAMTP                                            MD031473
     C                     SUB  FEWOFF    FEAMTP                                            MD031473
     C                     SUB  FEAMTW    FEAMTP                                            MD031473
     C                     ENDIF                                                            MD031473
      *                                                                                     MD031473
     C**********           Z-ADDENDATE    STDATE                                  MD031473 MD031473A
     C********** LELKEY    READELEFHSTLA                 27                       MD031473 MD031473A
     C**********           ENDDO                                                  MD031473 MD031473A
      *                                                                                     MD031473
     C                     Z-ADD@WAMT     FAMT                                              MD031473
     C                     Z-ADD@WRT      FRT                                               MD031473
      *                                                                                     MD031473
      ** Feored = Bjrdnb                                                                    MD031473
     C                     ELSE                                                             MD031473
      *
      ** Calculate WDAYS.                                                                     CLE073
      *                                                                                       CLE073
     C                     Z-ADDSTDATE    ZZBEG                                               CLE073
     C                     Z-ADDENDATE    ZZEND                                               CLE073
     C                     MOVE FECALC    ZZCALC                                              CLE073
     C                     EXSR ZINTDY                                                        CLE073
     C           FECALC    IFEQ 6                                                             CLE073
     C                     Z-ADDINT6DY    WDAYS                                               CLE073
     C                     ELSE                                                               CLE073
     C                     Z-ADDZZINDY    WDAYS                                               CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Set amount                                                                           CLE073
      *                                                                                       CLE073
     C           FECALT    IFEQ '99'                                                          CLE073
     C           FECALT    OREQ '90'                                                          CLE134
     C                     Z-ADDFEFAMT    CFAMT                                               CLE073
     C                     Z-ADDFEFAMT    AAMT                                                CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Type 98: Loan Original Amount                                                        CLE073
      *                                                                                       CLE073
     C           FECALT    IFEQ '98'                                                          CLE073
     C                     Z-ADDOPAMK     CFAMT                                               CLE073
     C                     Z-ADDOPAMK     AAMT                                                CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Caculation type 97: get amount from loan history file                                CLE073
      *                                                                                       CLE073
     C                     Z-ADD999       WLASN                                               CLE073
     C           FECALT    IFEQ '97'                                                          CLE073
     C                     Z-ADDSTDATE    WVDAT                                               CLE073
     C                     Z-ADDOPAMK     CFAMT                                               CLE073
     C                     Z-ADDOPAMK     AAMT                                                CLE073
     C                     Z-ADD999       WLASN   30                                          CLE073
     C           KEYHST    SETGTLEHISTLA                                                      CLE073
     C           KEYPHS    REDPELEHISTLA                 18                                   CLE073
     C           *IN18     IFEQ *OFF                                                          CLE073
     C                     Z-ADDCPAMP     CFAMT                                               CLE073
     C                     Z-ADDCPAMP     AAMT                                                CLE073
     C                     ELSE                                                               CLE073
     C                     Z-ADD001       WLASN                                               CLE073
     C           KEYHST    SETLLLEHISTLA                 18                                   CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C           FECALT    IFNE '99'                                                          CLE073
     C           FECALT    ANDNE'90'                                                          CLE134
     C                     EXSR HISCLL                                                        CLE073
     C                     Z-ADDWFEE      TDUE                                                CLE073
     C           TDUE      IFNE FEAMTS                                                      AR634880
     C           FECALT    ANDEQ'97'                                                        AR634880
     C           TDUE      SUB  FEAMTS    WDIFF2 130                                        AR634880
     C                     SUB  FEAMTP    WDIFF2                                            AR634880
     C                     ADD  FETADJ    WDIFF2                                            AR634880
     C                     ADD  FEAMTA    WDIFF2                                            AR634880
     C                     SUB  FEWOFF    WDIFF2                                            AR634880
     C                     SUB  FEAMTW    WDIFF2                                            AR634880
     C           WDIFF2    IFEQ 1                                                           AR634880
     C                     SUB  1         TDUE                                              AR634880
     C                     ENDIF                                                            AR634880
     C           WDIFF2    IFEQ -1                                                          AR634880
     C                     ADD  1         TDUE                                              AR634880
     C                     ENDIF                                                            AR634880
     C                     ENDIF                                                            AR634880
      *                                                                                       CLE073
      ** Recalculate Fee amount past due amount.                                              CLE073
      *                                                                                       CLE073
     C           TDUE      ADD  FETADJ    ADDUE  130                                          CLE073
     C                     ADD  FEAMTA    ADDUE                                               CLE073
     C                     SUB  FEAMTS    ADDUE                                               CLE073
     C           ADDUE     SUB  FEAMTP    WLOANA                                            MD055069
     C                     SUB  FEWOFF    WLOANA                                            MD055069
     C                     SUB  FEAMTW    WLOANA                                            MD055069
     C           FEAUTO    IFEQ 'Y'                                                           CLE073
     C           FEAUTO    OREQ 'C'                                                           CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
     C           FEAUT2    OREQ 'C'                                                           CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
     C                     SUB  FEAMTP    ADDUE                                               CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** FEAMTP should be set to amount outstanding on previous fee                           CLE073
      ** period only.                                                                         CLE073
      *                                                                                       CLE073
     C                     Z-ADDADDUE     FEAMTP                                              CLE073
     C                     SUB  FEWOFF    FEAMTP                                              CLE073
     C                     SUB  FEAMTW    FEAMTP                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                     MD031473
     C                     ENDIF                                                            MD031473
      *                                                                                     MD031473
     C                     MOVE 'H'       ATYP                                                CLE073
     C           FEAMTP    IFNE 0                                                           MD052216
     C                     Z-ADDFEAMTP    W#AMTO                                            MD052216
     C                     ENDIF                                                            MD052216
      *                                                                                       CLE073
     C                     ENDSR                                                              CLE073
      *                                                                                       CLE073
      *****************************************************************                       CLE073
     C/TITLE SR/HISCLL                                                                        CLE073
      *****************************************************************                       CLE073
      *                                                                                       CLE073
      *  HISCLL - Recalculating the total fee due from start.                                 CLE073
      *                                                                                       CLE073
      *  This sr is based on sr/HISCAL, in case of upgrade verify whether                     CLE073
      *  new fixes/changes done to sr/HISCAL are needed in sr/HISCLL                          CLE073
      *  as well                                                                              CLE073
      *                                                                                       CLE073
      *  CALLED FROM:  SR/RECALL                                                              CLE073
      *                                                                                       CLE073
      *  CALLS: SR/ACCRUE                                                                     CLE073
      *                                                                                       CLE073
      *****************************************************************                       CLE073
      *                                                                                       CLE073
     C           HISCLL    BEGSR                                                              CLE073
      *                                                                                       CLE073
     C                     MOVE '0'       *IN18                                               CLE073
      *                                                                                       CLE073
     C           FECALT    IFEQ '97'                        B* CALCT 97                       CLE073
     C           *IN18     DOWEQ'0'                                                           CLE073
     C           KEYPHS    READELEHISTLA                 18                                   CLE073
      *                                                                                       CLE073
     C           *IN18     IFEQ '1'                                                           CLE073
     C           VDATP     ORGT ENDATE                                                        CLE073
     C                     Z-ADDENDATE    VDATP                                               CLE073
     C                     MOVE '1'       *IN18                                               CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Calculate for number of days.                                                        CLE073
      *                                                                                       CLE073
     C                     Z-ADDSTDATE    ZZBEG                                               CLE073
     C           VDATP     IFGT STDATE                                                        CLE073
     C                     Z-ADDVDATP     ZZEND                                               CLE073
     C                     ELSE                                                               CLE073
     C                     Z-ADDSTDATE    ZZEND                                               CLE073
     C                     ENDIF                                                              CLE073
     C                     MOVE FECALC    ZZCALC                                              CLE073
     C                     EXSR ZINTDY                                                        CLE073
     C           FECALC    IFEQ 6                                                             CLE073
     C                     Z-ADDINT6DY    NDAYS                                               CLE073
     C                     ELSE                                                               CLE073
     C                     Z-ADDZZINDY    NDAYS                                               CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C           NDAYS     IFGT 0                                                             CLE073
     C                     Z-ADDNDAYS     WDAYS                                               CLE073
     C                     Z-ADDAAMT      WAMT                                                CLE073
     C                     EXSR ACCRUL                                                        CLE073
     C                     ADD  WTOT      WFEE                                                CLE073
     C                     ENDIF                                                              CLE073
     C           VDATP     IFGT STDATE                                                        CLE073
     C                     Z-ADDVDATP     STDATE                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Setup field AAMT.                                                                    CLE073
      *                                                                                       CLE073
     C           *IN18     IFNE '1'                                                           CLE073
     C                     Z-ADDCPAMP     AAMT                                                CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     ENDDO                                                              CLE073
      *                                                                                       CLE073
      ** Process accrual                                                                      CLE073
      *                                                                                       CLE073
     C                     ELSE                                                               CLE073
     C                     Z-ADDAAMT      WAMT                                                CLE073
     C                     EXSR ACCRUL                                                        CLE073
     C                     Z-ADDWTOT      WFEE                                                CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     ENDSR                                                              CLE073
      *                                                                                       CLE073
      *****************************************************************                       CLE073
      /EJECT                                                                                  CLE073
      *****************************************************************                       CLE031
     C/TITLE SR/SRLOAM                                                                        CLE139
      ********************************************************************                    CLE139
      *                                                                                       CLE139
      * SRLOAM - WRITE RECORD iN LOAMSDK FILE                                                 CLE139
      *                                                                                       CLE139
      *  CALLED FROM: GENKEY                                                                  CLE139
      *                                                                                       CLE139
      *  CALLS: SRGNSQ                                                                        CLE139
      *                                                                                       CLE139
      ********************************************************************                    CLE139
      *                                                                                       CLE139
     C           SRLOAM    BEGSR                                                              CLE139
      *                                                                                       CLE139
      ** Write record in Loan Amendments file                                                 CLE139
      *                                                                                       CLE139
     C           WLNKEY    CHAINCLOAN                34                                       CLE139
      *                                                                                       CLE139
      ** Database error                                                                       CLE139
      *                                                                                       CLE139
     C           *IN34     IFEQ '1'                                                           CLE139
     C           *LOCK     IN   LDA                                                           CLE139
     C                     MOVELFELOAN    DBKEY                                               CLE139
     C                     Z-ADD037       DBASE                                               CLE139
     C                     MOVEL'CLOAN'   DBFILE                                              CLE139
     C                     OUT  LDA                                                           CLE139
     C                     EXSR *PSSR                                                         CLE139
      *                                                                                       CLE139
     C                     ELSE                                                               CLE139
      *                                                                                       CLE139
     C                     EXSR SRGNSQ                                                        CLE139
     C                     CLEARLOAMSDKF                                                      CLE139
     C                     MOVELFELOAN    #LNRF                                               CLE139
     C                     MOVELLKEDAT    #VDAT                                               CLE139
     C                     Z-ADD#LAS1     #LASN                                               CLE139
     C                     Z-ADD2         #MRIN                                               CLE139
     C                     MOVELTPLTYP    #LTYP                                               CLE139
     C                     MOVELTPSUTP    #SUTP                                               CLE139
     C                     MOVELTPPTYP    #PTYP                                               CLE139
     C                     MOVEL'PI'      #AMTP                                               CLE139
     C                     MOVELTPCCY     #CCY                                                CLE139
     C                     MOVELLKEAMT    #PRAM                                               CLE139
     C                     MOVELLKEAMT    #TAMT                                               CLE139
     C                     MOVELTPBRCA    #BRCA                                               CLE139
     C                     MOVELTPCNUM    #CNUM                                               CLE139
     C                     MOVEL'Y'       #AUTO                                               CLE139
     C                     MOVEL'A'       #LLAG                                               CLE139
     C                     MOVELTPFCUS    #FCUS                                               CLE139
     C                     MOVELTPFTYP    #FTYP                                               CLE139
     C                     MOVELTPFSEQ    #FSEQ                                               CLE139
     C                     MOVELTPFCLB    #FCLB                                               CLE139
     C                     MOVELBJRDNB    #ORED                                               CLE139
     C                     MOVELBJRDNB    #LCD                                                CLE139
     C                     MOVEASTAMP,1   #TMST                                               CLE139
     C**********           MOVE 'XXXX'    #CLAS                                     CLE139 AR745249A
     C                     MOVELTPCLAS    #CLAS                                            AR745249A
     C                     MOVEL'F'       #GPRT                                               CLE139
     C                     MOVELTPRECI    #RECI                                               CLE139
      *                                                                                       CLE139
     C                     WRITELOAMSDKF                                                      CLE139
     C                     END                                                                CLE139
      *                                                                                       CLE139
      ** Update trailer file                                                                  CLE139
      *                                                                                       CLE139
     C           KHASH     KLIST                                                              CLE139
     C**********           KFLD           KLOAN   60                                   CLE139 CLE148
     C                     KFLD           KLOAN   6                                           CLE148
     C                     KFLD           KVDAT   50                                          CLE139
     C                     KFLD           KSEQ    30                                          CLE139
      *                                                                                       CLE139
     C**********           Z-ADD999999    KLOAN                                        CLE139 CLE148
     C                     MOVEL'999999'  KLOAN                                               CLE148
     C                     Z-ADD99999     KVDAT                                               CLE139
     C                     Z-ADD999       KSEQ                                                CLE139
      *                                                                                       CLE139
     C           KHASH     CHAINLOAMS                35                                       CLE139
     C           *IN35     IFEQ '1'                                                           CLE139
     C           *LOCK     IN   LDA                                                           CLE139
     C                     MOVELKLOAN     DBKEY                                               CLE139
     C                     Z-ADD038       DBASE                                               CLE139
     C                     MOVEL'LOAMS'   DBFILE                                              CLE139
     C                     OUT  LDA                                                           CLE139
     C                     EXSR *PSSR                                                         CLE139
      *                                                                                       CLE139
     C                     ELSE                                                               CLE139
      *                                                                                       CLE139
     C                     ADD  1         #NORE                                               CLE139
     C                     Z-ADD1         Z                                                   CLE139
     C                     Z-ADD3         S                                                   CLE139
     C           #PRAM     DIV  1000      ZZAMT                                               CLE139
     C                     Z-ADD#VRIF     INT,S                                               CLE139
     C                     Z-ADD#VRIL     DEC,S                                               CLE139
     C                     EXSR ZHASH                                                         CLE139
     C                     Z-ADDZZTOTI    #VRIF                                               CLE139
     C                     Z-ADDZZTOTD    #VRIL                                               CLE139
     C                     Z-ADD4         S                                                   CLE139
     C                     Z-ADD#VRRF     INT,S                                               CLE139
     C                     Z-ADD#VRRL     DEC,S                                               CLE139
     C                     EXSR ZHASH                                                         CLE139
     C                     Z-ADDZZTOTI    #VRRF                                               CLE139
     C                     Z-ADDZZTOTD    #VRRL                                               CLE139
     C                     UPDATLOAMSZ1F                                                      CLE139
     C                     ENDIF                                                              CLE139
      *                                                                                       CLE139
     C                     ENDSR                                                              CLE139
      ********************************************************************                    CLE139
      /EJECT                                                                                  CLE139
      ********************************************************************                    CLE139
     C/TITLE SR/SRGNSQ                                                                        CLE139
      ********************************************************************                    CLE139
      *                                                                                       CLE139
      * SRGNSQ - GENERATE NEXT AMEND SEQUENCE NUMBER                                          CLE139
      *                                                                                       CLE139
      *  CALLED FROM: SRLOAM                                                                  CLE139
      *                                                                                       CLE139
      *  CALLS: NONE                                                                          CLE139
      *                                                                                       CLE139
      ********************************************************************                    CLE139
      *                                                                                       CLE139
     C           SRGNSQ    BEGSR                                                              CLE139
      *                                                                                       CLE139
     C           KLAKEY    KLIST                                                              CLE139
     C**********           KFLD           #LNR1   60                                   CLE139 CLE148
     C                     KFLD           #LNR1   6                                           CLE148
     C                     KFLD           #VDA1   50                                          CLE139
     C                     KFLD           #LAS1   30                                          CLE139
      *                                                                                       CLE139
     C                     MOVE FELOAN    #LNR1                                               CLE139
     C                     Z-ADDLKEDAT    #VDA1                                               CLE139
     C                     Z-ADD*ZERO     #LAS1                                               CLE139
     C           KLAKEY    SETLLLOAMS                                                         CLE139
     C                     READ LOAMS                    99                                   CLE139
     C           *IN99     DOWEQ*OFF                                                          CLE139
     C           #RECIZ    IFEQ 'T'                                                           CLE139
     C                     LEAVE                                                              CLE139
     C                     ENDIF                                                              CLE139
     C           #LNR1     IFNE #LNRF                                                         CLE139
     C           #VDA1     ORNE #VDAT                                                         CLE139
     C                     LEAVE                                                              CLE139
     C                     ENDIF                                                              CLE139
     C                     Z-ADD#LASN     #LAS1                                               CLE139
     C                     READ LOAMS                    99                                   CLE139
     C                     ENDDO                                                              CLE139
     C                     ADD  1         #LAS1                                               CLE139
      *                                                                                       CLE139
     C                     ENDSR                                                              CLE139
     C/COPY WNCPYSRC,LEH00698
      *****************************************************************                     AR317401
     C/TITLE SR/FEECHG                                                                      AR317401
      *****************************************************************                     AR317401
      *                                                               *                     AR317401
      *  FEECHG - Loan Fee subtype change processing.                 *                     AR317401
      *                                                               *                     AR317401
      *  This SR will add the functionality of reversing fee accruals *                     AR317401
      *  posted but not paid from the old subtype and repost the      *                     AR317401
      *  total amount to the new subtype. Valid for loan fees only.   *                     AR317401
      *                                                               *                     AR317401
      *  CALLED FROM:  SR/MAIN                                        *                     AR317401
      *                                                               *                     AR317401
      *  CALLS: SR/GENKY                                              *                     AR317401
      *                                                               *                     AR317401
      *****************************************************************                     AR317401
      *                                                                                     AR317401
     C           FEECHG    BEGSR                                                            AR317401
      *                                                                                     AR317401
      ** Setup amount to be reverse for the old subtype.                                    AR317401
      *                                                                                     AR317401
     C                     Z-ADD0         LKEAMT                                            AR317401
     C           FELPAM    ADD  FEAMTP    LKEAMT                                            AR317401
      *                                                                                     AR317401
     C           FELPDT    IFLE CODT                                                        AR317401
     C           FEDDAT    ANDEQCODT                                                        AR317401
     C           FEDIND    ANDNE' '                                                         AR317401
     C           FEAMTP    ANDGT0                                                           AR317401
     C           BKALDI    ANDEQ'Y'                                                         AR317401
     C                     Z-ADD0         LKEAMT                                            AR317401
     C                     Z-ADDFEAMTP    LKEAMT                                            AR317401
     C                     ENDIF                                                            AR317401
      *                                                                                     AR317401
     C                     MOVE '0'       *IN61                                             AR317401
     C                     MOVE 'Y'       FEELS                                             AR317401
     C                     MOVE ' '       ATYP                                              AR317401
     C                     MOVE ' '       MSFLAG                                            AR317401
     C                     Z-ADD1         LKREVI                                            AR317401
     C                     EXSR GENKEY                                                      AR317401
      *                                                                                     AR317401
      ** Setup amount to be repost for the new subtype.                                     AR317401
      *                                                                                     AR317401
     C                     MOVE SUTPP1    FESUTP                                            AR317401
     C                     Z-ADD0         LKREVI                                            AR317401
     C                     EXSR GENKEY                                                      AR317401
      *                                                                                     AR317401
     C                     ENDSR                                                            AR317401
      *                                                                                     AR317401
      *****************************************************************                       CLE139
      /EJECT                                                                                  CL1393
      *****************************************************************                       CLE139
     C/TITLE SR/SRFZAS                                                                      MD026969
      *****************************************************************                     MD026969
      *                                                               *                     MD026969
      * SRFZAS - Write new record to LEFZASPD                         *                     MD026969
      *                                                               *                     MD026969
      * CALLED FROM: Main                                             *                     MD026969
      *                                                               *                     MD026969
      * CALLS: None                                                   *                     MD026969
      *                                                               *                     MD026969
      *****************************************************************                     MD026969
      *                                                                                     MD026969
     C           SRFZAS    BEGSR                                                            MD026969
      *                                                                                     MD026969
     C                     CLEARLEFZASD0                                                    MD026969
     C                     MOVE FERECI    FZRECI                                            MD026969
     C                     MOVE FEBRCA    FZBRCA                                            MD026969
     C                     MOVE FECNUM    FZCNUM                                            MD026969
     C                     Z-ADDFEFACL    FZFACL                                            MD026969
     C                     MOVE FELOAN    FZLOAN                                            MD026969
     C                     Z-ADDFEFSEQ    FZFSEQ                                            MD026969
     C                     Z-ADDFEFCOD    FZFCOD                                            MD026969
     C                     MOVE FEFCCY    FZFCCY                                            MD026969
     C                     Z-ADDADDUE     FZAMTP                                            MD026969
     C                     Z-ADDFELPDT    FZLPDT                                            MD026969
     C                     Z-ADDFEAMTS    FZLSAM                                            MD026969
     C                     Z-ADDFESDAT    FZSDAT                                            MD026969
     C                     MOVE ' '       FZRPRO                                            MD026969
     C                     Z-ADDBJRDNB    FZORED                                            MD026969
     C                     WRITELEFZASD0                                                    MD026969
      *                                                                                     MD026969
     C                     ENDSR                                                            MD026969
      *****************************************************************                     MD026969
      /EJECT                                                                                MD026969
      *****************************************************************                     MD026969
     C/TITLE SR/SRFZAR                                                                      MD026969
      *****************************************************************                     MD026969
      *                                                               *                     MD026969
      * SRFZAR - Output records of LEFZASPD to LER135P3               *                     MD026969
      *                                                               *                     MD026969
      * CALLED FROM: Main                                             *                     MD026969
      *                                                               *                     MD026969
      * CALLS: None                                                   *                     MD026969
      *                                                               *                     MD026969
      *****************************************************************                     MD026969
      *                                                                                     MD026969
     C           SRFZAR    BEGSR                                                            MD026969
      *                                                                                     MD026969
     C           P3OP      IFNE 'Y'                                                         MD054354
     C                     OPEN LER135P3                                                    MD054354
     C                     MOVE 'Y'       P3OP    1                                         MD054354
     C                     ENDIF                                                            MD054354
      *                                                                                     MD054354
     C                     WRITEHEADP3                                                      MD026969
      ** Ensure report spool file recorded by RCF                                           MD054354
     C                     Z-ADDSFNUM3    ZSNUM1                                            MD054354
      *                                                                                     MD054354
     C                     CALL 'ZSFILE'                                                    MD054354
     C                     PARM           SEQ     5                                         MD054354
     C                     PARM *BLANKS   SENTY   3                                         MD054354
     C                     PARM           SFILE3                                            MD054354
     C                     PARM           ZSNUM3  60                                        MD054354
     C                     PARM           ZSERR   1                                         MD054354
      *                                                                                     MD054354
      ** If error during ZSFILE processing, return to calling program                       MD054354
     C           ZSERR     IFEQ 'Y'                                                         MD054354
     C                     SETON                     U7U8LR                                 MD054354
     C                     RETRN                                                            MD054354
     C                     END                                                              MD054354
      *                                                                                     MD054354
     C                     Z-ADD0         COUNT  300                                        MD026969
     C           1         SETLLLEFZASPD                                                    MD026969
     C                     READ LEFZASPD                 54                                 MD026969
     C           *IN54     DOWEQ'0'                                                         MD026969
     C           FZRPRO    IFEQ ' '                                                         MD026969
      *                                                                                     MD026969
     C                     ADD  1         COUNT                                             MD026969
     C                     Z-ADDFZLPDT    ZDAYNO                                            MD026969
     C                     EXSR ZDATE2                                                      MD026969
     C           ZDATE     IFEQ *ZEROS                                                      MD026969
     C           ZADATE    ANDEQ*BLANKS                                                     MD026969
     C           *LOCK     IN   LDA                                                         MD026969
     C                     MOVEL'LER135'  DBPGM                                             MD026969
     C                     MOVEL'ZDATE2  'DBFILE           ************                     MD026969
     C                     Z-ADD012       DBASE            * DBERR 12 *                     MD026969
     C                     OUT  LDA                        ************                     MD026969
     C                     EXSR *PSSR                                                       MD026969
     C                     END                                                              MD026969
     C                     MOVE ZADATE    RLPDT                                             MD026969
      *                                                                                     MD026969
     C           FZSDAT    IFGT 0                                                           MD033473
     C                     Z-ADDFZSDAT    ZDAYNO                                            MD026969
     C                     EXSR ZDATE2                                                      MD026969
     C           ZDATE     IFEQ *ZEROS                                                      MD026969
     C           ZADATE    ANDEQ*BLANKS                                                     MD026969
     C           *LOCK     IN   LDA                                                         MD026969
     C                     MOVEL'LER135'  DBPGM                                             MD026969
     C                     MOVEL'ZDATE2  'DBFILE           ************                     MD026969
     C**********           Z-ADD012       DBASE            * DBERR 12 *            MD026969 MD033473
     C                     Z-ADD039       DBASE            * DBERR 39 *                     MD033473
     C                     OUT  LDA                        ************                     MD026969
     C                     EXSR *PSSR                                                       MD026969
     C                     END                                                              MD026969
     C                     MOVE ZADATE    RSDAT                                             MD026969
     C                     ELSE                                                             MD033473
     C                     MOVE *BLANKS   RSDAT                                             MD033473
     C                     ENDIF                                                            MD033473
      *                                                                                     MD026969
     C                     MOVELFZFCCY    ##KC                                              MD026969
     C                     EXSR ##CHKC                                                      MD026969
     C           ##FIC     IFEQ 'Y'                                                         MD026969
     C                     Z-ADDCCDP,Q    CDP                                               MD026969
     C                     ENDIF                                                            MD026969
     C                     Z-ADDCDP       DP                                                MD026969
     C           DP        ADD  4         P                                                 MD026969
     C                     MOVEA'0000'    *IN,50                                            MD026969
     C                     ADD  50        DP                                                MD026969
     C                     MOVE '1'       *IN,DP                                            MD026969
     C                     Z-ADDFZAMTP    RAMTP0                                            MD026969
      *                                                                                     MD026969
     C           *IN82     IFEQ '1'                                                         MD026969
     C                     ADD  1         PAGE                                              MD026969
     C                     WRITEHEADP3                                                      MD026969
     C                     MOVE '0'       *IN82                                             MD026969
     C                     ENDIF                                                            MD026969
      *                                                                                     MD026969
     C                     WRITEDETAIL3                                                     MD026969
     C                     ENDIF                                                            MD026969
     C                     READ LEFZASPD                 54                                 MD026969
     C                     ENDDO                                                            MD026969
      *                                                                                     MD026969
     C           *IN82     IFEQ '1'                                                         MD026969
     C                     ADD  1         PAGE                                              MD026969
     C                     WRITEHEADP3                                                      MD026969
     C                     MOVE '0'       *IN82                                             MD026969
     C                     ENDIF                                                            MD026969
     C           COUNT     IFGT 0                                                           MD026969
     C                     MOVE '0'       *IN54                                             MD026969
     C                     ELSE                                                             MD026969
     C                     MOVE '1'       *IN54                                             MD026969
     C                     ENDIF                                                            MD026969
     C                     WRITETRAILP3                                                     MD026969
      *                                                                                     MD026969
     C                     ENDSR                                                            MD026969
      *****************************************************************                     MD026969
      /EJECT                                                                                MD026969
      *****************************************************************                     MD026969
     C/TITLE SR/AUDIT
      *****************************************************************
      *
      *  AUDIT - Audit spool file processed through ZSFILE.
      *
      *  CALLED FROM:  Main Processing, *PSSR
      *
      *  CALLS:  ZSFILE
      *
      *****************************************************************
      *
     C           AUDIT     BEGSR
      *
     C                     Z-ADD0         PAGE
      *
     C                     Z-ADDSFNUMU    ZSNUMU
     C                     CALL 'ZSFILE'
     C                     PARM           SEQ
     C                     PARM *BLANKS   SENTY
     C                     PARM           SFILEU
     C                     PARM           ZSNUMU  60
     C                     PARM           ZSERR
      *
      ** Error during ZSFILE processing, return to calling program
      *
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
      *
     C                     ENDSR
      *
     C/COPY WNCPYSRC,LER135C044
      *****************************************************************
     C/TITLE STANDARD MIDAS SUBROUTINES USED IN PROGRAM
      *****************************************************************
      *
      *  STANDARD MIDAS SUBROUTINES
      *
      *  CALLED FROM: Various
      *
      *  CALLS:       Various
      *
      *****************************************************************
      *
     C/COPY ZSRSRC,ZFREQBZ2
      *
     C/COPY ZSRSRC,ZDATE1Z2
      *
     C/COPY ZSRSRC,ZDATE2Z2
      *
     C/COPY ZSRSRC,ZFWDT
      *
     C/COPY ZSRSRC,ZBKDT
      *
     C/COPY ZSRSRC,ZACCH
      *
     C/COPY ZSRSRC,ZCHKH
      *
     C/COPY ZSRSRC,ZHASHZ3
      *
     C/COPY ZSRSRC,ZXRATEZ1
      *
     C/COPY ZSRSRC,ZCONVZ1
      *                                                                                       CLE141
     C/COPY ZSRSRC,ZFRQB3                                                                     CLE141
      ********************************************************************                    218992
     C/TITLE SR/CHKCCY                                                                        218992
      ********************************************************************                    218992
      *                                                                                       218992
      * CHKCCY - CHECK EVENT CURRENCY NUMBER OF DECIMAL PLACES                                218992
      *                                                                                       218992
      *  CALLED FROM: PRTEVT, GENKEY                                                          218992
      *                                                                                       218992
      *  CALLS:                                                                               218992
      *                                                                                       218992
      ********************************************************************                    218992
      *                                                                                       218992
     C           CHKCCY    BEGSR                                                              218992
      *                                                                                       218992
      ** Check number of decimal places in currency:                                          218992
     C                     Z-ADD1         K       30                                          218992
     C           LKECCY    LOKUPCURR,K                   13                                   218992
      *                                                                                       218992
      ** Switch on indicator for Number of Decimal PLaces                                     218992
     C                     Z-ADDCCDP,K    DP                                                  218992
     C                     MOVEA'0000'    *IN,30                                              218992
     C                     ADD  30        DP                                                  218992
     C                     MOVE '1'       *IN,DP                                              218992
      *                                                                                       218992
     C                     ENDSR                                                              218992
      *                                                                                       218992
      *****************************************************************                     MD052216
     C/TITLE SR/CCYLOC                                                                      MD052216
      *****************************************************************                     MD052216
      *                                                                                     MD052216
      *  CCYLOC - Set currency & location depending on settlement type                      MD052216
      *                                                                                     MD052216
      *  CALLED FROM: UPDFEE, CHKPAY                                                        MD052216
      *                                                                                     MD052216
      *  CALLS:                                                                             MD052216
      *                                                                                     MD052216
      *****************************************************************                     MD052216
     C           CCYLOC    BEGSR                                                            MD052216
      *                                                                                     MD052216
      ** If Fee Settlement type is '01', '02', '07', '08' or '12',                          MD052216
      ** use Fee Currency and Nostro location                                               MD052216
      *                                                                                     MD052216
     C           FESTTL    IFEQ 01                                                          MD052216
     C           FESTTL    OREQ 02                                                          MD052216
     C           FESTTL    OREQ 07                                                          MD052216
     C           FESTTL    OREQ 08                                                          MD052216
     C           FESTTL    OREQ 12                                                          MD052216
      *                                                                                     MD052216
     C                     MOVELFEFCCY    PCURR                                             MD053873
      *                                                                                     MD053873
     C           CLE031    IFEQ 'Y'                                                         MD053873
      *                                                                                     MD053873
     C           PTFI      IFEQ *BLANKS                                                     MD053873
     C           FESCCY    ANDNE*BLANKS                                                     MD053873
     C                     MOVELFESCCY    PCURR                                             MD053873
     C                     ENDIF                                                            MD053873
      *                                                                                     MD053873
     C           PTFI      IFNE *BLANKS                                                     MD053873
     C           FEPSCY    ANDNE*BLANKS                                                     MD053873
     C                     MOVELFEPSCY    PCURR                                             MD053873
     C                     ENDIF                                                            MD053873
      *                                                                                     MD053873
     C                     ENDIF                                                            MD053873
      *                                                                                     MD053873
     C                     CALL 'AONOSTR0'                                                  MD052216
     C                     PARM *BLANKS   PRTCD   7                                         MD052216
     C                     PARM '*KEY   ' POPTN   7                                         MD052216
     C                     PARM *BLANKS   PCUSN   6                                         MD052216
     C**********           PARM FEFCCY    PCURR   3                                MD052216 MD053873
     C                     PARM           PCURR   3                                         MD053873
     C                     PARM *BLANKS   PACCD  10                                         MD052216
     C                     PARM *BLANKS   PACSN   2                                         MD052216
     C                     PARM FEOURS    PNONB   2                                         MD052216
     C                     PARM *BLANKS   PBRCA   3                                         MD052216
     C                     PARM *BLANKS   PCSSN  10                                         MD052216
     C                     PARM *BLANKS   PPNOI   1                                         MD052216
     C           SDNOST    PARM SDNOST    DSFDY                                             MD052216
      *                                                                                     MD052216
     C           PRTCD     IFNE *BLANKS                                                     MD052216
     C           *LOCK     IN   LDA                                                         MD052216
     C                     MOVEL'AONOSTR0'DBFILE                                            MD052216
     C                     Z-ADD56        DBASE                                             MD052216
     C                     MOVELFEFCCY    DBKEY                                             MD052216
     C                     OUT  LDA                                                         MD052216
     C                     EXSR *PSSR                                                       MD052216
     C                     ELSE                                                             MD052216
      *                                                                                     MD052216
     C**********           MOVELFEFCCY    ZCCY                                     MD052216 MD053873
     C                     MOVELPCURR     ZCCY                                              MD053873
     C                     MOVE A7NOSN    ZLOC                                              MD052216
     C                     ENDIF                                                            MD052216
      *                                                                                     MD052216
     C                     ELSE                                                             MD052216
      *                                                                                     MD052216
      ** For other settlement types, use Local Currency & Location                          MD052216
      *                                                                                     MD052216
     C                     MOVE BJLCCY    ZCCY                                              MD052216
     C                     MOVE BJSLCD    ZLOC                                              MD052216
      *                                                                                     MD052216
     C                     ENDIF                                                            MD052216
      *                                                                                     MD052216
     C                     ENDSR                                                            MD052216
      *****************************************************************                     MD052216
     C/TITLE SR/NXTPAY                                                                      MD052216
      *****************************************************************                     MD052216
      *                                                                                     MD052216
      *  NXTPAY - Adjust Next Fee Payment Date based on Pay Due Ind                         MD052216
      *                                                                                     MD052216
      *  CALLED FROM: UPDFEE                                                                MD052216
      *                                                                                     MD052216
      *  CALLS:                                                                             MD052216
      *                                                                                     MD052216
      *****************************************************************                     MD052216
     C           NXTPAY    BEGSR                                                            MD052216
      *                                                                                     MD052216
     C                     Z-ADDWFPBDT    ZDAYNO                                            MD052216
     C                     Z-ADDWFPBDT    ZDYNBR                                            MD052216
      *                                                                                     MD052216
     C                     SELEC                                                            MD052216
      *                                                                                     MD052216
     C           WPDDI     WHEQ 'A'                                                         MD052216
     C                     Z-ADDZDAYNO    ZDYNBR                                            MD052216
      *                                                                                     MD052216
     C           WPDDI     WHEQ 'P'                                                         MD052216
     C                     EXSR ZBKDT                                                       MD052216
      *                                                                                     MD052216
     C           WPDDI     WHEQ 'N'                                                         MD052216
     C                     EXSR ZFWDT                                                       MD052216
      *                                                                                     MD052216
     C           WPDDI     WHEQ 'M'                                                         MD052216
     C           WPDDI     OREQ *BLANK                                                      MD052216
     C                     EXSR ZDATE2                                                      MD052216
     C           *IN98     IFEQ *OFF                                                        MD052216
     C                     MOVE ZDATE     MMYY    40P                                       MD052216
     C                     MOVELMMYY      MMNLCD  20P                                       MD052216
     C                     ELSE                                                             MD052216
     C                     MOVELZDATE     MMNLCD    P                                       MD052216
     C                     ENDIF                                                            MD052216
     C                     Z-ADDZDAYNO    @DAYNO  50                                        MD052216
     C                     EXSR ZFWDT                                                       MD052216
     C                     Z-ADDZDYNBR    ZDAYNO                                            MD052216
     C                     EXSR ZDATE2                                                      MD052216
     C           *IN98     IFEQ *OFF                                                        MD052216
     C                     MOVE ZDATE     MMYY      P                                       MD052216
     C                     MOVELMMYY      MMNWKD  20P                                       MD052216
     C                     ELSE                                                             MD052216
     C                     MOVELZDATE     MMNWKD    P                                       MD052216
     C                     ENDIF                                                            MD052216
     C           MMNLCD    IFNE MMNWKD                                                      MD052216
     C                     Z-ADD@DAYNO    ZDAYNO                                            MD052216
     C                     EXSR ZBKDT                                                       MD052216
     C                     ENDIF                                                            MD052216
      *                                                                                     MD052216
     C                     ENDSL                                                            MD052216
      *                                                                                     MD052216
     C                     ENDSR                                                            MD052216
      *****************************************************************                     MD052216
     C/TITLE SR/CHKPAY                                                                      MD052216
      *****************************************************************                     MD052216
      *                                                                                     MD052216
      *  CHKPAY - Check Payment Taken Day Indicator                                         MD052216
      *                                                                                     MD052216
      *  CALLED FROM: Main Processing                                                       MD052216
      *                                                                                     MD052216
      *  CALLS: CCYLOC                                                                      MD052216
      *                                                                                     MD052216
      *****************************************************************                     MD052216
     C           CHKPAY    BEGSR                                                            MD052216
      *                                                                                     MD052216
     C                     Z-ADDWNWDAT    ZDAYNO                                            MD052216
     C                     Z-ADDWNWDAT    ZDYNBR                                            MD052216
     C                     Z-ADD*ZEROS    ZNRDYS                                            MD052216
     C                     EXSR CCYLOC                                                      MD052216
      *                                                                                     MD052216
     C           CLE141    IFEQ 'Y'                                                         MD052216
     C           FELOAN    ANDNE*BLANKS                                                     MD052216
      *                                                                                     MD052216
     C                     MOVELZCCY      CCYLL                                             MD052216
     C                     MOVELZLOC      LOCLL                                             MD052216
     C           FELOAN    CHAINCLOAN                95                                     MD054101
     C           WPTDI     IFEQ *BLANK                                                      MD052216
     C                     MOVEL'M'       PAYIND                                            MD052216
     C                     ELSE                                                             MD052216
     C                     MOVELWPTDI     PAYIND                                            MD052216
     C                     ENDIF                                                            MD052216
     C                     CALL 'LEZBDYCD'BDCHK                                             MD052216
     C                     MOVELZADJDT    ZDYNBR                                            MD052216
      *                                                                                     MD052216
     C                     ELSE                                                             MD052216
     C                     SELEC                                                            MD052216
      *                                                                                     MD052216
     C           WPTDI     WHEQ 'P'                                                         MD052216
     C                     EXSR ZBKDT                                                       MD052216
      *                                                                                     MD052216
     C           WPTDI     WHEQ 'N'                                                         MD052216
     C                     EXSR ZFWDT                                                       MD052216
      *                                                                                     MD052216
     C           WPTDI     WHEQ 'M'                                                         MD052216
     C           WPTDI     OREQ *BLANK                                                      MD052216
     C                     EXSR ZDATE2                                                      MD052216
     C           *IN98     IFEQ *OFF                                                        MD052216
     C                     MOVE ZDATE     MMYY      P                                       MD052216
     C                     MOVELMMYY      MMNLCD    P                                       MD052216
     C                     ELSE                                                             MD052216
     C                     MOVELZDATE     MMNLCD    P                                       MD052216
     C                     ENDIF                                                            MD052216
     C                     Z-ADDZDAYNO    @DAYNO                                            MD052216
     C                     EXSR ZFWDT                                                       MD052216
     C                     Z-ADDZDYNBR    ZDAYNO                                            MD052216
     C                     EXSR ZDATE2                                                      MD052216
     C           *IN98     IFEQ *OFF                                                        MD052216
     C                     MOVE ZDATE     MMYY      P                                       MD052216
     C                     MOVELMMYY      MMNWKD    P                                       MD052216
     C                     ELSE                                                             MD052216
     C                     MOVELZDATE     MMNWKD    P                                       MD052216
     C                     ENDIF                                                            MD052216
     C           MMNLCD    IFNE MMNWKD                                                      MD052216
     C                     Z-ADD@DAYNO    ZDAYNO                                            MD052216
     C                     EXSR ZBKDT                                                       MD052216
     C                     ENDIF                                                            MD052216
      *                                                                                     MD052216
     C                     ENDSL                                                            MD052216
     C                     ENDIF                                                            MD052216
      *                                                                                     MD052216
     C           *LIKE     DEFN WNWDAT    WNPAYD                                            MD052216
     C                     Z-ADDZDYNBR    WNPAYD                                            MD052216
      *                                                                                     MD052216
     C                     ENDSR                                                            MD052216
      *****************************************************************
     C/TITLE SR/*PSSR
      *****************************************************************
      *
      *  *PSSR - subroutine to perform database error processing
      *
      *  CALLED FROM: Various
      *
      *  CALLS:  Audit
      *
      *****************************************************************
      *
     C           *PSSR     BEGSR
      *
      ***  Check to see that *PSSR has not already been called.
      *
     C           WRUN      IFEQ *BLANK
     C                     MOVE 'Y'       WRUN    1
      *
     C                     SETON                     U7U8
     C                     DUMP
      *
     C                     EXSR AUDIT
     C                     WRITELER135C1
     C                     WRITEERROR
     C                     END
      *
     C                     SETON                     U7U8LR
     C                     RETRN
      *
     C                     ENDSR
      *****************************************************************                       CLE164
      *    SRRETRPKY - Retrieve LEACCTPD Repayment Priorities         *                       CLE164
      *****************************************************************                       CLE164
     C           SRRPKY    BEGSR                                                              CLE164
      *                                                                                       CLE164
     C                     CALL 'LE000801'                                                    CLE164
     C                     PARM *BLANKS   PRETC   7                                           CLE164
     C                     PARM SECATC    PCATC   5                                           CLE164
     C                     PARM 'LEFEEZTD'PFILE  10                                           CLE164
     C                     PARM FELOAN    PLOAN   6                                           CLE164
     C                     PARM FEBRCA    PBRCH   3                                           CLE164
     C                     PARM FECNUM    PCNUM   6                                           CLE164
     C                     PARM FEFACL    PFCLTY                                              CLE164
     C                     PARM FEFSEQ    PFESEQ                                              CLE164
     C                     PARM *ZEROS    PREPR                                               CLE164
     C                     PARM *ZEROS    PCAPR                                               CLE164
     C                     PARM *BLANKS   SEOVFL                                              CLE164
      *                                                                                       CLE164
     C                     MOVELPREPR     SEREPR                                              CLE164
     C                     MOVELPCAPR     SECAPR                                              CLE164
      *                                                                                       CLE164
     C                     ENDSR                                                              CLE164
      *****************************************************************                       CLE164
      *  ORIGB - Display Original Borrower on report                  *                     MD055481
      *                                                               *                     MD055481
      *  Called by: Main Processing                                   *                     MD055481
      *  Calls: None                                                  *                     MD055481
      *****************************************************************                     MD055481
     C           ORIGB     BEGSR                                                            MD055481
      *                                                                                     MD055481
      ** If participation purchased and system value is using Original                      MD055481
      ** Borrower.                                                                          MD055481
      *                                                                                     MD055481
     C                     MOVE *BLANKS   POLNO                                             MD055481
     C                     MOVEL*BLANKS   KEYC   10                                         MD055481
     C                     MOVELBBCRNM    WBCRNM 20                                         MD055481
     C           WPTYP     IFEQ 64                                                          MD055481
     C           WPTYP     OREQ 65                                                          MD055481
     C           WPTYP     OREQ 68                                                          MD055481
     C           WPTYP     OREQ 71                                                          MD055481
     C                     MOVE '1'       *IN36                                             MD055481
     C                     MOVE WOLNO     POLNO                                             MD055481
     C                     MOVELPOLNO     KEYC                                              MD055481
      *                                                                                     MD055481
      ** Get original borrower customer name.                                               MD055481
      *                                                                                     MD055481
     C                     CALL 'AOCUSTR0'                                                  MD055481
     C                     PARM '*BLANKS' WRTCD                                             MD055481
     C                     PARM '*KEY   ' WOPTN                                             MD055481
     C                     PARM           KEYC                                              MD055481
     C                     PARM           KEYSTS  7                                         MD055481
     C           SDCUST    PARM SDCUST    DSSDY                                             MD055481
     C           WRTCD     IFEQ *BLANKS                                                     MD055481
     C           WRTCD     OREQ '*CUSCLS'                                                   MD055481
     C                     MOVE BBCRNM    OLNORN                                            MD055481
     C                     ELSE                                                             MD055481
     C           *LOCK     IN   LDA                                                         MD055481
     C                     MOVEL'LER135'  DBPGM                                             MD055481
     C                     MOVELPOLNO     DBKEY            ************                     MD055481
     C                     MOVEL'SDCUSTPD'DBFILE           * DBERR 39 *                     MD055481
     C                     Z-ADD039       DBASE            ************                     MD055481
     C                     OUT  LDA                                                         MD055481
     C                     EXSR *PSSR                                                       MD055481
     C                     ENDIF                                                            MD055481
     C                     ENDIF                                                            MD055481
     C                     MOVELWBCRNM    BBCRNM                                            MD055481
      *                                                                                     MD055481
     C                     ENDSR                                                            MD055481
      ********************************************************************                  MD055481
      *
      /TITLE SR/ZINTDY                                                    CLE013
     C/COPY ZSRSRC,ZINTDYZ2                                               CLE013
      /TITLE SR/ZDATE9                                                    CLE013
     C/COPY ZSRSRC,ZDATE9Z3                                               CLE013
      /TITLE SR/ZDAT10                                                    CLE013
     C/COPY ZSRSRC,ZDAT10Z2                                               CLE013
      *****************************************************************
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
**   TABCAL/TABCBS - CALCULATION BASES.
136500236000336000436500536000636600
**   TABACC/TABACN - FACILITY ACTIONS. (BH0131 - ADD 'TO' TO PAYDUEDT)
WOWRITE OFF
REREPAYMENT
MTMATURITY
ICINTEREST CAITALISATION
PIPRINCIPAL INCREASE
PDPRINCIPAL DECREASE
STLOAN START
FIFACILITY INCREASE
FDFACILITY DECREASE
RCCHANGE TO REVOLVING CR IND
RVREVERSAL
PYTO PAYMENT DUE DATE
TCFACILITY TYPE CHANGE                                                    CLE005
FRFACILITY REACTIVATION                                                   CLE005
FEFACILITY EXPIRY                                                         CLE005
FCFACILITY CLOSURE                                                        CLE005
USUTILISATION START                                                       CLE005
UIUTILISATION INCREASE                                                    CLE005
UDUTILISATION DECREASE                                                    CLE005
UEUTILISATION EXPIRY                                                      CLE005
MCMULTI-CCY REDRAW                                                                            194912
ROROLLOVER - FCLTY EXCH RATE                                                                  CLE023
CHCHARGES ADDED-ON                                                                            CLE028
IAINTEREST ADDED-ON                                                                           CLE028
RDRATE CHANGE                                                                                 258414
     X/COPY WNCPYSRC,LEH00381
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**  MSG  - FEE CALCULATION TYPE NARRATIVES.
AVERAGE AVAILABLE AMOUNT, TIERED RATES
AVERAGE AVAILABLE AMOUNT, THRESHOLD RATES
AVERAGE AVAILABLE AMOUNT, SINGLE RATE
ACTUAL AVAILABLE AMOUNT, TIERED RATES
ACTUAL AVAILABLE AMOUNT, THRESHOLD RATES
ACTUAL AVAILABLE AMOUNT, SINGLE RATE
AVERAGE OUTSTANDING AMOUNT, TIERED RATES
AVERAGE OUTSTANDING AMOUNT, THRESHOLD RATES
AVERAGE OUTSTANDING AMOUNT, SINGLE RATE
ACTUAL OUTSTANDING AMOUNT, TIERED RATES
ACTUAL OUTSTANDING AMOUNT, THRESHOLD RATES
ACTUAL OUTSTANDING AMOUNT, SINGLE RATE
AVERAGE FACILITY AMOUNT, SINGLE RATE
ACTUAL FACILITY AMOUNT, SINGLE RATE
LOAN, FIXED AMOUNT                                                                            CLE073
LOAN, ORIGINAL AMOUNT, SINGLE RATE                                                            CLE073
LOAN, CURRENT AMOUNT, SINGLE RATE                                                             CLE073
LOAN, LATE FEE                                                                                CLE134
**   ZFMD  -  NUMBER OF DAYS IN THE MONTH
312831303130313130313031
** STAMP - Dummy timestamp                                                                    CLE034
0001-01-01-00.00.00.000000                                                                    CLE034
**   SVAL  -  SYSTEM VALUES ARRAY                                                             218782
Settlement09Postings                                                                          218782
PDCLFeeSetAccount                                                                             CLE134
ZeroPDFeeSettlements                                                                        MD026969
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN    CLE013
00366007310109601461                                                      CLE013
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR       CLE013
00000000310005900090001200015100181002120024300273003040033400365         CLE013
