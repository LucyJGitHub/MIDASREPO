     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas LE Lending fees input today')                    *
     F*****************************************************************
     F*                                                               *
     F*  Midas Customer Lending Module                            *
     F*                                                               *
     F*  LER140 - Lending Fees Input Today                            *
     F*                                                               *
     F*  Function: This report program runs in COB and reports all    *
     F*  (COB)     fees input, amended or deleted today               *
     F*                                                               *
     F*  Called By:LERC14                                             *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. AR375891B          Date 26Aug20               *
      *  Prev Amend No. MD055481           Date 04Sep20               *
      *                 MD052216           Date 04Apr19               *
      *                 CER050             Date 16Jun19               *
      *                 MD046248           Date 27Oct17               *
      *                 AR990753           Date 25Jan13               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 AR801992           Date 27Jul12               *
      *                 AR883268           Date 03Jan12               *
      *                 AR750543A          Date 03May11               *
      *                 CRE075             Date 06Dec10               *
      *                 CLE139             Date 06Dec10               *
      *                 AR745952           Date 18Apr11               *
      *                 CLE073             Date 13May08               *
      *                 CER059             Date 19Jul10               *
      *                 CER047             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 CAS016             Date 28Feb06               *
      * Midas Plus 1.4 Base ------------------------------------------*
      *                 244377             Date 13Dec06               *
      *                 244452             Date 14Dec06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CLE042             Date 06Sep05               *
      *                 CLE106             Date 01Aug04               *
      *                 CLE038             Date 04Jun04               *
      *                 CSD027             Date 09Dec05               *
      *                 CAS009             Date 04May04               *
      *                 BUG7109            Date 11May05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 CLE034             Date 05May03               *
      *                 CLE031             Date 04Feb03               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 204452             Date 02May02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 199456             Date 20Dec01               *
      *                 193475             Date 29Nov01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 179741             Date 27Mar01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 187798             Date 07Mar01               *
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CLE009             Date 26Apr99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 159258             Date 21Apr99               *
      *                 156498             Date 11Mar99               *
      *                 147935             Date  2Mar99               *
      *                 141453             Date 17Feb99               *
      *                 140833             Date 16Feb99               *
      *                 133792             Date 12May98               *
     F*                 138889             Date 08Sep98               *
     F*                 CLE005             Date 22May97               *
     F*                 127966             Date 13Oct97               *
     F*                 S01408             Date 05Sep96               *
     F*                 093577             Date 20Jun96               *
     F*                 100515             DATE 22MAY96               *
     F*                 083304             DATE 23FEB96               *
     F*                 060529             DATE 22FEB94               *
     F*                 062440             DATE 31NOV93               *
     F*                 BH3516             DATE 07SEP92               *
     F*                 BH3489             DATE 28AUG92               *
     F*                 BH3418             DATE 13JUL92               *
     F*                 BH3407             DATE 08JUL92               *
     F*                 0097               DATE 07JUL92               *
     F*                 E33172             DATE 20MAR92               *
     F*                 MOF60              DATE 28MAY91               *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  AR375891B - Report shows receipt settlement instructions. It *
      *              should be the payment side for parts sold loans. *
      *              (Child: AR375892)                                *
      *  MD055481 - Show the original borrower on the report for loan *
      *             fees attached to a participation purchased if the *
      *             system value 'LoanCustOriginPurch' is equal to 'O'*
      *  MD052216 - Lending Fee's Payment Due and Taken Day           *
      *  CER050 - Annualised Percentage Rate (Recompile)              *
      *  MD046248 - Finastra Rebranding                               *
      *  AR990753 - Component LERC14 failed during COB. Remove FOOB   *
      *             checking for records amended. (Child: AR990754)   *
      *           - Applied for AR1081542                             *
      *  CLE134 - Past Due Call Loan Processing                       *
      *  CLE148 - Alpha Loan Reference (Recompile)                    *
      *  AR801992 - Component LERC14 failed due to fee settled to a   *
      *             closed account. Amend Component LERC14 would not  *
      *             fail and continue to report fee details even if   *
      *             settlement account is not found in ACCNTAB.       *
      *             (Child: AR801993)                                 *
      *  AR883268 - LERC14 00001 File out of balance on LER140AU      *
      *  AR750543A - Trailer update needs to be amended as fee        *
      *              capitalised and paid are already separated       *
      *              (Child: AR750544)                                *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  CLE139 - Lending Fee Capitalisation                          *
      *  AR745952 - Replace indicator 45, 46 and 47 (Child:AR745953)  *
      *  CLE073 - Calculated Loan Based Fees                          *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *           (Recompile)                                         *
      *  CAS016 - IAS18 EIR Recalculation (Fee Amortisation Over      *
      *           Whole Period)                                       *
      *  244377 - Customer number/name/town not printed for fee       *
      *           booked for same customer but different branch.      *
      *  244452 - Missing action code in the report when a fee has    *
      *           been authorised and amended on the same day.        *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CLE042 - Extended Loan Sub Type (Recompile)                  *
      *  CLE106 - Syndications Manager.                               *
      *  CLE038 - Lending Enhancement for Nordea: Allocation by Amount*
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CAS009 - Effective Interest Rate/Amortised Cost Accounting   *
      *  BUG7109 - Settlement details not printed if CLE034 is off    *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CLE034 - Lending Enhancements Phase 1 Priority 1A            *
      *  CLE031 - Lending Enhancements.                               *
      *  204452 - Recompiled due to changed PF/LEFEED.                *
      *  199456 - Do not print PC Reference in LER140P1 if loan       *
      *           manager is switched off.                            *
      *  193475 - 'Receivable', 'Payable' or 'Internal' fee indicator *
      *           will only show on report if CLE006 is ON.           *
      *  179741 - Add settlement currency in the parameter before     *
      *           calling AONOSTR0 to avoid database error.           *
      *  187798 - If CLE006 is switched off, do not show Shared Fee   *
      *           information.                                        *
      *  CLE009 - LE I/C Swift Message Generation for Fees            *
      *           Recompiled due to changes in LEFEED                 *
      *  159258 - Print PC Reference in LER140P1 report. Amend,       *
      *           insert, authorising user fields and pc reference    *
      *           should only be displayed for syndicated lending.    *
      *  156498 - New spacing means report difficult to read          *
      *  147935 - Addition of insert, authorise and amend user        *
      *           profiles to lending reports                         *
      *  141453 - Recompiled due to changes in PF/LEFEED              *
     F*  140833 - Settlement details missing from report.             *
      *  133792 - Overprinting of report                              *
     F*  138889 - Overprinting of report. Recompile over new LER140P1.*
     F*  CLE005 - Customer Lending Enhancements - Others (T3)         *
     F*  127966 - Profit Centre Accounting Development:               *
     F*         - Attach profit centre to lending fees.               *
     F*  S01408 - Add core hooks LER140CCP1                           *
     F*         - Add core hooks LER140CCP2                           *
     F*         - Add core hooks LER140CCP3                           *
     F*         - Add core hooks LER140FFP1                           *
     F*                                                               *
     F*  093577 - Database error in SDCUSTPD at 012 because nostro    *
     F*           code was passed to customer number field instead.   *
     F*           As @THRN and @THRT is not used in the PRTF          *
     F*           anymore, remove this entire section of coding.      *
     F*  100515 - Recompile program due to changes in LEFEED.         *
     A*  083304 - Use the correct fields for control totals.          *
     A*  060529 - Change the Fee Calculation narrative from FULL to   *
     A*           FAC and interchange indicators 30 and 32 in PRTF/   *
     A*           LER140P1 to show the correct narrative on the       *
     F*           report. Recompiled this pgm over new LER140P1.      *
     F*  062440 - Reset Indicators 60 to 63 before setting any one of *
     F*           them on.                                            *
     F*  BH3516 - Put out customer again on overflows                 *
     F*  BH3489 - Overflow problems                                   *
     F*  BH3418 - Change to datastructure for AOACCTR0                *
     F*  BH3407 - Layout changes for the P1 report                    *
     F*  0097   - BHF - Settlement validation incorrect               *
     F*  E33172 - Chain to SDRETLPD conditioned on whether interest   *
     F*           on account module or retail 2 module is present     *
     F*  MOF60  - Customer Fees & Profitability Processing            *
     F*                                                               *
     F*****************************************************************
     F*****************************************************************
     FLEFEED  IP  E           K        DISK
      * Lending Fees - detail
     F/COPY WNCPYSRC,LER140FFP1                                           S01408
      *
     FLEFEEZ  UF  E                    DISK
      *
     FLESTALL5IF  E           K        DISK                                                   CLE034
      ** Midas LE Set. Allocations by Transaction File                                        CLE034
      *                                                                                       CLE034
     FLEFEEQL0IF  E           K        DISK                                                 MD052216
     FCLOAN   IF  E           K        DISK                                                 MD055481
     F            CLOANHHF                          KIGNORE                                 MD055481
     F            CLOANCKF                          KIGNORE                                 MD055481
     F            CLOANZ1F                          KIGNORE                                 MD055481
     FMLOAN   IF  E           K        DISK                                                 MD055481
     F            CLOANHHF                          KIGNORE                                 MD055481
     F            CLOANCKF                          KIGNORE                                 MD055481
     F            CLOANZ1F                          KIGNORE                                 MD055481
     F            CLOANCLF                          KRENAMEMCLONCLF                         MD055481
     FPSOLDL1 IF  E           K        DISK                                                AR375891B
     F            CLOANCLF                          KRENAMEJCLONCLF                        AR375891B
      ** Parts Sold loans                                                                  AR375891B
      *                                                                                    AR375891B
     F/COPY WNCPYSRC,LEH00554
     FLER140P1O   E             80     PRINTER      KINFDS SPOOL      UC
      * Lending Fees Input Today - audit
     FLER140AUO   E                    PRINTER      KINFDS SPOOLU
     F*
     F*   Function of indicators
     F*F* Lending fees input today detail
     F* 01    First Cycle Indicator.
     F* 02    'No Details to Report for this branch' conditioned output
     F* 30-37 Conditions output of fee type narrative
     F* 38-39 Supresses output of zeroes on report
     F* 40    SAR CLE005 is Present                                       CLE005
     F* 41    Receivable Fee Indicator                                    CLE005
     F* 42    Payable Fee Indicator                                       CLE005
     F* 43    SAR CLE010 is Present                                                           199456
     F* 44    READE for LESTALL5                                                              CLE034
     F* 45    Print settlement details or indicator                                           CLE034
      * 49    Fee Calculation Type 90                                                         CLE134
     F* 50    Change of Customer
     F* 51    Fee calculation type greater than Blank
     F* 53    Fee calculation type is percent
     F* 60    Number of Decimal Places = 0
     F* 61    Number of Decimal Places = 1
     F* 62    Number of Decimal Places = 2
     F* 63    Number of Decimal Places = 3
     F* 64    READE for LEFEEQL0                                                            MD052216
     F* 70    Analytical Accounting is installed                          127966
     F* 71    Control totals check indicator
     F* 72    Control totals check indicator
     F* 74    Control totals check indicator
     F* 80    Overflow indicator - LER140P1
     F* 98    Customer Number numeric validation indicator
     F* 99    Access Object Program check indicator
     F* U7&U8 Database error
     F*****************************************************************
     F*
     F* Subroutine Index
     F*
     F* B0000 - Initialization subroutine
     F* C0000 - Report Section subroutine
     F* E0000 - Audit subroutine
     F* SR34  - Settlement allocations report processing for CLE034                           CLE034
     F* *PSSR - Abnormal error subroutine
     F*
     F*****************************************************************
     F/EJECT
     E                    FAR         6  1
     E                    CPY@    1   1 80
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZEDITZ1                                                                    CLE034
     E/EJECT
     ILESTALD0                                                                                CLE034
     I** Rename Settlement Allocations detail fields                                          CLE034
     I              RSTM                            SARSTM                                    CLE034
     I              RSCY                            SARSCY                                    CLE034
     I              RONS                            SARONS                                    CLE034
     I              RCPC                            SARCPC                                    CLE034
     I              PSTM                            SAPSTM                                    CLE034
     I              PSCY                            SAPSCY                                    CLE034
     I              PONS                            SAPONS                                    CLE034
     I              PYPC                            SAPYPC                                    CLE034
     I              SEQ                             SASEQ                                     CLE034
     I              CCY                             SACCY                                     CLE038
      *                                                                                       CLE034
     ICLOANCLF                                                                              MD055481
      ** Rename fields                                                                      MD055481
     I              RECI                            CRECI                                   MD055481
     I              LNRF                            CLNRF                                   MD055481
     I              RCDT                            CRCDT                                   MD055481
     I              PTYP                            CPTYP                                   MD055481
     I              LASQ                            CLASQ                                   MD055481
     I              OLNO                            COLNO                                   MD055481
     I              IUSR                            CIUSR                                   MD055481
     I              AUSR                            CAUSR                                   MD055481
     I              XUSR                            CXUSR                                   MD055481
     I              PCRF                            CPCRF                                   MD055481
     I              OSDB                            COSDB                                   MD055481
     I              OMDB                            COMDB                                   MD055481
     I              RSTM                            CRSTM                                   MD055481
     I              RIBN                            CRIBN                                   MD055481
     I              RIBA                            CRIBA                                   MD055481
     I              ROBN                            CROBN                                   MD055481
     I              ROCN                            CROCN                                   MD055481
     I              PSTM                            CPSTM                                   MD055481
     I              PIBN                            CPIBN                                   MD055481
     I              PIBA                            CPIBA                                   MD055481
     I              POBN                            CPOBN                                   MD055481
     I              POCN                            CPOCN                                   MD055481
     I              RCRN                            CRCRN                                   MD055481
     I              RCRA                            CRCRA                                   MD055481
     I              RVNO                            CRVNO                                   MD055481
     I              AWBN                            CAWBN                                   MD055481
     I              AWBA                            CAWBA                                   MD055481
     I              BENN                            CBENN                                   MD055481
     I              BENA                            CBENA                                   MD055481
     I              DTP1                            CDTP1                                   MD055481
     I              DTP2                            CDTP2                                   MD055481
     I              DTP3                            CDTP3                                   MD055481
     I              DTP4                            CDTP4                                   MD055481
     I              DCHG                            CDCHG                                   MD055481
     I              BTB1                            CBTB1                                   MD055481
     I              BTB2                            CBTB2                                   MD055481
     I              BTB3                            CBTB3                                   MD055481
     I              BTB4                            CBTB4                                   MD055481
     I              BTB5                            CBTB5                                   MD055481
     I              BTB6                            CBTB6                                   MD055481
     I              CVMR                            CCVMR                                   MD055481
     I              PCOB                            CPCOB                                   MD055481
     I              LSWC                            CLSWC                                   MD055481
     I              LSWS                            CLSWS                                   MD055481
     I              FRNT                            CFRNT                                   MD055481
     I              AFRT                            CAFRT                                   MD055481
     I              REPA                            CREPA                                   MD055481
     I              RONS                            CRONS                                   MD055481
     I              PONS                            CPONS                                   MD055481
     IMCLONCLF                                                                              MD055481
      ** Rename fields                                                                      MD055481
     I              RECI                            MRECI                                   MD055481
     I              LNRF                            MLNRF                                   MD055481
     I              RCDT                            MRCDT                                   MD055481
     I              PTYP                            MPTYP                                   MD055481
     I              LASQ                            MLASQ                                   MD055481
     I              OLNO                            MOLNO                                   MD055481
     I              IUSR                            MIUSR                                   MD055481
     I              AUSR                            MAUSR                                   MD055481
     I              XUSR                            MXUSR                                   MD055481
     I              PCRF                            MPCRF                                   MD055481
     I              OSDB                            MOSDB                                   MD055481
     I              OMDB                            MOMDB                                   MD055481
     I              RSTM                            MRSTM                                   MD055481
     I              RIBN                            MRIBN                                   MD055481
     I              RIBA                            MRIBA                                   MD055481
     I              ROBN                            MROBN                                   MD055481
     I              ROCN                            MROCN                                   MD055481
     I              PSTM                            MPSTM                                   MD055481
     I              PIBN                            MPIBN                                   MD055481
     I              PIBA                            MPIBA                                   MD055481
     I              POBN                            MPOBN                                   MD055481
     I              POCN                            MPOCN                                   MD055481
     I              RCRN                            MRCRN                                   MD055481
     I              RCRA                            MRCRA                                   MD055481
     I              RVNO                            MRVNO                                   MD055481
     I              AWBN                            MAWBN                                   MD055481
     I              AWBA                            MAWBA                                   MD055481
     I              BENN                            MBENN                                   MD055481
     I              BENA                            MBENA                                   MD055481
     I              DTP1                            MDTP1                                   MD055481
     I              DTP2                            MDTP2                                   MD055481
     I              DTP3                            MDTP3                                   MD055481
     I              DTP4                            MDTP4                                   MD055481
     I              DCHG                            MDCHG                                   MD055481
     I              BTB1                            MBTB1                                   MD055481
     I              BTB2                            MBTB2                                   MD055481
     I              BTB3                            MBTB3                                   MD055481
     I              BTB4                            MBTB4                                   MD055481
     I              BTB5                            MBTB5                                   MD055481
     I              BTB6                            MBTB6                                   MD055481
     I              CVMR                            MCVMR                                   MD055481
     I              PCOB                            MPCOB                                   MD055481
     I              LSWC                            MLSWC                                   MD055481
     I              LSWS                            MLSWS                                   MD055481
     I              FRNT                            MFRNT                                   MD055481
     I              AFRT                            MAFRT                                   MD055481
     I              REPA                            MREPA                                   MD055481
     I              RONS                            MRONS                                   MD055481
     I              PONS                            MPONS                                   MD055481
      *                                                                                     MD055481
     I            DS
     I* Fee amount editing
     I                                        1  130@DSAMT
     I                                        1  131@DSAM1
     I                                        1  132@DSAM2
     I                                        1  133@DSAM3
      *                                                                                       CLE134
     I            DS                                                                          CLE134
     I                                        1  130FESFA                                     CLE134
     I                                        1  130FESFA1                                    CLE134
     I                                        1  130FESFA2                                    CLE134
     I                                        1  130FESFA3                                    CLE134
     I            DS                                                                          CLE134
     I                                        1  130FESFAM                                    CLE134
     I                                        1  130FESFM1                                    CLE134
     I                                        1  130FESFM2                                    CLE134
     I                                        1  130FESFM3                                    CLE134
     I            DS                                                                          CLE134
     I                                        1  130FEPSLM                                    CLE134
     I                                        1  130FEPSL1                                    CLE134
     I                                        1  130FEPSL2                                    CLE134
     I                                        1  130FEPSL3                                    CLE134
      *
     I            DS
      * Breakdown of THEIR  Nostro
     I                                        1  10 FETHER
     I                                        1   1 @TH1ST
     I                                        1   6 @THCUS
     I                                        1   8 @THNOS
     I            DS
     I                                        1   6 @THC
     I                                        1   7 TESTN6
      *
     I            DS
      * Breakdown of OURS   Nostro
     I**********                              1  12 FEOURS                                    CGL029
     I**********                              1   60@CUST                                     CGL029
     I**********                              7  100@ACCDE                                    CGL029
     I**********                             11  120@SEQ                                      CGL029
     I                                        1  18 FEOURS                                    CGL029
     I**********                              1   60@CUST                              CGL029 CSD027
     I                                        1   6 @CUST                                     CSD027
     I                                        7  160@ACCDE                                    CGL029
     I                                       17  180@SEQ                                      CGL029
      *
     I            DS
     I**********                              1   40@BMAFN                                    CGL029
     I**********                              5   60@SEQ1                                     CGL029
     I                                        1  100@BMAFN                                    CGL029
     I                                       11  120@SEQ1                                     CGL029
      *
     I            DS
     I* Facility datastructure
     I                                        1   6 FAR
     I                                        1   6 @LORF
     ISPOOL       DS
     I* File information - detail report
     I                                       83  92 SFILE
     I                                    B 123 1240SFNUM
     I                                    B 188 1890OLINE                 CLE005
     I                                    B 367 3680LINE
      *
     ISPOOLU      DS
     I* File information - audit
     I                                       83  92 SFILEU
     I                                    B 123 1240SFNUMU
     IPSDS       SDS
     I** Program Status
     I*
     I                                      244 253 JOB
     I                                      254 263 USER
     ILDA       E DSLDA
      * DATABASE ERROR DS
      *
     IRUNDAT    E DS
      ** Data area RUNDAT
     I              AGMBIN                          MBIN
      *
     ISDBANK    E DSSDBANKPD
      ** Bank details
      *
     ISDFEE     E DSSDFEEPD
     I**  EXTERNAL DS FOR FEE CODE DETAILS
     I*
     ISDCURR    E DSSDCURRPD
      ** Currency Type
      *
     ISDBRCH    E DSSDBRCHPD
      ** External DS for branch name details
     I              A8BRNM                          BRNM
      *
     ISDNOST    E DSSDNOSTPD
      ** External DS for customer details
      *
     ISDCUST    E DSSDCUSTPD
     I** External DS for Customer Details
     I              QQDFAC                          DFACQQ                                    CGL029
      *
     ISDMMOD    E DSSDMMODPD                                              E33172
     I** External DS for Midas Module Details                             E33172
     I              BGRTBN                          RETF                  E33172
     I              BGIOAC                          IOAC                  E33172
      *                                                                   E33172
     ID@ACCT    E DSACCNTAB
      ** Account Details DS for assigning data from Access
      ** Programs to work fields
     I*
     ISDCNST    E DSSDCNSTPD
      **   COUNTERPARTY NOSTRO DETAILS
      *
     ISDRETL    E DSSDRETLPD
      **   RETAIL DETAILS
     I              QQACCD                          ACCDQQ                                    CGL029
      *                                                                   CLE005
     ISCSARD    E DSSCSARDPD                                              CLE005
      ** External DS for SAR Details                                      CLE005
     I              LCD                             SALCD                 CLE005
      *
     IDSFDY     E DSDSFDY
      ** First DS for access programs, short data structure
      *
     IDSSDY     E DSDSSDY
      ** Second DS for access programs, long data structure
      *
     I              'LoanCustOriginPurch' C         WPARM                                   MD055481
      *                                                                                     MD055481
     C/EJECT
      *
      ** Set up copyright statement
     C                     MOVEACPY@      BIS@   80
      *
      ** Define LDA
     C           *NAMVAR   DEFN           LDA
      *
      ** Lock in dataarea RUNDAT
     C           *NAMVAR   DEFN           RUNDAT
     C                     IN   RUNDAT
      *
     C           PLIST1    PLIST                            DAY - DATE
     C                     PARM           DATE5   50        conversion
     C                     PARM           DATE6   60
     C                     PARM           DATE7   7
     C                     PARM           GRTCD   1
      *
     C           KEY001    KLIST
     C                     KFLD           @CUST            Key to
     C                     KFLD           FEFCCY           account file
     C                     KFLD           @ACCDE
     C                     KFLD           @SEQ
      *
     C           KEY002    KLIST
     C                     KFLD           FEFCCY
     C                     KFLD           A7NONB
      *
     C           KEY003    KLIST
     C                     KFLD           FECNUM           Key to
     C                     KFLD           FEFCCY           account file
     C**********           KFLD           @BMAFN  40                                          CGL029
     C                     KFLD           @BMAFN                                              CGL029
     C                     KFLD           @SEQ1   20
      *
     C           KEY004    KLIST                                                            MD052216
     C                     KFLD           FECNUM                                            MD052216
     C                     KFLD           FEFACL                                            MD052216
     C                     KFLD           FELOAN                                            MD052216
     C                     KFLD           FEFSEQ                                            MD052216
      *                                                                                     MD052216
     C           KSTALL    KLIST                                                              CLE034
     C                     KFLD           KTYPE   4                                           CLE034
     C                     KFLD           FELOAN                                              CLE034
     C                     KFLD           KVDAT   50                                          CLE034
     C                     KFLD           KLASQ   30                                          CLE034
     C                     KFLD           FECNUM                                              CLE034
     C                     KFLD           FEFACL                                              CLE034
     C                     KFLD           FEFSEQ                                              CLE034
     C/COPY WNCPYSRC,LEH00555
      *                                                                                       CLE034
     C                     MOVE 'A'       KRCDT                                             MD055481
     C           KCLOAN    KLIST                                                            MD055481
     C                     KFLD           FELOAN                                            MD055481
     C                     KFLD           KRCDT   1                                         MD055481
      *                                                                                     MD055481
     C                     SETOF                     80
      *
     C/COPY WNCPYSRC,LER140CCP1                                           S01408
     C           *LIKE     DEFN FECNUM    @FECNO           Prev FECNUM
      *
     C           *IN01     IFEQ '0'
     C                     EXSR B0000
     C                     END
      *                                                                                     MD055481
     C                     SETOF                     56                                     MD055481
     C           FELOAN    IFNE *BLANKS                                                     MD055481
     C           PPCUST    ANDEQ'O'                                                         MD055481
     C                     MOVE *BLANKS   POLNO                                             MD055481
      *                                                                                     MD055481
      ** Check on MCLONCL if loan is not found in CLOANCL                                   MD055481
      *                                                                                     MD055481
     C           KCLOAN    CHAINCLOAN                88                                     MD055481
     C           *IN88     IFEQ '0'                                                         MD055481
     C                     MOVE COLNO     WOLNO   6                                         MD055481
     C                     MOVE CPTYP     WPTYP   20                                        MD055481
     C                     EXSR ORIGB                                                       MD055481
     C                     ELSE                                                             MD055481
     C           KCLOAN    CHAINMLOAN                88                                     MD055481
     C           *IN88     IFEQ '0'                                                         MD055481
     C                     MOVE MOLNO     WOLNO                                             MD055481
     C                     MOVE MPTYP     WPTYP                                             MD055481
     C                     EXSR ORIGB                                                       MD055481
     C                     ENDIF                                                            MD055481
     C                     ENDIF                                                            MD055481
     C                     ENDIF                                                            MD055481
      *                                                                                     MD055481
     C                     ADD  1         @REC    50
     C           FECAPI    IFEQ 'Y'                                                        AR750543A
     C                     ADD  1         @CPREC  50                                       AR750543A
     C                     ELSE                                                            AR750543A
     C                     ADD  1         @PDREC  50                                       AR750543A
     C                     ENDIF                                                           AR750543A
     C           @CPREC    ADD  @PDREC    @COUNT                                           AR750543A
     C           BJRDNB    CASEQFELCHD    C0000
     C                     END
      *
      * If no record found initial subroutine needs to be executed here
      *
     CLRN01                EXSR B0000                      initial s/r
      *
     CLR         @REP      IFNE 0
     CLR                   WRITELER140T2
     CLR                   END
     CLR                   EXSR E0000
     C/EJECT
      ****************************************************************
      *  INITIALIZATION SUBROUTINE :
      *
      *  CALLED FROM MAIN PROCESSING, CALLS NOTHING.
      ****************************************************************
     C           B0000     BEGSR
      *
     C                     SETON                     0180
     C                     SETOF                     02
     C                     Z-ADD60        LINE
     C                     Z-ADD0         @DSAMT
     C                     MOVE *BLANKS   WKLOAN  6                                        AR375891B
     C                     MOVEL'LER140'  DBPGM
     C/COPY WNCPYSRC,LER140CCP2                                           S01408
      *
      ** Access bank details
     C                     CALL 'AOBANKR0'             99
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA                          **********
     C                     Z-ADD1         DBASE              * DBERR  01 *
     C                     MOVEL'BANK'    DBKEY              *************
     C                     MOVEL'SDBANKPD'DBFILE
     C                     MOVEL'LER140'  DBPGM
     C                     SETON                     U7U8
     C                     OUT  LDA                                         0096
     C                     EXSR E0000
     C*********************OUT  LDA                                         0096
     C                     EXSR *PSSR
     C                     END
      * Fix to define Ind 98 as this is used in ZDATE2                                        CSD027
      * Program compiled previous to CSD027 as it used 98 to decide if a field was numeric    CSD027
      * or not - oooops                                                                       CSD027
     C           BJDFIN    COMP 'M'                      98MMDDYY, 98 ON                      CSD027
      *                                                                                       CSD027
      *                                                                   CLE005
      ** Check if SAR CLE005 is present                                   CLE005
      *                                                                   CLE005
     C                     CALL 'AOSARDR0'                                CLE005
     C                     PARM *BLANKS   P@RTCD  7                       CLE005
     C                     PARM '*KEY   ' P@OPTN  7                       CLE005
     C                     PARM 'CLE005'  P@SARD  6                       CLE005
     C           SCSARD    PARM SCSARD    DSFDY                           CLE005
      *                                                                   CLE005
     C           P@RTCD    IFEQ *BLANKS                                   CLE005
     C                     MOVE *ON       *IN40                           CLE005
     C                     ELSE                                           CLE005
      *                                                                   CLE005
      ** Handle Database Error                                            CLE005
      *                                                                   CLE005
     C           P@RTCD    IFNE '*NRF    '                                CLE005
     C           *LOCK     IN   LDA                                       CLE005
     C                     MOVE 'SCSARDPD'DBFILE           ************   CLE005
     C                     Z-ADD015       DBASE            * DBERR 15 *   CLE005
     C                     MOVEL'CLE005  'DBKEY            ************   CLE005
     C                     MOVEL'LER140'  DBPGM                           CLE005
     C                     SETON                     U7U8                 CLE005
     C                     OUT  LDA                                       CLE005
     C                     EXSR E0000                                     CLE005
     C                     EXSR *PSSR                                     CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     ENDIF                                          CLE005
      *                                                                   187798
      ** Check if SAR CLE006 is present                                   187798
      *                                                                   187798
     C                     CALL 'AOSARDR0'                                187798
     C                     PARM *BLANKS   P@RTCD  7                       187798
     C                     PARM '*KEY   ' P@OPTN  7                       187798
     C                     PARM 'CLE006'  P@SARD  6                       187798
     C           SCSARD    PARM SCSARD    DSFDY                           187798
      *                                                                   187798
     C           P@RTCD    IFEQ *BLANKS                                   187798
     C                     MOVE *ON       *IN25                           187798
     C                     ELSE                                           187798
      *                                                                   187798
      ** Handle Database Error                                            187798
      *                                                                   187798
     C                     MOVE *OFF      *IN25                           187798
     C           P@RTCD    IFNE '*NRF    '                                187798
     C           *LOCK     IN   LDA                                       187798
     C                     MOVE 'SCSARDPD'DBFILE           ************   187798
     C                     Z-ADD025       DBASE            * DBERR 25 *   187798
     C                     MOVEL'CLE006  'DBKEY            ************   187798
     C                     MOVEL'LER140'  DBPGM                           187798
     C                     SETON                     U7U8                 187798
     C                     OUT  LDA                                       187798
     C                     EXSR E0000                                     187798
     C                     EXSR *PSSR                                     187798
     C                     ENDIF                                          187798
      *                                                                   187798
     C                     ENDIF                                          187798
      *                                                                                       CLE031
      ** Check if CLE031 is                                                                   CLE031
      ** installed in the system                                                              CLE031
      *                                                                                       CLE031
     C                     CALL 'AOSARDR0'                                                    CLE031
     C                     PARM *BLANKS   PRTCD   7                                           CLE031
     C                     PARM '*VERIFY' POPTN   7                                           CLE031
     C                     PARM 'CLE031'  PSARD   6                                           CLE031
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE031
      *                                                                                       CLE031
     C           PRTCD     IFEQ *BLANK                                                        CLE031
     C                     MOVE 'Y'       CLE031  1                                           CLE031
     C                     MOVE *ON       *IN48                                               CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE 'N'       CLE031                                              CLE031
     C                     MOVE *OFF      *IN48                                               CLE031
     C           PRTCD     IFNE '*NRF   '                                                     CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'SCSARDPD'DBFILE    P                                         CLE031
     C                     MOVELPSARD     DBKEY     P                                         CLE031
     C                     Z-ADD26        DBASE                                               CLE031
     C                     MOVEL'LER140'  DBPGM     P                                         CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR E0000                                                         CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE034
      ** Check if CLE034 is installed in the system                                           CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSARDR0'                                                    CLE034
     C                     PARM *BLANKS   PRTCD                                               CLE034
     C                     PARM '*VERIFY' POPTN                                               CLE034
     C                     PARM 'CLE034'  PSARD                                               CLE034
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE034
      *                                                                                       CLE034
     C           PRTCD     IFEQ *BLANK                                                        CLE034
     C                     MOVE 'Y'       CLE034  1                                           CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'N'       CLE034                                              CLE034
     C           PRTCD     IFNE '*NRF   '                                                     CLE034
     C           *LOCK     IN   LDA                                                           CLE034
     C                     MOVEL'SCSARDPD'DBFILE    P                                         CLE034
     C                     MOVELPSARD     DBKEY     P                                         CLE034
     C                     Z-ADD27        DBASE                                               CLE034
     C                     MOVEL'LER140'  DBPGM     P                                         CLE034
     C                     OUT  LDA                                                           CLE034
     C                     EXSR E0000                                                         CLE034
     C                     EXSR *PSSR                                                         CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
     C/COPY WNCPYSRC,LEH00556
      *                                                                                       CLE134
      ** Check if CLE134 is ON                                                                CLE134
      *                                                                                       CLE134
     C                     CALL 'AOSARDR0'                                                    CLE134
     C                     PARM *BLANKS   PRTCD                                               CLE134
     C                     PARM '*VERIFY' POPTN                                               CLE134
     C                     PARM 'CLE134'  PSARD                                               CLE134
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE134
      *                                                                                       CLE134
     C           PRTCD     IFEQ *BLANK                                                        CLE134
     C                     MOVE 'Y'       CLE134  1                                           CLE134
     C                     ELSE                                                               CLE134
     C                     MOVE 'N'       CLE134                                              CLE134
     C                     ENDIF                                                              CLE134
      *
      ** Access RETL details
     C                     CALL 'AOMMODR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C********** SDRETL    PARM SDRETL    DSFDY                             0097
     C           SDMMOD    PARM SDMMOD    DSFDY                             0097
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA                          *************
     C                     MOVEL'LER140'  DBPGM
     C                     Z-ADD2         DBASE              * DBERR  02 *
     C                     MOVEL'MMOD'    DBKEY              *************
     C                     MOVEL'SDMMODPD'DBFILE
     C                     SETON                     U7U8
     C                     OUT  LDA                                         0096
     C                     EXSR E0000
     C*********************OUT  LDA                                         0096
     C                     EXSR *PSSR
     C                     END
      *                                                                   127966
     C           BGN0ST    IFEQ 'Y'                                       127966
     C                     MOVE '1'       *IN70                           127966
     C                     ELSE                                           127966
     C                     MOVE '0'       *IN70                           127966
     C                     ENDIF                                          127966
      *                                                                   E33172
      ** Read SDRETLPD record if Retail 2 or Interest on Accounts         E33172
      ** modules switched on.                                             E33172
      *                                                                   E33172
     C           RETF      IFEQ 'Y'                                       E33172
     C           IOAC      OREQ 'Y'                                       E33172
     C                     CALL 'AORETLR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDRETL    PARM SDRETL    DSFDY
     C                     END                                            E33172
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA                          *************
     C                     Z-ADD2         DBASE              * DBERR  02 *
     C                     MOVEL'RETL'    DBKEY              *************
     C                     MOVEL'SDRETLPD'DBFILE
     C                     MOVEL'LER140'  DBPGM
     C                     SETON                     U7U8
     C                     OUT  LDA                                         0096
     C                     EXSR E0000
     C*********************OUT  LDA                                         0096
     C                     EXSR *PSSR
     C                     END
      *
     C                     MOVE BMACCD    @BMAFN
     C                     Z-ADD1         @SEQ1
      *
     C           MBIN      IFNE 'Y'
     C                     SETON                     33
     C                     END
      *
      ** Check if SAR CLE010 is present                                                       199456
      *                                                                                       199456
     C                     CALL 'AOSARDR0'                                                    199456
     C                     PARM *BLANKS   P@RTCD  7                                           199456
     C                     PARM '*KEY   ' P@OPTN  7                                           199456
     C                     PARM 'CLE010'  P@SARD  6                                           199456
     C           SCSARD    PARM SCSARD    DSFDY                                               199456
      *                                                                                       199456
     C           P@RTCD    IFEQ *BLANKS                                                       199456
     C                     MOVE '1'       *IN43                                               199456
     C                     ELSE                                                               199456
     C                     MOVE '0'       *IN43                                               199456
     C                     ENDIF                                                              199456
      *                                                                                       199456
      ** Access AOSARDR0 and check if CAS009 is installed                                     CAS009
      *                                                                                       CAS009
     C                     CALL 'AOSARDR0'                                                    CAS009
     C                     PARM *BLANKS   P@RTCD                                              CAS009
     C                     PARM '*VERIFY' P@OPTN                                              CAS009
     C                     PARM 'CAS009'  P@SARD                                              CAS009
     C           SCSARD    PARM SCSARD    DSFDY                                               CAS009
      *                                                                                       CAS009
     C           P@RTCD    IFNE *BLANKS                                                       CAS009
     C           P@RTCD    ANDNE'*NRF    '                                                    CAS009
     C                     MOVE 'SCSARDPD'DBFILE                                              CAS009
     C                     MOVEL'016'     DBASE                                               CAS009
     C                     MOVEL'CAS009'  DBKEY                                               CAS009
     C                     MOVE *ON       *INU7                                               CAS009
     C                     MOVE *ON       *INU8                                               CAS009
     C                     EXSR E0000                                                         CAS009
     C                     EXSR *PSSR                                                         CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C           P@RTCD    IFEQ *BLANKS                                                       CAS009
     C                     MOVE 'Y'       CAS009  1                                           CAS009
     C                     ELSE                                                               CAS009
     C                     MOVE 'N'       CAS009                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** Access AOSARDR0 and check if CAS016 is installed                                     CAS016
      *                                                                                       CAS016
     C                     CALL 'AOSARDR0'                                                    CAS016
     C                     PARM *BLANKS   P@RTCD                                              CAS016
     C                     PARM '*VERIFY' P@OPTN                                              CAS016
     C                     PARM 'CAS016'  P@SARD                                              CAS016
     C           SCSARD    PARM SCSARD    DSFDY                                               CAS016
      *                                                                                       CAS016
     C           P@RTCD    IFNE *BLANKS                                                       CAS016
     C           P@RTCD    ANDNE'*NRF    '                                                    CAS016
     C                     MOVE 'SCSARDPD'DBFILE                                              CAS016
     C                     MOVEL'017'     DBASE                                               CAS016
     C                     MOVEL'CAS016'  DBKEY                                               CAS016
     C                     MOVE *ON       *INU7                                               CAS016
     C                     MOVE *ON       *INU8                                               CAS016
     C                     EXSR E0000                                                         CAS016
     C                     EXSR *PSSR                                                         CAS016
     C                     ENDIF                                                              CAS016
      *                                                                                       CAS016
     C           P@RTCD    IFEQ *BLANKS                                                       CAS016
     C                     MOVE 'Y'       CAS016  1                                           CAS016
     C                     ELSE                                                               CAS016
     C                     MOVE 'N'       CAS016                                              CAS016
     C                     ENDIF                                                              CAS016
      *                                                                                       CLE073
      ** Check if CAR CLE073 is present                                                       CLE073
      *                                                                                       CLE073
     C                     CALL 'AOSARDR0'                                                    CLE073
     C                     PARM *BLANKS   P@RTCD  7                                           CLE073
     C                     PARM '*KEY   ' P@OPTN  7                                           CLE073
     C                     PARM 'CLE073'  P@SARD  6                                           CLE073
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE073
      *                                                                                       CLE073
     C           P@RTCD    IFEQ *BLANKS                                                       CLE073
     C                     MOVE 'Y'       CLE073  1                                           CLE073
     C                     ELSE                                                               CLE073
     C                     MOVE 'N'       CLE073                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      *                                                                                     MD055481
      ** Check System Value: Use Original Borrower or Purchased From?                       MD055481
      ** Set up parameter so access object checks LoanCustOriginPurch                       MD055481
      *                                                                                     MD055481
     C                     MOVELWPARM     SVALK1                                            MD055481
      *                                                                                     MD055481
     C                     CALL 'AOSVALR0'                                                  MD055481
     C                     PARM           RTNCDE  7                                         MD055481
     C                     PARM           SVALK1 20                                         MD055481
     C                     PARM           SVAL1 200                                         MD055481
     C                     PARM           SVALK2 20                                         MD055481
     C                     PARM           SVAL2 200                                         MD055481
     C                     PARM           SVALK3 20                                         MD055481
     C                     PARM           SVAL3 200                                         MD055481
     C                     PARM           SVALK4 20                                         MD055481
     C                     PARM           SVAL4 200                                         MD055481
     C                     PARM           SVALK5 20                                         MD055481
     C                     PARM           SVAL5 200                                         MD055481
     C                     PARM           SVALK6 20                                         MD055481
     C                     PARM           SVAL6 200                                         MD055481
     C                     PARM           SVALK7 20                                         MD055481
     C                     PARM           SVAL7 200                                         MD055481
     C                     PARM           SVALK8 20                                         MD055481
     C                     PARM           SVAL8 200                                         MD055481
     C                     PARM           SVALK9 20                                         MD055481
     C                     PARM           SVAL9 200                                         MD055481
     C                     PARM           SVALK0 20                                         MD055481
     C                     PARM           SVAL10200                                         MD055481
      *                                                                                     MD055481
      ** If the system value is not found then default value to 'P'                         MD055481
      *                                                                                     MD055481
     C           RTNCDE    IFNE *BLANKS                                                     MD055481
     C                     MOVE 'P'       PPCUST                                            MD055481
     C                     ELSE                                                             MD055481
      *                                                                                     MD055481
      ** Isolate the first character of SVAL1 which = 'P' or 'O'.                           MD055481
      *                                                                                     MD055481
     C                     MOVELSVAL1     PPCUST  1                                         MD055481
     C                     ENDIF                                                            MD055481
      *                                                                                     MD055481
     C                     ENDSR
     C/EJECT
      ********************************************************************
      *
      *  C0000 --- Report section subroutine
      *
      *  CALLED FROM: Main Processing
      *
      *  CALLS: NOTHING
      *
      ********************************************************************
     C           C0000     BEGSR
     C                     ADD  1         @REP
     C                     MOVEA'00000000'*IN,30                                            AR745952
     C                     SETOF                     151617                                 AR745952
      *
     C           FEORED    IFEQ BJRDNB                     B1
     C                     ADD  1         @INS
     C***********          MOVE 'INSERT'  @ACTN
     C                     MOVE 'I'       @ACTN
     C                     END                             E1
     C/COPY WNCPYSRC,LER140CCP3                                           S01408
      *
     C           FELCHT    IFEQ 'A'                        B1
     C           FEORED    ORLT BJRDNB                                                        244452
     C           FELCHT    ANDEQ'X'                                                           244452
     C           AUSR      ORNE *BLANKS                                                     AR883268
     C           FELCHT    ANDEQ'X'                                                         AR883268
     C           FEORED    ANDEQBJRDNB                                                      AR883268
     C                     ADD  1         @AMD
     C***********          MOVE 'AMEND '  @ACTN
     C                     MOVE 'A'       @ACTN
     C                     ELSE                            X1
      *
     C           FELCHT    IFEQ 'D'                        B2
     C                     ADD  1         @DEL
     C***********          MOVE 'DELETE'  @ACTN
     C                     MOVE 'D'       @ACTN
     C                     END                             E2
     C                     END                             E1
      *
     C           FECNUM    IFNE @FECNO                     B1
     C                     MOVE FECNUM    @FECNO           Change of
     C                     SETON                     50    Key
     C                     MOVE FECNUM    BBCUST
     C*
     C                     MOVEL*BLANKS   KEYC   10
     C                     MOVELBBCUST    KEYC
     C                     CALL 'AOCUSTR0'             99
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           KEYC
     C                     PARM           KEYSTS  7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           @RTCD     IFEQ *BLANKS
     C                     MOVE BBCRNM    @RN
     C                     MOVE BBCRTN    @RT
     C                     ELSE                            X2
     C                     MOVE *ALL'*'   @RN
     C                     MOVE *ALL'*'   @RT
     C           *LOCK     IN   LDA                         ************
     C                     MOVELFECNUM    DBKEY             * DBERR 03 *
     C                     Z-ADD3         DBASE             ************
     C                     MOVEL'LER140  'DBPGM
     C                     MOVEL'SDCUSTPD'DBFILE
     C                     SETON                     U7U8
     C                     OUT  LDA                                         0096
     C                     EXSR E0000
     C*********************OUT  LDA                                         0096
     C                     EXSR *PSSR
     C                     END
      *
     C                     ELSE
     C                     SETOF                     50
     C                     END
      *
     C           FEFACL    IFNE 0
     C                     MOVE FEFACL    @LORF            Facility
     C                     MOVE FAR,2     FAR,1
     C                     MOVE FAR,3     FAR,2
     C                     MOVE FAR,4     FAR,3
     C                     MOVE '/'       FAR,4
     C                     ELSE                            or
     C                     MOVE FELOAN    @LORF            Loan
     C                     END
      *
     C           FELOAN    IFNE *BLANKS                                                    AR375891B
     C           FELOAN    IFNE WKLOAN                                                     AR375891B
      *                                                                                    AR375891B
     C           FELOAN    CHAINPSOLDL1              85                                    AR375891B
     C           *IN85     IFEQ *OFF                                                       AR375891B
     C                     MOVE 'Y'       WPRTS                                            AR375891B
     C                     ELSE                                                            AR375891B
     C                     MOVE 'N'       WPRTS                                            AR375891B
     C                     ENDIF                                                           AR375891B
     C                     MOVE FELOAN    WKLOAN                                           AR375891B
     C                     ENDIF                                                           AR375891B
     C                     ELSE                                                            AR375891B
     C                     MOVE 'N'       WPRTS   1                                        AR375891B
     C                     ENDIF                                                           AR375891B
      *                                                                                    AR375891B
     C                     MOVE FEFCOD    AUFECD           Name of
     C                     CALL 'AOFEER0'              99
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM AUFECD    FKEY    2
     C           SDFEE     PARM SDFEE     DSFDY
      *
     C           @RTCD     IFNE *BLANKS
     C                     MOVE *ALL'*'   AUFENV
     C           *LOCK     IN   LDA                         ************
     C                     MOVELFEFCOD    DBKEY             * DBERR 04 *
     C                     Z-ADD4         DBASE             ************
     C                     MOVEL'LER140  'DBPGM
     C                     MOVEL'SDFEEPD 'DBFILE
     C                     SETON                     U7U8
     C                     OUT  LDA                                         0096
     C                     EXSR E0000
     C*********************OUT  LDA                                         0096
     C                     EXSR *PSSR
     C                     END                              E1
      *
     C                     MOVE FEBRCA    @AORL   3
     C                     Z-ADDFEFAMT    @DSAMT            Determine
     C                     CALL 'AOCURRR0'             99   Fee Amount
     C                     PARM '*MSG    '@RTCD
     C                     PARM '*KEY    '@OPTN
     C                     PARM FEFCCY    CURKEY  3
     C           SDCURR    PARM SDCURR    DSSDY
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     SETON                     99    ***************
     C                     MOVELFEFCCY    DBKEY            *  DBERR 05   *
     C                     Z-ADD5         DBASE            ***************
     C                     MOVEL'SDCURRPD'DBFILE
     C                     MOVEL'LER140  'DBPGM
     C                     SETON                     U7U8
     C                     OUT  LDA                                         0096
     C                     EXSR E0000
     C*********************OUT  LDA                                         0096
     C                     EXSR *PSSR
     C                     END
     C*                                                                   062440
     C** Initialise decimal position Indicators first.                    062440
     C*                                                                   062440
     C                     MOVEA'0000'    *IN,60                          062440
      *
     C           A6NBDP    IFEQ 0
     C                     MOVE '1'       *IN60
     C                     ELSE
     C           A6NBDP    IFEQ 1
     C                     MOVE '1'       *IN61
     C                     ELSE
     C           A6NBDP    IFEQ 2
     C                     MOVE '1'       *IN62
     C                     ELSE
     C           A6NBDP    IFEQ 3
     C                     MOVE '1'       *IN63
     C                     END
     C                     END
     C                     END
     C                     END
      *
     C                     Z-ADDFEPSTD    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    @STRT
      *
     C           FEPEND    IFEQ 0                           B1
     C                     MOVE *BLANKS   @END
     C                     ELSE                             X1
     C                     Z-ADDFEPEND    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    @END
     C                     END                              E1
      *
     C                     MOVE *BLANKS   @PAYON
      *
     C           FEPYON    IFEQ 'S'
     C                     MOVEL'START'   @PAYON
     C                     ELSE
      *
     C           FEPYON    IFEQ 'E'
     C                     MOVEL'END'     @PAYON
     C                     ELSE
      *
     C           FEPYON    IFEQ 'N'
     C                     MOVEL'NEXT'    @PAYON
     C                     END
     C                     END
     C                     END
     C*
     C** Initialise fields for the report
     C*
     C                     MOVE IUSR      @IUSR                           147935
     C                     MOVE AUSR      @AUSR                           147935
     C                     MOVE XUSR      @XUSR                           147935
     C                     MOVE PCRF      RPCRF                           159258
     C*                                                                   147935
     C           KEY004    CHAINLEFEEQL0             64                                     MD052216
     C                     MOVELFQPDDI    RFPDDI                                            MD052216
     C                     MOVELFQPTDI    RFPTDI                                            MD052216
      *                                                                                     MD052216
     C           FEERAT    IFEQ 0
     C                     MOVE '1'       *IN38
     C                     ELSE
     C                     MOVE '0'       *IN38
     C                     END
     C*
     C           FEDYIM    IFEQ 0
     C                     MOVE '1'       *IN39
     C                     ELSE
     C                     MOVE '0'       *IN39
     C                     END
      *
     C           FEAUTO    IFEQ 'Y'                        Auto-settle
     C           FEAUTO    OREQ 'C'                                                           CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
     C           FEAUT2    OREQ 'C'                                                           CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
     C                     MOVE 'YES'     @AUTST           Indicator
     C                     ELSE
     C                     MOVE 'NO '     @AUTST
     C                     END
      *
     C           FECAPI    IFEQ 'Y'                                                           CLE139
     C                     MOVE 'YES'     @CAPIT                                              CLE139
     C                     ELSE                                                               CLE139
     C                     MOVE 'NO '     @CAPIT                                              CLE139
     C                     END                                                                CLE139
      *                                                                                       CLE139
     C           FESTTL    IFEQ 1
     C           FESTTL    OREQ 2
     C           FESTTL    OREQ 7
     C           FESTTL    OREQ 8
     C           FESTTL    OREQ 12
     C                     MOVE *BLANKS   A7NONB           Determine
     C                     MOVELFEOURS    A7NONB           Nostro Number
     C                     MOVE *BLANKS   @RTCD
      *                                                                   179741
     C           FESCCY    IFEQ *BLANK                                    179741
     C                     MOVE FEFCCY    FCURR   3                       179741
     C                     ELSE                                           179741
     C                     MOVE FESCCY    FCURR                           179741
     C                     ENDIF                                          179741
      *                                                                   CLE031
      ** If feature CLE031 is on setup settlement currency                CLE031
      *                                                                   CLE031
     C           CLE031    IFEQ 'Y'                                       CLE031
     C           PTFI      IFEQ 'P'                                       CLE031
     C           PTFI      OREQ 'S'                                                           CLE106
     C           PTFI      OREQ 'R'                                                           CLE106
      *                                                                   CLE031
     C           FEPSCY    IFNE *BLANKS                                   CLE031
     C                     MOVE FEPSCY    FCURR                           CLE031
     C                     ENDIF                                          CLE031
      *                                                                   CLE031
     C                     ELSE                                           CLE031
      *                                                                   CLE031
     C           FESCCY    IFNE *BLANKS                                   CLE031
     C                     MOVE FESCCY    FCURR                           CLE031
     C                     ENDIF                                          CLE031
      *                                                                   CLE031
     C                     ENDIF                                          CLE031
     C                     ENDIF                                          CLE031
      *                                                                   CLE031
     C                     CALL 'AONOSTR0'             99
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           @CUSTA  6
     C**********           PARM FEFCCY    @CYCD   3                       179741
     C                     PARM FCURR     @CYCD   3                       179741
     C**********           PARM *BLANKS   @ACCD   4                                           CGL029
     C                     PARM *BLANKS   @ACCD  10                                           CGL029
     C                     PARM *BLANKS   @ACSN   2
     C                     PARM A7NONB    @NONB   2
     C                     PARM *BLANKS   @BRCD   3
     C                     PARM *BLANKS   @CSSN  10
     C                     PARM *BLANKS   @PNOI   1
     C           SDNOST    PARM SDNOST    DSFDY
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA                         ************
     C                     MOVELFECNUM    DBKEY             * DBERR 06 *
     C                     Z-ADD6         DBASE             ************
     C                     MOVEL'LER140  'DBPGM
     C                     MOVEL'SDNOSTPD'DBFILE
     C                     SETON                     U7U8
     C                     OUT  LDA                                         0096
     C                     EXSR E0000
     C*********************OUT  LDA                                         0096
     C                     EXSR *PSSR
     C                     END
      *
     C           *IN99     IFEQ '0'
      *
     C                     MOVEL*BLANKS   KEYC   10
     C                     MOVELBBCUST    KEYC
     C                     CALL 'AOCUSTR0'             99
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           KEYC
     C                     PARM           KEYSTS  7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           @RTCD     IFNE *BLANKS
     C**********           MOVE *ALL'*'   @OURN                           BH3516
     C**********           MOVE *ALL'*'   @OURT                           BH3516
     C                     MOVE *ALL'*'   @OURN  20                       BH3516
     C                     MOVE *ALL'*'   @OURT  10                       BH3516
     C           *LOCK     IN   LDA                         ************
     C                     MOVELFECNUM    DBKEY             * DBERR 07 *
     C                     Z-ADD7         DBASE             ************
     C                     MOVEL'LER140  'DBPGM
     C                     MOVEL'SDCUSTPD'DBFILE
     C                     SETON                     U7U8
     C                     OUT  LDA                                         0096
     C                     EXSR E0000
     C*********************OUT  LDA                                         0096
     C                     EXSR *PSSR
     C                     ELSE
     C                     MOVE BBCRNM    @OURN
     C                     MOVE BBCRTN    @OURT
     C                     END
      *
     C                     ELSE
     C                     MOVE *ALL'*'   @OURN
     C                     MOVE *ALL'*'   @OURT
     C                     END
      *
     C                     ELSE
      *
     C           FESTTL    IFEQ 14
     C                     MOVE *BLANKS   @OURT
     C                     MOVELFEOURS    ACNO
     C                     MOVE *BLANKS   @RTCD
     C*
     C* Set up Parameters for call to AOACCTR0
     C**********           MOVEL*BLANK    UUACID                            0097
     C**********           MOVEL@CUST     UUCUST                            0097
     C**********           MOVEL@ACCDE    UUACNO                            0097
     C**********           MOVEL@SEQ      UUACSN                            0097
     C                     MOVELFEOURS    UUACID                            0097
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C                     CALL 'AOACCTR0'             99
     C                     PARM '*MSG   ' @RTCD   7        B:Return Cd
     C                     PARM '*KEY   ' UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C**********           PARM           UUCUST  6        I:Customer Number0097
     C**********           PARM           UUCYCD  3        I:Currency Code  0097
     C**********           PARM           UUACNO  4        I:Account Code Nu0097
     C**********           PARM           UUACSN  2        I:Account Sequenc0097
     C**********           PARM           UUBRCD  3        I:Branch code    0097
     C                     PARM *BLANKS   UUCUST  6        I:Customer Number0097
     C                     PARM *BLANKS   UUCYCD  3        I:Currency Code  0097
     C**********           PARM *BLANKS   UUACNO  4        I:Account Code Num            0097 CGL029
     C                     PARM *BLANKS   UUACNO 10        I:Account Code Num                 CGL029
     C                     PARM *BLANKS   UUACSN  2        I:Account Sequenc0097
     C                     PARM *BLANKS   UUBRCD  3        I:Branch code    0097
     C***********D@ACCT    PARM *BLANK    UUSDY   6        O:Format       BH3418
     C           D@ACCT    PARM *BLANKS   DSSDY            O:Format       BH3418
      *
     C           @RTCD     IFNE *BLANKS
     C           @RTCD     ANDNE'*NRF   '                                                   AR801992
     C           *LOCK     IN   LDA                        **************
     C                     MOVEL'LER140'  DBPGM            *  DBERR 08  *
     C                     Z-ADD8         DBASE            **************
     C                     MOVEL@CUST     DBKEY
     C                     MOVEL'ACCNTAB 'DBFILE
     C                     SETON                     U7U8
     C                     OUT  LDA                                         0096
     C                     EXSR E0000
     C*********************OUT  LDA                                         0096
     C                     EXSR *PSSR
     C                     END
     C                     END
      *
     C           FESTTL    IFEQ 5
     C                     MOVE *BLANKS   @RTCD
     C*
     C* Set up Parameters for call to AOACCTR0
     C**********           MOVEL*BLANK    UUACID                            0097
     C                     MOVEL*BLANKS   UUACID                            0097
     C                     MOVEL@CUST     UUCUST
     C                     MOVELFEFCCY    UUCYCD
     C           CLE031    IFEQ 'Y'                                       CLE031
     C           FESCCY    ANDNE*BLANKS                                   CLE031
     C                     MOVELFESCCY    UUCYCD                          CLE031
     C                     ENDIF                                          CLE031
     C                     MOVEL@ACCDE    UUACNO
     C                     MOVEL@SEQ      UUACSN
     C                     MOVE FEOSBR    UUBRCD                            0097
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C                     CALL 'AOACCTR0'             99
     C                     PARM '*MSG   ' @RTCD   7        B:Return Cd
     C                     PARM '*KEY   ' UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCUST  6        I:Customer Number
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACNO  4        I:Account Code Num                 CGL029
     C                     PARM           UUACNO           I:Account Code Num                 CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch code
     C***********D@ACCT    PARM *BLANK    UUSDY            O:Format       BH3418
     C           D@ACCT    PARM *BLANKS   DSSDY            O:Format       BH3418
      *
     C           @RTCD     IFNE *BLANKS
     C           @RTCD     ANDNE'*NRF   '                                                   AR801992
     C           *LOCK     IN   LDA                        **************
     C                     MOVEL'LER140'  DBPGM            *  DBERR 09  *
     C                     Z-ADD9         DBASE            **************
     C                     MOVEL@CUST     DBKEY
     C                     MOVEL'ACCNTAB 'DBFILE
     C                     SETON                     U7U8
     C                     OUT  LDA                                         0096
     C                     EXSR E0000
     C*********************OUT  LDA                                         0096
     C                     EXSR *PSSR
     C                     END
     C                     END
      *
     C           FESTTL    IFEQ 4
     C                     MOVE *BLANKS   @RTCD
     C*
     C* Set up Parameters for call to AOACCTR0
     C**********           MOVEL*BLANK    UUACID                            0097
     C                     MOVEL*BLANKS   UUACID                            0097
     C                     MOVELFECNUM    UUCUST
     C                     MOVELFEFCCY    UUCYCD
     C                     MOVEL@BMAFN    UUACNO
     C                     MOVEL@SEQ1     UUACSN
     C                     MOVE FEOSBR    UUBRCD                            0097
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C                     CALL 'AOACCTR0'             99
     C                     PARM '*MSG   ' @RTCD   7        B:Return Cd
     C                     PARM '*KEY   ' UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCUST  6        I:Customer Number
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACNO  4        I:Account Code Num                 CGL029
     C                     PARM           UUACNO           I:Account Code Num                 CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch code
     C***********D@ACCT    PARM *BLANK    UUSDY            O:Format       BH3418
     C           D@ACCT    PARM *BLANKS   DSSDY            O:Format       BH3418
      *
     C           @RTCD     IFNE *BLANKS
     C           @RTCD     ANDNE'*NRF   '                                                   AR801992
     C           *LOCK     IN   LDA                        **************
     C                     MOVEL'LER140'  DBPGM            *  DBERR 10  *
     C                     Z-ADD10        DBASE            **************
     C                     MOVEL@CUST     DBKEY
     C                     MOVEL'ACCNTAB 'DBFILE
     C                     SETON                     U7U8
     C                     OUT  LDA                                         0096
     C                     EXSR E0000
     C*********************OUT  LDA                                         0096
     C                     EXSR *PSSR
     C                     END
     C                     END
      *
     C           FESTTL    IFEQ 5
     C           FESTTL    OREQ 14
     C           FESTTL    OREQ 4
      *
     C           *IN99     IFEQ '0'
     C                     MOVE ANAM      @OURN
     C                     ELSE
     C                     MOVE *ALL'*'   @OURN
     C                     END
      *
     C                     ELSE
     C                     MOVE *BLANKS   @OURN
     C                     MOVE *BLANKS   @OURT
     C                     END
     C                     END
      *
     C**********           MOVE *BLANKS   @THRN                           BH3516
     C**********           MOVE *BLANKS   @THRT                           BH3516
     C                     MOVE *BLANKS   @THRN  35                       BH3516
     C                     MOVE *BLANKS   @THRT  10                       BH3516
     C                     MOVE @THCUS    @THC              CHECK
     C                     MOVE '0'       TESTN6            FOR
     C***********          TESTN          TESTN6     98     CUSTOMER                          CSD027
      *
     C************IN98     IFEQ '1'                                                           CSD027
      *
     C                     MOVEL*BLANKS   KEYC   10
     C                     MOVEL@THCUS    KEYC
     C                     CALL 'AOCUSTR0'             99
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           KEYC
     C                     PARM           KEYSTS  7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           @RTCD     IFEQ *BLANKS
     C                     MOVELBBCRNM    @THRN
     C                     MOVE BBCRTN    @THRT
     C***********          ELSE                                                               CSD027
     C***********          MOVE *ALL'*'   @THRN                                               CSD027
     C***********          MOVE *ALL'*'   @THRT                                               CSD027
     C************LOCK     IN   LDA                         ************                      CSD027
     C***********          MOVELFECNUM    DBKEY             * DBERR 11 *                      CSD027
     C***********          Z-ADD11        DBASE             ************                      CSD027
     C***********          MOVEL'LER140  'DBPGM                                               CSD027
     C***********          MOVEL'SDCUSTPD'DBFILE                                              CSD027
     C***********          SETON                     U7U8                                     CSD027
     C***********          OUT  LDA                                         0096              CSD027
     C***********          EXSR E0000                                                         CSD027
     C*********************OUT  LDA                                         0096
     C***********          EXSR *PSSR                                                         CSD027
     C***********          END                                                                CSD027
      *
     C                     ELSE
      *
     C           @TH1ST    IFNE ' '
      *
     C                     CALL 'AOCNSTR0'             99
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM @THNOS    CPNC    8
     C           SDCNST    PARM SDCNST    DSFDY
      *
     C           @RTCD     IFEQ *BLANKS
     C                     MOVELAWCPNM    @THRN
     C**********           ELSE                                           093577
      **********                                                          093577
     C**********           MOVEL*BLANKS   KEYC   10                       093577
     C**********           MOVELFETHER    KEYC                            093577
     C**********           CALL 'AOCUSTR0'             99                 093577
     C**********           PARM '*MSG   ' @RTCD                           093577
     C**********           PARM '*KEY   ' @OPTN                           093577
     C**********           PARM           KEYC                            093577
     C**********           PARM           KEYSTS  7                       093577
     C********** SDCUST    PARM SDCUST    DSSDY                           093577
      **********                                                          093577
     C********** @RTCD     IFEQ *BLANKS                                   093577
     C**********           MOVELBBCRNM    @THRN                           093577
     C**********           MOVE BBCRTN    @THRT                           093577
     C**********           ELSE                                           093577
     C**********           MOVE *ALL'*'   @THRN                           093577
     C**********           MOVE *ALL'*'   @THRT                           093577
     C********** *LOCK     IN   LDA                         ************  093577
     C**********           MOVELFECNUM    DBKEY             * DBERR 12 *  093577
     C**********           Z-ADD12        DBASE             ************  093577
     C**********           MOVEL'LER140  'DBPGM                           093577
     C**********           MOVEL'SDCUSTPD'DBFILE                          093577
     C**********           SETON                     U7U8                 093577
     C**********           OUT  LDA                                0096   093577
     C**********           EXSR E0000                                     093577
     C*********************OUT  LDA                                         0096
     C**********           EXSR *PSSR                                     093577
     C**********           END                                            093577
     C                     END
     C                     END
     C                     END
      *                                                                                       CAS016
      ** Include new CAS016 fields                                                            CAS016
     C                     MOVE '0'       *IN04                                               CAS016
     C                     MOVE *BLANKS   R1AMRI                                              CAS016
     C                     MOVE *BLANKS   R1STPD                                              CAS016
     C                     MOVE *BLANKS   R1ENPD                                              CAS016
     C           CAS016    IFEQ 'Y'                                                           CAS016
     C           FEADJY    ANDEQ'Y'                                                           CAS016
     C           FESTPD    ANDNE0                                                             CAS016
     C                     MOVE '1'       *IN04                                               CAS016
     C                     MOVE FEAMRI    R1AMRI                                              CAS016
     C                     Z-ADDFESTPD    ZDAYNO                                              CAS016
     C                     EXSR ZDATE2                                                        CAS016
     C                     MOVE ZADATE    R1STPD                                              CAS016
     C           FEENPD    IFNE 0                                                             CAS016
     C                     Z-ADDFEENPD    ZDAYNO                                              CAS016
     C                     EXSR ZDATE2                                                        CAS016
     C                     MOVE ZADATE    R1ENPD                                              CAS016
     C                     ENDIF                                                              CAS016
     C                     ENDIF                                                              CAS016
      *                                                                                       CAS009
     C                     MOVE '0'       *IN03                                               CAS009
     C                     MOVE *BLANK    R1NPYD                                              CAS009
     C                     MOVE *BLANK    R1FREQ                                              CAS009
     C                     MOVE *BLANK    R1DYIM                                              CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C           FEPYON    ANDEQ'N'                                                           CAS009
     C           FECALT    ANDEQ*BLANKS                                                       CAS009
     C                     MOVE '1'       *IN03                                               CAS009
     C                     Z-ADDFENPYD    ZDAYNO                                              CAS009
     C                     EXSR ZDATE2                                                        CAS009
     C                     MOVE ZADATE    R1NPYD                                              CAS009
     C                     MOVE FEFREQ    R1FREQ                                              CAS009
     C                     MOVE FEDYIM    R1DYIM                                              CAS009
     C                     ENDIF                                                              CAS009
      *
     C           FECALT    COMP ' '                  51
      *
     C           *IN51     IFEQ '0'
      *
     C********** LINE      IFGE 58                                        BH3489
     C***********LINE      IFGT 51                                 BH3489 156498
     C           LINE      IFGT 48                                        156498
     C                     SETON                     80
     C                     END
      *
     C                     ELSE
     C*                                                                  BH3407
     C** Check the calculation type to set up the narrative for the      BH3407
     C** report correctly                                                BH3407
     C*                                                                  BH3407
     C** First check whether this is on full, outstanding or available   BH3407
     C*                                                                  BH3407
      *                                                                                       CLE073
     C/COPY WNCPYSRC,LEH00722
     C           CLE073    IFEQ 'Y'                                                           CLE073
     C           FECALT    ANDEQ'97'                                                          CLE073
     C           CLE073    OREQ 'Y'                                                           CLE073
     C           FECALT    ANDEQ'98'                                                          CLE073
     C           CLE073    OREQ 'Y'                                                           CLE073
     C           FECALT    ANDEQ'99'                                                          CLE073
     C**********           MOVEA'00000000'*IN,30                                     CLE073 AR745952
     C           CLE134    OREQ 'Y'                                                           CLE134
     C           FECALT    ANDEQ'90'                                                          CLE134
     C                     MOVEA'00000000'*IN,30                                              CLE073
     C                     SELEC                                                              CLE073
     C           FECALT    WHEQ '97'                                                          CLE073
     C**********           MOVE *ON       *IN45                                      CLE073 AR745952
     C                     SETON                     15                                     AR745952
     C           FECALT    WHEQ '98'                                                          CLE073
     C**********           MOVE *ON       *IN46                                      CLE073 AR745952
     C                     SETON                     16                                     AR745952
     C           FECALT    WHEQ '99'                                                          CLE073
     C           FECALT    OREQ '90'                                                          CLE134
     C**********           MOVE *ON       *IN47                                      CLE073 AR745952
     C                     SETON                     17                                     AR745952
     C                     MOVE *ON       *IN47                                               CLE073
     C                     ENDSL                                                              CLE073
     C                     ELSE                                                               CLE073
      *                                                                                       CLE134
     C           FECALT    IFEQ '90'                                                          CLE134
     C                     MOVE *ON       *IN49                                               CLE134
     C                     ELSE                                                               CLE134
     C                     MOVE *OFF      *IN49                                               CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE073
     C           FECALT    IFLT '10'                                     BH3407
     C                     MOVE '1'       *IN30                          BH3407
     C                     MOVE '0'       *IN31                          BH3407
     C                     MOVE '0'       *IN32                          BH3407
     C                     ELSE                                          BH3407
     C           FECALT    IFLT '20'                                     BH3407
     C                     MOVE '0'       *IN30                          BH3407
     C                     MOVE '1'       *IN31                          BH3407
     C                     MOVE '0'       *IN32                          BH3407
     C                     ELSE                                          BH3407
     C                     MOVE '0'       *IN30                          BH3407
     C                     MOVE '0'       *IN31                          BH3407
     C                     MOVE '1'       *IN32                          BH3407
     C                     END                                           BH3407
     C                     END                                           BH3407
     C*                                                                  BH3407
     C** Then check whether this is on average or actual                 BH3407
     C*                                                                  BH3407
     C           FECALT    IFLT '04'                                     BH3407
     C           FECALT    ORGT '10'                                     BH3407
     C           FECALT    ANDLT'14'                                     BH3407
     C           FECALT    OREQ '21'                                     BH3407
     C                     MOVE '1'       *IN33                          BH3407
     C                     MOVE '0'       *IN34                          BH3407
     C                     ELSE                                          BH3407
     C                     MOVE '0'       *IN33                          BH3407
     C                     MOVE '1'       *IN34                          BH3407
     C                     END                                           BH3407
     C*                                                                  BH3407
     C** Then check whether this is tierd, threshold or single fee       BH3407
     C*                                                                  BH3407
     C           FECALT    IFEQ '01'                                     BH3407
     C           FECALT    OREQ '04'                                     BH3407
     C           FECALT    OREQ '11'                                     BH3407
     C           FECALT    OREQ '14'                                     BH3407
     C                     MOVE '1'       *IN35                          BH3407
     C                     MOVE '0'       *IN36                          BH3407
     C                     MOVE '0'       *IN37                          BH3407
     C                     END                                           BH3407
     C*                                                                  BH3407
     C           FECALT    IFEQ '02'                                     BH3407
     C           FECALT    OREQ '05'                                     BH3407
     C           FECALT    OREQ '12'                                     BH3407
     C           FECALT    OREQ '15'                                     BH3407
     C                     MOVE '0'       *IN35                          BH3407
     C                     MOVE '1'       *IN36                          BH3407
     C                     MOVE '0'       *IN37                          BH3407
     C                     END                                           BH3407
     C*                                                                  BH3407
     C           FECALT    IFEQ '03'                                     BH3407
     C           FECALT    OREQ '06'                                     BH3407
     C           FECALT    OREQ '13'                                     BH3407
     C           FECALT    ORGT '15'                                     BH3407
     C                     MOVE '0'       *IN35                          BH3407
     C                     MOVE '0'       *IN36                          BH3407
     C                     MOVE '1'       *IN37                          BH3407
     C                     END                                           BH3407
     C/COPY WNCPYSRC,LEH00723
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C*                                                                  BH3407
     C********** LINE      IFGE 54                                        BH3489
     C***********LINE      IFGT 43                                 BH3489 156498
     C           LINE      IFGT 40                                        156498
     C                     SETON                     80
     C                     END
     C                     END
      *                                                                   CLE005
      ** If SAR CLE005 is Present                                         CLE005
      *                                                                   CLE005
     C           *IN40     IFEQ *ON                                       CLE005
      *                                                                   CLE005
      ** Format Share Fee for printing                                    CLE005
      *                                                                   CLE005
     C                     MOVE *BLANKS   RSHFI                           CLE005
     C           SHFI      IFEQ 'Y'                                       CLE005
     C                     MOVE 'YES'     RSHFI                           CLE005
     C                     ENDIF                                          CLE005
     C           SHFI      IFEQ 'N'                                       CLE005
     C                     MOVE 'NO'      RSHFI                           CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
      ** Format Fee Indicator for printing                                CLE005
      *                                                                   CLE005
     C                     MOVEA'10'      *IN,41                          CLE005
     C           *IN25     IFEQ '1'                                                           193475
     C                     MOVEL'RECEIVAB'RPTFN                           CLE005
     C                     MOVE 'LE'      RPTFN                           CLE005
     C                     ENDIF                                                              193475
     C           PTFI      IFEQ 'P'                                       CLE005
     C           PTFI      OREQ 'S'                                                           CLE106
     C           PTFI      OREQ 'R'                                                           CLE106
     C                     MOVEA'01'      *IN,41                          CLE005
     C           *IN25     IFEQ '1'                                                           193475
     C                     MOVEL'PAYABLE' RPTFN     P                     CLE005
     C                     ENDIF                                                              193475
     C                     ENDIF                                          CLE005
     C           PTFI      IFEQ 'I'                                       CLE005
     C                     MOVEA'00'      *IN,41                          CLE005
     C           *IN25     IFEQ '1'                                                           193475
     C                     MOVEL'INTERNAL'RPTFN     P                     CLE005
     C                     ENDIF                                                              193475
     C                     ENDIF                                          CLE005
     C           PTFI      IFEQ *BLANK                                                     AR375891B
     C           WPRTS     IFEQ 'Y'                                                        AR375891B
     C                     MOVEA'01'      *IN,41                                           AR375891B
     C                     ENDIF                                                           AR375891B
     C                     ENDIF                                                           AR375891B
      *                                                                                       CLE031
      ** Format settlement ccy/xrate/indicator                                                CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE *BLANK    RRSCY                                               CLE031
     C                     Z-ADD0         RREXR                                               CLE031
     C                     MOVE *BLANK    RREXI                                               CLE031
     C                     MOVE *BLANK    RPSCY                                               CLE031
     C                     Z-ADD0         RPEXR                                               CLE031
     C                     MOVE *BLANK    RPEXI                                               CLE031
     C           *IN41     IFEQ *ON                                                           CLE031
     C                     MOVE FESCCY    RRSCY                                               CLE031
     C                     Z-ADDFEREXR    RREXR                                               CLE031
     C                     MOVE FEREXI    RREXI                                               CLE031
     C                     ENDIF                                                              CLE031
     C           *IN42     IFEQ *ON                                                           CLE031
     C                     MOVE FEPSCY    RPSCY                                               CLE031
     C                     Z-ADDFEPEXR    RPEXR                                               CLE031
     C                     MOVE FEPEXI    RPEXI                                               CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                   CLE005
      ** Format Fee Settlement Instructions for printing                  CLE005
      *                                                                   CLE005
     C                     MOVE *BLANKS   RRSTM                           CLE005
     C           RSTM      IFNE *ZERO                                     CLE005
     C                     MOVELRSTM      RRSTM                           CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     MOVE *BLANKS   RROCN                           CLE005
     C********** ROCN      IFNE *ZERO                                                  CLE005 CSD027
     C           ROCN      IFNE *BLANKS                                                       CSD027
     C                     MOVELROCN      RROCN                           CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     MOVE *BLANKS   RROBN                           CLE005
     C********** ROBN      IFNE *ZERO                                                  CLE005 CSD027
     C           ROBN      IFNE *BLANKS                                                       CSD027
     C                     MOVELROBN      RROBN                           CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     MOVE *BLANKS   RPSTM                           CLE005
     C           PSTM      IFNE *ZERO                                     CLE005
     C                     MOVELPSTM      RPSTM                           CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     MOVE *BLANKS   RPOCN                           CLE005
     C********** POCN      IFNE *ZERO                                                  CLE005 CSD027
     C           POCN      IFNE *BLANKS                                                       CSD027
     C                     MOVELPOCN      RPOCN                           CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     MOVE *BLANKS   RPOBN                           CLE005
     C********** POBN      IFNE *ZERO                                                  CLE005 CSD027
     C           POBN      IFNE *BLANKS                                                       CSD027
     C                     MOVELPOBN      RPOBN                           CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     MOVELRONS      RRONS                           CLE005
     C                     MOVELRIBN      RRIBN                           CLE005
     C                     MOVELRIBA      RRIBA                           CLE005
     C                     MOVELPONS      RPONS                           CLE005
     C                     MOVELCVMR      RCVMR                           CLE005
     C                     MOVELRVNO      RRVNO                           CLE005
     C                     MOVELRCRN      RRCRN                           CLE005
     C                     MOVELRCRA      RRCRA                           CLE005
     C                     MOVELPIBN      RPIBN                           CLE005
     C                     MOVELPIBA      RPIBA                           CLE005
     C                     MOVELAWBN      RAWBN                           CLE005
     C                     MOVELAWBA      RAWBA                           CLE005
     C                     MOVELBENN      RBENN                           CLE005
     C                     MOVELBENA      RBENA                           CLE005
     C                     MOVELDTP1      RDTP1                           CLE005
     C                     MOVELDTP2      RDTP2                           CLE005
     C                     MOVELDTP3      RDTP3                           CLE005
     C                     MOVELDTP4      RDTP4                           CLE005
     C                     MOVELDCHG      RDCHG                           CLE005
     C                     MOVELBTB1      RBTB1                           CLE005
     C                     MOVELBTB2      RBTB2                           CLE005
     C                     MOVELBTB3      RBTB3                           CLE005
     C                     MOVELBTB4      RBTB4                           CLE005
     C                     MOVELBTB5      RBTB5                           CLE005
     C                     MOVELBTB6      RBTB6                           CLE005
      *                                                                   CLE005
     C                     ENDIF                                          CLE005
     C/COPY WNCPYSRC,LEH00557
      *
      ** When branch code changes open new spool file
     C           MBIN      IFEQ 'Y'
     C           FEBRCA    ANDNESTRBRC
     C                     MOVE FEBRCA    STRBRC  3
     C                     SETOF                     80
     C   02                WRITELER140T4
     C                     CLOSELER140P1
      ** If branch code changed, print customer details                                       244377
     C                     SETON                     50                                       244377
      *
      ** File has been opened field
     C                     MOVE 'Y'       P1OP    1
     C                     OPEN LER140P1
     C                     Z-ADD0         PAGE
     C                     SETON                     02
      *
      ** Ensure report spool file recorded by RCF
     C                     Z-ADDSFNUM     ZSNUM
      *
     C                     CALL 'ZSFILE'
     C                     PARM           SEQ     5
     C                     PARM FEBRCA    SENTY   3
     C                     PARM           SFILE
     C                     PARM           ZSNUM   60
     C                     PARM           ZSERR   1
      *
      *
      ** If error during ZSFILE processing, return to calling program
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
      *
      ** If system is multibranching obtain branch name for output
     C**********           CALL 'AOBRCHR0'             99                                     CGL029
     C                     CALL 'AOBRCHR1'             99                                     CGL029
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM FEBRCA    @DSNB   3
     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA                        ***************
     C                     MOVELFEBRCA    DBKEY            ** DBERR  13 **
     C                     Z-ADD13        DBASE            ***************
     C                     MOVEL'LER140'  DBPGM
     C                     MOVEL'SDBRCHPD'DBFILE
     C                     SETON                     U7U8
     C                     OUT  LDA                                         0096
     C                     EXSR E0000
     C*********************OUT  LDA                                         0096
     C                     EXSR *PSSR
     C                     END
      *
      ** Output header
     C                     WRITELER140H1
     C***********          WRITELER140H2
     C***********          WRITELER140H3                                 BH3407
      *
      ** If system multibranching
     C                     END
      *
      ** If system is not multibranching set up single spool file
     C           MBIN      IFNE 'Y'
     C           P1OP      ANDNE'Y'
     C                     CLOSELER140P1
     C                     MOVE 'Y'       P1OP
     C                     OPEN LER140P1
     C                     SETOF                     80
     C                     Z-ADD0         PAGE
      *
      ** Ensure report spool file recorded by RCF
     C                     Z-ADDSFNUM     ZSNUM
      *
     C                     CALL 'ZSFILE'
     C                     PARM           SEQ
     C                     PARM *BLANKS   SENTY
     C                     PARM           SFILE
     C                     PARM           ZSNUM
     C                     PARM           ZSERR
      *
      *
      ** If error during ZSFILE processing, return to calling program
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
      *
      ** Output header
     C                     WRITELER140H1
     C***********          WRITELER140H3                                 BH3407
      *
      ** MBIN IFNE 'Y' end
     C                     END
      *
      ** If overflow indicator on, output another header
     C           *IN80     IFEQ '1'
     C                     WRITELER140H1
     C***********MBIN      IFEQ 'Y'
     C***********          WRITELER140H2
     C***********          END
     C***********          WRITELER140H3                                 BH3407
     C                     SETOF                     80
     C                     SETON                     50                   BH3516
     C                     END
      *                                                                                       CLE031
      ** Format next payment details for non-calculated fees                                  CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C           FEPYON    ANDEQ'N'                                                           CLE031
     C           FECALT    ANDEQ*BLANK                                                        CLE031
     C                     MOVE *ON       *IN47                                               CLE031
     C                     Z-ADDFENPYD    ZDAYNO                                              CLE031
     C                     EXSR ZDATE2                                                        CLE031
     C                     MOVE ZADATE    RNXTDT                                              CLE031
     C                     MOVE FEFREQ    RFREQU                                              CLE031
     C                     MOVE FEDYIM    RDYIMN                                              CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE *OFF      *IN47                                               CLE031
     C                     ENDIF                                                              CLE031
      *
     C           *IN51     IFEQ '0'
     C                     WRITELER140H3                                 BH3407
     C                     WRITELER140D1
      *                                                                   140833
      * If CLE004 is on and fee is not for an internal participant        140833
      * then print settlement details on report.                          140833
      *                                                                   140833
     C           *IN40     IFEQ *ON                                       140833
     C           PTFI      ANDNE'I'                                       140833
      *                                                                   140833
      ** If CLE034 is on ..                                                                   CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    IFEQ 'Y'                                                           CLE034
      *                                                                                       CLE034
     C                     EXSR SR34                                                          CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C                     Z-ADD3         RQDLN1                                              CLE034
     C           OLINE     SUB  LINE      DIFLN1                                              CLE034
     C           DIFLN1    IFLE RQDLN1                                                        CLE034
     C                     WRITELER140H1                                                      CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      ** Print detail - Settlement allocation is NO                                           CLE034
      *                                                                                       CLE034
     C                     MOVE *OFF      *IN45                                               CLE034
     C                     MOVE ' NO'     RSTAL                                               CLE034
     C                     WRITELER140D5                                                      CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                             BUG7109
     C                     ENDIF                                                             BUG7109
     C           CLE034    IFNE 'Y'                                                          BUG7109
     C           CLE034    OREQ 'Y'                                                          BUG7109
     C           FESTAL    ANDNE'Y'                                                          BUG7109
      * write header if insufficient room on page...                      140833
     C           *IN41     IFEQ *ON                                       140833
     C                     Z-ADD7         RQDLN1                          140833
     C/COPY WNCPYSRC,LER140C001
     C                     ELSE                                           140833
     C           *IN42     IFEQ *ON                                       140833
     C                     Z-ADD25        RQDLN1                          140833
     C/COPY WNCPYSRC,LER140C002
     C                     ENDIF                                          140833
     C                     ENDIF                                          140833
     C           OLINE     SUB  LINE      DIFLN1                          140833
     C           DIFLN1    IFLE RQDLN1                                    140833
     C                     WRITELER140H1                                  140833
     C                     ENDIF                                          140833
      *                                                                   140833
      * print settlement details on report                                140833
     C                     WRITELER140D3                                  140833
      *                                                                   140833
     C*************        ENDIF                                                       CLE034BUG7109
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                          140833
     C/COPY WNCPYSRC,LEH00558
      *                                                                   140833
     C                     GOTO CEXIT
     C                     END
      *
     C           FEPIND    IFEQ 'P'
     C                     MOVE 'PERCENT' @PORA
     C                     SETON                     53
     C           FEAMT1    DIV  1000      @AMT13
     C           FEAMT2    DIV  1000      @AMT23
     C           FEAMT3    DIV  1000      @AMT33
     C           FEAMT4    DIV  1000      @AMT43
     C           FEAMT5    DIV  1000      @AMT53
     C                     ELSE
     C                     SETOF                     53
     C                     MOVE 'AMOUNT ' @PORA
     C                     END
      *
     C                     Z-ADDFENPYD    ZDAYNO           Convert
     C                     EXSR ZDATE2                     Next Pay Dte
     C                     MOVE ZADATE    @NPD
     C                     WRITELER140H3                                 BH3407
     C                     WRITELER140D1
      *                                                                   CLE005
      ** If SAR CLE005 is Present                                         CLE005
      *                                                                   CLE005
     C           *IN40     IFEQ *ON                                       CLE005
      *                                                                   CLE005
      **  Check that sufficient lines remain for the Format. If not,      CLE005
      **  write out the Main Headings on a new page.                      CLE005
      *                                                                   CLE005
     C**********           Z-ADD35        RQDLN1  20                CLE005140833
     C                     Z-ADD10        RQDLN1  20                      140833
     C           OLINE     SUB  LINE      DIFLN1  20                      CLE005
     C           DIFLN1    IFLE RQDLN1                                    CLE005
     C                     WRITELER140H1                                  CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     WRITELER140D2
      *                                                                   140833
      * If CLE004 is on and fee is not for an internal participant        140833
      * then print settlement details on report.                          140833
      *                                                                   140833
     C           *IN40     IFEQ *ON                                       140833
     C           PTFI      ANDNE'I'                                       140833
      *                                                                   140833
      ** If CLE034 is on ..                                                                   CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    IFEQ 'Y'                                                           CLE034
      *                                                                                       CLE034
     C                     EXSR SR34                                                          CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C                     Z-ADD3         RQDLN1                                              CLE034
     C           OLINE     SUB  LINE      DIFLN1                                              CLE034
     C           DIFLN1    IFLE RQDLN1                                                        CLE034
     C                     WRITELER140H1                                                      CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      ** Print detail - Settlement allocation is NO                                           CLE034
      *                                                                                       CLE034
     C                     MOVE *OFF      *IN45                                               CLE034
     C                     MOVE ' NO'     RSTAL                                               CLE034
     C                     WRITELER140D5                                                      CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                             BUG7109
     C                     ENDIF                                                             BUG7109
     C           CLE034    IFNE 'Y'                                                          BUG7109
     C           CLE034    OREQ 'Y'                                                          BUG7109
     C           FESTAL    ANDNE'Y'                                                          BUG7109
      * write header if insufficient room on page...                      140833
     C           *IN41     IFEQ *ON                                       140833
     C                     Z-ADD7         RQDLN1                          140833
     C/COPY WNCPYSRC,LER140C003
     C                     ELSE                                           140833
     C           *IN42     IFEQ *ON                                       140833
     C                     Z-ADD25        RQDLN1                          140833
     C/COPY WNCPYSRC,LER140C004
     C                     ENDIF                                          140833
     C                     ENDIF                                          140833
     C           OLINE     SUB  LINE      DIFLN1                          140833
     C           DIFLN1    IFLE RQDLN1                                    140833
     C                     WRITELER140H1                                  140833
     C                     ENDIF                                          140833
      *                                                                   140833
      * print settlement details on report                                140833
     C                     WRITELER140D3                                  140833
      *                                                                   140833
     C*************        ENDIF                                                       CLE034BUG7109
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                          140833
     C/COPY WNCPYSRC,LEH00559
      *                                                                   140833
      *
     C           CEXIT     ENDSR
      /EJECT
      ****************************************************************
      *  LR AUDIT  Report Subroutine :
      *  Called from Main Processing.
      *  Calls Nothing.
      ****************************************************************
     C           E0000     BEGSR
      *
     C                     Z-ADD0         PAGE
      *
      ** Ensure report spool file recorded by RCF
      *
     C                     Z-ADDSFNUMU    ZSNUMU  60
     C                     CALL 'ZSFILE'
     C                     PARM           SEQ
     C                     PARM *BLANKS   SENTY
     C                     PARM           SFILEU
     C                     PARM           ZSNUMU
     C                     PARM           ZSERR
      *
     C           ZSERR     IFEQ 'Y'
      ** Error during ZSFILE processing, return to calling program
     C                     SETON                     U7U8LR
     C                     ELSE
     C*
     C* Write the header to the report every time
     C*
     C                     WRITELER14AU1
     C*
     C* If there is an error output the error format
     C*
     C           *INU8     IFEQ '1'
     C                     WRITEDBFMT
     C                     ELSE
     C*
     C* If there are no details output the format and bypass the
     C* trailer processing
     C*
      *
     C           @REP      IFEQ 0
     C                     WRITELER14AT1                   No details
     C                     ELSE
      *
     C           1         CHAINLEFEEZ               99
     C*
     C* If the record is not found there is no way of updating the
     C* fields
      *                                                    **************
     C           *IN99     IFEQ '1'                        * DBERROR 14 *
     C                     Z-ADD14        DBASE            **************
     C                     MOVEL'1     '  DBKEY
     C                     MOVEL'LEFEEZ'  DBFILE
     C                     ELSE
      *
     C           @INS      ADD  FENRIC    @TOT    50        Check
     C***********@REC      COMP @TOT                 7171   Controls      083304
     C********** @REC      COMP FENORE               7171   Controls      083304           AR750543A
     C********** @INS      COMP FENINT               7272                                  AR750543A
     C********** @DEL      COMP FENDEL               7474                                  AR750543A
      *                                                                                    AR750543A
     C           FENORE    ADD  CANORE    @RNORE                                           AR750543A
     C           FENINT    ADD  CANINT    @RNINT                                           AR750543A
     C           FENAMD    ADD  CANAMD    @RNAMD                                           AR750543A
     C           FENDEL    ADD  CANDEL    @RNDEL                                           AR750543A
      *                                                                                    AR750543A
     C           @REC      COMP @RNORE               7171   Controls      083304           AR750543A
     C           @INS      COMP @RNINT               7272                                  AR750543A
     C********** @AMD      COMP @RNAMD               7373                         AR750543A AR990753
     C           @DEL      COMP @RNDEL               7474                                  AR750543A
      *                                                                                    AR750543A
     C                     MOVEA*IN,71    ERROR   4
     C           ERROR     COMP '0000'               U8
     C                     WRITELER14AT2
      *
     C           *INU8     IFEQ '0'
     C**********           MOVE @REC      FENRIC           Re-set                          AR750543A
     C                     MOVE @PDREC    FENRIC                                           AR750543A
     C                     Z-ADD0         FENINT           Control
     C                     Z-ADD0         FENAMD           File
     C                     Z-ADD0         FENDEL
     C                     MOVE @CPREC    CANRIC                                           AR750543A
     C                     Z-ADD0         CANINT                                           AR750543A
     C                     Z-ADD0         CANAMD                                           AR750543A
     C                     Z-ADD0         CANDEL                                           AR750543A
     C                     UPDATLEFEEZF
     C                     END
      *
     C                     END
     C                     END
     C                     END
     C                     END
     C                     ENDSR
     C/EJECT                                                                                  CLE034
      ********************************************************************                    CLE034
      *                                                                                       CLE034
      *  SR34 - Settlement allocation report processing for CLE034                            CLE034
      *                                                                                       CLE034
      ********************************************************************                    CLE034
     C           SR34      BEGSR                                                              CLE034
      *                                                                                       CLE034
     C                     Z-ADD3         RQDLN1                                              CLE034
     C           OLINE     SUB  LINE      DIFLN1                                              CLE034
     C           DIFLN1    IFLE RQDLN1                                                        CLE034
     C                     WRITELER140H1                                                      CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      ** Print detail - Settlement allocation is YES                                          CLE034
      *                                                                                       CLE034
     C                     MOVE *OFF      *IN45                                               CLE034
     C                     MOVE 'YES'     RSTAL                                               CLE034
     C                     WRITELER140D5                                                      CLE034
      *                                                                                       CLE034
     C                     MOVE *ON       *IN45                                               CLE034
     C                     MOVE 'FEES'    KTYPE                                               CLE034
     C                     Z-ADD*ZERO     KVDAT                                               CLE034
     C                     Z-ADD*ZERO     KLASQ                                               CLE034
     C           KSTALL    SETLLLESTALL5                                                      CLE034
     C           KSTALL    READELESTALL5                 44                                   CLE034
      *                                                                                       CLE034
     C           *IN44     IFEQ *OFF                                                          CLE034
      *                                                                                       CLE034
      ** Print settlement allocation header                                                   CLE034
      *                                                                                       CLE034
     C                     Z-ADD5         RQDLN1                                              CLE034
     C           OLINE     SUB  LINE      DIFLN1                                              CLE034
     C           DIFLN1    IFLE RQDLN1                                                        CLE034
     C                     WRITELER140H1                                                      CLE034
     C                     ENDIF                                                              CLE034
     C                     WRITELER140D4                                                      CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      ** Print settlement allocation details while record exists                              CLE034
      *                                                                                       CLE034
     C           *IN44     DOWEQ*OFF                                                          CLE034
     C                     MOVE *BLANKS   RTMET                                               CLE034
     C                     MOVE *BLANKS   RTCCY                                               CLE034
     C                     MOVE *BLANKS   RTACC                                               CLE034
     C                     MOVE *BLANKS   RTPER                                               CLE034
      *                                                                                       CLE034
     C           *IN41     IFEQ *ON                                                           CLE034
     C                     MOVE SARSTM    RTMET                                               CLE034
     C                     MOVE SARSCY    RTCCY                                               CLE034
     C                     MOVE SARONS    RTACC                                               CLE034
     C                     MOVE SARCPC    ZFIELD                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           *IN42     IFEQ *ON                                                           CLE034
     C                     MOVE SAPSTM    RTMET                                               CLE034
     C                     MOVE SAPSCY    RTCCY                                               CLE034
     C                     MOVE SAPONS    RTACC                                               CLE034
     C                     MOVE SAPYPC    ZFIELD                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     Z-ADD9         ZADEC                                               CLE034
     C                     EXSR ZEDIT                                                         CLE034
     C                     MOVELZFIELD    RTPER                                               CLE034
      *                                                                                       CLE034
     C                     Z-ADD2         RQDLN1                                              CLE034
     C           OLINE     SUB  LINE      DIFLN1                                              CLE034
     C           DIFLN1    IFLE RQDLN1                                                        CLE034
     C                     WRITELER140H1                                                      CLE034
     C                     WRITELER140D4                                                      CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     WRITELER140D5                                                      CLE034
     C           KSTALL    READELESTALL5                 44                                   CLE034
     C                     ENDDO                                                              CLE034
      *                                                                                       CLE034
     C                     ENDSR                                                              CLE034
     C/EJECT                                                                                  CLE034
      *****************************************************************                     MD055481
      *  ORIGB - Display Original Borrower on report                  *                     MD055481
      *                                                               *                     MD055481
      *  Called by: Main Processing                                   *                     MD055481
      *  Calls: None                                                  *                     MD055481
      *****************************************************************                     MD055481
     C           ORIGB     BEGSR                                                            MD055481
      *                                                                                     MD055481
      ** If participation purchased and system value is using Original                      MD055481
      ** Borrower.                                                                          MD055481
      *                                                                                     MD055481
     C                     MOVE *BLANKS   POLNO                                             MD055481
     C                     MOVELBBCRNM    WBCRNM 20                                         MD055481
     C                     MOVELBBCRTN    WBCRTN 10                                         MD055481
     C           WPTYP     IFEQ 64                                                          MD055481
     C           WPTYP     OREQ 65                                                          MD055481
     C           WPTYP     OREQ 68                                                          MD055481
     C           WPTYP     OREQ 71                                                          MD055481
     C                     MOVE '1'       *IN56                                             MD055481
     C                     MOVE WOLNO     POLNO                                             MD055481
     C                     MOVELPOLNO     KEYC   10                                         MD055481
      *                                                                                     MD055481
     C                     CALL 'AOCUSTR0'                                                  MD055481
     C                     PARM *BLANKS   @RTCD                                             MD055481
     C                     PARM '*KEY   ' @OPTN                                             MD055481
     C                     PARM           KEYC                                              MD055481
     C                     PARM           KEYSTS  7                                         MD055481
     C           SDCUST    PARM SDCUST    DSSDY                                             MD055481
      *                                                                                     MD055481
     C           @RTCD     IFEQ *BLANKS                                                     MD055481
     C           @RTCD     OREQ '*CUSCLS'                                                   MD055481
     C                     MOVE BBCRNM    OLNORN                                            MD055481
     C                     MOVE BBCRTN    OLNORT                                            MD055481
     C                     ELSE                                                             MD055481
     C                     MOVE *ALL'*'   OLNORN                                            MD055481
     C                     MOVE *ALL'*'   OLNORT                                            MD055481
     C           *LOCK     IN   LDA                         ************                    MD055481
     C                     MOVELPOLNO     DBKEY             * DBERR 18 *                    MD055481
     C                     Z-ADD18        DBASE             ************                    MD055481
     C                     MOVEL'LER140  'DBPGM                                             MD055481
     C                     MOVEL'SDCUSTPD'DBFILE                                            MD055481
     C                     SETON                     U7U8                                   MD055481
     C                     OUT  LDA                                                         MD055481
     C                     EXSR E0000                                                       MD055481
     C                     EXSR *PSSR                                                       MD055481
     C                     ENDIF                                                            MD055481
     C                     ENDIF                                                            MD055481
     C                     MOVELWBCRNM    BBCRNM                                            MD055481
     C                     MOVELWBCRTN    BBCRTN                                            MD055481
      *                                                                                     MD055481
     C                     ENDSR                                                            MD055481
      ********************************************************************
      *
      *  *PSSR --- SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS
      *
      *  CALLED FROM: AFTER ABNORMAL OPERATION OCCURS
      *
      *  CALLS: NOTHING
      *
      ********************************************************************
      *
     C           *PSSR     BEGSR                           ** *PSSR **
     C*
     C           @RUN      IFEQ *BLANKS
     C                     MOVE 'Y'       @RUN    1
     C                     DUMP
     C                     END
     C*
     C                     SETON                     U7U8LR
     C                     RETRN
     C*
     C                     ENDSR                           ** *PSSR **
     C*
     C********************************************************************
     C/TITLE SR/ZDATE2
     C/COPY ZSRSRC,ZDATE2Z2
     C/COPY ZSRSRC,ZEDITZ2
     C********************************************************************
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
