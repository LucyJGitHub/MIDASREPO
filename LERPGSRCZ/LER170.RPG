     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas LE Fees Settled/Adjusted Today')                 *
     F*****************************************************************
     F*                                                               *
     F*  Midas Customer Lending Module
     F*                                                               *
     F*  LER170 - Fees Settled/Adjusted Today Report                  *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. MD053375           Date 11Oct19               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 CLE139             Date 06Dec10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 CLE106             Date 01Aug04               *
      *                 CLE038             Date 04Jun04               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 CLE034             Date 05May03               *
      *                 CLE031             Date 04Feb03               *
      * Midas Release 4.01.03 ----------------------------------------*
      *                 196066             Date 21Oct02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 204452             Date 02May02               *
      *                 204445             Date 02May02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 193475             Date 29Nov01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 169219             Date 26Apr99               *
      *                 CLE009             Date 26Apr99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 157534             Date 23Mar99               *
      *                 152181             Date  3Mar99               *
      *                 148726             Date 17Dec98               *
      *                 147935             Date  3Mar99               *
      *                 147761             Date  3Mar99               *
      *                 141457             Date 17Feb99               *
      *                 141453             Date 17Feb99               *
     F*                 127016             DATE 29MAY98               *
     F*                 CLE005             Date 22May97               *
     F*                 103348             Date 22May96               *
     F*                 103123             Date 22May96               *
     F*                 101859             DATE 22MAY96               *
     F*                 100515             DATE 22MAY96               *
     F*                 045700             DATE 19SEP92               *
     F*                 MOF60              DATE 02APR92               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  MD053375 - Incorrect fee settlement amount in LER170 report. *
      *             Use new files LEFECPPD and LEFECPL0. Include      *
      *             backvalued fee payment in the report.             *
      *  MD046248 - Finastra Rebranding                               *
      *  CLE134 - Past Due Call Loan Processing (Recompile)           *
      *  CLE148 - Alpha Loan Reference                                *
      *  CLE139 - Lending Fee Capitalisation                          *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type (Recompile)                  *
      *  CLE106 - Syndications Manager.                               *
      *  CLE038 - Lending Enhancement for Nordea: Allocation by Amount*
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CLE034 - Lending Enhancements Phase 1 Priority 1A            *
      *  CLE031 - Lending Enhancements.                               *
      *  196066 - Insert/Amend/Authorise user blank when CLE002 is    *
      *           off. Fix is to condition the display of the fields  *
      *           when CLE002 feature is only switch on.              *
      *  204452 - Recompiled due to changed PF/LEFEED.                *
      *  204445 - Incorrect value printed for Original Amount Due     *
      *  193475 - 'Receivable', 'Payable' or 'Internal' fee indicator *
      *           will only show on report if CLE006 is ON.           *
      *  169219 - LDA not locked in and out in RCFP2 - fix to 152181  *
      *  CLE009 - LE I/C Swift Message Generation for Fees            *
      *           Recompiled due to changes in LEFEED                 *
      *  157534 - Adjustment showing an original due of the previous  *
      *           settlement instead of zero.                         *
      *  152181 - Addition LER170P2 printer file and other fields in  *
      *           LER170P1 report.                                    *
      *  147935 - Addition of insert, authorise and amend user        *
      *           profiles to lending reports.  Also prevents settle- *
      *           ment intructions from being printed for adjustments *
      *  148726 - Account officer wrong on the detail lines of        *
      *           the report.  Seems to be printing the previous      *
      *           account officer against each line.                  *
      *  147761 - Do not show any settlement instructions on the      *
      *           report (LER170P1) if a fee is automatically settled *
      *           as these details are already shown in LER140P1 on   *
      *           the day the fee is entered.                         *
      *  141457 - LER170 original amount due not shown and both sides *
      *  141453 - Recompiled due to changes in PF/LEFEED              *
     F*  127016 - Wrong account officer code printed for fee          *
     F*           settlement/adjustment.  There is no account officer *
     F*           field in LEFEEAD so get fee's account officer in    *
     F*           LEFEED.                                             *
     F*  CLE005 - Customer Lending Enhancements - Others (T3)         *
     F*  103348 - Fix for 045700 forgot to put the file name in       *
     F*           DBFILE if error in chain to LEFEED.                 *
     F*  103123 - Recompile program due to changes in LEFEDAD.        *
     F*           Include branch code as key field.                   *
     F*  101859 - Fee settled today with next settlement date on      *
     F*           next working day should be shown on the report.     *
     F*           Do not process fees with zero settled amount.       *
     F*  100515 - Add new fields to LEFEED. Ensure calculated         *
     F*           fees settled today will be included in the          *
     F*           report. This program should run after LER135        *
     F*           Use new field for the original amount due.          *
     F*  045700  -  Put out original amount due so we can see if Full *
     F*             Settlement was for it all. This fix involves      *
     F*             moving this pgm to run before LER135.             *
     F*  MOF60  - Customer Profitability and Fees Processing.         *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
      *
     F***LEFEDAD IP  E           K        DISK                                              MD053375
     FLEFECPL0IP  E           K        DISK                                                 MD053375
     F***LEFEED* IF  E           K        DISK                                       045700 MD053375
     F**********  LEFEEDF                           KRENAMEFEEDME                    045700 MD053375
     FLEFECPPDIF  E           K        DISK                                                 MD053375
     F            LEFEEDF                           KRENAMEFEEDME                           MD053375
     FLESTALL5IF  E           K        DISK                                                   CLE034
     FLEFEEAZ UF  E                    DISK
     FLER170P1O   E             80     PRINTER      KINFDS SPOOL      UC
     FLER170P2O   E                    PRINTER      KINFDS SPOOL2     UC  152181
     FLER170AUO   E                    PRINTER      KINFDS SPOOLU     UC
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F* 01    First Cycle Indicator.                                  *
     F* 02    'No Branch Details' conditioned output                  *
     F* 05    Print Fee Payable/Fee Receivable Indicator              *
     F* 06    Print Extended details of Fee Settlement instruction    *
     F* 10    Auto-Settlement fee details                             *
     F* 11    Adjusted Fee details                                    *
     F* 20    Record is a settlement                                  *   147935
     F* 27    Control Totals to be output                             *
      *  36 - Condition printing of LER170P2 and other fields.        *   152181
      *  37 - Multibranching indicator                                *   152181
      *  39  - CLE002 is ON                                                                   196066
     F* 60    Number of Decimal Places = 0                            *
     F* 61    Number of Decimal Places = 1                            *
     F* 62    Number of Decimal Places = 2                            *
     F* 63    Number of Decimal Places = 3                            *
     F* 80    Overflow indicator - LER170P1                           *
     F*                                                               *
     F*****************************************************************
      /EJECT
     E                    FER    16  16  1               Fee Reference nn)
     E                    FAR         6  1               Facility (nnn/nn)
     E                    ARN     1   5 18               Narratives
     E                    CPY@    1   1 80
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZEDITZ1                                                                    CLE034
      /EJECT
     ILESTALD0                                                                                CLE034
     I              RSTM                            STRSTM                                    CLE034
     I              PSTM                            STPSTM                                    CLE034
     I              RONS                            STRONS                                    CLE034
     I              PONS                            STPONS                                    CLE034
     I              PSCY                            STPSCY                                    CLE034
     I              POBR                            STPOBR                                    CLE034
     I              PIBN                            STPIBN                                    CLE034
     I              ROBR                            STROBR                                    CLE034
     I              RIBN                            STRIBN                                    CLE034
     I              REXR                            STREXR                                    CLE034
     I              REXI                            STREXI                                    CLE034
     I              PEXR                            STPEXR                                    CLE034
     I              PEXI                            STPEXI                                    CLE034
     I              RIBA                            STRIBA                                    CLE034
     I              ROBN                            STROBN                                    CLE034
     I              ROCN                            STROCN                                    CLE034
     I              CVMR                            STCVMR                                    CLE034
     I              BENN                            STBENN                                    CLE034
     I              BTB1                            STBTB1                                    CLE034
     I              BTB2                            STBTB2                                    CLE034
     I              BTB3                            STBTB3                                    CLE034
     I              BTB4                            STBTB4                                    CLE034
     I              SEQ                             STSEQ                                     CLE034
     I              CCY                             STCCY                                     CLE038
     ILEFEEDF     10
      *
      ** Manual Settlements/Ajustments Today
     I              FEBRCA                          BRCA
     ILEFEEADF    11
      *
     I              FABRCA                          BRCA
     ISDBRCH    E DSSDBRCHPD
      ** External DS for branch name details
     I              A8BRNM                          BRNM
      *                                                                   CLE005
     ISCSARD    E DSSCSARDPD                                              CLE005
      ** Switchable Features File                                         CLE005
      *                                                                   CLE005
     ISDBANK    E DSSDBANKPD
      ** Bank details
      *
     ISDCURR    E DSSDCURRPD
      ** Currency Type
      *
     ISDCUST    E DSSDCUSTPD
     I              QQDFAC                          DFACQQ                                    CGL029
     I*
     I**  EXTERNAL DS FOR CUSTOMER DETAILS
     I            DS
      ** DS to determine dec point
     I                                        1  130@DSAMT
     I                                        1  131@DSAM1
     I                                        1  132@DSAM2
     I                                        1  133@DSAM3
     I            DS                                                      045700
      ** DS to determine dec point                                        045700
     I                                        1  130WOOAM0                045700
     I                                        1  131WOOAM1                045700
     I                                        1  132WOOAM2                045700
     I                                        1  133WOOAM3                045700
     IFEEDDS      DS                                                      045700
     I** DS for database error on chain to LEFEED                         045700
     I                                        1   3 BRCA                  045700
     I**********                              4   90FACNUM                             045700 CSD027
     I                                        4   9 FACNUM                                    CSD027
     I                                       10  140FAFACL                045700
     I**********                             15  200FALOAN                             045700 CLE148
     I                                       15  20 FALOAN                                    CLE148
     I                                       21  220WKFSEQ                045700
     I            DS
      ** Fee Reference
     I                                        1  16 FER
     I                                        1  16 @FR
     I                                        1   6 CUST
     I                                        8  13 @LORF
     I                                        8  13 FAR
     I                                       15  160FEFSEQ
     I                                       15  160FAFSEQ
     IDSFDY     E DSDSFDY
      ** First DS for access programs, short data structure
      *
     IDSSDY     E DSDSSDY
      ** Second DS for access programs, long data structure
      *
     ILDA        UDS                            256
      ** DATABASE ERROR DS
      *
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
      *
      ** File information data structure
     ISPOOL       DS
     I                                       83  92 SFILE
     I                                    B 123 1240SFNUM
     I                                    B 188 1890OFLLN                                     CLE034
     I                                    B 367 3680LINE
     ISPOOL2      DS                                                      152181
     I                                       83  92 SFILE2                152181
     I                                    B 123 1240SFNUM2                152181
     I                                    B 188 1890OFLLN2                152181
     I                                    B 367 3680PRTLN2                152181
      *                                                                   152181
      *
     ISPOOLU      DS
     I                                       83  92 SFILEU
     I                                    B 123 1240SFNUMU
      *
     IRUNDT       DS
      ** Data area RUNDAT
     I                                        1   7 RUNA
     I                                    P   8  100RUND
     I                                       11  11 SSF
     I                                       12  12 DATF
     I                                       13  13 MBIN
     C/EJECT
      *****************************************************************
      *                                                               *
      *  Main Processing.                                             *
      *                                                               *
      *****************************************************************
      *
      ** Set up copyright statement
     C                     MOVEACPY@      BIS@   80
      *
      ** Define LDA
     C           *NAMVAR   DEFN           LDA
      *
      ** Lock in dataarea RUNDAT
     C           *NAMVAR   DEFN RUNDAT    RUNDT
     C                     IN   RUNDT
      *
     C           *LIKE     DEFN CUST      @CUS
     C           *LIKE     DEFN FEFCCY    @CCY
     C           *LIKE     DEFN DBASE     KLASQ                                               CLE034
      *
      ***  Initialisation.
     C  N01                EXSR B0000
      *
     C           *IN10     IFEQ '1'
     C***********FESDAT    CABLTBJRDNB    AEXIT                           100515
     C           FESDAT    CABGEBJDNWD    AEXIT
     C           FESDAT    IFLT BJRDNB                                    100515
     C           FELPDT    ANDLTBJRDNB                                    100515
     C           FEORED    ANDLTBJRDNB                                                      MD053375
     C           FESDAT    ORLT BJRDNB                                    100515
     C           FECALT    ANDEQ*BLANKS                                   100515
     C           FELPDT    ORGE BJDNWD                                    100515
     C           FEPLPD    ANDLTBJRDNB                                    101859
     C           FECALT    ORNE *BLANKS                                   101859
     C           FEPAMS    ANDEQ0                                         101859
     C                     GOTO AEXIT                                     100515
     C                     END                                            100515
     C                     END
      *
     C           *IN10     CASEQ'1'       C0000
     C           *IN11     CASEQ'1'       D0000
     C                     END
      *
      ***  Obtain Customer Name.
     C           CUST      IFNE @CUS
      *
     C                     MOVEL*BLANKS   KEYC   10
     C                     MOVELCUST      KEYC
     C                     CALL 'AOCUSTR0'             99
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           KEYC
     C                     PARM           KEYSTS  7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           @RTCD     IFNE *BLANKS
     C                     MOVE *ALL'*'   BBCRNM
     C                     END
      *
     C                     MOVE CUST      @CUS
     C                     END
      *
     C           FEFCCY    IFNE @CCY
     C                     CALL 'AOCURRR0'             99
     C                     PARM '*MSG    '@RTCD
     C                     PARM '*KEY    '@OPTN
     C                     PARM FEFCCY    CURKEY  3
     C           SDCURR    PARM SDCURR    DSSDY
      *
     C           @RTCD     IFNE *BLANKS
     C                     SETON                     99    ***************
     C                     MOVELFEFCCY    DBKEY            * DB ERROR 02 *
     C                     MOVEL'02'      DBASE            ***************
     C                     EXSR DBERR
     C                     EXSR AUDIT
     C                     EXSR *PSSR
     C                     END
      *
     C           A6NBDP    COMP 1                    626061
     C   62      A6NBDP    COMP 3                      6263
     C                     MOVE FEFCCY    @CCY
     C                     END
     C                     MOVE BRCA      @AORL   3
      *
      ** When branch code changes open new spool file
     C           MBIN      IFEQ 'Y'
     C           BRCA      ANDNESTRBRC
     C                     MOVE BRCA      STRBRC  3
     C                     SETOF                     80
     C   02                WRITELER170T4
     C           *IN02     IFEQ '1'                                       152181
     C           WOPNP2    ANDEQ'Y'                                       152181
     C           OFLLN2    SUB  PRTLN2    DIFLN2  30                      152181
     C           DIFLN2    IFLE 3                                         152181
     C                     WRITEHEADP2                                    152181
     C                     ENDIF                                          152181
     C                     WRITETRAILP2                                   152181
     C                     ENDIF                                          152181
     C                     SETON                     02
     C                     CLOSELER170P1
      *
      ** File has been opened field
     C                     MOVE 'Y'       P1OP    1
     C                     OPEN LER170P1
     C                     Z-ADD0         PAGE
      *
      ** Ensure report spool file recorded by RCF
     C                     Z-ADDSFNUM     ZSNUM
     C                     OUT  LDA
      *
     C                     CALL 'ZSFILE'
     C                     PARM           SEQ     5
     C                     PARM BRCA      SENTY   3
     C                     PARM           SFILE
     C                     PARM           ZSNUM   60
     C                     PARM           ZSERR   1
      *
     C           *LOCK     IN   LDA
      *
      ** If error during ZSFILE processing, return to calling program
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
      *                                                                   152181
     C           CLE005    IFEQ 'Y'                                       152181
     C           WOPNP2    IFEQ 'Y'                                       152181
     C                     CLOSELER170P2                                  152181
     C                     MOVE 'N'       WOPNP2  1                       152181
     C                     ENDIF                                          152181
     C                     OPEN LER170P2                                  152181
     C                     MOVE 'Y'       WOPNP2                          152181
     C                     EXSR RCFP2                                     152181
     C                     ENDIF                                          152181
      *
      ** If system is multibranching obtain branch name for output
     C**********           CALL 'AOBRCHR0'             99                                     CGL029
     C                     CALL 'AOBRCHR1'             99                                     CGL029
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM BRCA      @DSNB   3
     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *
     C           @RTCD     IFNE *BLANKS                    ***************
     C                     MOVELBRCA      DBKEY            * DB ERROR 03 *
     C                     MOVEL'03'      DBASE            ***************
     C                     MOVEL'LER170'  DBPGM
     C                     EXSR AUDIT
     C                     EXSR DBERR
     C                     EXSR *PSSR
     C                     END
      *
      ** Output header
     C                     WRITELER170H1
     C                     WRITELER170H2
     C                     WRITELER170H3
      *                                                                   152181
     C           WOPNP2    IFEQ 'Y'                                       152181
     C                     WRITEHEADP2                                    152181
     C                     ENDIF                                          152181
      *
      ** If system multibranching
     C                     END
      *
      ** If system is not multibranching set up single spool file
     C           MBIN      IFNE 'Y'
     C           P1OP      ANDNE'Y'
     C                     CLOSELER170P1
     C                     MOVE 'Y'       P1OP
     C                     OPEN LER170P1
     C                     SETOF                     80
     C                     Z-ADD0         PAGE
      *
      ** Ensure report spool file recorded by RCF
     C                     Z-ADDSFNUM     ZSNUM
     C                     OUT  LDA
      *
     C                     CALL 'ZSFILE'
     C                     PARM           SEQ     5
     C                     PARM *BLANKS   SENTY   3
     C                     PARM           SFILE
     C                     PARM           ZSNUM   60
     C                     PARM           ZSERR   1
      *
     C           *LOCK     IN   LDA
      *
      ** If error during ZSFILE processing, return to calling program
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
      *
      ** Output header
     C                     WRITELER170H1
     C                     WRITELER170H3
      *                                                                   152181
     C           CLE005    IFEQ 'Y'                                       152181
     C           WOPNP2    IFEQ 'Y'                                       152181
     C                     CLOSELER170P2                                  152181
     C                     MOVE 'N'       WOPNP2                          152181
     C                     ENDIF                                          152181
     C                     OPEN LER170P2                                  152181
     C                     MOVE 'Y'       WOPNP2                          152181
     C                     EXSR RCFP2                                     152181
     C                     WRITEHEADP2                                    152181
     C                     ENDIF                                          152181
      *
      ** MBIN IFNE 'Y' end
     C                     END
      *                                                                   CLE005
      ** Check for printing overflows.                                    CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C           *IN06     ANDEQ'1'                                       CLE005
     C           60        SUB  LINE      XLINE   20                      CLE005
     C           XLINE     IFLT 26                                        CLE005
     C                     SETON                     80                   CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
      *
      ** If overflow indicator on, output another header
     C           *IN80     IFEQ '1'
     C                     WRITELER170H1
     C           MBIN      IFEQ 'Y'
     C                     WRITELER170H2
     C                     END
     C                     WRITELER170H3
     C                     SETOF                     80
     C                     END
      *                                                                   152181
     C           WOPNP2    IFEQ 'Y'                                       152181
     C           OFLLN2    SUB  PRTLN2    DIFLN2  30                      152181
     C           DIFLN2    IFLE 1                                         152181
     C                     WRITEHEADP2                                    152181
     C                     ENDIF                                          152181
     C                     ENDIF                                          152181
     C*                                                                     0072
     C***  Account Officer should be that of the transaction rather         0072
     C***  than off the Customer file (only use that if transaction         0072
     C***  one is blank)                                                    0072
     C*                                                                     0072
     C***********FEACOF    IFNE *BLANKS                              0072 045700
     C***********          MOVE FEACOF    WKACOC  2                  0072 045700
     C***********          ELSE                                      0072 045700
     C***********          MOVE BBACOC    WKACOC                     0072 045700
     C***********          END                                       0072 045700
      *                                                                                       CLE139
      ***  Check Fee Capitalisation value.                                                    CLE139
      *                                                                                       CLE139
     C           FECAPI    IFEQ 'Y'                                                           CLE139
     C                     SETON                     64                                       CLE139
     C                     ELSE                                                               CLE139
     C                     SETOF                     64                                       CLE139
     C                     ENDIF                                                              CLE139
      *
      *
     C                     WRITELER170D1
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           *IN50     ANDEQ*ON                                                           CLE034
      *                                                                                       CLE034
     C                     MOVE 'Y'       WFIRST  1                                           CLE034
     C                     MOVE 'FSET'    KTYPE                                               CLE034
     C                     MOVE *ZEROS    KVDAT                                               CLE034
     C                     MOVE *ZEROS    KLASQ                                               CLE034
     C           KSTALL    SETLLLESTALL5                                                      CLE034
     C           KSTALL    READELESTALL5                 51                                   CLE034
      *                                                                                       CLE034
     C           *IN51     DOWEQ*OFF                                                          CLE034
      *                                                                                       CLE034
      ** Check for overflow                                                                   CLE034
      *                                                                                       CLE034
     C           OFLLN     SUB  LINE      DIFLN   30                                          CLE034
     C           DIFLN     IFLE 5                                                             CLE034
     C                     MOVE *ON       *IN80                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      ** If overflow indicator on, output another header                                      CLE034
      *                                                                                       CLE034
     C           *IN80     IFEQ *ON                                                           CLE034
     C                     WRITELER170H1                                                      CLE034
     C           MBIN      IFEQ 'Y'                                                           CLE034
     C                     WRITELER170H2                                                      CLE034
     C                     ENDIF                                                              CLE034
     C                     WRITELER170H3                                                      CLE034
     C                     WRITELER170H4                                                      CLE034
     C                     MOVE *OFF      *IN80                                               CLE034
     C                     MOVE 'N'       WFIRST                                              CLE034
     C                     ELSE                                                               CLE034
     C           WFIRST    IFEQ 'Y'                                                           CLE034
     C                     WRITELER170H4                                                      CLE034
     C                     MOVE 'N'       WFIRST                                              CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      ** Format details                                                                       CLE034
      *                                                                                       CLE034
     C                     MOVE *BLANKS   ZFIELD                                              CLE034
      *                                                                                       CLE034
     C           *IN07     IFEQ *ON                                                           CLE034
     C                     MOVE STRSTM    RSETM                                               CLE034
     C                     MOVE RSCY      RSETC                                               CLE034
     C                     MOVE STRONS    RSETA                                               CLE034
     C                     MOVE RCPC      ZFIELD                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           *IN06     IFEQ *ON                                                           CLE034
     C                     MOVE STPSTM    RSETM                                               CLE034
     C                     MOVE STPSCY    RSETC                                               CLE034
     C                     MOVE STPONS    RSETA                                               CLE034
     C                     MOVE PYPC      ZFIELD                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     Z-ADD9         ZADEC                                               CLE034
     C                     EXSR ZEDIT                                                         CLE034
     C                     MOVELZFIELD    RPERC                                               CLE034
      *                                                                                       CLE034
      ** Check for overflow                                                                   CLE034
      *                                                                                       CLE034
     C           OFLLN     SUB  LINE      DIFLN                                               CLE034
     C           DIFLN     IFLT 3                                                             CLE034
     C                     MOVE *ON       *IN80                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      ** If overflow indicator on, output another header                                      CLE034
      *                                                                                       CLE034
     C           *IN80     IFEQ *ON                                                           CLE034
     C                     WRITELER170H1                                                      CLE034
     C           MBIN      IFEQ 'Y'                                                           CLE034
     C                     WRITELER170H2                                                      CLE034
     C                     ENDIF                                                              CLE034
     C                     WRITELER170H3                                                      CLE034
     C                     WRITELER170H4                                                      CLE034
     C                     WRITELER170D2                                                      CLE034
     C                     MOVE *OFF      *IN80                                               CLE034
     C                     ELSE                                                               CLE034
     C                     WRITELER170D2                                                      CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           KSTALL    READELESTALL5                 51                                   CLE034
     C                     ENDDO                                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           WOPNP2    IFEQ 'Y'                                       152181
     C                     WRITEDETLP2                                    152181
     C                     ENDIF                                          152181
     C                     ADD  1         @REP
     C                     SETOF                     06                   CLE005
      *
     C           AEXIT     TAG
      *
     CLRN01                EXSR B0000
     CLR                   EXSR F0000
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  B0000 --- Initial Subroutine                                 *
      *                                                               *
      *  CALLED FROM: Main Processing                                 *
      *  CALLS: Nothing                                               *
      *                                                               *
      *****************************************************************
      *
     C           B0000     BEGSR
      *
     C           FEEDKY    KLIST                                          045700
     C                     KFLD           BRCA                            045700
     C                     KFLD           FACNUM                          045700
     C                     KFLD           FAFACL                          045700
     C                     KFLD           FALOAN                          045700
     C                     KFLD           FAFSEQ                          045700
     C*                                                                   045700
     C           KSTALL    KLIST                                                              CLE034
     C                     KFLD           KTYPE   4                                           CLE034
     C                     KFLD           FALOAN                                              CLE034
     C                     KFLD           KVDAT   50                                          CLE034
     C                     KFLD           KLASQ                                               CLE034
     C                     KFLD           FACNUM                                              CLE034
     C                     KFLD           FAFACL                                              CLE034
     C                     KFLD           FAFSEQ                                              CLE034
      *                                                                                       CLE034
     C                     SETON                     01
     C                     SETOF                     02
     C                     Z-ADD0         @DSAMT
     C                     Z-ADD0         WOOAM0                          045700
     C                     MOVEL'LER170'  DBPGM
      *
      ** Access bank details
     C                     CALL 'AOBANKR0'             99
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
      *
     C           @RTCD     IFNE *BLANKS                      *************
     C                     MOVEL'01'      DBASE              * DB ERROR 01
     C                     MOVEL'BANK'    DBKEY              *************
     C                     EXSR AUDIT
     C                     EXSR DBERR
     C                     EXSR *PSSR
     C                     ELSE
     C*
     C**  Check system date format: ddmmyy (*IN98 off), mmddyy (*IN98 on)
     C*
     C           DATF      IFEQ 'M'
     C                     SETON                     98
     C                     END
     C*
     C                     END
      *                                                                   CLE005
      ** Check if CLE005 is switched *ON.                                 CLE005
      *                                                                   CLE005
     C                     MOVE 'N'       CLE005  1                       CLE005
     C                     CALL 'AOSARDR0'                                CLE005
     C                     PARM *BLANKS   @RTCD   7                       CLE005
     C                     PARM '*VERIFY' @OPTN   7                       CLE005
     C                     PARM 'CLE005'  @SARD   6                       CLE005
     C           SCSARD    PARM SCSARD    DSFDY                           CLE005
      *                                                                   CLE005
     C           @RTCD     IFEQ *BLANKS                                   CLE005
     C                     MOVE 'Y'       CLE005                          CLE005
     C                     END                                            CLE005
      *                                                                   CLE005
     C           @RTCD     IFNE *BLANKS                                   CLE005
     C           @RTCD     ANDNE'*NRF  '                   ***************CLE005
     C                     MOVEL'CLE005'  DBKEY            * DB ERROR 04 *CLE005
     C                     MOVEL'04'      DBASE            ***************CLE005
     C                     MOVEL'LER170'  DBPGM                           CLE005
     C                     EXSR AUDIT                                     CLE005
     C                     EXSR DBERR                                     CLE005
     C                     EXSR *PSSR                                     CLE005
     C                     END                                            CLE005
      *                                                                                       193475
      ** Check if CLE006 is switched *ON.                                                     193475
      *                                                                                       193475
     C                     MOVE 'N'       CLE006  1                                           193475
     C                     CALL 'AOSARDR0'                                                    193475
     C                     PARM *BLANKS   @RTCD   7                                           193475
     C                     PARM '*VERIFY' @OPTN   7                                           193475
     C                     PARM 'CLE006'  @SARD   6                                           193475
     C           SCSARD    PARM SCSARD    DSFDY                                               193475
      *                                                                                       193475
     C           @RTCD     IFEQ *BLANKS                                                       193475
     C                     MOVE 'Y'       CLE006                                              193475
     C                     END                                                                193475
      *                                                                                       193475
     C           @RTCD     IFNE *BLANKS                                                       193475
     C           @RTCD     ANDNE'*NRF  '                   ***************                    193475
     C                     MOVEL'CLE006'  DBKEY            * DB ERROR 15 *                    193475
     C                     MOVEL'15'      DBASE            ***************                    193475
     C                     MOVEL'LER170'  DBPGM                                               193475
     C                     EXSR AUDIT                                                         193475
     C                     EXSR DBERR                                                         193475
     C                     EXSR *PSSR                                                         193475
     C                     END                                                                193475
      *                                                                                       CLE031
      ** Check if CLE031 is installed in the system                                           CLE031
      *                                                                                       CLE031
     C                     CALL 'AOSARDR0'                                                    CLE031
     C                     PARM *BLANKS   PRTCD   7                                           CLE031
     C                     PARM '*VERIFY' POPTN   7                                           CLE031
     C                     PARM 'CLE031'  PSARD   6                                           CLE031
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE031
      *                                                                                       CLE031
     C           PRTCD     IFEQ *BLANK                                                        CLE031
     C                     MOVE 'Y'       CLE031  1                                           CLE031
     C                     MOVE *ON       *IN48                                               CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE 'N'       CLE031                                              CLE031
     C                     MOVE *OFF      *IN48                                               CLE031
     C           PRTCD     IFNE '*NRF   '                                                     CLE031
     C           *LOCK     IN   LDA                                                           CLE031
     C                     MOVEL'SCSARDPD'DBFILE    P                                         CLE031
     C                     MOVELPSARD     DBKEY     P                                         CLE031
     C                     Z-ADD15        DBASE                                               CLE031
     C                     MOVEL'LER150'  DBPGM     P                                         CLE031
     C                     OUT  LDA                                                           CLE031
     C                     EXSR AUDIT                                                         CLE031
     C                     EXSR DBERR                                                         CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE034
      ** Check if CLE034 is switched *ON.                                                     CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSARDR0'                                                    CLE034
     C                     PARM *BLANKS   PRTCD                                               CLE034
     C                     PARM '*VERIFY' POPTN                                               CLE034
     C                     PARM 'CLE034'  PSARD                                               CLE034
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE034
      *                                                                                       CLE034
     C           PRTCD     IFNE *BLANKS                                                       CLE034
     C           PRTCD     ANDNE'*NRF  '                                                      CLE034
     C           *LOCK     IN   LDA                                                           CLE034
     C                     MOVEL'SCSARDPD'DBFILE    P                                         CLE034
     C                     MOVELPSARD     DBKEY     P                                         CLE034
     C                     Z-ADD16        DBASE                                               CLE034
     C                     MOVEL'LER170'  DBPGM     P                                         CLE034
     C                     EXSR AUDIT                                                         CLE034
     C                     EXSR DBERR                                                         CLE034
     C                     EXSR *PSSR                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           PRTCD     IFEQ *BLANKS                                                       CLE034
     C                     MOVE 'Y'       CLE034  1                                           CLE034
     C                     MOVE *ON       *IN49                                               CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'N'       CLE034                                              CLE034
     C                     MOVE *OFF      *IN49                                               CLE034
     C                     ENDIF                                                              CLE034
      *
     C           CLE005    IFEQ 'Y'                                       152181
     C                     MOVE '1'       *IN36                           152181
     C                     ENDIF                                          152181
     C           MBIN      IFEQ 'Y'                                       152181
     C                     MOVE '1'       *IN37                           152181
     C                     ENDIF                                          152181
      *                                                                   152181
      *                                                                                       196066
      ** Check if CLE002 is switched *ON.                                                     196066
      *                                                                                       196066
     C                     MOVE 'N'       CLE002  1                                           196066
     C                     CALL 'AOSARDR0'                                                    196066
     C                     PARM *BLANKS   @RTCD   7                                           196066
     C                     PARM '*VERIFY' @OPTN   7                                           196066
     C                     PARM 'CLE002'  @SARD   6                                           196066
     C           SCSARD    PARM SCSARD    DSFDY                                               196066
      *                                                                                       196066
     C           @RTCD     IFEQ *BLANKS                                                       196066
     C                     MOVE 'Y'       CLE002                                              196066
     C                     END                                                                196066
      *                                                                                       196066
     C           @RTCD     IFNE *BLANKS                                                       196066
     C           @RTCD     ANDNE'*NRF  '                   ***************                    196066
     C                     MOVEL'CLE002'  DBKEY            * DB ERROR 05 *                    196066
     C                     MOVEL'05'      DBASE            ***************                    196066
     C                     MOVEL'LER170'  DBPGM                                               196066
     C                     EXSR AUDIT                                                         196066
     C                     EXSR DBERR                                                         196066
     C                     EXSR *PSSR                                                         196066
     C                     END                                                                196066
      *                                                                                       196066
     C           CLE002    IFEQ 'Y'                                                           196066
     C                     MOVE '1'       *IN39                                               196066
     C                     ENDIF                                                              196066
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  C0000 --- Subroutine to process Auto-Settlement Details      *
      *                                                               *
      *  CALLED FROM: Main Processing                                 *
      *  CALLS: Nothing                                               *
      *                                                               *
      *****************************************************************
      *
     C           C0000     BEGSR
      *                                                                  CLE005
      ***If*CLE005*is*switched**ON,*print*the*'Fee*Payable/Fee*********                CLE005 193475
      ** If CLE006 is switched *ON, print the 'Fee Payable/Fee                                193475
      ** Receivable' indicator.                                          CLE005
      *                                                                  CLE005
     C           CLE005    IFEQ 'Y'                                      CLE005
     C                     SETON                     05                  CLE005
     C           PTFI      IFEQ 'P'                                      CLE005
     C           PTFI      OREQ 'S'                                                           CLE106
     C           PTFI      OREQ 'R'                                                           CLE106
     C           CLE006    IFEQ 'Y'                                                           193475
     C                     MOVE 'P'       RPTFI                          CLE005
     C                     ENDIF                                                              193475
     C***********          MOVE '1'       *IN06                   141457 147761
     C                     MOVE '0'       *IN06                          147761
     C                     MOVE '0'       *IN07                          141457
     C                     ENDIF                                         CLE005
      *                                                                  CLE005
     C           PTFI      IFEQ 'I'                                      CLE005
     C           CLE006    IFEQ 'Y'                                                           193475
     C                     MOVE 'I'       RPTFI                          CLE005
     C                     ENDIF                                                              193475
     C                     MOVE '0'       *IN06                          141457
     C                     MOVE '0'       *IN07                          141457
     C                     ENDIF                                         CLE005
      *                                                                  CLE005
     C           PTFI      IFEQ *BLANK                                   CLE005
     C           CLE006    IFEQ 'Y'                                                           193475
     C                     MOVE 'R'       RPTFI                          CLE005
     C                     ENDIF                                                              193475
     C                     MOVE '0'       *IN06                          141457
     C***********          MOVE '1'       *IN07                   141457 147761
     C                     MOVE '0'       *IN07                          147761
     C                     ENDIF                                         CLE005
     C                     ENDIF                                         CLE005
      *                                                                  CLE005
      ***If*CLE005*is*switched**ON,*setup*the*extended*details*of*CLE005 147761
      ***Fee*settlement*instructions*for*printing.*(PF/LEFEED)****CLE005 147761
      ***********                                                 CLE005 147761
     C***********CLE005    IFEQ 'Y'                               CLE005 147761
     C***********          SETON                     06            CLE005 141457
      ***********                                                 CLE005 147761
      ***For*Receipt*Settlement*Instruction.*                     CLE005 147761
     C***********          MOVE RSTM      RRSTM                   CLE005 147761
     C***********          MOVE RONS      RRONS                   CLE005 147761
     C***********          MOVE ROCN      RROCN                   CLE005 147761
     C***********          MOVE ROBN      RROBN                   CLE005 147761
     C***********          MOVE RIBN      RRIBN                   CLE005 147761
     C***********          MOVE RIBA      RRIBA                   CLE005 147761
      ***********                                                 CLE005 147761
      ***For*Payment*Settlement*Instruction.*                     CLE005 147761
     C***********          MOVE PSTM      RPSTM                   CLE005 147761
     C***********          MOVE PONS      RPONS                   CLE005 147761
     C***********          MOVE CVMR      RCVMR                   CLE005 147761
     C***********          MOVE RVNO      RRVNO                   CLE005 147761
     C***********          MOVE POCN      RPOCN                   CLE005 147761
     C***********          MOVE POBN      RPOBN                   CLE005 147761
     C***********          MOVE RCRN      RRCRN                   CLE005 147761
     C***********          MOVE RCRA      RRCRA                   CLE005 147761
     C***********          MOVE PIBN      RPIBN                   CLE005 147761
     C***********          MOVE PIBA      RPIBA                   CLE005 147761
     C***********          MOVE AWBN      RAWBN                   CLE005 147761
     C***********          MOVE AWBA      RAWBA                   CLE005 147761
     C***********          MOVE BENN      RBENN                   CLE005 147761
     C***********          MOVE BENA      RBENA                   CLE005 147761
     C***********          MOVE DTP1      RDTP1                   CLE005 147761
     C***********          MOVE DTP2      RDTP2                   CLE005 147761
     C***********          MOVE DTP3      RDTP3                   CLE005 147761
     C***********          MOVE DTP4      RDTP4                   CLE005 147761
     C***********          MOVE DCHG      RDCHG                   CLE005 147761
     C***********          MOVE BTB1      RBTB1                   CLE005 147761
     C***********          MOVE BTB2      RBTB2                   CLE005 147761
     C***********          MOVE BTB3      RBTB3                   CLE005 147761
     C***********          MOVE BTB4      RBTB4                   CLE005 147761
     C***********          MOVE BTB5      RBTB5                   CLE005 147761
     C***********          MOVE BTB6      RBTB6                   CLE005 147761
      ***********                                                 CLE005 147761
     C***********          ENDIF                                  CLE005 147761
      *
     C                     MOVE FECNUM    CUST
     C           FEACOF    IFNE *BLANKS                                  045700
     C                     MOVE FEACOF    WKACOC  2                      045700
     C                     ELSE                                          045700
      *                                                                   148726
     C                     MOVEL*BLANKS   KEYC                            148726
     C                     MOVELCUST      KEYC                            148726
     C                     CALL 'AOCUSTR0'             99                 148726
     C                     PARM '*MSG   ' @RTCD                           148726
     C                     PARM '*KEY   ' @OPTN                           148726
     C                     PARM           KEYC                            148726
     C                     PARM           KEYSTS                          148726
     C           SDCUST    PARM SDCUST    DSSDY                           148726
      *                                                                   148726
     C           @RTCD     IFNE *BLANKS                                   148726
     C                     MOVE '**'      BBACOC                          148726
     C                     ENDIF                                          148726
      *                                                                   148726
     C                     MOVE BBACOC    WKACOC                         045700
     C                     END                                           045700
      *
     C           FEPYON    IFEQ 'E'
     C                     Z-ADDFEPEND    @DAT5   50
     C                     ELSE
      *
     C           FEPYON    IFEQ 'N'
     C***********          Z-ADDFESDAT    @DAT5                           100515
     C           FELPDT    IFNE BJDNWD                                    101859
     C                     Z-ADDFELPDT    @DAT5                           100515
     C                     ELSE                                           101859
     C                     Z-ADDFEPLPD    @DAT5                           101859
     C                     END                                            101859
     C                     ELSE
     C                     Z-ADDFEPSTD    @DAT5
     C                     END
     C                     END
     C                     Z-ADD0         WOOAM0                          045700
      *
      ***  Settlement Date Conversion.
      *
     C           @DAT5     IFNE ZDAYNO
     C                     Z-ADD@DAT5     ZDAYNO
     C                     EXSR ZDATE2
     C                     END
      *
     C                     MOVE ZADATE    @DD
     C           FECALT    IFEQ *BLANKS                                   100515
     C                     Z-ADDFEAMTS    @DSAMT
     C                     ELSE                                           100515
     C                     Z-ADDFEPAMS    @DSAMT                          100515
     C                     END                                            100515
      *
     C           FEFACL    IFNE 0
     C                     MOVE FEFACL    @LORF
     C                     MOVE FAR,2     FAR,1
     C                     MOVE FAR,3     FAR,2
     C                     MOVE FAR,4     FAR,3
     C                     MOVE '/'       FAR,4
     C                     ELSE
     C                     MOVE FELOAN    @LORF
     C                     END
      *
      ***  AUTO SETTLE.
     C                     MOVE ARN,1     @NAR
      *
     C           CEXIT     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  D0000 --- Subroutine to process Adjusted fee Details         *
      *                                                               *
      *  CALLED FROM: Main Processing                                 *
      *  CALLS: Nothing                                               *
      *                                                               *
      *****************************************************************
      *
     C           D0000     BEGSR
      *                                                                  CLE005
      *  Reset settlement/adjustment indicator                            147935
     C                     MOVE *OFF      *IN20                           147935
      *                                                                   147935
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FASTAL    IFEQ 'Y'                                                           CLE034
     C                     MOVE 'YES'     RSTAL                                               CLE034
     C                     MOVE *ON       *IN50                                               CLE034
     C                     ELSE                                                               CLE034
     C                     MOVEL'NO '     RSTAL                                               CLE034
     C                     MOVE *OFF      *IN50                                               CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      ***If*CLE005*is*switched**ON,*print*the*'Fee*Payable/Fee*********                CLE005 193475
      ** If CLE006 is switched *ON, print the 'Fee Payable/Fee                                193475
      ** Receivable' indicator.                                          CLE005
      *                                                                  CLE005
     C           CLE005    IFEQ 'Y'                                      CLE005
     C                     SETON                     05                  CLE005
     C           PTFI      IFEQ 'P'                                      CLE005
     C           PTFI      OREQ 'S'                                                           CLE106
     C           PTFI      OREQ 'R'                                                           CLE106
     C           CLE006    IFEQ 'Y'                                                           193475
     C                     MOVE 'P'       RPTFI                          CLE005
     C                     ENDIF                                                              193475
     C                     MOVE '1'       *IN06                           141457
     C                     MOVE '0'       *IN07                           141457
     C                     ENDIF                                         CLE005
      *                                                                  CLE005
     C           PTFI      IFEQ 'I'                                      CLE005
     C           CLE006    IFEQ 'Y'                                                           193475
     C                     MOVE 'I'       RPTFI                          CLE005
     C                     ENDIF                                                              193475
     C                     MOVE '0'       *IN06                           141457
     C                     MOVE '0'       *IN07                           141457
     C                     ENDIF                                         CLE005
      *                                                                  CLE005
     C           PTFI      IFEQ *BLANK                                   CLE005
     C           CLE006    IFEQ 'Y'                                                           193475
     C                     MOVE 'R'       RPTFI                          CLE005
     C                     ENDIF                                                              193475
     C                     MOVE '0'       *IN06                           141457
     C                     MOVE '1'       *IN07                           141457
     C                     ENDIF                                         CLE005
     C                     ENDIF                                         CLE005
      *                                                                   147935
      ** If record is an adjustment, do not print settlement instrucs.    147935
     C           FARECI    IFEQ 'A'                                       147935
     C                     MOVE '0'       *IN06                           147935
     C                     MOVE '0'       *IN07                           147935
     C                     ENDIF                                          147935
      *                                                                  CLE005
      ** If CLE005 is switched *ON and detail is for Manual Settlement   CLE005
      ** setup the extended details of Fee Settlement instructions for   CLE005
      *  printing. (PF/LEFEEAD)                                          CLE005
      *                                                                  CLE005
     C           CLE005    IFEQ 'Y'                                      CLE005
     C           *IN50     ANDEQ*OFF                                                          CLE034
     C           FARECI    ANDNE'A'                                      CLE005
     C***********          SETON                     06            CLE005 141457
      *                                                                                       CLE031
      ** Format settlement ccy/xrate/indicator                                                CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE *BLANK    RRSCY                                               CLE031
     C                     Z-ADD0         RREXR                                               CLE031
     C                     MOVE *BLANK    RREXI                                               CLE031
     C                     MOVE *BLANK    RPSCY                                               CLE031
     C                     Z-ADD0         RPEXR                                               CLE031
     C                     MOVE *BLANK    RPEXI                                               CLE031
     C           *IN07     IFEQ *ON                                                           CLE031
     C                     MOVE FASCCY    RRSCY                                               CLE031
     C                     Z-ADDFAREXR    RREXR                                               CLE031
     C                     MOVE FAREXI    RREXI                                               CLE031
     C                     ENDIF                                                              CLE031
     C           *IN06     IFEQ *ON                                                           CLE031
     C                     MOVE FAPSCY    RPSCY                                               CLE031
     C                     Z-ADDFAPEXR    RPEXR                                               CLE031
     C                     MOVE FAPEXI    RPEXI                                               CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                  CLE005
      ** For Receipt Settlement Instruction.                             CLE005
     C                     MOVE RSTM      RRSTM                          CLE005
     C                     MOVE RONS      RRONS                          CLE005
     C                     MOVE ROCN      RROCN                          CLE005
     C                     MOVE ROBN      RROBN                          CLE005
     C                     MOVE RIBN      RRIBN                          CLE005
     C                     MOVE RIBA      RRIBA                          CLE005
      *                                                                  CLE005
      ** For Payment Settlement Instruction.                             CLE005
     C                     MOVE PSTM      RPSTM                          CLE005
     C                     MOVE PONS      RPONS                          CLE005
     C                     MOVE CVMR      RCVMR                          CLE005
     C                     MOVE RVNO      RRVNO                          CLE005
     C                     MOVE POCN      RPOCN                          CLE005
     C                     MOVE POBN      RPOBN                          CLE005
     C                     MOVE RCRN      RRCRN                          CLE005
     C                     MOVE RCRA      RRCRA                          CLE005
     C                     MOVE PIBN      RPIBN                          CLE005
     C                     MOVE PIBA      RPIBA                          CLE005
     C                     MOVE AWBN      RAWBN                          CLE005
     C                     MOVE AWBA      RAWBA                          CLE005
     C                     MOVE BENN      RBENN                          CLE005
     C                     MOVE BENA      RBENA                          CLE005
     C                     MOVE DTP1      RDTP1                          CLE005
     C                     MOVE DTP2      RDTP2                          CLE005
     C                     MOVE DTP3      RDTP3                          CLE005
     C                     MOVE DTP4      RDTP4                          CLE005
     C                     MOVE DCHG      RDCHG                          CLE005
     C                     MOVE BTB1      RBTB1                          CLE005
     C                     MOVE BTB2      RBTB2                          CLE005
     C                     MOVE BTB3      RBTB3                          CLE005
     C                     MOVE BTB4      RBTB4                          CLE005
     C                     MOVE BTB5      RBTB5                          CLE005
     C                     MOVE BTB6      RBTB6                          CLE005
     C                     ENDIF                                         CLE005
      *
     C                     MOVE FACNUM    CUST
      *                                                                   127016
      ** Get settled/adjusted fee's account officer                       127016
      *                                                                   127016
      *                                                                   148726
     C           FATYPE    IFEQ ' '                                       148726
     C           FEEDKY    CHAINFEEDME               77                   127016
     C*                                                                   127016
     C           *IN77     IFEQ '1'                                       127016
     C                     SETON                     99                   127016
     C                     MOVE FAFSEQ    WKFSEQ           ***************127016
     C                     MOVELFEEDDS    DBKEY            * DB ERROR 77 *127016
     C                     MOVEL'77'      DBASE            ***************127016
     C                     EXSR DBERR                                     127016
     C                     EXSR AUDIT                                     127016
     C                     EXSR *PSSR                                     127016
     C***********          ELSE                                     127016148726
     C                     ENDIF                                          148726
     C                     ENDIF                                          148726
     C           FEACOF    IFNE *BLANKS                                  045700
     C                     MOVE FEACOF    WKACOC  2                      045700
     C                     ELSE                                          045700
      *                                                                   148726
     C                     MOVEL*BLANKS   KEYC                            148726
     C                     MOVELCUST      KEYC                            148726
     C                     CALL 'AOCUSTR0'             99                 148726
     C                     PARM '*MSG   ' @RTCD                           148726
     C                     PARM '*KEY   ' @OPTN                           148726
     C                     PARM           KEYC                            148726
     C                     PARM           KEYSTS                          148726
     C           SDCUST    PARM SDCUST    DSSDY                           148726
      *                                                                   148726
     C           @RTCD     IFNE *BLANKS                                   148726
     C                     MOVE '**'      BBACOC                          148726
     C                     ENDIF                                          148726
      *                                                                   148726
     C                     MOVE BBACOC    WKACOC                         045700
     C                     END                                           045700
     C***************      END                                     127016 148726
      *
     C           FAFACL    IFNE 0
     C                     MOVE FAFACL    @LORF
     C                     MOVE FAR,2     FAR,1
     C                     MOVE FAR,3     FAR,2
     C                     MOVE FAR,4     FAR,3
     C                     MOVE '/'       FAR,4
     C                     ELSE
     C                     MOVE FALOAN    @LORF
     C                     END
      *
      ***  Adjustment.
     C           FARECI    IFEQ 'A'
     C                     MOVE *BLANKS   @DD
     C                     MOVE ARN,3     @NAR
     C                     Z-ADD0         WOOAM0                          157534
     C                     ELSE
      *
      ***  Settlement.
     C           FASADD    IFNE ZDAYNO
     C                     MOVE FASADD    ZDAYNO
     C                     EXSR ZDATE2
     C                     END
      *
     C                     MOVE ZADATE    @DD
     C           FATYPE    IFEQ 'P'
     C                     MOVE ARN,2     @NAR
     C                     EXSR SROAMD                                    141457
     C                     MOVEL'05'      WCNT    30                      141457
     C                     END
      *
     C           FATYPE    IFEQ 'W'
     C                     MOVE ARN,4     @NAR
     C                     EXSR SROAMD                                    141457
     C                     MOVEL'06'      WCNT    30                      141457
     C                     END
      *
     C***********          Z-ADD0         WOOAM0 130               045700 141457
     C*                                                                   045700
     C           FATYPE    IFEQ 'F'
     C                     MOVE ARN,5     @NAR
     C***********          MOVE '0'       *IN77                    045700 141457
     C***********                                                  045700 141457
     C*****Find*original amount due.                               045700 141457
     C***********                                                  045700 141457
     C***********FEEDKY    CHAINFEEDME               77            045700 141457
     C***********                                                  045700 141457
     C************IN77     IFEQ '1'                                045700 141457
     C***********          SETON                     99            045700 141457
     C***********          MOVE FAFSEQ    WKFSEQ    ***************045700 141457
     C***********          MOVELFEEDDS    DBKEY     * DB ERROR 77 *045700 141457
     C***********          MOVEL'77'      DBASE     ***************045700 141457
     C***********          EXSR DBERR                              045700 141457
     C***********          EXSR AUDIT                              045700 141457
     C***********          EXSR *PSSR                              045700 141457
     C***********          END                                     045700 141457
     C***********                                                  045700 141457
     C***********          Z-ADDFEAMTP    WOOAM0                   045700 100515
     C***********          Z-ADDFEPAMP    WOOAM0                   100515 141457
     C***********          MOVE BBACOC    WKACOC                   E44748 141457
      *                                                                   141457
     C                     EXSR SROAMD                                    141457
     C                     MOVEL'07'      WCNT    30                      141457
     C                     END
      *
     C                     END
      *
     C                     MOVE FAFCCY    FEFCCY
      *
     C           FASIGN    IFEQ '-'
     C                     Z-SUBFASADJ    @DSAMT
     C                     ELSE
     C                     Z-ADDFASADJ    @DSAMT
     C                     END
      *                                                                   147935
      *  Fill user fields for report (fields only appear if settlement    147935
      *  and non-autosettle)                                              147935
     C           FARECI    IFEQ 'S'                                       147935
     C                     MOVE *ON       *IN20                           147935
     C                     MOVE IUSR      @IUSR                           147935
     C                     MOVE AUSR      @AUSR                           147935
     C                     MOVE XUSR      @XUSR                           147935
     C                     Z-ADDFAVDAT    ZDAYNO                          152181
     C                     EXSR ZDATE2                                    152181
     C                     MOVE ZADATE    RVDAT                           152181
     C                     ENDIF                                          147935
      *                                                                   147935
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT                                                              141457
      *****************************************************************   141457
      *                                                               *   141457
      *  SROAMD -  Sub-routine to get original amount due.            *   141457
      *                                                               *   141457
      *  CALLED FROM: D0000                                           *   141457
      *  CALLS: Nothing                                               *   141457
      *                                                               *   141457
      *****************************************************************   141457
      *                                                                   141457
     C           SROAMD    BEGSR                                          141457
      *                                                                   141457
      **  Find original amount due.                                       141457
      *                                                                   141457
     C                     Z-ADD0         WOOAM0 130                      141457
     C                     MOVE '0'       *IN77                           141457
      *                                                                   141457
     C           FEEDKY    CHAINFEEDME               77                   141457
      *                                                                   141457
     C           *IN77     IFEQ '1'                                       141457
     C                     MOVE '1'       *IN99                           141457
     C                     MOVE FAFSEQ    WKFSEQ           ***************141457
     C                     MOVELFEEDDS    DBKEY            * DB ERROR XX *141457
     C                     MOVELWCNT      DBASE            ***************141457
     C                     EXSR DBERR                                     141457
     C                     EXSR AUDIT                                     141457
     C                     EXSR *PSSR                                     141457
     C                     ENDIF                                          141457
      *                                                                   141457
     C**********           Z-ADDFEPAMP    WOOAM0                          141457              204445
     C                     Z-ADDFEAMTP    WOOAM0                                              204445
      *                                                                   148726
     C                     MOVEL*BLANKS   KEYC                            148726
     C                     MOVELCUST      KEYC                            148726
     C                     CALL 'AOCUSTR0'             99                 148726
     C                     PARM '*MSG   ' @RTCD                           148726
     C                     PARM '*KEY   ' @OPTN                           148726
     C                     PARM           KEYC                            148726
     C                     PARM           KEYSTS                          148726
     C           SDCUST    PARM SDCUST    DSSDY                           148726
      *                                                                   148726
     C           @RTCD     IFNE *BLANKS                                   148726
     C                     MOVE '**'      BBACOC                          148726
     C                     ENDIF                                          148726
      *                                                                   148726
     C                     MOVE BBACOC    WKACOC                          141457
      *                                                                   141457
     C                     ENDSR                                          141457
      /EJECT
      *****************************************************************
      *                                                               *
      *  F0000 --- End of Report Subroutine                           *
      *                                                               *
      *  CALLED FROM: Main Processing                                 *
      *  CALLS: Nothing                                               *
      *                                                               *
      *****************************************************************
      *
     C           F0000     BEGSR
      *
      ***  End of Report.
     C           @REP      IFNE 0
     C                     WRITELER170T3
     C           WOPNP2    IFEQ 'Y'                                       152181
     C           OFLLN2    SUB  PRTLN2    DIFLN2  30                      152181
     C           DIFLN2    IFLE 3                                         152181
     C                     WRITEHEADP2                                    152181
     C                     ENDIF                                          152181
     C                     WRITETRAILP2                                   152181
     C                     ENDIF                                          152181
     C                     END
      *
     C                     CLOSELER170AU
     C                     OPEN LER170AU
     C                     Z-ADD0         PAGE
      *
     C                     WRITELER17AU1
      *
      ***  No Records to Report.
     C           @REP      IFEQ 0
     C                     WRITELER170T1
     C                     SETON                     27
     C                     END
      *
      ***  Controls.
     C  N27                WRITELER170T2
     C   27                SETOF                     27
      *
     C                     READ LEFEEAZF                 99
     C                     Z-ADD0         FANORE
     C                     Z-ADD0         FANINT
     C                     Z-ADD0         FANAMD
     C                     Z-ADD0         FANDEL
     C                     Z-ADD0         FANRIC
     C                     UPDATLEFEEAZF
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  DBERR --- Subroutine to perform Database Error Processing    *
      *                                                               *
      *  CALLED FROM: Main Processing                                 *
      *  CALLS: Nothing                                               *
      *                                                               *
      *****************************************************************
      *
     C           DBERR     BEGSR
      *
     C           DBASE     IFEQ 01
     C                     MOVEL'SDBANKPD'DBFILE
     C                     END
      *
     C           DBASE     IFEQ 02
     C                     MOVEL'SDCURRPD'DBFILE
     C                     END
      *
     C           DBASE     IFEQ 03
     C                     MOVEL'SDBRCHPD'DBFILE
     C                     END
      *                                                                   CLE005
     C           DBASE     IFEQ 04                                        CLE005
     C           DBASE     OREQ 15                                                            193475
     C                     MOVEL'SCSARDPD'DBFILE                          CLE005
     C                     END                                            CLE005
      *                                                                   103348
     C***********DBASE     IFEQ 77                                 103348 141457
     C           DBASE     IFEQ 05                                        141457
     C           DBASE     OREQ 06                                        141457
     C           DBASE     OREQ 07                                        141457
     C                     MOVEL'LEFEED  'DBFILE                          103348
     C                     END                                            103348
      *
     C                     CLOSELER170AU
     C                     OPEN LER170AU
      *
     C                     SETON                     U7U8LR
     C                     WRITELER17AU1
     C                     WRITEDBFMT
     C                     RETRN
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      * SUBROUTINE : AUDIT                                            *
      *                                                               *
      * CALLED IN MAIN PROCESSING IF PRINTER FILE NOT ALREADY OPENED  *
      * (e.g., database error or successfully reconciled message on   *
      *  audit report)                                                *
      *                                                               *
      *****************************************************************
      *
     C           AUDIT     BEGSR
      *
     C                     CLOSELER170AU
      *
      ** Open AU spool file
     C                     OPEN LER170AU
      *
      ** Ensure report spool file recorded by RCF
     C                     Z-ADDSFNUMU    ZSNUMU  60
     C                     OUT  LDA
     C                     CALL 'ZSFILE'
     C                     PARM           SEQ     5
     C                     PARM *BLANKS   SENTY   3
     C                     PARM           SFILEU
     C                     PARM           ZSNUMU
     C                     PARM           ZSERR
      *
     C           *LOCK     IN   LDA
      *
     C           ZSERR     IFEQ 'Y'
      ** Error during ZSFILE processing, return to calling program
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  *PSSR --- SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS     *
      *                                                               *
      *  CALLED FROM: AFTER ABNORMAL OPERATION OCCURS                 *
      *  CALLS: NOTHING                                               *
      *                                                               *
      *****************************************************************
      *
     C           *PSSR     BEGSR                           ** *PSSR **
      *
     C           @RUN      IFEQ *BLANKS
     C                     MOVE 'Y'       @RUN    1
     C                     DUMP
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT                                                              152181
      *****************************************************************   152181
      *                                                               *   152181
      *  RCFP2  - Subroutine to register the P2 Printer File via RCF. *   152181
      *                                                               *   152181
      *  Called From: Main Processing                                 *   152181
      *  Calls: None.                                                 *   152181
      *                                                               *   152181
      *****************************************************************   152181
     C           RCFP2     BEGSR                                          152181
      *                                                                   152181
      ** Ensure Report Spool File recorded by RCF.                        152181
      *                                                                   152181
     C                     Z-ADDSFNUM2    ZSNUM                           152181
      *                                                                   152181
     C                     OUT  LDA                                       169219
     C                     CALL 'ZSFILE'                                  152181
     C                     PARM           SEQ                             152181
     C                     PARM           SENTY                           152181
     C                     PARM           SFILE2                          152181
     C                     PARM           ZSNUM                           152181
     C                     PARM           ZSERR                           152181
      *                                                                   152181
      ** If Error occurs during ZSFILE processing, then return to the     152181
      ** Calling Program.                                                 152181
      *                                                                   152181
     C           *LOCK     IN   LDA                                       169219
     C           ZSERR     IFEQ 'Y'                                       152181
     C                     SETON                     U7U8LR               152181
     C                     RETRN                                          152181
     C                     ENDIF                                          152181
      *                                                                   152181
     C                     ENDSR                                          152181
      *****************************************************************   152181
     C/TITLE SR/ZDATE2
     C/COPY ZSRSRC,ZDATE2Z2
     C/COPY ZSRSRC,ZEDITZ2                                                                    CLE034
     C********************************************************************
      /EJECT
**
      -      -
**
AUTO SETTLEMENT
PARTIAL SETTLEMENT
ADJUSTMENT
WRITE OFF
FULL SETTLEMENT
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
