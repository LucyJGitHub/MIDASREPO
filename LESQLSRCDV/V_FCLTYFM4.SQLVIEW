/*******************************************************************************/
/*                                                                             */
/*       Midas - Global Processing Module                                      */
/*                                                                             */
/*       V_FCLTYFM4 - Facilies View with Aggregated Facilities                 */
/*                                                                             */
/*       (c) Finastra International Limited 2004                               */
/*                                                                             */
/*       Last Amend No. CSD103             Date 10Aug20                        */
/*       Prev Amend No. MD046248           Date 27Oct17                        */
/*                      CLE064             Date 06Dec10                        */
/*                      CER059             Date 19Jul10                        */
/*                      CER020             Date 19May08                        */
/* Bank Fusion Midas 1.4 Base -------------------------------------------------*/
/* Midas Plus 1.4 Base 04 -----------------------------------------------------*/
/* Midas Plus 1.4 Base --------------------------------------------------------*/
/* Midas Plus 1.3 ---------------- Base ---------------------------------------*/
/*                      CSD027             Date 10Dec05                        */
/*                      CLE042             Date 06Sep05                        */
/*                      CAP086             Date 08Jun05                        */
/*                      CLE041  *CREATE    Date 11Oct04                        */
/*                                                                             */
/*-----------------------------------------------------------------------------*/
/*                                                                             */
/*       CSD103 - LIBOR Deregulation - Common Layer/Standing Data. (Recompile) */
/*       MD046248 - Finastra Rebranding                                        */
/*       CLE064 - Enhancement of Lending Frequencies (Recompile)               */
/*       CER059 - German Feature Upgrade to Delhi                              */
/*       CER020 - Enhanced Rollover Window: Upgrade FGE089 to                  */
/*                Midas Plus (Recompile)                                       */
/*       CSD027 - Conversion Of Customer Number to Alpha                       */
/*       CLE042 - Extended Loan Sub Type                                       */
/*       CAP086 - Introduce Auto Authorisation to the API's                    */
/*                without it. (Recompile)                                      */
/*       CLE041 - Collateralised Lending Phase 2B                              */
/*                                                                             */
/*******************************************************************************/
  CREATE VIEW                                                                   :
  **********/**********                                                         :
  AS                                                                            :
 ((SELECT                                                                       :
  M.RECI , M.CNUM , M.FACT , M.FCNO , M.RCTP , M.BRCA , M.FCTI ,                :
  M.FCCY , M.FAMT , M.OVPC , M.DTAP , M.DTEX , M.RVCR , M.SECI ,                :
  M.MCCY , M.MCSI , M.NACD , M.CRSK , M.DLFS , M.NOMR , M.RVDT ,                :
  M.RVFR , M.RVDY , M.NAR1 , M.NAR2 , M.NAR3 , M.NAR4 , M.MTDH ,                :
  M.MTDL , M.MTDA , M.QTDA , M.YTDA , M.ACOF , M.ORBR , M.ZZ001 ,               :
  M.RVCD , M.ZZ002A , M.ORED , M.LCD , M.CHTP , M.TNLU , M.SYIN ,               :
  M.ANUM , M.DTPS , M.DICB , M.RTPS , M.RLPD , M.CSEL , M.ALCY ,                :
  M.COMD , M.CDTE , M.AVLD , M.LPTP , M.LPBR , M.LPAM , M.LPPS ,                :
**M.DFTP*,*M.DFST*,*M.TRCA*,*M.CANM*,*M.CAFT*,*M.CAFN*,*M.ACSQ*,****************:             CLE042
  M.DFTP , M.DFST , M.DFCL , M.TRCA , M.CANM , M.CAFT , M.CAFN , M.ACSQ ,       :             CLE042
  M.FSTS , M.IUSR , M.AUSR , M.XUSR , M.SYCP , M.PCRF , M.PRTR ,                :
  M.PMFC , M.PMFT , M.PMFN , M.INUM , M.JDTE , M.SHTP , M.SHPC ,                :
  M.RCSI , M.SKIR , M.SKIS , M.SKFR , M.SKFS , M.VDTC , M.OSDB ,                :
  M.OMDB , M.RSTM , M.RONSQQ , M.RIBN , M.RIBA , M.ROBN , M.ROCN ,              :
  M.PSTM , M.PONSQQ , M.PIBN , M.PIBA , M.POBN , M.POCN , M.RCRN ,              :
  M.RCRA , M.RVNO , M.AWBN , M.AWBA , M.BENN , M.BENA , M.DTP1 ,                :
  M.DTP2 , M.DTP3 , M.DTP4 , M.DCHG , M.BTB1 , M.BTB2 , M.BTB3 ,                :
  M.BTB4 , M.BTB5 , M.BTB6 , M.CVMR , M.PCOB , M.CAXR , M.CMDI ,                :
  M.CACY , M.PFTI , M.SCCY , M.ICCY , M.LAID , M.PASI , M.REPI ,                :
  M.FRNT , M.AFRT , M.REPA , M.STMP , M.DTPX , M.COAG , M.FCAG ,                :
  M.PHAG , M.SCAG , M.REXR , M.REXI , M.PSCY , M.PEXR , M.PEXI ,                :
  M.OVAM , M.SVCD , M.LMTI , M.RONS , M.PONS ,                                  :
  N.CAMD,                                                                       :
  N.CEXP,                                                                       :
  N.OAM2,                                                                       :
  N.RUN1,                                                                       :
    CASE                                                                        :
     WHEN M.DTEX < N.RUN1 THEN 0                                                :
     WHEN M.DTAP > N.RUN1 THEN 0                                                :
     ELSE FAMT-CEXP                                                             :
    END AS AVL_AMT,                                                             :
****DIGITS(M.CNUM)*AS*PADCNUM,**************************************************:             CSD027
           M.CNUM  AS PADCNUM,                                                  :             CSD027
    DIGITS(M.FACT) AS PADFACT,                                                  :
    DIGITS(M.FCNO) AS PADFCNO                                                   :
   FROM FCLTYFM AS M                                                            :
   LEFT JOIN FCLTYFN AS N                                                       :
    ON N.CNUM=M.CNUM AND N.FACT=M.FACT AND N.FCNO=M.FCNO                        :
   WHERE M.RECI IN ('D','E','C','R'))                                           :
  UNION                                                                         :
  (SELECT                                                                       :
  M.RECI , M.CNUM , M.FACT , M.FCNO , M.RCTP , M.BRCA , M.FCTI ,                :
  M.FCCY , M.FAMT , M.OVPC , M.DTAP , M.DTEX , M.RVCR , M.SECI ,                :
  M.MCCY , M.MCSI , M.NACD , M.CRSK , M.DLFS , M.NOMR , M.RVDT ,                :
  M.RVFR , M.RVDY , M.NAR1 , M.NAR2 , M.NAR3 , M.NAR4 , M.MTDH ,                :
  M.MTDL , M.MTDA , M.QTDA , M.YTDA , M.ACOF , M.ORBR , M.ZZ001 ,               :
  M.RVCD , M.ZZ002A , M.ORED , M.LCD , M.CHTP , M.TNLU , M.SYIN ,               :
  M.ANUM , M.DTPS , M.DICB , M.RTPS , M.RLPD , M.CSEL , M.ALCY ,                :
  M.COMD , M.CDTE , M.AVLD , M.LPTP , M.LPBR , M.LPAM , M.LPPS ,                :
**M.DFTP*,*M.DFST*,*M.TRCA*,*M.CANM*,*M.CAFT*,*M.CAFN*,*M.ACSQ*,****************:             CLE042
  M.DFTP , M.DFST , M.DFCL , M.TRCA , M.CANM , M.CAFT , M.CAFN , M.ACSQ ,       :             CLE042
  M.FSTS , M.IUSR , M.AUSR , M.XUSR , M.SYCP , M.PCRF , M.PRTR ,                :
  M.PMFC , M.PMFT , M.PMFN , M.INUM , M.JDTE , M.SHTP , M.SHPC ,                :
  M.RCSI , M.SKIR , M.SKIS , M.SKFR , M.SKFS , M.VDTC , M.OSDB ,                :
  M.OMDB , M.RSTM , M.RONSQQ , M.RIBN , M.RIBA , M.ROBN , M.ROCN ,              :
  M.PSTM , M.PONSQQ , M.PIBN , M.PIBA , M.POBN , M.POCN , M.RCRN ,              :
  M.RCRA , M.RVNO , M.AWBN , M.AWBA , M.BENN , M.BENA , M.DTP1 ,                :
  M.DTP2 , M.DTP3 , M.DTP4 , M.DCHG , M.BTB1 , M.BTB2 , M.BTB3 ,                :
  M.BTB4 , M.BTB5 , M.BTB6 , M.CVMR , M.PCOB , M.CAXR , M.CMDI ,                :
  M.CACY , M.PFTI , M.SCCY , M.ICCY , M.LAID , M.PASI , M.REPI ,                :
  M.FRNT , M.AFRT , M.REPA , M.STMP , M.DTPX , M.COAG , M.FCAG ,                :
  M.PHAG , M.SCAG , M.REXR , M.REXI , M.PSCY , M.PEXR , M.PEXI ,                :
  M.OVAM , M.SVCD , M.LMTI , M.RONS , M.PONS ,                                  :
    N.CAMD,                                                                     :
    N.CEXP,                                                                     :
    N.OAM2,                                                                     :
    N.RUN1,                                                                     :
    CASE                                                                        :
     WHEN M.DTEX < N.RUN1 THEN 0                                                :
     WHEN M.DTAP > N.RUN1 THEN 0                                                :
     ELSE FAMT-CEXP                                                             :
    END AS AVL_AMT,                                                             :
****DIGITS(M.CNUM)*AS*PADCNUM,**************************************************:             CSD027
           M.CNUM  AS PADCNUM,                                                  :             CSD027
    DIGITS(M.FACT) AS PADFACT,                                                  :
    DIGITS(M.FCNO) AS PADFCNO                                                   :
   FROM LEAGFMPD AS M                                                           :
   LEFT JOIN LEAGFNPD AS N                                                      :
    ON N.CNUM=M.CNUM AND N.FACT=M.FACT AND N.FCNO=M.FCNO                        :
   WHERE M.RECI IN ('D','E','C','R')));                                         :
/*******************************************************************************/
 ;                                                                              :
  label on table     **********/**********                                      :
   is 'Midas LE Facilities view with Agg. Facilities     ';                     :
                                                                                :
