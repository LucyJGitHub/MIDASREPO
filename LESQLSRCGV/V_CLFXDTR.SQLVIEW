/*******************************************************************************/
/*                                                                             */
/*       Midas - Customer Lending Module                                       */
/*                                                                             */
/*       V_CLFXDTR - Facility FX Deal Transaction Details                      */
/*                                                                             */
/*       (c) Finastra International Limited 2004                               */
/*                                                                             */
/*       Last Amend No. CLE168             Date 26Feb18                        */
/*       Prev Amend No. MD046248           Date 27Oct17                        */
/*                      CDL099             Date 06Oct17                        */
/*                      CDL094             Date 30May14                        */
/*                      AR1074315          Date 03Jan13                        */
/*                      CSW212             Date 03May12                        */
/*                      CLE147             Date 30Sep11                        */
/*                      CER049             Date 06Dec10                        */
/*                      CLE064             Date 06Dec10                        */
/*                      CER059             Date 19Jul10                        */
/*                      CER047             Date 19May08                        */
/*                      CER020             Date 19May08                        */
/*                      CER043             Date 19May08                        */
/* Bank Fusion Midas 1.4 Base -------------------------------------------------*/
/* Midas Plus 1.4 Base 04 -----------------------------------------------------*/
/* Midas Plus 1.4 Base --------------------------------------------------------*/
/* Midas Plus 1.3 ---------------- Base ---------------------------------------*/
/*                      CAP185             Date 21Apr06                        */
/*                      CDL049             Date 07Jul06                        */
/*                      CSD031             Date 10Apr06                        */
/*                      CSD027             Date 10Dec05                        */
/*                      CLE042             Date 06Sep05                        */
/*                      CLE106             Date 01Aug04                        */
/*                      CAS011             Date 16May05                        */
/*                      CAP086             Date 08Jun05                        */
/*                      CDL038             Date 10May05                        */
/*                      CSW037A            Date 02May05                        */
/*                      CAS010             Date 09Feb05                        */
/*                      CLE041             Date 11Oct04                        */
/*                      CSD025             Date 11Jan05                        */
/*                      CSW037             Date 15Dec04                        */
/*                      CSW036             Date 15Dec04                        */
/*                      BUG3644 *CREATE    Date 12Jul04                        */
/*                                                                             */
/*-----------------------------------------------------------------------------*/
/*                                                                             */
/*       CLE168 - Allow Debit of Blocked Account (Recompile)                   */
/*       MD046248 - Finastra Rebranding                                        */
/*       CDL099 - Split Value Date (Recompile)                                 */
/*       CDL094 - Enhance  Receive Settlement Instructions (Recompile)         */
/*       AR1074315 - error encountered during database upgrade for GC system   */
/*       CSW212 - SWIFT 2012 Changes (Recompile)                               */
/*       CLE147 - Aggregate Facility (Recompile)                               */
/*       CER049 - Stamp Tax (Recompile)                                        */
/*       CLE064 - Enhancement of Lending Frequencies (Recompile)               */
/*       CER059 - German Feature Upgrade to Delhi                              */
/*       CER047 - German Features LF037-00 Reporting §24c                      */
/*                (Recompile)                                                  */
/*       CER020 - Enhanced Rollover Window: Upgrade FGE089 to                  */
/*                Midas Plus (Recompile)                                       */
/*       CER043 - German Features LF041-00 New Fields and Defaulting           */
/*                (Recompile)                                                  */
/*       CAP185 - MQ Series Interface (Recompile)                              */
/*       CDL049 - Addition of a Reference Rate field (recompile)               */
/*       CSD031 - Enhanced Centralised Static Data (Recompile)                 */
/*       CSD027 - Conversion Of Customer Number to Alpha                       */
/*       CLE042 - Extended Loan Sub Type (Recompile)                           */
/*       CLE106 - Syndications Manager (Recompile)                             */
/*       CAS011 - EIR/AC Accounting Upgrade to MP1 (Recompile)                 */
/*       CAP086 - Introduce Auto Authorisation to the API's                    */
/*                without it. (Recompile)                                      */
/*       CDL038 - Extended Deal Sub Type (Recompile)                           */
/*       CSW037A- Additional Field extended to 40 chars (recompile)            */
/*       CAS010 - IAS + PB Enhancements Upgrade to Midasplus (Recompile)       */
/*       CLE041  - Collateralised Lending Phase 2B (Recompile)                 */
/*       CSD025 - Customer De-Activation                                       */
/*       CSW037 - Additional Field Data on MT300/MT320                         */
/*       CSW036 - Dual SWIFT BIC held on Client Details                        */
/*       BUG3644 - Serious Error in Collateralised Lending                     */
/*                                                                             */
/*******************************************************************************/
  CREATE VIEW                                                                   :
  **********/**********                                                         :
  (TRZONE ,                                                                     :
  TRT_ID ,                                                                      :
  TRMOD ,                                                                       :
  TRSMOD ,                                                                      :
  TRSNAM ,                                                                      :
  TRTREF ,                                                                      :
  TRTYPE ,                                                                      :
  TRSTYP ,                                                                      :
  TRFCUS ,                                                                      :
  PADTRFCUS ,                                                                   :
  TRFTYP ,                                                                      :
  PADTRFTYP ,                                                                   :
  TRFSEQ ,                                                                      :
  PADTRFSEQ ,                                                                   :
  TRBRAC ,                                                                      :
  TRCNUM ,                                                                      :
  PADTRCNUM ,                                                                   :
  TRCCY ,                                                                       :
  PADTRACOD ,                                                                   :
  TRACOD ,                                                                      :
  PADTRASEQ ,                                                                   :
  TRASEQ ,                                                                      :
  TRLNDL ,                                                                      :
  TRTDAT ,                                                                      :
  TRSDAT ,                                                                      :
  TREDAT ,                                                                      :
  TRTCCY ,                                                                      :
  TRMIND ,                                                                      :
  TRMTYP ,                                                                      :
  TRMARG ,                                                                      :
  TRINOF )                                                                      :
  AS                                                                            :
  SELECT                                                                        :
  GPTRAPPD.T_ZONE                                                               :
  ,GPTRAPPD.T_ID                                                                :
  ,GPTRAPPD.T_MOD                                                               :
  ,GPTRAPPD.T_SMOD                                                              :
  ,GPTRAPPD.T_SNAM                                                              :
  ,GPTRAPPD.T_TREF                                                              :
  ,GPTRAPPD.T_TRTP                                                              :
  ,GPTRAPPD.T_TRST                                                              :
  ,FCLTYFM.CNUM                                                                 :
**,DIGITS(FCLTYFM.CNUM)*********************************************************:             CSD027
  ,       FCLTYFM.CNUM                                                          :             CSD027
  ,FCLTYFM.FACT                                                                 :
  ,DIGITS(FCLTYFM.FACT)                                                         :
  ,FCLTYFM.FCNO                                                                 :
  ,DIGITS(FCLTYFM.FCNO)                                                         :
  ,''                                                                           :
  ,0                                                                            :
  ,''                                                                           :
  ,''                                                                           :
  ,''                                                                           :
  ,0                                                                            :
  ,''                                                                           :
  ,0                                                                            :
  ,FXDEALPP.FHDN38                                                              :
  ,GPTRAPPD.T_TDAT                                                              :
  ,GPTRAPPD.T_SDAT                                                              :
  ,GPTRAPPD.T_EDAT                                                              :
  ,GPTRAPPD.T_RCCY                                                              :
  ,SDPLINPD.PDMARG                                                              :
  ,LEFCLTQD.FCXMST                                                              :
  ,CLMASTPD.MSPERC                                                              :
  ,CASE WHEN SDPLINPD.PDINOF = 'C' THEN SDCUSTPD.BBINOF                         :
  ELSE SDPLINPD.PDINOF END AS INOF                                              :
  FROM                                                                          :
**GPTRAPPD*AS*GPTRAPPD**********************************************************:          AR1074315
**,GZSDBRCHPD*AS*SDBRCHPD*******************************************************:          AR1074315
**,GZFXDEALPP*AS*FXDEALPP*******************************************************:          AR1074315
**,GZDLDLDBQD*AS*DLDLDBQD*******************************************************:          AR1074315
**,GZLEFCLTQD*AS*LEFCLTQD*******************************************************:          AR1074315
**,GZFCLTYFM*AS*FCLTYFM*********************************************************:          AR1074315
**,GZFDDTSTPD*AS*FDDTSTPD*******************************************************:          AR1074315
**,GZSDPLINPD*AS*SDPLINPD*******************************************************:          AR1074315
**,GZSDCUSTPD*AS*SDCUSTPD*******************************************************:          AR1074315
  GPTRAPPD AS GPTRAPPD CROSS JOIN                                               :          AR1074315
  GZSDBRCHPD AS SDBRCHPD CROSS JOIN                                             :          AR1074315
  GZFXDEALPP AS FXDEALPP CROSS JOIN                                             :          AR1074315
  GZDLDLDBQD AS DLDLDBQD CROSS JOIN                                             :          AR1074315
  GZLEFCLTQD AS LEFCLTQD CROSS JOIN                                             :          AR1074315
  GZFCLTYFM AS FCLTYFM CROSS JOIN                                               :          AR1074315
  GZFDDTSTPD AS FDDTSTPD CROSS JOIN                                             :          AR1074315
  GZSDPLINPD AS SDPLINPD CROSS JOIN                                             :          AR1074315
  GZSDCUSTPD AS SDCUSTPD                                                        :          AR1074315
  LEFT OUTER JOIN V_CLMASTPD AS CLMASTPD                                        :
  ON   LEFCLTQD.FCXMST = CLMASTPD.MSTYPE                                        :
  AND GPTRAPPD.T_ZONE = CLMASTPD.MSZONE                                         :
  WHERE                                                                         :
  GPTRAPPD.T_MOD = 'DL' AND GPTRAPPD.T_SMOD = 'FXDL'                            :
  AND GPTRAPPD.T_TR6N = FXDEALPP.FHDN38                                         :
  AND GPTRAPPD.T_TRTP = FXDEALPP.FHTYPE                                         :
  AND GPTRAPPD.T_TRST = FXDEALPP.FHSTYP                                         :
  AND GPTRAPPD.T_BRCA =FXDEALPP.FHMBCA                                          :
  AND GPTRAPPD.T_TR6A = DLDLDBQD.F1DLNO                                         :
  AND GPTRAPPD.T_ZONE = SDBRCHPD.A8ZONE                                         :
  AND SDBRCHPD.A8BRCD = FCLTYFM.BRCA                                            :
  AND FCLTYFM.BRCA = DLDLDBQD.F1BRCA                                            :
  AND FCLTYFM.CNUM = DLDLDBQD.F1FCCU                                            :
  AND FCLTYFM.FACT = DLDLDBQD.F1FACT                                            :
  AND FCLTYFM.FCNO = DLDLDBQD.F1FCNO                                            :
  AND FCLTYFM.BRCA = LEFCLTQD.FCXBRC                                            :
**AND*DIGITS(FCLTYFM.CNUM)*=*LEFCLTQD.FCXFCU************************************:             CSD027
  AND        FCLTYFM.CNUM  = LEFCLTQD.FCXFCU                                    :             CSD027
  AND DIGITS(FCLTYFM.FACT) = LEFCLTQD.FCXFTP                                    :
  AND DIGITS(FCLTYFM.FCNO) = LEFCLTQD.FCXFNO                                    :
  AND FXDEALPP.FHTYPE = FDDTSTPD.DTPE11                                         :
  AND FXDEALPP.FHSTYP = FDDTSTPD.DLST11                                         :
  AND GPTRAPPD.T_ZONE = FDDTSTPD.FDZONE                                         :
  AND FDDTSTPD.INNR = SDPLINPD.PDINNR                                           :
  AND FDDTSTPD.FDZONE = SDPLINPD.PDZONE                                         :
  AND ((SDPLINPD.PDMARG = 'N' OR SDPLINPD.PDMARG = 'Y'                          :
  OR SDPLINPD.PDMARG = '')                                                      :
  AND (LEFCLTQD.FCXMST = CLMASTPD.MSTYPE                                        :
  AND (GPTRAPPD.T_RCCY = CLMASTPD.MSCURR OR TRIM(CLMASTPD.MSCURR)='')           :
  AND CLMASTPD.MSPRIOR = (SELECT MIN(MSPRIOR)                                   :
  FROM V_CLMASTPD                                                               :
  WHERE (FCXMST = MSTYPE AND MSCURR = T_RCCY)                                   :
  OR (FCXMST = MSTYPE AND MSCURR =''))                                          :
  OR (LEFCLTQD.FCXMST='' )))                                                    :
  AND SDCUSTPD.BBCUST = GPTRAPPD.T_CNMA                                         :
  AND SDCUSTPD.BBBRCD = GPTRAPPD.T_BRCA ;                                       :
                                                                                :
  LABEL ON COLUMN                                                               :
  **********/**********                                                         :
  (TRZONE IS 'Zone' ,                                                           :
  TRT_ID IS 'Identifier' ,                                                      :
  TRMOD IS 'Module' ,                                                           :
  TRSMOD IS 'Sub-Module' ,                                                      :
  TRSNAM IS 'Shortname' ,                                                       :
  TRTREF IS 'Transaction Reference' ,                                           :
  TRTYPE IS 'Transaction Type' ,                                                :
  TRSTYP IS 'Transaction Sub Type' ,                                            :
  TRFCUS IS 'Customer Number' ,                                                 :
  TRFTYP IS 'Facil Type' ,                                                      :
  TRFSEQ IS 'Fac No' ,                                                          :
  TRLNDL IS 'Deal no 38' ,                                                      :
  TRTDAT IS 'Transaction Date' ,                                                :
  TRSDAT IS 'Start Date' ,                                                      :
  TREDAT IS 'End Date' ,                                                        :
  TRTCCY IS 'Risk Currency' ,                                                   :
  TRMIND IS 'Marginable Flag' ,                                                 :
  TRMTYP IS 'FX Margin Type' ,                                                  :
  TRMARG IS 'Percentage' ) ;                                                    :
                                                                                :
**LABEL ON COLUMN                                                               :
************/**********                                                         :
**(TRZONE TEXT IS 'Zone' ,                                                      :
**TRT_ID TEXT IS 'Identifier' ,                                                 :
**TRMOD TEXT IS 'Module' ,                                                      :
**TRSMOD TEXT IS 'Sub-Module' ,                                                 :
**TRSNAM TEXT IS 'Shortname' ,                                                  :
**TRTREF TEXT IS 'Transaction Reference' ,                                      :
**TRTYPE TEXT IS 'Transaction Type' ,                                           :
**TRSTYP TEXT IS 'Transaction Sub Type' ,                                       :
**TRFCUS TEXT IS 'Customer number' ,                                            :
**TRFTYP TEXT IS 'Facility type' ,                                              :
**TRFSEQ TEXT IS 'Facility number' ,                                            :
**TRLNDL TEXT IS 'Deal number 38' ,                                             :
**TRTDAT TEXT IS 'Transaction Date' ,                                           :
**TRSDAT TEXT IS 'Start Date' ,                                                 :
**TREDAT TEXT IS 'End Date' ,                                                   :
**TRTCCY TEXT IS 'Risk Currency' ,                                              :
**TRMIND TEXT IS 'Marginable Flag' ,                                            :
**TRMTYP TEXT IS 'FX Margin Type' ,                                             :
**TRMARG TEXT IS 'Percentage' ) ;                                               :
/*******************************************************************************/
 ;                                                                              :
  label on table     **********/**********                                      :
   is 'Midas LE Facility FX Deal Transaction Details     ';                     :
                                                                                :
