/*******************************************************************************/
/*                                                                             */
/*       Midas - Customer Lending Module                                       */
/*                                                                             */
/*       P_CLTRAN - Transaction Against Facility Details                       */
/*                                                                             */
/*       (c) Finastra International Limited 2004                               */
/*                                                                             */
/*       Last Amend No. CIR020             Date 02Aug21                        */
/*       Prev Amend No. CDL102             Date 01Jun21                        */
/*                      CLE172             Date 01Oct20                        */
/*                      CSD103             Date 10Aug20                        */
/*                      MD055657           Date 14May20                        */
/*                      CER050             Date 16Jun19                        */
/*                      CLE168             Date 26Feb18                        */
/*                      MD046248           Date 27Oct17                        */
/*                      CDL099             Date 06Oct17                        */
/*                      CLE141             Date 08Feb16                        */
/*                      CLE148             Date 23Jul12                        */
/*                      CSW212             Date 03May12                        */
/*                      CLE147             Date 30Sep11                        */
/*                      CRE073             Date 06Dec10                        */
/*                      CLE143             Date 06Dec10                        */
/*                      CRE075             Date 06Dec10                        */
/*                      CLE064             Date 06Dec10                        */
/*                      CER059             Date 19Jul10                        */
/*                      CER043             Date 19May08                        */
/* Bank Fusion Midas 1.4 Base -------------------------------------------------*/
/* Midas Plus 1.4 Base 04 -----------------------------------------------------*/
/*                      BG18886            Date 29May08                        */
/* Midas Plus 1.4 Base --------------------------------------------------------*/
/* Midas Plus 1.3 ---------------- Base ---------------------------------------*/
/*                      CSD027A            Date 08May06                        */
/*                      CLE024  *CREATE    Date 20Oct03                        */
/*                                                                             */
/*-----------------------------------------------------------------------------*/
/*                                                                             */
/*       CIR020 - LIBOR Deregulation - FRA/IRS (Recompile)                     */
/*       CDL102 - LIBOR Deregulation - Dealing (Recompile)                     */
/*       CLE172 - LIBOR Deregulation - Lending (Recompile)                     */
/*       CSD103 - LIBOR Deregulation - Common Layer/Standing Data              */
/*                (Recompile)                                                  */
/*       MD055657 - Manual transaction from FFC TI Interface went to           */
/*                  repair queue because the facility exchange rate is         */
/*                  longer than the defined facility exchange rate in          */
/*                  Midas. Increase the field definition of the Midas          */
/*                  facility exchange rate. (Recompile)                        */
/*       CER050 - Annualised Percentage Rate (Recompile)                       */
/*       CLE168 - Allow Debit of Blocked Account (Recompile)                   */
/*       MD046248 - Finastra Rebranding                                        */
/*       CDL099 - Split Value Date (Recompile)                                 */
/*       CLE141 - Currency and Location Business Day Convention                */
/*                (Recompile)                                                  */
/*       CLE148 - Alpha Loan Reference (Recompile)                             */
/*       CSW212 - SWIFT 2012 Changes (Recompile)                               */
/*       CLE147 - Aggregate Facility (Recompile)                               */
/*       CRE073 - Interest Rate Rounding (Recompile)                           */
/*       CLE143 - Original Loan Contract Date & Effective Interest             */
/*                Rate (Recompile)                                             */
/*       CRE075 - Effective Date for Retail Accounts (Recompile)               */
/*       CLE064 - Enhancement of Lending Frequencies (Recompile)               */
/*       CER059 - German Feature Upgrade to Delhi                              */
/*       CER043 - German Features LF041-00 New Fields and Defaulting           */
/*                (Recompile)                                                  */
/*       BG18886 - Amend non-standard codes.                                   */
/*       CSD027A - Conversion Of Customer Number to Alpha                      */
/*       CLE024 - Collateralised Lending                                       */
/*                                                                             */
/*******************************************************************************/
  CREATE PROCEDURE                                                              :
  **********/**********                                                         :
  (                                                                             :
**IN*FCUS*NUMERIC(6, 0) ,*******************************************************:            CSD027A
  IN FCUS CHAR(6) ,                                                             :            CSD027A
  IN FTYP NUMERIC(3, 0) ,                                                       :
  IN FSEQ NUMERIC(2, 0) ,                                                       :
  IN STRORDERBY VARCHAR(100) )                                                  :
  DYNAMIC RESULT SETS 1                                                         :
  LANGUAGE SQL                                                                  :
  SPECIFIC                                                                      :
  **********/**********                                                         :
  NOT DETERMINISTIC                                                             :
  MODIFIES SQL DATA                                                             :
  CALLED ON NULL INPUT                                                          :
  BEGIN                                                                         :
  DECLARE SQLSTMT VARCHAR ( 1000 ) ;                                            :
  DECLARE DCURSOR DYNAMIC SCROLL CURSOR WITH RETURN FOR PSTMT ;                 :
  SET SQLSTMT = '(SELECT * FROM V_CLACCTR WHERE TRFCUS=? AND TRFTYP=? AND       :
  TRFSEQ=?) '                                                                   :
*****'UNION '                                                                   :            BG18886
*****'(SELECT * FROM V_CLCLNTR WHERE TRFCUS=? AND TRFTYP=? AND TRFSEQ=?) '      :            BG18886
*****'UNION '                                                                   :            BG18886
*****'(SELECT * FROM V_CLMMLTR WHERE TRFCUS=? AND TRFTYP=? AND TRFSEQ=?) '      :            BG18886
*****'UNION '                                                                   :            BG18886
*****'(SELECT * FROM V_CLFXDTR WHERE TRFCUS=? AND TRFTYP=? AND TRFSEQ=?) '      :            BG18886
*****'UNION '                                                                   :            BG18886
*****'(SELECT * FROM V_CLFRATR WHERE TRFCUS=? AND TRFTYP=? AND TRFSEQ=?) '      :            BG18886
*****'UNION '                                                                   :            BG18886
*****'(SELECT * FROM V_CLIRSTR WHERE TRFCUS=? AND TRFTYP=? AND TRFSEQ=?) '      :            BG18886
*****'UNION '                                                                   :            BG18886
*****'(SELECT * FROM V_CLMANTR WHERE TRFCUS=? AND TRFTYP=? AND TRFSEQ=?) '      :            BG18886
*****STRORDERBY ;                                                               :            BG18886
  CONCAT 'UNION '                                                               :            BG18886
  CONCAT '(SELECT * FROM V_CLCLNTR WHERE TRFCUS=? AND TRFTYP=? AND TRFSEQ=?) '  :            BG18886
  CONCAT 'UNION '                                                               :            BG18886
  CONCAT '(SELECT * FROM V_CLMMLTR WHERE TRFCUS=? AND TRFTYP=? AND TRFSEQ=?) '  :            BG18886
  CONCAT 'UNION '                                                               :            BG18886
  CONCAT '(SELECT * FROM V_CLFXDTR WHERE TRFCUS=? AND TRFTYP=? AND TRFSEQ=?) '  :            BG18886
  CONCAT 'UNION '                                                               :            BG18886
  CONCAT '(SELECT * FROM V_CLFRATR WHERE TRFCUS=? AND TRFTYP=? AND TRFSEQ=?) '  :            BG18886
  CONCAT 'UNION '                                                               :            BG18886
  CONCAT '(SELECT * FROM V_CLIRSTR WHERE TRFCUS=? AND TRFTYP=? AND TRFSEQ=?) '  :            BG18886
  CONCAT 'UNION '                                                               :            BG18886
  CONCAT '(SELECT * FROM V_CLMANTR WHERE TRFCUS=? AND TRFTYP=? AND TRFSEQ=?) '  :            BG18886
  CONCAT STRORDERBY ;                                                           :            BG18886
  PREPARE PSTMT FROM SQLSTMT ;                                                  :
  OPEN DCURSOR USING FCUS , FTYP , FSEQ , FCUS , FTYP , FSEQ , FCUS , FTYP ,    :
  FSEQ , FCUS , FTYP , FSEQ , FCUS , FTYP , FSEQ , FCUS , FTYP , FSEQ , FCUS ,  :
  FTYP , FSEQ ;                                                                 :
  END  ;                                                                        :
/*******************************************************************************/
 ;                                                                              :
  label on procedure **********/**********                                      :
   is 'Midas LE Facility Transaction Enquiry             ';                     :
                                                                                :
