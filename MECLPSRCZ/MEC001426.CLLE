/*********************************************************************/
/*STD    CLPBASEBND                                                  */
/*EXI    TEXT('Midas ME SWIFTRef - Check CFT050 Database Files')     */
/*********************************************************************/
/*                                                                   */
/*       Midas - Message Management                                  */
/*                                                                   */
/*       MEC001426 - Check CFT050 Database Files                     */
/*                                                                   */
/*       (c) Misys International Banking Systems Ltd. 2013           */
/*                                                                   */
/*       Last Amend No. CSW218             Date 19Jun18              */
/*       Prev Amend No. CFT051             Date 02Jun15              */
/*                      CFT050  *CREATE    Date 03Jun13              */
/*                                                                   */
/*********************************************************************/
/*                                                                   */
/*       CSW218 - SWIFT Changes 2018                                 */
/*       CFT051 - SWIFTRef Directories 2014                          */
/*       CFT050 - SWIFTRef Directories upload                        */
/*                                                                   */
/*********************************************************************/
             PGM        PARM(&STEP &MSG1 &MSG2 &MSG3 &MSG4 &ANSW1 +
                          &ANSW2 &ANSW3)
 
             DCL        VAR(&STEP) TYPE(*CHAR) LEN(1)
             DCL        VAR(&MSG1) TYPE(*CHAR) LEN(60)
             DCL        VAR(&MSG2) TYPE(*CHAR) LEN(60)
             DCL        VAR(&MSG3) TYPE(*CHAR) LEN(60)
             DCL        VAR(&MSG4) TYPE(*CHAR) LEN(60)
             DCL        VAR(&ANSW1) TYPE(*CHAR) LEN(1)
             DCL        VAR(&ANSW2) TYPE(*CHAR) LEN(1)
             DCL        VAR(&ANSW3) TYPE(*CHAR) LEN(1)
             DCL        VAR(&FLCTR) TYPE(*DEC) LEN(2 0)
             DCL        VAR(&FLNBR) TYPE(*DEC) LEN(2 0)
             DCL        VAR(&DOCHK) TYPE(*CHAR) LEN(1)
             DCL        VAR(&CHKFILE) TYPE(*CHAR) LEN(10)
             DCL        VAR(&CHKSTEP) TYPE(*CHAR) LEN(1)
             DCL        VAR(&CTR) TYPE(*DEC) LEN(2 0)
             DCL        VAR(&POS) TYPE(*DEC) LEN(2 0)
             DCL        VAR(&PRTCD) TYPE(*CHAR) LEN(7) VALUE(' ')                         /*CFT051*/
             DCL        VAR(&CFT051) TYPE(*CHAR) LEN(1) VALUE(' ')                        /*CFT051*/
             DCL        VAR(&CSW218) TYPE(*CHAR) LEN(1) VALUE(' ')                        /*CSW218*/
 
/* Copyright statement                                               */
             COPYRIGHT TEXT('(c) Misys International Banking Systems Ltd. +
                          2013')
 
/* Global Monitor Message                                            */
             MONMSG     MSGID(CPF0000 RPG0000 MCH0000) +
                           EXEC(GOTO ENDCLPGM)
 
/**********  CHGVAR     VAR(&FLCTR) VALUE(36)                        */                   /*CFT051*/
/**********  CHGVAR     VAR(&FLCTR) VALUE(45)                        */            /*CFT051 CSW218*/
             CHGVAR     VAR(&FLCTR) VALUE(48)                                             /*CSW218*/
             CHGVAR     VAR(&POS) VALUE(1)
             CHGVAR     VAR(&MSG1) VALUE(' ')
             CHGVAR     VAR(&MSG2) VALUE(' ')
             CHGVAR     VAR(&MSG3) VALUE(' ')
             CHGVAR     VAR(&MSG4) VALUE(' ')
 
             CALL       PGM(AOSARDR0) PARM(&PRTCD '*VERIFY' 'CFT051')                     /*CFT051*/
             IF         COND(&PRTCD *EQ ' ') THEN(CHGVAR +
                          VAR(&CFT051) VALUE('Y'))                                        /*CFT051*/
                                                                                          /*CSW218*/
/* Check if SWIFT 2018 is installed */                                                    /*CSW218*/
                                                                                          /*CSW218*/
             CHGVAR     VAR(&PRTCD) VALUE('       ')                                      /*CSW218*/
             CHGVAR     VAR(&CSW218) VALUE('N')                                           /*CSW218*/
             CALL       PGM(SWIF2018) PARM(&PRTCD)                                        /*CSW218*/
             IF         COND(&PRTCD *EQ 'CSW2018') THEN(DO)                               /*CSW218*/
                CHGVAR  VAR(&CSW218) VALUE('Y')                                           /*CSW218*/
             ENDDO                                                                        /*CSW218*/
 
 LOOP:
 
             CHGVAR     VAR(&DOCHK) VALUE('Y')
             CHGVAR     VAR(&CHKSTEP) VALUE('0')
             CHGVAR     VAR(&FLNBR) VALUE(&FLNBR + 1)
 
             SELECT
 
             WHEN       COND(&FLNBR = 1) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('MEDWB3PD')
                CHGVAR     VAR(&CHKSTEP) VALUE('1')
             ENDDO
 
             WHEN       COND(&FLNBR = 2) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('MEDWCTPD')
                CHGVAR     VAR(&CHKSTEP) VALUE('1')
             ENDDO
 
             WHEN       COND(&FLNBR = 3) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('MEDWCUPD')
                CHGVAR     VAR(&CHKSTEP) VALUE('1')
             ENDDO
 
             WHEN       COND(&FLNBR = 4) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('MEDWHLPD')
                CHGVAR     VAR(&CHKSTEP) VALUE('1')
             ENDDO
 
             WHEN       COND(&FLNBR = 5) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('MEDWTZPD')
                CHGVAR     VAR(&CHKSTEP) VALUE('1')
             ENDDO
 
             WHEN       COND(&FLNBR = 6) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('METICVPD')
                CHGVAR     VAR(&CHKSTEP) VALUE('1')
             ENDDO
 
             WHEN       COND(&FLNBR = 7) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('METIB3PD')
                CHGVAR     VAR(&CHKSTEP) VALUE('1')
             ENDDO
 
             WHEN       COND(&FLNBR = 8) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('METICCPD')
                CHGVAR     VAR(&CHKSTEP) VALUE('1')
             ENDDO
 
             WHEN       COND(&FLNBR = 9) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('METICUPD')
                CHGVAR     VAR(&CHKSTEP) VALUE('1')
             ENDDO
 
             WHEN       COND(&FLNBR = 10) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('METIHLPD')
                CHGVAR     VAR(&CHKSTEP) VALUE('1')
             ENDDO
 
             WHEN       COND(&FLNBR = 11) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('METITZPD')
                CHGVAR     VAR(&CHKSTEP) VALUE('1')
             ENDDO
 
             WHEN       COND(&FLNBR = 12) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('METXTFPD')
                CHGVAR     VAR(&CHKSTEP) VALUE('1')
             ENDDO
 
             WHEN       COND(&FLNBR = 13) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('MEBIB3PD')
                CHGVAR     VAR(&CHKSTEP) VALUE('1')
             ENDDO
 
             WHEN       COND(&FLNBR = 14) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('MEBICCPD')
                CHGVAR     VAR(&CHKSTEP) VALUE('1')
             ENDDO
 
             WHEN       COND(&FLNBR = 15) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('MEBICUPD')
                CHGVAR     VAR(&CHKSTEP) VALUE('1')
             ENDDO
 
             WHEN       COND(&FLNBR = 16) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('MEBIHLPD')
                CHGVAR     VAR(&CHKSTEP) VALUE('1')
             ENDDO
 
             WHEN       COND(&FLNBR = 17) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('MEBITZPD')
                CHGVAR     VAR(&CHKSTEP) VALUE('1')
             ENDDO
 
             WHEN       COND(&FLNBR = 18) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('MEBICIPD')
                CHGVAR     VAR(&CHKSTEP) VALUE('1')
             ENDDO
 
             WHEN       COND(&FLNBR = 19) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('MEISOCPD')
                CHGVAR     VAR(&CHKSTEP) VALUE('1')
             ENDDO
 
             WHEN       COND(&FLNBR = 20) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('MEBICDPD')
                CHGVAR     VAR(&CHKSTEP) VALUE('2')
                IF         COND(&ANSW1 *NE 'Y') THEN(DO)
                   CHGVAR     VAR(&DOCHK) VALUE('N')
                ENDDO
             ENDDO
 
             WHEN       COND(&FLNBR = 21) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('MEBICPPD')
                CHGVAR     VAR(&CHKSTEP) VALUE('2')
                IF         COND(&ANSW2 *NE 'Y') THEN(DO)
                   CHGVAR     VAR(&DOCHK) VALUE('N')
                ENDDO
             ENDDO
 
             WHEN       COND(&FLNBR = 22) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('MEBICBPD')
                CHGVAR     VAR(&CHKSTEP) VALUE('2')
                IF         COND(&ANSW3 *NE 'Y') THEN(DO)
                   CHGVAR     VAR(&DOCHK) VALUE('N')
                ENDDO
             ENDDO
 
             WHEN       COND(&FLNBR = 23) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('MEDWIBPD')
                CHGVAR     VAR(&CHKSTEP) VALUE('3')
             ENDDO
 
             WHEN       COND(&FLNBR = 24) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('MEDWISPD')
                CHGVAR     VAR(&CHKSTEP) VALUE('3')
             ENDDO
 
             WHEN       COND(&FLNBR = 25) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('METIIBPD')
                CHGVAR     VAR(&CHKSTEP) VALUE('3')
             ENDDO
 
             WHEN       COND(&FLNBR = 26) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('METIISPD')
                CHGVAR     VAR(&CHKSTEP) VALUE('3')
             ENDDO
 
             WHEN       COND(&FLNBR = 27) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('MEIBN3PD')
                CHGVAR     VAR(&CHKSTEP) VALUE('3')
             ENDDO
 
             WHEN       COND(&FLNBR = 28) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('MEIBNSPD')
                CHGVAR     VAR(&CHKSTEP) VALUE('3')
             ENDDO
 
             WHEN       COND(&FLNBR = 29) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('MEISOCPD')
                CHGVAR     VAR(&CHKSTEP) VALUE('3')
             ENDDO
 
             WHEN       COND(&FLNBR = 30) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('MEBICSPD')
                CHGVAR     VAR(&CHKSTEP) VALUE('4')
                IF         COND(&ANSW1 *NE 'Y') THEN(DO)
                   CHGVAR     VAR(&DOCHK) VALUE('N')
                ENDDO
             ENDDO
 
             WHEN       COND(&FLNBR = 31) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('MEDWSIPD')
                CHGVAR     VAR(&CHKSTEP) VALUE('5')
             ENDDO
 
             WHEN       COND(&FLNBR = 32) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('METSSIPD')
                CHGVAR     VAR(&CHKSTEP) VALUE('5')
             ENDDO
 
             WHEN       COND(&FLNBR = 33) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('MESSIPPD')
                CHGVAR     VAR(&CHKSTEP) VALUE('5')
             ENDDO
 
             WHEN       COND(&FLNBR = 34) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('MEDWSPPD')
                CHGVAR     VAR(&CHKSTEP) VALUE('6')
             ENDDO
 
             WHEN       COND(&FLNBR = 35) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('METSEPPD')
                CHGVAR     VAR(&CHKSTEP) VALUE('6')
             ENDDO
 
             WHEN       COND(&FLNBR = 36) THEN(DO)
                CHGVAR     VAR(&CHKFILE) VALUE('MESEPAPD')
                CHGVAR     VAR(&CHKSTEP) VALUE('6')
             ENDDO
 
             WHEN       COND(&FLNBR = 37 *AND &CFT051 = 'Y') +
                          THEN(DO)                                                        /*CFT051*/
                CHGVAR     VAR(&CHKFILE) VALUE('MEBISDPD')                                /*CFT051*/
                CHGVAR     VAR(&CHKSTEP) VALUE('1')                                       /*CFT051*/
             ENDDO                                                                        /*CFT051*/
                                                                                          /*CFT051*/
             WHEN       COND(&FLNBR = 38 *AND &CFT051 = 'Y') +
                          THEN(DO)                                                        /*CFT051*/
                CHGVAR     VAR(&CHKFILE) VALUE('METISDPD')                                /*CFT051*/
                CHGVAR     VAR(&CHKSTEP) VALUE('1')                                       /*CFT051*/
             ENDDO                                                                        /*CFT051*/
                                                                                          /*CFT051*/
             WHEN       COND(&FLNBR = 39 *AND &CFT051 = 'Y') +
                          THEN(DO)                                                        /*CFT051*/
                CHGVAR     VAR(&CHKFILE) VALUE('MEDWSDPD')                                /*CFT051*/
                CHGVAR     VAR(&CHKSTEP) VALUE('1')                                       /*CFT051*/
             ENDDO                                                                        /*CFT051*/
                                                                                          /*CFT051*/
                                                                                          /*CFT051*/
             WHEN       COND(&FLNBR = 40 *AND &CFT051 = 'Y') +
                          THEN(DO)                                                        /*CFT051*/
                CHGVAR     VAR(&CHKFILE) VALUE('MEBILLPD')                                /*CFT051*/
                CHGVAR     VAR(&CHKSTEP) VALUE('1')                                       /*CFT051*/
             ENDDO                                                                        /*CFT051*/
                                                                                          /*CFT051*/
             WHEN       COND(&FLNBR = 41 *AND &CFT051 = 'Y') +
                          THEN(DO)                                                        /*CFT051*/
                CHGVAR     VAR(&CHKFILE) VALUE('METILLPD')                                /*CFT051*/
                CHGVAR     VAR(&CHKSTEP) VALUE('1')                                       /*CFT051*/
             ENDDO                                                                        /*CFT051*/
                                                                                          /*CFT051*/
             WHEN       COND(&FLNBR = 42 *AND &CFT051 = 'Y') +
                          THEN(DO)                                                        /*CFT051*/
                CHGVAR     VAR(&CHKFILE) VALUE('MEDWLLPD')                                /*CFT051*/
                CHGVAR     VAR(&CHKSTEP) VALUE('1')                                       /*CFT051*/
             ENDDO                                                                        /*CFT051*/
                                                                                          /*CFT051*/
             WHEN       COND(&FLNBR = 43 *AND &CFT051 = 'Y') +
                          THEN(DO)                                                        /*CFT051*/
                CHGVAR     VAR(&CHKFILE) VALUE('MEIBELPD')                                /*CFT051*/
                CHGVAR     VAR(&CHKSTEP) VALUE('3')                                       /*CFT051*/
             ENDDO                                                                        /*CFT051*/
                                                                                          /*CFT051*/
             WHEN       COND(&FLNBR = 44 *AND &CFT051 = 'Y') +
                          THEN(DO)                                                        /*CFT051*/
                CHGVAR     VAR(&CHKFILE) VALUE('METIELPD')                                /*CFT051*/
                CHGVAR     VAR(&CHKSTEP) VALUE('3')                                       /*CFT051*/
             ENDDO                                                                        /*CFT051*/
                                                                                          /*CFT051*/
             WHEN       COND(&FLNBR = 45 *AND &CFT051 = 'Y') +
                          THEN(DO)                                                        /*CFT051*/
                CHGVAR     VAR(&CHKFILE) VALUE('MEDWELPD')                                /*CFT051*/
                CHGVAR     VAR(&CHKSTEP) VALUE('3')                                       /*CFT051*/
             ENDDO                                                                        /*CFT051*/
                                                                                          /*CFT051*/
             WHEN       COND(&FLNBR = 46 *AND &CSW218 = 'Y') +
                          THEN(DO)                                                        /*CSW218*/
                CHGVAR     VAR(&CHKFILE) VALUE('MEDWFIPD')                                /*CSW218*/
                CHGVAR     VAR(&CHKSTEP) VALUE('7')                                       /*CSW218*/
             ENDDO                                                                        /*CSW218*/
                                                                                          /*CSW218*/
             WHEN       COND(&FLNBR = 47 *AND &CSW218 = 'Y') +
                          THEN(DO)                                                        /*CSW218*/
                CHGVAR     VAR(&CHKFILE) VALUE('METIFIPD')                                /*CSW218*/
                CHGVAR     VAR(&CHKSTEP) VALUE('7')                                       /*CSW218*/
             ENDDO                                                                        /*CSW218*/
                                                                                          /*CSW218*/
             WHEN       COND(&FLNBR = 48 *AND &CSW218 = 'Y') +
                          THEN(DO)                                                        /*CSW218*/
                CHGVAR     VAR(&CHKFILE) VALUE('MEBICDPD')                                /*CSW218*/
                CHGVAR     VAR(&CHKSTEP) VALUE('7')                                       /*CSW218*/
             ENDDO                                                                        /*CSW218*/
                                                                                          /*CSW218*/
             ENDSELECT
 
             IF         COND(&STEP *NE &CHKSTEP) THEN(DO)
                GOTO LOOP
             ENDDO
 
             IF         COND(&DOCHK *NE 'Y') THEN(DO)
                GOTO LOOP
             ENDDO
 
             CHKOBJ     OBJ(&CHKFILE) OBJTYPE(*FILE)
             MONMSG     MSGID(CPF9801) EXEC(DO)
                CHGVAR     VAR(&MSG1) VALUE('Missing Files for this +
                             Option :')
                CHGVAR     VAR(&CTR) VALUE(&CTR + 1)
 
                SELECT
 
                WHEN       COND(&CTR < 7) THEN(DO)
                   CHGVAR     VAR(%SST(&MSG2 &POS 10)) VALUE(&CHKFILE)
                ENDDO
 
                WHEN       COND(&CTR < 13) THEN(DO)
                   CHGVAR     VAR(%SST(&MSG3 &POS 10)) VALUE(&CHKFILE)
                ENDDO
 
                WHEN       COND(&CTR < 19) THEN(DO)
                   CHGVAR     VAR(%SST(&MSG4 &POS 10)) VALUE(&CHKFILE)
                ENDDO
 
                ENDSELECT
 
                CHGVAR     VAR(&POS) VALUE(&POS + 10)
             ENDDO
 
             IF         COND(&POS > 60) THEN(DO)
             CHGVAR     VAR(&POS) VALUE(1)
             ENDDO
 
             IF         COND(&FLNBR > &FLCTR) THEN(DO)
                GOTO ENDCLPGM
             ENDDO
 
             GOTO LOOP
 
/* Database error processing */
 
             IF         COND(%SWITCH(XXXXXX11)) THEN(GOTO +
                          CMDLBL(ABNOR))
 
             GOTO       CMDLBL(ENDCLPGM)
 
/* Abnormal termination */
 
 ABNOR:
             CHGJOB     SWS(XXXXXX11)
             MONMSG     MSGID(CPF0000 MCH0000)
 
             SNDPGMMSG  MSGID(CPF9898) MSGF(QCPFMSG) MSGDTA('Program +
                          MEC001426 ended abnormally - see job log') +
                          TOMSGQ(MOPERQ)
             MONMSG     MSGID(CPF0000 MCH0000)
 
/* End program */
 
 ENDCLPGM:
 
             ENDPGM
