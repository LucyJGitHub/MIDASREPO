000100220214/*********************************************************************/
000200220214/*STD    CLPBASE                                                     */
000300220214/*EXI *  TEXT('Midas Incoming MX Messages Purge Phase II of II')     */
000400220214/*********************************************************************/
000500220214/*                                                                   */
000600220214/*       Midas     - Message Management Module                       */
000700220214/*                                                                   */
000800220214/*       MEC2230  - Incoming MX Purge Phase II of II                 */
000900220214/*                                                                   */
001000220214/*       (c) Finastra International Limited 2021                     */
001100220214/*                                                                   */
001200220214/*       Last Amend No. CSW122  *CREATE    Date 04Oct21              */
001300220214/*                                                                   */
001400220214/*********************************************************************/
001500220214/*                                                                   */
001600220214/*       CSW122 - SWIFT ISO20022 Changes                             */
001700220214/*                                                                   */
001800220214/*********************************************************************/
001900220214
002000220214             PGM        PARM(&COMP_NAME &COMP_SEQ)
002100220214
002200220214             DCL        VAR(&CPYFLD) TYPE(*CHAR) LEN(64) VALUE('(c) +
002300220214                          Finastra International Limited +
002400220214                          2021')
002500220214
002600220214/** Declare variables */
002700220214
002800220214             DCL        VAR(&RTN_CODE) TYPE(*CHAR) LEN(7)
002900220214             DCL        VAR(&COMP_NAME) TYPE(*CHAR) LEN(10)
003000220214             DCL        VAR(&COMP_SEQ) TYPE(*DEC) LEN(5)
003100220214             DCL        VAR(&STATUS) TYPE(*CHAR) LEN(1)
003200220214             DCL        VAR(&DATA) TYPE(*CHAR) LEN(50)
003300220214
003400220214/** Global Monitor Message */
003500220214
003600220214             MONMSG     MSGID(CPF0000 RPG0000 MCH0000) +
003700220214                           EXEC(GOTO ABNORMAL)
003800220214
003900220214/** Send Message to MRUNQ and standard processing parameters */
004000220214
004100220214             SNDPGMMSG  MSG('MEC2230 - Incoming MX Purge Phase II') +
004200220214                          TOMSGQ(MRUNQ)
004300220214             CHGJOB     SWS(XXXXX000)
004400220214             CHGVAR     VAR(&RTN_CODE) VALUE(' ')
004500220214
004600220214/** Start Commitment Control */
004700220214
004800220214             STRCMTCTL  LCKLVL(*ALL) CMTSCOPE(*JOB)
004900220214
005000220214/** Create data LDA in QTEMP  */
005100220214
005200220214             CRTDTAARA  DTAARA(QTEMP/LDA) TYPE(*CHAR) LEN(256)
005300220214             MONMSG     MSGID(CPF1023)
005400220214
005500220214/** Get run status */
005600220214
005700220214             CHGVAR     VAR(&STATUS) VALUE(' ')
005800220214             CALL       PGM(CB0160) PARM(&COMP_NAME &COMP_SEQ &STATUS)
005900220214
006000220214/** Update status to Active */
006100220214
006200220214             CHGVAR     VAR(&STATUS) VALUE('Y')
006300220214             CALL       PGM(CB0150) PARM(&COMP_NAME &COMP_SEQ &STATUS)
006400220214
006500220214/** Call Purge II process  */
006600220214
006700220214             CALL       PGM(ME2220) PARM(&RTN_CODE)
006800220214             IF         COND((&RTN_CODE *NE '       ') *AND +
006900220214                             (&RTN_CODE *NE 'MIN0098')) THEN(GOTO +
007000220214                          CMDLBL(DBERR))
007100220214
007200220214/** Update status to Not Active - component finished */
007300220214
007400220214             CHGVAR     VAR(&STATUS) VALUE('N')
007500220214             CALL       PGM(CB0150) PARM(&COMP_NAME &COMP_SEQ &STATUS)
007600220214
007700220214             GOTO       CMDLBL(ENDCLPGM)
007800220214
007900220214/** Report Database errors trapped by program */
008000220214
008100220214 DBERR:
008200220214             RTVDTAARA  DTAARA(LDA (134 50)) RTNVAR(&DATA)
008300220214             SNDPGMMSG  MSGID(MEM0001) MSGF(MIDAS) MSGDTA(&DATA) +
008400220214                          TOPGMQ(*EXT) TOMSGQ(MOPERQ)
008500220214
008600220214/** Abnormal termination processing                       */
008700220214
008800220214ABNORMAL:
008900220214             ROLLBACK
009000220214             MONMSG     MSGID(CPF0000 RPG0000 MCH0000)
009100220214             CHGJOB     SWS(XXXXXX11)
009200220214             MONMSG     MSGID(CPF0000 RPG0000 MCH0000)
009300220214             DMPCLPGM
009400220214             MONMSG     MSGID(CPF0000 RPG0000 MCH0000)
009500220214
009600220214             SNDPGMMSG  MSG('Program MEC2230 ended abnormally') +
009700220214                          TOMSGQ(MOPERQ MRUNQ)
009800220214             MONMSG     MSGID(CPF0000 RPG0000 MCH0000)
009900220214             SNDPGMMSG  MSGID(CPF9898) MSGF(QCPFMSG) MSGDTA('Program +
010000220214                          MEC2230 ended abnormally') MSGTYPE(*ESCAPE)
010100220214             MONMSG     MSGID(CPF0000 RPG0000 MCH0000)
010200220214
010300220214 ENDCLPGM:   RCLRSC     LVL(*CALLER)
010400220214             MONMSG     MSGID(CPF0000 RPG0000 MCH0000)
010500220214             CHGVAR     VAR(&CPYFLD) VALUE('(c) +
010600220214                          Finastra International Limited')
010700220214             MONMSG     MSGID(CPF0000 RPG0000 MCH0000)
010800220214
010900220214             ENDPGM
