     H        1                           F
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas ME Outgoing message maintenance')                *
/*XBIA*: OVRDBF FILE(MGOREFLU) TOFILE(MGOREFL0)                     : *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Message Management                                   *
     F*                                                               *
     F*  ME0600 - Outgoing Message Detail Enquiry/Maintenance         *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. MD052485           Date 02Apr19               *
      *  Prev Amend No. CSW218             Date 19Mar18               *
      *                 CSW213             Date 03Jun13               *
      *                 MD020899           Date 26Jun13               *
      *                 263130             Date 14Dec09               *
      *                 264001             Date 23Feb10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 258797             Date 10Feb09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 BUG14915           Date 25Sep07               *
      *                 CSW207             Date 13Jun07               *
      *                 121288             Date 15Dec06               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 174844             Date 02Nov02               *
      *                 CSD031             Date 10Apr06               *
      *                 204225             Date 02May06               *
      *                 206803             Date 10Jul02               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 BUG6198            Date 04Apr05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 210868             Date 19Dec02               *
      *                 219242             Date 01Jul03               *
      *                 219241             Date 01Jul03               *
      *                 CSD015             Date 14Oct02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 212173             Date 18Nov02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 158656             Date 11Dec01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 196833             Date 16Aug01               *
      *                 183583             Date 08Jun01               *
      *                 CSW201             Date 02May01               *
      * Midas DBA 3.05 -----------------------------------------------*
      * Midas DBA 3.04 -----------------------------------------------*
      *                 186181             Date 08Nov00               *
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CTK001             Date 11May99               *
     F*                 141572             Date 21SEP98               *
      *                 CMT001             Date 02NOV98               *
      *                 131215             DATE 18OCT98               *
      *                 140629             Date 18Sep98               *
     F*                 CSW098             Date 24MAR97               *
     F*                 113352             Date 13Feb97               *
     F*                 115412             DATE 17Feb98               *
     F*                 107503             DATE 11APR97
     F*                 CSW097             Date 26May97               *
     F*                 S01408             Date 14Nov96               *
     F*                 CSW096             DATE 03SEP96               *
     F*                 098075             DATE 21JUN96               *
     F*                 093005             DATE 07MAY96               *
     F*                 CSW003             DATE 19JAN96               *
     F*                 S01408             DATE 09JAN96               *
     F*                 087198             DATE 23OCT95               *
     F*                 087654             DATE 10OCT95               *
     F*                 087653             DATE 10OCT95               *
     F*                 087779             DATE 05JUN95               *
     F*                 S01408             DATE 21APR95               *
     F*                 081561             DATE 12JAN95               *
     F*                 081505             DATE 12JAN95               *
     F*                 067471             DATE 01NOV94               *
     F*                 067460             DATE 01NOV94               *
     F*                 067236             DATE 01NOV94               *
     F*                 067210             DATE 01NOV94               *
     F*                 067054             DATE 01NOV94               *
     F*                 066991             DATE 01NOV94               *
     F*                 078455             DATE 25OCT94               *
     F*                 S01435             DATE 10NOV93               *
     F*                 057745             DATE 02FEB94               *
     F*                 042081             DATE 26MAY93               *
     F*                 E38493             DATE 15APR92               *
     F*                 E29588             DATE 31OCT91               *
     F*                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  MD052485 - MT202 F52A + F57A incorrect field data in SpA Ldn *
      *             printed report vs. MPM.                           *
      *  CSW218 - SWIFT Changes 2018                                  *
      *  CSW213 - SWIFT Changes 2013 (Recompile)                      *
      *  MD020899 - There are spaces between field 50F lines          *
      *  263130 - Do not expand 50F.                                  *
      *  264001 - Outgoing Message picking up wrong address in field  *
      *           57A. Ensure that if message type is 202 and tag     *
      *           :119: is present, the sequence number is reset so   *
      *           that the correct details will be displayed for tag  *
      *           57A. Apply and correct fix 263606.                  *
      *  258797 - Invalid characters in the displayed MTCASH message. *
      *           Remove all characters '#' and '¢' in array TXT.     *
      *  BUG14915 - Error in using Corporate BEI field                *
      *  CSW207 - SWIFT 2007 Changes                                  *
      *  121288 - Display 'Deliverer of Securities' as text if second *
      *           occurrence of field tag 87. (1st occurrence in an   *
      *           MT512 is always 'Receiver of Securities').          *
      *  174844 - For MT580, display part deleted as for MT210 and    *
      *           MT203.                                              *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  204225 - Field tag :50: is incorrect on SWIFT MT103.         *
      *           CROSSMAR customers must be checked first before tag *
      *           :50A: or tag :50K: is written/shown on MT103.       *
      *  206803 - Ensure that the correct record is accessed in       *
      *           MGOEXTPD for fields 5Na and 8Na for MT103s with     *
      *           field :119:.                                        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  BUG6198- Cannot save new Details for CUSD (Recompile)        *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  210868 - In MT202, data replicated in field 57A:.            *
      *  219242 - Not possible to create MT103+ payment msg from      *
      *           non-FT transaction (Recompile)                      *
      *  219241 - Defaulting of "Details of Charges" assign a         *
      *           system value (Recompile)                            *
      *  CSD015 - Midas Compliance Watch - Watch List Checking        *
      *  212173 - Process validation fields for MT103s                *
     F*  158656 - Fix 183583 made it mandatory to have a record in    *
     F*           PF/MGOEXTPD to display the report name and town     *
     F*           of the Swift Address of field tag :5nA:. Replace    *
     F*           BIC customer parameter only if a record exists.     *
      *  196833 - Additional SWIFT Address for CLS Nostros            *
      *  183583 - Read created extension file MGOEXTPD in order to    *
      *           obtain the correct customer number and to retrieve  *
      *           its corresponding customer name & town.             *
      *  CSW201 - SWIFT 2001 Standards Update                         *
     F*  186181 - Format for currency and amounts needs to be able to *
     F*           cope with a sign in front                           *
     F*  CTK001 - Testkey module conversion from DOS to WINDOWS       *
     F*           95/NT (Testkey II) Error message changed from UNABLE*
     F*           TO GENERATE TESTKEY - INVALID MIDAS TESTKEY         *
     F*           WORKSTATION to ....TESTKEY USER                     *
     F*  141572 - Recompile over changes in MGOREFPD                  *
     F*  CMT001 - Orion Telex 3.3 Implementation.                     *
     F*           Addition of new Telex status codes.                 *
     F*  131215 - If priority entered is 'Urgent' then both delivery  *
     F*           monitoring Fields should be filled.                 *
     F*  140629 - Convert field 72 amount (, to .)                    *
     F*  CSW098 - SWIFT 1998 changes.                                 *
     F*           This program is changed to recognise MT515/518      *
     F*           tags :98a: date/time format suffixed with a         *
     F*           qualifier and/or type (:qual//type/yyymmddhhmmss).  *
     F*           A new tag format 'DT' is introduced to format time  *
     F*           to hh:mm:ss.  Also, :95P: (:qual//swiftid) should   *
     F*           also be output with name and address as with :5nA:  *
     F*           and :8nA: tags. Furthermore, MG5910 must also be    *
     F*           run when deleting the new MT515 and MT518 messages. *
     F*  113352  -  Recompile over changes in MGOREFPD                *
     F*  115412 - Data base error in MG5910 at 10                     *
     F*           Do not call MG5910 for other message type than      *
     F*           MT510,512,520,521,522,523,554,580.                  *
     F*  107503 - If destination is from SWIFT BIC file, output name  *
     F*           and city from this file                             *
     F*  CSW097 - Swift changes 1997:                                 *
     F*           The program was amended to recognise dates          *
     F*           in CCYYMMDD format.                                 *
     F*           Also, display name and town for :8nA: fields        *
     F*  S01408 - Addition of core hook ME0600CP13                    *
     F*         - Addition of core hook ME0600CP12                    *
     F*         - Addition of core hook ME0600EEP1                    *
     F*         - Addition of core hook ME0600X001                    *
     F*         - Addition of core hook ME0600OOP1                    *
     F*  CSW096 - Swift Changes 1996:                                 *
     F*           Add validation for field 22.                        *
     F*  098075 - Verification field in message management allows     *
     F*           anything to be input to transmit SWIFT pay          *
     F*           messages for message MT200 when ICD is set to 'Y'   *
     F*           for verify payment messages.                        *
     F*  093005 - Additional code for CORE FIX 087779.                *
     F*  CSW003 - MT5XX Message Generation - Phase 2.                 *
     F*  S01408 - Core hook ME0600CCP3 added                          *
     F*         - Core hook ME0600CCP4 added                          *
     F*         - Core hook ME0600CCP5 added                          *
     F*         - Core hook ME0600CCP6 added                          *
     F*         - Core hook ME0600CCP7 added                          *
     F*         - Core hook ME0600CCP8 added                          *
     F*         - Core hook ME0600CCP9 added                          *
     F*         - Core hook ME0600CP10 added                          *
     F*         - Core hook ME0600CP11 added                          *
     F*  087198 - Review validation of priority and delivery          *
     F*           combination.                                        *
     F*  087654 - For MT210s, output multiple message TRN, instead    *
     F*           of MIDAS transaction number because TRN is          *
     F*           otherwise not shown for part. apply fix E42824      *
     F*  087653 - Allow  deletion of entire MT203.                    *
     F*  087779 - Ensure CONG and RCDG are reset if an SE message     *
     F*           is deleted, otherwise a DB error can occur later.   *
     F*  S01408 - Core hook ME0600FFPG added                          *
     F*         - Core hook ME0600IIPG added                          *
     F*         - Core hook ME0600CCPG added                          *
     F*         - Core hook ME0600CCP1 added                          *
     F*         - Core hook ME0600CCP2 added                          *
     F*  081561 - Additional message status for supervisors added.    *
     F*  081505 - Message status text changed to be more meaningful.  *
     F*  067471 - Testkey not reported                                *
     F*  067460 - ME0600 fails trying to generate tetskey if not      *
     F*           run from Testkey workstation                        *
     F*  067236 - Return code added to Testkey CL processing          *
     F*  067210 - Pass date to Testkey in DDMMYY format (rather       *
     F*           than YYMMDD)                                        *
     F*  067054 - Pass telex shortname to Testkey, rather than        *
     F*           customer number                                     *
     F*  066991 - Orion not passing Telex status back to Midas        *
     F*  078455 - Midas Leo Integration. Bypass the code that set up  *
     F*           Midas customer numbers for external systems.        *
     F*  S01435 - Incoming Message Management                         *
     F*  057745 - VERIFY MT200 NOSTRO TRANSFER TRANSMISSION           *
     F*  042081 - Add town to address                                 *
      *   E38493  -  SUPRESS ALL BRANCH INFO WHEN SINGLE BRANCHING    *  *
      *   E29588 - POST-COLLECTION SWIFT RATIONALISATION AMENDMENTS   *
      *             o Do not output SWIFT error line if it contains   *
      *               non-numeric data                                *
      *             o Update last action date and time for all        *
      *               amendments                                      *
      *             o Change status to AMENDED for all amendments     *
      *               except re-route to paper                        *
      *             o Output correct narrative for ME/MX free-format  *
      *               messages                                        *
      *                                                               *
      *  RE-WRITTEN FOR S01344 - SWIFT RATIONALISATION PHASE 2        *
      *                                                               *
      *****************************************************************
     FME0600DFCF  E                    WORKSTN
     F                                        RRN   KSFILE ME0600F2
     FMGOREFL0IF  E           K        DISK
     FMGOREFLUUF  E           K        DISK
     F            MGOREFD0                          KRENAMEMGOREFU0
     F/COPY WNCPYSRC,ME0600F001
     FMGOMSGPDIF  E           K        DISK
     FMGOEXTLFIF  E           K        DISK                               183583
     FSDMTPYL0IF  E           K        DISK
     FSDMTAGL0IF  E           K        DISK
     FSDMMODPDIF  E                    DISK
     FSDBRCHL5IF  E           K        DISK
     FSDCUSTL0IF  E           K        DISK
     FSDCUSTL7IF  E           K        DISK
     F            @CUSTGE                           KRENAMESDCUSTSW
     FSDCUSTL9IF  E           K        DISK
     F            @CUSTLG                           KRENAMESDCUSTST
     FSDCUSTLAIF  E           K        DISK
     F            @CUSTLH                           KRENAMESDCUSTTX
     FSDCNSTL2IF  E           K        DISK
     F            @CNSTLD                           KRENAMESDCNSTSW
     FSDCNSTL3IF  E           K        DISK
     F            @CNSTLE                           KRENAMESDCNSTST
     FSDCNSTL4IF  E           K        DISK
     F            @CNSTLF                           KRENAMESDCNSTTX
     FSDCUSTLIIF  E           K        DISK                                                   204225
     F            SDCUSTD0                          KRENAMESDCUSTBE                           204225
     FTKOTIPF O   E                    DISK                      A    UC
     FTKOTOPF IF  E                    DISK                           UC
      *                                                                                       CSW201
      ** MG Transaction history file                                                          CSW201
     FMGHISTL3IF  E           K        DISK                                                   CSW201
      *                                                                                       CSW201
      ** MG Transaction history file by first transaction number                              CSW201
     FMGHISTL4IF  E           K        DISK                                                   CSW201
     F            MGHISTD0                          KRENAMEMGHISTD2                           CSW201
      *                                                                                       CSW201
     FSDCWHTL1IF  E           K        DISK                                                   CSD015
      ** Compliance Watch Hit List by Function Type                                           CSD015
      *                                                                                       CSD015
     FMEBICDL2IF  E           K        DISK                                                   CSW218
      ** BIC Directory table                                                                  CSW218
     F*                                                                   S01408
     F/COPY WNCPYSRC,ME0600FFPG                                           S01408
     F*                                                                   S01408
      *
      * ID C  F  H  L    Function of indicators
      *    10            EOF MGOREFPD
      *    11            EOF MFOMSGPD
      *    15            MG9205 not found (error on call)
      *    20            SFLDSP
      *    21            SFLDSPCTL
      *    22            SFLEND
      *    23            Enable F8-Previous
      *    24            Enable F9-Next
      *    25            Enable F10-Delete
      *    26            Enable F20-Amend
      *    27            Enable F24-Release
      *    28            Display delete prompt
      *    29            Display amend prompt
      *    30            Display release prompt
      *    31            ENTER pressed
      *    35            Error
      *    40            Error - Message/Part to delete
      *    41            Error - Network
      *    42            Error - Priority
      *    43            Error - Delivery
      *    44            Error - Non-delivery
      *    45            Error - Verification
      *    46            Error - Testkey
      *    50            MM/MMM LOKUP
      *    51            Status codes LOKUP
      *    52            Verify field LOKUP
      *    53            Format field LOKUP
      *    60            Verification required
      *    61            Testkey required
      *    62            SWIFT message => enable prioity/deliver input
      *    70            ON  => title on display is '... Maintenance'
      *    --            OFF => title on display is '... Enquiry'
      *    75            ELIN (Error line) contains non-numeric data      E29588
      *    81            USED IN SCAN FOR /OCMT/ AND /CHGS/               140629
      *    90            EOF SDCUSTPD/SDCNSTPD
      *    96            EOF SDMTYPPD
      *    97            EOF SDMMODPD
      *    98            EOF SDMTAGPD
      *    KH            F8
      *    KI            F9
      *    KJ            F10
      *    KL            F12
      *    KU            F20
      *    KY            F24
      *    U7U8LR        DB error
      *
      *                                                                   S01408
     E/COPY WNCPYSRC,ME0600EEP1                                           S01408
      *                                                                   S01408
     E                    TABMM   1  12  2   TABMON  3   months MM/MMM format
     E/COPY WNCPYSRC,ME0600E004
     E******************* TXT     1  23 78               text             067236
     E********************TXT     1  26 78               text       067236CTK001
     E********************TXT     1  27 78               text      CTK001 121288
     E                    TXT     1  28 78               text             121288
     E/COPY WNCPYSRC,ME0600E005
     E******************* TABCD   1  23  4   TABNAR 35   status codes     066991
     E******************* TABCD   1  41  4   TABNAR 35   status code066991081561
     E******************* TABCD   1  42  4   TABNAR 35   status code081561CMT001
     E                    TABCD   1  49  4   TABNAR 35   status codes     CMT001
     E***********         VERFY   1   5  6               verify field     098075
     E/COPY WNCPYSRC,ME0600E001
     E***********         VERFY   1   6  6               verify field     098075              212173
     E                    VERFY   1   7  6               verify field                         212173
     E/COPY WNCPYSRC,ME0600E002
     E                    TAB1    1  10  2 0 TAB2   15   Match status textS01184
     E                    CPY@    1   1 80
     E/COPY WNCPYSRC,ME0600E003
     E                    FLA        50  1               format field
     E                    FLB        50  1               formatted field
      ** Array for determining end of correspondent.                      CTK001
      *                                                                   CTK001
     E                    DATX       31  1                                CTK001
     E/COPY WNCPYSRC,ME0600E006
      *
     IUSMTPY      DS                              3                       CSW096
     I                                        1   1 USCH1                 CSW096
     I                                        2   2 USCH2                 CSW096
     I                                        3   3 USCH3                 CSW096
      *                                                                   CSW096
     ILDA         DS                            256
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
      **  Local data area
      *
     I           SDS
     I                                      244 253 WSID
     I                                      254 263 USRID
      **  Workstation ID
      *
     IDSRUN       DS                             13
     I                                        1   7 RUNA
     I/COPY WNCPYSRC,ME0600I005
     I                                       12  12 DATF
     I                                       13  13 MBIN
      **  RUNDAT data area
      *
     IDSSTAT      DS                            256
     I                                        1   50SEQ
      **  MTSTAT data area
     I/COPY WNCPYSRC,ME0600I002
      *
     I            DS
     I                                        1   60MGDE
     I                                        1   2 YY
     I                                        3   4 MM
     I                                        5   6 DD
     I            DS
     I                                        1   7 @DMY
     I                                        1   2 @DD
     I                                        3   5 @MM
     I                                        6   7 @YY
      **  Message date
      *
     I            DS
     I                                        1   5 @MTAG
     I                                        1   3 @WK3
     I                                        2   2 @WK1
     I                                        4   4 @WL1
     I/COPY WNCPYSRC,ME0600I001
      **  Message tag
      *
     I            DS
     I                                        1   2 @DN
     I                                        1   1 @D
     I                                        2   2 @N
      **  Delivery, non delivery notification
      *
     I            DS
     I                                        1  78 RCD1
     I                                        1  40 @RCD1
     I                                        8  10 BRCA
     I                                       17  36 OTHT
     I                                       38  40 OTHB
     I                                       66  68 RCBR
     I            DS
     I                                        1  78 RCD2
     I                                        9  14 NWRK
     I                                       30  32 MTPY
     I                                       34  68 @TYP
     I                                       71  78 @PDE
     I            DS
     I                                        1  78 RCD3
     I                                       17  36 NWSN
     I                                       59  65 @MGDE
     I            DS
     I                                        1  78 RCD4
     I                                       17  36 NWDS
     I                                       45  64 @NAME
     I                                       66  75 @TOWN
     I            DS
     I                                        1  78 RCD5
     I                                       17  41 @DSC
     I                                       50  56 LADT
     I                                       63  700@LATM
     I                                       63  64 @@HH
     I                                       66  67 @@MM
     I                                       69  70 @@SS
     I*                                                                   S01408
     I/COPY WNCPYSRC,ME0600IIPG                                           S01408
     I*                                                                   S01408
      **  Common headings
      *
     I            DS
     I                                        1  78 RCD6
     I                                        8   9 MODI
     I                                       29  43 MTRN
     I                                       50  51 TNTP
     I                                       61  62 SBTP
     I                                       11  78 IPME
      **  MIDAS generated single message headings
      *
     I            DS
     I                                        1  78 RCD7
     I                                        8   9 @MODI
     I**********                             29  43 SACN                                      CGL029
     I                                       29  49 SACN                                      CGL029
      **  MIDAS generated MT950 statement message
      *
     I            DS
     I                                        1  78 RCD8
     I                                       17  22 SYTM
      **  External system message headings
      *
     I            DS
     I                                        1  78 RCD9
     I                                        1  44 @RCD9
     I                                       10  15 @MPRY
     I                                       21  21 @DEL
     I                                       31  31 @NDL
     I                                       51  53 MSE1
     I                                       55  57 ELIN
      **  SWIFT headings
      *
     I            DS
     I                                        1  78 RCD10
     I                                       17  19 TSKSN
      **  Telex headings
      *
     I            DS
     I                                        1  78 RCD11
     I                                       19  33 CPYNAR
     I                                       55  69 BRKNAR
      **  Single message confirmation matching headings
      *
     I            DS
     I                                        1  78 RCD12
     I                                        2  12 @DLT
     I                                       18  19 @MODL
     I************                           24  40 @MTRN                 087654
     I                                       26  40 @MTRN                 087654
     I                                       47  48 @TNTP
     I                                       54  55 @SBTP
     I                                       57  65 @CPY
     I                                       63  64 @CFCPY
     I                                       66  73 @BRK
     I                                       71  72 @CFBRK
     I                                       57  72 @BLK
      **  Multiple message part headings
      *
     I            DS
     I                                        1  78 RCD13
     I                                        1  20 EFSCFD
     I                                       22  26 MTAG
     I                                       23  24 MTAG#                 121288
     I**********                             27  27 @#                                        258797
     I                                       28  77 MFLD
     I                                       28  28 @WM1
      **  Message text field
      *
     I            DS                                                      E29588
     I                                        1  78 RCDME                 E29588
     I                                        8   9 MEMOD                 E29588
      **  Heading for Message Managemnt free-format messages              E29588
      *                                                                   E29588
     I            DS                                                      067471
     I                                        1  78 RCDTK                 067471
     I                                       17  31 @TKY                  067471
      **  Heading for Testkey                                             067471
      *                                                                   067471
     I/COPY WNCPYSRC,ME0600I003
     I            DS
     I                                        1   8 WRKDAT
     I                                        1   2 WRKYY
     I                                        4   5 WRKMM
     I                                        7   8 WRKDD
      **  Data structure for rearranging date
      *
     I            DS
     I                                        1   8 CHGDAT
     I                                        1   5 @CHG5
     I I            '/'                       3   3 @1
     I I            '/'                       6   6 @@2
     I                                        7   8 CHGYY
      *                                                                   CSW097
      ** New data structure was introduced to accommodate                 CSW097
      ** CCYYMMDD format.                                                 CSW097
      *                                                                   CSW097
     I            DS                                                      CSW097
     I                                        1  10 WKDAT                 CSW097
     I                                        1   4 WKYY                  CSW097
     I                                        6   7 WKMM                  CSW097
     I                                        9  10 WKDD                  CSW097
      *                                                                   CSW097
      ** Data structure for rearranging date in CCYYMMDD format.          CSW097
      *                                                                   CSW097
     I            DS                                                      CSW097
     I                                        1  10 CHDAT                 CSW097
     I                                        1   5 @CH5                  CSW097
     I I            '/'                       3   3 @3                    CSW097
     I I            '/'                       6   6 @@4                   CSW097
     I                                        7  10 CHYY                  CSW097
      *                                                                   CSW097
      ** Define a constant.                                               CSW097
      *                                                                   CSW097
     I              '0123456789'          C         DIGITS                CSW097
     I/COPY WNCPYSRC,ME0600I004
      **  Data structure for rearranging date
      *
     I            DS
     I                                        1   6 WRKLAT
     I                                        1   2 @WKHH
     I                                        3   4 @WKMM
     I                                        5   6 @WKSS
      **  Date structure for time
      *
     I            DS
     I                                        1  12 ZSWFT
     I                                        8   8 USID                  CSW096
     I                                        9  11 BIC
      ** DS to check for BIC address
      *
     I            DS                                                      S01156
     I                                        1  35 TKIN                  S01156
     I                                        1   20W1                    S01156
     I                                        3   3 DTTP                  S01156
     I                                        4   4 CLN                   S01156
     I                                        5  35 DATA                  S01156
     I                                        5  35 DATX                  CTK001
     I                                        8   8 DTA4                  S01156
     I                                       11  12 DTA2                  S01156
     I                                       13  13 DTA3                  S01156
     I                                       15  15 DTA5                  067054
      **  Data structure to hold message passed to testkey                S01156
      *                                                                   S01156
     I            DS                             34
     I                                        1  34 TKOT
     I                                        1   20ID                    S01156
     I                                        2   2 SYS1
     I                                        4  33 TSKY1
     I                                        4   4 ERRR
      ** Data structure to hold message received from testkey
      *
     I            DS
     I                                        1   6 SVDT
     I                                        1   2 YY1
     I                                        3   4 MM1
     I                                        5   6 DD1
      *
     I            DS
     I                                        1   6 @SVDT
     I                                        1   2 DD2
     I                                        3   4 MM2
     I                                        5   6 YY2
      *                                                                   107503
      **  Data structure to split BIC address                             107503
      *                                                                   107503
     I            DS                                                      107503
     I                                        1  12 W01BIC                107503
     I                                        1   8 W01ICC                107503
     I                                        9  11 W01ICB                107503
      **  Data structure to reformat value date
      *
     IWHREF       DS                         16                                               CSW201
     I                                        1   2 HSMODI                                    CSW201
     I                                        3   8 HSTRAN                                    CSW201
     I                                        9  11 HSSEQ                                     CSW201
     ISDMGME    E DSSDMGMEPD
     I** Message Management details.
     I*
     ISCSARD    E DSSCSARDPD                                              CSW003
      *                                                                   CSW003
      ** External data structure for Switchable Features                  CSW003
      *                                                                   CSW003
     ISDCUST    E DSSDCUSTPD                                              S01435
      *                                                                   S01435
      *  Calling parameter data structure for AOCUSTR0                    S01435
      *                                                                   S01435
     ISDCNST    E DSSDCNSTPD                                              S01435
      *                                                                   S01435
      *  Calling parameter data structure for ME1400                      S01435
      *                                                                   S01435
     IMEBICD    E DSMEBICDPD                                              S01435
      *                                                                   S01435
      *  Calling parameter data structure for ME1400                      S01435
      *                                                                   S01435
      *                                                                   S01435
      * Layout for BIC directory processing                               S01435
      *                                                                   S01435
     IBICLAY      DS                             77                       S01435
      * Format for Report                                                 S01435
     I                                       28  62 #SCR1                 S01435
     I                                       63  77 #SCR2                 S01435
      /EJECT                                                              S01435
     IDSFDY     E DSDSFDY
      **  Access object DS
      *
     IDSLDY     E DSDSLDY                                                                     196833
      ** Long data structure for access objects                                               196833
      *                                                                                       196833
     ISDWLCC    E DSSDWLCCPD                                                                  CSD015
      ** Midas Functions for Watch List Checking Details File                                 CSD015
      *                                                                                       CSD015
     ISDSTAT    E DSSDSTAT                                                                    CSD015
      ** SD data area                                                                         CSD015
     I/COPY WNCPYSRC,ME0600I006
      *                                                                                       CSD015
     C           MGTAGK    KLIST
     C                     KFLD           MTAGK   5
     C                     KFLD           MTPYK   3
      *                                                                   CSW098
     C           KMTAG     KLIST                                          CSW098
     C                     KFLD           MTAGK                           CSW098
     C                     KFLD           MTPYK                           CSW098
     C                     KFLD           MSEQN   3                       CSW098
      *                                                                   183583
      ** KLIST for MGOEXTLF                                               183583
      *                                                                   183583
     C           KEXTN     KLIST                                          183583
     C                     KFLD           TRNO                            183583
     C                     KFLD           MTPY                            183583
     C                     KFLD           @V      20                      183583
      *
     C           *ENTRY    PLIST
     C                     PARM           TRNO   16
     C                     PARM           BGCFMT  1
     C                     PARM           ACTN    1
     C                     PARM           FILA    1
     C                     PARM           RTCD    2
     C                     PARM           @ERR    1
     C                     PARM           @TK     1                       067460
      *
      **  ZM1001 ERROR
     C           PLIST3    PLIST
     C                     PARM           @MSGID 10
     C                     PARM           @MSDTA 78
      *
     C                     MOVEL'ME0600'  PGMQ   10                       S01227
     C                     MOVEL*BLANKS   MSGKEY  4
      *                                                                                       CSW201
     C           KHIST     KLIST                                                              CSW201
     C                     KFLD           HSMODI                                              CSW201
     C                     KFLD           HSTRAN                                              CSW201
     C                     KFLD           HSMTPY                                              CSW201
     C                     KFLD           HSSEQ                                               CSW201
      *
      *****************************************************************
      *                   Index to subroutines                        *
      *   main process                                                *
      *   INIT   - initial process                                    *
      *   HDNG   - write message headings                             *
      *   TEXT   - write message text                                 *
      *   DELT   - delete message                                     *
      *   AMND   - amend message                                      *
      *   RELS   - release message                                    *
      *   SWADDR - format Name/Town from SWIFT address                *
      *   STADDR - format Name/Town from STTX address                 *
      *   TXADDR - format Name/Town from TELEX address                *
      *   PAPER  - clear Name/Town fields for paper messages          *
      *   FORM   - Format subfield                                    *
      *   *PSSR  - error handling                                     *
      *****************************************************************
     C/EJECT
      *****************************************************************
      *   main process                                                *
      *   Calls - INIT initial process                                *
      *           HDNG write message headings                         *
      *           TEXT write message text                             *
      *           DELT delete message                                 *
      *           AMND amend message                                  *
      *           RELS release message                                *
      *****************************************************************
      *
      **  Perform initial process
     C                     EXSR INIT
      *
      **  Access message reference file using transaction reference
     C           TRNO      CHAINMGOREFL0             10
      *
     C           *IN10     IFEQ '1'                                   1
     C           *LOCK     IN   LDA
     C                     Z-ADD3         DBASE
     C                     MOVELTRNO      DBKEY            * DB ERROR 03 *
     C                     MOVEL'MGOREFPD'DBFILE
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END                                       E1
     C/COPY WNCPYSRC,ME0600C067
      *
      **  If transaction is part of mutiple message
      **  access message reference file using message reference
     C           TRNF      IFNE *BLANKS                               1
     C                     MOVE TRNF      TRNO
      *
     C           TRNO      CHAINMGOREFL0             10
      *
     C           *IN10     IFEQ '1'                                   2
     C           *LOCK     IN   LDA
     C                     Z-ADD4         DBASE
     C                     MOVELTRNO      DBKEY            * DB ERROR 04 *
     C                     MOVEL'MGOREFPD'DBFILE
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END                                       E2
     C/COPY WNCPYSRC,ME0600C068
     C                     END                                       E1
      *
      **  Save header message details
     C                     MOVE TRNO      @TRNO  16
     C                     MOVE MGSG      @MGSG   1
     C                     MOVE NWRK      @NWRK   6
     C                     MOVE TSKS      @TSKS   1
     C/COPY WNCPYSRC,ME0600C006
      *
      **  Write message headings
     C                     EXSR HDNG
      *
      **  Access message file using message reference
     C           TRNO      CHAINMGOMSGPD             11
      *                                                                                       174844
      **  Initialise variable for first part of MT580.                                        174844
     C                     MOVEL'FIRST'   PHS     5                                           174844
      *
     C           *IN11     IFEQ '1'                                   1
     C           *LOCK     IN   LDA
     C                     Z-ADD5         DBASE
     C                     MOVELTRNO      DBKEY            * DB ERROR 05 *
     C                     MOVEL'MGOMSGPD'DBFILE
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END                                       E1
     C/COPY WNCPYSRC,ME0600C015
      *
      **  Process messages records with message reference
      *                                                                                       206803
     C           MTPY      IFEQ '103'                                                         206803
     C           MTAG      ANDEQ':119:'                                                       206803
     C           MTPY      OREQ '202'                                                         264001
     C           MTAG      ANDEQ':119:'                                                       264001
     C           MTPY      OREQ '103'                                                       MD052485
     C           MTAG      ANDEQ':121:'                                                     MD052485
     C           MTPY      OREQ '202'                                                       MD052485
     C           MTAG      ANDEQ':121:'                                                     MD052485
     C                     MOVE 'Y'       W#RSET  1                                           206803
     C                     ELSE                                                               206803
     C                     MOVE 'N'       W#RSET                                              206803
     C                     ENDIF                                                              206803
      *                                                                                       206803
     C                     MOVE 'N'       @MARK   1                                         MD052485
     C           MTPY      IFEQ '202'                                                       MD052485
     C           MTAG      ANDEQ':119:'                                                     MD052485
     C           MFLD      ANDEQ'COV'                                                       MD052485
     C                     MOVE 'Y'       @MARK                                             MD052485
     C                     ENDIF                                                            MD052485
      *                                                                                     MD052485
     C                     Z-ADD1         @V                              183583
     C           *IN11     DOWEQ'0'                                   1
     C/COPY WNCPYSRC,ME0600C016
      *
      **  Write message text
     C                     EXSR TEXT
      *
      **  Access next message file record with message reference
     C           @TRNO     READEMGOMSGPD                 11
      *                                                                                       206803
     C           W#RSET    IFEQ 'Y'                                                           206803
     C                     Z-ADD1         @V                                                  206803
     C                     MOVE 'N'       W#RSET                                              206803
     C                     ELSE                                                               206803
     C                     ADD  1         @V                              183583
     C                     ENDIF                                                              206803
      *                                                                                       206803
     C           @MARK     IFEQ 'Y'                                                         MD052485
     C                     MOVE 'Y'       W#RSET                                              206803
     C                     MOVE 'N'       @MARK                                             MD052485
     C                     ENDIF                                                            MD052485
      *                                                                                     MD052485
     C/COPY WNCPYSRC,ME0600C007
     C                     END                                       E1
     C/COPY WNCPYSRC,ME0600C017
      *
      **  If last or single message disable F8-Next
     C           FILA      IFNE 'L'                                   1
     C           FILA      ANDNE'S'
     C                     SETON                     23
     C                     END                                       E1
      *
      **  If first or single message disable F9-Previous
     C           FILA      IFNE 'F'                                   1
     C           FILA      ANDNE'S'
     C                     SETON                     24
     C                     END                                       E1
      *
      **  Do until F8, F9 or F12 pressed
     C           *INKH     DOWEQ'0'                                   1
     C           *INKI     ANDEQ'0'
     C           *INKL     ANDEQ'0'
      *
      **  If no errors clear input fields
     C           *IN35     IFEQ '0'                                   2
     C                     MOVE *BLANKS   STRN
     C                     MOVE *BLANKS   SNWK
     C                     MOVE *BLANKS   SPTY
     C                     MOVE *BLANKS   SDEL
     C                     MOVE *BLANKS   SNDL
     C                     MOVE *BLANKS   STKY
     C                     MOVE *BLANKS   SDAT
     C                     MOVE *BLANKS   SCCY
     C                     MOVE *BLANKS   SAMT
     C/COPY WNCPYSRC,ME0600C069
     C                     SETOF                     252627
     C                     SETOF                     282930
     C/COPY WNCPYSRC,ME0600C018
     C                     END                                       E2
      *
      **  If not enquiry
     C           ACTN      IFNE 'E'                                   2
      *
      **  Set indicator for 'Maintenance' on display
     C                     SETON                     70
      *
      **  If unreleased enable F10-Delete & F20-amend
     C           @MGSG     IFEQ '1'
     C                     SETON                     2526             3
      *
      **  If SWIFT, telex or STTX enable F24-Release
     C           @NWRK     IFEQ 'SWIFT'                               4
     C*                                                                   S01408
     C/COPY WNCPYSRC,ME0600CCP3                                           S01408
     C*                                                                   S01408
     C           @NWRK     OREQ 'TELEX'
     C           @NWRK     OREQ 'STTX'
     C/COPY WNCPYSRC,ME0600C054
     C                     SETON                     27
     C                     END                                       E4
     C                     END                                       E3
     C                     END                                       E2
     C/COPY WNCPYSRC,ME0600C043
      *
      **  If F10 pressed display delete prompt
     C           *IN25     IFEQ '1'                                   2
     C           *INKJ     ANDEQ'1'
     C                     SETON                     28
     C                     SETOF                     2930
     C/COPY WNCPYSRC,ME0600C019
     C                     END                                       E2
      *
      **  If F20 pressed display amend prompt - If message is for the
      **  SWIFT network, enable priority/delivery input.
     C           *IN26     IFEQ '1'                                   2
     C           *INKU     ANDEQ'1'
     C           @NWRK     IFEQ 'SWIFT'
     C*                                                                   S01408
     C/COPY WNCPYSRC,ME0600CCP9                                           S01408
     C*                                                                   S01408
     C                     SETON                     62
     C                     ELSE
     C                     SETOF                     62
     C                     END
     C                     SETON                     29
     C                     SETOF                     2830
     C/COPY WNCPYSRC,ME0600C008
     C                     END                                       E2
      *
      **  If F24 pressed display verification prompt
     C           *IN27     IFEQ '1'                                   2
     C           *INKY     ANDEQ'1'
     C/COPY WNCPYSRC,ME0600C051
      *
     C           ENVPM     IFEQ 'Y'                                   3
     C/COPY WNCPYSRC,ME0600C020
     C           MTPY      IFEQ '100'                                 4
     C           MTPY      OREQ '202'
     C           MTPY      OREQ '203'
     C           MTPY      OREQ '200'                                     057745
     C           MTPY      OREQ '103'                                                         212173
     C/COPY WNCPYSRC,ME0600C076
     C                     SETON                     30
     C                     SETOF                     2829
     C                     END                                       E4
     C/COPY WNCPYSRC,ME0600C021
     C                     END                                       E3
      *
     C                     SETOF                     61
     C           @NWRK     IFEQ 'TELEX'                               3
     C           @TSKS     ANDEQ'Y'
     C                     SETON                     3061
     C/COPY WNCPYSRC,ME0600C044
     C                     SETOF                     2829
     C                     END                                       E3
      *
      **  ..or release
     C           *IN30     IFEQ '0'                                   3
     C*                                                                   S01408
     C/COPY WNCPYSRC,ME0600CCPG                                           S01408
     C/COPY WNCPYSRC,ME0600C041                                           S01408
     C*                                                                   S01408
     C                     EXSR RELS
     C*                                                                   S01408
     C/COPY WNCPYSRC,ME0600CCP2                                           S01408
     C*                                                                   S01408
     C           *IN35     IFEQ '0'                                   4
     C                     SETOF                     252627
     C                     END                                       E4
     C/COPY WNCPYSRC,ME0600C022
     C                     END                                       E3
     C                     END                                       E2
     C/COPY WNCPYSRC,ME0600C023
      *
      **  Write Subfile
     C                     WRITEME0600F1
     C                     WRITESFLMSGC
     C                     EXFMTME0600F3
     C                     CALL 'ZM1002'
     C                     SETOF                     35
     C                     SETOF                     404142
     C                     SETOF                     434445
     C                     SETOF                     46
      *
     C/COPY WNCPYSRC,ME0600C055
      *
      **  If ENTER pressed
     C           *IN31     IFEQ '0'                                   2
      *
     C           *IN28     IFEQ '1'                                   3
     C/COPY WNCPYSRC,ME0600C060
     C                     EXSR DELT
     C/COPY WNCPYSRC,ME0600C061
     C                     END                                       E3
      *
     C           *IN29     IFEQ '1'                                   3
     C/COPY WNCPYSRC,ME0600C009
     C                     EXSR AMND
     C                     END                                       E3
      *
     C           *IN30     IFEQ '1'                                   3
     C*                                                                   S01408
     C/COPY WNCPYSRC,ME0600CCPG                                           S01408
     C/COPY WNCPYSRC,ME0600C042                                           S01408
     C*                                                                   S01408
     C                     EXSR RELS
     C*                                                                   S01408
     C/COPY WNCPYSRC,ME0600CCP2                                           S01408
     C*                                                                   S01408
     C                     END                                       E3
     C                     END                                       E2
     C                     END                                       E1
     C/COPY WNCPYSRC,ME0600C024
      *
      **  If F8 pressed
     C           *INKH     IFEQ '1'                                   1
     C                     MOVE '08'      RTCD
     C                     END                                       E1
      *
      **  If F9 pressed
     C           *INKI     IFEQ '1'                                   1
     C                     MOVE '09'      RTCD
     C                     END                                       E1
      *
      **  If F12 pressed
     C           *INKL     IFEQ '1'                                   1
     C                     MOVE '12'      RTCD
     C                     END                                       E1
      *
     C                     SETON                     LR
     C/EJECT
      *****************************************************************
      *   INIT - inital process                                       *
      *   Called by - main process                                    *
      *****************************************************************
      *
     C           INIT      BEGSR
     C*                                                                   S01408
     C/COPY WNCPYSRC,ME0600CCP1                                           S01408
     C*                                                                   S01408
      *
     C                     MOVEACPY@      BIS@   80
      *
      **  Set up LDA
     C           *NAMVAR   DEFN           LDA
     C           *LOCK     IN   LDA
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     MOVEL'ME0600'  DBPGM
     C                     MOVE *BLANKS   DBASE
     C                     OUT  LDA
      *
      ** Access SDMGMEPD for verification flag via access program.
      *
     C                     CALL 'AOMGMER0'
     C                     PARM '*MSG    '@RTCD   7
     C                     PARM '*FIRST  '@OPTN   7
     C           SDMGME    PARM SDMGME    DSFDY
      *
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     Z-ADD1         DBASE
     C                     MOVEL@OPTN     DBKEY            * DB ERROR 04 *
     C                     MOVEL'SDMGMEPD'DBFILE
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END                                       E1
      *
      **
     C           ENVPM     IFEQ 'Y'
     C                     SETON                     60
     C                     END
      *
      *                                                                   CSW003
      ** Check if (CSW003) MT5XX - Phase 2 Message Generation is on.      CSW003
      *                                                                   CSW003
     C                     CALL 'AOSARDR0'                                CSW003
     C                     PARM '*BLANKS' WRTCD   7                       CSW003
     C                     PARM '*VERIFY' WOPTN   7                       CSW003
     C                     PARM 'CSW003'  @SARD   6                       CSW003
     C           SCSARD    PARM SCSARD    DSFDY                           CSW003
      *                                                                   CSW003
     C           WRTCD     IFEQ *BLANKS                                   CSW003
     C                     MOVE 'Y'       CSW003  1                       CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW098
      ** Check if (CSW098) SWIFT 1998 changes is on                       CSW098
      *                                                                   CSW098
     C                     CALL 'SWIFT98'              7676               CSW098
     C                     PARM *BLANKS   CSW098  7                       CSW098
      *                                                                   CSW098
     C           *IN76     IFEQ '1'                                       CSW098
     C           *LOCK     IN   LDA                                       CSW098
     C                     MOVE '011'     DBASE                           CSW098
     C                     MOVEL'SWIFT98 'KEY16                           CSW098
     C                     MOVE 'ERROR   'KEY16  16        * * * * * * * *CSW098
     C                     MOVELKEY16     DBKEY            *  DBERR 011  *CSW098
     C                     MOVEL*BLANKS   DBFILE           * * * * * * * *CSW098
     C                     OUT  LDA                                       CSW098
     C                     EXSR *PSSR                                     CSW098
     C                     END                                            CSW098
      *                                                                                       CSW201
      ** Check if (CSW201) SWIFT 2001 changes is on                                           CSW201
      *                                                                                       CSW201
     C                     CALL 'SWIF2001'                                                    CSW201
     C                     PARM           P@RTCD  7                                           CSW201
      *                                                                                       CSW201
     C           P@RTCD    IFEQ 'CSW2001'                                                     CSW201
     C                     MOVE 'Y'       CSW201  1                                           CSW201
     C                     ELSE                                                               CSW201
     C                     MOVE 'N'       CSW201                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                   CSW003
      *                                                                                       CSD015
     C           *NAMVAR   DEFN           SDSTAT                                              CSD015
     C                     IN   SDSTAT                                                        CSD015
      *                                                                                       CSD015
      ** Check if Midas Compliance Watch (CSD015) is installed                                CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CSD015  1                                           CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY' POPTN                                               CSD015
     C                     PARM 'CSD015'  PSARD   6                                           CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANK                                                        CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     MOVEL'032'     DBASE                                               CSD015
     C                     MOVEL'CSD015'  DBKEY                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANK                                                        CSD015
     C                     MOVE 'Y'       CSD015                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** If CSD015 is on, check that function code is being monitored by                      CSD015
      ** Compliance Watch by calling AOWLCCR0                                                 CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C                     CALL 'AOWLCCR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*KEY   ' POPTN                                               CSD015
     C                     PARM 'MESSGENT'PFUNC   8                                           CSD015
     C           SDWLCC    PARM SDWLCC    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANK                                                        CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SDWLCCPD'DBFILE                                              CSD015
     C                     MOVEL'033'     DBASE                                               CSD015
     C                     MOVELPFUNC     DBKEY                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Compliance Watch Hit List Key List                                                   CSD015
      *                                                                                       CSD015
     C           KWHTKY    KLIST                                                              CSD015
     C                     KFLD           WFUNT   8                                           CSD015
     C                     KFLD           WIDEN  40                                           CSD015
     C                     KFLD           BRCA                                                CSD015
      *                                                                                       CSD015
     C/COPY WNCPYSRC,ME0600C070
      **  Access SDMMODPD for active networks
     C           1         CHAINSDMMODPD             97
      *
     C           *IN97     IFEQ '1'                                   1
     C           *LOCK     IN   LDA
     C                     Z-ADD2         DBASE
     C                     MOVEL'FIRST'   DBKEY            * DB ERROR 02 *
     C                     MOVEL'SDMMODPD'DBFILE
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END                                       E1
      *
      **  Access RUNDAT to find run date & multibranching indicator
     C           *NAMVAR   DEFN RUNDAT    DSRUN
     C           *LOCK     IN   DSRUN
     C                     OUT  DSRUN
      *
      **  Set up texts
     C                     MOVE TXT,1     RCD1
     C                     MOVE TXT,2     RCD2
     C                     MOVELTXT,3     RCD3
     C                     MOVELTXT,4     RCD4
     C                     MOVELTXT,5     RCD5
     C                     MOVELTXT,6     RCD6
     C                     MOVE TXT,7     RCD7
     C                     MOVE TXT,8     RCD8
     C                     MOVE TXT,9     RCD9
     C                     MOVE TXT,10    RCD10
     C                     MOVE TXT,11    RCD11
     C                     MOVE TXT,12    RCD12
     C                     MOVE TXT,21    RCDME  78
     C                     MOVE TXT,25    RCDTK                           067471
     C/COPY WNCPYSRC,ME0600C071
     C**********           MOVE *LOVAL    @#                                                  258797
     C                     MOVE *LOVAL    @#      1                                           258797
     C                     BITON'123467'  @#
      *                                                                   CSW096
      **  Check if SWIFT Changes 1996 (CSW096) is installed               CSW096
      *                                                                   CSW096
     C                     CALL 'SWIFT96'                                 CSW096
     C                     PARM *BLANKS   @RTCD   7                       CSW096
      *                                                                   CSW096
     C           @RTCD     IFEQ 'CSW096'                                  CSW096
     C                     MOVE 'Y'       CSW096  1                       CSW096
     C                     ELSE                                           CSW096
     C                     MOVE 'N'       CSW096                          CSW096
     C                     ENDIF                                          CSW096
      *                                                                                       CSW218
      ** Check if Swift 2018 changes is installed.                                            CSW218
      *                                                                                       CSW218
     C                     CALL 'SWIF2018'                                                    CSW218
     C                     PARM           PRTCD                                               CSW218
     C           PRTCD     IFEQ 'CSW2018'                                                     CSW218
     C                     MOVEL'Y'       CSW218  1                                           CSW218
     C                     ELSE                                                               CSW218
     C                     MOVEL'N'       CSW218                                              CSW218
     C                     ENDIF                                                              CSW218
      *                                                                                       CSW218
     C           KBICD     KLIST                                                              CSW218
     C                     KFLD           WBICC                                               CSW218
     C                     KFLD           WBICB                                               CSW218
      *
      **  Clear subfile
     C                     SETOF                     2021
     C                     WRITEME0600F3
     C                     SETON                     202122
     C/COPY WNCPYSRC,ME0600C052
     C                     Z-ADD1         RRN     50
      **                                                                  121288
     C                     MOVE 'N'       FLD87   1                       121288
      *
     C*                                                                   S01408
     C/COPY WNCPYSRC,ME0600CCP8                                           S01408
     C*                                                                   S01408
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   HDNG - Write message headings                               *
      *   Called by main process                                      *
      *             - DELT delete message                             *
      *               AMND amend message                              *
      *               RELS release message                            *
      *   Calls - SWADDR format Name/Town from SWIFT address          *
      *           STADDR format Name/Town from STTX address           *
      *           TXADDR format Name/Town from TELEX address          *
      *           PAPER  clear Name/Town fields for paper messages    *
      *****************************************************************
      *
     C           HDNG      BEGSR
      *
     C/COPY WNCPYSRC,ME0600C081
     C                     MOVE *BLANKS   RCD
      *                                                                   078455
      **  Only perform the Midas address processing if this is a Midas    078455
      **  message. If it is from an external system bypass this code      078455
      **  and set the addresses to blank.                                 078455
     C           SYTM      IFEQ *BLANKS                                   078455
      *
      **  Access Sender's customer details for non-SWIFT addresses
     C                     MOVE SECN      @WK6    6
     C           @WK6      CHAINSDCUSTL0             90
      *
     C           *IN90     IFEQ '1'                                   1
     C           *LOCK     IN   LDA
     C                     Z-ADD7         DBASE
     C                     MOVELSECN      DBKEY
     C                     MOVEL'SDCUSTL0'DBFILE
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END                                       E1
      *
      **  Store Sender's non-SWIFT addresses
     C                     MOVELBBCRNM    SNAME  20
     C                     MOVELBBTXA1    STELX  10
     C                     MOVELBBSTAD    SSTTX  12
      *
      ** Access branch file for Sender's SWIFT TID
     C           @WK6      CHAINSDBRCHL5             90
      *
     C           *IN90     IFEQ '1'                                   1
     C           *LOCK     IN   LDA
     C                     Z-ADD9         DBASE
     C                     MOVELSECN      DBKEY
     C                     MOVEL'SDBRCHL5'DBFILE
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END                                       E1
      *
      ** Store Sender's SWIFT TID
     C                     MOVELA8BTID    SSWFT  12
      *
      **  Access all available network addresses using current address
      **  non SWIFT, telex or STTX messages are accessed by customer
     C                     MOVELNWDS      ZADDR
     C                     MOVELDECN      ZCUST   8                       183583
     C                     EXSR SRDEST                                                        196833
     C           NWRK      CASEQ'SWIFT'   SWADDR                      1
     C*                                                                   S01408
     C/COPY WNCPYSRC,ME0600CCP4                                           S01408
     C*                                                                   S01408
     C           NWRK      CASEQ'STTX'    STADDR
     C           NWRK      CASEQ'TELEX'   TXADDR
     C                     CAS            PAPER
     C                     END                                       E1
      *
      **  Store all Destination's network addresses
     C                     MOVELZNAME     DNAME  20
     C                     MOVELZTELX     DTELX  10
     C                     MOVELZSTTX     DSTTX  12
      *                                                                                       CSW218
     C           CSW218    IFEQ 'N'                                                           CSW218
      *
      ** A 'BIC' code is not a valid SWIFT address - check BIC in DS
     C           BIC       IFNE 'BIC'
     C           CSW096    ANDEQ'N'                                       CSW096
     C           USID      ORNE '1'                                       CSW096
     C           CSW096    ANDEQ'Y'                                       CSW096
     C                     MOVELZSWFT     DSWFT  12
     C                     ELSE
     C                     MOVEL*BLANKS   DSWFT
     C                     END
      *                                                                                       CSW218
     C                     ELSE                                                               CSW218
      ** Check SWIFT address if connected to SWIFTNet FIN when CSW218 is ON                   CSW218
      *                                                                                       CSW218
     C                     MOVEL*BLANKS   WSID19                                              CSW218
     C           ZSWFT     IFNE *BLANKS                                                       CSW218
     C                     MOVELZSWFT     WBICC   8                                           CSW218
     C           3         SUBSTZSWFT:9   WBICB   3                                           CSW218
     C           WBICB     IFEQ *BLANKS                                                       CSW218
     C                     MOVEL'XXX'     WBICB                                               CSW218
     C                     ENDIF                                                              CSW218
      *                                                                                       CSW218
     C           KBICD     CHAINMEBICDL2             89                                       CSW218
     C           *IN89     IFEQ '0'                                                           CSW218
     C           1         SUBSTBDXINF:19 WSID19  1                                           CSW218
     C                     ENDIF                                                              CSW218
     C                     ENDIF                                                              CSW218
      *                                                                                       CSW218
      ** BIC address indicates not connected if the                                           CSW218
      ** Extra Information field position 19 is set to 'N'                                    CSW218
      *                                                                                       CSW218
     C           WSID19    IFEQ 'N'                                                           CSW218
     C                     MOVE *BLANKS   DSWFT                                               CSW218
     C                     ELSE                                                               CSW218
     C                     MOVELZSWFT     DSWFT                                               CSW218
     C                     ENDIF                                                              CSW218
     C                     ENDIF                                                              CSW218
      *                                                                   078455
      ** for an external system......                                     078455
     C                     ELSE                                           078455
     C                     MOVE *BLANKS   DNAME                           078455
     C                     MOVE *BLANKS   DTELX                           078455
     C                     MOVE *BLANKS   DSTTX                           078455
     C                     END                                            078455
      *
      **  Write common headings
     C           MBIN      IFEQ 'Y'                                       E38493
     C           RCBR      IFEQ *BLANKS
     C                     MOVEL@RCD1     RCD
     C                     ELSE
     C                     MOVE RCD1      RCD
     C                     END
     C                     ELSE                                           E38493
     C                     MOVE *BLANKS   RCD1                            E38493
     C                     MOVE *BLANKS   @RCD1                           E38493
     C                     END                                            E38493
      *
     C                     WRITEME0600F2
     C                     ADD  1         RRN
      *
     C           MTPY      CHAINSDMTPYL0             96
     C           *IN96     IFEQ '1'                                   1
     C                     MOVELTXT,15    @TYP
     C                     ELSE                                      X1
     C                     MOVELEEMTPD    @TYP
     C                     END                                       E1
      *
     C                     MOVE *BLANKS   @PDE
     C           MPDE      IFNE *BLANKS                               1
     C                     MOVELTXT,14    @PDE
     C                     END                                       E1
      *
     C                     MOVE RCD2      RCD
     C                     WRITEME0600F2
     C                     ADD  1         RRN
      *
     C           MM        LOKUPTABMM     TABMON         50
     C                     MOVE YY        @YY
     C                     MOVE TABMON    @MM
     C                     MOVE DD        @DD
     C                     MOVE @DMY      @MGDE
      *
     C                     MOVE RCD3      RCD
     C/COPY WNCPYSRC,ME0600C045
     C                     WRITEME0600F2
     C                     ADD  1         RRN
      *
     C           NWRK      IFNE 'PAPER'
     C                     MOVELZNAME     @NAME
     C                     MOVELZTOWN     @TOWN
     C                     ELSE
     C                     MOVEL*BLANKS   @NAME
     C                     MOVEL*BLANKS   @TOWN
     C                     END
      *
     C                     MOVE RCD4      RCD
     C                     WRITEME0600F2
     C                     ADD  1         RRN
      *
     C           MGST      LOKUPTABCD     TABNAR         51
     C           *IN51     IFEQ '1'                                   1
     C                     MOVELTABNAR    @DSC
     C                     ELSE                                      X1
      *                                                                   S01408
     C/COPY WNCPYSRC,ME0600CP12                                           S01408
      *                                                                   S01408
     C                     MOVEL*BLANKS   @DSC
     C                     MOVELMGST      @DSC
     C                     END                                       E1
      *                                                                   S01408
     C/COPY WNCPYSRC,ME0600CP13                                           S01408
      *                                                                   S01408
     C                     MOVE LATM      WRKLAT
     C                     MOVE @WKHH     @@HH
     C                     MOVE @WKMM     @@MM
     C                     MOVE @WKSS     @@SS
      *
     C                     MOVE RCD5      RCD
     C                     WRITEME0600F2
     C                     ADD  1         RRN
      *
      **  Write MIDAS generated single message headings
     C           SYTM      IFEQ *BLANKS                               1
     C           TRNM      ANDEQ*BLANKS
      *
      **  If not statement message output MIDAS details
     C           MTPY      IFNE '950'
     C           MTPY      ANDNE'940'                                 2
      *
      **  If message input via ME, display appropriate heading
     C           MODI      IFEQ 'ME'                                  3
     C           MODI      OREQ 'MX'                                      E29588
     C                     MOVE MODI      MEMOD                           E29588
     C                     MOVELRCDME     RCD
     C                     ELSE                                      X3
      *
      **  ...else message generated from MIDAS transaction, so display
      **  transaction details
     C                     MOVELRCD6      RCD
     C                     END                                       E3
     C                     ELSE                                      X2
      *
      **  ...else statement message, so output SWIFT a/c
     C                     MOVELMODI      @MODI
     C                     MOVELRCD7      RCD
     C                     END                                       E2
     C                     WRITEME0600F2
     C                     ADD  1         RRN
     C                     END                                       E1
      *
      **  Write external system message headings
     C           SYTM      IFNE *BLANKS                               1
     C                     MOVELRCD8      RCD
     C                     WRITEME0600F2
     C                     ADD  1         RRN
     C                     END                                       E1
      *
      **  Write SWIFT headings
     C           NWRK      IFEQ 'SWIFT'                               1
     C*                                                                   S01408
     C/COPY WNCPYSRC,ME0600CP10                                           S01408
     C*                                                                   S01408
     C           MPRY      IFEQ 'N'                                   2
     C                     MOVE 'NORMAL'  @MPRY
     C                     ELSE                                      X2
     C                     MOVE 'URGENT'  @MPRY
     C                     END                                       E2
      *
     C                     MOVE 'N'       @DEL
     C                     MOVE 'N'       @NDL
      *
     C           DELC      IFEQ '1'                                   2
     C                     MOVE 'Y'       @NDL
     C                     END                                       E2
     C           DELC      IFEQ '2'                                   2
     C                     MOVE 'Y'       @DEL
     C                     END                                       E2
     C           DELC      IFEQ '3'                                   2
     C                     MOVE 'Y'       @DEL
     C                     MOVE 'Y'       @NDL
     C                     END                                       E2
      *
      ** If ELIN does not contain numeric data it probably contains       E29588
      ** rubbish. output '---' instead                                    E29588
     C           ELIN      IFNE *BLANKS                               2   E29588
     C                     TESTN          ELIN       75                   E29588
     C           *IN75     IFEQ '0'                                   3   E29588
     C                     MOVE '---'     ELIN                            E29588
     C                     END                                       E3   E29588
     C                     END                                       E2   E29588
      *                                                                   E29588
     C                     MOVE *BLANKS   RCD
     C           MSE1      IFEQ *BLANK
     C           ELIN      ANDEQ*BLANK
     C                     MOVEL@RCD9     RCD
     C                     ELSE
     C                     MOVELRCD9      RCD
     C                     END
      *
     C                     WRITEME0600F2
     C                     ADD  1         RRN
     C                     END                                       E1
      *
      **  If unreleased telex message, output whether testkey is
      **  required
     C           NWRK      IFEQ 'TELEX'
     C***********@MGSG     ANDEQ'1'                                   1   067471
     C           @MGSG     IFEQ '1'                                   x   067471
     C                     MOVE *BLANKS   TSKSN
     C           @TSKS     IFEQ 'Y'                                   2
     C                     MOVEL'Yes'     TSKSN
     C                     ELSE
     C                     MOVEL'No'      TSKSN
     C                     END
     C                     MOVE RCD10     RCD
     C                     WRITEME0600F2                             E2
     C                     ADD  1         RRN
     C                     ELSE                                      Xx   067471
     C           TSKY      IFNE *BLANKS                               y   067471
     C                     MOVELTSKY      @TKY                            067471
     C                     MOVELRCDTK     RCD                             067471
     C                     WRITEME0600F2                                  067471
     C                     ADD  1         RRN                             067471
     C                     ENDIF                                     Ey   067471
     C                     ENDIF                                     Ex   067471
     C                     END                                       E1
      *
      **  Write single message confirmation matching headings
     C           BGCFMT    IFEQ 'Y'                                   1
     C           TRNM      ANDEQ*BLANKS
     C/COPY WNCPYSRC,ME0600C001
      *
     C                     CALL 'ZM0100'
     C                     PARM TRNO      ZTRN   16
     C                     PARM           ZSCPMS  20
     C                     PARM           ZSBKMS  20
     C                     PARM           ZSERR   1
     C/COPY WNCPYSRC,ME0600C002
      *
     C           ZSERR     IFEQ *BLANKS                               2
      *
      **  Obtain narrative for CF match status - if status not found
      **  output code only
     C           ZSCPMS    LOKUPTAB1      TAB2           65
     C           *IN65     IFEQ '1'
     C                     MOVELTAB2      CPYNAR
     C                     ELSE
     C                     MOVE *BLANKS   CPYNAR
     C                     MOVELZSCPMS    CPYNAR
     C                     END
     C           ZSBKMS    LOKUPTAB1      TAB2           65
     C           *IN65     IFEQ '1'
     C                     MOVELTAB2      BRKNAR
     C                     ELSE
     C                     MOVE *BLANKS   BRKNAR
     C                     MOVELZSBKMS    BRKNAR
     C                     END
      *
     C                     MOVE RCD11     RCD
     C                     WRITEME0600F2
     C                     ADD  1         RRN
     C                     END                                      E2
     C                     END                                      E1
     C/COPY WNCPYSRC,ME0600C046
      *
      **  Write detail headings
     C                     MOVE TXT,13    RCD
     C                     ADD  1         RRN
     C                     WRITEME0600F2
     C                     ADD  1         RRN
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   TEXT - write message text                                   *
      *   Called by main process                                      *
      *             - DELT delete message                             *
      *               AMND amend message                              *
      *               RELS release message                            *
      *   Calls - FORM format subfield                                *
      *****************************************************************
      *
     C           TEXT      BEGSR
      *
     C                     MOVE *BLANKS   RCD
      *
     C                     MOVE *BLANKS   EFSCFD
     C                     MOVE *BLANKS   EFTAGF
     C           MTAG      IFNE *BLANKS                               1
     C                     MOVE MTAG      @MTAG
      *
      **  If first line of multiple message part
     C           TRNF      IFNE *BLANKS                               2
     C           TRNM      ORNE *BLANKS
      *
      **  Field :20: (203) or :21: (210) marks the beginning of an
      **  an individual transaction in a multiple, so access message
      **  reference for transaction details
      **  Idem for field :23: in MT580.                                                       174844
     C           MTPY      IFEQ '203'                                 3
     C           MTAG      ANDEQ':20:'
     C           MTPY      OREQ '210'
     C           MTAG      ANDEQ':21:'
     C           MTPY      OREQ '580'                                                         174844
     C           MTAG      ANDEQ':23:'                                                        174844
     C/COPY WNCPYSRC,ME0600C025
      *
      **  Access message reference file using transaction reference
      **  of next part (210) or contents of :20: (203)
     C           MTPY      IFEQ '210'
     C/COPY WNCPYSRC,ME0600C026
     C                     MOVELTRNM      @WK16  16
     C                     ELSE
     C/COPY WNCPYSRC,ME0600C078
     C                     MOVELMFLD      @WK16  16
     C/COPY WNCPYSRC,ME0600C079
     C                     END
     C/COPY WNCPYSRC,ME0600C027
      *                                                                                       174844
      ** For MT580, reaccess  GOREFPD with TRNO as first part of                              174844
      ** message is about to be processed (PHS=FIRST).                                        174844
     C           MTPY      IFEQ '580'                                                         174844
     C           PHS       IFEQ 'FIRST'                                                       174844
     C                     MOVELTRNO      @WK16  16                                           174844
     C                     MOVEL*BLANKS   PHS                                                 174844
     C                     MOVEL'NEXT'    PHS                                                 174844
      *                                                                                       174844
     C                     ELSE                                                               174844
      ** For next parts, TRNM must be used.                                                   174844
     C                     MOVELTRNM      @WK16  16                                           174844
     C                     ENDIF                                                              174844
     C                     ENDIF                                                              174844
      *                                                                                       174844
     C           @WK16     CHAINMGOREFL0             10
      *
     C           *IN10     IFEQ '1'                                   4
     C           *LOCK     IN   LDA
     C                     Z-ADD6         DBASE
     C                     MOVEL@WK16     DBKEY            * DB ERROR 06 *
     C                     MOVEL'MGOREFPD'DBFILE
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END                                       E4
     C/COPY WNCPYSRC,ME0600C028
      *
     C                     MOVE *BLANKS   @BLK
     C           BGCFMT    IFEQ 'Y'                                   4
     C/COPY WNCPYSRC,ME0600C003
     C                     CALL 'ZM0100'
     C                     PARM TRNO      ZTRN   16
     C                     PARM           ZSCPMS  20
     C                     PARM           ZSBKMS  20
     C                     PARM           ZSERR   1
     C/COPY WNCPYSRC,ME0600C004
      *
     C           ZSERR     IFEQ *BLANKS                               5
     C                     MOVELTXT,17    @CPY
     C                     MOVE ZSCPMS    @CFCPY
     C                     MOVELTXT,18    @BRK
     C                     MOVE ZSBKMS    @CFBRK
     C                     END                                       E5
     C/COPY WNCPYSRC,ME0600C029
     C                     END                                       E4
      *
      **  Write multiple message part headings
     C                     MOVE *BLANKS   @DLT
     C           PTST      IFNE *BLANKS                               4
     C                     MOVELTXT,16    @DLT
     C                     END                                       E4
      *
      **  For MT210, output TRN, instead of Midas transaction number      087654
     C           MTPY      IFEQ '210'                                     087654
     C                     MOVELTRNO      @MTRN                           087654
     C                     ELSE                                           087654
     C                     MOVE MTRN      @MTRN
     C                     END                                            087654
     C                     MOVE TNTP      @TNTP
     C                     MOVE SBTP      @SBTP
     C                     MOVE MODI      @MODL
      *
     C                     MOVE RCD12     RCD
     C                     ADD  1         RRN
     C                     WRITEME0600F2
     C                     ADD  1         RRN
     C                     END                                       E3
     C/COPY WNCPYSRC,ME0600C030
     C                     END                                       E2
      *
      **  Access field tag file using message tag & type then just tag
     C                     MOVELMTAG      MTAGK
     C                     MOVELMTPY      MTPYK
     C*                                                                   CSW098
     C** If SWIFT 1998 changes is installed, consider message sequence    CSW098
     C** as well                                                          CSW098
     C*                                                                   CSW098
     C           CSW098    IFEQ 'CSW098 '                                 CSW098
     C           MSEQ      ANDNE*BLANKS                                   CSW098
     C*  Search 1: type specific, sequence specific                       CSW098
     C                     MOVELMSEQ      MSEQN                           CSW098
     C           KMTAG     CHAINSDMTAGL0             98                   CSW098
     C*  Search 2: type specific, sequence generic (blank)                CSW098
     C           *IN98     IFEQ '1'                                       CSW098
     C                     MOVEL*BLANKS   MSEQN                           CSW098
     C           KMTAG     CHAINSDMTAGL0             98                   CSW098
     C                     ENDIF                                          CSW098
     C*  Search 3: type generic ('ALL'), sequence specific                CSW098
     C           *IN98     IFEQ '1'                                       CSW098
     C                     MOVEL'ALL'     MTPYK                           CSW098
     C                     MOVELMSEQ      MSEQN                           CSW098
     C           KMTAG     CHAINSDMTAGL0             98                   CSW098
     C                     ENDIF                                          CSW098
     C*  Search 4: type generic ('ALL'), sequence generic (blank)         CSW098
     C           *IN98     IFEQ '1'                                       CSW098
     C                     MOVEL*BLANKS   MSEQN                           CSW098
     C           KMTAG     CHAINSDMTAGL0             98                   CSW098
     C                     ENDIF                                          CSW098
     C*                                                                   CSW098
     C                     ELSE                                           CSW098
     C*                                                                   CSW098
     C           MGTAGK    CHAINSDMTAGL0             98
     C           *IN98     IFEQ '1'                                   2
     C           MTAGK     CHAINSDMTAGL0             98
     C                     ENDIF                                          CSW098
     C*                                                                   CSW098
     C                     ENDIF                                          CSW098
      *
     C           *IN98     IFEQ '1'                                   3
     C                     MOVELTXT,19    EFSCFD
     C                     END                                       E3
     C***********          END                                       E2   CSW098
     C** MT512 - Deliverer of Securities.                                 121288
     C           *IN98     IFEQ '0'                                       121288
     C           MTPY      ANDEQ'512'                                     121288
     C           MTAG#     ANDEQ'87'                                      121288
     C           FLD87     IFEQ 'Y'                                       121288
     C                     MOVELTXT,28    EFSCFD                          121288
     C                     ELSE                                           121288
     C                     MOVE 'Y'       FLD87                           121288
     C                     END                                            121288
     C                     END                                            121288
     C**                                                                  121288
     C                     END                                       E1
      *
      **  If verification field on unverified, unreleased message
     C/COPY WNCPYSRC,ME0600C031
     C                     MOVELMTPY      VERFYK  6
     C                     MOVE @WK3      VERFYK
     C/COPY WNCPYSRC,ME0600C032
     C           VERFYK    LOKUPVERFY                    52
      *
     C/COPY WNCPYSRC,ME0600C056
     C           ENVPM     IFEQ 'Y'                                   1
     C/COPY WNCPYSRC,ME0600C059
     C           @MGSG     ANDEQ'1'
     C           *IN52     ANDEQ'1'
     C                     MOVELTXT,20    MFLD
      *
      **  Call appropriate formatting subroutine
     C                     ELSE                                      X1
     C           EFTAGF    IFNE *BLANKS                               2
     C                     EXSR FORM
      *
      **  If SWIFT address obtain name/town
     C                     ELSE                                      X2
     C           @WK1      IFEQ '5'                                   3
     C           @WL1      ANDEQ'A'
     C********** @WM1      ANDNE'/'                                       183583
     C           @WM1      ANDNE'/'                                                           210868
     C           @MTAG     OREQ ':50F:'                                                     BUG14915
     C           @WK1      OREQ '8'                                   3   CSW097
     C           @WL1      ANDEQ'A'                                       CSW097
     C           @WK1      OREQ '9'                                       CSW098
     C           @WL1      ANDEQ'P'                                       CSW098
      *                                                                                       204225
     C                     MOVE @WK3      WWK2    1                                           204225
     C                     MOVE '1'       *IN05                                               204225
     C           @WK1      IFEQ '5'                                   3                       204225
     C           WWK2      ANDEQ'0'                                                           204225
     C           @WL1      ANDEQ'A'                                                           204225
     C********** @WK1      OREQ '5'                                                  CSW207 BUG14915
     C********** WWK2      ANDEQ'0'                                                  CSW207 BUG14915
     C********** @WL1      ANDEQ'F'                                                  CSW207 BUG14915
     C                     MOVELMFLD      WBEI   11                                           204225
     C           WBEI      CHAINSDCUSTBE             05                                       204225
     C                     MOVE *BLANKS   ZCUST                                               204225
     C                     ENDIF                                                              204225
      *                                                                   S01435
      *  Format as SWIFT device print remove SWADDR processing            S01435
      *                                                                   S01435
     C           *IN05     IFEQ '1'                                                           204225
     C                     EXSR SEXTNR                                    183583
     C                     ENDIF                                                              204225
     C*************        MOVELMFLD      ZADDR                           S01435
     C*************        EXSR SWADDR                                    S01435
     C*************        MOVELMFLD      @WK50  50                       S01435
     C*************        MOVE ZNAME     @WK50                           S01435
     C*************        MOVELZTOWN     @WK10  10                 042081S01435
     C*************        MOVE @WK10     @WK50                     042081S10435
     C*************        MOVEL@WK50     MFLD                            S01435
      *                                                                   S01435
      *  Information now displayed on lines after BIC as per SWIFT        S01435
      *  Standard                                                         S01435
      *                                                                   S01435
      *  Write screen line                                                S01435
      *                                                                   S01435
     C                     MOVE RCD13     RCD                             S01435
     C                     WRITEME0600F2                                  S01435
     C                     ADD  1         RRN                             S01435
      *                                                                   S01435
      *  Call Access object to validate identifier                        S01435
      *                                                                   S01435
     C           @WL1      IFEQ 'P'                                       CSW098
     C           8         SUBSTMFLD:8    W9BICC                          CSW098
     C           3         SUBSTMFLD:16   W9BICB                          CSW098
     C                     ELSE                                           CSW098
     C                     MOVELMFLD      W9BICC                          S01435
     C           3         SUBSTMFLD:9    W9BICB                          S01435
     C                     ENDIF                                          CSW098
      *                                                                   S01435
     C           @WK1      IFEQ '5'                                       183583
     C           @WL1      ANDEQ'A'                                       183583
     C********** @MTAG     OREQ ':50F:'                                              BUG14915 263130
     C           @WK1      OREQ '8'                                       183583
     C           @WL1      ANDEQ'A'                                       183583
     C           ZCUST     IFNE *BLANKS                                   158656
     C                     MOVE *BLANKS   W9BICC                          183583
     C                     MOVELZCUST     W9BICC                          183583
     C                     ENDIF                                          158656
     C                     ENDIF                                          183583
      *                                                                   183583
     C                     CALL 'ME1400'                                  S01435
     C                     PARM *BLANKS   W9RTN   7                       S01435
     C                     PARM           W9BICC  8                       S01435
     C                     PARM           W9BICB  3                       S01435
     C                     PARM           SDCUST                          S01435
     C                     PARM           SDCNST                          S01435
     C                     PARM           MEBICD                          S01435
     C                     PARM *BLANKS   W9CUST  1                       S01435
     C                     PARM *BLANKS   W9CNST  1                       S01435
     C                     PARM *BLANKS   W9BICD  1                       S01435
      *                                                                   S01435
     C                     MOVEL*BLANKS   RCD13                           S01435
      *                                                                   S01435
     C                     SELEC                                          S01435
      *                                                                   S01435
      *  Record not found - S.W.I.F.T does not exist                      S01435
      *                                                                   S01435
     C           W9RTN     WHEQ 'Y2U0005'                                 S01435
      * No action                                                         S01435
      *                                                                   S01435
     C                     GOTO EXTEXT                                    S01435
      *                                                                   S01435
      *  Use data depending on file that the data exists on               S01435
      *                                                                   S01435
     C           W9BICD    WHEQ 'Y'                                       S01435
      *                                                                   S01435
      * Format First Line for screen                                      S01435
      *                                                                   S01435
     C                     MOVEL*BLANKS   BICLAY                          S01435
     C                     MOVELBDINS1    #SCR1                           S01435
      *                                                                   S01435
      *  Check fields not concatenated                                    S01435
      *                                                                   S01435
     C           1         SUBSTBDINS2:1  ##001   1                       S01435
     C           ##001     IFNE *BLANKS                                   S01435
     C                     MOVELBDINS2    #SCR2                           S01435
     C                     ELSE                                           S01435
     C           15        SUBSTBDINS2:2  #SCR2                           S01435
     C                     END                                            S01435
     C                     MOVELBICLAY    RCD13                           S01435
      *                                                                   S01435
      *  Write screen line                                                S01435
      *                                                                   S01435
     C                     MOVE *LOVAL    @#                              S01435
     C                     BITON'123467'  @#                              S01435
     C                     MOVE RCD13     RCD                             S01435
     C                     WRITEME0600F2                                  S01435
     C                     ADD  1         RRN                             S01435
      *                                                                   S01435
     C                     MOVEL*BLANKS   RCD13                           S01435
      *                                                                   S01435
      * Format Second Line for screen                                     S01435
      *                                                                   S01435
     C                     MOVEL*BLANKS   BICLAY                          S01435
     C                     MOVELBDCITY    #SCR1                           S01435
     C                     MOVELBICLAY    RCD13                           S01435
      *                                                                   S01435
      *  Write screen line                                                S01435
      *                                                                   S01435
     C                     MOVE *LOVAL    @#                              S01435
     C                     BITON'123467'  @#                              S01435
     C                     MOVE RCD13     RCD                             S01435
     C                     WRITEME0600F2                                  S01435
     C                     ADD  1         RRN                             S01435
      *                                                                   S01435
     C                     MOVEL*BLANKS   RCD13                           S01435
      *                                                                   S01435
      * Format Third Line for screen                                      S01435
      *                                                                   S01435
     C                     MOVEL*BLANKS   BICLAY                          S01435
     C           BDBRC1    IFNE *BLANKS                                   S01435
     C                     MOVELBDBRC1    #SCR1                           S01435
     C                     MOVELBICLAY    RCD13                           S01435
      *                                                                   S01435
      *  Write screen line                                                S01435
      *                                                                   S01435
     C                     MOVE *LOVAL    @#                              S01435
     C                     BITON'123467'  @#                              S01435
     C                     MOVE RCD13     RCD                             S01435
     C                     WRITEME0600F2                                  S01435
     C                     ADD  1         RRN                             S01435
      *                                                                   S01435
     C                     MOVEL*BLANKS   RCD13                           S01435
     C                     END                                            S01435
      *                                                                   S01435
     C                     GOTO EXTEXT                                    S01435
      *                                                                   S01435
     C           W9CUST    WHEQ 'Y'                                       S01435
      *                                                                   S01435
      * Format Customer Name and Town                                     S01435
      *                                                                   S01435
     C                     MOVEL*BLANKS   BICLAY                          S01435
     C           BBCRNM    IFNE *BLANKS                                   S01435
     C                     MOVELBBCRNM    #SCR1                           S01435
     C                     MOVELBICLAY    RCD13                           S01435
      *                                                                   S01435
      *  Write screen line                                                S01435
      *                                                                   S01435
     C                     MOVE *LOVAL    @#                              S01435
     C                     BITON'123467'  @#                              S01435
     C                     MOVE RCD13     RCD                             S01435
     C                     WRITEME0600F2                                  S01435
     C                     ADD  1         RRN                             S01435
      *                                                                   S01435
     C                     MOVEL*BLANKS   RCD13                           S01435
     C                     END                                            S01435
     C                     MOVEL*BLANKS   BICLAY                          S01435
     C           BBCRTN    IFNE *BLANKS                                   S01435
     C                     MOVELBBCRTN    #SCR1                           S01435
     C                     MOVELBICLAY    RCD13                           S01435
      *                                                                   S01435
      *  Write screen line                                                S01435
      *                                                                   S01435
     C                     MOVE *LOVAL    @#                              S01435
     C                     BITON'123467'  @#                              S01435
     C                     MOVE RCD13     RCD                             S01435
     C                     WRITEME0600F2                                  S01435
     C                     ADD  1         RRN                             S01435
      *                                                                   S01435
     C                     MOVEL*BLANKS   RCD13                           S01435
     C                     END                                            S01435
      *                                                                   S01435
     C                     GOTO EXTEXT                                    S01435
      *                                                                   S01435
     C           W9CNST    WHEQ 'Y'                                       S01435
      *                                                                   S01435
      * Format Counterparty Name and Town                                 S01435
      *                                                                   S01435
     C                     MOVEL*BLANKS   BICLAY                          S01435
     C           AWCPNM    IFNE *BLANKS                                   S01435
     C                     MOVELAWCPNM    #SCR1                           S01435
     C                     MOVELBICLAY    RCD13                           S01435
      *                                                                   S01435
      *  Write screen line                                                S01435
      *                                                                   S01435
     C                     MOVE *LOVAL    @#                              S01435
     C                     BITON'123467'  @#                              S01435
     C                     MOVE RCD13     RCD                             S01435
     C                     WRITEME0600F2                                  S01435
     C                     ADD  1         RRN                             S01435
      *                                                                   S01435
     C                     MOVEL*BLANKS   RCD13                           S01435
     C                     END                                            S01435
     C                     MOVEL*BLANKS   BICLAY                          S01435
     C           BBCRNM    IFNE *BLANKS                                   S01435
     C                     MOVELAWCNTN    #SCR1                           S01435
     C                     MOVELBICLAY    RCD13                           S01435
      *                                                                   S01435
      *  Write screen line                                                S01435
      *                                                                   S01435
     C                     MOVE *LOVAL    @#                              S01435
     C                     BITON'123467'  @#                              S01435
     C                     MOVE RCD13     RCD                             S01435
     C                     WRITEME0600F2                                  S01435
     C                     ADD  1         RRN                             S01435
      *                                                                   S01435
     C                     MOVEL*BLANKS   RCD13                           S01435
     C                     END                                            S01435
      *                                                                   S01435
     C                     GOTO EXTEXT                                    S01435
      *                                                                   S01435
     C                     ENDSL                                          S01435
     C                     END                                      E3
     C                     END                                      E2
     C                     END                                      E1
      *                                                                   140629
      ** If /OCMT/ or /CHGS/ then change comma in amount to decimal       140629
      ** point.                                                           140629
      *                                                                   140629
     C           '/OCMT/'  SCAN MFLD:1                   81               140629
      *                                                                   140629
     C           *IN81     IFEQ *OFF                                      140629
     C           '/CHGS/'  SCAN MFLD:1                   81               140629
     C                     ENDIF                                          140629
      *                                                                   140629
     C           *IN81     IFEQ *ON                                       140629
      *                                                                   140629
      ** If ',' in amount change to '.'                                   140629
      *                                                                   140629
     C           ',':'.'   XLATEMFLD      MFLD                            140629
     C                     ENDIF                                          140629
      *                                                                   140629
      *
     C           RCD13     IFNE *BLANKS                                                     MD020899
     C                     MOVE RCD13     RCD
     C                     WRITEME0600F2
     C                     ADD  1         RRN
     C                     ENDIF                                                            MD020899
      *
     C           EXTEXT    TAG                                            S01435
     C                     MOVE *LOVAL    @#                              S01435
     C                     BITON'123467'  @#                              S01435
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   DELT - delete message                                       *
      *   Called by - main process                                    *
      *   Calls - HDNG write message headings                         *
      *           TEXT write message text                             *
      *****************************************************************
      *
     C           DELT      BEGSR
      *
      **  Re access message reference file
     C           @TRNO     CHAINMGOREFD0             10
      *
      **  If message status has changed..
     C           MGSG      IFNE '1'                                   1
     C                     MOVEL'MEM1060' @MSGID
     C                     CALL 'ZM1001'  PLIST3
     C                     SETON                     3540
      *
      **  ..or TRN entered is not TRN of message or part of multiple
     C                     ELSE                                      X1
     C*                                                                   087653
     C           MTPY      IFNE '203'                                     087653
     C           STRN      ORNE *BLANKS                                   087653
     C*                                                                   087653
     C           STRN      IFNE @TRNO                                 2
     C           STRN      CHAINMGOREFD0             10
      *
     C           *IN10     IFEQ '1'                                   3
     C           TRNF      ORNE @TRNO
     C           PTST      OREQ 'D'
     C                     MOVEL'MEM1061' @MSGID
     C                     CALL 'ZM1001'  PLIST3
     C                     SETON                     3540
     C                     END                                       E3
     C                     END                                       E2
     C                     END                                            087653
     C                     END                                       E1
     C*                                                                   087653
     C           MTPY      IFEQ '203'                                     087653
     C           STRN      ANDEQ*BLANKS                                   087653
     C                     MOVE @TRNO     STRN                            087653
     C                     MOVE 'M'       PERR    1                       087653
     C                     ELSE                                           087653
     C                     MOVE *BLANKS   PERR                            087653
     C                     END                                            087653
      *
      **  If no errors cancel message or part of multiple
     C***********          MOVELSTRN      PMOD                            093005
     C                     MOVE MODI      PMOD                            093005
     C           *IN35     IFEQ '0'                                   1
     C/COPY WNCPYSRC,ME0600C033
      *                                                                                       CSW201
      ** If Swift 2001 is installed and message type is '362', get                            CSW201
      ** the message to be cancelled' First transaction no. in MT362                          CSW201
      ** field found in MGHISTPD.                                                             CSW201
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C           MTPY      ANDEQ'362'                                                         CSW201
     C                     MOVELTRNO      WHREF                                               CSW201
     C                     MOVE MTPY      HSMTPY                                              CSW201
     C           KHIST     CHAINMGHISTL3             10                                       CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     CALL 'MG9205'               15
     C                     PARM STRN      PTRN   16
     C                     PARM           PMOD    2
     C***********          PARM *BLANKS   PERR    1                       087653
     C                     PARM           PERR                            087653
     C/COPY WNCPYSRC,ME0600C034
     C                     END                                       E1
      *
      ** If MG9205 not found , set up LDA and return to calling program
      *
     C           *IN15     IFEQ '1'                                   3
     C           *LOCK     IN   LDA
     C                     MOVE '008'     DBASE
     C                     MOVEL'MG9205 E'KEY16
     C                     MOVE 'RROR    'KEY16  16        * * * * * * * *
     C                     MOVELKEY16     DBKEY            *  DBERR 008  *
     C                     MOVEL*BLANKS   DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END                                       E3
      *
      ** If database error in MG9205 return control to calling program
      *
     C           PERR      IFNE *BLANKS                               3
     C           *LOCK     IN   LDA
     C                     EXSR *PSSR
     C                     OUT  LDA
     C                     END                                       E3
      *                                                                   115412
      *                                                                                       CSW201
      ** Delete all record in MGOREFPD that has the same first                                CSW201
      ** transaction number as the transaction being deleted if CSW201                        CSW201
      ** is installed and message type is '362'                                               CSW201
      *                                                                                       CSW201
     C           *IN35     IFEQ '0'                                                           CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C           MTPY      ANDEQ'362'                                                         CSW201
     C                     MOVE HSFTRN    KFTRN  16                                           CSW201
      *                                                                                       CSW201
     C           KFTRN     SETLLMGHISTL4                                                      CSW201
     C           KFTRN     READEMGHISTL4                 10                                   CSW201
      *                                                                                       CSW201
     C           *IN10     DOWEQ*OFF                                                          CSW201
     C           KFTRN     ANDNE*BLANKS                                                       CSW201
      *                                                                                       CSW201
     C                     MOVELWHREF     WTRNO  16                                           CSW201
      *                                                                                       CSW201
     C           TRNO      IFNE WTRNO                                                         CSW201
     C           WTRNO     CHAINMGOREFD0             11                                       CSW201
     C           *IN11     IFEQ *OFF                                                          CSW201
     C                     CALL 'MG9205'               15                                     CSW201
     C                     PARM TRNO      PTRN                                                CSW201
     C                     PARM           PMOD                                                CSW201
     C                     PARM           PERR                                                CSW201
      *                                                                                       CSW201
      ** If MG9205 not found , set up LDA and return to calling program                       CSW201
      *                                                                                       CSW201
     C           *IN15     IFEQ '1'                                                           CSW201
     C           PERR      ORNE *BLANKS                                                       CSW201
     C           *LOCK     IN   LDA                                                           CSW201
     C                     Z-ADD12        DBASE                                               CSW201
     C                     MOVELTRNO      DBKEY                                               CSW201
     C                     MOVEL'MG9205'  DBPGM                                               CSW201
     C                     OUT  LDA                                                           CSW201
     C                     EXSR *PSSR                                                         CSW201
     C                     ENDIF                                                              CSW201
     C                     ENDIF                                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C           KFTRN     READEMGHISTL4                 10                                   CSW201
     C                     ENDDO                                                              CSW201
      *                                                                                       CSW201
     C                     ENDIF                                                              CSW201
     C                     ENDIF                                                              CSW201
      ** Only call MG5910 if message type is MT5xx                        115412
      *                                                                   115412
     C/COPY WNCPYSRC,ME0600C085
     C           MTPY      IFEQ '580'                                     115412
     C           MTPY      OREQ '554'                                     115412
     C           MTPY      OREQ '523'                                     115412
     C           MTPY      OREQ '522'                                     115412
     C           MTPY      OREQ '521'                                     115412
     C           MTPY      OREQ '520'                                     115412
     C           MTPY      OREQ '512'                                     115412
     C           MTPY      OREQ '510'                                     115412
     C           MTPY      OREQ '515'                                     CSW098
     C           MTPY      OREQ '518'                                     CSW098
      *                                                                   087779
      ** If SE msg and deleted successfully, call MG5910.                 087779
      *                                                                   087779
     C           *IN15     IFEQ '0'                                       087779
     C           PERR      ANDEQ*BLANKS                                   087779
     C           PMOD      ANDEQ'SE'                                      087779
      *                                                                   087779
      ** Initialise PRM1                                                  087779
      *                                                                   087779
     C                     MOVE *BLANKS   PRM1   15                       087779
     C                     MOVELMTRN      PRM1                            087779
     C                     MOVE TNTP      PRM1                            087779
      *                                                                   087779
      ** Initialise PRM2                                                  087779
      *                                                                   087779
     C           MTPY      IFEQ '580'                                     087779
     C           MTPY      OREQ '554'                                     087779
     C           MTPY      OREQ '523'                                     087779
     C           MTPY      OREQ '522'                                     087779
     C           MTPY      OREQ '521'                                     087779
     C           MTPY      OREQ '520'                                     087779
     C                     MOVE 'PR'      PRM2    2                       087779
     C                     ELSE                                           087779
     C                     MOVE 'CE'      PRM2                            087779
     C                     END                                            087779
      *                                                                   087779
     C                     CALL 'MG5910'               17                 087779
     C                     PARM 'SE'      PRM0    2                       087779
     C                     PARM           PRM1                            087779
     C                     PARM           PRM2                            087779
     C                     PARM 'C'       PRM3    1                       087779
     C                     PARM *BLANKS   PRM4    1                       087779
     C                     PARM *BLANKS   PRM5    1                       087779
     C                     PARM *BLANKS   PRM6    1                       087779
     C                     PARM CSW003    @MT5XX  1                       CSW003
      *                                                                   087779
     C           PRM6      IFEQ 'Y'                                       087779
     C           *LOCK     IN   LDA                                       087779
     C                     MOVE '010'     DBASE                           087779
     C                     MOVELPRM1      DBKEY            * DB ERROR 10 *087779
     C                     MOVEL'EXT FILE'DBFILE                          087779
     C                     OUT  LDA                                       087779
     C                     EXSR *PSSR                                     087779
     C                     END                                            087779
      *                                                                   087779
     C                     END                                            087779
      *                                                                   115412
     C                     END                                            115412
     C/COPY WNCPYSRC,ME0600C082
      *
      **  Clear subfile
     C                     SETOF                     2021
     C                     WRITEME0600F3
     C                     SETON                     202122
     C                     Z-ADD1         RRN     50
      *
      **  Re access message reference file
     C           @TRNO     CHAINMGOREFD0             10
     C                     MOVE MGSG      @MGSG   1
     C                     MOVE NWRK      @NWRK   6
     C                     MOVE TSKS      @TSKS   1
      *
      **  Write message headings
     C                     EXSR HDNG
      *
      **  Access message file using message reference
     C           @TRNO     CHAINMGOMSGPD             11
      **  Initialise variable for first part of MT580.                                        174844
     C                     MOVEL'FIRST'   PHS     5                                           174844
      *                                                                                       174844
      *
     C/COPY WNCPYSRC,ME0600C035
      **  Process messages records with message reference
      *                                                                                       206803
     C           MTPY      IFEQ '103'                                                         206803
     C           MTAG      ANDEQ':119:'                                                       206803
     C                     MOVE 'Y'       W#RSET                                              206803
     C                     ELSE                                                               206803
     C                     MOVE 'N'       W#RSET                                              206803
     C                     ENDIF                                                              206803
      *                                                                                       206803
     C                     Z-ADD1         @V                              183583
     C           *IN11     DOWEQ'0'                                   1
      *
      **  Write message text
     C                     EXSR TEXT
      *
      **  Access next message file record with message reference
     C           @TRNO     READEMGOMSGPD                 11
      *                                                                                       206803
     C           W#RSET    IFEQ 'Y'                                                           206803
     C                     Z-ADD1         @V                                                  206803
     C                     MOVE 'N'       W#RSET                                              206803
     C                     ELSE                                                               206803
     C                     ADD  1         @V                              183583
     C                     ENDIF                                                              206803
      *                                                                                       206803
     C                     END                                       E1
      *
     C                     ENDSR
     C/COPY WNCPYSRC,ME0600C062
     C/EJECT
      *****************************************************************
      *   AMND - amend message                                        *
      *   Called by - main process                                    *
      *   Calls - VALD validate amendment                             *
      *           HDNG write message headings                         *
      *           TEXT write message text                             *
      *****************************************************************
      *
     C           AMND      BEGSR
      *
      **  Re access message reference file
     C           @TRNO     CHAINMGOREFU0             10
     C/COPY WNCPYSRC,ME0600C075
      *
      **  If message status has changed..
     C           MGSG      IFNE '1'                                   1
     C                     MOVEL'MEM1062' @MSGID
     C                     CALL 'ZM1001'  PLIST3
     C                     SETON                     35
      *
      **  Validate amendment entered
     C                     ELSE                                      X1
     C                     EXSR VALD
     C                     END                                       E1
     C/COPY WNCPYSRC,ME0600C010
      *
      **  If no errors amend message
     C           *IN35     IFEQ '0'                                   1
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C           MTPY      ANDEQ'362'                                     115412              CSW201
     C                     MOVELTRNO      WHREF                                               CSW201
     C                     MOVE MTPY      HSMTPY                                              CSW201
     C           KHIST     CHAINMGHISTL3             10                                       CSW201
     C                     ENDIF                                                              CSW201
      *
     C           SNWK      IFNE *BLANKS                               2
     C                     MOVE SNWK      NWRK
     C                     END                                       E2
      *
     C           SPTY      IFNE *BLANKS                               2
     C                     MOVE SPTY      MPRY
     C                     END                                       E2
      *
     C                     MOVE 'NN'      @DN
     C           DELC      IFEQ '1'                                   2
     C                     MOVE 'NY'      @DN
     C                     END                                       E2
     C           DELC      IFEQ '2'                                   2
     C                     MOVE 'YN'      @DN
     C                     END                                       E2
     C           DELC      IFEQ '3'                                   2
     C                     MOVE 'YY'      @DN
     C                     END                                       E2
     C/COPY WNCPYSRC,ME0600C072
      *
     C           SDEL      IFNE *BLANKS                               2
     C                     MOVE SDEL      @D
     C                     END                                       E2
     C           SNDL      IFNE *BLANKS                               2
     C                     MOVE SNDL      @N
     C                     END                                       E2
      *
     C           @DN       IFEQ 'NN'                                  2
     C                     MOVE *BLANKS   DELC
     C                     END                                       E2
     C           @DN       IFEQ 'NY'                                  2
     C                     MOVE '1'       DELC
     C                     END                                       E2
     C           @DN       IFEQ 'YN'                                  2
     C                     MOVE '2'       DELC
     C                     END                                       E2
     C           @DN       IFEQ 'YY'                                  2
     C                     MOVE '3'       DELC
     C                     END                                       E2
     C/COPY WNCPYSRC,ME0600C073
      *                                                                   E29588
      **  Update last action date and time for this amendment             E29588
     C                     MOVE RUNA      LADT                            E29588
     C                     TIME           LATM                            E29588
      *
      **  Update status of PAPER message to PRTD to prevent amendment
     C           NWRK      IFEQ 'PAPER'                               2
     C                     MOVE '2'       MGSG
     C                     MOVE 'RRTD'    MGST
     C******************** MOVE RUNA      LADT                            E29588
     C******************** TIME           LATM                            E29588
     C                     MOVE RUNA      RELD
     C                     MOVE LATM      RELT
     C                     MOVE USRID     RUSR
     C                     MOVE WSID      RWSN
     C                     ELSE                                      X2   E29588
      *                                                                   E29588
      **  If not routed to paper, change status to AMENDED                E29588
     C/COPY WNCPYSRC,ME0600C047
     C                     MOVE 'AMND'    MGST                            E29588
     C/COPY WNCPYSRC,ME0600C048
     C                     END                                       E2
      *
     C                     UPDATMGOREFU0
      *
      **  Submit PAPER message print via RCF
     C           NWRK      IFEQ 'PAPER'                               2
     C                     CALL 'MEC0846R'
     C                     PARM           TRNO
     C                     PARM           BRCA
     C                     PARM           MBIN
     C                     END                                       E2
      *                                                                                       CSW201
      ** Amend all record in MGOREFPD that has the same first                                 CSW201
      ** transaction number as the transaction being deleted if CSW201                        CSW201
      ** is installed and message type is '362'                                               CSW201
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C           MTPY      ANDEQ'362'                                                         CSW201
     C                     MOVE HSFTRN    KFTRN  16                                           CSW201
      *                                                                                       CSW201
     C           KFTRN     SETLLMGHISTL4                                                      CSW201
     C           KFTRN     READEMGHISTL4                 10                                   CSW201
      *                                                                                       CSW201
     C           *IN10     DOWEQ*OFF                                                          CSW201
     C           KFTRN     ANDNE*BLANKS                                                       CSW201
      *                                                                                       CSW201
     C                     MOVELWHREF     WTRNO                                               CSW201
      *                                                                                       CSW201
     C           TRNO      IFNE WTRNO                                                         CSW201
     C           WTRNO     CHAINMGOREFU0             11                                       CSW201
     C           *IN11     IFEQ *OFF                                                          CSW201
      *                                                                                       CSW201
     C           SNWK      IFNE *BLANKS                                                       CSW201
     C                     MOVE SNWK      NWRK                                                CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C           SPTY      IFNE *BLANKS                                                       CSW201
     C                     MOVE SPTY      MPRY                                                CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     MOVE 'NN'      @DN                                                 CSW201
      *                                                                                       CSW201
     C                     SELEC                                                              CSW201
     C           DELC      WHEQ '1'                                                           CSW201
     C                     MOVE 'NY'      @DN                                                 CSW201
     C           DELC      WHEQ '2'                                                           CSW201
     C                     MOVE 'YN'      @DN                                                 CSW201
     C           DELC      WHEQ '3'                                                           CSW201
     C                     MOVE 'YY'      @DN                                                 CSW201
     C                     ENDSL                                                              CSW201
      *                                                                                       CSW201
     C           SDEL      IFNE *BLANKS                                                       CSW201
     C                     MOVE SDEL      @D                                                  CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C           SNDL      IFNE *BLANKS                                                       CSW201
     C                     MOVE SNDL      @N                                                  CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     SELEC                                                              CSW201
     C           @DN       WHEQ 'NN'                                                          CSW201
     C                     MOVE *BLANKS   DELC                                                CSW201
     C           @DN       WHEQ 'NY'                                                          CSW201
     C                     MOVE '1'       DELC                                                CSW201
     C           @DN       WHEQ 'YN'                                                          CSW201
     C                     MOVE '2'       DELC                                                CSW201
     C           @DN       WHEQ 'YY'                                                          CSW201
     C                     MOVE '3'       DELC                                                CSW201
     C                     ENDSL                                                              CSW201
      *                                                                                       CSW201
      **  Update last action date and time for this amendment                                 CSW201
      *                                                                                       CSW201
     C                     MOVE RUNA      LADT                                                CSW201
     C                     TIME           LATM                                                CSW201
      *                                                                                       CSW201
      **  Update status of PAPER message to PRTD to prevent amendment                         CSW201
      *                                                                                       CSW201
     C           NWRK      IFEQ 'PAPER'                                                       CSW201
     C                     MOVE '2'       MGSG                                                CSW201
     C                     MOVE 'RRTD'    MGST                                                CSW201
     C                     MOVE RUNA      RELD                                                CSW201
     C                     MOVE LATM      RELT                                                CSW201
     C                     MOVE USRID     RUSR                                                CSW201
     C                     MOVE WSID      RWSN                                                CSW201
     C                     ELSE                                                               CSW201
      *                                                                                       CSW201
      **  If not routed to paper, change status to AMENDED                                    CSW201
      *                                                                                       CSW201
     C                     MOVE 'AMND'    MGST                                                CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     UPDATMGOREFU0                                                      CSW201
      *                                                                                       CSW201
      **  Submit PAPER message print via RCF                                                  CSW201
      *                                                                                       CSW201
     C           NWRK      IFEQ 'PAPER'                                                       CSW201
     C                     CALL 'MEC0846R'                                                    CSW201
     C                     PARM           TRNO                                                CSW201
     C                     PARM           BRCA                                                CSW201
     C                     PARM           MBIN                                                CSW201
     C                     ENDIF                                                              CSW201
     C                     ENDIF                                                              CSW201
     C                     ENDIF                                                              CSW201
     C           KFTRN     READEMGHISTL4                 10                                   CSW201
     C                     ENDDO                                                              CSW201
      *                                                                                       CSW201
     C                     ENDIF                                                              CSW201
      *
     C                     ELSE                                      X1
     C                     EXCPT
     C                     END                                       E1
     C/COPY WNCPYSRC,ME0600C011
      *
      **  Clear subfile
     C                     SETOF                     2021
     C                     WRITEME0600F3
     C                     SETON                     202122
     C                     Z-ADD1         RRN     50
     C                     MOVE MGSG      @MGSG   1
     C                     MOVE NWRK      @NWRK   6
     C                     MOVE TSKS      @TSKS   1
      *
      **  Write message headings
     C                     EXSR HDNG
      *
      **  Access message file using message reference
     C           @TRNO     CHAINMGOMSGPD             11
     C/COPY WNCPYSRC,ME0600C036
      *
      **  Process messages records with message reference
      *                                                                                       206803
     C           MTPY      IFEQ '103'                                                         206803
     C           MTAG      ANDEQ':119:'                                                       206803
     C                     MOVE 'Y'       W#RSET  1                                           206803
     C                     ELSE                                                               206803
     C                     MOVE 'N'       W#RSET                                              206803
     C                     ENDIF                                                              206803
      *                                                                                       206803
     C                     Z-ADD1         @V                              183583
     C           *IN11     DOWEQ'0'                                   1
      *
      **  Write message text
     C                     EXSR TEXT
      *
      **  Access next message file record with message reference
     C           @TRNO     READEMGOMSGPD                 11
      *                                                                                       206803
     C           W#RSET    IFEQ 'Y'                                                           206803
     C                     Z-ADD1         @V                                                  206803
     C                     MOVE 'N'       W#RSET                                              206803
     C                     ELSE                                                               206803
     C                     ADD  1         @V                              183583
     C                     ENDIF                                                              206803
      *                                                                                       206803
     C                     END                                       E1
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   RELS - release message                                      *
      *   Called by - main process                                    *
      *   Calls - HDNG write message headings                         *
      *           TEXT write message text                             *
      *****************************************************************
      *
     C           RELS      BEGSR
      *
      **  Re access message reference file
     C***********@TRNO     CHAINMGOREFU0             10                   CTK001
     C           @TRNO     CHAINMGOREFU0             1013                 CTK001
     C/COPY WNCPYSRC,ME0600C080
      *                                                                   CTK001
      **  If record is now locked                                         CTK001
     C           *IN13     IFEQ '1'                                   1   CTK001
     C                     MOVELTXT,27    @MSDTA                          CTK001
     C                     CALL 'ZM1001'  PLIST3                          CTK001
     C                     MOVE *BLANKS   @MSDTA                          CTK001
     C                     SETON                     3545                 CTK001
     C                     ELSE                                           CTK001
      *                                                                                       CSD015
      ** If Midas Compliance Watch is active and watch list                                   CSD015
      ** checking applied, check trade if pending investigation                               CSD015
      *                                                                                       CSD015
     C           W1EWLC    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
      ** Check if message type exists in the watch list                                       CSD015
      *                                                                                       CSD015
     C                     CALL 'AOWLMTR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD   7                                           CSD015
     C                     PARM '*MTYP'   POPTN   7                                           CSD015
     C                     PARM MTPY      PMTYP   3                                           CSD015
     C                     PARM *BLANKS   PMTAG  50                                           CSD015
      *                                                                                       CSD015
      ** If Message Type exists, Execute SRWTCH subroutine                                    CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C                     MOVE 'MGOREF  'WFUNT                                               CSD015
     C                     MOVE *BLANK    WIDEN                                               CSD015
     C                     MOVELTRNO      WIDEN                                               CSD015
      *                                                                                       CSD015
     C           KWHTKY    CHAINSDCWHTL1             32                                       CSD015
      *                                                                                       CSD015
      ** If record found and under investigation, display error                               CSD015
      ** message 'Item under review by Compliance Officer'                                    CSD015
      *                                                                                       CSD015
     C           *IN32     IFEQ *OFF                                                          CSD015
     C           W3TREL    ANDNE'Y'                                                           CSD015
     C                     MOVEL'MEM9933' @MSGID                                              CSD015
     C                     CALL 'ZM1001'  PLIST3                                              CSD015
     C                     MOVE *ON       *IN35                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *
      **  If message status has changed..
     C           MGSG      IFNE '1'                                   1
     C                     MOVEL'MEM1071' @MSGID
     C                     CALL 'ZM1001'  PLIST3
     C                     SETON                     35
      *
      **  ..or verifiction is on and
     C                     ELSE                                      X1
     C           ENVPM     IFEQ 'Y'                                   2
     C/COPY WNCPYSRC,ME0600C057
     C           MTPY      IFEQ '100'                                 3
     C           MTPY      OREQ '202'
     C           MTPY      OREQ '203'
     C           MTPY      OREQ '200'                                     098075
     C           MTPY      OREQ '103'                                                         212173
     C/COPY WNCPYSRC,ME0600C077
      *
      **  value date entered is not date of message
     C           SDAT      IFNE SVDT                                  4
     C                     SETON                     3545
     C                     END                                       E4
      *
      **  currency entered is not currency of message
     C           SCCY      IFNE CCY                                   4
     C                     SETON                     3545
     C                     END                                       E4
      *
      **  amount entered is not amount of message or total of multiple
     C           TRNM      IFEQ *BLANKS                               4
     C           SAMT      ANDNEAMTS
     C                     SETON                     3545
     C                     END                                       E4
      *
     C           TRNM      IFNE *BLANKS                               4
     C           SAMT      ANDNEAMTX
     C                     SETON                     3545
     C                     END                                       E4
      *
      **  If user has entered an incorrect verification field issue
      **  error message
     C           *IN45     IFEQ '1'                                   4
     C                     MOVEL'MEM1072' @MSGID
     C                     CALL 'ZM1001'  PLIST3
     C                     END                                       E4
     C                     END                                       E3
     C/COPY WNCPYSRC,ME0600C084
     C                     END                                       E2
     C/COPY WNCPYSRC,ME0600C037
      *
      **  Testkey can only be added to Telex payment message
     C           NWRK      IFNE 'TELEX'                               2
     C           TSKS      ANDNE'Y'
     C           STKY      ANDNE*BLANKS
     C                     MOVEL'MEM1073' @MSGID
     C                     CALL 'ZM1001'  PLIST3
     C                     SETON                     3546
     C                     END                                       E2
      *
      **  Testkey must be added to telex payment message
     C           NWRK      IFEQ 'TELEX'                               2
     C           TSKS      ANDEQ'Y'
     C           STKY      ANDEQ*BLANKS
     C/COPY WNCPYSRC,ME0600C049
     C                     MOVEL'MEM1074' @MSGID
     C                     CALL 'ZM1001'  PLIST3
     C                     SETON                     3546
     C                     END                                       E2
      *
      **  If GEN entered generate testkey using testkey package
     C           STKY      IFEQ 'GEN'                                 2
     C                     EXSR TKEY
     C                     END                                       E2
     C/COPY WNCPYSRC,ME0600C038
     C                     END                                       E1
     C                     ENDIF                                          CTK001
      *
      **  If no errors release message
     C           *IN35     IFEQ '0'                                   1
      *                                                                                       CSW201
      ** If Swift 2001 is installed and message type is '362', get                            CSW201
      ** the message to be releaed' First transaction no. in MT362                            CSW201
      ** field found in MGHISTPD.                                                             CSW201
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C           MTPY      ANDEQ'362'                                     115412              CSW201
     C                     MOVELTRNO      WHREF                                               CSW201
     C                     MOVE MTPY      HSMTPY                                              CSW201
     C           KHIST     CHAINMGHISTL3             10                                       CSW201
     C                     ENDIF                                                              CSW201
      *
     C           STKY      IFNE *BLANKS                               2
     C           *NAMVAR   DEFN MTSTAT    DSSTAT
     C           *LOCK     IN   DSSTAT
     C                     ADD  1         SEQ
     C                     OUT  DSSTAT
     C                     MOVE STKY      TSKY
     C                     MOVE SEQ       TSEQ
     C                     END                                       E2
      *
     C/COPY WNCPYSRC,ME0600C058
     C                     MOVE '2'       MGSG
     C                     MOVE 'RSND'    MGST
     C/COPY WNCPYSRC,ME0600C053
     C                     MOVE RUNA      LADT
     C                     TIME           LATM
     C                     MOVE RUNA      RELD
     C                     MOVE LATM      RELT
     C                     MOVE USRID     RUSR
     C                     MOVE WSID      RWSN
     C/COPY WNCPYSRC,ME0600C050
      *
     C                     UPDATMGOREFU0
     C/COPY WNCPYSRC,ME0600C005
      *                                                                                       CSW201
      ** Release all records in MGOREFPD that has the same first                              CSW201
      ** transaction number being released if CSW201 is on and                                CSW201
      ** message type is '362'                                                                CSW201
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C           MTPY      ANDEQ'362'                                                         CSW201
     C                     MOVE HSFTRN    KFTRN  16                                           CSW201
      *                                                                                       CSW201
     C           KFTRN     SETLLMGHISTL4                                                      CSW201
     C           KFTRN     READEMGHISTL4                 10                                   CSW201
      *                                                                                       CSW201
     C           *IN10     DOWEQ*OFF                                                          CSW201
     C           KFTRN     ANDNE*BLANKS                                                       CSW201
      *                                                                                       CSW201
     C                     MOVELWHREF     WTRNO                                               CSW201
      *                                                                                       CSW201
     C           TRNO      IFNE WTRNO                                                         CSW201
     C           WTRNO     CHAINMGOREFU0             11                                       CSW201
     C           *IN11     IFEQ *OFF                                                          CSW201
      *                                                                                       CSW201
     C           STKY      IFNE *BLANKS                                                       CSW201
     C           *LOCK     IN   DSSTAT                                                        CSW201
     C                     ADD  1         SEQ                                                 CSW201
     C                     OUT  DSSTAT                                                        CSW201
     C                     MOVE STKY      TSKY                                                CSW201
     C                     MOVE SEQ       TSEQ                                                CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     MOVE '2'       MGSG                                                CSW201
     C                     MOVE 'RSND'    MGST                                                CSW201
     C                     MOVE RUNA      LADT                                                CSW201
     C                     TIME           LATM                                                CSW201
     C                     MOVE RUNA      RELD                                                CSW201
     C                     MOVE LATM      RELT                                                CSW201
     C                     MOVE USRID     RUSR                                                CSW201
     C                     MOVE WSID      RWSN                                                CSW201
      *                                                                                       CSW201
     C                     UPDATMGOREFU0                                                      CSW201
      *                                                                                       CSW201
     C                     ENDIF                                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C           KFTRN     READEMGHISTL4                 10                                   CSW201
     C                     ENDDO                                                              CSW201
      *                                                                                       CSW201
     C                     ENDIF                                                              CSW201
      *
     C                     ELSE                                      X1
     C**********           EXCPT                                          CTK001
     C                     UNLCKMGOREFLU                                  CTK001
     C                     END                                       E1
      *
      **  Clear subfile
     C                     SETOF                     2021
     C                     WRITEME0600F3
     C                     SETON                     202122
     C                     Z-ADD1         RRN     50
     C                     MOVE MGSG      @MGSG   1
     C                     MOVE NWRK      @NWRK   6
     C                     MOVE TSKS      @TSKS   1
      *
      **  Write message headings
     C                     EXSR HDNG
      *
      **  Access message file using message reference
     C           @TRNO     CHAINMGOMSGPD             11
      *                                                                                       174844
      **  Initialise variable for first part of MT580.                                        174844
     C                     MOVEL'FIRST'   PHS     5                                           174844
      *                                                                                       174844
     C/COPY WNCPYSRC,ME0600C039
      *
      **  Process messages records with message reference
      *                                                                                       206803
     C           MTPY      IFEQ '103'                                                         206803
     C           MTAG      ANDEQ':119:'                                                       206803
     C                     MOVE 'Y'       W#RSET  1                                           206803
     C                     ELSE                                                               206803
     C                     MOVE 'N'       W#RSET                                              206803
     C                     ENDIF                                                              206803
      *                                                                                       206803
     C                     Z-ADD1         @V                              183583
     C           *IN11     DOWEQ'0'                                   1
      *
      **  Write message text
     C                     EXSR TEXT
      *
      **  Access next message file record with message reference
     C           @TRNO     READEMGOMSGPD                 11
      *                                                                                       206803
     C           W#RSET    IFEQ 'Y'                                                           206803
     C                     Z-ADD1         @V                                                  206803
     C                     MOVE 'N'       W#RSET                                              206803
     C                     ELSE                                                               206803
     C                     ADD  1         @V                              183583
     C                     ENDIF                                                              206803
      *                                                                                       206803
     C                     END                                       E1
      *
     C                     ENDSR
      /EJECT                                                              183583
      *****************************************************************   183583
      *                                                               *   183583
      *   SEXTNR - Reads MGOEXTPD to get the SWIFT ID's cust. no.     *   183583
      *                                                               *   183583
      *   Called by: TEXT                                             *   183583
      *   Calls    : None                                             *   183583
      *                                                               *   183583
      *****************************************************************   183583
      *                                                                   183583
     C           SEXTNR    BEGSR                                          183583
      *                                                                   183583
     C                     MOVE *BLANKS   ZCUST                           183583
     C           KEXTN     CHAINMGOEXTLF             1616                 183583
     C           *IN16     IFEQ '0'                                       183583
     C                     MOVELMCSI      ZCUST                           183583
     C                     ENDIF                                          183583
      *                                                                   183583
     C           SEXTN9    ENDSR                                          183583
     C/EJECT
     C/COPY WNCPYSRC,ME0600C040
      *****************************************************************
      *   SWADDR - Format Name/Town from SWIFT address and get other  *
      *            Network adresses for this SWIFT address            *
      *   Called by - HDNG, VALD                                      *
      *   Standard input -  ZADDR, Address, 20A                       *
      *   Standard output - ZNAME, Customer/Countreparty name, 35A    *
      *                     ZTOWN, Customer/Counterparty town, 35A    *
      *                     ZSWFT  Address for SWIFT                  *
      *                     ZTELX  Address for TELEX                  *
      *                     ZSTTX  Address for STTX                   *
      *                     *IN90 If ON implies no record found       *
      *****************************************************************
      *
     C           SWADDR    BEGSR
      *
      **  Define standard fields
     C                     MOVE ZADDR     ZADDR  20
     C                     MOVE *BLANKS   ZNAME  35
     C                     MOVE *BLANKS   ZTOWN  20
     C                     MOVE *BLANKS   ZSWFT  12
     C                     MOVE *BLANKS   ZTELX  10
     C                     MOVE *BLANKS   ZSTTX  12
      *
      **  Move standard address to SWIFT address key
     C                     MOVELZADDR     SFWAD  12
      *
      **  First try customer file, SDCUST
     C           SFWAD     CHAINSDCUSTSW             90
      *                                                                   183583
     C           ZCUST     IFNE *BLANKS                                   183583
     C           *IN90     DOWEQ'0'                                       183583
     C           BBCUST    ANDNEZCUST                                     183583
     C           SFWAD     READESDCUSTSW                 90               183583
     C                     ENDDO                                          183583
     C                     ENDIF                                          183583
      *                                                                   183583
     C           *IN90     IFEQ '0'                                   1
     C                     MOVELBBCRNM    ZNAME
     C                     MOVELBBCRTN    ZTOWN
     C                     MOVELBBCSID    ZSWFT
     C                     MOVELBBTXA1    ZTELX
     C                     MOVELBBSTAD    ZSTTX
     C                     ELSE                                      X1
      *
      **  If not found on customer file, try C/Party Nostro file SDCNST
     C           SFWAD     CHAINSDCNSTSW             90
      *                                                                   183583
      ** Check if correct Counterparty used is found.                     183583
      *                                                                   183583
     C           ZCUST     IFNE *BLANKS                                   183583
     C           *IN90     DOWEQ'0'                                       183583
     C           AWCPNC    ANDNEZCUST                                     183583
     C           SFWAD     READESDCNSTSW                 90               183583
     C                     ENDDO                                          183583
     C                     ENDIF                                          183583
      *                                                                   183583
     C           *IN90     IFEQ '0'                                   2
     C                     MOVELAWCPNM    ZNAME
     C                     MOVELAWCNTN    ZTOWN
     C                     MOVELAWSWID    ZSWFT
     C                     MOVELAWTXA1    ZTELX
     C                     MOVELAWSTAD    ZSTTX
     C                     ELSE                                      X2   107503
      *                                                                   107503
      *  Call ME1400 to access BIC address                                107503
      *                                                                   107503
     C                     MOVE SFWAD     W01BIC                          107503
     C                     MOVE W01ICC    W9BICC                          107503
     C                     MOVE W01ICB    W9BICB                          107503
      *                                                                   107503
     C                     CALL 'ME1400'                                  107503
     C                     PARM *BLANKS   W9RTN   7                       107503
     C                     PARM           W9BICC  8                       107503
     C                     PARM           W9BICB  3                       107503
     C                     PARM           SDCUST                          107503
     C                     PARM           SDCNST                          107503
     C                     PARM           MEBICD                          107503
     C                     PARM *BLANKS   W9CUST  1                       107503
     C                     PARM *BLANKS   W9CNST  1                       107503
     C                     PARM *BLANKS   W9BICD  1                       107503
      *                                                                   107503
      ** If record found on BIC file, use first line of name & city       107503
      *                                                                   107503
     C           W9BICD    IFEQ 'Y'                                   3   107503
     C                     MOVELBDINS1    ZNAME                           107503
     C                     MOVELBDCITY    ZTOWN                           107503
     C                     MOVE '0'       *IN90                           107503
     C                     END                                       E3   107503
      *                                                                   107503
     C                     END                                       E2
     C                     END                                       E1
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   STADDR - Format Name/Town from STTX address get other       *
      *            Network addresses for this STTX address            *
      *   Called by - HDNG, VALD                                      *
      *   Standard input -  ZADDR, Address, 20A                       *
      *   Standard output - ZNAME, Customer/Countreparty name, 35A    *
      *                     ZTOWN  Customer/Counterparty town, 35A    *
      *                     ZSWFT  Address for SWIFT                  *
      *                     ZTELX  Address for TELEX                  *
      *                     ZSTTX  Address for STTX                   *
      *                     *IN90 If ON implies no record found       *
      *****************************************************************
      *
     C           STADDR    BEGSR
      *
      **  Define standard fields
     C                     MOVE ZADDR     ZADDR  20
     C                     MOVE *BLANKS   ZNAME  35
     C                     MOVE *BLANKS   ZTOWN  20
     C                     MOVE *BLANKS   ZSWFT  12
     C                     MOVE *BLANKS   ZTELX  10
     C                     MOVE *BLANKS   ZSTTX  12
      *
      **  Move standard address to STTX address key
     C                     MOVELZADDR     STXAD  12
      *
      **  First try customer file, SDCUST
     C           STXAD     CHAINSDCUSTST             90
      *                                                                   183583
     C           ZCUST     IFNE *BLANKS                                   183583
     C           *IN90     DOWEQ'0'                                       183583
     C           BBCUST    ANDNEZCUST                                     183583
     C           STXAD     READESDCUSTST                 90               183583
     C                     ENDDO                                          183583
     C                     ENDIF                                          183583
      *                                                                   183583
     C           *IN90     IFEQ '0'                                   1
     C                     MOVELBBCRNM    ZNAME
     C                     MOVELBBCRTN    ZTOWN
     C                     MOVELBBCSID    ZSWFT
     C                     MOVELBBTXA1    ZTELX
     C                     MOVELBBSTAD    ZSTTX
     C                     ELSE                                      X1
      *
      **  If not found on customer file, try C/Party Nostro file SDCNST
     C           STXAD     CHAINSDCNSTST             90
      *                                                                   183583
      ** Check if correct Counterparty used is found.                     183583
      *                                                                   183583
     C           ZCUST     IFNE *BLANKS                                   183583
     C           *IN90     DOWEQ'0'                                       183583
     C           AWCPNC    ANDNEZCUST                                     183583
     C           STXAD     READESDCNSTST                 90               183583
     C                     ENDDO                                          183583
     C                     ENDIF                                          183583
      *                                                                   183583
     C           *IN90     IFEQ '0'                                   2
     C                     MOVELAWCPNM    ZNAME
     C                     MOVELAWCNTN    ZTOWN
     C                     MOVELAWSWID    ZSWFT
     C                     MOVELAWTXA1    ZTELX
     C                     MOVELAWSTAD    ZSTTX
     C                     END                                       E2
     C                     END                                       E1
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   TXADDR - Format Name/Town from TELEX address and get other  *
      *            Network addresses for this TELEX address           *
      *   Called by - HDNG, VALD                                      *
      *   Standard input -  ZADDR, Address, 20A                       *
      *   Standard output - ZNAME, Customer/Countreparty name, 35A    *
      *                     ZTOWN  Customer/Counterparty town, 35A    *
      *                     ZSWFT  Address for SWIFT                  *
      *                     ZTELX  Address for TELEX                  *
      *                     ZSTTX  Address for STTX                   *
      *                     *IN90 If ON implies no record found       *
      *****************************************************************
      *
     C           TXADDR    BEGSR
      *
      **  Define standard fields
     C                     MOVE ZADDR     ZADDR  20
     C                     MOVE *BLANKS   ZNAME  35
     C                     MOVE *BLANKS   ZTOWN  20
     C                     MOVE *BLANKS   ZSWFT  12
     C                     MOVE *BLANKS   ZTELX  10
     C                     MOVE *BLANKS   ZSTTX  12
      *
      **  Move standard address to TELEX address key
     C                     MOVELZADDR     TLXAD  10
      *
      **  First try customer file, SDCUST
     C           TLXAD     CHAINSDCUSTTX             90
      *                                                                   183583
     C           ZCUST     IFNE *BLANKS                                   183583
     C           *IN90     DOWEQ'0'                                       183583
     C           BBCUST    ANDNEZCUST                                     183583
     C           TLXAD     READESDCUSTTX                 90               183583
     C                     ENDDO                                          183583
     C                     ENDIF                                          183583
      *                                                                   183583
     C           *IN90     IFEQ '0'                                   1
     C                     MOVELBBCRNM    ZNAME
     C                     MOVELBBCRTN    ZTOWN
     C                     MOVELBBCSID    ZSWFT
     C                     MOVELBBTXA1    ZTELX
     C                     MOVELBBSTAD    ZSTTX
     C                     ELSE                                      X1
      *
      **  If not found on customer file, try C/Party Nostro file SDCNST
     C           TLXAD     CHAINSDCNSTTX             90
      *                                                                   183583
      ** Check if correct Counterparty used is found.                     183583
      *                                                                   183583
     C           ZCUST     IFNE *BLANKS                                   183583
     C           *IN90     DOWEQ'0'                                       183583
     C           AWCPNC    ANDNEZCUST                                     183583
     C           TLXAD     READESDCNSTTX                 90               183583
     C                     ENDDO                                          183583
     C                     ENDIF                                          183583
      *                                                                   183583
     C           *IN90     IFEQ '0'                                   2
     C                     MOVELAWCPNM    ZNAME
     C                     MOVELAWCNTN    ZTOWN
     C                     MOVELAWSWID    ZSWFT
     C                     MOVELAWTXA1    ZTELX
     C                     MOVELAWSTAD    ZSTTX
     C                     END                                       E2
     C                     END                                       E1
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   PAPER - If current network is paper, access destination by  *
      *           customer number, because no single, unique entry in *
      *           network address can be used to acccess party.       *
      *   Called by - VALD                                            *
      *   Standard output - ZNAME  Address for PAPER                  *
      *                     ZSWFT  Address for SWIFT                  *
      *                     ZTELX  Address for TELEX                  *
      *                     ZSTTX  Address for STTX                   *
      *                     *IN90 If ON implies no record found       *
      *****************************************************************
      *
     C           PAPER     BEGSR
      *
      **  Define standard fields
     C                     MOVE *BLANKS   ZNAME  35
     C                     MOVE *BLANKS   ZSWFT  12
     C                     MOVE *BLANKS   ZTELX  10
     C                     MOVE *BLANKS   ZSTTX  12
     C/COPY WNCPYSRC,ME0600C012
      *
     C                     MOVE DECN      @WK6    6
     C           @WK6      CHAINSDCUSTL0             90
     C           *IN90     IFEQ '0'                                   1
     C                     MOVELBBCRNM    ZNAME
     C                     MOVELBBCSID    ZSWFT
     C                     MOVELBBTXA1    ZTELX
     C                     MOVELBBSTAD    ZSTTX
     C/COPY WNCPYSRC,ME0600C013
     C                     END                                       E1
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   FORM  - Format subfield                                     *
      *   Called by - TEXT write message text                         *
      *****************************************************************
      *
     C           FORM      BEGSR
      *
      ** Check for defined qualifiers, issuer codes or type in the form   CSW098
      **  MFLD = ':QUAL/ISSUERCD/TYPE/data' whereby formatting should     CSW098
      ** only be done on the data.                                        CSW098
      *                                                                   CSW098
     C                     MOVEA*BLANKS   FLA                             CSW098
     C                     MOVE *BLANKS   WMFLD  50                       CSW098
     C                     MOVE *BLANKS   WFLA   50                       CSW098
     C                     MOVE *BLANKS   WFLB   50                       CSW098
      *                                                                   CSW098
     C           @WM1      IFEQ ':'                        Qualifier StartCSW098
     C           '/'       SCAN MFLD:7    C       20       Issuer Code EndCSW098
      *                                                                   CSW098
     C           C         IFNE 0                                         CSW098
     C                     ADD  1         C                               CSW098
     C           '/'       SCAN MFLD:C    D       20       Type End       CSW098
     C           D         IFNE 0                                         CSW098
     C                     Z-ADDD         C                               CSW098
     C                     ELSE                                           CSW098
     C                     SUB  1         C                               CSW098
     C                     ENDIF                                          CSW098
     C           C         SUBSTMFLD      WMFLD                           CSW098
     C                     ADD  1         C                               CSW098
     C                     SUBSTMFLD:C    WFLA                            CSW098
     C                     MOVEAWFLA      FLA                             CSW098
     C                     ENDIF                                          CSW098
      *                                                                   CSW098
     C                     ELSE                                           CSW098
      *                                                                   CSW098
     C                     MOVEAMFLD      FLA
      *                                                                   CSW098
     C                     ENDIF                                          CSW098
      *                                                                   CSW098
     C                     MOVE *BLANKS   FLB
     C                     Z-ADD1         A       20
     C           ','       LOKUPFLA,A                    53
     C           *IN53     IFEQ '1'                                   1
     C                     MOVE '.'       FLA,A
     C                     END                                       E1
      *
     C           EFTAGF    IFEQ 'DCA'                                 1
     C           EFTAGF    OREQ 'DT'                                      CSW098
     C           EFTAGF    OREQ 'D'
     C           DIGITS    CHECKFLA,7                    47               CSW097
      *                                                                   CSW097
      ** The seventh character is not numeric.                            CSW097
      *                                                                   CSW097
     C           *IN47     IFEQ '1'                                       CSW097
     C                     MOVEAFLA,1     @WK2    2
     C                     MOVEA@WK2      FLB,1
     C                     MOVE '/'       FLB,3
     C                     MOVEAFLA,3     @WK2
     C                     MOVEA@WK2      FLB,4
     C                     MOVE '/'       FLB,6
     C                     MOVEAFLA,5     @WK2
     C                     MOVEA@WK2      FLB,7
      *
     C                     MOVEAFLB,1     WRKDAT
     C                     MOVE WRKYY     CHGYY
     C                     ELSE                                           CSW097
      *                                                                   CSW097
      ** It is numeric, therefore the date is in CCYYMMDD format.         CSW097
      *                                                                   CSW097
     C                     MOVEAFLA,1     @WK4    4                       CSW097
     C                     MOVEA@WK4      FLB,1                           CSW097
     C                     MOVE '/'       FLB,5                           CSW097
     C                     MOVEAFLA,5     @WK2                            CSW097
     C                     MOVEA@WK2      FLB,6                           CSW097
     C                     MOVE '/'       FLB,8                           CSW097
     C                     MOVEAFLA,7     @WK2                            CSW097
     C                     MOVEA@WK2      FLB,9                           CSW097
      *                                                                   CSW097
     C                     MOVEAFLB,1     WKDAT                           CSW097
     C                     MOVE WKYY      CHYY                            CSW097
     C                     ENDIF                                          CSW097
      *
     C           DATF      IFEQ 'M'
     C           *IN47     IFEQ '1'                                       CSW097
     C                     MOVELWRKMM     @CHG5
     C                     MOVE WRKDD     @CHG5
     C                     ELSE                                           CSW097
     C                     MOVELWKMM      @CH5                            CSW097
     C                     MOVE WKDD      @CH5                            CSW097
     C                     ENDIF                                          CSW097
     C                     ELSE
     C           *IN47     IFEQ '1'                                       CSW097
     C                     MOVE WRKMM     @CHG5
     C                     MOVELWRKDD     @CHG5
     C                     ELSE                                           CSW097
     C                     MOVE WKMM      @CH5                            CSW097
     C                     MOVELWKDD      @CH5                            CSW097
     C                     ENDIF                                          CSW097
     C                     END
      *
     C           *IN47     IFEQ '1'                                       CSW097
     C                     MOVEACHGDAT    FLB,1
     C                     ELSE                                           CSW097
     C                     MOVEACHDAT     FLB,1                           CSW097
     C                     ENDIF                                          CSW097
      *
     C                     END                                       E1
      *
     C           EFTAGF    IFEQ 'DCA'                                 1
     C           *IN47     IFEQ '1'                                       CSW097
     C                     MOVEAFLA,7     @WL3    3
     C                     MOVEA@WL3      FLB,10
     C                     MOVEAFLA,10    @WK15  15
     C/COPY WNCPYSRC,ME0600C086
     C                     MOVEA@WK15     FLB,14
     C/COPY WNCPYSRC,ME0600C087
     C                     ELSE                                           CSW097
     C                     MOVEAFLA,9     @WL3                            CSW097
     C                     MOVEA@WL3      FLB,12                          CSW097
     C                     MOVEAFLA,12    @WK15                           CSW097
     C/COPY WNCPYSRC,ME0600C088
     C                     MOVEA@WK15     FLB,16                          CSW097
     C/COPY WNCPYSRC,ME0600C089
     C                     ENDIF                                          CSW097
     C                     END                                       E1
     C*                                                                   CSW098
     C           EFTAGF    IFEQ 'DT'                                  1   CSW098
     C           *IN47     IFEQ '1'                                       CSW098
     C                     MOVEAFLA,7     @WL2    2                       CSW098
     C                     MOVEA@WL2      FLB,10                          CSW098
     C                     MOVE ':'       FLB,12                          CSW098
     C                     MOVEAFLA,9     @WL2                            CSW098
     C                     MOVEA@WL2      FLB,13                          CSW098
     C                     MOVE ':'       FLB,15                          CSW098
     C                     MOVEAFLA,11    @WL2                            CSW098
     C                     MOVEA@WL2      FLB,16                          CSW098
     C                     ELSE                                           CSW098
     C                     MOVEAFLA,9     @WL2                            CSW098
     C                     MOVEA@WL2      FLB,12                          CSW098
     C                     MOVE ':'       FLB,14                          CSW098
     C                     MOVEAFLA,11    @WL2                            CSW098
     C                     MOVEA@WL2      FLB,15                          CSW098
     C                     MOVE ':'       FLB,17                          CSW098
     C                     MOVEAFLA,13    @WL2                            CSW098
     C                     MOVEA@WL2      FLB,18                          CSW098
     C                     ENDIF                                          CSW098
     C                     END                                       E1   CSW098
      *
     C           EFTAGF    IFEQ 'CA'                                  1
     C                     MOVEAFLA,1     @WM1    1                                           186181
     C           DIGITS    CHECKFLA,4                    47                                   186181
      *                                                                                       186181
      ** If field starts with 'N', could be that the 'N' is the sign.                         186181
      ** If 4th character is not numeric, then currency is in this                            186181
      ** part of the field. So the field is in the format                                     186181
      ** Ncccaaaaaaaaaaaaaaa, where N is the sign, ccc is the currency                        186181
      ** and aaaaaaaaaaaaaaa is the amount. Otherwise the field is in                         186181
      ** format cccaaaaaaaaaaaaaaa.                                                           186181
      *                                                                                       186181
     C           @WM1      IFEQ 'N'                                                           186181
     C           *IN47     ANDEQ'1'                                                           186181
     C                     MOVEA@WM1      FLB,1                                               186181
     C                     MOVEAFLA,2     @WL3                                                186181
     C                     MOVEA@WL3      FLB,3                                               186181
     C                     MOVEAFLA,5     @WK15                                               186181
     C/COPY WNCPYSRC,ME0600C090
     C                     MOVEA@WK15     FLB,7                                               186181
     C/COPY WNCPYSRC,ME0600C091
     C                     ELSE                                                               186181
     C                     MOVEAFLA,1     @WL3
     C                     MOVEA@WL3      FLB,1
     C                     MOVEAFLA,4     @WK15
     C/COPY WNCPYSRC,ME0600C092
     C                     MOVEA@WK15     FLB,5
     C/COPY WNCPYSRC,ME0600C093
     C                     END                                                                186181
     C                     END                                       E1
      *
     C           EFTAGF    IFEQ 'A'                                   1
     C/COPY WNCPYSRC,ME0600C094
     C                     MOVEAFLA,1     FLB,1
     C/COPY WNCPYSRC,ME0600C095
     C                     END                                       E1
      *                                                                   CSW098
     C           WMFLD     IFNE *BLANKS                                   CSW098
     C                     MOVELWMFLD     MFLD                            CSW098
     C                     MOVEAFLB       WFLB                            CSW098
     C                     CAT  WFLB:0    MFLD                            CSW098
     C                     ELSE                                           CSW098
     C                     MOVEAFLB       MFLD
     C                     ENDIF                                          CSW098
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   VALD - validate amendment                                   *
      *   Called by - AMND amend message                              *
      *****************************************************************
      *
     C           VALD      BEGSR
      *
     C           SNWK      IFNE *BLANKS                               1
      *
      **  If network entered invalid
     C           SNWK      IFNE 'SWIFT'                               2
     C*                                                                   S01408
     C/COPY WNCPYSRC,ME0600CCP5                                           S01408
     C*                                                                   S01408
     C           SNWK      ANDNE'TELEX'
     C           SNWK      ANDNE'STTX'
     C           SNWK      ANDNE'PAPER'
     C                     MOVEL'MEM1014' @MSGID
     C                     CALL 'ZM1001'  PLIST3
     C                     SETON                     3541
     C                     END                                       E2
      *
      **  If network entered same as existing network
     C           SNWK      IFEQ NWRK                                  2
     C                     MOVEL'MEM1063' @MSGID
     C                     CALL 'ZM1001'  PLIST3
     C                     SETON                     3541
     C                     END                                       E2
     C*                                                                   S01408
     C/COPY WNCPYSRC,ME0600CCP7                                           S01408
     C*                                                                   S01408
      *
      **  If network entered inactive
     C           SNWK      IFEQ 'SWIFT'                               2
     C           BGMSDL    ANDNE'Y'
     C*                                                                   S01408
     C/COPY WNCPYSRC,ME0600CCP6                                           S01408
     C*                                                                   S01408
     C                     MOVEL'MEM1049' @MSGID
     C                     CALL 'ZM1001'  PLIST3
     C                     SETON                     3541
     C                     END                                       E2
      *
     C           SNWK      IFEQ 'TELEX'                               2
     C/COPY WNCPYSRC,ME0600C064
     C           BGMTMI    ANDNE'Y'
     C                     MOVEL'MEM1050' @MSGID
     C                     CALL 'ZM1001'  PLIST3
     C                     SETON                     3541
     C                     END                                       E2
      *
     C           SNWK      IFEQ 'STTX'                                2
     C           BGMSDL    ANDNE'Y'
     C                     MOVEL'MEM1051' @MSGID
     C                     CALL 'ZM1001'  PLIST3
     C                     SETON                     3541
     C                     END                                       E2
      *                                                                   CSW096
     C                     MOVE MTPY      USMTPY                          CSW096
     C           SNWK      IFEQ 'SWIFT'                                   CSW096
     C           USCH1     ANDEQ'3'                                       CSW096
     C           USCH2     ANDNE'9'                                       CSW096
      *                                                                   CSW096
     C           TRNO      CHAINMGOMSGD0             11                   CSW096
      *                                                                   CSW096
     C           *IN11     IFEQ '0'                                       CSW096
     C                     READ MGOMSGPD                 11               CSW096
     C           *IN11     IFEQ '0'                                       CSW096
     C                     READ MGOMSGPD                 11               CSW096
     C           *IN11     IFEQ '0'                                       CSW096
      *                                                                   CSW096
     C           MTAG      IFEQ ':22: '                                   CSW096
     C                     MOVEA*BLANKS   FLA                             CSW096
     C                     MOVEAMFLD      FLA                             CSW096
     C                     Z-ADD1         A                               CSW096
      *                                                                   CSW096
     C           '/'       LOKUPFLA,A                    53               CSW096
     C           *IN53     IFEQ '1'                                       CSW096
     C                     Z-ADDA         B       20                      CSW096
      *                                                                   CSW096
     C           ' '       LOKUPFLA,B                    53               CSW096
     C           *IN53     IFEQ '1'                                       CSW096
     C           B         SUB  A         USLEN   20                      CSW096
     C                     ADD  1         USLEN                           CSW096
      *                                                                   CSW096
     C           USLEN     IFLT 16                                        CSW096
     C                     MOVEL'MEM1096' @MSGID                          CSW096
     C                     CALL 'ZM1001'  PLIST3                          CSW096
     C                     MOVE '1'       *IN35                           CSW096
     C                     MOVE '1'       *IN41                           CSW096
     C                     ENDIF                                          CSW096
      *                                                                   CSW096
     C                     ENDIF                                          CSW096
      *                                                                   CSW096
     C                     ENDIF                                          CSW096
      *                                                                   CSW096
     C                     ENDIF                                          CSW096
      *                                                                   CSW096
     C                     ENDIF                                          CSW096
      *                                                                   CSW096
     C                     ENDIF                                          CSW096
      *                                                                   CSW096
     C                     ENDIF                                          CSW096
      *                                                                   CSW096
     C                     ENDIF                                          CSW096
      *                                                                   CSW096
     C                     END                                       E1
      *
     C           SPTY      IFNE *BLANKS                               1
     C           SDEL      ORNE *BLANKS                                   087198
     C           SNDL      ORNE *BLANKS                                   087198
      *
      **  If priority entered invalid
     C           SPTY      IFNE 'N'                                   2
     C           SPTY      ANDNE'U'
     C                     MOVEL'MEM1002' @MSGID
     C                     CALL 'ZM1001'  PLIST3
     C                     SETON                     3542
     C                     END                                       E2
      *
      **  If priority does not change, notification may be changed.       087198
      **  So  remove this error message.                                  087198
      ***********                                                         087198
      ****If*priority entered same as existing priority                   087198
     C***********SPTY      IFEQ MPRY                                  2   087198
     C***********          MOVEL'MEM1068' @MSGID                          087198
     C***********          CALL 'ZM1001'  PLIST3                          087198
     C***********          SETON                     3542                 087198
     C**********           END                                       E2   087198
      *                                                                   131215
      ** If priority entered is 'Urgent' then both delivery monitoring    131215
      ** fields should have values.                                       131215
      *                                                                   131215
     C           SPTY      IFEQ 'U'                                   2   131215
     C           SDEL      IFEQ ' '                                   3   131215
     C           SNDL      OREQ ' '                                       131215
     C                     MOVEL'MEM1097' @MSGID                          131215
     C                     CALL 'ZM1001'  PLIST3                          131215
     C                     SETON                     3542                 131215
     C                     END                                       E3   131215
     C                     END                                       E2   131215
      *                                                                   087198
      **  If priority entered is 'Urgent' then delivery monitoring        087198
      **  should be '1' or '3'. (Mandatory)  Can not be '2' OR ' '.       087198
     C           SPTY      IFEQ 'U'                                   2   087198
     C           SDEL      IFEQ 'Y'                                   3   087198
     C           SNDL      ANDEQ'N'                                       087198
     C           SDEL      OREQ 'N'                                       087198
     C           SNDL      ANDEQ'N'                                       087198
     C           SDEL      OREQ ' '                                       087198
     C           SNDL      ANDEQ' '                                       087198
     C                     MOVEL'MEM1094' @MSGID                          087198
     C                     CALL 'ZM1001'  PLIST3                          087198
     C                     SETON                     3542                 087198
     C                     END                                       E3   087198
     C                     END                                       E2   087198
      *                                                                   087198
      **  If priority entered is 'Normal' then delivery monitoring        087198
      **  may optionaly be '2' instead of ' '. Can not be '1' or '3'.     087198
     C           SPTY      IFEQ 'N'                                   2   087198
     C           SDEL      IFEQ 'Y'                                   3   087198
     C           SNDL      ANDEQ'Y'                                       087198
     C           SDEL      OREQ 'N'                                       087198
     C           SNDL      ANDEQ'Y'                                       087198
     C           SDEL      OREQ ' '                                       087198
     C           SNDL      ANDEQ' '                                       087198
     C                     MOVEL'MEM1095' @MSGID                          087198
     C                     CALL 'ZM1001'  PLIST3                          087198
     C                     SETON                     3542                 087198
     C                     END                                       E3   087198
     C                     END                                       E2   087198
     C                     END                                       E1
      *
      **  If delivery note entered invalid
     C           SDEL      IFNE 'Y'                                   1
     C           SDEL      ANDNE'N'
     C           SDEL      ANDNE' '
     C                     MOVEL'MEM1069' @MSGID
     C                     CALL 'ZM1001'  PLIST3
     C                     SETON                     3543
     C                     END                                       E1
      *
      **  If non delivery note entered invalid
     C           SNDL      IFNE 'Y'                                   1
     C           SNDL      ANDNE'N'
     C           SNDL      ANDNE' '
     C                     MOVEL'MEM1070' @MSGID
     C                     CALL 'ZM1001'  PLIST3
     C                     SETON                     3544
     C                     END                                       E1
     C/COPY WNCPYSRC,ME0600C074
      *
      **  If no errors attempt to re-route if required
     C           *IN35     IFEQ '0'                                   1
     C           SNWK      ANDNE*BLANKS
      *
     C           SNWK      IFEQ 'SWIFT'                               2
     C*                                                                   S01408
     C/COPY WNCPYSRC,ME0600CP11                                           S01408
     C*                                                                   S01408
     C           SSWFT     IFEQ *BLANKS
     C           DSWFT     OREQ *BLANKS                               3
     C                     MOVEL'MEM1064' @MSGID
     C                     CALL 'ZM1001'  PLIST3
     C                     SETON                     3541
     C                     ELSE                                      X3
     C                     MOVELSNWK      NWRK
     C                     MOVE *BLANKS   NWSN
     C                     MOVELSSWFT     NWSN
     C                     MOVE *BLANKS   NWDS
     C                     MOVELDSWFT     NWDS
     C                     END                                       E3
     C                     END                                       E2
      *
     C/COPY WNCPYSRC,ME0600C063
     C           SNWK      IFEQ 'TELEX'                               2
     C/COPY WNCPYSRC,ME0600C065
     C           STELX     IFEQ *BLANKS
     C           DTELX     OREQ *BLANKS                               3
     C                     MOVEL'MEM1065' @MSGID
     C                     CALL 'ZM1001'  PLIST3
     C                     SETON                     3541
     C                     ELSE                                      X3
     C                     MOVELSNWK      NWRK
     C                     MOVE *BLANKS   NWSN
     C                     MOVELSTELX     NWSN
     C                     MOVE *BLANKS   NWDS
     C                     MOVELDTELX     NWDS
     C                     END                                       E3
     C/COPY WNCPYSRC,ME0600C066
     C                     END                                       E2
      *
     C           SNWK      IFEQ 'STTX'                                2
     C           SSTTX     IFEQ *BLANKS
     C           DSTTX     OREQ *BLANKS                               3
     C                     MOVEL'MEM1066' @MSGID
     C                     CALL 'ZM1001'  PLIST3
     C                     SETON                     3541
     C                     ELSE                                      X3
     C                     MOVELSNWK      NWRK
     C                     MOVE *BLANKS   NWSN
     C                     MOVELSSTTX     NWSN
     C                     MOVE *BLANKS   NWDS
     C                     MOVELDSTTX     NWDS
     C                     END                                       E3
     C                     END                                       E2
      *
     C           SNWK      IFEQ 'PAPER'                               2
     C           SNAME     IFEQ *BLANKS
     C           DNAME     OREQ *BLANKS                               3
     C                     MOVEL'MEM1067' @MSGID
     C                     CALL 'ZM1001'  PLIST3
     C                     SETON                     3541
     C                     ELSE                                      X3
     C                     MOVELSNWK      NWRK
     C                     MOVE *BLANKS   NWSN
     C                     MOVELSNAME     NWSN
     C                     MOVE *BLANKS   NWDS
     C                     MOVELDNAME     NWDS
     C                     END                                       E3
     C                     END                                       E2
     C                     END                                       E1
      *
     C                     ENDSR
     C/EJECT
     C/COPY WNCPYSRC,ME0600C014
      *****************************************************************
      *   TKEY - Generate testkey                                     *
      *****************************************************************
      *
     C           TKEY      BEGSR
      *
      **  Clear message id, because this subroutine sends hard-coded      067236
      **  error messages                                                  067236
     C                     CLEAR@MSGID                                    067236
     C                     CLEAR@MSDTA                                    067236
      *                                                                   067460
      **  If not Midas Testkey workstation, send error message            067460
     C           @TK       IFNE 'Y'                                       067460
     C                     MOVELTXT,24    @MSDTA                          067460
     C                     CALL 'ZM1001'  PLIST3                          067460
     C                     SETON                     3546                 067460
     C                     ELSE                                           067460
     C                     OPEN TKOTIPF
      *                                                                   CTK001
      ** Before proceeding, ensure record is not now being used/been      CTK001
      ** cleared by another user                                          CTK001
      *                                                                   CTK001
     C           TRNO      CHAINMGOREFL0             1013                 CTK001
      *                                                                   CTK001
     C           *IN10     IFEQ *OFF                                      CTK001
     C           *IN13     ANDEQ*OFF                                      CTK001
      *
      **  Write the 1st record to TKOTIPF                                 S01156
     C                     Z-ADD1         W1                              S01156
     C                     MOVE 'U'       DTTP                            S01156
     C                     MOVE ':'       CLN                             S01156
     C                     MOVE *BLANKS   DATA                            S01156
     C                     MOVEL'MIDAS'   DATA                            S01156
     C                     MOVE MODI      DTA2                            S01156
     C                     MOVE ':'       DTA3                            S01156
     C                     WRITETKOTIPFF                                  S01156
      *                                                                   S01156
      **  Write the 2nd record to TKOTIPF                                 S01156
     C                     MOVE 'S'       DTTP                            S01156
     C                     MOVE *BLANKS   DATA                            S01156
     C******************** MOVELDECN      DATA                      S01156067054
     C******************** MOVEL':'       DTA2                      S01156067054
     C                     MOVELNWDS      DATA                            067054
     C***********          MOVEL':'       DTA5                      067054CTK001
      *                                                                   CTK001
      ** Determine position for colon                                     CTK001
      *                                                                   CTK001
     C                     Z-ADD31        N       20                      CTK001
      *                                                                   CTK001
     C           N         DOWGT*ZERO                                     CTK001
     C           DATX,N    ANDEQ*BLANKS                                   CTK001
     C                     SUB  1         N                               CTK001
     C                     ENDDO                                          CTK001
      *                                                                   CTK001
     C           N         IFNE *ZERO                                     CTK001
     C                     ADD  1         N                               CTK001
     C                     MOVE ':'       DATX,N                          CTK001
     C                     ENDIF                                          CTK001
      *                                                                   CTK001
     C                     WRITETKOTIPFF                                  S01156
      *                                                                   S01156
      **  Write the 3rd record to TKOTIPF                                 S01156
     C                     MOVE YY1       YY2
     C                     MOVE MM1       MM2
     C                     MOVE DD1       DD2
      *
     C                     MOVE 'D'       DTTP                            S01156
     C                     MOVE *BLANKS   DATA                            S01156
     C******************** MOVELSVDT      DATA                      S01156067210
     C                     MOVEL@SVDT     DATA                            067210
     C                     MOVEL':'       DTA2                            S01156
     C                     WRITETKOTIPFF                                  S01156
      *                                                                   S01156
      **  Write the 4th record to TKOTIPF                                 S01156
     C                     MOVE 'C'       DTTP                            S01156
     C                     MOVE *BLANKS   DATA                            S01156
     C                     MOVELCCY       DATA                            S01156
     C                     MOVEL':'       DTA4                            S01156
     C                     WRITETKOTIPFF                                  S01156
      *                                                                   S01156
      **  Write the 5th record to TKOTIPF                                 S01156
     C                     MOVE 'A'       DTTP                            S01156
     C                     MOVE *BLANKS   FLA                             S01156
     C                     Z-ADD1         A                               S01156
      *
     C           TRNM      IFEQ *BLANKS                               1
     C                     MOVEAAMTS      FLA
     C                     ELSE                                      X1
     C                     MOVEAAMTX      FLA
     C                     END                                       E1
      *
     C           A         DOWLT50                                    1   S01156
     C           FLA,A     ANDNE','                                       S01156
     C           FLA,A     ANDNE' '                                       S01156
     C                     ADD  1         A                               S01156
     C                     END                                       E1   S01156
     C                     MOVE ':'       FLA,A                           S01156
      *                                                                   S01156
      **  Blank out any remainder                                         S01156
     C           A         IFLT 50                                    1   S01156
     C                     ADD  1         A                               S01156
     C                     MOVEA*BLANKS   FLA,A                           S01156
     C                     END                                       E1   S01156
     C                     MOVEAFLA       DATA                            S01156
     C                     WRITETKOTIPFF                                  S01156
      *
     C                     CLOSETKOTIPF
      *
     C                     CALL 'MTC4030'
     C                     PARM *BLANK    @MTRT   1                       067236
      *                                                                   CTK001
      ** If record locked or removed my another user                      CTK001
      *                                                                   CTK001
     C                     ELSE                                           CTK001
     C                     MOVELTXT,27    @MSDTA                          CTK001
     C                     CALL 'ZM1001'  PLIST3                          CTK001
     C                     MOVE *BLANKS   @MSDTA                          CTK001
     C                     SETON                     3546                 CTK001
     C                     ENDIF                                          CTK001
      *                                                                   067236
      **  If program ends in error, display error message                 067236
     C           @MTRT     IFEQ 'E'                                       067236
     C                     MOVELTXT,23    @MSDTA                          067236
     C                     CALL 'ZM1001'  PLIST3                          067236
     C                     MOVE *BLANKS   @MSDTA                          067236
     C                     SETON                     3546                 067236
     C                     ELSE                                           067236
      *
     C                     OPEN TKOTOPF
      *
      **  Read the TKOTOPF file                                           S01156
     C           1         CHAINTKOTOPFF             10                   S01156
      *                                                                   S01156
      **  Return error which prevented calculation of testkey             S01156
      **   - if file empty, may be because PC Organizer (PCO.EXE) not     067236
      **     started in PC's AUTOEXEC.BAT                                 067236
     C           *IN10     IFEQ '1'                                   1
     C           SYS1      OREQ 'E'
     C           ERRR      OREQ 'E'
     C           TKOT      OREQ *BLANK
     C           *IN10     IFEQ '0'                                       067236
     C                     MOVELTXT,22    @MSDTA
     C                     MOVE TKOT      @MSDTA
     C                     ELSE                                           067236
     C                     MOVELTXT,23    @MSDTA                          067236
     C                     END                                            067236
     C                     CALL 'ZM1001'  PLIST3
     C                     MOVE *BLANKS   @MSDTA
     C                     SETON                     3546
      *                                                                   S01156
      **  Return generated testkey after removing colon                   S01156
     C                     ELSE                                      X1   S01156
     C                     MOVE *BLANKS   FLA                             S01156
     C                     Z-ADD1         A                               S01156
      *
     C                     MOVEATSKY1     FLA                             S01199
     C           A         DOWLE50                                    2   S01156
     C           FLA,A     ANDNE':'                                       S01156
     C                     ADD  1         A
     C                     END                                       E2   S01156
      *
     C           A         IFLE 50                                    2   S01156
     C                     MOVEA*BLANKS   FLA,A                           S01156
     C                     END                                       E2   S01156
     C                     MOVEAFLA       STKY                            S01156
     C                     END                                       E1
      *
     C                     CLOSETKOTOPF
      *                                                                   067236
     C                     END                                            067236
      *
     C                     END                                            067460
      *                                                                   067460
     C                     ENDSR
     C/EJECT
      *****************************************************************                       196833
      *                                                               *                       196833
      *  SRDEST - Destination for CLS Pay/Receives                    *                       196833
      *           For CLS Pay/Receives, retrieve the SWIFT ID of the  *                       196833
      *           DECN field. This will display the correct Customer  *                       196833
      *           Report name and Town.                               *                       196833
      *                                                               *                       196833
      *****************************************************************                       196833
      *                                                                                       196833
     C           SRDEST    BEGSR                                                              196833
      *                                                                                       196833
     C           TNTP      IFEQ 'PC'                                                          196833
     C           TNTP      OREQ 'RC'                                                          196833
      *                                                                                       196833
     C                     MOVE *BLANKS   PCUST  10                                           196833
     C                     MOVELDECN      PCUST                                               196833
      *                                                                                       196833
     C                     CALL 'AOCUSTR1'                                                    196833
     C                     PARM *BLANKS   @RTCD                                               196833
     C                     PARM '*KEY   ' @OPTN                                               196833
     C                     PARM           PCUST                                               196833
     C                     PARM *BLANKS   PKYST   7                                           196833
     C           SDCUST    PARM SDCUST    DSLDY                                               196833
      *                                                                                       196833
     C           @RTCD     IFEQ *BLANKS                                                       196833
     C                     MOVELBBCSID    ZADDR                                               196833
     C                     ELSE                                                               196833
     C           *LOCK     IN   LDA                                                           196833
     C                     Z-ADD012       DBASE                                               196833
     C                     MOVEL'SDCUSTPD'DBFILE                                              196833
     C                     MOVELPCUST     DBKEY                                               196833
     C                     OUT  LDA                                                           196833
     C                     EXSR *PSSR                                                         196833
     C                     ENDIF                                                              196833
      *                                                                                       196833
     C                     ENDIF                                                              196833
      *                                                                                       196833
     C                     ENDSR                                                              196833
      *                                                                                       196833
      *****************************************************************                       196833
      /EJECT                                                                                  196833
      *****************************************************************
      *   *PSSR - error handling                                      *
      *****************************************************************
      *
     C           *PSSR     BEGSR
      *
     C                     MOVE '1'       @ERR
     C                     SETON                     LR
     C                     DUMP
     C/COPY WNCPYSRC,ME0600C083
     C                     RETRN
      *
     C                     ENDSR
     C/COPY WNCPYSRC,ME0600C096
      *
     OMGOREFU0E
      /COPY WNCPYSRC,ME0600OOP1                                           S01408
** File translation table for high intensity bytes
ME0600DF227B204A
     X/COPY WNCPYSRC,ME0600X001                                           S01408
**  Months MM/MMM format
01JAN
02FEB
03MAR
04APR
05MAY
06JUN
07JUL
08AUG
09SEP
10OCT
11NOV
12DEC
**  Text
Branch XXX      XXXXXXXXXXXXXXXXXXXX XXX    Settlement - receive XXX
Network XXXXXX  Message type XXX XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX  XXXXXXXX
Sender          XXXXXXXXXXXXXXXXXXXX        Creation date XXXXXXX
Destination     XXXXXXXXXXXXXXXXXXXX        XXXXXXXXXXXXXXXXXXXX XXXXXXXXXX
Message status  XXXXXXXXXXXXXXXXXXXXXXXXX   Date XXXXXXX Time XX:XX:XX
Module XX       Transaction XXXXXXXXXXXXXXX Type XX Subtype XX
Module XX     SWIFT account XXXXXXXXXXXXXXX
External System XXXXXX
Priority XXXXXX Del X Non del X notif.      Error XXX XXX
Testkey req/d?  XXX
C/Pty conf status XXXXXXXXXXXXXXX  Broker conf status XXXXXXXXXXXXXXX
 XXXXXXXXXXX Mod XX  Tr. XXXXXXXXXXXXXXX Type XX Sub XX XXXXX XX XXXX XX
Description          Tag   Data
*P.D.E.*
<MSG DESC NOT FOUND>
* DELETED *
C/Pty
Brok
<TAG DESC NOT FOUND>
<NOT VERIFIED>
Module XX - message input via Message Management
MIDAS testkey returned error message:
MIDAS Testkey program ended in error - see job-log
Unable to generate testkey - not Midas Testkey user
Testkey         X
123456789 123456789 123456789 123456789 123456789 123456789 123456789 12345678
The record for this message is locked. Please refresh screen and re-try
Deliverer of Security
** TABCD/TABNAR - Table of Status/Narrative.
CRTDCreated
AMNDAmended
DLTDDeleted
RSNDReady to send
PENDPending Transmission
TRANTransmitted
EFMTFormat error
ELAULogical Authentication error
ESEQInput sequence number error
ETIDTerminal ID error
ELENMessage length error
EAUTS.W.I.F.T. authentication error
QRDQReady queue error
QVRQVerification queue error
LACKLogically acknowledged
NACKNegatively acknowledged
EBL1Error in basic header
EBL2Error in application header
EBL4Error in text
EBL5Error in trailer
PRTDPrinted (released)
RRTDRe-routed (released)
TSNTSent via Telex                                                        081505
TOUTPending Transmission                                                  081505
TCANCancelled                                                             081505
TRTYIn retry                                                              081505
TACTActive                                                                081505
TSENSent via Telex                                                        066991
THLEHeld - error                                                          081505
THLOHeld by Telex operator                                                066991
TBOXAt Telex box                                                          066991
TCNRCancel requested                                                      081505
TRELHeld on Telex queue                                                   081505
TWTGWaiting                                                               081505
TRTSReady to send                                                         081505
TDESIn despatch                                                           081505
TONQOn Telex queue                                                        066991
TCMPComplete                                                              081505
TUNKTelex status unknown                                                  066991
TRRTOn Telex re-route queue                                               066991
TDLTDeleted                                                               081505
TSPVSupervisor to authorise                                               081561
THORHeld by Originator                                                    CMT001
THTCHeld Time Constraints                                                 CMT001
THLOHeld by Tx/Fx Operator                                                CMT001
TCARAt Carrier                                                            CMT001
THOPHeld by Operator                                                      CMT001
TIRSItem Reset                                                            CMT001
TCNAComplete not accounted yet                                            CMT001
     X/COPY WNCPYSRC,ME0600X003
** VERFY - Message types/fields requiring verification
100:32
200:32                                                                    098075
202:32
203:19
203:30
203:32
103:32
     X/COPY WNCPYSRC,ME0600X002
** TAB1 TAB2 (Counterparty and Broker status)
00NO FEEDBACK YET
01WAITING
02TIMED OUT
50PROPOSED PAIR
51PAIRED ERROR-O
52PAIRED ERROR-T
53PAIRED ERROR-B
54PROPOSED INVEST
97NONE EXPECTED
99PAIRED NO ERROR
** CPY@   **      OBJECT COPYRIGHT
(c) Misys International Banking Systems Ltd. 2001
