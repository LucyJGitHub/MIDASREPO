     H        1
     F*****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas ME Auto-gen criteria analysis')                  *
      *****************************************************************
      *                                                               *
      *  Midas - Message Management Module                            *
      *                                                               *
      *  ME1501 - Auto-Gen Criteria Analysis                          *
      *                                                               *
      *  Function:  This program extracts the required fields from    *
      *             the translation process and checks against the    *
      *             user-defined auto-gen criteria to set up the      *
      *             FT transactions.                                  *
      *                                                               *
      *  Called By: FT0300  - FT Auto Generation                      *
      *  Calls : Programs in MEUCHKPD                                 *
      *                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. MD022652           Date 07Oct13               *
      *  Prev Amend No. CER059             Date 19Jul10               *
      *                 CER045             Date 20Jul09               *
      *                 CER030             Date 09Jul08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 BUG24998           Date 17Jul09               *
      *                 CSW209             Date 01Apr09               *
      *                 BUG24039           Date 01Apr09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 CSW207             Date 19Jun07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CSC022             Date 24Feb04               *
      *                 CGL029             Date 01Sep03               *
      *                 CRE008             Date 10Apr02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 197953             Date 28Nov01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CFT009             Date 25Aug00               *
      *                 CFT014             Date 22Jun00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CFT014             Date 25May00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 177678             Date 25Apr00               *
      *                 CFT007             Date 17Nov99               *
      *                 CFT006             Date 20Oct99               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CFT005             Date 08Jul99               *
      *                 CFT004             DATE 27Jul99               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CGL009             Date 26Jul99               *
      *                 165126             Date 26Jul99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 162508             Date 22Jun99               *
      *                 162490             Date 16Jun99               *
      *                 162380             Date 14Jun99               *
      *                 CFT002  *Create    Date 05May98               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  MD022652 - Excluded Phase Processing                         *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER045 - German Features - Reporting Bundesbank (Recompile)  *
      *  CER030 - Multicash German Feature                            *
      *  BUG24998 - Bank operation code is missing (Recompile)        *
      *  CSW209 - SWIFT 2009 Changes                                  *
      *  BUG24039 - Field P70 error                                   *
      *  CSW207 - SWIFT 2007 Changes                                  *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CSC022 - Commitment Control Changes for MidasPlus            *
      *           (Recompile)                                         *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CRE008 - Cash Management                                     *
      *           Recognise MT101 and MT103 for routing to Cash Mgt   *
      *           Also, if is set to be reported, log test failure    *
      *           for reporting to FT0310.                            *
      *  197953 - Increase Vostro accound code array from 20 to 100   *
      *  CFT009 - FT Fees and Charge Development                      *
      *  CFT014 - Addition of MT103 messages                          *
      *  CFT014 - Straight-through processing Phase 2 MT103           *
      *           Messages Generation for FT.                         *
      *  177678 - Error in autogen analysis exception report          *
      *  CFT007 - BIC Database Plus Integration                       *
      *  CFT006 - MT101/2 message addtion for outgoing/incoming RFT   *
      *  CFT005 - Straight Through Processing Phase 2                 *
      *           Auto-authorisation of STP payments (Recompile)      *
      *  CFT004 - International Bank Account Number                   *
      *  CGL009 - FONTIS IAT/TPP interface                            *
      *  165126 - Allow for the network when selecting a criteria     *
      *  162508 - Allows suffix and operators GT GE LE LT in          *
      *           in user defined checking function                   *
      *  162490 - Field 32 reported wrong in ME1501P1 + tidy up format*
      *  162380 - Allow lower case Compare Value names                *
      *  CFT002 - Straight Through Processing Phase 1 Enhancements    *
      *  CFT002 - Straight Through Processing Phase 1                 *
      *           Based on MEH022 original references:                *
      *           DJBPK3/DJBPK2/S01482/DBF242/DBF215/DBF165/DBF164    *
      *           DBF156/DBF142/DBF083/DBF082/DBF081/DBF080/HUB001    *
      *                                                               *
      *****************************************************************
      *                                                               *
      *  Indicator usage                                              *
      *  ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯                                              *
      *                                                               *
      *  50    First cycle completed                                  *
      *  60    EOF on MEGNCRL0                                        *
      *  61    EOF on MEGNDTL0                                        *
      *  63    Match found on table LOKUP                             *
      *  90    Chain fail                                             *
      *  99    EOF on Read                                            *
      *                                                               *
      *  U7/U8 Error Ocurred                                          *
      *  LR    End program                                            *
      *                                                               *
      *****************************************************************
     F/EJECT
      *****************************************************************
      *                                                               *
      *  S U B R O U T I N E   I N D E X                              *
      *                                                               *
      *   #HINIT   - Initialise and define fields                     *
      *   #HSLCT   - Select message for Auto-Gen. Process             *
      *   #HMATH   - Match the message details against the criteria   *
      *   #HAUDT   - Produce audit list                               *
      *   #HFDDT   - Validate Field Details                           *
      *   #H1AMT   - Validate the First Amount                        *
      *   STRFNC   - *STR function                                    *
      *   SRUCHK   - User defined function check                      *
      *                                                               *
      *****************************************************************
     F/EJECT
      *
      *  Auto-Gen Criteria Control
      *
     FMEGNCRL0IF  E           K        DISK         KINFSR SRFILE
      *
      *  Auto-Gen Criteria Details
      *
     FMEGNDTL0IF  E           K        DISK         KINFSR SRFILE
      *
      *  Incoming Message Detail - multiple formats
      *
     FMEINDTS2IF  E           K        DISK         KINFSR SRFILE
      *
      *  Account master file
      *
     FACCNT   IF  E           K        DISK         KINFSR SRFILE
      *
      *  Account code extension file
      *
     FSDACODL3IF  E           K        DISK
      *
      *  Vostro Account codes
      *
     FSDBRCHL5IF  E           K        DISK
      *
      *  Customer master extension file
      *
     FMEBICDL2IF  E           K        DISK
      *
      *  Message Management Bic Directory
      *
     FMEINMPL1IF  E           K        DISK
      *
      *  Message Management Incoming, Parts
      *
     FSDMTAGL0IF  E           K        DISK
      *
      * Message Tags
      *
     FMEINCRL1IF  E           K        DISK
      *
      * User check programm
      *
     FMEUCHKPDIT  F      15           EDISK
      *                                                                                       CRE008
      * User check programm - Extended use                                                    CRE008
      *                                                                                       CRE008
     FMEECHKPDIT  F      15           EDISK                                                   CRE008
      *
      * SD Country codes                                                                      CFT004
      *                                                                                       CFT004
     FSDCTRYL2IF  E           K        DISK                                                   CFT004
      *                                                                                       CFT004
      *  Exception Audit List
      *
     F/COPY WNCPYSRC,ME1501F001
     F*E1501P1O***E********************PRINTER                        UC  CFT006
     FME1501P1O   E             25     PRINTER                        UC  CFT006
     F/COPY WNCPYSRC,ME1501F002
      /EJECT
     E                    CPY@    1   1 80               Copyright table
     **********           HK1        20  4 0A            Vostro A/c code                      197953
     E**********          HK1       100  4 0A            Vostro A/c code               197953 CGL029
     E                    HK1       100 10 0A                                                 CGL029
     E                    HK2         6 35               Criteria array
     E                    HK3        28  5   HK4   100   Msg Hdr/Trailer
     E                    HK5        28  5   HK6   100   Msg Other dtls
     E    MEUCHKPD        @CK     1 200 15
     E    MEECHKPD        @CE     1 200 15                                                    CRE008
     E/COPY WNCPYSRC,ME1501E001
     E/COPY ZSRSRC,ZDATE1Z1
     E/COPY ZSRSRC,ZHOLE
     E/COPY MECPYSRC,SRERRE
      /EJECT
      *
     ICPYR@#      DS
      *
      *  Data structure for compilation  - Copyright insertion
      *
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
      *
     IRUNDTA    E DSRUNDAT
      *
      *  Define rundat data area
      *
      *
      *  Incoming message details data structures copy member
      *
      /COPY MECPYSRC,SME1100P
     I/COPY WNCPYSRC,ME1501I001
      *                                                                   CRE008
     IINLF      E DSMEINLFPD                                              CRE008
      *
     I************PCRIT     E DSMEGNCRPD                    256           CFT009
     IPCRIT     E DSMEGNCRPD                                              CFT009
      *
      *  Return Criteria Details to calling program
      *
     I            DS
      *
      *  Split the detail fields into field tag name and contents
      *
     I                                        1 256 WUFDDT
     I                                        1   5 WUMTAG
     I                                        6   6 WUFDIN
     I                                        6 256 WUTGCK
     I                                        7 256 WUTGVL
     I**********                              7  24 WUACCO                                    CGL029
     I                                        7  30 WUACCO                                    CGL029
     I**********                              7  120WUCNUM                                    CSD027
     I                                        7  12 WUCNUM                                    CSD027
     I                                        7  12 WUCNUA
     I                                       13  15 WUCURR
     I**********                             16  190WUACCD                                    CGL029
     I**********                             16  19 WUACCA                                    CGL029
     I**********                             20  210WUACSQ                                    CGL029
     I**********                             20  21 WUACSA                                    CGL029
     I**********                             22  24 WUBRCA                                    CGL029
     I**********                             25 256 WUORIG                                    CGL029
     I**********                             25 256 WUO                                       CGL029
     I                                       16  250WUACCD                                    CGL029
     I                                       16  25 WUACCA                                    CGL029
     I                                       26  270WUACSQ                                    CGL029
     I                                       26  27 WUACSA                                    CGL029
     I                                       28  30 WUBRCA                                    CGL029
     I                                       31 256 WUORIG                                    CGL029
     I                                       31 256 WUO                                       CGL029
      ** For FONTIS tag 72 is bigger (no translation possible)            CGL009
     I                                        7 246 F72                   CGL009
     I**********                             25  35 WUSWFT                                    CGL029
     I**********                             36 256 WUNSWF                                    CGL029
     I**********                             60  70 WUSWF2                                    CGL029
     I**********                             71 256 WUNSW2                                    CGL029
     I                                       31  41 WUSWFT                                    CGL029
     I                                       42 256 WUNSWF                                    CGL029
     I                                       66  76 WUSWF2                                    CGL029
     I                                       77 256 WUNSW2                                    CGL029
      *
     I            DS
      *
      *  Split the detail fields into field tag name and contents
      *
     I                                        1 256 WCFDDT
     I                                        1   5 WCMTAG
     I                                        6   6 WCFDIN
     I**********                              7  24 WCACCO                                    CGL029
     I                                        7  30 WCACCO                                    CGL029
     I                                        7  120WCCNUM
     I                                        7  12 WCCNUA
     I                                       13  15 WCCURR
     I**********                             16  190WCACCD                                    CGL029
     I**********                             16  19 WCACCA                                    CGL029
     I**********                             20  210WCACSQ                                    CGL029
     I**********                             20  21 WCACSA                                    CGL029
     I**********                             22  24 WCBRCA                                    CGL029
     I**********                             25 256 WCORIG                                    CGL029
     I**********                             25  35 WCSWFT                                    CGL029
     I**********                             36 256 WCNSWF                                    CGL029
     I**********                             60  70 WCSWF2                                    CGL029
     I**********                             71 256 WCNSW2                                    CGL029
     I                                       16  250WCACCD                                    CGL029
     I                                       16  25 WCACCA                                    CGL029
     I                                       26  270WCACSQ                                    CGL029
     I                                       26  27 WCACSA                                    CGL029
     I                                       28  30 WCBRCA                                    CGL029
     I                                       31 256 WCORIG                                    CGL029
     I                                       31  41 WCSWFT                                    CGL029
     I                                       42 256 WCNSWF                                    CGL029
     I                                       66  76 WCSWF2                                    CGL029
     I                                       77 256 WCNSW2                                    CGL029
      *
      *  Split SWIFT date format into YYMMDD
      *  for Midas date conversion
      *
     I            DS
     I                                        1   6 SWDT
     I                                        1   2 SYY
     I                                        3   4 SMM
     I                                        5   6 SDD
      *
      *  Split Criteria Compare Value
      *
     I            DS
     I                                        1  35 WUCRIT
     I                                        1   1 WUASTK
     I                                        1   5 WUFUNC
     I                                        1   2 WUFUN2                                    162380
     I                                        1   3 WUFUN3                                    162380
     I                                        1   4 WUFUN4
     I                                        1   6 WUFUN6                                    CFT004
     I                                        1   7 WUFUN7                                    CFT004
     I                                        8  35 WIBANV                                    CFT004
     I                                        5   7 WUSLEA
     I                                        5   70WUSLEN
     I                                        8   8 WUBLNK
     I                                        9  35 WUSCMP
     I                                        6  35 WUCODE
     I                                        7   80WUHOUR
     I                                       10  110WUMINS
      *
      * Received date and time as 12 long field
      *
     IRCCOMP      DS                             14
     I                                        1   2 RCCNTY
     I                                        3   80RCDATE
     I                                        3   40RCYEAR
     I                                        3   8 RCDATA
     I                                        9  120RCTIME
     I                                       13  140RCSECS
      *
      * System date and time as 12 long field
      *
     ISYCOMP      DS                             14
     I                                        1   80SYDATE
     I                                        9  140SYTIME
     I                                        9  100SYHOUR
     I                                       11  120SYMINS
     I                                       13  140SYSECS
      *
      *  Combine 6 Criteria Compare Values from the record
      *  into an array
      *
     I            DS
     I                                        1 210 HK2
     I                                        1 210 WUCRIA
     I                                        1  35 GDCMP1
     I                                       36  70 GDCMP2
     I                                       71 105 GDCMP3
     I                                      106 140 GDCMP4
     I                                      141 175 GDCMP5
     I                                      176 210 GDCMP6
     I            DS
     I                                        1 140 WUHK3
     I                                        1 140 HK3
     I            DS
     I                                        1 140 WUHK5
     I                                        1 140 HK5
     IMEDTA       DS
     I                                        1   3 O#MTPY
     I                                        4   60O#MSET
     I                                        7  36 O#DESC
     I                                       37  66 O#DES2
     ILGDTA       DS                                                                          CRE008
     I                                        1   3 L#MTPY                                    CRE008
     I                                        4   60L#MSET                                    CRE008
     I                                        7   90L#CSEQ                                    CRE008
     I                                       10 240 L#CRIT                                    CRE008
     I@CKDS       DS
     I                                        1   5 @CKFNC
     I                                        6  15 @CKPGM
      *
      ** To check wether a field is numeric
     I              '0123456789'          C         WNUMB
      *
     I              'abcdefghijklmnopqrst-C         LW                                        162380
     I              'uvwxyz'                                                                  162380
     I              'ABCDEFGHIJKLMNOPQRST-C         UP                                        162380
     I              'UVWXYZ'                                                                  162380
      *
      *  Data Structures used by Access Objects
      *
     I/COPY WNCPYSRC,ME1501I002
     IDSFDY     E DSDSFDY
      *
     ISDBANK    E DSSDBANKPD
     ISDCUST    E DSSDCUSTPD
     ISDNOST    E DSSDNOSTPD
     I*                                                                   CFT004
     ISCSARD    E DSSCSARDPD                                              CFT007
     I* External data structure for SAR file details                      CFT004
      *
      *  Data structures used by holiday checking
      *
     I/COPY ZSRSRC,ZHOLI
     I/COPY ZSRSRC,ZHOLDS
      *
      *  End of Program Error Processing copysource member
      *
     I/COPY MECPYSRC,SRERRI
      *
      /EJECT
      *****************************************************************
      *                 M A I N L I N E
      *****************************************************************
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'MAIN'    @STK,Q
      *
      *  Define entry parameters
      *
     C           *ENTRY    PLIST
     C                     PARM           W0ACT   8        Action code
     C                     PARM           PHEAD            General Details
     C                     PARM           PDATA            Message Details
     C                     PARM           PDAT2                                               CSW209
     C/COPY WNCPYSRC,ME1501C004
     C                     PARM           PCRIT            CriteriaDetails
     C                     PARM           W0RTN   7        Return Code
     C                     PARM           W0CPGM 10        Program for msgs
     C                     PARM           P@RETV256        Return value                       CRE008
     C/COPY WNCPYSRC,ME1501C009
      *
      * Initialise program
      *
     C           *IN50     IFEQ '0'
     C                     EXSR #HINIT
     C                     ENDIF
      *
      *  Determine whether Auto-Gen of FT transaction is required :-
      *
     C                     EXSR #HSLCT
      *
      *  set up return code
      *
     C           WUPYTP    IFEQ *BLANKS
     C                     MOVEL'MIN0083' W0RTN
     C                     ELSE
     C                     MOVEL'MIN0096' W0RTN
     C                     ENDIF
      *
      *  Unwind subroutine stack name
      *
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
      *  Return to calling program
      *
     C                     RETRN
      /EJECT
      *****************************************************************
      *                                                               *
      *  #HSLCT   : Select message for Auto-Gen. Process              *
      *                                                               *
      *  CALLED BY: Main processing section                           *
      *                                                               *
      *  CALLS    : MATCH   - Check the details against criteria      *
      *                                                               *
      *****************************************************************
     CSR         #HSLCT    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'#HSLCT'  @STK,Q
      *
      *  Initialise the return parameter of the subroutine
      *
     C                     MOVE *BLANKS   WUPYTP  2
     C                     MOVE *BLANKS   WUPYST  2                       CRE008
     C/COPY WNCPYSRC,ME1501C010
      *
      *  Position to first Criteria Set
      *
     C                     Z-ADD*ZEROS    GNMSET
     C           KYGNCR    SETLL@GNCRPD              60
     C           *IN60     IFEQ '0'
     C           KYGNC2    READE@GNCRPD                  60
     C                     END
      *
      *  If record not found - should not be auto-gen
      *
     C           *IN60     IFEQ '1'
     C                     MOVE *BLANKS   WUPYTP
     C                     ELSE
      *
      *  Loop until all criteria within the Set are processed
      *
     C           KYGNCR    SETLL@GNCRPD              60
     C           *IN60     DOWEQ'0'
     C           WUPYTP    ANDEQ*BLANKS
      *
      *  Access Auto-Gen Criteria Control File
      *
     C           KYGNC2    READE@GNCRPD                  60
      *                                                                   CRE008
     C                     MOVE *BLANKS   WFRULE  1                       CRE008
      *
      *  If record found - continue analysis
      *
     C           *IN60     IFEQ '0'
      *                                                                   CGL009
     C/COPY WNCPYSRC,MEH00018
      * FONTIS and SWIFT can have the same message type (100) so          CGL009
      * we take account of the network in the criteria selection          165126
     C           GNNWRK    IFNE PNWRK                                     165126
      * Read next criterion                                               165126
     C                     ITER                                           165126
     C                     ENDIF                                          165126
      *                                                                   165126
      *
      *  Set up Payment type beforehand
      *  and subtype too...                                               CRE008
      *
     C                     MOVE GNPYTP    WUPYTP
     C                     MOVE GNPYST    WUPYST                          CRE008
      *
      *  Position to first tag in the Criteria Set
      *
     C                     Z-ADDGNMSET    GDMSET
     C                     Z-ADD*ZEROS    GDCSEQ
     C           KYGNDT    SETLL@GNDTPD              61
     C           *IN61     IFEQ '0'
     C           KYGNCR    READE@GNDTPD                  61
     C                     END
      *
      *  If record found - continue analysis
      *
     C           *IN61     IFEQ '0'
      *
      *  Loop until all criteria within the Set are processed
      *  or any of the criteria is not satisfied
      *
     C                     Z-ADD1         H3      20
     C                     Z-ADD1         H4      20
     C                     MOVEA*BLANKS   HK3
     C                     MOVEA*BLANKS   HK4
     C           KYGNDT    SETLL@GNDTPD              61
     C           *IN61     DOUEQ'1'
     C           WUPYTP    OREQ *BLANKS
      *
      *  Access Auto-Gen Criteria Details File
      *
     C           KYGNCR    READE@GNDTPD                  61
      *
      *  If record found - Check whether the criteria is matched
      *
     C           *IN61     IFEQ '0'
      *                                                                   CRE008
      ** But first, check if test needs logging...                        CRE008
     C           WFRULE    IFNE 'Y'                                       CRE008
     C           GDREPT    ANDEQ'Y'                                       CRE008
     C                     MOVELGNMTPY    O#MTPY                          CRE008
     C                     MOVELGNMSET    O#MSET                          CRE008
     C                     MOVELGNDESC    O#DESC                          CRE008
     C                     MOVELGNDES2    O#DES2                          CRE008
     C                     MOVELMEDTA     MEMSDT    P                     CRE008
     C                     MOVELW0CPGM    MEPGMQ                          CRE008
     C                     MOVEL'MIN0505' MEMSID                          CRE008
     C                     MOVEL'MEMSG'   MEMSGF           Msg file       CRE008
     C                     EXSR MESNMS                                    CRE008
     C                     MOVEL'Y'       WFRULE                          CRE008
     C                     ENDIF                                          CRE008
      *                                                                   CRE008
      ** Now check proceed with checking....                              CRE008
     C                     EXSR #HMATH
     C                     ENDIF
      *
     C                     ENDDO
     C                     ENDIF
     C                     ENDIF
     C                     ENDDO
     C                     ENDIF
      *
      *  Set up return action code
      *
     C                     SELEC
     C           WUPYTP    WHEQ 'IN'
     C                     MOVEL'*INC FT 'W0ACT
      *
      * Send message for rule that was found
      *
     C                     MOVELGNMTPY    O#MTPY
     C                     MOVELGNMSET    O#MSET
     C                     MOVELGNDESC    O#DESC
     C                     MOVELGNDES2    O#DES2
     C                     MOVELMEDTA     MEMSDT    P
     C                     MOVELW0CPGM    MEPGMQ
     C                     MOVEL'MIN0260' MEMSID
     C                     MOVEL'MEMSG'   MEMSGF           Msg file
     C                     EXSR MESNMS
      *
     C           WUPYTP    WHEQ 'OP'
     C                     MOVEL'*OUT FT 'W0ACT
      *
      * Send message for rule that was found
      *
     C                     MOVELGNMTPY    O#MTPY
     C                     MOVELGNMSET    O#MSET
     C                     MOVELGNDESC    O#DESC
     C                     MOVELGNDES2    O#DES2
     C                     MOVELMEDTA     MEMSDT    P
     C                     MOVELW0CPGM    MEPGMQ
     C                     MOVEL'MIN0261' MEMSID
     C                     MOVEL'MEMSG   'MEMSGF           Msg file
     C                     EXSR MESNMS
      *                                                                   CFT006
      ** If the switchable feature, CFT006, is on then do new processing  CFT006
      *                                                                   CFT006
      ** If message type is MT101 'RI' set up return action               CFT006
      *                                                                   CFT006
     C           WUPYTP    WHEQ 'RI'                                      CFT006
     C           CFT006    ANDEQ'Y'                                       CFT006
     C                     MOVEL'*RFT IN 'W0ACT                           CFT006
      *                                                                   CFT006
      * Send message for rule that was found                              CFT006
      *                                                                   CFT006
     C                     MOVELGNMTPY    O#MTPY                          CFT006
     C                     MOVELGNMSET    O#MSET                          CFT006
     C                     MOVELGNDESC    O#DESC                          CFT006
     C                     MOVELGNDES2    O#DES2                          CFT006
     C                     MOVELMEDTA     MEMSDT    P                     CFT006
     C                     MOVELW0CPGM    MEPGMQ                          CFT006
     C                     MOVEL'MIN0260' MEMSID                          CFT006
     C                     MOVEL'MEMSG'   MEMSGF           Msg file       CFT006
     C                     EXSR MESNMS                                    CFT006
      *                                                                   CFT006
      ** If message type is MT102 'BI' set up return action               CFT006
      *                                                                   CFT006
     C           WUPYTP    WHEQ 'BI'                                      CFT006
     C           CFT008    ANDEQ'Y'                                       CFT006
     C                     MOVEL'*CCT IN 'W0ACT                           CFT006
      *                                                                   CFT006
      * Send message for rule that was found                              CFT006
      *                                                                   CFT006
     C                     MOVELGNMTPY    O#MTPY                          CFT006
     C                     MOVELGNMSET    O#MSET                          CFT006
     C                     MOVELGNDESC    O#DESC                          CFT006
     C                     MOVELGNDES2    O#DES2                          CFT006
     C                     MOVELMEDTA     MEMSDT    P                     CFT006
     C                     MOVELW0CPGM    MEPGMQ                          CFT006
     C                     MOVEL'MIN0260' MEMSID                          CFT006
     C                     MOVEL'MEMSG'   MEMSGF           Msg file       CFT006
     C                     EXSR MESNMS                                    CFT006
      *
      ** If message type is MT101 'CM' set up return action               CRE008
      *                                                                   CRE008
     C           WUPYTP    WHEQ 'CM'                                      CRE008
     C           CRE008    ANDEQ'Y'                                       CRE008
     C*                                                                   CRE008
     C                     SELEC                                          CRE008
     C           WUPYST    WHEQ 'MT'                                      CRE008
     C                     MOVEL'*CM 101 'W0ACT                           CRE008
     C           WUPYST    WHEQ 'MR'                                      CRE008
     C                     MOVEL'*CM 103R'W0ACT                           CRE008
     C           WUPYST    WHEQ 'MS'                                      CRE008
     C                     MOVEL'*CM 103S'W0ACT                           CRE008
     C                     ENDSL                                          CRE008
      *                                                                   CRE008
      * Send message for rule that was found                              CRE008
      *                                                                   CRE008
     C                     MOVELGNMTPY    O#MTPY                          CRE008
     C                     MOVELGNMSET    O#MSET                          CRE008
     C                     MOVELGNDESC    O#DESC                          CRE008
     C                     MOVELGNDES2    O#DES2                          CRE008
     C                     MOVELMEDTA     MEMSDT    P                     CRE008
     C                     MOVELW0CPGM    MEPGMQ                          CRE008
     C                     MOVEL'MIN0504' MEMSID                          CRE008
     C                     MOVEL'MEMSG'   MEMSGF                          CRE008
     C                     EXSR MESNMS                                    CRE008
      *                                                                   CRE008
      * If Payment type is '**' then action is ignore
      *
     C           WUPYTP    WHEQ '**'
     C                     MOVEL'*IGNORE 'W0ACT
      *
      * Send message for rule that was found
      *
     C                     MOVELGNMTPY    O#MTPY
     C                     MOVELGNMSET    O#MSET
     C                     MOVELGNDESC    O#DESC
     C                     MOVELGNDES2    O#DES2
     C                     MOVELMEDTA     MEMSDT    P
     C                     MOVELW0CPGM    MEPGMQ
     C                     MOVEL'MIN0262' MEMSID
     C                     MOVEL'MEMSG'   MEMSGF           Msg file
     C                     EXSR MESNMS
      *
      * If Payment type is '++' then action is manually process
      *
     C           WUPYTP    WHEQ '++'
     C                     MOVEL*BLANKS   W0ACT
      *
      * Send message for rule that was found
      *
     C                     MOVELGNMTPY    O#MTPY
     C                     MOVELGNMSET    O#MSET
     C                     MOVELGNDESC    O#DESC
     C                     MOVELGNDES2    O#DES2
     C                     MOVELMEDTA     MEMSDT    P
     C                     MOVELW0CPGM    MEPGMQ
     C                     MOVEL'MIN0263' MEMSID
     C                     MOVEL'MEMSG'   MEMSGF           Msg file
     C                     EXSR MESNMS
     C                     OTHER
     C                     MOVEL*BLANKS   W0ACT
     C                     ENDSL
      *
      *  Produce audit list
      *
     C           GNEXCP    IFEQ 'Y'
     C           W0ACT     OREQ *BLANKS
     C                     EXSR #HAUDT
     C                     ENDIF
      *
      *  Unwind subroutine stack name
      *
     C           #HXSLC    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
      *****************************************************************
      *                                                               *
      *  #HMATH   : Match the message details against the criteria    *
      *                                                               *
      *  CALLED BY: SELECT                                            *
      *                                                               *
      *  CALLS    :                                                   *
      *                                                               *
      *****************************************************************
     CSR         #HMATH    BEGSR
      ** CAUTION :
      ** =========
      ** Part of this subroutine has been duplicated in program ME1503
      ** Therefore any amendments here are to be reported in the other
      ** program.
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'#HMATH'  @STK,Q
      *
      *  Initialise the work fields
      *
     C                     MOVE *BLANKS   WUMATH  1
     C                     MOVE *BLANKS   WUFDDT
     C                     MOVE *LOVAL    WKPART
     C/COPY WNCPYSRC,ME1501C005
      *
      *  Depends on the message tag
      *  set up details
      *  and
      *  pass to validation routine
      *
     C                     SELEC
     C/COPY WNCPYSRC,ME1501C011
      *
     C           GDMTAG    WHEQ ':20: '                    Trans Ref
     C           GDMTAG    OREQ 'BJ20 '                    Trans Ref
      *                                                                   CFT006
     C           GDHDTG    IFEQ 'N'                                       CFT006
     C                     MOVELP20       WUFDDT
     C                     ELSE                                           CFT006
     C                     MOVELPH20      WUFDDT                          CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     EXSR #HFDDT
      *
     C           GDMTAG    WHEQ ':21: '                    Related Ref
     C           GDMTAG    OREQ 'BJ21 '                    Related Ref
     C                     MOVELP21       WUFDDT
     C                     EXSR #HFDDT
      *
     C           GDMTAG    WHEQ ':32A:'                    1st amount A
     C           GDMTAG    OREQ ':32B:'                    1st amount A
     C           GDMTAG    OREQ ':32C:'                    1st amount C
     C           GDMTAG    OREQ ':32D:'                    1st amount D
     C           GDMTAG    OREQ ':32P:'                    1st amount P
     C           GDMTAG    OREQ ':32R:'                    1st amount R
     C           GDMTAG    OREQ 'BJ32 '                    1st amount BOJ
      *                                                                   CFT006
     C           GDHDTG    IFEQ 'N'                                       CFT006
      *                                                                   CFT006
     C           GDMTAG    IFEQ ':32B:'                                   CFT006
      *                                                                   CFT006
     C           GDMTPY    IFEQ '101'                                     CFT006
     C           GDMTPY    OREQ '102'                                     CFT006
     C                     MOVELP32B      WUFDDT                          CFT006
     C                     ELSE                                           CFT006
     C                     MOVELPDCA      WUFDDT
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     ELSE                                           CFT006
     C                     MOVELPDCA      WUFDDT                          CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     ELSE                                           CFT006
     C                     MOVELPH32A     WUFDDT                          CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     EXSR #H1AMT
      *
     C           GDMTAG    WHEQ ':50: '                    Ord Cust
     C           GDMTAG    OREQ ':50H:'                    Ord Cust       CFT006
     C           GDMTAG    OREQ ':50A:'                    Ord Cust       CFT014
     C           GDMTAG    OREQ ':50K:'                    Ord Cust       CFT014
     C           GDMTAG    OREQ ':50F:'                    Ord Cust       CSW207
     C           GDMTAG    OREQ 'BJ50D'                    Ord Cust
      *                                                                   CFT006
     C           GDMSEQ    IFEQ 'B'                                                           CSW209
     C           CSW209    ANDEQ'Y'                                                           CSW209
     C                     MOVELPB50      WUFDDT                                              CSW209
     C                     ELSE                                                               CSW209
     C           GDHDTG    IFEQ 'N'                                       CFT006
     C                     MOVELP50       WUFDDT
     C                     ELSE                                           CFT006
     C                     MOVELPH50      WUFDDT                          CFT006
     C                     ENDIF                                          CFT006
     C                     ENDIF                                                              CSW209
      *                                                                   CFT006
     C                     EXSR #HFDDT
      *
     C           GDMTAG    WHEQ ':52A:'                    Ord Bank
     C           GDMTAG    OREQ ':52B:'                    Ord Bank       CFT006
     C           GDMTAG    OREQ ':52C:'                    Ord Bank       CFT006
     C           GDMTAG    OREQ ':52D:'                    Ord Bank
     C           GDMTAG    OREQ 'BJ52D'                    Ord Bank
      *                                                                   CFT006
     C           GDMSEQ    IFEQ 'B'                                                           CSW209
     C           CSW209    ANDEQ'Y'                                                           CSW209
     C                     MOVELPB52      WUFDDT                                              CSW209
     C                     ELSE                                                               CSW209
     C           GDHDTG    IFEQ 'N'                                       CFT006
     C                     MOVELP52       WUFDDT
     C                     ELSE                                           CFT006
     C                     MOVELPH52      WUFDDT                          CFT006
     C                     ENDIF                                          CFT006
     C                     ENDIF                                                              CSW209
      *                                                                   CFT006
     C                     EXSR #HFDDT
      *
     C           GDMTAG    WHEQ ':53A:'                    Sndr Corr
     C           GDMTAG    OREQ ':53B:'                    Sndr Corr
     C           GDMTAG    OREQ ':53C:'                    Sndr Corr      CFT006
     C           GDMTAG    OREQ ':53D:'                    Sndr Corr
      *                                                                   CFT006
     C           GDHDTG    IFEQ 'N'                                       CFT006
     C                     MOVELP53       WUFDDT
     C                     ELSE                                           CFT006
     C                     MOVELPH53      WUFDDT                          CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     EXSR #HFDDT
      *
     C           GDMTAG    WHEQ ':54A:'                    Rcvr Corr
     C           GDMTAG    OREQ ':54B:'                    Rcvr Corr
     C           GDMTAG    OREQ ':54D:'                    Rcvr Corr
      *                                                                   CFT006
     C           GDHDTG    IFEQ 'N'                                       CFT006
     C                     MOVELP54       WUFDDT
     C                     ELSE                                           CFT006
     C                     MOVELPH54      WUFDDT                          CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     EXSR #HFDDT
      *                                                                   CFT014
     C           GDMTAG    WHEQ ':55A:'                    3rd Reim Inst  CFT014
     C           GDMTAG    OREQ ':55B:'                    3rd Reim Inst  CFT014
     C           GDMTAG    OREQ ':55D:'                    3rd Reim Inst  CFT014
     C                     MOVELP55       WUFDDT                          CFT014
     C                     EXSR #HFDDT                                    CFT014
      *
     C           GDMTAG    WHEQ ':56A:'                    Intermediary
     C           GDMTAG    OREQ ':56C:'                    Intermediary   CFT006
     C           GDMTAG    OREQ ':56D:'                    Intermediary
     C           GDMSEQ    IFEQ 'B'                                                           CSW209
     C           CSW209    ANDEQ'Y'                                                           CSW209
     C                     MOVELPB56      WUFDDT                                              CSW209
     C                     ELSE                                                               CSW209
     C                     MOVELP56       WUFDDT
     C                     ENDIF                                                              CSW209
     C                     EXSR #HFDDT
      *
     C           GDMTAG    WHEQ ':57A:'                    A/c with Inst
     C           GDMTAG    OREQ ':57B:'                    A/c with Inst
     C           GDMTAG    OREQ ':57C:'                    A/c with Inst  CFT006
     C           GDMTAG    OREQ ':57D:'                    A/c with Inst
     C           GDMTAG    OREQ 'BJ57D'                    A/c with Inst
     C           GDMSEQ    IFEQ 'B'                                                           CSW209
     C           CSW209    ANDEQ'Y'                                                           CSW209
     C                     MOVELPB57      WUFDDT                                              CSW209
     C                     ELSE                                                               CSW209
     C                     MOVELP57       WUFDDT
     C                     ENDIF                                                              CSW209
     C                     EXSR #HFDDT
      *
     C           GDMTAG    WHEQ ':58A:'                    Beneficiary
     C           GDMTAG    OREQ ':58D:'                    Beneficiary Bank
     C           GDMTAG    OREQ 'BJ58D'                    Beneficiary Bank
     C                     MOVELP58       WUFDDT
     C                     EXSR #HFDDT
      *
     C           GDMTAG    WHEQ ':59: '                    Beneficiary Cust
     C           GDMTAG    OREQ ':59A:'                    Beneficiary Cust CFT014
     C           GDMTAG    OREQ 'BJ59D'                    Beneficiary Cust
     C           GDMSEQ    IFEQ 'B'                                                           CSW209
     C           CSW209    ANDEQ'Y'                                                           CSW209
     C                     MOVELPB59      WUFDDT                                              CSW209
     C                     ELSE                                                               CSW209
     C                     MOVELP59       WUFDDT
     C                     ENDIF                                                              CSW209
     C                     EXSR #HFDDT
      *
     C           GDMTAG    WHEQ ':72: '                    Bank-bank info
     C           GDMTAG    OREQ 'BJ72 '                    Bank-bank info
      *                                                                   CFT006
     C           GDMSEQ    IFEQ 'B'                                                           CSW209
     C           CSW209    ANDEQ'Y'                                                           CSW209
     C                     MOVELPB72      WUFDDT                                              CSW209
     C                     ELSE                                                               CSW209
     C           GDHDTG    IFEQ 'N'                                       CFT006
     C                     MOVELP72       WUFDDT
     C                     ELSE                                           CFT006
     C                     MOVELPH72      WUFDDT                          CFT006
     C                     ENDIF                                          CFT006
     C                     ENDIF                                                              CSW209
      *                                                                   CFT006
     C                     EXSR #HFDDT
     C/COPY WNCPYSRC,ME1501C001
      *
     C           GDMTAG    WHEQ 'SNDR '                    Sender
     C                     MOVELPSN       WUFDDT
     C                     EXSR #HFDDT
     C/COPY WNCPYSRC,ME1501C012
      *                                                                   CFT006
     C           GDMTAG    WHEQ ':21R:'                    Cust ref       CFT006
      *                                                                   CFT006
     C           GDHDTG    IFEQ 'Y'                                       CFT006
     C                     MOVELPH21R     WUFDDT                          CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     EXSR #HFDDT                                    CFT006
      *                                                                   CFT006
     C           GDMTAG    WHEQ ':50L:'                    Inst Party     CFT006
      *                                                                   CFT006
     C           GDHDTG    IFEQ 'N'                                       CFT006
     C                     MOVELP50L      WUFDDT                          CFT006
     C                     ELSE                                           CFT006
     C                     MOVELPH50L     WUFDDT                          CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     EXSR #HFDDT                                    CFT006
      *                                                                   CFT006
     C           GDMTAG    WHEQ ':51A:'                    Sending Ins    CFT006
      *                                                                   CFT006
     C           GDHDTG    IFEQ 'Y'                                       CFT006
     C                     MOVELPH51A     WUFDDT                          CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     EXSR #HFDDT                                    CFT006
      *                                                                   CFT006
     C           GDMTAG    WHEQ ':30: '                    Exec date      CFT006
      *                                                                   CFT006
     C           GDHDTG    IFEQ 'Y'                                       CFT006
     C                     MOVELPH30      WUFDDT                          CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     EXSR #HFDDT                                    CFT006
      *                                                                   CFT006
     C           GDMTAG    WHEQ ':25: '                    Authoris.      CFT006
      *                                                                   CFT006
     C           GDHDTG    IFEQ 'Y'                                       CFT006
     C                     MOVELPH25      WUFDDT                          CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     EXSR #HFDDT                                    CFT006
      *                                                                   CFT006
     C           GDMTAG    WHEQ ':21F:'                    Fx Ref         CFT006
      *                                                                   CFT006
     C                     MOVELP21F      WUFDDT                          CFT006
      *                                                                   CFT006
     C                     EXSR #HFDDT                                    CFT006
      *                                                                   CFT014
     C           GDMTAG    WHEQ ':23B:'                    Bnk Op Cde     CFT014
      *                                                                   CFT014
     C                     MOVELP23B      WUFDDT                          CFT014
      *                                                                   CFT014
     C                     EXSR #HFDDT                                    CFT014
      *                                                                   CFT006
     C           GDMTAG    WHEQ ':23E:'                    Inst Code      CFT006
      *                                                                   CFT006
     C                     MOVELP23E      WUFDDT                          CFT006
      *                                                                   CFT006
     C                     EXSR #HFDDT                                    CFT006
      *                                                                   CFT006
     C           GDMTAG    WHEQ ':77B:'                    Reg Report.    CFT006
      *                                                                   CFT006
     C           GDHDTG    IFEQ 'N'                                       CFT006
     C                     MOVELP77B      WUFDDT                          CFT006
     C                     ELSE                                           CFT006
     C                     MOVELPH77B     WUFDDT                          CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     EXSR #HFDDT                                    CFT006
      *                                                                   CFT006
     C           GDMTAG    WHEQ ':33B:'                    Orig Amount    CFT006
     C           GDMSEQ    IFEQ 'B'                                                           CSW209
     C           CSW209    ANDEQ'Y'                                                           CSW209
     C                     MOVELPB33B     WUFDDT                                              CSW209
     C                     ELSE                                                               CSW209
     C                     MOVELP33B      WUFDDT                          CFT006
     C                     ENDIF                                                              CSW209
     C                     EXSR #H1AMT                                    CFT006
      *                                                                   CFT006
     C           GDMTAG    WHEQ ':25A:'                    Charges acc    CFT006
     C                     MOVELP25A      WUFDDT                          CFT006
     C                     EXSR #HFDDT                                    CFT006
      *                                                                   CFT006
     C           GDMTAG    WHEQ ':36: '                    Exchg Rate     CFT006
      *                                                                   CFT006
     C           GDHDTG    IFEQ 'N'                                       CFT006
     C                     MOVELP36       WUFDDT                          CFT006
     C                     ELSE                                           CFT006
     C                     MOVELPH36      WUFDDT                          CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     EXSR #HFDDT                                    CFT006
      *                                                                   CFT006
     C           GDMTAG    WHEQ ':23: '                    Bank Opcd      CFT006
      *                                                                   CFT006
     C           GDHDTG    IFEQ 'Y'                                       CFT006
     C                     MOVELPH23      WUFDDT                          CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     EXSR #HFDDT                                    CFT006
      *                                                                   CFT006
     C           GDMTAG    WHEQ ':26T:'                    Trns Code      CFT006
      *                                                                   CFT006
     C           GDHDTG    IFEQ 'N'                                       CFT006
     C                     MOVELP26T      WUFDDT                          CFT006
     C                     ELSE                                           CFT006
     C                     MOVELPH26T     WUFDDT                          CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     EXSR #HFDDT                                    CFT006
      *                                                                   CFT006
     C           GDMTAG    WHEQ ':71F:'                    Sender Charg   CFT006
      *                                                                   CFT006
     C           GDHDTG    IFEQ 'N'                                       CFT006
      ** FT field: Senders Charges can have multiples lines               CFT014
      ** (e.g. MT103)                                                     CFT014
     C           P71FX     IFEQ *BLANK                                    CFT014
     C                     MOVELP71F      WUFDDT                          CFT006
     C                     ELSE                                           CFT014
     C                     MOVELP71FX     WUFDDT                          CFT014
     C                     ENDIF                                          CFT014
     C                     ELSE                                           CFT006
     C                     MOVELPH71F     WUFDDT                          CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     EXSR #H1AMT                                    CFT006
      *                                                                   CFT006
     C           GDMTAG    WHEQ ':71G:'                    Recv Charg     CFT006
      *                                                                   CFT006
     C           GDHDTG    IFEQ 'N'                                       CFT006
     C                     MOVELP71G      WUFDDT                          CFT006
     C                     ELSE                                           CFT006
     C                     MOVELPH71G     WUFDDT                          CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     EXSR #H1AMT                                    CFT006
      *                                                                   CRE008
     C           GDMTAG    WHEQ ':70: '                    Det of Pay     CRE008
      *                                                                   CRE008
     C                     MOVELP70       WUFDDT                          CRE008
      *                                                                   CRE008
     C                     EXSR #HFDDT                                    CRE008
      *                                                                                       CER030
     C           GDMTAG    WHEQ 'PEXN'                                                        CER030
      *                                                                                       CER030
     C           CER031    IFEQ 'Y'                                                           CER030
     C                     MOVELPEXN      WUFDDT                                              CER030
     C                     EXSR #HFDDT                                                        CER030
     C                     ENDIF                                                              CER030
      *                                                                   CFT006
     C           GDMTAG    WHEQ ':19: '                    Sum Amt        CFT006
      *                                                                   CFT006
     C           GDHDTG    IFEQ 'Y'                                       CFT006
     C                     MOVELPH19      WUFDDT                          CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     EXSR #HFDDT                                    CFT006
      *                                                                   CFT006
     C           GDMTAG    WHEQ ':71:'                     Detl of Chrge  CFT006
     C           GDMTAG    OREQ ':71A:'                    Detl of Chrge  CFT006
      *                                                                   CFT006
     C           GDHDTG    IFEQ 'N'                                       CFT006
     C                     MOVELP71       WUFDDT                          CFT006
     C                     ELSE                                           CFT006
     C                     MOVELPH71      WUFDDT                          CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     EXSR #HFDDT                                    CFT006
      *
     C           GDMTAG    WHEQ ':70:'                                                      BUG24039
     C           GDMSEQ    IFEQ 'B'                                                           CSW209
     C           CSW209    ANDEQ'Y'                                                           CSW209
     C                     MOVELPB70      WUFDDT                                              CSW209
     C                     ELSE                                                               CSW209
     C                     MOVELP70       WUFDDT                                            BUG24039
     C                     ENDIF                                                              CSW209
     C                     EXSR #HFDDT                                                      BUG24039
      *                                                                                     BUG24039
     C           GDMTAG    WHEQ '103:'                                                        CSW209
     C           CSW209    ANDEQ'Y'                                                           CSW209
     C                     MOVELP103      WUFDDT                                              CSW209
      *                                                                                       CSW209
     C                     EXSR #HFDDT                                                        CSW209
      *                                                                                       CSW209
     C           GDMTAG    WHEQ '1:   '                    Header Blk 1
     C           GDMTAG    OREQ '2:   '                    Header Blk 2
     C           GDMTAG    OREQ '3:   '                    Header Blk 3
     C           GDMTAG    OREQ '4:   '                    Header Blk 4
     C           GDMTAG    OREQ '5:   '                    Header Blk 5
     C           GDMTAG    OREQ 'BJ06 '                    Authen'n Code
     C           GDMTAG    OREQ 'S:   '                    Trailer Blk S
     C           GDMTAG    OREQ 'CHK: '                    Checksum
     C           GDMTAG    OREQ 'COP: '                    COP???
     C           GDMTAG    OREQ 'DLM: '                    Delayed message
     C           GDMTAG    OREQ 'ENC: '                    Encryption
     C           GDMTAG    OREQ 'MAC: '                    Authen'n Code
     C           GDMTAG    OREQ 'PDE: '                    Possible Dup.
     C           GDMTAG    OREQ 'PDM: '                    Possible Dup.
     C           GDMTAG    OREQ 'QTA: '                    Interruption
     C           GDMTAG    OREQ 'REJ: '                    Rejection
     C           GDMTAG    OREQ 'RTV: '                    Retrieved msg
     C           GDMTAG    OREQ 'SUP: '                    Supervisor msg
     C           GDMTAG    OREQ 'SAB: '                    Auth'n bypassed
     C           GDMTAG    OREQ 'SAC: '                    Auth'n correct
     C           GDMTAG    OREQ 'SAI: '                    Auth'n incorrec
     C           GDMTAG    OREQ 'SAO: '                    Auth'n correct
     C           GDMTAG    OREQ 'SPD: '                    Sys Poss Dup
     C           GDMTAG    OREQ 'SYS: '                    Sys Originated
     C           GDMTAG    OREQ 'TNG: '                    Training
     C           GDMTAG    OREQ 'TRN: '                    Trans Ref
     C           GDMTAG    OREQ 'UND: '                    Unroutable msg
     C           GDMTAG    OREQ '11R: '                    Original msg
     C           GDMTAG    OREQ '11S: '                    Original msg
     C           GDMTAG    OREQ '108: '                                                       CSW209
     C           CSW209    ANDEQ'Y'                                                           CSW209
     C           GDMTAG    OREQ '113: '                                                       CSW209
     C           CSW209    ANDEQ'Y'                                                           CSW209
     C           GDMTAG    OREQ '115: '                                                       CSW209
     C           CSW209    ANDEQ'Y'                                                           CSW209
     C           GDMTAG    OREQ '119: '                                                       CSW209
     C           CSW209    ANDEQ'Y'                                                           CSW209
     C                     Z-ADD0         WKPART
     C           KYINDT    SETLLMEINDTS2                 99
     C           *IN99     IFEQ '1'
     C           KYINDT    READEMEINDTS2                 99
     C           *IN99     IFEQ '0'
     C           GDMTAG    IFEQ '2:   '
     C                     MOVELDTMFLD    WUFDDT
     C                     ELSE
     C                     MOVELDSMF35    WUFDDT
     C                     ENDIF
     C                     MOVE WUMTAG    HK3,H3
     C                     MOVE WUORIG    HK4,H3
     C                     ENDIF
     C                     ELSE
     C                     MOVE *BLANKS   WUFDDT
     C                     ENDIF
     C                     EXSR #HFDDT
      *
     C                     OTHER                           Other details
     C           KYINDT    SETLLMEINDTS2                 99
     C           *IN99     IFEQ '1'
     C           KYINDT    READEMEINDTS2                 99
     C           *IN99     IFEQ '0'
     C           GDMTAG    IFEQ '2:   '
     C                     MOVELDTMFLD    WUFDDT
     C                     ELSE
     C                     MOVELDSMF35    WUFDDT
     C                     ENDIF
     C                     MOVE WUMTAG    HK5,H4
     C                     MOVE WUORIG    HK6,H4
     C                     ENDIF
     C                     ENDIF
     C                     EXSR #HFDDT
      *
     C                     ENDSL
      *
      *  If criteria not match, blank out Payment type
      *
     C           WUMATH    IFEQ *BLANK
     C                     MOVE *BLANKS   WUPYTP
     C                     MOVE *BLANKS   WUPYST                          CRE008
      *                                                                   CRE008
      *  and blank out P#RETV                                             CRE008
     C                     MOVE *BLANKS   P@RETV                          CRE008
      *                                                                   CRE008
      ** then log if required                                             CRE008
     C           GDREPT    IFEQ 'Y'                                       CRE008
     C                     MOVE *BLANKS   LGDTA                           CRE008
     C                     MOVELGDMTPY    L#MTPY                          CRE008
     C                     MOVELGDMSET    L#MSET                          CRE008
     C                     MOVELGDCSEQ    L#CSEQ                          CRE008
     C           L#CRIT    CAT  GDMTAG:0  L#CRIT                          CRE008
     C                     CAT  GDOPER:1  L#CRIT                          CRE008
     C                     CAT  GDCMP1:1  L#CRIT                          CRE008
     C           GDCMP2    IFNE *BLANK                                    CRE008
     C                     CAT  'OR':1    L#CRIT                          CRE008
     C                     CAT  GDCMP2:1  L#CRIT                          CRE008
     C                     ENDIF                                          CRE008
     C           GDCMP3    IFNE *BLANK                                    CRE008
     C                     CAT  'OR':1    L#CRIT                          CRE008
     C                     CAT  GDCMP3:1  L#CRIT                          CRE008
     C                     ENDIF                                          CRE008
     C           GDCMP4    IFNE *BLANK                                    CRE008
     C                     CAT  'OR':1    L#CRIT                          CRE008
     C                     CAT  GDCMP4:1  L#CRIT                          CRE008
     C                     ENDIF                                          CRE008
     C           GDCMP5    IFNE *BLANK                                    CRE008
     C                     CAT  'OR':1    L#CRIT                          CRE008
     C                     CAT  GDCMP5:1  L#CRIT                          CRE008
     C                     ENDIF                                          CRE008
     C           GDCMP6    IFNE *BLANK                                    CRE008
     C                     CAT  'OR':1    L#CRIT                          CRE008
     C                     CAT  GDCMP6:1  L#CRIT                          CRE008
     C                     ENDIF                                          CRE008
     C                     MOVELLGDTA     MEMSDT    P                     CRE008
     C                     MOVELW0CPGM    MEPGMQ                          CRE008
     C                     MOVEL'MIN0507' MEMSID                          CRE008
     C                     MOVEL'MEMSG'   MEMSGF           Msg file       CRE008
     C                     EXSR MESNMS                                    CRE008
     C                     ENDIF                                          CRE008
      *                                                                   CRE008
     C                     ENDIF
      *
      *  Unwind subroutine stack name
      *
     C           #HXMAT    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
      *****************************************************************
      *                                                               *
      *  #HFDDT   : Validate Field Details                            *
      *                                                               *
      *  CALLED BY: MATCH                                             *
      *                                                               *
      *  CALLS    :                                                   *
      *                                                               *
      *****************************************************************
     CSR         #HFDDT    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'#HFDDT'  @STK,Q
      *
      *  Check criteria
      *
     C                     Z-ADD1         H2      10
     C                     MOVELHK2,H2    WUCRIT
      *
      *
     C           H2        DOWLEWUCRNO
      *
     C           WUCRIT    IFNE *BLANKS
      *
      *  General checking - no special value used
      *
     C           WUASTK    IFNE '*'
      *
     C           WUACCO    IFEQ WUCRIT
     C           WUORIG    OREQ WUCRIT
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
      *
     C                     ELSE
      *
      *
      * Convert lower case to upper case in Compare Value name                                162380
     C           ' '       SCAN WUFUNC    WLF          90                                     162380
     C           *IN90     IFEQ '0'                                                           162380
     C           WLF       IFEQ 0                                                             162380
     C           WLF       ORGT 5                                                             162380
     C           LW:UP     XLATEWUFUNC    WUFUNC                                              162380
     C                     ELSE                                                               162380
     C                     SELEC                                                              162380
     C           WLF       WHEQ 3                                                             162380
     C           LW:UP     XLATEWUFUN2    WUFUN2                                              162380
     C           WLF       WHEQ 4                                                             162380
     C           LW:UP     XLATEWUFUN3    WUFUN3                                              162380
     C           WLF       WHEQ 5                                                             162380
     C           LW:UP     XLATEWUFUN4    WUFUN4                                              162380
     C                     ENDSL                                                              162380
     C                     ENDIF                                                              162380
     C                     ENDIF                                                              162380
      *
     C                     SELEC
      *
      *
      * Test time that message was received
      *
      * If *TIME used then date is assumed to be system date
      * and not Midas Run date.
      *
     C           WUFUNC    WHEQ '*TIME'
      *
      * Get received date and time from control record
      *
     C           PHMSGR    CHAIN@INCRL1              90
      *
      * Construct Received time and date into YYMMDDHHMM00 format
      *
     C                     Z-ADDCRMODE    RCDATE
      *
      * Y2K => Received time and date into CCYYMMDDHHMM00 format
     C                     MOVE CRMDEC    RCCNTY
      *
     C                     Z-ADDCRMOTM    RCTIME
     C                     Z-ADD0         RCSECS
      *
      * Get System Date and time and place in CCYYMMDDHHMM00 format
      *
     C                     TIME           SYDTTM 140
     C                     Z-ADDSYDTTM    SYDATE
     C                     Z-ADDWUHOUR    SYHOUR
     C                     Z-ADDWUMINS    SYMINS
     C                     Z-ADD0         SYSECS
      *
      * Test time against GT and LT only
      *
     C                     SELEC
     C           GDOPER    WHEQ 'GT'
     C           RCCOMP    IFGT SYCOMP
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
      *
     C           GDOPER    WHEQ 'LT'
     C           RCCOMP    IFLT SYCOMP
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
     C                     ENDSL
      *
     C           WUFUNC    WHEQ '*ACC '
     C           '/ACC/'   SCAN WUORIG                   90
     C           *IN90     IFEQ '1'
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
      *
      * Test for //FW and /FW
      *
     C           WUFUNC    WHEQ '*FEDW'
     C                     MOVELWUORIG    ##003A
     C                     MOVELWUORIG    ##004A  4
     C           ##003A    IFEQ '/FW'
     C           ##004A    OREQ '//FW'
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
      *
      * Test for BIC Code Match (extact match)
      *
     C           WUFUNC    WHEQ '*BIC '
      *
      * Only check if network swift and type A flag
      *
     C           1         SUBSTGDMTAG:4  ##001A  1
     C           PNWRK     IFEQ 'SWIFT'
     C           ##001A    ANDEQ'A'
     C           3         SUBSTWUCRIT:14 ##003A  3
     C           8         SUBSTWUCRIT:6  ##008A  8
     C           1         SUBSTWUORIG:1  ##001A
      *
      * If account line extract from second line
      *
     C           ##001A    IFEQ '/'
     C           3         SUBSTWUORIG:44 ##003B  3
     C           8         SUBSTWUORIG:36 ##008B  8
     C                     ELSE
     C           3         SUBSTWUORIG:9  ##003B  3
     C           8         SUBSTWUORIG:1  ##008B  8
     C                     ENDIF
      *
      * Set match flag depending on contents
      *
     C                     SELEC
      *
      * Extact match
      *
     C           ##008A    WHEQ ##008B
     C           ##003A    ANDEQ##003B
     C                     MOVE 'Y'       WUMATH
      *
      * XXX in one but blanks in the other
      *
     C           ##008A    WHEQ ##008B
     C           ##003A    ANDEQ*BLANKS
     C           ##003B    ANDEQ'XXX'
     C           ##008A    OREQ ##008B
     C           ##003A    ANDEQ'XXX'
     C           ##003B    ANDEQ*BLANKS
     C                     MOVE 'Y'       WUMATH
      *
      * xxx therefor on first 8 characters need match
      *
     C           ##008A    WHEQ ##008B
     C           ##003A    ANDEQ'xxx'
     C                     MOVE 'Y'       WUMATH
     C                     ENDSL
     C                     ENDIF
      *
      * Test for Customer Number
      *
     C           WUFUNC    WHEQ '*CNUM'
     C********** WUCNUM    IFNE 0                                                             CSD027
     C           WUCNUM    IFNE *BLANKS                                                       CSD027
     C           WUCNUA    ANDNE*BLANKS
     C           6         SUBSTWUCRIT:7  ##006A  6
     C           WUCNUA    IFEQ ##006A
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
     C                     ENDIF
      *
      * Test for Account is in message currency
      *
     C           WUFUNC    WHEQ '*MCCY'
     C           WUACCD    IFNE *ZEROS
     C           WUACCA    ANDNE*BLANK
     C           KYMPL1    CHAIN@INMPL1              90
     C           *IN90     IFEQ '0'
     C           MPCYCD    ANDEQWUCURR
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
     C                     ENDIF
      *
      * Test for Account line specification
      *
     C           WUFUNC    WHEQ '*ACLN'
     C           1         SUBSTWUORIG:1  ##001A
     C           ##001A    IFEQ '/'
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
      *
      * Test for Swift Bic on supplied Bic directory
      *
     C           WUFUNC    WHEQ '*SWFT'
     C           1         SUBSTWUORIG:1  ##001A
      *
      * No account line
      *
     C           WUORIG    IFNE *BLANKS
     C           WUSWFT    ANDNE*BLANKS
     C           WUNSWF    ANDEQ*BLANKS
     C           ##001A    ANDNE'/'
     C                     MOVELWUSWFT    BDBICC
     C                     MOVE WUSWFT    BDBICB
     C           BDBICB    IFEQ *BLANKS
     C                     MOVEL'XXX'     BDBICB
     C                     ENDIF
     C           KYBICD    CHAIN@BICDL2              90
     C           *IN90     IFEQ '0'
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
     C                     ENDIF
      *
      * If account line extract from second line
      *
     C           WUORIG    IFNE *BLANKS
     C           ##001A    ANDEQ'/'
     C           WUSWF2    ANDNE*BLANKS
     C           WUNSW2    ANDEQ*BLANKS
     C                     MOVELWUSWF2    BDBICC
     C                     MOVE WUSWF2    BDBICB
     C           BDBICB    IFEQ *BLANKS
     C                     MOVEL'XXX'     BDBICB
     C                     ENDIF
     C           KYBICD    CHAIN@BICDL2              90
     C           *IN90     IFEQ '0'
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
     C                     ENDIF
      *
      * Test to see if a Nostro
      *
     C           WUFUNC    WHEQ '*NOST'
      *
      * Find Nostro details
      *
     C                     CALL 'AONOSTR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM WUCNUA    @CUST   6
     C                     PARM WUCURR    @CYCD   3
     C**********           PARM WUACCA    @ACCD   4                                           CGL029
     C                     PARM WUACCA    @ACCD  10                                           CGL029
     C                     PARM WUACSA    @ACSN   2
     C                     PARM *BLANKS   @NONB   2
     C                     PARM WUBRCA    @BRCD   3
     C                     PARM *BLANKS   @CSSN  10
     C                     PARM *BLANKS   @PNOI   1
     C           SDNOST    PARM *BLANKS   DSFDY
      *
     C           @RTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       WUMATH
     C                     END
      *
      * Check tags are the same
      *
     C           WUFUNC    WHEQ '*TAGD'
     C           5         SUBSTWUCODE:2  ##005A  5
     C                     MOVEL*BLANKS   WCFDDT
     C/COPY WNCPYSRC,ME1501C006
      *
      * Get data of tag specified
      *
     C                     SELEC
     C           ##005A    WHEQ ':50: '                    Ord Cust
     C                     MOVELP50       WCFDDT
      *
     C           ##005A    WHEQ ':52A:'                    Ord Bank
     C                     MOVELP52       WCFDDT
      *
     C           ##005A    WHEQ ':53A:'                    Sndr Corr
     C                     MOVELP53       WCFDDT
      *
     C           ##005A    WHEQ ':54A:'                    Rcvr Corr
     C                     MOVELP54       WCFDDT
      *
     C           ##005A    WHEQ ':56A:'                    Intermediary
     C                     MOVELP56       WCFDDT
      *
     C           ##005A    WHEQ ':57A:'                    A/c with Inst
     C                     MOVELP57       WCFDDT
      *
     C           ##005A    WHEQ ':58A:'                    Beneficiary
     C                     MOVELP58       WCFDDT
      *
     C           ##005A    WHEQ ':59: '                    Beneficiary Cust
     C                     MOVELP59       WCFDDT
      *
     C           ##005A    WHEQ ':72: '                    Bank-bank info
     C                     MOVELP72       WCFDDT
     C/COPY WNCPYSRC,ME1501C002
      *
     C           ##005A    WHEQ 'SNDR '                    Sender
     C                     MOVELPSN       WCFDDT
     C                     ENDSL
     C/COPY WNCPYSRC,ME1501C007
      *
      * if customer numbers or data is the same set the match field
      *
     C********** WUCNUM    IFNE *ZEROS                                                        CSD027
     C           WUCNUM    IFNE *BLANKS                                                       CSD027
     C           WUCNUA    ANDNE*BLANKS
     C           WCCNUM    ANDNE*ZEROS
     C           WCCNUA    ANDNE*BLANKS
     C           WUCNUA    ANDEQWCCNUA
     C           WUORIG    OREQ WCORIG
     C           WCORIG    ANDNE*BLANKS
     C           WUORIG    ANDNE*BLANKS
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
      *
     C           WUFUNC    WHEQ '*A/C '
     C           KYACCO    CHAINACCNTABF             90
     C           *IN90     IFEQ '0'
     C           RECI      ANDEQ'D'
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
      *
     C           WUFUNC    WHEQ '*BANK'
     C********** WUCNUM    IFNE *ZEROS                                                        CSD027
     C           WUCNUM    IFNE *BLANKS                                                       CSD027
     C           WUCNUA    ANDNE*BLANKS
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM WUCNUA    @KEY1  10
     C                     PARM *BLANK    @KYST   7
     C           SDCUST    PARM SDCUST    DSSDY
     C           BBBNBI    IFEQ 'Y'
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
     C                     ENDIF
      *
     C           WUFUNC    WHEQ '*BICN'
     C********** WUCNUM    IFNE *ZEROS                                                        CSD027
     C           WUCNUM    IFNE *BLANKS                                                       CSD027
     C           WUCNUA    ANDNE*BLANKS
     C           WUCNUA    CHAINSDBRCHL5             90
     C           *IN90     IFEQ '0'
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
     C                     ENDIF
      *
     C           WUFUNC    WHEQ '*BOJ '
     C********** WUCNUM    IFNE *ZEROS                                                        CSD027
     C           WUCNUM    IFNE *BLANKS                                                       CSD027
     C           WUCNUA    ANDNE*BLANKS
      *
      * /COPY for BOJ Extension file check
      *
      *COPY WNCPYSRC, MEH022CBOJ
     C           BBBFIC    IFEQ 'Y'
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
     C                     ENDIF
      *
     C           WUFUNC    WHEQ '*CCY '
     C           WUCODE    IFEQ WUCURR
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
      *
     C           WUFUNC    WHEQ '*CUST'
     C********** WUCNUM    IFNE *ZEROS                                                        CSD027
     C           WUCNUM    IFNE *BLANKS                                                       CSD027
     C           WUCNUA    ANDNE*BLANKS
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
      *
     C           WUFUNC    WHEQ '*GRP '
     C********** WUCNUM    IFNE *ZEROS                                                        CSD027
     C           WUCNUM    IFNE *BLANKS                                                       CSD027
     C           WUCNUA    ANDNE*BLANKS
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM WUCNUA    @KEY1  10
     C                     PARM *BLANK    @KYST   7
     C           SDCUST    PARM SDCUST    DSSDY
     C           BBBSIN    IFNE *BLANKS
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
     C                     ENDIF
      *
     C           WUFUNC    WHEQ '*LCCY'
     C           BJLCCY    IFEQ WUCURR
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
      *
     C           WUFUNC    WHEQ '*LOC '
     C********** WUCNUM    IFNE *ZEROS                                                        CSD027
     C           WUCNUM    IFNE *BLANKS                                                       CSD027
     C           WUCNUA    ANDNE*BLANKS
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM WUCNUA    @KEY1  10
     C                     PARM *BLANK    @KYST   7
     C           SDCUST    PARM SDCUST    DSSDY
     C           BBLCCD    IFEQ WUCODE
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
     C                     ENDIF
      *
     C           WUFUNC    WHEQ '*NONE'
     C           WKPART    IFEQ *LOVAL
     C           WUTGVL    IFEQ *BLANKS
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
     C                     ELSE
      ** Tag value has been retrieved in file MEINDTS2
     C           WUFDDT    IFEQ *BLANKS
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
     C                     ENDIF
      *
     C           WUFUNC    WHEQ '*REC '
     C           '/REC/'   SCAN WUORIG                   90
     C           *IN90     IFEQ '1'
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
      *
     C           WUFUNC    WHEQ '*RETL'
     C           KYACCO    CHAINACCNTABF             90
     C           *IN90     IFEQ '0'
     C           RECI      ANDEQ'D'
     C           ATYP      ANDEQ'R'
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
      *
     C           WUFUNC    WHEQ '*SEND'
     C                     MOVELPSN       U1W12A 12
     C**********           MOVE U1W12A    U1W6N   60                                          CSD027
     C                     MOVE U1W12A    U1W6N   6                                           CSD027
     C                     MOVE U1W12A    U1W6A   6
     C           WUCNUM    IFEQ U1W6N
     C           WUCNUA    ANDNE*BLANKS
     C           U1W6A     ANDNE*BLANKS
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
      *
     C           WUFUNC    WHEQ '*VOST'
     C           WUACCD    IFNE *ZEROS
     C           WUACCA    ANDNE*BLANK
     C           WUACCD    LOKUPHK1                      63
     C           *IN63     IFEQ '1'
     C           KYACCO    CHAINACCNTABF             90
     C           *IN90     IFEQ '0'
     C           RECI      ANDEQ'D'
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ** Process function *STRxxx   where xxx = 000,...,999
     C           WUFUN4    WHEQ '*STR'
     C           WUMTAG    ANDNE*BLANK
     C                     EXSR STRFNC
      *                                                                                      CFT004
      * Check if this is IBAN number                                                         CFT004
     C           WUFUN7    WHEQ '*IBAN  '                                                    CFT004
     C           CFT004    ANDEQ'Y'                                                          CFT004
     C           1         SUBSTWUORIG:1  ##001A                                             CFT004
     C           2         SUBSTWUORIG:2  ##002A  2                                          CFT004
      * Caracter 2 & 3 must be a valid ISO country code                                      CFT004
     C           ##002A    CHAINSDCTRYL2             90                                      CFT004
     C           ##001A    IFEQ '/'                                                          CFT004
     C           *IN90     ANDEQ*OFF                                                         CFT004
     C                     MOVE 'Y'       WUMATH                                             CFT004
     C                     ENDIF                                                             CFT004
      *                                                                                      CFT004
      * Test for a 'bad' IBAN                                                                CFT004
     C           WUFUN7    WHEQ '*IBANF '                                                    CFT004
     C           CFT004    ANDEQ'Y'                                                          CFT004
     C           1         SUBSTWUORIG:1  ##001A                                             CFT004
     C           2         SUBSTWUORIG:2  ##002A  2                                          CFT004
     C           34        SUBSTWUORIG:2  P@IBN1 34                                          CFT004
      * Character 2 & 3 must be a valid ISO country code                                     CFT004
     C           ##002A    CHAINSDCTRYL2             90                                      CFT004
     C           ##001A    IFEQ '/'                                                          CFT004
     C           *IN90     ANDEQ*OFF                                                         CFT004
      * Check Valid External IBAN                                                            CFT004
     C                     CALL 'AOIBANR5'                                                   CFT004
     C                     PARM           @RTCD                                              CFT004
     C                     PARM           P@IBN1           I:IBAN                            CFT004
      *                                                                                      CFT004
      * If IBAN is invalid set WUMATH to 'Y'                                                 CFT004
     C           @RTCD     IFNE *BLANKS                                                      CFT004
     C                     MOVE 'Y'       WUMATH                                             CFT004
     C                     ENDIF                                                             CFT004
     C                     ENDIF                                                             CFT004
      * Test if IBAN is equal to the value specified in criteria                             CFT004
     C           WUFUN6    WHEQ '*IBANV'                                                     CFT004
     C           CFT004    ANDEQ'Y'                                                          CFT004
     C           34        SUBSTWUORIG:2  P@IBN1                                             CFT004
     C           P@IBN1    IFEQ WIBANV                                                       CFT004
     C                     MOVE 'Y'       WUMATH                                             CFT004
     C                     ENDIF                                                             CFT004
      *                                                                                      CFT004
      * Test if the IBAN is a valid MIDAS account                                            CFT004
     C           WUFUN7    WHEQ '*IBANAC'                                                    CFT004
     C           CFT004    ANDEQ'Y'                                                          CFT004
     C           34        SUBSTWUORIG:2  P@IBN1                                             CFT004
     C                     CALL 'AOIBANR4'                                                   CFT004
     C                     PARM           @RTCD                                              CFT004
     C                     PARM '*VERIFY' @OPTN            I:Option                          CFT004
     C                     PARM           P@IBN1           I:IBAN                            CFT004
     C                     PARM           DSSDY                                              CFT004
     C           @RTCD     IFEQ *BLANKS                                                      CFT004
     C                     MOVE 'Y'       WUMATH                                             CFT004
     C                     ENDIF                                                             CFT004
      *
      *                                                                   CFT007
      * 'Special Function' is *BICP and BIC DB+ Integration is on         CFT007
      *                                                                   CFT007
     C           WUFUNC    WHEQ '*BICP'                                   CFT007
     C           CFT007    ANDEQ*ON                                       CFT007
      *                                                                   CFT007
     C                     MOVE GDMTAG    WUFLOP  2                       CFT007
     C                     MOVELWUFLOP    @IOPTN                          CFT007
      *                                                                   CFT007
     C           @IOPTN    IFNE 'A'                                       CFT007
     C           @IOPTN    ANDNE'B'                                       CFT007
     C           @IOPTN    ANDNE'C'                                       CFT007
     C           @IOPTN    ANDNE'D'                                       CFT007
     C                     MOVE *BLANKS   @IOPTN                          CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
      * Determine the currency of the message                             CFT007
      *                                                                   CFT007
     C                     MOVELPDCA      DSTRAN                          CFT007
     C                     MOVE TVCCY     @ICCY                           CFT007
     C                     MOVELWUTGCK    @ITGVL                          CFT007
      *                                                                   CFT007
      * Call the BIC Plus repair program                                  CFT007
      *                                                                   CFT007
     C                     CALL 'ME1610'                                  CFT007
     C                     PARM           @ITGVL251                       CFT007
     C                     PARM           @IOPTN  1                       CFT007
     C                     PARM           @ICCY   3                       CFT007
     C                     PARM *BLANK    @ORPFL251                       CFT007
     C                     PARM *BLANK    @ORTCD  7                       CFT007
      *                                                                   CFT007
     C           @ORTCD    IFEQ '*MAP'                                    CFT007
     C                     MOVE 'Y'       WUMATH                          CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
      *                                                                   CFT007
      ** Process function CHK (user defined)
      ** TO BE PROCESSED ONLY IF NO OTHER HARD CODED FUNCTIONS
      ** WERE FOUND
     C                     OTHER
     C                     EXSR SRUCHK
      *
     C                     ENDSL
     C                     ENDIF
     C                     ENDIF
      *
     C                     ADD  1         H2
     C           H2        IFLE WUCRNO
     C                     MOVELHK2,H2    WUCRIT
     C                     ENDIF
     C                     ENDDO
      *
      *  In case of negation, reverse the result
      *
     C           GDOPER    IFEQ 'NE'
     C           WUMATH    IFEQ 'Y'
     C                     MOVE *BLANK    WUMATH
     C                     ELSE
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
     C                     ENDIF
      *
      *  Unwind subroutine stack name
      *
     C           #HXFDD    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
      *****************************************************************
      *                                                               *
      *  #H1AMT   : Validate the First Amount                         *
      *                                                               *
      *  CALLED BY: MATCH                                             *
      *                                                               *
      *  CALLS    :                                                   *
      *                                                               *
      *****************************************************************
     CSR         #H1AMT    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q
     C                     MOVEL'#H1AMT'  @STK,Q
      *
      *  Check criteria
      *
     C                     Z-ADD1         H2
     C                     MOVELHK2,H2    WUCRIT
      *
      *
     C           H2        DOWLEWUCRNO
      *
     C           WUCRIT    IFNE *BLANKS
      *
      *  General checking - no special value used
      *
     C           WUASTK    IFNE '*'
     C           WUORIG    IFEQ WUCRIT
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
      *
     C                     ELSE
      *
      *
      * Convert lower case to upper case in Compare Value name                                162380
     C           ' '       SCAN WUFUNC    WLF          90                                     162380
     C           *IN90     IFEQ '0'                                                           162380
     C           WLF       IFEQ 0                                                             162380
     C           WLF       ORGT 5                                                             162380
     C           LW:UP     XLATEWUFUNC    WUFUNC                                              162380
     C                     ELSE                                                               162380
     C                     SELEC                                                              162380
     C           WLF       WHEQ 3                                                             162380
     C           LW:UP     XLATEWUFUN2    WUFUN2                                              162380
     C           WLF       WHEQ 4                                                             162380
     C           LW:UP     XLATEWUFUN3    WUFUN3                                              162380
     C           WLF       WHEQ 5                                                             162380
     C           LW:UP     XLATEWUFUN4    WUFUN4                                              162380
     C                     ENDSL                                                              162380
     C                     ENDIF                                                              162380
     C                     ENDIF                                                              162380
      *                                                                   CFT006
     C           GDMTAG    IFEQ ':32B:'                                   CFT006
     C           GDMTAG    OREQ ':33B:'                                   CFT006
     C           GDMTAG    OREQ ':71F:'                                   CFT006
     C           GDMTAG    OREQ ':71G:'                                   CFT006
      *                                                                   CFT006
      *  Reformat into ccy/amount                                         CFT006
      *                                                                   CFT006
     C                     MOVELWUORIG    TTCA                            CFT006
      *                                                                   CFT006
     C                     ELSE                                           CFT006
      *
      *  Reformat into date/ccy/amount
      *
     C                     MOVELWUORIG    TVDCA
      *
      *  Turn date into Midas date format
      *
     C           WUDFF     IFEQ 'M'
      * MMDDYY Format
     C                     MOVELTVVDAT    SWDT
     C                     MOVE SDD       DD      20
     C                     MOVE SYY       SDD
     C                     MOVE SMM       SYY
     C                     MOVE DD        SMM
     C                     MOVE SWDT      WUSLDT  60
     C                     ELSE
      * DDMMYY Format
     C                     MOVELTVVDAT    SWDT
     C                     MOVE SDD       DD
     C                     MOVE SYY       SDD
     C                     MOVE DD        SYY
     C                     MOVE SWDT      WUSLDT
     C                     ENDIF
      *
     C                     MOVE WUSLDT    ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    WUSLDN  50
      *                                                                   CFT006
     C                     ENDIF                                          CFT006
      *
     C                     SELEC
      *
      * Test for curreny is in message currency
      *
     C           WUFUNC    WHEQ '*MCCY'
     C           KYMPL1    CHAIN@INMPL1              90
      *                                                                   CFT006
     C           GDMTAG    IFEQ ':32B:'                                   CFT006
     C           GDMTAG    OREQ ':33B:'                                   CFT006
     C           GDMTAG    OREQ ':71F:'                                   CFT006
     C           GDMTAG    OREQ ':71G:'                                   CFT006
      *                                                                   CFT006
     C           *IN90     IFEQ *OFF                                      CFT006
     C           MPCYCD    ANDEQTTCCY                                     CFT006
     C                     MOVE 'Y'       WUMATH                          CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     ELSE                                           CFT006
      *                                                                   CFT006
     C           *IN90     IFEQ '0'
     C           MPCYCD    ANDEQTVCCY
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
      *                                                                   CFT006
     C                     ENDIF                                          CFT006
      *
      *  Date checking
      *
     C           WUFUNC    WHEQ '*TODY'
      *
     C           GDMTAG    IFNE ':32B:'                                   CFT006
     C           GDMTAG    ANDNE':33B:'                                   CFT006
     C           GDMTAG    ANDNE':71F:'                                   CFT006
     C           GDMTAG    ANDNE':71G:'                                   CFT006
      *                                                                   CFT006
     C                     SELEC
     C           GDOPER    WHEQ 'EQ'
     C           GDOPER    OREQ 'NE'
     C           WUSLDN    IFEQ WURDNB
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
     C           GDOPER    WHEQ 'GT'
     C           WUSLDN    IFGT WURDNB
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
     C           GDOPER    WHEQ 'GE'
     C           WUSLDN    IFGE WURDNB
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
     C           GDOPER    WHEQ 'LT'
     C           WUSLDN    IFLT WURDNB
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
     C           GDOPER    WHEQ 'LE'
     C           WUSLDN    IFLE WURDNB
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
     C                     ENDSL
      *                                                                   CFT006
     C                     ENDIF                                          CFT006
      *
      *  Ccy checking
      *
     C           WUFUNC    WHEQ '*CCY '
      *                                                                   CFT006
     C           GDMTAG    IFEQ ':32B:'                                   CFT006
     C           GDMTAG    OREQ ':33B:'                                   CFT006
     C           GDMTAG    OREQ ':71F:'                                   CFT006
     C           GDMTAG    OREQ ':71G:'                                   CFT006
      *                                                                   CFT006
     C           WUCODE    IFEQ TTCCY                                     CFT006
     C                     MOVE 'Y'       WUMATH                          CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     ELSE                                           CFT006
      *                                                                   CFT006
     C           WUCODE    IFEQ TVCCY
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
      *                                                                   CFT006
     C                     ENDIF                                          CFT006
      *
     C           WUFUNC    WHEQ '*LCCY'
      *                                                                   CFT006
     C           GDMTAG    IFEQ ':32B:'                                   CFT006
     C           GDMTAG    OREQ ':33B:'                                   CFT006
     C           GDMTAG    OREQ ':71F:'                                   CFT006
     C           GDMTAG    OREQ ':71G:'                                   CFT006
      *                                                                   CFT006
     C           BJLCCY    IFEQ TTCCY                                     CFT006
     C                     MOVE 'Y'       WUMATH                          CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     ELSE                                           CFT006
      *                                                                   CFT006
     C           BJLCCY    IFEQ TVCCY
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
      *                                                                   CFT006
     C                     ENDIF                                          CFT006
      *
      *  Working day checking (Ccy + date checking)
      *
      *
      *  Local ccy working day
      *
     C           WUFUNC    WHEQ '*LWKD'
      *                                                                   CFT006
     C           GDMTAG    IFNE ':32B:'                                   CFT006
     C           GDMTAG    ANDNE':33B:'                                   CFT006
     C           GDMTAG    ANDNE':71F:'                                   CFT006
     C           GDMTAG    ANDNE':71G:'                                   CFT006
      *                                                                   CFT006
     C                     MOVE BJLCCY    ZCCY
     C                     MOVE *BLANKS   ZLOC
     C                     EXSR ZCHKH
     C           ZIND      IFNE 'H'
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
      *                                                                   CFT006
     C                     ENDIF                                          CFT006
      *
      *  Transaction ccy working day
      *
     C           WUFUNC    WHEQ '*CWKD'
      *                                                                   CFT006
     C           GDMTAG    IFNE ':32B:'                                   CFT006
     C           GDMTAG    ANDNE':33B:'                                   CFT006
     C           GDMTAG    ANDNE':71F:'                                   CFT006
     C           GDMTAG    ANDNE':71G:'                                   CFT006
      *                                                                   CFT006
     C                     MOVE TVCCY     ZCCY
     C                     MOVE *BLANKS   ZLOC
     C                     EXSR ZCHKH
     C           ZIND      IFNE 'H'
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
      *                                                                   CFT006
     C                     ENDIF                                          CFT006
      *
      *
      ** Process function *STRxxx   where xxx = 000,...,999
     C           WUFUN4    WHEQ '*STR'
     C           WUMTAG    ANDNE*BLANK
     C                     EXSR STRFNC
      *
      ** Process function CHK (user defined)
      ** TO BE PROCESSED ONLY IF NO OTHER HARD CODED FUNCTIONS
      ** WERE FOUND
     C                     OTHER
     C                     EXSR SRUCHK
      *
     C                     ENDSL
     C                     ENDIF
     C                     ENDIF
      *
     C                     ADD  1         H2
     C           H2        IFLE WUCRNO
     C                     MOVELHK2,H2    WUCRIT
     C                     ENDIF
     C                     ENDDO
      *
      *  In case of negation, reverse the result
      *
     C           GDOPER    IFEQ 'NE'
     C           WUMATH    IFEQ 'Y'
     C                     MOVE *BLANK    WUMATH
     C                     ELSE
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
     C                     ENDIF
      *
      *  Unwind subroutine stack name
      *
     C           #HX1AM    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
      *****************************************************************
      *                                                               *
      *  #HAUDT   : Produce audit list                                *
      *                                                               *
      *  CALLED BY: Main processing                                   *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     CSR         #HAUDT    BEGSR
     C           CSW209    IFEQ 'Y'                                                           CSW209
     C                     MOVEL*BLANKS   WMSEQ                                               CSW209
     C                     ENDIF                                                              CSW209
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q       50
     C                     MOVEL'#HAUDT'  @STK,Q
      *
      * Open printer file
      *
     C                     OPEN ME1501P1
      *
      *  Write Report Header
      *
     C                     WRITEHEADER
      *
      *  Write Message Header
      *
     C                     WRITEMSGHDR
     C/COPY WNCPYSRC,ME1501C008
      *                                                                   CFT006
      *  Sum of Amounts - Header (if there is any)                        CFT006
      *                                                                   CFT006
     C           PH19      IFNE *BLANKS                                   CFT006
     C                     MOVEL*BLANKS   WUFDDT                          CFT006
     C                     MOVELPH19      WUFDDT                          CFT006
     C                     MOVELWUMTAG    HPRTG                           CFT006
     C                     MOVELWUACCO    HPRDT                           CFT006
     C                     MOVELWUORIG    HPROR1                          CFT006
     C                     MOVE WUORIG    HPROR2                          CFT006
     C***********KYDESC    CHAIN@EFREJ4              99            CFT006 CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ *OFF                                      CFT006
     C                     MOVELEFSCFD    HPRDS                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVEL*BLANKS   HPRDS                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR1    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN51                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR2    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN52                           CFT006
     C                     ENDIF                                          CFT006
     C                     WRITEMSGDTL                                    CFT006
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     MOVE *OFF      *IN51                           CFT006
     C                     MOVE *OFF      *IN52                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      *  Transaction Reference - Header (if there is any)                 CFT006
      *                                                                   CFT006
     C           PH20      IFNE *BLANKS                                   CFT006
     C                     MOVEL*BLANKS   WUFDDT                          CFT006
     C                     MOVELPH20      WUFDDT                          CFT006
     C                     MOVELWUMTAG    HPRTG                           CFT006
     C                     MOVELWUACCO    HPRDT                           CFT006
     C                     MOVELWUORIG    HPROR1                          CFT006
     C                     MOVE WUORIG    HPROR2                          CFT006
     C***********KYDESC    CHAIN@EFREJ4              99            CFT006 CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ *OFF                                      CFT006
     C                     MOVELEFSCFD    HPRDS                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVEL*BLANKS   HPRDS                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR1    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN51                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR2    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN52                           CFT006
     C                     ENDIF                                          CFT006
     C                     WRITEMSGDTL                                    CFT006
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     MOVE *OFF      *IN51                           CFT006
     C                     MOVE *OFF      *IN52                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      *  Customer Reference - Header (if there is any)                    CFT006
      *                                                                   CFT006
     C           PH21R     IFNE *BLANKS                                   CFT006
     C                     MOVEL*BLANKS   WUFDDT                          CFT006
     C                     MOVELPH21R     WUFDDT                          CFT006
     C                     MOVELWUMTAG    HPRTG                           CFT006
     C                     MOVELWUACCO    HPRDT                           CFT006
     C                     MOVELWUORIG    HPROR1                          CFT006
     C                     MOVE WUORIG    HPROR2                          CFT006
     C***********KYDESC    CHAIN@EFREJ4              99            CFT006 CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ *OFF                                      CFT006
     C                     MOVELEFSCFD    HPRDS                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVEL*BLANKS   HPRDS                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR1    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN51                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR2    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN52                           CFT006
     C                     ENDIF                                          CFT006
     C                     WRITEMSGDTL                                    CFT006
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     MOVE *OFF      *IN51                           CFT006
     C                     MOVE *OFF      *IN52                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      *  Bank Operation Code - Header (if there is any)                   CFT006
      *                                                                   CFT006
     C           PH23      IFNE *BLANKS                                   CFT006
     C                     MOVEL*BLANKS   WUFDDT                          CFT006
     C                     MOVELPH23      WUFDDT                          CFT006
     C                     MOVELWUMTAG    HPRTG                           CFT006
     C                     MOVELWUACCO    HPRDT                           CFT006
     C                     MOVELWUORIG    HPROR1                          CFT006
     C                     MOVE WUORIG    HPROR2                          CFT006
     C***********KYDESC    CHAIN@EFREJ4              99            CFT006 CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ *OFF                                      CFT006
     C                     MOVELEFSCFD    HPRDS                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVEL*BLANKS   HPRDS                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR1    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN51                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR2    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN52                           CFT006
     C                     ENDIF                                          CFT006
     C                     WRITEMSGDTL                                    CFT006
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     MOVE *OFF      *IN51                           CFT006
     C                     MOVE *OFF      *IN52                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      *  Authorisation - Header (if there is any)                         CFT006
      *                                                                   CFT006
     C           PH25      IFNE *BLANKS                                   CFT006
     C                     MOVEL*BLANKS   WUFDDT                          CFT006
     C                     MOVELPH25      WUFDDT                          CFT006
     C                     MOVELWUMTAG    HPRTG                           CFT006
     C                     MOVELWUACCO    HPRDT                           CFT006
     C                     MOVELWUORIG    HPROR1                          CFT006
     C                     MOVE WUORIG    HPROR2                          CFT006
     C***********KYDESC    CHAIN@EFREJ4              99            CFT006 CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ *OFF                                      CFT006
     C                     MOVELEFSCFD    HPRDS                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVEL*BLANKS   HPRDS                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR1    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN51                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR2    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN52                           CFT006
     C                     ENDIF                                          CFT006
     C                     WRITEMSGDTL                                    CFT006
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     MOVE *OFF      *IN51                           CFT006
     C                     MOVE *OFF      *IN52                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      *  Transaction Type Code - Header (if there is any)                 CFT006
      *                                                                   CFT006
     C           PH26T     IFNE *BLANKS                                   CFT006
     C                     MOVEL*BLANKS   WUFDDT                          CFT006
     C                     MOVELPH26T     WUFDDT                          CFT006
     C                     MOVELWUMTAG    HPRTG                           CFT006
     C                     MOVELWUACCO    HPRDT                           CFT006
     C                     MOVELWUORIG    HPROR1                          CFT006
     C                     MOVE WUORIG    HPROR2                          CFT006
     C***********KYDESC    CHAIN@EFREJ4              99            CFT006 CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ *OFF                                      CFT006
     C                     MOVELEFSCFD    HPRDS                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVEL*BLANKS   HPRDS                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR1    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN51                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR2    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN52                           CFT006
     C                     ENDIF                                          CFT006
     C                     WRITEMSGDTL                                    CFT006
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     MOVE *OFF      *IN51                           CFT006
     C                     MOVE *OFF      *IN52                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      *  Requested Execution Date - Header (if there is any)              CFT006
      *                                                                   CFT006
     C           PH30      IFNE *BLANKS                                   CFT006
     C                     MOVEL*BLANKS   WUFDDT                          CFT006
     C                     MOVELPH30      WUFDDT                          CFT006
     C                     MOVELWUMTAG    HPRTG                           CFT006
     C                     MOVELWUACCO    HPRDT                           CFT006
     C                     MOVELWUORIG    HPROR1                          CFT006
     C                     MOVE WUORIG    HPROR2                          CFT006
     C***********KYDESC    CHAIN@EFREJ4              99            CFT006 CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ *OFF                                      CFT006
     C                     MOVELEFSCFD    HPRDS                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVEL*BLANKS   HPRDS                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR1    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN51                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR2    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN52                           CFT006
     C                     ENDIF                                          CFT006
     C                     WRITEMSGDTL                                    CFT006
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     MOVE *OFF      *IN51                           CFT006
     C                     MOVE *OFF      *IN52                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      *  Value date/ccy/amount - Header (if there is any)                 CFT006
      *                                                                   CFT006
     C           PH32A     IFNE *BLANKS                                   CFT006
     C                     MOVEL*BLANKS   WUFDDT                          CFT006
     C                     MOVELPH32A     WUFDDT                          CFT006
     C                     MOVELWUMTAG    HPRTG                           CFT006
     C                     MOVELWUORIG    TVDCA                           CFT006
     C                     MOVE *BLANKS   HPROR1                          177678
     C                     MOVE *BLANKS   HPROR2                          177678
     C                     MOVELTVDCA     HPROR1                          CFT006
     C***********KYDESC    CHAIN@EFREJ4              99            CFT006 CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ *OFF                                      CFT006
     C                     MOVELEFSCFD    HPRDS                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVEL*BLANKS   HPRDS                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR1    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN51                           CFT006
     C                     ENDIF                                          CFT006
     C                     WRITEMSGDTL                                    CFT006
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      *  Exchange Rate - Header (if there is any)                         CFT006
      *                                                                   CFT006
     C           PH36      IFNE *BLANKS                                   CFT006
     C                     MOVEL*BLANKS   WUFDDT                          CFT006
     C                     MOVELPH36      WUFDDT                          CFT006
     C                     MOVELWUMTAG    HPRTG                           CFT006
     C                     MOVELWUACCO    HPRDT                           CFT006
     C                     MOVELWUORIG    HPROR1                          CFT006
     C                     MOVE WUORIG    HPROR2                          CFT006
     C***********KYDESC    CHAIN@EFREJ4              99            CFT006 CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ *OFF                                      CFT006
     C                     MOVELEFSCFD    HPRDS                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVEL*BLANKS   HPRDS                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR1    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN51                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR2    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN52                           CFT006
     C                     ENDIF                                          CFT006
     C                     WRITEMSGDTL                                    CFT006
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     MOVE *OFF      *IN51                           CFT006
     C                     MOVE *OFF      *IN52                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      *  Ordering Customer - Header (if there is any)                     CFT006
      *                                                                   CFT006
     C           PH50      IFNE *BLANKS                                   CFT006
     C                     MOVEL*BLANKS   WUFDDT                          CFT006
     C                     MOVELPH50      WUFDDT                          CFT006
     C                     MOVELWUMTAG    HPRTG                           CFT006
     C                     MOVELWUACCO    HPRDT                           CFT006
     C                     MOVELWUORIG    HPROR1                          CFT006
     C                     MOVE WUORIG    HPROR2                          CFT006
     C***********KYDESC    CHAIN@EFREJ4              99            CFT006 CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ *OFF                                      CFT006
     C                     MOVELEFSCFD    HPRDS                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVEL*BLANKS   HPRDS                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR1    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN51                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR2    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN52                           CFT006
     C                     ENDIF                                          CFT006
     C                     WRITEMSGDTL                                    CFT006
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     MOVE *OFF      *IN51                           CFT006
     C                     MOVE *OFF      *IN52                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      *  Instructing Party - Header (if there is any)                     CFT006
      *                                                                   CFT006
     C           PH50L     IFNE *BLANKS                                   CFT006
     C                     MOVEL*BLANKS   WUFDDT                          CFT006
     C                     MOVELPH50L     WUFDDT                          CFT006
     C                     MOVELWUMTAG    HPRTG                           CFT006
     C                     MOVELWUACCO    HPRDT                           CFT006
     C                     MOVELWUORIG    HPROR1                          CFT006
     C                     MOVE WUORIG    HPROR2                          CFT006
     C***********KYDESC    CHAIN@EFREJ4              99            CFT006 CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ *OFF                                      CFT006
     C                     MOVELEFSCFD    HPRDS                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVEL*BLANKS   HPRDS                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR1    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN51                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR2    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN52                           CFT006
     C                     ENDIF                                          CFT006
     C                     WRITEMSGDTL                                    CFT006
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     MOVE *OFF      *IN51                           CFT006
     C                     MOVE *OFF      *IN52                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      *  Sending Institution - Header (if there is any)                   CFT006
      *                                                                   CFT006
     C           PH51A     IFNE *BLANKS                                   CFT006
     C                     MOVEL*BLANKS   WUFDDT                          CFT006
     C                     MOVELPH51A     WUFDDT                          CFT006
     C                     MOVELWUMTAG    HPRTG                           CFT006
     C                     MOVELWUACCO    HPRDT                           CFT006
     C                     MOVELWUORIG    HPROR1                          CFT006
     C                     MOVE WUORIG    HPROR2                          CFT006
     C***********KYDESC    CHAIN@EFREJ4              99            CFT006 CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ *OFF                                      CFT006
     C                     MOVELEFSCFD    HPRDS                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVEL*BLANKS   HPRDS                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR1    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN51                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR2    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN52                           CFT006
     C                     ENDIF                                          CFT006
     C                     WRITEMSGDTL                                    CFT006
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     MOVE *OFF      *IN51                           CFT006
     C                     MOVE *OFF      *IN52                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      *  Ordering Institution - Header (if there is any)                  CFT006
      *                                                                   CFT006
     C           PH52      IFNE *BLANKS                                   CFT006
     C                     MOVEL*BLANKS   WUFDDT                          CFT006
     C                     MOVELPH52      WUFDDT                          CFT006
     C                     MOVELWUMTAG    HPRTG                           CFT006
     C                     MOVELWUACCO    HPRDT                           CFT006
     C                     MOVELWUORIG    HPROR1                          CFT006
     C                     MOVE WUORIG    HPROR2                          CFT006
     C***********KYDESC    CHAIN@EFREJ4              99            CFT006 CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ *OFF                                      CFT006
     C                     MOVELEFSCFD    HPRDS                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVEL*BLANKS   HPRDS                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR1    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN51                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR2    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN52                           CFT006
     C                     ENDIF                                          CFT006
     C                     WRITEMSGDTL                                    CFT006
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     MOVE *OFF      *IN51                           CFT006
     C                     MOVE *OFF      *IN52                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      *  Sender's Correspondent - Header (if there is any)                CFT006
      *                                                                   CFT006
     C           PH53      IFNE *BLANKS                                   CFT006
     C                     MOVEL*BLANKS   WUFDDT                          CFT006
     C                     MOVELPH53      WUFDDT                          CFT006
     C                     MOVELWUMTAG    HPRTG                           CFT006
     C                     MOVELWUACCO    HPRDT                           CFT006
     C                     MOVELWUORIG    HPROR1                          CFT006
     C                     MOVE WUORIG    HPROR2                          CFT006
     C***********KYDESC    CHAIN@EFREJ4              99            CFT006 CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ *OFF                                      CFT006
     C                     MOVELEFSCFD    HPRDS                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVEL*BLANKS   HPRDS                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR1    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN51                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR2    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN52                           CFT006
     C                     ENDIF                                          CFT006
     C                     WRITEMSGDTL                                    CFT006
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     MOVE *OFF      *IN51                           CFT006
     C                     MOVE *OFF      *IN52                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      *  Receiver's Correspondent - Header (if there is any)              CFT006
      *                                                                   CFT006
     C           PH54      IFNE *BLANKS                                   CFT006
     C                     MOVEL*BLANKS   WUFDDT                          CFT006
     C                     MOVELPH54      WUFDDT                          CFT006
     C                     MOVELWUMTAG    HPRTG                           CFT006
     C                     MOVELWUACCO    HPRDT                           CFT006
     C                     MOVELWUORIG    HPROR1                          CFT006
     C                     MOVE WUORIG    HPROR2                          CFT006
     C***********KYDESC    CHAIN@EFREJ4              99            CFT006 CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ *OFF                                      CFT006
     C                     MOVELEFSCFD    HPRDS                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVEL*BLANKS   HPRDS                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR1    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN51                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR2    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN52                           CFT006
     C                     ENDIF                                          CFT006
     C                     WRITEMSGDTL                                    CFT006
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     MOVE *OFF      *IN51                           CFT006
     C                     MOVE *OFF      *IN52                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      *  Details of charges - Header (if there is any)                    CFT006
      *                                                                   CFT006
     C           PH71      IFNE *BLANKS                                   CFT006
     C                     MOVEL*BLANKS   WUFDDT                          CFT006
     C                     MOVELPH71      WUFDDT                          CFT006
     C                     MOVELWUMTAG    HPRTG                           CFT006
     C                     MOVELWUACCO    HPRDT                           CFT006
     C                     MOVELWUORIG    HPROR1                          CFT006
     C                     MOVE WUORIG    HPROR2                          CFT006
     C***********KYDESC    CHAIN@EFREJ4              99            CFT006 CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ *OFF                                      CFT006
     C                     MOVELEFSCFD    HPRDS                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVEL*BLANKS   HPRDS                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR1    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN51                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR2    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN52                           CFT006
     C                     ENDIF                                          CFT006
     C                     WRITEMSGDTL                                    CFT006
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     MOVE *OFF      *IN51                           CFT006
     C                     MOVE *OFF      *IN52                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      *  Sum of Sender's Charges/amount - Header (if there is any)        CFT006
      *                                                                   CFT006
     C           PH71F     IFNE *BLANKS                                   CFT006
     C                     MOVEL*BLANKS   WUFDDT                          CFT006
     C                     MOVELPH71F     WUFDDT                          CFT006
     C                     MOVELWUMTAG    HPRTG                           CFT006
     C                     MOVELWUORIG    TTCA                            CFT006
     C                     MOVE *BLANKS   HPROR1                          177678
     C                     MOVE *BLANKS   HPROR2                          177678
     C                     MOVELTTCA      HPROR1                          CFT006
     C***********KYDESC    CHAIN@EFREJ4              99            CFT006 CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ *OFF                                      CFT006
     C                     MOVELEFSCFD    HPRDS                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVEL*BLANKS   HPRDS                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR1    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN51                           CFT006
     C                     ENDIF                                          CFT006
     C                     WRITEMSGDTL                                    CFT006
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      *  Sum of Receiver's Charges/amount - Header (if there is any)      CFT006
      *                                                                   CFT006
     C           PH71G     IFNE *BLANKS                                   CFT006
     C                     MOVEL*BLANKS   WUFDDT                          CFT006
     C                     MOVELPH71G     WUFDDT                          CFT006
     C                     MOVELWUMTAG    HPRTG                           CFT006
     C                     MOVELWUORIG    TTCA                            CFT006
     C                     MOVE *BLANKS   HPROR1                          177678
     C                     MOVE *BLANKS   HPROR2                          177678
     C                     MOVELTTCA      HPROR1                          CFT006
     C***********KYDESC    CHAIN@EFREJ4              99            CFT006 CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ *OFF                                      CFT006
     C                     MOVELEFSCFD    HPRDS                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVEL*BLANKS   HPRDS                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR1    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN51                           CFT006
     C                     ENDIF                                          CFT006
     C                     WRITEMSGDTL                                    CFT006
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      *  Sender to Receiver Information - Header (if there is any)        CFT006
      *                                                                   CFT006
     C           PH72      IFNE *BLANKS                                   CFT006
     C                     MOVEL*BLANKS   WUFDDT                          CFT006
     C                     MOVELPH72      WUFDDT                          CFT006
     C                     MOVELWUMTAG    HPRTG                           CFT006
     C                     MOVELWUACCO    HPRDT                           CFT006
     C                     MOVELWUORIG    HPROR1                          CFT006
     C                     MOVE WUORIG    HPROR2                          CFT006
     C***********KYDESC    CHAIN@EFREJ4              99            CFT006 CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ *OFF                                      CFT006
     C                     MOVELEFSCFD    HPRDS                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVEL*BLANKS   HPRDS                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR1    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN51                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR2    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN52                           CFT006
     C                     ENDIF                                          CFT006
     C                     WRITEMSGDTL                                    CFT006
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     MOVE *OFF      *IN51                           CFT006
     C                     MOVE *OFF      *IN52                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      *  Regulatory Reporting - Header (if there is any)                  CFT006
      *                                                                   CFT006
     C           PH77B     IFNE *BLANKS                                   CFT006
     C                     MOVEL*BLANKS   WUFDDT                          CFT006
     C                     MOVELPH77B     WUFDDT                          CFT006
     C                     MOVELWUMTAG    HPRTG                           CFT006
     C                     MOVELWUACCO    HPRDT                           CFT006
     C                     MOVELWUORIG    HPROR1                          CFT006
     C                     MOVE WUORIG    HPROR2                          CFT006
     C***********KYDESC    CHAIN@EFREJ4              99            CFT006 CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ *OFF                                      CFT006
     C                     MOVELEFSCFD    HPRDS                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVEL*BLANKS   HPRDS                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR1    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN51                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR2    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN52                           CFT006
     C                     ENDIF                                          CFT006
     C                     WRITEMSGDTL                                    CFT006
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     MOVE *OFF      *IN51                           CFT006
     C                     MOVE *OFF      *IN52                           CFT006
     C                     ENDIF                                          CFT006
      *
      *  Transaction Reference (if there is any)
      *
     C           P20       IFNE *BLANKS
     C                     MOVELP20       WUFDDT
     C                     MOVELWUMTAG    HPRTG
     C                     MOVELWUACCO    HPRDT
     C                     MOVELWUORIG    HPROR1
     C                     MOVE WUORIG    HPROR2
     C***********KYDESC    CHAIN@EFREJ4              99                   CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ '0'
     C                     MOVELEFSCFD    HPRDS
     C                     ELSE
     C                     MOVEL*BLANKS   HPRDS
     C                     END
     C           HPROR1    IFNE *BLANKS
     C                     SETON                     51
     C                     ENDIF
     C           HPROR2    IFNE *BLANKS
     C                     SETON                     52
     C                     ENDIF
     C/COPY WNCPYSRC,ME1501C013
     C                     WRITEMSGDTL
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     SETOF                     5152
     C                     ENDIF
      *
      *  Related Reference (if there is any)
      *
     C           P21       IFNE *BLANKS
     C                     MOVELP21       WUFDDT
     C                     MOVELWUMTAG    HPRTG
     C                     MOVELWUACCO    HPRDT
     C                     MOVELWUORIG    HPROR1
     C                     MOVE WUORIG    HPROR2
     C***********KYDESC    CHAIN@EFREJ4              99                   CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ '0'
     C                     MOVELEFSCFD    HPRDS
     C                     ELSE
     C                     MOVEL*BLANKS   HPRDS
     C                     END
     C           HPROR1    IFNE *BLANKS
     C                     SETON                     51
     C                     ENDIF
     C           HPROR2    IFNE *BLANKS
     C                     SETON                     52
     C                     ENDIF
     C/COPY WNCPYSRC,ME1501C014
     C                     WRITEMSGDTL
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     SETOF                     5152
     C                     ENDIF
      *                                                                   CFT006
      *  F/X Deal Reference (if there is any)                             CFT006
      *                                                                   CFT006
     C           P21F      IFNE *BLANKS                                   CFT006
     C                     MOVEL*BLANKS   WUFDDT                          CFT006
     C                     MOVELP21F      WUFDDT                          CFT006
     C                     MOVELWUMTAG    HPRTG                           CFT006
     C                     MOVELWUACCO    HPRDT                           CFT006
     C                     MOVELWUORIG    HPROR1                          CFT006
     C                     MOVE WUORIG    HPROR2                          CFT006
     C***********KYDESC    CHAIN@EFREJ4              99            CFT006 CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ *OFF                                      CFT006
     C                     MOVELEFSCFD    HPRDS                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVEL*BLANKS   HPRDS                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR1    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN51                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR2    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN52                           CFT006
     C                     ENDIF                                          CFT006
     C                     WRITEMSGDTL                                    CFT006
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     MOVE *OFF      *IN51                           CFT006
     C                     MOVE *OFF      *IN52                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT014
      *  Bank Operation Code (if there is any)                            CFT014
      *                                                                   CFT014
     C           P23B      IFNE *BLANKS                                   CFT014
     C                     MOVEL*BLANKS   WUFDDT                          CFT014
     C                     MOVELP23B      WUFDDT                          CFT014
     C                     MOVELWUMTAG    HPRTG                           CFT014
     C                     MOVELWUACCO    HPRDT                           CFT014
     C                     MOVELWUORIG    HPROR1                          CFT014
     C                     MOVE WUORIG    HPROR2                          CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ *OFF                                      CFT014
     C                     MOVELEFSCFD    HPRDS                           CFT014
     C                     ELSE                                           CFT014
     C                     MOVEL*BLANKS   HPRDS                           CFT014
     C                     ENDIF                                          CFT014
     C           HPROR1    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN51                           CFT014
     C                     ENDIF                                          CFT014
     C           HPROR2    IFNE *BLANKS                                   CFT014
     C                     MOVE *ON       *IN52                           CFT014
     C                     ENDIF                                          CFT014
     C                     WRITEMSGDTL                                    CFT014
      *                                                                   CFT014
     C           *IN25     IFEQ *ON                                       CFT014
     C                     WRITEHEADER                                    CFT014
     C                     MOVE *OFF      *IN25                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     MOVE *OFF      *IN51                           CFT014
     C                     MOVE *OFF      *IN52                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT006
      *  Instruction Code (if there is any)                               CFT006
      *                                                                   CFT006
     C           P23E      IFNE *BLANKS                                   CFT006
     C                     MOVEL*BLANKS   WUFDDT                          CFT006
     C                     MOVELP23E      WUFDDT                          CFT006
     C                     MOVELWUMTAG    HPRTG                           CFT006
     C                     MOVELWUACCO    HPRDT                           CFT006
     C                     MOVELWUORIG    HPROR1                          CFT006
     C                     MOVE WUORIG    HPROR2                          CFT006
     C***********KYDESC    CHAIN@EFREJ4              99            CFT006 CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ *OFF                                      CFT006
     C                     MOVELEFSCFD    HPRDS                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVEL*BLANKS   HPRDS                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR1    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN51                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR2    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN52                           CFT006
     C                     ENDIF                                          CFT006
     C                     WRITEMSGDTL                                    CFT006
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     MOVE *OFF      *IN51                           CFT006
     C                     MOVE *OFF      *IN52                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      *  Charges Account (if there is any)                                CFT006
      *                                                                   CFT006
     C           P25A      IFNE *BLANKS                                   CFT006
     C                     MOVEL*BLANKS   WUFDDT                          CFT006
     C                     MOVELP25A      WUFDDT                          CFT006
     C                     MOVELWUMTAG    HPRTG                           CFT006
     C                     MOVELWUACCO    HPRDT                           CFT006
     C                     MOVELWUORIG    HPROR1                          CFT006
     C                     MOVE WUORIG    HPROR2                          CFT006
     C***********KYDESC    CHAIN@EFREJ4              99            CFT006 CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ *OFF                                      CFT006
     C                     MOVELEFSCFD    HPRDS                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVEL*BLANKS   HPRDS                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR1    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN51                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR2    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN52                           CFT006
     C                     ENDIF                                          CFT006
     C                     WRITEMSGDTL                                    CFT006
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     MOVE *OFF      *IN51                           CFT006
     C                     MOVE *OFF      *IN52                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      *  Transaction Type Code (if there is any)                          CFT006
      *                                                                   CFT006
     C           P26T      IFNE *BLANKS                                   CFT006
     C                     MOVEL*BLANKS   WUFDDT                          CFT006
     C                     MOVELP26T      WUFDDT                          CFT006
     C                     MOVELWUMTAG    HPRTG                           CFT006
     C                     MOVELWUACCO    HPRDT                           CFT006
     C                     MOVELWUORIG    HPROR1                          CFT006
     C                     MOVE WUORIG    HPROR2                          CFT006
     C***********KYDESC    CHAIN@EFREJ4              99            CFT006 CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ *OFF                                      CFT006
     C                     MOVELEFSCFD    HPRDS                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVEL*BLANKS   HPRDS                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR1    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN51                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR2    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN52                           CFT006
     C                     ENDIF                                          CFT006
     C                     WRITEMSGDTL                                    CFT006
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     MOVE *OFF      *IN51                           CFT006
     C                     MOVE *OFF      *IN52                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      *  Currency/Transaction amount (if there is any)                    CFT006
      *                                                                   CFT006
     C           P32B      IFNE *BLANKS                                   CFT006
     C                     MOVEL*BLANKS   WUFDDT                          CFT006
     C                     MOVELP32B      WUFDDT                          CFT006
     C                     MOVELWUMTAG    HPRTG                           CFT006
     C                     MOVELWUORIG    TTCA                            CFT006
     C                     MOVE *BLANKS   HPROR1                          177678
     C                     MOVE *BLANKS   HPROR2                          177678
     C                     MOVELTTCA      HPROR1                          CFT006
     C***********KYDESC    CHAIN@EFREJ4              99            CFT006 CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ *OFF                                      CFT006
     C                     MOVELEFSCFD    HPRDS                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVEL*BLANKS   HPRDS                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR1    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN51                           CFT006
     C                     ENDIF                                          CFT006
     C                     WRITEMSGDTL                                    CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      *  Original Ordered Amount (if there is any)                        CFT006
      *                                                                   CFT006
     C           P33B      IFNE *BLANKS                                   CFT006
     C                     MOVEL*BLANKS   WUFDDT                          CFT006
     C                     MOVELP33B      WUFDDT                          CFT006
     C                     MOVELWUMTAG    HPRTG                           CFT006
     C                     MOVELWUORIG    TTCA                            CFT006
     C                     MOVE *BLANKS   HPROR1                          177678
     C                     MOVE *BLANKS   HPROR2                          177678
     C                     MOVELTTCA      HPROR1                          CFT006
     C***********KYDESC    CHAIN@EFREJ4              99            CFT006 CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ *OFF                                      CFT006
     C                     MOVELEFSCFD    HPRDS                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVEL*BLANKS   HPRDS                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR1    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN51                           CFT006
     C                     ENDIF                                          CFT006
     C                     WRITEMSGDTL                                    CFT006
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     ENDIF                                          CFT006
      *
      *  Value date/ccy/amount (if there is any)
      *
     C           PDCA      IFNE *BLANKS
     C                     MOVELPDCA      WUFDDT
     C                     MOVELWUMTAG    HPRTG
     C                     MOVELWUORIG    TVDCA
     C*********************MOVELTVDCA     HPRDT                                               162490
     C                     MOVE *BLANKS   HPROR1                          177678
     C                     MOVE *BLANKS   HPROR2                          177678
     C                     MOVELTVDCA     HPROR1                                              162490
     C***********KYDESC    CHAIN@EFREJ4              99                   CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ '0'
     C                     MOVELEFSCFD    HPRDS
     C                     ELSE
     C                     MOVEL*BLANKS   HPRDS
     C                     END
     C           HPROR1    IFNE *BLANKS                                                       162490
     C                     SETON                     51                                       162490
     C                     ENDIF                                                              162490
     C/COPY WNCPYSRC,ME1501C015
     C                     WRITEMSGDTL
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     ENDIF
      *                                                                   CFT006
      *  Exchange Rate (if there is any)                                  CFT006
      *                                                                   CFT006
     C           P36       IFNE *BLANKS                                   CFT006
     C                     MOVEL*BLANKS   WUFDDT                          CFT006
     C                     MOVELP36       WUFDDT                          CFT006
     C                     MOVELWUMTAG    HPRTG                           CFT006
     C                     MOVELWUACCO    HPRDT                           CFT006
     C                     MOVELWUORIG    HPROR1                          CFT006
     C                     MOVE WUORIG    HPROR2                          CFT006
     C***********KYDESC    CHAIN@EFREJ4              99            CFT006 CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ *OFF                                      CFT006
     C                     MOVELEFSCFD    HPRDS                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVEL*BLANKS   HPRDS                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR1    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN51                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR2    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN52                           CFT006
     C                     ENDIF                                          CFT006
     C                     WRITEMSGDTL                                    CFT006
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     MOVE *OFF      *IN51                           CFT006
     C                     MOVE *OFF      *IN52                           CFT006
     C                     ENDIF                                          CFT006
      *
      *  Ordering Customer (if there is any)
      *
     C           P50       IFNE *BLANKS
     C                     MOVELP50       WUFDDT
     C                     MOVELWUMTAG    HPRTG
     C                     MOVELWUACCO    HPRDT
     C                     MOVELWUORIG    HPROR1
     C                     MOVE WUORIG    HPROR2
     C***********KYDESC    CHAIN@EFREJ4              99                   CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ '0'
     C                     MOVELEFSCFD    HPRDS
     C                     ELSE
     C                     MOVEL*BLANKS   HPRDS
     C                     END
     C           HPROR1    IFNE *BLANKS
     C                     SETON                     51
     C                     ENDIF
     C           HPROR2    IFNE *BLANKS
     C                     SETON                     52
     C                     ENDIF
     C/COPY WNCPYSRC,ME1501C016
     C                     WRITEMSGDTL
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     SETOF                     5152
     C                     ENDIF
      *                                                                   CFT006
      *  Instructing Party (if there is any)                              CFT006
      *                                                                   CFT006
     C           P50L      IFNE *BLANKS                                   CFT006
     C                     MOVEL*BLANKS   WUFDDT                          CFT006
     C                     MOVELP50L      WUFDDT                          CFT006
     C                     MOVELWUMTAG    HPRTG                           CFT006
     C                     MOVELWUACCO    HPRDT                           CFT006
     C                     MOVELWUORIG    HPROR1                          CFT006
     C                     MOVE WUORIG    HPROR2                          CFT006
     C***********KYDESC    CHAIN@EFREJ4              99            CFT006 CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ *OFF                                      CFT006
     C                     MOVELEFSCFD    HPRDS                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVEL*BLANKS   HPRDS                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR1    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN51                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR2    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN52                           CFT006
     C                     ENDIF                                          CFT006
     C                     WRITEMSGDTL                                    CFT006
     C                     MOVE *OFF      *IN51                           CFT006
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     MOVE *OFF      *IN52                           CFT006
     C                     ENDIF                                          CFT006
      *
      *  Ordering Institution (if there is any)
      *
     C           P52       IFNE *BLANKS
     C                     MOVELP52       WUFDDT
     C                     MOVELWUMTAG    HPRTG
     C                     MOVELWUACCO    HPRDT
     C                     MOVELWUORIG    HPROR1
     C                     MOVE WUORIG    HPROR2
     C***********KYDESC    CHAIN@EFREJ4              99                   CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ '0'
     C                     MOVELEFSCFD    HPRDS
     C                     ELSE
     C                     MOVEL*BLANKS   HPRDS
     C                     END
     C           HPROR1    IFNE *BLANKS
     C                     SETON                     51
     C                     ENDIF
     C           HPROR2    IFNE *BLANKS
     C                     SETON                     52
     C                     ENDIF
     C/COPY WNCPYSRC,ME1501C017
     C                     WRITEMSGDTL
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     SETOF                     5152
     C                     ENDIF
      *
      *  Sender's Correspondent (if there is any)
      *
     C           P53       IFNE *BLANKS
     C                     MOVELP53       WUFDDT
     C                     MOVELWUMTAG    HPRTG
     C                     MOVELWUACCO    HPRDT
     C                     MOVELWUORIG    HPROR1
     C                     MOVE WUORIG    HPROR2
     C***********KYDESC    CHAIN@EFREJ4              99                   CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ '0'
     C                     MOVELEFSCFD    HPRDS
     C                     ELSE
     C                     MOVEL*BLANKS   HPRDS
     C                     END
     C           HPROR1    IFNE *BLANKS
     C                     SETON                     51
     C                     ENDIF
     C           HPROR2    IFNE *BLANKS
     C                     SETON                     52
     C                     ENDIF
     C/COPY WNCPYSRC,ME1501C018
     C                     WRITEMSGDTL
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     SETOF                     5152
     C                     ENDIF
      *
      *  Receiver's Correspondent (if there is any)
      *
     C           P54       IFNE *BLANKS
     C                     MOVELP54       WUFDDT
     C                     MOVELWUMTAG    HPRTG
     C                     MOVELWUACCO    HPRDT
     C                     MOVELWUORIG    HPROR1
     C                     MOVE WUORIG    HPROR2
     C***********KYDESC    CHAIN@EFREJ4              99                   CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ '0'
     C                     MOVELEFSCFD    HPRDS
     C                     ELSE
     C                     MOVEL*BLANKS   HPRDS
     C                     END
     C           HPROR1    IFNE *BLANKS
     C                     SETON                     51
     C                     ENDIF
     C           HPROR2    IFNE *BLANKS
     C                     SETON                     52
     C                     ENDIF
     C/COPY WNCPYSRC,ME1501C019
     C                     WRITEMSGDTL
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     SETOF                     5152
     C                     ENDIF
      *                                                                   CFT014
      *  Third Reimb Institution (if there is any)                        CFT014
      *                                                                   CFT014
     C           P55       IFNE *BLANKS                                   CFT014
     C                     MOVELP55       WUFDDT                          CFT014
     C                     MOVELWUMTAG    HPRTG                           CFT014
     C                     MOVELWUACCO    HPRDT                           CFT014
     C                     MOVELWUORIG    HPROR1                          CFT014
     C                     MOVE WUORIG    HPROR2                          CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ '0'                                       CFT014
     C                     MOVELEFSCFD    HPRDS                           CFT014
     C                     ELSE                                           CFT014
     C                     MOVEL*BLANKS   HPRDS                           CFT014
     C                     END                                            CFT014
     C           HPROR1    IFNE *BLANKS                                   CFT014
     C                     SETON                     51                   CFT014
     C                     ENDIF                                          CFT014
     C           HPROR2    IFNE *BLANKS                                   CFT014
     C                     SETON                     52                   CFT014
     C                     ENDIF                                          CFT014
     C                     WRITEMSGDTL                                    CFT014
      *                                                                   CFT014
     C           *IN25     IFEQ *ON                                       CFT014
     C                     WRITEHEADER                                    CFT014
     C                     MOVE *OFF      *IN25                           CFT014
     C                     ENDIF                                          CFT014
      *                                                                   CFT014
     C                     SETOF                     5152                 CFT014
     C                     ENDIF                                          CFT014
      *
      *  Intermediary (if there is any)
      *
     C/COPY WNCPYSRC,ME1501C020
     C           P56       IFNE *BLANKS
     C/COPY WNCPYSRC,ME1501C021
     C                     MOVELP56       WUFDDT
     C/COPY WNCPYSRC,ME1501C022
     C                     MOVELWUMTAG    HPRTG
     C                     MOVELWUACCO    HPRDT
     C                     MOVELWUORIG    HPROR1
     C                     MOVE WUORIG    HPROR2
     C***********KYDESC    CHAIN@EFREJ4              99                   CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ '0'
     C                     MOVELEFSCFD    HPRDS
     C                     ELSE
     C                     MOVEL*BLANKS   HPRDS
     C                     END
     C           HPROR1    IFNE *BLANKS
     C                     SETON                     51
     C                     ENDIF
     C           HPROR2    IFNE *BLANKS
     C                     SETON                     52
     C                     ENDIF
     C/COPY WNCPYSRC,ME1501C023
     C                     WRITEMSGDTL
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     SETOF                     5152
     C                     ENDIF
      *
      *  Account with Institution (if there is any)
      *
     C           P57       IFNE *BLANKS
     C/COPY WNCPYSRC,ME1501C024
     C                     MOVELP57       WUFDDT
     C/COPY WNCPYSRC,ME1501C025
     C                     MOVELWUMTAG    HPRTG
     C                     MOVELWUACCO    HPRDT
     C                     MOVELWUORIG    HPROR1
     C                     MOVE WUORIG    HPROR2
     C***********KYDESC    CHAIN@EFREJ4              99                   CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ '0'
     C                     MOVELEFSCFD    HPRDS
     C                     ELSE
     C                     MOVEL*BLANKS   HPRDS
     C                     END
     C           HPROR1    IFNE *BLANKS
     C                     SETON                     51
     C                     ENDIF
     C           HPROR2    IFNE *BLANKS
     C                     SETON                     52
     C                     ENDIF
     C/COPY WNCPYSRC,ME1501C026
     C                     WRITEMSGDTL
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     SETOF                     5152
     C                     ENDIF
      *
      *  Beneficiary Institution (if there is any)
      *
     C           P58       IFNE *BLANKS
     C                     MOVELP58       WUFDDT
     C                     MOVELWUMTAG    HPRTG
     C                     MOVELWUACCO    HPRDT
     C                     MOVELWUORIG    HPROR1
     C                     MOVE WUORIG    HPROR2
     C***********KYDESC    CHAIN@EFREJ4              99                   CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ '0'
     C                     MOVELEFSCFD    HPRDS
     C                     ELSE
     C                     MOVEL*BLANKS   HPRDS
     C                     END
     C           HPROR1    IFNE *BLANKS
     C                     SETON                     51
     C                     ENDIF
     C           HPROR2    IFNE *BLANKS
     C                     SETON                     52
     C                     ENDIF
     C/COPY WNCPYSRC,ME1501C027
     C                     WRITEMSGDTL
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     SETOF                     5152
     C                     ENDIF
      *
      *  Beneficiary Customer (if there is any)
      *
     C           P59       IFNE *BLANKS
     C                     MOVELP59       WUFDDT
     C                     MOVELWUMTAG    HPRTG
     C                     MOVELWUACCO    HPRDT
     C                     MOVELWUORIG    HPROR1
     C                     MOVE WUORIG    HPROR2
     C***********KYDESC    CHAIN@EFREJ4              99                   CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ '0'
     C                     MOVELEFSCFD    HPRDS
     C                     ELSE
     C                     MOVEL*BLANKS   HPRDS
     C                     END
     C           HPROR1    IFNE *BLANKS
     C                     SETON                     51
     C                     ENDIF
     C           HPROR2    IFNE *BLANKS
     C                     SETON                     52
     C                     ENDIF
     C/COPY WNCPYSRC,ME1501C028
     C                     WRITEMSGDTL
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     SETOF                     5152
     C                     ENDIF
      *
      *  Details of Payment (if there is any)
      *
     C           P70       IFNE *BLANKS
     C                     MOVELP70       WUFDDT
     C                     MOVELWUMTAG    HPRTG
     C                     MOVELWUACCO    HPRDT
     C                     MOVELWUORIG    HPROR1
     C                     MOVE WUORIG    HPROR2
     C***********KYDESC    CHAIN@EFREJ4              99                   CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ '0'
     C                     MOVELEFSCFD    HPRDS
     C                     ELSE
     C                     MOVEL*BLANKS   HPRDS
     C                     END
     C           HPROR1    IFNE *BLANKS
     C                     SETON                     51
     C                     ENDIF
     C           HPROR2    IFNE *BLANKS
     C                     SETON                     52
     C                     ENDIF
     C/COPY WNCPYSRC,ME1501C029
     C                     WRITEMSGDTL
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     SETOF                     5152
     C                     ENDIF
      *                                                                                       CER030
      ** Processing of Extended narratives                                                    CER030
      *                                                                                       CER030
     C           CER031    IFEQ 'Y'                                                           CER030
     C           PEXN      ANDNE*BLANKS                                                       CER030
     C                     MOVELPEXN      WUFDDT                                              CER030
     C                     MOVELWUMTAG    HPRTG                                               CER030
     C                     MOVELWUACCO    HPRDT                                               CER030
     C                     MOVELWUORIG    HPROR1                                              CER030
     C                     MOVE WUORIG    HPROR2                                              CER030
     C                     EXSR RTVTGD                                                        CER030
     C           *IN99     IFEQ *OFF                                                          CER030
     C                     MOVELEFSCFD    HPRDS                                               CER030
     C                     ELSE                                                               CER030
     C                     MOVEL*BLANKS   HPRDS                                               CER030
     C                     END                                                                CER030
     C           HPROR1    IFNE *BLANKS                                                       CER030
     C                     MOVE *ON       *IN51                                               CER030
     C                     ENDIF                                                              CER030
     C           HPROR2    IFNE *BLANKS                                                       CER030
     C                     MOVE *ON       *IN52                                               CER030
     C                     ENDIF                                                              CER030
      *                                                                                       CER030
     C                     WRITEMSGDTL                                                        CER030
      *                                                                                       CER030
     C           *IN25     IFEQ *ON                                                           CER030
     C                     WRITEHEADER                                                        CER030
     C                     MOVE *OFF      *IN25                                               CER030
     C                     ENDIF                                                              CER030
      *                                                                                       CER030
     C                     MOVE *OFF      *IN51                                               CER030
     C                     MOVE *OFF      *IN52                                               CER030
     C                     ENDIF                                                              CER030
      *
      *  Details of Charges (if there is any)
      *
     C           P71       IFNE *BLANKS
     C                     MOVELP71       WUFDDT
     C                     MOVELWUMTAG    HPRTG
     C                     MOVELWUACCO    HPRDT
     C                     MOVELWUORIG    HPROR1
     C                     MOVE WUORIG    HPROR2
     C***********KYDESC    CHAIN@EFREJ4              99                   CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ '0'
     C                     MOVELEFSCFD    HPRDS
     C                     ELSE
     C                     MOVEL*BLANKS   HPRDS
     C                     END
     C           HPROR1    IFNE *BLANKS
     C                     SETON                     51
     C                     ENDIF
     C           HPROR2    IFNE *BLANKS
     C                     SETON                     52
     C                     ENDIF
     C/COPY WNCPYSRC,ME1501C030
     C                     WRITEMSGDTL
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     SETOF                     5152
     C                     ENDIF
      *                                                                   CFT006
      *  Sender's Charges/Amount (if there is any)                        CFT006
      *                                                                   CFT006
     C           P71F      IFNE *BLANKS                                   CFT006
     C                     MOVEL*BLANKS   WUFDDT                          CFT006
     C                     MOVELP71F      WUFDDT                          CFT006
     C                     MOVELWUMTAG    HPRTG                           CFT006
     C                     MOVELWUORIG    TTCA                            CFT006
     C                     MOVE *BLANKS   HPROR1                          177678
     C                     MOVE *BLANKS   HPROR2                          177678
     C                     MOVELTTCA      HPROR1                          CFT006
     C***********KYDESC    CHAIN@EFREJ4              99            CFT006 CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ *OFF                                      CFT006
     C                     MOVELEFSCFD    HPRDS                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVEL*BLANKS   HPRDS                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR1    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN51                           CFT006
     C                     ENDIF                                          CFT006
     C                     WRITEMSGDTL                                    CFT006
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      *  Receiver's Charges/Amount (if there is any)                      CFT006
      *                                                                   CFT006
     C           P71G      IFNE *BLANKS                                   CFT006
     C                     MOVEL*BLANKS   WUFDDT                          CFT006
     C                     MOVELP71G      WUFDDT                          CFT006
     C                     MOVELWUMTAG    HPRTG                           CFT006
     C                     MOVELWUORIG    TTCA                            CFT006
     C                     MOVE *BLANKS   HPROR1                          177678
     C                     MOVE *BLANKS   HPROR2                          177678
     C                     MOVELTTCA      HPROR1                          CFT006
     C***********KYDESC    CHAIN@EFREJ4              99            CFT006 CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ *OFF                                      CFT006
     C                     MOVELEFSCFD    HPRDS                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVEL*BLANKS   HPRDS                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR1    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN51                           CFT006
     C                     ENDIF                                          CFT006
     C                     WRITEMSGDTL                                    CFT006
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     ENDIF                                          CFT006
      *
      *  Bank to Bank information (if there is any)
      *
     C           P72       IFNE *BLANKS
     C                     MOVELP72       WUFDDT
     C                     MOVELWUMTAG    HPRTG
     C                     SELEC                                          CGL009
      *  For FONTIS                                                       CGL009
      *  We don't allow for the decoded field because tag 72              CGL009
      *  is not formated in the same way. (The first line can be          CGL009
      *  65 chars long and the other 35 chars)                            CGL009
     C           PNWRK     WHEQ 'FONTIS'                                  CGL009
     C                     MOVELF72       HPROR1                          CGL009
     C                     MOVE F72       HPROR2                          CGL009
      *  Other Networks                                                   CGL009
     C                     OTHER                                          CGL009
     C                     MOVELWUACCO    HPRDT                           CGL009
     C                     MOVELWUORIG    HPROR1                          CGL009
     C                     MOVE WUORIG    HPROR2                          CGL009
     C                     ENDSL                                          CGL009
     C***********KYDESC    CHAIN@EFREJ4              99                   CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ '0'
     C                     MOVELEFSCFD    HPRDS
     C                     ELSE
     C                     MOVEL*BLANKS   HPRDS
     C                     END
     C           HPROR1    IFNE *BLANKS
     C                     SETON                     51
     C                     ENDIF
     C           HPROR2    IFNE *BLANKS
     C                     SETON                     52
     C                     ENDIF
     C/COPY WNCPYSRC,ME1501C031
     C                     WRITEMSGDTL
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     SETOF                     5152
     C                     ENDIF
      *                                                                   CFT006
      *  Regulatory Reporting (if there is any)                           CFT006
      *                                                                   CFT006
     C           P77B      IFNE *BLANKS                                   CFT006
     C                     MOVEL*BLANKS   WUFDDT                          CFT006
     C                     MOVELP77B      WUFDDT                          CFT006
     C                     MOVELWUMTAG    HPRTG                           CFT006
     C                     MOVELWUACCO    HPRDT                           CFT006
     C                     MOVELWUORIG    HPROR1                          CFT006
     C                     MOVE WUORIG    HPROR2                          CFT006
     C***********KYDESC    CHAIN@EFREJ4              99            CFT006 CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ *OFF                                      CFT006
     C                     MOVELEFSCFD    HPRDS                           CFT006
     C                     ELSE                                           CFT006
     C                     MOVEL*BLANKS   HPRDS                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR1    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN51                           CFT006
     C                     ENDIF                                          CFT006
     C           HPROR2    IFNE *BLANKS                                   CFT006
     C                     MOVE *ON       *IN52                           CFT006
     C                     ENDIF                                          CFT006
     C                     WRITEMSGDTL                                    CFT006
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     MOVE *OFF      *IN51                           CFT006
     C                     MOVE *OFF      *IN52                           CFT006
     C                     ENDIF                                          CFT006
      *
      *  Sender Address Information (if there is any)
      *
     C           PSN       IFNE *BLANKS
     C                     MOVELPSN       WUFDDT
     C                     MOVELWUMTAG    HPRTG
     C                     MOVELWUACCO    HPRDT
     C                     MOVELWUORIG    HPROR1
     C                     MOVE WUORIG    HPROR2
     C***********KYDESC    CHAIN@EFREJ4              99                   CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ '0'
     C                     MOVELEFSCFD    HPRDS
     C                     ELSE
     C                     MOVEL*BLANKS   HPRDS
     C                     END
     C           HPROR1    IFNE *BLANKS
     C                     SETON                     51
     C                     ENDIF
     C           HPROR2    IFNE *BLANKS
     C                     SETON                     52
     C                     ENDIF
     C/COPY WNCPYSRC,ME1501C032
     C                     WRITEMSGDTL
      *                                                                   CFT006
     C           *IN25     IFEQ *ON                                       CFT006
     C                     WRITEHEADER                                    CFT006
     C                     MOVE *OFF      *IN25                           CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     SETOF                     5152
     C                     ENDIF
     C/COPY WNCPYSRC,ME1501C033
     C           CSW209    IFEQ 'Y'                                                           CSW209
     C           PB50      IFNE *BLANKS                                                       CSW209
     C                     MOVEL*BLANKS   WUFDDT                                              CSW209
     C                     MOVELPB50      WUFDDT                                              CSW209
     C                     MOVELWUMTAG    HPRTG                                               CSW209
     C                     MOVELWUACCO    HPRDT                                               CSW209
     C                     MOVELWUORIG    HPROR1                                              CSW209
     C                     MOVE WUORIG    HPROR2                                              CSW209
     C                     MOVE 'B'       WMSEQ                                               CSW209
     C                     EXSR RTVTGD                                                        CSW209
     C           *IN99     IFEQ '0'                                                           CSW209
     C                     MOVELEFSCFD    HPRDS                                               CSW209
     C                     ELSE                                                               CSW209
     C                     MOVEL*BLANKS   HPRDS                                               CSW209
     C                     END                                                                CSW209
     C           HPROR1    IFNE *BLANKS                                                       CSW209
     C                     SETON                     51                                       CSW209
     C                     ENDIF                                                              CSW209
     C           HPROR2    IFNE *BLANKS                                                       CSW209
     C                     SETON                     52                                       CSW209
     C                     ENDIF                                                              CSW209
     C                     WRITEMSGDTL                                                        CSW209
      *                                                                                       CSW209
     C           *IN25     IFEQ *ON                                                           CSW209
     C                     WRITEHEADER                                                        CSW209
     C                     MOVE *OFF      *IN25                                               CSW209
     C                     ENDIF                                                              CSW209
      *                                                                                       CSW209
     C                     SETOF                     5152                                     CSW209
     C                     ENDIF                                                              CSW209
      *
     C           PB52      IFNE *BLANKS                                                       CSW209
     C                     MOVEL*BLANKS   WUFDDT                                              CSW209
     C                     MOVELPB52      WUFDDT                                              CSW209
     C                     MOVELWUMTAG    HPRTG                                               CSW209
     C                     MOVELWUACCO    HPRDT                                               CSW209
     C                     MOVELWUORIG    HPROR1                                              CSW209
     C                     MOVE WUORIG    HPROR2                                              CSW209
     C                     MOVE 'B'       WMSEQ                                               CSW209
     C                     EXSR RTVTGD                                                        CSW209
     C           *IN99     IFEQ '0'                                                           CSW209
     C                     MOVELEFSCFD    HPRDS                                               CSW209
     C                     ELSE                                                               CSW209
     C                     MOVEL*BLANKS   HPRDS                                               CSW209
     C                     END                                                                CSW209
     C           HPROR1    IFNE *BLANKS                                                       CSW209
     C                     SETON                     51                                       CSW209
     C                     ENDIF                                                              CSW209
     C           HPROR2    IFNE *BLANKS                                                       CSW209
     C                     SETON                     52                                       CSW209
     C                     ENDIF                                                              CSW209
     C                     WRITEMSGDTL                                                        CSW209
      *                                                                                       CSW209
     C           *IN25     IFEQ *ON                                                           CSW209
     C                     WRITEHEADER                                                        CSW209
     C                     MOVE *OFF      *IN25                                               CSW209
     C                     ENDIF                                                              CSW209
      *                                                                                       CSW209
     C                     SETOF                     5152                                     CSW209
     C                     ENDIF                                                              CSW209
      *                                                                                       CSW209
     C           PB56      IFNE *BLANKS                                                       CSW209
     C                     MOVEL*BLANKS   WUFDDT                                              CSW209
     C                     MOVELPB56      WUFDDT                                              CSW209
     C                     MOVELWUMTAG    HPRTG                                               CSW209
     C                     MOVELWUACCO    HPRDT                                               CSW209
     C                     MOVELWUORIG    HPROR1                                              CSW209
     C                     MOVE WUORIG    HPROR2                                              CSW209
     C                     MOVE 'B'       WMSEQ                                               CSW209
     C                     EXSR RTVTGD                                                        CSW209
     C           *IN99     IFEQ '0'                                                           CSW209
     C                     MOVELEFSCFD    HPRDS                                               CSW209
     C                     ELSE                                                               CSW209
     C                     MOVEL*BLANKS   HPRDS                                               CSW209
     C                     END                                                                CSW209
     C           HPROR1    IFNE *BLANKS                                                       CSW209
     C                     SETON                     51                                       CSW209
     C                     ENDIF                                                              CSW209
     C           HPROR2    IFNE *BLANKS                                                       CSW209
     C                     SETON                     52                                       CSW209
     C                     ENDIF                                                              CSW209
     C                     WRITEMSGDTL                                                        CSW209
      *                                                                                       CSW209
     C           *IN25     IFEQ *ON                                                           CSW209
     C                     WRITEHEADER                                                        CSW209
     C                     MOVE *OFF      *IN25                                               CSW209
     C                     ENDIF                                                              CSW209
      *                                                                                       CSW209
     C                     SETOF                     5152                                     CSW209
     C                     ENDIF                                                              CSW209
      *                                                                                       CSW209
     C           PB57      IFNE *BLANKS                                                       CSW209
     C                     MOVEL*BLANKS   WUFDDT                                              CSW209
     C                     MOVELPB57      WUFDDT                                              CSW209
     C                     MOVELWUMTAG    HPRTG                                               CSW209
     C                     MOVELWUACCO    HPRDT                                               CSW209
     C                     MOVELWUORIG    HPROR1                                              CSW209
     C                     MOVE WUORIG    HPROR2                                              CSW209
     C                     MOVE 'B'       WMSEQ                                               CSW209
     C                     EXSR RTVTGD                                                        CSW209
     C           *IN99     IFEQ '0'                                                           CSW209
     C                     MOVELEFSCFD    HPRDS                                               CSW209
     C                     ELSE                                                               CSW209
     C                     MOVEL*BLANKS   HPRDS                                               CSW209
     C                     END                                                                CSW209
     C           HPROR1    IFNE *BLANKS                                                       CSW209
     C                     SETON                     51                                       CSW209
     C                     ENDIF                                                              CSW209
     C           HPROR2    IFNE *BLANKS                                                       CSW209
     C                     SETON                     52                                       CSW209
     C                     ENDIF                                                              CSW209
     C                     WRITEMSGDTL                                                        CSW209
      *                                                                                       CSW209
     C           *IN25     IFEQ *ON                                                           CSW209
     C                     WRITEHEADER                                                        CSW209
     C                     MOVE *OFF      *IN25                                               CSW209
     C                     ENDIF                                                              CSW209
      *                                                                                       CSW209
     C                     SETOF                     5152                                     CSW209
     C                     ENDIF                                                              CSW209
      *                                                                                       CSW209
     C           PB59      IFNE *BLANKS                                                       CSW209
     C                     MOVEL*BLANKS   WUFDDT                                              CSW209
     C                     MOVELPB59      WUFDDT                                              CSW209
     C                     MOVELWUMTAG    HPRTG                                               CSW209
     C                     MOVELWUACCO    HPRDT                                               CSW209
     C                     MOVELWUORIG    HPROR1                                              CSW209
     C                     MOVE WUORIG    HPROR2                                              CSW209
     C                     MOVE 'B'       WMSEQ                                               CSW209
     C                     EXSR RTVTGD                                                        CSW209
     C           *IN99     IFEQ '0'                                                           CSW209
     C                     MOVELEFSCFD    HPRDS                                               CSW209
     C                     ELSE                                                               CSW209
     C                     MOVEL*BLANKS   HPRDS                                               CSW209
     C                     END                                                                CSW209
     C           HPROR1    IFNE *BLANKS                                                       CSW209
     C                     SETON                     51                                       CSW209
     C                     ENDIF                                                              CSW209
     C           HPROR2    IFNE *BLANKS                                                       CSW209
     C                     SETON                     52                                       CSW209
     C                     ENDIF                                                              CSW209
     C                     WRITEMSGDTL                                                        CSW209
      *                                                                                       CSW209
     C           *IN25     IFEQ *ON                                                           CSW209
     C                     WRITEHEADER                                                        CSW209
     C                     MOVE *OFF      *IN25                                               CSW209
     C                     ENDIF                                                              CSW209
      *                                                                                       CSW209
     C                     SETOF                     5152                                     CSW209
     C                     ENDIF                                                              CSW209
      *                                                                                       CSW209
     C           PB70      IFNE *BLANKS                                                       CSW209
     C                     MOVEL*BLANKS   WUFDDT                                              CSW209
     C                     MOVELPB70      WUFDDT                                              CSW209
     C                     MOVELWUMTAG    HPRTG                                               CSW209
     C                     MOVELWUACCO    HPRDT                                               CSW209
     C                     MOVELWUORIG    HPROR1                                              CSW209
     C                     MOVE WUORIG    HPROR2                                              CSW209
     C                     MOVE 'B'       WMSEQ                                               CSW209
     C                     EXSR RTVTGD                                                        CSW209
     C           *IN99     IFEQ '0'                                                           CSW209
     C                     MOVELEFSCFD    HPRDS                                               CSW209
     C                     ELSE                                                               CSW209
     C                     MOVEL*BLANKS   HPRDS                                               CSW209
     C                     END                                                                CSW209
     C           HPROR1    IFNE *BLANKS                                                       CSW209
     C                     SETON                     51                                       CSW209
     C                     ENDIF                                                              CSW209
     C           HPROR2    IFNE *BLANKS                                                       CSW209
     C                     SETON                     52                                       CSW209
     C                     ENDIF                                                              CSW209
     C                     WRITEMSGDTL                                                        CSW209
      *                                                                                       CSW209
     C           *IN25     IFEQ *ON                                                           CSW209
     C                     WRITEHEADER                                                        CSW209
     C                     MOVE *OFF      *IN25                                               CSW209
     C                     ENDIF                                                              CSW209
      *                                                                                       CSW209
     C                     SETOF                     5152                                     CSW209
     C                     ENDIF                                                              CSW209
      *                                                                                       CSW209
     C           PB72      IFNE *BLANKS                                                       CSW209
     C                     MOVEL*BLANKS   WUFDDT                                              CSW209
     C                     MOVELPB72      WUFDDT                                              CSW209
     C                     MOVELWUMTAG    HPRTG                                               CSW209
     C                     MOVELWUACCO    HPRDT                                               CSW209
     C                     MOVELWUORIG    HPROR1                                              CSW209
     C                     MOVE WUORIG    HPROR2                                              CSW209
     C                     MOVE 'B'       WMSEQ                                               CSW209
     C                     EXSR RTVTGD                                                        CSW209
     C           *IN99     IFEQ '0'                                                           CSW209
     C                     MOVELEFSCFD    HPRDS                                               CSW209
     C                     ELSE                                                               CSW209
     C                     MOVEL*BLANKS   HPRDS                                               CSW209
     C                     END                                                                CSW209
     C           HPROR1    IFNE *BLANKS                                                       CSW209
     C                     SETON                     51                                       CSW209
     C                     ENDIF                                                              CSW209
     C           HPROR2    IFNE *BLANKS                                                       CSW209
     C                     SETON                     52                                       CSW209
     C                     ENDIF                                                              CSW209
     C                     WRITEMSGDTL                                                        CSW209
      *                                                                                       CSW209
     C           *IN25     IFEQ *ON                                                           CSW209
     C                     WRITEHEADER                                                        CSW209
     C                     MOVE *OFF      *IN25                                               CSW209
     C                     ENDIF                                                              CSW209
      *                                                                                       CSW209
     C                     SETOF                     5152                                     CSW209
     C                     ENDIF                                                              CSW209
      *                                                                                       CSW209
     C           PB33B     IFNE *BLANKS                                                       CSW209
     C                     MOVEL*BLANKS   WUFDDT                                              CSW209
     C                     MOVELPB33B     WUFDDT                                              CSW209
     C                     MOVELWUMTAG    HPRTG                                               CSW209
     C                     MOVELWUORIG    TTCA                                                CSW209
     C                     MOVE *BLANKS   HPROR1                                              CSW209
     C                     MOVE *BLANKS   HPROR2                                              CSW209
     C                     MOVE TTCA      HPROR1                                              CSW209
     C                     MOVE 'B'       WMSEQ                                               CSW209
     C                     EXSR RTVTGD                                                        CSW209
     C           *IN99     IFEQ '0'                                                           CSW209
     C                     MOVELEFSCFD    HPRDS                                               CSW209
     C                     ELSE                                                               CSW209
     C                     MOVEL*BLANKS   HPRDS                                               CSW209
     C                     END                                                                CSW209
     C           HPROR1    IFNE *BLANKS                                                       CSW209
     C                     SETON                     51                                       CSW209
     C                     ENDIF                                                              CSW209
     C                     WRITEMSGDTL                                                        CSW209
      *                                                                                       CSW209
     C           *IN25     IFEQ *ON                                                           CSW209
     C                     WRITEHEADER                                                        CSW209
     C                     MOVE *OFF      *IN25                                               CSW209
     C                     ENDIF                                                              CSW209
      *                                                                                       CSW209
     C                     SETOF                     51                                       CSW209
      *                                                                                       CSW209
     C                     ENDIF                                                              CSW209
     C                     ENDIF                                                              CSW209
      *                                                                                       CSW209
      *  Message Header/Trailer (if there is any)
      *
     C           WUHK3     IFNE *BLANKS
     C                     Z-ADD1         H3
     C           HK3,H3    DOWNE*BLANKS
     C           H3        ANDLEWUHDNO
     C                     MOVELHK3,H3    HPRTG
     C                     MOVELHK4,H3    HPROR1
     C***********KYDESC    CHAIN@EFREJ4              99                   CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ '0'
     C                     MOVELEFSCFD    HPRDS
     C                     ELSE
     C                     MOVEL*BLANKS   HPRDS
     C                     END
     C           HPROR1    IFNE *BLANKS
     C                     SETON                     51
     C                     ENDIF
     C/COPY WNCPYSRC,ME1501C034
     C                     WRITEMSGDTL                 99
     C                     SETOF                     51
     C                     ADD  1         H3
      *
      *  Write Report Header if overflow
      *
     C           *IN99     IFEQ '1'
     C                     WRITEHEADER
     C                     SETOF                     99
     C                     ENDIF
      *
     C                     ENDDO
     C                     ENDIF
      *
      *  Other details (if there is any)
      *
     C           WUHK5     IFNE *BLANKS
     C                     Z-ADD1         H4
     C           HK5,H4    DOWNE*BLANKS
     C           H4        ANDLEWUHDNO
     C                     MOVELHK5,H4    HPRTG
     C                     MOVELHK6,H4    HPROR1
     C***********KYDESC    CHAIN@EFREJ4              99                   CFT014
     C                     EXSR RTVTGD                                    CFT014
     C           *IN99     IFEQ '0'
     C                     MOVELEFSCFD    HPRDS
     C                     ELSE
     C                     MOVEL*BLANKS   HPRDS
     C                     END
     C           HPROR1    IFNE *BLANKS
     C                     SETON                     51
     C                     ENDIF
     C/COPY WNCPYSRC,ME1501C035
     C                     WRITEMSGDTL                 99
     C                     SETOF                     51
     C                     ADD  1         H4
      *
      *  Write Report Header if overflow
      *
     C           *IN99     IFEQ '1'
     C                     WRITEHEADER
     C                     SETOF                     99
     C                     ENDIF
      *
     C                     ENDDO
     C                     ENDIF
      *
      *  Footer
      *
     C                     WRITEFOOTER
      *
      * Close printer file
      *
     C                     CLOSEME1501P1
      *
      *  Unwind subroutine stack name
      *
     C           #HXAUD    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRUCHK   : CHECK FUNCTION (USER DEFINED)                     *
      *                                                               *
      *  CALLED BY: #HFDDT #H1AMT                                     *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     CSR         SRUCHK    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q       50
     C                     MOVEL'SRUCHK'  @STK,Q
      *
      ** Must look like a function
     C           WUASTK    IFNE '*'
     C                     GOTO SRUCKF
     C                     ENDIF
      *
      ** Check that the user defined function exists
      ** (So as to be abble to call the programm tied to it)
      *
      ** Its no use performing the search if the array is empty
     C           WEMPCK    IFEQ *BLANKS
     C           @CK,1     IFEQ *BLANKS
     C                     MOVEL'Y'       WEMPCK  1
     C                     GOTO SRUCKF
     C                     ELSE
     C                     MOVEL'N'       WEMPCK
     C                     ENDIF
     C                     ELSE
     C           WEMPCK    IFEQ 'Y'
     C                     GOTO SRUCKF
     C                     ENDIF
     C                     ENDIF
      *
      ** Before performing a dichotomic search we ensure that
      ** the array is sorted and the beginning and the end are
      ** known
     C           WSRTCK    IFEQ *BLANK
     C                     MOVEL'Y'       WSRTCK  1
      *
      ** Length of @CK = end of the array
     C                     Z-ADD200       WE      30
     C           *LIKE     DEFN WE        WB
     C           *LIKE     DEFN WE        WS
     C           *LIKE     DEFN WE        WF
     C           *LIKE     DEFN WE        WP
      *
     C                     SORTA@CK
      *
      ** Determine the beginning of the Array
     C                     Z-ADD1         WB
     C           WB        DOWLTWE
     C           @CK,WB    IFNE *BLANK
     C                     LEAVE
     C                     ENDIF
     C                     ADD  1         WB
     C                     ENDDO
      *
     C                     ENDIF
      *
      ** SEARCH
      *
      ** Extract Function (e.g *MYFNC, *M ... )                                               162508
     C           *LIKE     DEFN WUFUNC    WUFNCT                                              162508
     C                     Z-ADD0         WLF     20                                          162508
     C                     MOVEL*BLANK    WUFNCT                                              162508
     C                     MOVEL*BLANK    P#PTTN                                              162508
     C           ' '       SCAN WUFUNC    WLF          90                                     162508
     C           *IN90     IFEQ '1'                                                           162508
     C                     GOTO SRUCKF                                                        162508
     C                     ENDIF                                                              162508
     C           WLF       IFEQ 0                                                             162508
      ** Special case where the name of the function fills                                    162508
      ** all the file field (e.g 5 digits)                                                    162508
     C                     Z-ADD5         WLF     20                                          162508
     C                     MOVELWUFUNC    WUFNCT                                              162508
     C                     ADD  2         WLF                                                 162508
     C                     ELSE                                                               162508
     C           WLF       SUBSTWUFUNC    WUFNCT       90                                     162508
     C                     ADD  1         WLF                                                 162508
     C                     ENDIF                                                              162508
      ** Extract pattern (e.g *MYFNC <PATTERN> )                                              162508
     C                     SUBSTWUCRIT:WLFP#PTTN       90                                     162508
     C           *IN90     IFEQ '1'                                                           162508
     C                     GOTO SRUCKF                                                        162508
     C                     ENDIF                                                              162508
      *                                                                                       162508
     C                     Z-ADDWB        WS
     C                     Z-ADDWE        WF
     C           WS        DOWLEWF
      ** WP = (WS + WF) / 2
     C           WS        ADD  WF        WP
     C           WP        MULT 0.5       WP
     C                     MOVEA@CK,WP    @CKDS
     C                     SELEC
      ** Search succeeds
     C***********@CKFNC    WHEQ WUFUNC                                                        162508
     C           @CKFNC    WHEQ WUFNCT                                                        162508
     C           *LIKE     DEFN WUTGCK    P#CHKP
     C/COPY WNCPYSRC,ME1501C037
     C                     CALL @CKPGM                 90
     C                     PARM *BLANK    P#RETN  7
     C                     PARM           PHEAD                                               CSW209
     C                     PARM           PDATA                                               CSW209
     C                     PARM           PDAT2                                               CSW209
     C                     PARM WUTGCK    P#CHKP
     C                     PARM           P#PTTN 32                                           162508
     C                     PARM           GDOPER                                              162508
     C/COPY WNCPYSRC,ME1501C038
     C           P#RETN    IFEQ 'T'
     C           *IN90     ANDEQ'0'
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
     C                     LEAVE
      *
     C***********@CKFNC    WHLT WUFUNC                                                        162508
     C           @CKFNC    WHLT WUFNCT                                                        162508
      ** Search will be performed at the right side of pivot
      ** WS = WP + 1
     C           WP        ADD  1         WS
      *
     C***********@CKFNC    WHGT WUFUNC                                                        162508
     C           @CKFNC    WHGT WUFNCT                                                        162508
      ** Search will be performed at the left side of pivot
      ** WF = WP - 1
     C           WP        SUB  1         WF
      *
     C                     ENDSL
     C                     ENDDO
      *
      *
      ***Unwind subroutine stack name*******                                                  CRE008
      *
     C           SRUCKF    TAG
      *                                                                                       CRE008
      **  Process function from extended user check file                                      CRE008
     C                     EXSR SRECHK                                                        CRE008
      *                                                                                       CRE008
      *  Unwind subroutine stack name                                                         CRE008
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
     CSR                   ENDSR
      *****************************************************************   CRE008
      /EJECT                                                              CRE008
      *****************************************************************   CRE008
      *                                                               *   CRE008
      *  SRECHK   : CHECK FUNCTION (USER DEFINED) -Extended use       *   CRE008
      *             This subroutine works in the same principle as    *   CRE008
      *             SRUCHK, except that it uses the check programs    *   CRE008
      *             defined in MEECHKPD rather than MEUCHKPD.         *   CRE008
      *             When found in MECHKPD, the exit program allows    *   CRE008
      *             a more extensive field comparison by matching     *   CRE008
      *             the test field against other fields in the same   *   CRE008
      *             message.  Also, it is able to pass back any       *   CRE008
      *             significant fields to the calling program.        *   CRE008
      *                                                               *   CRE008
      *  CALLED BY: SRUCHK                                            *   CRE008
      *                                                               *   CRE008
      *  CALLS    :        -                                          *   CRE008
      *                                                               *   CRE008
      *****************************************************************   CRE008
     CSR         SRECHK    BEGSR                                          CRE008
      *                                                                   CRE008
      *  Set up subroutine stack name                                     CRE008
      *                                                                   CRE008
     C                     ADD  1         Q       50                      CRE008
     C                     MOVEL'SRECHK'  @STK,Q                          CRE008
      *                                                                   CRE008
      ** Must look like a function                                        CRE008
     C           WUASTK    IFNE '*'                                       CRE008
     C                     GOTO SRECKF                                    CRE008
     C                     ENDIF                                          CRE008
      *                                                                   CRE008
      ** Check that the user defined function exists                      CRE008
      ** (So as to be abble to call the programm tied to it)              CRE008
      *                                                                   CRE008
      ** Its no use performing the search if the array is empty           CRE008
     C           WEMPCE    IFEQ *BLANKS                                   CRE008
     C           @CE,1     IFEQ *BLANKS                                   CRE008
     C                     MOVEL'Y'       WEMPCE  1                       CRE008
     C                     GOTO SRECKF                                    CRE008
     C                     ELSE                                           CRE008
     C                     MOVEL'N'       WEMPCE                          CRE008
     C                     ENDIF                                          CRE008
     C                     ELSE                                           CRE008
     C           WEMPCE    IFEQ 'Y'                                       CRE008
     C                     GOTO SRECKF                                    CRE008
     C                     ENDIF                                          CRE008
     C                     ENDIF                                          CRE008
      *                                                                   CRE008
      ** Before performing a dichotomic search we ensure that             CRE008
      ** the array is sorted and thf wsrtcking and the end are            CRE008
      ** known                                                            CRE008
     C           WSRTCE    IFEQ *BLANK                                    CRE008
     C                     MOVEL'Y'       WSRTCE  1                       CRE008
      *                                                                   CRE008
      ** Length of @CE = end of the array                                 CRE008
     C                     Z-ADD200       WE      30                      CRE008
      *                                                                   CRE008
     C                     SORTA@CE                                       CRE008
      *                                                                   CRE008
      ** Determine the beginning of the Array                             CRE008
     C                     Z-ADD1         WB                              CRE008
     C           WB        DOWLTWE                                        CRE008
     C           @CE,WB    IFNE *BLANK                                    CRE008
     C                     LEAVE                                          CRE008
     C                     ENDIF                                          CRE008
     C                     ADD  1         WB                              CRE008
     C                     ENDDO                                          CRE008
      *                                                                   CRE008
     C                     ENDIF                                          CRE008
      *                                                                   CRE008
      ** SEARCH                                                           CRE008
      *                                                                   CRE008
      ** Extract Function (e.g *MYFNC, *M ... )                           CRE008
     C                     Z-ADD0         WLF     20                      CRE008
     C                     MOVEL*BLANK    WUFNCT                          CRE008
     C                     MOVEL*BLANK    P#PTTN                          CRE008
     C           ' '       SCAN WUFUNC    WLF          90                 CRE008
     C           *IN90     IFEQ '1'                                       CRE008
     C                     GOTO SRECKF                                    CRE008
     C                     ENDIF                                          CRE008
     C           WLF       IFEQ 0                                         CRE008
      ** Special case where the name of the function fills                CRE008
      ** all the file field (e.g 5 digits)                                CRE008
     C                     Z-ADD5         WLF     20                      CRE008
     C                     MOVELWUFUNC    WUFNCT                          CRE008
     C                     ADD  2         WLF                             CRE008
     C                     ELSE                                           CRE008
     C           WLF       SUBSTWUFUNC    WUFNCT       90                 CRE008
     C                     ADD  1         WLF                             CRE008
     C                     ENDIF                                          CRE008
      ** Extract pattern (e.g *MYFNC <PATTERN> )                          CRE008
     C                     SUBSTWUCRIT:WLFP#PTTN       90                 CRE008
     C           *IN90     IFEQ '1'                                       CRE008
     C                     GOTO SRECKF                                    CRE008
     C                     ENDIF                                          CRE008
      *                                                                   CRE008
     C                     Z-ADDWB        WS                              CRE008
     C                     Z-ADDWE        WF                              CRE008
     C           WS        DOWLEWF                                        CRE008
      ** WP = (WS + WF) / 2                                               CRE008
     C           WS        ADD  WF        WP                              CRE008
     C           WP        MULT 0.5       WP                              CRE008
     C                     MOVEA@CE,WP    @CKDS                           CRE008
     C                     SELEC                                          CRE008
      ** Search succeeds                                                  CRE008
     C           @CKFNC    WHEQ WUFNCT                                    CRE008
     C                     CALL @CKPGM                 90                 CRE008
     C                     PARM *BLANK    P#RETN  7                       CRE008
     C                     PARM           PHEAD                           CRE008
     C                     PARM           PDATA                           CRE008
     C                     PARM           PDAT2                                               CSW209
     C                     PARM WUTGCK    P#CHKP                          CRE008
     C                     PARM           P#PTTN 32                       CRE008
     C                     PARM           GDOPER                          CRE008
     C                     PARM           GDMTAG                          CRE008
     C                     PARM           GDREPT                          CRE008
     C                     PARM           W0CPGM                          CRE008
     C           RETFLD    PARM *BLANK    RETFLD256                       CRE008
      *                                                                   CRE008
     C           P#RETN    IFEQ 'T'                                       CRE008
     C           *IN90     ANDEQ'0'                                       CRE008
     C                     MOVE 'Y'       WUMATH                          CRE008
     C* If RETFLD <> blank, accumulate to P@RETV                          CRE008
     C           RETFLD    IFNE *BLANK                                    CRE008
     C           P@RETV    CAT  '/':0     P@RETV                          CRE008
     C           P@RETV    CAT  RETFLD:0  P@RETV                          CRE008
     C                     ENDIF                                          CRE008
     C                     ENDIF                                          CRE008
     C                     LEAVE                                          CRE008
      *                                                                   CRE008
     C           @CKFNC    WHLT WUFNCT                                    CRE008
      ** Search will be performed at the right side of pivot              CRE008
      ** WS = WP + 1                                                      CRE008
     C           WP        ADD  1         WS                              CRE008
      *                                                                   CRE008
     C           @CKFNC    WHGT WUFNCT                                    CRE008
      ** Search will be performed at the left side of pivot               CRE008
      ** WF = WP - 1                                                      CRE008
     C           WP        SUB  1         WF                              CRE008
      *                                                                   CRE008
     C                     ENDSL                                          CRE008
     C                     ENDDO                                          CRE008
      *                                                                   CRE008
      *  Unwind subroutine stack name                                     CRE008
      *                                                                   CRE008
     C           SRECKF    TAG                                            CRE008
      *                                                                   CRE008
     C                     MOVEA*BLANKS   @STK,Q                          CRE008
     C                     SUB  1         Q                               CRE008
     CSR                   ENDSR                                          CRE008
      /EJECT
      *****************************************************************   CFT014
      *                                                               *   CFT014
      *  RTVTGD   : RETRIEVE TAG DESCRIPTION                          *   CFT014
      *                                                               *   CFT014
      *  CALLED BY: #HAUDT                                            *   CFT014
      *                                                               *   CFT014
      *  CALLS    :        -                                          *   CFT014
      *                                                               *   CFT014
      *****************************************************************   CFT014
     CSR         RTVTGD    BEGSR                                          CFT014
      *                                                                   CFT014
      *  Set up subroutine stack name                                     CFT014
      *                                                                   CFT014
     C                     ADD  1         Q       50                      CFT014
     C                     MOVEL'RTVTGD'  @STK,Q                          CFT014
     C           KYDSC1    CHAIN@EFREJ4              99                                       CSW209
     C           *IN99     IFEQ '1'                                                           CSW209
      *                                                                   CFT014
      *  Find first the tag description tied to the specific              CFT014
      *  message type, if not found then find the tag desciption          CFT014
      *  applicable for ALL the message type                              CFT014
     C           KYDSC2    CHAIN@EFREJ4              99                   CFT014
     C           *IN99     IFEQ '1'                                       CFT014
     C           KYDESC    CHAIN@EFREJ4              99                   CFT014
     C                     ENDIF                                          CFT014
     C                     ENDIF                                                              CSW209
      *                                                                   CFT014
      *  Unwind subroutine stack name                                     CFT014
      *                                                                   CFT014
     C           RTTGDF    TAG                                            CFT014
     C                     MOVEA*BLANKS   @STK,Q                          CFT014
     C                     SUB  1         Q                               CFT014
     CSR                   ENDSR                                          CFT014
      /EJECT                                                              CFT014
      *****************************************************************
      *                                                               *
      *  STRFNC   : *STR FUNCTION                                     *
      *                                                               *
      *  CALLED BY: #HFDDT #H1AMT                                     *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     CSR         STRFNC    BEGSR
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q       50
     C                     MOVEL'STRFNC'  @STK,Q
      ** *STRXXX <pattern> check there s a blank between XXX and
      ** <pattern>
     C           WUBLNK    IFNE *BLANK
     C                     GOTO STRFNF
     C                     ENDIF
      ** only test :tag: EQ *STRXXX <pattern>
      **           :tag: NE *STRXXX <pattern>
      ** are allowed
     C           GDOPER    IFNE 'EQ'
     C           GDOPER    ANDNE'NE'
     C                     GOTO STRFNF
     C                     ENDIF
      *
      ** *STRXXX XXX numeric ?
     C           WNUMB     CHECKWUSLEA                   90
     C           *IN90     IFEQ '0'
     C                     Z-ADD0         WPTTN   30
     C                     Z-ADD0         WLC     20
      ** Determine the length of the comparison string
     C           ' '       CHEKRWUSCMP    WLC
     C           WLC       IFGT 0
     C           WUSLEN    IFEQ 0
      ** All the :tag: will be scanned
     C           PNWRK     IFEQ 'FONTIS'                                  CGL009
     C           GDMTAG    ANDEQ':72:'                                    CGL009
     C           WUSCMP:WLCSCAN F72       WPTTN        90                 CGL009
     C                     ELSE                                           CGL009
     C           WUSCMP:WLCSCAN WUO       WPTTN        90
     C                     ENDIF                                          CGL009
     C                     ELSE
      ** The :tag: will be scanned partially
     C           PNWRK     IFEQ 'FONTIS'                                  CGL009
     C           GDMTAG    ANDEQ':72:'                                    CGL009
     C           WUSCMP:WLCSCAN F72:WUSLENWPTTN        90                 CGL009
     C                     ELSE                                           CGL009
     C           WUSCMP:WLCSCAN WUO:WUSLENWPTTN        90
     C                     ENDIF                                          CGL009
     C                     ENDIF
     C           *IN90     IFEQ '0'
     C           WPTTN     ANDNE0
     C                     MOVE 'Y'       WUMATH
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      *  Unwind subroutine stack name
      *
     C           STRFNF    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
     CSR                   ENDSR
      /EJECT
     C/COPY WNCPYSRC,ME1501C036
      *****************************************************************
      *                                                               *
      *  #HINIT   : Initialise and define fields                      *
      *                                                               *
      *  CALLED BY: Main processing                                   *
      *                                                               *
      *  CALLS    :        -                                          *
      *                                                               *
      *****************************************************************
     CSR         #HINIT    BEGSR
      *
      *  Set up copyright statement
      *
     C                     MOVEACPY@      BIS@   80
      *
      *  Set up subroutine stack name
      *
     C                     ADD  1         Q       50
     C                     MOVEL'#HINIT'  @STK,Q
      *
      *  Set up no. of entries per criteria table record
      *
     C                     Z-ADD6         WUCRNO  10
      *
      *  Set up no. of entries per Header/Trailer array
      *
     C                     Z-ADD28        WUHDNO  20
      *
      *  Set up Overflow line no.
      *
     C                     Z-ADD60        WUOVFL  20
      *
      *  Set up max. no. of entries on Vostro A/c code array
      *
     C**********           Z-ADD20        WUVOAC  20                                          197953
     C                     Z-ADD100       WUVOAC  30                                          197953
      *
      * Set keylist for Auto-Gen Criteria Control File
      *
     C           KYGNCR    KLIST
     C                     KFLD           PMTPY
     C                     KFLD           GNMSET
      *
     C           KYGNC2    KLIST
     C                     KFLD           PMTPY
      *
      * Set keylist for Auto-Gen Criteria Details File
      *
     C           KYGNDT    KLIST
     C                     KFLD           PMTPY
     C                     KFLD           GDMSET
     C                     KFLD           GDCSEQ
      *
      * Set keylist for Message Details File
      *
     C           KYINDT    KLIST
     C                     KFLD           PHMSGR
     C                     KFLD           WKPART
     C                     KFLD           GDMTAG
     C           *LIKE     DEFN PHPART    WKPART
      *
      * Set keylist for Account master File
      *
     C           KYACCO    KLIST
     C                     KFLD           WUCNUM
     C                     KFLD           WUCURR
     C                     KFLD           WUACCD
     C                     KFLD           WUACSQ
     C                     KFLD           WUBRCA
     C                     MOVEL*BLANKS   WBMSEQ                                              CSW209
      *
      * Set keylist for Message tag description
      *
     C           KYDESC    KLIST
     C                     KFLD           HPRTG
     C                     KFLD           A#MTPY
     C                     KFLD           WBMSEQ                                              CSW209
     C           *LIKE     DEFN EFMSEQ    WMSEQ                                               CSW209
     C           *LIKE     DEFN EFMSEQ    WBMSEQ                                              CSW209
     C           *LIKE     DEFN PMTPY     A#MTPY
     C                     MOVEL'ALL'     A#MTPY
      *                                                                                       CSW209
      ** Set keylist for Message tag description 1                                            CSW209
      *                                                                                       CSW209
     C           KYDSC1    KLIST                                                              CSW209
     C                     KFLD           HPRTG                                               CSW209
     C                     KFLD           PMTPY                                               CSW209
     C                     KFLD           WMSEQ                                               CSW209
      *                                                                   CFT014
      ** Set keylist for Message tag description                          CFT014
      *                                                                   CFT014
     C           KYDSC2    KLIST                                          CFT014
     C                     KFLD           HPRTG                           CFT014
     C                     KFLD           PMTPY                           CFT014
     C                     KFLD           WBMSEQ                                              CSW209
      *
      * Set keylist for Bic Directory
      *
     C           KYBICD    KLIST
     C                     KFLD           BDBICC
     C                     KFLD           BDBICB
      *
      * Set keylist for Message parts
      *
     C           KYMPL1    KLIST
     C                     KFLD           PHMSGR
     C                     KFLD           PHPART
      *
      ** Extract bank details
      *
     C                     CALL 'AOBANKR0'
     C                     PARM '*DBERR ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
      *                                                                   CFT006
      ** Access SAR details file to determine if CFT006 is switched ON    CFT006
      *                                                                   CFT006
     C                     MOVE 'N'       CFT006                          CFT006
     C                     CALL 'AOSARDR0'                                CFT006
     C                     PARM *BLANKS   @RTCD   7                       CFT006
     C                     PARM '*VERIFY' @OPTN   7                       CFT006
     C                     PARM 'CFT006'  @SARD   6                       CFT006
     C           SCSARD    PARM SCSARD    DSFDY                           CFT006
      *                                                                   CFT006
      ** If core feature is switched ON, set a variable to condition      CFT006
      ** the rest of the processing                                       CFT006
      *                                                                   CFT006
     C           @RTCD     IFEQ *BLANKS                                   CFT006
     C                     MOVE 'Y'       CFT006  1                       CFT006
     C                     ELSE                                           CFT006
      *                                                                   CFT006
     C                     MOVE 'N'       CFT006  1                       CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      ** Access SAR details file to determine if CFT008 is switched ON    CFT006
      *                                                                   CFT006
     C                     MOVE 'N'       CFT008  1                       CFT006
     C                     CALL 'AOSARDR0'                                CFT006
     C                     PARM *BLANKS   @RTCD   7                       CFT006
     C                     PARM '*VERIFY' @OPTN   7                       CFT006
     C                     PARM 'CFT008'  @SARD   6                       CFT006
     C           SCSARD    PARM SCSARD    DSFDY                           CFT006
      *                                                                   CFT006
      ** If core feature is switched ON, set a variable to condition      CFT006
      ** the rest of the processing                                       CFT006
      *                                                                   CFT006
     C           @RTCD     IFEQ *BLANKS                                   CFT006
     C                     MOVE 'Y'       CFT008                          CFT006
     C                     ELSE                                           CFT006
      *                                                                   CFT006
     C                     MOVE 'N'       CFT008                          CFT006
     C                     ENDIF                                          CFT006
      *
      *  Access SAR details file to see if CFT007 is installed.           CFT007
      *                                                                   CFT007
     C                     CALL 'AOSARDR0'                                CFT007
     C                     PARM *BLANKS   P@RTCD  7                       CFT007
     C                     PARM '*VERIFY' P@OPTN  7                       CFT007
     C                     PARM 'CFT007'  @SARD   6                       CFT007
     C           SCSARD    PARM *BLANKS   DSFDY                           CFT007
      *                                                                   CFT007
      *  Allow BIC Database Plus Integration                              CFT007
      *                                                                   CFT007
     C           P@RTCD    IFEQ *BLANKS                                   CFT007
     C                     MOVE *ON       CFT007  1                       CFT007
     C                     ENDIF                                          CFT007
      *                                                                   CFT007
      *                                                                                     MD022652
      ** Access SAR details file to see if CFT050 is installed.                             MD022652
      *                                                                                     MD022652
     C                     CALL 'AOSARDR0'                                                  MD022652
     C                     PARM *BLANKS   PRTCD   7                                         MD022652
     C                     PARM '*VERIFY' POPTN   7                                         MD022652
     C                     PARM 'CFT050'  PSARD   6                                         MD022652
     C           SCSARD    PARM *BLANKS   DSFDY                                             MD022652
      *                                                                                     MD022652
      ** CFT007 process will take place when CFT050 is switched on                          MD022652
      *                                                                                     MD022652
     C           PRTCD     IFEQ *BLANKS                                                     MD022652
     C                     MOVE *ON       CFT007                                            MD022652
     C                     ENDIF                                                            MD022652
      *                                                                                     MD022652
      *  Get Rundate information
      *
     C           *NAMVAR   DEFN RUNDAT    RUNDTA
     C                     IN   RUNDTA
     C                     MOVE AGMRDT    WUMRDT  7        Midas Run date
     C                     MOVE AGRDNB    WURDNB  50       Run day number
     C                     MOVE AGSUC     WUSUC   1        Set up complete
     C                     MOVE AGDFF     WUDFF   1        Date Format
     C                     MOVE AGMBIN    WUMBIN  1        Multi Branched
     C           WUDFF     COMP 'M'                      98
      *
      *  Convert Midas date to YYMMDD format
      *
     C                     CALL 'ZM0060'
     C                     PARM WURDNB    P@RDNB  50
     C                     PARM *BLANKS   ##YMD   6
      *
      *  Load Vostro A/c code array
      *
     C           *LOVAL    SETLL@A5REA6
     C                     Z-ADD*ZERO     H1      50
     C                     READ @A5REA6                  99
     C           *IN99     DOWEQ'0'
     C           H1        ANDLTWUVOAC
     C                     ADD  1         H1
     C                     MOVELA5ACCD    HK1,H1
     C                     READ @A5REA6                  99
     C                     END
      *                                                                   CFT004
      ** Access SAR details file to see if CFT004 is installed.           CFT004
      *                                                                   CFT004
     C                     CALL 'AOSARDR0'                                CFT004
     C                     PARM *BLANKS   P@RTCD  7                       CFT004
     C                     PARM '*VERIFY' P@OPTN  7                       CFT004
     C                     PARM 'CFT004'  P@SARD  6                       CFT004
     C           SCSARD    PARM *BLANKS   DSFDY                           CFT004
      *                                                                   CFT004
      ** Allow IBAN processing                                            CFT004
      *                                                                   CFT004
     C           P@RTCD    IFEQ *BLANKS                                   CFT004
     C                     MOVE 'Y'       CFT004  1                       CFT004
     C                     ELSE                                           CFT004
     C                     MOVE 'N'       CFT004                          CFT004
     C                     END                                            CFT004
      *                                                                                       CSW209
     C                     CALL 'SWIF2009'                                                    CSW209
     C                     PARM           P@RTCD                                              CSW209
     C           P@RTCD    IFEQ 'CSW2009'                                                     CSW209
     C                     MOVE 'Y'       CSW209  1                                           CSW209
     C                     ELSE                                                               CSW209
     C                     MOVE 'N'       CSW209                                              CSW209
     C                     ENDIF                                                              CSW209
      *                                                                                       CSW209
      *                                                                   CRE008
      ** Access SAR details file to see if CRE008 is installed.           CRE008
      *                                                                   CRE008
     C                     CALL 'AOSARDR0'                                CRE008
     C                     PARM *BLANKS   P@RTCD  7                       CRE008
     C                     PARM '*VERIFY' P@OPTN  7                       CRE008
     C                     PARM 'CRE008'  P@SARD  6                       CRE008
     C           SCSARD    PARM *BLANKS   DSFDY                           CRE008
      *                                                                   CRE008
      ** Allow IBAN processing                                            CRE008
      *                                                                   CRE008
     C           P@RTCD    IFEQ *BLANKS                                   CRE008
     C                     MOVE 'Y'       CRE008  1                       CRE008
     C                     ELSE                                           CRE008
     C                     MOVE 'N'       CRE008                          CRE008
     C                     END                                            CRE008
      *                                                                                       CER030
      ** Check the switchable feature CER031                                                  CER030
      *                                                                                       CER030
     C                     CALL 'AOSARDR0'                                                    CER030
     C                     PARM *BLANKS   PRTCD   7                                           CER030
     C                     PARM '*VERIFY' POPTN   7                                           CER030
     C                     PARM 'CER031'  PSARD   6                                           CER030
     C           SCSARD    PARM SCSARD    DSFDY                                               CER030
      *                                                                                       CER030
     C           PRTCD     IFEQ *BLANKS                                                       CER030
     C                     MOVEL'Y'       CER031  1                                           CER030
     C                     ELSE                                                               CER030
     C                     MOVEL'N'       CER031                                              CER030
     C                     ENDIF                                                              CER030
     C/COPY WNCPYSRC,ME1501C003
      *
      *  Indicate that set up is complete
      *
     C                     SETON                     50
      *
      *  Unwind subroutine stack name
      *
     C           #HXINI    TAG
     C                     MOVEA*BLANKS   @STK,Q
     C                     SUB  1         Q
      *
     CSR                   ENDSR
      /EJECT
     C/COPY ZSRSRC,ZACCH
      /EJECT
     C/COPY ZSRSRC,ZCHKH
      /EJECT
     C/COPY ZSRSRC,ZDATE1Z2
      /EJECT
     C/COPY MECPYSRC,SRERRC
      /EJECT
     C/COPY MECPYSRC,SMESNMSC
      /EJECT
**  CPY@ table
(c) Misys International Banking Systems Ltd. 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
