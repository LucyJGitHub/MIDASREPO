     H        1                           F
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas MG Format customer transfer message')            *
     F*****************************************************************
     F*                                                               *
     F*  Midas - MESSAGE GENERATION                                   *
     F*                                                               *
     F*  MG0100 - CUSTOMER TRANSFER MESSAGE FORMATTING                *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD050972           Date 17May18               *
      *  Prev Amend No. MD050936           Date 16May18               *
      *                 CSW218             Date 19Mar18               *
      *                 MD046248           Date 27Oct17               *
      *                 CDL099             Date 06Oct17               *
      *                 CSW215             Date 06Apr15               *
      *                 MD031087           Date 25Nov14               *
      *                 MD026727           Date 26May14               *
      *                 MD023383           Date 12Nov13               *
      *                 MD022039           Date 27Aug13               *
      *                 CSW213             Date 03Jun13               *
      *                 AR787620           Date 10Jun11               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 BUG26160           Date 23Sep09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 BUG15037           Date 17Oct07               *
      *                 BUG15017A          Date 17Oct07               *
      *                 BUG15017           Date 16Oct07               *
      *                 250600             Date 07Oct07               *
      *                 BUG14593           Date 12Aug07               *
      *                 CSW207A            Date 01Aug07               *
      *                 CSW207             Date 07Jul07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSW206             Date 03Jul06               *
      *                 CMG001             Date 15Feb06               *
      *                 172477             Date 06Jun06               *
      *                 227096             Date 26May06               *
      *                 CSD031             Date 10Apr06               *
      *                 220913             Date 02May06               *
      *                 204225             Date 02May06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 BUG6076            Date 04Mar05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 222373             Date 27Oct03               *
      *                 222385             Date 23Oct03               *
      *                 222458             Date 24Oct03               *
      *                 221145             Date 08Sep03               *
      *                 219243             Date 01Jul03               *
      *                 219242             Date 01Jul03               *
      *                 219241             Date 01Jul03               *
      *                 CSW203             Date 26May03               *
      *                 CSD015             Date 14Oct02               *
      * Midas Release 4.01.01 ----------------------------------------*
      *                 208890             Date 22Aug02               *
      *                 CSW202             Date 20May02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CSW025             Date 26Mar02               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CSW201             Date 02May01               *
      *                 183583             Date 08Jun01               *
      * Midas DBA 3.05 -----------------------------------------------*
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CFT013             Date 25May00               *
      *                 CDL008             Date 02May00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 138742             Date 07Jul98               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 169210             Date 14Oct99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 153367             Date 29Jan99               *
     F*                 142403             Date 25Jan99               *
     F*                 141572             DATE 21SEP98               *
     F*                 135953             DATE 04OCT98               *
     F*                 145304             DATE 20OCT98               *
     F*                 144710             Date 20OCT98               *
     F*                 144171             DATE 06OCT98               *
     F*                 CEU003             DATE 29MAR98               *
     F*                 113352             DATE 28MAR98               *
     F*                 105577             Date 21Jul97               *
     F*                 S01408             Date 08Aug96               *
     F*                 CSW096             DATE 03JUN96               *
     F*                 078649             DATE 31MAY96               *
     F*                 095141             DATE 02NOV95               *
     F*                 S01408             DATE 09JAN96               *
     F*                 S01408             DATE 04AUG95               *
     F*                 084320             DATE 07MAR95               *
     F*                 080096             DATE 12JAN95               *
     F*                 060980             DATE 29OCT93               *
     F*                 S01421             DATE 18MAY93               *
     F*                 S01412             DATE 05MAY93               *
     F*                 E42086             DATE 10JUL92               *
     F*                 E40242             DATE 25JUN92               *
     F*                 E35632             DATE 15JAN92               *
     F*                 E27567             DATE 11OCT91               *
     F*                 E29588             DATE 07OCT91               *
     F*                                                               *
     F*****************************************************************
      *                                                               *
      *  MD050972 - Field tag 32A has a blank Value Date for LDNI     *
      *  MD050936 - Field tag 53B has a defaulted value of '/'        *
      *  CSW218 - SWIFT Changes 2018                                  *
      *  MD046248 - Finastra Rebranding                               *
      *  CDL099 - Split Value Date                                    *
      *  CSW215 - SWIFT Changes 2015                                  *
      *  MD031087 - Recompile due to changes in SWIFTTRANS Table in   *
      *             order to avoid corruption of German Chars         *
      *             (Recompile)                                       *
      *  MD026727 - Allow customer number in first line of field 50.  *
      *  MD023383 - STP is generated when IBAN is invalid             *
      *  MD022039 - No STP in block 3 tag 119                         *
      *  CSW213 - SWIFT Changes 2013                                  *
      *  AR787620 - Hooks Incorporation                               *
      *             WNCPYSRC,MGH00001                                 *
      *             WNCPYSRC,MGH00002                                 *
      *             WNCPYSRC,MGH00003                                 *
      *  BUG26160 - Details of charges was incorrectly reflected      *
      *  BUG15037 - DB error in AOCUSTR0. Take correct customer number*
      *  BUG15017A - Additional fix for BUG15017                      *
      *  BUG15017 - Missing fields in MT103 and MT210                 *
      *  250600 - Fix CFT032 and CSW207                               *
      *  BUG14593 - SWIFT 2007 error in SP08                           *
      *  CSW207A - SWIFT 2007 Standard Changes                        *
      *  CSW207 - SWIFT 2007 Standard Changes                         *
      *  CSW206 - Swift 2006 Standard Changes                         *
      *  CMG001 - Amend Field 53B to reflect the Nostro Account Number*
      *  172477 - Remove fix 078649.  This will include Feild 57 even *
      *           if Account with Bank is the same as the Nostro      *
      *           Customer. Applied fix 170449.                       *
      *  227096 - Generation of MT103 - incorrct formatting of fields *
      *           :50 and :59. Fix refs 205747 and 204225 were used,  *
      *           but only the parts that effect MG0100               *
      *  205747 - Format for field 59 on MT103 also needs to be       *
      *           changed for CROSSMAR in the same way as field 50.   *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  220913 - Include customer number in MT103 field 50K          *
      *  204225 - Format for field 50 is wrong on SWIFT MT103. If     *
      *           Ordering Customer is CROSSMAR and MT3xx Corporate   *
      *           BEI is not blank, tag 50A with BEI code should be   *
      *           used. If Ordering Customer is CROSSMAR and MT3xx    *
      *           Corporate BEI is blank, tag 50K with customer's     *
      *           name and address should be used.                    *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  BUG6076- Cancellation processing for interest and cover      *
      *           messages not working in MMM.                        *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222373 - Parameter mismatch.                                 *
      *  222385 - SWIFT msgs are Watch List checked regardless of     *
      *           configuration file setting                          *
      *  222458 - Complete fix 219243                                 *
      *  221145 - Compliance Watch WLC: Move compliance check to      *
      *           after COMIT to MGOMSGPD                             *
      *  219243 - Fields 33B and 36 for FX Deals                      *
      *  219242 - Not possible to create MT103+ payment msg from      *
      *           non-FT transaction                                  *
      *  219241 - Defaulting of "Details of Charges" assign a         *
      *           system value                                        *
      *  CSW203 - SWIFT 2003 Standards Update                         *
      *  CSD015 - Midas Compliance Watch - Watch List Checking        *
      *  208890 - Various Core Fixes in SWIFT                         *
      *  CSW202 - SWIFT 2002 Standards Update                         *
      *  CSW025 - Midas Message Manager                               *
      *           - Pass original change type                         *
      *  CSW201 - SWIFT 2001 Standards Update                         *
      *  183583 - Add extension file MGOEXTPD to store customer no.   *
      *           of field with SWIFT address.                        *
      *  CFT013 - Straight-through Processing Phase 2 MT103 Messages  *
      *           Generation for non-FT.                              *
      *  CDL008 - Continuous Linked Settlement (Recompiled)           *
     F*  138742 - Default priority urgent, delivery notification      *
     F*           required and non-delivery warning required flags    *
     F*           are not defaulted from SDCURRPD.                    *
     F*  169210 - Requested hooks are duplicates                      *
     F*           Renamed MG0100C024 to MG0100CX24                    *
     F*           Renamed MG0100C025 to MG0100CX25                    *
     F*           Renamed MG0100C026 to MG0100CX26                    *
     F*           Renamed MG0100C027 to MG0100CX27                    *
     F*           Renamed MG0100C028 to MG0100CX28                    *
     F*           Renamed MG0100C029 to MG0100CX29                    *
     F*  153367 - Should generate field :57: (Account w/ Bank) if     *
     F*           field :56: (Intermediary Bank) is generated.        *
     F*  142403 - Changes which should have been done for lending     *
     F*           fees under cle007.                                  *
     F*           Swift Trn of fee messages are to start with F.      *
     F*  141572 - Set-up CINDV (Century flag)  to correct year2000    *
     F*           display problem.                                    *
     F*  135953 - Check for blank lines on field 70.                  *
     F*  145304 - Format field 72:/OCMT/xxxnnnn, swiftcode line with a*
     F*           final '/'.                                          *
     F*  144710 - Output "/OCMT/" first before "Bank to Bank" fields. *
     F*           This is to ensure correct order of codewords        *
     F*           in case /CHGS/ is entered on bank to bank fields    *
     F*  144171 - Amount in SWIFT messages showing the original amount*
     F*           and not the Euro equivalent.                        *
     F*  CEU003 - EMU Dealing Settlement Ccy Conversion               *
     F*  113352 - Set-up CIND (Century flag)  to correct year2000     *
     F*           display problem.                                    *
     F*  105577 - Integrate fix 82042                                 *
     F*           PUT CORRECT RELATED REF IN COVER MT202              *
     F*  S01408 - Addition of core hook MG0100CP12                    *
     F*                                 MG0100CP11                    *
     F*                                 MG0100CP10                    *
     F*                                 MG0100CCP9                    *
     F*                                 MG0100CCP8                    *
     F*  CSW096 - SWIFT changes 1996                                  *
     F*  078649 -  If Destination Address is the same as ACCOUNT      *
     F*            WITH INSTITUTION (Field 57), then output blank     *
     F*            Field 57.                                          *
     F*  095141 - 'Test key required' should be yes for MT100s.       *
     F*  S01408 - Addition of core hook MG0100CCP4                    *
     F*                                 MG0100CCP5                    *
     F*                                 MG0100IIP2                    *
     F*  S01408 - Addition of core hook MG0100FFP1                    *
     F*                                 MG0100IIP1                    *
     F*                                 MG0100CCP1                    *
     F*                                 MG0100CCP2                    *
     F*                                 MG0100CCP3                    *
     F*  084320 - Do not set on U7 for a non-fatal error, as this     *
     F*           will cause the controlling component to end         *
     F*           abnormally.                                         *
     F*  080096 - RECOMPILE BECAUSE COPY MEMBER MGCPYSRC,SWIFTTRANS   *
     F*           CHANGED                                             *
     F*  060980 - Retention period calculated incorrectly. Use value  *
     F*           date instead of run date to calculate retention.    *
     F*  S01421 - REPLACE THE SWIFT TRANSLATION TABLE WITH A          *
     F*           /COPY STATEMENT (SWIFTTRANS).                       *
     F*  S01412 - SWIFT September '93 Message Changes.                *
     F*           Field :56a: on an MT100 can now use option D,       *
     F*           ie. it is no longer essential for Intermediary      *
     F*           to have a SWIFT address in cases where an MT100     *
     F*           is to be produced. This change makes the /IBK/      *
     F*           codeword in field :72: unnecessary.                 *
     F*            o Amend s/r FMT56 to produce a D type address if   *
     F*              necessary                                        *
     F*            o Remove /IBK/ processing from s/r FMT72           *
     F*  E42086 - CATER FOR BLANK ADDRESS LINES                       *
     F*  E40242 - Recompiled due to changes to field ASEQ             *
     F*  E35632 - SWIFT AMOUNT FIELD NOT SET UP ON MGOREFPD           *
     F*  E27567 - BRANCH FILE SWIFT ID, SHOULD NOT BE MANDATORY,      *
     F*           HENCE ROUTING ROUTINE SHOULD REFLECT THIS.          *
     F*  E29588 - POST COLLECTION SWIFT RATIONALISATION FIXES         *
     F*  RE-WRITTEN FOR S01344 - SWIFT RATIONALISATION PHASE 2        *
     F*                                                               *
     F*****************************************************************
     F*MGF100PDUF**E********************DISK***                                              BUG6076
     FMGF100L1UF  E           K        DISK                                                  BUG6076
     F                                              KCOMIT
     FMGOMSGPDO   E                    DISK
     F                                              KCOMIT
     FMGOEXTPDO   E                    DISK                               183583
     F                                              KCOMIT                183583
     F*MGOREFL0IF**E           K        DISK                              E29588
     F************MGOREFD0                          KRENAMEMGREFL0        E29588
     FMGOREFA6IF  E           K        DISK
     F            MGOREFD0                          KRENAMEMGREFL0
     FMEISOCL1IF  E           K        DISK         KINFSR *PSSR                              CSW202
     FMGOREFPDO   E                    DISK
     F                                              KCOMIT
     F/COPY WNCPYSRC,MG0100F001
     FMG0100P1O   E                    PRINTER                        UC
     FMG0100AUO   E                    PRINTER                        UC
     FMGCOVRPDO   E           K        DISK                               105577
     FDEALS   IF  E           K        DISK                           UC                      CDL099
     F            DEALSDAF                          KIGNORE                                   CDL099
     F            DEALSDCF                          KIGNORE                                   CDL099
     F            DEALSDDF                          KIGNORE                                   CDL099
     F            DEALSDEF                          KIGNORE                                   CDL099
     F            DEALSDGF                          KIGNORE                                   CDL099
     F            DEALSDFF                          KIGNORE                                   CDL099
     F*                                                                   S01408
     F/COPY WNCPYSRC,MG0100FFP1                                           S01408
     F*                                                                   S01408
      ********************************************************************
      *
      * ID C  F  H  L    Function of indicators
      *
      *    05            Error on write to MGOREFPD.
      *    06            Error on write to MGOMSGPD
      *****10************EOF MGF100PD**********************************                      BUG6076
      *    10            EOF MGF100L1                                                        BUG6076
      *    11            TRN not unique; record found on MGOREFPD
      *    15            Standard program (ZM0xxx) ended in error.
      *    16            Error on delete of GDF record.
      *    20            LOKUP operation searching array (GNR)
      *    21            LOKUP operation searching array (GNR)
      *    22            LOKUP operation searching array (GNR)
      *    24            Error on call of MG5000
      *    31            No blank space in array @wrk
      *    50            MG0100AU open
      * U7U8LR           DB error
      *
     F********************************************************************
     E                    GNR        15  3               generate released
     E                    BTBI        6 35               bank to bank in
     E                    BTBO        6 35               bank to bank out
     E                    CPY@    1   1 80               copyright
     E                    MSGA    1   9 60               message text
     E                    @WRK       50  1               concatenation field
     E                    @STR       50  1               String formatting145304
      *                                                                   CFT013
      ** Array of codewords for Bank to Bank information                  CFT013
     E**********          ABTB    1  14 10                                             CFT013 CSW202
     E                    ABTB    1  15 10                                                    CSW202
      *                                                                   CFT013
      ** Array for formatting amount                                      CFT013
     E                    AAMT       15  1                                CFT013
      *                                                                   CFT013
      ** Work array indicator                                             CFT013
     E**********          AIND        8  1                                             CFT013 208890
     E                    AIND        9  1                                                    208890
     E                    ALPH   26  26  1                                                    CSW202
     E                    NUMC   10  10  1                                                    CSW202
      *
      *                                                                   S01408
     I/COPY WNCPYSRC,MG0100IIP2                                           S01408
      *                                                                   S01408
     I@BTB        DS                             35
     I                                        1   5 @BT1
     I                                        6   8 @BT2
     I                                        1  26 @BT3
     I                                        6  35 @BT4
     I                                        1   5 WBTB5                 CFT013
     I                                        1   6 WBTB6                 CFT013
     I                                        1   8 WBTB8                 CFT013
     I                                        1   9 WBTB9                 CFT013
     I                                        1  10 WBTB10                CFT013
     I                                        1   2 WBTB2                 CFT013
     I                                        7  35 WBTB29                CFT013
     I                                       10  35 WBTB26                CFT013
     I                                        3  35 WBTB33                CFT013
      *
     I                                        6   6 BSLSH
     I                                        3  12 BCNO1
     I                                        6  15 BCNO2
      **  Data structure for bank to bank field
      *
     IDSBOUT      DS
     I                                        1  35 BOUT
     I                                        3  35 OUT1
     I                                        6  35 OUT2
      **  Data structure for bank to bank output
      *
     I            DS
     I                                        1  12 CSID
     I                                        9  11 @BIC
      **  Data structure to test for BIC code
      *
     IMULT        DS                         95
     I                                        1   5 MTAG
     I                                        6  55 MFLD
     I                                       56 105 MERR
      **  Multiple occurrence data structure for message
      *
     IEXTN        DS                         45                           183583
     I                                        1   20MPSN                  183583
     I                                        3   7 MTG                   183583
     I                                        8  15 MCSI                  183583
      *                                                                   183583
      ** Multiple occurrence data structure for extension file            183583
      *                                                                   183583
     I            DS                                                      183583
     I                                        1   5 @MTG                  183583
     I                                        2   2 FLDTYP                183583
     I                                        4   4 FLDTAG                183583
      *                                                                   183583
      ** Field tag data structure                                         183583
      *                                                                   183583
     IFLD3N       DS                         24
     I                                        1   6 ZSDATE
     I                                        7   9 ZSCCY
     I                                       10  24 ZSAMNT
     I                                        7  24 FLD33B                CFT013
      **  Data structure containing codeword for fields 32.
      *
     IERR3N       DS                         24
     I                                        1   3 ZCCY
     I                                        5  170ZAMT
      ** Erroneous currency and amount for Field32.
      *                                                                   CSW096
     IP@IN        DS                            256                       CSW096
     I                                        1   3 I@SNBR                CSW096
     I                                        4   9 I@DSCN                CSW096
     I                                       10  12 I@MTPY                CSW096
     I                                       13  140I@SETT                CSW096
     I                                       15  15 I@CONC                CSW096
     I                                       16  16 I@FTCS                CSW096
     I                                       17  18 I@MMOD                CSW096
      ** Data structure for input parameter                               CSW096
      *                                                                   CSW096
     IP@OUT       DS                            256                       CSW096
     I**********                              1   60O@CNSN                             CSW096 CSD027
     I                                        1   6 O@CNSN                                    CSD027
     I                                        7  18 O@SWSN                CSW096
     I                                       19  38 O@NWSN                CSW096
     I                                       39  49 O@SWDS                CSW096
     I                                       46  46 W@96CN                CSW096
     I                                       47  49 W@BIC                 CSW096
     I                                       50  69 O@NWDS                CSW096
     I                                       70  75 O@NWRK                CSW096
     I                                       76  76 O@MGSG                CSW096
     I                                       77  80 O@MGST                CSW096
     I                                       81  81 O@PAIN                CSW096
     I                                       82  87 O@PCNB                CSW096
     I                                       88  90 O@SPRS                CSW096
      ** Data structure for ouput parameter                               CSW096
      *                                                                   CSW096
     IP@BTB       DS                                                      CFT013
     I                                        1  35 MGBTB1                CFT013
     I                                       36  70 MGBTB2                CFT013
     I                                       71 105 MGBTB3                CFT013
     I                                      106 140 MGBTB4                CFT013
     I                                      141 175 MGBTB5                CFT013
     I                                      176 210 MGBTB6                CFT013
      ** Bank to Bank information                                         CFT013
      *                                                                   CFT013
     I*                                                                   S01408
     I/COPY WNCPYSRC,MG0100IIP1                                           S01408
      *                                                                   CFT013
     I/COPY FTCPYSRC,FT0010I001                                           CFT013
     I*                                                                   S01408
     I              'CustNoFirstLineFld50'C         AOCAB                                   MD026727
      *                                                                                     MD026727
     I              'ACOUNTLINE'          C         CACNT1                                    250600
      *                                                                                       CSW218
     I              'MGC001802'           C         UIDPGM                                    CSW218
      *                                                                                       250600
      ** Outgoing message                                                                     250600
      *                                                                                       250600
     IMEOUFM    E DSMEOUFMPD                                                                  250600
      *                                                                                       250600
      *
     ISDBANK    E DSSDBANKPD
      **  Data structure for bank file
      *
     ISDCUST    E DSSDCUSTPD
      **  Data structure for customer file
      *
     ISDCNST    E DSSDCNSTPD
      **  Data structure for counterparty nostro file
      *
     ISDBRCH    E DSSDBRCHPD
     I              QQDFAC                          DFACQQ                                    CGL029
      **  Data structure for branch file
      *
     ISDMMOD    E DSSDMMODPD
      **  Data structure for module ICD file
      *
     ISDNOST    E DSSDNOSTPD
      **  Data structure for nostro file
      *
     ISDMGME    E DSSDMGMEPD
      **  Data structure for message management data.
     I*                                                                   138742
     ISDCURR    E DSSDCURRPD                                              138742
     I** Record formats for access to currency details                    138742
      *
     IMEBICD    E DSMEBICDPD                                              CFT013
      ** Data structure for SWIFT BIC Directory file                      CFT013
      *                                                                   CFT013
     IMEBEIS    E DSMEBEISPD                                                                  CSW202
      ** Data Structure for Business Entity Identifier file                                   CSW202
      *                                                                                       CSW202
      *                                                                                       CSD015
     IWLFDS     E DSSDWLTOPD                                                                  CSD015
      ** DS For Midas SD Watch List Transaction Details File for OPM                          CSD015
      *                                                                                       CSD015
     IPSTRNG      DS                           9999                                           CSD015
      ** DS For Search String                                                                 CSD015
      *                                                                                       CSD015
     ISDWLCC    E DSSDWLCCPD                                                                  222385
      ** Watch list checking details                                                          222385
      *                                                                                       222385
     IDSFDY     E DSDSFDY
      **  Short data structure for access programs
      *
     IDSSDY     E DSDSSDY
      **  Long data structure for access programs
      *
     IDSLDY     E DSDSLDY                                                 CFT013
      ** Third data structure for access programs                         CFT013
      *                                                                   CFT013
     ILDA         DS                            256
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     ISCSARD    E DSSCSARDPD                                              CEU003
      **  External data structures for Switchable Features Details        CEU003
      **  Local data area
      *
      *****************************************************************
      *                   Index to subroutines                        *
      *   main process                                                *
      *   SWADF - Format SWIFT address.                               *
      ****ROUT**-*determine*message*routing****************************   CSW096
      *   SRROUT - determine message routing                          *   CSW096
      *   FMTREF - format fields :20: and :32A:                       *
      *   FMTORD - format fields :50: :52s:                           *
      *   FMT53 - format field :53s:                                  *
      *   FMT54 - format field :54s:                                  *
      *   FMT56 - format field :56s:                                  *
      *   FMT57 - format field :57s:                                  *
      *   FMT59 - format field :59:                                   *
      *   FMTDET - format detail fields :70: and :71A:                *
      *   FMT72 - format field :72:                                   *
      *   REPT  - print incorrectly generated messages                *
      *   OMSG  - output correctly generated messages                 *
      ****NWAD**-*determine*default*network*addresses******************   CSW096
      ****PRAD**-*determine*priority*network*addresses*****************   CSW096
      *   INTF  - Initialise non-constant fields.                     *
      *   INIT  - initial process                                     *
      *   *PSSR - error handling                                      *
      *   DFLT  - Currency defaults                                   *   138742
      *****************************************************************
     C/EJECT
      *****************************************************************
      *   main process                                                *
      *   Calls - INIT initial process                                *
      *           INTF initialise non-constant fields                 *
      ************ROUT*determine*message*routing***********************   CSW096
      *           SRROUT determine message routing                    *   CSW096
      *           FMTREF format fields :20: :32A:                     *
      *           FMTORD format fields :50: :52s:                     *
      *           FMT53 format field :53s:                            *
      *           FMT54 format field :54s:                            *
      *           FMT56 format field :56s:                            *
      *           FMT57 format field :57s:                            *
      *           FMT58 format field :58s:                            *
      *           FMT59 format field :59s:                            *
      *           FMTDET format fields :70: and :71A:                 *
      *           FMT72 format field :72s:                            *
      *           REPT print incorrectly generated messages           *
      *           OMSG output correctly generated messages            *
      *****************************************************************
      *
      ** Initial process
      *
     C                     EXSR INIT
      *
      ** Read the first record from the MT100 extract file
      *
     C**********           READ MGF100PD                 10                                  BUG6076
     C                     READ MGF100L1                 10                                  BUG6076
      *
      ** Format Message Control.
      *
      ** Do While records found on the MT100 extract file
      *
     C           *IN10     DOWEQ'0'
     C/COPY WNCPYSRC,MGH00054
      *
      ** Get Interest Message Indicator from Transaction Number                              BUG6076
      *                                                                                      BUG6076
     C                     MOVE ' '       INTMSG  1                                          BUG6076
     C           MGCHTP    IFEQ 'A'                                                          BUG6076
     C           MGCHTP    OREQ 'I'                                                          BUG6076
     C                     MOVE MGTNUM    INTMSG                                             BUG6076
     C           INTMSG    IFEQ 'I'                                                          BUG6076
     C                     MOVE ' '       MGTNUM                                             BUG6076
     C                     ENDIF                                                             BUG6076
     C                     ENDIF                                                             BUG6076
      *
      ** Initialise non-constant fields
      *
     C                     EXSR INTF
      *
      **  Obtain sequence numbers from transaction record
      *
     C                     CALL 'MG5000'               24
     C                     PARM MGMODI    @MODI   2
     C                     PARM MGTNUM    @TRAN  15
     C                     PARM 'PR'      @PROG   2
     C                     PARM *BLANKS   @MODE   1
     C                     PARM *ZEROS    MGLSWC  30
     C                     PARM *ZEROS    MGLSWS  30
     C                     PARM *BLANKS   @ERCD   1
      *
      **  Error on access for sequence number
     C           @ERCD     IFEQ 'Y'
     C           *LOCK     IN   LDA
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Program missing on call
     C           *IN24     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '010'     DBASE            * * * * * * * *
     C                     MOVEL'MG5000'  DBKEY            *  DBERR 010  *
     C                     OUT  LDA                        * * * * * * * *
     C                     EXSR *PSSR
     C                     END
      *
     C           *LOCK     IN   LDA
     C                     MOVEL'MG0100  'DBPGM
     C                     OUT  LDA
      *
      **  Clear multiple occurrence data structure
     C                     Z-ADD1         X       30
     C           X         OCUR MULT
     C           X         DOWLE200
     C           MULT      ANDNE*BLANKS
     C                     MOVE *BLANKS   MULT
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
      *                                                                   183583
      ** Clear multiple occurrence DS for the extension file.             183583
      *                                                                   183583
     C                     Z-ADD1         V       20                      183583
     C           V         OCUR EXTN                                      183583
     C           V         DOWLE20                                        183583
     C           MCSI      ANDNE*BLANKS                                   183583
     C                     Z-ADD*ZEROS    MPSN                            183583
     C                     MOVE *BLANKS   MTG                             183583
     C                     MOVE *BLANKS   MCSI                            183583
     C                     ADD  1         V                               183583
     C           V         OCUR EXTN                                      183583
     C                     ENDDO                                          183583
     C                     Z-ADD0         V                               183583
      *                                                                   CFT013
      ** Determine type of message                                        CFT013
      *                                                                   CFT013
     C           CFT013    IFEQ 'Y'                                       CFT013
     C                     EXSR SRDTMG                                    CFT013
     C                     ENDIF                                          CFT013
      *
      **  Determine message routing
      *
     C***********          EXSR ROUT                                      CSW096
     C/COPY WNCPYSRC,MG0100C021
     C                     EXSR SRROUT                                    CSW096
      *                                                                   CFT013
      ** Bypass processing if record is to be suppressed.                 CFT013
      *                                                                   CFT013
     C           CFT013    IFEQ 'Y'                                       CFT013
     C           PORTCD    ANDNE'SUP    '                                 CFT013
      *                                                                                       CSW203
      ** MT100 will no longer be generaterd if CFT013 is not installed                        CSW203
      *                                                                                       CSW203
     C********** CFT013    OREQ 'N'                                                    CFT013 CSW203
      *                                                                   CFT013
     C                     SELEC                                          CFT013
      *                                                                   CFT013
      ** Format MT100 message.                                            CFT013
     C           CFT013    WHEQ 'N'                                       CFT013
     C           CFT013    OREQ 'Y'                                       CFT013
     C           PORTCD    ANDEQ'*CRT100'                                 CFT013
      *
     C/COPY WNCPYSRC,MG0100C010
      **  Format message fields.
      *
      ** Format fields :20: and :32A:
      *
     C                     EXSR FMTREF
      *
      ** Format fields :50: and :52s:
      *
     C                     EXSR FMTORD
      *
      ** Format field :53s:
      *
     C                     EXSR FMT53
      *
      ** Format field :54s:
      *
     C                     EXSR FMT54
      *
      ** Format field :56s:
      *
     C                     EXSR FMT56
      *
      ** Format field :57s:
      *
     C                     EXSR FMT57
      *
      ** Format field :59:
      *
     C                     EXSR FMT59
      *
      ** Format detail fields :70: and :71A:
      *
     C                     EXSR FMTDET
     C/COPY WNCPYSRC,MG0100C038
      *
      ** Format field :72:
      *
     C                     EXSR FMT72
     C/COPY WNCPYSRC,MG0100C039
      *                                                                   CFT013
      ** Format MT103 Message.                                            CFT013
     C           CFT013    WHEQ 'Y'                                       CFT013
     C           PORTCD    ANDEQ'*CRT103'                                 CFT013
     C                     MOVEA*BLANK    AIND                            CFT013
     C                     EXSR SRF103                                    CFT013
      *                                                                   CFT013
     C                     ENDSL                                          CFT013
      *                                                                   138742
      **  Set up currency defaults                                        138742
     C                     EXSR DFLT                                      138742
      *                                                                   138742
     C/COPY WNCPYSRC,MG0100C028
      *
      **  Print incorrectly generated message
     C           @ERR      IFEQ 'Y'
     C                     EXSR REPT
     C                     ELSE
     C/COPY WNCPYSRC,MG0100C022
      *
      **  Output correctly generated messages
      *
     C                     EXSR OMSG
     C                     END
      *                                                                   CFT013
     C                     ENDIF                                          CFT013
      *
      ** Delete the processed record.
      *
     C**********           DELETMGF100PD               16                                    BUG6076
     C                     DELETMGF100L1               16                                    BUG6076
      *
      **  Error on delete of record.
      *
     C           *IN16     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '008'     DBASE              * * * * * * *
     C                     MOVELMGTNUM    DBKEY              * DBERR 008 *
     C**********           MOVEL'MGF100PD'DBFILE             * * * * * * *                   BUG6076
     C                     MOVEL'MGF100L1'DBFILE                                             BUG6076
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*C*PY*WN*PYSRC*MG0100C028                                           169210
     C/COPY WNCPYSRC,MG0100CX28                                           169210
      *
      **  Update sequence numbers on transaction record
      **  if no errors have occurred
      *
     C           @ERR      IFNE 'Y'
     C                     CALL 'MG5000'               24
     C                     PARM MGMODI    @MODI   2
     C                     PARM MGTNUM    @TRAN  15
     C                     PARM 'PR'      @PROG   2
     C                     PARM 'U'       @MODE   1
     C                     PARM *ZEROS    MGLSWC  30
     C                     PARM *ZEROS    MGLSWS  30
     C                     PARM *BLANKS   @ERCD   1
      *
      **  Error on access for sequence number
     C           @ERCD     IFEQ 'Y'
     C           *LOCK     IN   LDA
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Program missing on call
     C           *IN24     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '012'     DBASE            * * * * * * * *
     C                     MOVE 'MG5000'  DBKEY            *  DBERR 012  *
     C                     OUT  LDA                        * * * * * * * *
     C                     EXSR *PSSR
     C                     END
      *
     C                     END
     C           *LOCK     IN   LDA
     C                     MOVEL'MG0100  'DBPGM
     C                     OUT  LDA
      *
      **  COMIT all changes since no error on writing the message
      *
     C                     COMIT
      *                                                                   221145
      **  Call Compliance Watch:Watch List Checking                       221145
      *                                                                   221145
     C           CSD015    IFEQ 'Y'                                       221145
     C           W1EWLC    ANDEQ'Y'                                                           222385
     C           CSW025    ANDEQ'N'                                       221145
     C                     EXSR WLCDQ                                     221145
     C                     ENDIF                                          221145
      *                                                                   105577
      **  Write record to MGCOVRPD if this is a main message.             105577
      *                                                                   105577
     C           MGCVMI    IFEQ 'P'                                       105577
     C                     WRITEMGCOVRD0                                  105577
     C                     END                                            105577
      *
      **  Read next customer transfer extract record
      *
     C**********           READ MGF100PD                 10                                  BUG6076
     C                     READ MGF100L1                 10                                  BUG6076
     C                     END                                       E1
      *
     C           *IN50     IFEQ '1'
     C                     WRITEEOREPT
     C                     END
      *
      **  Terminate program
     C/COPY WNCPYSRC,MG0100C037
     C                     SETON                     LR
     C/EJECT
      *****************************************************************
      *   SWADF - Format SWIFT address                                *
      *   Called by - FMTORD - Format fields :50: and :52s:           *
      *               FMT53 - Format field :53s:                      *
      *               FMT54 - Format field :54s:                      *
      *               FMT57 - Format field :57s:                      *
      *               FMT59 - Format field :59s:                      *
      *   Calls     -                                                 *
      *****************************************************************
      *
     C           SWADF     BEGSR
      *
      **  Address 1
     C           ZSADD1    IFNE *BLANKS
     C                     MOVELZSADD1    MFLD
     C                     END                             Address 1      E42086
      *
      **  Address 2
     C           ZSADD2    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD2    MFLD
     C                     END                             Address 2      E42086
      **  Address 3
     C           ZSADD3    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD3    MFLD
     C                     END                             Address 3      E42086
      **  Address 4
     C           ZSADD4    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD4    MFLD
     C                     END                             Address 4
     C********** CSW207    IFEQ 'Y'                                                CSW207A BUG15017A
     C********** CFT032    OREQ 'Y'                                                  250600 BUG15017
     C*******    PMSGL5    ANDNE*BLANKS                                              CSW207A  250600
     C********** ZSADD5    ANDNE*BLANKS                                             250600 BUG15017A
     C           ZSADD5    IFNE *BLANKS                                                    BUG15017A
     C                     ADD  1         X                                             CSW207A
     C           X         OCUR MULT                                                    CSW207A
     C                     MOVELPMSGL5    MFLD                                          CSW207A
     C*******              MOVELPMSGL5    MFLD                                       CSW207A  250600
     C*******              MOVEL*BLANKS   PMSGL5                                     CSW207A  250600
     C                     MOVELZSADD5    MFLD                                                250600
     C                     MOVEL*BLANKS   ZSADD5                                              250600
     C                     ENDIF                                                             CSW207A
     C**********           END                             Address 3      E42086
     C**********           END                             Address 2      E42086
     C**********           END                             Address 1      E42086
      *
     C                     ENDSR
      /EJECT                                                              183583
      *****************************************************************   183583
      *                                                               *   183583
      *   SEXTN - Store customer with SWIFT address to data structure *   183583
      *                                                               *   183583
      *   Called by: FMTORD, FMT53, FMT54, FMT56, FMT57               *   183583
      *   Calls    : None                                             *   183583
      *                                                               *   183583
      *****************************************************************   183583
      *                                                                   183583
     C           SEXTN     BEGSR                                          183583
      *                                                                   183583
     C           SAVMTG    IFNE *BLANKS                                   183583
     C                     MOVE SAVMTG    @MTG                            183583
     C                     ELSE                                           183583
     C                     MOVELMTAG      @MTG                            183583
     C                     ENDIF                                          183583
     C           FLDTYP    IFEQ '5'                                       183583
     C           FLDTAG    ANDEQ'A'                                       183583
     C           FLDTYP    OREQ '5'                                                         BUG15037
     C           FLDTAG    ANDEQ'F'                                                         BUG15037
     C                     ADD  1         V                               183583
     C           V         OCUR EXTN                                      183583
     C                     Z-ADDX         MPSN                            183583
     C                     MOVEL@MTG      MTG                             183583
     C                     MOVELZDEST     MCSI                            183583
     C                     ENDIF                                          183583
      *                                                                   183583
     C           SEXT9     ENDSR                                          183583
     C/EJECT
      *****************************************************************
      ****ROUT*-*determine*message*routing*****************************   CSW096
      ****Called*by*-*main*process*************************************   CSW096
      ****Calls*-*NWAD*determine*default*network*addresses*************   CSW096
      ************PRAD*determine*priority*network*addresses************   CSW096
      *****************************************************************   CSW096
      ***********                                                         CSW096
     C***********ROUT      BEGSR                                          CSW096
      ***********                                                         CSW096
      ****Access*SDBRCHPD*using*branch*code*******************************CSW096
     C***********          CALL 'AOBRCHR0'                                CSW096
     C***********          PARM '*MSG   ' @RTCD                           CSW096
     C***********          PARM '*KEY   ' @OPTN                           CSW096
     C***********          PARM MGPOBR    P@BRCD  3                       CSW096
     C***********SDBRCH    PARM SDBRCH    DSSDY                           CSW096
      ***********                                                         CSW096
      ***Branch*record*not*found*-*Error**********************************CSW096
      ***********                                                         CSW096
     C***********@RTCD     IFNE *BLANKS                                   CSW096
     C************LOCK     IN   LDA                                       CSW096
     C***********          MOVE '004'     DBASE              * * * * * * *CSW096
     C***********          MOVELMGPOBR    DBKEY              * DBERR 004 *CSW096
     C***********          MOVEL'SDBRCHPD'DBFILE             * * * * * * *CSW096
     C***********          OUT  LDA                                       CSW096
     C***********          EXSR *PSSR                                     CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      *****Save*branch*internal*customer*number***************************CSW096
      ***********                                                         CSW096
     C***********          MOVE A8BICN    SECN                            CSW096
     C***********          MOVE A8BICN    @SND    6                       CSW096
      ***********                                                         CSW096
      ****Access*SDCUSTPD*using*branch*internal*customer*number***********CSW096
      ***********                                                         CSW096
     C***********          MOVE *BLANKS   @KEY1                           CSW096
     C***********          MOVELA8BICN    @KEY1                           CSW096
     C***********          CALL 'AOCUSTR0'                                CSW096
     C***********          PARM '*MSG   ' @RTCD                           CSW096
     C***********          PARM '*KEY   ' @OPTN                           CSW096
     C***********          PARM           @KEY1  10                       CSW096
     C***********          PARM *BLANKS   @KYST   7                       CSW096
     C***********SDCUST    PARM SDCUST    DSSDY                           CSW096
      ***********                                                         CSW096
      ***Customer*record*not*found*-*Error********************************CSW096
      ***********                                                         CSW096
     C***********@RTCD     IFNE *BLANKS                                   CSW096
     C************LOCK     IN   LDA                                       CSW096
     C***********          MOVE '005'     DBASE              * * * * * * *CSW096
     C***********          MOVELA8BICN    DBKEY              * DBERR 005 *CSW096
     C***********          MOVEL'SDCUSTPD'DBFILE             * * * * * * *CSW096
     C***********          OUT  LDA                                       CSW096
     C***********          EXSR *PSSR                                     CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****Save*sender's*addresses*&*parent*customer*number****************CSW096
     C***********          MOVE BBCRNM    SCRNM                           CSW096
     C***********          MOVE A8BTID    SCSID                           CSW096
     C***********          MOVE BBTXA1    STELX                           CSW096
     C***********          MOVE BBSTAD    SSTTX                           CSW096
     C***********          MOVE BBPCNB    SPCNB                           CSW096
      ***********                                                         CSW096
      ****Access*SDCUSTPD*using*destination*customer*number***************CSW096
     C***********          MOVE MGDEST    DECN                            CSW096
     C***********          MOVE MGDEST    @DST    6                       CSW096
      ***********                                                         CSW096
     C***********          MOVE *BLANKS   @KEY1                           CSW096
     C***********          MOVELMGDEST    @KEY1                           CSW096
     C***********          CALL 'AOCUSTR0'                                CSW096
     C***********          PARM '*MSG   ' @RTCD                           CSW096
     C***********          PARM '*KEY   ' @OPTN                           CSW096
     C***********          PARM           @KEY1  10                       CSW096
     C***********          PARM *BLANKS   @KYST   7                       CSW096
     C***********SDCUST    PARM SDCUST    DSSDY                           CSW096
      ***********                                                         CSW096
     C***********          MOVE *BLANKS   DSERR                           CSW096
      ***********                                                         CSW096
      ****If*the*Destination*Customer*is*not*found.***********************CSW096
      ***********                                                         CSW096
     C***********@RTCD     IFNE *BLANKS                                   CSW096
     C***********          MOVE 'Y'       @ERR                            CSW096
     C***********          MOVELMSGA,2    DSERR  50                       CSW096
      ***********                                                         CSW096
      ****Determine*the*routing*to*the*destination*customer.**************CSW096
      ***********                                                         CSW096
     C***********          ELSE                                           CSW096
     C***********          MOVE BBCSID    CSID                            CSW096
      ***********                                                         CSW096
      ***If*there*is*a*default*network.***********************************CSW096
      ***********                                                         CSW096
     C***********BBDNW1    IFNE *BLANKS                                   CSW096
     C***********          EXSR NWAD                                      CSW096
     C***********          ELSE                                           CSW096
      ***********                                                         CSW096
      ***Else*use*the*priority*network.***********************************CSW096
      ***********                                                         CSW096
     C***********          EXSR PRAD                                      CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****Fill*up*the*message*status*released *nfo.*from*PF/SDCUSTPD***   CSW096
      ****if*the*message*status*is*blank.*********************************CSW096
      ***********                                                         CSW096
     C***********MGST      IFEQ *BLANKS                                   CSW096
      ***********                                                         CSW096
      ****Is*message*to*be*generated*as*released*?************************CSW096
     C***********          MOVE BBDS01    GNR,1                           CSW096
     C***********          MOVE BBDS02    GNR,2                           CSW096
     C***********          MOVE BBDS03    GNR,3                           CSW096
     C***********          MOVE BBDS04    GNR,4                           CSW096
     C***********          MOVE BBDS05    GNR,5                           CSW096
     C***********          MOVE BBDS06    GNR,6                           CSW096
     C***********          MOVE BBDS07    GNR,7                           CSW096
     C***********          MOVE BBDS08    GNR,8                           CSW096
     C***********          MOVE BBDS09    GNR,9                           CSW096
     C***********          MOVE BBDS10    GNR,10                          CSW096
     C***********          MOVE BBDS11    GNR,11                          CSW096
     C***********          MOVE BBDS12    GNR,12                          CSW096
     C***********          MOVE BBDS13    GNR,13                          CSW096
     C***********          MOVE BBDS14    GNR,14                          CSW096
     C***********          MOVE BBDS15    GNR,15                          CSW096
      ***********                                                         CSW096
     C***********'100'     LOKUPGNR                      20               CSW096
     C***********'10*'     LOKUPGNR                      21               CSW096
     C***********'1**'     LOKUPGNR                      22               CSW096
      ***********                                                         CSW096
     C************IN20     IFEQ '1'                                       CSW096
     C************IN21     OREQ '1'                                       CSW096
     C************IN22     OREQ '1'                                       CSW096
     C***********          MOVE 'RSND'    MGST                            CSW096
     C***********          MOVE '2'       MGSG                            CSW096
     C***********          ELSE                                           CSW096
     C***********          MOVE 'CRTD'    MGST                            CSW096
     C***********          MOVE '1'       MGSG                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****Save*destination*parent*customer*number*************************CSW096
     C***********          MOVE BBPCNB    DPCNB                           CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          ENDSR                                          CSW096
     C/EJECT                                                              CSW096
      *****************************************************************   CSW096
      *   SRROUT - determine message routing                          *   CSW096
      *   Called by - main process                                    *   CSW096
      *   Calls -                                                     *   CSW096
      *****************************************************************   CSW096
      *                                                                   CSW096
     C           SRROUT    BEGSR                                          CSW096
      *                                                                   CSW096
     C/COPY WNCPYSRC,MG0100C002
     C                     MOVE MGPOBR    I@SNBR                          CSW096
     C/COPY WNCPYSRC,MG0100C003
     C                     MOVE *BLANKS   I@DSCN                          CSW096
     C                     MOVE MGDEST    I@DSCN                          CSW096
      *                                                                   CFT013
     C           CFT013    IFEQ 'Y'                                       CFT013
     C           PORTCD    ANDEQ'*CRT103'                                 CFT013
     C                     MOVE '103'     I@MTPY                          CFT013
     C                     ELSE                                           CFT013
     C                     MOVE '100'     I@MTPY                          CSW096
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C                     MOVE 'N'       I@CONC                          CSW096
     C                     Z-ADDMGSETP    I@SETT                          CSW096
     C                     MOVE *BLANK    I@FTCS                          CSW096
     C                     MOVE MGMODI    I@MMOD                          CSW096
      *###################################################################CSW096
      *                                                                  #CSW096
      * Below are two copy sources intended for setting up the custom    #CSW096
      * parameter (P@ZZ) in the call to MG9900.                          #CSW096
      * One (MG9900CALL) is in ALL MG generation programs and is for use #CSW096
      * when a change is required to all of them.                        #CSW096
      * The other is only in this program.                               #CSW096
     C/COPY WNCPYSRC,MG9900CALL                                          #CSW096
     C/COPY WNCPYSRC,MG0100ROUT                                          #CSW096
      *                                                                  #CSW096
      *###################################################################CSW096
     C                     CALL 'MG9900'                                  CSW096
     C                     PARM *BLANKS   @RTCD                           CSW096
     C                     PARM           P@IN                            CSW096
     C                     PARM *BLANKS   P@OUT                           CSW096
     C                     PARM           P@ZZ  256                       CSW096
      *                                                                   CSW096
     C           @RTCD     IFNE *BLANKS                                   CSW096
     C           *LOCK     IN   LDA                                       CSW096
     C                     MOVE '092'     DBASE              * * * * * * *CSW096
     C                     MOVEL'*CALL  ' DBKEY              * DBERR 092 *CSW096
     C                     MOVEL'MG9900'  DBFILE             * * * * * * *CSW096
     C                     OUT  LDA                                       CSW096
     C                     EXSR *PSSR                                     CSW096
     C                     ELSE                                           CSW096
     C                     MOVE O@NWRK    NWRK                            CSW096
     C/COPY WNCPYSRC,MG0100C016
     C**********           Z-ADDO@CNSN    SECN                                         CSW096 CSD027
     C                     MOVE O@CNSN    SECN                                                CSD027
     C                     MOVE *BLANKS   @SND    6                       CSW096
     C                     MOVE O@CNSN    @SND                            CSW096
     C                     MOVE O@NWSN    NWSN                            CSW096
     C**********           Z-ADDMGDEST    DECN                                         CSW096 CSD027
     C                     MOVE MGDEST    DECN                                                CSD027
     C                     MOVE *BLANKS   @DST    6                       CSW096
     C                     MOVE MGDEST    @DST                            CSW096
     C                     MOVE O@NWDS    NWDS                            CSW096
     C                     MOVE O@MGSG    MGSG                            CSW096
     C                     MOVE O@MGST    MGST                            CSW096
     C                     MOVE O@PCNB    SPCNB                           CSW096
     C/COPY WNCPYSRC,MG0100C019
     C                     END                                            CSW096
      *                                                                                       CSW215
      ** Change the Network to 'PAPER' if the Precious Metal Indicator                        CSW215
      ** of the currency is 'Y' and Network is currently set to 'SWIFT'                       CSW215
      *                                                                                       CSW215
     C           CSW215    IFEQ 'Y'                                                           CSW215
     C                     CALL 'AOCURRR0'                                                    CSW215
     C                     PARM *BLANKS   @RTCD                                               CSW215
     C                     PARM '*KEY   ' @OPTN                                               CSW215
     C                     PARM MGCCY     @BKCY                                               CSW215
     C           SDCURR    PARM SDCURR    DSSDY                                               CSW215
      *                                                                                       CSW215
     C           @RTCD     IFEQ *BLANKS                                                       CSW215
     C           NWRK      ANDEQ'SWIFT'                                                       CSW215
     C           A6PMRT    ANDEQ'Y'                                                           CSW215
     C                     MOVEL'PAPER'   NWRK                                                CSW215
     C                     ENDIF                                                              CSW215
     C                     ENDIF                                                              CSW215
      *                                                                   CSW096
     C/COPY WNCPYSRC,MG0100C011
     C                     ENDSR                                          CSW096
     C/EJECT                                                              CSW096
      *****************************************************************
      *   FMTREF                                                      *
      *   Called by - main process                                    *
      *   Calls     -                                                 *
      *****************************************************************
      *
     C           FMTREF    BEGSR
     C/COPY WNCPYSRC,MG0100C030
      *
     C                     MOVE *BLANKS   CVTRN                           105577
     C                     MOVE *BLANKS   CVDLNO                          105577
     C                     MOVE *BLANKS   CVSEQN                          105577
      *                                                                   105577
      ** Field :20: -  Transaction Reference Number.
     C/COPY WNCPYSRC,MG0100C031
      *
     C                     Z-ADD1         X
     C/COPY WNCPYSRC,MG0100C032
     C           X         OCUR MULT
     C                     MOVEA*BLANKS   @WRK
      *
     C                     Z-ADD1         Z       20
      *                                                                   142403
     C           CLE007    IFEQ 'Y'                                       142403
     C           MGMODI    ANDEQ'LF'                                      142403
     C           CLE007    OREQ 'Y'                                       142403
     C           MGMODI    ANDEQ'LS'                                      142403
     C                     MOVE 'F'       @WRK,1                          142403
     C                     MOVEAMGTNUM    @WRK,2                          142403
      *                                                                   142403
      * For a loan based fee, midas transaction is 14 characters long,    142403
      * so remove customer number, since there will not be room for it    142403
      * in the SWIFT transaction ref.                                     142403
     C           @WRK,15   IFNE *BLANK                                    142403
     C                     MOVEA@WRK,8    W#LNSQ  8                       142403
     C                     MOVEAW#LNSQ    @WRK,2    P                     142403
     C                     ENDIF                                          142403
      *                                                                   142403
     C                     ELSE                                           142403
     C                     MOVEAMGMODI    @WRK
     C                     MOVEAMGTNUM    @WRK,3
     C                     ENDIF                                          142403
     C           MGLSWS    ADD  1         HLSWS   30
     C                     MOVE HLSWS     HSWS    3
      *
     C           ' '       LOKUP@WRK,Z                   31
      *                                                                   142403
     C           CLE007    IFEQ 'Y'                                       142403
     C           MGMODI    ANDEQ'LF'                                      142403
     C           CLE007    OREQ 'Y'                                       142403
     C           MGMODI    ANDEQ'LS'                                      142403
     C                     MOVE HLSWS     WSWS    2                       142403
     C                     MOVEAWSWS      @WRK,Z                          142403
      *                                                                   142403
     C                     ELSE                                           142403
     C                     MOVEAHSWS      @WRK,Z
     C                     ENDIF                                          142403
      *
      **  Check on MGREFPD for a uniqne TRN,else output as an error.
      **  and store the TRN of the new confirmation message.
      *
     C                     MOVEA@WRK      @TRNA  16
     C                     MOVEA@WRK      CVTRN  16                       105577
     C                     MOVELMGTNUM    CVDLNO  6                       105577
     C                     MOVELHSWS      CVSEQN  3                       105577
      *
     C           @TRNA     CHAINMGREFL0              11
      *
      ** If a record is found flag field as in error.
      *
     C           *IN11     IFEQ '0'
     C                     MOVE 'Y'       @ERR
     C                     MOVELMSGA,7    MERR
     C                     END
      *
     C                     MOVEL':20:'    MTAG
     C                     MOVEA@WRK      MFLD
     C**************       MOVELMFLD      MGTNUM
      *
      **  Field :32A: value date, currency code, amount
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C/COPY WNCPYSRC,MG0100C004
      *
      **  Format value date to SWIFT standard
     C                     MOVE MGVDAT    ZMDAY
     C/COPY WNCPYSRC,MG0100C005
      *                                                                                       CDL099
      * Only check for SVD if FX/MM                                                           CDL099
     C           MGMODI    IFEQ 'DL'                                                          CDL099
     C           CDL099    ANDEQ'Y'                                                           CDL099
     C                     MOVELMGTNUM    KYDLNO  60                                          CDL099
     C           KYDLNO    CHAINDEALS                40                                       CDL099
     C           *IN40     IFEQ '0'                                                         MD050972
     C           BSDT2     ANDNE0                                                           MD050972
     C                     MOVE BSDT2     ZMDAY                                               CDL099
     C                     ENDIF                                                            MD050972
     C                     ENDIF                                                              CDL099
      *                                                                                       CDL099
     C                     CALL 'ZM0060'               15
     C                     PARM           ZMDAY
     C                     PARM           ZSDATE
      *
      ** Call to program ended in error.
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '012'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 012  *
     C                     MOVEL'ZM0060'  DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Format purchase currency and amount
     C                     MOVE MGCCY     ZCCY
     C/COPY WNCPYSRC,MGH00071
     C                     MOVE MGEAMT    ZAMNT
     C                     CALL 'ZM0040'               15
     C                     PARM           ZAMNT  130
     C                     PARM           ZCCY    3
     C                     PARM           ZSAMNT
     C                     PARM           ZSCCY   3
     C                     PARM           ZERR    1
     C                     PARM           ZSWDPC  1                                           222373
      *
      **  Call ended in error (program not found)
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '013'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 013  *
     C                     MOVEL'ZM0040'  DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      ** Error - indicate erroneous fields;
     C           ZERR      IFEQ '1'
     C                     MOVE 'Y'       @ERR
     C                     MOVE MGEAMT    ZAMT
     C                     MOVE MGCCY     ZCCY
     C                     MOVELERR3N     MFLD
     C                     MOVELMSGA,4    MERR
      *
     C                     ELSE
     C                     MOVE ':32A:'   MTAG
     C                     MOVELFLD3N     MFLD
      *                                                                   144171
      ** Save event amount.                                               144171
      *                                                                   144171
     C                     MOVEL*BLANKS   SAMNT  17                       144171
     C                     MOVELZSAMNT    SAMNT                           144171
      *                                                                   144171
     C                     END
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   FMTORD - format fields :50: :52s:                           *
      *   Called by - main process                                    *
      *   Calls     - SWADF - Format SWIFT address.                   *
      *****************************************************************
      *
     C           FMTORD    BEGSR
      *
      **  Format :50: Ordering customer
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE ':50: '   MTAG
     C********** MGPOCN    IFEQ 0                                                             CSD027
     C           MGPOCN    IFEQ *BLANKS                                                       CSD027
     C                     MOVELMSGA,8    MERR
     C                     MOVE 'Y'       @ERR
     C                     ELSE
      *
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELMGPOCN    ZDEST
     C                     CALL 'ZM0055'
     C                     PARM           ZDEST  12
     C                     PARM           ZSADD1 35
     C                     PARM           ZSADD2 35
     C                     PARM           ZSADD3 35
     C                     PARM           ZSADD4 35
     C                     PARM           ZERR
     C*                                                                   S01408
     C/COPY WNCPYSRC,MG0100CP11                                           S01408
     C*                                                                   S01408
      *
     C           ZERR      IFEQ '1'
     C                     MOVELMGPOCN    MFLD
     C                     MOVELMSGA,6    MERR
     C                     MOVE 'Y'       @ERR
     C                     END
      *
      **  Write full name and address
      *
     C                     EXSR SWADF
     C                     END
      *
      **  Format :52s: Ordering institution
     C********** MGPOBN    IFNE 0                                                             CSD027
     C           MGPOBN    IFNE *BLANKS                                                       CSD027
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELMGPOBN    ZDEST
     C                     CALL 'ZM0050'
     C                     PARM           ZDEST
     C                     PARM           ZSADD1
     C                     PARM           ZSADD2
     C                     PARM           ZSADD3
     C                     PARM           ZSADD4
     C                     PARM           ZSTAG   1
     C                     PARM           ZSTYPE  1
     C                     PARM           ZERR
     C                     PARM *BLANK    ZDBEI   1                                           CSW201
      *
     C           ZERR      IFEQ '1'
     C                     MOVELMGPOBN    MFLD
     C                     MOVELMSGA,5    MERR
     C                     MOVE 'Y'       @ERR
     C                     END
      *
      **  Write ISO bank identifier..
     C           ZSTAG     IFEQ 'A'
     C                     MOVE ':52A:'   MTAG
      *
      **  ..or full name and address
     C                     ELSE
     C                     MOVE ':52D:'   MTAG
     C                     END
      *
     C                     EXSR SWADF
     C                     MOVE *BLANKS   SAVMTG  5                       183583
     C                     EXSR SEXTN                                     183583
     C                     END
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   FMT53 - format field  :53s:                                 *
      *   Called by - main process                                    *
      *   Calls     - SWADF - Format SWIFT address.                   *
      *****************************************************************
      *
     C           FMT53     BEGSR
      *
      **  Format :53s: Senders correspondent
     C*C*PY*WN*PYSRC*MG0100C026                                           169210
     C/COPY WNCPYSRC,MG0100CX26                                           169210
     C           MGRVNO    IFNE *BLANKS
      *                                                                   CMG001
      ** Always execute  the following code when CMG001 is switched ON.   CMG001
     C           CMG001    OREQ 'Y'                                       CMG001
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     MOVE *BLANKS   P@NONB
     C                     MOVELMGPONS    P@NONB
     C                     CALL 'AONOSTR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM *BLANKS   P@CUST  6
     C                     PARM MGCCY     P@CYCD  3
     C**********           PARM *BLANKS   P@ACCD  4                                           CGL029
     C                     PARM *BLANKS   P@ACCD 10                                           CGL029
     C                     PARM *BLANKS   P@ACSN  2
     C                     PARM           P@NONB  2
     C                     PARM *BLANKS   P@BRCD  3
     C                     PARM *BLANKS   P@CSSN 10
     C                     PARM *BLANKS   P@PNOI  1
     C           SDNOST    PARM SDNOST    DSFDY
      *
     C           @RTCD     IFNE *BLANKS
     C                     MOVE ':53 :'   MTAG
     C                     MOVELMGPONS    @WK5    5
     C                     MOVE MGCCY     @WK5
     C                     MOVEL@WK5      MFLD
     C                     MOVELMSGA,3    MERR
     C                     MOVE 'Y'       @ERR
      *
      ** Format 53B when CMG001 is switched ON.
     C                     ELSE                                           CMG001
     C           CMG001    IFEQ 'Y'                                       CMG001
     C           A7OACN    ANDNE*BLANKS                                                     MD050936
     C                     MOVE ':53B:'   MTAG                            CMG001
     C                     MOVE *BLANKS   MFLD                            CMG001
      *                                                                   CMG001 210796
      *  210796 - Extend Our a/c at Nostro field from 15A to 35A          CMG001 210796
      *           and truncate the 35th character.                        CMG001 210796
     C*******              MOVEL'/'       TEMP1  15                       CMG001 210796
     C*******              MOVE A7OANN    TEMP1                           CMG001 210796
     C                     MOVEL'/'       TEMP1  35                       CMG001 210796
     C                     MOVELA7OACN    TEMP2  34                       CMG001 210796
     C                     MOVE TEMP2     TEMP1                           CMG001 210796
      *                                                                   CMG001 210796
     C                     MOVELTEMP1     MFLD                            CMG001
     C                     GOTO END53                                     CMG001
     C                     ENDIF                                          CMG001
     C                     END
      *
     C*                                                                   S01408
     C/COPY WNCPYSRC,MG0100CCP4                                           S01408
     C*                                                                   S01408
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELA7CUST    ZDEST
     C                     CALL 'ZM0050'
     C                     PARM           ZDEST
     C                     PARM           ZSADD1
     C                     PARM           ZSADD2
     C                     PARM           ZSADD3
     C                     PARM           ZSADD4
     C                     PARM           ZSTAG
     C                     PARM           ZSTYPE
     C                     PARM           ZERR
     C                     PARM           ZDBEI                                               CSW201
      *
     C           ZERR      IFEQ '1'
     C                     MOVE ':53 :'   MTAG
     C                     MOVELA7CUST    MFLD
     C                     MOVELMSGA,5    MERR
     C                     MOVE 'Y'       @ERR
     C                     END
      *
      **  Write ISO bank identifier..
     C           ZSTAG     IFEQ 'A'
     C/COPY WNCPYSRC,MGH00001
     C                     MOVE ':53A:'   MTAG
     C                     MOVELZSADD1    MFLD
     C                     MOVE *BLANKS   SAVMTG                          183583
     C                     EXSR SEXTN                                     183583
     C/COPY WNCPYSRC,MGH00002
     C           CFT013    IFEQ 'Y'                                       CFT013
     C                     MOVE 'Y'       AIND,2                          CFT013
     C                     ENDIF                                          CFT013
      *
      **  Access SDNOSTPD for a possible 'B' type address.
      *
     C                     ELSE
     C                     MOVE *BLANKS   @KEY1
     C                     MOVELA7CUST    @KEY1
     C                     CALL 'AOCUSTR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM           @KEY1  10
     C                     PARM *BLANKS   @KYST   7
     C           SDCUST    PARM SDCUST    DSSDY
     C*                                                                   S01408
     C/COPY WNCPYSRC,MG0100CCP8                                           S01408
     C*                                                                   S01408
      *
      ** If our record is not found on sdnostpd.
      *
     C           @RTCD     IFNE *BLANKS
     C                     MOVE ':53 :'   MTAG
     C                     MOVELA7CUST    MFLD
     C                     MOVELMSGA,3    MERR
     C                     MOVE 'Y'       @ERR
     C                     END
      *
      **  ..or town if branch of sender
     C           BBPCNB    IFEQ SPCNB
     C           BBPCNB    ANDNE*BLANKS
     C           BBPCNB    OREQ @SND
     C           A7CUST    OREQ SPCNB
     C                     MOVE ':53B:'   MTAG
     C                     MOVE *BLANKS   @WRK
     C                     MOVELBBCRNM    @WRK,1
     C                     Z-ADD22        J       20
     C                     MOVEABBCRTN    @WRK,J
     C                     MOVEA@WRK      MFLD
      *                                                                   CFT013
     C           CFT013    IFEQ 'Y'                                       CFT013
     C           @WRK,1    ANDEQ'/'                                       CFT013
     C                     MOVE 'Y'       AIND,2                          CFT013
     C                     ENDIF                                          CFT013
      *
      **  ..or full name and address
     C                     ELSE
     C                     MOVE ':53D:'   MTAG
     C                     EXSR SWADF
     C                     END
     C                     END
      *                                                                   CFT013
      ** If field :53a: is not present...                                 CFT013
     C                     ELSE                                           CFT013
     C           CFT013    IFEQ 'Y'                                       CFT013
      ** This code will only be executed if CMG001 is switched off.
     C           CMG001    ANDEQ'N'                                       CMG001
     C                     MOVE 'Y'       AIND,2                          CFT013
     C                     ENDIF                                          CFT013
     C                     END
     C*C*PY*WN*PYSRC*MG0100C027                                           169210
     C/COPY WNCPYSRC,MG0100CX27                                           169210
     C*                                                                   CMG001
     C           END53     TAG                                            CMG001
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   FMT54 - format field :54s:                                  *
      *   Called by - main process                                    *
      *   Calls     - SWADF - Format SWIFT address.                   *
      *****************************************************************
      *
     C           FMT54     BEGSR
      *
     C/COPY WNCPYSRC,MG0100C013
      **  Format :54s: Receivers correspondent
     C           MGRCRN    IFNE *BLANK
     C/COPY WNCPYSRC,MGH00055
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELMGRCRN    ZDEST
     C                     CALL 'ZM0050'
     C                     PARM           ZDEST
     C                     PARM           ZSADD1
     C                     PARM           ZSADD2
     C                     PARM           ZSADD3
     C                     PARM           ZSADD4
     C                     PARM           ZSTAG
     C                     PARM           ZSTYPE
     C                     PARM           ZERR
     C                     PARM           ZDBEI                                               CSW201
      *
     C           ZERR      IFEQ '1'
     C                     MOVE ':54 :'   MTAG
     C                     MOVELMGRCRN    MFLD
     C                     MOVELMSGA,5    MERR
     C                     MOVE 'Y'       @ERR
     C                     END
      *
      **  Write ISO bank identifier..
     C           ZSTAG     IFEQ 'A'
     C                     MOVE ':54A:'   MTAG
      *
      **  Write receiver's correspondent account if present
     C                     MOVE *BLANKS   SAVMTG                          183583
     C           MGRCRA    IFNE *BLANKS
     C                     MOVE MTAG      SAVMTG                          183583
     C/COPY WNCPYSRC,MG0100C033
     C                     MOVELMGRCRA    MFLD
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C                     MOVELZSADD1    MFLD
     C                     EXSR SEXTN                                     183583
      *                                                                   CFT013
     C           CFT013    IFEQ 'Y'                                       CFT013
     C                     MOVE 'Y'       AIND,3                          CFT013
     C                     ENDIF                                          CFT013
      *
     C                     ELSE
      *
      **  If address is a customer, attempt 'B' type address
     C           ZSTYPE    IFNE 'C'
     C                     MOVE *BLANKS   @KEY1
     C                     MOVELMGRCRN    @KEY1
     C                     CALL 'AOCUSTR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM           @KEY1  10
     C                     PARM *BLANKS   @KYST   7
     C           SDCUST    PARM SDCUST    DSSDY
     C*                                                                   S01408
     C/COPY WNCPYSRC,MG0100CCP9                                           S01408
     C*                                                                   S01408
      *
     C           @RTCD     IFNE *BLANKS
     C                     MOVE ':54 :'   MTAG
     C                     MOVELMGRCRN    MFLD
     C                     MOVELMSGA,2    MERR
     C                     MOVE 'Y'       @ERR
     C                     END
     C                     END
      *
      **  ..or town if branch of destination
     C           ZSTYPE    IFNE 'C'
     C           BBPCNB    ANDEQDPCNB
     C           BBPCNB    ANDNE*BLANKS
     C           BBPCNB    OREQ @DST
     C           MGRCRN    OREQ DPCNB
     C                     MOVE ':54B:'   MTAG
      *
      **  Write receiver's correspondent account if present
     C                     MOVE *BLANKS   SAVMTG                          183583
     C           MGRCRA    IFNE *BLANKS
     C                     MOVE MTAG      SAVMTG                          183583
     C/COPY WNCPYSRC,MG0100C034
     C                     MOVELMGRCRA    MFLD
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C                     MOVE *BLANKS   @WRK
     C                     MOVELBBCRNM    @WRK,1
     C                     Z-ADD22        J       20
     C                     MOVEABBCRTN    @WRK,J
     C                     MOVEA@WRK      MFLD
      *
      **  ..or full name and address  (ALWAYS for C/P nostro)
     C                     ELSE
     C                     MOVE ':54D:'   MTAG
      *
      **  Write receiver's correspondent account if present
     C           MGRCRA    IFNE *BLANKS
     C                     MOVELMGRCRA    MFLD
     C                     END
     C                     EXSR SWADF
     C                     END
     C                     END
      *                                                                   CFT013
      ** If field :54 is not present...                                   CFT013
     C                     ELSE                                           CFT013
     C           CFT013    IFEQ 'Y'                                       CFT013
     C                     MOVE 'Y'       AIND,3                          CFT013
     C                     ENDIF                                          CFT013
     C                     END
      *
     C/COPY WNCPYSRC,MG0100C014
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   FMT56 - format field :56A:                                  *
      *   Called by - main process                                    *
      *   Calls     -                                                 *
      *****************************************************************
      *
     C           FMT56     BEGSR
      *                                                                   153367
     C                     MOVE *BLANK    WFLD56  1                       153367
      *
      **  Format :56A: Intermediary
     C           MGPIBN    IFNE *BLANK
      *
      **  Set field :56: generated flag to 'Y'                            153367
      *                                                                   153367
     C                     MOVE 'Y'       WFLD56                          153367
      *                                                                   153367
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELMGPIBN    ZDEST
     C                     CALL 'ZM0050'
     C                     PARM           ZDEST
     C                     PARM           ZSADD1
     C                     PARM           ZSADD2
     C                     PARM           ZSADD3
     C                     PARM           ZSADD4
     C                     PARM           ZSTAG
     C                     PARM           ZSTYPE
     C                     PARM           ZERR
     C                     PARM           ZDBEI                                               CSW201
      *
     C           ZERR      IFEQ '1'
     C********** ZSTAG     ORNE 'A'                                       S01412
     C                     MOVE ':56 :'   MTAG
     C                     MOVELMGPIBN    MFLD
     C                     MOVELMSGA,5    MERR
     C                     MOVE 'Y'       @ERR
     C                     END
      *
      **  Write ISO bank identifier..
     C           ZSTAG     IFEQ 'A'                                       S01412
     C                     MOVE ':56A:'   MTAG
     C/COPY WNCPYSRC,MG0100C035
      *
      **  Write intermediary account if present
     C                     MOVE *BLANKS   SAVMTG                          183583
     C           MGPIBA    IFNE *BLANKS
     C                     MOVE MTAG      SAVMTG                          183583
     C                     MOVELMGPIBA    MFLD
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C                     MOVELZSADD1    MFLD
     C                     EXSR SEXTN                                     183583
      *                                                                   CFT013
     C           CFT013    IFEQ 'Y'                                       CFT013
     C                     MOVE 'Y'       AIND,5                          CFT013
     C                     ENDIF                                          CFT013
      *                                                                   S01412
      **  else format D type address                                      S01412
     C                     ELSE                                           S01412
     C                     MOVE ':56D:'   MTAG                            S01412
      *                                                                   S01412
      **  Write intermediary account if present                           S01412
     C           MGPIBA    IFNE *BLANKS                                   S01412
     C                     MOVELMGPIBA    MFLD                            S01412
     C                     END                                            S01412
     C                     EXSR SWADF                                     S01412
     C                     END                                            S01412
      *                                                                   CFT013
      ** If field :56 is not present...                                   CFT013
     C                     ELSE                                           CFT013
     C           CFT013    IFEQ 'Y'                                       CFT013
     C                     MOVE 'Y'       AIND,5                          CFT013
     C                     ENDIF                                          CFT013
     C                     END
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   FMT57 - format field :57s:                                  *
      *   Called by - main process                                    *
      *   Calls     - SWADF - Format SWIFT address.                   *
      *****************************************************************
      *
     C           FMT57     BEGSR
      *
      **  Format :57s: Account with institution
     C           MGAWBN    IFNE *BLANK
     C/COPY WNCPYSRC,MG0100C017
      *                                                                   078649
     C**********           MOVE *ZEROS    NUAWBN  60                                   078649 CSD027
     C**********           MOVE *BLANKS   NUAWBN  6                                    CSD027 172477
     C**********           MOVELMGAWBN    NUAWBN                                       078649 172477
     C********** NUAWBN    IFNE MGDEST                                                 078649 172477
      *                                                                   153367
      **  OR if field :56: was generated                                  153367
     C           WFLD56    OREQ 'Y'                                       153367
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELMGAWBN    ZDEST
     C                     CALL 'ZM0050'
     C                     PARM           ZDEST
     C                     PARM           ZSADD1
     C                     PARM           ZSADD2
     C                     PARM           ZSADD3
     C                     PARM           ZSADD4
     C                     PARM           ZSTAG
     C                     PARM           ZSTYPE
     C                     PARM           ZERR
     C                     PARM           ZDBEI                                               CSW201
      *
     C           ZERR      IFEQ '1'
     C                     MOVE ':57 :'   MTAG
     C                     MOVELMGAWBN    MFLD
     C                     MOVELMSGA,5    MERR
     C                     MOVE 'Y'       @ERR
     C                     END
      *
      **  If account with account blank use CHAPS account
     C           MGAWBA    IFEQ *BLANKS
     C                     MOVE MGBTB1    @BTB
     C           @BT1      IFEQ '/BEN/'
     C           @BT2      ANDEQ'/SC'
     C*C*PY*WN*PYSRC*MG0100C029                                           169210
     C/COPY WNCPYSRC,MG0100CX29                                           169210
     C                     MOVEL@BT4      MGAWBA
     C                     END
     C                     END
      *
      **  Write ISO bank identifier..
     C           ZSTAG     IFEQ 'A'
     C                     MOVE ':57A:'   MTAG
      *
      **  Write account with account if present
     C                     MOVE *BLANKS   SAVMTG                          183583
     C           MGAWBA    IFNE *BLANKS
     C                     MOVE MTAG      SAVMTG                          183583
     C                     MOVELMGAWBA    MFLD
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C                     MOVELZSADD1    MFLD
     C                     EXSR SEXTN                                     183583
      *                                                                   CFT013
     C           CFT013    IFEQ 'Y'                                       CFT013
     C                     MOVE 'Y'       AIND,6                          CFT013
     C                     ENDIF                                          CFT013
      *
     C                     ELSE
      *
      **  If address is customer, attempt 'B' type address
     C           ZSTYPE    IFNE 'C'
     C                     MOVE *BLANKS   @KEY1
     C                     MOVELMGAWBN    @KEY1
     C                     CALL 'AOCUSTR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM           @KEY1  10
     C                     PARM *BLANKS   @KYST   7
     C           SDCUST    PARM SDCUST    DSSDY
     C*                                                                   S01408
     C/COPY WNCPYSRC,MG0100CP10                                           S01408
     C*                                                                   S01408
      *
     C           @RTCD     IFNE *BLANKS
     C                     MOVE ':57 :'   MTAG
     C                     MOVELMGAWBN    MFLD
     C                     MOVELMSGA,2    MERR
     C                     MOVE 'Y'       @ERR
     C                     END
     C                     END
      *
      **  ..or town if branch of destination
     C           ZSTYPE    IFNE 'C'
     C           BBPCNB    ANDEQDPCNB
     C           BBPCNB    ANDNE*BLANKS
     C           BBPCNB    OREQ @DST
     C           MGAWBN    OREQ DPCNB
     C                     MOVE ':57B:'   MTAG
      *
      **  Write account with account if present
     C           MGAWBA    IFNE *BLANKS
     C                     MOVELMGAWBA    MFLD
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C                     MOVE *BLANKS   @WRK
     C                     MOVEABBCRNM    @WRK,1
     C                     Z-ADD22        J       20
     C                     MOVEABBCRTN    @WRK,J
     C                     MOVEA@WRK      MFLD
      *
      **  ..or full name and address
     C                     ELSE
     C                     MOVE ':57D:'   MTAG
      *
      **  Write account with account if present
     C           MGAWBA    IFNE *BLANKS
     C                     MOVELMGAWBA    MFLD
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
      *
     C                     EXSR SWADF
     C                     END
     C                     END
      *                                                                   CFT013
      ** If field :57 is not present...                                   CFT013
     C**********           ELSE                                                        CFT013 172477
     C           CFT013    IFEQ 'Y'                                       CFT013
     C                     MOVE 'Y'       AIND,6                          CFT013
     C                     ENDIF                                          CFT013
     C**********           END                                                         078649 172477
      *                                                                   CFT013
      ** If field :57 is not present...                                   CFT013
     C                     ELSE                                           CFT013
     C           CFT013    IFEQ 'Y'                                       CFT013
     C                     MOVE 'Y'       AIND,6                          CFT013
     C                     ENDIF                                          CFT013
     C                     END
      *
     C/COPY WNCPYSRC,MG0100C018
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   FMT59 - format field :59:                                   *
      *   Called by - main process                                    *
      *   Calls     - SWADF - Format SWIFT address.                   *
      *****************************************************************
      *
     C           FMT59     BEGSR
      *
     C/COPY WNCPYSRC,MG0100C015
      **  Format :59: Beneficiary
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE ':59: '   MTAG
     C/COPY WNCPYSRC,MG0100C024
      *
     C           MGBENN    IFEQ *BLANK
     C*C*PY*WN*PYSRC*MG0100C024                                           169210
     C/COPY WNCPYSRC,MG0100CX24                                           169210
     C                     MOVELMGBENN    MFLD
     C                     MOVELMSGA,8    MERR
     C                     MOVE 'Y'       @ERR
     C                     ELSE
     C*C*PY*WN*PYSRC*MG0100C025                                           169210
     C/COPY WNCPYSRC,MG0100CX25                                           169210
      *
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELMGBENN    ZDEST
     C/COPY WNCPYSRC,MG0100C026
     C                     CALL 'ZM0055'
     C                     PARM           ZDEST
     C                     PARM           ZSADD1
     C                     PARM           ZSADD2
     C                     PARM           ZSADD3
     C                     PARM           ZSADD4
     C                     PARM           ZERR
     C*                                                                   S01408
     C/COPY WNCPYSRC,MG0100CP12                                           S01408
     C*                                                                   S01408
      *
     C           ZERR      IFEQ '1'
     C                     MOVELMGBENN    MFLD
     C                     MOVELMSGA,6    MERR
     C                     MOVE 'Y'       @ERR
     C                     ELSE
     C/COPY WNCPYSRC,MG0100C027
      *
      **  If beneficiary account blank use bank to bank beneficiary
     C           MGBENA    IFEQ *BLANKS
     C                     MOVE MGBTB1    @BTB
     C           @BT1      IFEQ '/BEN/'
     C           @BT2      IFNE '/BJ'
     C           @BT2      ANDNE'/BL'
     C           @BT2      ANDNE'/CH'
     C           @BT2      ANDNE'/CP'
     C           @BT2      ANDNE'/FW'
     C           @BT2      ANDNE'/SC'
     C           MGMODI    IFEQ 'SE'                                                          219242
     C                     MOVEL@BT4      MGBENA                                              219242
     C                     ELSE                                                               219242
     C                     MOVEL@BT3      MGBENA
     C                     ENDIF                                                              219242
     C                     END
     C                     END
     C                     END
      *
      **  Write beneficiary account if present
     C           MGBENA    IFNE *BLANKS
     C                     MOVELMGBENA    MFLD
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
      *
     C                     EXSR SWADF
     C                     END
     C                     END
     C/COPY WNCPYSRC,MG0100C025
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   FMTDET - format detail fields :70: :71A:                    *
      *   Called by - main process                                    *
      *****************************************************************
      *
     C           FMTDET    BEGSR
      *
      **  Format :70: Details of payments
      *
     C                     MOVE 'N'       DONIT   1                       135953
     C           MGDTP1    IFNE *BLANKS                                   135953
     C           MGDTP2    ORNE *BLANKS                                   135953
     C           MGDTP3    ORNE *BLANKS                                   135953
     C           MGDTP4    ORNE *BLANKS                                   135953
     C                     ADD  1         X                               135953
     C           X         OCUR MULT                                      135953
     C                     MOVE ':70: '   MTAG                            135953
     C                     MOVE 'Y'       DONIT                           135953
     C                     END                                            135953
      *                                                                   135953
     C           MGDTP1    IFNE *BLANKS
     C***********          ADD  1         X                               135953
     C***********X         OCUR MULT                                      135953
     C***********          MOVE ':70: '   MTAG                            135953
     C                     MOVELMGDTP1    MFLD
     C                     MOVE 'N'       DONIT                           135953
     C                     END
      *
     C           MGDTP2    IFNE *BLANKS
     C           DONIT     IFEQ 'N'                                       135953
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END                                            135953
     C                     MOVELMGDTP2    MFLD
     C                     MOVE 'N'       DONIT                           135953
     C                     END
      *
     C           MGDTP3    IFNE *BLANKS
     C           DONIT     IFEQ 'N'                                       135953
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END                                            135953
     C                     MOVELMGDTP3    MFLD
     C                     MOVE 'N'       DONIT                           135953
     C                     END
      *
     C           MGDTP4    IFNE *BLANKS
     C           DONIT     IFEQ 'N'                                       135953
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END                                            135953
     C                     MOVELMGDTP4    MFLD
     C                     MOVE 'N'       DONIT                           135953
     C                     END
      *
      **  Format :71A: Details of charges
     C/COPY WNCPYSRC,MG0100C043
     C********** MGDCHG    IFNE *BLANKS                                                     BUG26160
     C**********           ADD  1         X                                                 BUG26160
     C********** X         OCUR MULT                                                        BUG26160
     C**********           MOVE ':71A:'   MTAG                                              BUG26160
     C**********           MOVELENDCHG    MFLD                                       250600 BUG26160
     C**********           MOVELENDCHG    MGDCHG                                     250600 BUG26160
     C**********           MOVELMGDCHG    MFLD                                                250600
     C**********           ELSE                                           CFT013            BUG26160
      *                                                                   CFT013
     C********** CFT013    IFEQ 'Y'                                                  CFT013 BUG26160
     C********** PORTCD    ANDEQ'*CRT103'                                            CFT013 BUG26160
     C********** MGDCHG    ANDEQ*BLANK                                               CFT013 BUG26160
     C           MGDCHG    IFEQ *BLANKS                                                     BUG26160
      *                                                                                     BUG26160
     C           ENDCHG    IFEQ *BLANKS                                                     BUG26160
     C                     MOVEL'BEN'     MGDCHG                                            BUG26160
     C                     ELSE                                                             BUG26160
     C                     MOVELENDCHG    MGDCHG                                            BUG26160
     C                     ENDIF                                                            BUG26160
     C                     ENDIF                                                            BUG26160
     C                     ADD  1         X                               CFT013
     C           X         OCUR MULT                                      CFT013
     C                     MOVEL':71A:'   MTAG                            CFT013
     C                     MOVELMGDCHG    MFLD                                              BUG26160
     C**********           MOVEL'BEN'     MFLD                                         CFT013 219241
     C**********           MOVELENDCHG    MFLD                                       219241 BUG26160
     C**********           MOVELENDCHG    MFLD                                         219241 250600
     C**********           MOVELENDCHG    MGDCHG                                       219241 250600
     C**********           ENDIF                                                     CFT013 BUG26160
      *                                                                   CFT013
     C**********           END                                                              BUG26160
      *
     C/COPY WNCPYSRC,MG0100C042
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   FMT72 - format field :72:                                   *
      *   Called by - main process                                    *
      *   Calls     -                                                 *
      *****************************************************************
      *
     C           FMT72     BEGSR
     C           MGBTB1    IFNE *BLANKS
     C           MGBTB2    ORNE *BLANKS
     C           MGBTB3    ORNE *BLANKS
     C           MGBTB4    ORNE *BLANKS
     C           MGBTB5    ORNE *BLANKS
     C           MGBTB6    ORNE *BLANKS
     C           MGOTRC    ORNE *BLANKS                                   CEU003
      *
      **  Format :72: Sender to receiver information
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE ':72: '   MTAG
     C                     MOVE *BLANKS   BTBI
     C                     MOVE *BLANKS   BTBO
      *
     C/COPY WNCPYSRC,MG0100C040
      **  Ignore beneficiary accounts except CHAPS not output in :57:
     C                     MOVE MGBTB1    @BTB
     C           @BT1      IFNE '/BEN/'
     C           @BT1      OREQ '/BEN/'
     C           @BT2      ANDEQ'/SC'
     C           @BT4      ANDNEMGAWBA
     C                     MOVE MGBTB1    BTBI,1
     C                     MOVE MGBTB2    BTBI,2
     C                     MOVE MGBTB3    BTBI,3
     C                     MOVE MGBTB4    BTBI,4
     C                     MOVE MGBTB5    BTBI,5
     C                     MOVE MGBTB6    BTBI,6
      *
     C                     ELSE
     C                     MOVE MGBTB2    BTBI,1
     C                     MOVE MGBTB3    BTBI,2
     C                     MOVE MGBTB4    BTBI,3
     C                     MOVE MGBTB5    BTBI,4
     C                     MOVE MGBTB6    BTBI,5
     C                     END
      *
     C/COPY WNCPYSRC,MG0100C041
      **  Set input and output counters to first line
     C                     Z-ADD1         A       10
     C                     Z-ADD1         Y       10
      *
      **  Set up Bank to Bank fields 1 - 6
     C           A         DOWLT7
     C           Y         ANDLT7
      *
      ****Check*for intermediary bank                                     S01412
     C                     MOVE BTBI,A    @BTB
     C********** @BT1      IFEQ '/IBK/'                                   S01412
      **********                                                          S01412
      ****account on next line                                            S01412
     C********** BSLSH     IFEQ '/'                                       S01412
     C**********           MOVE @BTB      BTBO,Y                          S01412
     C**********           ADD  1         A                               S01412
     C**********           ADD  1         Y                               S01412
     C**********           MOVE BTBI,A    @BTB                            S01412
      **********                                                          S01412
      ****expand account                                                  S01412
     C**********           MOVE *BLANKS   @KEY1                           S01412
     C**********           MOVELBCNO1     @KEY1                           S01412
     C**********           CALL 'AOCUSTR0'                                S01412
     C**********           PARM *BLANKS   @RTCD   7                       S01412
     C**********           PARM '*KEY'    @OPTN   7                       S01412
     C**********           PARM           @KEY1  10                       S01412
     C**********           PARM *BLANKS   @KYST   7                       S01412
     C********** SDCUST    PARM SDCUST    DSSDY                           S01412
      **********                                                          S01412
      ***Customer record not found on file                                S01412
      **********                                                          S01412
     C********** @RTCD     IFEQ *BLANKS                                   S01412
     C**********           MOVE *BLANKS   BOUT                            S01412
     C**********           MOVEL'//'      BOUT                            S01412
     C**********           MOVELBBCRNM    OUT1                            S01412
     C**********           MOVE BOUT      BTBO,Y                          S01412
     C**********           ADD  1         Y                               S01412
     C**********           MOVE *BLANKS   BOUT                            S01412
     C**********           MOVEL'//'      BOUT                            S01412
     C**********           MOVELBBCRTN    OUT1                            S01412
     C**********           MOVE BOUT      BTBO,Y                          S01412
      **********                                                          S01412
     C**********           ELSE                                           S01412
     C**********           MOVE *BLANKS   @CNCD                           S01412
     C**********           MOVELBCNO1     @CNCD                           S01412
      **********                                                          S01412
      ***Access*counterparty nostro file.                                 S01412
      **********                                                          S01412
     C**********           CALL 'AOCNSTR0'                                S01412
     C**********           PARM *BLANKS   @RTCD   7                       S01412
     C**********           PARM '*KEY'    @OPTN   7                       S01412
     C**********           PARM           @CNCD   8                       S01412
     C********** SDCNST    PARM SDCNST    DSFDY                           S01412
      **********                                                          S01412
      ***Record*not found on file.                                        S01412
      **********                                                          S01412
     C********** @RTCD     IFEQ *BLANKS                                   S01412
     C**********           MOVE *BLANKS   BOUT                            S01412
     C**********           MOVEL'//'      BOUT                            S01412
     C**********           MOVELAWCPNM    OUT1                            S01412
     C**********           MOVE BOUT      BTBO,Y                          S01412
     C**********           ADD  1         Y                               S01412
     C**********           MOVE *BLANKS   BOUT                            S01412
     C**********           MOVEL'//'      BOUT                            S01412
     C**********           MOVELAWCNTN    OUT1                            S01412
     C**********           MOVE BOUT      BTBO,Y                          S01412
      **********                                                          S01412
     C**********           ELSE                                           S01412
     C**********           MOVELBCNO1     MFLD                            S01412
     C**********           MOVELMSGA,3    MERR                            S01412
     C**********           MOVE 'Y'       @ERR                            S01412
     C**********           END                                            S01412
     C**********           END                                            S01412
      **********                                                          S01412
      ****account on this line                                            S01412
     C**********           ELSE                                           S01412
     C**********           MOVE @BTB      BOUT                            S01412
      **********                                                          S01412
      ****expand account                                                  S01412
     C**********           MOVE *BLANKS   @KEY1                           S01412
     C**********           MOVELBCNO2     @KEY1                           S01412
     C**********           CALL 'AOCUSTR0'                                S01412
     C**********           PARM *BLANKS   @RTCD   7                       S01412
     C**********           PARM '*KEY'    @OPTN   7                       S01412
     C**********           PARM           @KEY1  10                       S01412
     C**********           PARM *BLANKS   @KYST   7                       S01412
     C********** SDCUST    PARM SDCUST    DSSDY                           S01412
      **********                                                          S01412
      ***Customer Record not found.                                       S01412
      **********                                                          S01412
     C********** @RTCD     IFEQ *BLANKS                                   S01412
     C**********           MOVE *BLANKS   OUT2                            S01412
     C**********           MOVELBBCRNM    OUT2                            S01412
     C**********           MOVE BOUT      BTBO,Y                          S01412
     C**********           ADD  1         Y                               S01412
     C**********           MOVE *BLANKS   BOUT                            S01412
     C**********           MOVEL'//'      BOUT                            S01412
     C**********           MOVELBBCRTN    OUT1                            S01412
     C**********           MOVE BOUT      BTBO,Y                          S01412
      **********                                                          S01412
     C**********           ELSE                                           S01412
     C**********           MOVE *BLANKS   @CNCD                           S01412
     C**********           MOVELBCNO2     @CNCD                           S01412
      **********                                                          S01412
      ***Access*Counterparty Nostro file.                                 S01412
      **********                                                          S01412
     C**********           CALL 'AOCNSTR0'                                S01412
     C**********           PARM *BLANKS   @RTCD   7                       S01412
     C**********           PARM '*KEY'    @OPTN   7                       S01412
     C**********           PARM           @CNCD   8                       S01412
     C********** SDCNST    PARM SDCNST    DSFDY                           S01412
      **********                                                          S01412
     C********** @RTCD     IFEQ *BLANKS                                   S01412
     C**********           MOVE *BLANKS   OUT2                            S01412
     C**********           MOVELAWCPNM    OUT2                            S01412
     C**********           MOVE BOUT      BTBO,Y                          S01412
     C**********           ADD  1         Y                               S01412
     C**********           MOVE *BLANKS   BOUT                            S01412
     C**********           MOVEL'//'      BOUT                            S01412
     C**********           MOVELAWCNTN    OUT1                            S01412
     C**********           MOVE BOUT      BTBO,Y                          S01412
      **********                                                          S01412
      ***Record*not found on file.                                        S01412
      **********                                                          S01412
     C**********           ELSE                                           S01412
     C**********           MOVELBCNO2     MFLD                            S01412
     C**********           MOVELMSGA,9    MERR                            S01412
     C**********           MOVE 'Y'       @ERR                            S01412
     C**********           END                                            S01412
     C**********           END                                            S01412
     C**********           END                                            S01412
      **********                                                          S01412
     C**********           ELSE                                           S01412
     C                     MOVE @BTB      BTBO,Y
     C**********           END                                            S01412
      *
     C                     ADD  1         A
     C                     ADD  1         Y
     C                     END
      *
     C           CEU003    IFEQ 'Y'                                       144710
     C           MGOTRC    ANDNE*BLANKS                                   144710
      *                                                                   144710
      **  Format the amount according to Swift specifications             144710
      *                                                                   144710
     C                     MOVE MGOTRC    ZCCY                            144710
     C                     MOVE MGOTRA    ZAMNT                           144710
     C                     CALL 'ZM0040'               15                 144710
     C                     PARM           ZAMNT  130                      144710
     C                     PARM           ZCCY    3                       144710
     C                     PARM           ZSAMNT                          144710
     C                     PARM           ZSCCY   3                       144710
     C                     PARM           ZERR    1                       144710
     C                     PARM           ZSWDPC                                              222373
      *                                                                   144710
      **  Call ended in error (program not found)                         144710
      *                                                                   144710
     C           *IN15     IFEQ '1'                                       144710
     C           *LOCK     IN   LDA                                       144710
     C                     MOVE '015'     DBASE            * * * * * * * *144710
     C                     MOVEL'       ' DBKEY            *  DBERR 015  *144710
     C                     MOVEL'ZM0040'  DBFILE           * * * * * * * *144710
     C                     OUT  LDA                                       144710
     C                     EXSR *PSSR                                     144710
     C                     ENDIF                                          144710
      *                                                                   144710
     C                     MOVEL'/OCMT/'  WTFLD1  6                       144710
     C                     MOVE *BLANKS   WMFLD2 24                       145304
     C                     MOVEA*BLANKS   @STR                            145304
     C                     Z-ADD1         N       20                      145304
      *                                                                   144710
      ** Error - indicate erroneous fields;                               144710
      *                                                                   144710
     C           ZERR      IFEQ '1'                                       144710
     C                     MOVE 'Y'       @ERR                            144710
     C                     MOVELMSGA,4    MERR                            144710
     C                     MOVE MGOTRC    ZCCY                            144710
     C                     MOVE MGOTRA    ZAMT                            144710
     C           WTFLD1    CAT  ERR3N     MFLD                            144710
     C                     ELSE                                           144710
     C           WTFLD1    CAT  ZSCCY     WMFLD1  9                       144710
     C********** WMFLD1    CAT  ZSAMNT    MFLD                     144710 145304
     C           WMFLD1    CAT  ZSAMNT    WMFLD2                          145304
     C                     MOVEAWMFLD2    @STR                            145304
     C           ' '       LOKUP@STR,N                   60               145304
     C                     MOVEA'/'       @STR,N                          145304
     C                     MOVEA@STR      MFLD                            145304
     C                     ENDIF                                          144710
      *                                                                   144710
     C           MFLD      IFNE *BLANK                                    144710
     C                     ADD  1         X                               144710
     C           X         OCUR MULT                                      144710
     C                     ENDIF                                          144710
      *                                                                   144710
     C                     ENDIF                                          144710
      *                                                                   144710
      **  Write all non blank bank to bank lines
     C                     MOVELBTBO,1    MFLD
     C           MFLD      IFNE *BLANK
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
      *
     C                     MOVELBTBO,2    MFLD
     C           MFLD      IFNE *BLANK
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
      *
     C                     MOVELBTBO,3    MFLD
     C           MFLD      IFNE *BLANK
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
      *
     C                     MOVELBTBO,4    MFLD
     C           MFLD      IFNE *BLANK
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
      *
     C                     MOVELBTBO,5    MFLD
     C           MFLD      IFNE *BLANK
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
      *
     C                     MOVELBTBO,6    MFLD
     C           MFLD      IFNE *BLANK
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
      *
     C***********CEU003    IFEQ 'Y'                                CEU003 144710
     C***********MGOTRC    ANDNE*BLANKS                            CEU003 144710
     C***********                                                  CEU003 144710
     C****Format*the*amount*according*to*Swift*specifications*     CEU003 144710
     C***********                                                  CEU003 144710
     C***********          MOVE MGOTRC    ZCCY                     CEU003 144710
     C***********          MOVE MGOTRA    ZAMNT                    CEU003 144710
     C***********          CALL 'ZM0040'               15          CEU003 144710
     C***********          PARM           ZAMNT  130               CEU003 144710
     C***********          PARM           ZCCY    3                CEU003 144710
     C***********          PARM           ZSAMNT                   CEU003 144710
     C***********          PARM           ZSCCY   3                CEU003 144710
     C***********          PARM           ZERR    1                CEU003 144710
     C***********                                                  CEU003 144710
     C****Call*ended*in*error*(program*not*found)*                 CEU003 144710
     C***********                                                  CEU003 144710
     C************IN15     IFEQ '1'                                CEU003 144710
     C************LOCK     IN   LDA                                CEU003 144710
     C***********          MOVE '015'     DBASE     * * * * * * * *CEU003 144710
     C***********          MOVEL'       ' DBKEY     *  DBERR 015  *CEU003 144710
     C***********          MOVEL'ZM0040'  DBFILE    * * * * * * * *CEU003 144710
     C***********          OUT  LDA                                CEU003 144710
     C***********          EXSR *PSSR                              CEU003 144710
     C***********          ENDIF                                   CEU003 144710
     C***********                                                  CEU003 144710
     C***Error*-*indicate*erroneous*fields;*                       CEU003 144710
     C***********                                                  CEU003 144710
     C***********          MOVEL'/OCMT/'  WTFLD1  6                CEU003 144710
     C***********ZERR      IFEQ '1'                                CEU003 144710
     C***********          MOVE 'Y'       @ERR                     CEU003 144710
     C***********          MOVE MGOTRA    ZAMT                     CEU003 144710
     C***********          MOVE MGOTRC    ZCCY                     CEU003 144710
     C***********WTFLD1    CAT  MGOTRC    WMFLD1  9                CEU003 144710
     C***********WMFLD1    CAT  ZSAMNT    MFLD                     CEU003 144710
     C***********          MOVELMSGA,4    MERR                     CEU003 144710
      ***********                                                  CEU003 144710
     C***********          ELSE                                    CEU003 144710
     C***********WTFLD1    CAT  MGOTRC    WMFLD1  9                CEU003 144710
     C***********WMFLD1    CAT  ZSAMNT    MFLD                     CEU003 144710
     C***********          ENDIF                                   CEU003 144710
     C***********MFLD      IFNE *BLANK                             CEU003 144710
     C***********          ADD  1         X                        CEU003 144710
     C***********X         OCUR MULT                               CEU003 144710
     C***********          ENDIF                                   CEU003 144710
     C***********          ENDIF                                   CEU003 144710
     C                     END
      *
     C                     ENDSR
     C/COPY WNCPYSRC,MG0100C029
     C/EJECT
      *****************************************************************
      *   REPT - print incorrectly generated messages                 *
      *   Called by - main process                                    *
      *   Calls     -                                                 *
      *****************************************************************
      *
     C           REPT      BEGSR
      *
      ** If MG0100P1 has not previously opened.
      *
     C           *IN50     IFEQ '0'
     C                     OPEN MG0100P1
     C                     SETON                     50                   084320
     C************         SETON                     50U7                 084320
     C                     END
      *                                                                   CFT013
     C           CFT013    IFEQ 'Y'                                       CFT013
     C           PORTCD    ANDEQ'*CRT103'                                 CFT013
     C                     MOVE *ON       *IN09                           CFT013
     C                     ELSE                                           CFT013
     C                     MOVE *OFF      *IN09                           CFT013
     C                     ENDIF                                          CFT013
      *
     C                     WRITEHEADER
     C                     WRITETEXT
      *
      **  Process multiple occurrence data structure
      *
     C                     Z-ADD0         I       20
     C           I         DOWLEX
     C                     ADD  1         I
     C           I         OCUR MULT
     C                     WRITELINE
     C                     END
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   OMSG - output correctly generated messages                  *
      *   Called by - main process                                    *
      *   Calls     - WREF - Write reference record to PF/MGOREFPD    *
      *****************************************************************
      *
     C           OMSG      BEGSR
      *
      ** Write reference record to PF/MGOREFPD.
      *
     C                     EXSR WREF
     C/COPY WNCPYSRC,MGH00003
      *                                                                   CFT013
      ** If message to be created is a MT103, write additional msg.       CFT013
      *                                                                   CFT013
     C           CFT013    IFEQ 'Y'                                       CFT013
     C           PORTCD    ANDEQ'*CRT103'                                 CFT013
     C           AIND,1    ANDEQ'Y'                                       CFT013
     C           AIND,2    ANDEQ'Y'                                       CFT013
     C           AIND,3    ANDEQ'Y'                                       CFT013
     C           AIND,4    ANDEQ'Y'                                       CFT013
     C           AIND,5    ANDEQ'Y'                                       CFT013
     C           AIND,6    ANDEQ'Y'                                       CFT013
     C           AIND,7    ANDEQ'Y'                                       CFT013
     C           AIND,8    ANDEQ'Y'                                       CFT013
     C           AIND,9    ANDEQ'Y'                                                           208890
     C********** WKIBAR    ANDEQ'Y'                                                  CSW213 MD022039
     C                     ADD  1         X                               CFT013
     C           X         OCUR MULT                                      CFT013
     C                     MOVEL':119:'   MTAG                            CFT013
     C                     MOVEL*BLANK    MFLD                            CFT013
     C                     MOVEL'STP'     MFLD                            CFT013
     C                     WRITEMGOMSGD0               06                 CFT013
     C                     MOVEL*BLANK    MTAG                            CFT013
     C                     MOVEL*BLANK    MFLD                            CFT013
     C           *IN06     IFEQ *ON                                       CFT013
     C           *LOCK     IN   LDA                                       CFT013
     C                     Z-ADD30        DBASE                           CFT013
     C                     MOVEL'*WRITE ' DBKEY                           CFT013
     C                     MOVEL'MGOMSGPD'DBFILE                          CFT013
     C                     OUT  LDA                                       CFT013
     C                     EXSR *PSSR                                     CFT013
     C                     ENDIF                                          CFT013
     C                     ENDIF                                          CFT013
      *                                                                                       CSW218
      ** Field :121: - UETR (Unique End-to-end Transaction Reference)                         CSW218
      *                                                                                       CSW218
     C           CSW218    IFEQ 'Y'                                                           CSW218
     C                     CALL UIDPGM                                                        CSW218
     C                     PARM *BLANKS   PUUID  50                                           CSW218
     C                     ADD  1         X                                                   CSW218
     C           X         OCUR MULT                                                          CSW218
     C                     MOVEL':121:'   MTAG                                                CSW218
     C                     MOVEL*BLANK    MFLD                                                CSW218
     C                     MOVELPUUID     MFLD                                                CSW218
     C                     WRITEMGOMSGD0               06                                     CSW218
     C                     MOVEL*BLANK    MTAG                                                CSW218
     C                     MOVEL*BLANK    MFLD                                                CSW218
     C           *IN06     IFEQ *ON                                                           CSW218
     C           *LOCK     IN   LDA                                                           CSW218
     C                     Z-ADD42        DBASE                                               CSW218
     C                     MOVEL'*WRITE ' DBKEY                                               CSW218
     C                     MOVEL'MGOMSGPD'DBFILE                                              CSW218
     C                     OUT  LDA                                                           CSW218
     C                     EXSR *PSSR                                                         CSW218
     C                     ENDIF                                                              CSW218
     C                     ENDIF                                                              CSW218
      *
      **  Write multiple occurrence data structure to MGOMSGPD
      *
     C                     Z-ADD1         X       30
     C           X         OCUR MULT
     C           X         DOWLE200                                   1
     C           MFLD      ANDNE*BLANKS
     C/COPY WNCPYSRC,MG0100C020
     C                     WRITEMGOMSGD0               06
      *
      **  Error on write to PF/MGOMSGPD (message data file)
      *
     C           *IN06     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '007'     DBASE              * * * * * * *
     C                     MOVEL'       ' DBKEY              * DBERR 007 *
     C                     MOVEL'MGOMSGPD'DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END                                       E1
      *                                                                   183583
      ** Write multiple occurrence data structure to MGOEXTPD             183583
      *                                                                   183583
     C                     Z-ADD1         V       20                      183583
     C           V         OCUR EXTN                                      183583
     C           V         DOWLE20                                        183583
     C           MCSI      ANDNE*BLANKS                                   183583
     C                     WRITEMGOEXTD0               06                 183583
      *                                                                   183583
      ** Error on write to PF/MGOEXTPD (message data extension file)      183583
      *                                                                   183583
     C           *IN06     IFEQ '1'                                       183583
     C           *LOCK     IN   LDA                                       183583
     C                     MOVE '023'     DBASE            ************** 183583
     C                     MOVEL'        'DBKEY            * DBERROR 23 * 183583
     C                     MOVEL'MGOEXTPD'DBFILE           ************** 183583
     C                     OUT  LDA                                       183583
     C                     EXSR *PSSR                                     183583
     C                     ENDIF                                          183583
     C                     ADD  1         V                               183583
     C           V         OCUR EXTN                                      183583
     C                     ENDDO                                          183583
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   WREF - Write reference record to PF/MGOREFPD                *
      *   Called by - OMSG  output message PF/MGOMSGPD                *
      *   Calls     -                                                 *
      *****************************************************************
      *
     C           WREF      BEGSR
      *
     C                     MOVE *BLANKS   SYTM
     C                     MOVE @TRNA     TRNO
     C                     MOVE *BLANKS   TRNF
     C                     MOVE *BLANKS   TRNM
     C                     MOVE MGAMTP    EVTP                            E29588
     C                     Z-ADDMGAVDT    AVDT                            E29588
     C                     Z-ADDMGASEQ    ASEQ                            E29588
     C           CFT013    IFEQ 'Y'                                       CFT013
     C           PORTCD    ANDEQ'*CRT103'                                 CFT013
     C                     MOVEL'103'     MTPY                            CFT013
     C                     ELSE                                           CFT013
     C                     MOVE '100'     MTPY
     C                     ENDIF                                          CFT013
     C***********          MOVE 'N'       MPRY                            138742
     C                     MOVEL*BLANKS   PTST
     C                     MOVEL*BLANKS   CARQ
     C                     MOVEL*BLANKS   MPDE
     C/COPY WNCPYSRC,MG0100C023
     C*
     C** Use value date to calculate retention.                           060980
     C*                                                                   060980
     C           MGVDAT    ADD  ENDSMN    ZMDAY                           060980
     C                     CALL 'ZM0060'               15                 060980
     C                     PARM           ZMDAY                           060980
     C                     PARM           ZSDATE                          060980
     C*                                                                   060980
     C** If the program ends in error.                                    060980
     C*                                                                   060980
     C           *IN15     IFEQ '1'                                       060980
     C           *LOCK     IN   LDA                                       060980
     C                     MOVE '006'     DBASE              * * * * * * *060980
     C                     MOVEL'       ' DBKEY              * DBERR 006 *060980
     C                     MOVEL'ZM0060'  DBFILE             * * * * * * *060980
     C                     OUT  LDA                                       060980
     C                     EXSR *PSSR                                     060980
     C                     END                                            060980
     C                     MOVE ZSDATE    @HRDT   6                       060980
     C                     MOVEL@HRDT     HRDT
     C                     TIME           MGTM
     C                     MOVE BJMRDT    LADT
     C                     MOVE MGTM      LATM
     C*                                                                   S01408
     C/COPY WNCPYSRC,MG0100CCP3                                           S01408
     C*                                                                   S01408
      *
      ** If Watch List Checking (CSD015) is applied and                                       CSD015
      ** Midas Message Manager is not applied (CSW025)                                        CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           222385
     C           CSW025    ANDEQ'N'                                                           CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           MGST      IFEQ 'CRTD'
     C                     MOVE '1'       MGSG
     C                     END
     C           MGST      IFEQ 'RSND'
     C                     MOVE BJMRDT    RELD
     C                     MOVE MGTM      RELT
     C                     MOVE '2'       MGSG
     C                     END
     C           MGST      IFEQ 'PRTD'
     C                     MOVE '3'       MGSG
     C                     END
      *
     C/COPY WNCPYSRC,MG0100C012
     C                     MOVEL*BLANKS   RUSR
     C                     MOVEL*BLANKS   RWSN
     C*********************MOVEL*BLANKS   AMTS                            E35632
     C***********          MOVELZSAMNT    AMTS                     E35632 144171
     C                     MOVELSAMNT     AMTS                            144171
     C                     MOVEL*BLANKS   AMTX
     C*********************MOVEL*BLANKS   SVDT                            E29588
      *                                                                   E29588
      **  Format value date to YYMMDD format                              E29588
     C/COPY WNCPYSRC,MG0100C006
      *                                                                                       CDL099
      ** Only check for SVD if FX/MM                                                          CDL099
      *                                                                                       CDL099
     C           MGMODI    IFEQ 'DL'                                                          CDL099
     C           CDL099    ANDEQ'Y'                                                           CDL099
     C                     Z-ADDMGVDAT    ULVDT   50                                          CDL099
     C                     MOVELMGTNUM    KYDLNO                                              CDL099
     C           KYDLNO    CHAINDEALS                40                                       CDL099
     C           *IN40     IFEQ '0'                                                         MD050972
     C           BSDT2     ANDNE0                                                           MD050972
     C                     MOVE BSDT2     MGVDAT                                              CDL099
     C                     ENDIF                                                            MD050972
     C                     ENDIF                                                              CDL099
      *                                                                                       CDL099
     C                     CALL 'ZM0060'               15                 E29588
     C                     PARM MGVDAT    ZMDAY   50                      E29588
     C                     PARM           ZMDATE  6                       E29588
     C/COPY WNCPYSRC,MG0100C007
      *                                                                                       CDL099
      ** Only check for SVD if FX/MM                                                          CDL099
      *                                                                                       CDL099
     C           MGMODI    IFEQ 'DL'                                                          CDL099
     C           CDL099    ANDEQ'Y'                                                           CDL099
     C                     Z-ADDULVDT     MGVDAT                                              CDL099
     C                     ENDIF                                                              CDL099
      *                                                                   E29588
     C           *IN15     IFEQ '1'                                       E29588
     C           *LOCK     IN   LDA                                       E29588
     C                     MOVE '014'     DBASE            * * * * * * * *E29588
     C                     MOVEL'       ' DBKEY            *  DBERR 014  *E29588
     C                     MOVEL'ZM0060'  DBFILE           * * * * * * * *E29588
     C                     OUT  LDA                                       E29588
     C                     EXSR *PSSR                                     E29588
     C                     END                                            E29588
      *                                                                   E29588
     C                     MOVELZMDATE    SVDT                            E29588
      *                                                                   141572
      ** Setup century indicator CINDV for value date SVDT                141572
     C           SVDT      IFEQ *BLANK                                    141572
     C                     MOVE *BLANK    CINDV                           141572
     C                     ELSE                                           141572
     C                     MOVELSVDT      YY      20                      141572
     C           YY        IFLT 72                                        141572
     C                     MOVE '2'       CINDV                           141572
     C                     ELSE                                           141572
     C                     MOVE '1'       CINDV                           141572
     C                     ENDIF                                          141572
     C                     ENDIF                                          141572
      *                                                                   141572
     C                     MOVEL*BLANKS   SACN
     C                     MOVEL*BLANKS   AORR
     C                     MOVEL*BLANKS   DESI
      *
      **  Branch details
      *
     C/COPY WNCPYSRC,MG0100C008
     C                     MOVE MGPOBR    BRCA
     C/COPY WNCPYSRC,MG0100C009
     C                     MOVE MGBRCA    OTHB
     C           OTHB      IFNE *BLANKS
     C                     MOVELMSGA,1    OTHT
     C                     END
      *
     C                     MOVE *BLANKS   NETI
     C***********          MOVE *BLANKS   DELC                            138742
     C                     MOVE *BLANKS   DYST
     C                     MOVE *BLANKS   RSID
     C                     MOVE *BLANKS   MSE1
     C                     MOVE *BLANKS   ELIN
     C                     MOVE *BLANKS   SSAC
     C                     MOVE *BLANKS   MIR
     C***********          MOVE *BLANKS   TSKS                            095141
     C                     MOVE 'Y'       TSKS                            095141
     C                     MOVE *BLANKS   TSKY
     C                     MOVE MGCHTP    AORR                                                CSW025
     C           INTMSG    IFEQ 'I'                                                          BUG6076
     C           MGCHTP    IFEQ 'A'                                                          BUG6076
     C                     MOVE 'T'       AORR                                               BUG6076
     C                     ENDIF                                                             BUG6076
     C           MGCHTP    IFEQ 'I'                                                          BUG6076
     C                     MOVE 'P'       AORR                                               BUG6076
     C                     ENDIF                                                             BUG6076
     C                     ENDIF                                                             BUG6076
     C*                                                                   S01408
     C/COPY WNCPYSRC,MG0100CCP1                                           S01408
     C*                                                                   S01408
      *
     C                     WRITEMGOREFD0               05
      *
      **  Error on write to PF/MGOREFPD (message reference file)
      *
     C           *IN05     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '013'     DBASE              * * * * * * *
     C                     MOVEL'       ' DBKEY              * DBERR 013 *
     C                     MOVEL'MGOREFPD'DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C/COPY WNCPYSRC,MG0100C001
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      ****NWAD*-*determine*default*network*addresses*******************   CSW096
      ****Called*by*-*ROUT*determine*message*routing*******************   CSW096
      ****Calls*******-************************************************   CSW096
      *****************************************************************   CSW096
      ***********                                                         CSW096
     C***********NWAD      BEGSR                                          CSW096
      ***********                                                         CSW096
      ****Default*is*SWIFT************************************************CSW096
      ***********                                                         CSW096
     C***********BBDNW1    IFEQ 'SWIFT'                                   CSW096
     C***********BBCSID    ANDNE*BLANKS                                   CSW096
     C***********@BIC      ANDNE'BIC'                                     CSW096
     C***********BGMSDL    ANDEQ'Y'                                       CSW096
     C***********          MOVELSCSID     NWSN                            CSW096
     C***********          MOVELBBCSID    NWDS                            CSW096
     C***********          MOVELBBDNW1    NWRK                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****Default*is*TELEX************************************************CSW096
      ***********                                                         CSW096
     C***********BBDNW1    IFEQ 'TELEX'                                   CSW096
     C***********BBTXA1    ANDNE*BLANKS                                   CSW096
     C***********BGMTMI    ANDEQ'Y'                                       CSW096
     C***********          MOVELSTELX     NWSN                            CSW096
     C***********          MOVELBBTXA1    NWDS                            CSW096
     C***********          MOVELBBDNW1    NWRK                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****Default*is*STTX*************************************************CSW096
      ***********                                                         CSW096
     C***********BBDNW1    IFEQ 'STTX'                                    CSW096
     C***********BBSTAD    ANDNE*BLANKS                                   CSW096
     C***********BGMSDL    ANDEQ'Y'                                       CSW096
     C***********          MOVELSSTTX     NWSN                            CSW096
     C***********          MOVELBBSTAD    NWDS                            CSW096
     C***********          MOVELBBDNW1    NWRK                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****Default*is*PAPER************************************************CSW096
      ***********                                                         CSW096
     C***********BBDNW1    IFEQ 'PAPER'                                   CSW096
     C***********          MOVELSCRNM     NWSN                            CSW096
     C***********          MOVELBBCRNM    NWDS                            CSW096
     C***********          MOVELBBDNW1    NWRK                            CSW096
      ***********                                                         CSW096
      ***********                                                         CSW096
      ****If*the*ICD*option*for*free*format*advice*is*'Y',****************CSW096
      ****the*message*has*already*been*printed*,*hence*no*further*********CSW096
      ****print*out*is*needed.********************************************CSW096
     C***********ENFFAR    IFEQ 'Y'                                       CSW096
     C***********          MOVEL'PRTD'    MGST                            CSW096
     C***********          MOVE '3'       MGSG                            CSW096
     C***********          ELSE                                           CSW096
     C***********          MOVEL'RSND'    MGST                            CSW096
     C***********          MOVE '2'       MGSG                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****Found*to*be*unroutable******************************************CSW096
      ***********                                                         CSW096
     C***********NWRK      IFEQ *BLANKS                                   CSW096
     C***********NWDS      OREQ *BLANKS                                   CSW096
     C***********NWSN      OREQ *BLANKS                                   CSW096
     C***********          MOVEL'UNROUT'  NWRK                            CSW096
     C***********          MOVELSCRNM     NWSN                            CSW096
     C***********          MOVELBBCRNM    NWDS                            CSW096
     C***********          MOVEL'CRTD'    MGST                            CSW096
     C***********          MOVE '1'       MGSG                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          ENDSR                                          CSW096
     C*/EJECT****                                                         CSW096
      ********************************************************************CSW096
      ****PRAD*-*determine*priority*network*addresses*********************CSW096
      ****Called*by*-*ROUT*determine*message*routing**********************CSW096
      ********************************************************************CSW096
      ***********                                                         CSW096
     C***********PRAD      BEGSR                                          CSW096
      ***********                                                         CSW096
      ****Set*up*priority*sender,*destination*&*network*******************CSW096
      ***********                                                         CSW096
      ***********        (1)  (2)  (3)  (4)  (5)  (6)  (7)                CSW096
      ***********------------------------------------------               CSW096
      ****SWIFT*ADDRESS  Y   N   N   Y   Y   Y   Y                CSW096
      ****TELEX*ADDRESS  N   Y   N   Y   Y   N   N                CSW096
      ****STTX*ADDRESS   N   N   Y   N   N   Y   Y                CSW096
      ****SETT.*TYPE                01  08  01  08                CSW096
      ***********------------------------------------------               CSW096
      ****DESTN*= CSID   X               X       X                CSW096
      ****DESTN*= TELX       X       X                            CSW096
      ****DESTN*= STTX           X           X                    CSW096
      ***********------------------------------------------               CSW096
      ****MESSAGE ROUTE                                           CSW096
      ****CODE*(SWTX)    S   T   X   T   S   X   S                CSW096
      ***********                                                         CSW096
      ****SWIFT*?*********************************************************CSW096
      ****(1)*************************************************************CSW096
     C***********BGMSDL    IFEQ 'Y'                                       CSW096
     C***********SCSID     ANDNE*BLANKS                            E27567 CSW096
      ***********                                                         CSW096
     C***********BBCSID    IFNE *BLANKS                                   CSW096
     C***********BBTXA1    ANDEQ*BLANKS                                   CSW096
     C***********BBSTAD    ANDEQ*BLANKS                                   CSW096
      ****(5)*************************************************************CSW096
     C***********BBCSID    ORNE *BLANKS                                   CSW096
     C***********BBTXA1    ANDNE*BLANKS                                   CSW096
     C***********BBSTAD    ANDEQ*BLANKS                                   CSW096
     C***********MGSETP    ANDEQ08                                        CSW096
      ****(7)*************************************************************CSW096
     C***********BBCSID    ORNE *BLANKS                                   CSW096
     C***********BBTXA1    ANDEQ*BLANKS                                   CSW096
     C***********BBSTAD    ANDNE*BLANKS                                   CSW096
     C***********MGSETP    ANDEQ08                                        CSW096
      ***********                                                         CSW096
     C***********          MOVELSCSID     NWSN                            CSW096
     C***********          MOVELBBCSID    NWDS                            CSW096
     C***********          MOVE 'SWIFT '  NWRK                            CSW096
     C***********          END                                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****TELEX*?*********************************************************CSW096
      ****(2)*************************************************************CSW096
     C***********BGMTMI    IFEQ 'Y'                                       CSW096
     C***********STELX     ANDNE*BLANKS                            E27567 CSW096
      ***********                                                         CSW096
     C***********BBCSID    IFEQ *BLANKS                                   CSW096
     C***********BBTXA1    ANDNE*BLANKS                                   CSW096
     C***********BBSTAD    ANDEQ*BLANKS                                   CSW096
      ****(4)*************************************************************CSW096
     C***********BBCSID    ORNE *BLANKS                                   CSW096
     C***********BBTXA1    ANDNE*BLANKS                                   CSW096
     C***********BBSTAD    ANDEQ*BLANKS                                   CSW096
     C***********MGSETP    ANDEQ01                                        CSW096
      ***********                                                         CSW096
     C***********          MOVELSTELX     NWSN                            CSW096
     C***********          MOVELBBTXA1    NWDS                            CSW096
     C***********          MOVE 'TELEX '  NWRK                            CSW096
     C***********          END                                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****STTX*?**********************************************************CSW096
      ****(3)*************************************************************CSW096
     C***********BGMSDL    IFEQ 'Y'                                       CSW096
     C***********SSTTX     ANDNE*BLANKS                            E27567 CSW096
      ***********                                                         CSW096
     C***********BBCSID    IFEQ *BLANKS                                   CSW096
     C***********BBTXA1    ANDEQ*BLANKS                                   CSW096
     C***********BBSTAD    ANDNE*BLANKS                                   CSW096
      ****(6)*************************************************************CSW096
     C***********BBCSID    ORNE *BLANKS                                   CSW096
     C***********BBTXA1    ANDEQ*BLANKS                                   CSW096
     C***********BBSTAD    ANDNE*BLANKS                                   CSW096
     C***********MGSETP    ANDEQ01                                        CSW096
      ***********                                                         CSW096
     C***********          MOVELSSTTX     NWSN                            CSW096
     C***********          MOVELBBSTAD    NWDS                            CSW096
     C***********          MOVE 'STTX  '  NWRK                            CSW096
     C***********          END                                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****If*network*is*SWIFT*and*if*positions*9-11*of*the****************CSW096
      ****SWIFT*address*are*equal*to*'BIC'********************************CSW096
      ****try*to*route*the*message*via*Telex*or*STTX**********************CSW096
      ***********                                                         CSW096
     C***********NWRK      IFEQ 'SWIFT '                                  CSW096
     C***********@BIC      ANDEQ'BIC'                                     CSW096
      ***********                                                         CSW096
     C***********          MOVE *BLANKS   NWSN                            CSW096
     C***********          MOVE *BLANKS   NWDS                            CSW096
      ***********                                                         CSW096
     C***********BGMTMI    IFEQ 'Y'                                       CSW096
     C***********BBTXA1    ANDNE*BLANKS                                   CSW096
     C***********STELX     ANDNE*BLANKS                            E27567 CSW096
     C***********          MOVELSTELX     NWSN                            CSW096
     C***********          MOVELBBTXA1    NWDS                            CSW096
     C***********          MOVEL'TELEX '  NWRK                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********BGMSDL    IFEQ 'Y'                                       CSW096
     C***********BBSTAD    ANDNE*BLANKS                                   CSW096
     C***********SSTTX     ANDNE*BLANKS                            E27567 CSW096
     C***********          MOVELSSTTX     NWSN                            CSW096
     C***********          MOVELBBSTAD    NWDS                            CSW096
     C***********          MOVE 'STTX  '  NWRK                            CSW096
     C***********          END                                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****If*failed*to*route*to*electronic*network,*produce*paper*********CSW096
      ***********                                                         CSW096
     C***********NWRK      IFEQ *BLANKS                                   CSW096
     C***********NWDS      OREQ *BLANKS                                   CSW096
     C***********NWSN      OREQ *BLANKS                                   CSW096
     C***********          MOVEL'PAPER'   NWRK                            CSW096
     C***********          MOVELSCRNM     NWSN                            CSW096
     C***********          MOVELBBCRNM    NWDS                            CSW096
      ***********                                                         CSW096
      ****If*the*ICD*option*for*free*format*advices*is*'Y'*the************CSW096
      ****message*has*already*been*printed*,*hence*no*further*************CSW096
      ****print*out*is*needed.********************************************CSW096
      ***********                                                         CSW096
     C***********ENFFAR    IFEQ 'Y'                                       CSW096
     C***********          MOVEL'PRTD'    MGST                            CSW096
     C***********          MOVE '3'       MGSG                            CSW096
     C***********          ELSE                                           CSW096
     C***********          MOVEL'RSND'    MGST                            CSW096
     C***********          MOVE '2'       MGSG                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          ENDSR                                          CSW096
     C/EJECT
      *****************************************************************
      *   INTF  - Initialise non-constant fields.                     *
      *   Called by - main process.                                   *
      *   Calls     -                                                 *
      *****************************************************************
      *
     C           INTF      BEGSR
      *
     C                     MOVE *BLANKS   TRNO
     C                     MOVE MGMODI    MODI
     C                     MOVELMGTNUM    MTRN
     C                     MOVE MGTTYP    TNTP
     C                     MOVE MGTSTP    SBTP
     C                     MOVE *BLANKS   NWRK
     C**********           Z-ADD0         SECN                                                CSD027
     C                     MOVE *BLANKS   SECN                                                CSD027
     C                     MOVE *BLANKS   NWSN
     C**********           Z-ADD0         DECN                                                CSD027
     C                     MOVE *BLANKS   DECN                                                CSD027
     C                     MOVE *BLANKS   NWDS
     C                     MOVELMGBENN    NWBN
     C                     Z-ADD0         MGTM
     C                     Z-ADD0         LATM
     C                     MOVE *BLANKS   RELD
     C                     Z-ADD0         RELT
     C                     MOVE *BLANKS   AMTS
     C                     MOVE *BLANKS   SVDT
     C                     MOVE *BLANKS   CINDV                           141572
     C                     MOVE MGCCY     CCY
     C                     MOVELMGPONS    NSNO
     C                     Z-ADD0         AVDT                            E29588
     C                     Z-ADD0         ASEQ                            E29588
      *
     C                     MOVE *BLANKS   @BTB
     C                     MOVE *BLANKS   SCRNM  20
     C                     MOVE *BLANKS   SCSID  12
     C                     MOVE *BLANKS   STELX  10
     C                     MOVE *BLANKS   SSTTX  12
     C                     MOVE *BLANKS   SPCNB   6
     C                     MOVE *BLANKS   DPCNB   6
     C                     MOVE *BLANKS   @ERR    1
      *
     C/COPY WNCPYSRC,MGH00072
     C                     ENDSR
     C/EJECT
      *****************************************************************   138742
      *   DFLT - GET DEFAULT VALUES FROM SDCURRPD                     *   138742
      *   Called by - main process                                    *   138742
      *   Calls     -                                                 *   138742
      *****************************************************************   138742
     C           DFLT      BEGSR                                          138742
      *                                                                   138742
      *                                                                   138742
     C** Call Access Program for Currency Details                         138742
     C*       to Obtain DEFAULTS                                          138742
     C                     CALL 'AOCURRR0'                                138742
     C                     PARM '*DBERR ' @RTCD                           138742
     C                     PARM '*KEY   ' @OPTN                           138742
     C                     PARM MGCCY     @BKCY   3                       138742
     C           SDCURR    PARM SDCURR    DSSDY                           138742
     C*                                                                   138742
     C           A6DPRU    IFEQ 'Y'                                       138742
     C                     MOVE 'U'       MPRY                            138742
     C                     ELSE                                           138742
     C                     MOVE 'N'       MPRY                            138742
     C                     END                                            138742
     C*                                                                   138742
     C                     MOVE A6NDWR    JEZ     2                       138742
     C                     MOVELA6DNOR    JEZ                             138742
     C*                                                                   138742
     C           JEZ       IFEQ 'NN'                                      138742
     C                     MOVE *BLANKS   DELC                            138742
     C                     END                                            138742
     C           JEZ       IFEQ 'NY'                                      138742
     C                     MOVE '1'       DELC                            138742
     C                     END                                            138742
     C           JEZ       IFEQ 'YN'                                      138742
     C                     MOVE '2'       DELC                            138742
     C                     END                                            138742
     C           JEZ       IFEQ 'YY'                                      138742
     C                     MOVE '3'       DELC                            138742
     C                     END                                            138742
     C*                                                                   138742
     C                     ENDSR                                          138742
     C/EJECT                                                              138742
      *****************************************************************   CFT013
      *  SRDTMG - Determine Type of Message                           *   CFT013
      *  Called by - main process                                     *   CFT013
      *  Calls     - ME1730                                           *   CFT013
      *****************************************************************   CFT013
     C           SRDTMG    BEGSR                                          CFT013
      *                                                                   CFT013
     C                     MOVE MGPOBR    I@SNBR                          CFT013
     C                     MOVE *BLANKS   I@DSCN                          CFT013
     C                     MOVE MGDEST    I@DSCN                          CFT013
     C                     MOVE '100'     I@MTPY                          CFT013
     C                     MOVE 'N'       I@CONC                          CFT013
     C                     Z-ADDMGSETP    I@SETT                          CFT013
     C                     MOVE *BLANK    I@FTCS                          CFT013
     C                     MOVE MGMODI    I@MMOD                          CFT013
      *                                                                   CFT013
     C                     CALL 'MG9900'                                  CFT013
     C                     PARM *BLANKS   @RTCD                           CFT013
     C                     PARM           P@IN                            CFT013
     C                     PARM *BLANKS   P@OUT                           CFT013
     C                     PARM           P@ZZ                            CFT013
      *                                                                   CFT013
     C           @RTCD     IFNE *BLANKS                                   CFT013
     C           *LOCK     IN   LDA                                       CFT013
     C                     Z-ADD31        DBASE                           CFT013
     C                     MOVEL'*CALL  ' DBKEY                           CFT013
     C                     MOVEL'MG9900'  DBFILE                          CFT013
     C                     OUT  LDA                                       CFT013
     C                     EXSR *PSSR                                     CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C                     MOVELMGBRCA    PIBRCH                          CFT013
     C                     MOVELO@SWSN    PISBIC                          CFT013
     C                     MOVELO@SWDS    PIRBIC                          CFT013
     C                     MOVELMGPOBN    PIORDB                          CFT013
     C                     MOVELP@BTB     PIBTBI                          CFT013
     C                     MOVELMGRCRN    PIRCVC                          CFT013
     C                     MOVEL*BLANK    PISNDC                          CFT013
     C           MGRVNO    IFEQ *BLANKS                                   CFT013
     C                     MOVELMGPONS    PISNDC                          CFT013
     C                     ELSE                                           CFT013
     C                     MOVELMGRVNO    PISNDC                          CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
      ** ME1730 will not be called anymore if CSW203 is installed                             CSW203
      *                                                                                       CSW203
     C           CSW203    IFNE 'Y'                                                           CSW203
      *                                                                                       CSW203
     C                     CALL 'ME1730'                                  CFT013
     C                     PARM           PIBRCH  3                       CFT013
     C                     PARM           PISBIC 11                       CFT013
     C                     PARM           PIRBIC 11                       CFT013
     C                     PARM           PIORDB256                       CFT013
     C                     PARM           PIBTBI256                       CFT013
     C                     PARM           PISNDC256                       CFT013
     C                     PARM           PIRCVC256                       CFT013
     C                     PARM *BLANK    PORTCD  7                       CFT013
      *                                                                   CFT013
     C           PORTCD    IFEQ '*ERROR'                                  CFT013
     C           *LOCK     IN   LDA                                       CFT013
     C                     MOVEL*BLANKS   DBKEY                           CFT013
     C                     MOVEL'ME1730'  DBFILE                          CFT013
     C                     Z-ADD32        DBASE                           CFT013
     C                     OUT  LDA                                       CFT013
     C                     EXSR *PSSR                                     CFT013
     C                     ENDIF                                          CFT013
      *                                                                                       CSW203
     C                     ELSE                                                               CSW203
     C                     MOVEL'*CRT103' PORTCD                                              CSW203
     C                     ENDIF                                                              CSW203
      *                                                                   CFT013
      ** Access Destination Customer details                              CFT013
      *                                                                   CFT013
     C                     MOVELMGDEST    PKEY1                           CFT013
     C                     CALL 'AOCUSTR1'                                CFT013
     C                     PARM *BLANK    PRTCD   7                       CFT013
     C                     PARM '*KEY   ' POPTN   7                       CFT013
     C                     PARM           PKEY1  10                       CFT013
     C                     PARM *BLANKS   PKYST   7                       CFT013
     C           SDCUST    PARM SDCUST    DSLDY                           CFT013
      *                                                                   CFT013
     C           PRTCD     IFNE *BLANKS                                   CFT013
     C           *LOCK     IN   LDA                                       CFT013
     C                     MOVELPKEY1     DBKEY                           CFT013
     C                     MOVEL'SDCUSTPD'DBFILE                          CFT013
     C                     Z-ADD33        DBASE                           CFT013
     C                     OUT  LDA                                       CFT013
     C                     EXSR *PSSR                                     CFT013
      *                                                                   CFT013
     C                     ELSE                                           CFT013
      *                                                                   CFT013
     C                     SELEC                                          CFT013
      *                                                                   CFT013
     C           PORTCD    WHEQ '*CRT100'                                 CFT013
     C           BBNG01    IFEQ '100'                                     CFT013
     C           BBNG02    OREQ '100'                                     CFT013
     C           BBNG03    OREQ '100'                                     CFT013
     C           BBNG04    OREQ '100'                                     CFT013
     C           BBNG05    OREQ '100'                                     CFT013
     C           BBNG06    OREQ '100'                                     CFT013
     C           BBNG07    OREQ '100'                                     CFT013
     C           BBNG08    OREQ '100'                                     CFT013
     C           BBNG09    OREQ '100'                                     CFT013
     C           BBNG10    OREQ '100'                                     CFT013
     C           BBNG11    OREQ '100'                                     CFT013
     C           BBNG12    OREQ '100'                                     CFT013
     C           BBNG13    OREQ '100'                                     CFT013
     C           BBNG14    OREQ '100'                                     CFT013
     C           BBNG15    OREQ '100'                                     CFT013
     C                     MOVEL'SUP    ' PORTCD                          CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C           PORTCD    WHEQ '*CRT103'                                 CFT013
     C           BBNG01    IFEQ '103'                                     CFT013
     C           BBNG02    OREQ '103'                                     CFT013
     C           BBNG03    OREQ '103'                                     CFT013
     C           BBNG04    OREQ '103'                                     CFT013
     C           BBNG05    OREQ '103'                                     CFT013
     C           BBNG06    OREQ '103'                                     CFT013
     C           BBNG07    OREQ '103'                                     CFT013
     C           BBNG08    OREQ '103'                                     CFT013
     C           BBNG09    OREQ '103'                                     CFT013
     C           BBNG10    OREQ '103'                                     CFT013
     C           BBNG11    OREQ '103'                                     CFT013
     C           BBNG12    OREQ '103'                                     CFT013
     C           BBNG13    OREQ '103'                                     CFT013
     C           BBNG14    OREQ '103'                                     CFT013
     C           BBNG15    OREQ '103'                                     CFT013
     C                     MOVEL'SUP    ' PORTCD                          CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C                     ENDSL                                          CFT013
      *                                                                   250600
     C                     MOVELBBCOLC    PCTRY                           250600
      *                                                                   250600
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C                     ENDSR                                          CFT013
      *****************************************************************   CFT013
     C/EJECT                                                              CFT013
      *****************************************************************   CFT013
      *  SRF103 - Format MT103 message                                *   CFT013
      *  Called by - main process                                     *   CFT013
      *  Calls     -                                                  *   CFT013
      *****************************************************************   CFT013
     C           SRF103    BEGSR                                          CFT013
      *                                                                   CFT013
      ** Format :20: Transaction Reference Number                         CFT013
      *                                                                   CFT013
     C                     EXSR SRFM20                                    CFT013
      *                                                                   CFT013
      **  Format :23B: Bank Operation Code                                CFT013
      **  Format :23E: Instruction Code                                   CFT013
      *                                                                   CFT013
     C                     EXSR SRFM23                                    CFT013
      *                                                                   CFT013
      **  Format :32A: Value Date/Currency/Interbank Settled Amount       CFT013
      **  Format :33B: Currency/Instructed Amount                         CFT013
      **  Format :36: Exchange Rate                                       CFT013
      *                                                                   CFT013
     C                     EXSR SRFM3X                                    CFT013
      *                                                                   CFT013
      **  Format :50a: Ordering Customer                                  CFT013
      *                                                                   CFT013
     C                     ADD  1         X                               CFT013
     C           X         OCUR MULT                                      CFT013
      *                                                                   CFT013
     C********** MGPOCN    IFEQ 0                                                      CFT013 CSD027
     C           MGPOCN    IFEQ *BLANKS                                                       CSD027
     C                     MOVELMSGA,8    MERR                            CFT013
     C                     MOVE 'Y'       @ERR                            CFT013
     C                     ELSE                                           CFT013
      *                                                                                       CSW207
      ** Call program that will format field for 50F.                                         CSW207
      *                                                                                       CSW207
     C                     MOVELNWRK      PNTWRK    P                                         250600
     C                     MOVELI@MTPY    PMSGTP    P                                         250600
     C                     MOVELMGPONS    PNOSTF    P                                         250600
      *                                                                                       250600
     C           CSW207    IFEQ 'Y'                                                           CSW207
     C                     MOVE *BLANKS   PCUSTA                                              CSW207
     C                     MOVELMGPOCN    PCUSTA                                              CSW207
     C                     MOVELMGPOCN    P@IN1     P                                         250600
     C                     MOVEL':50F:'   PMSGFD    P                                         250600
     C                     MOVELMGMODI    PMODI     P                                         250600
      *                                                                                       250600
     C                     CALL 'FT001000'                                                    CSW207
     C                     PARM *BLANKS   PRTRN   7                                           CSW207
     C                     PARM *BLANKS   PMSGID  7                                           CSW207
     C                     PARM *BLANK    PERTP   1                                           CSW207
     C                     PARM 'FRMT'    PVTYP   4                                           CSW207
     C                     PARM           P@IN1  35                                           CSW207
     C                     PARM           P@IN2  35                                           CSW207
     C                     PARM           P@IN3  35                                           CSW207
     C                     PARM           P@IN4  35                                           CSW207
     C                     PARM           P@IN5  35                                           CSW207
     C**********           PARM           PACTYP  1                                   CSW207 CSW207A
     C                     PARM 'C'       PACTYP  1                                          CSW207A
     C                     PARM           PACC   34                                           CSW207
     C                     PARM           PCUSTA  6                                           CSW207
     C                     PARM           PNAHO  10                                           CSW207
     C**********           PARM 'SWIFT'   PNTWRK  6                                     CSW207250600
     C**********           PARM '103'     PMSGTP  3                                     CSW207250600
     C**********           PARM ':50F:'   PMSGFD  5                                     CSW207250600
     C                     PARM           PNTWRK  6                                           250600
     C                     PARM           PMSGTP  3                                           250600
     C                     PARM           PMSGFD  5                                           250600
     C                     PARM           PCTRY   2                                           CSW207
     C**********           PARM           PBRCH   3                                  CSW207 BUG14593
     C                     PARM MGBRCA    PBRCH   3                                         BUG14593
     C**********           PARM           PCURR   3                                  CSW207 BUG14593
     C                     PARM MGCCY     PCURR   3                                         BUG14593
     C                     PARM           PNOSTF  2                                           CSW207
     C                     PARM           PMODI   2                                           CSW207
     C                     PARM           PMSGL1 35                                           CSW207
     C                     PARM           PMSGL2 35                                           CSW207
     C                     PARM           PMSGL3 35                                           CSW207
     C                     PARM           PMSGL4 35                                           CSW207
     C                     PARM           PMSGL5 35                                           CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
     C           PRTRN     IFEQ *BLANKS                                                       CSW207
     C           CSW207    ANDEQ'Y'                                                           CSW207
     C                     MOVE ':50F:'   MTAG                                                CSW207
     C                     MOVE PMSGL1    ZSADD1                                              CSW207
     C                     MOVE PMSGL2    ZSADD2                                              CSW207
     C                     MOVE PMSGL3    ZSADD3                                              CSW207
     C                     MOVE PMSGL4    ZSADD4                                              CSW207
     C                     MOVE PMSGL5    ZSADD5 35                                           250600
      *                                                                                       CSW207
     C                     ELSE                                                               CSW207
      *                                                                   CFT013
     C                     MOVE *BLANKS   ZDEST                           CFT013
     C                     MOVELMGPOCN    ZDEST                           CFT013
     C                     CALL 'ZM0050'                                  CFT013
     C                     PARM           ZDEST                           CFT013
     C                     PARM           ZSADD1                          CFT013
     C                     PARM           ZSADD2                          CFT013
     C                     PARM           ZSADD3                          CFT013
     C                     PARM           ZSADD4                          CFT013
     C                     PARM           ZSTAG                           CFT013
     C                     PARM           ZSTYPE                          CFT013
     C                     PARM           ZERR                            CFT013
     C                     PARM *BLANK    ZDBEI                                               CSW201
      *                                                                   CFT013
     C           ZERR      IFEQ '1'                                       CFT013
     C                     MOVE ':50: '   MTAG                            CFT013
     C                     MOVELMGPOCN    MFLD                            CFT013
     C                     MOVELMSGA,5    MERR                            CFT013
     C                     MOVE 'Y'       @ERR                            CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C           ZSTAG     IFEQ 'A'                                       CFT013
     C                     MOVE ':50A:'   MTAG                            CFT013
      *                                                                                     MD026727
     C           PAOCAB    IFEQ 'Y'                                                         MD026727
     C                     EXSR SRICNA                                                      MD026727
     C                     ENDIF                                                            MD026727
      *                                                                                     MD026727
     C                     ELSE                                           CFT013
     C                     MOVE ':50K:'   MTAG                            CFT013
      *                                                                                     MD026727
     C           PAOCAB    IFEQ 'Y'                                                         MD026727
     C                     EXSR SRICNK                                                      MD026727
     C                     ELSE                                                             MD026727
      *                                                                                     MD026727
     C*                                                                                       220913
     C* Insert Customer Number                                                                220913
     C                     EXSR SRICAR                                                        220913
      *                                                                                     MD026727
     C                     ENDIF                                                            MD026727
     C*                                                                                       220913
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
      ** Check if SAR CSW024 is switched *ON.                                                 204225
      *                                                                                       204225
     C           CSW024    IFEQ 'Y'                                                           204225
      *                                                                                       204225
      ** Search customer then check if it is CROSSMAR and its BEI is                          204225
      ** not blank.                                                                           204225
      *                                                                                       204225
     C                     MOVEL*BLANKS   @KEY1                                               204225
     C                     MOVELZDEST     @KEY1                                               204225
     C                     CALL 'AOCUSTR1'                                                    204225
     C                     PARM '*MSG   ' @RTCD                                               204225
     C                     PARM '*KEY   ' @OPTN                                               204225
     C                     PARM           @KEY1                                               204225
     C                     PARM *BLANKS   @KYST                                               204225
     C           SDCUST    PARM SDCUST    DSLDY                                               204225
      *                                                                                       204225
     C           @RTCD     IFEQ *BLANKS                                                       204225
     C           BBCORP    IFEQ 'Y'                                                           204225
     C           BBCBEI    IFNE *BLANKS                                                       204225
     C                     MOVE ':50A:'   MTAG                                                204225
     C                     MOVE *BLANKS   ZSADD1                                              204225
     C                     MOVELBBCBEI    ZSADD1                                              204225
     C                     MOVE *BLANKS   ZSADD2                                              204225
     C                     MOVE *BLANKS   ZSADD3                                              204225
     C                     MOVE *BLANKS   ZSADD4                                              204225
     C                     ELSE                                                               204225
     C********** CFT032    IFEQ 'Y'                                                 250600 BUG15017A
     C                     MOVELCACNT1    PACTNF                                              250600
     C                     MOVELMGBRCA    BRCA4A                                              250600
     C                     MOVELPCTRY     CTRY4A                                              250600
     C                     CALL 'AOOUFMR0'PLOUFM                                              250600
     C           @RTRN     IFEQ *BLANKS                                                       250600
     C           OMFLAG    ANDEQ'M'                                                        BUG15017A
     C           @RTRN     ORNE *BLANKS                                                    BUG15017A
     C           OMFLAG    ANDEQ'W'                                                        BUG15017A
     C********** OMFLAG    IFEQ 'M'                                                 250600 BUG15017A
     C********** OMFLAG    OREQ 'W'                                                 250600 BUG15017A
     C           '/'       CAT  ZDEST     ZSADD1                                              250600
     C                     MOVE BBCNA1    ZSADD2                                              250600
     C                     MOVE BBCNA2    ZSADD3                                              250600
     C                     MOVE BBCNA3    ZSADD4                                              250600
     C                     MOVE BBCNA4    ZSADD5                                              250600
     C                     GOTO EXORC                                                         250600
     C**********           ENDIF                                                    250600 BUG15017A
     C**********           ENDIF                                                    250600 BUG15017A
     C**********           ENDIF                                                    250600 BUG15017A
     C                     ELSE                                                            BUG15017A
     C                     MOVE ':50K:'   MTAG                                                204225
     C                     MOVE BBCNA1    ZSADD1                                              204225
     C                     MOVE BBCNA2    ZSADD2                                              204225
     C                     MOVE BBCNA3    ZSADD3                                              204225
     C                     MOVE BBCNA4    ZSADD4                                              204225
     C                     MOVE *BLANKS   ZSADD5                                              250600
     C                     ENDIF                                                           BUG15017A
     C*                                                                                       220913
     C* Insert Customer Number                                                                220913
     C                     EXSR SRICAR                                                        220913
     C*                                                                                       220913
     C                     ENDIF                                                              204225
     C                     ENDIF                                                              204225
     C                     ENDIF                                                              204225
      *                                                                                       CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       204225
     C                     ENDIF                                                              204225
     C           EXORC     TAG                                                                250600
      *                                                                                       204225
     C                     EXSR SWADF                                     CFT013
     C                     MOVE *BLANKS   SAVMTG                                            BUG15037
     C                     EXSR SEXTN                                                       BUG15037
     C                     ENDIF                                          CFT013
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C                     MOVE 'Y'       ZDBEI                                               CSW201
     C                     ENDIF                                                              CSW201
      *                                                                   CFT013
      **  Format :52a: Ordering Institution                               CFT013
      *                                                                   CFT013
     C********** MGPOBN    IFNE 0                                                      CFT013 CSD027
     C           MGPOBN    IFNE *BLANKS                                                       CSD027
      *                                                                   CFT013
     C                     ADD  1         X                               CFT013
     C           X         OCUR MULT                                      CFT013
     C                     MOVE *BLANKS   ZDEST                           CFT013
     C                     MOVELMGPOBN    ZDEST                           CFT013
     C                     CALL 'ZM0050'                                  CFT013
     C                     PARM           ZDEST                           CFT013
     C                     PARM           ZSADD1                          CFT013
     C                     PARM           ZSADD2                          CFT013
     C                     PARM           ZSADD3                          CFT013
     C                     PARM           ZSADD4                          CFT013
     C                     PARM           ZSTAG                           CFT013
     C                     PARM           ZSTYPE                          CFT013
     C                     PARM           ZERR                            CFT013
     C                     PARM           ZDBEI                                               CSW201
      *                                                                   CFT013
     C           ZERR      IFEQ '1'                                       CFT013
     C                     MOVELMGPOBN    MFLD                            CFT013
     C                     MOVELMSGA,5    MERR                            CFT013
     C                     MOVE 'Y'       @ERR                            CFT013
     C                     END                                            CFT013
      *                                                                   CFT013
      **  Write ISO bank identifier..                                     CFT013
     C           ZSTAG     IFEQ 'A'                                       CFT013
     C                     MOVE ':52A:'   MTAG                            CFT013
      *                                                                                       208890
     C           CFT013    IFEQ 'Y'                                                           208890
     C                     MOVE 'Y'       AIND,9                                              208890
     C                     ENDIF                                                              208890
      *                                                                   CFT013
      **  ..or full name and address                                      CFT013
     C                     ELSE                                           CFT013
     C                     MOVE ':52D:'   MTAG                            CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C                     EXSR SWADF                                     CFT013
     C                     MOVE *BLANKS   SAVMTG  5                                         BUG15037
     C                     EXSR SEXTN                                                       BUG15037
     C                     ELSE                                                               208890
     C           CFT013    IFEQ 'Y'                                                           208890
     C                     MOVE 'Y'       AIND,9                                              208890
     C                     ENDIF                                                              208890
      *                                                                                       208890
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
      **  Format :53a: Sender's Correspondent                             CFT013
      *                                                                   CFT013
     C                     EXSR FMT53                                     CFT013
      *                                                                   CFT013
      **  Format :54a: Receiver's Correspondent                           CFT013
      *                                                                   CFT013
     C                     EXSR FMT54                                     CFT013
      *                                                                   CFT013
      **  Format :55a: Third Reimbursement Institution                    CFT013
      *                                                                   CFT013
     C                     EXSR SRFM55                                    CFT013
      *                                                                   CFT013
      **  Format :56a: Intermediary Institution                           CFT013
      *                                                                   CFT013
     C                     EXSR FMT56                                     CFT013
      *                                                                   CFT013
      **  Format :57a: Account with Institution                           CFT013
      *                                                                   CFT013
     C                     EXSR FMT57                                     CFT013
      *                                                                   CFT013
      **  Format :59a: Beneficiary                                        CFT013
      *                                                                   CFT013
     C                     ADD  1         X                               CFT013
     C           X         OCUR MULT                                      CFT013
      *                                                                   CFT013
     C           MGBENN    IFEQ *BLANK                                    CFT013
     C                     MOVELMGBENN    MFLD                            CFT013
     C                     MOVELMSGA,8    MERR                            CFT013
     C                     MOVE 'Y'       @ERR                            CFT013
      *                                                                   CFT013
     C                     ELSE                                           CFT013
      *                                                                                       CSW215
      ** Format 59F Beneficiary                                                               CSW215
      *                                                                                       CSW215
     C                     MOVEL'N'       WRK59F  1                                           CSW215
     C           CSW215    IFEQ 'Y'                                                           CSW215
     C                     EXSR SRFM59                                                        CSW215
     C                     ENDIF                                                              CSW215
      *                                                                                       CSW215
     C           WRK59F    IFEQ 'N'                                                           CSW215
      *                                                                   CFT013
     C                     MOVE *BLANKS   ZDEST                           CFT013
     C                     MOVELMGBENN    ZDEST                           CFT013
      *                                                                   CFT013
     C                     CALL 'ZM0050'                                  CFT013
     C                     PARM           ZDEST                           CFT013
     C                     PARM           ZSADD1                          CFT013
     C                     PARM           ZSADD2                          CFT013
     C                     PARM           ZSADD3                          CFT013
     C                     PARM           ZSADD4                          CFT013
     C                     PARM           ZSTAG                           CFT013
     C                     PARM           ZSTYPE                          CFT013
     C                     PARM           ZERR                            CFT013
     C                     PARM *BLANK    ZDBEI                                               CSW201
      *                                                                   CFT013
     C           ZERR      IFEQ '1'                                       CFT013
     C                     MOVELMGBENN    MFLD                            CFT013
     C                     MOVELMSGA,5    MERR                            CFT013
     C                     MOVE 'Y'       @ERR                            CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
      **  If beneficiary account blank use bank to bank beneficiary       CFT013
     C           MGBENA    IFEQ *BLANKS                                   CFT013
     C                     MOVE MGBTB1    @BTB                            CFT013
     C           @BT1      IFEQ '/BEN/'                                   CFT013
     C           @BT2      IFNE '/BJ'                                     CFT013
     C           @BT2      ANDNE'/BL'                                     CFT013
     C           @BT2      ANDNE'/CH'                                     CFT013
     C           @BT2      ANDNE'/CP'                                     CFT013
     C           @BT2      ANDNE'/FW'                                     CFT013
     C           @BT2      ANDNE'/SC'                                     CFT013
     C           MGMODI    IFEQ 'SE'                                                          219242
     C                     MOVEL@BT4      MGBENA                                              219242
     C                     ELSE                                                               219242
     C                     MOVEL@BT3      MGBENA                          CFT013
     C                     ENDIF                                                              219242
     C                     ENDIF                                          CFT013
     C                     ENDIF                                          CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C           ZSTAG     IFEQ 'A'                                       CFT013
     C                     MOVE ':59A:'   MTAG                            CFT013
     C                     ELSE                                           CFT013
     C                     MOVE ':59: '   MTAG                            CFT013
     C                     ENDIF                                          CFT013
      *                                                                                       205747
      ** Check if SAR CSW024 is switched *ON.                                                 205747
      *                                                                                       205747
     C           CSW024    IFEQ 'Y'                                                           205747
      *                                                                                       205747
      ** Search customer then check if it is CROSSMAR and its BEI is                          205747
      ** not blank.                                                                           205747
      *                                                                                       205747
     C                     MOVEL*BLANKS   @KEY1                                               205747
     C                     MOVELZDEST     @KEY1                                               205747
     C                     CALL 'AOCUSTR1'                                                    205747
     C                     PARM '*MSG   ' @RTCD                                               205747
     C                     PARM '*KEY   ' @OPTN                                               205747
     C                     PARM           @KEY1                                               205747
     C                     PARM *BLANKS   @KYST                                               205747
     C           SDCUST    PARM SDCUST    DSLDY                                               205747
      *                                                                                       205747
     C           @RTCD     IFEQ *BLANKS                                                       205747
     C           BBCORP    IFEQ 'Y'                                                           205747
     C           BBCBEI    IFNE *BLANKS                                                       205747
     C                     MOVE ':59A:'   MTAG                                                205747
     C                     MOVE *BLANKS   ZSADD1                                              205747
     C                     MOVELBBCBEI    ZSADD1                                              205747
     C                     MOVE *BLANKS   ZSADD2                                              205747
     C                     MOVE *BLANKS   ZSADD3                                              205747
     C                     MOVE *BLANKS   ZSADD4                                              205747
     C                     ELSE                                                               205747
     C                     MOVE ':59: '   MTAG                                                205747
     C                     MOVE BBCNA1    ZSADD1                                              205747
     C                     MOVE BBCNA2    ZSADD2                                              205747
     C                     MOVE BBCNA3    ZSADD3                                              205747
     C                     MOVE BBCNA4    ZSADD4                                              205747
     C                     ENDIF                                                              205747
     C                     ENDIF                                                              205747
     C                     ENDIF                                                              205747
      *                                                                                       205747
     C                     ENDIF                                                              205747
      *                                                                   CFT013
      **  Write beneficiary account if present                            CFT013
     C           MGBENA    IFNE *BLANKS                                   CFT013
     C                     MOVELMGBENA    MFLD                            CFT013
     C                     ADD  1         X                               CFT013
     C           X         OCUR MULT                                      CFT013
     C                     MOVEA*BLANK    @WRK                            CFT013
     C                     MOVEAMGBENA    @WRK                            CFT013
      *                                                                   CFT013
      ** If first line is an account line                                 CFT013
     C           @WRK,1    IFEQ '/'                                       CFT013
     C                     MOVE 'Y'       AIND,7                          CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C                     ENDIF                                          CFT013
      *                                                                                       CSW202
      ** Swift 2002 changes                                                                   CSW202
      *                                                                                       CSW202
     C           CSW202    IFEQ 'Y'                                                           CSW202
     C           AIND,7    ANDEQ'Y'                                                           CSW202
      *                                                                                       CSW202
      ** Determine if Sender field Support Charge Transparency                                CSW202
      *                                                                                       CSW202
     C                     MOVE 'N'       WSCTSN  1                                           CSW202
     C                     MOVE *BLANKS   WFLAG   1                                           CSW202
     C                     MOVE *BLANKS   WRK18  18                                           CSW202
     C           8         SUBSTNWSN:1    WSWID   8                                           CSW202
     C           3         SUBSTNWSN:10   WBRCH   3                                           CSW202
     C           WSWID     CAT  WBRCH     WRK11  11                                           CSW202
     C                     MOVELWRK11     WRK18                                               CSW202
     C                     EXSR SRSCT                                                         CSW202
     C           WKSCHT    IFEQ 'Y'                                                           CSW202
     C                     MOVE 'Y'       WSCTSN                                              CSW202
     C                     ENDIF                                                              CSW202
      *                                                                                       CSW202
      ** Determine if Receiver field Support Charge Transparency                              CSW202
      *                                                                                       CSW202
     C                     MOVE 'N'       WSCTRC  1                                           CSW202
     C                     MOVE *BLANKS   WFLAG                                               CSW202
     C                     MOVE *BLANKS   WRK18                                               CSW202
     C                     MOVELNWDS      WRK18                                               CSW202
     C                     EXSR SRSCT                                                         CSW202
     C           WKSCHT    IFEQ 'Y'                                                           CSW202
     C                     MOVE 'Y'       WSCTRC                                              CSW202
     C                     ENDIF                                                              CSW202
      *                                                                                       CSW202
      ** Determine if Account with Institution field Support Charge                           CSW202
      ** transparency                                                                         CSW202
      *                                                                                       CSW202
     C                     MOVE 'Y'       WSCTAI  1                                           CSW202
     C                     MOVE 'Y'       WFLAG                                               CSW202
     C           AIND,6    IFEQ 'Y'                                                           CSW202
     C           MGAWBN    ANDNE*BLANKS                                                       CSW202
     C                     MOVE *BLANKS   WRK18                                               CSW202
     C                     MOVELMGAWBN    WRK18                                               CSW202
     C                     EXSR SRSCT                                                         CSW202
     C           WKSCHT    IFNE 'Y'                                                           CSW202
     C                     MOVE 'N'       WSCTAI                                              CSW202
     C                     ENDIF                                                              CSW202
     C                     ENDIF                                                              CSW202
      *                                                                                       CSW202
      ** Check if MGBENA is an IBAN account in correct format                                 CSW202
      *                                                                                       CSW202
     C                     MOVE 'N'       WIBANF  1                                           CSW202
     C           CFT004    IFEQ 'Y'                                                           CSW202
     C                     EXSR SRIBAN                                                        CSW202
     C                     ENDIF                                                              CSW202
      *                                                                                       CSW202
     C********** WSCTSN    IFNE 'Y'                                                    CSW202 CSW213
     C********** WSCTRC    IFNE 'Y'                                                    CSW202 CSW213
     C********** WSCTAI    ORNE 'Y'                                                    CSW202 CSW213
     C********** WIBANF    ORNE 'Y'                                                    CSW202 CSW213
     C********** WSCTSN    IFEQ 'Y'                                                  CSW213 MD022039
     C********** WSCTRC    ANDEQ'Y'                                                  CSW213 MD022039
     C********** WSCTAI    ANDEQ'Y'                                                  CSW213 MD022039
     C********** WIBANF    IFNE 'Y'                                                  CSW213 MD022039
     C           WSCTSN    IFNE 'Y'                                                         MD022039
     C           WSCTRC    ORNE 'Y'                                                         MD022039
     C           WSCTAI    ORNE 'Y'                                                         MD022039
     C           WIBANF    ORNE 'Y'                                                         MD022039
     C                     MOVE *BLANKS   AIND,7                                              CSW202
     C                     ENDIF                                                              CSW215
     C**********           ENDIF                                                     CSW213 MD022039
     C                     ENDIF                                                              CSW202
      *                                                                                       CSW202
     C                     ENDIF                                                              CSW202
      *                                                                   CFT013
     C                     EXSR SWADF                                     CFT013
      *                                                                   CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
      **  Format :70: Remittance Information                              CFT013
      **  Format :71A: Details of Charges                                 CFT013
      *                                                                   CFT013
     C                     EXSR FMTDET                                    CFT013
      *                                                                   CFT013
      **  Format :71F: Sender's Charges                                   CFT013
      *                                                                   CFT013
     C/COPY WNCPYSRC,MG0100C044
     C           MGDCHG    IFEQ *BLANK                                    CFT013
     C           MGDCHG    OREQ 'BEN'                                     CFT013
     C                     EXSR SRFM71                                    CFT013
     C                     ENDIF                                          CFT013
     C/COPY WNCPYSRC,MG0100C045
      *                                                                   CFT013
      **  Format :72: Senter to Receiver Information                      CFT013
      *                                                                   CFT013
     C                     EXSR SRFM72                                    CFT013
      *                                                                   CFT013
     C                     ENDSR                                          CFT013
      *****************************************************************   CFT013
     C/EJECT                                                              CFT013
      *****************************************************************   CFT013
      *  SRFM20 - Format :20: Transaction Reference Number            *   CFT013
      *  Called by - SRF103                                           *   CFT013
      *  Calls     -                                                  *   CFT013
      *****************************************************************   CFT013
     C           SRFM20    BEGSR                                          CFT013
      *                                                                   CFT013
     C                     MOVE *BLANKS   CVTRN                           CFT013
     C                     MOVE *BLANKS   CVDLNO                          CFT013
     C                     MOVE *BLANKS   CVSEQN                          CFT013
      *                                                                   CFT013
     C                     Z-ADD1         X                               CFT013
     C           X         OCUR MULT                                      CFT013
     C                     MOVEA*BLANKS   @WRK                            CFT013
      *                                                                   CFT013
     C                     Z-ADD1         Z                               CFT013
      *                                                                   CFT013
     C           CLE007    IFEQ 'Y'                                       CFT013
     C           MGMODI    ANDEQ'LF'                                      CFT013
     C           CLE007    OREQ 'Y'                                       CFT013
     C           MGMODI    ANDEQ'LS'                                      CFT013
     C                     MOVE 'F'       @WRK,1                          CFT013
     C                     MOVEAMGTNUM    @WRK,2                          CFT013
      *                                                                   CFT013
      * For a loan based fee, midas transaction is 14 characters long,    CFT013
      * so remove customer number, since there will not be room for it    CFT013
      * in the SWIFT transaction ref.                                     CFT013
     C           @WRK,15   IFNE *BLANK                                    CFT013
     C                     MOVEA@WRK,8    W#LNSQ                          CFT013
     C                     MOVEAW#LNSQ    @WRK,2    P                     CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C                     ELSE                                           CFT013
     C                     MOVEAMGMODI    @WRK                            CFT013
     C                     MOVEAMGTNUM    @WRK,3                          CFT013
     C                     ENDIF                                          CFT013
     C           MGLSWS    ADD  1         HLSWS                           CFT013
     C                     MOVE HLSWS     HSWS                            CFT013
      *                                                                   CFT013
     C           ' '       LOKUP@WRK,Z                   31               CFT013
      *                                                                   CFT013
     C           CLE007    IFEQ 'Y'                                       CFT013
     C           MGMODI    ANDEQ'LF'                                      CFT013
     C           CLE007    OREQ 'Y'                                       CFT013
     C           MGMODI    ANDEQ'LS'                                      CFT013
     C                     MOVE HLSWS     WSWS                            CFT013
     C                     MOVEAWSWS      @WRK,Z                          CFT013
      *                                                                   CFT013
     C                     ELSE                                           CFT013
     C                     MOVEAHSWS      @WRK,Z                          CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
      **  Check on MGREFPD for a uniqne TRN,else output as an error.      CFT013
      **  and store the TRN of the new confirmation message.              CFT013
      *                                                                   CFT013
     C                     MOVEA@WRK      @TRNA                           CFT013
     C                     MOVEA@WRK      CVTRN                           CFT013
     C                     MOVELMGTNUM    CVDLNO                          CFT013
     C                     MOVELHSWS      CVSEQN                          CFT013
      *                                                                   CFT013
     C           @TRNA     CHAINMGREFL0              11                   CFT013
      *                                                                   CFT013
      ** If a record is found flag field as in error.                     CFT013
      *                                                                   CFT013
     C           *IN11     IFEQ '0'                                       CFT013
     C                     MOVE 'Y'       @ERR                            CFT013
     C                     MOVELMSGA,7    MERR                            CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C                     MOVEL':20:'    MTAG                            CFT013
     C                     MOVEA@WRK      MFLD                            CFT013
      *                                                                   CFT013
     C                     ENDSR                                          CFT013
      *****************************************************************   CFT013
     C/EJECT                                                              CFT013
      *****************************************************************   CFT013
      *  SRFM23 - Format :23a: Bank Operation Code & Instruction Code *   CFT013
      *  Called by - SRF103                                           *   CFT013
      *  Calls     -                                                  *   CFT013
      *****************************************************************   CFT013
     C           SRFM23    BEGSR                                          CFT013
      *                                                                   CFT013
      **  Format :23B: Bank Operation Code                                CFT013
      *                                                                   CFT013
     C                     ADD  1         X                               CFT013
     C           X         OCUR MULT                                      CFT013
     C                     MOVEL':23B:'   MTAG                            CFT013
     C                     MOVEL'CRED'    MFLD                            CFT013
      *                                                                   CFT013
      **  Format :23E: Instruction Code                                   CFT013
      *                                                                   CFT013
     C                     MOVEL'N'       FLD23   1                       CFT013
     C           P@BTB     IFNE *BLANKS                                   CFT013
      *                                                                   CFT013
     C                     MOVEA*BLANKS   BTBI                            CFT013
     C                     MOVELMGBTB1    BTBI,1                          CFT013
     C                     MOVELMGBTB2    BTBI,2                          CFT013
     C                     MOVELMGBTB3    BTBI,3                          CFT013
     C                     MOVELMGBTB4    BTBI,4                          CFT013
     C                     MOVELMGBTB5    BTBI,5                          CFT013
     C                     MOVELMGBTB6    BTBI,6                          CFT013
     C                     MOVE 'N'       WERI                            CFT013
      *                                                                   CFT013
     C                     Z-ADD1         I                               CFT013
     C           I         DOUGT6                                         CFT013
      *                                                                   CFT013
     C                     MOVELBTBI,I    @BTB                            CFT013
     C                     MOVEA*BLANKS   @WRK                            CFT013
      *                                                                   CFT013
     C                     SELEC                                          CFT013
     C           WBTB9     WHEQ ABTB,1                                    CFT013
      *                                                                                       CSW206
      ** Process only when CSW206 is off.                                                     CSW206
      *                                                                                       CSW206
     C           CSW206    IFEQ 'N'                                                           CSW206
     C                     MOVEA'BONL'    @WRK                            CFT013
     C                     ENDIF                                                              CSW206
     C                     MOVE 'Y'       WERI                            CFT013
     C           WBTB8     WHEQ ABTB,2                                    CFT013
     C                     MOVEA'CHQB'    @WRK                            CFT013
     C                     MOVE 'Y'       WERI                            CFT013
     C           WBTB10    WHEQ ABTB,3                                    CFT013
     C                     MOVEA'CORT'    @WRK                            CFT013
     C                     MOVE 'Y'       AIND,1                          CFT013
     C           WBTB6     WHEQ ABTB,4                                    CFT013
     C                     MOVEA'HOLD'    @WRK,1                          CFT013
     C           WBTB29    IFNE *BLANK                                    CFT013
     C                     MOVE '/'       @WRK,5                          CFT013
     C                     MOVEAWBTB29    @WRK,6                          CFT013
     C                     ENDIF                                          CFT013
     C                     MOVE 'Y'       WERI                            CFT013
     C           WBTB10    WHEQ ABTB,5                                    CFT013
     C                     MOVEA'INTC'    @WRK                            CFT013
     C                     MOVE 'Y'       AIND,1                          CFT013
     C           WBTB6     WHEQ ABTB,6                                    CFT013
     C                     MOVEA'PHON'    @WRK,1                          CFT013
     C           WBTB29    IFNE *BLANK                                    CFT013
     C                     MOVE '/'       @WRK,5                          CFT013
     C                     MOVEAWBTB29    @WRK,6                          CFT013
     C                     ENDIF                                          CFT013
     C                     MOVE 'Y'       WERI                            CFT013
     C           WBTB9     WHEQ ABTB,7                                    CFT013
     C                     MOVEA'PHOB'    @WRK,1                          CFT013
     C           WBTB26    IFNE *BLANK                                    CFT013
     C                     MOVE '/'       @WRK,5                          CFT013
     C                     MOVEAWBTB26    @WRK,6                          CFT013
     C                     ENDIF                                          CFT013
     C                     MOVE 'Y'       WERI                            CFT013
     C           WBTB9     WHEQ ABTB,8                                    CFT013
     C                     MOVEA'PHOI'    @WRK,1                          CFT013
     C           WBTB26    IFNE *BLANK                                    CFT013
     C                     MOVE '/'       @WRK,5                          CFT013
     C                     MOVEAWBTB26    @WRK,6                          CFT013
     C                     ENDIF                                          CFT013
     C                     MOVE 'Y'       WERI                            CFT013
     C           WBTB6     WHEQ ABTB,10                                   CFT013
     C                     MOVEA'TELE'    @WRK                            CFT013
     C                     MOVE 'Y'       WERI                            CFT013
     C           WBTB9     WHEQ ABTB,11                                   CFT013
     C                     MOVEA'TELB'    @WRK,1                          CFT013
     C           WBTB26    IFNE *BLANK                                    CFT013
     C                     MOVE '/'       @WRK,5                          CFT013
     C                     MOVEAWBTB26    @WRK,6                          CFT013
     C                     ENDIF                                          CFT013
     C                     MOVE 'Y'       WERI                            CFT013
     C           WBTB9     WHEQ ABTB,12                                   CFT013
     C                     MOVEA'TELI'    @WRK,1                          CFT013
     C           WBTB26    IFNE *BLANK                                    CFT013
     C                     MOVE '/'       @WRK,5                          CFT013
     C                     MOVEAWBTB26    @WRK,6                          CFT013
     C                     ENDIF                                          CFT013
     C                     MOVE 'Y'       WERI                            CFT013
     C           WBTB6     WHEQ ABTB,15                                                       CSW202
     C           CSW202    ANDEQ'Y'                                                           CSW202
     C                     MOVEA'REPA'    @WRK,1                                              CSW202
     C                     MOVE 'Y'       AIND,1                                              CSW202
     C           WBTB29    IFNE *BLANKS                                                       CSW202
     C                     MOVE '/'       @WRK,5                                              CSW202
     C                     MOVEAWBTB29    @WRK,6                                              CSW202
     C                     ENDIF                                                              CSW202
     C                     ENDSL                                          CFT013
      *                                                                   CFT013
     C           @WRK,1    IFNE *BLANK                                    CFT013
     C                     ADD  1         X                               CFT013
     C           X         OCUR MULT                                      CFT013
     C                     MOVEL':23E:'   MTAG                            CFT013
     C                     MOVEA@WRK      MFLD                            CFT013
     C                     MOVE 'Y'       FLD23                           CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C           MFLD      IFEQ 'SDVA'                                    CFT013
     C                     MOVE 'Y'       AIND,1                          CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C                     ADD  1         I                               CFT013
      *                                                                   CFT013
     C                     ENDDO                                          CFT013
      *                                                                   CFT013
     C           WERI      IFEQ 'Y'                                       CFT013
     C                     MOVE 'N'       AIND,1                          CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
      ** If field :23E is not present...                                  CFT013
     C           FLD23     IFEQ 'N'                                       CFT013
     C***********          MOVE 'Y'       AIND,1                                       CFT013 219242
      *                                                                                       219242
     C                     MOVE *BLANKS   WINCD                                               219242
      *                                                                                       219242
     C                     SELEC                                                              219242
      *                                                                                       219242
     C           MGMODI    WHEQ 'DL'                                                          219242
     C           ENICDL    ANDNE*BLANKS                                                       219242
     C                     ADD  1         X                                                   219242
     C           X         OCUR MULT                                                          219242
     C                     MOVEL':23E:'   MTAG                                                219242
     C                     MOVELENICDL    WINCD   4                                           219242
     C           ENAFDL    IFEQ *BLANKS                                                       219242
     C                     MOVELENICDL    MFLD                                                219242
     C                     ELSE                                                               219242
     C           ENICDL    CAT  '/'       WMFLD   5                                           219242
     C           WMFLD     CAT  ENAFDL    WFLD   35                                           219242
     C                     MOVELWFLD      MFLD                                                219242
     C                     ENDIF                                                              219242
      *                                                                                       219242
     C           MGMODI    WHEQ 'LE'                                                          219242
     C           ENICLE    ANDNE*BLANKS                                                       219242
     C                     ADD  1         X                                                   219242
     C           X         OCUR MULT                                                          219242
     C                     MOVEL':23E:'   MTAG                                                219242
     C                     MOVELENICLE    WINCD                                               219242
     C           ENAFLE    IFEQ *BLANKS                                                       219242
     C                     MOVELENICLE    MFLD                                                219242
     C                     ELSE                                                               219242
     C           ENICLE    CAT  '/'       WMFLD                                               219242
     C           WMFLD     CAT  ENAFLE    WFLD                                                219242
     C                     MOVELWFLD      MFLD                                                219242
     C                     ENDIF                                                              219242
      *                                                                                       219242
     C           MGMODI    WHEQ 'SE'                                                          219242
     C           ENICSE    ANDNE*BLANKS                                                       219242
     C                     ADD  1         X                                                   219242
     C           X         OCUR MULT                                                          219242
     C                     MOVEL':23E:'   MTAG                                                219242
     C                     MOVELENICSE    WINCD                                               219242
     C           ENAFSE    IFEQ *BLANKS                                                       219242
     C                     MOVELENICSE    MFLD                                                219242
     C                     ELSE                                                               219242
     C           ENICSE    CAT  '/'       WMFLD                                               219242
     C           WMFLD     CAT  ENAFSE    WFLD                                                219242
     C                     MOVELWFLD      MFLD                                                219242
     C                     ENDIF                                                              219242
      *                                                                                       219242
     C                     ENDSL                                                              219242
      *                                                                                       219242
     C           WINCD     IFEQ 'SDVA'                                                        219242
     C           WINCD     OREQ 'CORT'                                                        219242
     C           WINCD     OREQ 'INTC'                                                        219242
     C           WINCD     OREQ 'REPA'                                                        219242
     C           WINCD     OREQ *BLANKS                                                       219242
     C                     MOVE 'Y'       AIND,1                                              219242
     C                     ENDIF                                                              219242
      *                                                                                       219242
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C                     ENDSR                                          CFT013
      *****************************************************************   CFT013
     C/EJECT                                                              CFT013
      *****************************************************************   CFT013
      *  SRFM3X - Format :32A:, :33B: & :36:                          *   CFT013
      *  Called by - SRF103                                           *   CFT013
      *  Calls     -                                                  *   CFT013
      *****************************************************************   CFT013
     C           SRFM3X    BEGSR                                          CFT013
      *                                                                   CFT013
      **  Format :32A: Value Date/Currency/Interbank Settled Amount       CFT013
      *                                                                   CFT013
     C                     ADD  1         X                               CFT013
     C           X         OCUR MULT                                      CFT013
      *                                                                   CFT013
      **  Format value date to SWIFT standard                             CFT013
     C                     MOVE MGVDAT    ZMDAY                           CFT013
      *                                                                                       CDL099
      ** Only check for SVD if FX/MM ie not LE or other modules                               CDL099
      *                                                                                       CDL099
     C           MGMODI    IFEQ 'DL'                                                          CDL099
     C           CDL099    ANDEQ'Y'                                                           CDL099
     C                     MOVELMGTNUM    KYDLNO                                              CDL099
     C           KYDLNO    CHAINDEALS                40                                       CDL099
     C           *IN40     IFEQ '0'                                                         MD050972
     C           BSDT2     ANDNE0                                                           MD050972
     C                     MOVE BSDT2     ZMDAY                                               CDL099
     C                     ENDIF                                                            MD050972
     C                     ENDIF                                                              CDL099
      *                                                                   135679
     C                     CALL 'ZM0060'               15                 CFT013
     C                     PARM           ZMDAY                           CFT013
     C                     PARM           ZSDATE                          CFT013
      *                                                                   CFT013
      ** Call to program ended in error.                                  CFT013
     C           *IN15     IFEQ '1'                                       CFT013
     C           *LOCK     IN   LDA                                       CFT013
     C                     Z-ADD34        DBASE                           CFT013
     C                     MOVEL'*CALL  ' DBKEY                           CFT013
     C                     MOVEL'ZM0060'  DBFILE                          CFT013
     C                     OUT  LDA                                       CFT013
     C                     EXSR *PSSR                                     CFT013
     C                     END                                            CFT013
      *                                                                   CFT013
      **  Format purchase currency and amount                             CFT013
     C                     MOVE MGCCY     ZCCY                            CFT013
     C                     MOVE MGEAMT    ZAMNT                           CFT013
     C/COPY WNCPYSRC,MGH00073
     C                     EXSR SRZM40                                    CFT013
      *                                                                   CFT013
      ** Error - indicate erroneous fields                                CFT013
     C           ZERR      IFEQ '1'                                       CFT013
     C                     MOVE 'Y'       @ERR                            CFT013
     C                     MOVE MGEAMT    ZAMT                            CFT013
     C                     MOVE MGCCY     ZCCY                            CFT013
     C/COPY WNCPYSRC,MGH00074
     C                     MOVELERR3N     MFLD                            CFT013
     C                     MOVELMSGA,4    MERR                            CFT013
      *                                                                   CFT013
     C                     ELSE                                           CFT013
     C                     MOVE ':32A:'   MTAG                            CFT013
     C                     MOVELFLD3N     MFLD                            CFT013
      *                                                                   CFT013
      ** Save event amount.                                               CFT013
     C                     MOVEL*BLANKS   SAMNT                           CFT013
     C                     MOVELZSAMNT    SAMNT                           CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
      **  Format :33B: Currency/Instructed Amount                         CFT013
      *                                                                   CFT013
     C                     ADD  1         X                               CFT013
     C           X         OCUR MULT                                      CFT013
      *                                                                   CFT013
     C           MGICCY    IFNE *BLANKS                                                       219243
     C           MGIAMT    ANDNE*ZEROS                                                        219243
     C                     MOVE MGICCY    ZCCY                                                219243
     C                     Z-ADDMGIAMT    ZAMNT                                               219243
     C                     ELSE                                                               219243
      *                                                                                       219243
     C           CEU003    IFEQ 'Y'                                       CFT013
     C           MGOTRC    ANDNE*BLANKS                                   CFT013
     C                     MOVE MGOTRC    ZCCY                            CFT013
     C                     Z-ADDMGOTRA    ZAMNT                           CFT013
     C/COPY WNCPYSRC,MGH00075
     C                     ELSE                                           CFT013
     C                     MOVE MGCCY     ZCCY                            CFT013
     C                     Z-ADDMGEAMT    ZAMNT                           CFT013
     C/COPY WNCPYSRC,MGH00076
     C                     ENDIF                                          CFT013
      *                                                                                       219243
     C                     ENDIF                                                              219243
      *                                                                   CFT013
      **  Format Amount                                                   CFT013
     C                     EXSR SRZM40                                    CFT013
      *                                                                   CFT013
      ** Error - indicate erroneous fields                                CFT013
     C           ZERR      IFEQ '1'                                       CFT013
     C                     MOVE 'Y'       @ERR                            CFT013
     C                     MOVE ZAMNT     ZAMT                            CFT013
     C                     MOVE ZCCY      ZCCY                            CFT013
     C                     MOVELERR3N     MFLD                            CFT013
     C                     MOVELMSGA,4    MERR                            CFT013
     C                     ELSE                                           CFT013
     C                     MOVE ':33B:'   MTAG                            CFT013
     C                     MOVELFLD33B    MFLD                            CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
      **  Format :36: Exchange Rate                                       CFT013
      *                                                                   CFT013
     C           MGICCY    IFNE *BLANKS                                                       219243
     C                     MOVE MGICCY    WRKCCY  3                                           219243
     C                     ELSE                                                               219243
     C                     MOVE MGOTRC    WRKCCY                                              219243
     C                     ENDIF                                                              219243
      *                                                                                       219243
     C           MGIAMT    IFNE *ZEROS                                                        219243
     C                     Z-ADDMGIAMT    WRKAMT 130                                          219243
     C                     ELSE                                                               219243
     C                     Z-ADDMGOTRA    WRKAMT                                              219243
     C                     ENDIF                                                              219243
      *                                                                                       219243
     C********** MGCCY     IFNE MGOTRC                                                 CFT013 219243
     C********** MGOTRC    ANDNE*BLANK                                                 CFT013 219243
     C********** MGOTRA    ANDNE*ZERO                                                  CFT013 219243
     C           MGCCY     IFNE WRKCCY                                                        219243
     C           WRKCCY    ANDNE*BLANK                                                        219243
     C           WRKAMT    ANDNE*ZERO                                                         219243
      *                                                                                       222458
     C           MGEXRT    IFEQ *ZEROS                                                        222458
      *                                                                   CFT013
      ** Set up parameters to call FT0010                                 CFT013
     C                     MOVE *BLANKS   P#0010                          CFT013
     C                     MOVE *BLANKS   P#NDCY                          CFT013
     C                     Z-ADD*ZEROS    P#NDAM                          CFT013
     C                     MOVE MGCCY     P#DBCY                          CFT013
     C                     Z-ADDMGEAMT    P#DBAM                          CFT013
     C**********           MOVE MGOTRC    P#CRCY                                       CFT013 219243
     C**********           MOVE MGOTRA    P#CRAM                                       CFT013 219243
     C                     MOVE WRKCCY    P#CRCY                                              219243
     C                     MOVE WRKAMT    P#CRAM                                              219243
     C                     MOVE *BLANKS   P#PDCY                          CFT013
     C                     Z-ADD*ZEROS    P#PDAM                          CFT013
     C                     Z-ADD*ZEROS    P#DBDT                          CFT013
     C                     Z-ADD*ZEROS    P#CRDT                          CFT013
     C                     Z-ADD*ZEROS    P#RATE                          CFT013
     C                     MOVE *BLANKS   P#OVRT                          CFT013
     C                     MOVE *BLANKS   P#SDIN                          CFT013
     C                     Z-ADD*ZEROS    P#RTDS                          CFT013
     C                     MOVEL*BLANKS   P#PMSQ                          CFT013
     C                     MOVE *BLANKS   P#INDC                          CFT013
     C                     MOVE *BLANKS   P#RTCD                          CFT013
      *                                                                   CFT013
     C                     CALL 'FT0010'                                  CFT013
     C                     PARM           P#0010                          CFT013
      *                                                                   CFT013
     C           P#RTCD    IFEQ '*ERROR*'                                 CFT013
     C                     MOVEL'*CALL   'DBKEY                           CFT013
     C                     MOVEL'FT0010'  DBFILE                          CFT013
     C                     Z-ADD35        DBASE                           CFT013
     C                     EXSR *PSSR                                     CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C                     Z-ADD0         WOEXR  158                      CFT013
     C           P#MDIN    IFEQ 1                                         CFT013
     C********** MGOTRA    DIV  MGEAMT    WOEXR                                        CFT013 219243
     C           WRKAMT    DIV  MGEAMT    WOEXR                                               219243
     C                     ELSE                                           CFT013
     C********** MGEAMT    DIV  MGOTRA    WOEXR                                        CFT013 219243
     C           MGEAMT    DIV  WRKAMT    WOEXR                                               219243
     C                     ENDIF                                          CFT013
      *                                                                                       222458
     C                     ELSE                                                               222458
     C                     Z-ADD0         WOEXR                                               222548
     C                     Z-ADDMGEXRT    WOEXR                                               222458
     C                     ENDIF                                                              222458
      *                                                                   CFT013
     C                     ADD  1         X                               CFT013
     C           X         OCUR MULT                                      CFT013
     C                     MOVE ':36: '   MTAG                            CFT013
     C                     Z-ADDWOEXR     ZPRIC  158                      CFT013
     C                     EXSR SR1190                                    CFT013
      *                                                                   CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C                     ENDSR                                          CFT013
      *****************************************************************   CFT013
     C/EJECT                                                              CFT013
      *****************************************************************   CFT013
      *  SRFM55 - Format :55a: Third Reimbursement Institution        *   CFT013
      *  Called by - SRF103                                           *   CFT013
      *  Calls     - ME1400                                           *   CFT013
      *****************************************************************   CFT013
     C           SRFM55    BEGSR                                          CFT013
      *                                                                   CFT013
     C                     MOVE 'N'       FLD55   1                       CFT013
     C           P@BTB     IFNE *BLANKS                                   CFT013
      *                                                                   CFT013
     C                     MOVEA*BLANKS   BTBI                            CFT013
     C                     MOVELMGBTB1    BTBI,1                          CFT013
     C                     MOVELMGBTB2    BTBI,2                          CFT013
     C                     MOVELMGBTB3    BTBI,3                          CFT013
     C                     MOVELMGBTB4    BTBI,4                          CFT013
     C                     MOVELMGBTB5    BTBI,5                          CFT013
     C                     MOVELMGBTB6    BTBI,6                          CFT013
      *                                                                   CFT013
     C                     Z-ADD1         Z                               CFT013
     C           Z         DOUGT6                                         CFT013
      *                                                                   CFT013
     C                     MOVE BTBI,Z    WBTB   35                       CFT013
      *                                                                   CFT013
     C           '/RCB/'   SCAN WBTB:1    WSCAN   30     89               CFT013
      *                                                                   CFT013
      ** If /RCB/ is found in bank to bank info.                          CFT013
     C           *IN89     IFEQ *ON                                       CFT013
      *                                                                   CFT013
      ** If next line is preceeded by a double slash('//'), treat it      CFT013
      ** as an address.                                                   CFT013
     C           Z         ADD  1         I                               CFT013
     C                     MOVELBTBI,I    @BTB                            CFT013
     C                     MOVE 'N'       WADDY   1                       CFT013
     C           WBTB2     IFEQ '//'                                      CFT013
     C                     MOVE 'Y'       WADDY                           CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C           WSCAN     ADD  5         IX      30                      CFT013
     C                     MOVEL*BLANK    PBICC                           CFT013
     C           8         SUBSTWBTB:IX   PBICC        89                 CFT013
     C           *IN89     IFEQ *ON                                       CFT013
     C                     MOVEL*BLANK    PBICC                           CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C                     ADD  8         IX                              CFT013
     C                     MOVEL*BLANK    PBICB                           CFT013
     C           3         SUBSTWBTB:IX   PBICB        89                 CFT013
     C           *IN89     IFEQ *ON                                       CFT013
     C                     MOVEL*BLANK    PBICB                           CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C                     CALL 'ME1400'                                  CFT013
     C                     PARM *BLANK    PRTCD                           CFT013
     C                     PARM           PBICC   8                       CFT013
     C                     PARM           PBICB   3                       CFT013
     C                     PARM           SDCUST                          CFT013
     C                     PARM           SDCNST                          CFT013
     C                     PARM           MEBICD                          CFT013
     C                     PARM           PCUST   1                       CFT013
     C                     PARM           PCNST   1                       CFT013
     C                     PARM           PBICD   1                       CFT013
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C           PRTCD     ANDEQ*BLANKS                                                       CSW201
     C           PBICD     ANDEQ'Y'                                                           CSW201
      *                                                                                       CSW202
     C           CSW202    IFEQ 'Y'                                                           CSW202
     C                     CALL 'AOBEISR0'                                                    CSW202
     C                     PARM *BLANKS   PRCOD   7                                           CSW202
     C                     PARM '*VERIFY' POPTN                                               CSW202
     C                     PARM BDSUBT    PBIC    4                                           CSW202
     C           MEBEIS    PARM MEBEIS    DSFDY                                               CSW202
     C                     ENDIF                                                              CSW202
      *                                                                                       CSW202
     C           BDSUBT    IFEQ 'BEID'                                                        CSW201
     C           CSW202    ANDEQ'N'                                                           CSW202
      *                                                                                       CSW202
     C           BDSUBT    OREQ 'TRCO'                                                        CSW201
     C           CSW202    ANDEQ'N'                                                           CSW202
      *                                                                                       CSW202
     C           CSW202    OREQ 'Y'                                                           CSW202
     C           PRCOD     ANDEQ*BLANKS                                                       CSW202
      *                                                                                       CSW202
     C                     MOVE '*DBEI  ' PRTCD                                               CSW201
     C                     ENDIF                                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                   CFT013
     C           PRTCD     IFEQ *BLANKS                                   CFT013
     C           WADDY     ANDEQ'N'                                       CFT013
     C           PRTCD     OREQ 'MIN0244'                                 CFT013
     C           WADDY     ANDEQ'N'                                       CFT013
     C           PRTCD     OREQ 'MIN0245'                                 CFT013
     C           WADDY     ANDEQ'N'                                       CFT013
     C                     MOVEA*BLANKS   @WRK                            CFT013
     C                     MOVEAPBICC     @WRK,1                          CFT013
     C                     MOVEAPBICB     @WRK,9                          CFT013
     C                     ADD  1         X                               CFT013
     C           X         OCUR MULT                                      CFT013
     C                     MOVE ':55A:'   MTAG                            CFT013
     C                     MOVEA@WRK      MFLD                            CFT013
     C                     MOVE 'Y'       AIND,4                          CFT013
     C                     MOVE 'Y'       FLD55                           CFT013
      *                                                                   CFT013
     C                     ELSE                                           CFT013
      *                                                                   CFT013
     C                     ADD  1         X                               CFT013
     C           X         OCUR MULT                                      CFT013
     C                     MOVE ':55D:'   MTAG                            CFT013
      *                                                                                       CSW201
      ** If SWIFT ID a BEI                                                                    CSW201
      *                                                                                       CSW201
     C           PRTCD     IFEQ '*DBEI'                                                       CSW201
      *                                                                                       CSW201
     C                     SELEC                                                              CSW201
      *                                                                                       CSW201
     C           PCUST     WHEQ 'Y'                                                           CSW201
      *                                                                                       CSW201
     C                     MOVELBBCNA1    MFLD                                                CSW201
      *                                                                                       CSW201
     C           BBCNA2    IFNE *BLANKS                                                       CSW201
     C                     ADD  1         X                                                   CSW201
     C           X         OCUR MULT                                                          CSW201
     C                     MOVELBBCNA2    MFLD                                                CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C           BBCNA3    IFNE *BLANKS                                                       CSW201
     C                     ADD  1         X                                                   CSW201
     C           X         OCUR MULT                                                          CSW201
     C                     MOVELBBCNA3    MFLD                                                CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C           BBCNA4    IFNE *BLANKS                                                       CSW201
     C                     ADD  1         X                                                   CSW201
     C           X         OCUR MULT                                                          CSW201
     C                     MOVELBBCNA4    MFLD                                                CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C           PCNST     WHEQ 'Y'                                                           CSW201
      *                                                                                       CSW201
     C                     MOVELAWCPNM    MFLD                                                CSW201
      *                                                                                       CSW201
     C           AWCNTN    IFNE *BLANKS                                                       CSW201
     C                     ADD  1         X                                                   CSW201
     C           X         OCUR MULT                                                          CSW201
     C                     MOVELAWCNTN    MFLD                                                CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     ENDSL                                                              CSW201
      *                                                                                       CSW201
     C                     ELSE                                                               CSW201
      *                                                                                       CSW201
     C                     MOVE *BLANKS   @BTB                            CFT013
     C           WSCAN     ADD  5         IX                              CFT013
     C           35        SUB  IX        I                               CFT013
     C           I         SUBSTWBTB:IX   @BTB                            CFT013
     C                     MOVEL@BTB      MFLD                            CFT013
      *                                                                                       CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     MOVE 'Y'       FLD55                           CFT013
      *                                                                   CFT013
     C           Z         ADD  1         I                               CFT013
     C           I         DOUGT6                                         CFT013
     C                     MOVELBTBI,I    @BTB                            CFT013
     C           WBTB2     IFEQ '//'                                      CFT013
     C                     ADD  1         X                               CFT013
     C           X         OCUR MULT                                      CFT013
     C                     MOVELWBTB33    MFLD                            CFT013
     C                     ADD  1         I                               CFT013
     C                     ELSE                                           CFT013
     C                     Z-ADD7         I                               CFT013
     C                     ENDIF                                          CFT013
     C                     ENDDO                                          CFT013
      *                                                                   CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C                     Z-ADD7         Z                               CFT013
     C                     ELSE                                           CFT013
     C                     ADD  1         Z                               CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C                     ENDDO                                          CFT013
      *                                                                   CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C           FLD55     IFEQ 'N'                                       CFT013
     C                     MOVE 'Y'       AIND,4                          CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C                     ENDSR                                          CFT013
      *****************************************************************   CFT013
     C/EJECT                                                              CFT013
      *****************************************************************   CFT013
      *  SRFM71 - Format :71F: Sender's Charges                       *   CFT013
      *  Called by - SRF103                                           *   CFT013
      *  Calls     -                                                  *   CFT013
      *****************************************************************   CFT013
     C           SRFM71    BEGSR                                          CFT013
      *                                                                   CFT013
     C                     ADD  1         X                               CFT013
     C           X         OCUR MULT                                      CFT013
     C                     MOVEL':71F:'   MTAG                            CFT013
      *                                                                   CFT013
     C           '/CHGS/'  SCAN P@BTB:1   WSCAN          89               CFT013
      *                                                                   CFT013
      ** IF /CHGS/ is found in bank to bank info.                         CFT013
      ** Syntax is /CHGS/CCYnnnn,nn/                                      CFT013
     C           *IN89     IFEQ *ON                                       CFT013
      *                                                                   CFT013
     C           WSCAN     ADD  6         IX                              CFT013
     C           3         SUBSTP@BTB:IX  WCCY    3                       CFT013
     C                     ADD  3         IX                              CFT013
     C                     MOVEL*BLANKS   WAMT15 15                       CFT013
     C           15        SUBSTP@BTB:IX  WAMT15                          CFT013
      *                                                                   CFT013
     C           WCCY      IFEQ MGCCY                                     CFT013
     C                     MOVEA*BLANKS   @WRK                            CFT013
     C                     MOVEAWCCY      @WRK,1                          CFT013
     C                     MOVEAWAMT15    @WRK,4                          CFT013
     C                     MOVEA@WRK      MFLD                            CFT013
      *                                                                   CFT013
     C                     ELSE                                           CFT013
      *                                                                   CFT013
     C                     CALL 'AOCURRR0'                                CFT013
     C                     PARM '*DBERR ' @RTCD                           CFT013
     C                     PARM '*KEY   ' @OPTN                           CFT013
     C                     PARM WCCY      @BKCY                           CFT013
     C           SDCURR    PARM SDCURR    DSSDY                           CFT013
      *                                                                   CFT013
     C                     MOVEA*BLANK    AAMT                            CFT013
     C                     MOVEAWAMT15    AAMT                            CFT013
     C           ','       SCAN WAMT15:1  I              89               CFT013
      *                                                                   CFT013
     C           *IN89     IFEQ *ON                                       CFT013
     C                     SUBST'.'       AAMT,I                          CFT013
     C                     ENDIF                                          CFT013
      *  Drop closing '/' on /CHGS/ syntax                                CFT013
     C           '/'       SCAN WAMT15:1  I              89               CFT013
      *                                                                   CFT013
     C           *IN89     IFEQ *ON                                       CFT013
     C                     SUBST' '       AAMT,I                          CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C                     MOVE *BLANK    ZFIELD                          CFT013
     C                     MOVEAAAMT      ZFIELD                          CFT013
     C                     Z-ADDA6NBDP    ZADEC                           CFT013
     C           15        SUB  A6NBDP    ZADIG                           CFT013
      *                                                                   CFT013
     C                     CALL 'ZALIGN'                                  CFT013
     C                     PARM *BLANK    PRTCD                           CFT013
     C                     PARM           ZFIELD 16                       CFT013
     C                     PARM           ZADEC   10                      CFT013
     C                     PARM           ZADIG   20                      CFT013
     C                     PARM *BLANK    ZAFLD  16                       CFT013
      *                                                                   CFT013
     C           PRTCD     IFNE *BLANK                                    CFT013
     C           *LOCK     IN   LDA                                       CFT013
     C                     Z-ADD36        DBASE                           CFT013
     C                     MOVEL'*CALL  ' DBKEY                           CFT013
     C                     MOVEL'ZALIGN'  DBFILE                          CFT013
     C                     OUT  LDA                                       CFT013
     C                     EXSR *PSSR                                     CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
      ** Set up parameters to call FT0010                                 CFT013
     C                     MOVE *BLANKS   P#0010                          CFT013
     C                     MOVE *BLANKS   P#NDCY                          CFT013
     C                     Z-ADD*ZEROS    P#NDAM                          CFT013
     C                     MOVE WCCY      P#DBCY                          CFT013
     C                     MOVE ZAFLD     P#DBAM                          CFT013
     C                     MOVE MGCCY     P#CRCY                          CFT013
     C                     Z-ADD*ZEROS    P#CRAM                          CFT013
     C                     MOVE *BLANKS   P#PDCY                          CFT013
     C                     Z-ADD*ZEROS    P#PDAM                          CFT013
     C                     Z-ADD*ZEROS    P#DBDT                          CFT013
     C                     Z-ADD*ZEROS    P#CRDT                          CFT013
     C                     Z-ADD*ZEROS    P#RATE                          CFT013
     C                     MOVE *BLANKS   P#OVRT                          CFT013
     C                     MOVE *BLANKS   P#SDIN                          CFT013
     C                     Z-ADD*ZEROS    P#RTDS                          CFT013
     C                     MOVEL*BLANKS   P#PMSQ                          CFT013
     C                     MOVE *BLANKS   P#INDC                          CFT013
     C                     MOVE *BLANKS   P#RTCD                          CFT013
      *                                                                   CFT013
     C                     CALL 'FT0010'                                  CFT013
     C                     PARM           P#0010                          CFT013
      *                                                                   CFT013
     C           P#RTCD    IFEQ '*ERROR*'                                 CFT013
     C                     MOVEL'*CALL   'DBKEY                           CFT013
     C                     MOVEL'FT0010'  DBFILE                          CFT013
     C                     Z-ADD37        DBASE                           CFT013
     C                     EXSR *PSSR                                     CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C           P#INDC    IFEQ '00000'                                   CFT013
     C                     Z-ADDP#CRAM    ZAMNT                           CFT013
     C                     MOVE MGCCY     ZCCY                            CFT013
     C/COPY WNCPYSRC,MGH00077
     C                     EXSR SRZM40                                    CFT013
      *                                                                   CFT013
      ** Error - indicate erroneous fields                                CFT013
     C           ZERR      IFEQ '1'                                       CFT013
     C                     MOVE 'Y'       @ERR                            CFT013
     C                     MOVE 0         ZAMT                            CFT013
     C                     MOVE WCCY      ZCCY                            CFT013
     C                     MOVELERR3N     MFLD                            CFT013
     C                     MOVELMSGA,4    MERR                            CFT013
     C                     ELSE                                           CFT013
     C                     MOVELFLD33B    MFLD                            CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C                     ELSE                                           CFT013
      *                                                                   CFT013
     C                     MOVE MGCCY     ZCCY                            CFT013
     C/COPY WNCPYSRC,MGH00078
     C                     Z-ADD0         ZAMNT                           CFT013
     C                     EXSR SRZM40                                    CFT013
      *                                                                   CFT013
      ** Error - indicate erroneous fields                                CFT013
     C           ZERR      IFEQ '1'                                       CFT013
     C                     MOVE 'Y'       @ERR                            CFT013
     C                     MOVE 0         ZAMT                            CFT013
     C                     MOVE MGCCY     ZCCY                            CFT013
     C/COPY WNCPYSRC,MGH00086
     C                     MOVELERR3N     MFLD                            CFT013
     C                     MOVELMSGA,4    MERR                            CFT013
     C                     ELSE                                           CFT013
     C                     MOVELFLD33B    MFLD                            CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C                     ENDSR                                          CFT013
      *****************************************************************   CFT013
     C/EJECT                                                              CFT013
      *****************************************************************   CFT013
      *  SRFM72 - Format :72: Sender to Receiver Information          *   CFT013
      *  Called by - SRF103                                           *   CFT013
      *  Calls     - ME1400                                           *   CFT013
      *****************************************************************   CFT013
     C           SRFM72    BEGSR                                          CFT013
      *                                                                   CFT013
     C/COPY WNCPYSRC,MGH00079
     C           P@BTB     IFNE *BLANKS                                   CFT013
      *                                                                   CFT013
     C                     MOVEL*BLANKS   BTBI                            CFT013
     C                     MOVELMGBTB1    BTBI,1                          CFT013
     C                     MOVELMGBTB2    BTBI,2                          CFT013
     C                     MOVELMGBTB3    BTBI,3                          CFT013
     C                     MOVELMGBTB4    BTBI,4                          CFT013
     C                     MOVELMGBTB5    BTBI,5                          CFT013
     C                     MOVELMGBTB6    BTBI,6                          CFT013
     C                     MOVE 'N'       WERI    1                       CFT013
     C                     MOVE 'Y'       W1ST    1                       CFT013
      *                                                                   CFT013
     C                     Z-ADD1         I                               CFT013
     C           I         DOUGT6                                         CFT013
     C                     MOVELBTBI,I    @BTB                            CFT013
      *                                                                   CFT013
     C           BTBI,I    IFNE *BLANKS                                   CFT013
     C           WBTB9     ANDNEABTB,1                                    CFT013
     C           WBTB8     ANDNEABTB,2                                    CFT013
     C           WBTB10    ANDNEABTB,3                                    CFT013
     C           WBTB6     ANDNEABTB,4                                    CFT013
     C           WBTB10    ANDNEABTB,5                                    CFT013
     C           WBTB6     ANDNEABTB,6                                    CFT013
     C           WBTB9     ANDNEABTB,7                                    CFT013
     C           WBTB9     ANDNEABTB,8                                    CFT013
     C           WBTB5     ANDNEABTB,9                                    CFT013
     C           WBTB6     ANDNEABTB,10                                   CFT013
     C           WBTB9     ANDNEABTB,11                                   CFT013
     C           WBTB9     ANDNEABTB,12                                   CFT013
     C           WBTB6     ANDNEABTB,13                                   CFT013
     C           WBTB6     ANDNEABTB,14                                   CFT013
     C           W1ST      IFEQ 'Y'                                       CFT013
     C                     ADD  1         X                               CFT013
     C           X         OCUR MULT                                      CFT013
     C                     MOVEL':72: '   MTAG                            CFT013
     C                     MOVELBTBI,I    MFLD                            CFT013
     C                     MOVE 'N'       W1ST                            CFT013
     C                     ELSE                                           CFT013
     C                     ADD  1         X                               CFT013
     C           X         OCUR MULT                                      CFT013
     C                     MOVELBTBI,I    MFLD                            CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
      ** Drop all succeding extension line for omitted codewords.         CFT013
     C                     ELSE                                           CFT013
      *                                                                   CFT013
     C           BTBI,I    IFNE *BLANKS                                   CFT013
     C           I         ADD  1         Z                               CFT013
     C           Z         DOWLT7                                         CFT013
     C                     MOVELBTBI,Z    @BTB                            CFT013
     C           WBTB2     IFEQ '//'                                      CFT013
     C                     ADD  1         I                               CFT013
     C                     ADD  1         Z                               CFT013
     C                     ELSE                                           CFT013
     C                     ADD  7         Z                               CFT013
     C                     ENDIF                                          CFT013
     C                     ENDDO                                          CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C           WBTB5     IFEQ '/INS/'                                   CFT013
     C           8         SUBSTMFLD:6    PBICC                           CFT013
     C           3         SUBSTMFLD:14   PBICB                           CFT013
     C                     CALL 'ME1400'                                  CFT013
     C                     PARM *BLANKS   PRTCD                           CFT013
     C                     PARM           PBICC                           CFT013
     C                     PARM           PBICB                           CFT013
     C                     PARM           SDCUST                          CFT013
     C                     PARM           SDCNST                          CFT013
     C                     PARM           MEBICD                          CFT013
     C                     PARM           PCUST                           CFT013
     C                     PARM           PCNST                           CFT013
     C                     PARM           PBICD                           CFT013
     C           PRTCD     IFEQ *BLANKS                                   CFT013
     C           PRTCD     OREQ 'MIN0244'                                 CFT013
     C           PRTCD     OREQ 'MIN0245'                                 CFT013
     C                     MOVE 'Y'       AIND,8                          CFT013
     C                     ENDIF                                          CFT013
     C                     ELSE                                           CFT013
     C           BTBI,I    IFNE *BLANKS                                   CFT013
     C                     MOVE 'Y'       AIND,8                          CFT013
     C                     ENDIF                                          CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C           WBTB6     IFEQ '/REJT/'                                  CFT013
     C           WBTB6     OREQ '/RETN/'                                  CFT013
     C           WBTB6     OREQ '/OCMT/'                                  CFT013
     C                     MOVE 'Y'       WERI    1                       CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C                     ADD  1         I                               CFT013
     C                     ENDDO                                          CFT013
      *                                                                   CFT013
     C/COPY WNCPYSRC,MGH00080
     C           WERI      IFEQ 'Y'                                       CFT013
     C                     MOVE 'N'       AIND,8                          CFT013
     C                     ENDIF                                          CFT013
     C/COPY WNCPYSRC,MGH00081
      *                                                                   CFT013
      ** Else, if field 72 is not present...                              CFT013
     C                     ELSE                                           CFT013
     C                     MOVE 'Y'       AIND,8                          CFT013
     C                     ENDIF                                          CFT013
     C/COPY WNCPYSRC,MGH00082
      *                                                                   CFT013
     C                     ENDSR                                          CFT013
      *****************************************************************   CFT013
     C/EJECT                                                              CFT013
      *****************************************************************   CFT013
      *  SRZM40 - Convert Midas amount to Swift format.               *   CFT013
      *  Called by - SRF103                                           *   CFT013
      *  Calls     - ZM0040                                           *   CFT013
      *****************************************************************   CFT013
     C           SRZM40    BEGSR                                          CFT013
      *                                                                   CFT013
     C                     CALL 'ZM0040'               15                 CFT013
     C                     PARM           ZAMNT                           CFT013
     C                     PARM           ZCCY                            CFT013
     C                     PARM           ZSAMNT                          CFT013
     C                     PARM           ZSCCY                           CFT013
     C                     PARM           ZERR                            CFT013
     C                     PARM           ZSWDPC                                              222373
      *                                                                   CFT013
      **  Call ended in error (program not found)                         CFT013
     C           *IN15     IFEQ '1'                                       CFT013
     C           *LOCK     IN   LDA                                       CFT013
     C                     Z-ADD38        DBASE                           CFT013
     C                     MOVEL'*CALL  ' DBKEY                           CFT013
     C                     MOVEL'ZM0040'  DBFILE                          CFT013
     C                     OUT  LDA                                       CFT013
     C                     EXSR *PSSR                                     CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C                     ENDSR                                          CFT013
      *****************************************************************   CFT013
     C/EJECT                                                              CFT013
      *****************************************************************   CFT013
      *   SR1190 - Convert Rate to Swift format.                      *   CFT013
      *  Called by - SRFM3X                                           *   CFT013
      *  Calls     - ZM1190                                           *   CFT013
      *****************************************************************   CFT013
     C           SR1190    BEGSR                                          CFT013
      *                                                                   CFT013
     C                     MOVE *BLANKS   ZSPRIC 16                       CFT013
     C                     MOVE *BLANKS   ZOPRIC 21                       CFT013
     C                     Z-ADDZPRIC     WPRIC  158                      CFT013
      *                                                                   CFT013
     C                     CALL 'ZM1190'               28                 CFT013
     C                     PARM           ZPRIC                           CFT013
     C                     PARM           ZSPRIC                          CFT013
     C                     PARM           ZOPRIC                          CFT013
      *                                                                   CFT013
      ** If program is not found, then dbase error.                       CFT013
      *                                                                   CFT013
     C           *IN28     IFEQ '1'                                       CFT013
     C           *LOCK     IN   LDA                                       CFT013
     C                     Z-ADD39        DBASE                           CFT013
     C                     MOVE '*CALL '  DBKEY                           CFT013
     C                     MOVEL'ZM1190'  DBPGM                           CFT013
     C                     OUT  LDA                                       CFT013
     C                     EXSR *PSSR                                     CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C           WPRIC     IFLT 0                                         CFT013
     C           'N'       CAT  ZSPRIC:0  MFLD                            CFT013
     C                     ELSE                                           CFT013
     C                     MOVELZSPRIC    MFLD                            CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C                     ENDSR                                          CFT013
      *****************************************************************   CFT013
     C/EJECT                                                              CFT013
      *****************************************************************
      *   INIT - inital process                                       *
      *   Called by - main process                                    *
      *   Calls     -                                                 *
      *****************************************************************
      *
     C           INIT      BEGSR
      *
     C                     MOVEACPY@      BIS@   80
      *
      **  Set up LDA
     C           *NAMVAR   DEFN           LDA
     C           *LOCK     IN   LDA
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     MOVEL'MG0100'  DBPGM
     C                     MOVE *BLANKS   DBASE
     C                     OUT  LDA
      *
      **  Access SDBANKPD for report title
      *
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
      *
      ** If no record is found on sdbankpd.
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '001'     DBASE              * * * * * * *
     C                     MOVEL'FIRST'   DBKEY              * DBERR 001 *
     C                     MOVEL'SDBANKPD'DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Access SDMMODPD for modules available
      *
     C                     CALL 'AOMMODR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C           SDMMOD    PARM SDMMOD    DSFDY
      *
      ** If no record is found on sdmmodpd.
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '002'     DBASE              * * * * * * *
     C                     MOVEL'FIRST'   DBKEY              * DBERR 002 *
     C                     MOVEL'SDMMODPD'DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Access SDMGMEPD for message management data.
      *
     C**********           CALL 'AOMGMER0'                                                    219242
     C                     CALL 'AOMGMER1'                                                    219242
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C********** SDMGME    PARM SDMGME    DSFDY                                               219242
     C           SDMGME    PARM SDMGME    DSSDY                                               219242
      *
      ** If no record is found on sdmgmepd.
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '003'     DBASE            * * * * * * * *
     C                     MOVEL'FIRST'   DBKEY            *  DBERR 003  *
     C                     MOVEL'SDMGMEPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *                                                                   142403
      ** Determine if Customer Lending Enhancements - Others (T3)         142403
      ** feature is installed                                             142403
      *                                                                   142403
     C                     CALL 'AOSARDR0'                                142403
     C                     PARM *BLANKS   P@RTCD  7                       142403
     C                     PARM '*KEY   ' P@OPTN  7                       142403
     C                     PARM 'CLE007'  P@SARD  6                       142403
     C           SCSARD    PARM SCSARD    DSFDY                           142403
      *                                                                   142403
     C           P@RTCD    IFEQ *BLANKS                                   142403
     C                     MOVE 'Y'       CLE007  1                       142403
     C                     ELSE                                           142403
     C                     MOVE 'N'       CLE007                          142403
      *                                                                   142403
     C           P@RTCD    IFNE '*NRF    '                                142403
     C           *LOCK     IN   LDA                                       142403
     C******************   MOVEL'MG0202  'DBPGM                     142403250600
     C                     MOVEL'MG0100  'DBPGM                           250600
     C                     MOVEL'SCSARDPD'DBFILE           ************   142403
     C                     Z-ADD29        DBASE            * DBERR 29 *   142403
     C                     MOVEL'CLE007'  DBKEY     P      ************   142403
     C                     OUT  LDA                                       142403
     C                     EXSR *PSSR                                     142403
     C                     ENDIF                                          142403
      *                                                                   142403
     C                     ENDIF                                          142403
      *                                                                   250600
      ** Determine if CFT032 is switched on                               250600
      *                                                                   250600
     C                     CALL 'AOSARDR0'                                250600
     C                     PARM *BLANKS   P@RTCD  7                       250600
     C                     PARM '*KEY   ' P@OPTN  7                       250600
     C                     PARM 'CFT032'  P@SARD  6                       250600
     C           SCSARD    PARM SCSARD    DSFDY                           250600
      *                                                                   250600
     C           P@RTCD    IFEQ *BLANKS                                   250600
     C                     MOVE 'Y'       CFT032  1                       250600
     C                     ELSE                                           250600
     C                     MOVE 'N'       CFT032                          250600
      *                                                                   250600
     C           P@RTCD    IFNE '*NRF    '                                250600
     C           *LOCK     IN   LDA                                       250600
     C                     MOVEL'MG0100  'DBPGM                           250600
     C                     MOVEL'SCSARDPD'DBFILE           ************   250600
     C                     Z-ADD29        DBASE            * DBERR 29 *   250600
     C                     MOVEL'CFT032'  DBKEY     P      ************   250600
     C                     OUT  LDA                                       250600
     C                     EXSR *PSSR                                     250600
     C                     ENDIF                                          250600
      *                                                                   250600
     C                     ENDIF                                          250600
      *
      **  Initialise constant fields
     C                     MOVE *LOVAL    CR      1
     C                     BITON'457'     CR
     C                     MOVE *LOVAL    LF      1
     C                     BITON'257'     LF
     C                     MOVELCR        CRLF    2
     C                     MOVE LF        CRLF
      *
      **  CRLF Control Character for message data records
      *
     C                     MOVE CRLF      CTRC
      *
      **  Convert run date to YYMMDD, for Message Generation Date
     C                     CALL 'ZM0060'               15
     C                     PARM BJRDNB    ZMDAY   50
     C                     PARM           ZSDATE  6
      *
      ** Program ended in error.
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '004'     DBASE              * * * * * * *
     C                     MOVEL'       ' DBKEY              * DBERR 004 *
     C                     MOVEL'ZM0060'  DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     MOVE ZSDATE    MGDE
     C*                                                                   113352
      ** Set-up Message Generation  Century flag                          113352
      *                                                                   113352
     C                     MOVELMGDE      YY      20                      113352
     C           YY        IFLT 72                                        113352
     C                     MOVE '2'       CIND                            113352
     C                     ELSE                                           113352
     C                     MOVE '1'       CIND                            113352
     C                     ENDIF                                          113352
     C*                                                                   113352
     C*                                                                   S01408
     C/COPY WNCPYSRC,MG0100CCP2                                           S01408
     C*                                                                   S01408
     C***********                                                         060980
     C****Convert*history*retention*date*to*YYMMDD*********************   060980
     C***********                                                         060980
     C***********BJRDNB    ADD  ENDSMN    ZMDAY                           060980
     C***********          CALL 'ZM0060'               15                 060980
     C***********          PARM           ZMDAY                           060980
     C***********          PARM           ZSDATE                          060980
     C***********                                                         060980
     C***If*the*program*ends*in*error.*********************************   060980
     C***********                                                         060980
     C************IN15     IFEQ '1'                                       060980
     C************LOCK     IN   LDA                                       060980
     C***********          MOVE '006'     DBASE              * * * * * * *060980
     C***********          MOVEL'       ' DBKEY              * DBERR 006 *060980
     C***********          MOVEL'ZM0060'  DBFILE             * * * * * * *060980
     C***********          OUT  LDA                                       060980
     C***********          EXSR *PSSR                                     060980
     C***********          END                                            060980
     C***********          MOVE ZSDATE    @HRDT   6                       060980
     C                     MOVE '100'     MTPY
     C                     MOVE 'N'       MPRY
     C                     MOVE '1'       MGSG
     C                     MOVE 'CRTD'    MGST
      *
     C*                                                                   CEU003
     C** Access Switchable Feature Details                                CEU003
     C*                                                                   CEU003
     C                     CALL 'AOSARDR0'                                CEU003
     C                     PARM *BLANKS   PRTCD   7                       CEU003
     C                     PARM '*VERIFY 'POPTN   7                       CEU003
     C                     PARM 'CEU003'  PSARD   6                       CEU003
     C           SCSARD    PARM SCSARD    DSSDY                           CEU003
     C*                                                                   CEU003
     C           PRTCD     IFEQ *BLANKS                                   CEU003
     C                     MOVE 'Y'       CEU003  1                       CEU003
     C                     ELSE                                           CEU003
     C                     MOVE 'N'       CEU003                          CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CFT013
      ** Access SAR file to determine if CFT013 is installed.             CFT013
      *                                                                   CFT013
     C                     CALL 'AOSARDR0'                                CFT013
     C                     PARM *BLANKS   PRTCD                           CFT013
     C                     PARM '*VERIFY' POPTN                           CFT013
     C                     PARM 'CFT013'  PSARD                           CFT013
     C           SCSARD    PARM SCSARD    DSFDY                           CFT013
      *                                                                   CFT013
      ** An NRF (No Record Found) return code is valid.                   CFT013
      ** Issue database error only for error return codes.                CFT013
      *                                                                   CFT013
     C           PRTCD     IFNE *BLANKS                                   CFT013
     C           PRTCD     ANDNE'*NRF   '                                 CFT013
     C           *LOCK     IN   LDA                                       CFT013
     C                     MOVEL'CFT013'  DBKEY                           CFT013
     C                     MOVEL'SCSARDPD'DBFILE                          CFT013
     C                     Z-ADD40        DBASE                           CFT013
     C                     OUT  LDA                                       CFT013
     C                     EXSR *PSSR                                     CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C           PRTCD     IFEQ *BLANK                                    CFT013
     C                     MOVEL'Y'       CFT013  1                       CFT013
     C                     ELSE                                           CFT013
     C                     MOVEL'N'       CFT013                          CFT013
     C                     ENDIF                                          CFT013
      *                                                                                       CSW201
      ** Check if switchable feature CSW201 is switched on                                    CSW201
      *                                                                                       CSw201
     C                     CALL 'SWIF2001'                                                    CSW201
     C                     PARM           PRTCD                                               CSW201
      *                                                                                       CSW201
     C           PRTCD     IFEQ 'CSW2001'                                                     CSW201
     C                     MOVE 'Y'       CSW201  1                                           CSW201
     C                     ELSE                                                               CSW201
     C                     MOVE 'N'       CSW201                                              CSW201
     C                     ENDIF                                                              CSW201
      ** Access SAR file to determine if CSW024 is installed.                                 204225
      *                                                                                       204225
     C                     CALL 'AOSARDR0'                                                    204225
     C                     PARM *BLANKS   PRTCD                                               204225
     C                     PARM '*VERIFY' POPTN                                               204225
     C                     PARM 'CSW024'  PSARD                                               204225
     C           SCSARD    PARM SCSARD    DSFDY                                               204225
      *                                                                                       204225
      ** An NRF (No Record Found) return code is valid.                                       204225
      ** Issue database error only for error return codes.                                    204225
      *                                                                                       204225
     C           PRTCD     IFNE *BLANKS                                                       204225
     C           PRTCD     ANDNE'*NRF   '                                                     204225
     C           *LOCK     IN   LDA                                                           204225
     C                     MOVEL'CSW024'  DBKEY            ************                       204225
     C                     MOVEL'SCSARDPD'DBFILE           * DBERR 41 *                       204225
     C                     Z-ADD41        DBASE            ************                       204225
     C                     OUT  LDA                                                           204225
     C                     EXSR *PSSR                                                         204225
     C                     ENDIF                                                              204225
      *                                                                                       204225
     C           PRTCD     IFEQ *BLANKS                                                       204225
     C                     MOVEL'Y'       CSW024  1                                           204225
     C                     ELSE                                                               204225
     C                     MOVEL'N'       CSW024                                              204225
     C                     ENDIF                                                              204225
      *                                                                                       204225
      *                                                                                       CSW202
      ** Check if CSW202 is installed                                                         CSW202
      *                                                                                       CSW202
     C                     CALL 'SWIF2002'                                                    CSW202
     C                     PARM *BLANKS   PRTCD                                               CSW202
      *                                                                                       CSW202
     C           PRTCD     IFEQ 'CSW2002'                                                     CSW202
     C                     MOVE 'Y'       CSW202  1                                           CSW202
     C                     ELSE                                                               CSW202
     C                     MOVE 'N'       CSW202                                              CSW202
     C                     ENDIF                                                              CSW202
      *                                                                                       CSW202
      ** Access SAR details to determine if IBAN validation is                                CSW202
      ** switched on (CFT004)                                                                 CSW202
      *                                                                                       CSW202
     C                     CALL 'AOSARDR0'                                                    CSW202
     C                     PARM *BLANKS   PRTCD                                               CSW202
     C                     PARM '*VERIFY 'POPTN                                               CSW202
     C                     PARM 'CFT004'  PSARD                                               CSW202
     C           SCSARD    PARM SCSARD    DSFDY                                               CSW202
      *                                                                                       CSW202
     C           PRTCD     IFEQ *BLANKS                                                       CSW202
     C                     MOVE 'Y'       CFT004  1                                           CSW202
     C                     ELSE                                                               CSW202
     C                     MOVE 'N'       CFT004                                              CSW202
     C                     ENDIF                                                              CSW202
      *                                                                                       CSD015
      ** Access SAR file to determine if Midas Compliance Watch                               CSD015
      ** - Watch List Checking (CSD015) is installed                                          CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY' POPTN                                               CSD015
     C                     PARM 'CSD015'  PSARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
      ** An NRF (No Record Found) return code is valid.                                       CSD015
      ** Issue database error only for error return codes.                                    CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     MOVEL'CSD015'  DBKEY                                               CSD015
     C                     Z-ADD52        DBASE                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANK                                                        CSD015
     C                     MOVEL'Y'       CSD015  1                                           CSD015
      *                                                                                       222385
      ** Access AOWLCCR0 to check if function code MESSGENT is available                      222385
      *                                                                                       222385
     C                     CALL 'AOWLCCR0'                                                    222385
     C                     PARM *BLANKS   @RTCD                                               222385
     C                     PARM '*KEY'    @OPTN                                               222385
     C                     PARM 'MESSGENT'PFUNC   8                                           222385
     C           SDWLCC    PARM SDWLCC    DSFDY                                               222385
      *                                                                                       222385
     C           @RTCD     IFNE *BLANKS                                                       222385
     C           @RTCD     ANDNE'*NRF'                                                        222385
     C                     MOVEL'SDWLCCPD'DBFILE                                              222385
     C                     MOVELPFUNC     DBKEY                                               222385
     C                     Z-ADD32        DBASE                                               222385
     C                     EXSR *PSSR                                                         222385
     C                     ENDIF                                                              222385
      *                                                                                       222385
     C                     ELSE                                                               CSD015
     C                     MOVEL'N'       CSD015                                              CSD015
     C                     MOVEL'N'       W1EWLC                                              222385
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Access SAR file to determine if Midas Manager (CSW025) is installed                  CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY' POPTN                                               CSD015
     C                     PARM 'CSW025'  PSARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
      ** An NRF (No Record Found) return code is valid.                                       CSD015
      ** Issue database error only for error return codes.                                    CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     MOVEL'CSW025'  DBKEY                                               CSD015
     C                     Z-ADD53        DBASE                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANK                                                        CSD015
     C                     MOVEL'Y'       CSW025  1                                           CSD015
     C                     ELSE                                                               CSD015
     C                     MOVEL'N'       CSW025                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                   CFT013
     C                     MOVEL*BLANK    PORTCD                          CFT013
     C                     MOVEA*BLANK    AIND                            CFT013
      *                                                                                       CSW203
      ** Check if CSW203 is installed                                                         CSW203
      *                                                                                       CSW203
     C                     CALL 'SWIF2003'                                                    CSW203
     C                     PARM *BLANKS   PRTCD                                               CSW203
      *                                                                                       CSW203
      ** If CSW203 is installed, set CSW203 flag to 'Y' and set                               CSW203
      ** variable PORTCD to '*CRT103'                                                         CSW203
      *                                                                                       CSW203
     C           PRTCD     IFEQ 'CSW2003'                                                     CSW203
     C                     MOVE 'Y'       CSW203  1                                           CSW203
     C                     MOVEL'*CRT103' PORTCD                                              CSW203
     C                     ELSE                                                               CSW203
     C                     MOVE 'N'       CSW203                                              CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW206
      ** Check if SWIFT 2006 is installed                                                     CSW206
      *                                                                                       CSW206
     C                     CALL 'SWIF2006'                                                    CSW206
     C                     PARM *BLANKS   PRTCD                                               CSW206
      *                                                                                       CSW206
     C           PRTCD     IFEQ 'CSW2006'                                                     CSW206
     C                     MOVE 'Y'       CSW206  1                                           CSW206
     C                     ELSE                                                               CSW206
     C                     MOVE 'N'       CSW206                                              CSW206
     C                     ENDIF                                                              CSW206
      *                                                                                       CSW207
      ** Check for SWIFT 2007 is intalled                                                     CSW207
      *                                                                                       CSW207
     C                     CALL 'SWIF2007'                                                    CSW207
     C                     PARM *BLANKS   P@RTCD                                              CSW207
     C           P@RTCD    IFEQ 'CSW2007'                                                     CSW207
     C                     MOVE 'Y'       CSW207  1                                           CSW207
     C                     ELSE                                                               CSW207
     C                     MOVE 'N'       CSW207                                              CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW213
      ** Check for SWIFT 2013 is intalled                                                     CSW213
      *                                                                                       CSW213
     C                     CALL 'SWIF2013'                                                    CSW213
     C                     PARM *BLANKS   P@RTCD                                              CSW213
     C           P@RTCD    IFEQ 'CSW2013'                                                     CSW213
     C                     MOVE 'Y'       CSW213  1                                           CSW213
     C                     ELSE                                                               CSW213
     C                     MOVE 'N'       CSW213                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW207
      ** Check if SWIFT 2015 enhancement is installed                                         CSW215
      *                                                                                       CSW215
     C                     CALL 'SWIF2015'                                                    CSW215
     C                     PARM *BLANKS   PRTCD                                               CSW215
      *                                                                                       CSW215
     C           PRTCD     IFEQ 'CSW2015'                                                     CSW215
     C                     MOVE 'Y'       CSW215  1                                           CSW215
     C                     ELSE                                                               CSW215
     C                     MOVE 'N'       CSW215                                              CSW215
     C                     ENDIF                                                              CSW215
      *                                                                                       CSW218
      ** Check if switchable feature CSW218 is switched on                                    CSW218
      *                                                                                       CSW218
     C                     CALL 'SWIF2018'                                                    CSW218
     C                     PARM *BLANKS   PRTCD                                               CSW218
      *                                                                                       CSW218
     C           PRTCD     IFEQ 'CSW2018'                                                     CSW218
     C                     MOVEL'Y'       CSW218  1                                           CSW218
     C                     ELSE                                                               CSW218
     C                     MOVEL'N'       CSW218                                              CSW218
     C                     ENDIF                                                              CSW218
      *                                                                                       250600
      ** Parameter List for calling AOOUFMR0                                                  250600
      *                                                                                       250600
     C           PLOUFM    PLIST                                                              250600
     C                     PARM *BLANKS   @RTRN   7                                           250600
     C                     PARM '*KEY   ' @OPTN   7                                           250600
     C                     PARM           PNTWRK  6                                           250600
     C                     PARM           PMSGTP  3                                           250600
     C                     PARM           PMSGFD  5                                           250600
     C                     PARM           BRCA4A  4                                           250600
     C                     PARM           CTRY4A  4                                           250600
     C                     PARM           PCURR   3                                           250600
     C                     PARM           PNOSTF  2                                           250600
     C                     PARM           PACTNF 10                                           250600
     C           MEOUFM    PARM *BLANKS   DSFDY                                               250600
     C*                                                                   CEU003
     C*                                                                   S01408
     C/COPY WNCPYSRC,MG0100CCP5                                           S01408
     C*                                                                   S01408
      *                                                                   CMG001
      *  Access Switchable Feature Details                                CMG001
      *                                                                   CMG001
     C                     CALL 'AOSARDR0'                                CMG001
     C                     PARM *BLANKS   PRTCD   7                       CMG001
     C                     PARM '*VERIFY 'POPTN   7                       CMG001
     C                     PARM 'CMG001'  PSARD   6                       CMG001
     C           SCSARD    PARM SCSARD    DSSDY                           CMG001
      *                                                                   CMG001
     C           PRTCD     IFEQ *BLANKS                                   CMG001
     C                     MOVE 'Y'       CMG001  1                       CMG001
     C                     ELSE                                           CMG001
     C                     MOVE 'N'       CMG001                          CMG001
     C                     ENDIF                                          CMG001
      *                                                                   CMG001
      ** Check if feature CDL099 is enabled                                                   CDL099
      *                                                                                       CDL099
     C                     CALL 'AOSARDR0'                                                    CDL099
     C                     PARM *BLANKS   PRTCD   7                                           CDL099
     C                     PARM '*VERIFY 'POPTN   7                                           CDL099
     C                     PARM 'CDL099'  PSARD   6                                           CDL099
     C           SCSARD    PARM SCSARD    DSSDY                                               CDL099
      *                                                                                       CDL099
     C           PRTCD     IFEQ *BLANKS                                                       CDL099
     C                     MOVE 'Y'       CDL099  1                                           CDL099
     C                     OPEN DEALS                                                         CDL099
     C                     ELSE                                                               CDL099
     C                     MOVE 'N'       CDL099                                              CDL099
     C                     ENDIF                                                              CDL099
      *                                                                                       CDL099
      ** Access system value for CustNoFirstLineFld50                                       MD026727
      *                                                                                     MD026727
     C                     CALL 'AOSVALR0'                                                  MD026727
     C                     PARM *BLANKS   @RTCD                                             MD026727
     C                     PARM AOCAB     P@OP01 20                                         MD026727
     C                     PARM *BLANKS   P@VL01200                                         MD026727
     C                     PARM *BLANKS   P@OP02 20                                         MD026727
     C                     PARM *BLANKS   P@VL02200                                         MD026727
     C                     PARM *BLANKS   P@OP03 20                                         MD026727
     C                     PARM *BLANKS   P@VL03200                                         MD026727
     C                     PARM *BLANKS   P@OP04 20                                         MD026727
     C                     PARM *BLANKS   P@VL04200                                         MD026727
     C                     PARM *BLANKS   P@OP05 20                                         MD026727
     C                     PARM *BLANKS   P@VL05200                                         MD026727
     C                     PARM *BLANKS   P@OP06 20                                         MD026727
     C                     PARM *BLANKS   P@VL06200                                         MD026727
     C                     PARM *BLANKS   P@OP07 20                                         MD026727
     C                     PARM *BLANKS   P@VL07200                                         MD026727
     C                     PARM *BLANKS   P@OP08 20                                         MD026727
     C                     PARM *BLANKS   P@VL08200                                         MD026727
     C                     PARM *BLANKS   P@OP09 20                                         MD026727
     C                     PARM *BLANKS   P@VL09200                                         MD026727
     C                     PARM *BLANKS   P@OP10 20                                         MD026727
     C                     PARM *BLANKS   P@VL10200                                         MD026727
      *                                                                                     MD026727
     C                     MOVEL'N'       PAOCAB  1                                         MD026727
      *                                                                                     MD026727
     C           @RTCD     IFEQ *BLANK                                                      MD026727
     C                     MOVELP@VL01    PAOCAB                                            MD026727
     C                     ENDIF                                                            MD026727
      *                                                                                     MD026727
     C/COPY WNCPYSRC,MGH00083
     C                     ENDSR
     C/EJECT
      *****************************************************************                       CSW202
      *                                                               *                       CSW202
      *  SRSCT  - Determine Support Charge Transparency               *                       CSW202
      *                                                               *                       CSW202
      *****************************************************************                       CSW202
     C           SRSCT     BEGSR                                                              CSW202
      *                                                                                       CSW202
      ** Initialize Support Charge Transparency field                                         CSW202
      *                                                                                       CSW202
     C                     MOVE 'N'       WKSCHT  1                                           CSW202
      *                                                                                       CSW202
     C                     CALL 'AOBICDV0'                                                    CSW202
     C                     PARM *BLANKS   PRTCD                                               CSW202
     C                     PARM WRK18     PBICW  18                                           CSW202
     C                     PARM           PTYPE   7                                           CSW202
     C                     PARM           DSSDY                                               CSW202
      *                                                                                       CSW202
      ** If entry is a customer number, retrieve the Customer Swift                           CSW202
      ** ID                                                                                   CSW202
      *                                                                                       CSW202
     C           PTYPE     IFEQ '*NUMBER'                                                     CSW202
     C           WFLAG     ANDEQ'Y'                                                           CSW202
     C           PTYPE     OREQ '*SHNAME'                                                     CSW202
     C           WFLAG     ANDEQ'Y'                                                           CSW202
      *                                                                                       CSW202
     C                     MOVELDSSDY     SDCUST                                              CSW202
     C                     MOVELBBCSID    WRK18                                               CSW202
      *                                                                                       CSW202
     C                     CALL 'AOBICDV0'                                                    CSW202
     C                     PARM *BLANKS   PRTCD                                               CSW202
     C                     PARM WRK18     PBICW  18                                           CSW202
     C                     PARM           PTYPE   7                                           CSW202
     C                     PARM           DSSDY                                               CSW202
      *                                                                                       CSW202
     C                     ENDIF                                                              CSW202
      *                                                                                       CSW202
      ** If entry is a BIC Identifier, check for the country code                             CSW202
      ** of sender/destination                                                                CSW202
      *                                                                                       CSW202
     C           PTYPE     IFEQ '*BIC'                                                        CSW202
     C                     MOVELDSSDY     MEBICD                                              CSW202
     C           2         SUBSTBDBICC:5  WCNTY   2                                           CSW202
      *                                                                                       CSW202
      ** Determine if sender/destination country code exists in ISO                           CSW202
      ** country code file.  If found, check if 'Support Charges                              CSW202
      ** Transparency flag is 'Y'                                                             CSW202
      *                                                                                       CSW202
     C           WCNTY     CHAINMEISOCL1             52                                       CSW202
      *                                                                                       CSW202
     C           *IN52     IFEQ *OFF                                                          CSW202
     C********** M3SCHT    ANDEQ'Y'                                                    CSW202 CSW213
     C********** CSW213    IFEQ 'Y'                                                  CSW213 MD022039
     C********** M3IBAR    ANDEQ'Y'                                                  CSW213 MD022039
     C**********           MOVE 'Y'       WKIBAR  1                                  CSW213 MD022039
     C**********           ELSE                                                      CSW213 MD022039
     C           M3SCHT    IFEQ 'Y'                                                           CSW213
     C           CSW213    ANDEQ'N'                                                         MD023383
     C           CSW213    OREQ 'Y'                                                         MD022039
     C           M3IBAR    ANDEQ'Y'                                                         MD022039
     C                     MOVE 'Y'       WKSCHT                                              CSW202
     C                     ENDIF                                                              CSW213
     C**********           ENDIF                                                     CSW213 MD022039
     C                     ENDIF                                                              CSW202
     C                     ENDIF                                                              CSW202
      *                                                                                       CSW202
     C                     ENDSR                                                              CSW202
      *****************************************************************                       CSW202
      /EJECT                                                                                  CSW202
      *****************************************************************                       CSW202
      *                                                               *                       CSW202
      *  SRIBAN - Determine if Beneficiary Bank is in valid IBAN      *                       CSW202
      *           format                                              *                       CSW202
      *                                                               *                       CSW202
      *****************************************************************                       CSW202
     C           SRIBAN    BEGSR                                                              CSW202
      *                                                                                       CSW202
     C           34        SUBSTMGBENA:2  PIBAN                                               CSW202
      *                                                                                       CSW202
     C                     MOVE *BLANKS   P@IBAN 34                                           CSW202
      *                                                                                       CSW202
     C                     CALL 'AOIBANR3'                                                    CSW202
     C                     PARM           PRTCD                                               CSW202
     C                     PARM           PIBAN  47                                           CSW202
     C                     PARM           POWITH 47                                           CSW202
     C           P@IBAN    PARM           PONOBL 34                                           CSW202
      *                                                                                       CSW202
     C           PRTCD     IFEQ *BLANKS                                                       CSW202
      *                                                                                       CSW202
     C           1         SUBSTP@IBAN:1  WTRD1   1                                           CSW202
     C           1         SUBSTP@IBAN:2  WTRD2   1                                           CSW202
     C           1         SUBSTP@IBAN:3  WTRD3   1                                           CSW202
     C           1         SUBSTP@IBAN:4  WTRD4   1                                           CSW202
      *                                                                                       CSW202
     C           WTRD1     LOKUPALPH                     88                                   CSW202
      *                                                                                       CSW202
     C           *IN88     IFEQ *ON                                                           CSW202
     C           WTRD2     LOKUPALPH                     88                                   CSW202
     C                     ENDIF                                                              CSW202
      *                                                                                       CSW202
     C           *IN88     IFEQ *ON                                                           CSW202
     C           WTRD3     LOKUPNUMC                     88                                   CSW202
     C                     ENDIF                                                              CSW202
      *                                                                                       CSW202
     C           *IN88     IFEQ *ON                                                           CSW202
     C           WTRD4     LOKUPNUMC                     88                                   CSW202
     C                     ENDIF                                                              CSW202
      *                                                                                       CSW202
      ** Entry is in valid IBAN format.                                                       CSW202
      *                                                                                       CSW202
     C           *IN88     IFEQ *ON                                                           CSW202
      *                                                                                       CSW202
     C                     CALL 'AOIBANR5'                                                    CSW202
     C                     PARM *BLANKS   PRTCD                                               CSW202
     C                     PARM           P@IBAN                                              CSW202
     C           PRTCD     IFEQ *BLANKS                                                       CSW202
     C                     MOVE 'Y'       WIBANF                                              CSW202
     C                     ENDIF                                                              CSW202
      *                                                                                       CSW202
     C                     ENDIF                                                              CSW202
      *                                                                                       CSW202
     C                     ENDIF                                                              CSW202
      *                                                                                       CSW202
     C                     ENDSR                                                              CSW202
      *****************************************************************                       220913
      *                                                               *                       220913
      *  SRICAR - Insert Customer number                              *                       220913
      *                                                               *                       220913
      *****************************************************************                       220913
      *                                                                                       220913
     C           SRICAR    BEGSR                                                              220913
      *                                                                                       220913
      * Insert customer number before storing data to MULT (last line)                        220913
      * overrding last address line if necessary                                              220913
     C           MTAG      IFEQ ':50K:'                                                       220913
     C                     SELEC                                                              220913
     C           ZSADD2    WHEQ *BLANK                                                        220913
     C           ZSADD3    ANDEQ*BLANK                                                        220913
     C           ZSADD4    ANDEQ*BLANK                                                        220913
     C                     MOVELMGPOCN    ZSADD2                                              220913
     C           ZSADD2    WHEQ *BLANK                                                        220913
     C           ZSADD3    ANDEQ*BLANK                                                        220913
     C           ZSADD4    ANDNE*BLANK                                                        220913
     C                     MOVELZSADD4    ZSADD2                                              220913
     C                     MOVELMGPOCN    ZSADD3                                              220913
     C                     MOVEL*BLANK    ZSADD4                                              220913
     C           ZSADD2    WHEQ *BLANK                                                        220913
     C           ZSADD3    ANDNE*BLANK                                                        220913
     C           ZSADD4    ANDEQ*BLANK                                                        220913
     C                     MOVELZSADD3    ZSADD2                                              220913
     C                     MOVELMGPOCN    ZSADD3    P                                         220913
     C                     MOVEL*BLANK    ZSADD4                                              220913
     C           ZSADD2    WHEQ *BLANK                                                        220913
     C           ZSADD3    ANDNE*BLANK                                                        220913
     C           ZSADD4    ANDNE*BLANK                                                        220913
     C                     MOVELZSADD3    ZSADD2                                              220913
     C                     MOVELZSADD4    ZSADD3                                              220913
     C                     MOVELMGPOCN    ZSADD4    P                                         220913
     C           ZSADD2    WHNE *BLANK                                                        220913
     C           ZSADD3    ANDEQ*BLANK                                                        220913
     C           ZSADD4    ANDEQ*BLANK                                                        220913
     C                     MOVELMGPOCN    ZSADD3                                              220913
     C           ZSADD2    WHNE *BLANK                                                        220913
     C           ZSADD3    ANDEQ*BLANK                                                        220913
     C           ZSADD4    ANDNE*BLANK                                                        220913
     C                     MOVELZSADD4    ZSADD3                                              220913
     C                     MOVELMGPOCN    ZSADD4    P                                         220913
     C                     OTHER                                                              220913
     C                     MOVELMGPOCN    ZSADD4    P                                         220913
     C                     ENDSL                                                              220913
     C                     ENDIF                                                              220913
      *                                                                                       220913
     C                     ENDSR                                                              220913
      *                                                                                       220913
      *****************************************************************                     MD026727
      *                                                               *                     MD026727
      *  SRICNA - Insert Customer number on first line (:50A:)        *                     MD026727
      *                                                               *                     MD026727
      *****************************************************************                     MD026727
      *                                                                                     MD026727
     C           SRICNA    BEGSR                                                            MD026727
      *                                                                                     MD026727
      * Insert customer number on first line.                                               MD026727
     C                     MOVELZSADD1    ZSADD2                                            MD026727
     C                     MOVE *BLANKS   ZSADD1                                            MD026727
     C           '/'       CAT  MGPOCN    ZSADD1                                            MD026727
     C                     MOVE *BLANKS   ZSADD3                                            MD026727
     C                     MOVE *BLANKS   ZSADD4                                            MD026727
     C                     MOVE *BLANKS   ZSADD5                                            MD026727
      *                                                                                     MD026727
     C                     ENDSR                                                            MD026727
      *****************************************************************                     MD026727
      *                                                               *                     MD026727
      *  SRICNK - Insert Customer number on first line (:50K:)        *                     MD026727
      *                                                               *                     MD026727
      *****************************************************************                     MD026727
      *                                                                                     MD026727
     C           SRICNK    BEGSR                                                            MD026727
      *                                                                                     MD026727
      * Insert customer number on first line overrding last address                         MD026727
      * line as necessary                                                                   MD026727
     C                     SELEC                                                            MD026727
     C           ZSADD2    WHEQ *BLANK                                                      MD026727
     C           ZSADD3    ANDEQ*BLANK                                                      MD026727
     C           ZSADD4    ANDEQ*BLANK                                                      MD026727
     C                     MOVELZSADD1    ZSADD2                                            MD026727
     C                     MOVE *BLANKS   ZSADD1                                            MD026727
     C           '/'       CAT  MGPOCN    ZSADD1                                            MD026727
     C           ZSADD2    WHEQ *BLANK                                                      MD026727
     C           ZSADD3    ANDEQ*BLANK                                                      MD026727
     C           ZSADD4    ANDNE*BLANK                                                      MD026727
     C                     MOVELZSADD1    ZSADD2                                            MD026727
     C                     MOVELZSADD4    ZSADD3                                            MD026727
     C                     MOVE *BLANKS   ZSADD1                                            MD026727
     C           '/'       CAT  MGPOCN    ZSADD1                                            MD026727
     C           ZSADD2    WHEQ *BLANK                                                      MD026727
     C           ZSADD3    ANDNE*BLANK                                                      MD026727
     C           ZSADD4    ANDEQ*BLANK                                                      MD026727
     C                     MOVELZSADD3    ZSADD2                                            MD026727
     C                     MOVE *BLANKS   ZSADD1                                            MD026727
     C           '/'       CAT  MGPOCN    ZSADD1    P                                       MD026727
     C           ZSADD2    WHEQ *BLANK                                                      MD026727
     C           ZSADD3    ANDNE*BLANK                                                      MD026727
     C           ZSADD4    ANDNE*BLANK                                                      MD026727
     C                     MOVELZSADD1    ZSADD2                                            MD026727
     C                     MOVE *BLANKS   ZSADD1                                            MD026727
     C           '/'       CAT  MGPOCN    ZSADD1    P                                       MD026727
     C           ZSADD2    WHNE *BLANK                                                      MD026727
     C           ZSADD3    ANDEQ*BLANK                                                      MD026727
     C           ZSADD4    ANDEQ*BLANK                                                      MD026727
     C                     MOVELZSADD2    ZSADD3                                            MD026727
     C                     MOVELZSADD1    ZSADD2                                            MD026727
     C                     MOVE *BLANKS   ZSADD1                                            MD026727
     C           '/'       CAT  MGPOCN    ZSADD1                                            MD026727
     C           ZSADD2    WHNE *BLANK                                                      MD026727
     C           ZSADD3    ANDEQ*BLANK                                                      MD026727
     C           ZSADD4    ANDNE*BLANK                                                      MD026727
     C                     MOVELZSADD2    ZSADD3                                            MD026727
     C                     MOVELZSADD1    ZSADD2                                            MD026727
     C                     MOVE *BLANKS   ZSADD1                                            MD026727
     C           '/'       CAT  MGPOCN    ZSADD1    P                                       MD026727
     C           ZSADD2    WHNE *BLANK                                                      MD026727
     C           ZSADD3    ANDNE*BLANK                                                      MD026727
     C           ZSADD4    ANDNE*BLANK                                                      MD026727
     C                     MOVELZSADD4    ZSADD5                                            MD026727
     C                     MOVELZSADD3    ZSADD4                                            MD026727
     C                     MOVELZSADD2    ZSADD3                                            MD026727
     C                     MOVELZSADD1    ZSADD2                                            MD026727
     C                     MOVE *BLANKS   ZSADD1                                            MD026727
     C           '/'       CAT  MGPOCN    ZSADD1    P                                       MD026727
     C                     OTHER                                                            MD026727
     C                     MOVE *BLANKS   ZSADD1                                            MD026727
     C           '/'       CAT  MGPOCN    ZSADD1    P                                       MD026727
     C                     ENDSL                                                            MD026727
      *                                                                                     MD026727
     C                     ENDSR                                                            MD026727
      *                                                                                     MD026727
      *****************************************************************                       CSW202
      /EJECT                                                                                  CSW202
      *****************************************************************                       CSD015
      *                                                               *                       CSD015
      *  SRWTCH - Watch List Checking Processing                      *                       CSD015
      *                                                               *                       CSD015
      *****************************************************************                       CSD015
      *                                                                                       CSD015
     C           SRWTCH    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Check if message if for automatic release. If yes, default to CRTD status            CSD015
      ** and setup Automatic Release flag.                                                    CSD015
      *                                                                                       CSD015
     C                     MOVEL'N'       PARLS                                               CSD015
      *                                                                                       CSD015
     C           MGST      IFEQ 'RSND'                                                        CSD015
     C           NWRK      IFEQ 'SWIFT'                                                       CSD015
     C           NWRK      OREQ 'TELEX'                                                       CSD015
     C           NWRK      OREQ 'STTX'                                                        CSD015
     C                     MOVEL'CRTD'    MGST                                                CSD015
     C                     MOVEL'Y'       PARLS   1                                           CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Set-up parameter for Compliance Engine program                                       CSD015
      *                                                                                       CSD015
      ** Initialise WLFDS data structure                                                      CSD015
      *                                                                                       CSD015
     C                     CLEARWLFDS                                                         CSD015
     C                     Z-ADD*ZERO     W4VDAT                                              CSD015
     C                     Z-ADD*ZERO     W4MDAT                                              CSD015
     C                     Z-ADD*ZERO     W4AMT1                                              CSD015
     C                     Z-ADD*ZERO     W4AMT2                                              CSD015
      *                                                                                       CSD015
      ** Set the following details                                                            CSD015
      *                                                                                       CSD015
     C                     MOVELTRNO      W4IDEN                                              CSD015
     C                     MOVELMTPY      W4ITEM                                              CSD015
     C                     MOVEL'MGOREF'  W4FUNT                                              CSD015
     C                     MOVELMGPOBR    W4BRCH                                              CSD015
     C                     MOVELDECN      W4CNUM                                              CSD015
     C                     Z-ADDBJRDNB    W4DDAT                                              CSD015
     C                     MOVELPARLS     W4ARLS                                              CSD015
      *                                                                                       CSD015
      ***Send*transaction*details to Compliance Watch by calling SDWLCLOP              CSD015 221145
      *********************                                                            CSD015 221145
     C*********************CALL 'SDWLCLOP'                                             CSD015 221145
     C*********************PARM           WLFDS                                        CSD015 221145
     C*********************PARM *BLANKS   PSTRNG                                       CSD015 221145
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
     C/EJECT                                                                                  CSD015
      *****************************************************************                       221145
      *                                                               *                       221145
      *  WLCDQ - Submit information to Watch List Check Dtaq          *                       221145
      *                                                               *                       221145
      *****************************************************************                       221145
      *                                                                                       221145
     C           WLCDQ     BEGSR                                                              221145
      *                                                                                       221145
      *  Send transaction to compliance engine program                                        221145
      *                                                                                       221145
     C                     CALL 'SDWLCLOP'                                                    221145
     C                     PARM           WLFDS                                               221145
     C                     PARM *BLANKS   PSTRNG                                              221145
      *                                                                                       221145
      *                                                                                       221145
     C                     ENDSR                                                              221145
      *                                                                                       221145
     C/EJECT                                                                                  221145
      *****************************************************************                       CSW215
      *                                                               *                       CSW215
      *  SRFM59 - Determine if Beneficiary is in 59F Format           *                       CSW215
      *                                                               *                       CSW215
      *****************************************************************                       CSW215
     C           SRFM59    BEGSR                                                              CSW215
      *                                                                                       CSW215
     C                     MOVELMGBENN    PINP1     P                                         CSW215
      *                                                                                       CSW215
     C                     CALL 'MG001001'                                                    CSW215
     C                     PARM *BLANKS   PRTRN                                               CSW215
     C                     PARM 'FRMT'    PVTYP                                               CSW215
     C                     PARM           PINP1  35                                           CSW215
     C                     PARM *BLANKS   PINP2  35                                           CSW215
     C                     PARM *BLANKS   PINP3  35                                           CSW215
     C                     PARM *BLANKS   PINP4  35                                           CSW215
     C                     PARM *BLANKS   PINP5  35                                           CSW215
     C                     PARM NWRK      PNTWRK                                              CSW215
     C                     PARM           PMSGTP                                              CSW215
     C                     PARM ':59F:'   PMSGFD                                              CSW215
     C                     PARM MGBRCA    PBRCH                                               CSW215
     C                     PARM           PCTRY                                               CSW215
     C                     PARM MGCCY     PCURR                                               CSW215
     C                     PARM           PNOSTF                                              CSW215
     C                     PARM *BLANKS   PMSGL1                                              CSW215
     C                     PARM *BLANKS   PMSGL2                                              CSW215
     C                     PARM *BLANKS   PMSGL3                                              CSW215
     C                     PARM *BLANKS   PMSGL4                                              CSW215
     C                     PARM *BLANKS   PMSGL5                                              CSW215
     C                     PARM *BLANKS   PMSGID                                              CSW215
     C                     PARM *BLANK    PERTP                                               CSW215
      *                                                                                       CSW215
     C           PRTRN     IFEQ *BLANKS                                                       CSW215
     C                     MOVEL'Y'       WRK59F                                              CSW215
     C                     MOVEL':59F:'   MTAG                                                CSW215
     C                     MOVE PMSGL1    ZSADD1                                              CSW215
     C                     MOVE PMSGL2    ZSADD2                                              CSW215
     C                     MOVE PMSGL3    ZSADD3                                              CSW215
     C                     MOVE PMSGL4    ZSADD4                                              CSW215
     C                     MOVE PMSGL5    ZSADD5                                              CSW215
     C                     ENDIF                                                              CSW215
      *                                                                                       CSW215
     C                     ENDSR                                                              CSW215
      *****************************************************************                       CSW215
      /EJECT                                                                                  CSW215
      *****************************************************************
      *   *PSSR - error handling                                      *
      *****************************************************************
      *
     C           *PSSR     BEGSR
      *
      **  Write database error to report
      *
     C                     OPEN MG0100AU
     C                     WRITEHEAD
     C                     WRITEDBERROR
      *
     C                     SETON                     U7U8LR
     C                     DUMP
     C                     RETRN
      *
     C                     ENDSR
     C/COPY WNCPYSRC,MG0100C036
     C/COPY MGCPYSRC,SWIFTTRANS                                           BLI605
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
** MSGA   Messages
Settlement - pay
Customer details not found on SDCUSTPD
Nostro customer not found on SDNOSTPD
ZM0040 (format ccy and amount) call ended in error
ZM0050 (format SWIFT address) call ended in error
ZM0055 (format SWIFT 'D' type address) call ended in error
Duplicate TRN key built for this message
Field entry is mandatory
Counterparty Nostro Details not found on SDCNSTPD
** ABTB                                                                   CFT013
/BENONLY/                                                                 CFT013
/CHEQUE/                                                                  CFT013
/CORPTRAD/                                                                CFT013
/HOLD/                                                                    CFT013
/INTRACOM/                                                                CFT013
/PHON/                                                                    CFT013
/PHONBEN/                                                                 CFT013
/PHONIBK/                                                                 CFT013
/RCB/                                                                     CFT013
/TELE/                                                                    CFT013
/TELEBEN/                                                                 CFT013
/TELEIBK/                                                                 CFT013
/OCMT/                                                                    CFT013
/CHGS/                                                                    CFT013
/REPA/                                                                                        CSW202
**   ALPH  - Array of alphabetic                                                              CSW202
ABCDEFGHIJKLMNOPQRSTUVWXYZ                                                                    CSW202
**   NUMC  - Array of numeric                                                                 CSW202
1234567890                                                                                    CSW202
