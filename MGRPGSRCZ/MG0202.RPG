     H        1                           F
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas MG Format financial inst transfer message')      *
     F*****************************************************************
     F*                                                               *
     F*  Midas - MESSAGE GENERATION                                   *
     F*                                                               *
     F*  MG0202 - FORMAT FINANCIAL INSTITUTION TRANSFER MESSAGE       *
     F*           FOR BOTH MT202 AND MT203 MESSAGES                   *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      *  Prev Amend No. CDL099             Date 06Oct17               *
      *                 MD036542           Date 02Dec15               *
      *                 MD035921           Date 16Oct15               *
      *                 CSW215             Date 06Apr15               *
      *                 CLE148             Date 23Jul12               *
      *                 AR1002987          Date 11Jul12               *
      *                 CSW212             Date 03Mau12               *
      *                 AR787620           Date 10Jun11               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 BUG25980           Date 11Sep09               *
      *                 CSW209             Date 01Apr09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 CPK027             Date 17Apr07               *
      *                 140901             Date 13Dec06               *
      *                 CSW050             Date 08Aug06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242622             Date 26Sep06               *
      *                 172477             Date 06Jun06               *
      *                 CMG001             Date 15Feb06               *
      *                 240120             Date 31May06               *
      *                 235581             Date 31May06               *
      *                 CSD031             Date 10Apr06               *
      *                 227679             Date 26Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 BUG6076            Date 04Mar05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 222373             Date 27Oct03               *
      *                 222385             Date 23Oct03               *
      *                 221145             Date 08Sep03               *
      *                 219242             Date 01Jul03               *
      *                 219241             Date 01Jul03               *
      *                 CSD015             Date 14Oct02               *
      *                 210796             Date 22Nov02               *
      * Midas Release 4.01.01 ----------------------------------------*
      *                 CSW202             Date 20May02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CSW025             Date 26Mar02               *
      *                 193524             Date 10Aug01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 196833             Date 16Aug01               *
      *                 CSW201             Date 02May01               *
      *                 187271             Date 13Jul01               *
      *                 183583             Date 11Jun01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 184930             Date 12Dec00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CDL008             Date 02May00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 110745             Date 13Jun00               *
      *                 138742             Date 07Jul98               *
      * Midas DBA 3.02 -----------------------------------------------*
     F*                 CSW020             DATE 04JAN00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 153367             Date 26Feb99               *
     F*                 142403             Date 26Feb99               *
     F*                 141572             DATE 21SEP98               *
     F*                 149106             Date 09Dec98               *
     F*                 145304             Date 20Oct98               *
     F*                 144710             Date 20OCT98               *
     F*                 144171             DATE 06OCT98               *
     F*                 129211             DATE 12MAR98               *
     F*                 CEU003             DATE 29MAR98               *
     F*                 113352            DATE 29MAR98                *
     F*                 CLE007             Date 22May97               *
     F*                 105577             DATE 21JUL97               *
     F*                 CDL002             DATE 17SEP97               *
     F*                 111106             DATE 14MAR97               *
     F*                 109281             DATE 25FEB97               *
     F*                 S01408             DATE 11OCT96               *
     F*                 S01408             DATE 04SEP96               *
     F*                 S01408             DATE 08AUG96               *
     F*                 CSW096             DATE 03JUN96               *
     F*                 078649             DATE 31MAY96               *
     F*                 103277             DATE 16MAY96               *
     F*                 S01408             DATE 09JAN96               *
     F*                 S01408             DATE 02AUG95               *
     F*                 087652             DATE 16JUN95               *
     F*                 S01408             DATE 12JUN95               *
     F*                 087256             DATE 10MAY95               *
     F*                 084320             DATE 07MAR95               *
     F*                 080096             DATE 12JAN95               *
     F*                 S01408             DATE 11NOV94               *
     F*                 051356             DATE 08NOV93               *
     F*                 S01421             DATE 18AUG93               *
     F*                 E42086             DATE 10JUL92               *
     F*                 E40242             DATE 25JUN92               *
     F*                 E27567             DATE 11OCT91               *
     F*                 E29588             DATE 07OCT91               *
     F*                                                               *
      *****************************************************************
      *                                                               *
      *  MD046248 - Finastra Rebranding                               *
      *  CDL099 - Split Value Date                                    *
      *  MD036542 - Missing "/" before the account in the 53B field   *
      *             of MT0202.                                        *
      *  MD035921 - MT202 missing tag 53 - Account Identification     *
      *  CSW215 - SWIFT Changes 2015                                  *
      *  CLE148 - Alpha Loan Reference                                *
      *  AR1002987 - Various error in MT202COV output when BEN        *
      *              is defined for Sender-to-Receiver (Cover) field  *
      *  CSW212 - SWIFT 2012 Changes                                  *
      *  AR787620 - Hooks Incorporation                               *
      *             WNCPYSRC,MGH00004                                 *
      *             WNCPYSRC,MGH00005                                 *
      *             WNCPYSRC,MGH00009                                 *
      *             WNCPYSRC,MGH00010                                 *
      *             WNCPYSRC,MGH00011                                 *
      *             WNCPYSRC,MGH00012                                 *
      *             WNCPYSRC,MGH00006                                 *
      *             WNCPYSRC,MGH00007                                 *
      *             WNCPYSRC,MGH00008                                 *
      *  BUG25980 - Applied fix for BUG25355.                         *
      *  BUG25355 - MT202 contains Field :119: COVCUS33 and field     *
      *             tag 58A is missing                                *
      *  CSW209 - SWIFT 2009 Changes                                  *
      *  CPK027 - Errors in compiling MP1_3_TTTS - Change NUAWBN to 6A*
      *  140901 - When account with bank is same as beneficiary or    *
      *           destination customer, do not output account with    *
      *           in field 57.                                        *
      *  CSW050 - Generate Multiple Messages in MidasPlus             *
      *           Fix applied by 242622.                              *
      *  242622 - Generate Multiple Messages in MidasPlus             *
      *         - Additional fix to ensure that deletion of message   *
      *           will only be done when read is done successfully.   *
      *  172477 - Remove fix 078649.  This will include Feild 57 even *
      *           if Account with Bank is the same as the Nostro      *
      *           Customer. Applied fix 170449.                       *
      *  CMG001 - Amend Field 53B to reflect the Nostro Account Number*
      *  240120 - Applied fix 235581.                                 *
      *  235581 - Field 58 (Beneficiary) of MT202 for Interest Payment*
      *           of an IRS deal shows wrong Report Name and Report   *
      *           Town. Ensure that the value of MPSN to be written   *
      *           to PF/MGOEXTPD is correct by avoiding to format     *
      *           MT203 header when 2 separate MT202's will be        *
      *           generated for Interest Payment and Principal        *
      *           Exchange of an IRS deal.                            *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
     F*  227679 - Field :32B: should not be used for MT202 message.   *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  BUG6076- Cancellation processing for interest and cover      *
      *           messages not working in MMM.                        *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222373 - Parameter mismatch.                                 *
      *  222385 - SWIFT msgs are Watch List checked regardless of     *
      *           configuration file setting                          *
      *  221145 - Compliance Watch WLC: Allow checking of multiple    *
      *           SWIFT messages                                      *
      *  219242 - Not possible to create MT103+ payment msg from      *
      *           non-FT transaction (Recompile)                      *
      *  219241 - Defaulting of "Details of Charges" assign a         *
      *           system value (Recompile)                            *
      *  CSD015 - Midas Compliance Watch - Watch List Checking.       *
      *  210796 - Extend Our a/c at Nostro field                      *
      *  CSW202 - SWIFT 2002 Standards Update                         *
      *  CSW025 - Midas Message Manager                               *
      *           - Pass original change type & suppress multiples    *
      *  193524 - Do not produce MT203 for CLS messages               *
      *  196833 - Additional SWIFT Address for CLS Nostros            *
      *  CSW201 - SWIFT 2001 Standards Update                         *
      *  187271 - Incorrect currency code in message tag 32 due to    *
      *           override in ZSCCY when tag 72 is formatted. Fix is  *
      *           to save field ZSCCY before executing subroutine     *
      *           MESG which formats fields 56/57/58/72.              *
      *  183583 - Add extension file MGOEXTPD to store customer no.   *
      *           of field with SWIFT address.                        *
     F*  184930 - Error caused by CSW020.  FLD19 being subtract twice *
      *  CDL008 - Continuous Linked Settlement                        *
     F*  110745 - Incorrect incorporation of 109281                   *
     F*  138742 - Default priority urgent, delivery notification      *
     F*           required and non-delivery warning required flags    *
     F*           are not defaulted from SDCURRPD.                    *
     F*  CSW020 - SWIFT Decimal Places                                *
     F*           Take in account the swift decimal places to         *
     F*           calculate the Sum of Amounts.                       *
     F*  153367 - Should generate field :57: (Account w/ Bank) if     *
     F*           field :56: (Intermediary Bank) was generated.       *
     F*  142403 - Swift Trn of fee messages are to start with F.      *
     F*  141572 - Setup CINDV (century flag) SVDT ( value date).      *
     F*  149106 - Cover MT202 should not contain ERI information.     *
     F*  145304 - Format field 72:/OCMT/xxxnnnn, swiftcode line with a*
     F*           final '/'.                                          *
     F*  144710 - Output "/OCMT/" first before "Bank to Bank" fields. *
     F*           This is to ensure correct order of codewords        *
     F*           in case /CHGS/ is entered on bank to bank fields    *
     F*  144171 - Amount in SWIFT messages showing the original amount*
     F*           and not the Euro equivalent.                        *
     F*  129211 - MT202 Cover Note processing not working properly.   *
     F*           ENDIF statement in the wrong place, so if a cover   *
     F*           note required and a record exists in MGCOVRPD,      *
     F*           details not set up in current occurance of MULT, so *
     F*           incorrect data output to MGOMSGPD. Fix is to move   *
     F*           ENDIF statement.                                    *
     F*  CEU003 - EMU Dealing Settlement Ccy Conversion               *
     F*  113352 - Set-up CIND (Century flag)  to correct year2000     *
     F*           display problem.                                    *
     F*  CLE007 - Customer Lending Enhancement -Others (T3)           *
     F*  CDL002 - FX Netting                                          *
     F*           Field 20: is NT/Net Number/Sequence                 *
     F*           Field 21: is Net Reference                          *
     F*  105577 - Integration of fix 82042                            *
     F*           PUT CORRECT RELATED REF IN COVER MT202              *
     F*  111106 - Fields are not initialised                          *
     F*  109281 - Correct status of part of multiple message          *
     F*           must always be Created                              *
     F*  S01408 - Addition of core hook MG0202CP14                    *
     F*  S01408 - Addition of core hook MG0202CP13                    *
     F*         - Addition of core hook MG0202CP12                    *
     F*         - Addition of core hook MG0202CP11                    *
     F*         - Addition of core hook MG0202CP10                    *
     F*         - Addition of core hook MG0202CCP9                    *
     F*  S01408 - Addition of core hook MG0202CCP8                    *
     F*         - Addition of core hook MG0202CCP7                    *
     F*  CSW096 - Swift Changes 1996:                                 *
     F*           Set up field 57 if MGAWBB is non-blank.             *
     F*  078649 - If Destination Address is the same as ACCOUNT       *
     F*           WITH INSTITUTION (Field 57), then output blank      *
     F*           Field 57.                                           *
     F*  103277 - INCORRECT LENGH OF ACL. FIRST 8 CHARS CAN BE        *
     F*           '/BEN//SC'. FROM POSITION 6 THIS IS MOVED INTO      *
     F*           ACLINE, WHICH WILL START WITH '/SC' WHICH IS NOT    *
     F*           VALID WHEN IT SHOULD BE '//SC', CHANGE START        *
     F*           POSITION TO BE 5.                                   *
     F*  S01408 - Addition of core hook MG0202CCP5                    *
     F*           Addition of core hook MG0202CCP6                    *
     F*           Addition of core hook MG0202FFP1                    *
     F*           Addition of core hook MG0202IIP1                    *
     F*  S01408 - Addition of core hook MG0202CCP2                    *
     F*           Addition of core hook MG0202CCP3                    *
     F*           Addition of core hook MG0202CCP4                    *
     F*  087652 - Cater for blank address lines                       *
     F*  S01408 - Addition of core hook MG0202CCP1                    *
     F*           Addition of core hook MG0202IIPG                    *
     F*           Addition of core hook MG0202FFPG                    *
     F*  087256 - For multiple part MT210 messages the second and     *
     F*           subsequent MGOREFPD records should have a status    *
     F*           of 'CRTD'                                           *
     F*  084320 - Do not set on U7 for a non-fatal error, as this     *
     F*           will cause the controlling component to end         *
     F*           abnormally.                                         *
     F*  080096 - RECOMPILE BECAUSE COPY MEMBER MGCPYSRC,SWIFTTRANS   *
     F*           CHANGED                                             *
     F*  S01408 - Addition of core hook MG0202CCPG                    *
     F*  051356 - Change the maximum limit of 10 parts for multiple   *
     F*           MT203 to 8 parts.                                   *
     F*  S01421 - REPLACE THE SWIFT TRANSLATION TABLE WITH A          *
     F*           /COPY STATEMENT (SWIFTTRANS).                       *
     F*                                                               *
     F*  E42086 - CATER FOR BLANK ADDRESS LINES                       *
     F*  E40242 - Recompiled due to changes to field ASEQ             *
     F*  E27567 - BRANCH FILE SWIFT ID, SHOULD NOT BE MANDATORY       *
     F*           HENCE ROUTING ROUTINE SHOULD REFLECT THIS.          *
     F*  E29588 - POST COLLECTION SWIFT RATIONALISATION FIXES         *
     F*  RE-WRITTEN FOR S01344 - SWIFT RATIONALISATION PHASE 2        *
     F*                                                               *
     F*****************************************************************
      *                                                                   S01408
     F/COPY WNCPYSRC,MG0202FFPG                                           S01408
      *                                                                   S01408
     FMGF202L0UF  E           K        DISK
     F                                              KCOMIT
     FMGF202L1UF  E           K        DISK                                                  BUG6076
     F                                              KCOMIT                                   BUG6076
     F            MGF202D0                          KRENAMEMGF202D1                          BUG6076
     F*MGOREFL0IF**E           K        DISK                              E29588
     F************MGOREFD0                          KRENAMEMGREFL0        E29588
     FMGOREFA6IF  E           K        DISK                               E29588
     F            MGOREFD0                          KRENAMEMGREFL0
     FSDNOSTL8IF  E           K        DISK                                                   196833
     FSDNOSTL0IF  E           K        DISK                                                 MD035921
     F/COPY WNCPYSRC,MG0202F003
     FMGOREFPDO   E                    DISK
     F                                              KCOMIT
     FMGOMSGPDO   E                    DISK
     F/COPY WNCPYSRC,MG0202F002
     F                                              KCOMIT
     FFXNETML4UF  E           K        DISK                           U5  CDL002
     F                                              KCOMIT                CDL002
     F/COPY WNCPYSRC,MG0202F001
     FMGOEXTPDO   E                    DISK                               183583
     F                                              KCOMIT                183583
     FMG0202P1O   E                    PRINTER                        UC
     FMG0202AUO   E                    PRINTER                        UC
     FMGCOVRPDIF  E           K        DISK                               105577
     FMGOMSGLAIF  E           K        DISK                                                   CSW209
     F            MGOMSGD0                          KRENAMEMGOMSGA                            CSW209
     FDEALS   IF  E           K        DISK                           UC                      CDL099
     F            DEALSDAF                          KIGNORE                                   CDL099
     F            DEALSDCF                          KIGNORE                                   CDL099
     F            DEALSDDF                          KIGNORE                                   CDL099
     F            DEALSDEF                          KIGNORE                                   CDL099
     F            DEALSDGF                          KIGNORE                                   CDL099
     F            DEALSDFF                          KIGNORE                                   CDL099
      *
      *                                                                   S01408
     F/COPY WNCPYSRC,MG0202FFP1                                           S01408
      *                                                                   S01408
      ********************************************************************
      *
      * ID C  F  H  L    FUNCTION OF INDICATORS
      *
      *    05            Error on write to PF/MGOREFPD
      *    06            Error on write to PF/MGOMSGPD
      *****10************EOF*MGF202L0**********************************                      BUG6076
      *    10            EOF MGF202L0/L1                                                     BUG6076
      *****11************CHAIN to MGOREFL0 (TRN unique ?)                 E29588
      *    11            CHAIN to MGOREFA6 (TRN unique ?)                 E29588
      *    15            Error in call to standard program (ZMxxxx)
      *    16            Error on delete of GDF record.
      *    19            LOKUP operation searching array (GNR, @WRK)
      *    20            LOKUP operation searching array (GNR, @WRK)
      *    21            LOKUP operation searching array (GNR)
      *    22            LOKUP operation for determining the codeword
      *    24            MG5000 not found/error on call
      *    25            CHAIN to FXNETML4                                CDL002
      *    50            MG0202P1 open
      *    U7U8          Database error
      *
     F********************************************************************
     E                    CPY@    1   1 80               copyright
     E                    MSGA    1   7 60               message text
     E/COPY WNCPYSRC,MG0202E001
     E                    GNR        15  3               msg generated rel
     E                    MNG        15  3               msg type not gen
     E                    @WRK       50  1               concatenation fld
     E                    BTBI        6 35               bank to bank info
     E                    R203       10  6               MT203 trans. nos.E29588
     E                    @STR       50  1               String formatting145304
      *
      *                                                                   S01408
     I/COPY WNCPYSRC,MG0202IIP1                                           S01408
      *                                                                   S01408
     IRUNDAT      DS                                                      CSW020
     I                                        1   7 MRDT                  CSW020
     I                                    P   8  100RDNB                  CSW020
     I                                       11  11 SUC                   CSW020
     I                                       12  12 DFF                   CSW020
     I                                       13  13 MBIN                  CSW020
      *                                                                   CSW020
     IMULT        DS                        100
     I                                        1   5 MTAG
     I                                        6  55 MFLD
     I                                       56 105 MERR
      **  Multiple occurrence data structure for message
      *
     IEXTN        DS                         80                           183583
     I                                        1   20MPSN                  183583
     I                                        3   7 MTG                   183583
     I                                        8  15 MCSI                  183583
      *                                                                   183583
      ** Multiple occurrence data structure for extension file            183583
      *                                                                   183583
     I            DS                                                      183583
     I                                        1   5 @MTG                  183583
     I                                        2   2 FLDTYP                183583
     I                                        4   4 FLDTAG                183583
      *                                                                   183583
      ** Field tag data structure                                         183583
      *                                                                   183583
     IREF203      DS                         11
     I                                        1  16 @RTRN
      **  Multiple occurrence data structure for MT203 TRN's
      *
     I*PART********DS                         10                          E29588
     IPART        DS                         16                           E29588
     I                                        1  15 @MTRN
     I                                       16  17 @TNTP
     I                                       18  19 @SBTP
     I                                       20  39 @NWBN
     I                                       40  56 @AMTS
     I                                       57  59 @OTHB
     I                                       60  61 @MOD
     I                                       62  64 @ZSCCY                                    187271
      **  Multiple occurrence data structure for MT203 parts
      *
     I@TRN        DS                         16
     I                                        1   2 @TR1
     I                                        3   8 @TR2
     I                                        9  110@TR3
     I                                       12  16 @TR4
      **  Data structure build transaction reference number
      *
     I            DS
     I                                        1  12 CSID
     I                                        9  11 @BIC
      **  Data structure to test for BIC code
      *
     IFLD3A       DS                         26
     I                                        1   6 ZSDATE
     I                                        7   9 ZSCCY
     I                                       10  26 ZSAMNT
      **  Data structure containing codeword for Fields 32A
      *
     IERR3N       DS                         24
     I                                        1   3 ZCCY
     I                                        5  17 ZAMT
      **  Erroneous currency & amounts for Fields 32A
      *
     I@MTAG       DS                          5
     I                                        1   1 COLON1
     I                                        2   3 FLDNO
     I                                        4   4 TAG
     I                                        5   5 COLON2
      **  Data structure constructing message field tag
      *
     I@BTB        DS                         35
     I                                        1   8 BENSC
     I                                        1   6 BEN
     I                                        7   8 CODE
     I****************************************6  35 ACL                   103277
     I                                        5  35 ACL                   103277
      **  Data structure for sender to receiver information
      *
     IP@IN        DS                            256                       CSW096
     I                                        1   3 I@SNBR                CSW096
     I                                        4   9 I@DSCN                CSW096
     I                                       10  12 I@MTPY                CSW096
     I                                       13  140I@SETT                CSW096
     I                                       15  15 I@CONC                CSW096
     I                                       16  16 I@FTCS                CSW096
     I                                       17  18 I@MMOD                CSW096
      ** Data structure for input parameter                               CSW096
      *                                                                   CSW096
     IP@OUT       DS                            256                       CSW096
     I**********                              1   60O@CNSN                             CSW096 CSD027
     I                                        1   6 O@CNSN                                    CSD027
     I                                        7  18 O@SWSN                CSW096
     I                                       19  38 O@NWSN                CSW096
     I                                       39  49 O@SWDS                CSW096
     I                                       46  46 W@96CN                CSW096
     I                                       47  49 W@BIC                 CSW096
     I                                       50  69 O@NWDS                CSW096
     I                                       70  75 O@NWRK                CSW096
     I                                       76  76 O@MGSG                CSW096
     I                                       77  80 O@MGST                CSW096
     I                                       81  81 O@PAIN                CSW096
     I                                       82  87 O@PCNB                CSW096
     I                                       88  90 O@SPRS                CSW096
      ** Data structure for ouput parameter                               CSW096
      *                                                                   CSW096
     I/COPY WNCPYSRC,MG0202I001
      *                                                                                       CSD015
     IPSTRNG      DS                           9999                                           CSD015
      *                                                                                       CSD015
     IWLTDS     E DSSDWLTOPD                                                                  CSD015
      ** List transaction details                                                             CSD015
      *                                                                                       CSD015
     ISDWLCC    E DSSDWLCCPD                                                                  222385
      ** Watch list checking details                                                          222385
      *                                                                                       222385
     ISDBANK    E DSSDBANKPD
      **  Data structure for bank file
      *
     ISDCUST    E DSSDCUSTPD
      **  Data structure for customer file
      *
     ISDBRCH    E DSSDBRCHPD
     I              QQDFAC                          DFACQQ                                    CGL029
      **  Data structure for branch file
      *
     ISDCURR    E DSSDCURRPD
      **  Data structure for currency file
      *
     ISDMMOD    E DSSDMMODPD
      **  Data structure for module ICD file
      *
     ISDNOST    E DSSDNOSTPD
      **  Data structure for nostro file
      *
     ISDMGME    E DSSDMGMEPD
      **  Data structure for message management data.
      *
     ISCSARD    E DSSCSARDPD                                              CDL002
      **  Data structure for SAR data.                                    CDL002
     I/COPY WNCPYSRC,MG0202I002
      *                                                                   CDL002
     ISDCNST    E DSSDCNSTPD                                                                  CSW201
      **  Data structure for counterparty nostro file                                         CSW201
      *                                                                                       CSW201
     IMEBICD    E DSMEBICDPD                                                                  CSW201
      ** Data structure for SWIFT BIC Directory file                                          CSW201
      *                                                                                       CSW201
     IMEBEIS    E DSMEBEISPD                                                                  CSW202
      ** Data Structure for Business Entity Identifier file                                   CSW202
      *                                                                                       CSW202
     IDSFDY     E DSDSFDY
      **  Short data structure for access programs
      *
     IDSSDY     E DSDSSDY
      **  Long data structure for access programs
      *
     ILDA         DS                            256
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
      **  Local data area
      *                                                                                       140901
      * Data structure for AOSVALR0 string                                                    140901
     I            DS                                                                          140901
     I                                        1 200 SVAL1                                     140901
     I                                        1   1 NINC57                                    140901
      *                                                                                       140901
      * System Value                                                                          140901
     I            DS                                                                          140901
     I I            'NotIncFld57IfSame58 '    1  20 SVALK1                                    140901
      *                                                                                       140901
      *                                                                   S01408
     I/COPY WNCPYSRC,MG0202IIPG                                           S01408
      *                                                                   S01408
      *
     C/EJECT
      *****************************************************************
      *                   Index to subroutines                        *
      *  main process                                                 *
      *  INIT   - Initial process                                     *
      *  INTF   - Initialise non-constant fields                      *
      ***ROUT***-*Determine*message*routing****************************   CSW096
      *  SRROUT - Determine message routing                           *   CSW096
      ***NWAD***-*Determine*default*network*address********************   CSW096
      ***PRAD***-*Determine*settlement*network*address*****************   CSW096
      *  VALD   - Are MT203's valid for dest. customer and currency?  *
      ***FILL***-*Fill*up*arrays*GNR*and*MNG***************************   CSW096
      *  CHECK  - Check if the matching criteria is met for an  MT203 *
      *  MS202  - Format an MT202 message                             *
      *  MS203  - Format an MT203 message                             *
      *  FMTHD  - Format the header part of an MT203 (19/30/52/53/54) *
      *  COMM   - Format common fields :20:,:21: and :32(A or B):     *
      *  MESG   - Format fields :56n:, :57n:, :58n:, :72:             *
      *  FLD52  - Format field 52 (Ordering Institution)              *
      *  FLD53  - Format field 53 (Senders Correspondent)             *
      *  FLD54  - Format field 54 (Receivers Correspondent)           *
      *  FLD56  - Format field 56 (Intermediary Bank)                 *
      *  FLD57  - Format field 57 (Account with Institution)          *
      *  FLD58  - Format field 58 (Beneficiary)                       *
      *  FLD72  - Format field 72 (Sender to Receiver Information)    *
      *  FSWAD  - Format SWIFT A/D addresses                          *
      *  FSWADS - Format SWIFT A/B/D addresses                        *
      *  OMSG   - Output correctly generated message to PF/MGOMSGPD   *
      *  REPT   - Output incorrectly generated message to report      *
      *  SEQN   - Retrive S.W.I.F.T sequence numbers                  *
      *  DELT   - Delete processed GDF record                         *
      *  UPMOD  - Update S.W.I.F.T. sequence numbers                  *
      *  RMVMSG - Remove message part from data structure MULT        *
      *  CONVRT - Convert one part MT203 to an MT202                  *
      *  WREF   - Write reference record to PF/MGOREFPD               *
      *  WREFM  - Write reference records to PF/MGOREFPD for MT203    *
      *  DFLT   - Currency defaults                                   *   138742
      *                                                               *
      *****************************************************************
     C/EJECT
      *****************************************************************
      *                                                               *
      *                Multiple message processing                    *
      *               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~                   *
      *                                                               *
      * 1. Matching criteria:                                         *
      *      The following fields are used to determine whether or    *
      *      not two or more message can be combined to produce a     *
      *      multiple payment message (MT203).                        *
      *      Module id                                                *
      *      Destination customer                                     *
      *      Branch code                                              *
      *      Value date                                               *
      *      Currency                                                 *
      *      Ordering customer                                        *
      *      Our Nostro                                               *
      *      Receivers correspondent                                  *
      *      Recipient Number                                         *
      *      Settlement type                                          *
      *                                                               *
      *      A logical file (MGF202L0), is built over the GDF file    *
      *      MGF202PD, keyed by the above matching criteria fields.   *
      *      Once a record has been read, using MGF202L0, the next    *
      *      record is then read and the matching criteria fields     *
      *      are compared; if the same, produce an MT203 else an      *
      *      MT202 is created.                                        *
      *                                                               *
      * Note:  The matching criteria is to be used only when          *
      *        MT203 messages pass the following validations,         *
      *        (i)  valid for destination currency                    *
      *             (A6GMPY, PF/SDCURRPD = 'Y')                       *
      *        (ii) valid for destination customer                    *
      *             (BBNG01-15, PF/SDCUSTPD <> '2**' '20*' '203')     *
      *                                                               *
      * Note: For CLS messages they should remain as separate         *   227679
      *       MT202 messages, as they are submitted at different      *   227679
      *       times.                                                  *   227679
      *                                                               *
      * 2. Byte Counting                                              *
      *      At present the total amount of bytes we can transmit     *
      *      at any one time equals 1920. When creating an MT203      *
      *      we wish to include as many parts possible (to the        *
      *      maximum of 10), instead of setting ourselves a limit.    *
      *      This is achieved by adding the bytes of the fields       *
      *      being formatted for each part of the multiple and        *
      *      subtracting them from the total. The amount of bytes     *
      *      removed for each field are calculated by taking the      *
      *      maxmum allowed bytes for that particlaur field.          *
      *                                                               *
      * Note:  S.W.I.F.T. messages contain Header and Trailer infor-  *
      *        mation. At present we have defaulted then to their     *
      *        maximum size of Header 64 and Trailer 16. These values *
      *        must also be subtracted from the total amount for      *
      *        each MT203 message.                                    *
      *        Total amount, Header and Trailer fields are            *
      *        initialised to the above amounts in subroutine INTF.   *
      *                                                               *
      * 3. Multiple Data Structure MULT                               *
      *      The multiple occurrence data structure is used to        *
      *      store up the records that make up the SWIFT message      *
      *      before writing the whole message to file.                *
      *      To store the records of the message, you must            *
      *      first access an OCUR record, obtain the Message Tag      *
      *      & Message field data values for this OCUR record,        *
      *      then go on to the next OCUR record and continue          *
      *      this process until the SWIFT message is complete.        *
      *                                                               *
      *                                                               *                      BUG6076
      *          Interest & Cover Message Processing in MMM           *                      BUG6076
      *          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~           *                      BUG6076
      *                  Midas        |          MMM                  *                      BUG6076
      *               CHTP   AORR     |    Cover      Action          *                      BUG6076
      * Principal                     |                               *                      BUG6076
      *   Primary      I      I       |                 I             *                      BUG6076
      *                A      A       |                 A             *                      BUG6076
      *   Cover        I      E       |      C          I             *                      BUG6076
      *                A      V       |      C          A             *                      BUG6076
      * Interest                      |                               *                      BUG6076
      *   Primary      I      P       |      I          I             *                      BUG6076
      *                A      T       |      I          A             *                      BUG6076
      *   Cover        I      N       |      S          I             *                      BUG6076
      *                A      O       |      S          A             *                      BUG6076
      *                                                               *                      BUG6076
      *****************************************************************
     C/EJECT
      *****************************************************************
      *   Main process                                                *
      *   Calls     INIT   initial process                            *
      *             INTF   initialise non-constant fields             *
      **************ROUT***determine*message*routing*******************   CSW096
      *             SRROUT determine message routing                  *   CSW096
      *             VALD   Are MT203's valid?                         *
      *             CHECK  Matching criteria met ?                    *
      *             MS202  Format an MT202 message                    *
      *             MS203  Format an MT203 message                    *
      *                                                               *
      *****************************************************************
      *
      **  Initial process
     C                     EXSR INIT
      *
      **  Read the first record from the MT202 extract file
      *
     C           CSW025    IFEQ 'Y'                                                          BUG6076
     C                     READ MGF202L1                 10                                  BUG6076
     C                     ELSE                                                              BUG6076
     C                     READ MGF202L0                 10
     C                     ENDIF                                                             BUG6076
      *
      **  Do While records found on the MT202 extract file
      *
     C           *IN10     DOWEQ'0'
     C/COPY WNCPYSRC,MG0202C083
      *                                                                                      BUG6076
      ** Get Interest Message Indicator from Transaction Number                              BUG6076
      *                                                                                      BUG6076
     C                     MOVE ' '       INTMSG  1                                          BUG6076
     C           MGCHTP    IFEQ 'A'                                                          BUG6076
     C           MGCHTP    OREQ 'I'                                                          BUG6076
     C                     MOVE MGTNUM    INTMSG                                             BUG6076
     C           INTMSG    IFEQ 'I'                                                          BUG6076
     C                     MOVE ' '       MGTNUM                                             BUG6076
     C                     ENDIF                                                             BUG6076
     C                     ENDIF                                                             BUG6076
      *
      **  Initialise non-constant fields
      *
     C                     EXSR INTF
      *
      **  Determine message routing
      *
     C***********          EXSR ROUT                                      CSW096
     C/COPY WNCPYSRC,MG0202C032
     C                     EXSR SRROUT                                    CSW096
     C/COPY WNCPYSRC,MG0202C033
      *
      **  Save key fields (match criteria of LF/MGF202L0)
      *
     C                     EXSR VALD
      *
      **  Set up currency defaults                                        138742
     C                     EXSR DFLT                                      138742
      *                                                                   138742
     C           GM203     IFEQ 'N'
     C           NWRK      OREQ 'PAPER'
     C           NWRK      OREQ 'UNROUT'
     C/COPY WNCPYSRC,MG0202C034
      *
     C                     EXSR MS202
      *
     C                     ELSE
      *                                                                                      BUG6076
     C           CSW025    IFNE 'Y'                                                          BUG6076
     C           CSW025    OREQ 'Y'                                                           242622
     C           CSW050    ANDEQ'Y'                                                           242622
      *                                                                                      BUG6076
      **  Multiple message valid
      **  Read next record to determine if MT203 required
      *
     C           CSW025    IFEQ 'Y'                                                           242622
     C                     READ MGF202L1                 10                                   242622
     C                     ELSE                                                               242622
     C                     READ MGF202L0                 10
     C                     ENDIF                                                              242622
     C/COPY WNCPYSRC,MG0202C084
      *
      **  If not end of file, is the matching criteria met ?
      *
     C           *IN10     IFEQ '0'
     C                     EXSR CHECK
     C                     END
      *
      **  Return back to the previous message so it can be processed
      *
     C           CSW025    IFEQ 'Y'                                                           242622
     C                     READPMGF202L1                 10                                   242622
     C                     ELSE                                                               242622
     C                     READPMGF202L0                 10
     C                     ENDIF                                                              242622
      *                                                                                      BUG6076
     C                     ENDIF                                                             BUG6076
      *                                                                   S01408
     C/COPY WNCPYSRC,MG0202CCP1                                           S01408
      *                                                                   S01408
      *
      **  Matching criteria is met
     C           MATCH     IFEQ 'Y'
     C******     MGTTYP    ANDNE'PC'                                                  193524 227679
     C           CSW025    ANDNE'Y'                                                          BUG6076
     C           MATCH     OREQ 'Y'                                                           242622
     C           CSW025    ANDEQ'Y'                                                           242622
     C           CSW050    ANDEQ'Y'                                                           242622
      *
      *
     C                     EXSR MS203
     C                     ELSE
      *
     C                     EXSR MS202
     C                     END
     C/COPY WNCPYSRC,MG0202C035
     C                     END
      *
      ** Delete the GDF records that have been processed
      *
     C                     EXSR DELT
      *
      ** Update the S.W.I.F.T sequence number
      *
     C                     EXSR UPMOD
      *
      **  Commit all file changes to PF/MGOREFPD & PF/MGOMSGPD
      *
     C                     COMIT
      *                                                                   221145
      **  Call Compliance Watch:Watch List Checking                       221145
      *                                                                   221145
     C           CSD015    IFEQ 'Y'                                       221145
     C           W1EWLC    ANDEQ'Y'                                                           222385
     C           CSW025    ANDEQ'N'                                       221145
     C                     EXSR WLCDQ                                     221145
     C                     ENDIF                                          221145
      *
      **  READ next GDF record
      *
     C           CSW025    IFEQ 'Y'                                                          BUG6076
     C                     READ MGF202L1                 10                                  BUG6076
     C                     ELSE                                                              BUG6076
     C                     READ MGF202L0                 10
     C                     ENDIF                                                             BUG6076
      *
     C                     END
      *
      **  Write end of report, only if the printer file is open
      *
     C           *IN50     IFEQ '1'
     C                     WRITEEOREPT
     C                     END
     C/COPY WNCPYSRC,MG0202C071
      *
     C                     SETON                     LR
      *
      *
     C/EJECT
      *****************************************************************   138742
      *   DFLT - GET DEFAULT VALUES FROM SDCURRPD                     *   138742
      *   Called by - main process                                    *   138742
      *   Calls     -                                                 *   138742
      *****************************************************************   138742
     C           DFLT      BEGSR                                          138742
      *                                                                   138742
      *                                                                   138742
     C** Call Access Program for Currency Details                         138742
     C*       to Obtain DEFAULTS                                          138742
     C                     CALL 'AOCURRR0'                                138742
     C                     PARM '*DBERR ' @RTCD                           138742
     C                     PARM '*KEY   ' @OPTN                           138742
     C                     PARM MGCCY     @BKCY   3                       138742
     C           SDCURR    PARM SDCURR    DSSDY                           138742
     C*                                                                   138742
     C           A6DPRU    IFEQ 'Y'                                       138742
     C                     MOVE 'U'       MPRY                            138742
     C                     ELSE                                           138742
     C                     MOVE 'N'       MPRY                            138742
     C                     END                                            138742
     C*                                                                   138742
     C                     MOVE A6NDWR    JEZ     2                       138742
     C                     MOVELA6DNOR    JEZ                             138742
     C*                                                                   138742
     C           JEZ       IFEQ 'NN'                                      138742
     C                     MOVE *BLANKS   DELC                            138742
     C                     END                                            138742
     C           JEZ       IFEQ 'NY'                                      138742
     C                     MOVE '1'       DELC                            138742
     C                     END                                            138742
     C           JEZ       IFEQ 'YN'                                      138742
     C                     MOVE '2'       DELC                            138742
     C                     END                                            138742
     C           JEZ       IFEQ 'YY'                                      138742
     C                     MOVE '3'       DELC                            138742
     C                     END                                            138742
     C*                                                                   138742
     C                     ENDSR                                          138742
     C/EJECT                                                              138742
      *****************************************************************
      *   INIT - inital process                                       *
      *   Called by - main process                                    *
      *   Calls     -                                                 *
      *****************************************************************
      *
     C           INIT      BEGSR
      *
     C                     MOVEACPY@      BIS@   80
      *
      **  Set up LDA
     C           *NAMVAR   DEFN           LDA
     C           *LOCK     IN   LDA
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     MOVEL'MG0202'  DBPGM
     C                     MOVE *BLANKS   DBASE
     C                     OUT  LDA
      *                                                                   CSW020
      * Get Rundate - Rundate  *                                          CSW020
     C           *NAMVAR   DEFN           RUNDAT                          CSW020
     C                     IN   RUNDAT                                    CSW020
      *
      **  Access SDBANKPD for report title
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '001'     DBASE            * * * * * * * *
     C                     MOVEL'FIRST'   DBKEY            *  DBERR 001  *
     C                     MOVEL'SDBANKPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Access SDMMODPD for modules available
      *
     C                     CALL 'AOMMODR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C           SDMMOD    PARM SDMMOD    DSFDY
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '002'     DBASE            * * * * * * * *
     C                     MOVEL'FIRST'   DBKEY            *  DBERR 002  *
     C                     MOVEL'SDMMODPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Access SDMGMEPD for message management data.
      *
     C                     CALL 'AOMGMER0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C           SDMGME    PARM SDMGME    DSFDY
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '003'     DBASE            * * * * * * * *
     C                     MOVEL'FIRST'   DBKEY            *  DBERR 003  *
     C                     MOVEL'SDMGMEPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *                                                                   CLE007
      ** Determine if Customer Lending Enhancements - Others (T3)         CLE007
      ** feature is installed                                             CLE007
      *                                                                   CLE007
     C                     CALL 'AOSARDR0'                                CLE007
     C                     PARM *BLANKS   P@RTCD  7                       CLE007
     C                     PARM '*KEY   ' P@OPTN  7                       CLE007
     C                     PARM 'CLE007'  P@SARD  6                       CLE007
     C           SCSARD    PARM SCSARD    DSFDY                           CLE007
      *                                                                   CLE007
     C           P@RTCD    IFEQ *BLANKS                                   CLE007
     C                     MOVE 'Y'       CLE007  1                       CLE007
     C                     ELSE                                           CLE007
     C                     MOVE 'N'       CLE007                          CLE007
      *                                                                   CLE007
     C           P@RTCD    IFNE '*NRF    '                                CLE007
     C           *LOCK     IN   LDA                                       CLE007
     C                     MOVEL'MG0202  'DBPGM                           CLE007
     C                     MOVEL'SCSARDPD'DBFILE           ************   CLE007
     C                     Z-ADD29        DBASE            * DBERR 29 *   CLE007
     C                     MOVEL'CLE007'  DBKEY     P      ************   CLE007
     C                     OUT  LDA                                       CLE007
     C                     EXSR *PSSR                                     CLE007
     C                     ENDIF                                          CLE007
      *                                                                   CLE007
     C                     ENDIF                                          CLE007
     C*                                                                   CDL002
     C** Access SAR Details file to determine if CDL002 installed         CDL002
     C*                                                                   CDL002
     C                     CALL 'AOSARDR0'                                CDL002
     C                     PARM '       ' @RTCD                           CDL002
     C                     PARM '*VERIFY' @OPTN                           CDL002
     C                     PARM 'CDL002'  @SARD   6                       CDL002
     C           SCSARD    PARM SCSARD    DSFDY                           CDL002
     C           @RTCD     IFNE *BLANK                                    CDL002
     C           @RTCD     ANDNE'*NRF   '                                 CDL002
     C                     MOVEL'SCSARDPD'DBFILE           ************** CDL002
     C                     MOVEL'029'     DBASE            * DBERROR 029* CDL002
     C                     MOVEL@RTCD     DBKEY            ************** CDL002
     C                     SETON                     U7U8                 CDL002
     C                     EXSR *PSSR                                     CDL002
     C                     END                                            CDL002
     C           @RTCD     IFEQ *BLANK                                    CDL002
     C                     MOVE 'Y'       CDL002  1                       CDL002
     C                     ELSE                                           CDL002
     C                     MOVE 'N'       CDL002                          CDL002
     C                     ENDIF                                          CDL002
      *                                                                                       CSW025
      ** Is CSW025 installed?                                                                 CSW025
      *                                                                                       CSW025
     C                     CALL 'AOSARDR0'                                                    CSW025
     C                     PARM '       ' @RTCD                                               CSW025
     C                     PARM '*VERIFY' @OPTN                                               CSW025
     C                     PARM 'CSW025'  @SARD                                               CSW025
     C           @RTCD     IFNE *BLANK                                                        CSW025
     C           @RTCD     ANDNE'*NRF   '                                                     CSW025
     C                     MOVEL'SCSARDPD'DBFILE                                              CSW025
     C                     MOVEL'022'     DBASE                                               CSW025
     C                     MOVEL@RTCD     DBKEY                                               CSW025
     C                     MOVE *ON       *INU7                                               CSW025
     C                     MOVE *ON       *INU8                                               CSW025
     C                     EXSR *PSSR                                                         CSW025
     C                     ENDIF                                                              CSW025
     C           @RTCD     IFEQ *BLANK                                                        CSW025
     C                     MOVE 'Y'       CSW025  1                                           CSW025
     C                     ENDIF                                                              CSW025
      *                                                                                       242622
      ** Is CSW050 installed?                                                                 242622
      *                                                                                       242622
     C                     CALL 'AOSARDR0'                                                    242622
     C                     PARM '       ' @RTCD                                               242622
     C                     PARM '*VERIFY' @OPTN                                               242622
     C                     PARM 'CSW050'  @SARD                                               242622
     C           @RTCD     IFNE *BLANK                                                        242622
     C           @RTCD     ANDNE'*NRF   '                                                     242622
     C                     MOVEL'SCSARDPD'DBFILE                                              242622
     C                     MOVEL'034'     DBASE                                               242622
     C                     MOVEL@RTCD     DBKEY                                               242622
     C                     MOVE *ON       *INU7                                               242622
     C                     MOVE *ON       *INU8                                               242622
     C                     EXSR *PSSR                                                         242622
     C                     ENDIF                                                              242622
     C           @RTCD     IFEQ *BLANK                                                        242622
     C                     MOVE 'Y'       CSW050  1                                           242622
     C                     ENDIF                                                              242622
      *                                                                                       CSW025
     C/COPY WNCPYSRC,MG0202C072
      *
      **  Initialise constant fields
     C                     MOVE *LOVAL    CR      1
     C                     BITON'457'     CR
     C                     MOVE *LOVAL    LF      1
     C                     BITON'257'     LF
     C                     MOVELCR        CRLF    2
     C                     MOVE LF        CRLF
     C                     MOVE *BLANKS   @TR4
     C                     MOVE ':'       COLON1
     C                     MOVE ':'       COLON2
      *
      **  CRLF Control Character for message data records
     C                     MOVE CRLF      CTRC
      *
      **  Convert run date to YYMMDD, for Message Generation Date
     C                     CALL 'ZM0060'               15
     C                     PARM BJRDNB    ZMDAY   50
     C                     PARM           ZMDATE  6
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '004'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 004  *
     C                     MOVEL'ZM0060'  DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     MOVE ZMDATE    MGDE
      *                                                                   S01408
     C*                                                                   113352
      ** Set-up Message Generation  Century flag                          113352
      *                                                                   113352
     C                     MOVELMGDE      YY      20                      113352
     C           YY        IFLT 72                                        113352
     C                     MOVE '2'       CIND                            113352
     C                     ELSE                                           113352
     C                     MOVE '1'       CIND                            113352
     C                     ENDIF                                          113352
     C/COPY WNCPYSRC,MG0202CCP2                                           S01408
      *                                                                   S01408
      *
      **  Initialise HEADER AND TRAILER parts of a SWIFT message
      **  to the maximum bytes that may be required
     C                     Z-ADD1920      TBYTES  40
     C                     Z-ADD64        HDBYTE  20
     C                     Z-ADD16        TRBYTE  20
      *                                                                   S01408
     C/COPY WNCPYSRC,MG0202C092
     C*                                                                   CEU003
     C** Access Switchable Feature Details                                CEU003
     C*                                                                   CEU003
     C                     CALL 'AOSARDR0'                                CEU003
     C                     PARM *BLANKS   PRTCD   7                       CEU003
     C                     PARM '*VERIFY 'POPTN   7                       CEU003
     C                     PARM 'CEU003'  PSARD   6                       CEU003
     C           SCSARD    PARM SCSARD    DSSDY                           CEU003
     C*                                                                   CEU003
     C           PRTCD     IFEQ *BLANKS                                   CEU003
     C                     MOVE 'Y'       CEU003  1                       CEU003
     C                     ELSE                                           CEU003
     C                     MOVE 'N'       CEU003                          CEU003
     C                     ENDIF                                          CEU003
     C*                                                                   CSW020
     C** Check if swift decimal places feature is switched on             CSW020
     C*                                                                   CSW020
     C                     CALL 'AOSARDR0'                                CSW020
     C                     PARM *BLANKS   PRTCD   7                       CSW020
     C                     PARM '*VERIFY 'POPTN   7                       CSW020
     C                     PARM 'CSW020'  PSARD   6                       CSW020
     C           SCSARD    PARM SCSARD    DSSDY                           CSW020
     C*                                                                   CSW020
     C           PRTCD     IFEQ *BLANKS                                   CSW020
     C                     MOVE 'Y'       CSW020  1                       CSW020
     C                     ELSE                                           CSW020
     C                     MOVE 'N'       CSW020                          CSW020
     C                     ENDIF                                          CSW020
      *                                                                                       CSD015
      ** Check if Midas Compliance Watch (CSD015) is installed                                CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY 'POPTN                                               CSD015
     C                     PARM 'CSD015'  PSARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
      ** An NRF (No Record Found) return code is valid.                                       CSD015
      ** Issue database error only for error return codes.                                    CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'CSD015'  DBKEY                                               CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     Z-ADD33        DBASE                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSD015  1                                           CSD015
      *                                                                                       222385
      ** Access AOWLCCR0 to check if function code MESSGENT is available                      222385
      *                                                                                       222385
     C                     CALL 'AOWLCCR0'                                                    222385
     C                     PARM *BLANKS   @RTCD                                               222385
     C                     PARM '*KEY'    @OPTN                                               222385
     C                     PARM 'MESSGENT'PFUNC   8                                           222385
     C           SDWLCC    PARM SDWLCC    DSFDY                                               222385
      *                                                                                       222385
     C           @RTCD     IFNE *BLANKS                                                       222385
     C           @RTCD     ANDNE'*NRF'                                                        222385
     C                     MOVEL'SDWLCCPD'DBFILE                                              222385
     C                     MOVELPFUNC     DBKEY                                               222385
     C                     Z-ADD32        DBASE                                               222385
     C                     EXSR *PSSR                                                         222385
     C                     ENDIF                                                              222385
      *                                                                                       222385
     C                     ELSE                                                               CSD015
     C                     MOVEL'N'       W1EWLC                                              222385
     C                     MOVE 'N'       CSD015                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSW201
      ** Check if switchable feature CSW201 is switched on                                    CSW201
      *                                                                                       CSW201
     C                     CALL 'SWIF2001'                                                    CSW201
     C                     PARM           PRTCD                                               CSW201
      *                                                                                       CSW201
     C           PRTCD     IFEQ 'CSW2001'                                                     CSW201
     C                     MOVE 'Y'       ZDBEI                                               CSW201
     C                     MOVE 'Y'       CSW201  1                                           CSW201
     C                     ELSE                                                               CSW201
     C                     MOVE ' '       ZDBEI                                               CSW201
     C                     MOVE 'N'       CSW201                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW202
      ** Check if CSW202 is installed                                                         CSW202
      *                                                                                       CSW202
     C                     CALL 'SWIF2002'                                                    CSW202
     C                     PARM *BLANKS   PRTCD                                               CSW202
      *                                                                                       CSW202
     C           PRTCD     IFEQ 'CSW2002'                                                     CSW202
     C                     MOVE 'Y'       CSW202  1                                           CSW202
     C                     ELSE                                                               CSW202
     C                     MOVE 'N'       CSW202                                              CSW202
     C                     ENDIF                                                              CSW202
      *                                                                                       CSW209
      ** Check if SWIFT 2009 is installed                                                     CSW209
      *                                                                                       CSW209
     C                     CALL 'SWIF2009'                                                    CSW209
     C                     PARM *BLANKS   PRTCD                                               CSW209
      *                                                                                       CSW209
     C           PRTCD     IFEQ 'CSW2009'                                                     CSW209
     C                     MOVE 'Y'       CSW209  1                                           CSW209
     C                     ELSE                                                               CSW209
     C                     MOVE 'N'       CSW209                                              CSW209
     C                     ENDIF                                                              CSW209
      *                                                                                       140901
      **  Access SDSAVLPD for 'Not Include Field 57 if same as Field 58 ind (Y/N)'            140901
     C                     CALL 'AOSVALR0'                                                    140901
     C                     PARM *BLANKS   RTNCDE  7                                           140901
     C                     PARM           SVALK1 20                                           140901
     C                     PARM           SVAL1 200                                           140901
     C                     PARM           SVALK2 20                                           140901
     C                     PARM           SVAL2 200                                           140901
     C                     PARM           SVALK3 20                                           140901
     C                     PARM           SVAL3 200                                           140901
     C                     PARM           SVALK4 20                                           140901
     C                     PARM           SVAL4 200                                           140901
     C                     PARM           SVALK5 20                                           140901
     C                     PARM           SVAL5 200                                           140901
     C                     PARM           SVALK6 20                                           140901
     C                     PARM           SVAL6 200                                           140901
     C                     PARM           SVALK7 20                                           140901
     C                     PARM           SVAL7 200                                           140901
     C                     PARM           SVALK8 20                                           140901
     C                     PARM           SVAL8 200                                           140901
     C                     PARM           SVALK9 20                                           140901
     C                     PARM           SVAL9 200                                           140901
     C                     PARM           SVALK0 20                                           140901
     C                     PARM           SVAL10200                                           140901
      *                                                                                       140901
     C           RTNCDE    IFNE *BLANKS                                                       140901
     C           *LOCK     IN   LDA                                                           140901
     C                     MOVE SVALK1    DBKEY            * DB ERROR 39 *                    140901
     C                     Z-ADD39        DBASE                                               140901
     C                     MOVE 'SDSVALPD'DBFILE                                              140901
     C                     OUT  LDA                                                           140901
     C                     EXSR *PSSR                                                         140901
     C                     ENDIF                                                              140901
     C*                                                                   CEU003
      *  Access Switchable Feature Details                                CMG001
      *                                                                   CMG001
     C                     CALL 'AOSARDR0'                                CMG001
     C                     PARM *BLANKS   PRTCD   7                       CMG001
     C                     PARM '*VERIFY 'POPTN   7                       CMG001
     C                     PARM 'CMG001'  PSARD   6                       CMG001
     C           SCSARD    PARM SCSARD    DSSDY                           CMG001
      *                                                                   CMG001
     C           PRTCD     IFEQ *BLANKS                                   CMG001
     C                     MOVE 'Y'       CMG001  1                       CMG001
     C                     ELSE                                           CMG001
     C                     MOVE 'N'       CMG001                          CMG001
     C                     ENDIF                                          CMG001
      *                                                                   CMG001
      ** Check if feature CDL099 is enabled                                                   CDL099
      *                                                                                       CDL099
     C                     CALL 'AOSARDR0'                                                    CDL099
     C                     PARM *BLANKS   PRTCD   7                                           CDL099
     C                     PARM '*VERIFY 'POPTN   7                                           CDL099
     C                     PARM 'CDL099'  PSARD   6                                           CDL099
     C           SCSARD    PARM SCSARD    DSSDY                                               CDL099
      *                                                                                       CDL099
     C           PRTCD     IFEQ *BLANKS                                                       CDL099
     C                     MOVE 'Y'       CDL099  1                                           CDL099
     C                     OPEN DEALS                                                         CDL099
     C                     ELSE                                                               CDL099
     C                     MOVE 'N'       CDL099                                              CDL099
     C                     ENDIF                                                              CDL099
      *                                                                                       CDL099
     C/COPY WNCPYSRC,MG0202CCP6                                           S01408
      *                                                                   S01408
      *
      ** Check if the switchable feature CSW212 is on                                         CSW212
      *                                                                                       CSW212
     C                     CALL 'SWIF2012'                                                    CSW212
     C                     PARM *BLANKS   PRTCD                                               CSW212
      *                                                                                       CSW212
     C           PRTCD     IFEQ 'CSW2012'                                                     CSW212
     C                     MOVE 'Y'       CSW212  1                                           CSW212
     C                     ELSE                                                               CSW212
     C                     MOVE 'N'       CSW212                                              CSW212
     C                     ENDIF                                                              CSW212
     C*                                                                                       CSW212
      ** Check if the switchable feature CSW215 is on                                         CSW215
      *                                                                                       CSW215
     C                     CALL 'SWIF2015'                                                    CSW215
     C                     PARM *BLANKS   PRTCD                                               CSW215
      *                                                                                       CSW215
     C           PRTCD     IFEQ 'CSW2015'                                                     CSW215
     C                     MOVE 'Y'       CSW215  1                                           CSW215
     C                     ELSE                                                               CSW215
     C                     MOVE 'N'       CSW215                                              CSW215
     C                     ENDIF                                                              CSW215
      *                                                                                       CSW215
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   INTF - Initalise non-constant fields                        *
      *   Called by - main process                                    *
      *   Calls     -                                                 *
      *****************************************************************
      *
     C           INTF      BEGSR
      *
     C                     MOVE *BLANKS   TRNO
     C                     MOVE *BLANKS   TRNF
     C                     MOVE *BLANKS   TRNM
     C                     MOVE *BLANKS   MTPY
     C                     MOVE '      '  NWRK
     C**********           Z-ADD0         SECN                                                CSD027
     C                     MOVE *BLANKS   SECN                                                CSD027
     C                     MOVE *BLANKS   NWSN
     C**********           Z-ADD0         DECN                                                CSD027
     C                     MOVE *BLANKS   DECN                                                CSD027
     C                     MOVE *BLANKS   NWDS
     C                     MOVE *BLANKS   MGSG
     C                     MOVE *BLANKS   MGST
     C                     MOVE *BLANKS   LSCC
     C                     MOVE *BLANKS   F57U
     C                     Z-ADD0         MGTM
     C                     Z-ADD0         LATM
     C                     MOVE *BLANKS   RELD
     C                     Z-ADD0         RELT
     C                     MOVE *BLANKS   AMTX
     C                     MOVE *BLANKS   AMTS
     C                     MOVE *BLANKS   SVDT
     C                     MOVE *BLANKS   CINDV                           141572
     C                     MOVE *BLANKS   CCY
     C                     MOVE *BLANKS   NSNO
     C                     Z-ADD0         AVDT                            E29588
     C                     Z-ADD0         ASEQ                            E29588
      *
     C                     MOVE *BLANKS   @TRN
     C                     MOVE *BLANKS   @ERR    1
      *
      **  Save fields for Destination and Sender customer information
      *
     C                     MOVE *BLANKS   DTELX  10
     C                     MOVE *BLANKS   DSTTX  12
     C                     MOVE *BLANKS   DCRNM  20
     C                     MOVE *BLANKS   DPCNB   6
     C                     MOVE *BLANKS   DPAIN   1
      *
     C                     MOVE *BLANKS   SCSID  12
     C                     MOVE *BLANKS   STELX  10
     C                     MOVE *BLANKS   SSTTX  12
     C                     MOVE *BLANKS   SCRNM  20
     C                     MOVE *BLANKS   SPCNB   6
     C                     MOVE *BLANKS   SPAIN   1
      *
      **  Restore bytes field for new message
      *
     C                     Z-ADDTBYTES    BYTES   40
     C                     SUB  HDBYTE    BYTES
     C                     SUB  TRBYTE    BYTES
      *
     C                     Z-ADD0         BYTRMV
     C                     MOVE 'N'       RANOUT
     C                     MOVE 'N'       MATCH
      *
      **  Convert history retention date to YYMMDD
     C           MGVDAT    ADD  ENDSMN    ZMDAY
     C                     CALL 'ZM0060'               15
     C                     PARM           ZMDAY
     C                     PARM           ZMDATE
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '005'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 005  *
     C                     MOVEL'ZM0060'  DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     MOVE ZMDATE    @HRDT   6
      *
      **  Clear multiple occurrence data structures
     C                     Z-ADD1         X       20
     C           X         OCUR MULT
      *
     C           X         DOWLE65
     C           MULT      ANDNE*BLANKS
     C                     MOVE *BLANKS   MULT
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
      *                                                                   183583
      ** Clear multiple occurrence DS for the extension file.             183583
      *                                                                   183583
     C                     Z-ADD1         V       20                      183583
     C           V         OCUR EXTN                                      183583
     C           V         DOWLE80                                        183583
     C           MCSI      ANDNE*BLANKS                                   183583
     C                     Z-ADD*ZEROS    MPSN                            183583
     C                     MOVE *BLANKS   MTG                             183583
     C                     MOVE *BLANKS   MCSI                            183583
     C                     ADD  1         V                               183583
     C           V         OCUR EXTN                                      183583
     C                     ENDDO                                          183583
     C                     Z-ADD0         V                               183583
      *
      **  11th REF203 record always blank; Used as the TRN of the         E29588
      **  next part for the 10th part of a MT203. 11th PART used          E29588
      **  for blank fields for the header reference record for a          E29588
      **  multiple MT203 message.                                         E29588
      *                                                                   E29588
     C                     Z-ADD0         X
     C           X         DOWLT11                                        E29588
     C                     ADD  1         X
     C           X         OCUR REF203
     C           X         OCUR PART
     C                     MOVE *BLANKS   REF203
     C                     MOVE *BLANKS   PART
     C                     END
      *
     C/COPY WNCPYSRC,MGH00084
     C                     ENDSR
     C/EJECT
      *****************************************************************
      ****ROUT*-*determine*message*routing*****************************   CSW096
      ****Called*by***Main*process*************************************   CSW096
      ****Calls*******NWAD**determine*default*network*address**********   CSW096
      ****************PRAD**determine*priority*network*address*********   CSW096
      ****************FILL**fill*up*arrays*GNR*and*MNG*****************   CSW096
      *****************************************************************   CSW096
      ***********                                                         CSW096
     C***********ROUT      BEGSR                                          CSW096
      ***********                                                         CSW096
      ****Access*SDBRCHPD*using*branch*code*******************************CSW096
     C***********          CALL 'AOBRCHR0'                                CSW096
     C***********          PARM '*MSG   ' @RTCD                           CSW096
     C***********          PARM '*KEY   ' @OPTN                           CSW096
     C***********          PARM MGPOBR    @BRCD   3                       CSW096
     C***********SDBRCH    PARM SDBRCH    DSSDY                           CSW096
      ***********                                                         CSW096
      ***Branch*record*not*found*-*Error**********************************CSW096
     C***********@RTCD     IFNE *BLANKS                                   CSW096
     C************LOCK     IN   LDA                                       CSW096
     C***********          MOVE '006'     DBASE            * * * * * * * *CSW096
     C***********          MOVELMGPOBR    DBKEY            *  DBERR 006  *CSW096
     C***********          MOVEL'SDBRCHPD'DBFILE           * * * * * * * *CSW096
     C***********          OUT  LDA                                       CSW096
     C***********          EXSR *PSSR                                     CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      *****save*branch*internal*customer*number*&*SWIFT*TID*address*******CSW096
     C***********          MOVELA8BICN    SECN                            CSW096
     C***********          MOVE A8BTID    SCSID                           CSW096
      ***********                                                         CSW096
      ****Access*SDCUSTPD*using*branch*internal*customer*number***********CSW096
     C***********          MOVE *BLANKS   @KEY1                           CSW096
     C***********          MOVELSECN      @KEY1                           CSW096
     C***********          CALL 'AOCUSTR0'                                CSW096
     C***********          PARM '*MSG   ' @RTCD                           CSW096
     C***********          PARM '*KEY   ' @OPTN                           CSW096
     C***********          PARM           @KEY1  10                       CSW096
     C***********          PARM *BLANKS   @KYST   7                       CSW096
     C***********SDCUST    PARM SDCUST    DSSDY                           CSW096
      ***********                                                         CSW096
      ***Customer*record*not*found*-*Error********************************CSW096
     C***********@RTCD     IFNE *BLANKS                                   CSW096
     C************LOCK     IN   LDA                                       CSW096
     C***********          MOVE '007'     DBASE            * * * * * * * *CSW096
     C***********          MOVEL@KEY1     DBKEY            *  DBERR 007  *CSW096
     C***********          MOVEL'SDCUSTPD'DBFILE           * * * * * * * *CSW096
     C***********          OUT  LDA                                       CSW096
     C***********          EXSR *PSSR                                     CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****Save*sender's*addresses*&*parent*customer*number****************CSW096
      ***********                                                         CSW096
     C***********          MOVE BBTXA1    STELX                           CSW096
     C***********          MOVE BBSTAD    SSTTX                           CSW096
     C***********          MOVE BBCRNM    SCRNM                           CSW096
     C***********          MOVE BBPCNB    SPCNB                           CSW096
     C***********          MOVE BBPAIN    SPAIN                           CSW096
      ***********                                                         CSW096
      ****Access*SDCUSTPD*using*destination*customer*number***************CSW096
      ***********                                                         CSW096
     C***********          MOVE *BLANKS   @KEY1                           CSW096
     C***********          MOVELMGDEST    @KEY1                           CSW096
     C***********          CALL 'AOCUSTR0'                                CSW096
     C***********          PARM '*MSG   ' @RTCD                           CSW096
     C***********          PARM '*KEY   ' @OPTN                           CSW096
     C***********          PARM           @KEY1  10                       CSW096
     C***********          PARM *BLANKS   @KYST   7                       CSW096
     C***********SDCUST    PARM SDCUST    DSSDY                           CSW096
      ****Error***********************************************************CSW096
     C***********          MOVE MGDEST    DECN                            CSW096
     C***********          MOVE *BLANKS   DSERR  50                       CSW096
     C***********@RTCD     IFNE *BLANKS                                   CSW096
     C***********          MOVE 'Y'       @ERR                            CSW096
     C***********          MOVELMSGA,2    DSERR                           CSW096
     C***********          MOVELSCRNM     NWSN                            CSW096
      ***********                                                         CSW096
     C***********          ELSE                                           CSW096
      ***********                                                         CSW096
      ****To*check*'BIC'*in*SWIFT*address*********************************CSW096
     C***********          MOVE BBCSID    CSID                            CSW096
      ***********                                                         CSW096
      ****Use*default*network*if*entered;**Else**use*priorities***********CSW096
      ***********                                                         CSW096
     C***********BBDNW2    IFNE *BLANKS                                   CSW096
     C***********          EXSR NWAD                                      CSW096
     C***********          ELSE                                           CSW096
     C***********          EXSR PRAD                                      CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****Fill*up*the*appropriate*array*information*from*PF/SDCUSTPD******CSW096
     C***********          EXSR FILL                                      CSW096
      ***********                                                         CSW096
      ****Is*default*status*for*a*Single*MT202*message*released*?*********CSW096
      ****Check*only*if*status*not*already*determined*********************CSW096
      ***********                                                         CSW096
     C***********MGST      IFEQ *BLANKS                                   CSW096
      ***********                                                         CSW096
     C***********'202'     LOKUPGNR                      19               CSW096
     C***********'20*'     LOKUPGNR                      20               CSW096
     C***********'2**'     LOKUPGNR                      21               CSW096
      ***********                                                         CSW096
     C************IN19     IFEQ '1'                                       CSW096
     C************IN20     OREQ '1'                                       CSW096
     C************IN21     OREQ '1'                                       CSW096
     C***********          MOVE 'RSND'    SMGST   4                       CSW096
     C***********          MOVE '2'       SMGSG   1                       CSW096
     C***********          ELSE                                           CSW096
     C***********          MOVE 'CRTD'    SMGST                           CSW096
     C***********          MOVE '1'       SMGSG                           CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****Is*default*status*for*Multiple*MT203*messages*released*?********CSW096
      ***********                                                         CSW096
     C***********'203'     LOKUPGNR                      19               CSW096
     C************IN19     IFEQ '1'                                       CSW096
     C************IN20     OREQ '1'                                       CSW096
     C************IN21     OREQ '1'                                       CSW096
     C***********          MOVE 'RSND'    MMGST   4                       CSW096
     C***********          MOVE '2'       MMGSG   1                       CSW096
     C***********          ELSE                                           CSW096
     C***********          MOVE 'CRTD'    MMGST                           CSW096
     C***********          MOVE '1'       MMGSG                           CSW096
     C***********          END                                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          ENDSR                                          CSW096
     C/EJECT
      *****************************************************************   CSW096
      *   SRROUT - determine message routing                          *   CSW096
      *   Called by - main process                                    *   CSW096
      *   Calls -                                                     *   CSW096
      *****************************************************************   CSW096
      *                                                                   CSW096
     C           SRROUT    BEGSR                                          CSW096
      *                                                                   CSW096
     C/COPY WNCPYSRC,MG0202C003
     C                     MOVE MGPOBR    I@SNBR                          CSW096
     C/COPY WNCPYSRC,MG0202C004
     C                     MOVE *BLANKS   I@DSCN                          CSW096
     C/COPY WNCPYSRC,MGH00004
     C                     MOVE MGDEST    I@DSCN                          CSW096
     C/COPY WNCPYSRC,MGH00005
     C                     MOVE '202'     I@MTPY                          CSW096
     C                     MOVE 'N'       I@CONC                          CSW096
     C                     Z-ADDMGSETP    I@SETT                          CSW096
     C                     MOVE *BLANK    I@FTCS                          CSW096
     C                     MOVE MGMODI    I@MMOD                          CSW096
      *###################################################################CSW096
      *                                                                  #CSW096
      * Below are two copy sources intended for setting up the custom    #CSW096
      * parameter (P@ZZ) in the call to MG9900.                          #CSW096
      * One (MG9900CALL) is in ALL MG generation programs and is for use #CSW096
      * when a change is required to all of them.                        #CSW096
      * The other is only in this program.                               #CSW096
     C/COPY WNCPYSRC,MG9900CALL                                          #CSW096
     C/COPY WNCPYSRC,MG0202ROUT                                          #CSW096
      *                                                                  #CSW096
      *###################################################################CSW096
     C                     CALL 'MG9900'                                  CSW096
     C                     PARM *BLANKS   @RTCD                           CSW096
     C                     PARM           P@IN                            CSW096
     C                     PARM *BLANKS   P@OUT                           CSW096
     C                     PARM           P@ZZ  256                       CSW096
      *                                                                   CSW096
     C           @RTCD     IFNE *BLANKS                                   CSW096
     C           *LOCK     IN   LDA                                       CSW096
     C                     MOVE '092'     DBASE              * * * * * * *CSW096
     C                     MOVEL'*CALL  ' DBKEY              * DBERR 092 *CSW096
     C                     MOVEL'MG9900'  DBFILE             * * * * * * *CSW096
     C                     OUT  LDA                                       CSW096
     C                     EXSR *PSSR                                     CSW096
     C                     ELSE                                           CSW096
     C                     MOVE O@NWRK    NWRK                            CSW096
     C/COPY WNCPYSRC,MG0202C027
     C**********           Z-ADDO@CNSN    SECN                                         CSW096 CSD027
     C                     MOVE O@CNSN    SECN                                                CSD027
     C                     MOVE O@NWSN    NWSN                            CSW096
     C**********           Z-ADDMGDEST    DECN                                         CSW096 CSD027
     C/COPY WNCPYSRC,MGH00009
     C                     MOVE MGDEST    DECN                                                CSD027
     C/COPY WNCPYSRC,MGH00010
     C                     MOVE O@NWDS    NWDS                            CSW096
     C                     MOVE O@MGSG    MGSG                            CSW096
     C                     MOVE *BLANK    SMGSG   1                       CSW096
     C                     MOVE O@MGSG    SMGSG                           CSW096
     C                     MOVE O@MGST    MGST                            CSW096
     C                     MOVE *BLANKS   SMGST   4                       CSW096
     C                     MOVE O@MGST    SMGST                           CSW096
     C                     MOVE O@PCNB    SPCNB                           CSW096
     C                     MOVE O@PAIN    SPAIN                           CSW096
     C           *LIKE     DEFN O@SPRS    SSPRS                           CSW096
     C                     MOVELO@SPRS    SSPRS                           CSW096
     C/COPY WNCPYSRC,MG0202C030
     C                     END                                            CSW096
      *                                                                                       CSW215
      ** Change the Network to 'PAPER' if the Precious Metal Indicator                        CSW215
      ** of the currency is 'Y' and Network is currently set to 'SWIFT'                       CSW215
      *                                                                                       CSW215
     C           CSW215    IFEQ 'Y'                                                           CSW215
     C                     CALL 'AOCURRR0'                                                    CSW215
     C                     PARM '*DBERR ' @RTCD                                               CSW215
     C                     PARM '*KEY   ' @OPTN                                               CSW215
     C                     PARM MGCCY     @BKCY                                               CSW215
     C           SDCURR    PARM SDCURR    DSSDY                                               CSW215
      *                                                                                       CSW215
     C           @RTCD     IFEQ *BLANKS                                                       CSW215
     C           NWRK      ANDEQ'SWIFT'                                                       CSW215
     C           A6PMRT    ANDEQ'Y'                                                           CSW215
     C                     MOVEL'PAPER'   NWRK                                                CSW215
     C                     ENDIF                                                              CSW215
     C                     ENDIF                                                              CSW215
      *                                                                   CSW096
     C/COPY WNCPYSRC,MG0202C021
     C                     ENDSR                                          CSW096
     C/EJECT                                                              CSW096
      *****************************************************************   CSW096
      ****NWAD*-*determine*default*network*address*********************   CSW096
      ****Called*by***ROUT**determine*message*routing******************   CSW096
      ****Calls*******-************************************************   CSW096
      *****************************************************************   CSW096
      ***********                                                         CSW096
     C***********NWAD      BEGSR                                          CSW096
      ***********                                                         CSW096
      ****Default*is*SWIFT************************************************CSW096
     C***********BBDNW2    IFEQ 'SWIFT'                                   CSW096
     C***********@BIC      ANDNE'BIC'                                     CSW096
     C***********BGMSDL    ANDEQ'Y'                                       CSW096
     C***********          MOVELSCSID     NWSN                            CSW096
     C***********          MOVELBBCSID    NWDS                            CSW096
     C***********          MOVELBBDNW2    NWRK                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****Default*is*TELEX************************************************CSW096
     C***********BBDNW2    IFEQ 'TELEX'                                   CSW096
     C***********BGMTMI    ANDEQ'Y'                                       CSW096
     C***********          MOVELSTELX     NWSN                            CSW096
     C***********          MOVELBBTXA1    NWDS                            CSW096
     C***********          MOVELBBDNW2    NWRK                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****Default*is*STTX*************************************************CSW096
     C***********BBDNW2    IFEQ 'STTX '                                   CSW096
     C***********BGMSDL    ANDEQ'Y'                                       CSW096
     C***********          MOVELSSTTX     NWSN                            CSW096
     C***********          MOVELBBSTAD    NWDS                            CSW096
     C***********          MOVELBBDNW2    NWRK                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****Default*is*PAPER************************************************CSW096
      ***********                                                         CSW096
     C***********BBDNW2    IFEQ 'PAPER'                                   CSW096
     C***********          MOVEL'PAPER'   NWRK                            CSW096
     C***********          MOVELSCRNM     NWSN                            CSW096
     C***********          MOVELBBCRNM    NWDS                            CSW096
      ***********                                                         CSW096
      ****If*the*ICD*option*for*free*format*advices*is*'Y'*the************CSW096
      ****message*has*already*been*printed*,*hence*no*further*************CSW096
      ****print*out*is*needed.********************************************CSW096
     C***********ENFFAR    IFEQ 'Y'                                       CSW096
     C***********          MOVEL'PRTD'    MGST                            CSW096
     C***********          MOVE '3'       MGSG                            CSW096
     C***********          ELSE                                           CSW096
     C***********          MOVEL'RSND'    MGST                            CSW096
     C***********          MOVE '2'       MGSG                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****Found*to*be*unroutable******************************************CSW096
      ***********                                                         CSW096
     C***********NWRK      IFEQ *BLANKS                                   CSW096
     C***********NWDS      OREQ *BLANKS                                   CSW096
     C***********NWSN      OREQ *BLANKS                                   CSW096
     C***********          MOVEL'UNROUT'  NWRK                            CSW096
     C***********          MOVELSCRNM     NWSN                            CSW096
     C***********          MOVELBBCRNM    NWDS                            CSW096
     C***********          MOVEL'CRTD'    MGST                            CSW096
     C***********          MOVE '1'       MGSG                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          ENDSR                                          CSW096
     C*/EJECT****                                                         CSW096
      *****************************************************************   CSW096
      ****PRAD*-*determine*settlement*network*address******************   CSW096
      ****Called*by*-*ROUT*determine*message*routing*******************   CSW096
      ****Calls*******-************************************************   CSW096
      *****************************************************************   CSW096
      ***********                                                         CSW096
     C***********PRAD      BEGSR                                          CSW096
      ***********                                                         CSW096
      ****Set*up*priority*sender,*destination*&*network*******************CSW096
      ***********                                                         CSW096
      ****'S'*=*SWIFT;*'T'*=*TELEX;*'X'*=*STTX****************************CSW096
      ***********                                                         CSW096
      ***********          (1)  (2)  (3)  (4)  (5)  (6)  (7)              CSW096
      ****---------------------------------------------------             CSW096
      ****SWIFT*ADDRESS    Y   N   N   Y   Y   Y   Y              CSW096
      ****TELEX*ADDRESS    N   Y   N   Y   Y   N   N              CSW096
      ****STTX*ADDRESS     N   N   Y   N   N   Y   Y              CSW096
      ****SETT.*TYPE                  01  08  01  08              CSW096
      ****---------------------------------------------------             CSW096
      ****DESTN*= BBCSID   X               X       X              CSW096
      ****DESTN*= BBTXA1       X       X                          CSW096
      ****DESTN*= BBSTAD           X           X                  CSW096
      ****---------------------------------------------------             CSW096
      ****NETWORK                                                 CSW096
      ****(NWRK)           S   T   X   T   S   X   S              CSW096
      ***********                                                         CSW096
      ****SWIFT*?                                                         CSW096
      ****(1)*************************************************************CSW096
     C***********BGMSDL    IFEQ 'Y'                                       CSW096
     C***********SCSID     ANDNE*BLANKS                            E27567 CSW096
      ***********                                                         CSW096
     C***********BBCSID    IFNE *BLANKS                                   CSW096
     C***********BBTXA1    ANDEQ*BLANKS                                   CSW096
     C***********BBSTAD    ANDEQ*BLANKS                                   CSW096
      ****(5)*************************************************************CSW096
     C***********BBCSID    ORNE *BLANKS                                   CSW096
     C***********BBTXA1    ANDNE*BLANKS                                   CSW096
     C***********BBSTAD    ANDEQ*BLANKS                                   CSW096
     C***********MGSETP    ANDEQ08                                        CSW096
      ****(7)*************************************************************CSW096
     C***********BBCSID    ORNE *BLANKS                                   CSW096
     C***********BBTXA1    ANDEQ*BLANKS                                   CSW096
     C***********BBSTAD    ANDNE*BLANKS                                   CSW096
     C***********MGSETP    ANDEQ08                                        CSW096
      ***********                                                         CSW096
     C***********          MOVELSCSID     NWSN                            CSW096
     C***********          MOVELBBCSID    NWDS                            CSW096
     C***********          MOVE 'SWIFT '  NWRK                            CSW096
     C***********          END                                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****TELEX*?*********************************************************CSW096
      ****(2)*************************************************************CSW096
     C***********BGMTMI    IFEQ 'Y'                                       CSW096
     C***********STELX     ANDNE*BLANKS                            E27567 CSW096
      ***********                                                         CSW096
     C***********BBCSID    IFEQ *BLANKS                                   CSW096
     C***********BBTXA1    ANDNE*BLANKS                                   CSW096
     C***********BBSTAD    ANDEQ*BLANKS                                   CSW096
      ****(4)*************************************************************CSW096
     C***********BBCSID    ORNE *BLANKS                                   CSW096
     C***********BBTXA1    ANDNE*BLANKS                                   CSW096
     C***********BBSTAD    ANDEQ*BLANKS                                   CSW096
     C***********MGSETP    ANDEQ01                                        CSW096
      ***********                                                         CSW096
     C***********          MOVELSTELX     NWSN                            CSW096
     C***********          MOVELBBTXA1    NWDS                            CSW096
     C***********          MOVE 'TELEX '  NWRK                            CSW096
     C***********          END                                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****STTX*?**********************************************************CSW096
      ****(3)*************************************************************CSW096
      ***********                                                         CSW096
     C***********BGMSDL    IFEQ 'Y'                                       CSW096
     C***********SSTTX     ANDNE*BLANKS                            E27567 CSW096
      ***********                                                         CSW096
     C***********BBCSID    IFEQ *BLANKS                                   CSW096
     C***********BBTXA1    ANDEQ*BLANKS                                   CSW096
     C***********BBSTAD    ANDNE*BLANKS                                   CSW096
      ****(6)*************************************************************CSW096
     C***********BBCSID    ORNE *BLANKS                                   CSW096
     C***********BBTXA1    ANDEQ*BLANKS                                   CSW096
     C***********BBSTAD    ANDNE*BLANKS                                   CSW096
     C***********MGSETP    ANDEQ01                                        CSW096
      ***********                                                         CSW096
     C***********          MOVELSSTTX     NWSN                            CSW096
     C***********          MOVELBBSTAD    NWDS                            CSW096
     C***********          MOVE 'STTX  '  NWRK                            CSW096
     C***********          END                                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****If*network*is*SWIFT*and*if*positions*9-11*of*the****************CSW096
      ****SWIFT*address*are*equal*to*'BIC'********************************CSW096
      ****try*to*route*the*message*via*Telex*or*STTX**********************CSW096
      ***********                                                         CSW096
     C***********NWRK      IFEQ 'SWIFT '                                  CSW096
     C***********@BIC      ANDEQ'BIC'                                     CSW096
      ***********                                                         CSW096
     C***********          MOVE *BLANKS   NWSN                            CSW096
     C***********          MOVE *BLANKS   NWDS                            CSW096
      ***********                                                         CSW096
     C***********BGMTMI    IFEQ 'Y'                                       CSW096
     C***********BBTXA1    ANDNE*BLANKS                                   CSW096
     C***********STELX     ANDNE*BLANKS                            E27567 CSW096
     C***********          MOVELSTELX     NWSN                            CSW096
     C***********          MOVELBBTXA1    NWDS                            CSW096
     C***********          MOVEL'TELEX '  NWRK                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********BGMSDL    IFEQ 'Y'                                       CSW096
     C***********BBSTAD    ANDNE*BLANKS                                   CSW096
     C***********SSTTX     ANDNE*BLANKS                            E27567 CSW096
     C***********          MOVELSSTTX     NWSN                            CSW096
     C***********          MOVELBBSTAD    NWDS                            CSW096
     C***********          MOVE 'STTX  '  NWRK                            CSW096
     C***********          END                                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****Found*to*be*unroutable*(send*via*PAPER)*************************CSW096
      ***********                                                         CSW096
     C***********NWRK      IFEQ *BLANKS                                   CSW096
     C***********NWDS      OREQ *BLANKS                                   CSW096
     C***********NWSN      OREQ *BLANKS                                   CSW096
     C***********          MOVEL'PAPER '  NWRK                            CSW096
     C***********          MOVELSCRNM     NWSN                            CSW096
     C***********          MOVELBBCRNM    NWDS                            CSW096
      ***********                                                         CSW096
      ****If*the*ICD*option*for*free*format*advices*is*'Y'*the************CSW096
      ****message*has*already*been*printed*,*hence*no*further*************CSW096
      ****print*out*is*needed.********************************************CSW096
     C***********ENFFAR    IFEQ 'Y'                                       CSW096
     C***********          MOVEL'PRTD'    MGST                            CSW096
     C***********          MOVE '3'       MGSG                            CSW096
     C***********          ELSE                                           CSW096
     C***********          MOVEL'RSND'    MGST                            CSW096
     C***********          MOVE '2'       MGSG                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          ENDSR                                          CSW096
     C/EJECT
      *****************************************************************
      *   VALD - Are MT203's valid for dest. customer & currency?     *
      *   Called by   main process                                    *
      *   Calls                                                       *
      *****************************************************************
      *
     C           VALD      BEGSR
      *
      **  Are MT203's valid for this currency ?
      *
     C                     CALL 'AOCURRR0'
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*KEY'    @OPTN   7
     C                     PARM MGCCY     @CCY    3
     C           SDCURR    PARM SDCURR    DSSDY
      *
      ** To deal with data base errors.
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '008'     DBASE            * * * * * * * *
     C                     MOVELMGCCY     DBKEY            *  DBERR 008  *
     C                     MOVEL'SDCURRPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Are MT203 messages valid for this destination customer ?
      *
     C                     MOVE 'N'       GM203   1
     C           '203'     LOKUPMNG                      19
     C           '20*'     LOKUPMNG                      20
     C           '2**'     LOKUPMNG                      21
      *
      **  MT203 messages valid for currency and destination customer ?
      *
     C************IN19     IFEQ '0'                                       CSW096
     C************IN20     ANDEQ'0'                                       CSW096
     C************IN21     ANDEQ'0'                                       CSW096
      *                                                                   CSW096
      * If suppress is Yes i.e. 20* 2** or 202 = 203 suppress             CSW096
      * then generate a 202 otherwise if currency allows multiples        CSW096
      * generate a Mt203                                                  CSW096
      *                                                                   CSW096
     C           SSPRS     IFNE 'Yes'                                     CSW096
     C           SSPRS     ANDNE'202'                                     CSW096
     C           A6GMPY    ANDEQ'Y'
     C                     MOVE 'Y'       GM203
     C                     END
     C/COPY WNCPYSRC,MG0202C054
      *
      **  Save destination addresses & parent customer number
      *
     C***********          MOVE BBTXA1    DTELX                           111106
     C***********          MOVE BBSTAD    DSTTX                           111106
     C***********          MOVE BBCRNM    DCRNM                           111106
     C***********          MOVE BBPCNB    DPCNB                           111106
     C***********          MOVE BBPAIN    DPAIN                           111106
     C                     MOVE O@NWSN    DTELX                           111106
     C                     MOVE O@NWDS    DSTTX                           111106
     C                     MOVE O@NWDS    DCRNM                           111106
     C                     MOVE O@PCNB    DPCNB                           111106
     C                     MOVE O@PAIN    DPAIN                           111106
      *
      **  Save fields required for the match criteria of MT203's
      *
     C                     MOVELMGMODI    KMODI   2
     C**********           MOVELMGDEST    KDEST   60                                          CSD027
     C                     MOVELMGDEST    KDEST   6                                           CSD027
     C                     MOVELMGPOBR    KPOBR   3
     C                     MOVELMGVDAT    KVDAT   50
     C/COPY WNCPYSRC,MG0202C007
      *                                                                                       CDL099
      ** Only check for SVD if FX/MM                                                          CDL099
     C           MGMODI    IFEQ 'DL'                                                          CDL099
     C           CDL099    ANDEQ'Y'                                                           CDL099
     C                     MOVELMGTNUM    KYDLNO  60                                          CDL099
     C           KYDLNO    CHAINDEALS                40                                       CDL099
     C                     MOVE BSDT2     KVDAT                                               CDL099
     C                     ENDIF                                                              CDL099
      *                                                                                       CDL099
     C                     MOVELMGCCY     KCCY    3
     C**********           MOVELMGPOBN    KPOBN   60                                          CSD027
     C                     MOVELMGPOBN    KPOBN   6                                           CSD027
     C**********           MOVELMGPONS    KPONS  12                                           CGL029
     C                     MOVELMGPONS    KPONS  18                                           CGL029
     C                     MOVELMGRCRN    KRCRN   8
     C                     MOVELMGRVNO    KRVNO   8
     C                     MOVELMGSETP    KSETP   20
     C                     MOVELMGTNUM    KTNUM  15                                           235581
     C           CSW209    IFEQ 'Y'                                                           CSW209
     C                     MOVELMGCVMI    KCVMI   1                                           CSW209
     C                     MOVELMGTNUM    KTNUM  15                                           CSW209
     C                     ENDIF                                                              CSW209
     C**                                                                  CSW020
     C/COPY WNCPYSRC,MG0202C073
     C** Check if the currency number of decimal places is different from CSW020
     C** the swift number of decimal places                               CSW020
     C                     MOVE 'N'       WCHGRQ  1                       CSW020
     C           CSW020    IFEQ 'Y'                                       CSW020
      *                                                                   CSW020
     C           A6SWDP    IFNE A6NBDP                                    CSW020
     C           A6SWDT    ANDLERDNB                                      CSW020
      *                                                                   CSW020
      * Are MT203's allowed ?                                             CSW020
     C           GM203     IFEQ 'Y'                                       CSW020
      *                                                                   CSW020
     C           A6SWDP    IFLT A6NBDP                                    CSW020
     C           A6NBDP    SUB  A6SWDP    WDIFF   10                      CSW020
      * Set Change required field to Yes                                  CSW020
     C                     MOVE 'Y'       WCHGRQ                          CSW020
     C                     ELSE                                           CSW020
     C           A6SWDP    SUB  A6NBDP    WDIFF                           CSW020
     C                     ENDIF                                          CSW020
      *                                                                   CSW020
     C           WDIFF     IFEQ 1                                         CSW020
     C                     Z-ADD10        WPOWER  40                      CSW020
     C                     ENDIF                                          CSW020
     C           WDIFF     IFEQ 2                                         CSW020
     C                     Z-ADD100       WPOWER                          CSW020
     C                     ENDIF                                          CSW020
     C           WDIFF     IFEQ 3                                         CSW020
     C                     Z-ADD1000      WPOWER                          CSW020
     C                     ENDIF                                          CSW020
      *                                                                   CSW020
     C                     ENDIF                                          CSW020
     C                     ENDIF                                          CSW020
     C                     ENDIF                                          CSW020
     C*                                                                   CSW020
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      ****FILL*-*Fill*up*arrays*GNR*and*MNG****************************   CSW096
      ****Called*by***VALD**are*MT203's*valid?*************************   CSW096
      ****Calls*******-************************************************   CSW096
      *****************************************************************   CSW096
      ***********                                                         CSW096
     C***********FILL      BEGSR                                          CSW096
      ***********                                                         CSW096
      ****Is*message*to*be*generated*as*released*?************************CSW096
      ***********                                                         CSW096
     C***********          MOVE BBDS01    GNR,1                           CSW096
     C***********          MOVE BBDS02    GNR,2                           CSW096
     C***********          MOVE BBDS03    GNR,3                           CSW096
     C***********          MOVE BBDS04    GNR,4                           CSW096
     C***********          MOVE BBDS05    GNR,5                           CSW096
     C***********          MOVE BBDS06    GNR,6                           CSW096
     C***********          MOVE BBDS07    GNR,7                           CSW096
     C***********          MOVE BBDS08    GNR,8                           CSW096
     C***********          MOVE BBDS09    GNR,9                           CSW096
     C***********          MOVE BBDS10    GNR,10                          CSW096
     C***********          MOVE BBDS11    GNR,11                          CSW096
     C***********          MOVE BBDS12    GNR,12                          CSW096
     C***********          MOVE BBDS13    GNR,13                          CSW096
     C***********          MOVE BBDS14    GNR,14                          CSW096
     C***********          MOVE BBDS15    GNR,15                          CSW096
      ***********                                                         CSW096
      ****Is*message*type*not*generated*?*********************************CSW096
     C***********          MOVE BBNG01    MNG,1                           CSW096
     C***********          MOVE BBNG02    MNG,2                           CSW096
     C***********          MOVE BBNG03    MNG,3                           CSW096
     C***********          MOVE BBNG04    MNG,4                           CSW096
     C***********          MOVE BBNG05    MNG,5                           CSW096
     C***********          MOVE BBNG06    MNG,6                           CSW096
     C***********          MOVE BBNG07    MNG,7                           CSW096
     C***********          MOVE BBNG08    MNG,8                           CSW096
     C***********          MOVE BBNG09    MNG,9                           CSW096
     C***********          MOVE BBNG10    MNG,10                          CSW096
     C***********          MOVE BBNG11    MNG,11                          CSW096
     C***********          MOVE BBNG12    MNG,12                          CSW096
     C***********          MOVE BBNG13    MNG,13                          CSW096
     C***********          MOVE BBNG14    MNG,14                          CSW096
     C***********          MOVE BBNG15    MNG,15                          CSW096
      ***********                                                         CSW096
     C***********          ENDSR                                          CSW096
     C/EJECT
      *****************************************************************
      *   CHECK - Check if the matching criteria is met for an  MT203 *
      *   Called by   main process                                    *
      *               MS203  Format an MT203 message                  *
      *   Calls       -                                               *
      *****************************************************************
      *
     C           CHECK     BEGSR
     C/COPY WNCPYSRC,MG0202C008
      *                                                                                       CDL099
      ** Only check for SVD if FX/MM                                                          CDL099
      *                                                                                       CDL099
     C           MGMODI    IFEQ 'DL'                                                          CDL099
     C           CDL099    ANDEQ'Y'                                                           CDL099
     C                     Z-ADDMGVDAT    ULMVD   50                                          CDL099
     C                     MOVELMGTNUM    KYDLNO                                              CDL099
     C           KYDLNO    CHAINDEALS                40                                       CDL099
     C                     MOVE BSDT2     MGVDAT                                              CDL099
     C                     ENDIF                                                              CDL099
      *
      **  Determine if matching criteria are met for an MT203
      *
     C           KMODI     IFEQ MGMODI
     C           KDEST     ANDEQMGDEST
     C           KPOBR     ANDEQMGPOBR
     C           KVDAT     ANDEQMGVDAT
     C           KCCY      ANDEQMGCCY
     C           KPOBN     ANDEQMGPOBN
     C           KPONS     ANDEQMGPONS
     C           KRCRN     ANDEQMGRCRN
     C           KRVNO     ANDEQMGRVNO
     C           KSETP     ANDEQMGSETP
     C           KTNUM     ANDNEMGTNUM                                                        235581
     C/COPY WNCPYSRC,MG0202C074
      *
      **** Check that Message Status has not changed either               CSW096
      *                                                                   CSW096
     C                     MOVELO@MGST    KMGST   4                       CSW096
      *                                                                   CSW096
     C/COPY WNCPYSRC,MG0202C005
     C                     MOVE MGPOBR    I@SNBR                          CSW096
     C/COPY WNCPYSRC,MG0202C006
     C                     MOVE *BLANKS   I@DSCN                          CSW096
     C                     MOVE MGDEST    I@DSCN                          CSW096
     C                     MOVE '202'     I@MTPY                          CSW096
     C                     MOVE 'N'       I@CONC                          CSW096
     C                     Z-ADDMGSETP    I@SETT                          CSW096
     C                     MOVE *BLANK    I@FTCS                          CSW096
     C                     MOVE MGMODI    I@MMOD                          CSW096
      *###################################################################CSW096
      *                                                                  #CSW096
      * Below are two copy sources intended for setting up the custom    #CSW096
      * parameter (P@ZZ) in the call to MG9900.                          #CSW096
      * One (MG9900CALL) is in ALL MG generation programs and is for use #CSW096
      * when a change is required to all of them.                        #CSW096
      * The other is only in this program.                               #CSW096
     C/COPY WNCPYSRC,MG9900CALL                                          #CSW096
     C/COPY WNCPYSRC,MG0202ROUT                                          #CSW096
      *                                                                  #CSW096
      *###################################################################CSW096
     C                     CALL 'MG9900'                                  CSW096
     C                     PARM *BLANKS   @RTCD                           CSW096
     C                     PARM           P@IN                            CSW096
     C                     PARM *BLANKS   P@OUT                           CSW096
     C                     PARM           P@ZZ  256                       CSW096
      *                                                                   CSW096
     C           @RTCD     IFNE *BLANKS                                   CSW096
     C           *LOCK     IN   LDA                                       CSW096
     C                     MOVE '093'     DBASE              * * * * * * *CSW096
     C                     MOVEL'*CALL  ' DBKEY              * DBERR 093 *CSW096
     C                     MOVEL'MG9900'  DBFILE             * * * * * * *CSW096
     C                     OUT  LDA                                       CSW096
     C                     EXSR *PSSR                                     CSW096
     C                     ENDIF                                          CSW096
      *                                                                   CSW096
      **** If Message Status is the same, set Match Flag to Yes;          CSW096
      **** Otherwise, set Match Flag to NO                                CSW096
      *                                                                   CSW096
     C           O@MGST    IFEQ KMGST                                     CSW096
     C                     MOVE 'Y'       MATCH   1                       CSW096
      *                                                                                       CSW209
      ** If SWIFT 2009 is ON                                                                  CSW209
      ** Check if COV message needs to be created                                             CSW209
      *                                                                                       CSW209
     C           CSW209    IFEQ 'Y'                                                           CSW209
     C           MGCVMI    ANDEQ'S'                                                           CSW209
      *                                                                                       CSW209
     C           MGCVMI    IFEQ KCVMI                                                         CSW209
      *                                                                                       CSW209
     C           PRVCOV    IFEQ 'Y'                                                           CSW209
     C                     MOVE 'N'       MATCH                                               CSW209
     C                     ELSE                                                               CSW209
     C                     MOVE 'Y'       MATCH                                               CSW209
     C                     ENDIF                                                              CSW209
      *                                                                                       CSW209
     C                     ELSE                                                               CSW209
     C                     MOVE 'N'       PRTCOV  1                                           CSW209
      *                                                                                       CSW209
     C                     MOVE *BLANKS   IXDLNO                                              CSW209
     C                     MOVELKTNUM     IXDLNO                                              CSW209
     C           IXDLNO    SETLLMGCOVRPD                 40                                   CSW209
      *                                                                                       CSW209
     C           *IN40     IFEQ '1'                                                           CSW209
      *                                                                                       CSW209
      ** Setup parameters for AOBAGRV0                                                        CSW209
      *                                                                                       CSW209
     C                     MOVELNWSN      @SSID                                               CSW209
      *                                                                                       CSW209
     C                     MOVE *BLANKS   @KEY1                                               CSW209
     C                     MOVELMGBENN    @KEY1                                               CSW209
     C                     CALL 'AOCUSTR0'                                                    CSW209
     C                     PARM '*MSG   ' @RTCD                                               CSW209
     C                     PARM '*KEY   ' @OPTN                                               CSW209
     C                     PARM           @KEY1                                               CSW209
     C                     PARM *BLANKS   @KYST                                               CSW209
     C           SDCUST    PARM SDCUST    DSSDY                                               CSW209
      *                                                                                       CSW209
     C                     MOVEL*BLANKS   @RSID                                               CSW209
     C                     MOVELBBCSID    @RSID                                               CSW209
      *                                                                                       CSW209
     C                     MOVEL*BLANKS   @ORBK                                               CSW209
     C                     MOVELMGPOBN    @ORBK                                               CSW209
      *                                                                                       CSW209
     C                     MOVEL*BLANKS   @SCOR                                               CSW209
     C                     MOVELMGPONS    @SCOR                                               CSW209
      *                                                                                       CSW209
     C                     MOVEL*BLANKS   @RCOR                                               CSW209
     C                     MOVELMGRCRN    @RCOR                                               CSW209
      *                                                                                       CSW209
      ** Access MEBAGRPD to check bilateral agreement                                         CSW209
      *                                                                                       CSW209
     C                     CALL 'AOBAGRV0'                                                    CSW209
     C                     PARM *BLANKS   @RTCD                                               CSW209
     C                     PARM 'SCT_C202'@BAGR  10                                           CSW209
     C                     PARM MGPOBR    @BRCD                                               CSW209
     C                     PARM NWRK      @NWRK   6                                           CSW209
     C                     PARM '103'     @MTPY   3                                           CSW209
     C                     PARM MGCCY     @SCUR   3                                           CSW209
     C                     PARM MGCCY     @PCUR   3                                           CSW209
     C                     PARM           @SSID  11                                           CSW209
     C                     PARM           @RSID  11                                           CSW209
     C                     PARM *BLANKS   @VFLG   8                                           CSW209
     C                     PARM           @ORBK 256                                           CSW209
     C                     PARM *BLANKS   @SRCV 256                                           CSW209
     C                     PARM           @SCOR 256                                           CSW209
     C                     PARM           @RCOR 256                                           CSW209
      *                                                                                       CSW209
     C           @RTCD     IFEQ '*CRTCOV'                                                     CSW209
     C                     MOVE 'N'       MATCH                                               CSW209
     C                     ENDIF                                                              CSW209
      *                                                                                       CSW209
     C                     ENDIF                                                              CSW209
      *                                                                                       CSW209
     C                     ENDIF                                                              CSW209
     C                     ENDIF                                                              CSW209
      *                                                                                       CSW209
     C                     ELSE                                           CSW096
     C                     MOVE 'N'       MATCH                           CSW096
     C                     ENDIF                                          CSW096
      *                                                                   CSW096
     C***********          MOVE 'Y'       MATCH   1                       CSW096
     C/COPY WNCPYSRC,MG0202C075
     C                     ELSE
     C                     MOVE 'N'       MATCH
     C                     END
      *
     C/COPY WNCPYSRC,MG0202C009
      *                                                                                       CDL099
     C           MGMODI    IFEQ 'DL'                                                          CDL099
     C           CDL099    ANDEQ'Y'                                                           CDL099
     C                     Z-ADDULMVD     MGVDAT                                              CDL099
     C                     ENDIF                                                              CDL099
      *                                                                                       CDL099
     C           CSW025    IFEQ 'Y'                                                           CSW025
     C           CSW050    ANDNE'Y'                                                           242622
     C                     MOVE 'N'       MATCH                                               CSW025
     C                     ENDIF                                                              CSW025
      *                                                                                       CSW025
      ** If Message type a CLS message then do not create MG0203                              227679
     C           MGTTYP    IFEQ 'PC'                                                          227679
     C                     MOVE 'N'       MATCH                                               227679
     C                     ENDIF                                                              227679
      *                                                                                       227679
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   MS202 - Format an MT202 message                             *
      *   Called by   main process                                    *
      *   Calls       COMM   format common fields 21/22/32A or 32B    *
      *               FLD52  format field 52 (ordering institution)   *
      *               FLD53  format field 53 (senders correspondent)  *
      *               FLD54  format field 54 (receivers correspondent)*
      *               MESG   format fields 56/57/58 & 72              *
      *               OMSG   output correctly generated message       *
      *               REPT   report incorrectly generated message     *
      *****************************************************************
      *
     C           MS202     BEGSR
     C/COPY WNCPYSRC,MG0202C049
      *
      *
     C                     MOVE '202'     MTPY
      *
      **  Format Fields 20, 21 and 32A or 32B
      *
     C                     EXSR COMM
      *
     C/COPY WNCPYSRC,MG0202C022
      **  Format Fields 52, 53 and 54
      *
     C                     EXSR FLD52
     C                     EXSR FLD53
     C                     EXSR FLD54
      *
      **  Format Fields 56, 57, 58 and 72
      *
     C                     EXSR MESG
      *                                                                                       CSW209
     C           CSW209    IFEQ 'Y'                                                           CSW209
     C           COV103    ANDEQ'Y'                                                           CSW209
     C                     EXSR SRCOV                                                         CSW209
     C                     ENDIF                                                              CSW209
     C/COPY WNCPYSRC,MG0202C050
      *
      **  Report if error on message formatting
      *
     C           @ERR      IFEQ 'Y'
     C                     EXSR REPT
     C                     ELSE
     C/COPY WNCPYSRC,MG0202C036
      *
      *                                                                                       221145
      **  Store individual message details for Compliance Watch Checking                      221145
      *                                                                                       221145
     C                     MOVE *BLANK    WLTDS                                               221145
      *                                                                                       221145
     C                     Z-ADD*ZERO     W4VDAT                                              221145
     C                     Z-ADD*ZERO     W4MDAT                                              221145
     C                     Z-ADD*ZERO     W4AMT1                                              221145
     C                     Z-ADD*ZERO     W4AMT2                                              221145
     C                     MOVEL@TRNO     W4IDEN                                              221145
     C                     MOVEL'202'     W4ITEM                                              221145
     C                     MOVELMGPOBR    W4BRCH                                              221145
     C                     MOVEL'MGOREF'  W4FUNT                                              221145
     C                     MOVELMGDEST    W4CNUM                                              221145
     C                     Z-ADDBJRDNB    W4DDAT                                              221145
     C           MGST      IFEQ 'RSND'                                                        221145
     C                     MOVEL'Y'       W4ARLS                                              221145
     C                     ELSE                                                               221145
     C                     MOVEL'N'       W4ARLS                                              221145
     C                     ENDIF                                                              221145
      *                                                                                       221145
      **  Write message to PF/MGOMSGPD
      *
     C                     EXSR OMSG
     C                     END
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   MS203 - Format an MT203 message                             *
      *   Called by   main process                                    *
      *   Calls       FMTHD  format fields 19, 30, 52, 53, 54         *
      *               COMM   format fields 20, 21, 32(A OR B)         *
      *               MESG   format fields 56, 57, 58 & 72            *
      *               RMVMSG remove message part from DS MULT         *
      *               CHECK  check matching criteria is met for MT203 *
      *               CONVRT convert one part MT203 to an MT202       *
      *               OMSG   output correctly generated message       *
      *****************************************************************
      *
     C           MS203     BEGSR
     C/COPY WNCPYSRC,MG0202C051
      *
     C                     MOVE '203'     MTPY
      *
      **  Initialise amount of Field 19 & the no. of parts of the MT203
      **  blank array for the transaction numbers used in the MT203       E29588
     C                     Z-ADD0         FLD19  170
     C                     Z-ADD0         PARTS   20
     C                     MOVEA*BLANKS   R203                            E29588
     C                     Z-ADD0         P       20                      E29588
      *
      **  Format Fields 19, 30, 52, 53 and 54 & remove the bytes
     C                     EXSR FMTHD
     C                     SUB  BYTRMV    BYTES
      *
      **  While the matching criteria is met & bytes remain for the
     C****whole*message*&*the*maximum*10*parts*allowed*not*met,*and****   051356
     C**  whole message & the maximum 8 parts allowed not met, and        051356
      **  not end of file; format the parts of the MT203
      *
     C           MATCH     DOWEQ'Y'
     C           BYTES     ANDGT90
     C***********PARTS     ANDLT10                                        051356
     C           PARTS     ANDLT8                                         051356
     C           *IN10     ANDEQ'0'
      *
      **  save the start position of this part
      **  increment the number of parts and field 19
     C                     Z-ADD0         BYTRMV  40
     C                     Z-ADDX         STPOS   20
     C                     Z-ADDV         STPOSV  20                      183583
     C                     ADD  1         PARTS
      *                                                                   CSW020
      * CSW020: If the swift number decimal places is less than the       CSW020
      *         normal number of decimal place, zeroise the extra decimalsCSW020
      *         when incrementing the sum of amount (FLD19).              CSW020
     C           WCHGRQ    IFEQ 'Y'                                       CSW020
     C           MGEAMT    DIV  WPOWER    NWEAMT 130                      CSW020
     C                     MULT WPOWER    NWEAMT 130                      CSW020
     C                     ADD  NWEAMT    FLD19                           CSW020
     C                     ELSE                                           CSW020
     C                     ADD  MGEAMT    FLD19
     C                     ENDIF                                          CSW020
      *
      **  Save the start position of the first part
      *
     C           PARTS     IFEQ 1
     C                     Z-ADDSTPOS     FIRST   20
     C                     END
      *
      **  Construct the header part of the MT203
      **  Format Fields 20, 21 and 32A or 32B
     C                     EXSR COMM
      *
      **  Set up reference file information for each part of the MT203
      *
     C           PARTS     OCUR REF203
     C           PARTS     OCUR PART
     C                     MOVEL@TRNO     @RTRN
     C                     MOVELMGTNUM    @MTRN
     C                     MOVELMGTTYP    @TNTP
     C                     MOVELMGTSTP    @SBTP
     C                     MOVELMGBENN    @NWBN
     C                     MOVELZSAMNT    @AMTS
     C                     MOVELMGBRCA    @OTHB
     C                     MOVELMGMODI    @MOD
     C                     MOVELZSCCY     @ZSCCY                                              187271
      *                                                                                       221145
      **  Store transaction details of first message for Compliance Watch checking            221145
      *                                                                                       221145
     C           PARTS     IFEQ 1                                                             221145
     C                     MOVE *BLANK    WLTDS                                               221145
      *                                                                                       221145
     C                     Z-ADD*ZERO     W4VDAT                                              221145
     C                     Z-ADD*ZERO     W4MDAT                                              221145
     C                     Z-ADD*ZERO     W4AMT1                                              221145
     C                     Z-ADD*ZERO     W4AMT2                                              221145
     C                     MOVEL@TRNO     W4IDEN                                              221145
     C                     MOVEL'203'     W4ITEM                                              221145
     C                     MOVELMGPOBR    W4BRCH                                              221145
     C                     MOVEL'MGOREF'  W4FUNT                                              221145
     C                     MOVELMGDEST    W4CNUM                                              221145
     C                     Z-ADDBJRDNB    W4DDAT                                              221145
     C           MGST      IFEQ 'RSND'                                                        221145
     C                     MOVEL'Y'       W4ARLS                                              221145
     C                     ELSE                                                               221145
     C                     MOVEL'N'       W4ARLS                                              221145
     C                     ENDIF                                                              221145
      *                                                                                       221145
     C                     ENDIF                                                              221145
      *
      **  Format the part of the MT203, fields 56/57/58/72
      *
     C                     EXSR MESG
      *
      **  If an error in formatting the message or run out bytes
      **  for the message, delete the current part of the message
      **  and print out a report of the erroneous part
     C           @ERR      IFEQ 'Y'
     C           RANOUT    OREQ 'Y'
     C                     EXSR RMVMSG
     C                     ELSE                                           E29588
     C                     ADD  1         P                               E29588
     C                     MOVEL@MTRN     R203,P                          E29588
     C                     END
      *
      **  Read the next message, if bytes remain  OR
      **  no bytes remain and there was a formatting error;
      **  Do not read the next message if no bytes remain, as we
      **  wish to process this message again, if no format error.
      *
     C           RANOUT    IFEQ 'N'
     C           RANOUT    OREQ 'Y'
     C           @ERR      ANDEQ'Y'
     C           CSW025    IFEQ 'Y'                                                           242622
     C                     READ MGF202L1                 10                                   242622
     C                     ELSE                                                               242622
     C                     READ MGF202L0                 10
     C                     ENDIF                                                              242622
     C/COPY WNCPYSRC,MG0202C085
      *
      **  Check if next message could be part of this multiple
      *
     C           *IN10     IFEQ '0'
     C                     EXSR CHECK
      *                                                                   E29588
      **  MT203 should not contain more than one part for any trans no    E29588
      **  except if payment is made through CLS Schedule                  CDL008
     C                     MOVELMGTNUM    RTNUM   6                       E29588
     C           MGTTYP    IFNE 'PC'                                      CDL008
     C           RTNUM     LOKUPR203                     23               E29588
     C           *IN23     IFEQ '1'                                       E29588
     C                     MOVE 'N'       MATCH                           E29588
     C                     END                                            E29588
     C                     ENDIF                                          CDL008
     C                     END
      *                                                                   E29588
     C                     END
      *
     C                     MOVE 'N'       @ERR
      *
     C                     END                              do while
      *
      **  Write a one part MT203 as an MT202;  Else write the MT203
      *
     C           CSW025    IFEQ 'Y'                                                           242622
     C                     READPMGF202L1                 10                                   242622
     C                     ELSE                                                               242622
     C                     READPMGF202L0                 10
     C                     ENDIF                                                              242622
     C/COPY WNCPYSRC,MG0202C086
     C           PARTS     IFEQ 1
     C                     EXSR CONVRT
     C                     ELSE
      *
      **  No message if error on the first part (PARTS defaulted to 15)
     C           PARTS     IFNE 15
     C                     EXSR OMSG
     C                     END
     C                     END
     C/COPY WNCPYSRC,MG0202C052
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   FMTHD - Format the header part of an MT203 message          *
      *   Called by   MS203  format an MT203 message                  *
      *   Calls       FLD52  format field 52 (ordering institution)   *
      *               FLD53  format field 53 (senders correspondent)  *
      *               FLD54  format field 54 (receivers correspondent)*
      *****************************************************************
      *
     C           FMTHD     BEGSR
     C/COPY WNCPYSRC,MG0202C100
      *
      **  Field :19:  output tag
      *
     C                     Z-ADD1         X
     C           X         OCUR MULT
     C/COPY WNCPYSRC,MG0202C038
     C                     MOVE ':19: '   MTAG
     C/COPY WNCPYSRC,MG0202C039
     C                     Z-ADD25        BYTRMV
     C/COPY WNCPYSRC,MG0202C040
      *
      **  Field :30:  value date
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C/COPY WNCPYSRC,MG0202C010
      *                                                                                       CDL099
      ** Only check for SVD if FX/MM                                                          CDL099
      *                                                                                       CDL099
     C           MGMODI    IFEQ 'DL'                                                          CDL099
     C           CDL099    ANDEQ'Y'                                                           CDL099
     C                     Z-ADDMGVDAT    ULMVD   50                                          CDL099
     C                     MOVELMGTNUM    KYDLNO                                              CDL099
     C           KYDLNO    CHAINDEALS                40                                       CDL099
     C                     MOVE BSDT2     MGVDAT                                              CDL099
     C                     ENDIF                                                              CDL099
      *                                                                                       CDL099
     C                     CALL 'ZM0060'               15
     C                     PARM MGVDAT    ZMDAY   50
     C                     PARM           ZMDATE  6
     C/COPY WNCPYSRC,MG0202C011
      *                                                                                       CDL099
     C           MGMODI    IFEQ 'DL'                                                          CDL099
     C           CDL099    ANDEQ'Y'                                                           CDL099
     C                     Z-ADDULMVD     MGVDAT                                              CDL099
     C                     ENDIF                                                              CDL099
      *
      **  Error on call ?
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '009'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 009  *
     C                     MOVEL'ZM0060'  DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
     C                     MOVE ':30: '   MTAG
     C                     MOVELZMDATE    MFLD
     C                     ADD  12        BYTRMV
      *
      **  Field :52:  Ordering Institution
      *
     C                     EXSR FLD52
      *
      **  Field :53:  Senders Correspondent
      *
     C                     EXSR FLD53
      *
      **  Field :54:  Receivers Correspondent
      *
     C                     EXSR FLD54
      *
      **  Save end postition of header
      *
     C                     Z-ADDX         ENDHD   20
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   COMM  - Format common fields 20/21 & 32(A or B)             *
      *   Called by - MS202  format an MT202 message                  *
      *               MS203  format an MT203 message                  *
      *   Calls     -                                                 *
      *****************************************************************
      *
     C           COMM      BEGSR
      *                                                                                       CSW209
     C           CSW209    IFEQ 'Y'                                                           CSW209
     C                     MOVEL'N'       COV103  1                                           CSW209
     C                     ENDIF                                                              CSW209
      *
      **  Access the approriate transaction file for the SWIFT sequence
      *
     C                     EXSR SEQN
     C/COPY WNCPYSRC,MG0202C055
      *
      **  Field :20:  Transaction reference number
      *
      **  Field 20 starts at position one only for an MT202
     C           MTPY      IFEQ '202'
     C                     Z-ADD1         X       20
     C                     ELSE
     C                     ADD  1         X
     C                     END
     C/COPY WNCPYSRC,MG0202C056
     C           X         OCUR MULT
     C/COPY WNCPYSRC,MG0202C041
      *                                                                   CDL002
      **  Only proceed if FX Netting switchable feature is off,           CDL002
      **  or its on and the module id is not 'NT'                         CDL002
      *                                                                   CDL002
     C           CDL002    IFEQ 'N'                                       CDL002
     C           CDL002    OREQ 'Y'                                       CDL002
     C           MGMODI    ANDNE'NT'                                      CDL002
      *
      **  In a work array, build up the variable length TRN
      *
     C                     MOVE *BLANKS   @WRK
      *                                                                   CLE007
     C           CLE007    IFEQ 'Y'                                       CLE007
     C           MGMODI    ANDEQ'LF'                                      CLE007
     C           CLE007    OREQ 'Y'                                       CLE007
     C           MGMODI    ANDEQ'LS'                                      CLE007
     C***********          MOVEAMGTNUM    @WRK                      CLE007142403
     C                     MOVE 'F'       @WRK,1                          142403
     C                     MOVEAMGTNUM    @WRK,2                          142403
      *                                                                   142403
      * For a loan based fee, midas transaction is 14 characters long,    142403
      * so remove customer number, since there will not be room for it    142403
      * in the SWIFT transaction ref.                                     142403
     C           @WRK,15   IFNE *BLANK                                    142403
     C                     MOVEA@WRK,8    W#LNSQ  8                       142403
     C                     MOVEAW#LNSQ    @WRK,2    P                     142403
     C                     ENDIF                                          142403
      *                                                                   CLE007
     C                     ELSE                                           CLE007
     C                     MOVEAMGMODI    @WRK
     C                     MOVEAMGTNUM    @WRK,3
     C                     ENDIF                                          CLE007
      *
      **  Tag onto the end the sequence number
      *
     C           MGLSWS    ADD  1         @SWS    30
     C                     MOVE @SWS      @LSWS   3
     C                     Z-ADD1         I
     C           ' '       LOKUP@WRK,I                   22
      *                                                                   CLE007
     C           CLE007    IFEQ 'Y'                                       CLE007
     C           MGMODI    ANDEQ'LF'                                      CLE007
     C           CLE007    OREQ 'Y'                                       CLE007
     C           MGMODI    ANDEQ'LS'                                      CLE007
     C                     MOVE @SWS      WSWS    2                       CLE007
     C                     MOVEAWSWS      @WRK,I                          CLE007
      *                                                                   CLE007
     C                     ELSE                                           CLE007
      *                                                                   CDL008
      ** For CLS pay-in schedules, midas transaction is 16 characters     CDL008
      ** long so do not add sequence number at the end                    CDL008
      *                                                                   CDL008
     C           MGTTYP    IFNE 'PC'                                      CDL008
     C                     MOVEA@LSWS     @WRK,I
     C                     ENDIF                                          CDL008
     C                     ENDIF                                          CLE007
     C                     MOVE ':20: '   MTAG
     C/COPY WNCPYSRC,MG0202C087
     C                     MOVEA@WRK      MFLD
     C/COPY WNCPYSRC,MG0202C088
      *
      **  Determine if the TRN is unique
     C                     MOVEA@WRK      @TRNO  16
      *
     C           @TRNO     CHAINMGREFL0              11
      *
      **  Cannot have duplicate keys, hence error
     C           *IN11     IFEQ '0'
     C                     MOVELMSGA,7    MERR
     C                     MOVE 'Y'       @ERR
     C                     END
     C                     ADD  22        BYTRMV
      *                                                                   CDL002
     C                     ENDIF                                          CDL002
     C/COPY WNCPYSRC,MG0202C091
      *                                                                   CDL002
      **  If FX Netting switchable feature is on and and the              CDL002
      **  module id is 'NT' chain FXNETML4 using Net no.                  CDL002
      **  from MGF202PD                                                   CDL002
      *                                                                   CDL002
     C           CDL002    IFEQ 'Y'                                       CDL002
     C           MGMODI    ANDEQ'NT'                                      CDL002
      *                                                                   CDL002
     C           *LIKE     DEFN AMNTNO    DEALNO                          CDL002
     C                     MOVELMGTNUM    DEALNO                          CDL002
     C           DEALNO    CHAINFXNETML4             25                   CDL002
     C           *IN25     IFEQ *OFF                                      CDL002
     C                     MOVE ':20: '   MTAG                            CDL002
     C                     ADD  22        BYTRMV                          CDL002
      *                                                                   CDL002
      **  In a work array, build up the variable length TRN               CDL002
      *                                                                   CDL002
     C                     MOVE *BLANKS   @WRK                            CDL002
     C                     MOVEAMGMODI    @WRK                            CDL002
     C                     MOVEAMGTNUM    @WRK,3                          CDL002
      *                                                                   CDL002
      **  Tag onto the end the sequence number                            CDL002
      *                                                                   CDL002
     C           MGLSWS    ADD  1         @SWS                            CDL002
     C                     MOVE @SWS      @LSWS                           CDL002
     C                     Z-ADD1         I                               CDL002
     C           ' '       LOKUP@WRK,I                   22               CDL002
     C                     MOVEA@LSWS     @WRK,I                          CDL002
      *                                                                   CDL002
      **  Determine if the TRN is unique                                  CDL002
     C                     MOVEA@WRK      @TRNO                           CDL002
     C                     MOVEA@WRK      MFLD                            CDL002
      *                                                                   CDL002
     C           @TRNO     CHAINMGREFL0              11                   CDL002
      *                                                                   CDL002
      **  Cannot have duplicate keys, hence error                         CDL002
     C           *IN11     IFEQ '0'                                       CDL002
     C                     MOVELMSGA,7    MERR                            CDL002
     C                     MOVE 'Y'       @ERR                            CDL002
     C                     END                                            CDL002
      *                                                                   CDL002
     C                     ELSE                                           CDL002
     C           *LOCK     IN   LDA                                       CDL002
     C                     MOVE '030'     DBASE            * * * * * * * *CDL002
     C                     MOVELDEALNO    DBKEY            *  DBERR 030  *CDL002
     C                     MOVEL'FXNETML4'DBFILE           * * * * * * * *CDL002
     C                     OUT  LDA                                       CDL002
     C                     EXSR *PSSR                                     CDL002
     C                     ENDIF                                          CDL002
     C                     ENDIF                                          CDL002
      *
      **  Field :21:  Related reference
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C/COPY WNCPYSRC,MG0202C057
      *                                                                   105577
      ** If a Cover MT202 then look for Related Ref of MT100              105577
      *                                                                   105577
     C                     MOVE '0'       *IN41                           105577
     C           MGCVMI    IFEQ 'S'                                       105577
     C                     MOVE *BLANKS   IXDLNO  6                       105577
     C                     MOVELMGTNUM    IXDLNO                          105577
     C           IXDLNO    SETLLMGCOVRPD                 40               105577
      *                                                                   105577
      *                                                                   105577
     C           *IN40     IFEQ '0'                                       105577
     C                     MOVE '1'       *IN41            21:  NOT SET   105577
     C           CSW209    IFEQ 'Y'                                                           CSW209
     C                     MOVEL'N'       PRVCOV  1                                           CSW209
     C                     ENDIF                                                              CSW209
     C                     ELSE                                           105577
     C           IXDLNO    SETGTMGCOVRPD                                  105577
     C                     READPMGCOVRPD                 42               105577
      *                                                                   105577
      ** TRN found in Rel. Msg file.                                      105577
      *                                                                   105577
     C                     MOVELCVTRN     ZCREF                           105577
     C           CSW209    IFEQ 'Y'                                                           CSW209
     C                     MOVEL'Y'       COV103                                              CSW209
     C                     ENDIF                                                              CSW209
     C                     END                                            105577
     C                     ELSE                                           105577
     C                     MOVE '1'       *IN41                           105577
     C                     END                                            105577
      *                                                                   105577
      ** If Rel. record not found,                                        105577
      ** Or Message not cover      then process as normal                 105577
     C           *IN41     IFEQ '1'                                       105577
      *                                                                   105577
      *                                                                   CDL002
      **  Only proceed if FX Netting switchable feature is off,           CDL002
      **  or its on and the module id is not 'NT'                         CDL002
      *                                                                   CDL002
     C           CDL002    IFEQ 'N'                                       CDL002
     C           CDL002    OREQ 'Y'                                       CDL002
     C           MGMODI    ANDNE'NT'                                      CDL002
      **  Access SDBRCHPD using branch code
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM MGBRCA    @BRCD   3
     C           SDBRCH    PARM SDBRCH    DSSDY
      *
      ** Branch record not found - Error
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '010'     DBASE            * * * * * * * *
     C                     MOVELMGBRCA    DBKEY            *  DBERR 010  *
     C                     MOVEL'SDBRCHPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Access SDCUSTPD using Customer Number
     C                     MOVE *BLANKS   @KEY1
     C                     MOVELMGCNUM    @KEY1
     C                     CALL 'AOCUSTR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           @KEY1  10
     C                     PARM *BLANKS   @KYST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
      **  If customer exist and has a SWIFT address then
      **  format the SWIFT common reference
      *
     C                     MOVE *BLANKS   ZCREF
     C           @RTCD     IFEQ *BLANKS
     C           BBCSID    ANDNE*BLANKS
     C/COPY WNCPYSRC,MG0202C076
      *
     C                     MOVELA8BTID    ZSSWI
     C                     MOVELBBCSID    ZDSWI
     C                     MOVE MGRATE    ZRATE
     C                     CALL 'ZM0020'               15
     C                     PARM           ZSSWI  12
     C                     PARM           ZDSWI  12
     C                     PARM           ZRATE  138
     C                     PARM           ZCREF  16
      *
      **  Error on call (program not found)
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '011'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 011  *
     C                     MOVEL'ZM0020'  DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C/COPY WNCPYSRC,MG0202C082
     C                     END
      *
      ** Customer record not found - Error
      *
     C           @RTCD     IFNE *BLANKS
     C           ZCREF     OREQ *BLANKS
      *
      **  Not the first message, reference TRN of last confirmation
     C           MGLSWC    IFGT 0
     C                     MOVE MGLSWC    @LSWC   3
     C                     MOVEA@LSWC     @WRK,I
     C                     MOVEA@WRK      ZCREF
      *
      **  First message, reference TRN of this message
     C                     ELSE
     C                     MOVEL@TRNO     ZCREF
     C                     END
     C                     END
      *                                                                   105577
     C                     END                                            105577
      *
     C                     ENDIF                                          129211
      *                                                                   129211
     C                     MOVE ':21: '   MTAG
     C/COPY WNCPYSRC,MG0202C089
     C                     MOVELZCREF     MFLD
     C/COPY WNCPYSRC,MG0202C090
     C                     ADD  22        BYTRMV
      *                                                                   CDL002
     C************         ENDIF                                    CDL002129211
      *                                                                   CDL002
      **  If FX Netting switchable feature is on and and the              CDL002
      **  module id is 'NT' obtain FXNETML4 using Net no.                 CDL002
      **  from MGF202PD                                                   CDL002
      *                                                                   CDL002
     C           CDL002    IFEQ 'Y'                                       CDL002
     C           MGMODI    ANDEQ'NT'                                      CDL002
     C                     MOVELAMNETR    ZCREF                           CDL002
     C                     MOVE ':21: '   MTAG                            CDL002
     C                     MOVELZCREF     MFLD                            CDL002
     C                     ADD  22        BYTRMV                          CDL002
     C                     ENDIF                                          CDL002
     C/COPY WNCPYSRC,MG0202C058
      *
      **  Field :32A:  value date, currency code, amount (MT202) OR
      **  Field :32B:  currency code, amount (MT203)
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      **  Format value date to SWIFT standard
     C                     MOVE MGVDAT    ZMDAY
     C/COPY WNCPYSRC,MG0202C012
      *                                                                                       CDL099
      ** Only check for SVD if FX/MM                                                          CDL099
      *                                                                                       CDL099
     C           MGMODI    IFEQ 'DL'                                                          CDL099
     C           CDL099    ANDEQ'Y'                                                           CDL099
     C                     MOVELMGTNUM    KYDLNO                                              CDL099
     C           KYDLNO    CHAINDEALS                40                                       CDL099
     C                     MOVE BSDT2     ZMDAY                                               CDL099
     C                     ENDIF                                                              CDL099
      *                                                                                       CDL099
     C                     CALL 'ZM0060'               15
     C                     PARM           ZMDAY
     C                     PARM           ZSDATE
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '012'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 012  *
     C                     MOVEL'ZM0060'  DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Format purchase currency and amount
     C/COPY WNCPYSRC,MG0202C099
     C                     MOVE MGCCY     ZCCY
     C/COPY WNCPYSRC,MGH00085
     C                     MOVE MGEAMT    ZAMNT
     C                     CALL 'ZM0040'               15
     C                     PARM           ZAMNT  130
     C                     PARM           ZCCY    3
     C                     PARM           ZSAMNT
     C                     PARM           ZSCCY   3
     C                     PARM           ZERR    1
     C                     PARM           ZSWDPC  1                                           222373
      *
      **  Call ended in error (program not found)
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '013'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 013  *
     C                     MOVEL'ZM0040'  DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      ** Error - indicate erroneous fields;
     C           ZERR      IFEQ '1'
     C                     MOVE 'Y'       @ERR
     C                     MOVE MGEAMT    ZAMT
     C                     MOVE MGCCY     ZCCY
     C                     MOVELERR3N     MFLD
     C                     MOVELMSGA,4    MERR
      *
     C                     ELSE
     C           MATCH     IFEQ 'Y'
     C                     MOVE ':32B:'   MTAG
     C                     MOVE FLD3A     HOLD20 20
     C                     MOVELHOLD20    MFLD
     C                     ADD  25        BYTRMV
     C                     ELSE
     C                     MOVE ':32A:'   MTAG
     C                     MOVELFLD3A     MFLD
     C                     END
      *                                                                   144171
      ** Save event amount.                                               144171
      *                                                                   144171
     C                     MOVEL*BLANKS   SAMNT  17                       144171
     C                     MOVELZSAMNT    SAMNT                           144171
      *                                                                   144171
     C                     END
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   MESG -  Format fields 56/57/58 & 72                         *
      *   Called by   main process                                    *
      *   Calls       FLD56  format field 56 (intermediary bank)      *
      *               FLD57  format field 57 (a/c with institution)   *
      *               FLD58  format field 58 (beneficiary)            *
      *               FLD72  format field 72 (Sender to Receiver Info)*
      *****************************************************************
      *
     C           MESG      BEGSR
      *
     C                     MOVE 'N'       RANOUT  1
      *
      **  Field :56:  Intermediary bank
      *
     C                     EXSR FLD56
      *
      **  Field :57:  Account with Institution
      *
     C/COPY WNCPYSRC,MGH00011
     C                     EXSR FLD57
     C/COPY WNCPYSRC,MGH00012
      *
      **  Field :58:  Beneficiary
      *
     C                     EXSR FLD58
     C/COPY WNCPYSRC,MG0202C095
      *
      **  Field :72:  Sender to Receiver information
      *
     C                     EXSR FLD72
     C/COPY WNCPYSRC,MG0202C096
      *
      **  Build a multiple message with the most parts possible by
      **  subtracting the amount of bytes for this part of a MT203
      **  from the total amount of bytes that can be used.
      *
     C                     SUB  BYTRMV    BYTES
      *
      **  Indicate if we have run out of bytes for the whole MT203
      *
     C           BYTES     IFLT 0
     C                     MOVE 'Y'       RANOUT
     C                     END
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   FLD52 - Format field 52 (Ordering Institution)              *
      *   Called by - FMTHD  format the header part of an MT203       *
      *   Calls       FSWAD  format swift address                     *
      *****************************************************************
      *
     C           FLD52     BEGSR
      *
      **  Field :52:  Ordering Institution
      *
      *                                                                   S01408
     C/COPY WNCPYSRC,MG0202CP12                                           S01408
      *                                                                   S01408
     C********** MGPOBN    IFNE 0                                                             CSD027
     C           MGPOBN    IFNE *BLANKS                                                       CSD027
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      **  format address
     C                     MOVE *BLANKS   ACLINE
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELMGPOBN    ZDEST
     C                     MOVE ' '       TAG
     C                     MOVE '52'      FLDNO
     C                     EXSR FSWAD
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,MG0202CP13                                           S01408
     C*                                                                   S01408
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   FLD53 - Format field 53 (Senders Correspondent)             *
      *   Called by - FMTHD  format the header part of an MT203       *
      *   Calls       FSWADS format swift address                     *
      *****************************************************************
      *
     C           FLD53     BEGSR
     C/COPY WNCPYSRC,MGH00056
      *
      **  Field 53  Sender's correspondent
     C           MGTTYP    IFEQ 'PC'                                                          210796
     C                     MOVELMGCCY     WCCY                                                210796
     C                     MOVELMGPONS    WLPR                                                210796
      *                                                                                       210796
     C           KCLS      CHAINSDNOSTL8             80                                       210796
      *                                                                                       210796
      ** If dummy nostro is not found, database error.                                        210796
     C           *IN80     IFEQ *ON                                                           210796
     C           *LOCK     IN   LDA                                                           210796
     C                     MOVEL'SDNOSTL8'DBFILE                                              210796
     C                     Z-ADD032       DBASE                                               210796
     C           MGCCY     CAT  MGPONS:0  DBKEY                                               210796
     C                     OUT  LDA                                                           210796
     C                     EXSR *PSSR                                                         210796
      *                                                                                       210796
     C                     ELSE                                                               210796
      *                                                                                       210796
     C           A7OACN    IFNE *BLANK                                                        210796
     C                     ADD  1         X                                                   210796
     C           X         OCUR MULT                                                          210796
     C                     MOVE ':53B:'   MTAG                                                210796
     C           1         SUBSTA7OACN:1  WSLSH   1                                         MD036542
     C           WSLSH     IFEQ '/'                                                         MD036542
     C                     MOVELA7OACN    MFLD                                              MD036542
     C                     ELSE                                                             MD036542
     C           '/'       CAT  A7OACN:0  MFLD                                                210796
     C                     ENDIF                                                            MD036542
     C                     END                                                                210796
     C                     END                                                                210796
      *                                                                                       210796
     C                     ELSE                                                               210796
      *                                                                                       210796
     C           MGRVNO    IFEQ *BLANKS                                                     MD035921
     C                     MOVELMGCCY     WCCY                                              MD035921
     C                     MOVELMGPONS    WLPR                                              MD035921
      *                                                                                     MD035921
     C           KCLS      CHAINSDNOSTL0             80                                     MD035921
      *                                                                                     MD035921
     C           *IN80     IFEQ *OFF                                                        MD035921
      *                                                                                     MD035921
     C           A7OACN    IFNE *BLANK                                                      MD035921
     C                     ADD  1         X                                                 MD035921
     C           X         OCUR MULT                                                        MD035921
     C                     MOVE ':53B:'   MTAG                                              MD035921
     C           1         SUBSTA7OACN:1  WSLSH   1                                         MD036542
     C           WSLSH     IFEQ '/'                                                         MD036542
     C                     MOVELA7OACN    MFLD                                              MD035921
     C                     ELSE                                                             MD036542
     C           '/'       CAT  A7OACN:0  MFLD                                              MD036542
     C                     ENDIF                                                            MD036542
     C                     ENDIF                                                            MD035921
     C                     ENDIF                                                            MD035921
     C                     ENDIF                                                            MD035921
      *                                                                                     MD035921
     C/COPY WNCPYSRC,MG0202C059
     C           MGRVNO    IFNE *BLANKS
      *                                                                   CMG001
      * Always execute the following codes if CMG001 is on                CMG001
     C           CMG001    OREQ 'Y'                                       CMG001
      *                                                                   S01408
     C/COPY WNCPYSRC,MG0202CCPG                                           S01408
      *                                                                   S01408
      *
      **  Access nostro account
     C                     MOVELMGPONS    @NSKYE
     C                     CALL 'AONOSTR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM *BLANKS   @NSKYA  6
     C                     PARM MGCCY     @NSKYB  3
     C**********           PARM *BLANKS   @NSKYC  4                                           CGL029
     C                     PARM *BLANKS   @NSKYC 10                                           CGL029
     C                     PARM *BLANKS   @NSKYD  2
     C                     PARM           @NSKYE  2
     C                     PARM *BLANKS   @KEYF   3
     C                     PARM *BLANKS   @KEYG  10
     C                     PARM *BLANKS   @KEYH   1
     C           SDNOST    PARM SDNOST    DSFDY
      *
      **  Nostro customer not found
     C           @RTCD     IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE 'Y'       @ERR
     C                     MOVE ':53 :'   MTAG
     C                     MOVELMGPONS    MFLD
     C                     MOVELMSGA,3    MERR
      *
     C                     ELSE
      *                                                                   S01408
     C/COPY WNCPYSRC,MG0202CCP5                                           S01408
      *                                                                   S01408
     C           CMG001    IFEQ 'Y'                                       CMG001
     C                     ADD  1         X                               CMG001
     C           X         OCUR MULT                                      CMG001
     C                     MOVE ':53B:'   MTAG                            CMG001
     C                     MOVE *BLANKS   MFLD                            CMG001
      *                                                                                       210796
      *  Extend Our a/c at Nostro field from 15A to 35A                                       210796
      *  and truncate the 35th character.                                                     210796
     C                     MOVEL'/'       TEMP1  35                                           210796
     C                     MOVELA7OACN    TEMP2  34                                           210796
     C                     MOVE TEMP2     TEMP1                                               210796
      *                                                                                       210796
     C                     MOVELTEMP1     MFLD                            CMG001
     C                     GOTO BOBIS                                     CMG001
     C                     ENDIF                                          CMG001
      *                                                                   CMG001
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELA7CUST    ZDEST
     C                     CALL 'ZM0050'               15
     C                     PARM           ZDEST  12
     C                     PARM           ZSADD1 35
     C                     PARM           ZSADD2 35
     C                     PARM           ZSADD3 35
     C                     PARM           ZSADD4 35
     C                     PARM           ZSTAG   1
     C                     PARM           ZSTYPE  1
     C                     PARM           ZERR    1
     C                     PARM           ZDBEI   1                                           CSW201
      *
      **  Error on call (program not found)
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '014'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 014  *
     C                     MOVEL'ZM0050'  DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Error when formating address
     C           ZERR      IFEQ '1'
     C                     MOVE 'Y'       @ERR
     C                     MOVE ':53 :'   MTAG
     C                     MOVELZDEST     MFLD
     C                     MOVELMSGA,5    MERR
      *
      **  Format field 53 address
     C                     ELSE
     C                     MOVE *BLANKS   @CNUM
     C                     MOVELA7CUST    @CNUM  10
     C                     MOVE *BLANKS   ACLINE 35
     C                     MOVE ' '       TAG
     C                     MOVE '53'      FLDNO
      *
      **  Use senders customer number and parent number
     C                     MOVELSECN      SRCNUM  6
     C                     MOVELSPCNB     SRPCNB  6
     C/COPY WNCPYSRC,MGH00006
     C                     EXSR FSWADS
     C/COPY WNCPYSRC,MGH00007
     C                     END                             ZM0050 error?
      *
     C                     END                             Nostro exist
      *
     C                     END
     C                     END                                                                210796
      *                                                                   S01408
     C/COPY WNCPYSRC,MG0202CCP9                                           S01408
      *                                                                   S01408
     C           BOBIS     TAG                                            CMG001
      *
     C                     ENDSR
     C/EJECT
      ***************************************************************
      *   FLD54 - Format field 54 (Receivers Correspondent)         *
      *   Called by - FMTHD  format the header part of an MT203     *
      *   Calls       FSWADS format swift address                   *
      ***************************************************************
      *
     C           FLD54     BEGSR
      *
     C/COPY WNCPYSRC,MG0202C023
      **  Field :54:  Receivers correspondent
     C           MGRCRN    IFNE *BLANKS
     C/COPY WNCPYSRC,MGH00057
      *
      **  Format SWIFT address
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELMGRCRN    ZDEST
     C                     CALL 'ZM0050'               15
     C                     PARM           ZDEST  12
     C                     PARM           ZSADD1 35
     C                     PARM           ZSADD2 35
     C                     PARM           ZSADD3 35
     C                     PARM           ZSADD4 35
     C                     PARM           ZSTAG   1
     C                     PARM           ZSTYPE  1
     C                     PARM           ZERR    1
     C                     PARM           ZDBEI                                               CSW201
      *
      **  Error on call (program not found)
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '015'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 015  *
     C                     MOVEL'ZM0050'  DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Error when formating address
     C           ZERR      IFEQ '1'
     C                     MOVE 'Y'       @ERR
     C                     MOVE ':54 :'   MTAG
     C                     MOVELZDEST     MFLD
     C                     MOVELMSGA,5    MERR
      *
      **  Format field 54 address
     C                     ELSE
     C                     MOVE *BLANKS   @CNUM
     C                     MOVELMGRCRN    @CNUM
     C                     MOVELMGRCRA    ACLINE 35
     C                     MOVE ' '       TAG
     C                     MOVE '54'      FLDNO
      *
      **  Use destination customer number and parent number
     C                     MOVELDECN      SRCNUM
     C                     MOVELDPCNB     SRPCNB
     C                     EXSR FSWADS
     C                     END
      *
     C                     END
      *
     C/COPY WNCPYSRC,MG0202C024
     C                     ENDSR
     C/EJECT
      ***************************************************************
      *   FLD56 - Format field 56 (Intermediary Bank)               *
      *   Called by - MESG   format fields 56/57/57 & 72            *
      *   Calls       FSWAD  format swift address                   *
      ***************************************************************
      *
     C           FLD56     BEGSR
      *                                                                   153367
     C                     MOVE *BLANK    WFLD56  1                       153367
      *
      **  Field :56:  Intermediary Bank
      *
     C           MGPIBN    IFNE *BLANKS
      *                                                                   153367
      **  Set field :56: generated flag to 'Y'                            153367
      *                                                                   153367
     C                     MOVE 'Y'       WFLD56                          153367
      *                                                                   153367
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELMGPIBN    ZDEST
     C                     MOVELMGPIBA    ACLINE
     C                     MOVE ' '       TAG
     C                     MOVE '56'      FLDNO
     C                     EXSR FSWAD
     C                     END
      *
     C                     ENDSR
     C/EJECT
      ***************************************************************
      *   FLD57 - Format field 57 (Account with Institution)        *
      *   Called by - MESG   format fields 56/57/58 & 72            *
      *   Calls       FSWADS format swift address                   *
      ***************************************************************
      *
     C           FLD57     BEGSR
      *                                                                   CSW096
     C/COPY WNCPYSRC,MG0202C025
     C           MGAWBB    IFEQ *BLANKS                                   CSW096
      *
      **  Field :57:
     C           MGAWBN    IFNE *BLANKS
      *                                                                   078649
     C**********           MOVE *ZEROS    NUAWBN  60                                   078649 CSD027
     C**********           MOVE *BLANKS   NUAWBN  6                                    CSD027 172477
     C**********           MOVELMGAWBN    NUAWBN                                       078649 172477
     C********** NUAWBN    IFNE MGDEST                                                 078649 172477
      *                                                                   140901
     C**********           MOVE *ZEROS    NUAWBN  60                                   140901 CPK027
     C                     MOVE *BLANKS   NUAWBN  6                                           CPK027
     C                     MOVELMGAWBN    NUAWBN                          140901
      *                                                                   140901
      ** Do not output account with bank when equal to beneficiary        140901
      ** or destination customer when system value                        140901
      *  'NotIncFld57IfSame58' = 'Y'                                      140901
     C                     MOVE *BLANKS   TBENN   8                       140901
     C           MGBENN    IFNE *BLANKS                                   140901
     C                     MOVELMGBENN    TBENN                           140901
     C                     ELSE                                           140901
     C                     MOVELMGCNUM    TBENN                           140901
     C                     END                                            140901
      *                                                                   140901
     C           NUAWBN    IFNE MGDEST                                    140901
     C           MGAWBN    ANDNETBENN                                     140901
     C           NINC57    OREQ 'N'                                       140901
      *                                                                   153367
      **  OR if field :56: was generated                                  153367
     C           WFLD56    OREQ 'Y'                                       153367
     C/COPY WNCPYSRC,MG0202C060
      *
      **  Format SWIFT address
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELMGAWBN    ZDEST
     C                     CALL 'ZM0050'               15
     C                     PARM           ZDEST  12
     C                     PARM           ZSADD1 35
     C                     PARM           ZSADD2 35
     C                     PARM           ZSADD3 35
     C                     PARM           ZSADD4 35
     C                     PARM           ZSTAG   1
     C                     PARM           ZSTYPE  1
     C                     PARM           ZERR    1
     C                     PARM           ZDBEI                                               CSW201
      *
      **  Error on call (program not found)
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '016'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 016  *
     C                     MOVEL'ZM0050'  DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Error when formating address
     C           ZERR      IFEQ '1'
     C                     MOVE 'Y'       @ERR
     C                     MOVE ':57 :'   MTAG
     C                     MOVELZDEST     MFLD
     C                     MOVELMSGA,5    MERR
      *
      **  Format field 57 address
     C                     ELSE
     C                     MOVE *BLANKS   @CNUM
     C                     MOVELMGAWBN    @CNUM
      *
      **  Check for non-extended settlements account line
      *
     C                     MOVE MGBTB1    @BTB
     C                     MOVELMGAWBA    ACLINE
     C           MGAWBA    IFEQ *BLANKS
     C           BENSC     ANDEQ'/BEN//SC'
     C/COPY WNCPYSRC,MG0202C069
     C                     MOVELACL       ACLINE
     C                     END
      *
     C                     MOVE ' '       TAG
     C                     MOVE '57'      FLDNO
      *
      **  Use destination customer number and parent number
     C                     MOVELDECN      SRCNUM
     C                     MOVELDPCNB     SRPCNB
     C                     EXSR FSWADS
     C/COPY WNCPYSRC,MG0202C093
     C                     END
      *
     C**********           END                                     078649 172477
     C                     END                                            140901
     C                     END
      *
     C                     ELSE                                           CSW096
      *                                                                   CSW096
     C                     ADD  1         X                               CSW096
     C           X         OCUR MULT                                      CSW096
     C                     MOVE 'A'       TAG                             CSW096
     C                     MOVE '57'      FLDNO                           CSW096
     C                     MOVELMGAWBN    USACB  11                       CSW096
     C           MGAWBB    IFNE 'XXX'                                     CSW096
     C                     MOVE MGAWBB    USACB                           CSW096
     C                     ENDIF                                          CSW096
      *                                                                   CSW096
     C                     MOVE @MTAG     MTAG                            CSW096
     C/COPY WNCPYSRC,MG0202C077
     C                     MOVELUSACB     MFLD                            CSW096
      *                                                                                       CSW201
      ** If CSW201 is installed, BIC must not be a BEI.                                       CSW201
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
      *                                                                                       CSW201
     C           MGAWBB    IFEQ 'XXX'                                                         CSW201
     C                     MOVE *BLANKS   MGAWBX                                              CSW201
     C                     ELSE                                                               CSW201
     C                     MOVE MGAWBB    MGAWBX                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     CALL 'ME1400'                                                      CSW201
     C                     PARM           PRTN    7                                           CSW201
     C                     PARM           MGAWBN                                              CSW201
     C                     PARM           MGAWBX  3                                           CSW201
     C                     PARM           SDCUST                                              CSW201
     C                     PARM           SDCNST                                              CSW201
     C                     PARM           MEBICD                                              CSW201
     C                     PARM           PCUST   1                                           CSW201
     C                     PARM           PCNST   1                                           CSW201
     C                     PARM           PBICD   1                                           CSW201
      *                                                                                       CSW202
     C           CSW202    IFEQ 'Y'                                                           CSW202
     C           PBICD     ANDEQ'Y'                                                           CSW202
     C                     CALL 'AOBEISR0'                                                    CSW202
     C                     PARM *BLANKS   PRTCD                                               CSW202
     C                     PARM '*VERIFY' POPTN                                               CSW202
     C                     PARM BDSUBT    PBIC    4                                           CSW202
     C           MEBEIS    PARM MEBEIS    DSFDY                                               CSW202
     C                     ENDIF                                                              CSW202
      *                                                                                       CSW201
      ** Format to :57D (Address) if BEI.                                                     CSW201
     C           PRTN      IFEQ *BLANKS                                                       CSW201
     C           PBICD     ANDEQ'Y'                                                           CSW201
     C           BDSUBT    ANDEQ'BEID'                                                        CSW201
     C           CSW202    ANDEQ'N'                                                           CSW202
      *                                                                                       CSW201
     C           PRTN      OREQ *BLANKS                                                       CSW201
     C           PBICD     ANDEQ'Y'                                                           CSW201
     C           BDSUBT    ANDEQ'TRCO'                                                        CSW201
     C           CSW202    ANDEQ'N'                                                           CSW202
      *                                                                                       CSW202
     C           PBICD     OREQ 'Y'                                                           CSW202
     C           PRTCD     ANDEQ*BLANKS                                                       CSW202
     C           CSW202    ANDEQ'Y'                                                           CSW202
      *                                                                                       CSW202
     C                     MOVE 'D'       TAG                                                 CSW201
     C                     MOVE @MTAG     MTAG                                                CSW201
      *                                                                                       CSW201
      ** Format using customer or counterparty address.                                       CSW201
     C           PCNST     IFEQ 'Y'                                                           CSW201
     C                     MOVE *BLANKS   ACLINE                                              CSW201
     C                     MOVE *BLANKS   ZDEST                                               CSW201
     C                     MOVELAWCPNC    ZDEST                                               CSW201
     C                     MOVE ' '       TAG                                                 CSW201
     C                     EXSR FSWAD                                                         CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C           PCUST     IFEQ 'Y'                                                           CSW201
     C                     MOVE *BLANKS   ACLINE                                              CSW201
     C                     MOVE *BLANKS   ZDEST                                               CSW201
     C                     MOVELBBCUST    ZDEST                                               CSW201
     C                     MOVE ' '       TAG                                                 CSW201
     C                     EXSR FSWAD                                                         CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     ENDIF                                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                   CSW096
     C/COPY WNCPYSRC,MG0202C094
     C                     ENDIF                                          CSW096
      *                                                                   CSW096
     C/COPY WNCPYSRC,MG0202C026
     C                     ENDSR
     C/EJECT
      ***************************************************************
      *   FLD58 - Format field 58 (Beneficiary)                     *
      *   Called by - MESG   format fields 56/57/58 & 72            *
      *   Calls       FSWAD  format swift address                   *
      ***************************************************************
      *
     C           FLD58     BEGSR
     C/COPY WNCPYSRC,MG0202C046
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZDEST
      *
      **  Use customer of deal if the beneficiary is not entered
      *
     C           MGBENN    IFNE *BLANKS
     C/COPY WNCPYSRC,MG0202C065
     C                     MOVELMGBENN    ZDEST
     C                     MOVELMGBENA    ACLINE
     C                     ELSE
     C                     MOVELMGCNUM    ZDEST
     C                     MOVE *BLANKS   ACLINE
     C                     END
      *                                                                   S01408
     C/COPY WNCPYSRC,MG0202CP10                                           S01408
      *                                                                   S01408
      *
      **  Check for non-extended settlements account line
      *
     C                     MOVE MGBTB1    @BTB
     C           BEN       IFEQ '/BEN//'
     C/COPY WNCPYSRC,MG0202C061
      *
     C           CODE      IFNE 'CH'
     C           CODE      ANDNE'FW'
     C           CODE      ANDNE'CP'
     C           CODE      ANDNE'SC'
     C           CODE      ANDNE'BJ'
     C           CODE      ANDNE'BL'
     C                     MOVELACL       ACLINE
     C                     END
     C/COPY WNCPYSRC,MG0202C062
     C                     END
     C/COPY WNCPYSRC,MG0202C066
      *
     C                     MOVE ' '       TAG
     C                     MOVE '58'      FLDNO
     C                     EXSR FSWAD
      *                                                                   S01408
     C/COPY WNCPYSRC,MG0202CP11                                           S01408
      *                                                                   S01408
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   FLD72 - Format Field 72 (Sender to Receiver Information)    *
      *   Called by - MESG  format fields 56/57/58 & 72               *
      *   Calls     -                                                 *
      *****************************************************************
      *
     C           FLD72     BEGSR
      *
      **  Check for non-extended settlements entry
      *
     C                     MOVE 'N'       FLD72O  1
     C/COPY WNCPYSRC,MG0202C067
      *                                                                   144710
     C           CEU003    IFEQ 'Y'                                       144710
     C           MGOTRC    ANDNE*BLANK                                    144710
      *                                                                   149106
      ** Do not include ERI information on a cover MT202.                 149106
      *                                                                   149106
     C           MGCVMI    ANDNE'S'                                       149106
      *                                                                   144710
     C                     ADD  1         X                               144710
     C           X         OCUR MULT                                      144710
     C           FLD72O    IFEQ 'N'                                       144710
     C                     MOVE ':72: '   MTAG                            144710
     C                     MOVE 'Y'       FLD72O                          144710
     C                     ENDIF                                          144710
      *                                                                   144710
      **  Format purchase currency and amount                             144710
      *                                                                   144710
     C                     MOVE MGOTRC    ZCCY                            144710
     C                     MOVE MGOTRA    ZAMNT                           144710
     C                     CALL 'ZM0040'               15                 144710
     C                     PARM           ZAMNT  130                      144710
     C                     PARM           ZCCY    3                       144710
     C                     PARM           ZSAMNT                          144710
     C                     PARM           ZSCCY   3                       144710
     C                     PARM           ZERR    1                       144710
     C                     PARM           ZSWDPC                                              222373
      *                                                                   144710
      **  Call ended in error (program not found)                         144710
      *                                                                   144710
     C           *IN15     IFEQ '1'                                       144710
     C           *LOCK     IN   LDA                                       144710
     C                     MOVE '094'     DBASE            * * * * * * * *144710
     C                     MOVEL'       ' DBKEY            *  DBERR 094  *144710
     C                     MOVEL'ZM0040'  DBFILE           * * * * * * * *144710
     C                     OUT  LDA                                       144710
     C                     EXSR *PSSR                                     144710
     C                     ENDIF                                          144710
      *                                                                   144710
     C                     MOVEL'/OCMT/'  WTFLD1  6                       144710
     C                     MOVE *BLANKS   WMFLD2 24                       145304
     C                     MOVEA*BLANKS   @STR                            145304
     C                     Z-ADD1         N       20                      145304
      *                                                                   144710
      ** Error - indicate erroneous fields;                               144710
      *                                                                   144710
     C           ZERR      IFEQ 'Y'                                       144710
     C                     MOVE 'Y'       @ERR                            144710
     C                     MOVELMSGA,4    MERR                            144710
     C                     MOVE MGOTRC    ZCCY                            144710
     C                     MOVE MGOTRA    ZAMT                            144710
     C           WTFLD1    CAT  ERR3N     MFLD                            144710
     C                     ELSE                                           144710
     C           WTFLD1    CAT  ZSCCY     WMFLD1  9                       144710
     C********** WMFLD1    CAT  ZSAMNT    MFLD                     144710 145304
     C           WMFLD1    CAT  ZSAMNT    WMFLD2                          145304
     C                     MOVEAWMFLD2    @STR                            145304
     C           ' '       LOKUP@STR,N                   60               145304
     C                     MOVEA'/'       @STR,N                          145304
     C                     MOVEA@STR      MFLD                            145304
     C******************** ADD  25        BYTRMV                   144710 145304
     C                     ADD  24        BYTRMV                          144710
     C                     ENDIF                                          144710
      *                                                                   144710
     C                     ENDIF                                          144710
      *                                                                   144710
     C/COPY WNCPYSRC,MG0202C028
     C                     MOVE MGBTB1    @BTB
      *                                                                                       CSW212
     C                     MOVE *BLANKS   OABTB   1                                           CSW212
     C                     MOVE 'Y'       OABTB   1                                        AR1002987
     C           CSW212    IFEQ 'Y'                                                           CSW212
     C           MGCVMI    ANDEQ'S'                                                           CSW212
      *                                                                                       CSW212
     C********** MGTTYP    IFEQ 'FP'                                                CSW212 AR1002987
     C********** MGTTYP    OREQ 'FS'                                                CSW212 AR1002987
     C********** MGTTYP    OREQ 'PI'                                                CSW212 AR1002987
     C********** MGTTYP    OREQ 'SI'                                                CSW212 AR1002987
     C********** MGTTYP    OREQ 'CX'                                                CSW212 AR1002987
     C********** MGTTYP    OREQ 'SW'                                                CSW212 AR1002987
     C********** MGTTYP    OREQ 'OP'                                                CSW212 AR1002987
     C********** MGTTYP    OREQ 'OT'                                                CSW212 AR1002987
     C**********           MOVE 'Y'       OABTB                                     CSW212 AR1002987
     C           MGTTYP    IFNE 'FP'                                                       AR1002987
     C           MGTTYP    ANDNE'FS'                                                       AR1002987
     C           MGTTYP    ANDNE'PI'                                                       AR1002987
     C           MGTTYP    ANDNE'SI'                                                       AR1002987
     C           MGTTYP    ANDNE'CX'                                                       AR1002987
     C           MGTTYP    ANDNE'SW'                                                       AR1002987
     C           MGTTYP    ANDNE'OP'                                                       AR1002987
     C           MGTTYP    ANDNE'OT'                                                       AR1002987
     C                     MOVE 'N'       OABTB                                            AR1002987
     C                     ENDIF                                                              CSW212
      *                                                                                       CSW212
     C                     ENDIF                                                              CSW212
      *                                                                                       CSW212
     C           OABTB     IFEQ 'Y'                                                        AR1002987
     C           BEN       IFEQ '/BEN//'
     C********** OABTB     ANDNE'Y'                                                 CSW212 AR1002987
     C/COPY WNCPYSRC,MG0202C070
      *
     C           MGAWBN    IFEQ *BLANKS
     C           CODE      ANDEQ'SC'
     C                     ADD  1         X
     C           X         OCUR MULT
     C           FLD72O    IFEQ 'N'                                       144710
     C                     MOVE ':72: '   MTAG
     C                     MOVE 'Y'       FLD72O                          144710
     C                     ENDIF                                          144710
     C                     MOVELMGBTB1    MFLD
     C***********          MOVE 'Y'       FLD72O                          144710
     C                     ADD  41        BYTRMV
     C                     END
      *
     C                     ELSE
      *
      **  Output all fields that contain information
     C                     MOVE MGBTB1    BTBI,1
     C                     MOVE MGBTB2    BTBI,2
     C                     MOVE MGBTB3    BTBI,3
     C                     MOVE MGBTB4    BTBI,4
     C                     MOVE MGBTB5    BTBI,5
     C                     MOVE MGBTB6    BTBI,6
      *
     C                     Z-ADD0         I
      *
     C           I         DOWLT6
     C                     ADD  1         I
     C           BTBI,I    IFNE *BLANKS
     C/COPY WNCPYSRC,MG0202C097
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C           FLD72O    IFEQ 'N'
     C                     MOVE ':72: '   MTAG
     C                     MOVE 'Y'       FLD72O
     C                     END
     C                     MOVELBTBI,I    MFLD
     C                     ADD  41        BYTRMV
     C                     END
      *
     C/COPY WNCPYSRC,MG0202C098
     C                     END
     C***********                                                  CEU003 144710
     C***********CEU003    IFEQ 'Y'                                CEU003 144710
     C***********MGOTRC    ANDNE*BLANK                             CEU003 144710
     C***********                                                  CEU003 144710
     C****Format*purchase*currency*and*amount*                     CEU003 144710
     C***********                                                  CEU003 144710
     C***********          MOVE MGOTRC    ZCCY                     CEU003 144710
     C***********          MOVE MGOTRA    ZAMNT                    CEU003 144710
     C***********          CALL 'ZM0040'               15          CEU003 144710
     C***********          PARM           ZAMNT  130               CEU003 144710
     C***********          PARM           ZCCY    3                CEU003 144710
     C***********          PARM           ZSAMNT                   CEU003 144710
     C***********          PARM           ZSCCY   3                CEU003 144710
     C***********          PARM           ZERR    1                CEU003 144710
     C***********                                                  CEU003 144710
     C****Call*ended*in*error*(program*not*found)*                 CEU003 144710
     C***********                                                  CEU003 144710
     C************IN15     IFEQ '1'                                CEU003 144710
     C************LOCK     IN   LDA                                CEU003 144710
     C***********          MOVE '094'     DBASE     * * * * * * * *CEU003 144710
     C***********          MOVEL'       ' DBKEY     *  DBERR 094  *CEU003 144710
     C***********          MOVEL'ZM0040'  DBFILE    * * * * * * * *CEU003 144710
     C***********          OUT  LDA                                CEU003 144710
     C***********          EXSR *PSSR                              CEU003 144710
     C***********          ELSE                                    CEU003 144710
     C***********                                                  CEU003 144710
     C***********          ADD  1         X                        CEU003 144710
     C***********X         OCUR MULT                               CEU003 144710
     C***********FLD72O    IFEQ 'N'                                CEU003 144710
     C***********          MOVE ':72: '   MTAG                     CEU003 144710
     C***********          MOVE 'Y'       FLD72O                   CEU003 144710
     C***********          ENDIF                                   CEU003 144710
     C***********          MOVEL'/OCMT/'  WTFLD1  6                CEU003 144710
     C***********WTFLD1    CAT  MGOTRC    WMFLD1  9                CEU003 144710
     C***********WMFLD1    CAT  ZSAMNT    MFLD                     CEU003 144710
     C***********          ADD  25        BYTRMV                   CEU003 144710
     C***********          ENDIF                                   CEU003 144710
     C***********          ENDIF                                   CEU003 144710
      *                                                                   144710
     C                     END
     C                     ENDIF                                                           AR1002987
     C/COPY WNCPYSRC,MG0202C029
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   FSWAD - Format SWIFT A/D addresses                          *
      *   Input  ZDEST  customer number being formatted               *
      *          ACLINE account line for the customer being processed *
      *          FLDNO  equal to the SWIFT field being formatted      *
      *          TAG    blank                                         *
      *                                                               *
      *   Called by   FLD52  format field 52 (ordering institution)   *
      *               FLD56  format field 56 (intermediary bank)      *
      *               FLD58  format field 58 (beneficiary)            *
      *   Calls       -                                               *
      *****************************************************************
      *
     C           FSWAD     BEGSR
      *
      *
      **  Format SWIFT address
     C/COPY WNCPYSRC,MG0202C047
     C                     CALL 'ZM0050'               15
     C                     PARM           ZDEST  12
     C                     PARM           ZSADD1 35
     C                     PARM           ZSADD2 35
     C                     PARM           ZSADD3 35
     C                     PARM           ZSADD4 35
     C                     PARM           ZSTAG   1
     C                     PARM           ZSTYPE  1
     C                     PARM ' '       ZERR    1
     C                     PARM           ZDBEI                                               CSW201
     C/COPY WNCPYSRC,MG0202C101
      *
      **  Error on call (program not found)
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '017'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 017  *
     C                     MOVEL'ZM0050'  DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      **  Error when formatting address
     C           ZERR      IFEQ '1'
     C                     MOVE 'Y'       @ERR
     C                     MOVE ZSTAG     TAG
     C                     MOVE @MTAG     MTAG
     C                     MOVELZDEST     MFLD
     C                     MOVELMSGA,5    MERR
      *
     C                     ELSE
      *
      **  Set up field tag
     C/COPY WNCPYSRC,MG0202C048
      *
     C                     MOVE ZSTAG     TAG
     C                     MOVE @MTAG     MTAG
     C/COPY WNCPYSRC,MG0202C078
      **  Output account line
      *
     C                     MOVE *BLANKS   SAVMTG  5                       183583
     C           ACLINE    IFNE *BLANKS
     C                     MOVE MTAG      SAVMTG                          183583
     C                     MOVELACLINE    MFLD
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
      **  Address 1
     C                     MOVELZSADD1    MFLD
     C                     EXSR SEXTN                                     183583
      *
      **  Full address
     C           ZSTAG     IFEQ 'D'
      *
      **  Address 2
     C           ZSADD2    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD2    MFLD
     C                     END                             Address 2      E42086
      **  Address 3
     C           ZSADD3    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD3    MFLD
     C                     END                             Address 3      E42086
      **  Address 4
     C           ZSADD4    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD4    MFLD
     C                     END                             Address 4
     C**********           END                             Address 3      E42086
     C**********           END                             Address 2      E42086
     C                     END                             Address 1
      *
     C                     END                             Error ?
      *
      **  Byte removal count for MT203 messages only
      *
     C           MTPY      IFEQ '203'
      *
      **  SWIFT address
     C           TAG       IFEQ 'A'
     C                     ADD  19        BYTRMV
      *
      **  full address
     C                     ELSE
     C                     ADD  153       BYTRMV
     C                     END
      *
      **  add on bytes to be removed if account line present
     C           ACLINE    IFNE *BLANKS
     C                     ADD  37        BYTRMV
     C                     END
     C                     END
     C/COPY WNCPYSRC,MG0202C102
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   FSWADS  Format SWIFT A/B/D addresses, with A/C line         *
      *                                                               *
      *   Input  ACLINE account line for the customer being processed *
      *          @MTAG  SWIFT field tag (without A/B/D)               *
      *          @CNUM  customer of field to test 'B' type address    *
      *          SRCNUM Sender or Receiver customer number            *
      *          SRPCNB Sender or Receiver parent customer number     *
      *                                                               *
      *   Called by - FLD53  format field 53 (senders correspondent)  *
      *               FLD54  format field 54 (receivers correspondent)*
      *               FLD57  format field 57 (a/c with institution)   *
      *   Calls     -                                                 *
      *****************************************************************
      *
     C           FSWADS    BEGSR
      *
      **  A Type address
     C           ZSTAG     IFEQ 'A'
     C                     MOVE 'A'       TAG
     C                     MOVE @MTAG     MTAG
     C/COPY WNCPYSRC,MG0202C079
      *
      **  Output account line
     C                     MOVE *BLANKS   SAVMTG                          183583
     C           ACLINE    IFNE *BLANKS
     C                     MOVE MTAG      SAVMTG                          183583
     C                     MOVELACLINE    MFLD
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
      *
     C                     MOVELZSADD1    MFLD
     C                     EXSR SEXTN                                     183583
      *
     C                     ELSE
      *
      **  Access SDCUSTPD using our pay nostro customer number
     C                     MOVE *BLANKS   @KEY1
     C                     MOVEL@CNUM     @KEY1
     C                     CALL 'AOCUSTR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           @KEY1  10
     C                     PARM *BLANKS   @KYST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
      **  B Type address
      *
      **  If access to SDCUSTPD ended in error then @CNUM contained
      **   a counterparty nostro, so process D type address
      *
     C           @RTCD     IFEQ *BLANKS
     C           BBPCNB    ANDEQSRPCNB
     C           BBPCNB    ANDNE*BLANKS
     C           BBPCNB    OREQ SRCNUM
     C           @CNUM     OREQ SRPCNB
      *
     C                     MOVE 'B'       TAG
     C                     MOVE @MTAG     MTAG
     C/COPY WNCPYSRC,MG0202C080
      *
      **  Output account line
     C           ACLINE    IFNE *BLANKS
     C                     MOVELACLINE    MFLD
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
      *
     C                     MOVE *BLANKS   @WRK
     C***********          MOVELBBCRNM    @WRK,1                          111106
     C                     MOVEABBCRNM    @WRK,1                          111106
     C                     Z-ADD22        J       20
     C                     MOVEABBCRTN    @WRK,J
     C                     MOVEA@WRK      MFLD
      *
      **  D Type address
     C                     ELSE
     C                     MOVE 'D'       TAG
     C                     MOVE @MTAG     MTAG
     C/COPY WNCPYSRC,MG0202C081
      *
      **  Output account line
     C           ACLINE    IFNE *BLANKS
     C                     MOVELACLINE    MFLD
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
      *
     C                     MOVELZSADD1    MFLD
      **  Address 2
     C           ZSADD2    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD2    MFLD
     C                     END                             Address 2      087652
      **  Address 3
     C           ZSADD3    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD3    MFLD
     C                     END                             Address 3      087652
      **  Address 4
     C           ZSADD4    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD4    MFLD
     C                     END                             D address 4
     C***********          END                             D address 3    087652
     C***********          END                             D address 2    087652
     C                     END                             B/D address 1
      *
     C                     END                             A/B/D address?
      *
      **  Byte removal count for MT203 messages only
      *
     C           MTPY      IFEQ '203'
      *
      **  SWIFT address
     C           TAG       IFEQ 'A'
     C                     ADD  19        BYTRMV
     C                     END
      *
      **  Branch address
     C           TAG       IFEQ 'B'
     C                     ADD  42        BYTRMV
     C                     END
      *
      **  full address
     C           TAG       IFEQ 'D'
     C                     ADD  153       BYTRMV
     C                     END
      *
      **  add on bytes to be removed if account line present
     C           ACLINE    IFNE *BLANKS
     C                     ADD  37        BYTRMV
     C                     END
     C                     END
      *
     C                     ENDSR
      /EJECT                                                              183583
      *****************************************************************   183583
      *                                                               *   183583
      *   SEXTN - Store customer with SWIFT address to data structure *   183583
      *                                                               *   183583
      *   Called by: FSWAD, FSWADS                                    *   183583
      *   Calls    : None                                             *   183583
      *                                                               *   183583
      *****************************************************************   183583
      *                                                                   183583
     C           SEXTN     BEGSR                                          183583
      *                                                                   183583
     C           SAVMTG    IFNE *BLANKS                                   183583
     C                     MOVE SAVMTG    @MTG                            183583
     C                     ELSE                                           183583
     C                     MOVELMTAG      @MTG                            183583
     C                     ENDIF                                          183583
     C           FLDTYP    IFEQ '5'                                       183583
     C           FLDTAG    ANDEQ'A'                                       183583
     C                     ADD  1         V                               183583
     C           V         OCUR EXTN                                      183583
     C                     Z-ADDX         MPSN                            183583
     C                     MOVEL@MTG      MTG                             183583
     C                     MOVELZDEST     MCSI                            183583
     C                     ENDIF                                          183583
      *                                                                   183583
     C           SEXT9     ENDSR                                          183583
     C/EJECT
      *****************************************************************
      *   OMSG   - Output correctly generated message to PF/MGOMSGPD  *
      *   Called by   main process                                    *
      *   Calls       -                                               *
      *****************************************************************
      *
     C           OMSG      BEGSR
      *
      **  Write reference records for each part of the MT203
      *
     C           MTPY      IFEQ '203'
      *
      **  Format total amount of the part to SWIFT
      *
     C                     MOVE *BLANKS   ZAMNT
     C                     MOVE FLD19     ZAMNT
     C                     CALL 'ZM0040'
     C                     PARM           ZAMNT
     C                     PARM MGCCY     ZCCY
     C                     PARM           ZSAMNT
     C                     PARM           ZSCCY
     C                     PARM           ZERR
     C                     PARM           ZSWDPC                                              222373
      *
      **  Produce error report if format of field 19 ended in error
      *
     C           ZERR      IFEQ 'Y'
     C                     MOVE 'Y'       @ERR
     C/COPY WNCPYSRC,MG0202C042
     C           1         OCUR MULT
     C/COPY WNCPYSRC,MG0202C043
     C                     MOVEAMSGA,6    MERR
     C                     ELSE
      *
      **  No error on format of field 19, set up the field 19 (total amount)
      **  for this MT203, for PF/MGOREFPD & PF/MGOMSGPD
      *
     C                     MOVELZSAMNT    AMTX
     C/COPY WNCPYSRC,MG0202C044
     C           1         OCUR MULT
     C/COPY WNCPYSRC,MG0202C045
     C                     MOVELZSAMNT    MFLD
      *
      **  I represents TRNO; J represents the next part (TRNM).
      **  TRN of first part (TRNF), is blank for the first part but
      **  is entered for all subsequent parts of the MT203
     C                     Z-ADD1         I
     C                     Z-ADD2         J       20
     C           I         OCUR REF203
     C                     MOVE *BLANKS   TRNF
     C           1         OCUR REF203
     C                     MOVEL@RTRN     @TRNF  16
      *
      **  Output reference record for each part. Obtain the next
      **  REF203 entry for TRNM and use the first part entry of
      **  REF203 for TRNF on each part after the first record.
      **  PART is used to obtain unique information for each part.
      *
     C           I         DOWLEPARTS
      *
      **  current part
     C           I         OCUR REF203
     C           I         OCUR PART
     C                     MOVEL@RTRN     TRNO
      *
      **  next part
     C           J         OCUR REF203
     C                     MOVEL@RTRN     TRNM
      *
      **  write reference record to PF/MGOREFPD
     C                     EXSR WREFM
      *
      **  Obtain TRNF for subsequent parts and AMTX now blank
     C                     MOVEL@TRNF     TRNF
     C                     MOVE *BLANKS   AMTX
     C                     ADD  1         I
     C                     ADD  1         J
     C                     END
      *
      **  TRNO of the whole message equals the TRN of the first part
     C                     MOVELTRNF      TRNO
     C                     END
      *
      **  Write a reference record for the MT202
     C                     ELSE
      *                                                                   144171
      ** Move back saved amount.                                          144171
      *                                                                   144171
     C                     MOVEL*BLANKS   ZSAMNT                          144171
     C                     MOVELSAMNT     ZSAMNT                          144171
      *                                                                   144171
     C                     EXSR WREF
     C/COPY WNCPYSRC,MGH00008
     C                     END
      *
      **  Output the message to PF/MGOMSGPD if no error on format of FLD19
      *
     C           @ERR      IFNE 'Y'
      *
      **  Write the message details to PF/MGOMSGPD
      *
     C           CSW209    IFEQ 'Y'                                                           CSW209
     C           PRTCOV    ANDEQ'Y'                                                           CSW209
     C           MGCVMI    ANDEQ'S'                                                           CSW209
     C           COV103    ANDEQ'Y'                                                           CSW209
     C                     MOVEL':119:'   MTAG                                                CSW209
     C                     MOVEL'COV'     MFLD                                                CSW209
      *                                                                                       CSW209
     C                     WRITEMGOMSGD0               06                                     CSW209
      *                                                                                       CSW209
      **  Error on write to PF/MGOMSGPD (message data file)                                   CSW209
      *                                                                                       CSW209
     C           *IN06     IFEQ '1'                                                           CSW209
     C           *LOCK     IN   LDA                                                           CSW209
     C                     MOVE '018'     DBASE            * * * * * * * *                    CSW209
     C                     MOVEL'       ' DBKEY            *  DBERR 018  *                    CSW209
     C                     MOVEL'MGOMSGPD'DBFILE           * * * * * * * *                    CSW209
     C                     OUT  LDA                                                           CSW209
     C                     EXSR *PSSR                                                         CSW209
     C                     ENDIF                                                              CSW209
      *                                                                                       CSW209
     C                     MOVEL*BLANKS   MTAG                                                CSW209
     C                     MOVEL*BLANKS   MFLD                                                CSW209
      *                                                                                     BUG25355
      ** Reset print COV indicator after printing MT202 COV                                 BUG25355
      *                                                                                     BUG25355
     C                     MOVE 'N'       PRTCOV                                            BUG25355
     C                     ENDIF                                                              CSW209
      *                                                                                       CSW209
     C                     Z-ADD1         I
     C           I         OCUR MULT
      *
     C           I         DOWLEX
     C           MFLD      ANDNE*BLANKS
     C/COPY WNCPYSRC,MG0202C031
     C                     WRITEMGOMSGD0               06
      *
      **  Error on write to PF/MGOMSGPD (message data file)
     C           *IN06     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '018'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 018  *
     C                     MOVEL'MGOMSGPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C                     ADD  1         I
     C           I         OCUR MULT
     C                     END
      *                                                                   183583
      ** Write multiple occurrence data structure to MGOEXTPD             183583
      *                                                                   183583
     C                     Z-ADD1         I                               183583
     C           I         OCUR EXTN                                      183583
     C           I         DOWLEV                                         183583
     C           MCSI      ANDNE*BLANKS                                   183583
     C                     WRITEMGOEXTD0               06                 183583
      *                                                                   183583
      ** Error on write to PF/MGOEXTPD (message data extension file)      183583
      *                                                                   183583
     C           *IN06     IFEQ '1'                                       183583
     C           *LOCK     IN   LDA                                       183583
     C                     MOVE '029'     DBASE            ************** 183583
     C                     MOVEL'        'DBKEY            *  DBERR 029 * 183583
     C                     MOVEL'MGOEXTPD'DBFILE           ************** 183583
     C                     OUT  LDA                                       183583
     C                     EXSR *PSSR                                     183583
     C                     ENDIF                                          183583
     C                     ADD  1         I                               183583
     C           I         OCUR EXTN                                      183583
     C                     ENDDO                                          183583
      *
      **  Error occurred during the formatting of the amount fields
      *
     C                     ELSE
     C                     EXSR REPT
     C                     END
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************                       CSD015
      *                                                               *                       CSD015
      *  SRWTCH - Watch Processing                                    *                       CSD015
      *                                                               *                       CSD015
      *****************************************************************                       CSD015
      *                                                                                       CSD015
     C           SRWTCH    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Re-determine Message Status                                                          CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       PARLS   1                                           CSD015
      *                                                                                       CSD015
     C           MGST      IFEQ 'RSND'                                                        CSD015
      *                                                                                       CSD015
     C           NWRK      IFEQ 'SWIFT '                                                      CSD015
     C           NWRK      OREQ 'TELEX '                                                      CSD015
     C           NWRK      OREQ 'STTX  '                                                      CSD015
     C                     MOVE 'CRTD'    MGST                                                CSD015
     C                     MOVE '1'       MGSG                                                CSD015
     C                     MOVE 'Y'       PARLS                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ***Initialise*parameter for compliance engine program.                           CSD015 221145
      *********************                                                            CSD015 221145
     C*********************MOVE *BLANK    WLTDS                                        CSD015 221145
      *********************                                                            CSD015 221145
     C*********************Z-ADD*ZERO     W4VDAT                                       CSD015 221145
     C*********************Z-ADD*ZERO     W4MDAT                                       CSD015 221145
     C*********************Z-ADD*ZERO     W4AMT1                                       CSD015 221145
     C*********************Z-ADD*ZERO     W4AMT2                                       CSD015 221145
      *********************                                                            CSD015 221145
      ***Set*up*parameter*for compliance engine program                                CSD015 221145
      *********************                                                            CSD015 221145
     C*********************MOVELTRNO      W4IDEN                                       CSD015 221145
     C*********************MOVELMTPY      W4ITEM                                       CSD015 221145
     C*********************MOVELMGPOBR    W4BRCH                                       CSD015 221145
     C*********************MOVEL'MGOREF'  W4FUNT                                       CSD015 221145
     C*********************MOVELDECN      W4CNUM                                       CSD015 221145
     C*********************Z-ADDBJRDNB    W4DDAT                                       CSD015 221145
     C*********************MOVELPARLS     W4ARLS                                       CSD015 221145
      *********************                                                            CSD015 221145
      ***Send*transaction*to compliance engine program                                 CSD015 221145
      *********************                                                            CSD015 221145
     C*********************CALL 'SDWLCLOP'                                             CSD015 221145
     C*********************PARM           WLTDS                                        CSD015 221145
     C*********************PARM           PSTRNG                                       CSD015 221145
      *                                                                                       CSD015
     C           ENDWAT    ENDSR                                                              CSD015
      *                                                                                       CSD015
     C/EJECT                                                                                  221145
      *****************************************************************                       221145
      *                                                               *                       221145
      *  WLCDQ - Submit information to Watch List Check Dtaq          *                       221145
      *                                                               *                       221145
      *****************************************************************                       221145
      *                                                                                       221145
     C           WLCDQ     BEGSR                                                              221145
      *                                                                                       221145
      *  Send transaction details to Compliance Watch by calling SDWLCLOP                     221145
      *                                                                                       221145
     C                     CALL 'SDWLCLOP'                                                    221145
     C                     PARM           WLTDS                                               221145
     C                     PARM           PSTRNG                                              221145
      *                                                                                       221145
     C                     ENDSR                                                              221145
      *                                                                                       221145
      *****************************************************************
      *   REPT   - Output incorrectly generated message to report     *
      *   Called by   main process                                    *
      *   Calls       -                                               *
      *****************************************************************
      *
     C           REPT      BEGSR
      *
     C           *IN50     IFEQ '0'
     C                     OPEN MG0202P1
     C                     SETON                     50                   084320
     C************         SETON                     50U7                 084320
     C                     END
      *
      **   Set up HEADings and sender/customer information
      **       for the error report
     C**********           MOVELMGTNUM    TNUM    60                                          CLE148
     C                     MOVELMGTNUM    TNUM                                                CLE148
     C                     WRITEHEADER
     C                     WRITETEXT
      *
      **  Process multiple occurrence data structure
      *
     C                     Z-ADD0         I       20
     C           I         DOWLEX
     C                     ADD  1         I
     C           I         OCUR MULT
     C                     WRITELINE
     C                     END
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   SEQN   Retreive the he GDF file the records processed       *
      *   Called by   COMM  format fields 20, 21, 32(A or B)          *
      *   Calls       -                                               *
      *****************************************************************
      *
     C           SEQN      BEGSR
      *
      **  Obtain sequence numbers from transaction record
      ** only if not a CLS transaction.
      *
     C           MGTTYP    IFEQ 'PC'                                      CDL008
     C                     Z-ADD*ZEROS    MGLSWC                          CDL008
     C                     Z-ADD*ZEROS    MGLSWS                          CDL008
     C                     ELSE                                           CDL008
     C                     CALL 'MG5000'               24
     C                     PARM MGMODI    @MODI   2
     C                     PARM MGTNUM    @TRAN  15
     C                     PARM 'PR'      @PROG   2
     C                     PARM *BLANKS   @MODE   1
     C                     PARM *ZEROS    MGLSWC  30
     C                     PARM *ZEROS    MGLSWS  30
     C                     PARM *BLANKS   @ERCD   1
      *
      **  Error on access for sequence number
     C           @ERCD     IFEQ 'Y'
     C           *LOCK     IN   LDA
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Program missing on call
     C           *IN24     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '019'     DBASE            * * * * * * * *
     C                     MOVE 'MG5000'  DBKEY            *  DBERR 019  *
     C                     OUT  LDA                        * * * * * * * *
     C                     EXSR *PSSR
     C                     END
     C                     ENDIF                                          CDL008
      *
     C           *LOCK     IN   LDA
     C                     MOVEL'MG0202  'DBPGM
     C                     OUT  LDA
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   DELT   Delete from the GDF file the records processed       *
      *   Called by   main process                                    *
      *   Calls       -                                               *
      *****************************************************************
      *
     C           DELT      BEGSR
      *
      **  Delete GDF records from the start
      **  of the file, to the last part processed
      *
     C                     MOVELMGTNUM    SAVNUM 15
     C           CSW025    IFEQ 'Y'                                                          BUG6076
     C           *LOVAL    SETLLMGF202L1                                                     BUG6076
     C                     ELSE                                                              BUG6076
     C           *LOVAL    SETLLMGF202L0
     C                     ENDIF                                                             BUG6076
      *
     C           SAVNUM    DOUEQMGTNUM
     C           *IN10     OREQ '1'
     C           CSW025    IFEQ 'Y'                                                          BUG6076
     C                     READ MGF202L1                 10                                  BUG6076
     C                     ELSE                                                              BUG6076
     C                     READ MGF202L0                 10
     C                     ENDIF                                                             BUG6076
     C           INTMSG    IFEQ 'I'                                                          BUG6076
     C                     MOVE ' '       MGTNUM                                             BUG6076
     C                     ENDIF                                                             BUG6076
     C           *IN10     IFEQ '0'                                                           242622
     C           CSW025    IFEQ 'Y'                                                          BUG6076
     C                     DELETMGF202L1               16                                    BUG6076
     C                     ELSE                                                              BUG6076
     C                     DELETMGF202L0               16
     C                     ENDIF                                                             BUG6076
     C                     ENDIF                                                              242622
      *
      **  Error on delete of record.
      *
     C           *IN16     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '020'     DBASE             * * * * * * *
     C                     MOVELMGTNUM    DBKEY             * DBERR 020 *
     C                     MOVEL'MGF202L0'DBFILE            * * * * * * *
     C           CSW025    IFEQ 'Y'                                                          BUG6076
     C                     MOVEL'MGF202L1'DBFILE                                             BUG6076
     C                     ENDIF                                                             BUG6076
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C/COPY WNCPYSRC,MG0202C068
     C                     END
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   UPMOD  Update the S.W.I.F.T. sequence numbers               *
      *   Called by   main process                                    *
      *   Calls       -                                               *
      *****************************************************************
      *
     C           UPMOD     BEGSR
      *
      **  For each part of the multiple, update the S.W.I.F.T.
      **  sequence number for that transaction number
      *
     C           MTPY      IFEQ '203'
      *
     C                     Z-ADD1         I
     C           I         OCUR PART
      *
     C           @MTRN     DOWNE*BLANKS
     C           @ERCD     ANDEQ*BLANKS
     C           *IN24     ANDEQ'0'
     C           @ERR      ANDNE'Y'
      *
      **  Update sequence numbers on transaction record
      **  if no errors have occurred
      ** and if not a CLS transaction                                     CDL008
      *
     C           MGTTYP    IFNE 'PC'                                      CDL008
     C                     CALL 'MG5000'               24
     C                     PARM @MOD      @MODI   2
     C                     PARM @MTRN     @TRAN  15
     C                     PARM 'PR'      @PROG   2
     C                     PARM 'U'       @MODE   1
     C                     PARM *ZEROS    MGLSWC  30
     C                     PARM *ZEROS    MGLSWS  30
     C                     PARM *BLANKS   @ERCD   1
     C                     ENDIF                                          CDL008
      *
     C                     ADD  1         I
     C           I         OCUR PART
     C                     END
      *
      **  Update sequence numbers on transaction record for MT202
      **  if no errors have occurred
      ** and if not a CLS transaction                                     CDL008
      *
     C                     ELSE
     C           MGTTYP    IFNE 'PC'                                      CDL008
     C           @ERR      IFNE 'Y'
     C                     CALL 'MG5000'               24
     C                     PARM MGMODI    @MODI   2
     C                     PARM MGTNUM    @TRAN  15
     C                     PARM 'PR'      @PROG   2
     C                     PARM 'U'       @MODE   1
     C                     PARM *ZEROS    MGLSWS  30
     C                     PARM *ZEROS    MGLSWC  30
     C                     PARM *BLANKS   @ERCD   1
     C                     END
     C                     ENDIF                                          CDL008
     C                     END
      *
      **  Error on access for sequence number
     C           @ERCD     IFEQ 'Y'
     C           *LOCK     IN   LDA
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Program missing on call
     C           *IN24     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '021'     DBASE            * * * * * * * *
     C                     MOVE 'MG5000'  DBKEY            *  DBERR 021  *
     C                     OUT  LDA                        * * * * * * * *
     C                     EXSR *PSSR
     C                     END
     C           *LOCK     IN   LDA
     C                     MOVEL'MG0202  'DBPGM
     C                     OUT  LDA
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   RMVMSG - Remove message part from data structure MULT       *
      *   Called by   main process                                    *
      *   Calls       -                                               *
      *****************************************************************
      *
     C           RMVMSG    BEGSR
      *
      **  Error occurred therefore print out the header
      *
     C           @ERR      IFEQ 'Y'
      *
     C           *IN50     IFEQ '0'
     C                     OPEN MG0202P1
     C                     SETON                     50
     C                     END
      *
      **   Set up Headings and sender/customer information
      **       for the error report
     C**********           MOVELMGTNUM    TNUM    60                                          CLE148
     C                     MOVELMGTNUM    TNUM                                                CLE148
     C                     WRITEHEADER
     C                     WRITETEXT
      *
      **  Print out the header part of the MT203
      *
     C                     Z-ADD0         I       20
     C           I         DOWLTENDHD
     C                     ADD  1         I
     C           I         OCUR MULT
     C                     WRITELINE
     C                     END
     C                     END
      *
      **  Remove the part and output to report if an error
      *
     C                     Z-ADDSTPOS     I
     C           I         DOWLEX
     C                     ADD  1         I
     C           I         OCUR MULT
      *
     C           @ERR      IFEQ 'Y'
     C                     WRITELINE
     C                     END
      *
     C                     MOVE *BLANKS   MULT
     C                     END
      *                                                                   183583
      ** Remove the details from the extension file for this part.        183583
      *                                                                   183583
     C                     Z-ADDSTPOSV    I                               183583
     C           I         DOWLEV                                         183583
     C                     ADD  1         I                               183583
     C           I         OCUR EXTN                                      183583
     C                     Z-ADD*ZEROS    MPSN                            183583
     C                     MOVE *BLANKS   MTG                             183583
     C                     MOVE *BLANKS   MCSI                            183583
     C                     ENDDO                                          183583
     C                     Z-ADDSTPOSV    V                               183583
      *
      **  Reverse the message details for the part being removed
      **  If bytes remain then add the bytes back to the total
      **  so that they can be reused.
     C                     Z-ADDSTPOS     X
     C           RANOUT    IFEQ 'N'
     C                     ADD  BYTRMV    BYTES
     C                     END
      *
     C           PARTS     OCUR REF203
     C           PARTS     OCUR PART
     C                     MOVE *BLANKS   REF203
     C                     MOVE *BLANKS   PART
     C                     SUB  1         PARTS
      *
     C********             SUB  MGEAMT    FLD19                           184930
      *                                                                   CSW020
      * CSW020: If the swift number decimal places is less than the       CSW020
      *         normal number of decimal place, zeroise the extra decimalsCSW020
      *         when reducing the sum of amount (FLD19).                  CSW020
     C           WCHGRQ    IFEQ 'Y'                                       CSW020
     C           MGEAMT    DIV  WPOWER    NWEAMT 130                      CSW020
     C                     MULT WPOWER    NWEAMT 130                      CSW020
     C                     SUB  NWEAMT    FLD19                           CSW020
     C                     ELSE                                           CSW020
     C                     SUB  MGEAMT    FLD19
     C                     ENDIF                                          CSW020
      *
      **  If error in first part of MT203, report the error & quit
      **  the MT203 loop defaulting PARTS to 15
      *
     C           @ERR      IFEQ 'Y'
     C           PARTS     ANDEQ0
     C                     Z-ADD15        PARTS
     C                     END
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   CONVRT - Convert one part MT203 to an MT202                 *
      *   Called by   MS203   format an MT203 message                 *
      *   Calls       WREF    write reference record to PF/MGOREFPD   *
      *****************************************************************
      *
     C           CONVRT    BEGSR
      *
      **  Access the first part TRN for the TRN of the MT202
      *
     C           1         OCUR REF203
     C           1         OCUR PART
     C                     MOVEL@RTRN     @TRNO
     C                     MOVEL@MTRN     MGTNUM
     C                     MOVEL@TNTP     MGTTYP
     C                     MOVEL@SBTP     MGTSTP
     C                     MOVEL@NWBN     MGBENN
     C                     MOVEL@AMTS     ZSAMNT
     C                     MOVEL@OTHB     MGBRCA
     C                     MOVEL@ZSCCY    ZSCCY                                               187271
      *
      **  Write reference record  (PF/MGOREFPD)
      *
     C                     EXSR WREF
      *
      **  Write fields 20 and 21
      *
     C                     Z-ADDFIRST     I
     C                     DO   2
     C                     ADD  1         I
     C           I         OCUR MULT
     C                     WRITEMGOMSGD0               06
      *
      **  Error on write to PF/MGOMSGPD (message data file)
     C           *IN06     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '022'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 022  *
     C                     MOVEL'MGOMSGPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C                     END
      *
      **  Convert field :32B: to :32A:
      *
     C                     ADD  1         I
     C           I         OCUR MULT
      *
      **  Change tag and move FLD3A (:32A:) contents into the field
      **  FLD3A is always constructed in subroutine COMM
     C                     MOVE ':32A:'   MTAG
     C                     MOVELFLD3A     MFLD
     C                     WRITEMGOMSGD0               06
      *
      **  Error on write to PF/MGOMSGPD (message data file)
     C           *IN06     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '023'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 023  *
     C                     MOVEL'MGOMSGPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  From the header access fields 52/53/54 (if present)
      *
     C                     Z-ADD3         I
     C           I         OCUR MULT
      *
     C           MTAG      DOWNE':20: '
     C                     WRITEMGOMSGD0               06
     C                     ADD  1         I
     C           I         OCUR MULT
     C                     END
      *
      **  Skip fields 20/21/32B of the part & process remaining fields
      *
     C                     Z-ADDFIRST     I
     C                     ADD  4         I
     C           I         OCUR MULT
      *
     C           I         DOWLEX
     C           MFLD      ANDNE*BLANKS
     C                     WRITEMGOMSGD0               06
      *
      **  Error on write to PF/MGOMSGPD (message data file)
     C           *IN06     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '024'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 024  *
     C                     MOVEL'MGOMSGPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
     C                     ADD  1         I
     C           I         OCUR MULT
     C                     END
      *                                                                   183583
      ** Write multiple occurrence data structure to MGOEXTPD             183583
      *                                                                   183583
     C                     Z-ADD1         I                               183583
     C           I         OCUR EXTN                                      183583
     C           I         DOWLEV                                         183583
     C           MCSI      ANDNE*BLANKS                                   183583
     C                     WRITEMGOEXTD0               06                 183583
      *                                                                   183583
      ** Error on write to PF/MGOEXTPD (message data extension file)      183583
      *                                                                   183583
     C           *IN06     IFEQ '1'                                       183583
     C           *LOCK     IN   LDA                                       183583
     C                     MOVE '030'     DBASE            * * * * * * * *183583
     C                     MOVEL'        'DBKEY            *  DBERR 030  *183583
     C                     MOVEL'MGOEXTPD'DBFILE           * * * * * * * *183583
     C                     OUT  LDA                                       183583
     C                     EXSR *PSSR                                     183583
     C                     ENDIF                                          183583
     C                     ADD  1         I                               183583
     C           I         OCUR EXTN                                      183583
     C                     ENDDO                                          183583
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   WREF - Write reference record to PF/MGOREFPD                *
      *   Called by   OMSG   output message PF/MGOMSGPD               *
      *               CONVRT convert one part MT203 to an MT202       *
      *   Calls       -                                               *
      *****************************************************************
      *
     C           WREF      BEGSR
      *
     C                     MOVE *BLANKS   SYTM
     C                     MOVE MGMODI    MODI
     C                     MOVEL@TRNO     TRNO
     C                     MOVE *BLANKS   TRNF
     C                     MOVE *BLANKS   TRNM
     C                     MOVELMGTNUM    MTRN
     C                     MOVE MGTTYP    TNTP
     C                     MOVE MGTSTP    SBTP
     C                     MOVE '202'     MTPY
     C                     MOVE MGAMTP    EVTP                            E29588
     C                     Z-ADDMGAVDT    AVDT                            E29588
     C                     Z-ADDMGASEQ    ASEQ                            E29588
     C                     MOVELMGBENN    NWBN
     C***********          MOVE 'N'       MPRY                            138742
     C/COPY WNCPYSRC,MG0202C037
      *
      **  If not already determined, use the default from SDCUSTPD
      *
     C           MGST      IFEQ *BLANK
     C                     MOVE SMGSG     MGSG
     C                     MOVE SMGST     MGST
     C                     END
      *                                                                                       CSD015
      ** If Watch List Checking is Applied and CSW025 is off,                                 CSD015
      ** do watch processing.                                                                 CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           222385
     C           CSW025    ANDNE'Y'                                                           CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *
     C                     MOVEL*BLANKS   PTST
     C                     MOVEL*BLANKS   LSCC
     C                     MOVEL*BLANKS   CARQ
     C                     MOVEL*BLANKS   MPDE
     C                     MOVEL@HRDT     HRDT
     C                     TIME           MGTM
     C                     MOVE BJMRDT    LADT
     C                     MOVE MGTM      LATM
      *
     C           MGST      IFEQ 'RSND'
     C                     MOVE BJMRDT    RELD
     C                     MOVE MGTM      RELT
     C                     END
      *
     C                     MOVEL*BLANKS   RUSR
      *
     C                     MOVELZSAMNT    AMTS
     C                     MOVEL*BLANKS   AMTX
      *
      **  Format value date to YYMMDD format
     C/COPY WNCPYSRC,MG0202C013
      *                                                                                       CDL099
      ** Only check for SVD if FX/MM                                                          CDL099
      *                                                                                       CDL099
     C           MGMODI    IFEQ 'DL'                                                          CDL099
     C           CDL099    ANDEQ'Y'                                                           CDL099
     C                     Z-ADDMGVDAT    ULMVD   50                                          CDL099
     C                     MOVELMGTNUM    KYDLNO                                              CDL099
     C           KYDLNO    CHAINDEALS                40                                       CDL099
     C                     MOVE BSDT2     MGVDAT                                              CDL099
     C                     ENDIF                                                              CDL099
      *                                                                                       CDL099
     C                     CALL 'ZM0060'               15
     C                     PARM MGVDAT    ZMDAY   50
     C                     PARM           ZMDATE  6
     C/COPY WNCPYSRC,MG0202C014
      *                                                                                       CDL099
     C           MGMODI    IFEQ 'DL'                                                          CDL099
     C           CDL099    ANDEQ'Y'                                                           CDL099
     C                     Z-ADDULMVD     MGVDAT                                              CDL099
     C                     ENDIF                                                              CDL099
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '025'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 025  *
     C                     MOVEL'ZM0060'  DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
     C                     MOVELZMDATE    SVDT
      *                                                                   141572
      ** Setup century indicator CINDV for value date SVDT                141572
     C           SVDT      IFEQ *BLANK                                    141572
     C                     MOVE *BLANK    CINDV                           141572
     C                     ELSE                                           141572
     C                     MOVELSVDT      YY      20                      141572
     C           YY        IFLT 72                                        141572
     C                     MOVE '2'       CINDV                           141572
     C                     ELSE                                           141572
     C                     MOVE '1'       CINDV                           141572
     C                     ENDIF                                          141572
     C                     ENDIF                                          141572
      *                                                                   141572
     C                     MOVELMGCCY     CCY
     C                     MOVELMGPONS    NSNO
     C                     MOVEL*BLANKS   SACN
     C                     MOVEL*BLANKS   AORR
     C                     MOVEL*BLANKS   DESI
      *
      **  Branch details
     C/COPY WNCPYSRC,MG0202C017
     C                     MOVE MGPOBR    BRCA
     C/COPY WNCPYSRC,MG0202C018
     C                     MOVE MGBRCA    OTHB
     C           OTHB      IFNE *BLANKS
     C                     MOVELMSGA,1    OTHT
     C                     END
     C                     MOVE *BLANKS   RCBR
      *
     C                     MOVE *BLANKS   NETI
     C***********          MOVE *BLANKS   DELC                            138742
      *                                                                   S01408
     C/COPY WNCPYSRC,MG0202CCP7                                           S01408
      *                                                                   S01408
     C                     MOVE *BLANKS   DYST
     C                     MOVE *BLANKS   RSID
     C                     MOVE *BLANKS   MSE1
     C                     MOVE *BLANKS   ELIN
     C                     MOVE *BLANKS   SSAC
     C                     MOVE *BLANKS   MIR
      *
     C                     MOVE 'Y'       TSKS
     C                     MOVE *BLANKS   TSKY
      *                                                                                       196833
      ** Change the Destination for CLS payments                                              196833
      *                                                                                       196833
     C                     EXSR SRDEST                                                        196833
      *                                                                   S01408
     C/COPY WNCPYSRC,MG0202CCP3                                           S01408
      *                                                                   S01408
      *
      **  Only write reference record if no error
      *
     C           @ERR      IFNE 'Y'
     C                     MOVE MGCHTP    AORR                                                CSW025
     C           MGCHTP    IFEQ 'A'                                                          BUG6076
     C           INTMSG    IFEQ 'I'                                                          BUG6076
     C           MGCVMI    IFNE 'S'                                                          BUG6076
     C                     MOVE 'T'       AORR                                               BUG6076
     C                     ELSE                                                              BUG6076
     C                     MOVE 'O'       AORR                                               BUG6076
     C                     ENDIF                                                             BUG6076
     C                     ELSE                                                              BUG6076
     C           MGCVMI    IFEQ 'S'                                                          BUG6076
     C                     MOVE 'V'       AORR                                               BUG6076
     C                     ENDIF                                                             BUG6076
     C                     ENDIF                                                             BUG6076
     C                     ENDIF                                                             BUG6076
     C           MGCHTP    IFEQ 'I'                                                          BUG6076
     C           INTMSG    IFEQ 'I'                                                          BUG6076
     C           MGCVMI    IFNE 'S'                                                          BUG6076
     C                     MOVE 'P'       AORR                                               BUG6076
     C                     ELSE                                                              BUG6076
     C                     MOVE 'N'       AORR                                               BUG6076
     C                     ENDIF                                                             BUG6076
     C                     ELSE                                                              BUG6076
     C           MGCVMI    IFEQ 'S'                                                          BUG6076
     C                     MOVE 'E'       AORR                                               BUG6076
     C                     ENDIF                                                             BUG6076
     C                     ENDIF                                                             BUG6076
     C                     ENDIF                                                             BUG6076
      *                                                                                      BUG6076
     C/COPY WNCPYSRC,MGH00058
     C                     WRITEMGOREFD0               05
      *
      **  Error on write to PF/MGOREFPD (message reference file)
     C           *IN05     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '026'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 026  *
     C                     MOVEL'MGOREFPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C/COPY WNCPYSRC,MG0202C063
     C                     END
     C/COPY WNCPYSRC,MG0202C001
     C*
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   WREFM - Write a reference record for MT203 parts            *
      *   Called by   OMSG  output message PF/MGOMSGPD                *
      *   Calls       -                                               *
      *****************************************************************
      *
     C           WREFM     BEGSR
      *
     C                     MOVE *BLANKS   SYTM
     C                     MOVE MGMODI    MODI
     C                     MOVEL@MTRN     MTRN
     C                     MOVEL@TNTP     TNTP
     C                     MOVEL@SBTP     SBTP
     C                     MOVE '203'     MTPY
     C                     MOVE MGAMTP    EVTP                            E29588
     C                     Z-ADDMGAVDT    AVDT                            E29588
     C                     Z-ADDMGASEQ    ASEQ                            E29588
     C                     MOVEL@NWBN     NWBN
     C************         MOVE 'N'       MPRY                            138742
      *                                                                   109281
      **  If part of multiple message and not the header status           109281
      *   must be created.                                                109281
      *                                                                   109281
     C********** TRNF      IFEQ *BLANK                             109281 110745
     C           TRNF      IFNE *BLANK                                    110745
     C                     MOVE 'CRTD'    MGST                            109281
     C                     MOVE '1'       MGSG                            109281
     C                     ENDIF                                          109281
      *                                                                                       CSD015
      ** If Watch List Checking is Applied and CSW025 is off,                                 CSD015
      ** do watch processing.                                                                 CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           222385
     C           CSW025    ANDNE'Y'                                                           CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
     C*                                                                   S01408
     C/COPY WNCPYSRC,MG0202CP14                                           S01408
     C*                                                                   S01408
      *
      ****If*not*already*determined,*use*the*default*from*SDCUSTPD*****
      **  If not already determined, use a default of 'CREATED' for a
      **  second or subsequent part of a multiple.
      *
     C           MGST      IFEQ *BLANK
     C                     MOVE '1'       MGSG                            087256
     C                     MOVE 'CRTD'    MGST                            087256
     C************         MOVE MMGSG     MGSG                            087256
     C************         MOVE MMGST     MGST                            087256
     C                     END
      *
     C                     MOVEL*BLANKS   PTST
     C                     MOVEL*BLANKS   LSCC
     C                     MOVEL*BLANKS   CARQ
     C                     MOVEL*BLANKS   MPDE
     C                     MOVEL@HRDT     HRDT
     C                     TIME           MGTM
     C                     MOVE BJMRDT    LADT
     C                     MOVE MGTM      LATM
      *
     C           MGST      IFEQ 'RSND'
     C                     MOVE BJMRDT    RELD
     C                     MOVE MGTM      RELT
     C                     END
      *
     C                     MOVEL*BLANKS   RUSR
     C                     MOVEL*BLANKS   RWSN
      *
     C                     MOVEL@AMTS     AMTS
      *
      **  Format value date to YYMMDD format
     C/COPY WNCPYSRC,MG0202C015
      *                                                                                       CDL099
      ** Only check for SVD if FX/MM                                                          CDL099
      *                                                                                       CDL099
     C           MGMODI    IFEQ 'DL'                                                          CDL099
     C           CDL099    ANDEQ'Y'                                                           CDL099
     C                     Z-ADDMGVDAT    ULMVD   50                                          CDL099
     C                     MOVELMGTNUM    KYDLNO                                              CDL099
     C           KYDLNO    CHAINDEALS                40                                       CDL099
     C                     MOVE BSDT2     MGVDAT                                              CDL099
     C                     ENDIF                                                              CDL099
      *                                                                                       CDL099
     C                     CALL 'ZM0060'               15
     C                     PARM MGVDAT    ZMDAY   50
     C                     PARM           ZMDATE  6
     C/COPY WNCPYSRC,MG0202C016
      *                                                                                       CDL099
     C           MGMODI    IFEQ 'DL'                                                          CDL099
     C           CDL099    ANDEQ'Y'                                                           CDL099
     C                     Z-ADDULMVD     MGVDAT                                              CDL099
     C                     ENDIF                                                              CDL099
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '027'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 027  *
     C                     MOVEL'ZM0060'  DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
     C                     MOVELZMDATE    SVDT
      *                                                                   141572
      ** Setup century indicator CINDV for value date SVDT                141572
     C           SVDT      IFEQ *BLANK                                    141572
     C                     MOVE *BLANK    CINDV                           141572
     C                     ELSE                                           141572
     C                     MOVELSVDT      YY      20                      141572
     C           YY        IFLT 72                                        141572
     C                     MOVE '2'       CINDV                           141572
     C                     ELSE                                           141572
     C                     MOVE '1'       CINDV                           141572
     C                     ENDIF                                          141572
     C                     ENDIF                                          141572
      *                                                                   141572
     C                     MOVELMGCCY     CCY
     C                     MOVELMGPONS    NSNO
     C                     MOVEL*BLANKS   SACN
     C                     MOVEL*BLANKS   AORR
     C                     MOVEL*BLANKS   DESI
      *
      **  Branch details
     C/COPY WNCPYSRC,MG0202C019
     C                     MOVE MGPOBR    BRCA
     C/COPY WNCPYSRC,MG0202C020
     C                     MOVE @OTHB     OTHB
     C                     MOVELMSGA,1    OTHT
     C                     MOVE *BLANKS   RCBR
      *
     C                     MOVE *BLANKS   NETI
     C***********          MOVE *BLANKS   DELC                            138742
      *                                                                   S01408
     C/COPY WNCPYSRC,MG0202CCP8                                           S01408
      *                                                                   S01408
     C                     MOVE *BLANKS   DYST
     C                     MOVE *BLANKS   RSID
     C                     MOVE *BLANKS   MSE1
     C                     MOVE *BLANKS   ELIN
     C                     MOVE *BLANKS   SSAC
     C                     MOVE *BLANKS   MIR
      *
     C                     MOVE 'Y'       TSKS
     C                     MOVE *BLANKS   TSKY
      *                                                                                       196833
      ** Change the Destination for CLS payments                                              196833
      *                                                                                       196833
     C                     EXSR SRDEST                                                        196833
      *                                                                   S01408
     C/COPY WNCPYSRC,MG0202CCP4                                           S01408
      *                                                                   S01408
      *
      **  Only write reference record if no error
      *
     C           @ERR      IFNE 'Y'
     C                     MOVE MGCHTP    AORR                                                CSW025
     C                     WRITEMGOREFD0               05
      *
      **  Error on write to PF/MGOREFPD (message reference file)
     C           *IN05     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '028'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 028  *
     C                     MOVEL'MGOREFPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     END
     C/COPY WNCPYSRC,MG0202C002
     C*
     C                     ENDSR
     C/EJECT
      *****************************************************************                       196833
      *                                                               *                       196833
      *  SRDEST - Destination for CLS Payments                        *                       196833
      *           For CLS payments, override Destination equal to     *                       196833
      *           'Alternative CLS Funding SWIFT ID' from the         *                       196833
      *           Nostro details file.                                *                       196833
      *                                                               *                       196833
      *****************************************************************                       196833
      *                                                                                       196833
     C           SRDEST    BEGSR                                                              196833
      *                                                                                       196833
     C           MGTTYP    IFEQ 'PC'                                                          196833
      *                                                                                       196833
     C           KCLS      KLIST                                                              196833
     C                     KFLD           WCCY    3                                           196833
     C                     KFLD           WLPR    2                                           196833
      *                                                                                       196833
     C           3         SUBSTTRNO:3    WCCY                                                196833
     C           2         SUBSTTRNO:6    WLPR                                                196833
      *                                                                                       196833
     C           KCLS      CHAINSDNOSTL8             80                                       196833
      *                                                                                       196833
      ** If dummy nostro is not found, database error.                                        196833
      *                                                                                       196833
     C           *IN80     IFEQ *ON                                                           196833
     C           *LOCK     IN   LDA                                                           196833
     C                     MOVEL'SDNOSTL8'DBFILE                                              196833
     C                     Z-ADD031       DBASE                                               196833
     C           WCCY      CAT  WLPR:1    DBKEY                                               196833
     C                     OUT  LDA                                                           196833
     C                     EXSR *PSSR                                                         196833
      *                                                                                       196833
      ** Else, set Destination = Alternative CLS Funding SWIFT ID,                            196833
      ** if it is not blank.                                                                  196833
      *                                                                                       196833
     C                     ELSE                                                               196833
     C           A7ASID    IFNE *BLANKS                                                       196833
     C                     MOVELA7ASID    NWDS                                                196833
     C                     ENDIF                                                              196833
     C                     ENDIF                                                              196833
      *                                                                                       196833
     C                     ENDIF                                                              196833
      *                                                                                       196833
     C                     ENDSR                                                              196833
      *                                                                                       196833
      *****************************************************************                       196833
      /EJECT                                                                                  196833
      *****************************************************************                       CSW209
      *   SRCOV - Check if COV message needs to be created            *                       CSW209
      *   Called by   MS202 - Format an MT202 message                 *                       CSW209
      *   Calls       AOBAGRV0                                        *                       CSW209
      *****************************************************************                       CSW209
      *                                                                                       CSW209
     C           SRCOV     BEGSR                                                              CSW209
      *                                                                                       CSW209
      ** Setup parameters for AOBAGRV0                                                        CSW209
      *                                                                                       CSW209
     C                     MOVELNWSN      @SSID                                               CSW209
      *                                                                                       CSW209
     C                     MOVE *BLANKS   @KEY1                                               CSW209
     C                     MOVELMGBENN    @KEY1                                               CSW209
     C                     CALL 'AOCUSTR0'                                                    CSW209
     C                     PARM '*MSG   ' @RTCD                                               CSW209
     C                     PARM '*KEY   ' @OPTN                                               CSW209
     C                     PARM           @KEY1                                               CSW209
     C                     PARM *BLANKS   @KYST                                               CSW209
     C           SDCUST    PARM SDCUST    DSSDY                                               CSW209
      *                                                                                       CSW209
     C                     MOVEL*BLANKS   @RSID                                               CSW209
     C                     MOVELBBCSID    @RSID                                               CSW209
      *                                                                                       CSW209
     C                     MOVEL*BLANKS   @ORBK                                               CSW209
     C                     MOVELMGPOBN    @ORBK                                               CSW209
      *                                                                                       CSW209
     C                     MOVEL*BLANKS   @SCOR                                               CSW209
     C                     MOVELMGPONS    @SCOR                                               CSW209
      *                                                                                       CSW209
     C                     MOVEL*BLANKS   @RCOR                                               CSW209
     C                     MOVELMGRCRN    @RCOR                                               CSW209
      *                                                                                       CSW209
      ** Access MEBAGRPD to check bilateral agreement                                         CSW209
      *                                                                                       CSW209
     C                     CALL 'AOBAGRV0'                                                    CSW209
     C                     PARM *BLANKS   @RTCD                                               CSW209
     C                     PARM 'SCT_C202'@BAGR  10                                           CSW209
     C                     PARM MGPOBR    @BRCD                                               CSW209
     C                     PARM NWRK      @NWRK   6                                           CSW209
     C                     PARM '103'     @MTPY   3                                           CSW209
     C                     PARM MGCCY     @SCUR   3                                           CSW209
     C                     PARM MGCCY     @PCUR   3                                           CSW209
     C                     PARM           @SSID  11                                           CSW209
     C                     PARM           @RSID  11                                           CSW209
     C                     PARM *BLANKS   @VFLG   8                                           CSW209
     C                     PARM           @ORBK 256                                           CSW209
     C                     PARM *BLANKS   @SRCV 256                                           CSW209
     C                     PARM           @SCOR 256                                           CSW209
     C                     PARM           @RCOR 256                                           CSW209
      *                                                                                       CSW209
     C           @RTCD     IFEQ '*CRTCOV'                                                     CSW209
     C                     MOVE 'Y'       PRVCOV                                              CSW209
     C                     MOVEL*BLANKS   WTAG    5                                           CSW209
     C                     MOVEL*BLANKS   WFLD   50                                           CSW209
      *                                                                                       CSW209
     C           CVTRN     SETLLMGOMSGLA                 40                                   CSW209
     C           *IN40     IFEQ *ON                                                           CSW209
      *                                                                                       CSW209
     C                     ADD  1         X                                                   CSW209
     C           X         OCUR MULT                                                          CSW209
      *                                                                                       CSW209
     C                     MOVE 'Y'       PRTCOV                                              CSW209
     C                     MOVEL*BLANKS   SAVTAG                                              CSW209
      *                                                                                       CSW209
     C           CVTRN     READEMGOMSGLA                 40                                   CSW209
     C           *IN40     DOWEQ*OFF                                                          CSW209
      *                                                                                       CSW209
      ** If :33B: data is present, save data                                                  CSW209
      *                                                                                       CSW209
     C           MTAG      IFEQ ':33B:'                                                       CSW209
     C                     MOVELMTAG      WTAG                                                CSW209
     C                     MOVELMFLD      WFLD                                                CSW209
     C                     ENDIF                                                              CSW209
      *                                                                                       CSW209
     C                     MOVELMTAG      @TAG    3                                           CSW209
      *                                                                                       CSW209
      ** IF MTAG is blanks, check if continuation                                             CSW209
      *                                                                                       CSW209
     C           MTAG      IFEQ *BLANKS                                                       CSW209
     C           SAVTAG    ANDNE*BLANKS                                                       CSW209
     C                     MOVELSAVTAG    @TAG                                                CSW209
     C                     ELSE                                                               CSW209
     C                     MOVEL*BLANKS   SAVTAG                                              CSW209
     C                     ENDIF                                                              CSW209
      *                                                                                       CSW209
     C           @TAG      IFEQ ':50'                                                         CSW209
     C           @TAG      OREQ ':52'                                                         CSW209
     C           @TAG      OREQ ':56'                                                         CSW209
     C           @TAG      OREQ ':57'                                                         CSW209
     C           @TAG      OREQ ':59'                                                         CSW209
     C           @TAG      OREQ ':70'                                                         CSW209
     C           @TAG      OREQ ':72'                                                         CSW209
     C                     ADD  1         X                                                   CSW209
     C           X         OCUR MULT                                                          CSW209
      *                                                                                       CSW209
      ** Save message tag                                                                     CSW209
      *                                                                                       CSW209
     C                     MOVEL@TAG      SAVTAG  3                                           CSW209
     C                     ENDIF                                                              CSW209
      *                                                                                       CSW209
     C           CVTRN     READEMGOMSGLA                 40                                   CSW209
     C                     ENDDO                                                              CSW209
      *                                                                                       CSW209
      ** If :33B: data is present, move data to MULT                                          CSW209
      *                                                                                       CSW209
     C           WTAG      IFNE *BLANKS                                                       CSW209
     C                     MOVELWTAG      MTAG                                                CSW209
     C                     MOVELWFLD      MFLD                                                CSW209
     C                     ADD  1         X                                                   CSW209
     C           X         OCUR MULT                                                          CSW209
     C                     ENDIF                                                              CSW209
      *                                                                                       CSW209
     C                     ENDIF                                                              CSW209
      *                                                                                       CSW209
     C                     ENDIF                                                              CSW209
      *                                                                                       CSW209
     C                     ENDSR                                                              CSW209
     C/EJECT                                                                                  CSW209
      *****************************************************************   CDL002
      *   UPDAT - Dummy update of FXNETML4 due to MG5000              *   CDL002
      *****************************************************************   CDL002
      *                                                                   CDL002
     C           UPDAT     BEGSR                                          CDL002
      *                                                                   CDL002
     C                     OPEN FXNETML4                                  CDL002
     C   25N25             UPDATFXNETMD0                                  CDL002
     C                     CLOSEFXNETML4                                  CDL002
      *                                                                   CDL002
     C                     ENDSR                                          CDL002
     C/COPY WNCPYSRC,MG0202C053
     C/EJECT                                                              CDL002
      *****************************************************************
      *   *PSSR - error handling                                      *
      *****************************************************************
      *
     C           *PSSR     BEGSR
      *
      **  Write database error to report
     C                     OPEN MG0202AU
     C                     WRITEHEAD
     C                     WRITEDBERROR
      *
     C                     SETON                     U7U8LR
     C                     DUMP
     C                     RETRN
      *
     C                     ENDSR
     C/EJECT
     C/COPY WNCPYSRC,MG0202C064
      *
     C/COPY MGCPYSRC,SWIFTTRANS                                           BLI605
** CPY@   Object Copyright
(c) Finastra International Limited 2001
** MSGA   Messages
Booking
Customer details not found on SDCUSTPD
Nostro customer not found on SDNOSTPD
ZM0040 (format ccy and amount) call ended in error
ZM0050 (format SWIFT address) call ended in error
ZM0040 (format fld 19 amount) call ended in error
Duplicate TRN key built for this message
     X/COPY WNCPYSRC,MG0202X001
