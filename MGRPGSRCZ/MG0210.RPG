     H        1                           F
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas MG Format notice to receive message')            *
     F*****************************************************************
     F*                                                               *
     F*  Midas - MESSAGE GENERATION                                   *
     F*                                                               *
     F*  MG0210 - FORMAT NOTICE TO RECEIVE MESSAGE (MT210)            *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. CLE148             Date 23Jul12               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *  Last Amend No. BUG15099           Date 23Oct07               *
      *  Prev Amend No. BUG15017           Date 16Oct07               *
      *                 250600             Date 07Oct07               *
      *                 CSW207A            Date 01Aug07               *
      *                 CSW207             Date 07Jul07               *
      *                 248359             Date 20Jun07               *
      *                 162270A            Date 12Jan07               *
      *                 162270             Date 18Dec06               *
      *                 CSW050             Date 05Dec06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242622             Date 26Sep06               *
      *                 240909             Date 05Jul06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 222373             Date 27Oct03               *
      *                 222385             Date 23Oct03               *
      *                 221145             Date 08Sep03               *
      *                 219242             Date 01Jul03               *
      *                 219241             Date 01Jul03               *
      *                 CSD015             Date 14Oct02               *
      *                 210796             Date 22Nov02               *
      * Midas Release 4.01.01 ----------------------------------------*
      *                 CSW202             Date 20May02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CSW025             Date 26Mar02               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 196833             Date 16Aug01               *
      *                 CSW201             Date 02May01               *
      *                 183583             Date 11Jun01               *
      * Midas DBA 3.05 -----------------------------------------------*
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CDL008             Date 02May00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 138742             Date 07Jul98               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CSW020             Date 04Jan00               *
      *                 169210             Date 19Oct99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 142403             Date 25Jan99               *
     F*                 141572             DATE 21SEP98               *
     F*                 127264             DATE 18DEC97               *
     F*                 113352             DATE 13FEB97               *
     F*                 046817             DATE 28OCT97               *
     F*                 CDL002             DATE 17SEP97               *
     F*                 109283             DATE 06FEB97               *
     F*                 S01408             DATE 31OCT96               *
     F*                 CSW096             DATE 03JUN96               *
     F*                 082906             DATE 23OCT95               *
     F*                 090915             DATE 23OCT95               *
     F*                 S01408             DATE 02AUG95               *
     F*                 087256             DATE 03MAY95               *
     F*                 084320             DATE 07MAR95               *
     F*                 080096             DATE 12JAN95               *
     F*                 060799             DATE 17FEB94               *
     F*                 S01421             DATE 18AUG93               *
     F*                 E42086             DATE 10JLU92               *
     F*                 E40242             DATE 25JUN92               *
     F*                 E27567             DATE 11OCT91               *
     F*                 E29588             DATE 07OCT91               *
     F*                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  CLE148 - Alpha Loan Reference                                *
      *  BUG15099 - Error in field 50 in MT210. It contains the name  *
      *             and address of the destination customer rather    *
      *             than receipt ordering customer.                   *
      *  BUG15017 - Missing fields in MT103 and MT210                 *
      *  250600 - Fix CFT032 and CSW207                               *
      *  CSW207A - SWIFT 2007 Standard Changes                        *
      *  CSW207 - Swift 2007 Changes                                  *
      *  248359 - Missing Safekeeping Account number.                 *
     F*  162270A- Change feature BCY001 to CSE099.                    *
     F*  162270 - Amended program such that for a TP trade with a     *
     F*           pay code of 1, a clearance type of 3 or 4 and a pay *
     F*           from different to the delivered to, MT202 and MT210 *
     F*           will be generated.                                  *
      *  CSW050 - Generate Multiple Messages in MidasPlus.            *
      *           Fix applied by 242622.                              *
      *  242622 - Generate Multiple Messages in MidasPlus.            *
      *  240909 - Format field :21: to use transaction reference if   *
      *           system value MG0210Fld21TranRef is Y                *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222373 - Parameter Mismatch.                                 *
      *  222385 - SWIFT msgs are Watch List checked regardless of     *
      *           configuration file setting                          *
      *  221145 - Compliance Watch WLC: Allow checking of multiple    *
      *           SWIFT messages                                      *
      *  219242 - Not possible to create MT103+ payment msg from      *
      *           non-FT transaction (Recompile)                      *
      *  219241 - Defaulting of "Details of Charges" assign a         *
      *           system value (Recompile)                            *
      *  CSD015 - Midas Compliance Watch - Watch List Checking        *
      *  210796 - Extend Our a/c at Nostro field                      *
      *  CSW202 - SWIFT 2002 Standards Update                         *
      *  CSW025 - Midas Message Manager                               *
      *           - Pass original change type & suppress multiples    *
      *  196833 - Additional SWIFT Address for CLS Nostros            *
      *  CSW201 - SWIFT 2001 Standards Update                         *
      *  183583 - Add extension file MGOEXTPD to store customer no.   *
      *           of field with SWIFT address.                        *
      *  CDL008 - Continuous Linked Settlement                        *
     F*   138742 - Default priority urgent, delivery notification     *
     F*            required and non-delivery warning required flags   *
     F*            are not defaulted from SDCURRPD.                   *
     F*  CSW020 - SWIFT Decimal Places                                *
     F*           Take in account the swift decimal places to         *
     F*           calculate the Sum of Amounts.                       *
      *  169210 - Duplicate hook renamed from MG0210C028 to MG0210CABP*
     F*  142403 - Changes which should have been done for lending     *
     F*           fees under CLE007.                                  *
     F*           Swift Trn of fee messages are to start with F.      *
     F*  141572 - Setup CINDV (century flag) SVDT ( value date).      *
     F*  127264 - FX Netting                                          *
     F*           Field 20: is NT/Net Number/Sequence                 *
     F*  113352 - Set-up CIND (Century flag)  to correct year2000     *
     F*           display problem.                                    *
     F*  046817 - Print out all address lines; do not stop if a       *
     F*           blank address line is found.                        *
     F*  CDL002 - FX Netting                                          *
     F*           Field 20: is Net Reference (single messages)        *
     F*           Field 20: is NT/Date/Time  (multiple messages)      *
     F*           Field 21: is Net Reference                          *
     F*  109283 - Correct identification of duplicate TRNF.           *
     F*  S01408 - Addition of Core Hook MG0210CCP5                   *
     F*           Addition of Core Hook MG0210CCP4                   *
     F*  CSW096 - SWIFT changes 1996                                  *
     F*  082906 - APPLY SAME CORRECTION AS IN MG0330                  *
     F*  090915 - To avoid a duplicate key in MGOREFPD, add a         *
     F*           sequence to TRN in the case of two messages         *
     F*           are generated in the same second.                   *
     F*  S01408 - Addition of core hook MG0210CCP1                    *
     F*           Addition of core hook MG0210CCP2                    *
     F*           Addition of core hook MG0210CCP3                    *
     F*  087256 - For multiple part MT210 messages the second and     *
     F*           subsequent MGOREFPD records should have a status    *
     F*           of 'CRTD'                                           *
     F*  084320 - Do not set on U7 for a non-fatal error, as this     *
     F*           will cause the controlling component to end         *
     F*           abnormally.                                         *
     F*  080096 - RECOMPILE BECAUSE COPY MEMBER MGCPYSRC,SWIFTTRANS   *
     F*           CHANGED                                             *
     F*  060799 - Do not show the word 'Booking' for multiple 210     *
     F*           messages.  This is in relation to fix E29588.       *
     F*  S01421 - REPLACE THE SWIFT TRANSLATION TABLE WITH A          *
     F*           /COPY STATEMENT (SWIFTTRANS).                       *
     F*  E42086 - CATER FOR BLANK ADDRESS LINES                       *
     F*  E40242 - Recompiled due to changes in ASEQ                   *
     F*  E27567 - BRANCH FILE SWIFT ID, SHOULD NOT BE MANDATORY,      *
     F*           HENCE ROUTING ROUTINE SHOULD REFLECT THIS.          *
     F*  E29588 - POST COLLECTION SWIFT RATIONALISATION FIXES         *
     F*           o Booking branch narrative should be blank          *
     F*             for a multiple MT210.                             *
     F*  RE-WRITTEN FOR S01344 - SWIFT RATIONALISATION PHASE 2        *
     F*                                                               *
     F*****************************************************************
     FMGF210L0UF  E           K        DISK
     F                                              KCOMIT
     F*MGOREFL0IF**E           K        DISK                              E29588
     F************MGOREFD0                          KRENAMEMGREFL0        E29588
     FMGOREFA6IF  E           K        DISK
     F            MGOREFD0                          KRENAMEMGREFL0
     FMGOREFA1IF  E           K        DISK                                                   221145
     F            MGOREFD0                          KRENAMEMGREFA1                            221145
     FSDNOSTL8IF  E           K        DISK                                                   196833
     FMGOREFPDO   E                    DISK
     F                                              KCOMIT
     FMGOMSGPDO   E                    DISK
     F                                              KCOMIT
     FFXNETML4UF  E           K        DISK                           U5  CDL002
     F                                              KCOMIT                CDL002
     FMGOEXTPDO   E                    DISK                               183583
     F                                              KCOMIT                183583
     FMG0210P1O   E                    PRINTER                        UC
     FMG0210AUO   E                    PRINTER                        UC
      *                                                                                       162270
     FTRADSDY4IF  E           K        DISK                                                   162270
      *                                                                                       162270
     FTRADSDY2IF  E           K        DISK                                                   248359
      *                                                                                       248359
     F/COPY WNCPYSRC,MG0210F001
      *
      ********************************************************************
      *
      * ID C  F  H  L    FUNCTION OF INDICATORS
      *
      *    05            Error on write to PF/MGOREFPD
      *    06            Error on write to PF/MGOMSGPD
      *    10            EOF MGF210L0
      *    11            CHAIN to MGOREFA6 (TRN unique ?)
      *****11************CHAIN to MGOREFL0 (TRN unique ?)                 E29588
      *    15            Error in call to standard program (ZMxxxx)
      *    16            Error on delete of GDF record.
      *    19            LOKUP operation searching array (GNR, @WRK)
      *    20            LOKUP operation searching array (GNR, @WRK)
      *    21            LOKUP operation searching array (GNR)
      *    22            LOKUP operation for determining the codeword
      *    24            MG5000 not found/error on call
      *    25            CHAIN to FXNETML4                                CDL002
      *    50            MG0210P1 open
      *    90            CHAIN to MGOREFA1                                221145
      *    U7U8          Database error
      *
     F********************************************************************
     E                    CPY@    1   1 80               copyright
     E/COPY WNCPYSRC,MG0210E001
     E                    MSGA    1   7 50               message text
     E/COPY WNCPYSRC,MG0210E002
     E                    GNR        15  3               msg generated rel
     E                    MNG        15  3               msg type not gen.
     E                    @WRK       50  1               concatenate field
     E                    BTBI        6 35               bank to bank info
     E                    R203       10  6               MT203 trans. nos.E29588
      *
     IMGREFA1                                                             221145
      *                                                                   221145
      ** Rename Fields                                                    221145
      *                                                                   221145
     I              SYTM                            ASYTM                 221145
     I              MODI                            AMODI                 221145
     I              TRNO                            ATRNO                 221145
     I              TRNF                            ATRNF                 221145
     I              TRNM                            ATRNM                 221145
     I              MTRN                            AMTRN                 221145
     I              TNTP                            ATNTP                 221145
     I              SBTP                            ASBTP                 221145
     I              EVTP                            AEVTP                 221145
     I              NWRK                            ANWRK                 221145
     I              SECN                            ASECN                 221145
     I              NWSN                            ANWSN                 221145
     I              DECN                            ADECN                 221145
     I              NWDS                            ANWDS                 221145
     I              NWBN                            ANWBN                 221145
     I              MTPY                            AMTPY                 221145
     I              MPRY                            AMPRY                 221145
     I              MGSG                            AMGSG                 221145
     I              MGST                            AMGST                 221145
     I              LSCC                            ALSCC                 221145
     I              F57U                            AF57U                 221145
     I              PTST                            APTST                 221145
     I              CARQ                            ACARQ                 221145
     I              MPDE                            AMPDE                 221145
     I              HRDT                            AHRDT                 221145
     I              MGDE                            AMGDE                 221145
     I              MGTM                            AMGTM                 221145
     I              LADT                            ALADT                 221145
     I              LATM                            ALATM                 221145
     I              RELD                            ARELD                 221145
     I              RELT                            ARELT                 221145
     I              RUSR                            ARUSR                 221145
     I              RWSN                            ARWSN                 221145
     I              AMTX                            AAMTX                 221145
     I              AMTS                            AAMTS                 221145
     I              SVDT                            ASVDT                 221145
     I              CCY                             ACCY                  221145
     I              NSNO                            ANSNO                 221145
     I              SACN                            ASACN                 221145
     I              AORR                            AAORR                 221145
     I              DESI                            ADESI                 221145
     I              BRCA                            ABRCA                 221145
     I              OTHB                            AOTHB                 221145
     I              RCBR                            ARCBR                 221145
     I              OTHT                            AOTHT                 221145
     I              NETI                            ANETI                 221145
     I              DELC                            ADELC                 221145
     I              DYST                            ADYST                 221145
     I              RSID                            ARSID                 221145
     I              MSE1                            AMSE1                 221145
     I              ELIN                            AELIN                 221145
     I              SSAC                            ASSAC                 221145
     I              MIR                             AMIR                  221145
     I              TSKS                            ATSKS                 221145
     I              TSKY                            ATSKY                 221145
     I              TSEQ                            ATSEQ                 221145
     I              CFPF                            ACFPF                 221145
     I              PT210                           APT210                221145
     I              AVDT                            AAVDT                 221145
     I              ASEQ                            AASEQ                 221145
     I              TODY                            ATODY                 221145
     I              CIND                            ACIND                 221145
     I              CINDV                           ACINDV                221145
     I              CLSS                            ACLSS                 221145
      *                                                                   221145
     IMULT        DS                        100
     I                                        1   5 MTAG
     I                                        6  55 MFLD
     I                                       56 105 MERR
     IEXTN        DS                         45                           183583
     I                                        1   20MPSN                  183583
     I                                        3   7 MTG                   183583
     I                                        8  15 MCSI                  183583
      *                                                                   183583
      ** Multiple occurrence data structure for extension file            183583
      *                                                                   183583
     I            DS                                                      183583
     I                                        1   5 @MTG                  183583
     I                                        2   2 FLDTYP                183583
     I                                        4   4 FLDTAG                183583
      *                                                                   183583
      ** Field tag data structure                                         183583
      *                                                                   183583
      **  Multiple occurrence data structure for message
      *
     IREF210      DS                         11
     I                                        1  16 @RTRN
      **  Multiple occurrence data structure for MT210 TRN's
      *
     IPART        DS                         11
     I                                        1  15 @MTRN
     I                                       16  17 @TNTP
     I                                       18  19 @SBTP
     I                                       20  32 @AMTS
     I                                       33  35 @OTHB
      **  Multiple occurrence data structure for MT210 parts
      *
     I@TRN        DS                         16
     I                                        1   2 @TR1
     I                                        3   8 @TR2
     I                                        9  110@TR3
     I                                       12  16 @TR4
      **  Data structure build transaction reference number
      *
     I            DS
     I                                        1  12 CSID
     I                                        9  11 @BIC
      **  Data structure to test for BIC code
      *
     IFLD3B       DS                         26
     I                                        1   3 ZSCCY
     I                                        4  20 ZSAMNT
      **  Data structure containing codeword for Fields 32B
      *
     I/COPY WNCPYSRC,MG0210I002
     IERR3N       DS                         24
     I                                        1   3 ZCCY
     I                                        5  17 ZAMT
      **  Erroneous currency & amounts for Fields 32A
      *
     I@MTAG       DS                          5
     I                                        1   1 COLON1
     I                                        2   3 FLDNO
     I                                        4   4 TAG
     I                                        5   5 COLON2
      **  Data structure constructing message field tag
      *
     I@BTB        DS                         35
     I                                        1   8 BENSC
     I                                        1   6 BEN
     I                                        7   8 CODE
     I                                        6  35 ACL
      **  Data structure for sender to receiver information
      *
     IP@IN        DS                            256                       CSW096
     I                                        1   3 I@SNBR                CSW096
     I                                        4   9 I@DSCN                CSW096
     I                                       10  12 I@MTPY                CSW096
     I                                       13  140I@SETT                CSW096
     I                                       15  15 I@CONC                CSW096
     I                                       16  16 I@FTCS                CSW096
     I                                       17  18 I@MMOD                CSW096
      ** Data structure for input parameter                               CSW096
      *                                                                   CSW096
     IP@OUT       DS                            256                       CSW096
     I**********                              1   60O@CNSN                             CSW096 CSD027
     I                                        1   6 O@CNSN                                    CSD027
     I                                        7  18 O@SWSN                CSW096
     I                                       19  38 O@NWSN                CSW096
     I                                       39  49 O@SWDS                CSW096
     I                                       46  46 W@96CN                CSW096
     I                                       47  49 W@BIC                 CSW096
     I                                       50  69 O@NWDS                CSW096
     I                                       70  75 O@NWRK                CSW096
     I                                       76  76 O@MGSG                CSW096
     I                                       77  80 O@MGST                CSW096
     I                                       81  81 O@PAIN                CSW096
     I                                       82  87 O@PCNB                CSW096
     I                                       88  90 O@SPRS                CSW096
      ** Data structure for ouput parameter                               CSW096
      *                                                                   CSW096
     I/COPY WNCPYSRC,MG0210I001
      *                                                                                       CSD015
     IPSTRNG      DS                           9999                                           CSD015
      *                                                                                       CSD015
     IWLTDS     E DSSDWLTOPD                                                                  CSD015
      ** List transaction details                                                             CSD015
      *                                                                                       CSD015
     ISDWLCC    E DSSDWLCCPD                                                                  222385
      ** Watch list checking details                                                          222385
      *                                                                                       222385
     ISDBANK    E DSSDBANKPD
      **  Data structure for bank file
      *
     ISDCUST    E DSSDCUSTPD
      **  Data structure for customer file
      *
     ISDBRCH    E DSSDBRCHPD
     I              QQDFAC                          DFACQQ                                    CGL029
      **  Data structure for branch file
      *
     ISDMMOD    E DSSDMMODPD
      **  Data structure for module ICD file
      *
     ISDMGME    E DSSDMGMEPD
      **  Data structure for message management data.
      *
     ISCSARD    E DSSCSARDPD                                              CDL002
      **  Data structure for SAR data.                                    CDL002
      *                                                                   CDL002
     IMEBEIS    E DSMEBEISPD                                                                  CSW202
      ** Data Structure for Business Entity Identifier file                                   CSW202
      *                                                                                       CSW202
     IDSFDY     E DSDSFDY
      **  Short data structure for access programs
      *
     IDSSDY     E DSDSSDY
      **  Long data structure for access programs
      *                                                                                       250600
     IDSLDY     E DSDSLDY                                                                     250600
      **  Long data structure for access programs                                             250600
      *
     ISDCURR    E DSSDCURRPD                                              CSW020
      **  Data structure for currency file                                CSW020
      *                                                                   CSW020
     IMEBICD    E DSMEBICDPD                                                                  CSW201
      ** Midas BIC Directory                                                                  CSW201
      *                                                                                       CSW201
     IRUNDAT      DS                                                      CSW020
     I                                        1   7 MRDT                  CSW020
     I                                    P   8  100RDNB                  CSW020
     I                                       11  11 SUC                   CSW020
     I                                       12  12 DFF                   CSW020
     I                                       13  13 MBIN                  CSW020
      *                                                                   CSW020
     ISVAL1       DS                            200                                           240909
     I                                        1   1 SVAL11                                    240909
      ** DS for AOSVALR0                                                                      240909
      *                                                                                       240909
     I              'MG0210Fld21TranRef ' C         SVALKA                                    240909
      *                                                                                       240909
     I            DS                                                                          248359
     I                                        1   6 T1SAFA                                    248359
     I                                        1   1 SA0101                                    248359
      *                                                                                       248359
     ISVCUSD      DS                           1500                                         BUG15099
     ILDA         DS                            256
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
      **  Local data area
      *                                                                   CSW096
     I/COPY WNCPYSRC,MG0210IIPG                                           CSW096
      *                                                                   CSW096
      *
     C/EJECT
      *****************************************************************
      *                                                               *
      *                Multiple message processing                    *
      *               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~                   *
      *                                                               *
      * 1. Matching criteria:                                         *
      *      The following fields are used to determine whether or    *
      *      not two or more message can be combined to produce a     *
      *      multiple receive message (MT210).                        *
      *      Module id                                                *
      *      Destination customer                                     *
      *      Branch code                                              *
      *      Value date                                               *
      *      Currency                                                 *
      *      Settlement type                                          *
      *                                                               *
      *      A logical file (MGF210L0), is built over the GDF file    *
      *      MGF210PD, keyed by the above matching criteria fields.   *
      *      Once a record has been read, using MGF210L0, the next    *
      *      record is then read and the matching criteria fields     *
      *      are compared; if the same, produce a multiple MT210      *
      *      message, else produce a single MT210.                    *
      *                                                               *
      *                                                               *
      * 2. Byte Counting                                              *
      *      At present the total amount of bytes we can transmit     *
      *      at any one time equals 1920. When creating an MT210      *
      *      we wish to include as many parts possible (to the        *
      *      maximum of 10), instead of setting ourselves a limit.    *
      *      This is achieved by adding the bytes of the fields       *
      *      being formatted for each part of the multiple and        *
      *      subtracting them from the total. The amount of bytes     *
      *      removed for each field are calculated by taking the      *
      *      maxmum allowed bytes for that particlaur field.          *
      *                                                               *
      * Note:  S.W.I.F.T. messages contain Header and Trailer infor-  *
      *        mation. At present we have defaulted then to their     *
      *        maximum size of Header 64 and Trailer 16. These values *
      *        must also be subtracted from the total amount for      *
      *        each MT210 message.                                    *
      *        Total amount, Header and Trailer fields are            *
      *        initialised to the above amounts in subroutine INTF.   *
      *                                                               *
      * 3. Multiple Data Structure MULT                               *
      *      The multiple occurrence data structure is used to        *
      *      store up the records that make up the SWIFT message      *
      *      before writing the whole message to file.                *
      *      To store the records of the message, you must            *
      *      first access an OCUR record, obtain the Message Tag      *
      *      & Message field data values for this OCUR record,        *
      *      then go on to the next OCUR record and continue          *
      *      this process until the SWIFT message is complete.        *
      *                                                               *
      *****************************************************************
     C/EJECT
      *****************************************************************
      *                   Index to subroutines                        *
      *  main process                                                 *
      *  INIT   - Initial process                                     *
      *  INTF   - Initialise non-constant fields                      *
      ***ROUT***-*Determine*message*routing****************************   CSW096
      *  SRROUT - Determine message routing                           *   CSW096
      ***FILL***-*Fill*up*array*GNR************************************   CSW096
      ***NWAD***-*Determine*default*network*address********************   CSW096
      ***PRAD***-*Determine*settlement*network*address*****************   CSW096
      *  CHECK  - Check if the matching criteria is met for an  MT210 *
      *  SG210  - Format a single MT210                               *
      *  MU210  - Format a multiple MT210                             *
      *  TRNUM  - Format TRN for reference file, PF/MGOREFPD          *
      *  FMTHD  - Format the header part of an MT210 :20: AND :30:    *
      *  MESG   - Format fields :50:, :52n:, :56n:                    *
      *  FLD50  - Format field 50 (Ordering Institution)              *
      *  FLD52  - Format field 52 (Ordering Institution)              *
      *  FLD56  - Format field 56 (Intermediary Bank)                 *
      *  FSWAD  - Format SWIFT A/D addresses                          *
      *  OMSG   - Output correctly generated message to PF/MGOMSGPD   *
      *  REPT   - Output incorrectly generated message to report      *
      *  SEQN   - Retrive S.W.I.F.T sequence numbers                  *
      *  DELT   - Delete processed GDF record                         *
      *  UPMOD  - Update S.W.I.F.T. sequence numbers                  *
      *  RMVMSG - Remove message part from data structure MULT        *
      *  WREF   - Write reference record to PF/MGOREFPD               *
      *  WREFM  - Write reference records to PF/MGOREFPD for MT210    *
      *  DFLT   - Default priorities from SDCURRPD                    *   138742
      *                                                               *
      *****************************************************************
     C/EJECT
      *****************************************************************
      *   Main process                                                *
      *   Calls     INIT   initial process                            *
      *             INTF   initialise non-constant fields             *
      **************ROUT***determine*message*routing*******************   CSW096
      *             SRROUT determine message routing                  *   CSW096
      *             CHECK  Matching criteria met ?                    *
      *             SG210  Format a single MT210 message              *
      *             MU210  Format a multiple MT210 message            *
      *                                                               *
      *****************************************************************
      *
      **  Initial process
     C                     EXSR INIT
      *
      **  Read the first record from the MT210 extract file
      *
     C                     READ MGF210L0                 10
      *
      **  Do While records found on the MT210 extract file
      *
     C           *IN10     DOWEQ'0'
      *
      **  Initialise non-constant fields
      *
     C                     EXSR INTF
      *
      **  Determine message routing
      *
     C***********          EXSR ROUT                                      CSW096
     C                     EXSR SRROUT                                    CSW096
      *
      **  Set up currency defaults                                        138742
     C                     EXSR DFLT                                      138742
      *                                                                   138742
      **  Single MT210 required when network 'PAPER' or 'UNROUT'
      *
     C           NWRK      IFEQ 'PAPER'
     C           NWRK      OREQ 'UNROUT'
     C/COPY WNCPYSRC,MG0210C029
      *
     C                     EXSR SG210
      *
     C                     ELSE
      **  Read next record to determine if multiple MT210 required
      *
     C                     READ MGF210L0                 10
      *
      **  If not end of file, is the matching criteria met ?
      *
     C           *IN10     IFEQ '0'
     C/COPY WNCPYSRC,MG0210C007
     C                     EXSR CHECK
     C/COPY WNCPYSRC,MG0210C008
     C                     END
      *
      **  Return back to the previous message so it can be processed
      *
     C                     READPMGF210L0                 10
      *
      **  Matching criteria is met
     C           MATCH     IFEQ 'Y'
     C/COPY WNCPYSRC,MG0210C044
      *
      **  multiple MT210
     C                     EXSR MU210
     C/COPY WNCPYSRC,MG0210C045
     C                     ELSE
      *
      **  single MT210
     C                     EXSR SG210
     C                     END
     C                     END
      *
      ** Delete the GDF records that have been processed
      *
     C                     EXSR DELT
      *
      ** Update the S.W.I.F.T sequence number
      *
     C                     EXSR UPMOD
      *
      **  Commit all file changes to PF/MGOREFPD & PF/MGOMSGPD
      *
     C                     COMIT
      *                                                                   221145
      **  Call Compliance Watch:Watch List Checking                       221145
      *                                                                   221145
     C           CSD015    IFEQ 'Y'                                       221145
     C           W1EWLC    ANDEQ'Y'                                                           222385
     C           CSW025    ANDEQ'N'                                       221145
     C                     EXSR WLCDQ                                     221145
     C                     ENDIF                                          221145
      *
      **  READ next GDF record
      *
     C                     READ MGF210L0                 10
      *
     C                     END
      *
      **  Write end of report, only if the printer file is open
      *
     C           *IN50     IFEQ '1'
     C                     WRITEEOREPT
     C                     END
     C/COPY WNCPYSRC,MG0210C037
      *
     C                     SETON                     LR
      *
     C/EJECT
      *****************************************************************   138742
     C           DFLT      BEGSR                                          138742
      *                                                                   138742
      *                                                                   138742
     C** Call Access Program for Currency Details                         138742
     C*       to Obtain DEFAULTS                                          138742
     C                     CALL 'AOCURRR0'                                138742
     C                     PARM '*DBERR ' @RTCD                           138742
     C                     PARM '*KEY   ' @OPTN                           138742
     C                     PARM MGCCY     @BKCY   3                       138742
     C           SDCURR    PARM SDCURR    DSSDY                           138742
     C*                                                                   138742
     C           A6DPRU    IFEQ 'Y'                                       138742
     C                     MOVE 'U'       MPRY                            138742
     C                     ELSE                                           138742
     C                     MOVE 'N'       MPRY                            138742
     C                     END                                            138742
     C*                                                                   138742
     C                     MOVE A6NDWR    JEZ     2                       138742
     C                     MOVELA6DNOR    JEZ                             138742
     C*                                                                   138742
     C           JEZ       IFEQ 'NN'                                      138742
     C                     MOVE *BLANKS   DELC                            138742
     C                     END                                            138742
     C           JEZ       IFEQ 'NY'                                      138742
     C                     MOVE '1'       DELC                            138742
     C                     END                                            138742
     C           JEZ       IFEQ 'YN'                                      138742
     C                     MOVE '2'       DELC                            138742
     C                     END                                            138742
     C           JEZ       IFEQ 'YY'                                      138742
     C                     MOVE '3'       DELC                            138742
     C                     END                                            138742
     C*                                                                   138742
     C                     ENDSR                                          138742
     C/EJECT                                                              138742
      *****************************************************************
      *   INIT - inital process                                       *
      *   Called by - main process                                    *
      *   Calls     -                                                 *
      *****************************************************************
      *
     C           INIT      BEGSR
      *
     C                     MOVEACPY@      BIS@   80
      *
      **  Set up LDA
     C           *NAMVAR   DEFN           LDA
     C           *LOCK     IN   LDA
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     MOVEL'MG0210'  DBPGM
     C                     MOVE *BLANKS   DBASE
     C                     OUT  LDA
      *                                                                   CSW020
      * Get Rundate - Rundate  *                                          CSW020
     C           *NAMVAR   DEFN           RUNDAT                          CSW020
     C                     IN   RUNDAT                                    CSW020
      *
      **  Access SDBANKPD for report title
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '001'     DBASE            * * * * * * * *
     C                     MOVEL'FIRST'   DBKEY            *  DBERR 001  *
     C                     MOVEL'SDBANKPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Access SDMMODPD for modules available
      *
     C                     CALL 'AOMMODR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C           SDMMOD    PARM SDMMOD    DSFDY
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '002'     DBASE            * * * * * * * *
     C                     MOVEL'FIRST'   DBKEY            *  DBERR 002  *
     C                     MOVEL'SDMMODPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Access SDMGMEPD for message management data.
     C                     CALL 'AOMGMER0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C           SDMGME    PARM SDMGME    DSFDY
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '024'     DBASE            * * * * * * * *
     C                     MOVEL'FIRST'   DBKEY            *  DBERR 024  *
     C                     MOVEL'SDMGMEPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      * Check system values                                                                   240909
     C                     CALL 'AOSVALR0'                                                    240909
     C                     PARM           @RTCD                                               240909
     C                     PARM SVALKA    SVALK1 20                                           240909
     C                     PARM           SVAL1 200                                           240909
     C                     PARM *BLANK    SVALK2 20                                           240909
     C                     PARM           SVAL2 200                                           240909
     C                     PARM *BLANK    SVALK3 20                                           240909
     C                     PARM           SVAL3 200                                           240909
     C                     PARM *BLANK    SVALK4 20                                           240909
     C                     PARM           SVAL4 200                                           240909
     C                     PARM *BLANK    SVALK5 20                                           240909
     C                     PARM           SVAL5 200                                           240909
     C                     PARM *BLANK    SVALK6 20                                           240909
     C                     PARM           SVAL6 200                                           240909
     C                     PARM *BLANK    SVALK7 20                                           240909
     C                     PARM           SVAL7 200                                           240909
     C                     PARM *BLANK    SVALK8 20                                           240909
     C                     PARM           SVAL8 200                                           240909
     C                     PARM *BLANK    SVALK9 20                                           240909
     C                     PARM           SVAL9 200                                           240909
     C                     PARM *BLANK    SVALK0 20                                           240909
     C                     PARM           SVAL10200                                           240909
      *                                                                                       240909
     C           @RTCD     IFNE *BLANK                                                        240909
     C                     MOVELSVALKA    DBKEY                                               240909
     C                     MOVEL'SDSVALPD'DBFILE           ***************                    240909
     C                     MOVEL'034'     DBASE            * DBERROR 034 *                    240909
     C                     SETON                     U7U8  ***************                    240909
     C                     EXSR *PSSR                                                         240909
     C                     ENDIF                                                              240909
      *                                                                                       240909
     C                     MOVE SVAL11    FL21TR  1                                           240909
     C*                                                                   CDL002
     C** Access SAR Details file to determine if CDL002 installed         CDL002
     C*                                                                   CDL002
     C                     CALL 'AOSARDR0'                                CDL002
     C                     PARM '       ' @RTCD                           CDL002
     C                     PARM '*VERIFY' @OPTN                           CDL002
     C                     PARM 'CDL002'  @SARD   6                       CDL002
     C           SCSARD    PARM SCSARD    DSFDY                           CDL002
     C           @RTCD     IFNE *BLANK                                    CDL002
     C           @RTCD     ANDNE'*NRF   '                                 CDL002
     C                     MOVEL'SCSARDPD'DBFILE           ************** CDL002
     C                     MOVEL'025'     DBASE            * DBERROR 025* CDL002
     C                     MOVEL@RTCD     DBKEY            ************** CDL002
     C                     SETON                     U7U8                 CDL002
     C                     EXSR *PSSR                                     CDL002
     C                     END                                            CDL002
     C           @RTCD     IFEQ *BLANK                                    CDL002
     C                     MOVE 'Y'       CDL002  1                       CDL002
     C                     ELSE                                           CDL002
     C                     MOVE 'N'       CDL002                          CDL002
     C                     ENDIF                                          CDL002
      *                                                                   142403
      ** Determine if Customer Lending Enhancements - Others (T3)         142403
      ** feature is installed                                             142403
      *                                                                   142403
     C                     CALL 'AOSARDR0'                                142403
     C                     PARM *BLANKS   P@RTCD  7                       142403
     C                     PARM '*KEY   ' P@OPTN  7                       142403
     C                     PARM 'CLE007'  P@SARD  6                       142403
     C           SCSARD    PARM SCSARD    DSFDY                           142403
      *                                                                   142403
     C           P@RTCD    IFEQ *BLANKS                                   142403
     C                     MOVE 'Y'       CLE007  1                       142403
     C                     ELSE                                           142403
     C                     MOVE 'N'       CLE007                          142403
      *                                                                   142403
     C           P@RTCD    IFNE '*NRF    '                                142403
     C           *LOCK     IN   LDA                                       142403
     C                     MOVEL'MG0202  'DBPGM                           142403
     C                     MOVEL'SCSARDPD'DBFILE           ************   142403
     C                     Z-ADD29        DBASE            * DBERR 29 *   142403
     C                     MOVEL'CLE007'  DBKEY     P      ************   142403
     C                     OUT  LDA                                       142403
     C                     EXSR *PSSR                                     142403
     C                     ENDIF                                          142403
      *                                                                   142403
     C                     ENDIF                                          142403
      *
      ** Determine if Swift decimal places feature is installed           CSW020
      *                                                                   CSW020
     C                     CALL 'AOSARDR0'                                CSW020
     C                     PARM *BLANKS   P@RTCD  7                       CSW020
     C                     PARM '*KEY   ' P@OPTN  7                       CSW020
     C                     PARM 'CSW020'  P@SARD  6                       CSW020
     C           SCSARD    PARM SCSARD    DSFDY                           CSW020
      *                                                                   CSW020
     C           P@RTCD    IFEQ *BLANKS                                   CSW020
     C                     MOVE 'Y'       CSW020  1                       CSW020
     C                     ELSE                                           CSW020
     C                     MOVE 'N'       CSW020                          CSW020
      *                                                                   CSW020
     C           P@RTCD    IFNE '*NRF    '                                CSW020
     C           *LOCK     IN   LDA                                       CSW020
     C                     MOVEL'MG0210  'DBPGM                           CSW020
     C                     MOVEL'SCSARDPD'DBFILE           ************   CSW020
     C                     Z-ADD26        DBASE            * DBERR 26 *   CSW020
     C                     MOVEL'CSW020'  DBKEY     P      ************   CSW020
     C                     OUT  LDA                                       CSW020
     C                     EXSR *PSSR                                     CSW020
     C                     ENDIF                                          CSW020
      *                                                                   CSW020
     C                     ENDIF                                          CSW020
     C/COPY WNCPYSRC,MG0210C038
      *                                                                   CSW020
      ** Check if SWIFT 2001 enhancement is installed                                         CSW201
      *                                                                                       CSW201
     C                     CALL 'SWIF2001'                                                    CSW201
     C                     PARM *BLANKS   @RTCD                                               CSW201
      *                                                                                       CSW201
     C           @RTCD     IFEQ 'CSW2001'                                                     CSW201
     C                     MOVEL'Y'       CSW201  1                                           CSW201
     C                     MOVEL'Y'       ZDBEI                                               CSW201
     C                     ELSE                                                               CSW201
     C                     MOVEL'N'       CSW201                                              CSW201
     C                     MOVE *BLANK    ZDBEI                                               CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW025
      ** Is CSW025 installed?                                                                 CSW025
      *                                                                                       CSW025
     C                     CALL 'AOSARDR0'                                                    CSW025
     C                     PARM '       ' @RTCD                                               CSW025
     C                     PARM '*VERIFY' @OPTN                                               CSW025
     C                     PARM 'CSW025'  @SARD                                               CSW025
     C           @RTCD     IFNE *BLANK                                                        CSW025
     C           @RTCD     ANDNE'*NRF   '                                                     CSW025
     C                     MOVEL'SCSARDPD'DBFILE                                              CSW025
     C                     MOVEL'031'     DBASE                                               CSW025
     C                     MOVEL@RTCD     DBKEY                                               CSW025
     C                     MOVE *ON       *INU7                                               CSW025
     C                     MOVE *ON       *INU8                                               CSW025
     C                     EXSR *PSSR                                                         CSW025
     C                     ENDIF                                                              CSW025
     C           @RTCD     IFEQ *BLANK                                                        CSW025
     C                     MOVE 'Y'       CSW025  1                                           CSW025
     C                     ENDIF                                                              CSW025
      *                                                                                       242622
      ** Is CSW050 installed?                                                                 242622
      *                                                                                       242622
     C                     CALL 'AOSARDR0'                                                    242622
     C                     PARM '       ' @RTCD                                               242622
     C                     PARM '*VERIFY' @OPTN                                               242622
     C                     PARM 'CSW050'  @SARD                                               242622
     C           @RTCD     IFNE *BLANK                                                        242622
     C           @RTCD     ANDNE'*NRF   '                                                     242622
     C                     MOVEL'SCSARDPD'DBFILE                                              242622
     C                     MOVEL'034'     DBASE                                               242622
     C                     MOVEL@RTCD     DBKEY                                               242622
     C                     MOVE *ON       *INU7                                               242622
     C                     MOVE *ON       *INU8                                               242622
     C                     EXSR *PSSR                                                         242622
     C                     ENDIF                                                              242622
     C           @RTCD     IFEQ *BLANK                                                        242622
     C                     MOVE 'Y'       CSW050  1                                           242622
     C                     MOVE 'Y'       FL21TR                                              242622
     C                     ENDIF                                                              242622
      *                                                                                       CSW202
      ** Check if Midas Compliance Watch (CSD015) is installed                                CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY '@OPTN                                               CSD015
     C                     PARM 'CSD015'  @SARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
      ** An NRF (No Record Found) return code is valid.                                       CSD015
      ** Issue database error only for error return codes.                                    CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'CSD015'  DBKEY                                               CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     Z-ADD33        DBASE                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSD015  1                                           CSD015
      *                                                                                       222385
      ** Access AOWLCCR0 to check if function code MESSGENT is available                      222385
      *                                                                                       222385
     C                     CALL 'AOWLCCR0'                                                    222385
     C                     PARM *BLANKS   @RTCD                                               222385
     C                     PARM '*KEY'    @OPTN                                               222385
     C                     PARM 'MESSGENT'PFUNC   8                                           222385
     C           SDWLCC    PARM SDWLCC    DSFDY                                               222385
      *                                                                                       222385
     C           @RTCD     IFNE *BLANKS                                                       222385
     C           @RTCD     ANDNE'*NRF'                                                        222385
     C                     MOVEL'SDWLCCPD'DBFILE                                              222385
     C                     MOVELPFUNC     DBKEY                                               222385
     C                     Z-ADD32        DBASE                                               222385
     C                     EXSR *PSSR                                                         222385
     C                     ENDIF                                                              222385
      *                                                                                       222385
     C                     ELSE                                                               CSD015
     C                     MOVEL'N'       W1EWLC                                              222385
     C                     MOVE 'N'       CSD015                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Check if CSW202 is installed                                                         CSW202
      *                                                                                       CSW202
     C                     CALL 'SWIF2002'                                                    CSW202
     C                     PARM *BLANKS   PRTCD                                               CSW202
      *                                                                                       CSW202
     C           PRTCD     IFEQ 'CSW2002'                                                     CSW202
     C                     MOVE 'Y'       CSW202  1                                           CSW202
     C                     ELSE                                                               CSW202
     C                     MOVE 'N'       CSW202                                              CSW202
     C                     ENDIF                                                              CSW202
      *                                                                                       CSW201
      ** Check if SWIFT 2007 enhancement is installed                                         CSW207
      *                                                                                       CSW207
     C                     CALL 'SWIF2007'                                                    CSW207
     C                     PARM *BLANKS   @RTCD                                               CSW207
      *                                                                                       CSW207
     C           @RTCD     IFEQ 'CSW2007'                                                     CSW207
     C                     MOVE 'Y'       CSW207  1                                           CSW207
     C                     ELSE                                                               CSW207
     C                     MOVE 'N'       CSW207                                              CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       162270
      ***Access*SAR*Details*file*to*determine*if*BCY001*installed                     162270 162270A
      ** Access SAR Details file to determine if CSE099 installed                            162270A
      *                                                                                       162270
     C                     CALL 'AOSARDR0'                                                    162270
     C                     PARM '       ' @RTCD                                               162270
     C                     PARM '*VERIFY' @OPTN                                               162270
     C*********************PARM 'BCY001'  @SARD   6                                   162270 162270A
     C                     PARM 'CSE099'  @SARD   6                                          162270A
     C           SCSARD    PARM SCSARD    DSFDY                                               162270
     C           @RTCD     IFNE *BLANK                                                        162270
     C           @RTCD     ANDNE'*NRF   '                                                     162270
     C                     MOVEL'SCSARDPD'DBFILE           **************                     162270
     C                     MOVEL'035'     DBASE            * DBERROR 025*                     162270
     C                     MOVEL@RTCD     DBKEY            **************                     162270
     C                     SETON                     U7U8                                     162270
     C                     EXSR *PSSR                                                         162270
     C                     END                                                                162270
     C           @RTCD     IFEQ *BLANK                                                        162270
     C*********************MOVE 'Y'       BCY001  1                                   162270 162270A
     C                     MOVE 'Y'       CSE099  1                                          162270A
     C                     ELSE                                                               162270
     C*********************MOVE 'N'       BCY001                                      162270 162270A
     C                     MOVE 'N'       CSE099                                             162270A
     C                     ENDIF                                                              162270
      *                                                                                       248359
      ** Check if feature CSW003 is present                                                   248359
      *                                                                                       248359
     C                     CALL 'AOSARDR0'                                                    248359
     C                     PARM '       ' @RTCD                                               248359
     C                     PARM '*VERIFY' @OPTN                                               248359
     C                     PARM 'CSW003'  @SARD   6                                           248359
     C           SCSARD    PARM SCSARD    DSFDY                                               248359
     C           @RTCD     IFNE *BLANK                                                        248359
     C           @RTCD     ANDNE'*NRF   '                                                     248359
     C                     MOVEL'SCSARDPD'DBFILE           ***************                    248359
     C                     MOVEL'036'     DBASE            * DBERROR 036 *                    248359
     C                     MOVEL@RTCD     DBKEY            ***************                    248359
     C                     SETON                     U7U8                                     248359
     C                     EXSR *PSSR                                                         248359
     C                     ENDIF                                                              248359
      *                                                                                       248359
     C           @RTCD     IFEQ *BLANK                                                        248359
     C                     MOVE 'Y'       CSW003  1                                           248359
     C                     ELSE                                                               248359
     C                     MOVE 'N'       CSW003                                              248359
     C                     ENDIF                                                              248359
      *                                                                                       248359
      **  Initialise constant fields
     C                     MOVE *LOVAL    CR      1
     C                     BITON'457'     CR
     C                     MOVE *LOVAL    LF      1
     C                     BITON'257'     LF
     C                     MOVELCR        CRLF    2
     C                     MOVE LF        CRLF
     C                     MOVE *BLANKS   @TR4
     C                     MOVE ':'       COLON1
     C                     MOVE ':'       COLON2
      *
      **  CRLF Control Character for message data records
     C                     MOVE CRLF      CTRC
      *
      **  Convert run date to YYMMDD, for Message Generation Date
     C                     CALL 'ZM0060'               15
     C                     PARM BJRDNB    ZMDAY   50
     C                     PARM           ZMDATE  6
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '003'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 003  *
     C                     MOVEL'ZM0060'  DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     MOVE ZMDATE    MGDE
      *                                                                   113352
      ** Set-up Message Generation  Century flag                          113352
      *                                                                   113352
     C                     MOVELMGDE      YY      20                      113352
     C           YY        IFLT 72                                        113352
     C                     MOVE '2'       CIND                            113352
     C                     ELSE                                           113352
     C                     MOVE '1'       CIND                            113352
     C                     ENDIF                                          113352
      *                                                                   S01408
     C/COPY WNCPYSRC,MG0210CCP1                                           S01408
      *                                                                   S01408
      *
      **  Initialise HEADER AND TRAILER parts of a SWIFT message
      **  to the maximum bytes that may be required
     C                     Z-ADD1920      TBYTES  40
     C                     Z-ADD64        HDBYTE  20
     C                     Z-ADD16        TRBYTE  20
     C/COPY WNCPYSRC,MG0210C030
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   INTF - Initalise non-constant fields                        *
      *   Called by - main process                                    *
      *   Calls     -                                                 *
      *****************************************************************
      *
     C           INTF      BEGSR
      *
     C                     MOVE *BLANKS   TRNO
     C                     MOVE *BLANKS   TRNF
     C                     MOVE *BLANKS   TRNM
     C                     MOVE *BLANKS   MTPY
     C                     MOVE *BLANKS   NWRK
     C**********           Z-ADD0         SECN                                                CSD027
     C                     MOVE *BLANKS   SECN                                                CSD027
     C                     MOVE *BLANKS   NWSN
     C**********           Z-ADD0         DECN                                                CSD027
     C                     MOVE *BLANKS   DECN                                                CSD027
     C                     MOVE *BLANKS   NWDS
     C                     MOVE *BLANKS   MGSG
     C                     MOVE *BLANKS   MGST
     C                     MOVE *BLANKS   LSCC
     C                     MOVE *BLANKS   F57U
     C                     Z-ADD0         MGTM
     C                     Z-ADD0         LATM
     C                     MOVE *BLANKS   RELD
     C                     Z-ADD0         RELT
     C                     MOVE *BLANKS   AMTX
     C                     MOVE *BLANKS   AMTS
     C                     MOVE *BLANKS   SVDT
     C                     MOVE *BLANKS   CINDV                           141572
     C                     MOVE *BLANKS   CCY
     C                     MOVE *BLANKS   NSNO
     C                     Z-ADD0         AVDT                            E29588
     C                     Z-ADD0         ASEQ                            E29588
      *
     C                     MOVE *BLANKS   @TRN
     C                     MOVE *BLANKS   @ERR    1
      *
      **  Save fields for Destination and Sender customer information
      *
     C                     MOVE *BLANKS   DTELX  10
     C                     MOVE *BLANKS   DSTTX  12
     C                     MOVE *BLANKS   DCRNM  20
     C                     MOVE *BLANKS   DPCNB   6
     C                     MOVE *BLANKS   DPAIN   1
      *
     C                     MOVE *BLANKS   SCSID  12
     C                     MOVE *BLANKS   STELX  10
     C                     MOVE *BLANKS   SSTTX  12
     C                     MOVE *BLANKS   SCRNM  20
     C                     MOVE *BLANKS   SPCNB   6
     C                     MOVE *BLANKS   SPAIN   1
      *
      **  Restore bytes field for new message
      *
     C                     Z-ADDTBYTES    BYTES   40
     C                     SUB  HDBYTE    BYTES
     C                     SUB  TRBYTE    BYTES
      *
     C                     Z-ADD0         BYTRMV
     C                     MOVE 'N'       RANOUT  1
     C                     MOVE 'N'       MATCH   1
     C/COPY WNCPYSRC,MG0210C050
     C                     Z-ADD0         PARTS   20
     C                     Z-ADD1         TC      10                      090915
      *
      **  Convert history retention date to YYMMDD
     C           MGVDAT    ADD  ENDSMN    ZMDAY
     C                     CALL 'ZM0060'               15
     C                     PARM           ZMDAY
     C                     PARM           ZMDATE
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '005'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 005  *
     C                     MOVEL'ZM0060'  DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     MOVE ZMDATE    @HRDT   6
      *
      **  Clear multiple occurrence data structures
     C                     Z-ADD1         X       20
     C           X         OCUR MULT
      *
     C           X         DOWLE65
     C           MULT      ANDNE*BLANKS
     C                     MOVE *BLANKS   MULT
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
      *                                                                   183583
      ** Clear multiple occurrence DS for the extension file.             183583
      *                                                                   183583
     C                     Z-ADD1         V       20                      183583
     C           V         OCUR EXTN                                      183583
     C           V         DOWLE45                                        183583
     C           MCSI      ANDNE*BLANKS                                   183583
     C                     Z-ADD*ZEROS    MPSN                            183583
     C                     MOVE *BLANKS   MTG                             183583
     C                     MOVE *BLANKS   MCSI                            183583
     C                     ADD  1         V                               183583
     C           V         OCUR EXTN                                      183583
     C                     ENDDO                                          183583
     C                     Z-ADD0         V                               183583
      *
     C                     Z-ADD0         X
      *
      **  11th REF210 record always blank; Used as the TRN of the
      **  next part for the 10th part of a MT210. 11th PART used
      **  for blank fields for the header reference record for a
      **  multiple MT210 message.
      *
     C           X         DOWLT11
     C                     ADD  1         X
     C           X         OCUR REF210
     C           X         OCUR PART
     C                     MOVE *BLANKS   REF210
     C                     MOVE *BLANKS   PART
     C                     END
      *
      ** If the branch code on the file MGF320PD is blank,                082906
      ** then default it to the branch code on the SDBRCHPD               082906
      *                                                                   082906
     C           MGBRCA    IFEQ *BLANKS                                   082906
     C                     MOVELA8BRCD    MGBRCA                          082906
     C                     END                                            082906
      ** If our receive branch is blank then default it to the            082906
      ** branch code                                                      082906
      *                                                                   082906
     C           MGROBR    IFEQ *BLANKS                                   082906
     C                     MOVELMGBRCA    MGROBR                          082906
     C                     END                                            082906
      *                                                                   CSW020
      * Check if change required for swift decimal places                 CSW020
     C           CSW020    IFEQ 'Y'                                       CSW020
     C                     MOVE ' '       WCHGRQ  1                       CSW020
     C                     CALL 'AOCURRR0'                                CSW020
     C                     PARM *BLANKS   @RTCD   7                       CSW020
     C                     PARM '*KEY'    @OPTN   7                       CSW020
     C                     PARM MGCCY     @CCY    3                       CSW020
     C           SDCURR    PARM SDCURR    DSSDY                           CSW020
      *                                                                   CSW020
      ** To deal with data base errors.                                   CSW020
      *                                                                   CSW020
     C           @RTCD     IFNE *BLANKS                                   CSW020
     C           *LOCK     IN   LDA                                       CSW020
     C                     MOVE '027'     DBASE            * * * * * * * *CSW020
     C                     MOVELMGCCY     DBKEY            *  DBERR 027  *CSW020
     C                     MOVEL'SDCURRPD'DBFILE           * * * * * * * *CSW020
     C                     OUT  LDA                                       CSW020
     C                     EXSR *PSSR                                     CSW020
     C                     ENDIF                                          CSW020
      *                                                                   CSW020
     C           A6SWDP    IFNE A6NBDP                                    CSW020
     C           A6SWDT    ANDLERDNB                                      CSW020
      *                                                                   CSW020
     C           A6SWDP    IFLT A6NBDP                                    CSW020
     C           A6NBDP    SUB  A6SWDP    WDIFF   10                      CSW020
      * Set Change required field to Yes                                  CSW020
     C                     MOVE 'Y'       WCHGRQ                          CSW020
     C                     ELSE                                           CSW020
     C           A6SWDP    SUB  A6NBDP    WDIFF                           CSW020
     C                     ENDIF                                          CSW020
      *                                                                   CSW020
     C           WDIFF     IFEQ 1                                         CSW020
     C                     Z-ADD10        WPOWER  40                      CSW020
     C                     ENDIF                                          CSW020
     C           WDIFF     IFEQ 2                                         CSW020
     C                     Z-ADD100       WPOWER                          CSW020
     C                     ENDIF                                          CSW020
     C           WDIFF     IFEQ 3                                         CSW020
     C                     Z-ADD1000      WPOWER                          CSW020
     C                     ENDIF                                          CSW020
      *                                                                   CSW020
     C                     ENDIF                                          CSW020
     C                     ENDIF                                          CSW020
      *                                                                   082906
     C                     ENDSR
     C/EJECT
      *****************************************************************
      ****ROUT*-*determine*message*routing*****************************   CSW096
      ****Called*by***Main*process*************************************   CSW096
      ****Calls*******NWAD**determine*default*network*addresse*********   CSW096
      ****************PRAD**determine*priority*network*addresse********   CSW096
      ****************FILL**fill*up*array*GNR**************************   CSW096
      *****************************************************************   CSW096
      ***********                                                         CSW096
     C***********ROUT      BEGSR                                          CSW096
      ***********                                                         CSW096
      ****Access*SDBRCHPD*using*branch*code*******************************CSW096
     C***********          CALL 'AOBRCHR0'                                CSW096
     C***********          PARM '*MSG   ' @RTCD                           CSW096
     C***********          PARM '*KEY   ' @OPTN                           CSW096
     C***********          PARM MGROBR    @BRCD   3                       CSW096
     C***********SDBRCH    PARM SDBRCH    DSSDY                           CSW096
      ***********                                                         CSW096
      ***Branch*record*not*found*-*Error**********************************CSW096
     C***********@RTCD     IFNE *BLANKS                                   CSW096
     C************LOCK     IN   LDA                                       CSW096
     C***********          MOVE '006'     DBASE            * * * * * * * *CSW096
     C***********          MOVELMGROBR    DBKEY            *  DBERR 006  *CSW096
     C***********          MOVEL'SDBRCHPD'DBFILE           * * * * * * * *CSW096
     C***********          OUT  LDA                                       CSW096
     C***********          EXSR *PSSR                                     CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      *****save*branch*internal*customer*number*&*SWIFT*TID*address*******CSW096
     C***********          MOVELA8BICN    SECN                            CSW096
     C***********          MOVE A8BTID    SCSID                           CSW096
      ***********                                                         CSW096
      ****Access*SDCUSTPD*using*branch*internal*customer*number***********CSW096
     C***********          MOVE *BLANKS   @KEY1                           CSW096
     C***********          MOVELSECN      @KEY1                           CSW096
     C***********          CALL 'AOCUSTR0'                                CSW096
     C***********          PARM '*MSG   ' @RTCD                           CSW096
     C***********          PARM '*KEY   ' @OPTN                           CSW096
     C***********          PARM           @KEY1  10                       CSW096
     C***********          PARM *BLANKS   @KYST   7                       CSW096
     C***********SDCUST    PARM SDCUST    DSSDY                           CSW096
      ***********                                                         CSW096
      ***Customer*record*not*found*-*Error********************************CSW096
     C***********@RTCD     IFNE *BLANKS                                   CSW096
     C************LOCK     IN   LDA                                       CSW096
     C***********          MOVE '007'     DBASE            * * * * * * * *CSW096
     C***********          MOVEL@KEY1     DBKEY            *  DBERR 007  *CSW096
     C***********          MOVEL'SDCUSTPD'DBFILE           * * * * * * * *CSW096
     C***********          OUT  LDA                                       CSW096
     C***********          EXSR *PSSR                                     CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****Save*sender's*addresses*&*parent*customer*number****************CSW096
      ***********                                                         CSW096
     C***********          MOVE BBTXA1    STELX                           CSW096
     C***********          MOVE BBSTAD    SSTTX                           CSW096
     C***********          MOVE BBCRNM    SCRNM                           CSW096
     C***********          MOVE BBPCNB    SPCNB                           CSW096
     C***********          MOVE BBPAIN    SPAIN                           CSW096
      ***********                                                         CSW096
      ****Access*SDCUSTPD*using*destination*customer*number***************CSW096
      ***********                                                         CSW096
     C***********          MOVE *BLANKS   @KEY1                           CSW096
     C***********          MOVELMGDEST    @KEY1                           CSW096
     C***********          CALL 'AOCUSTR0'                                CSW096
     C***********          PARM '*MSG   ' @RTCD                           CSW096
     C***********          PARM '*KEY   ' @OPTN                           CSW096
     C***********          PARM           @KEY1  10                       CSW096
     C***********          PARM *BLANKS   @KYST   7                       CSW096
     C***********SDCUST    PARM SDCUST    DSSDY                           CSW096
      ****Error***********************************************************CSW096
     C***********          MOVE MGDEST    DECN                            CSW096
     C***********          MOVE *BLANKS   DSERR  50                       CSW096
     C***********@RTCD     IFNE *BLANKS                                   CSW096
     C***********          MOVE 'Y'       @ERR                            CSW096
     C***********          MOVELMSGA,2    DSERR                           CSW096
     C***********          MOVELSCRNM     NWSN                            CSW096
      ***********                                                         CSW096
     C***********          ELSE                                           CSW096
      ***********                                                         CSW096
      ****To*check*'BIC'*in*SWIFT*address*********************************CSW096
     C***********          MOVE BBCSID    CSID                            CSW096
      ***********                                                         CSW096
      ****Use*default*network*if*entered;**Else**use*priorities***********CSW096
      ***********                                                         CSW096
     C***********BBDNW2    IFNE *BLANKS                                   CSW096
     C***********          EXSR NWAD                                      CSW096
     C***********          ELSE                                           CSW096
     C***********          EXSR PRAD                                      CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****Fill*up*the*appropriate*array*information*from*PF/SDCUSTPD******CSW096
     C***********          EXSR FILL                                      CSW096
      ***********                                                         CSW096
      ****Is*default*status*for*an*MT210*message*released*?***************CSW096
      ****Check*only*if*status*not*already*determined*********************CSW096
      ***********                                                         CSW096
     C***********MGST      IFEQ *BLANKS                                   CSW096
      ***********                                                         CSW096
     C***********'210'     LOKUPGNR                      19               CSW096
     C***********'21*'     LOKUPGNR                      20               CSW096
     C***********'2**'     LOKUPGNR                      21               CSW096
      ***********                                                         CSW096
     C************IN19     IFEQ '1'                                       CSW096
     C************IN20     OREQ '1'                                       CSW096
     C************IN21     OREQ '1'                                       CSW096
     C***********          MOVE 'RSND'    MGST                            CSW096
     C***********          MOVE '2'       MGSG                            CSW096
     C***********          ELSE                                           CSW096
     C***********          MOVE 'CRTD'    MGST                            CSW096
     C***********          MOVE '1'       MGSG                            CSW096
     C***********          END                                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****Save*fields*required*for*the*match*criteria*of*MT210's**********CSW096
      ***********                                                         CSW096
     C***********          MOVELMGMODI    KMODI   2                       CSW096
     C***********          MOVELMGDEST    KDEST   60                      CSW096
     C***********          MOVELMGROBR    KROBR   3                       CSW096
     C***********          MOVELMGVDAT    KVDAT   50                      CSW096
     C***********          MOVELMGCCY     KCCY    3                       CSW096
     C***********          MOVELMGSETP    KSETP   20                      CSW096
      ***********                                                         CSW096
     C***********          ENDSR                                          CSW096
     C/EJECT                                                              CSW096
      *****************************************************************   CSW096
      *   SRROUT - determine message routing                          *   CSW096
      *   Called by - main process                                    *   CSW096
      *   Calls -                                                     *   CSW096
      *****************************************************************   CSW096
      *                                                                   CSW096
     C           SRROUT    BEGSR                                          CSW096
      *                                                                   CSW096
     C/COPY WNCPYSRC,MG0210C003
     C                     MOVE MGROBR    I@SNBR                          CSW096
     C/COPY WNCPYSRC,MG0210C004
     C                     MOVE *BLANKS   I@DSCN                          CSW096
     C                     MOVE MGDEST    I@DSCN                          CSW096
     C                     MOVE '210'     I@MTPY                          CSW096
     C                     MOVE 'N'       I@CONC                          CSW096
     C                     Z-ADDMGSETP    I@SETT                          CSW096
     C                     MOVE *BLANK    I@FTCS                          CSW096
     C                     MOVE MGMODI    I@MMOD                          CSW096
      *###################################################################CSW096
      *                                                                  #CSW096
      * Below are two copy sources intended for setting up the custom    #CSW096
      * parameter (P@ZZ) in the call to MG9900.                          #CSW096
      * One (MG9900CALL) is in ALL MG generation programs and is for use #CSW096
      * when a change is required to all of them.                        #CSW096
      * The other is only in this program.                               #CSW096
     C/COPY WNCPYSRC,MG9900CALL                                          #CSW096
     C/COPY WNCPYSRC,MG0210ROUT                                          #CSW096
      *                                                                  #CSW096
      *###################################################################CSW096
     C                     CALL 'MG9900'                                  CSW096
     C                     PARM *BLANKS   @RTCD                           CSW096
     C                     PARM           P@IN                            CSW096
     C                     PARM *BLANKS   P@OUT                           CSW096
     C                     PARM           P@ZZ  256                       CSW096
      *                                                                   CSW096
     C           @RTCD     IFNE *BLANKS                                   CSW096
     C           *LOCK     IN   LDA                                       CSW096
     C                     MOVE '092'     DBASE              * * * * * * *CSW096
     C                     MOVEL'*CALL  ' DBKEY              * DBERR 092 *CSW096
     C                     MOVEL'MG9900'  DBFILE             * * * * * * *CSW096
     C                     OUT  LDA                                       CSW096
     C                     EXSR *PSSR                                     CSW096
     C                     ELSE                                           CSW096
     C                     MOVE O@NWRK    NWRK                            CSW096
     C**********           Z-ADDO@CNSN    SECN                                         CSW096 CSD027
     C                     MOVE O@CNSN    SECN                                                CSD027
     C                     MOVE O@NWSN    NWSN                            CSW096
     C**********           Z-ADDMGDEST    DECN                                         CSW096 CSD027
     C                     MOVE MGDEST    DECN                                                CSD027
     C                     MOVE O@NWDS    NWDS                            CSW096
     C                     MOVE O@MGSG    MGSG                            CSW096
     C                     MOVE O@MGST    MGST                            CSW096
     C                     MOVE O@PCNB    SPCNB                           CSW096
     C                     MOVE O@PAIN    SPAIN                           CSW096
     C                     END                                            CSW096
      *                                                                   CSW096
      **  Save fields required for the match criteria of MT210's          CSW096
      *                                                                   CSW096
     C                     MOVELMGMODI    KMODI   2                       CSW096
     C**********           MOVELMGDEST    KDEST   60                                   CSW096 CSD027
     C                     MOVELMGDEST    KDEST   6                                           CSD027
     C                     MOVELMGROBR    KROBR   3                       CSW096
     C                     MOVELMGVDAT    KVDAT   50                      CSW096
     C                     MOVELMGCCY     KCCY    3                       CSW096
     C                     MOVELMGSETP    KSETP   20                      CSW096
      *                                                                                       162270
     C***********BCY001    IFEQ 'Y'                                                   162270 162270A
     C           CSE099    IFEQ 'Y'                                                          162270A
     C           MGMODI    IFEQ 'SE'                                                          162270
     C           MGRIBN    ANDNE*BLANKS                                                       162270
     C                     EXSR SRACID                                                        162270
     C                     MOVE WACID     KACID  11                                           162270
     C                     END                                                                162270
     C                     ENDIF                                                              162270
      *                                                                                       162270
      *                                                                   CSW096
     C/COPY WNCPYSRC,MG0210C018
     C                     ENDSR                                          CSW096
     C/EJECT                                                              CSW096
      *****************************************************************   CSW096
      ****FILL*-*Fill*up*arrays*GNR*and*MNG****************************   CSW096
      ****Called*by***ROUT**determine*message*routing******************   CSW096
      ****Calls*******-************************************************   CSW096
      *****************************************************************   CSW096
      ***********                                                         CSW096
     C***********FILL      BEGSR                                          CSW096
      ***********                                                         CSW096
      ****Is*message*to*be*generated*as*released*?************************CSW096
      ***********                                                         CSW096
     C***********          MOVE BBDS01    GNR,1                           CSW096
     C***********          MOVE BBDS02    GNR,2                           CSW096
     C***********          MOVE BBDS03    GNR,3                           CSW096
     C***********          MOVE BBDS04    GNR,4                           CSW096
     C***********          MOVE BBDS05    GNR,5                           CSW096
     C***********          MOVE BBDS06    GNR,6                           CSW096
     C***********          MOVE BBDS07    GNR,7                           CSW096
     C***********          MOVE BBDS08    GNR,8                           CSW096
     C***********          MOVE BBDS09    GNR,9                           CSW096
     C***********          MOVE BBDS10    GNR,10                          CSW096
     C***********          MOVE BBDS11    GNR,11                          CSW096
     C***********          MOVE BBDS12    GNR,12                          CSW096
     C***********          MOVE BBDS13    GNR,13                          CSW096
     C***********          MOVE BBDS14    GNR,14                          CSW096
     C***********          MOVE BBDS15    GNR,15                          CSW096
      ***********                                                         CSW096
     C***********          ENDSR                                          CSW096
     C*/EJECT****                                                         CSW096
      *****************************************************************   CSW096
      ****NWAD*-*determine*default*network*address*********************   CSW096
      ****Called*by***ROUT**determine*message*routing******************   CSW096
      ****Calls*******-************************************************   CSW096
      *****************************************************************   CSW096
      ***********                                                         CSW096
     C***********NWAD      BEGSR                                          CSW096
      ***********                                                         CSW096
      ****Default*is*SWIFT************************************************CSW096
     C***********BBDNW2    IFEQ 'SWIFT'                                   CSW096
     C***********@BIC      ANDNE'BIC'                                     CSW096
     C***********BGMSDL    ANDEQ'Y'                                       CSW096
     C***********          MOVELSCSID     NWSN                            CSW096
     C***********          MOVELBBCSID    NWDS                            CSW096
     C***********          MOVELBBDNW2    NWRK                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****Default*is*TELEX************************************************CSW096
     C***********BBDNW2    IFEQ 'TELEX'                                   CSW096
     C***********BGMTMI    ANDEQ'Y'                                       CSW096
     C***********          MOVELSTELX     NWSN                            CSW096
     C***********          MOVELBBTXA1    NWDS                            CSW096
     C***********          MOVELBBDNW2    NWRK                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****Default*is*STTX*************************************************CSW096
     C***********BBDNW2    IFEQ 'STTX '                                   CSW096
     C***********BGMSDL    ANDEQ'Y'                                       CSW096
     C***********          MOVELSSTTX     NWSN                            CSW096
     C***********          MOVELBBSTAD    NWDS                            CSW096
     C***********          MOVELBBDNW2    NWRK                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****Default*is*PAPER************************************************CSW096
      ***********                                                         CSW096
     C***********BBDNW2    IFEQ 'PAPER'                                   CSW096
     C***********          MOVEL'PAPER'   NWRK                            CSW096
     C***********          MOVELSCRNM     NWSN                            CSW096
     C***********          MOVELBBCRNM    NWDS                            CSW096
      ***********                                                         CSW096
      ****If*the*ICD*option*for*free*format*advices*is*'Y'*the************CSW096
      ****message*has*already*been*printed*,*hence*no*further*************CSW096
      ****print*out*is*needed.********************************************CSW096
     C***********ENFFAR    IFEQ 'Y'                                       CSW096
     C***********          MOVEL'PRTD'    MGST                            CSW096
     C***********          MOVE '3'       MGSG                            CSW096
     C***********          ELSE                                           CSW096
     C***********          MOVEL'RSND'    MGST                            CSW096
     C***********          MOVE '2'       MGSG                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****Found*to*be*unroutable******************************************CSW096
      ***********                                                         CSW096
     C***********NWRK      IFEQ *BLANKS                                   CSW096
     C***********NWDS      OREQ *BLANKS                                   CSW096
     C***********NWSN      OREQ *BLANKS                                   CSW096
     C***********          MOVEL'UNROUT'  NWRK                            CSW096
     C***********          MOVELSCRNM     NWSN                            CSW096
     C***********          MOVELBBCRNM    NWDS                            CSW096
     C***********          MOVEL'CRTD'    MGST                            CSW096
     C***********          MOVE '1'       MGSG                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          ENDSR                                          CSW096
     C*/EJECT****                                                         CSW096
      *****************************************************************   CSW096
      ****PRAD*-*determine*settlement*network*address******************   CSW096
      ****Called*by*-*ROUT*determine*message*routing*******************   CSW096
      ****Calls*******-************************************************   CSW096
      *****************************************************************   CSW096
      ***********                                                         CSW096
     C***********PRAD      BEGSR                                          CSW096
      ***********                                                         CSW096
      ****Set*up*priority*sender,*destination*&*network*******************CSW096
      ***********                                                         CSW096
      ****'S'*=*SWIFT;*'T'*=*TELEX;*'X'*=*STTX****************************CSW096
      ***********                                                         CSW096
      *********************(1)**(2)**(3)**(4)**(5)**(6)**(7)**************CSW096
      ****---------------------------------------------------*************CSW096
      ****SWIFT*ADDRESS    Y   N   N   Y   Y   Y   Y              CSW096
      ****TELEX*ADDRESS    N   Y   N   Y   Y   N   N              CSW096
      ****STTX*ADDRESS     N   N   Y   N   N   Y   Y              CSW096
      ****SETT.*TYPE                  01  08  01  08              CSW096
      ****---------------------------------------------------             CSW096
      ****DESTN*= BBCSID   X               X       X              CSW096
      ****DESTN*= BBTXA1       X       X                          CSW096
      ****DESTN*= BBSTAD           X           X                  CSW096
      ****---------------------------------------------------             CSW096
      ****NETWORK                                                 CSW096
      ****(NWRK)           S   T   X   T   S   X   S              CSW096
      ***********                                                         CSW096
      ****SWIFT*?*********************************************************CSW096
      ****(1)*************************************************************CSW096
     C***********BGMSDL    IFEQ 'Y'                                       CSW096
     C***********SCSID     ANDNE*BLANKS                            E27567 CSW096
      ***********                                                         CSW096
     C***********BBCSID    IFNE *BLANKS                                   CSW096
     C***********BBTXA1    ANDEQ*BLANKS                                   CSW096
     C***********BBSTAD    ANDEQ*BLANKS                                   CSW096
      ****(5)*************************************************************CSW096
     C***********BBCSID    ORNE *BLANKS                                   CSW096
     C***********BBTXA1    ANDNE*BLANKS                                   CSW096
     C***********BBSTAD    ANDEQ*BLANKS                                   CSW096
     C***********MGSETP    ANDEQ08                                        CSW096
      ****(7)*************************************************************CSW096
     C***********BBCSID    ORNE *BLANKS                                   CSW096
     C***********BBTXA1    ANDEQ*BLANKS                                   CSW096
     C***********BBSTAD    ANDNE*BLANKS                                   CSW096
     C***********MGSETP    ANDEQ08                                        CSW096
      ***********                                                         CSW096
     C***********          MOVELSCSID     NWSN                            CSW096
     C***********          MOVELBBCSID    NWDS                            CSW096
     C***********          MOVE 'SWIFT '  NWRK                            CSW096
     C***********          END                                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****TELEX*?*********************************************************CSW096
      ****(2)*************************************************************CSW096
     C***********BGMTMI    IFEQ 'Y'                                       CSW096
     C***********STELX     ANDNE*BLANKS                            E27567 CSW096
      ***********                                                         CSW096
     C***********BBCSID    IFEQ *BLANKS                                   CSW096
     C***********BBTXA1    ANDNE*BLANKS                                   CSW096
     C***********BBSTAD    ANDEQ*BLANKS                                   CSW096
      ****(4)*************************************************************CSW096
     C***********BBCSID    ORNE *BLANKS                                   CSW096
     C***********BBTXA1    ANDNE*BLANKS                                   CSW096
     C***********BBSTAD    ANDEQ*BLANKS                                   CSW096
     C***********MGSETP    ANDEQ01                                        CSW096
      ***********                                                         CSW096
     C***********          MOVELSTELX     NWSN                            CSW096
     C***********          MOVELBBTXA1    NWDS                            CSW096
     C***********          MOVE 'TELEX '  NWRK                            CSW096
     C***********          END                                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****STTX*?**********************************************************CSW096
      ****(3)*************************************************************CSW096
      ***********                                                         CSW096
     C***********BGMSDL    IFEQ 'Y'                                       CSW096
     C***********SSTTX     ANDNE*BLANKS                            E27567 CSW096
      ***********                                                         CSW096
     C***********BBCSID    IFEQ *BLANKS                                   CSW096
     C***********BBTXA1    ANDEQ*BLANKS                                   CSW096
     C***********BBSTAD    ANDNE*BLANKS                                   CSW096
      ****(6)*************************************************************CSW096
     C***********BBCSID    ORNE *BLANKS                                   CSW096
     C***********BBTXA1    ANDEQ*BLANKS                                   CSW096
     C***********BBSTAD    ANDNE*BLANKS                                   CSW096
     C***********MGSETP    ANDEQ01                                        CSW096
      ***********                                                         CSW096
     C***********          MOVELSSTTX     NWSN                            CSW096
     C***********          MOVELBBSTAD    NWDS                            CSW096
     C***********          MOVE 'STTX  '  NWRK                            CSW096
     C***********          END                                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****If*network*is*SWIFT*and*if*positions*9-11*of*the****************CSW096
      ****SWIFT*address*are*equal*to*'BIC'********************************CSW096
      ****try*to*route*the*message*via*Telex*or*STTX**********************CSW096
      ***********                                                         CSW096
     C***********NWRK      IFEQ 'SWIFT '                                  CSW096
     C***********@BIC      ANDEQ'BIC'                                     CSW096
      ***********                                                         CSW096
     C***********          MOVE *BLANKS   NWSN                            CSW096
     C***********          MOVE *BLANKS   NWDS                            CSW096
      ***********                                                         CSW096
     C***********BGMTMI    IFEQ 'Y'                                       CSW096
     C***********BBTXA1    ANDNE*BLANKS                                   CSW096
     C***********STELX     ANDNE*BLANKS                            E27567 CSW096
     C***********          MOVELSTELX     NWSN                            CSW096
     C***********          MOVELBBTXA1    NWDS                            CSW096
     C***********          MOVEL'TELEX '  NWRK                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********BGMSDL    IFEQ 'Y'                                       CSW096
     C***********BBSTAD    ANDNE*BLANKS                                   CSW096
     C***********SSTTX     ANDNE*BLANKS                            E27567 CSW096
     C***********          MOVELSSTTX     NWSN                            CSW096
     C***********          MOVELBBSTAD    NWDS                            CSW096
     C***********          MOVE 'STTX  '  NWRK                            CSW096
     C***********          END                                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****Found*to*be*unroutable*(send*via*PAPER)*************************CSW096
      ***********                                                         CSW096
     C***********NWRK      IFEQ *BLANKS                                   CSW096
     C***********NWDS      OREQ *BLANKS                                   CSW096
     C***********NWSN      OREQ *BLANKS                                   CSW096
     C***********          MOVEL'PAPER '  NWRK                            CSW096
     C***********          MOVELSCRNM     NWSN                            CSW096
     C***********          MOVELBBCRNM    NWDS                            CSW096
      ***********                                                         CSW096
      ****If*the*ICD*option*for*free*format*advices*is*'Y'*the************CSW096
      ****message*has*already*been*printed*,*hence*no*further*************CSW096
      ****print*out*is*needed.********************************************CSW096
     C***********ENFFAR    IFEQ 'Y'                                       CSW096
     C***********          MOVEL'PRTD'    MGST                            CSW096
     C***********          MOVE '3'       MGSG                            CSW096
     C***********          ELSE                                           CSW096
     C***********          MOVEL'RSND'    MGST                            CSW096
     C***********          MOVE '2'       MGSG                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          ENDSR                                          CSW096
      ***********                                                         CSW096
     C/EJECT
      *****************************************************************
      *   CHECK - Check matching criteria met for multiple MT210      *
      *   Called by   main process                                    *
      *               MU210  Format multiple MT210 message            *
      *   Calls       -                                               *
      *****************************************************************
      *
     C           CHECK     BEGSR
      *
      **  Determine if matching criteria met for multiple MT210
      *
     C           KMODI     IFEQ MGMODI
     C           KDEST     ANDEQMGDEST
     C           KROBR     ANDEQMGROBR
     C           KVDAT     ANDEQMGVDAT
     C           KCCY      ANDEQMGCCY
     C           KSETP     ANDEQMGSETP
      *
      **** Check that Message Status has not changed either               CSW096
      *                                                                   CSW096
     C                     MOVELO@MGST    KMGST   4                       CSW096
      *                                                                   CSW096
     C/COPY WNCPYSRC,MG0210C005
     C                     MOVE MGROBR    I@SNBR                          CSW096
     C/COPY WNCPYSRC,MG0210C006
     C                     MOVE *BLANKS   I@DSCN                          CSW096
     C                     MOVE MGDEST    I@DSCN                          CSW096
     C                     MOVE '210'     I@MTPY                          CSW096
     C                     MOVE 'N'       I@CONC                          CSW096
     C                     Z-ADDMGSETP    I@SETT                          CSW096
     C                     MOVE *BLANK    I@FTCS                          CSW096
     C                     MOVE MGMODI    I@MMOD                          CSW096
      *###################################################################CSW096
      *                                                                  #CSW096
      * Below are two copy sources intended for setting up the custom    #CSW096
      * parameter (P@ZZ) in the call to MG9900.                          #CSW096
      * One (MG9900CALL) is in ALL MG generation programs and is for use #CSW096
      * when a change is required to all of them.                        #CSW096
      * The other is only in this program.                               #CSW096
     C/COPY WNCPYSRC,MG9900CALL                                          #CSW096
     C/COPY WNCPYSRC,MG0210ROUT                                          #CSW096
      *                                                                  #CSW096
      *###################################################################CSW096
     C                     CALL 'MG9900'                                  CSW096
     C                     PARM *BLANKS   @RTCD                           CSW096
     C                     PARM           P@IN                            CSW096
     C                     PARM *BLANKS   P@OUT                           CSW096
     C                     PARM           P@ZZ  256                       CSW096
      *                                                                   CSW096
     C           @RTCD     IFNE *BLANKS                                   CSW096
     C           *LOCK     IN   LDA                                       CSW096
     C                     MOVE '093'     DBASE              * * * * * * *CSW096
     C                     MOVEL'*CALL  ' DBKEY              * DBERR 093 *CSW096
     C                     MOVEL'MG9900'  DBFILE             * * * * * * *CSW096
     C                     OUT  LDA                                       CSW096
     C                     EXSR *PSSR                                     CSW096
     C                     ENDIF                                          CSW096
      *                                                                   CSW096
      **** If Message Status is the same, set Match Flag to Yes;          CSW096
      **** Otherwise, set Match Flag to NO                                CSW096
      *                                                                   CSW096
     C           O@MGST    IFEQ KMGST                                     CSW096
     C                     MOVE 'Y'       MATCH   1                       CSW096
      *                                                                                       162270
     C***********BCY001    IFEQ 'Y'                                                   162270 162270A
     C           CSE099    IFEQ 'Y'                                                          162270A
     C           MGMODI    IFEQ 'SE'                                                          162270
     C           MGRIBN    ANDNE*BLANKS                                                       162270
     C                     EXSR SRACID                                                        162270
     C           KACID     IFEQ WACID                                                         162270
     C                     MOVE 'Y'       MATCH                                               162270
     C                     ELSE                                                               162270
     C                     MOVE 'N'       MATCH                                               162270
     C                     END                                                                162270
     C                     END                                                                162270
     C                     ENDIF                                                              162270
      *                                                                                       162270
     C/COPY WNCPYSRC,MG0210C040
     C                     ELSE                                           CSW096
     C                     MOVE 'N'       MATCH                           CSW096
     C                     ENDIF                                          CSW096
      *                                                                   CSW096
     C***********          MOVE 'Y'       MATCH   1                       CSW096
     C                     ELSE
     C                     MOVE 'N'       MATCH
     C                     END
      *
     C/COPY WNCPYSRC,MG0210C011
     C           CSW025    IFEQ 'Y'                                                           CSW025
     C           CSW050    ANDNE'Y'                                                           242622
     C                     MOVE 'N'       MATCH                                               CSW025
     C                     ENDIF                                                              CSW025
      *                                                                                       CSW025
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   SG210 - Format single MT210 message                         *
      *   Called by   main process                                    *
      *   Calls       FMTHD  format fields 20 and 30                  *
      *               MESG   format fields 21/32B/50/52/56            *
      *               OMSG   output correctly generated message       *
      *               REPT   report incorrectly generated message     *
      *****************************************************************
      *
     C           SG210     BEGSR
      *
      **  Format Fields 20 and 30
      *
     C                     EXSR FMTHD
      *
      **  Format Fields 21, 32B, 50, 52n and 56n
      *
     C                     EXSR MESG
      *
      **  Report if error on message formatting
      *
     C           @ERR      IFEQ 'Y'
     C                     EXSR REPT
     C                     ELSE
      *
      **  Store individual message details for Compliance Watch Checking                      221145
      *                                                                                       221145
     C                     MOVE *BLANK    WLTDS                                               221145
      *                                                                                       221145
     C                     Z-ADD*ZERO     W4VDAT                                              221145
     C                     Z-ADD*ZERO     W4MDAT                                              221145
     C                     Z-ADD*ZERO     W4AMT1                                              221145
     C                     Z-ADD*ZERO     W4AMT2                                              221145
     C                     MOVEL@TRNO     W4IDEN                                              221145
     C                     MOVEL'210'     W4ITEM                                              221145
     C                     MOVELMGROBR    W4BRCH                                              221145
     C                     MOVEL'MGOREF'  W4FUNT                                              221145
     C                     MOVELMGDEST    W4CNUM                                              221145
     C                     Z-ADDBJRDNB    W4DDAT                                              221145
     C           MGST      IFEQ 'RSND'                                                        221145
     C                     MOVEL'Y'       W4ARLS                                              221145
     C                     ELSE                                                               221145
     C                     MOVEL'N'       W4ARLS                                              221145
     C                     ENDIF                                                              221145
      *                                                                                       221145
      **  Write message to PF/MGOMSGPD
      *
     C                     EXSR OMSG
     C                     END
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   MU210 - Format multiple MT210 message                       *
      *   Called by   main process                                    *
      *   Calls       FMTHD  format fields 20 and 30                  *
      *               MESG   format fields 21, 32B, 50, 52, & 56      *
      *               TRNUM  format TRN for reference file            *
      *               RMVMSG remove message part from DS MULT         *
      *               CHECK  check matching criteria met for MT210    *
      *               OMSG   output correctly generated message       *
      *****************************************************************
      *
     C           MU210     BEGSR
      *
      **  Initialise total amount & the no. of parts of the MT210
      **  blank array for the transaction numbers used in the MT203       E29588
      *
     C                     Z-ADD0         TAMT   170
     C                     Z-ADD0         PARTS   20
     C                     MOVEA*BLANKS   R203                            E29588
     C                     Z-ADD0         P       20                      E29588
      *
      **  Format Fields 20, and 30
     C                     EXSR FMTHD
     C                     SUB  BYTRMV    BYTES
      *
      **  While the matching criteria is met & bytes remain for the
      **  whole message & the maximum 10 parts allowed not met, and
      **  not end of file; format the parts of the MT210
      *
     C           MATCH     DOWEQ'Y'
     C/COPY WNCPYSRC,MG0210C051
     C           BYTES     ANDGT90
     C           PARTS     ANDLT10
     C           *IN10     ANDEQ'0'
      *
      **  save the start position of this part
      **  increment the number of parts and total amount
     C                     Z-ADD0         BYTRMV  40
     C                     Z-ADDX         STPOS   20
     C                     Z-ADDV         STPOSV  20                      183583
     C                     ADD  1         PARTS
      *                                                                   CSW020
      * CSW020: If the swift number decimal places is less than the       CSW020
      *         normal number of decimal place, zeroise the extra decimalsCSW020
      *         when incrementing the total amount (TAMT).                CSW020
     C           WCHGRQ    IFEQ 'Y'                                       CSW020
     C           MGEAMT    DIV  WPOWER    NWEAMT 130                      CSW020
     C                     MULT WPOWER    NWEAMT                          CSW020
     C                     ADD  NWEAMT    TAMT                            CSW020
     C                     ELSE                                           CSW020
     C                     ADD  MGEAMT    TAMT
     C                     ENDIF                                          CSW020
      *
      **  Save the start position of the first part
      *
     C           PARTS     IFEQ 1
     C                     Z-ADDSTPOS     FIRST   20
     C                     END
      *
      **  Format the part of the MT210, fields 21/32B/50/52n/56n
      *
     C                     EXSR MESG
      *
      **  Set up reference file information for each part of the MT210
      *
     C           PARTS     OCUR REF210
     C           PARTS     OCUR PART
     C                     MOVEL@TRNO     @RTRN
     C                     MOVELMGTNUM    @MTRN
     C                     MOVELMGTTYP    @TNTP
     C                     MOVELMGTSTP    @SBTP
     C                     MOVELZSAMNT    @AMTS
     C                     MOVELMGBRCA    @OTHB
      *                                                                                       221145
      **  Store transaction details of first message for Compliance Watch checking            221145
      *                                                                                       221145
     C           PARTS     IFEQ 1                                                             221145
     C                     MOVE *BLANK    WLTDS                                               221145
      *                                                                                       221145
     C                     Z-ADD*ZERO     W4VDAT                                              221145
     C                     Z-ADD*ZERO     W4MDAT                                              221145
     C                     Z-ADD*ZERO     W4AMT1                                              221145
     C                     Z-ADD*ZERO     W4AMT2                                              221145
     C                     MOVEL@TRNO     W4IDEN                                              221145
     C                     MOVEL'210'     W4ITEM                                              221145
     C                     MOVELMGROBR    W4BRCH                                              221145
     C                     MOVEL'MGOREF'  W4FUNT                                              221145
     C                     MOVELMGDEST    W4CNUM                                              221145
     C                     Z-ADDBJRDNB    W4DDAT                                              221145
     C           MGST      IFEQ 'RSND'                                                        221145
     C                     MOVEL'Y'       W4ARLS                                              221145
     C                     ELSE                                                               221145
     C                     MOVEL'N'       W4ARLS                                              221145
     C                     ENDIF                                                              221145
      *                                                                                       221145
     C                     ENDIF                                                              221145
      *
      **  If an error in formatting the message or run out bytes
      **  for the message, delete the current part of the message
      **  and print out a report of the erroneous part
      *
     C           @ERR      IFEQ 'Y'
     C           RANOUT    OREQ 'Y'
     C                     EXSR RMVMSG
     C                     ELSE                                           E29588
     C                     ADD  1         P                               E29588
     C                     MOVEL@MTRN     R203,P                          E29588
     C                     END
      *
      **  Read the next message, if bytes remain  OR
      **  no bytes remain and there was a formatting error.
      **  Do not read the next message if no bytes remain, as we
      **  wish to process this message again, if no format error.
      *
     C           RANOUT    IFEQ 'N'
     C           RANOUT    OREQ 'Y'
     C           @ERR      ANDEQ'Y'
     C                     READ MGF210L0                 10
      *
      **  Check if next message could be part of this multiple
      *
     C           *IN10     IFEQ '0'
     C/COPY WNCPYSRC,MG0210C009
     C                     EXSR CHECK
     C/COPY WNCPYSRC,MG0210C010
      *                                                                   E29588
      **  MT203 should not contain more than one part for any trans no    E29588
     C                     MOVELMGTNUM    RTNUM   6                       E29588
     C           RTNUM     LOKUPR203                     23               E29588
     C           *IN23     IFEQ '1'                                       E29588
     C                     MOVE 'N'       MATCH                           E29588
     C                     END                                            E29588
     C                     END
      *                                                                   E29588
     C                     END
      *
     C                     MOVE ' '       @ERR
      *
     C                     END                              do while
      *
     C                     READPMGF210L0                 10
      *
      **  If one part then field 20 should be changed
      *
     C           PARTS     IFEQ 1
     C           1         OCUR REF210
     C                     MOVE @RTRN     @TRNO
     C           1         OCUR MULT
     C                     MOVEL@TRNO     MFLD
      *
      **  Retrieve relevent information for this message
      *
     C           1         OCUR PART
     C                     MOVEL@MTRN     MGTNUM
     C                     MOVEL@TNTP     MGTTYP
     C                     MOVEL@SBTP     MGTSTP
     C                     MOVEL@AMTS     ZSAMNT
     C                     MOVEL@OTHB     MGBRCA
     C                     END
      *
      **  No message if error on the first part (PARTS defaulted to 15)
      *
     C           PARTS     IFNE 15
     C                     EXSR OMSG
     C                     END
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   TRNUM - Format TRN for reference file PF/MGOREFPD           *
      *   Called by   MU210  format single MT210 message              *
      *               MESG   format fields :21:,:32B:,:50:,:52n:,:56n:*
      *   Calls       -                                               *
      *****************************************************************
      *
     C           TRNUM     BEGSR
     C/COPY WNCPYSRC,MG0210C031
      *
      **  Access the approriate transaction file for the SWIFT sequence
      *
     C                     EXSR SEQN
      *                                                                   CDL002
      **  Only proceed if FX Netting switchable feature is off,           CDL002
      **  or its on and the module id is not 'NT'                         CDL002
      *                                                                   CDL002
     C           CDL002    IFEQ 'N'                                       CDL002
     C           CDL002    OREQ 'Y'                                       CDL002
     C           MGMODI    ANDNE'NT'                                      CDL002
      *
      **  In a work array, build up the variable length TRN
      *
     C                     MOVE *BLANKS   @WRK
      *                                                                   142403
     C           CLE007    IFEQ 'Y'                                       142403
     C           MGMODI    ANDEQ'LF'                                      142403
     C           CLE007    OREQ 'Y'                                       142403
     C           MGMODI    ANDEQ'LS'                                      142403
     C                     MOVE 'F'       @WRK,1                          142403
     C                     MOVEAMGTNUM    @WRK,2                          142403
      *                                                                   142403
      * For a loan based fee, midas transaction is 14 characters long,    142403
      * so remove customer number, since there will not be room for it    142403
      * in the SWIFT transaction ref.                                     142403
     C           @WRK,15   IFNE *BLANK                                    142403
     C                     MOVEA@WRK,8    W#LNSQ  8                       142403
     C                     MOVEAW#LNSQ    @WRK,2    P                     142403
     C                     ENDIF                                          142403
      *                                                                   142403
     C                     ELSE                                           142403
     C                     MOVEAMGMODI    @WRK
     C                     MOVEAMGTNUM    @WRK,3
     C                     ENDIF                                          142403
      *
      **  Tag onto the end the sequence number
      *
     C           MGLSWS    ADD  1         @SWS    30
     C/COPY WNCPYSRC,MG0210C032
     C                     MOVE @SWS      @LSWS   3
     C                     Z-ADD1         I
     C           ' '       LOKUP@WRK,I                   22
      *                                                                   142403
     C           CLE007    IFEQ 'Y'                                       142403
     C           MGMODI    ANDEQ'LF'                                      142403
     C           CLE007    OREQ 'Y'                                       142403
     C           MGMODI    ANDEQ'LS'                                      142403
     C                     MOVE @SWS      WSWS    2                       142403
     C                     MOVEAWSWS      @WRK,I                          142403
      *                                                                   142403
     C                     ELSE                                           142403
      *                                                                   CDL008
      ** For CLS pay-in schedules, midas transaction is 16 characters     CDL008
      ** long so do not add sequence number at the end                    CDL008
      *                                                                   CDL008
     C           MGTTYP    IFNE 'RC'                                      CDL008
     C                     MOVEA@LSWS     @WRK,I
     C                     ENDIF                                          CDL008
     C                     ENDIF                                          142403
     C                     MOVEA@WRK      @TRNO  16
      *
      **  Determine if the TRN is unique
      *
     C           @TRNO     CHAINMGREFL0              11
      *
      **  Cannot have duplicate keys, hence error
     C           *IN11     IFEQ '0'
      *
      **  For multiple MT210, the TRN is displayed on field 21
     C           MTAG      IFEQ ':21: '
     C                     MOVE @TRNO     MFLD
     C                     END
     C                     MOVELMSGA,7    MERR
     C                     MOVE 'Y'       @ERR
     C                     END
      *                                                                   CDL002
     C                     ENDIF                                          CDL002
      *                                                                   CDL002
      **  If FX Netting switchable feature is on and and the              CDL002
      **  module id is 'NT' chain FXNETML4 using Net no.                  CDL002
      *                                                                   CDL002
     C           CDL002    IFEQ 'Y'                                       CDL002
     C           MGMODI    ANDEQ'NT'                                      CDL002
      *                                                                   CDL002
      **  In a work array, build up the variable length TRN               CDL002
      *                                                                   CDL002
     C                     MOVE *BLANKS   @WRK                            CDL002
     C                     MOVEAMGMODI    @WRK                            CDL002
     C                     MOVEAMGTNUM    @WRK,3                          CDL002
      *                                                                   CDL002
      **  Tag onto the end the sequence number                            CDL002
      *                                                                   CDL002
     C           MGLSWS    ADD  1         @SWS                            CDL002
     C                     MOVE @SWS      @LSWS                           CDL002
     C                     Z-ADD1         I                               CDL002
     C           ' '       LOKUP@WRK,I                   22               CDL002
     C                     MOVEA@LSWS     @WRK,I                          CDL002
     C                     MOVEA@WRK      @TRNO                           CDL002
      *                                                                   CDL002
      **  Determine if the TRN is unique                                  CDL002
      *                                                                   CDL002
     C           @TRNO     CHAINMGREFL0              11                   CDL002
      *                                                                   CDL002
      **  Cannot have duplicate keys, hence error                         CDL002
     C           *IN11     IFEQ '0'                                       CDL002
     C                     MOVELMSGA,7    MERR                            CDL002
     C                     MOVE 'Y'       @ERR                            CDL002
     C                     END                                            CDL002
      *                                                                   CDL002
      **  module id is 'NT' chain FXNETML4 using Net no.                  CDL002
      **  from MGF202PD                                                   CDL002
      *                                                                   CDL002
     C                     MOVE *BLANKS   @WRK                            CDL002
     C           *LIKE     DEFN AMNTNO    DEALNO                          CDL002
     C                     MOVELMGTNUM    DEALNO                          CDL002
     C           DEALNO    CHAINFXNETML4             25                   CDL002
     C           *IN25     IFEQ *OFF                                      CDL002
     C                     MOVEAAMNETR    @WRK                            CDL002
      *                                                                   CDL002
      **  For multiple MT210, the TRN is displayed on field 21            CDL002
     C           MTAG      IFEQ ':21: '                                   CDL002
     C                     MOVEA@WRK      MFLD                            CDL002
     C                     END                                            CDL002
     C                     ELSE                                           CDL002
     C           *LOCK     IN   LDA                                       CDL002
     C                     MOVE '022'     DBASE            * * * * * * * *CDL002
     C                     MOVELDEALNO    DBKEY            *  DBERR 022  *CDL002
     C                     MOVEL'FXNETML4'DBFILE           * * * * * * * *CDL002
     C                     OUT  LDA                                       CDL002
     C                     EXSR *PSSR                                     CDL002
     C                     ENDIF                                          CDL002
      *                                                                   127264
      **  In a work array, build up the variable length TRN               127264
      *                                                                   127264
     C                     MOVE *BLANKS   @WRK                            127264
     C                     MOVEAMGMODI    @WRK                            127264
     C                     MOVEAMGTNUM    @WRK,3                          127264
      *                                                                   127264
      **  Tag onto the end the sequence number                            127264
      *                                                                   127264
     C           MGLSWS    ADD  1         @SWS    30                      127264
     C                     MOVE @SWS      @LSWS   3                       127264
     C                     Z-ADD1         I                               127264
     C           ' '       LOKUP@WRK,I                   22               127264
     C                     MOVEA@LSWS     @WRK,I                          127264
      *                                                                   127264
     C                     ENDIF                                          CDL002
      *
     C/COPY WNCPYSRC,MG0210C036
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   FMTHD - Format the header part of an MT210 message          *
      *   Called by   SG210  format single MT210 message              *
      *               MU210  format multiple MT210 message            *
      *   Calls       TRNUM  format TRN for reference file            *
      *****************************************************************
      *
     C           FMTHD     BEGSR
      *
      **  Field :20:  Transaction reference number
      *
     C                     Z-ADD1         X       20
     C           X         OCUR MULT
     C/COPY WNCPYSRC,MG0210C028
      *
      **  Multiple message TRN equals MODI,ddmm (rundate),HHMMSS
      *
     C           MATCH     IFEQ 'Y'
     C                     MOVE *BLANKS   @WRK
     C                     MOVEAMGMODI    @WRK,1
     C                     MOVE MGDE      HOLD4   4
     C                     MOVEAHOLD4     @WRK,3
     C                     TIME           HOLD6   60
     C                     MOVELHOLD6     HOLD6A  6
     C                     MOVEAHOLD6A    @WRK,7
      *                                                                   090915
      **  IN THE CASE OF DUPLICATE TIME                                   090915
      *                                                                   090915
     C           HOLD6     IFEQ LTIM                                      090915
      *                                                                   109283
      * Use a bigger number for duplicates, TC is initialised to 1        109283
      * hence HOLD3 is always 2...                                        109283
      * Duplicate numbers start at 999 and then are counted down          109283
      *                                                                   109283
     C***********          ADD  1         TC                        090915109283
     C***********          MOVELTC        HOLD3   3                 090915109283
     C                     SUB  1         ##003N  30                      109283
     C           ##003N    IFLT 1                                         109283
     C                     Z-ADD999       ##003N                          109283
     C                     ENDIF                                          109283
     C                     MOVEL##003N    HOLD3   3                       109283
     C                     Z-ADD1         I                               090915
     C           ' '       LOKUP@WRK,I                   22               090915
     C                     MOVEAHOLD3     @WRK,I                          090915
     C                     ELSE                                           090915
     C                     Z-ADDHOLD6     LTIM    60                      090915
     C                     ENDIF                                          090915
     C                     MOVEA@WRK      @TRNF  16
      *
      **  Determine if the TRN is unique
      *
     C           @TRNF     CHAINMGREFL0              11
      *
      **  Cannot have duplicate keys, hence error
     C           *IN11     IFEQ '0'
     C                     MOVELMSGA,6    MERR
     C                     MOVE 'Y'       @ERR
     C                     END
      *
      **  Use the transaction number
     C                     ELSE
     C                     EXSR TRNUM
     C                     END
      *
     C                     MOVE ':20: '   MTAG
     C                     MOVEA@WRK      MFLD
     C                     ADD  22        BYTRMV
      *                                                                                       162270
     C***********BCY001    IFEQ 'Y'                                                   162270 162270A
     C           CSE099    IFEQ 'Y'                                                          162270A
     C           MGMODI    IFEQ 'SE'                                                          162270
     C           MGRIBN    ANDNE*BLANKS                                                       162270
      *                                                                                       162270
     C                     ADD  1         X                                                   162270
     C           X         OCUR MULT                                                          162270
     C                     MOVE ':25: '   MTAG                                                162270
     C                     MOVELKACID     MFLD                                                162270
     C                     ADD  18        BYTRMV                                              162270
     C                     END                                                                162270
     C                     ENDIF                                                              162270
      *                                                                                       162270
     C/COPY WNCPYSRC,MG0210C012
      *
     C           MGTTYP    IFEQ 'PC'                                                          210796
     C                     MOVELMGCCY     WCCY                                                210796
     C                     MOVELMGRONS    WLPR                                                210796
      *                                                                                       210796
     C           KCLS      CHAINSDNOSTL8             80                                       210796
      *                                                                                       210796
      ** If dummy nostro is not found, database error.                                        210796
     C           *IN80     IFEQ *ON                                                           210796
     C           *LOCK     IN   LDA                                                           210796
     C                     MOVEL'SDNOSTL8'DBFILE                                              210796
     C                     Z-ADD032       DBASE                                               210796
     C           MGCCY     CAT  MGRONS:0  DBKEY                                               210796
     C                     OUT  LDA                                                           210796
     C                     EXSR *PSSR                                                         210796
      *                                                                                       210796
     C                     ELSE                                                               210796
      *                                                                                       210796
     C           A7OACN    IFNE *BLANK                                                        210796
     C                     ADD  1         X                                                   210796
     C           X         OCUR MULT                                                          210796
     C                     MOVE ':25 :'   MTAG                                                210796
     C           '/'       CAT  A7OACN:0  MFLD                                                210796
     C                     END                                                                210796
     C                     END                                                                210796
     C                     END                                                                210796
      *                                                                                       210796
      **  Field :30:  value date
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     CALL 'ZM0060'               15
     C                     PARM MGVDAT    ZMDAY   50
     C                     PARM           ZMDATE  6
      *
      **  Error on call ?
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '008'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 008  *
     C                     MOVEL'ZM0060'  DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
     C                     MOVE ':30: '   MTAG
     C                     MOVELZMDATE    MFLD
     C                     ADD  12        BYTRMV
      *
     C                     Z-ADDX         ENDHD   20
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   MESG  - Format fields :21: :32B: :50: :52n: :56n:           *
      *   Called by -  SG210   format single MT210 message            *
      *                MG210   format multiple MT210 message          *
      *   Calls        FLD50   format field 50  (ordering customer)   *
      *                FLD52   format field 52n (ordering institution)*
      *                FLD56   format field 56n (intermediary)        *
      *****************************************************************
      *
     C           MESG      BEGSR
      *
      **  Field :21:  Related reference
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE ':21: '   MTAG
      **  Determine TRN for part of a multiple, for PF/MGOREFPD
      *
     C           MATCH     IFEQ 'Y'
     C/COPY WNCPYSRC,MG0210C053
     C                     EXSR TRNUM
     C                     END
      *                                                                   CDL002
      **  Only proceed if FX Netting switchable feature is off,           CDL002
      **  or its on and the module id is not 'NT'                         CDL002
      *                                                                   CDL002
     C           CDL002    IFEQ 'N'                                       CDL002
     C           CDL002    OREQ 'Y'                                       CDL002
     C           MGMODI    ANDNE'NT'                                      CDL002
     C/COPY WNCPYSRC,MG0210C019
      *
      **  Access SDBRCHPD using branch code
     C           FL21TR    IFNE 'Y'                                                           240909
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM MGBRCA    @BRCD   3
     C           SDBRCH    PARM SDBRCH    DSSDY
      *
      ** Branch record not found - Error
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '009'     DBASE            * * * * * * * *
     C                     MOVELMGBRCA    DBKEY            *  DBERR 009  *
     C                     MOVEL'SDBRCHPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Access SDCUSTPD using
     C                     MOVE *BLANKS   @KEY1
     C                     MOVELMGCNUM    @KEY1
     C                     CALL 'AOCUSTR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           @KEY1  10
     C                     PARM *BLANKS   @KYST   7
     C           SDCUST    PARM SDCUST    DSSDY
     C/COPY WNCPYSRC,MG0210C024
      *
      **  If customer exist and has a SWIFT address then
      **  format the SWIFT common reference
      *
     C                     MOVE *BLANKS   ZCREF
     C           @RTCD     IFEQ *BLANKS
     C           BBCSID    ANDNE*BLANKS
     C           MGTTYP    ANDNE'NX'
      *
     C                     MOVELA8BTID    ZSSWI
     C                     MOVELBBCSID    ZDSWI
     C/COPY WNCPYSRC,MG0210C042
     C                     MOVELMGRATE    ZRATE
     C                     CALL 'ZM0020'               15
     C                     PARM           ZSSWI  12
     C                     PARM           ZDSWI  12
     C                     PARM           ZRATE  138
     C                     PARM           ZCREF  16
      *
      **  Error on call (program not found)
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '010'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 010  *
     C                     MOVEL'ZM0020'  DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C/COPY WNCPYSRC,MG0210C043
     C                     END
     C                     ENDIF                                                              240909
      *
      ** Customer record not found - Error
      *
     C/COPY WNCPYSRC,MG0210C046
     C           @RTCD     IFNE *BLANKS
     C           ZCREF     OREQ *BLANKS
     C           FL21TR    OREQ 'Y'                                                           240909
     C/COPY WNCPYSRC,MG0210C047
     C           FL21TR    IFEQ 'Y'                                                           240909
     C                     MOVE *BLANKS   ZCREF                                               240909
     C                     ENDIF                                                              240909
      *
      **  Not the first message, reference TRN of last confirmation
     C           MGLSWC    IFGT 0
     C           FL21TR    ANDNE'Y'                                                           240909
     C           MGLSWC    ORGT 0                                                             240909
     C           MATCH     ANDEQ'N'                                                           240909
     C           FL21TR    ANDEQ'Y'                                                           240909
     C                     MOVE MGLSWC    @LSWC   3
     C                     MOVEA@LSWC     @WRK,I
     C                     MOVEA@WRK      ZCREF
      *
      **  First message, reference TRN of this message
     C                     ELSE
     C/COPY WNCPYSRC,MG0210C020
     C                     MOVEL@TRNO     ZCREF
     C/COPY WNCPYSRC,MG0210C021
     C                     END
     C                     END
     C/COPY WNCPYSRC,MG0210C022
      *
     C                     MOVELZCREF     MFLD
     C                     ADD  22        BYTRMV
      *
     C                     ENDIF                                          CDL002
      *                                                                   CDL002
      **  If FX Netting switchable feature is on and and the              CDL002
      **  module id is 'NT' obtain FXNETML4 using Net no.                 CDL002
      *                                                                   CDL002
     C           CDL002    IFEQ 'Y'                                       CDL002
     C           MGMODI    ANDEQ'NT'                                      CDL002
     C                     MOVELAMNETR    ZCREF                           CDL002
     C                     MOVELZCREF     MFLD                            CDL002
     C                     ADD  22        BYTRMV                          CDL002
     C                     ENDIF                                          CDL002
     C/COPY WNCPYSRC,MG0210C049
      *
      **  Field :32B:  currency code, amount
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      **  Format purchase currency and amount
     C/COPY WNCPYSRC,MG0210C048
     C                     MOVE MGCCY     ZCCY
     C                     MOVE MGEAMT    ZAMNT
     C                     CALL 'ZM0040'               15
     C                     PARM           ZAMNT  130
     C                     PARM           ZCCY    3
     C                     PARM           ZSAMNT 17
     C                     PARM           ZSCCY   3
     C                     PARM ' '       ZERR    1
     C                     PARM           ZSWDPC  1                                           222373
      *
      **  Call ended in error (program not found)
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '011'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 011  *
     C                     MOVEL'ZM0040'  DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      ** Error - indicate erroneous fields;
     C           ZERR      IFEQ '1'
     C                     MOVE 'Y'       @ERR
     C                     MOVE MGEAMT    ZAMT
     C                     MOVE MGCCY     ZCCY
     C                     MOVE ':32B:'   MTAG
     C                     MOVELERR3N     MFLD
     C                     MOVELMSGA,3    MERR
      *
     C                     ELSE
     C                     MOVE ':32B:'   MTAG
     C                     MOVELFLD3B     MFLD
     C                     ADD  25        BYTRMV
     C                     END
     C*COP* WN*PYSRC*MG0210C028                                           169210
     C/COPY WNCPYSRC,MG0210CABP                                           169210
      *
      **  Format Field :50:   (Ordering Customer)
      *
     C                     EXSR FLD50
      **  Format Field :52n:  (Ordering Institution)
      *
     C                     EXSR FLD52
      **  Format Field :56n:  (Intermediary)
      *
     C                     EXSR FLD56
      *
      **  Build a multiple message with the most parts possible by
      **  subtracting the amount of bytes for this part of a MT210
      **  from the total amount of bytes that can be used.
      *
     C                     SUB  BYTRMV    BYTES
      *
      **  Indicate if we have run out of bytes for the whole MT210
      *
     C           BYTES     IFLT 0
     C                     MOVE 'Y'       RANOUT
     C                     END
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   FLD50 - Format field 50 (Ordering Customer)                 *
      *   Called by - MESG   format fields 21/32B/50/52n/56n          *
      *   Calls                                                       *
      *****************************************************************
      *
     C           FLD50     BEGSR
      *
      **  Field :50:  Ordering Customer
      *
     C********** MGROCN    IFNE 0                                                             CSD027
     C           MGROCN    IFNE *BLANKS                                                       CSD027
      *
      **  Access SDCUSTPD using ordering customer number
      *
     C                     MOVE *BLANKS   @KEY1
     C                     MOVELMGROCN    @KEY1
     C                     CALL 'AOCUSTR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           @KEY1  10
     C                     PARM *BLANKS   @KYST   7
     C           SDCUST    PARM SDCUST    DSSDY
     C/COPY WNCPYSRC,MG0210C025
      *
      ** Customer record not found - Error
      *
     C           @RTCD     IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE 'Y'       @ERR
     C                     MOVE ':50: '   MTAG
     C                     MOVELMGROCN    MFLD
     C                     MOVELMSGA,2    MERR
      *
      **  Full address
     C                     ELSE
      *                                                                                       CSW207
     C           CSW207    IFEQ 'Y'                                                           CSW207
      *                                                                                     BUG15099
      ** Save the customer details of ordering customer and restore it back                 BUG15099
      ** before exiting this 'if' condition.                                                BUG15099
      *                                                                                     BUG15099
     C                     MOVELSDCUST    SVCUSD                                            BUG15099
      *                                                                                       CSW207
     C                     MOVELNWRK      P@NWRK    P                                         250600
     C                     MOVELI@MTPY    P@MTYP    P                                         250600
      *                                                                                       250600
     C                     MOVE MGROCN    P@CUST                                              CSW207
     C                     MOVELMGROCN    P@IN1     P                                         250600
     C                     MOVELMGMODI    P@MODI    P                                         250600
     C                     MOVELMGDEST    PKEY1                                               250600
      *                                                                                       250600
     C                     CALL 'AOCUSTR1'                                                    250600
     C                     PARM *BLANK    P@RTCD  7                                           250600
     C                     PARM '*KEY   ' POPTN   7                                           250600
     C                     PARM           PKEY1  10                                           250600
     C                     PARM *BLANKS   PKYST   7                                           250600
     C           SDCUST    PARM SDCUST    DSLDY                                               250600
      *                                                                                       250600
     C           P@RTCD    IFEQ *BLANKS                                                       250600
     C                     MOVELBBCOLC    P@CTRY                                              250600
     C                     ENDIF                                                              250600
      *                                                                                       250600
     C                     MOVELMGRONS    P@NSTR                                              250600
      *                                                                                       CSW207
     C                     CALL 'FT001000'                                                    CSW207
      *                                                                                       CSW207
      ** input parm                                                                           CSW207
      *                                                                                       CSW207
     C                     PARM *BLANKS   P@RTCD                                              CSW207
     C                     PARM *BLANKS   P@MSID  7                                           CSW207
     C                     PARM *BLANK    P@ERTP  1                                           CSW207
     C                     PARM 'FRMT'    P@VALD  4                                           CSW207
     C                     PARM           P@IN1  35                                           CSW207
     C                     PARM           P@IN2  35                                           CSW207
     C                     PARM           P@IN3  35                                           CSW207
     C                     PARM           P@IN4  35                                           CSW207
     C                     PARM           P@IN5  35                                           CSW207
     C**********           PARM           P@ACTP  1                                   CSW207 CSW207A
     C                     PARM 'C'       P@ACTP  1                                          CSW207A
     C                     PARM           P@ACCT 34                                           CSW207
     C                     PARM           P@CUST  6                                           CSW207
     C                     PARM           P@NAHD 10                                           CSW207
     C**********           PARM           P@NWRK  6                                   CSW207 CSW207A
     C**********           PARM 'SWIFT'   P@NWRK  6                                   CSW207A 250600
     C**********           PARM '210'     P@MTYP  3                                    CSW207 250600
     C                     PARM           P@NWRK  6                                           250600
     C                     PARM           P@MTYP  3                                           250600
     C**********           PARM           P@MSGF  5                                   CSW207 CSW207A
     C                     PARM ':50F:'   P@MSGF  5                                          CSW207A
     C                     PARM           P@CTRY  2                                           CSW207
     C                     PARM MGBRCA    P@BRCA  3                                           CSW207
     C                     PARM MGCCY     P@CCY   3                                           CSW207
     C**********           PARM *BLANKS   P@NSTR  2                                    CSW207 250600
     C**********           PARM *BLANKS   P@MODI  2                                    CSW207 250600
     C                     PARM           P@NSTR  2                                           250600
     C                     PARM           P@MODI  2                                           250600
      *                                                                                       CSW207
      ** output parm                                                                          CSW207
      *                                                                                       CSW207
     C                     PARM           P@ML01 35                                           CSW207
     C                     PARM           P@ML02 35                                           CSW207
     C                     PARM           P@ML03 35                                           CSW207
     C                     PARM           P@ML04 35                                           CSW207
     C                     PARM           P@ML05 35                                           CSW207
      *                                                                                       CSW207
     C           P@RTCD    IFEQ *BLANKS                                                       CSW207
     C           P@ML01    ANDNE*BLANKS                                                     BUG15017
      *                                                                                       CSW207
     C           P@ML01    IFNE *BLANKS                                                       CSW207
     C                     ADD  1         X                                                   CSW207
     C           X         OCUR MULT                                                          CSW207
     C**********           MOVE ':50F: '  MTAG                                        CSW207 CSW207A
     C                     MOVEL':50F:'   MTAG                                               CSW207A
     C                     MOVELP@ML01    MFLD                                                CSW207
      *                                                                                       CSW207
     C           P@ML02    IFNE *BLANKS                                                       CSW207
     C                     ADD  1         X                                                   CSW207
     C           X         OCUR MULT                                                          CSW207
     C                     MOVELP@ML02    MFLD                                                CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
     C           P@ML03    IFNE *BLANKS                                                       CSW207
     C                     ADD  1         X                                                   CSW207
     C           X         OCUR MULT                                                          CSW207
     C                     MOVELP@ML03    MFLD                                                CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
     C           P@ML04    IFNE *BLANKS                                                       CSW207
     C                     ADD  1         X                                                   CSW207
     C           X         OCUR MULT                                                          CSW207
     C                     MOVELP@ML04    MFLD                                                CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
     C           P@ML05    IFNE *BLANKS                                                       CSW207
     C                     ADD  1         X                                                   CSW207
     C           X         OCUR MULT                                                          CSW207
     C                     MOVELP@ML05    MFLD                                                CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                     BUG15099
      ** Restore customer details of ordering customer                                      BUG15099
      *                                                                                     BUG15099
     C                     MOVELSVCUSD    SDCUST                                            BUG15099
      *                                                                                       CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW201
      ** If SWIFT 2001 is installed and SWIFT ID is not blank,                                CSW201
      ** check if SWIFT ID exists in BIC directory                                            CSW201
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C                     MOVEL'N'       WCHGIN  1                                           CSW201
      *                                                                                       CSW201
     C           BBCSID    IFNE *BLANKS                                                       CSW201
     C                     MOVELBBCSID    PCHAR                                               CSW201
     C                     CALL 'AOBICDV0'                                                    CSW201
     C                     PARM *BLANKS   PRTCD  10                                           CSW201
     C                     PARM           PCHAR  18                                           CSW201
     C                     PARM           PTYPE   7                                           CSW201
     C           MEBICD    PARM MEBICD    DSSDY                                               CSW201
      *                                                                                       CSW201
      ** If it is existing, and subtype is 'BEID' or 'TRCO',                                  CSW201
      ** then format field :50C:                                                              CSW201
      *                                                                                       CSW201
     C           PTYPE     IFEQ '*BIC'                                                        CSW201
      *                                                                                       CSW202
     C           CSW202    IFEQ 'Y'                                                           CSW202
     C                     CALL 'AOBEISR0'                                                    CSW202
     C                     PARM *BLANKS   PRTNC   7                                           CSW202
     C                     PARM '*VERIFY' POPTN   7                                           CSW202
     C                     PARM BDSUBT    PBICD   4                                           CSW202
     C           MEBEIS    PARM MEBEIS    DSFDY                                               CSW202
     C                     ENDIF                                                              CSW202
      *                                                                                       CSW202
     C           BDSUBT    IFEQ 'BEID'                                                        CSW201
     C           CSW202    ANDEQ'N'                                                           CSW202
     C           BDSUBT    OREQ 'TRCO'                                                        CSW201
     C           CSW202    ANDEQ'N'                                                           CSW202
     C           CSW202    OREQ 'Y'                                                           CSW202
     C           PRTNC     ANDEQ*BLANKS                                                       CSW202
     C                     ADD  1         X                                                   CSW201
     C           X         OCUR MULT                                                          CSW201
     C                     MOVE ':50C:'   MTAG                                                CSW201
     C                     MOVELBBCSID    MFLD                                                CSW201
     C                     MOVEL'Y'       WCHGIN                                              CSW201
     C                     ADD  19        BYTRMV                                              CSW201
     C                     ENDIF                                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     ENDIF                                                              CSW201
      *
     C                     ADD  153       BYTRMV
      *                                                                                       CSW201
      ** Otherwise, do normal formatting for field :50:                                       CSW201
      *                                                                                       CSW201
     C           P@ML01    IFEQ *BLANKS                                                      CSW207A
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C           WCHGIN    ANDNE'Y'                                                           CSW201
     C           CSW201    OREQ 'N'                                                           CSW201
      *
      **  Address 1
      *
     C           BBCNA1    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE ':50: '   MTAG
     C                     MOVELBBCNA1    MFLD
      *
      **  Address 2
     C           BBCNA2    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELBBCNA2    MFLD
     C                     END                             Address 2      046817
      **  Address 3
     C           BBCNA3    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELBBCNA3    MFLD
     C                     END                             Address 3      046817
      **  Address 4
     C           BBCNA4    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELBBCNA4    MFLD
     C                     END                             Address 4
     C*********************END                             Address 3      046817
     C*********************END                             Address 2      046817
     C                     END                             Address 1
      *                                                                                       CSW201
     C                     ENDIF                                                              CSW201
     C                     ENDIF                                                             CSW207A
      *
     C                     END
     C                     END
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   FLD52 - Format field 52 (Ordering Institution)              *
      *   Called by - MESG   format fields 21/32B/50/52n/56n          *
      *   Calls       FSWAD  format swift address                     *
      *****************************************************************
      *
     C           FLD52     BEGSR
      *
      **  Field :52:  Ordering Institution
      *
     C********** MGROBN    IFNE 0                                                             CSD027
     C           MGROBN    IFNE *BLANKS                                                       CSD027
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      **  format address
     C                     MOVE *BLANKS   ACLINE 35
     C                     MOVE *BLANKS   ZDEST
     C***********BCY001    IFEQ 'Y'                                                   162270 162270A
     C           CSE099    IFEQ 'Y'                                                          162270A
     C           MGMODI    IFEQ 'SE'                                                          162270
     C           MGRIBN    ANDNE*BLANKS                                                       162270
     C                     MOVE SECN      MGROBN                                              162270
     C                     ENDIF                                                              162270
     C                     ENDIF                                                              162270
     C/COPY WNCPYSRC,MG0210C041
     C                     MOVELMGROBN    ZDEST
     C                     MOVE ' '       TAG
     C                     MOVE '52'      FLDNO
     C                     EXSR FSWAD
     C                     END
      *
     C                     ENDSR
     C/EJECT
      ***************************************************************
      *   FLD56 - Format field 56 (Intermediary Bank)               *
      *   Called by - MESG   format fields 21/32B/50/52n/56n        *
      *   Calls       FSWAD  format swift address                   *
      ***************************************************************
      *
     C           FLD56     BEGSR
      *
      **  Field :56:  Intermediary Bank
     C*                                                                   S01408
     C/COPY WNCPYSRC,MG0210CCP4                                           S01408
     C*                                                                   S01408
      *
     C           MGRIBN    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELMGRIBN    ZDEST
     C                     MOVELMGRIBA    ACLINE
     C                     MOVE ' '       TAG
     C                     MOVE '56'      FLDNO
     C                     EXSR FSWAD
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,MG0210CCP5                                           S01408
     C*                                                                   S01408
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   FSWAD - Format SWIFT A/D addresses                          *
      *   Input  ZDEST  customer number being formatted               *
      *          ACLINE account line for the customer being processed *
      *          FLDNO  equal to the SWIFT field being formatted      *
      *          TAG    blank                                         *
      *                                                               *
      *   Called by   FLD52  format field 52 (ordering institution)   *
      *               FLD56  format field 56 (intermediary bank)      *
      *   Calls       -                                               *
      *****************************************************************
      *
     C           FSWAD     BEGSR
      *
      *
      **  Format SWIFT address
     C                     CALL 'ZM0050'               15
     C                     PARM           ZDEST  12
     C                     PARM           ZSADD1 35
     C                     PARM           ZSADD2 35
     C                     PARM           ZSADD3 35
     C                     PARM           ZSADD4 35
     C                     PARM           ZSTAG   1
     C                     PARM           ZSTYPE  1
     C                     PARM ' '       ZERR    1
     C                     PARM           ZDBEI   1                                           CSW201
      *
      **  Error on call (program not found)
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '012'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 012  *
     C                     MOVEL'ZM0050'  DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Error when formatting address
     C           ZERR      IFEQ '1'
     C                     MOVE 'Y'       @ERR
     C                     MOVE ZSTAG     TAG
     C                     MOVE @MTAG     MTAG
     C                     MOVELZDEST     MFLD
     C                     MOVELMSGA,4    MERR
      *
     C                     ELSE
      *
      **  Set up field tag
      *
     C                     MOVE ZSTAG     TAG
     C                     MOVE @MTAG     MTAG
      **  Output account line
      *
     C                     MOVE *BLANKS   SAVMTG  5                       183583
     C           ACLINE    IFNE *BLANKS
     C                     MOVE MTAG      SAVMTG                          183583
     C                     MOVELACLINE    MFLD
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
      **  Address 1
     C                     MOVELZSADD1    MFLD
     C                     EXSR SEXTN                                     183583
      *
      **  Full address
     C           ZSTAG     IFEQ 'D'
      *
      **  Address 2
     C           ZSADD2    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD2    MFLD
     C                     END                             Address 2      E42086
      **  Address 3
     C           ZSADD3    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD3    MFLD
     C                     END                             Address 3      E42086
      **  Address 4
     C           ZSADD4    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD4    MFLD
     C                     END                             Address 4
     C**********           END                             Address 3      E42086
     C**********           END                             Address 2      E42086
     C                     END                             Address 1
      *
     C                     END                             Error ?
      *
      **  SWIFT address
      *
     C           TAG       IFEQ 'A'
     C                     ADD  19        BYTRMV
      *
      **  full address
     C                     ELSE
     C                     ADD  153       BYTRMV
     C                     END
      *
      **  add on bytes to be removed if account line present
     C           ACLINE    IFNE *BLANKS
     C                     ADD  37        BYTRMV
     C                     END
      *
     C                     ENDSR
      /EJECT                                                              183583
      *****************************************************************   183583
      *                                                               *   183583
      *   SEXTN - Store customer with SWIFT address to data structure *   183583
      *                                                               *   183583
      *   Called by: FSWAD                                            *   183583
      *   Calls    : None                                             *   183583
      *                                                               *   183583
      *****************************************************************   183583
      *                                                                   183583
     C           SEXTN     BEGSR                                          183583
      *                                                                   183583
     C           SAVMTG    IFNE *BLANKS                                   183583
     C                     MOVE SAVMTG    @MTG                            183583
     C                     ELSE                                           183583
     C                     MOVELMTAG      @MTG                            183583
     C                     ENDIF                                          183583
     C           FLDTYP    IFEQ '5'                                       183583
     C           FLDTAG    ANDEQ'A'                                       183583
     C                     ADD  1         V                               183583
     C           V         OCUR EXTN                                      183583
     C                     Z-ADDX         MPSN                            183583
     C                     MOVEL@MTG      MTG                             183583
     C                     MOVELZDEST     MCSI                            183583
     C                     ENDIF                                          183583
      *                                                                   183583
     C           SEXT9     ENDSR                                          183583
     C/EJECT
      *****************************************************************
      *   OMSG   - Output correctly generated message to PF/MGOMSGPD  *
      *   Called by   main process                                    *
      *               MU210  format multiple MT210 messages           *
      *   Calls       -                                               *
      *****************************************************************
      *
     C           OMSG      BEGSR
      *
      **  Write reference records for each multiple part of the MT210
      *
     C           PARTS     IFGT 1
      *
      **  Format total amount of the part to SWIFT
      *
     C                     MOVE *BLANKS   ZAMNT
     C                     MOVE TAMT      ZAMNT
     C                     CALL 'ZM0040'
     C                     PARM           ZAMNT
     C                     PARM MGCCY     ZCCY
     C                     PARM           ZSAMNT
     C                     PARM           ZSCCY
     C                     PARM           ZERR
     C                     PARM           ZSWDPC                                              222373
      *
      **  Produce error report if format of total amount ended in error
      *
     C           ZERR      IFEQ 'Y'
     C                     MOVE 'Y'       @ERR
     C           1         OCUR MULT
     C                     MOVEAMSGA,5    MERR
     C                     ELSE
      *
      **  No error, set up the fields required for the header reference
      **  record (PF/MGOREFPD)
      *
     C                     MOVELZSAMNT    AMTX
      *
      **  Access blank information & the first part TRN number
      *
     C                     Z-ADD0         PT210
     C           11        OCUR PART
     C           CSW050    IFEQ 'Y'                                                           242622
     C                     MOVELAMTX      @AMTS                                               242622
     C                     ENDIF                                                              242622
     C           1         OCUR REF210
     C                     MOVEL@RTRN     TRNM
     C                     MOVEL@TRNF     TRNO
     C                     EXSR WREFM
      *
      **  I represents TRNO; J represents the next part (TRNM).
      **  TRN of first part (TRNF).
     C                     Z-ADD1         I
     C                     Z-ADD2         J       20
     C                     MOVEL@TRNF     TRNF
     C                     MOVE *BLANKS   AMTX
      *                                                                   087256
      ** Subsequent MGOREFPD  records for multiple part MT210 records     087256
      ** should have status created.                                      087256
     C                     MOVE 'CRTD'    MGST                            087256
     C                     MOVE '1'       MGSG                            087256
      *
      **  Output reference record for each part. Obtain the next
      **  REF210 entry for TRNM.
      **  PART is used to obtain unique information for each part.
      **  'I' also represents the part position within the multiple.
      *
     C           I         DOWLEPARTS
      *
      **  current part
     C           I         OCUR REF210
     C           I         OCUR PART
     C                     MOVEL@RTRN     TRNO
     C                     MOVE I         PT210   20
      *
      **  next part
     C           J         OCUR REF210
     C                     MOVEL@RTRN     TRNM
      *
      **  write reference record to PF/MGOREFPD
     C                     EXSR WREFM
      *
     C                     ADD  1         I
     C                     ADD  1         J
     C                     END
      *
      **  TRNO of the whole message equals the TRN of the first part
     C                     MOVELTRNF      TRNO
     C                     END
      *
      **  Write a reference record for a single MT210
     C                     ELSE
     C                     EXSR WREF
     C                     END
      *
      **  Output the message to PF/MGOMSGPD if no error on format of TAMT
      *
     C           @ERR      IFNE 'Y'
      *
      **  Write the message details to PF/MGOMSGPD
      *
     C                     Z-ADD1         I
     C           I         OCUR MULT
      *
     C           I         DOWLEX
     C           MFLD      ANDNE*BLANKS
     C/COPY WNCPYSRC,MG0210C023
     C                     WRITEMGOMSGD0               06
      *
      **  Error on write to PF/MGOMSGPD (message data file)
     C           *IN06     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '013'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 013  *
     C                     MOVEL'MGOMSGPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C                     ADD  1         I
     C           I         OCUR MULT
     C                     END
      *                                                                   183583
      ** Write multiple occurrence data structure to MGOEXTPD             183583
      *                                                                   183583
     C                     Z-ADD1         I                               183583
     C           I         OCUR EXTN                                      183583
     C           I         DOWLEV                                         183583
     C           MCSI      ANDNE*BLANKS                                   183583
     C                     WRITEMGOEXTD0               06                 183583
      *                                                                   183583
      ** Error on write to PF/MGOEXTPD (message data extension file)      183583
      *                                                                   183583
     C           *IN06     IFEQ '1'                                       183583
     C           *LOCK     IN   LDA                                       183583
     C                     MOVE '025'     DBASE            ************** 183583
     C                     MOVEL'        'DBKEY            * DBERROR 25 * 183583
     C                     MOVEL'MGOEXTPD'DBFILE           ************** 183583
     C                     OUT  LDA                                       183583
     C                     EXSR *PSSR                                     183583
     C                     ENDIF                                          183583
     C                     ADD  1         I                               183583
     C           I         OCUR EXTN                                      183583
     C                     ENDDO                                          183583
      *
      **  Error occurred during the formatting of the amount fields
      *
     C                     ELSE
     C                     EXSR REPT
     C                     END
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************                       CSD015
      *                                                               *                       CSD015
      *  SRWTCH - Watch Processing                                    *                       CSD015
      *                                                               *                       CSD015
      *****************************************************************                       CSD015
      *                                                                                       CSD015
     C           SRWTCH    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Re-determine Message Status                                                          CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       PARLS   1                                           CSD015
      *                                                                                       CSD015
     C           MGST      IFEQ 'RSND'                                                        CSD015
     C           NWRK      IFEQ 'SWIFT '                                                      CSD015
     C           NWRK      OREQ 'TELEX '                                                      CSD015
     C           NWRK      OREQ 'STTX  '                                                      CSD015
     C                     MOVE 'CRTD'    MGST                                                CSD015
     C                     MOVE '1'       MGSG                                                CSD015
     C                     MOVE 'Y'       PARLS                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ***Initialise*parameter for compliance engine program.                           CSD015 221145
      *********************                                                            CSD015 221145
     C*********************MOVE *BLANK    WLTDS                                        CSD015 221145
      *********************                                                            CSD015 221145
     C*********************Z-ADD*ZERO     W4VDAT                                       CSD015 221145
     C*********************Z-ADD*ZERO     W4MDAT                                       CSD015 221145
     C*********************Z-ADD*ZERO     W4AMT1                                       CSD015 221145
     C*********************Z-ADD*ZERO     W4AMT2                                       CSD015 221145
      *********************                                                            CSD015 221145
      ***Set*up*parameter*for compliance engine program                                CSD015 221145
      *********************                                                            CSD015 221145
     C*********************MOVELTRNO      W4IDEN                                       CSD015 221145
     C*********************MOVELMTPY      W4ITEM                                       CSD015 221145
     C*********************MOVELMGROBR    W4BRCH                                       CSD015 221145
     C*********************MOVEL'MGOREF'  W4FUNT                                       CSD015 221145
     C*********************MOVELDECN      W4CNUM                                       CSD015 221145
     C*********************Z-ADDBJRDNB    W4DDAT                                       CSD015 221145
     C*********************MOVELPARLS     W4ARLS                                       CSD015 221145
      *********************                                                            CSD015 221145
      ***Send*transaction*to compliance engine program                                 CSD015 221145
      *********************                                                            CSD015 221145
     C*********************CALL 'SDWLCLOP'                                             CSD015 221145
     C*********************PARM           WLTDS                                        CSD015 221145
     C*********************PARM           PSTRNG                                       CSD015 221145
      *                                                                                       CSD015
     C           ENDWAT    ENDSR                                                              CSD015
      *                                                                                       CSD015
     C/EJECT                                                                                  221145
      *****************************************************************                       221145
      *                                                               *                       221145
      *  WLCDQ - Submit information to Watch List Check Dtaq          *                       221145
      *                                                               *                       221145
      *****************************************************************                       221145
      *                                                                                       221145
     C           WLCDQ     BEGSR                                                              221145
      *                                                                                       221145
     C                     MOVE *BLANKS   ATRNM                                               221145
     C                     MOVELW4IDEN    ATRNM                                               221145
      *                                                                                       221145
     C           ATRNM     CHAINMGREFA1              90                                       221145
      *                                                                                       221145
      *  If a multiple message is being generated                                             221145
      *  (i.e. the TRNO of the first message is found in 'Next TRNO' field of MGOREFPD)       221145
      *  then send the TRNO of the main part of the message to Compliance Watch               221145
      *                                                                                       221145
     C           *IN90     IFEQ *OFF                                                          221145
     C                     MOVE *BLANKS   W4IDEN                                              221145
     C                     MOVELATRNO     W4IDEN                                              221145
     C                     ENDIF                                                              221145
      *                                                                                       221145
      *  Send transaction to compliance engine program                                        221145
      *                                                                                       221145
     C                     CALL 'SDWLCLOP'                                                    221145
     C                     PARM           WLTDS                                               221145
     C                     PARM           PSTRNG                                              221145
      *                                                                                       221145
     C                     ENDSR                                                              221145
      *                                                                                       221145
      *****************************************************************
      *   REPT   - Output incorrectly generated message to report     *
      *   Called by   SG210  format single MT210 message              *
      *   Calls       -                                               *
      *****************************************************************
      *
     C           REPT      BEGSR
      *
     C           *IN50     IFEQ '0'
     C                     OPEN MG0210P1
     C                     SETON                     50                   084320
     C************         SETON                     50U7                 084320
     C                     END
      *
      **   Set up headings and sender/customer information
      **       for the error report
     C**********           MOVELMGTNUM    TNUM    60                                          CLE148
     C                     MOVELMGTNUM    TNUM                                                CLE148
     C                     WRITEHEADER
     C                     WRITETEXT
      *
      **  Process multiple occurrence data structure
      *
     C                     Z-ADD0         I       20
     C           I         DOWLEX
     C                     ADD  1         I
     C           I         OCUR MULT
     C                     WRITELINE
     C                     END
     C                     ENDSR
      *
     C/EJECT
      *****************************************************************
      *   SEQN   Retreive the S.W.I.F.T. sequence numbers             *
      *   Called by   COMM  format fields 20, 21, 32(A or B)          *
      *   Calls       -                                               *
      *****************************************************************
      *
     C           SEQN      BEGSR
      *
      **  Obtain sequence numbers from transaction record
      ** if transaction is not a CLS schedule                             CDL008
      *
     C           MGTTYP    IFEQ 'RC'                                      CDL008
     C                     Z-ADD*ZEROS    MGLSWC                          CDL008
     C                     Z-ADD*ZEROS    MGLSWS                          CDL008
     C                     ELSE                                           CDL008
     C                     CALL 'MG5000'               24
     C                     PARM MGMODI    @MODI   2
     C                     PARM MGTNUM    @TRAN  15
     C                     PARM 'PR'      @PROG   2
     C                     PARM *BLANKS   @MODE   1
     C                     PARM *ZEROS    MGLSWC  30
     C                     PARM *ZEROS    MGLSWS  30
     C                     PARM *BLANKS   @ERCD   1
      *
      **  Error on access for sequence number
     C           @ERCD     IFEQ 'Y'
     C           *LOCK     IN   LDA
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Program missing on call
     C           *IN24     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '020'     DBASE            * * * * * * * *
     C                     MOVE 'MG5000'  DBKEY            *  DBERR 020  *
     C                     OUT  LDA                        * * * * * * * *
     C                     EXSR *PSSR
     C                     END
     C                     ENDIF                                          CDL008
     C           *LOCK     IN   LDA
     C                     MOVEL'MG0210  'DBPGM
     C                     OUT  LDA
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   DELT   Delete from the GDF file the records processed       *
      *   Called by   main process                                    *
      *   Calls       -                                               *
      *****************************************************************
      *
     C           DELT      BEGSR
      *
      **  Delete GDF records from the start
      **  of the file, to the last part processed
      *
     C/COPY WNCPYSRC,MG0210C013
     C                     MOVELMGTNUM    SAVNUM 15
     C                     MOVE *BLANKS   MGTNUM
     C           *LOVAL    SETLLMGF210L0
      *
     C           SAVNUM    DOUEQMGTNUM
     C           *IN10     OREQ '1'
     C                     READ MGF210L0                 10
     C                     DELETMGF210L0               16
      *
      **  Error on delete of record.
      *
     C           *IN16     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '021'     DBASE             * * * * * * *
     C                     MOVELMGTNUM    DBKEY             * DBERR 021 *
     C                     MOVEL'MGF210L0'DBFILE            * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     END
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   UPMOD  Update the S.W.I.F.T. sequence numbers               *
      *   Called by   main process                                    *
      *   Calls       -                                               *
      *****************************************************************
      *
     C           UPMOD     BEGSR
      *
      **  For each part of the multiple, update the S.W.I.F.T.
      **  sequence number for that transaction number
      *
     C/COPY WNCPYSRC,MG0210C033
     C           PARTS     IFGT 1
      *
     C                     Z-ADD1         I
     C           I         OCUR PART
      *
     C           @MTRN     DOWNE*BLANKS
     C           @ERCD     ANDEQ*BLANKS
     C           *IN24     ANDEQ'0'
     C           @ERR      ANDNE'Y'
      *
      **  Update sequence numbers on transaction record
      **  if no errors have occurred
      ** and if not a CLS transaction                                     CDL008
      *
     C           MGTTYP    IFNE 'RC'                                      CDL008
     C                     CALL 'MG5000'               24
     C                     PARM MGMODI    @MODI   2
     C                     PARM @MTRN     @TRAN  15
     C                     PARM 'PR'      @PROG   2
     C                     PARM 'U'       @MODE   1
     C                     PARM *ZEROS    MGLSWC  30
     C                     PARM *ZEROS    MGLSWS  30
     C                     PARM *BLANKS   @ERCD   1
     C                     ENDIF                                          CDL008
      *
     C                     ADD  1         I
     C           I         OCUR PART
     C                     END
      *
      **  Update sequence numbers on transaction record for MT210
      **  if no errors have occurred
      ** and if not a CLS transaction                                     CDL008
      *
     C                     ELSE
     C           MGTTYP    IFNE 'RC'                                      CDL008
     C           @ERR      IFNE 'Y'
     C                     CALL 'MG5000'               24
     C                     PARM MGMODI    @MODI   2
     C                     PARM MGTNUM    @TRAN  15
     C                     PARM 'PR'      @PROG   2
     C                     PARM 'U'       @MODE   1
     C                     PARM *ZEROS    MGLSWS  30
     C                     PARM *ZEROS    MGLSWC  30
     C                     PARM *BLANKS   @ERCD   1
     C                     END
     C                     ENDIF                                          CDL008
     C                     END
      *
      **  Error on access for sequence number
     C           @ERCD     IFEQ 'Y'
     C           *LOCK     IN   LDA
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Program missing on call
     C           *IN24     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '023'     DBASE            * * * * * * * *
     C                     MOVE 'MG5000'  DBKEY            *  DBERR 023  *
     C                     OUT  LDA                        * * * * * * * *
     C                     EXSR *PSSR
     C                     END
     C           *LOCK     IN   LDA
     C                     MOVEL'MG0210  'DBPGM
     C                     OUT  LDA
      *
     C/COPY WNCPYSRC,MG0210C034
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   RMVMSG - Remove message part from data structure MULT       *
      *   Called by   MU210  format multiple MT210 message            *
      *   Calls       -                                               *
      *****************************************************************
      *
     C           RMVMSG    BEGSR
      *
      **  Error occurred therefore print out the header
      *
     C           @ERR      IFEQ 'Y'
      *
     C           *IN50     IFEQ '0'
     C                     OPEN MG0210P1
     C                     SETON                     50
     C                     END
      *
      **   Set up Headings and sender/customer information
      **       for the error report
     C**********           MOVELMGTNUM    TNUM    60                                          CLE148
     C                     MOVELMGTNUM    TNUM                                                CLE148
     C                     WRITEHEADER
     C                     WRITETEXT
      *
      **  Print out the header part of the MT210
      *
     C                     Z-ADD0         I       20
     C           I         DOWLTENDHD
     C                     ADD  1         I
     C           I         OCUR MULT
     C                     WRITELINE
     C                     END
     C                     END
      *
      **  Remove the part and output to report if an error
      *
     C                     Z-ADDSTPOS     I
     C           I         DOWLEX
     C                     ADD  1         I
     C           I         OCUR MULT
      *
     C           @ERR      IFEQ 'Y'
     C                     WRITELINE
     C                     END
      *
     C                     MOVE *BLANKS   MULT
     C                     END
      *                                                                   183583
      ** Remove the details from the extension file for this part.        183583
      *                                                                   183583
     C                     Z-ADDSTPOSV    I                               183583
     C           I         OCUR EXTN                                      183583
     C           I         DOWLEV                                         183583
     C                     ADD  1         I                               183583
     C           I         OCUR EXTN                                      183583
     C                     Z-ADD*ZEROS    MPSN                            183583
     C                     MOVE *BLANKS   MTG                             183583
     C                     MOVE *BLANKS   MCSI                            183583
     C                     ENDDO                                          183583
     C                     Z-ADDSTPOSV    V                               183583
      *
      **  Reverse the message details for the part being removed
      **  If bytes remain then add the bytes back to the total
      **  so that they can be reused.
     C                     Z-ADDSTPOS     X
     C           RANOUT    IFEQ 'N'
     C                     ADD  BYTRMV    BYTES
     C                     END
      *
     C           PARTS     OCUR REF210
     C           PARTS     OCUR PART
     C                     MOVE *BLANKS   REF210
     C                     MOVE *BLANKS   PART
     C                     SUB  1         PARTS
      *
      *                                                                   CSW020
      * CSW020: If the swift number decimal places is less than the       CSW020
      *         normal number of decimal place, zeroise the extra decimalsCSW020
      *         when reducing the total amount (TAMT).                    CSW020
     C           WCHGRQ    IFEQ 'Y'                                       CSW020
     C           MGEAMT    DIV  WPOWER    NWEAMT 130                      CSW020
     C                     MULT WPOWER    NWEAMT 130                      CSW020
     C                     SUB  NWEAMT    TAMT                            CSW020
     C                     ELSE                                           CSW020
     C                     SUB  MGEAMT    TAMT
     C                     ENDIF                                          CSW020
      *
      **  If error in first part of MT210, report the error & quit
      **  the MT210 loop defaulting PARTS to 15
      *
     C           @ERR      IFEQ 'Y'
     C           PARTS     ANDEQ0
     C                     Z-ADD15        PARTS
     C                     END
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   WREF - Write reference record to PF/MGOREFPD                *
      *   Called by   OMSG   output message PF/MGOMSGPD               *
      *   Calls       -                                               *
      *****************************************************************
      *
     C           WREF      BEGSR
      *
     C                     MOVE *BLANKS   SYTM
     C                     MOVE MGMODI    MODI
     C                     MOVEL@TRNO     TRNO
     C                     MOVE *BLANKS   TRNF
     C                     MOVE *BLANKS   TRNM
     C                     MOVELMGTNUM    MTRN
     C                     MOVE MGTTYP    TNTP
     C                     MOVE MGTSTP    SBTP
     C                     MOVE '210'     MTPY
     C                     MOVE MGAMTP    EVTP                            E29588
     C                     Z-ADDMGAVDT    AVDT                            E29588
     C                     Z-ADDMGASEQ    ASEQ                            E29588
     C                     MOVE *BLANKS   NWBN
     C**********           MOVE 'N'       MPRY                            138742
      *
     C/COPY WNCPYSRC,MG0210C026
     C                     MOVEL*BLANKS   PTST
     C                     MOVEL*BLANKS   LSCC
     C                     MOVEL*BLANKS   CARQ
     C                     MOVEL*BLANKS   MPDE
     C                     MOVEL@HRDT     HRDT
     C                     TIME           MGTM
     C                     MOVE BJMRDT    LADT
     C                     MOVE MGTM      LATM
      *                                                                                       CSD015
      ** If Watch List Checking is Applied and CSW025 is off,                                 CSD015
      ** do watch processing.                                                                 CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           222385
     C           CSW025    ANDNE'Y'                                                           CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *
     C           MGST      IFEQ 'RSND'
     C                     MOVE BJMRDT    RELD
     C                     MOVE MGTM      RELT
     C                     END
      *
     C                     MOVEL*BLANKS   RUSR
     C                     MOVEL*BLANKS   RWSN
      *
     C                     MOVELZSAMNT    AMTS
     C                     MOVEL*BLANKS   AMTX
      *
      **  Format value date to YYMMDD format
     C                     CALL 'ZM0060'               15
     C                     PARM MGVDAT    ZMDAY   50
     C                     PARM           ZMDATE  6
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '015'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 015  *
     C                     MOVEL'ZM0060'  DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
     C                     MOVELZMDATE    SVDT
      *                                                                   141572
      ** Setup century indicator CINDV for value date SVDT                141572
     C           SVDT      IFEQ *BLANK                                    141572
     C                     MOVE *BLANK    CINDV                           141572
     C                     ELSE                                           141572
     C                     MOVELSVDT      YY      20                      141572
     C           YY        IFLT 72                                        141572
     C                     MOVE '2'       CINDV                           141572
     C                     ELSE                                           141572
     C                     MOVE '1'       CINDV                           141572
     C                     ENDIF                                          141572
     C                     ENDIF                                          141572
      *                                                                   141572
     C                     MOVELMGCCY     CCY
     C                     MOVELMGRONS    NSNO
     C                     MOVEL*BLANKS   SACN
     C                     MOVEL*BLANKS   AORR
     C                     MOVEL*BLANKS   DESI
     C                     Z-ADD0         PT210                           E29588
      *
      **  Branch details
     C/COPY WNCPYSRC,MG0210C014
     C                     MOVE MGROBR    BRCA
     C/COPY WNCPYSRC,MG0210C015
     C                     MOVE MGBRCA    OTHB
     C           OTHB      IFNE *BLANKS
     C                     MOVELMSGA,1    OTHT
     C                     END
     C                     MOVE *BLANKS   RCBR
      *
     C                     MOVE *BLANKS   NETI
     C**********           MOVE *BLANKS   DELC                            138742
     C                     MOVE *BLANKS   DYST
     C                     MOVE *BLANKS   RSID
     C                     MOVE *BLANKS   MSE1
     C                     MOVE *BLANKS   ELIN
     C                     MOVE *BLANKS   SSAC
     C                     MOVE *BLANKS   MIR
     C                     MOVE *BLANKS   TSKS
     C                     MOVE *BLANKS   TSKY
      *                                                                                       196833
      ** Change the Destination for CLS payments                                              196833
      *                                                                                       196833
     C                     EXSR SRDEST                                                        196833
      *                                                                   S01408
     C/COPY WNCPYSRC,MG0210CCP2                                           S01408
      *                                                                   S01408
      *
     C                     MOVE MGCHTP    AORR                                                CSW025
     C                     WRITEMGOREFD0               05
      *
      **  Error on write to PF/MGOREFPD (message reference file)
     C           *IN05     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '016'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 016  *
     C                     MOVEL'MGOREFPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C/COPY WNCPYSRC,MG0210C001
     C*
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   WREFM - Write a reference record for mulyiple MT210 parts   *
      *   Called by   OMSG  output message PF/MGOMSGPD                *
      *   Calls       -                                               *
      *****************************************************************
      *
     C           WREFM     BEGSR
      *
     C                     MOVE *BLANKS   SYTM
     C                     MOVE MGMODI    MODI
     C                     MOVEL@MTRN     MTRN
     C                     MOVEL@TNTP     TNTP
     C                     MOVEL@SBTP     SBTP
     C                     MOVE '210'     MTPY
     C                     MOVE MGAMTP    EVTP                            E29588
     C                     Z-ADDMGAVDT    AVDT                            E29588
     C                     Z-ADDMGASEQ    ASEQ                            E29588
     C                     MOVE *BLANKS   NWBN
     C                     MOVE 'N'       MPRY
      *
     C/COPY WNCPYSRC,MG0210C027
     C                     MOVEL*BLANKS   PTST
     C                     MOVEL*BLANKS   LSCC
     C                     MOVEL*BLANKS   CARQ
     C                     MOVEL*BLANKS   MPDE
     C                     MOVEL@HRDT     HRDT
     C                     TIME           MGTM
     C                     MOVE BJMRDT    LADT
     C                     MOVE MGTM      LATM
      *                                                                                       CSD015
      ** If Watch List Checking is Applied and CSW025 is off,                                 CSD015
      ** do watch processing.                                                                 CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           222385
     C           CSW025    ANDNE'Y'                                                           CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *
     C           MGST      IFEQ 'RSND'
     C                     MOVE BJMRDT    RELD
     C                     MOVE MGTM      RELT
     C                     END
      *
     C                     MOVEL*BLANKS   RUSR
     C                     MOVEL*BLANKS   RWSN
     C                     MOVEL@AMTS     AMTS
      *
      **  Format value date to YYMMDD format
     C                     CALL 'ZM0060'               15
     C                     PARM MGVDAT    ZMDAY   50
     C                     PARM           ZMDATE  6
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '017'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 017  *
     C                     MOVEL'ZM0060'  DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
     C                     MOVELZMDATE    SVDT
      *                                                                   141572
      ** Setup century indicator CINDV for value date SVDT                141572
     C           SVDT      IFEQ *BLANK                                    141572
     C                     MOVE *BLANK    CINDV                           141572
     C                     ELSE                                           141572
     C                     MOVELSVDT      YY      20                      141572
     C           YY        IFLT 72                                        141572
     C                     MOVE '2'       CINDV                           141572
     C                     ELSE                                           141572
     C                     MOVE '1'       CINDV                           141572
     C                     ENDIF                                          141572
     C                     ENDIF                                          141572
      *                                                                   141572
     C                     MOVELMGCCY     CCY
     C                     MOVELMGRONS    NSNO
     C                     MOVEL*BLANKS   SACN
     C                     MOVEL*BLANKS   AORR
     C                     MOVEL*BLANKS   DESI
      *
      **  Branch details
     C/COPY WNCPYSRC,MG0210C016
     C                     MOVE MGROBR    BRCA
     C/COPY WNCPYSRC,MG0210C017
     C                     MOVE @OTHB     OTHB
     C********** OTHB      IFNE *BLANKS                                   E29588
     C******************** MOVELMSGA,1    OTHT                            E29588
     C******************** END                                            E29588
     C           OTHB      IFNE *BLANKS                                   060799
     C                     MOVELMSGA,1    OTHT                            060799
     C                     ELSE                                           060799
     C                     MOVE *BLANKS   OTHT                            060799
     C                     END                                            060799
     C                     MOVE *BLANKS   RCBR
      *
     C                     MOVE *BLANKS   NETI
     C                     MOVE *BLANKS   DELC
     C                     MOVE *BLANKS   DYST
     C                     MOVE *BLANKS   RSID
     C                     MOVE *BLANKS   MSE1
     C                     MOVE *BLANKS   ELIN
     C                     MOVE *BLANKS   SSAC
     C                     MOVE *BLANKS   MIR
     C                     MOVE *BLANKS   TSKS
     C                     MOVE *BLANKS   TSKY
      *                                                                                       196833
      ** Change the Destination for CLS payments                                              196833
      *                                                                                       196833
     C                     EXSR SRDEST                                                        196833
      *                                                                   S01408
     C/COPY WNCPYSRC,MG0210CCP3                                           S01408
      *                                                                   S01408
      *
     C                     MOVE MGCHTP    AORR                                                CSW025
     C                     WRITEMGOREFD0               05
      *
      **  Error on write to PF/MGOREFPD (message reference file)
     C           *IN05     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '018'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 018  *
     C                     MOVEL'MGOREFPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C/COPY WNCPYSRC,MG0210C002
     C*
     C                     ENDSR
     C/EJECT
      *****************************************************************                       196833
      *                                                               *                       196833
      *  SRDEST - Destination for CLS Receipts                        *                       196833
      *           For CLS receipts, override Destination equal to     *                       196833
      *           'Alternative CLS Funding SWIFT ID' from the         *                       196833
      *           Nostro details file.                                *                       196833
      *                                                               *                       196833
      *****************************************************************                       196833
      *                                                                                       196833
     C           SRDEST    BEGSR                                                              196833
      *                                                                                       196833
     C           MGTTYP    IFEQ 'RC'                                                          196833
      *                                                                                       196833
     C           KCLS      KLIST                                                              196833
     C                     KFLD           WCCY    3                                           196833
     C                     KFLD           WLPR    2                                           196833
      *                                                                                       196833
     C           3         SUBSTTRNO:3    WCCY                                                196833
     C           2         SUBSTTRNO:6    WLPR                                                196833
      *                                                                                       196833
     C           KCLS      CHAINSDNOSTL8             80                                       196833
      *                                                                                       196833
      ** If dummy nostro is not found, database error.                                        196833
      *                                                                                       196833
     C           *IN80     IFEQ *ON                                                           196833
     C           *LOCK     IN   LDA                                                           196833
     C                     MOVEL'SDNOSTL8'DBFILE                                              196833
     C                     Z-ADD030       DBASE                                               196833
     C           WCCY      CAT  WLPR:1    DBKEY                                               196833
     C                     OUT  LDA                                                           196833
     C                     EXSR *PSSR                                                         196833
      *                                                                                       196833
      ** Else, set Destination = Alternative CLS Funding SWIFT ID,                            196833
      ** if it is not blank.                                                                  196833
      *                                                                                       196833
     C                     ELSE                                                               196833
     C           A7ASID    IFNE *BLANKS                                                       196833
     C                     MOVELA7ASID    NWDS                                                196833
     C                     ENDIF                                                              196833
     C                     ENDIF                                                              196833
      *                                                                                       196833
     C                     ENDIF                                                              196833
      *                                                                                       196833
     C                     ENDSR                                                              196833
      *                                                                                       196833
      *****************************************************************                       196833
      /EJECT                                                                                  196833
      *****************************************************************   CDL002
      *   UPDAT - Dummy update of FXNETML4 due to MG5000              *   CDL002
      *****************************************************************   CDL002
      *                                                                   CDL002
     C           UPDAT     BEGSR                                          CDL002
      *                                                                   CDL002
     C                     OPEN FXNETML4                                  CDL002
     C   25N25             UPDATFXNETMD0                                  CDL002
     C                     CLOSEFXNETML4                                  CDL002
      *                                                                   CDL002
     C                     ENDSR                                          CDL002
     C/COPY WNCPYSRC,MG0210C039
      *****************************************************************
      *   *PSSR - error handling                                      *
      *****************************************************************
      *
     C           *PSSR     BEGSR
      *
      **  Write database error to report
     C                     OPEN MG0210AU
     C                     WRITEHEAD
     C                     WRITEDBERROR
      *
     C                     SETON                     U7U8LR
     C                     DUMP
     C                     RETRN
      *
     C                     ENDSR
      *                                                                                       162270
      *****************************************************************                       162270
      *   SRACID inital process                                       *                       162270
      *   Called by - SRROUT, SRACID and FMTHD                        *                       162270
      *   Calls     -                                                 *                       162270
      *****************************************************************                       162270
      *                                                                                       162270
     C           SRACID    BEGSR                                                              162270
      *                                                                                       162270
     C           MGMODI    IFEQ 'SE'                                                          162270
     C           MGRIBN    ANDNE*BLANKS                                                       162270
     C                     MOVELMGTNUM    WFKEY   6                                           162270
     C           WFKEY     CHAINTRADSDD1             99                                       162270
      *                                                                                       162270
     C           *IN99     IFEQ '1'                                                           162270
     C           *LOCK     IN   LDA                                                           162270
     C                     MOVE '025'     DBASE            * * * * * * * *                    162270
     C                     MOVELWFKEY     DBKEY            *  DBERR 025  *                    162270
     C                     MOVEL'TRADSDX1'DBFILE           * * * * * * * *                    162270
     C                     OUT  LDA                                                           162270
     C                     EXSR *PSSR                                                         162270
     C                     END                                                                162270
      *                                                                                       162270
     C                     MOVE *BLANKS   WACID  11                                           162270
      *                                                                                       248359
      ** If 1st Safekeeping Account is non-blank (T1SAFA - TRADSDX1)                          248359
      *                                                                                       248359
     C           T1SAFA    IFNE *BLANKS                                                       248359
      *                                                                                       248359
     C                     MOVE *BLANKS   WSAFA5  5                                           162270
     C           SA0101    IFEQ '/'                                                           248359
     C                     MOVE T1SAFA    WSAFA5                                              162270
     C                     ELSE                                                               248359
     C                     MOVELT1SAFA    WSAFA5                                              248359
     C                     ENDIF                                                              248359
     C                     MOVE WSAFA5    WACID                                               162270
      ** Else, check 2nd Safekeeping Account (T2SKAL - TRADSDX2)                              248359
      *                                                                                       248359
     C                     ELSE                                                               248359
      *                                                                                       248359
     C           T2KEY     KLIST                                                              248359
     C                     KFLD           WFKEY                                               248359
     C                     KFLD           T2WHEN                                              248359
      *                                                                                       248359
     C           CSW003    IFEQ 'Y'                                                           248359
     C                     MOVE 'A'       T2WHEN  1                                           248359
     C                     ELSE                                                               248359
     C                     MOVE *BLANK    T2WHEN                                              248359
     C                     ENDIF                                                              248359
      *                                                                                       248359
     C           T2KEY     CHAINTRADSDY2             99                                       248359
      *                                                                                       248359
     C                     MOVE *BLANKS   WSAFA5                                              248359
     C           *IN99     IFEQ '0'                                                           248359
     C                     MOVELT2SKAL    WSAFA5                                              248359
     C                     ENDIF                                                              248359
     C                     MOVE WSAFA5    WACID                                               248359
      *                                                                                       248359
     C                     ENDIF                                                              248359
      *                                                                                       162270
      **  Access SDCUSTPD using                                                               162270
      *                                                                                       162270
     C                     MOVE *BLANKS   @KEY1                                               162270
     C                     MOVELDECN      @KEY1                                               162270
     C                     CALL 'AOCUSTR0'                                                    162270
     C                     PARM '*MSG   ' @RTCD                                               162270
     C                     PARM '*KEY   ' @OPTN                                               162270
     C                     PARM           @KEY1  10                                           162270
     C                     PARM *BLANKS   @KYST   7                                           162270
     C           SDCUST    PARM SDCUST    DSSDY                                               162270
     C                     MOVE *BLANKS   WCRNM5  5                                           162270
     C                     MOVELBBCRNM    WCRNM5                                              162270
     C                     MOVELWCRNM5    WACID                                               162270
     C                     END                                                                162270
      *                                                                                       162270
     C                     ENDSR                                                              162270
      *                                                                                       162270
     C/COPY WNCPYSRC,MG0210C035
     C/EJECT
      *
     C/COPY MGCPYSRC,SWIFTTRANS                                           BLI605
** CPY@   Object Copyright
(c) Misys International Banking Systems Ltd. 2001
** MSGA   Messages
Booking
Customer details not found on SDCUSTPD
ZM0040 (format ccy and amount) call ended in error
ZM0050 (format SWIFT address) call ended in error
ZM0040 (format amount) call ended in error
Duplicate TRN (ref.) key built for this message
Duplicate TRN (ref.) key for this message
