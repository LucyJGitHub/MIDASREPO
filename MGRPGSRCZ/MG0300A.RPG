     H        1                           F
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas MG Format FX conf. msg - SWIFT97 version')       *
      *****************************************************************
      *                                                               *
      *  Midas - Message Generation                                   *
      *                                                               *
      *  MG0300A - Foreign Exchange Confirmation Message Formatting   *
      *            SWIFT97 Version                                    *
      *                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. CSW216             Date 14Mar16               *
      *  Prev Amend No. MD039569           Date 01Aug16               *
      *                 CGL165             Date 17Feb15               *
      *                 MD031101           Date 19Nov14               *
      *                 MD030913           Date 25Nov14               *
      *                 MD029064           Date 25Nov14               *
      *                 MD029017           Date 25Nov14               *
      *                 MD028085           Date 25Nov14               *
      *                 MD027855           Date 25Nov14               *
      *                 CSW214             Date 25Nov14               *
      *                 CDL096             Date 22Sep14               *
      *                 CDL094             Date 03Jun14               *
      *                 MD020963           Date 19Aug14               *
      *                 261612             Date 26Jun12               *
      *                 MD023007           Date 24Oct13               *
      *                 MD023798           Date 26Nov13               *
      *                 MD022981           Date 12Nov13               *
      *                 MD022633A          Date 17Oct13               *
      *                 MD022579           Date 02Oct13               *
      *                 MD023009           Date 23Oct13               *
      *                 MD022633           Date 03Oct13               *
      *                 MD022367           Date 16Sep13               *
      *                 CSW213             Date 03Jun13               *
      *                 CLE148             Date 23Jul12               *
      *                 AR994044           Date 26Jun12               *
      *                 CSW212             Date 03May12               *
      *                 CCB020             Date 06Aug12
      *                 255986B            Date 20Nov09               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 255986             Date 12Sep08               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      *                 139406             Date 06Dec06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CDL049             Date 07Jul06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CDL038             Date 10May05               *
      *                 CDL028             Date 07Feb05               *
      *                 CSW037A            Date 02May05               *
      *                 BUG6548            Date 11Apr05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 222373             Date 27Oct03               *
      *                 222385             Date 23Oct03               *
      *                 221145             Date 08Sep03               *
      *                 219242             Date 01Jul03               *
      *                 219241             Date 01Jul03               *
      *                 CSD015             Date 14Oct02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 206355             Date  1Jul02               *
      *                 202275             Date 07Mar02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CSW025             Date 26Mar02               *
      *                 200478             Date 06Dec01               *
      *                 CSW024             Date 31Aug01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CSW201             Date 02May01               *
      *                 183583             Date 31Jun01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 190127             Date 28Feb01               *
      *                 180372             Date 20Jun00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 187585             Date 08Dec00               *
      *                 CDL008             Date 02May00               *
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 139247             Date 27Apr99               *
      *                 141572             Date 21Sep98               *
      *                 144040             Date 26Oct98               *
      *                 125375             Date 17Jul98               *
      *                 137909             Date 22Jul98               *
      *                 CSW013             Date 18Mar98               *
      *                 122377             Date 10Sep97               *
      *                 CSW012             Date 26May97               *
      *                 CSW097 *CREATE     Date 26May97               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  CSW216 - SWIFT Changes 2016                                  *
      *  MD039569 - Field 58 not reflected in MT300                   *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  MD031101 - MT300-Missing 'Our Account No. at Nostro' in Field*
      *             57 in subseq. B1 of seq 15B (for Receipt-Nostro)  *
      *           - get Our Account No. at Nostro if no Receipt       *
      *             Delivery Agent defined in Receipt Nostro          *
      *  MD030913 - Two MT300 generated for Trade Repository          *
      *  MD029064 - Field 89J /CLRC/CP is missing in MT300 in SP19    *
      *  MD029017 - Tag 22A value is AMND instead of NEWT             *
      *  MD028085 - MT300 Field 89J  /CLRC/ Clearing System Code      *
      *             and Clearing Identification should have no spaces *
      *             in between                                        *
      *  MD027855 - Field 89J /CLRC/CP is missing in MT300            *
      *  CSW214 - SWIFT Changes 2014                                  *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *  MD020963 - If the field tag for 83 comes as 'D' output :83D  *
      *  261612 - MT300 rate problem beteen Midas Plus and Meridian.  *
      *           Ensure that the system is able to handle the        *
      *           processing of 12 digit Exchange Rates.              *
      *  MD023007 - Inaccurate writing sequence on repeating fields   *
      *             of RPIF details in MT generation                  *
      *  MD023798 - Invalid format for tag 98D                        *
      *  MD022981 - Seq 15E without succeeding field tags generated   *
      *  MD022633A - Properly set-up the value for tags 22L and 91J   *
      *  MD022579 - MT300 not generated when Trade Repo ID is changed *
      *  MD023009 - MT300 Message 15E is out of sequence              *
      *  MD022633 - Allow reporting details with '0' Transaction      *
      *             Identifier type for different reporting           *
      *             jurisdiction and reporting party ID combinations. *
      *  MD022367 - MT300 Incorrect value for field tag 21 during     *
      *             AMEND and DELETE of FXDL                          *
      *  CSW213 - SWIFT Changes 2013                                  *
      *  CLE148 - Alpha Loan Reference                                *
      *  AR994044 - Field tag 72 Seq C is missing in MT300 if deal    *
      *             type is AT and CSW212 and CSW005 is on.           *
      *  CSW212 - SWIFT 2012 Changes                                  *
      *  CCB020 - COB Restructure - Secondary COB - Infrastracture    *
      *  255986B - Introduce system value 'PopBTBConf' to populate    *
      *            Bank to Bank information in confirmation           *
      *  255986 - Field 72 to be included in MT300                    *
      *  139406 - For Forward with option Value date should be        *
      *           Option to date.                                     *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  CSW037A- Additional Field extended to 40 chars               *
      *  BUG6548- Field 83J appearing twice in message.               *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320.               *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222373 - Parameter Mismatch.                                 *
      *  222385 - SWIFT msgs are Watch List checked regardless of     *
      *           configuration file setting                          *
      *  221145 - Compliance Watch WLC: Move compliance check to      *
      *           after COMIT to MGOMSGPD                             *
      *  219242 - Not possible to create MT103+ payment msg from      *
      *           non-FT transaction (Recompile)                      *
      *  219241 - Defaulting of "Details of Charges" assign a         *
      *           system value (Recompile)                            *
      *  CSD015 - Midas Compliance Watch - Watch List Checking        *
      *  206355 - Database error in MG0300A @22 file SDCUSTPD.        *
      *           Increase the size of variable @KEY2 from 8 to 10    *
      *           so that it will be of same size as variable P@KEY1  *
      *           in AOCUSTR0.                                        *
      *  202275 - Remove the final '/' in field 72.                   *
      *  CSW025 - Midas Message Manager                               *
      *           - Pass original change type                         *
      *  200478 - FX Netting: MT300 does not show correct information *
      *           on field 57A. It should show text 'TO BE NETTED'.   *
      *  CSW024 - MT3xx field 82/83/87 changes                        *
      *  CSW201 - SWIFT 2001 Standards Update                         *
      *  183583 - Add extension file MGOEXTPD to store customer no.   *
      *           of field with SWIFT address.                        *
      *           Also added the use of AOCNSTR0 in SR/FMT83 in case  *
      *           that the beneficiary specified for the deal is a    *
      *           counterparty nostro.                                *
      *  190127 - Related reference should contain tansaction         *
      *           reference of previous message of same type          *
      *  180372 - DBERR 22 when Beneficiary is a counterparty Nostro. *
      *  187585 - Block 3 Code for CLS should not be mandatory        *
      *  CDL008 - Continuous Linked Settlement                        *
     F*  139247 - If DIRECT entered, use Beneficiary for :57: on Pay  *
     F*           Sequence. Apply fix 088043.                         *
     F*  141572 - Setup CINDV (century flag) SVDT ( value date).      *
     F*  139247 - If DIRECT entered, use Beneficiary for :57: on Pay  *
     F*           Sequence. Apply fix 088043.                         *
     F*  144040 - Set-up CIND (Century Flag) to correct YEAR2000      *
     F*           display problem.                                    *
     F*  125375 - If the broker only uses electronic dealing then     *
     F*           specify ELEC in field 24D and do not specify broker *
     F*           details in field 88.                                *
     F*  137909 - Use the payment or receipt settlement currency if   *
     F*           not blank for accessing nostro details. This is     *
     F*           needed tag 53A and tag 57A.                         *
     F*  CSW013 - Suppress fields :82a: and :87a: for SWIFT           *
     F*           April 1998 changes.                                 *
     F*  122377 - Only process :58 if MGBENN is not blank.            *
     F*  CSW012 - Extract Contact person details for MT300.           *
     F*  CSW097 - Swift Changes 1997                                  *
     F*           o taken from MG0300 changing only FMTA, FMTB and    *
     F*             FMTC to output the new MT300 message              *
     F*           o Field :57 processing is also changed such that    *
     F*             if Account with Bank = 'DIRECT', this should be   *
     F*             the pay nostro and fld :53 should not appear.     *
     F*                                                               *
     F*****************************************************************
      *
      ** MT300 Generation Driver File
     FMGF300PDUF  E                    DISK
     F                                              KCOMIT
      *
      ** MG Message Reference by TRNO
     FMGOREFL0IF  E           K        DISK
     F            MGOREFD0                          KRENAMEMGREFL0
      *
      ** SD Customer Details                                                                  CDL094
     FSDCUSTL7IF  E           K        DISK                                                   CDL094
      *                                                                                       CDL094
      ** MG Master Messages Reference File
     FMGOREFPDO   E                    DISK
     F                                              KCOMIT
      *
     FDEALS   IF  E           K        DISK                           UC                      200478
     F            DEALSDAF                          KIGNORE                                   200478
     F            DEALSDCF                          KIGNORE                                   200478
     F            DEALSDDF                          KIGNORE                                   200478
     F            DEALSDEF                          KIGNORE                                   200478
     F            DEALSDGF                          KIGNORE                                   200478
     F            DEALSDFF                          KIGNORE                                   200478
      *                                                                                       200478
      ** MG Master Message Data File
     FMGOMSGPDO   E                    DISK
     F                                              KCOMIT
     FDLRPIFL1IF  E           K        DISK                           UC                    MD022981
      *                                                                                       190127
      ** MG Transaction history file                                                          190127
     F***MGHISTL0UF  E           K        DISK                      A                  190127 CSW213
     F**********                                    KCOMIT                             190127 CSW213
     FMGHISTL7UF  E           K        DISK                      A                            CSW213
     F                                              KCOMIT                                    CSW213
     F/COPY WNCPYSRC,MG0300AF01
     FMGOEXTPDO   E                    DISK                               183583
     F                                              KCOMIT                183583
      *
      ** MG FX Confirmation Formatting Error Report
     F***MG0300P1O   E                    PRINTER                        UC                   CSW213
     FMG0300P1O   E             99     PRINTER                        UC                      CSW213
      *
      ** MG FX Confirmation Formatting Audit Report
     FMG0300AUO   E                    PRINTER                        UC
     F*
     F/COPY WNCPYSRC,MG0300FFP1
     F*
      *
      ********************************************************************
      *
      * ID C  F  H  L    FUNCTION OF INDICATORS
      *
      *    05            Error on write to PF/MGOREFPD
      *    06            Error on write to PF/MGOMSGPD
      *    10            EOF MGF300PD
      *    11            CHAIN to MGOREFL0 (TRN unique ?)
      *    15            Error in call to standard program (ZMxxxx)
      *    16            Error on delete of GDF record.
      *    22            LOKUP operation for determining the codeword
      *    23            LOKUP operation for settlement code
      *    24            Error on call of MG5000
      *    25            ConCord Interface is ON.
      *    30            Feedback record not generated
      *    50            MG0300P1 open
      *    55            Tag 53A already generated
      *    U7U8          Database error
      *
     F********************************************************************
     E/EJECT
      *
      ** Array Containing Copyright statement
     E                    CPY@    1   1 80
      *
      ** Array Containing Messages
     E                    MSGA    1   8 60
      *
      ** Selection Criteria for the codeword
     E                    TABSLT  1  22 22
      *
      ** Resulting codeword (selected codewrod value)
     E                    TABRST  1  22 10
      *
      ** Selection Criteria for the codewrod (SWIFT96)
     E                    TABS96  1  18 22   TABR96 10
      *
      ** Codes indicating settlement via nostro
     E                    TABNST  1   5  2
      *
      ** Codes indicating settlement via internal
     E                    TABINT  1   5  2
     E/COPY WNCPYSRC,MG0300AE01
      *
      ** Concatenation field
     E                    @WRK       50  1
     E                    @BTB        6 35                                                    255986
      *
     E                    IX          4  1 0                                                MD023007
      *
     I/COPY WNCPYSRC,MG0300IIP2
      *
      **  Rename conflicting MGOREFL0 fields
     IMGREFL0
     I              SYTM                            MSYTM
     I              NWRK                            MNWRK
     I              SECN                            MSECN
     I              NWSN                            MNWSN
     I              DECN                            MDECN
     I              NWDS                            MNWDS
     I              MGSG                            MMGSG
     I              MGST                            MMGST
     I              F57U                            MF57U
     I              LSCC                            MLSCC
     I              HRDT                            MHRDT
     I              MGDE                            MMGDE
     I              MGTM                            MMGTM
     I              LADT                            MLADT
     I              RELD                            MRELD
     I              RELT                            MRELT
     I              CFPF                            MCFPF
     I              TODY                            MTODY
     I              CLSS                            MCLSS                 CDL008
      *
      **  Multiple occurrence data structure for message
     IMULT        DS                         95
     I                                        1   5 MTAG
     I                                        6  55 MFLD
     I                                       56 105 MERR
      *
     IEXTN        DS                         45                           183583
     I                                        1   20MPSN                  183583
     I                                        3   7 MTG                   183583
     I                                        8  15 MCSI                  183583
      *                                                                   183583
      ** Multiple occurrence data structure for extension file            183583
      *                                                                   183583
     I            DS                                                      183583
     I                                        1   5 @MTG                  183583
     I                                        2   2 FLDTYP                183583
     I                                        4   4 FLDTAG                183583
      *                                                                   183583
      ** Field tag data structure                                         183583
      *                                                                   183583
      **  Data structure build transaction reference number
     I@TRN        DS                         16
     I                                        1   2 @TR1
     I                                        3   8 @TR2
     I                                        9  110@TR3
     I                                       12  16 @TR4
      *
      **  Data structure build transaction reference number                                   CSW213
     I@TRN1       DS                         16                                               CSW213
     I                                        1   2 @TRN11                                    CSW213
     I                                        3   8 @TRN21                                    CSW213
     I                                        9  14 @TRN31                                    CSW213
     I                                       15  160@TRN41                                    CSW213
     I                                        3  14 @TRNID                                    CSW213
      *                                                                                       CSW213
      **  Data structure to build key to determine codeword
     ISEARCH      DS                         22
     I                                        1   6 @MGST
     I                                        8  15 @LSCC
     I                                       17  17 @OF57
     I                                       19  22 @NOST
      *
      **  Data structure containing codeword for the new message
     ICODEWD      DS                         22
     I                                        1   8 CWRD
     I                                       10  10 F57U
      *
      **  Data structure containing codeword for FieldS 32B/32B
     IFLD2N       DS                         18
     I                                        1   3 ZSCCY
     I                                        4  18 ZSAMNT
      *
      **  Erroneous currency & amounts for Fields 32B/32B
     IERR3N       DS                         24
     I                                        1   3 ZCCY
     I                                        5  17 ZAMT
      *
      **  Data structure constructing message field tag
     I@MTAG       DS                          5
     I                                        1   1 COLON1
     I                                        2   3 FLDNO
     I                                        4   4 TAG
     I                                        5   5 COLON2
      *
      ****Data*structure to check MPHAS for Close of Business                                 CCB020
     I*MPHAS****   DS                                                                         CCB020
     I**********                              1   1 STATUS                                    CCB020
      *
      ** Data structure for input parameter
     IP@IN        DS                            256
     I                                        1   3 I@SNBR
     I                                        4   9 I@DSCN
     I                                       10  12 I@MTPY
     I                                       13  140I@SETT
     I                                       15  15 I@CONC
     I                                       16  16 I@FTCS
     I                                       17  18 I@MMOD
      *
      ** Data structure for ouput parameter
     IP@OUT       DS                            256
     I**********                              1   60O@CNSN                                    CSD027
     I                                        1   6 O@CNSN                                    CSD027
     I                                        7  18 O@SWSN
     I                                       19  38 O@NWSN
     I                                       39  49 O@SWDS
     I                                       46  46 W@96CN
     I                                       47  49 W@BIC
     I                                       50  69 O@NWDS
     I                                       70  75 O@NWRK
     I                                       76  76 O@MGSG
     I                                       77  80 O@MGST
     I                                       81  81 O@PAIN
     I                                       82  87 O@PCNB
     I                                       88  90 O@SPRS
      *                                                                                      255986B
     I**********    'PopBTBConf          'C         APOPB                           255986B AR994044
     I              'PopSTRConf          'C         APOPB                                   AR994044
      *                                                                                       190127
      **  Data structure for related reference                                                190127
     I@HREF       DS                         16                                               190127
     I                                        1   2 HSMODI                                    190127
     I                                        3   8 HSTRAN                                    190127
     I                                        9  11 HSSEQ                                     190127
      *                                                                                       CSW213
      **  Data structure for related reference CSW213                                         CSW213
     I@HREF1      DS                         16                                               CSW213
     I                                        1   2 H1MODI                                    CSW213
     I                                        3   8 H1TRAN                                    CSW213
     I                                        9  14 HSDEST                                    CSW213
     I                                       15  16 @SSEQ                                     CSW213
      *                                                                                       CSW213
      ** Multiple occurrence data structure for reporting party                               CSW213
     IRPPT        DS                          5                                               CSW213
     I                                        1  35 MGRJXX                                    CSW213
     I                                       36  41 MGRPXX                                    CSW213
     I                                       42  61 MGRNXX                                    CSW213
     I                                       62  71 MGRCXX                                    CSW213
     I                                       72  82 MGRSXX                                    CSW213
     I                                       83 102 MGRLXX                                    CSW213
     I                                      103 136 MGRAXX                                    CSW213
     I**********                            137 146 MGUTXX                             CSW213 CSW214
     I**********                            147 178 MGTNXX                             CSW213 CSW214
     I**********                            179 179 MGTIXX                             CSW213 CSW214
     I**********                            180 180 MGETXX                             CSW213 CSW214
     I**********                            137 156 MGUTXX                             CSW214 CSW216
     I**********                            157 188 MGTNXX                             CSW214 CSW216
     I**********                            189 189 MGTIXX                             CSW214 CSW216
     I**********                            190 190 MGETXX                             CSW214 CSW216
     I                                      137 166 MGUTXX                                    CSW216
     I                                      167 198 MGTNXX                                    CSW216
     I                                      199 199 MGTIXX                                    CSW216
     I                                      200 200 MGETXX                                    CSW216
      *                                                                                       CSW213
     I/COPY WNCPYSRC,MG0300AI01
      *
      ** Watch list checking details                                                          222385
     ISDWLCC    E DSSDWLCCPD                                                                  222385
      *                                                                                       222385
      **  Data structure for Customer Extensions SWIFT Details                                CSW213
     ISDCSSW    E DSSDCSSWPD                                                                  CSW213
      *                                                                                       CSW213
      **  Data structure for bank file
     ISDBANK    E DSSDBANKPD
      *
      **  Data structure for trading file
     ISDTRAD    E DSSDTRADPD
      *
      **  Data structure for customer file
     ISDCUST    E DSSDCUSTPD
      *
      **  Data structure for branch file
     ISDBRCH    E DSSDBRCHPD
     I              QQDFAC                          DFACQQ                                    CGL029
      *
      **  Data structure for broker file
     ISDBROK    E DSSDBROKPD
      *
      **  Data structure for module ICD file
     ISDMMOD    E DSSDMMODPD
      *
      **  Data structure for nostro file
     ISDNOST    E DSSDNOSTPD
     I              QQACCD                          ACCDQQ                                    CGL029
      *
      **  Data structure for message management data.
     ISDMGME    E DSSDMGMEPD
      *
      **  Data structure for SAR - Switchable features file
     ISCSARD    E DSSCSARDPD
      *                                                                                       180372
     ISDCNST    E DSSDCNSTPD                                                                  180372
      **  Data structure for counterparty nostro file                                         180372
      *
     IWLTDS     E DSSDWLTOPD                                                                  CSD015
      ** Watch List Transaction Details Data Structure                                        CSD015
      *                                                                                       CSD015
     IPSTRNG      DS                           9999                                           CSD015
      ** SDWLCLOP Search String Parameter                                                     CSD015
      *                                                                                       CSD015
      **  Short data structure for access programs
     IDSFDY     E DSDSFDY
      *
      **  Long data structure for access programs
     IDSSDY     E DSDSSDY
      *
     IDSLDY     E DSDSLDY                                                                     CSW024
      ** Third data structure for access programs                                             CSW024
      *                                                                                       CSW024
      **  Local data area
     ILDA         DS                            256
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
      *
     I/COPY WNCPYSRC,MG0300IIP1
      *
     C/EJECT
      *****************************************************************
      *                   Index to subroutines                        *
      *                                                               *
      *   Main process                                                *
      *   SRINIT  - Initial process                                   *
      *   SRINTF  - Initialise non-constant fields                    *
      *   SRROUT  - Determine message routing                         *
      *   SRFMTA  - Format message detail - Sequence A                *
      *   SRFMTB  - Format message detail - Sequence B                *
      *   SRFMTC  - Format message detail - Sequence C                *
      *   SRFMTE  - Format message detail - Sequence E                *                       CSW213
      *   SRFMPY  - Format message - Cust. Extension SWIFT Details    *                       CSW213
      *   SRCODE  - Calculate codeword for fields 21/22               *
      *   SRPAYE  - Pay side field 57 (KNOWN or UNKNOWN)              *
      *   FSWAD - Format SWIFT address                                *
      *   FMT72 - Format Field 72                                     *                       255986
      *   FMT53 - Format Field 53  sequence B                         *
      *   FMTC1 - Format fields 56 & 57 for FMTC                      *
      *   SRREPT  - Print incorrectly generated messages              *
      *   SROMSG  - Output correctly generated messages               *
      *   SRWREF  - Write reference record to PF/MGOREFPD             *
      *   *PSSR - Error handling                                      *
      *                                                               *
      *   NOTE:   A multiple occurrence data structure is used to     *
      *           store up the records that make up the SWIFT message *
      *           before writing the whole message to file.           *
      *           To store the records of the message, you must       *
      *           first access an OCUR record, obtain the Message Tag *
      *           & Message field data values for this OCUR record,   *
      *           then go on to the next OCUR record and continue     *
      *           this process until the SWIFT message is complete.   *
      *****************************************************************
     C/EJECT
      *                                                                                       190127
      **  Transaction history key                                                             190127
     C           HSKEY     KLIST                                                              190127
     C                     KFLD           MGMODI                                              190127
     C                     KFLD           HSTRAN                                              190127
     C                     KFLD           HSDEST                                              CSW213
     C                     KFLD           HSMTPY                                              190127
      *
      ** Initial process
      *
     C/COPY WNCPYSRC,MG0300CCP3
      *
     C                     EXSR SRINIT
      *
      * Access Switchable features file to see if ConCord is switched
      * ON.
      *
     C                     CALL 'AOSARDR0'
     C                     PARM '       ' RTCDA   7
     C                     PARM '*VERIFY' RTCDB   7
     C                     PARM 'CCF001'  RTCDC   6
      *
     C           RTCDA     IFEQ *BLANK
     C                     MOVE *ON       *IN25
     C                     ENDIF
     C/COPY WNCPYSRC,MG0300AC12
      *
      ** Read the first record from the MT300 extract file
      *
     C                     READ MGF300PD                 10
      *
      ** Do While records found on the MT300 extract file
      *
     C           *IN10     DOWEQ'0'
     C/COPY WNCPYSRC,MG0300AC13
      * If DEALING MSG and NETTING access DEALS file                                          200478
     C           CDL002    IFEQ 'Y'                                                           200478
     C           MGMODI    ANDEQ'DL'                                                          200478
     C                     MOVELMGTNUM    KYDLNO  60                                          200478
     C           KYDLNO    CHAINDEALS                40                                       200478
     C           *IN40     IFEQ '1'                                                           200478
     C                     MOVE *BLANKS   NETBY                                               200478
     C                     MOVE *BLANKS   NETSL                                               200478
     C                     ENDIF                                                              200478
     C                     ELSE                                                               200478
     C                     MOVE *BLANKS   NETBY                                               200478
     C                     MOVE *BLANKS   NETSL                                               200478
     C                     ENDIF                                                              200478
      *
      ** Initialise non-constant fields
     C                     EXSR SRINTF
      *
      ** Determine message routing
     C                     EXSR SRROUT
      *
      ** Format message detail - Sequence A
     C                     EXSR SRFMTA
      *
      ** Format message detail - Sequence B
     C                     EXSR SRFMTB
      *
      ** Format message detail - Sequence C
     C                     EXSR SRFMTC
      *                                                                                       CSW213
      ** Format message detail - CSW213                                                       CSW213
      *                                                                                       CSW213
     C           CSW213    IFEQ 'Y'                                                           CSW213
      *                                                                                     MD022981
     C                     MOVELMGTTYP    KDTYP   2                                         MD022981
     C                     MOVELMGTNUM    KDLNO  16                                         MD022981
      *                                                                                     MD022981
     C           RPIFKY    CHAINDLRPIFL1             20                                     MD022981
      *                                                                                     MD022981
     C           *IN20     IFEQ '0'                                                         MD022981
     C                     EXSR SRFMTE                                                        CSW213
     C                     ENDIF                                                            MD022981
     C                     ENDIF                                                              CSW213
      *
      ** Print incorrectly generated message
     C           @ERR      IFEQ 'Y'
     C                     EXSR SRREPT
     C                     ELSE
      *
     C/COPY WNCPYSRC,MG0300CCP5
      *
      *
      ** Output correctly generated message
     C                     EXSR SROMSG
      *
      ** If confirmation matching switched on, generate feedback record
      **  (at present only produced for dealing)
      *
     C           BGCFMT    IFEQ 'Y'
     C           MGMODI    ANDEQ'DL'
     C                     EXSR CFMAT
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** Delete the processed GDF record.
      *
     C                     DELETMGF300PD               16
      *
      **  Error on delete of record.
      *
     C           *IN16     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '001'     DBASE            * * * * * * * *
     C                     MOVELMGTNUM    DBKEY            *  DBERR 001  *
     C                     MOVEL'MGF300PD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      **  Update sequence numbers on transaction record
      **  if no errors have occurred
      *
     C           @ERR      IFNE 'Y'
     C           MGACMI    IFEQ 'Y'                                                           CSW213
     C                     CALL 'MG5000'               24                                     CSW213
     C                     PARM MGTTYP    @MODI   2                                           CSW213
     C                     PARM MGTNUM    @TRAN  15                                           CSW213
     C                     PARM 'CE'      @PROG   2                                           CSW213
     C                     PARM 'U'       @MODE   1                                           CSW213
     C                     PARM *ZEROS    MGLSWC  30                                          CSW213
     C                     PARM *ZEROS    MGLSWS  30                                          CSW213
     C                     PARM *BLANKS   @ERCD   1                                           CSW213
     C                     ELSE                                                               CSW213
     C                     CALL 'MG5000'               24
     C                     PARM MGMODI    @MODI   2
     C                     PARM MGTNUM    @TRAN  15
     C                     PARM 'CE'      @PROG   2
     C                     PARM 'U'       @MODE   1
     C                     PARM *ZEROS    MGLSWC  30
     C                     PARM *ZEROS    MGLSWS  30
     C                     PARM *BLANKS   @ERCD   1
     C                     ENDIF                                                              CSW213
      *
      **  Error on access for sequence number
     C           @ERCD     IFEQ 'Y'
     C           *LOCK     IN   LDA
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      **  Program missing on call
     C           *IN24     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '002'     DBASE            * * * * * * * *
     C                     MOVE 'MG5000'  DBKEY            *  DBERR 002  *
     C                     OUT  LDA                        * * * * * * * *
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     ENDIF
     C           *LOCK     IN   LDA
     C                     MOVEL'MG0300A 'DBPGM
     C                     OUT  LDA
     C/COPY WNCPYSRC,MG0300AC23
      *
      **  COMIT all changes since no error on writing the message
      *
     C                     COMIT
      *                                                                   221145
      **  Call Compliance Watch:Watch List Checking                       221145
      *                                                                   221145
     C           CSD015    IFEQ 'Y'                                       221145
     C           W1EWLC    ANDEQ'Y'                                                           222385
     C           CSW025    ANDEQ'N'                                       221145
     C                     EXSR WLCDQ                                     221145
     C                     ENDIF                                          221145
      *
      ** Read next MT300 extract record
     C                     READ MGF300PD                 10
      *
     C                     ENDDO
      *
      **  Write end of report, only if the printer file is open
      *
     C           *IN50     IFEQ '1'
     C                     WRITEEOREPT
     C                     ENDIF
     C/COPY WNCPYSRC,MG0300AC34
      *
     C                     SETON                     LR
      *
     C/EJECT
      *****************************************************************
      *   SRINIT - Inital process                                     *
      *   Called By - main process                                    *
      *   Calls                                                       *
      *****************************************************************
      *
     C           SRINIT    BEGSR
      *
     C                     MOVEACPY@      BIS@   80
     C/COPY WNCPYSRC,MG0300AC14
      *
      **  Set up LDA
     C           *NAMVAR   DEFN           LDA
     C           *LOCK     IN   LDA
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     MOVEL'MG0300A' DBPGM
     C                     MOVE *BLANKS   DBASE
     C                     OUT  LDA
      ***********                                                                             CCB020
      ****Set*up*MPHAS data area                                                              CCB020
      ***********                                                                             CCB020
     C************NAMVAR   DEFN           MPHAS                                               CCB020
     C************LOCK     IN   MPHAS                                                         CCB020
     C***********          MOVE STATUS    COB     1                                           CCB020
     C***********          OUT  MPHAS                                                         CCB020
     C                     MOVEL'CBC00100'@CLPRM  9                                           CCB020
     C                     MOVE '1'       @CLPRM                                              CCB020
     C                     CALL @CLPRM                                                        CCB020
     C                     PARM *BLANKS   COBST   4                                           CCB020
      *
      **  Access SDBANKPD for report title
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '003'     DBASE            * * * * * * * *
     C                     MOVEL'FIRST'   DBKEY            *  DBERR 003  *
     C                     MOVEL'SDBANKPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      **  Access SDTRADPD for trading information
      *
     C                     CALL 'AOTRADR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDTRAD    PARM SDTRAD    DSFDY
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '004'     DBASE            * * * * * * * *
     C                     MOVEL'FIRST'   DBKEY            *  DBERR 004  *
     C                     MOVEL'SDTRADPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      **  Access SDMMODPD for modules available
     C                     CALL 'AOMMODR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C           SDMMOD    PARM SDMMOD    DSFDY
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '005'     DBASE            * * * * * * * *
     C                     MOVEL'FIRST'   DBKEY            *  DBERR 005  *
     C                     MOVEL'SDMMODPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      **  Access SDMGMEPD for message management data.
      *
     C                     CALL 'AOMGMER0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C           SDMGME    PARM SDMGME    DSFDY
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '006'     DBASE            * * * * * * * *
     C                     MOVEL'FIRST'   DBKEY            *  DBERR 006  *
     C                     MOVEL'SDMGMEPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *                                                                   CSW012
      **  Access Switchable Features file for CSW012                      CSW012
      *                                                                   CSW012
     C                     CALL 'AOSARDR0'                                CSW012
     C                     PARM *BLANKS   @RTCD                           CSW012
     C                     PARM '*VERIFY' @OPTN                           CSW012
     C                     PARM 'CSW012'  @SARD   6                       CSW012
     C           SCSARD    PARM SCSARD    DSFDY                           CSW012
      *                                                                   CSW012
     C           @RTCD     IFNE *BLANKS                                   CSW012
     C           @RTCD     ANDNE'*NRF   '                                 CSW012
     C           *LOCK     IN   LDA                                       CSW012
     C                     MOVE '007'     DBASE            * * * * * * * *CSW012
     C                     MOVEL@SARD     DBKEY            * DB ERROR 07 *CSW012
     C                     MOVEL'SCSARDPD'DBFILE           * * * * * * * *CSW012
     C                     OUT  LDA                                       CSW012
     C                     EXSR *PSSR                                     CSW012
     C                     ENDIF                                          CSW012
      *                                                                   CSW012
     C           @RTCD     IFEQ *BLANKS                                   CSW012
     C                     MOVEL'Y'       CSW012  1                       CSW012
     C                     ELSE                                           CSW012
     C                     MOVEL'N'       CSW012                          CSW012
     C                     ENDIF                                          CSW012
     C/COPY WNCPYSRC,MG0300AC18
      *                                                                                       200478
      ** Access SAR Details file to determine if CDL002 installed                             200478
      *                                                                                       200478
     C                     CALL 'AOSARDR0'                                                    200478
     C                     PARM '       ' @RTCD   7                                           200478
     C                     PARM '*VERIFY' @OPTN   7                                           200478
     C                     PARM 'CDL002'  @SARD   6                                           200478
     C           SCSARD    PARM SCSARD    DSFDY                                               200478
     C           @RTCD     IFNE *BLANK                                                        200478
     C           @RTCD     ANDNE'*NRF   '                                                     200478
     C                     MOVEL'SCSARDPD'DBFILE           **************                     200478
     C                     MOVEL'023'     DBASE            * DBERROR 023                      200478
     C                     MOVEL@RTCD     DBKEY            **************                     200478
     C                     SETON                     U7U8                                     200478
     C                     EXSR *PSSR                                                         200478
     C                     ENDIF                                                              200478
     C           @RTCD     IFEQ *BLANK                                                        200478
     C                     MOVE 'Y'       CDL002  1                                           200478
     C                     OPEN DEALS                                                         200478
     C                     MOVEL'TO BE '  NETTXT 12                                           200478
     C                     MOVE 'NETTED'  NETTXT                                              200478
     C                     ENDIF                                                              200478
      *                                                                                       CSD015
      ** Check if CSD015 is enabled.                                                          CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD   7                                           CSD015
     C                     PARM '*VERIFY' POPTN   7                                           CSD015
     C                     PARM 'CSD015'  PSARN   6                                           CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CSD015  1                                           CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSD015                                              CSD015
      *                                                                                       222385
      ** Access AOWLCCR0 to check if function code MESSGENT is available                      222385
      *                                                                                       222385
     C                     CALL 'AOWLCCR0'                                                    222385
     C                     PARM *BLANKS   @RTCD                                               222385
     C                     PARM '*KEY'    @OPTN                                               222385
     C                     PARM 'MESSGENT'PFUNC   8                                           222385
     C           SDWLCC    PARM SDWLCC    DSFDY                                               222385
      *                                                                                       222385
     C           @RTCD     IFNE *BLANKS                                                       222385
     C           @RTCD     ANDNE'*NRF'                                                        222385
     C                     MOVEL'SDWLCCPD'DBFILE                                              222385
     C                     MOVELPFUNC     DBKEY                                               222385
     C                     Z-ADD32        DBASE                                               222385
     C                     EXSR *PSSR                                                         222385
     C                     ENDIF                                                              222385
      *                                                                                       222385
     C                     ELSE                                                               CSD015
     C                     MOVEL'N'       W1EWLC                                              222385
      *                                                                                       CSD015
     C           PRTCD     IFNE '*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     MOVELPSARN     DBKEY                                               CSD015
     C                     Z-ADD31        DBASE                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Check if CSW025 is enabled.                                                          CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY' POPTN                                               CSD015
     C                     PARM 'CSW025'  PSARN                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CSW025  1                                           CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSW025                                              CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE '*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     MOVELPSARN     DBKEY                                               CSD015
     C                     Z-ADD32        DBASE                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *
      **  Initialise constant fields
     C                     MOVE *LOVAL    CR      1
     C                     BITON'457'     CR
     C                     MOVE *LOVAL    LF      1
     C                     BITON'257'     LF
     C                     MOVELCR        CRLF    2
     C                     MOVE LF        CRLF
     C                     MOVE *BLANKS   @TR4
     C                     MOVE ':'       COLON1
     C                     MOVE ':'       COLON2
      *
      **  CRLF Control Character for message data records
     C                     MOVE CRLF      CTRC
      *
      **  Convert run date to YYMMDD, for Message Generation Date
     C                     CALL 'ZM0060'               15
     C                     PARM BJRDNB    ZMDAY   50
     C                     PARM           ZMDATE  6
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '008'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 008  *
     C                     MOVEL'ZM0060'  DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     MOVE ZMDATE    MGDE
      *
      ** Set-up Message Generation Century flag                           144040
      *                                                                   144040
     C                     MOVELMGDE      YY      20                      144040
     C           YY        IFLT 72                                        144040
     C                     MOVE '2'       CIND                            144040
     C                     ELSE                                           144040
     C                     MOVE '1'       CIND                            144040
     C                     ENDIF                                          144040
      *
      **  Convert history retention date to YYMMDD
     C           BJRDNB    ADD  ENDSMN    ZMDAY
     C                     CALL 'ZM0060'               15
     C                     PARM           ZMDAY
     C                     PARM           ZMDATE  6
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '009'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 009  *
     C                     MOVEL'ZM0060'  DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     MOVE ZMDATE    @HRDT   6
      *
      **  Check if SWIFT Changes 1996 (CSW096) is installed
      *
     C                     CALL 'SWIFT96'
     C                     PARM *BLANKS   @RTCD   7
      *
     C           @RTCD     IFEQ 'CSW096'
     C                     MOVE 'Y'       CSW096  1
     C                     ELSE
     C                     MOVE 'N'       CSW096
     C                     ENDIF
      *                                                                   137909
      **  Access Switchable Features file for CEU003                      137909
      *                                                                   137909
     C                     CALL 'AOSARDR0'                                137909
     C                     PARM *BLANKS   @RTCD                           137909
     C                     PARM '*VERIFY' @OPTN                           137909
     C                     PARM 'CEU003'  @SARD   6                       137909
     C           @RTCD     IFEQ *BLANKS                                   137909
     C                     MOVEL'Y'       CEU003  1                       137909
     C                     ELSE                                           137909
     C                     MOVEL'N'       CEU003                          137909
     C                     ENDIF                                          137909
     C/COPY WNCPYSRC,MG0300AC24
      *                                                                   CDL008
      ** Check if switchable feature CDL008 is switched on                CDL008
      *                                                                   CDL008
     C                     CALL 'AOSARDR0'                                CDL008
     C                     PARM *BLANKS   @RTCD                           CDL008
     C                     PARM '*VERIFY' @OPTN                           CDL008
     C                     PARM 'CDL008'  @SARD                           CDL008
     C           SCSARD    PARM SCSARD    DSFDY                           CDL008
      *                                                                   CDL008
     C           @RTCD     IFNE *BLANK                                    CDL008
     C           @RTCD     ANDNE'*NRF   '                                 CDL008
     C           *LOCK     IN   LDA                                       CDL008
     C                     MOVEL'SCSARDPD'DBFILE           ************   CDL008
     C                     MOVEL'CDL008'  DBKEY            * DBERR 26 *   CDL008
     C                     MOVEL'026'     DBASE            ************   CDL008
     C                     OUT  LDA                                       CDL008
     C                     EXSR *PSSR                                     CDL008
     C                     ENDIF                                          CDL008
      *                                                                   CDL008
     C           @RTCD     IFEQ *BLANK                                    CDL008
     C                     MOVE 'Y'       CDL008  1                       CDL008
     C                     ELSE                                           CDL008
     C                     MOVE 'N'       CDL008                          CDL008
     C                     ENDIF                                          CDL008
      *                                                                                       CSW201
      ** Check if switchable feature CSW024 is switched on                                    CSW024
     C                     CALL 'AOSARDR0'                                                    CSW024
     C                     PARM *BLANKS   @RTCD                                               CSW024
     C                     PARM '*VERIFY' @OPTN                                               CSW024
     C                     PARM 'CSW024'  @SARD                                               CSW024
     C           SCSARD    PARM SCSARD    DSFDY                                               CSW024
      *                                                                                       CSW024
     C           @RTCD     IFNE *BLANK                                                        CSW024
     C           @RTCD     ANDNE'*NRF   '                                                     CSW024
     C           *LOCK     IN   LDA                                                           CSW024
     C                     MOVEL'SCSARDPD'DBFILE           ************                       CSW024
     C                     MOVEL'CSW024'  DBKEY            * DBERR 28 *                       CSW024
     C                     MOVEL'028'     DBASE            ************                       CSW024
     C                     OUT  LDA                                                           CSW024
     C                     EXSR *PSSR                                                         CSW024
     C                     ENDIF                                                              CSW024
      *                                                                                       CSW024
     C           @RTCD     IFEQ *BLANK                                                        CSW024
     C                     MOVE 'Y'       CSW024  1                                           CSW024
     C                     ELSE                                                               CSW024
     C                     MOVE 'N'       CSW024                                              CSW024
     C                     ENDIF                                                              CSW024
      *                                                                                       CSW024
      ** Check if switchable feature CSW037 is switched on                                    CSW037
     C                     CALL 'AOSARDR0'                                                    CSW037
     C                     PARM *BLANKS   @RTCD                                               CSW037
     C                     PARM '*VERIFY' @OPTN                                               CSW037
     C                     PARM 'CSW037'  @SARD                                               CSW037
     C           SCSARD    PARM SCSARD    DSFDY                                               CSW037
      *                                                                                       CSW037
     C           @RTCD     IFNE *BLANK                                                        CSW037
     C           @RTCD     ANDNE'*NRF   '                                                     CSW037
     C           *LOCK     IN   LDA                                                           CSW037
     C                     MOVEL'SCSARDPD'DBFILE           ************                       CSW037
     C                     MOVEL'CSW037'  DBKEY            * DBERR 28 *                       CSW037
     C                     MOVEL'030'     DBASE            ************                       CSW037
     C                     OUT  LDA                                                           CSW037
     C                     EXSR *PSSR                                                         CSW037
     C                     ENDIF                                                              CSW037
      *                                                                                       CSW037
     C           @RTCD     IFEQ *BLANK                                                        CSW037
     C                     MOVE 'Y'       CSW037  1                                           CSW037
     C                     ELSE                                                               CSW037
     C                     MOVE 'N'       CSW037                                              CSW037
     C                     ENDIF                                                              CSW037
      *                                                                                       CSW037
      ** Check if Enhanced Receive Settlement Instructions feature                            CDL094
      ** is installed                                                                         CDL094
      *                                                                                       CDL094
     C                     MOVE 'N'       CDL094  1                                           CDL094
     C                     CALL 'AOSARDR0'                                                    CDL094
     C                     PARM *BLANKS   @RTCD                                               CDL094
     C                     PARM '*VERIFY' @OPTN                                               CDL094
     C                     PARM 'CDL094'  @SARD                                               CDL094
     C           SCSARD    PARM SCSARD    DSFDY                                               CDL094
      *                                                                                       CDL094
     C           @RTCD     IFEQ *BLANKS                                                       CDL094
     C                     MOVE 'Y'       CDL094                                              CDL094
     C                     ENDIF                                                              CDL094
      *                                                                                       CDL094
      ** Check if switchable feature CSW201 is switched on                                    CSW201
      *                                                                                       CSW201
     C                     CALL 'SWIF2001'                                                    CSW201
     C                     PARM *BLANKS   @RTCD                                               CSW201
      *                                                                                       CSW201
     C           @RTCD     IFEQ 'CSW2001'                                                     CSW201
     C                     MOVE 'Y'       CSW201  1                                           CSW201
     C                     ELSE                                                               CSW201
     C                     MOVE 'N'       CSW201                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW212
      ** Check if switchable feature CSW212 is switched on                                    CSW212
      *                                                                                       CSW212
     C                     CALL 'SWIF2012'                                                    CSW212
     C                     PARM *BLANKS   @RTCD                                               CSW212
      *                                                                                       CSW212
     C           @RTCD     IFEQ 'CSW2012'                                                     CSW212
     C                     MOVE 'Y'       CSW212  1                                           CSW212
     C                     ELSE                                                               CSW212
     C                     MOVE 'N'       CSW212                                              CSW212
     C                     ENDIF                                                              CSW212
      *                                                                                      255986B
     C                     CALL 'AOSVALR0'                                                   255986B
     C                     PARM *BLANKS   @RTCD                                              255986B
     C                     PARM APOPB     P@OP01 20                                          255986B
     C                     PARM *BLANKS   P@VL01200                                          255986B
     C                     PARM *BLANKS   P@OP02 20                                          255986B
     C                     PARM *BLANKS   P@VL02200                                          255986B
     C                     PARM *BLANKS   P@OP03 20                                          255986B
     C                     PARM *BLANKS   P@VL03200                                          255986B
     C                     PARM *BLANKS   P@OP04 20                                          255986B
     C                     PARM *BLANKS   P@VL04200                                          255986B
     C                     PARM *BLANKS   P@OP05 20                                          255986B
     C                     PARM *BLANKS   P@VL05200                                          255986B
     C                     PARM *BLANKS   P@OP06 20                                          255986B
     C                     PARM *BLANKS   P@VL06200                                          255986B
     C                     PARM *BLANKS   P@OP07 20                                          255986B
     C                     PARM *BLANKS   P@VL07200                                          255986B
     C                     PARM *BLANKS   P@OP08 20                                          255986B
     C                     PARM *BLANKS   P@VL08200                                          255986B
     C                     PARM *BLANKS   P@OP09 20                                          255986B
     C                     PARM *BLANKS   P@VL09200                                          255986B
     C                     PARM *BLANKS   P@OP10 20                                          255986B
     C                     PARM *BLANKS   P@VL10200                                          255986B
      *                                                                                      255986B
     C                     MOVEL'N'       PAPOPB  1                                          255986B
     C           @RTCD     IFEQ *BLANK                                                       255986B
     C                     MOVELP@VL01    PAPOPB                                             255986B
     C                     ENDIF                                                             255986B
      *                                                                                     MD022981
      ** Setup Key Field for DLRPIFPD                                                       MD022981
      *                                                                                     MD022981
     C           RPIFKY    KLIST                                                            MD022981
     C                     KFLD           KDTYP                                             MD022981
     C                     KFLD           KDLNO                                             MD022981
      *                                                                                     MD022981
      ** Check if switchable feature CSW213 is switched on                                  MD022981
      *                                                                                     MD022981
     C                     CALL 'SWIF2013'                                                  MD022981
     C                     PARM *BLANKS   @RTCD                                             MD022981
      *                                                                                     MD022981
     C           @RTCD     IFEQ 'CSW2013'                                                   MD022981
     C                     MOVE 'Y'       CSW213  1                                         MD022981
     C                     OPEN DLRPIFL1                                                    MD022981
     C                     ELSE                                                             MD022981
     C                     MOVE 'N'       CSW213                                            MD022981
     C                     ENDIF                                                            MD022981
      *                                                                                       CSW214
      ** Check if switchable feature CSW214 is switched on                                    CSW214
      *                                                                                       CSW214
     C                     CALL 'SWIF2014'                                                    CSW214
     C                     PARM *BLANKS   PRTCD   7                                           CSW214
      *                                                                                       CSW214
     C           PRTCD     IFEQ 'CSW2014'                                                     CSW214
     C                     MOVE 'Y'       CSW214  1                                           CSW214
     C                     ELSE                                                               CSW214
     C                     MOVE 'N'       CSW214                                              CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                     MD029064
      ** Check if Chips 2 feature is switched on                                            MD029064
      *                                                                                     MD029064
     C                     CALL 'AOSARDR0'                                                  MD029064
     C                     PARM *BLANKS   PRTCD                                             MD029064
     C                     PARM '*VERIFY' POPTN                                             MD029064
     C                     PARM 'S01429'  PSARN                                             MD029064
     C           SCSARD    PARM SCSARD    DSFDY                                             MD029064
      *                                                                                     MD029064
     C                     MOVE 'N'       S01429  1                                         MD029064
     C           PRTCD     IFEQ *BLANKS                                                     MD029064
     C                     MOVE 'Y'       S01429                                            MD029064
     C                     ENDIF                                                            MD029064
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   SRINTF - Initalise non-constant fields                      *
      *   Called by - main process                                    *
      *   Calls                                                       *
      *****************************************************************
      *
     C           SRINTF    BEGSR
      *
     C                     MOVE *BLANKS   AWBA6   6
     C                     MOVELMGAWBA    AWBA6                           139247
     C***********6         SUBSTMGAWBA:2  AWBA6                    095876 139247
      *
     C                     MOVE *BLANKS   TRNO
     C                     MOVE '      '  NWRK
     C**********           Z-ADD0         SECN                                                CSD027
     C                     MOVE *BLANKS   SECN                                                CSD027
     C                     MOVE *BLANKS   NWSN
     C**********           Z-ADD0         DECN                                                CSD027
     C                     MOVE *BLANKS   DECN                                                CSD027
     C                     MOVE *BLANKS   NWDS
     C                     MOVE *BLANKS   MGSG
     C                     MOVE *BLANKS   MGST
     C                     MOVE *BLANKS   LSCC
     C                     MOVE *BLANKS   F57U
     C                     Z-ADD0         MGTM
     C                     Z-ADD0         LATM
     C                     MOVE *BLANKS   RELD
     C                     Z-ADD0         RELT
     C                     MOVE *BLANKS   AMTS
     C                     MOVE *BLANKS   SVDT
     C                     MOVE *BLANKS   CINDV                           141572
     C                     MOVE *BLANKS   CLSS                            CDL008
      *
     C                     MOVE *BLANKS   @TRN
     C                     MOVE *BLANKS   @ERR    1
     C                     MOVE *BLANKS   STELX  10
     C                     MOVE *BLANKS   SSTTX  12
     C                     MOVE *BLANKS   SCRNM  20
     C                     MOVE *BLANKS   SPCNB   6
     C                     MOVE *BLANKS   SPAIN   1
      *                                                                                     MD022633
     C                     MOVE *BLANKS   WRKMRJ                                            MD022633
     C                     MOVE *BLANKS   WRKMRP                                            MD022633
     C                     MOVE *BLANKS   WRKMRN                                           MD022633A
     C                     MOVE *BLANKS   WRKMRC                                           MD022633A
     C                     MOVE *BLANKS   WRKMRS                                           MD022633A
     C                     MOVE *BLANKS   WRKMRL                                           MD022633A
     C                     MOVE *BLANKS   WRKMRA                                           MD022633A
     C/COPY WNCPYSRC,MG0300AC25
      *
      **  Initialise field to indicate that the current position
      **  for outputting field :72:, is at line 1
     C                     MOVE 'N'       LINE2   1
      *
      **  Clear multiple occurrence data structure
     C                     Z-ADD1         X       20
     C           X         OCUR MULT
      *
     C           X         DOWLE95
     C           MULT      ANDNE*BLANKS
     C                     MOVE *BLANKS   MULT
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     ENDDO
      *                                                                   183583
      ** Clear multiple occurrence DS for the extension file.             183583
      *                                                                   183583
     C                     Z-ADD1         V       20                      183583
     C           V         OCUR EXTN                                      183583
     C           V         DOWLE20                                        183583
     C           MCSI      ANDNE*BLANKS                                   183583
     C                     Z-ADD*ZEROS    MPSN                            183583
     C                     MOVE *BLANKS   MTG                             183583
     C                     MOVE *BLANKS   MCSI                            183583
     C                     ADD  1         V                               183583
     C           V         OCUR EXTN                                      183583
     C                     ENDDO                                          183583
     C                     Z-ADD0         V                               183583
      **********                                                                     CSW213 MD022981
      ***Check*if*switchable feature CSW213 is switched on                           CSW213 MD022981
      **********                                                                     CSW213 MD022981
     C**********           CALL 'SWIF2013'                                           CSW213 MD022981
     C**********           PARM *BLANKS   @RTCD                                      CSW213 MD022981
      **********                                                                     CSW213 MD022981
     C********** @RTCD     IFEQ 'CSW2013'                                            CSW213 MD022981
     C**********           MOVE 'Y'       CSW213  1                                  CSW213 MD022981
     C**********           ELSE                                                      CSW213 MD022981
     C**********           MOVE 'N'       CSW213                                     CSW213 MD022981
     C**********           ENDIF                                                     CSW213 MD022981
      *
      **  Obtain sequence numbers from transaction record
     C           MGACMI    IFEQ 'Y'                                                           CSW213
     C                     CALL 'MG5000'               24                                     CSW213
     C                     PARM MGTTYP    @MODI   2                                           CSW213
     C                     PARM MGTNUM    @TRAN  15                                           CSW213
     C                     PARM 'CE'      @PROG   2                                           CSW213
     C                     PARM *BLANKS   @MODE   1                                           CSW213
     C                     PARM *ZEROS    MGLSWC  30                                          CSW213
     C                     PARM *ZEROS    MGLSWS  30                                          CSW213
     C                     PARM *BLANKS   @ERCD   1                                           CSW213
     C                     ELSE                                                               CSW213
     C                     CALL 'MG5000'               24
     C                     PARM MGMODI    @MODI   2
     C                     PARM MGTNUM    @TRAN  15
     C                     PARM 'CE'      @PROG   2
     C                     PARM *BLANKS   @MODE   1
     C                     PARM *ZEROS    MGLSWC  30
     C                     PARM *ZEROS    MGLSWS  30
     C                     PARM *BLANKS   @ERCD   1
     C                     ENDIF                                                              CSW213
      *
      **  Error on access for sequence number
     C           @ERCD     IFEQ 'Y'
     C           *LOCK     IN   LDA
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      **  Program missing on call
     C           *IN24     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '010'     DBASE            * * * * * * * *
     C                     MOVE 'MG5000'  DBKEY            *  DBERR 010  *
     C                     OUT  LDA                        * * * * * * * *
     C                     EXSR *PSSR
     C                     ENDIF
     C           *LOCK     IN   LDA
     C                     MOVEL'MG0300A 'DBPGM
     C                     OUT  LDA
      *
      **  To ensure field 53 if generated when required
     C                     SETOF                     55
      *
     C                     ENDSR
     C/EJECT                                                                                MD023007
      *****************************************************************                     MD023007
      *   SRRPPT - Match RPPT details for Reporting Jurisdiction and  *                     MD023007
      *            Reporting Party fields                             *                     MD023007
      *   Called by SRFMTE                                            *                     MD023007
      *   Calls -                                                     *                     MD023007
      *****************************************************************                     MD023007
      *                                                                                     MD023007
     C           SRRPPT    BEGSR                                                            MD023007
      *                                                                                     MD023007
      ** Initialize work fields                                                             MD023007
     C                     Z-ADD1         IX1     10                                        MD023007
     C                     Z-ADD1         IX2     10                                        MD023007
     C                     Z-ADD0         IX                                                MD023007
      *                                                                                     MD023007
      ** Main loop for RPPT                                                                 MD023007
      *                                                                                     MD023007
     C           IX1       DOWLE4                                                           MD023007
      *                                                                                     MD023007
     C           IX1       LOKUPIX                       98                                 MD023007
      *                                                                                     MD023007
     C           *IN98     IFEQ '0'                                                         MD023007
     C                     MOVE IX1       IX,IX2                                            MD023007
     C           IX1       OCUR RPPT                                                        MD023007
     C                     MOVELRPPT      WRPPT1136                                         MD023007
     C                     ADD  1         IX2                                               MD023007
      *                                                                                     MD023007
     C                     Z-ADD1         IX3     10                                        MD023007
      *                                                                                     MD023007
      ** Search a match for each Reporting Party details,                                   MD023007
      ** then resequence the occurence for all combined RPPT details                        MD023007
      *                                                                                     MD023007
     C           IX3       DOWLE4                                                           MD023007
      *                                                                                     MD023007
     C           IX3       IFNE IX1                                                         MD023007
     C           IX3       OCUR RPPT                                                        MD023007
     C                     MOVELRPPT      WRPPT2136                                         MD023007
      *                                                                                     MD023007
     C           WRPPT1    IFEQ WRPPT2                                                      MD023007
     C                     MOVE IX3       IX,IX2                                            MD023007
     C                     ADD  1         IX2                                               MD023007
     C                     ENDIF                                                            MD023007
     C                     ENDIF                                                            MD023007
      *                                                                                     MD023007
     C                     ADD  1         IX3                                               MD023007
      *                                                                                     MD023007
     C                     ENDDO                                                            MD023007
     C                     ENDIF                                                            MD023007
      *                                                                                     MD023007
     C                     ADD  1         IX1                                               MD023007
      *                                                                                     MD023007
     C                     ENDDO                                                            MD023007
      *                                                                                     MD023007
     C                     ENDSR                                                            MD023007
     C/EJECT                                                                               MD022633A
      *****************************************************************                    MD022633A
      *                                                               *                    MD022633A
      *  GETRCL- Get record length                                    *                    MD022633A
      *                                                               *                    MD022633A
      *****************************************************************                    MD022633A
      *                                                                                    MD022633A
     C           GETRCL    BEGSR                                                           MD022633A
      *                                                                                    MD022633A
     C           'UTGETRCD'CAT  'LN'      P#PGM  10                                        MD022633A
      *                                                                                    MD022633A
     C                     CALL P#PGM                                                      MD022633A
     C                     PARM           P#RTCD 10                                        MD022633A
     C                     PARM           P#RCDL  50                                       MD022633A
     C                     PARM           P#FILN 10                                        MD022633A
     C                     PARM '*LIBL'   P#LIBN 10                                        MD022633A
      *                                                                                    MD022633A
     C           P#RTCD    IFNE *BLANK                                                     MD022633A
     C                     EXSR *PSSR                                                      MD022633A
     C                     ENDIF                                                           MD022633A
      *                                                                                    MD022633A
     C                     ENDSR                                                           MD022633A
     C/EJECT
      *****************************************************************
      *   SRROUT - determine message routing                          *
      *   Called by - main process                                    *
      *   Calls -                                                     *
      *****************************************************************
      *
     C           SRROUT    BEGSR
      *
     C                     MOVE MGBRCA    I@SNBR
     C                     MOVE *BLANKS   I@DSCN
     C                     MOVE MGCNUM    I@DSCN
     C                     MOVE '300'     I@MTPY
     C                     MOVE 'Y'       I@CONC
     C                     Z-ADD0         I@SETT
     C                     MOVE *BLANK    I@FTCS
     C                     MOVE MGMODI    I@MMOD
      *
      *###################################################################
      *                                                                  #
      * Below are two copy sources intended for setting up the custom    #
      * parameter (P@ZZ) in the call to MG9900.                          #
      * One (MG9900CALL) is in ALL MG generation programs and is for use #
      * when a change is required to all of them.                        #
      * The other is only in this program.                               #
     C/COPY WNCPYSRC,MG9900CALL                                          #
     C/COPY WNCPYSRC,MG0300ROUT                                          #
      *                                                                  #
      *###################################################################
      *
     C*********************CALL 'MG9900'                                  CSW036
     C                     CALL 'MG9901'                                  CSW036
     C                     PARM *BLANKS   @RTCD
     C                     PARM           P@IN
     C                     PARM *BLANKS   P@OUT
     C                     PARM           P@ZZ  256
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '011'     DBASE              * * * * * * *
     C                     MOVEL'*CALL  ' DBKEY              * DBERR 011 *
     C*********************MOVEL'MG9900'  DBFILE             * * * * * * *CSW036
     C                     MOVEL'MG9901'  DBFILE             * * * * * * *CSW036
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ELSE
     C                     MOVE O@NWRK    NWRK
     C           CSW212    IFEQ 'Y'                                                           CSW212
     C           O@NWRK    ANDEQ'SWIFT'                                                       CSW212
     C           MGPMBC    IFEQ 'Y'                                                           CSW212
     C           MGPMSC    OREQ 'Y'                                                           CSW212
     C                     MOVEL'PAPER'   NWRK                                                CSW212
     C                     ENDIF                                                              CSW212
     C                     ENDIF                                                              CSW212
     C**********           Z-ADDO@CNSN    SECN                                                CSD027
     C                     MOVE O@CNSN    SECN                                                CSD027
     C                     MOVE O@NWSN    NWSN
     C**********           Z-ADDMGCNUM    DECN                                                CSD027
     C                     MOVE MGCNUM    DECN                                                CSD027
     C                     MOVE O@NWDS    NWDS
     C                     MOVE O@MGSG    MGSG
     C                     MOVE O@MGST    MGST
     C                     MOVE O@PCNB    SPCNB
     C                     MOVE O@PAIN    SPAIN
     C                     ENDIF
     C/COPY WNCPYSRC,MG0300AC26
      *
     C                     MOVEL*BLANKS   @KEY1                                               CSW024
     C           MGACMI    IFEQ 'Y'                                                           CSW213
     C                     MOVELMGPTYA    @KEY1                                               CSW213
     C                     ELSE                                                               CSW213
     C                     MOVELMGCNUM    @KEY1                                               CSW024
     C                     ENDIF                                                              CSW213
     C                     CALL 'AOCUSTR1'                                                    CSW024
     C                     PARM '*MSG   ' @RTCD                                               CSW024
     C                     PARM '*KEY   ' @OPTN                                               CSW024
     C                     PARM           @KEY1                                               CSW024
     C                     PARM *BLANKS   @KYST                                               CSW024
     C           SDCUST    PARM SDCUST    DSLDY                                               CSW024
      *                                                                                       CSW024
     C           @RTCD     IFNE *BLANKS                                                       CSW024
     C           *LOCK     IN   LDA                                                           CSW024
     C                     MOVEL'AOCUSTR0'DBFILE                                              CSW024
     C                     MOVE '029'     DBASE              * * * * * * *                    CSW024
     C                     MOVELMGCNUM    DBKEY              * DBERR 29  *                    CSW024
     C                     OUT  LDA                          * * * * * * *                    CSW024
     C                     EXSR *PSSR                                                         CSW024
     C                     ELSE                                                               CSW024
     C                     MOVE BBCNA1    DSCNA1 35                                           CSW024
     C                     MOVE BBCNA2    DSCNA2 35                                           CSW024
     C                     MOVE BBCNA3    DSCNA3 35                                           CSW024
     C                     MOVE BBCNA4    DSCNA4 35                                           CSW024
     C                     MOVE BBCORP    DSCORP  1                                           CSW024
     C                     MOVE BBCBEI    DSCBEI 11                                           CSW024
     C                     MOVE BBRI01    DSRI01 40                                           CSW024
     C                     MOVE BBRI02    DSRI02 40                                           CSW024
     C                     MOVE BBRI03    DSRI03 40                                           CSW024
     C                     MOVE BBRI04    DSRI04 40                                           CSW024
     C                     MOVE BBRI05    DSRI05 40                                           CSW024
     C                     MOVE BBFUND    DSFUND 34                                           CSW024
     C           CSW037    IFEQ 'Y'                                                           CSW037
     C******               MOVE BBFNAC    DSFNAC 30                                    CSW037CSW037A
     C           *LIKE     DEFN BBFNAC    DSFNAC                                             CSW037A
     C                     MOVELBBFNAC    DSFNAC                                             CSW037A
     C                     ENDIF                                                              CSW037
     C                     ENDIF                                                              CSW024
      *                                                                                       CSW024
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   SRFMTA - Format message detail - Sequence A                 *
      *   Called by   Main process                                    *
      *   Calls       SRCODE determine codeword                       *
      *****************************************************************
      *
     C           SRFMTA    BEGSR
      *                                                                   CDL008
     C                     Z-ADD*ZERO     X                               CDL008
      *                                                                   CDL008
      ** If CDL008 is on and FX deal is settled through CLS,              CDL008
      ** setup field :103: with Block 3 code.                             CDL008
      *                                                                   CDL008
     C           CDL008    IFEQ 'Y'                                       CDL008
     C           MGCLSS    ANDEQ'Y'                                       CDL008
      *                                                                   CDL008
     C           CEU003    IFEQ 'Y'                                       CDL008
     C           MGPYCY    ANDNE*BLANKS                                   CDL008
     C                     MOVE MGPYCY    @NSKYB                          CDL008
     C                     ELSE                                           CDL008
     C                     MOVE MGSLCY    @NSKYB                          CDL008
     C                     ENDIF                                          CDL008
      *                                                                   CDL008
      ** Retrieve Block 3 Code via AONOSTR0                               CDL008
      *                                                                   CDL008
     C**********           CALL 'AONOSTR0'                                             CDL008 CDL094
     C                     CALL 'AONOSTR1'                                                    CDL094
     C                     PARM '*MSG   ' @RTCD                           CDL008
     C                     PARM '*KEY   ' @OPTN                           CDL008
     C                     PARM *BLANKS   @NSKYA                          CDL008
     C                     PARM           @NSKYB                          CDL008
     C                     PARM *BLANKS   @NSKYC                          CDL008
     C                     PARM *BLANKS   @NSKYD                          CDL008
     C                     PARM MGPONS    @NSKYE                          CDL008
     C                     PARM *BLANKS   @KEYF                           CDL008
     C                     PARM *BLANKS   @KEYG                           CDL008
     C                     PARM *BLANKS   @KEYH                           CDL008
     C********** SDNOST    PARM SDNOST    DSFDY                                        CDL008 CDL094
     C           SDNOST    PARM SDNOST    DSSDY                                               CDL094
      *                                                                   CDL008
      ** Do not output field :103: at all if Block 3 Code is blank        187585
      *                                                                   187585
     C***********          ADD  1         X                        CDL008 187585
     C***********X         OCUR MULT                               CDL008 187585
     C***********          MOVE ':103:'   MTAG                     CDL008 187585
      *                                                                   CDL008
     C           @RTCD     IFEQ *BLANKS                                   CDL008
     C                     MOVE A7BL3C    WRK1    3                       CDL008
      *                                                                   187585
     C           WRK1      IFNE *BLANKS                                   CDL008
     C                     ADD  1         X                               187585
     C           X         OCUR MULT                                      187585
     C                     MOVE ':103:'   MTAG                            187585
     C                     MOVELWRK1      MFLD                            CDL008
     C                     ENDIF                                          CDL008
      *                                                                   187585
     C                     ELSE                                           CDL008
     C                     MOVE 'Y'       @ERR                            CDL008
     C                     MOVELMGPONS    MFLD                            CDL008
     C                     MOVELMSGA,3    MERR                            CDL008
     C                     ENDIF                                          CDL008
      *                                                                   CDL008
     C                     ENDIF                                          CDL008
      *
      **  Field :15A: General Information
     C***********          Z-ADD1         X                               CDL008
     C                     ADD  1         X                               CDL008
     C           X         OCUR MULT
     C                     MOVE ':15A:'   MTAG
     C                     MOVEL*BLANK    MFLD
      *
      **  Field :20:  Transaction reference number
     C                     ADD  1         X
     C           X         OCUR MULT
      *                                                                                       CSW213
     C           MGACMI    IFEQ 'Y'                                                           CSW213
     C                     MOVE MGMODI    @TRN11                                              CSW213
     C                     MOVELMGTNUM    @TRN21                                              CSW213
     C                     MOVELMGCNUM    @TRN31                                              CSW213
     C           MGLSWS    ADD  1         @TRN41                                              CSW213
     C                     MOVE ':20: '   MTAG                                                CSW213
     C                     MOVEL@TRN1     MFLD                                                CSW213
      *                                                                                       CSW213
      **  Store the TRN of the new confirmation message                                       CSW213
     C                     MOVEL@TRN1     @TRNO  16                                           CSW213
      *                                                                                       CSW213
     C                     ELSE                                                               CSW213
     C                     MOVE MGMODI    @TR1
     C                     MOVELMGTNUM    @TR2
     C           MGLSWS    ADD  1         @TR3
     C/COPY WNCPYSRC,MG0300AC27
     C                     MOVE ':20: '   MTAG
     C                     MOVEL@TRN      MFLD
      *
      **  Store the TRN of the new confirmation message
     C                     MOVEL@TRN      @TRNO  16
     C                     ENDIF                                                              CSW213
      *
      **  Determine if the TRN is unique
      *
     C           @TRNO     CHAINMGREFL0              11
      *
      **  Cannot have duplicate keys, hence error
     C           *IN11     IFEQ '0'
     C                     MOVELMSGA,8    MERR
     C                     MOVE 'Y'       @ERR
     C                     ENDIF
      *
      **  Field :21:  Related reference
      **  Determine the message codeword
     C                     EXSR SRCODE
     C/COPY WNCPYSRC,MG0300AC28
      *
     C           CWRD      IFNE 'NEW'
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE MGLSWC    @TR3
     C                     MOVEL@TRN      MFLD
      *                                                                                       CSW213
     C           MGACMI    IFEQ 'Y'                                                           CSW213
     C                     MOVELMGCNUM    WDEST   6                                           CSW213
     C                     MOVEL@TRN1     MFLD                                              MD022579
     C                     ELSE                                                               CSW213
     C                     MOVEL*BLANKS   WDEST                                               CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       190127
      **  Obtain transaction reference of previous MT300                                      190127
     C                     MOVELMGTNUM    HSTRAN                                              190127
     C                     MOVE '300'     HSMTPY                                              190127
      *                                                                                       190127
     C                     MOVE HSTRAN    @HTRN   6                                           190127
      *                                                                                       190127
     C***********HSKEY     SETGTMGHISTL0                                               190127 CSW213
     C***********          READPMGHISTL0                 56                            190127 CSW213
     C           HSKEY     SETGTMGHISTL7                                                      CSW213
     C                     READPMGHISTL7                 56                                   CSW213
      *                                                                                       190127
     C           *IN56     IFEQ '0'                                                           190127
     C           HSMODI    ANDEQMGMODI                                                        190127
     C           HSTRAN    ANDEQ@HTRN                                                         190127
     C           HSDEST    ANDEQWDEST                                                         CSW213
     C           HSMTPY    ANDEQ'300'                                                         190127
     C           MGACMI    IFEQ 'Y'                                                           CSW213
     C**********           MOVE HSSEQ     @SSEQ                                      CSW213 MD022367
     C**********           MOVEL@HREF1    MFLD                                       CSW213 MD022367
     C                     MOVELHSMODI    @TRN11                                            MD022367
     C                     MOVELHSTRAN    @TRN21                                            MD022367
     C                     MOVEL@TRN1     MFLD                                              MD022367
     C                     ELSE                                                               CSW213
     C                     MOVEL@HREF     MFLD                                                190127
     C                     END                                                                190127
     C                     ENDIF                                                              CSW213
      *                                                                                       190127
     C                     MOVE ':21: '   MTAG
      *
     C                     ENDIF
     C/COPY WNCPYSRC,MG0300AC29
      *
      **  Field :22A: Type of Operation
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     SELEC
     C           CDL008    WHEQ 'Y'                                       CDL008
     C           MGCHTP    ANDEQ'I'                                       CDL008
     C           MGCLSS    ANDEQ'N'                                       CDL008
     C                     MOVEL'NEWT'    MFLD                            CDL008
     C           MGCHTP    WHEQ 'C'
     C                     MOVEL'CANC'    MFLD
     C           CWRD      WHEQ 'AMEND'
     C                     MOVEL'AMND'    MFLD
     C           MGTTYP    WHEQ 'OT'
     C                     MOVEL'EXOP'    MFLD
     C           CWRD      WHEQ 'NEW'
     C                     MOVEL'NEWT'    MFLD
     C                     ENDSL
      *
     C           MGTTYP    IFEQ 'OP'
     C********** COB       ANDEQ'C'                                                           CCB020
     C           COBST     ANDEQ'*YES'                                                        CCB020
     C                     MOVEL'EXOP'    MFLD
     C                     ENDIF
      *
      **  Codeword blank
     C           CWRD      IFEQ *BLANKS
     C                     MOVE 'Y'       @ERR
     C                     MOVEAMSGA,7    MERR
     C                     ENDIF
      *
     C                     MOVE ':22A:'   MTAG
      *
     C/COPY WNCPYSRC,MG0300AC49
      *                                                                                       CSW024
      ** If corporate customer output :94A:                                                   CSW024
     C           CSW024    IFEQ 'Y'                                                           CSW024
     C           DSCORP    ANDEQ'Y'                                                           CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C                     MOVE *BLANK    MFLD                                                CSW024
     C                     MOVEL'AGNT'    MFLD                                                CSW024
     C                     MOVE ':94A:'   MTAG                                                CSW024
     C                     ENDIF                                                              CSW024
      *                                                                                       CSW024
      **  Field :22C: Common Reference
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZCREF
      *
      **  If SWIFT network, use sender & destination customer
      **  SWIFT address, and the exchange rate to produce
      **  common reference field;  Else use the message TRN
     C           NWRK      IFEQ 'SWIFT'
     C           NWRK      OREQ 'STTX'
      *
     C           NWRK      IFEQ 'SWIFT'
     C                     MOVELNWSN      ZSSWI
     C                     MOVELNWDS      ZDSWI
     C                     ENDIF
     C/COPY WNCPYSRC,MG0300AC40
     C                     MOVE MGEXRT    ZRATE
      *
      **  Format SWIFT common reference
     C                     CALL 'ZM0020'               15
     C                     PARM           ZSSWI  12
     C                     PARM           ZDSWI  12
     C                     PARM           ZRATE  138
     C                     PARM           ZCREF  16
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '012'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 012  *
     C                     MOVEL'ZM0020'  DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     ENDIF
      *
     C           O@SWSN    IFNE *BLANKS
     C           O@SWDS    ANDNE*BLANKS
      *
     C/COPY WNCPYSRC,MG0300AC52
     C                     MOVE MGEXRT    ZRATE
     C                     MOVELO@SWSN    ZSSWI
     C                     MOVELO@SWDS    ZDSWI
      *                                                                                       261612
      ** Format Rate                                                                          261612
      *                                                                                       261612
     C                     SELEC                                                              261612
     C           ZRATE     WHGE 10000                                                         261612
     C                     Z-ADDZRATE     ZRAT1  136                                          261612
     C                     Z-ADDZRAT1     ZRATE                                               261612
     C           ZRATE     WHGE 1000                                                          261612
     C                     Z-ADDZRATE     ZRAT2  137                                          261612
     C                     Z-ADDZRAT2     ZRATE                                               261612
     C                     ENDSL                                                              261612
      *
      **  Format SWIFT common reference
      *
     C                     CALL 'ZM0020'               15
     C                     PARM           ZSSWI  12
     C                     PARM           ZDSWI  12
     C                     PARM           ZRATE  138
     C                     PARM           ZCREF  16
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '013'     DBASE            * * * * * * * *
     C                     MOVE '      '  DBKEY            *  DBERR 013  *
     C                     MOVEL'ZM0020'  DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C/COPY WNCPYSRC,MG0300AC41
      *
     C                     ENDIF
      *
     C           ZCREF     IFEQ *BLANKS
     C                     MOVEL@TRNO     ZCREF
     C                     ENDIF
      *
     C                     MOVE ':22C:'   MTAG
     C                     MOVELZCREF     MFLD
      ***********                                                         CSW013
      ****Field*:82a: Party A                                             CSW013
      ***********                                                         CSW013
     C***********          ADD  1         X                               CSW013
     C***********X         OCUR MULT                                      CSW013
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
      *                                                                                       CSW201
      ** Field :82a: Party A                                                                  CSW201
      *                                                                                       CSW201
     C                     ADD  1         X                                                   CSW201
     C           X         OCUR MULT                                                          CSW201
     C                     ENDIF                                                              CSW201
      *
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM MGBRCA    @BRCD   3
     C           SDBRCH    PARM SDBRCH    DSSDY
      *
      ** Branch record not found - DB Error
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '014'     DBASE              * * * * * * *
     C                     MOVELMGBRCA    DBKEY              * DBERR 014 *
     C                     MOVEL'SDBRCHPD'DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C**********           MOVE *BLANKS   WBICN   60                                          CSD027
     C                     MOVE *BLANKS   WBICN   6                                           CSD027
     C                     MOVELA8BICN    WBICN
      *
     C***********          MOVE *BLANKS   ZDEST                           CSW013
     C***********          MOVELWBICN     ZDEST                           CSW013
     C***********          MOVE *BLANKS   ACLINE                          CSW013
     C***********          MOVE ' '       TAG                             CSW013
     C***********          MOVE '82'      FLDNO                           CSW013
     C***********          EXSR FSWAD                                     CSW013
      ***********                                                         CSW013
      ****Field*:87a: Party B                                             CSW013
     C***********          ADD  1         X                               CSW013
     C***********X         OCUR MULT                                      CSW013
      ***********                                                         CSW013
     C***********          MOVE *BLANKS   ZDEST                           CSW013
     C***********          MOVELMGCNUM    ZDEST                           CSW013
     C***********          MOVE *BLANKS   ACLINE                          CSW013
     C***********          MOVE ' '       TAG                             CSW013
     C***********          MOVE '87'      FLDNO                           CSW013
     C***********          EXSR FSWAD                                     CSW013
      ***********                                                         CSW013
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
      *                                                                                       CSW201
     C                     MOVE *BLANKS   ZDEST                                               CSW201
     C                     MOVELWBICN     ZDEST                                               CSW201
     C                     MOVE *BLANKS   ACLINE                                              CSW201
     C                     MOVE ' '       TAG                                                 CSW201
     C                     MOVE '82'      FLDNO                                               CSW201
     C                     EXSR FSWAD                                                         CSW201
      *                                                                                       CSW201
     C                     ENDIF                                                              CSW024
      *                                                                                       CSW024
      ** If corporate customer...                                                             CSW024
     C           CSW024    IFEQ 'Y'                                                           CSW024
     C           DSCORP    ANDEQ'Y'                                                           CSW024
      *                                                                                       CSW024
      ** If BEI output :87A:                                                                  CSW024
     C           DSCBEI    IFNE *BLANK                                                        CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C                     MOVE *BLANK    MFLD                                                CSW024
     C                     MOVELDSCBEI    MFLD                                                CSW024
     C                     MOVE ':87A:'   MTAG                                                CSW024
      *                                                                                       CSW024
      ** If receiver party info output :87J:                                                  CSW024
     C                     ELSE                                                               CSW024
     C           DSRI01    IFNE *BLANK                                                        CSW024
     C           DSRI02    ORNE *BLANK                                                        CSW024
     C           DSRI03    ORNE *BLANK                                                        CSW024
     C           DSRI04    ORNE *BLANK                                                        CSW024
     C           DSRI05    ORNE *BLANK                                                        CSW024
      *                                                                                       CSW024
     C                     MOVE *BLANK    DN87    1                                           CSW024
     C           DSRI01    IFNE *BLANK                                                        CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C           DN87      IFNE 'Y'                                                           CSW024
     C                     MOVE ':87J:'   MTAG                                                CSW024
     C                     MOVE 'Y'       DN87                                                CSW024
     C                     ENDIF                                                              CSW024
     C                     MOVE *BLANK    MFLD                                                CSW024
     C                     MOVELDSRI01    MFLD                                                CSW024
     C                     ENDIF                                                              CSW024
     C           DSRI02    IFNE *BLANK                                                        CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C           DN87      IFNE 'Y'                                                           CSW024
     C                     MOVE ':87J:'   MTAG                                                CSW024
     C                     MOVE 'Y'       DN87                                                CSW024
     C                     ENDIF                                                              CSW024
     C                     MOVE *BLANK    MFLD                                                CSW024
     C                     MOVELDSRI02    MFLD                                                CSW024
     C                     ENDIF                                                              CSW024
     C           DSRI03    IFNE *BLANK                                                        CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C           DN87      IFNE 'Y'                                                           CSW024
     C                     MOVE ':87J:'   MTAG                                                CSW024
     C                     MOVE 'Y'       DN87                                                CSW024
     C                     ENDIF                                                              CSW024
     C                     MOVE *BLANK    MFLD                                                CSW024
     C                     MOVELDSRI03    MFLD                                                CSW024
     C                     ENDIF                                                              CSW024
     C           DSRI04    IFNE *BLANK                                                        CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C           DN87      IFNE 'Y'                                                           CSW024
     C                     MOVE ':87J:'   MTAG                                                CSW024
     C                     MOVE 'Y'       DN87                                                CSW024
     C                     ENDIF                                                              CSW024
     C                     MOVE *BLANK    MFLD                                                CSW024
     C                     MOVELDSRI04    MFLD                                                CSW024
     C                     ENDIF                                                              CSW024
     C           DSRI05    IFNE *BLANK                                                        CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C           DN87      IFNE 'Y'                                                           CSW024
     C                     MOVE ':87J:'   MTAG                                                CSW024
     C                     MOVE 'Y'       DN87                                                CSW024
     C                     ENDIF                                                              CSW024
     C                     MOVE *BLANK    MFLD                                                CSW024
     C                     MOVELDSRI05    MFLD                                                CSW024
     C                     ENDIF                                                              CSW024
      *                                                                                       CSW024
      ** Else output :87D:                                                                    CSW024
     C                     ELSE                                                               CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C                     MOVE ':87D:'   MTAG                                                CSW024
     C                     MOVELDSCNA1    MFLD                                                CSW024
      ** Address 2                                                                            CSW024
     C           DSCNA2    IFNE *BLANKS                                                       CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C                     MOVELDSCNA2    MFLD                                                CSW024
     C                     ENDIF                                                              CSW024
      ** Address 3                                                                            CSW024
     C           DSCNA3    IFNE *BLANKS                                                       CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C                     MOVELDSCNA3    MFLD                                                CSW024
     C                     ENDIF                                                              CSW024
      ** Address 4                                                                            CSW024
     C           DSCNA4    IFNE *BLANKS                                                       CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C                     MOVELDSCNA4    MFLD                                                CSW024
     C                     ENDIF                                                              CSW024
      *                                                                                       CSW024
     C                     ENDIF                                                              CSW024
     C                     ENDIF                                                              CSW024
      *                                                                                       CSW024
     C                     ELSE                                                               CSW024
      *                                                                                       CSW024
     C           CSW201    IFEQ 'Y'                                                           CSW024
      *                                                                                       CSW024
      **  Field :87a: Party B                                                                 CSW201
      *                                                                                       CSW201
     C                     ADD  1         X                                                   CSW201
     C           X         OCUR MULT                                                          CSW201
      *                                                                                       CSW201
     C                     MOVE *BLANKS   ZDEST                                               CSW201
     C                     MOVELMGCNUM    ZDEST                                               CSW201
     C                     MOVE *BLANKS   ACLINE                                              CSW201
     C                     MOVE ' '       TAG                                                 CSW201
     C                     MOVE '87'      FLDNO                                               CSW201
     C                     EXSR FSWAD                                                         CSW201
      *                                                                                       CSW201
     C                     ENDIF                                                              CSW024
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
      **  Format Field :83a
     C/COPY WNCPYSRC,MG0300AC44
      *
     C                     EXSR FMT83
      *                                                                                       CSW212
      ** Field :77H: - Type, Date, Version of the Agreement                                   CSW212
      *                                                                                       CSW212
     C           CSW212    IFEQ 'Y'                                                           CSW212
      *                                                                                       CSW212
     C           MGAGTY    IFNE *BLANKS                                                       CSW212
     C                     ADD  1         X                                                   CSW212
     C           X         OCUR MULT                                                          CSW212
     C                     MOVE ':77H:'   MTAG                                                CSW212
      *                                                                                       CSW212
     C                     MOVEA*BLANKS   @WRK                                                CSW212
     C                     MOVEAMGAGTY    @WRK                                                CSW212
     C                     Z-ADD1         Z       30                                          CSW212
      *                                                                                       CSW212
     C           MGAGDT    IFNE *ZEROS                                                        CSW212
     C           ' '       LOKUP@WRK,Z                   31                                   CSW212
     C                     MOVEA'/'       @WRK,Z                                              CSW212
     C                     ADD  1         Z                                                   CSW212
     C                     MOVE MGAGDT    WNAGDT  8                                           CSW212
     C                     MOVEAWNAGDT    @WRK,Z                                              CSW212
     C                     ENDIF                                                              CSW212
      *                                                                                       CSW212
     C           MGAGVV    IFNE *ZEROS                                                        CSW212
     C           ' '       LOKUP@WRK,Z                   31                                   CSW212
     C                     MOVEA'//'      @WRK,Z                                              CSW212
     C                     ADD  2         Z                                                   CSW212
     C                     MOVE MGAGVV    WNAGVV  4                                           CSW212
     C                     MOVEAWNAGVV    @WRK,Z                                              CSW212
     C                     ENDIF                                                              CSW212
      *                                                                                       CSW212
     C                     MOVEA@WRK      MFLD                                                CSW212
      *                                                                                       CSW212
     C                     ENDIF                                                              CSW212
     C                     ENDIF                                                              CSW212
      *                                                                                       CSW212
      ** Field :77D: - Terms and Conditions                                                   CSW212
      *                                                                                       CSW212
     C           MGCON1    IFNE *BLANKS                                                       CSW212
      *                                                                                       CSW212
      ** Store the Conditions information for easier use                                      CSW212
      *                                                                                       CSW212
     C                     MOVE MGCON1    @BTB,1                                              CSW212
     C                     MOVE MGCON2    @BTB,2                                              CSW212
     C                     MOVE MGCON3    @BTB,3                                              CSW212
     C                     MOVE MGCON4    @BTB,4                                              CSW212
     C                     MOVE MGCON5    @BTB,5                                              CSW212
     C                     MOVE MGCON6    @BTB,6                                              CSW212
      *                                                                                       CSW212
     C                     Z-ADD0         I                                                   CSW212
     C                     MOVE 'N'       FLD77O  1                                           CSW212
      *                                                                                       CSW212
      ** Search through all six fields & output if not blank                                  CSW212
      *                                                                                       CSW212
     C           I         DOWLT6                                                             CSW212
      *                                                                                       CSW212
     C                     ADD  1         I                                                   CSW212
      *                                                                                       CSW212
     C           @BTB,I    IFNE *BLANKS                                                       CSW212
     C                     ADD  1         X                                                   CSW212
     C           X         OCUR MULT                                                          CSW212
     C           FLD77O    IFEQ 'N'                                                           CSW212
     C                     MOVE ':77D:'   MTAG                                                CSW212
     C                     MOVE 'Y'       FLD77O                                              CSW212
     C                     ENDIF                                                              CSW212
      *                                                                                       CSW212
     C                     MOVEL@BTB,I    MFLD                                                CSW212
     C                     ENDIF                                                              CSW212
      *                                                                                       CSW212
     C                     ENDDO                                                              CSW212
      *                                                                                       CSW212
     C                     ENDIF                                                              CSW212
      *                                                                                       CSW212
      **  Field :14C: - Year of Definitions                                                   CSW212
      *                                                                                       CSW212
     C           CSW212    IFEQ 'Y'                                                           CSW212
     C           MGISDA    IFNE *ZEROS                                                        CSW212
     C                     ADD  1         X                                                   CSW212
     C           X         OCUR MULT                                                          CSW212
     C                     MOVE ':14C:'   MTAG                                                CSW212
     C                     MOVELMGISDA    MFLD                                                CSW212
     C                     ENDIF                                                              CSW212
     C                     ENDIF                                                              CSW212
      *                                                                                       CSW212
     C/COPY WNCPYSRC,MG0300AC43
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   SRFMTB - Format message detail - Sequence B                 *
      *   Called by   main process                                    *
      *   Calls       FSWAD  format SWIFT address                     *
      *****************************************************************
      *
     C           SRFMTB    BEGSR
      *
      **  Field :15B: Transaction Details
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE ':15B:'   MTAG
     C                     MOVEL*BLANK    MFLD
      *
      **  Field :30T:  Trade Date (CCYYMMDD format)
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE MGTDAT    ZMDAY
      *
      **  Convert Midas date to SWIFT date format
     C                     CALL 'ZM0065'               15
     C                     PARM           ZMDAY   50
     C                     PARM           ZSDATE  6
     C                     PARM           ZSDATC  8
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '015'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 015  *
     C                     MOVEL'ZM0065'  DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     MOVE ':30T:'   MTAG
     C                     MOVELZSDATC    MFLD
      *
      **  Field :30V:  Value Date (CCYYMMDD format)
     C                     ADD  1         X
     C           X         OCUR MULT
      **  Format value date to SWIFT standard
     C           MGTTYP    IFEQ 'OP'
     C***********COB       ANDEQ'C'                                       139406
     C                     MOVE MGOTDT    ZMDAY
     C                     ELSE
     C                     MOVE MGVDAT    ZMDAY
     C                     ENDIF
     C                     CALL 'ZM0065'               15
     C                     PARM           ZMDAY   50
     C                     PARM           ZSDATE  6
     C                     PARM           ZSDATC  8
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '016'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 016  *
     C                     MOVEL'ZM0065'  DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     MOVE ':30V:'   MTAG
     C                     MOVELZSDATC    MFLD
      *
      **  Field :36:  Exchange rate
     C                     ADD  1         X
     C           X         OCUR MULT
     C/COPY WNCPYSRC,MG0300AC42
     C                     MOVE MGEXRT    ZEXRT
     C/COPY WNCPYSRC,MG0300AC01
      *
      **  Exchange rate conversion
     C                     CALL 'ZM0030'               15
     C                     PARM           ZEXRT  138
     C                     PARM           ZSEXRT 12
     C/COPY WNCPYSRC,MG0300AC37
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '017'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 017  *
     C                     MOVEL'ZM0030'  DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C/COPY WNCPYSRC,MG0300AC03
      *
     C                     MOVE ':36: '   MTAG
     C                     MOVELZSEXRT    MFLD
      *
      ** 1. Sequence B1 - Amount Bought
      ** ------------------------------
      *
      **  Field :32B:  Currency, Amount Bought
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      **  Format purchase currency and amount
     C                     MOVE MGPUCY    ZCCY
     C                     MOVE MGPAMT    ZAMNT
     C/COPY WNCPYSRC,MG0300AC38
     C                     CALL 'ZM0040'               15
     C                     PARM           ZAMNT  130
     C                     PARM           ZCCY    3
     C                     PARM           ZSAMNT 15
     C                     PARM           ZSCCY   3
     C                     PARM ' '       ZERR    1
     C                     PARM           ZSWDPC  1                                           222373
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '018'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 018  *
     C                     MOVEL'ZM0040'  DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     MOVE ':32B:'   MTAG
      *
      ** Error - indicate erroneous fields
     C           ZERR      IFEQ '1'
     C                     MOVE 'Y'       @ERR
     C                     MOVE MGPAMT    ZAMT
     C                     MOVELERR3N     MFLD
     C                     MOVELMSGA,5    MERR
     C                     ELSE
     C                     MOVELFLD2N     MFLD
     C                     ENDIF
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C                     MOVE 'Y'       ZDBEI                                               CSW201
     C                     ENDIF                                                              CSW201
      *
      **  Field :56a:  Intermediary
     C/COPY WNCPYSRC,MG0300AC22
      *
      **  Intermediary not blank; retrieve customer address
     C           MGRIBN    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELMGRIBN    ZDEST
     C                     MOVE *BLANKS   ACLINE 35
     C                     MOVELMGRIBA    ACLINE
     C                     MOVE ' '       TAG
     C                     MOVE '56'      FLDNO
     C                     MOVE NETBY     CKNETI                                              200478
     C                     EXSR FSWAD
     C                     ENDIF
      *
      **  Field :57a: Receiving Agent
     C/COPY WNCPYSRC,MG0300AC07
     C                     ADD  1         X
     C           X         OCUR MULT
      **  Test if settlement via nostro
     C                     MOVE MGRSTM    @STM    2
     C           @STM      LOKUPTABNST                   23
     C           MGRONS    IFNE *BLANKS
     C           *IN23     ANDEQ'1'
      *
      ** Use receipt settlement currency to access nostro if not blank.   137909
      ** Otherwise use purchase currency.                                 137909
     C           CEU003    IFEQ 'Y'                                       137909
     C           MGRCCY    ANDNE*BLANKS                                   137909
     C                     MOVE MGRCCY    @NSKYB                          137909
     C                     ELSE                                           137909
     C                     MOVE MGPUCY    @NSKYB                          137909
     C                     ENDIF                                          137909
      *                                                                   137909
     C                     MOVELMGRONS    @NSKYE
     C**********           CALL 'AONOSTR0'                                                    CDL094
     C                     CALL 'AONOSTR1'                                                    CDL094
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM *BLANKS   @NSKYA  6
     C***********          PARM MGPUCY    @NSKYB  3                       137909
     C                     PARM           @NSKYB  3                       137909
     C**********           PARM *BLANKS   @NSKYC  4                                           CGL029
     C                     PARM *BLANKS   @NSKYC 10                                           CGL029
     C                     PARM *BLANKS   @NSKYD  2
     C                     PARM           @NSKYE  2
     C                     PARM *BLANKS   @KEYF   3
     C                     PARM *BLANKS   @KEYG  10
     C                     PARM *BLANKS   @KEYH   1
     C********** SDNOST    PARM SDNOST    DSFDY                                               CDL094
     C           SDNOST    PARM SDNOST    DSSDY                                               CDL094
      *
     C           @RTCD     IFNE *BLANKS
     C                     MOVE 'Y'       @ERR
     C                     MOVELMGRONS    MFLD
     C                     MOVELMSGA,3    MERR
     C                     MOVE ':57 :'   MTAG
     C                     ELSE
      *
      * If CDL094 is On and Delivery Agent details have been defined for                      CDL094
      * the Nostro, use these and not the Customer of the Nostro details                      CDL094
     C           CDL094    IFEQ 'Y'                                                           CDL094
     C           A7RF57    ANDNE*BLANKS                                                       CDL094
      *                                                                                       CDL094
      * If SWIFT BIC defined as the Delivery Agent then obtain related                        CDL094
      * customer number                                                                       CDL094
     C                     MOVE *IN80     IN80    1                                           CDL094
     C                     MOVELA7RF57    WSWID  12                                           CDL094
     C           WSWID     CHAINSDCUSTL7             80                                       CDL094
     C           *IN80     IFEQ *OFF                                                          CDL094
     C                     MOVEL*BLANKS   ZDEST                                               CDL094
     C                     MOVELBBCUST    ZDEST                                               CDL094
     C                     ELSE                                                               CDL094
     C                     MOVEL*BLANKS   ZDEST                                               CDL094
     C                     MOVELA7RF57    ZDEST                                               CDL094
     C                     ENDIF                                                              CDL094
     C                     MOVEL*BLANKS   ACLINE                                              CDL094
     C                     MOVELA7RA57    ACLINE                                              CDL094
     C                     MOVE IN80      *IN80                                               CDL094
      *                                                                                       CDL094
     C                     ELSE                                                               CDL094
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELA7CUST    ZDEST
      *
     C/COPY WNCPYSRC,MG0300CCP1
      *
     C                     MOVEL*BLANKS   ACLINE
     C                     MOVE *BLANKS   @OANN  36                                         MD031101
     C           A7OACN    IFNE *BLANKS                                                     MD031101
     C                     MOVE A7OACN    @OANN                                             MD031101
     C                     MOVEL'/'       @OANN                                             MD031101
     C                     ENDIF                                                            MD031101
     C                     MOVEL@OANN     ACLINE                                            MD031101
     C                     ENDIF                                                              CDL094
     C                     MOVE ' '       TAG
     C                     MOVE '57'      FLDNO
     C                     MOVE NETBY     CKNETI  1                                           200478
     C/COPY WNCPYSRC,MG0300AC15
     C                     EXSR FSWAD
     C                     ENDIF
      *
      **  Our receive nostro is blank or settlement internal
     C                     ELSE
      **  Test if settlement internal
     C                     MOVE MGRSTM    @STM
     C           @STM      LOKUPTABINT                   23
      *
     C           *IN23     IFEQ '1'
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELSECN      ZDEST
     C                     MOVEL*BLANKS   ACLINE
     C                     MOVE ' '       TAG
     C                     MOVE '57'      FLDNO
     C                     MOVE NETBY     CKNETI                                              200478
     C                     EXSR FSWAD
      *
     C                     ELSE
     C                     MOVE ':57D:'   MTAG
      * If BUY NET deal set MFLD to 'TO BE NETTED'                                            200478
     C           NETBY     IFNE 'Y'                                                           200478
     C                     MOVEL'UNKNOWN' MFLD
     C                     ELSE                                                               200478
     C                     MOVELNETTXT    MFLD                                                200478
     C                     ENDIF                                                              200478
     C                     ENDIF
      *
     C                     ENDIF
     C/COPY WNCPYSRC,MG0300AC08
      *
      ** 2. Sequence B2 - Amount Sold
      ** ----------------------------
      *
      **  Field :33B: Sale Currency and Amount
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE MGSLCY    ZCCY
     C                     MOVE MGSAMT    ZAMNT
     C/COPY WNCPYSRC,MG0300AC39
     C                     CALL 'ZM0040'               15
     C                     PARM           ZAMNT  130
     C                     PARM           ZCCY    3
     C                     PARM           ZSAMNT 15
     C                     PARM           ZSCCY   3
     C                     PARM ' '       ZERR    1
     C                     PARM           ZSWDPC                                              222373
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '019'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 019  *
     C                     MOVEL'ZM0040'  DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     MOVE ':33B:'   MTAG
      **  Error ?
     C           ZERR      IFEQ '1'
     C                     MOVE 'Y'       @ERR
     C                     MOVE MGSAMT    ZAMT
     C                     MOVELERR3N     MFLD
     C                     MOVELMSGA,5    MERR
     C                     ELSE
      **  Set up field
     C                     MOVELFLD2N     MFLD
     C                     ENDIF
      *
      **  Field :53a: Delivery Agent
     C/COPY WNCPYSRC,MG0300AC09
      *                                                                   CDL008
      ** Suppress Field 53A if FX deal was settled through CLS            CDL008
      *                                                                   CDL008
     C           CDL008    IFEQ 'Y'                                       CDL008
     C           MGCLSS    ANDEQ'Y'                                       CDL008
     C                     ELSE                                           CDL008
      *
      **  Test if settlement via nostro
     C                     MOVE MGPSTM    @STM
     C           @STM      LOKUPTABNST                   23
      *
     C           MGPONS    IFNE *BLANKS
     C           *IN23     ANDEQ'1'
      *
      **  either A/C with Bank or Receipient entered
      **  or A/C with A/c line = 'DIRECT'
      *
     C           MGAWBN    IFNE *BLANKS
     C           MGRVNO    ORNE *BLANKS
     C           AWBA6     ANDNE'DIRECT'
      *
      ** Use payment settlement currency to access nostro if not blank.   137909
      ** Otherwise use sell currency.                                     137909
     C           CEU003    IFEQ 'Y'                                       137909
     C           MGPYCY    ANDNE*BLANKS                                   137909
     C                     MOVE MGPYCY    @NSKYB                          137909
     C                     ELSE                                           137909
     C                     MOVE MGSLCY    @NSKYB                          137909
     C                     ENDIF                                          137909
      *                                                                   137909
     C                     MOVELMGPONS    @NSKYE
     C**********           CALL 'AONOSTR0'                                                    CDL094
     C                     CALL 'AONOSTR1'                                                    CDL094
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM *BLANKS   @NSKYA  6
     C***********          PARM MGSLCY    @NSKYB  3                       137909
     C                     PARM           @NSKYB  3                       137909
     C**********           PARM *BLANKS   @NSKYC  4                                           CGL029
     C                     PARM *BLANKS   @NSKYC                                              CGL029
     C                     PARM *BLANKS   @NSKYD  2
     C                     PARM           @NSKYE  2
     C                     PARM *BLANKS   @KEYF   3
     C                     PARM *BLANKS   @KEYG  10
     C                     PARM *BLANKS   @KEYH   1
     C********** SDNOST    PARM SDNOST    DSFDY                                               CDL094
     C           SDNOST    PARM SDNOST    DSSDY                                               CDL094
      *
      **  Nostro customer not found
     C           @RTCD     IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE 'Y'       @ERR
     C                     MOVE ':53 :'   MTAG
     C                     MOVELMGPONS    MFLD
     C                     MOVELMSGA,3    MERR
     C                     ELSE
      *
      ** Branch Internal Customer cf. Customer number of Our Pay Nostro
     C                     MOVELSECN      @SECN   6
     C           @SECN     IFNE A7CUST
     C           MGAWBN    ANDNEA7CUST
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZDEST
     C           MGRVNO    IFEQ *BLANKS
     C                     MOVELA7CUST    ZDEST
     C                     ELSE
     C                     MOVELMGRVNO    ZDEST
     C/COPY WNCPYSRC,MG0300AC02
     C                     ENDIF
     C*********************CALL 'ZM0050'               15                 CSW036
     C                     CALL 'ZM0051'               15                 CSW036
     C                     PARM           ZDEST  12
     C                     PARM           ZSADD1 35
     C                     PARM           ZSADD2 35
     C                     PARM           ZSADD3 35
     C                     PARM           ZSADD4 35
     C                     PARM           ZSTAG   1
     C                     PARM           ZSTYPE  1
     C                     PARM ' '       ZERR    1
     C                     PARM           ZDBEI   1                                           CSW201
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '020'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 020  *
     C*********************MOVEL'ZM0050'  DBFILE           * * * * * * * *CSW036
     C                     MOVEL'ZM0051'  DBFILE           * * * * * * * *CSW036
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      **  Error when formating address
     C           ZERR      IFEQ '1'
     C                     MOVE 'Y'       @ERR
     C                     MOVE ':53 :'   MTAG
     C                     MOVELZDEST     MFLD
     C                     MOVELMSGA,6    MERR
     C                     ELSE
     C                     EXSR FMT53
     C                     ENDIF
     C                     ENDIF                           Cust. No differ
     C                     ENDIF                           Nostro exist
     C                     ENDIF                           A/C & recepient
     C                     ENDIF                           Pay nostro/set.
     C                     ENDIF                                          CDL008
     C/COPY WNCPYSRC,MG0300AC10
      *
      **  Field :56a: and :57a: Receiving and benefciary inst.
      **  Nostro field blank
     C           MGPSTM    IFEQ 00
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE ':57D:'   MTAG
      *If SELL NET deal set MFLD to 'TO BE NETTED'                                            200478
     C           NETSL     IFNE 'Y'                                                           200478
     C                     MOVEL'UNKNOWN' MFLD
     C                     ELSE                                                               200478
     C                     MOVELNETTXT    MFLD                                                200478
     C                     ENDIF                                                              200478
     C                     MOVE 'Y'       FLD57U  1
     C                     END
      *
      **  Field 57 Seq C is not UNKNOWN
     C           FLD57U    IFNE 'Y'
      *
      **  Field 56 and Field 57  intermediary and account with inst.
     C                     EXSR FMTC1
     C                     END
     C                     MOVE 'N'       FLD57U
      *                                                                                       CSW201
     C                     MOVE *BLANK    ZDBEI                                               CSW201
      *
      **  Field :58a:
     C/COPY WNCPYSRC,MG0300AC19
      *
     C           WBCUST    IFNE MGCNUM
     C********** WBCUST    ANDNE0                                                      122377 CSD027
     C           WBCUST    ANDNE*BLANKS                                                       CSD027
     C           WBCUST    OREQ MGCNUM                                                      MD039569
     C           WBCUST    ANDNE*BLANKS                                                     MD039569
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZDEST
     C/COPY WNCPYSRC,MG0300AC20
     C                     MOVELMGBENN    ZDEST
     C/COPY WNCPYSRC,MG0300AC11
     C                     MOVE *BLANKS   ACLINE
     C                     MOVELMGBENA    ACLINE                                            MD039569
     C                     MOVE ' '       TAG
     C                     MOVE '58'      FLDNO
     C                     EXSR FSWAD
     C/COPY WNCPYSRC,MG0300AC21
     C                     ENDIF
      *
     C/COPY WNCPYSRC,MG0300AC50
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   SRFMTC - Format message detail - Sequence C                 *
      *   Called by   Main process                                    *
      *   Calls       FMTC1  format field 56 and 57                   *
      *****************************************************************
      *
     C           SRFMTC    BEGSR
      *
      **  Field :15C: New Sequence
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE ':15C:'   MTAG
     C                     MOVEL*BLANK    MFLD
      *
     C           CSW012    IFEQ 'Y'                                       CSW012
      **  Field :29A: Contact Information                                 CSW012
      *                                                                   CSW012
     C           MGCTC1    IFNE *BLANKS                                   CSW012
     C                     ADD  1         X                               CSW012
     C           X         OCUR MULT                                      CSW012
     C                     MOVE ':29A:'   MTAG                            CSW012
     C                     MOVELMGCTC1    MFLD                            CSW012
     C           MGCTC2    IFNE *BLANKS                                   CSW012
     C                     ADD  1         X                               CSW012
     C           X         OCUR MULT                                      CSW012
     C                     MOVELMGCTC2    MFLD                            CSW012
     C                     ENDIF                                          CSW012
     C           MGCTC3    IFNE *BLANKS                                   CSW012
     C                     ADD  1         X                               CSW012
     C           X         OCUR MULT                                      CSW012
     C                     MOVELMGCTC3    MFLD                            CSW012
     C                     ENDIF                                          CSW012
     C                     ENDIF                                          CSW012
      *                                                                   CSW012
     C                     ENDIF                                          CSW012
      *
      **  Field :24D: Dealing Method
     C                     MOVE *BLANK    @RTCD
     C                     MOVE 'N'       WBRKC   1
     C                     MOVE *BLANK    WBRKN  30
     C                     MOVE *BLANK    WBRTN  10
     C                     MOVE 'N'       WFLD72  1
      *
     C           MGBRKC    IFNE 'TELX'
     C           MGBRKC    ANDNE'PHON'
     C           MGBRKC    ANDNE*BLANK
     C                     CALL 'AOBROKR0'
     C                     PARM           @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM MGBRKC    @BROKY  4
     C           SDBROK    PARM SDBROK    DSFDY
     C                     ENDIF
      *
     C           @RTCD     IFEQ *BLANK
     C           MGBRKC    ANDNE*BLANK
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE ':24D:'   MTAG
      *
     C                     SELEC
     C           MGBRKC    WHEQ 'TELX'
     C                     MOVEL'TELX'    MFLD
     C           MGBRKC    WHEQ 'PHON'
     C                     MOVEL'PHON'    MFLD
     C                     OTHER
     C                     MOVE 'Y'       WBRKC
     C                     MOVELA9BKNM    WBRKN
     C                     MOVELA9BRTN    WBRTN
     C           A9EBS     IFEQ 'Y'                                       125375
     C                     MOVEL'ELEC'    MFLD                            125375
     C                     ELSE                                           125375
     C                     MOVEL'BROK'    MFLD
     C                     ENDIF                                          125375
     C                     ENDSL
      *
     C                     ELSE
      *
     C           MGBRKC    IFNE *BLANKS
     C                     MOVE 'Y'       WFLD72  1
     C                     ENDIF
     C*
     C                     ENDIF
      *                                                                                       255986
      **  Field :72: Sender to Receiver Information                                           255986
      **   from bank-to-bank fields within settlement instructions                            255986
     C           MGBTB1    IFNE *BLANKS                                                       255986
     C           MGBTB2    ORNE *BLANKS                                                       255986
     C           MGBTB3    ORNE *BLANKS                                                       255986
     C           MGBTB4    ORNE *BLANKS                                                       255986
     C           MGBTB5    ORNE *BLANKS                                                       255986
     C           MGBTB6    ORNE *BLANKS                                                       255986
     C                     MOVE 'Y'       WFLD72  1                                           255986
     C                     ENDIF                                                              255986
      *
      **  Field :88a: Broker Identification
      *
     C           WBRKC     IFEQ 'Y'
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE ':88D:'   MTAG
     C                     MOVELWBRKN     MFLD
      *
      **  Broker Town
     C           WBRTN     IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELWBRTN     MFLD
     C                     ENDIF
     C                     ENDIF
      *
      **  Field :72: Sender to Receiver Information
     C/COPY WNCPYSRC,MG0300AC32
      *                                                                   CDL008
      ** If CDL008 is installed and the FX deal has been amended from     CDL008
      ** CLS Settlement 'N' to 'Y', output Field :72:                     CDL008
      *                                                                   CDL008
     C           CDL008    IFEQ 'Y'                                       CDL008
     C           CWRD      ANDEQ'AMEND'                                   CDL008
     C           MGCLSS    ANDEQ'Y'                                       CDL008
     C           WCLSS     ANDEQ'N'                                       CDL008
     C                     MOVE 'Y'       WFLD72                          CDL008
     C                     MOVE *ON       WCLS    1                       CDL008
     C                     ELSE                                           CDL008
     C                     MOVE *OFF      WCLS                            CDL008
     C                     ENDIF                                          CDL008
      *                                                                   CDL008
     C           WFLD72    IFEQ 'Y'
     C**********           ADD  1         X                                                   255986
     C********** X         OCUR MULT                                                          255986
     C**********           MOVE ':72: '   MTAG                                                255986
     C**********           EXSR FLD72                                                 255986 255986B
      *                                                                   CDL008
     C/COPY WNCPYSRC,MGH00105
     C           WCLS      IFEQ *ON                                       CDL008
     C                     ADD  1         X                                                  255986B
     C           X         OCUR MULT                                                         255986B
     C                     MOVE ':72: '   MTAG                                               255986B
     C                     MOVEL'/'       MFLD                            CDL008
     C           MFLD      CAT  'REC/':0  MFLD                            CDL008
     C           MFLD      CAT  'CLSB':0  MFLD                            CDL008
     C********** MFLD      CAT  'NEWT/':0 MFLD                                         CDL008 202275
     C           MFLD      CAT  'NEWT':0  MFLD                                                202275
     C                     Z-ADD1         SWCTR   30                                         255986B
     C                     MOVE 'Y'       LINE2   1                                          255986B
     C                     ELSE                                           CDL008
     C**********           MOVEL'/'       MFLD                                                255986
     C********** MFLD      CAT  MGBRKC:0  MFLD                                                255986
     C********** MFLD      CAT  '/':0     MFLD                                                255986
     C                     ENDIF                                          CDL008
      *                                                                   CDL008
     C                     EXSR FLD72                                                        255986B
      *                                                                                      255986B
     C                     ENDIF
     C/COPY WNCPYSRC,MG0300AC33
      *
     C                     ENDSR
     C/EJECT                                                                                  CSW213
      *****************************************************************                       CSW213
      *   SRFMTE - Format message detail - Sequence E                 *                       CSW213
      *   Called by   Main process                                    *                       CSW213
      *   Calls                                                       *                       CSW213
      *****************************************************************                       CSW213
      *                                                                                       CSW213
     C           SRFMTE    BEGSR                                                              CSW213
      *                                                                                       CSW213
      **  Field :15E: New Sequence                                                            CSW213
      *                                                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVE ':15E:'   MTAG                                                CSW213
     C                     MOVEL*BLANK    MFLD                                                CSW213
     C                     Z-ADDX         X15E    20                                        MD022981
      *                                                                                       CSW213
      **  Clear multiple occurrence DS for the RPPT                                           CSW213
      *                                                                                       CSW213
     C                     Z-ADD1         Y       10                                          CSW213
     C           Y         OCUR RPPT                                                          CSW213
     C           Y         DOWLE4                                                             CSW213
      *                                                                                       CSW213
     C                     CLEARRPPT                                                          CSW213
      *                                                                                       CSW213
      **  This will clear the RPPT Multi-Occurence DS for the ff fields                       CSW213
      **  MGRJXX - Reporting Jurisdiction    MGUTXX - UTI Namespace/Issuer Code               CSW213
      **  MGRPXX - Reporting Party           MGTNXX - Transaction Identifier                  CSW213
      **  MGRNXX - Reporting Party Name      MGTIXX - Transaction Identifier Type             CSW213
      **  MGRCXX - Reporting Party City      MGETXX - Event Type                              CSW213
      **  MGRSXX - Reporting Party SWIFT identification                                       CSW213
      **  MGRLXX - Reporting Party LEI                                                        CSW213
      **  MGRAXX - Reporting Party Account                                                    CSW213
      *                                                                                       CSW213
     C                     ADD  1         Y                                                   CSW213
     C           Y         OCUR RPPT                                                          CSW213
     C                     ENDDO                                                              CSW213
     C                     Z-ADD0         Y                                                   CSW213
      *                                                                                       CSW213
      **  Initialize multioccurence DS RPPT with the 4 set of fields                          CSW213
      *                                                                                       CSW213
     C                     Z-ADD1         Y1      10                                          CSW213
     C           Y1        OCUR RPPT                                                          CSW213
     C           Y1        DOWLE4                                                             CSW213
     C           Y1        IFEQ 1                                                             CSW213
     C                     MOVE MGRJ01    MGRJXX                                              CSW213
     C                     MOVE MGRP01    MGRPXX                                              CSW213
     C                     MOVE MGRN01    MGRNXX                                              CSW213
     C                     MOVE MGRC01    MGRCXX                                              CSW213
     C                     MOVE MGRS01    MGRSXX                                              CSW213
     C                     MOVE MGRL01    MGRLXX                                              CSW213
     C                     MOVE MGRA01    MGRAXX                                              CSW213
     C                     MOVE MGUT01    MGUTXX                                              CSW213
     C                     MOVE MGTN01    MGTNXX                                              CSW213
     C                     MOVE MGTI01    MGTIXX                                              CSW213
     C                     MOVE MGET01    MGETXX                                              CSW213
     C                     ENDIF                                                              CSW213
     C           Y1        IFEQ 2                                                             CSW213
     C                     MOVE MGRJ02    MGRJXX                                              CSW213
     C                     MOVE MGRP02    MGRPXX                                              CSW213
     C                     MOVE MGRN02    MGRNXX                                              CSW213
     C                     MOVE MGRC02    MGRCXX                                              CSW213
     C                     MOVE MGRS02    MGRSXX                                              CSW213
     C                     MOVE MGRL02    MGRLXX                                              CSW213
     C                     MOVE MGRA02    MGRAXX                                              CSW213
     C                     MOVE MGUT02    MGUTXX                                              CSW213
     C                     MOVE MGTN02    MGTNXX                                              CSW213
     C                     MOVE MGTI02    MGTIXX                                              CSW213
     C                     MOVE MGET02    MGETXX                                              CSW213
     C                     ENDIF                                                              CSW213
     C           Y1        IFEQ 3                                                             CSW213
     C                     MOVE MGRJ03    MGRJXX                                              CSW213
     C                     MOVE MGRP03    MGRPXX                                              CSW213
     C                     MOVE MGRN03    MGRNXX                                              CSW213
     C                     MOVE MGRC03    MGRCXX                                              CSW213
     C                     MOVE MGRS03    MGRSXX                                              CSW213
     C                     MOVE MGRL03    MGRLXX                                              CSW213
     C                     MOVE MGRA03    MGRAXX                                              CSW213
     C                     MOVE MGUT03    MGUTXX                                              CSW213
     C                     MOVE MGTN03    MGTNXX                                              CSW213
     C                     MOVE MGTI03    MGTIXX                                              CSW213
     C                     MOVE MGET03    MGETXX                                              CSW213
     C                     ENDIF                                                              CSW213
     C           Y1        IFEQ 4                                                             CSW213
     C                     MOVE MGRJ04    MGRJXX                                              CSW213
     C                     MOVE MGRP04    MGRPXX                                              CSW213
     C                     MOVE MGRN04    MGRNXX                                              CSW213
     C                     MOVE MGRC04    MGRCXX                                              CSW213
     C                     MOVE MGRS04    MGRSXX                                              CSW213
     C                     MOVE MGRL04    MGRLXX                                              CSW213
     C                     MOVE MGRA04    MGRAXX                                              CSW213
     C                     MOVE MGUT04    MGUTXX                                              CSW213
     C                     MOVE MGTN04    MGTNXX                                              CSW213
     C                     MOVE MGTI04    MGTIXX                                              CSW213
     C                     MOVE MGET04    MGETXX                                              CSW213
     C                     ENDIF                                                              CSW213
     C                     ADD  1         Y1                                                  CSW213
     C           Y1        OCUR RPPT                                                          CSW213
     C                     ENDDO                                                              CSW213
     C                     Z-ADD0         Y1                                                  CSW213
      *                                                                                       CSW213
     C                     EXSR SRRPPT                                                      MD023007
      *                                                                                     MD023007
     C                     Z-ADD0         WRKIX   10                                          CSW213
     C                     MOVEL'N'       WRKFLG  1                                           CSW213
      *                                                                                       CSW213
      **  Do Loop for 4 times                                                                 CSW213
      *                                                                                       CSW213
     C           WRKIX     DOWLT4                                                             CSW213
     C                     ADD  1         WRKIX                                               CSW213
     C********** WRKIX     OCUR RPPT                                                 CSW213 MD023007
     C           IX,WRKIX  OCUR RPPT                                                        MD023007
      *                                                                                       CSW213
      **  Reporting Jurisdiction                                                              CSW213
      *                                                                                       CSW213
     C           MGRJXX    IFEQ *BLANKS                                                       CSW213
     C                     ADD  5         WRKIX                                               CSW213
     C                     ELSE                                                               CSW213
     C********** MGRJXX    IFNE *BLANKS                                             CSW213 MD022633A
     C********** MGRPXX    ANDNE*BLANKS                                             CSW213 MD022633A
     C********** MGRNXX    ANDNE*BLANKS                                             CSW213 MD022633A
     C********** MGRCXX    ANDNE*BLANKS                                             CSW213 MD022633A
     C********** MGRSXX    ANDNE*BLANKS                                             CSW213 MD022633A
     C********** MGRLXX    ANDNE*BLANKS                                             CSW213 MD022633A
     C********** MGRAXX    ANDNE*BLANKS                                             CSW213 MD022633A
     C           MGRJXX    IFNE WRKMRJ                                                      MD022633
     C           MGRPXX    ORNE WRKMRP                                                      MD022633
     C           MGRNXX    ORNE WRKMRN                                                     MD022633A
     C           MGRCXX    ORNE WRKMRC                                                     MD022633A
     C           MGRSXX    ORNE WRKMRS                                                     MD022633A
     C           MGRLXX    ORNE WRKMRL                                                     MD022633A
     C           MGRAXX    ORNE WRKMRA                                                     MD022633A
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':22L:'   MTAG                                                CSW213
     C                     MOVELMGRJXX    MFLD                                                CSW213
     C                     MOVEL'N'       WRKFLG                                              CSW213
     C**********           ENDIF                                                     CSW213 MD022633
      *                                                                                       CSW213
      **  Reporting Party                                                                     CSW213
      *                                                                                       CSW213
     C           MGRPXX    IFNE *BLANKS                                                       CSW213
     C                     MOVELMGRPXX    WRKMRP  6                                         MD022633
     C                     MOVELMGRJXX    WRKMRJ 35                                         MD022633
     C                     MOVELMGRNXX    WRKMRN 20                                        MD022633A
     C                     MOVELMGRCXX    WRKMRC 10                                        MD022633A
     C                     MOVELMGRSXX    WRKMRS 11                                        MD022633A
     C                     MOVELMGRLXX    WRKMRL 20                                        MD022633A
     C                     MOVELMGRAXX    WRKMRA 34                                        MD022633A
     C                     MOVE *BLANKS   ZDEST                                               CSW213
     C                     MOVELMGRPXX    ZDEST                                               CSW213
     C                     MOVELMGRAXX    ACLINE                                              CSW213
     C                     MOVEL'91'      FLDNO                                               CSW213
     C                     MOVE *BLANKS   TAG                                                 CSW213
     C                     EXSR SRFMPY                                                        CSW213
     C                     ELSE                                                               CSW213
     C           MGRLXX    IFEQ *BLANKS                                                       CSW213
     C           MGRNXX    ANDEQ*BLANKS                                                       CSW213
     C           MGRSXX    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':91A:'   MTAG                                                CSW213
     C                     MOVEL*BLANKS   MFLD                                                CSW213
     C                     MOVELMGRSXX    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     ELSE                                                               CSW213
     C                     MOVELMGRPXX    WRKMRP                                           MD022633A
     C                     MOVELMGRJXX    WRKMRJ                                           MD022633A
     C                     MOVELMGRNXX    WRKMRN                                           MD022633A
     C                     MOVELMGRCXX    WRKMRC                                           MD022633A
     C                     MOVELMGRSXX    WRKMRS                                           MD022633A
     C                     MOVELMGRLXX    WRKMRL                                           MD022633A
     C                     MOVELMGRAXX    WRKMRA                                           MD022633A
     C           MGRNXX    IFNE *BLANKS                                                       CSW213
     C           MGRSXX    ANDNE*BLANKS                                                       CSW213
     C           MGRNXX    ORNE *BLANKS                                                       CSW213
     C           MGRLXX    ANDNE*BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':91J:'   MTAG                                                CSW213
     C           MGRSXX    IFNE *BLANKS                                                       CSW213
     C           '/ABIC/'  CAT  MGRSXX    MFLD                                                CSW213
     C                     ELSE                                                               CSW213
     C           '/ABIC'   CAT  '/UKWN'   MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           MGRLXX    IFNE *BLANKS                                                       CSW213
     C           '/LEIC/'  CAT  MGRLXX    MFLD                                                CSW213
     C                     ELSE                                                               CSW213
     C           '/NAME/'  CAT  MGRNXX    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGRCXX    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           '/NAME/'  CAT  MGRCXX    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     ELSE                                                               CSW213
     C           MGRNXX    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':91D:'   MTAG                                                CSW213
     C                     MOVELMGRNXX    MFLD                                                CSW213
     C           MGRCXX    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVELMGRCXX    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                            MD022633
     C**********           ENDIF                                                  MD022633 MD022633A
      *                                                                                       CSW213
      **  Unique Transaction Identifier/Prior Unique Transaction Identifier                   CSW213
      *                                                                                       CSW213
     C           MGUTXX    IFNE *BLANKS                                                       CSW213
     C           MGTNXX    ANDNE*BLANKS                                                       CSW213
     C           MGTIXX    IFEQ '0'                                                           CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':22M:'   MTAG                                                CSW213
     C                     MOVELMGUTXX    MFLD                                                CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':22N:'   MTAG                                                CSW213
     C                     MOVELMGTNXX    MFLD                                                CSW213
     C                     MOVEL'Y'       WRKFLG                                              CSW213
     C                     ELSE                                                               CSW213
     C           WRKFLG    IFEQ 'Y'                                                           CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':22P:'   MTAG                                                CSW213
     C                     MOVELMGUTXX    MFLD                                                CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':22R:'   MTAG                                                CSW213
     C                     MOVELMGTNXX    MFLD                                                CSW213
     C                     ELSE                                                               CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':22M:'   MTAG                                                CSW213
     C                     MOVELMGUTXX    MFLD                                                CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':22N:'   MTAG                                                CSW213
     C                     MOVELMGTNXX    MFLD                                                CSW213
     C                     MOVEL'Y'       WRKFLG                                              CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
     C                     ENDDO                                                              CSW213
      *                                                                                       CSW213
      **  Central Counterparty Clearing House                                                 CSW213
      *                                                                                       CSW213
     C           MGCCPI    IFNE *BLANKS                                                       CSW213
     C                     MOVE *BLANKS   ZDEST                                               CSW213
     C                     MOVELMGCCPI    ZDEST                                               CSW213
     C                     MOVELMGCCPA    ACLINE                                              CSW213
     C                     MOVEL'81'      FLDNO                                               CSW213
     C                     MOVE *BLANKS   TAG                                                 CSW213
     C                     EXSR SRFMPY                                                        CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW214
      **  Clearing Broker                                                                     CSW214
      *                                                                                       CSW214
     C           CSW214    IFEQ 'Y'                                                           CSW214
      *                                                                                       CSW214
     C           MGCBRI    IFNE *BLANKS                                                       CSW214
     C                     MOVE *BLANKS   ZDEST                                               CSW214
     C                     MOVELMGCBRI    ZDEST                                               CSW214
     C                     MOVELMGCBRA    ACLINE                                              CSW214
     C                     MOVEL'89'      FLDNO                                               CSW214
     C                     MOVE *BLANKS   TAG                                                 CSW214
     C                     EXSR SRFMPY                                                        CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                       CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                       CSW213
      **  Clearing Exception Party                                                            CSW213
      *                                                                                       CSW213
     C           MGCEPI    IFNE *BLANKS                                                       CSW213
     C                     MOVE *BLANKS   ZDEST                                               CSW213
     C                     MOVELMGCEPI    ZDEST                                               CSW213
     C                     MOVELMGCEPA    ACLINE                                              CSW213
     C                     MOVEL'96'      FLDNO                                               CSW213
     C                     MOVE *BLANKS   TAG                                                 CSW213
     C                     EXSR SRFMPY                                                        CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      **  Clearing Broker Identification                                                      CSW213
      *                                                                                       CSW213
     C           MGCBCI    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':22S:'   MTAG                                                CSW213
     C           'C/'      CAT  MGCBCI    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGCBPI    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':22S:'   MTAG                                                CSW213
     C           'P/'      CAT  MGCBPI    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      **  Cleared Product Identification                                                      CSW213
      *                                                                                       CSW213
     C           MGPRID    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':22T:'   MTAG                                                CSW213
     C                     MOVELMGPRID    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      **  Clearing Threshold Indicator                                                        CSW213
      *                                                                                       CSW213
     C           MGCGTI    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':17E:'   MTAG                                                CSW213
     C                     MOVELMGCGTI    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      **  Underlying Product Identifier                                                       CSW213
      *                                                                                       CSW213
     C           MGUPID    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':22U:'   MTAG                                                CSW213
     C                     MOVELMGUPID    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      **  Allocation Indicator                                                                CSW213
      *                                                                                       CSW213
     C           MGALLI    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':17H:'   MTAG                                                CSW213
     C                     MOVELMGALLI    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      **  Collateralisation Indicator                                                         CSW213
      *                                                                                       CSW213
     C           MGCLLI    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':17P:'   MTAG                                                CSW213
     C                     MOVELMGCLLI    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      **  Execution Venue                                                                     CSW213
      *                                                                                       CSW213
     C           MGEXVE    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':22V:'   MTAG                                                CSW213
     C                     MOVELMGEXVE    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      **  Execution Timestamp                                                                 CSW213
      *                                                                                       CSW213
     C********** MGUTCT    IFNE *ZEROS                                               CSW213 MD023798
     C********** MGGEDT    ORNE *ZEROS                                             MD022981 MD023798
     C********** MGGETM    ORNE *ZEROS                                             MD022981 MD023798
     C           MGGEDT    IFNE *ZEROS                                                      MD023798
     C           MGGETM    ANDNE*ZEROS                                                      MD023798
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':98D:'   MTAG                                                CSW213
     C                     MOVE MGGEDT    DNGEDT  8                                           CSW213
     C                     MOVE MGGETM    DNGETM  6                                           CSW213
     C                     MOVE MGUTCT    DNUTCT  4                                           CSW213
     C           MGUSGN    IFEQ 'N'                                                           CSW213
     C           DNGEDT    CAT  DNGETM    ETIME1 14                                           CSW213
     C           '/N'      CAT  DNUTCT    ETIME2  6                                           CSW213
     C           ETIME1    CAT  ETIME2    MFLD                                                CSW213
     C                     ELSE                                                               CSW213
     C           DNGEDT    CAT  DNGETM    ETIME1 14                                           CSW213
     C********** ETIME1    CAT  DNUTCT    MFLD                                       CSW213 MD023798
      *                                                                                     MD023798
     C           DNUTCT    IFNE *ZEROS                                                      MD023798
     C           '/'       CAT  DNUTCT    ETIME3  5                                         MD023798
     C           ETIME1    CAT  ETIME3    MFLD                                              MD023798
     C                     ELSE                                                             MD023798
     C                     MOVELETIME1    MFLD                                              MD023798
     C                     ENDIF                                                            MD023798
      *                                                                                     MD023798
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      **  Non Standard Flag                                                                   CSW213
      *                                                                                       CSW213
     C           MGNORS    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':17W:'   MTAG                                                CSW213
     C                     MOVELMGNORS    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      **  Link Swap Identification                                                            CSW213
      *                                                                                       CSW213
     C           MGLSID    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':22W:'   MTAG                                                CSW213
     C                     MOVELMGLSID    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW214
     C           CSW214    IFEQ 'Y'                                                           CSW214
      *                                                                                       CSW214
      ** Financial Nature of the Counterparty Indicator                                       CSW214
      *                                                                                       CSW214
     C           MGFNCI    IFNE *BLANKS                                                       CSW214
     C                     ADD  1         X                                                   CSW214
     C           X         OCUR MULT                                                          CSW214
     C                     MOVEL':17Y:'   MTAG                                                CSW214
     C                     MOVELMGFNCI    MFLD                                                CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                       CSW214
      ** Collateral Portfolio Indicator                                                       CSW214
      *                                                                                       CSW214
     C           MGCOPI    IFNE *BLANKS                                                       CSW214
     C                     ADD  1         X                                                   CSW214
     C           X         OCUR MULT                                                          CSW214
     C                     MOVEL':17Z:'   MTAG                                                CSW214
     C                     MOVELMGCOPI    MFLD                                                CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                       CSW214
      ** Collateral Portfolio Code                                                            CSW214
      *                                                                                       CSW214
     C           MGCOPI    IFEQ 'Y'                                                           CSW214
     C           MGCOPC    ANDNE*BLANKS                                                       CSW214
     C                     ADD  1         X                                                   CSW214
     C           X         OCUR MULT                                                          CSW214
     C                     MOVEL':22Q:'   MTAG                                                CSW214
     C                     MOVELMGCOPC    MFLD                                                CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                       CSW214
      ** Portfolio Compression Indicator                                                      CSW214
      *                                                                                       CSW214
     C           MGPOCI    IFNE *BLANKS                                                       CSW214
     C                     ADD  1         X                                                   CSW214
     C           X         OCUR MULT                                                          CSW214
     C                     MOVEL':17L:'   MTAG                                                CSW214
     C                     MOVELMGPOCI    MFLD                                                CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                       CSW214
      ** Corporate Sector Indicator                                                           CSW214
      *                                                                                       CSW214
     C           MGCOSI    IFNE *BLANKS                                                       CSW214
     C                     ADD  1         X                                                   CSW214
     C           X         OCUR MULT                                                          CSW214
     C                     MOVEL':17M:'   MTAG                                                CSW214
     C                     MOVELMGCOSI    MFLD                                                CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                       CSW214
      ** Trade with Non-EEA Counterparty Indicator                                            CSW214
      *                                                                                       CSW214
     C           MGTNEI    IFNE *BLANKS                                                       CSW214
     C                     ADD  1         X                                                   CSW214
     C           X         OCUR MULT                                                          CSW214
     C                     MOVEL':17Q:'   MTAG                                                CSW214
     C                     MOVELMGTNEI    MFLD                                                CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                       CSW214
      ** Intragroup Trade Indicator                                                           CSW214
      *                                                                                       CSW214
     C           MGIGTI    IFNE *BLANKS                                                       CSW214
     C                     ADD  1         X                                                   CSW214
     C           X         OCUR MULT                                                          CSW214
     C                     MOVEL':17S:'   MTAG                                                CSW214
     C                     MOVELMGIGTI    MFLD                                                CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                       CSW214
      ** Commercial or Treasury Financial Indicator                                           CSW214
      *                                                                                       CSW214
     C           MGCTFI    IFNE *BLANKS                                                       CSW214
     C                     ADD  1         X                                                   CSW214
     C           X         OCUR MULT                                                          CSW214
     C                     MOVEL':17X:'   MTAG                                                CSW214
     C                     MOVELMGCTFI    MFLD                                                CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                       CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                       CSW213
      **  Additional Reporting Information                                                    CSW213
      *                                                                                       CSW213
     C           MGAR01    IFNE *BLANKS                                                       CSW213
     C           MGAR02    ORNE *BLANK                                                        CSW213
     C           MGAR03    ORNE *BLANK                                                        CSW213
     C           MGAR04    ORNE *BLANK                                                        CSW213
     C           MGAR05    ORNE *BLANK                                                        CSW213
     C           MGAR06    ORNE *BLANK                                                        CSW213
     C           MGAR07    ORNE *BLANK                                                        CSW213
     C           MGAR08    ORNE *BLANK                                                        CSW213
     C           MGAR09    ORNE *BLANK                                                        CSW213
     C           MGAR10    ORNE *BLANK                                                        CSW213
     C           MGAR11    ORNE *BLANK                                                        CSW213
     C           MGAR12    ORNE *BLANK                                                        CSW213
     C           MGAR13    ORNE *BLANK                                                        CSW213
     C           MGAR14    ORNE *BLANK                                                        CSW213
     C           MGAR15    ORNE *BLANK                                                        CSW213
     C           MGAR16    ORNE *BLANK                                                        CSW213
     C           MGAR17    ORNE *BLANK                                                        CSW213
     C           MGAR18    ORNE *BLANK                                                        CSW213
     C           MGAR19    ORNE *BLANK                                                        CSW213
     C           MGAR20    ORNE *BLANK                                                        CSW213
      *                                                                                       CSW213
     C                     MOVE *BLANK    DN77    1                                           CSW213
     C           MGAR01    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR01    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR02    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR02    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR03    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR03    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR04    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR04    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR05    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR05    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR06    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR06    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR07    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR07    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR08    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR08    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR09    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR09    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR10    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR10    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR11    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR11    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR12    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR12    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR13    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR13    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR14    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR14    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR15    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR15    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR16    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR16    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR17    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR17    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR18    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR18    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR19    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR19    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR20    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR20    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
     C           X         IFEQ X15E                                                        MD022981
     C                     MOVE *BLANKS   MTAG                                              MD022981
     C                     SUB  1         X                                                 MD022981
     C                     ENDIF                                                            MD022981
      *                                                                                     MD022981
     C                     ENDSR                                                              CSW213
     C/EJECT                                                                                  CSW213
      *****************************************************************                       CSW213
      *   SRFMPY - Format message - Cust. Extension SWIFT Details     *                       CSW213
      *   Called by   Main process                                    *                       CSW213
      *   Calls - None                                                *                       CSW213
      *****************************************************************                       CSW213
      *                                                                                       CSW213
     C           SRFMPY    BEGSR                                                              CSW213
      *                                                                                       CSW213
     C           ACLINE    IFNE *BLANKS                                                       CSW213
     C           1         SUBSTACLINE:1  ACTEMP  1                                           CSW213
     C           ACTEMP    IFNE '/'                                                           CSW213
     C           '/'       CAT  ACLINE    ACLINE                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      **  Access Customer for with ZDEST (10 first characters) field using                    CSW213
      **  AOCSSWR0 - Customer Extension SWIFT Details                                         CSW213
      *                                                                                       CSW213
     C                     CALL 'AOCSSWR0'                                                    CSW213
     C                     PARM '*MSG   ' @RTCD   7                                           CSW213
     C                     PARM '*KEY   ' @OPTN   7                                           CSW213
     C                     PARM ZDEST     @KEY1  10                                           CSW213
     C                     PARM *BLANKS   @KYST   7                                           CSW213
     C                     PARM           DSLDY                                               CSW213
      *                                                                                       CSW213
      ** Extract SDCUSTPD and SDCSSWPD                                                     MD022633A
      *                                                                                    MD022633A
     C                     MOVEL'SDCUSTPD'P#FILN                                           MD022633A
     C                     EXSR GETRCL                                                     MD022633A
     C           P#RCDL    SUBSTDSLDY     SDCUST                                           MD022633A
     C           P#RCDL    ADD  1         WLEN    50                                       MD022633A
      *                                                                                    MD022633A
     C                     MOVEL'SDCSSWPD'P#FILN                                           MD022633A
     C                     EXSR GETRCL                                                     MD022633A
     C           P#RCDL    SUBSTDSLDY:WLENSDCSSW                                           MD022633A
      *                                                                                    MD022633A
     C           BBCSID    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL'A'       TAG                                                 CSW213
     C                     MOVEL@MTAG     MTAG                                                CSW213
     C           ACLINE    IFNE *BLANKS                                                       CSW213
     C                     MOVELACLINE    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVELBBCSID    MFLD                                                CSW213
     C                     ELSE                                                               CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL'J'       TAG                                                 CSW213
     C                     MOVEL@MTAG     MTAG                                                CSW213
     C           '/ABIC'   CAT  '/UKWN'   ABIUKW 10                                           CSW213
     C                     MOVELABIUKW    MFLD                                                CSW213
     C           CSCLID    IFNE *BLANKS                                                       CSW213
     C           CSCLSY    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C********** '/CLRC/'  CAT  CSCLSY    CLRTMP 10                                  CSW213 MD028085
     C           '/CLRC/'  CAT  CSCLSY    CLRTMP  8                                         MD028085
     C           CLRTMP    CAT  CSCLID    MFLD                                                CSW213
     C                     ELSE                                                               CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           '/CLRC/'  CAT  CSCLID    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     ELSE                                                               CSW213
     C           BBCHID    IFNE *ZEROS                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           '/CLRC'   CAT  '/CH'     CLRCH   8                                           CSW213
     C                     MOVE BBCHID    DNCHID  6                                           CSW213
     C           CLRCH     CAT  DNCHID    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           BBCHSC    IFNE *ZEROS                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           '/CLRC'   CAT  '/SC'     CLRSC   8                                           CSW213
     C                     MOVE BBCHSC    DNCHSC  6                                           CSW213
     C           CLRSC     CAT  DNCHSC    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           S01429    IFEQ 'Y'                                                         MD029064
     C*********  BBCABA    IFNE *ZEROS                                               CSW213 MD027855
     C           BBABA2    IFNE *ZEROS                                                      MD027855
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           '/CLRC'   CAT  '/CP'     CLRCP   8                                           CSW213
     C**********           MOVE BBCABA    DNCABA  3                                  CSW213 MD027855
     C**********           MOVE BBABA2    DNCABA  4                                MD027855 MD029064
     C                     MOVE BBABA2    DNABA2  4                                         MD029064
     C********** CLRCP     CAT  DNCABA    MFLD                                       CSW213 MD029064
     C           CLRCP     CAT  DNABA2    MFLD                                              MD029064
     C                     ENDIF                                                              CSW213
     C                     ELSE                                                             MD029064
     C           BBCABA    IFNE *ZEROS                                                      MD029064
     C                     ADD  1         X                                                 MD029064
     C           X         OCUR MULT                                                        MD029064
     C           '/CLRC'   CAT  '/CP'     CLRCP                                             MD029064
     C                     MOVE BBCABA    DNCABA  3                                         MD029064
     C           CLRCP     CAT  DNCABA    MFLD                                              MD029064
     C                     ENDIF                                                            MD029064
     C                     ENDIF                                                            MD029064
     C           BBBFIC    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           '/CLRC'   CAT  '/BJ'     CLRBJ   8                                           CSW213
     C           CLRBJ     CAT  BBBFIC    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           BBBLCD    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           '/CLRC'   CAT  '/BL'     CLRBL   8                                           CSW213
     C           CLRBL     CAT  BBBLCD    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           BBFWCD    IFNE *ZEROS                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           '/CLRC'   CAT  '/FW'     CLRFW   8                                           CSW213
     C                     MOVE BBFWCD    DNFWCD  9                                           CSW213
     C           CLRFW     CAT  DNFWCD    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
     C           CSLEIC    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           '/LEIC/'  CAT  CSLEIC    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           '/NAME/'  CAT  BBCNA1    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     ELSE                                                               CSW213
     C                     ADD  1         X                                                 MD023009
     C           X         OCUR MULT                                                        MD023009
     C                     EXSR FSWAD                                                         CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDSR                                                              CSW213
     C/EJECT
      *****************************************************************                       255986
      *   FLD72 - Calculate field 72                                  *                       255986
      *   Called by   FMTA  Format message detail Seq A               *                       255986
      *   Calls       -                                               *                       255986
      *****************************************************************                       255986
      *                                                                                       255986
     C           FLD72     BEGSR                                                              255986
     C*                                                                                       255986
     C                     MOVEA*BLANKS   @WRK                                                255986
     C                     Z-ADD*ZERO     WCNTR   10                                          255986
      *                                                                                       255986
     C********** MGBRKC    IFNE 'TELX'                                                255986 255986B
     C********** MGBRKC    ANDNE'PHON'                                                255986 255986B
     C********** MGBRKC    ANDNE'MAIL'                                                255986 255986B
     C********** MGBRKC    ANDNE'SWAP'                                                255986 255986B
     C********** MGBRKC    ANDNE*BLANKS                                               255986 255986B
      **********                                                                      255986 255986B
      ****Access*the*broker*file***                                                   255986 255986B
     C**********           CALL 'AOBROKR0'                                            255986 255986B
     C**********           PARM '*MSG   ' @RTCD   7                                   255986 255986B
     C**********           PARM '*KEY   ' @OPTN   7                                   255986 255986B
     C**********           PARM MGBRKC    @BROKY  4                                   255986 255986B
     C********** SDBROK    PARM SDBROK    DSFDY                                       255986 255986B
      ***Error*?***                                                                   255986 255986B
     C********** @RTCD     IFNE *BLANK                                                255986 255986B
     C**********           MOVE 'Y'       @ERR                                        255986 255986B
     C**********           MOVEAMGBRKC    @WRK,1                                      255986 255986B
     C**********           MOVELMSGA,4    @MERR  50                                   255986 255986B
      **********                                                                      255986 255986B
     C**********           END                                                        255986 255986B
     C**********           END                                                        255986 255986B
      **********                                                                      255986 255986B
      ***Maximum*length*of*field*is*35***                                             255986 255986B
     C**********           MOVEA@WRK,36   @WRK15 15                                   255986 255986B
     C********** @WRK15    IFNE *BLANK                                                255986 255986B
     C**********           Z-ADD36        J       20                                  255986 255986B
     C**********           MOVEA*BLANK    @WRK,J                                      255986 255986B
     C**********           END                                                        255986 255986B
      **********                                                                      255986 255986B
      ****Output*Field*:72:*as*constructed*from*above***                              255986 255986B
     C********** @WRK,1    IFNE *BLANK                                                255986 255986B
     C**********           ADD  1         X                                           255986 255986B
     C********** X         OCUR MULT                                                  255986 255986B
     C**********           MOVE ':72: '   MTAG                                        255986 255986B
     C**********           MOVEA@WRK      MFLD                                        255986 255986B
     C**********           MOVEL@MERR     MERR                                        255986 255986B
     C**********           MOVE 'Y'       LINE2   1                                   255986 255986B
     C**********           END                                                        255986 255986B
      **********                                                                      255986 255986B
      ***Wrap*round*to*the*next*line*the*remainder*of*the*BROKER*info.***             255986 255986B
     C********** @WRK15    IFNE *BLANK                                                255986 255986B
     C**********           MOVEA*BLANK    @WRK                                        255986 255986B
     C**********           MOVEA'//'      @WRK,1                                      255986 255986B
     C**********           MOVEA@WRK15    @WRK,3                                      255986 255986B
     C**********           ADD  1         X                                           255986 255986B
     C********** X         OCUR MULT                                                  255986 255986B
     C**********           MOVEA@WRK      MFLD                                        255986 255986B
     C**********           END                                                        255986 255986B
     C*                                                                                       255986
      * Check all six Bank to Bank Info fields and output any which                           255986
      * contain data                                                                          255986
      *                                                                                      255986B
     C           PAPOPB    IFNE 'N'                                                          255986B
      *                                                                                      255986B
     C                     CLEAR@BTB                                                          255986
     C                     MOVELMGBTB1    @BTB,1                                              255986
     C                     MOVELMGBTB2    @BTB,2                                              255986
     C                     MOVELMGBTB3    @BTB,3                                              255986
     C                     MOVELMGBTB4    @BTB,4                                              255986
     C                     MOVELMGBTB5    @BTB,5                                              255986
     C                     MOVELMGBTB6    @BTB,6                                              255986
      *                                                                                      255986B
     C           PAPOPB    IFEQ 'P'                                                          255986B
     C           6         SUB  SWCTR     WCNTR                                              255986B
     C                     ELSE                                                              255986B
     C           @BTB,1    IFNE *BLANKS                                                      255986B
     C                     Z-ADD6         WCNTR                                              255986B
     C                     SUB  SWCTR     X                                                  255986B
     C                     MOVEL'N'       LINE2                                              255986B
     C                     ENDIF                                                             255986B
     C                     ENDIF                                                             255986B
      *                                                                                       255986
     C********** 6         SUB  WCNTR     WCNTR                                       255986 255986B
     C           1         DO   WCNTR     CT6     10                                          255986
      *                                                                                       255986
     C           @BTB,CT6  IFNE *BLANKS                                                       255986
     C                     ADD  1         X                                                   255986
     C           X         OCUR MULT                                                          255986
     C                     MOVE *BLANKS   MTAG                                                255986
      *                                                                                       255986
      **  If this is the first line of field 72 then set tag to ':72: '                       255986
     C           LINE2     IFEQ 'N'                                                           255986
     C                     MOVE ':72: '   MTAG                                                255986
     C                     MOVE 'Y'       LINE2                                               255986
     C                     END                                                                255986
     C                     MOVE *BLANKS   MFLD                                                255986
     C                     MOVE *BLANKS   MERR                                                255986
     C                     MOVEL@BTB,CT6  MFLD                                                255986
     C                     END                                                                255986
     C                     END                                                                255986
     C                     ENDIF                                                             255986B
      *                                                                                       255986
     C                     ENDSR                                                              255986
     C/EJECT                                                                                  255986
      *****************************************************************
      *   SRCODE - Calculate codework                                 *
      *   Called by   SRFMTA  Format message detail Seq A             *
      *   Calls       SRPAYE  Pay side field 57 (KNOWN or UNKNOWN)    *
      *****************************************************************
      *
     C           SRCODE    BEGSR
      *
     C                     MOVE *BLANKS   PRNOUT  4
     C                     MOVE *BLANKS   CODEWD
      *
      **  Determine the state of the pay side of the transaction
      *
     C                     EXSR SRPAYE
      *
      **  pay field 57 & rec our-nostro are BOTH not blank
     C           PAY57     IFNE *BLANK
     C           MGRONS    ANDNE*BLANK
     C                     MOVE 'BOTH'    PRNOST  4
     C                     ENDIF
      *
      **  pay field 57 & rec our-nostro; Both blank/One blank
     C           PAY57     IFEQ *BLANK
     C           MGRONS    OREQ *BLANK
     C                     MOVE 'B/O '    PRNOST
     C                     ENDIF
      *
      **  If sequence number zero (NEW message)
     C           MGLSWC    IFEQ 0
     C                     MOVEL'NEW'     CWRD
      *
      **  If both our-nostro fields non-blank the 57 fields are Known
     C           PRNOST    IFEQ 'BOTH'
     C                     MOVE 'K'       F57U
      *
      **  Both or one our-nostro field(s) are blank, Unknown
     C                     ELSE
     C                     MOVE 'U'       F57U
     C                     ENDIF
      *
      **  The two table TABSLT and TABRST are used to create the
      **  CONDITION and RESULT, as shown in the table below.
      **  The position of the CONDITION on TABSLT, is the same
      **  equivalent position for the RESULT on TABRST. Hence when
      **  a LOKUP is performed on TABSLT, using the CONDITION as the
      **  key, the equivalent positional RESULT value is placed
      **  in TABRST.
      **
      **  To retrieve the first 3 fields for the CONDITION, the
      **  last confrimation created for the Transaction number
      **  is accessed.
      **  <----------------CONDITION------------------->  <--RESULT-->
      **  Status   Old Code  Old F57U  Rec Our-Nostro     Code     F57U
      **           LF/MGOREFL0         Pay Our-Nostro
      **  -----------------------------------------------------------------
      **      No record found          Both non-blank     COMPLETE  K
      **      No record found          One or both blank  AMEND     U
      **  SENT     NEW          U      Both non-blank     COMPLETE  K
      **  SENT     NEW          U      One or both blank  AMEND     U
      **  SENT     NEW          K      Both non-blank     AMEND     K
      **  SENT     NEW          K      One or both blank  AMEND     K
      **  NONREC   NEW          U      Both non-blank     NEW       K
      **  NONREC   NEW          U      One or both blank  NEW       U
      **  NONREC   NEW          K      Both non-blank     NEW       K
      **  NONREC   NEW          K      One or both blank  NEW       K
      **  SENT     AMEND        U      Both non-blank     COMPLETE  K
      **  SENT     AMEND        U      One or both blank  AMEND     U
      **  SENT     AMEND        K      Both non-blank     AMEND     K
      **  SENT     AMEND        K      One or both blank  AMEND     K
      **  SENT     COMPLETE     K      Both non-blank     AMEND     K
      **  SENT     COMPLETE     K      One or both blank  AMEND     K
      **  NONREC   AMEND        U      Both non-blank     COMPLETE  K
      **  NONREC   AMEND        U      One or both blank  AMEND     U
      **  NONREC   AMEND        K      Both non-blank     AMEND     K
      **  NONREC   AMEND        K      One or both blank  AMEND     K
      **  NONREC   COMPLETE     K      Both non-blank     COMPLETE  K
      **  NONREC   COMPLETE     K      One or both blank  AMEND     U
      *
      *
      **  For SWIFT Changes 1996, the two new tables TABS96 and
      **  TABR96 are used to create the CONDITION and RESULT,
      **  as shown in the table below.  The position of the
      **  ONDITION on TABS96, is the same equivalent position
      **  for the RESULT on TABR96.  Hence when a LOKUP is performed
      **  on TABS96, using the CONDITION as the key, the equivalent
      **  positional RESULT value is placed in TABR96.
      **
      **  To retrieve the first 3 fields for the CONDITION, the
      **  last confrimation created for the Transaction number
      **  is accessed.
      **  <----------------CONDITION------------------->  <--RESULT-->
      **  Status   Old Code  Old F57U  Rec Our-Nostro     Code     F57U
      **           LF/MGOREFL0         Pay Our-Nostro
      **  ----------------------------------------------------------------
      **      No record found          Both non-blank     AMEND     K
      **      No record found          One or both blank  AMEND     U
      **  NONREC   NEW          U      Both non-blank     NEW       K
      **  NONREC   NEW          U      One or both blank  NEW       U
      **  NONREC   NEW          K      Both non-blank     NEW       K
      **  NONREC   NEW          K      One or both blank  NEW       K
      **  SENT     NEW          U      Both non-blank     AMEND     K
      **  SENT     NEW          U      One or both blank  AMEND     U
      **  SENT     NEW          K      Both non-blank     AMEND     K
      **  SENT     NEW          K      One or both blank  AMEND     K
      **  NONREC   AMEND        U      Both non-blank     AMEND     K
      **  NONREC   AMEND        U      One or both blank  AMEND     U
      **  NONREC   AMEND        K      Both non-blank     AMEND     K
      **  NONREC   AMEND        K      One or both blank  AMEND     K
      **  SENT     AMEND        U      Both non-blank     AMEND     K
      **  SENT     AMEND        U      One or both blank  AMEND     U
      **  SENT     AMEND        K      Both non-blank     AMEND     K
      **  SENT     AMEND        K      One or both blank  AMEND     K
      *
     C                     ELSE
     C                     MOVE *BLANKS   SEARCH
      *
      **  Retrieve last confirmation for this tranaction number
     C           MGACMI    IFEQ 'Y'                                                           CSW213
     C**********           ADD  1         MGLSWC                                     CSW213 MD022367
     C                     MOVE MGLSWC    @TRN41                                              CSW213
     C           @TRN1     CHAINMGREFL0              10                                     MD029017
     C                     ELSE                                                               CSW213
     C                     MOVE MGLSWC    @TR3
     C           @TRN      CHAINMGREFL0              10                                     MD029017
     C                     ENDIF                                                              CSW213
     C********** @TRN      CHAINMGREFL0              10                                     MD029017
      *
      **  If a message found build the selection key
     C           *IN10     IFEQ '0'
      *
     C           MMGSG     IFEQ '2'
     C           MMGSG     OREQ '3'
     C                     MOVEL'SENT'    @MGST
     C                     ELSE
     C                     MOVEL'NONREC'  @MGST
     C                     ENDIF
      *
     C                     MOVELMLSCC     @LSCC
     C                     MOVE MF57U     @OF57
     C                     MOVE MCLSS     WCLSS   1                       CDL008
     C                     ENDIF
     C                     MOVE PRNOST    @NOST
      *
      **  Use select table to point to the result table
      *
     C           CSW096    IFEQ 'Y'
     C           SEARCH    LOKUPTABS96    TABR96         22
     C                     ELSE
     C           SEARCH    LOKUPTABSLT    TABRST         22
     C                     ENDIF
      *
      **  Key matches select table, outputs the corresponding
      **  result table value to 'TABRST'
     C           *IN22     IFEQ '1'
      *
     C           CSW096    IFEQ 'Y'
     C                     MOVE TABR96    CODEWD
     C                     ELSE
     C                     MOVE TABRST    CODEWD
     C                     ENDIF
      *
     C                     ELSE
     C                     MOVEL'AMEND   'CWRD
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   SRPAYE - Pay side field 57 (KNOWN or UNKNOWN)               *
      *   Called by   SRCODE  Calculate codeword                      *
      *   Calls       -                                               *
      *****************************************************************
      *
     C           SRPAYE    BEGSR
      *
     C                     MOVE *BLANKS   PAY57   5
      *
      **  Known when settlement via nostro (MGAWBN is blank)
      *
     C           MGPSTM    IFEQ 02
     C           MGPSTM    OREQ 12
     C                     MOVE 'KNOWN'   PAY57
     C                     ENDIF
      *
      **  Known when settlement internal (branch internal customer)
      *
     C                     MOVE MGPSTM    @STM    2
     C           @STM      LOKUPTABINT                   23
     C           *IN23     IFEQ '1'
     C                     MOVE 'KNOWN'   PAY57
     C                     ENDIF
      *
      **  Known when settlement via nostro and MGAWBN entered
      *
     C           MGPSTM    IFEQ 01
     C           MGPSTM    OREQ 07
     C           MGPSTM    OREQ 08
     C           MGAWBN    IFNE *BLANKS
     C           MGAWBN    OREQ *BLANKS
     C           AWBA6     ANDEQ'DIRECT'
     C                     MOVE 'KNOWN'   PAY57
     C                     ENDIF
     C                     ENDIF
      *
      **  Unknown when settlement internal
      *
     C           MGPSTM    IFEQ 00
     C                     MOVE *BLANKS   PAY57
     C                     ENDIF
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   FSWAD - Format SWIFT address                                *
      *   Called by   SRFMTB Format message detail Seq B              *
      *               FMTC1  Format message detail Seq C              *
      *   Calls       -                                               *
      *****************************************************************
      *
     C           FSWAD     BEGSR
      *
      * If NET deal set MFLD to 'TO BE NETTED'                                                200478
     C           CKNETI    IFEQ 'Y'                                                           200478
     C           FLDNO     ANDEQ'57'                                                          200478
     C                     MOVELNETTXT    MFLD                                                200478
     C                     MOVE 'D'       TAG                                                 200478
     C                     MOVE @MTAG     MTAG                                                200478
     C                     ELSE                                                               200478
     C*********************CALL 'ZM0050'               15                 CSW036
     C                     CALL 'ZM0051'               15                 CSW036
     C                     PARM           ZDEST  12
     C                     PARM           ZSADD1 35
     C                     PARM           ZSADD2 35
     C                     PARM           ZSADD3 35
     C                     PARM           ZSADD4 35
     C                     PARM           ZSTAG   1
     C                     PARM           ZSTYPE  1
     C                     PARM ' '       ZERR    1
     C                     PARM           ZDBEI   1                                           CSW201
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '021'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 021  *
     C*********************MOVEL'ZM0050'  DBFILE           * * * * * * * *CSW036
     C                     MOVEL'ZM0051'  DBFILE           * * * * * * * *CSW036
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      **  Error ?
     C           ZERR      IFEQ '1'
     C                     MOVE 'Y'       @ERR
     C                     MOVE ZSTAG     TAG
     C                     MOVE @MTAG     MTAG
     C                     MOVELZDEST     MFLD
     C                     MOVELMSGA,6    MERR
     C                     ELSE
      *
      **  Address 1
     C           ACLINE    IFNE *BLANKS
     C                     MOVELACLINE    MFLD
     C                     ELSE
     C                     MOVELZSADD1    MFLD
     C                     ENDIF
      *
      **  SWIFT address;  Else full address
     C           ZSTAG     IFEQ 'A'
     C/COPY WNCPYSRC,MG0300AC45
     C                     MOVE 'A'       TAG
     C                     MOVE @MTAG     MTAG
     C                     MOVE *BLANKS   SAVMTG  5                       183583
     C/COPY WNCPYSRC,MG0300AC46
     C           ACLINE    IFNE *BLANKS
     C                     MOVE MTAG      SAVMTG                          183583
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD1    MFLD
     C                     ENDIF
     C                     EXSR SEXTN                                     183583
     C/COPY WNCPYSRC,MG0300AC16
      *
     C                     ELSE
     C/COPY WNCPYSRC,MG0300AC47
      *
     C                     MOVE 'D'       TAG
     C                     MOVE @MTAG     MTAG
     C/COPY WNCPYSRC,MG0300AC48
     C           ACLINE    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD1    MFLD
     C                     ENDIF
      *
      **  Address 2
     C           ZSADD2    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD2    MFLD
     C                     ENDIF                           Address 2
      *
      **  Address 3
     C           ZSADD3    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD3    MFLD
     C                     ENDIF                           Address 3
      *
      **  Address 4
     C           ZSADD4    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD4    MFLD
     C                     ENDIF                           Address 4
     C                     ENDIF                           Address 1
      *
     C                     ENDIF                           Error ?
     C                     ENDIF                                                              200478
     C/COPY WNCPYSRC,MG0300AC17
      *
     C                     ENDSR
      /EJECT                                                              183583
      *****************************************************************   183583
      *                                                               *   183583
      *   SEXTN - Store customer with SWIFT address to data structure *   183583
      *                                                               *   183583
      *   Called by: FSWAD, FMT53, FMT83                              *   183583
      *   Calls    : None                                             *   183583
      *                                                               *   183583
      *****************************************************************   183583
      *                                                                   183583
     C           SEXTN     BEGSR                                          183583
      *                                                                   183583
     C           SAVMTG    IFNE *BLANKS                                   183583
     C                     MOVE SAVMTG    @MTG                            183583
     C                     ELSE                                           183583
     C                     MOVELMTAG      @MTG                            183583
     C                     ENDIF                                          183583
     C           FLDTYP    IFEQ '5'                                       183583
     C           FLDTAG    ANDEQ'A'                                       183583
     C           FLDTYP    OREQ '8'                                       183583
     C           FLDTAG    ANDEQ'A'                                       183583
     C                     ADD  1         V                               183583
     C           V         OCUR EXTN                                      183583
     C                     Z-ADDX         MPSN                            183583
     C                     MOVEL@MTG      MTG                             183583
     C                     MOVELZDEST     MCSI                            183583
     C                     ENDIF                                          183583
      *                                                                   183583
     C           SEXT9     ENDSR                                          183583
     C/EJECT
      *****************************************************************
      *   FMT83 - Format Field 83 address   - Sequence A              *
      *   Called by   SRFMTA  Format message details Sequence A       *
      *   Calls       -                                               *
      *****************************************************************
      *
     C           FMT83     BEGSR
      *
     C**********           Z-ADD0         WFLD83  60                                          CSD027
     C**********           Z-ADD0         WBCUST  60                   * *                    CSD027
     C                     MOVE *BLANKS   WFLD83  6                                           CSD027
     C                     MOVE *BLANKS   WBCUST  6                    * *                    CSD027
     C                     MOVE *BLANKS   BBCUST                          122377
      *
     C           CSW024    IFEQ 'Y'                                                           CSW024
     C           DSFUND    ANDNE*BLANK                                                        CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C           '/NAME/'  CAT  DSFUND    MFLD                                                CSW024
     C                     MOVE ':83J:'   MTAG                                                CSW024
     C           CSW037    IFEQ 'Y'                                                           CSW037
     C           DSFNAC    ANDNE*BLANK                                                        CSW037
     C                     ADD  1         X                                                   CSW037
     C           X         OCUR MULT                                                          CSW037
     C*****                MOVE ':83J:'   MTAG                                         CSW037BUG6548
     C                     MOVE *BLANK    MFLD                                                CSW037
     C                     MOVELDSFNAC    MFLD                                                CSW037
     C                     ENDIF                                                              CSW037
      *                                                                                       CSW024
     C                     ELSE                                                               CSW024
      *                                                                                       CSW024
      **  Access customer file for Beneficiary Customer Number
      *
     C           MGBENN    IFNE *BLANKS                                   122377
     C*********************CALL 'AOCUSTR0'                                CSW036
     C                     CALL 'AOCUSTR1'                                CSW036
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C/COPY WNCPYSRC,MG0300AC30
     C**********           PARM MGBENN    @KEY2   8                                           206355
     C                     PARM MGBENN    @KEY2  10                                           206355
     C/COPY WNCPYSRC,MG0300AC31
     C                     PARM *BLANKS   @KYST   7
     C***********SDCUST    PARM SDCUST    DSSDY                           CSW036
     C           SDCUST    PARM SDCUST    DSLDY                           CSW036
      *                                                                                       180372
      ** Customer Not found on SDCUSTPD, check the counterparty                               180372
      ** Nostro file.                                                                         180372
      *                                                                                       180372
     C           @RTCD     IFNE *BLANKS                                                       180372
     C                     CALL 'AOCNSTR0'                                                    180372
     C                     PARM *BLANKS   @RTCD   7                                           180372
     C                     PARM '*KEY'    @OPTN   7                                           180372
     C                     PARM MGBENN    @CNCD   8                                           180372
     C           SDCNST    PARM SDCNST    DSFDY                                               180372
      *
      ** Customer record not found - database error
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '022'     DBASE            * * * * * * * *
     C                     MOVELMGBENN    DBKEY            *  DBERR 022  *
     C                     MOVEL'SDCUSTPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ELSE                                                               180372
     C**********           Z-ADD999999    WBCUST                                       180372 CSD027
     C                     MOVE '999999'  WBCUST                                              CSD027
     C                     ENDIF
     C                     ELSE                                                               180372
     C                     MOVE BBCUST    WBCUST                                              180372
     C                     ENDIF                                                              180372
     C                     ENDIF                                          122377
      *
      ** Save beneficiary customer number for later use in
      ** field 58 formatting.
      *
     C**********           MOVE BBCUST    WBCUST                       * *                    180372
      *
      **  Output this field only if Pay Ordering Bank/Customer
      **  is not the same as Sender, Receiver and Beneficiary
      **  Also, Pay Ordering Customer/Bank must have SWIFT address.
      *
     C********** MGPOBN    IFNE *ZERO                                                         CSD027
     C           MGPOBN    IFNE *BLANKS                                                       CSD027
     C           MGPOBN    ANDNEWBICN
     C           MGPOBN    ANDNEMGCNUM
     C           MGPOBN    ANDNEWBCUST
     C**********           Z-ADDMGPOBN    WFLD83                                              CSD027
     C                     MOVE MGPOBN    WFLD83                                              CSD027
     C                     ENDIF
      *
     C********** MGPOCN    IFNE *ZERO                                                         CSD027
     C           MGPOCN    IFNE *BLANKS                                                       CSD027
     C           MGPOCN    ANDNEWBICN
     C           MGPOCN    ANDNEMGCNUM
     C           MGPOCN    ANDNEWBCUST
     C**********           Z-ADDMGPOCN    WFLD83                                              CSD027
     C                     MOVE MGPOCN    WFLD83                                              CSD027
     C                     ENDIF
      *
     C********** WFLD83    IFNE *ZERO                                                         CSD027
     C           WFLD83    IFNE *BLANKS                                                       CSD027
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELWFLD83    ZDEST
      *
     C*********************CALL 'ZM0050'               15                 CSW036
     C                     CALL 'ZM0051'               15                 CSW036
     C                     PARM           ZDEST  12
     C                     PARM           ZSADD1 35
     C                     PARM           ZSADD2 35
     C                     PARM           ZSADD3 35
     C                     PARM           ZSADD4 35
     C                     PARM           ZSTAG   1
     C                     PARM           ZSTYPE  1
     C                     PARM ' '       ZERR    1
     C                     PARM           ZDBEI   1                                           CSW201
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '023'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 023  *
     C*********************MOVEL'ZM0050'  DBFILE           * * * * * * * *CSW036
     C                     MOVEL'ZM0051'  DBFILE           * * * * * * * *CSW036
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      **  Error ?
     C           ZERR      IFEQ '1'
     C                     MOVE 'Y'       @ERR
     C                     MOVE ZSTAG     TAG
     C                     MOVE @MTAG     MTAG
     C                     MOVELZDEST     MFLD
     C                     MOVELMSGA,6    MERR
      *
     C                     ELSE
      *
      **  Output only if with SWIFT address.
      *
     C           ZSTAG     IFEQ 'A'
     C           ZSTAG     OREQ 'D'                                                         MD020963
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ACLINE
     C                     MOVE ' '       TAG
     C                     MOVE '83'      FLDNO
     C**********           MOVE 'A'       TAG                                               MD020963
     C                     MOVE ZSTAG     TAG                                               MD020963
     C                     MOVE @MTAG     MTAG
      *
      **  Address 1
     C                     MOVE *BLANKS   SAVMTG  5                       183583
     C           ACLINE    IFNE *BLANKS
     C                     MOVE MTAG      SAVMTG                          183583
     C                     MOVELACLINE    MFLD
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD1    MFLD
     C                     ELSE
     C                     MOVELZSADD1    MFLD
     C                     ENDIF
      *                                                                                       CSW213
     C                     ELSE                                                               CSW213
     C           CSW024    IFEQ 'Y'                                                           CSW213
     C           DSCORP    ANDEQ'Y'                                                           CSW213
     C           BBRI01    IFNE *BLANK                                                        CSW213
     C           BBRI02    ORNE *BLANK                                                        CSW213
     C           BBRI03    ORNE *BLANK                                                        CSW213
     C           BBRI04    ORNE *BLANK                                                        CSW213
     C           BBRI05    ORNE *BLANK                                                        CSW213
      *                                                                                       CSW213
     C                     MOVE *BLANK    DN83    1                                           CSW213
     C           BBRI01    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN83      IFNE 'Y'                                                           CSW213
     C                     MOVE ':83J:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN83                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELBBRI01    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           BBRI02    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN83      IFNE 'Y'                                                           CSW213
     C                     MOVE ':83J:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN83                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELBBRI02    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           BBRI03    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN83      IFNE 'Y'                                                           CSW213
     C                     MOVE ':83J:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN83                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELBBRI03    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           BBRI04    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN83      IFNE 'Y'                                                           CSW213
     C                     MOVE ':83J:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN83                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELBBRI04    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           BBRI05    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN83      IFNE 'Y'                                                           CSW213
     C                     MOVE ':83J:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN83                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELBBRI05    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
      *
     C                     EXSR SEXTN                                     183583
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF                                                              CSW024
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   FMT53 - Format Field 53 address   - Sequence C              *
      *   Called by   SRFMTC  Format message details Sequence C       *
      *   Calls       -                                               *
      *****************************************************************
      *
     C           FMT53     BEGSR
      *
      **  A Type address
     C           ZSTAG     IFEQ 'A'
     C                     MOVE ':53A:'   MTAG
     C                     MOVELZSADD1    MFLD
     C                     EXSR SEXTN                                     183583
     C                     MOVE '1'       *IN55
      *
     C                     ELSE
      *
      **  Access SDCUSTPD using our pay nostro customer number
     C                     MOVE *BLANKS   @KEY1
     C                     MOVELA7CUST    @KEY1
     C*********************CALL 'AOCUSTR0'                                CSW036
     C                     CALL 'AOCUSTR1'                                CSW036
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           @KEY1  10
     C                     PARM *BLANKS   @KYST   7
     C***********SDCUST    PARM SDCUST    DSSDY                           CSW036
     C           SDCUST    PARM SDCUST    DSLDY                           CSW036
      *
      ** Customer record not found - Error
     C           @RTCD     IFNE *BLANKS
     C                     MOVE 'Y'       @ERR
     C                     MOVE ':53 :'   MTAG
     C                     MOVELA7CUST    MFLD
     C                     MOVE MSGA,2    MERR
      *
     C                     ELSE
      *
      **  B Type address
     C**********           MOVE BBPCNB    @PCNB   60                                          CSD027
     C                     MOVE BBPCNB    @PCNB   6                                           CSD027
     C           SPAIN     IFEQ 'P'
     C           @PCNB     ANDEQSECN
     C           BBPAIN    OREQ 'P'
     C           A7CUST    ANDEQSPCNB
     C           BBPCNB    OREQ SPCNB
     C           BBPCNB    ANDNE*BLANKS
      *
     C                     MOVE ':53B:'   MTAG
     C                     MOVE *BLANKS   @WRK
     C                     MOVEABBCRNM    @WRK,1
     C                     Z-ADD22        J       20
     C                     MOVEABBCRTN    @WRK,J
     C                     MOVEA@WRK      MFLD
      *
      **  D Type address
     C                     ELSE
     C                     MOVE ':53D:'   MTAG
     C                     MOVELZSADD1    MFLD
      **  Address 2
     C           ZSADD2    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD2    MFLD
      **  Address 3
     C           ZSADD3    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD3    MFLD
      **  Address 4
     C           ZSADD4    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD4    MFLD
     C                     ENDIF                           D address 4
     C                     ENDIF                           D address 3
     C                     ENDIF                           D address 2
     C                     ENDIF                           B/D address 1
      *
     C                     ENDIF                           Cust. error?
      *
     C                     ENDIF                           A/B/D address?
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   FMTC1 - Format Fields 56 & 57 - Sequence C                  *
      *   Called by   SRFMTC format message details Sequence C        *
      *   Calls       FSWAD  format SWIFT address                     *
      *****************************************************************
      *
     C           FMTC1     BEGSR
      *
     C                     MOVE 'N'       FLD57O  1
      *
      **  Field :57:  A/C with institution non-blank
     C           MGAWBN    IFNE *BLANKS
      *
      **  Field :56:  Pay Intermediary bank
     C           MGPIBN    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELMGPIBN    ZDEST
     C                     MOVEL*BLANKS   ACLINE
     C                     MOVELMGPIBA    ACLINE
     C                     MOVE ' '       TAG
     C                     MOVE '56'      FLDNO
     C                     EXSR FSWAD
     C                     ENDIF
      *
      **  Format Account with institution
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELMGAWBN    ZDEST
     C                     MOVEL*BLANKS   ACLINE
     C/COPY WNCPYSRC,MG0300AC51
     C                     MOVELMGBENA    ACLINE
     C                     MOVE ' '       TAG
     C                     MOVE '57'      FLDNO
     C/COPY WNCPYSRC,MG0300AC04
     C                     MOVE NETSL     CKNETI                                              200478
     C                     EXSR FSWAD
     C                     MOVE 'Y'       FLD57O  1
      *
      **    A/C with Inst. blank
     C                     ELSE
      *
      *   Field 57 = pay nostro customer if settlement via '02' or '12'
      **  OR if A/c with Bank Account line set up as 'DIRECT'
     C           MGPSTM    IFEQ 02
     C           MGPSTM    OREQ 12
     C           AWBA6     OREQ 'DIRECT'
     C                     MOVELMGPONS    @NONB
      *                                                                   137909
      ** Use payment settlement currency to access nostro if not blank.   137909
      ** Otherwise use sell currency.                                     137909
     C           CEU003    IFEQ 'Y'                                       137909
     C           MGPYCY    ANDNE*BLANKS                                   137909
     C                     MOVE MGPYCY    @CYCD                           137909
     C                     ELSE                                           137909
     C                     MOVE MGSLCY    @CYCD                           137909
     C                     ENDIF                                          137909
      *                                                                   137909
     C**********           CALL 'AONOSTR0'                                                    CDL094
     C                     CALL 'AONOSTR1'                                                    CDL094
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM *BLANKS   @CUST   6
     C***********          PARM MGSLCY    @CYCD   3                       137909
     C                     PARM           @CYCD   3                       137909
     C**********           PARM *BLANKS   @ACCD   4                                           CGL029
     C                     PARM *BLANKS   @ACCD  10                                           CGL029
     C                     PARM *BLANKS   @ACSN   2
     C                     PARM           @NONB   2
     C                     PARM *BLANKS   @BRCD   3
     C                     PARM *BLANKS   @CSSN  10
     C                     PARM *BLANKS   @PNOI   1
     C********** SDNOST    PARM SDNOST    DSFDY                                               CDL094
     C           SDNOST    PARM SDNOST    DSSDY                                               CDL094
      *
      **  Nostro customer not found
      *
     C           @RTCD     IFNE *BLANKS
     C                     MOVE 'Y'       @ERR
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELMGPONS    HLD2    2
     C                     MOVELMGSLCY    HLD5
     C                     MOVE HLD2      HLD5    5
     C                     MOVELHLD5      MFLD
     C                     MOVELMSGA,3    MERR
     C                     MOVE ':57 :'   MTAG
     C                     ELSE
      *
      **  Format our Pay Nostro Customer Address
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZDEST
     C           MGRVNO    IFEQ *BLANKS
     C                     MOVELA7CUST    ZDEST
     C                     ELSE
     C                     MOVELMGRVNO    ZDEST
     C                     ENDIF
     C                     MOVEL*BLANKS   ACLINE
     C                     MOVE ' '       TAG
     C                     MOVE '57'      FLDNO
     C                     MOVE NETSL     CKNETI                                              200478
     C                     EXSR FSWAD
     C                     ENDIF
      *
     C                     ELSE
     C                     MOVE MGPSTM    @STM
     C           @STM      LOKUPTABINT                   23
      *
     C           *IN23     IFEQ '1'
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELSECN      ZDEST
     C                     MOVEL*BLANKS   ACLINE
     C                     MOVE ' '       TAG
     C                     MOVE '57'      FLDNO
     C                     MOVE NETSL     CKNETI                                              200478
     C                     EXSR FSWAD
      *
     C                     ELSE
      *
      ** Use payment settlement currency to access nostro if not blank.   137909
      ** Otherwise use sell currency.                                     137909
     C           CEU003    IFEQ 'Y'                                       137909
     C           MGPYCY    ANDNE*BLANKS                                   137909
     C                     MOVE MGPYCY    @NSKYB                          137909
     C                     ELSE                                           137909
     C                     MOVE MGSLCY    @NSKYB                          137909
     C                     ENDIF                                          137909
      *                                                                   137909
      **  Field 53 is equal to Our Pay Nostro
     C                     MOVELMGPONS    @NSKYE
     C**********           CALL 'AONOSTR0'                                                    CDL094
     C                     CALL 'AONOSTR1'                                                    CDL094
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM *BLANKS   @NSKYA  6
     C***********          PARM MGSLCY    @NSKYB  3                       137909
     C                     PARM           @NSKYB  3                       137909
     C**********           PARM *BLANKS   @NSKYC  4                                           CGL029
     C                     PARM *BLANKS   @NSKYC                                              CGL029
     C                     PARM *BLANKS   @NSKYD  2
     C                     PARM           @NSKYE  2
     C                     PARM *BLANKS   @KEYF   3
     C                     PARM *BLANKS   @KEYG  10
     C                     PARM *BLANKS   @KEYH   1
     C********** SDNOST    PARM SDNOST    DSFDY                                               CDL094
     C           SDNOST    PARM SDNOST    DSSDY                                               CDL094
      *
      **  Nostro customer not found
     C           @RTCD     IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE 'Y'       @ERR
     C                     MOVE ':53 :'   MTAG
     C                     MOVELMGPONS    MFLD
     C                     MOVELMSGA,3    MERR
     C                     ELSE
      *
      **  Format our Pay Nostro Customer Address
      *      ( only if Tag 53A not yet generated )
      *
     C           *IN55     IFEQ '1'
     C                     MOVE '0'       *IN55
     C                     ELSE
      *                                                                   CDL008
     C           CDL008    IFEQ 'Y'                                       CDL008
     C           MGCLSS    ANDEQ'Y'                                       CDL008
     C                     ELSE                                           CDL008
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELA7CUST    ZDEST
     C                     MOVEL*BLANKS   ACLINE
     C                     MOVE ' '       TAG
     C                     MOVE '53'      FLDNO
     C                     EXSR FSWAD
     C                     ENDIF                                          CDL008
      *                                                                   CDL008
     C                     ENDIF
     C                     ENDIF
      *
      **  Settlement 01,07 or 08 with MGAWBN blank or settlement 00
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE ':57D:'   MTAG
      *If SELL NET deal set MFLD to 'TO BE NETTED'                                            200478
     C           NETSL     IFNE 'Y'                                                           200478
     C                     MOVEL'UNKNOWN' MFLD
     C                     ELSE                                                               200478
     C                     MOVELNETTXT    MFLD                                                200478
     C                     ENDIF                                                              200478
      *
     C/COPY WNCPYSRC,MG0300CCP2
      *
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
     C/EJECT
     C/COPY WNCPYSRC,MGH00087
      *****************************************************************
      *   SRREPT - print incorrectly generated messages               *
      *   Called by   Main process                                    *
      *   Calls       -                                               *
      *****************************************************************
      *
     C           SRREPT    BEGSR
      *
     C           *IN50     IFEQ '0'
     C                     OPEN MG0300P1
     C                     SETON                     50
     C                     ENDIF
      *
      **   Set up headings and sender/customer information
      **       for the error report
     C                     MOVE '0'       *IN30
     C           @FEED     IFEQ ' '
     C                     MOVE '1'       *IN30
     C                     ENDIF
     C**********           MOVELMGTNUM    TNUM    60                                          CLE148
     C                     MOVELMGTNUM    TNUM                                                CLE148
     C                     WRITEHEADER
     C                     WRITETEXT
      *
      **  Process multiple occurrence data structure
      *
     C                     Z-ADD0         I       20
     C           I         DOWLEX
     C                     ADD  1         I
     C           I         OCUR MULT
     C           *IN99     IFEQ '1'                                                           CSW213
     C                     WRITEHEADER                                                        CSW213
     C                     WRITETEXT                                                          CSW213
     C                     WRITELINE                                                          CSW213
     C                     ELSE                                                               CSW213
     C                     WRITELINE
     C                     ENDIF                                                              CSW213
     C                     ENDDO
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   SROMSG - output correctly generated messages                *
      *   Called by   Main process                                    *
      *   Calls       SRWREF                                          *
      *****************************************************************
      *
     C           SROMSG    BEGSR
      *
      ** Write reference record  (PF/MGOREFPD)
     C                     EXSR SRWREF
      *
     C/COPY WNCPYSRC,MG0300CCP6
      *
      *
      **  Write multiple occurrence data structure to MGOMSGPD
     C                     Z-ADD1         X
     C           X         OCUR MULT
      *
     C           X         DOWLE95
     C           MULT      ANDNE*BLANKS
     C                     WRITEMGOMSGD0               06
      *
     C/COPY WNCPYSRC,MG0300CCP7
      *
      *
      **  Error on write to PF/MGOMSGPD (message data file)
     C           *IN06     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '024'     DBASE            * * * * * * * *
     C                     MOVEL'        'DBKEY            *  DBERR 024  *
     C                     MOVEL'MGOMSGPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C/COPY WNCPYSRC,MG0300AC05
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     ENDDO
      *                                                                   183583
      ** Write multiple occurrence data structure to MGOEXTPD             183583
      *                                                                   183583
     C                     Z-ADD1         V       20                      183583
     C           V         OCUR EXTN                                      183583
     C           V         DOWLE20                                        183583
     C           MCSI      ANDNE*BLANKS                                   183583
     C                     WRITEMGOEXTD0               06                 183583
      *                                                                   183583
      ** Error on write to PF/MGOEXTPD (message data extension file)      183583
      *                                                                   183583
     C           *IN06     IFEQ '1'                                       183583
     C           *LOCK     IN   LDA                                       183583
     C                     MOVE '027'     DBASE            ************** 183583
     C                     MOVEL'        'DBKEY            * DBERROR 27 * 183583
     C                     MOVEL'MGOEXTPD'DBFILE           ************** 183583
     C                     OUT  LDA                                       183583
     C                     EXSR *PSSR                                     183583
     C                     ENDIF                                          183583
     C                     ADD  1         V                               183583
     C           V         OCUR EXTN                                      183583
     C                     ENDDO                                          183583
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   CFMAT - produce confirmation matching feedback record       *
      *   Called by   Main process                                    *
      *   Calls       -                                               *
      *****************************************************************
      *
     C           CFMAT     BEGSR
      *
     C                     CALL 'MG5001'
     C                     PARM TRNO      @TRNM  16
     C                     PARM MGBRCA    @BRCA   3
     C                     PARM *BLANK    @FEED   1
      *
     C           @FEED     IFEQ 'Y'
      *
     C           *IN50     IFEQ '0'
     C                     OPEN MG0300P1
     C                     SETON                     50U7
     C                     ENDIF
      *
      **   Set up headings and sender/customer information
      **       for the error report
     C                     MOVE '1'       *IN30
     C**********           MOVELMGTNUM    TNUM    60                                          CLE148
     C                     MOVELMGTNUM    TNUM                                                CLE148
     C                     WRITEHEADER
     C                     WRITETEXT
     C                     WRITEFEED
     C                     MOVE '0'       *IN30
     C                     ENDIF
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   SRWREF - Write reference record to PF/MGOREFPD              *
      *   Called by   SROMSG  output message PF/MGOMSGPD              *
      *   Calls       -                                               *
      *****************************************************************
      *
     C           SRWREF    BEGSR
      *
     C                     MOVE *BLANKS   SYTM
     C                     MOVE MGMODI    MODI
     C                     MOVEL@TRNO     TRNO
     C                     MOVE *BLANKS   TRNF
     C                     MOVE *BLANKS   TRNM
     C                     MOVE *BLANKS   MTRN                                              MD030913
     C           MGACMI    IFEQ 'Y'                                                           CSW213
     C                     MOVEL@TRNID    MTRN                                                CSW213
     C                     ELSE                                                               CSW213
     C                     MOVEL@TR2      MTRN
     C                     ENDIF                                                              CSW213
     C                     MOVE MGTTYP    TNTP
     C                     MOVE MGTSTP    SBTP
     C                     MOVE *BLANKS   EVTP
     C                     MOVEL*BLANKS   NWBN
     C                     MOVE '300'     MTPY
     C                     MOVE 'N'       MPRY
     C                     MOVELCWRD      LSCC
     C                     MOVEL*BLANKS   PTST
     C                     MOVEL*BLANKS   CARQ
     C                     MOVEL*BLANKS   MPDE
     C                     MOVEL@HRDT     HRDT
     C                     TIME           MGTM
     C                     MOVE BJMRDT    LADT
     C                     MOVE MGTM      LATM
      *
      ** Initiate the Midas Watch List Checking Engine if CSD015 is                           CSD015
      ** enabled and CSW025 is disabled.                                                      CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           222385
     C           CSW025    ANDEQ'N'                                                           CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           MGST      IFEQ 'RSND'
     C                     MOVE BJMRDT    RELD
     C                     MOVE MGTM      RELT
     C                     ENDIF
      *
     C                     MOVEL*BLANKS   RUSR
     C                     MOVEL*BLANKS   RWSN
     C                     MOVEL*BLANKS   AMTS
     C                     MOVEL*BLANKS   AMTX
     C                     MOVEL*BLANKS   SVDT
     C                     MOVEL*BLANKS   CINDV                           141572
     C                     MOVEL*BLANKS   CCY
     C                     MOVEL*BLANKS   NSNO
     C                     MOVEL*BLANKS   SACN
     C                     MOVEL*BLANKS   AORR
     C                     MOVEL*BLANKS   DESI
      *
      **  Branch details
     C                     MOVE MGBRCA    BRCA
     C                     MOVE MGPOBR    OTHB
     C           OTHB      IFNE *BLANKS
     C                     MOVELMSGA,1    OTHT
     C                     ENDIF
     C                     MOVE MGROBR    RCBR
      *
     C                     MOVE *BLANKS   NETI
     C                     MOVE *BLANKS   DELC
     C                     MOVE *BLANKS   DYST
     C                     MOVE *BLANKS   RSID
     C                     MOVE *BLANKS   MSE1
     C                     MOVE *BLANKS   ELIN
     C                     MOVE *BLANKS   SSAC
     C                     MOVE *BLANKS   MIR
     C                     MOVE *BLANKS   TSKS
     C                     MOVE *BLANKS   TSKY
      *                                                                   CDL008
      ** Set up CLS field when CDL008 is switched on                      CDL008
      *                                                                   CDL008
     C           CDL008    IFEQ 'Y'                                       CDL008
     C                     MOVE MGCLSS    CLSS                            CDL008
     C                     ENDIF                                          CDL008
     C                     MOVE MGCHTP    AORR                                                CSW025
     C/COPY WNCPYSRC,MG0300AC35
      *
     C                     WRITEMGOREFD0               05
      *
      **  Error on write to PF/MGOREFPD (message reference file)
     C           *IN05     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '025'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 025  *
     C                     MOVEL'MGOREFPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *                                                                                       190127
      ** Write transaction history record                                                     190127
     C           MGACMI    IFEQ 'Y'                                                           CSW213
     C                     MOVELTRNO      @HREF1                                              CSW213
     C                     MOVEL@HREF1    @HREF                                             MD022579
     C                     MOVE '000'     HSSEQ                                               CSW213
     C                     MOVE @SSEQ     HSSEQ                                               CSW213
     C                     ELSE                                                               CSW213
     C                     MOVELTRNO      @HREF                                               190127
     C**********           MOVELMGTRID    HSDEST                                   MD022367 MD022579
     C                     ENDIF                                                              CSW213
     C                     MOVE '300'     HSMTPY                                              190127
      *                                                                                       190127
     C                     WRITEMGHISTD0               56                                     190127
      *                                                                                       190127
      **  Error on write to PF/MGHISTPD                                                       190127
     C           *IN56     IFEQ '1'                                                           190127
     C           *LOCK     IN   LDA                                                           190127
     C                     MOVE '027'     DBASE            * * * * * * * *                    190127
     C                     MOVEL'       ' DBKEY            *  DBERR 027  *                    190127
     C                     MOVEL'MGHISTPD'DBFILE           * * * * * * * *                    190127
     C                     OUT  LDA                                                           190127
     C                     EXSR *PSSR                                                         190127
     C                     END                                                                190127
      *                                                                                       190127
     C/COPY WNCPYSRC,MG0300AC06
     C                     ENDSR
     C/COPY WNCPYSRC,MG0300AC36
     C/EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      *                                                               *                       CSD015
      *  SRWTCH - Initiates the Midas Watch List Checking Engine.     *                       CSD015
      *                                                               *                       CSD015
      *****************************************************************                       CSD015
     C           SRWTCH    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Check if the message is for automatic release.                                       CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       PARLS                                               CSD015
      *                                                                                       CSD015
     C           MGST      IFEQ 'RSND'                                                        CSD015
     C           NWRK      IFEQ 'SWIFT '                                                      CSD015
     C           NWRK      OREQ 'TELEX '                                                      CSD015
     C           NWRK      OREQ 'STTX  '                                                      CSD015
     C                     MOVE 'CRTD'    MGST                                                CSD015
     C                     MOVE '1'       MGSG                                                CSD015
     C                     MOVE 'Y'       PARLS   1                                           CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Initialise the Transaction Details parameter.                                        CSD015
      *                                                                                       CSD015
     C                     CLEARWLTDS                                                         CSD015
     C                     Z-ADD*ZERO     W4VDAT                                              CSD015
     C                     Z-ADD*ZERO     W4MDAT                                              CSD015
     C                     Z-ADD*ZERO     W4AMT1                                              CSD015
     C                     Z-ADD*ZERO     W4AMT2                                              CSD015
      *                                                                                       CSD015
     C                     MOVELTRNO      W4IDEN                                              CSD015
     C                     MOVELMTPY      W4ITEM                                              CSD015
     C                     MOVEL'MGOREF  'W4FUNT                                              CSD015
     C                     MOVELMGBRCA    W4BRCH                                              CSD015
     C                     MOVELDECN      W4CNUM                                              CSD015
     C                     Z-ADDBJRDNB    W4DDAT                                              CSD015
     C                     MOVE PARLS     W4ARLS                                              CSD015
      *                                                                                       CSD015
      ***Send*the Transaction Details to the Compliance Engine                         CSD015 221145
      *********************                                                            CSD015 221145
     C*********************CALL 'SDWLCLOP'                                             CSD015 221145
     C*********************PARM           WLTDS                                        CSD015 221145
     C*********************PARM *BLANKS   PSTRNG                                       CSD015 221145
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
     C/EJECT
      *****************************************************************                       221145
      *                                                               *                       221145
      *  WLCDQ - Submit information to Watch List Check Dtaq          *                       221145
      *                                                               *                       221145
      *****************************************************************                       221145
      *                                                                                       221145
     C           WLCDQ     BEGSR                                                              221145
      *                                                                                       221145
      *  Send transaction to compliance engine program                                        221145
      *                                                                                       221145
     C                     CALL 'SDWLCLOP'                                                    221145
     C                     PARM           WLTDS                                               221145
     C                     PARM *BLANKS   PSTRNG                                              221145
      *                                                                                       221145
      *                                                                                       221145
     C                     ENDSR                                                              221145
      *                                                                                       221145
     C/EJECT                                                                                  221145
      *****************************************************************
      *   *PSSR - error handling                                      *
      *****************************************************************
      *
     C           *PSSR     BEGSR
      *
      **  Write database error to report
     C                     OPEN MG0300AU
     C                     WRITEHEAD
     C                     WRITEDBERROR
      *
     C                     SETON                     U7U8LR
     C                     DUMP
     C                     RETRN
      *
     C                     ENDSR
     C/EJECT
      *
     C/COPY MGCPYSRC,SWIFTTRANS
** CPY@   Object Copyright
(c) Misys International Banking Systems Ltd. 2001
** MSGA   Messages
Settlement - pay
Customer details not found on SDCUSTPD
Nostro customer not found on SDNOSTPD
Broker code not found on SDBROKPD
ZM0040 (format ccy and amount) call ended in error
ZM0050 (format SWIFT address) call ended in error
Codeword was not found for this message
Duplicate TRN (ref.) key built for this message
** TABSLT - selection criteria for the codeword
                  BOTH
                  B/O
SENT   NEW      U BOTH
SENT   NEW      U B/O
SENT   NEW      K BOTH
SENT   NEW      K B/O
NONREC NEW      U BOTH
NONREC NEW      U B/O
NONREC NEW      K BOTH
NONREC NEW      K B/O
SENT   AMEND    U BOTH
SENT   AMEND    U B/O
SENT   AMEND    K BOTH
SENT   AMEND    K B/O
SENT   COMPLETE K BOTH
SENT   COMPLETE K B/O
NONREC AMEND    U BOTH
NONREC AMEND    U B/O
NONREC AMEND    K BOTH
NONREC AMEND    K B/O
NONREC COMPLETE K BOTH
NONREC COMPLETE K B/O
** TABRST - Resulting codeword; corresponds to the selection criteria
COMPLETE K
AMEND    U
COMPLETE K
AMEND    U
AMEND    K
AMEND    K
NEW      K
NEW      U
NEW      K
NEW      K
COMPLETE K
AMEND    U
AMEND    K
AMEND    K
AMEND    K
AMEND    K
COMPLETE K
AMEND    U
AMEND    K
AMEND    K
COMPLETE K
AMEND    U
** TABS96 - selection criteria for the codeword
                  BOTHAMEND    K
                  B/O AMEND    U
NONREC NEW      U BOTHNEW      K
NONREC NEW      U B/O NEW      U
NONREC NEW      K BOTHNEW      K
NONREC NEW      K B/O NEW      K
SENT   NEW      U BOTHAMEND    K
SENT   NEW      U B/O AMEND    U
SENT   NEW      K BOTHAMEND    K
SENT   NEW      K B/O AMEND    K
NONREC AMEND    U BOTHAMEND    K
NONREC AMEND    U B/O AMEND    U
NONREC AMEND    K BOTHAMEND    K
NONREC AMEND    K B/O AMEND    K
SENT   AMEND    U BOTHAMEND    K
SENT   AMEND    U B/O AMEND    U
SENT   AMEND    K BOTHAMEND    K
SENT   AMEND    K B/O AMEND    K
** TABNST - Codes indicating settlement via nostro
01
02
07
08
12
** TABINT - Codes indicating settlement via internal
03
04
05
06
14
