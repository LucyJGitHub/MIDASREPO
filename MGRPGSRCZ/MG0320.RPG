     H        1                           F
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas MG Format fixed loan/deposit conf. messages')    *
      *****************************************************************
      *                                                               *
      *  Midas - MESSAGE GENERATION                                   *
      *                                                               *
      *  MG0320 - FIXED LOAN/DEPOSIT CONFIRMATION MESSAGE FORMATTING  *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD051884           Date 05Sep19               *
      *  Prev Amend No. 260931             Date 25Nov15               *
      *                 MD055995           Date 13Jul20               *
      *                 MD050459           Date 12Mar20               *
      *                 AR908919           Date 02Oct19               *
      *                 MD053295           Date 13Apr19               *
      *                 MD046248           Date 27Oct17               *
      *                 MD047993           Date 23Sep17               *
      *                 MD035545           Date 11Sep15               *
      *                 MD035358           Date 08Mar17               *
      *                 AR641715           Date 25May16               *
      *                 MD034675A          Date 29Jul15               *
      *                 MD034675           Date 03Jul15               *
      *                 AR598353           Date 05Jun15               *
      *                 AR694628A          Date 05Jun15               *
      *                 AR694628           Date 05Jun15               *
      *                 AR733390           Date 13Mar15               *
      *                 CGL165             Date 17Feb15               *
      *                 CDL096             Date 22Sep14               *
      *                 CDL094             Date 03Jun14               *
      *                 CDL093             Date 24Apr14               *
      *                 CSW213             Date 03Jun13               *
      *                 AR916823           Date 12Jun13               *
      *                 AR996895           Date 25Nov12               *
      *                 CLE148             Date 23Jul12               *
      *                 263666             Date 01Feb10               *
      *                 261382             Date 13Aug09               *
      *                 260362             Date 18Aug09               *
      *                 255986B            Date 20Nov09               *
      *                 260490             Date 17Sep09               *
      *                 CER059             Date 19Jul10               *
      *                 CER016A            Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 255986A (          Date 13Oct08               *
      *                 255986             Date 15Sep08               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 BUG20466           Date 06Aug08               *
      *                 CSW208             Date 15Apr08               *
      *                 249455             Date 31Jul07               *
      *                 247842             Date 21May07               *
      *                 247393             Date 20May07               *
      *                 245960             Date 23Apr07               *
      *                 246141             Date 26Mar07               *
      *                 246354             Date 12Mar07               *
      *                 164847             Date 30Nov06               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242286             Date 26Sep06               *
      *                 CSD031             Date 10Apr06               *
      *                 236852             Date 03Feb06               *
      *                 CSD027             Date 09Dec05               *
      *                 CIR013             Date 25Apr05               *
      *                 CSW037A            Date 02May05               *
      *                 BUG6548            Date 11Apr05               *
      *                 233400             Date 09May05               *
      *                 233056             Date 13Apr05               *
      *                 233003             Date 08Apr05               *
      *                 232540             Date 09Mar05               *
      *                 CSW205             Date 30Nov04               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 222373             Date 27Oct03               *
      *                 222385             Date 23Oct03               *
      *                 221145             Date 08Sep03               *
      *                 219242             Date 01Jul03               *
      *                 219241             Date 01Jul03               *
      *                 CSD015             Date 14Oct02               *
      *                 210796             Date 22Nov02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 208051             Date 11Sep02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CSW025             Date 26Mar02               *
      *                 CSW024             Date 31Aug01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CSW201             Date 02May01               *
      *                 193545             Date 13Jul01               *
      *                 183583             Date 11Jun01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 190127             Date 28Feb01               *
      *                 188609             Date 12Jan01               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 186748             Date 04Dec00               *
      *                 187089             Date 29Nov00               *
      *                 186781             Date 23Nov00               *
      *                 186635             Date 21Nov00               *
      *                 186631             Date 21Nov00               *
      *                 186144             Date 09Nov00               *
      *                 CDL008             Date 02May00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CSW200             Date 21Aug00               *
      *                 CIR004             Date 20Jan00               *
      * Midas DBA 3.02 -----------------------------------------------*
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CDL006             Date 26Apr99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 141572             Date 21Sep98               *
      *                 137909             Date 22Jul98               *
     F*                 130581             DATE 25MAR98               *
     F*                 113352             DATE 13FEB97               *
     F*                 121768             DATE 19FEB98               *
     F*                 126017             DATE 18NOV97               *
     F*                 109795             DATE 23SEP97               *
     F*                 096521             DATE 04MAR97               *
     F*                 097885             DATE 31JAN97               *
     F*                 S01408             DATE 28OCT96               *
     F*                 CSW096             DATE  3JUN96               *
     F*                 103387             DATE 21MAY96               *
     F*                 083970             DATE 23MAY96               *
     F*                 095244             DATE 01NOV95               *
     F*                 095238             DATE 31OCT95               *
     F*                 088544             DATE 20OCT95               *
     F*                 081533             DATE 26JAN95               *
     F*                 088043             DATE 14JUN95               *
     F*                 087078             DATE 21JUN95               *
     F*                 085623             DATE 21JUN95               *
     F*                 085625             DATE 21JUN95               *
     F*                 084454             DATE 15JUN95               *
     F*                 CCF001             DATE 12APR95               *
     F*                 084320             DATE 07MAR95               *
     F*                 080096             DATE 12JAN95               *
     F*                 079771             DATE 20DEC94               *
     F*                 077898             DATE 20DEC94               *
     F*                 S01408             DATE 11NOV94               *
     F*                 066600             DATE 04FEB94               *
     F*                 066550             DATE 04FEB94               *
     F*                 056739             DATE 16NOV93               *
     F*                 S01421             DATE 18AUG93               *
     F*                 051850 (BH1164)    DATE 24JUN93               *
     F*                 E42086             DATE 10JLU92               *
     F*                 E40242             DATE 25JUN92               *
     F*                 E33129 (BH2648)    DATE 16DEC91               *
     F*                 E32363             DATE 25NOV91               *
     F*                 E31885             DATE 13NOV91               *
     F*                 E29588             DATE 07OCT91               *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
      *  MD051884 - SWIFT MT320 early maturity unexpected interest    *
      *             amount                                            *
      *  260931 - Field 87A not correct                               *
      *  MD055995 - Diff in field F57U for 8 MT320 Messages, MP value *
      *             of 'K', FM blank - Formalize fix introduced in    *
      *             MG0320, rename DEALSDC.F57FU to avoid conflict of *
      *             both fields                                       *
      *  MD050459  - Produce correct 34E for 'BC' Deal Amendment      *
      *            - Incomplete computation for 34E for 'PI' and 'PD' *
      *              Deal Amendment                                   *
      *  AR908919 - MT320 message not acknowleged by SWIFT alliance.  *
      *             Ensure that for Early Maturity deal amendments,   *
      *             tag 30X will be generated instead of 32H.         *
      *             (Child: AR908920)                                 *
      *           - Applied for MD053816                              *
      *  MD053295 - Lending loan with Interest Calculation Basis      *
      *             method 3 (30/360) has wrong interest payment      *
      *             amount for month of March (Recompile)             *
      *  MD046248 - Finastra Rebranding                               *
      *  MD047993 - Modified MD035545. Removed dependency on Accrue   *
      *             on Last Day indicator.                            *
      *  MD035545 - LE: Interest Calculation in Leap year. Consider   *
      *             Accrue on Last Day Indicator for method 6.        *
      *  MD035358 - MT320 Messages missing information                *
      *           - complete the fix of AR733390                      *
      *  AR641715 - Incorrect details shown in 57A and 58A is not     *
      *             displayed in MT320 even if Beneficiary field has  *
      *             details.                                          *
      *           - Applied for MD-38208                              *
      *  MD034675A - Wrong computation of total interest and principal*
      *              in field 34E                                     *
      *  MD034675 - INVALID MESSAGES GENERATED FOR 'CI',PI/PD' and    *
      *             'SC' events                                       *
      *  AR598353 - Midas SWIFT with incorrect details                *
      *              Applied for MD034571                             *
      *  AR694628A - Tag 22A in MMM still equal to AMND. Need to move *
      *              'A' in AORR when deal has SC or EM amendment.    *
      *              Applied for MD034571                             *
      *  AR694628 - Error on SC deal amendment on MT320. Ensure fields*
      *             get correct values after SC. Applied for MD034571 *
      *  AR733390 - Missing account number in tag 58. (Child:AR733391)*
      *           - Applied for MD-8341                               *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *  CDL093 - MM Interest calculation type 9.                     *
      *  CSW213 - SWIFT Changes 2013                                  *
      *  AR916823 - Recompute Interest in 34E to include Interest     *
      *             Adjustments. (Child: AR916824)                    *
      *  AR996895 - Incorrect accrual interest calculation.           *
      *             (Child:AR996897) (Recompile)                      *
      *  CLE148 - Alpha Loan Reference (Recompile)                    *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  261382 - Replaced codeword 'CINT' with 'CONF' as 'CINT' is   *
      *           not a SWIFT standard for MT320 tag 22B.             *
      *  260362 - Similar fix with 241593.                            *
      *           For Rollovers set up a message reference for field  *
      *           21. If it's an amend, the complete or correct field *
      *           21 should refer to the previous message and not the *
      *           rolled over deal number.                            *
      *  255986B - Introduce system value 'PopBTBConf' to populate    *
      *            Bank to Bank information in confirmation           *
      *  260490 - Field 32H should exclude interest amount for        *
      *           increase principal.                                 *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *            to Midas Plus (Recompile)                          *
      *  255986A- Field 72 not appearing in MT320(Correct subroutine) *
      *  (Reopen)                                                     *
      *  255986 - Field 72 not appearing in MT320                     *
      *  BUG20466 - Field 32H in seq I of MT320 should be             *
      *             negative in amount                                *
      *  CSW208 - SWIFT 2008 Changes                                  *
      *  249455 - Field 56 shown on MT320 although not specified on   *
      *           deal. Error occurs when the deal branch and nostro  *
      *           branch are different.  Downgraded fix 222846.       *
      *  247842 - Field 38J should contain value from INT6DY when     *
      *           calc method 6 or 9 is used.  Otherwise, use ZZINDY. *
      *  247393 - Half adjust interest amounts.                       *
      *  245960 - For SC deal amendments, use code word CINT on field *
      *           22B.                                                *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  246354 - Missing field :21: for Maturity.                    *
      *           If related ref not found in MGHISTPD, set :21: to   *
      *           'NOREF'.                                            *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  236852 - Extend the definition of @OANN field to 36 so that  *
      *           the leading digit of the our a/c at nostro will not *
      *           be dropped.                                         *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over GLINTC and ZINTDY.                   *
      *  CSW037A- Additional Field extended to 40 chars               *
      *  BUG6548- Field 83J appearing twice in message.               *
      *  233400 - S01434 =Off and CSW205 = off, 32H should not include*
      *           interest                                            *
      *  233056 - Remove fix 232540 ie., 32H should be 0 if principals*
      *           have not changed in a rollover.                     *
      *  233003 - SWIFT2005 changes for MT320 does not work when      *
      *           S01434 is off                                       *
      *  232540 - If rollover amount and principal are equal, 32H     *
      *           should be = interest if settled in the same         *
      *           cash flow.                                          *
      *  CSW205 - Swift 2005 Standards                                *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320.               *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits (Recompile)      *
      *  222373 - Parameter Mismatch.                                 *
      *  222385 - SWIFT msgs are Watch List checked regardless of     *
      *           configuration file setting                          *
      *  221145 - Compliance Watch WLC: Move compliance check to      *
      *           after COMIT to MGOMSGPD                             *
      *  219242 - Not possible to create MT103+ payment msg from      *
      *           non-FT transaction (Recompile)                      *
      *  219241 - Defaulting of "Details of Charges" assign a         *
      *           system value (Recompile)                            *
      *  CSD015 - Midas Compliance Watch - Watch List Checking        *
      *  210796 - Extend Our a/c at Nostro field                      *
      *  208051 - Interest rate should have a 'N' for a -ve deposit   *
      *           or a +ve loan. Ensure ZINTR is always set-up.       *
      *  CSW025 - Midas Message Manager                               *
      *           - Pass original change type                         *
      *  CSW024 - MT3xx field 82/83/87 changes                        *
      *  CSW201 - SWIFT 2001 Standards Update                         *
      *  193545 - Now that MT320 has the same layout as the MT300     *
      *           due to Swift changes 2000, do the same processing   *
      *           for the beneficiary A/C line. Output it to field 57 *
      *  183583 - Add extension file MGOEXTPD to store customer no.   *
      *           of field with SWIFT address.                        *
      *  190127 - Related reference should contain tansaction         *
      *           reference of previous message of same type          *
      *  188609 - Add account line to field 57 for message type MT320 *
     F*  186748 - :15C: missing if :53D: used                         *
     F*  187089 - MT320s rejected by TRAM because BROKER not          *
     F*           recognised                                          *
     F*  186781 - Flag maturity messages so not picked up by TRAM     *
     F*  186635 - 24D should specify what electronic broker it is     *
     F*  186631 - If interest amount is negative, make ZAMNT positive *
     F*  186144 - 32H should not include interest                     *
      *  CDL008 - Continuous Linked Settlement (Recompiled)           *
     F*  CSW200 - Swift 2000 Changes.                                 *
      *  CIR004 - Dealing Calculation Method Change.                  *
      *         - Recompiled due to GLINTC and ZINTDY changes         *
      *  CDL006 - Fiduciary Dealing.                                  *
     F*  141572 - Setup CINDV (century flag) SVDT ( value date).      *
     F*  137909 - Use the settlement currency if not blank for        *
     F*           accessing nostro details. This is needed for tag    *
     F*           57A. Only use if CEU003 or CEU004 is on.            *
     F*  130581 - MG0320 issues an error if it does not find a loan   *
     F*           type/sub-type in SDDLSTPD. It should set ASFUID     *
     F*           to blank rather than issue an error.                *
     F*  113352 - Set-up CIND (Century flag)  to correct year2000     *
     F*           display problem.                                    *
     F*  121768 - Recompile over changed GLINTCZ1                     *
     F*  126017 - Correction to interest calculation for calculation  *
     F*           basis 6 in SR/GLINTC. Add SR/ZDAT10                 *
     F*  109795 - If front-up interest, full amount of interest       *
     F*           should be output to field 34R                       *
     F*  096521 - SWIFT Confo (MT300/MT320/MT330) should show :53:    *
     F*           sender correspondent as Recepient of payment        *
     F*           instruction when it is used instead of nostro.      *
     F*  097885 - Recompiled for wrong calculation of number of day   *
     F*           interest (ZINTDYZ2).                                *
     F*  S01408 - Addition of core hook MG0320FFP1                    *
     F*           Addition of core hook MG0320IIP2                    *
     F*           Addition of core hook MG0320IIP1                    *
     F*           Addition of core hook MG0320CP10                    *
     F*           Addition of core hook MG0320CCP9                    *
     F*           Addition of core hook MG0320CCP8                    *
     F*           Addition of core hook MG0320CCP7                    *
     F*           Addition of core hook MG0320CCP6                    *
     F*           Addition of core hook MG0320CCP5                    *
     F*           Addition of core hook MG0320CCP4                    *
     F*           Addition of core hook MG0320CCP3                    *
     F*  CSW096 - SWIFT Changes November 1996.                        *
     F*  103387 - If MGAWBA contains DIRECT, reformat it in /DIRECT   *
     F*           See also MG03xx.                                    *
      *  083970 - If an amendment is made on a rollover deal, fld21   *
      *           of the confirmation should contain the TRN of the   *
      *           last confirmation for the rollover deal instead of  *
      *           the rollover deal number.                           *
     F*  095244 - Recompiled for Calculation method 3                 *
     F*  095238 - Recompiled for Calculation method 3                 *
     F*  088544 - Rename conflicting MGOREFL0 field TODY to resolve   *
     F*           enquiry problem.                                    *
      *  081533  -  If branch code on the file is blank then default  *
      *             it to the branch code on SDBRCHPD.  If our        *
      *             receive branch is blank then default it the       *
      *             branch code.  Applied fixes 074856 and 073944.    *
     F*  088043 - If DIRECT entered, use Beneficiary for :57: on Pay  *
     F*           Sequence                                            *
     F*  087078 - Error in SWIFT line :33 for Rollover deals with     *
     F*           changes in amounts.                                 *
     F*  085623 - Amount on line 33 should take into account whether  *
     F*           interest is paid separately                         *
     F*  085625 - Selection tables are missing ROLINC, ROLINCIN and   *
     F*           ROLDECIN                                            *
     F*  084454 - Line 33 is missing for codes ROLINC, ROLINCIN,      *
     F*           ROLDECIN, ROLSAM, AND ROLSAMIN whenever an Auto-    *
     F*           roll occurs.                                        *
     F*  CCF001 - Concord Interface                                   *
     F*  084320 - Do not set on U7 for a non-fatal error, as this     *
     F*           will cause the controlling component to end         *
     F*           abnormally.                                         *
     F*  080096 - RECOMPILE BECAUSE COPY MEMBER MGCPYSRC,SWIFTTRANS   *
     F*           CHANGED                                             *
     F*  079771 - Keyword correction for rollovers                    *
     F*  077898 - A principal increase rollover should have a         *
     F*           common keyword of ROLINC not ROLSAMIN               *
     F*  S01408 - Addition of core hook MG0320CCP1.                   *
     F*           Addition of core hook MG0320CCP2.                   *
     F*  066600 - Was not working out Date Format correctly.          *
     F*  066550 - GLINTC has had historical problems and inaccuracies *
     F*           and is now externaly descibed and changed to use    *
     F*           ZINTDYZ1. See document atached to error no on GEMS  *
     F*  056739 - Add account line for fields :56: and :57:           *
     F*  S01421 - REPLACE THE SWIFT TRANSLATION TABLE WITH A          *
     F*           /COPY STATEMENT (SWIFTTRANS).                       *
     F*  051850 - RENAME CFPF FIELD TO PREVENT MESSAGES BEING         *
     F*           GENERATED AS ALREADY PROCESSED BY CONF. MATCHING.   *
     F*           PREVENTS 'MISSING' MESSAGES ON TRAM.                *
     F*  E42086 - CATER FOR BLANK ADDRESS LINES                       *
     F*  E40242 - Recompiled due to changes to field ASEQ             *
     F*  E33129 - BROKER NAME COULD BE 3 OVER 35 LIMIT SO ADD         *
     F*           NEXT LINE FOR FIELD 72                              *
     F*  E32363 - FOR THE RECIVE SIDE:-                               *
     F*           i.   use the intermediary if entered;               *
     F*           ii.  a/c with inst. is equal to the rcv nostro;     *
     F*           iii. if branch code of sender not equal to the      *
     F*                rcv settlement branch and the intermediary     *
     F*                is blank, intermediary is equal to the         *
     F*                internal customer number of the rcv branch.    *
     F*  E31885 - INTEREST AMOUNT INCORRECTLY ROUNDED                 *
     F*  E29588 - POST COLLECTION SWIFT RATIONALISATION FIXES         *
     F*           o prevent a blank codeword for field 22             *
     F*  RE-WRITTEN FOR S01344 - SWIFT RATIONALISATION PHASE 2        *
     F*                                                               *
     F*****************************************************************
     F*
     F/COPY WNCPYSRC,MG0320FFP1
     F*
     FMGF320PDUF  E                    DISK
     F                                              KCOMIT
     FMGOREFL0IF  E           K        DISK
     F            MGOREFD0                          KRENAMEMGREFL0
     FMGOREFPDO   E                    DISK
     F                                              KCOMIT
     FMGOMSGPDO   E                    DISK
     F                                              KCOMIT
      *                                                                                       190127
      ** MG Transaction history file                                                          190127
     FMGHISTL0UF  E           K        DISK                      A                            190127
     F                                              KCOMIT                                    190127
     FDEALSC  IF  E           K        DISK                                                 AR916823
      ** Deals File                                                                         AR916823
      *                                                                                     AR916823
      ** SD Customer Details                                                                  CDL094
     FSDCUSTL7IF  E           K        DISK                                                   CDL094
      *                                                                                       CDL094
     F/COPY WNCPYSRC,MG0320F001
     FMGOEXTPDO   E                    DISK                               183583
     F                                              KCOMIT                183583
     FMGX320L0IF  E           K        DISK                           UC                      CSW208
     FMG0320P1O   E                    PRINTER                        UC
     FMG0320AUO   E                    PRINTER                        UC
     F/COPY WNCPYSRC,MGH00096
      ********************************************************************
      *
      * ID C  F  H  L    FUNCTION OF INDICATORS
      *
      *    05            Error on write to MGOREFPD.
      *    06            Error on write to MGOMSGPD
      *    10            EOF MGF320PD
      *    11            Chain to MGOREFL0.
      *    15            Error in call to standard program (ZMxxxx)
      *    16            Error on delete of GDF record.
      *    20            LOKUP operation searching array (GNR)
      *    21            LOKUP operation searching array (GNR)
      *    22            LOKUP operation searching array (GNR)
      *    23            Settlement method on TABNST/TABINT.
      *    24            Settlement method on TABRST.
      *    25            Array 1st line filled ; fld72.
      *    26            Error on call of MG5000
      *    27            ConCord Interface is ON.                         CCF001
      *    30            Feedback record not generated
      *    31            @wrk array indicator.
      *    50            MG0320P1 open
      *    90            Calculation basis 2
      *    91            Calculation basis 3
      *    92            Calculation basis 1
      *    95            Calculation basis 6
      *    96            Calculation basis 5
      *    97            Calculation basis 4
      *    U7U8          Database error
      *
     F********************************************************************
     E                    CPY@    1   1 80               copyright
     E/COPY WNCPYSRC,MG0320E001
     E***********         MSGA    1   8 60               message text     CDL006
     E                    MSGA    1   9 60               message text     CDL006
     E/COPY WNCPYSRC,MG0320E002
     E***********         TABSLT  1  46 28               codwrd conditions085625
     E***********         TABRST  1  46 10               selected codeword085625
     E                    TABSLT  1  70 28               codwrd conditions085625
     E                    TABRST  1  70 10               selected codeword085625
     E                    TABS96  1  30 28   TABR96 10   codwrd conditionsCSW096
     E                    TABNST  1   5  2               settlement nostro
     E                    TABINT  1   5  2               settle. internal
     E                    GNR        15  3               msg gen. released
     E                    @WRK       50  1               work array
     E                    ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAY
     E                    ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAY
     E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY
     E                    @BTB        6 35               Bank to Bank Info                    255986
      *
     E/COPY ZSRSRC,ZDATE9Z1                                               066550
     E********************************************************************
      *
     I*
     I/COPY WNCPYSRC,MG0320IIP1
     I*
     IMGREFL0
     I              SYTM                            MSYTM
     I              NWRK                            MNWRK
     I              SECN                            MSECN
     I              NWSN                            MNWSN
     I              DECN                            MDECN
     I              NWDS                            MNWDS
     I              MGSG                            MMGSG
     I              MGST                            MMGST
     I              F57U                            MF57U
     I              LSCC                            MLSCC
     I              HRDT                            MHRDT
     I              MGDE                            MMGDE
     I              MGTM                            MMGTM
     I              LADT                            MLADT
     I              RELD                            MRELD
     I              RELT                            MRELT
     I              CFPF                            MCFPF                 051850
     I              TODY                            MTODY                 088544
      **  Rename conflicting MGOREFL0 fields
      *
     I/COPY WNCPYSRC,MGH00097
     IDEALSDCF                                                                              AR916823
     I              DLNO                            FDDLNO                                  AR916823
     I              VDAT                            FDVDAT                                  AR916823
     I              MDAT                            FDMDAT                                  AR916823
     I              PCPL                            FDPCPL                                  MD050459
     I              INTR                            FDINTR                                  AR916823
     I              NIDT                            FDNIDT                                  AR916823
     I              IACD                            FDIACD                                  AR916823
     I              AITC                            FDAITC                                  AR916823
     I              AIAN                            FDAIAN                                  AR916823
     I              AIAP                            FDAIAP                                  AR916823
     I              IPRD                            FDIPRD                                  AR916823
     I              ICTD                            FDICTD                                  AR916823
     I              AIPD                            FDAIPD                                  MD034675
     I              INTF                            FDINTF                                  AR916823
     I              F57U                            FDF57U                                  MD055995
      ** Rename for conflicting fields of DEALSDC                                           AR916823
      *                                                                                     AR916823
     I            DS
     I                                        1  12 CSID
     I                                        9  11 @BIC
      **  Data structure to test for BIC code
      *
      **  MSSTAT data area                                                                    CSW208
      *                                                                                       CSW208
     IDSTAT       DS                            256                                           CSW208
     I                                       24  24 WPDE                                      CSW208
      *                                                                                       CSW208
     I***MULT***     DS                         95                                            CSW208
     IMULT        DS                        999                                               CSW208
     I                                        1   5 MTAG
     I                                        6  55 MFLD
     I                                       56 105 MERR
      **  Multiple occurrence data structure for message
      *
     IEXTN        DS                         45                           183583
     I                                        1   20MPSN                  183583
     I                                        3   7 MTG                   183583
     I                                        8  15 MCSI                  183583
      *                                                                   183583
      ** Multiple occurrence data structure for extension file            183583
      *                                                                   183583
     I            DS                                                      183583
     I                                        1   5 @MTG                  183583
     I                                        2   2 FLDTYP                183583
     I                                        4   4 FLDTAG                183583
      *                                                                   183583
      ** Field tag data structure                                         183583
      *                                                                   183583
     ISEARCH      DS                         22
     I                                        1   6 @MGST
     I                                        8  16 @LSCC
     I                                       23  23 @OF57
     I                                       25  28 @NOST
      **  Data structure to build key to determine codeword
      *
     ICODEWD      DS                         22
     I                                        1   8 CWRD
     I                                       10  10 F57U
      **  Data structure containing codeword for the new message
      *
     IFLD3N       DS                         24
     I                                        1   6 ZSDATE
     I                                        7   9 ZSCCY
     I                                       10  24 ZSAMNT
      **  Data structure containing codeword for fields 32/33.
      *
     IERR3N       DS                         24
     I                                        1   3 ZCCY
     I                                        5  170ZAMT
      **  Erroneous currency & amounts for Fields 32/33
      *
     I@MTAG       DS                          5
     I                                        1   1 COLON1
     I                                        2   3 FLDNO
     I                                        4   4 TAG
     I                                        5   5 COLON2
     I            DS                                                                          260362
     I                                        1   30CFSEQ                                     260362
      **  Data structure constructing message field tag
      *
     IP@IN        DS                            256                       CSW096
     I                                        1   3 I@SNBR                CSW096
     I                                        4   9 I@DSCN                CSW096
     I                                       10  12 I@MTPY                CSW096
     I                                       13  140I@SETT                CSW096
     I                                       15  15 I@CONC                CSW096
     I                                       16  16 I@FTCS                CSW096
     I                                       17  18 I@MMOD                CSW096
      ** Data structure for input parameter                               CSW096
      *                                                                   CSW096
     IP@OUT       DS                            256                       CSW096
     I**********                              1   60O@CNSN                             CSW096 CSD027
     I                                        1   6 O@CNSN                                    CSD027
     I                                        7  18 O@SWSN                CSW096
     I                                       19  38 O@NWSN                CSW096
     I                                       39  49 O@SWDS                CSW096
     I                                       46  46 W@96CN                CSW096
     I                                       47  49 W@BIC                 CSW096
     I                                       50  69 O@NWDS                CSW096
     I                                       70  75 O@NWRK                CSW096
     I                                       76  76 O@MGSG                CSW096
     I                                       77  80 O@MGST                CSW096
     I                                       81  81 O@PAIN                CSW096
     I                                       82  87 O@PCNB                CSW096
     I                                       88  90 O@SPRS                CSW096
      ** Data structure for ouput parameter                               CSW096
      *                                                                   CSW096
     I@HREF       DS                         16                                               190127
     I                                        1   2 HSMODI                                    190127
     I                                        3   8 HSTRAN                                    190127
     I                                        9  11 HSSEQ                                     190127
      **  Data structure for related reference                                                190127
      *                                                                                       190127
     ISDBANK    E DSSDBANKPD
      **  External Data structure for bank details.
      *
     ISDTRAD    E DSSDTRADPD
      **  External Data structure for trading file.
      *
     ISDCUST    E DSSDCUSTPD
      **  External Data structure for customer details.
      *
     ISDCURR    E DSSDCURRPD
      **  External Data structure for currency details.
      *
     ISDBRCH    E DSSDBRCHPD
     I              QQDFAC                          DFACQQ                                    CGL029
      **  External Data structure for branch details.
      *
     ISDBROK    E DSSDBROKPD
      **  External Data structure for broker file.
      *
     ISDDLST    E DSSDDLSTPD                                              109795
      **  External Data structure for deals sub-type file.                109795
      *                                                                   109795
     ISDMMOD    E DSSDMMODPD
      **  External Data structure for module ICD file.
      *
     ISDNOST    E DSSDNOSTPD
     I              QQACCD                          ACCDQQ                                    CGL029
      **  External Data structure for nostro details.
      *
     ISDMGME    E DSSDMGMEPD
      **  Data structure for message management data.
      *
     ISCSARD    E DSSCSARDPD                                              077898
      **  Data structure for Switchable Features file                     077898
      *                                                                   077898
     IWLTDS     E DSSDWLTOPD                                                                  CSD015
      ** Watch List Transaction Details Data Structure                                        CSD015
      *                                                                                       CSD015
     IPSTRNG      DS                           9999                                           CSD015
      ** SDWLCLOP Search String Parameter                                                     CSD015
      *                                                                                       CSD015
     ISDWLCC    E DSSDWLCCPD                                                                  222385
      ** Watch list checking details                                                          222385
      *                                                                                       222385
     I***SDGELR*   E DSSDGELRPD                                                    MD035545 MD047993
     I**GENERAL*LEDGER*DETAILS*ACCESSED*VIA*ACCESS*PROGRAM***************          MD035545 MD047993
     I**********    QQACCD                          ACCDQQ                         MD035545 MD047993
     IDSFDY     E DSDSFDY
      **  Short data structure for access programs
      *
     IDSSDY     E DSDSSDY
      **  Long data structure for access programs
      *
     IDSLDY     E DSDSLDY                                                                     CSW024
      ** Third data structure for access programs                                             CSW024
      *                                                                                       CSW024
     ISDCNST    E DSSDCNSTPD                                                                  CSW213
      **  Data structure for counterparty nostro file                                         CSW213
      *                                                                                       CSW213
     ILDA         DS                            256
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
      **  Local data area
     I*
     I/COPY WNCPYSRC,MG0320IIP2
     I*
     I/COPY ZSRSRC,ZINTDYZ1                                               066550
     I/COPY ZSRSRC,ZDATE9Z2                                               066550
     I/COPY ZSRSRC,ZDAT10Z1                                               126017
     IMGAWBA      DS                                                      103387
     I                                        1   6 WWAWBA                103387
     I                                        7  35 WWAWBB                103387
      *                                                                                      255986B
     I              'PopBTBConf          'C         APOPB                                    255986B
     I              'LECalcBasis6LeapYear'C         WPARML                                  MD035545
      *
     C/EJECT
      *****************************************************************
      *                   Index to subroutines                        *
      *   main process                                                *
      *   FSWAD- Format SWIFT Address.                                *
      *   INTF - Initialise non-constant fields.                      *
      ****ROUT*-*Determine*Message*Routing.****************************   CSW096
      * SRROUT - Determine Message Routing.                           *   CSW096
      *   FMTA - Format Message Detail - Seq. A.                      *
      *   FMTB - Format Message Detail - Seq. B.                      *
      *   CODE - Calculate the codeword.                              *
      *   PAYE - Pay side field 57 (KNOWN or UNKNOWN)                 *
      *   DATES- Format the Date Fields.                              *
      *   RECV - Format Fields 53 ,56 and 57 (receive instructions)   *
      *   PAY  - Format Fields 53  56 and 57 (payment instructions)   *
      *   FLD72- Format Field 72.                                     *
      *   FMA200 - Format Message Details - Sequence A                *   CSW200
      *   FMB200 - Format Message Details - Sequence B                *   CSW200
      *   FMC200 - Format Message Details - Sequence C                *   CSW200
      *   FMD200 - Format Message Details - Sequence D                *   CSW200
      *   FME200 - Format Message Details - Sequence E                *   CSW200
      *   FMF200 - Format Message Details - Sequence F                *   CSW200
      *   FMH200 - Format Message Details - Sequence H                *   CSW200
      ****NWAD*-*Determine*Default*Network*Address.********************   CSW096
      ****PRAD*-*Determine*Priority*Network*Address.*******************   CSW096
      **TXROUT**-*Attempt*priority*route*to*STTX/Telex*****************   CSW096
      **SWROUT**-*Attempt*priority*route*to*SWIFT**********************   CSW096
      ****FILL*-*Fill*arrays*for*generation*state.*********************   CSW096
      *   REPT - Print Incorrectly Generated Messages.                *
      *   OMSG - Output Correctly Generated Messages.                 *
      *   WREF - Write o/p reference to PF/MGOREFPD.                  *
      *   INIT - Initial Process.                                     *
      *   *PSSR- Error Handling.                                      *
      *                                                               *
      *****************************************************************
     C/EJECT
      *****************************************************************
      *   NOTE:   A multiple occurrence data structure is used to     *
      *           store up the records that make up the SWIFT message *
      *           before writing the whole message to file.           *
      *           To store the records of the message, you must       *
      *           first access an OCUR record, obtain the Message Tag *
      *           & Message field data values for this OCUR record,   *
      *           then go on to the next OCUR record and continue     *
      *           this process until the SWIFT message is complete.   *
      *                                                               *
      *   NOTE2:  :3xP: and :3xR:                                     *
      *           The tag on fields 32 , 33 and 34 is either P or R   *
      *           dependant on the value of MGLORD the loans or       *
      *           deposits indicator. If MGLORD = L the deal is a     *
      *           loan (placing), D indicates a deposit (taking).     *
      *           MGLORD:                L         D               *
      *           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~}         *
      *           32                     P         R      }        *
      *           33(mgrota>mgpcpl.)     R         P       }tag    *
      *           33(mgrota<=mgpcpl)     P         R      } value. *
      *           34                     R         P     }         *
      *           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~          *
      *   NOTE3:  RECV and PAY subroutines.                           *
      *           Both subroutines RECV and PAY format the same       *
      *           fields.However the order in which these are         *
      *           performed depends upon whether the deal is a        *
      *           placing or a taking and also on which format of the *
      *           message is being produced.                          *
      *           MGLORD:                     L(placing)D(taking)  *
      *           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ *
      *           Format A (at value date)     PAY        RECV     *
      *           Format B (when funds due)    RECV       PAY      *
      *           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~  *
      *****************************************************************
     C/EJECT
      *****************************************************************
      *   MAIN - main process                                         *
      *   Called by - none                                            *
      *   Calls - INIT Initial Process.                               *
      *           INTF Initialise non-constant fields.                *
      ************ROUT*Determine*Message*Routing.**********************   CSW096
      *           SRROUT Determine Message Routing.                   *   CSW096
      *           FMTA Format Message Detail - Seq. A.                *
      *           FMTB Format Message Detail - Seq. B.                *
      *           REPT Print Incorrectly Generated Messages.          *
      *           OMSG Output Correctly Generated Messages.           *
      *****************************************************************
      *                                                                                       190127
      **  Transaction history key                                                             190127
     C           HSKEY     KLIST                                                              190127
     C                     KFLD           MGMODI                                              190127
     C                     KFLD           HSTRAN                                              190127
     C                     KFLD           HSMTPY                                              190127
      *
      ** Initial process
      *
     C/COPY WNCPYSRC,MG0320C073
     C                     EXSR INIT
      *
     C* Access Switchable features file to see if ConCord is switched     CCF001
     C* ON.                                                               CCF001
     C*                                                                   CCF001
     C                     CALL 'AOSARDR0'                                CCF001
     C                     PARM '       ' RTCDA   7                       CCF001
     C                     PARM '*VERIFY' RTCDB   7                       CCF001
     C                     PARM 'CCF001'  RTCDC   6                       CCF001
     C*                                                                   CCF001
     C           RTCDA     IFEQ *BLANK                                    CCF001
     C                     MOVE *ON       *IN27                           CCF001
     C                     END                                            CCF001
     C*                                                                   CCF001
      ** Read the first record from the MT320 extract file
      *
     C                     READ MGF320PD                 10
      *
      ** Format Message Control.
      *
      ** Do While records found on the MT320 extract file
      *
     C           *IN10     DOWEQ'0'
      *
      ** Initialise non-constant fields
      *
     C                     EXSR INTF
      *
      ** Determine Message Routing.
      *
     C***********          EXSR ROUT                                      CSW096
     C                     EXSR SRROUT                                    CSW096
      *                                                                   CSW200
     C           CSW200    IFEQ 'N'                                       CSW200
      *
      ** Format Message Detail - Seq A.
      *
     C                     EXSR FMTA
      *
      ** Format Message Detail - Seq B.
      *
     C                     EXSR FMTB
      *                                                                   CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      ** Use the Swift 2000 changes                                       CSW200
      *                                                                   CSW200
      ** Format Message Detail - Seq A.                                   CSW200
      *                                                                   CSW200
     C                     EXSR FMA200                                    CSW200
      *                                                                   CSW200
      ** Format Message Detail - Seq B.                                   CSW200
      *                                                                   CSW200
     C                     EXSR FMB200                                    CSW200
      *                                                                   CSW200
      *                                                                   CSW200
      ** Format Message Detail - Seq C.                                   CSW200
      *                                                                   CSW200
     C                     EXSR FMC200                                    CSW200
      *                                                                   CSW200
      ** Format Message Detail - Seq D.                                   CSW200
      *                                                                   CSW200
     C                     EXSR FMD200                                    CSW200
      *                                                                   CSW200
      ** Format Message Detail - Seq E. or F.                             CSW200
      *                                                                   CSW200
     C           MGMODI    IFEQ 'DL'                                      CSW200
     C           S01434    ANDEQ'Y'                                       CSW200
     C           MGIPDS    ANDEQ'Y'                                       CSW200
     C           MGLORD    IFEQ 'L'                                       CSW200
     C                     EXSR FMF200                                    CSW200
     C                     ELSE                                           CSW200
     C                     EXSR FME200                                    CSW200
     C                     ENDIF                                          CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      ** Format Message Detail - Seq H.                                   CSW200
      *                                                                   CSW200
     C                     EXSR FMH200                                    CSW200
     C           CSW208    IFEQ 'Y'                                                           CSW208
     C                     EXSR FMI208                                                        CSW208
     C                     ENDIF                                                              CSW208
     C                     ENDIF                                          CSW200
      *
      ** Print incorrectly generated message
     C           @ERR      IFEQ 'Y'
     C                     EXSR REPT
     C                     ELSE
      *
      ** Output correctly generated message
     C                     EXSR OMSG
      *
      ** If confirmation matching switched on, generate feedback record
      **  (at present only produced for dealing)
      *
     C           BGCFMT    IFEQ 'Y'
     C           MGMODI    ANDEQ'DL'
     C                     EXSR CFMAT
     C                     END
      *
     C                     END
      *
      ** Delete the processed GDF record.
      *
     C                     DELETMGF320PD               16
      *
      **  Error on delete of record.
      *
     C           *IN16     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '013'     DBASE              * * * * * * *
     C                     MOVELMGTNUM    DBKEY              * DBERR 013 *
     C                     MOVEL'MGF320PD'DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Update sequence numbers on transaction record
      **  if no errors have occurred
      *
     C           @ERR      IFNE 'Y'
     C                     CALL 'MG5000'               26
     C                     PARM MGMODI    @MODI   2
     C                     PARM MGTNUM    @TRAN  15
     C                     PARM 'CE'      @PROG   2
     C                     PARM 'U'       @MODE   1
     C                     PARM *ZEROS    MGLSWC  30
     C                     PARM *ZEROS    MGLSWS  30
     C                     PARM *BLANKS   @ERCD   1
      *
      **  Error on access for sequence number
     C           @ERCD     IFEQ 'Y'
     C           *LOCK     IN   LDA
     C                     MOVE '024'     DBASE            * * * * * * * *
     C                     MOVELMODI      DBKEY            *  DBERR 024  *
     C                     MOVE MTRN      DBKEY            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Program missing on call
     C           *IN26     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '025'     DBASE            * * * * * * * *
     C                     MOVE 'MG5000'  DBKEY            *  DBERR 025  *
     C                     OUT  LDA                        * * * * * * * *
     C                     EXSR *PSSR
     C                     END
      *
     C                     END
     C           *LOCK     IN   LDA
     C                     MOVEL'MG0320  'DBPGM
     C                     OUT  LDA
     C/COPY WNCPYSRC,MG0320C027
      *
      **  COMIT all changes since no error on writing the message
      *
     C                     COMIT
      *                                                                   221145
      **  Call Compliance Watch:Watch List Checking                       221145
      *                                                                   221145
     C           CSD015    IFEQ 'Y'                                       221145
     C           W1EWLC    ANDEQ'Y'                                                           222385
     C           CSW025    ANDEQ'N'                                       221145
     C                     EXSR WLCDQ                                     221145
     C                     ENDIF                                          221145
      *
      **  Read the next record.
      *
     C                     READ MGF320PD                 10
     C                     END
      *
      **  Write end of report, only if the printer file is open
      *
     C           *IN50     IFEQ '1'
     C                     WRITEEOREPT
     C                     END
     C/COPY WNCPYSRC,MG0320C030
      *
     C                     SETON                     LR
     C/EJECT
      *****************************************************************
      *   FSWAD - Format SWIFT address                                *
      *   Called by - RECV  - Format fields 53,56, and 57.            *
      *               PAY   - Format fields 53,56, and 57.            *
      *****************************************************************
      *
     C           FSWAD     BEGSR
      *
     C*********************CALL 'ZM0050'                                  CSW036
     C                     CALL 'ZM0051'                                  CSW036
     C                     PARM           ZDEST  12
     C                     PARM           ZSADD1 35
     C                     PARM           ZSADD2 35
     C                     PARM           ZSADD3 35
     C                     PARM           ZSADD4 35
     C                     PARM           ZSTAG   1
     C                     PARM           ZSTYPE  1
     C                     PARM           ZERR    1
     C                     PARM           ZDBEI   1                                           CSW201
      **  Error ?
     C           ZERR      IFEQ '1'
     C                     MOVE 'Y'       @ERR
     C                     MOVE @MTAG     MTAG
     C                     MOVELZDEST     MFLD
     C                     MOVELMSGA,6    MERR
     C                     ELSE
      **  Address 1
     C           ACLINE    IFNE *BLANKS                                   056739
     C                     MOVELACLINE    MFLD                            056739
     C                     ELSE                                           056739
     C                     MOVELZSADD1    MFLD
     C                     END                                            056739
      *
      **  SWIFT address;  Else full address
     C           ZSTAG     IFEQ 'A'
     C/COPY WNCPYSRC,MG0320C042
     C                     MOVE 'A'       TAG
     C                     MOVE @MTAG     MTAG
     C/COPY WNCPYSRC,MG0320C043
     C                     MOVE *BLANKS   SAVMTG  5                       183583
     C           ACLINE    IFNE *BLANKS                                   056739
     C                     MOVE MTAG      SAVMTG                          183583
     C                     ADD  1         X                               056739
     C           X         OCUR MULT                                      056739
     C                     MOVELZSADD1    MFLD                            056739
     C                     END                                            056739
     C                     EXSR SEXTN                                     183583
      *
     C                     ELSE
     C/COPY WNCPYSRC,MG0320C044
     C                     MOVE 'D'       TAG
     C                     MOVE @MTAG     MTAG
     C/COPY WNCPYSRC,MG0320C045
     C           ACLINE    IFNE *BLANKS                                   056739
     C                     ADD  1         X                               056739
     C           X         OCUR MULT                                      056739
     C                     MOVELZSADD1    MFLD                            056739
     C                     END                                            056739
      **  Address 2
     C           ZSADD2    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD2    MFLD
     C                     END                             Address 2      E42086
      **  Address 3
     C           ZSADD3    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD3    MFLD
     C                     END                             Address 3      E42086
      **  Address 4
     C           ZSADD4    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD4    MFLD
     C                     END                             Address 4
     C**********           END                             Address 3      E42086
     C**********           END                             Address 2      E42086
     C                     END                             Address 1
      *
     C                     END                             Error ?
      *
     C                     ENDSR
      /EJECT                                                              183583
      *****************************************************************   183583
      *                                                               *   183583
      *   SEXTN - Store customer with SWIFT address to data structure *   183583
      *                                                               *   183583
      *   Called by: FSWAD                                            *   183583
      *   Calls    : None                                             *   183583
      *                                                               *   183583
      *****************************************************************   183583
      *                                                                   183583
     C           SEXTN     BEGSR                                          183583
      *                                                                   183583
     C           SAVMTG    IFNE *BLANKS                                   183583
     C                     MOVE SAVMTG    @MTG                            183583
     C                     ELSE                                           183583
     C                     MOVELMTAG      @MTG                            183583
     C                     ENDIF                                          183583
     C           FLDTYP    IFEQ '5'                                       183583
     C           FLDTAG    ANDEQ'A'                                       183583
     C           FLDTYP    OREQ '8'                                                           CSW213
     C           FLDTAG    ANDEQ'A'                                                           CSW213
     C                     ADD  1         V                               183583
     C           V         OCUR EXTN                                      183583
     C                     Z-ADDX         MPSN                            183583
     C                     MOVEL@MTG      MTG                             183583
     C                     MOVELZDEST     MCSI                            183583
     C                     ENDIF                                          183583
      *                                                                   183583
     C           SEXT9     ENDSR                                          183583
     C/EJECT                                                                                  CSW213
      *****************************************************************                       CSW213
      *   FMT83 - Format Field 83J                                    *                       CSW213
      *   Called by - Format Message Detail - Sequence A.             *                       CSW213
      *   Calls - SEXTN                                               *                       CSW213
      *****************************************************************                       CSW213
      *                                                                                       CSW213
     C           FMT83     BEGSR                                                              CSW213
      *                                                                                       CSW213
     C                     MOVE *BLANKS   WFLD83  6                                           CSW213
     C                     MOVE *BLANKS   WBCUST  6                                           CSW213
     C                     MOVE *BLANKS   BBCUST                                              CSW213
      *                                                                                       CSW213
     C           CSW024    IFEQ 'Y'                                                           CSW213
     C           DSFUND    ANDNE*BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           '/NAME/'  CAT  DSFUND    MFLD                                                CSW213
     C                     MOVE ':83J:'   MTAG                                                CSW213
     C           CSW037    IFEQ 'Y'                                                           CSW213
     C           DSFNAC    ANDNE*BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELDSFNAC    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      *                                                                                       CSW213
     C                     ELSE                                                               CSW213
      *                                                                                       CSW213
      **  Access customer file for Beneficiary Customer Number                                CSW213
      *                                                                                       CSW213
     C           MGBENN    IFNE *BLANKS                                                       CSW213
     C                     CALL 'AOCUSTR1'                                                    CSW213
     C                     PARM '*MSG   ' @RTCD                                               CSW213
     C                     PARM '*KEY   ' @OPTN                                               CSW213
     C                     PARM MGBENN    @KEY2  10                                           CSW213
     C                     PARM *BLANKS   @KYST   7                                           CSW213
     C           SDCUST    PARM SDCUST    DSLDY                                               CSW213
      *                                                                                       CSW213
      ** Customer Not found on SDCUSTPD, check the counterparty                               CSW213
      ** Nostro file.                                                                         CSW213
      *                                                                                       CSW213
     C           @RTCD     IFNE *BLANKS                                                       CSW213
     C                     CALL 'AOCNSTR0'                                                    CSW213
     C                     PARM *BLANKS   @RTCD   7                                           CSW213
     C                     PARM '*KEY'    @OPTN   7                                           CSW213
     C                     PARM MGBENN    @CNCD   8                                           CSW213
     C           SDCNST    PARM SDCNST    DSFDY                                               CSW213
      *                                                                                       CSW213
      ** Customer record not found - database error                                           CSW213
      *                                                                                       CSW213
     C           @RTCD     IFNE *BLANKS                                                       CSW213
     C           *LOCK     IN   LDA                                                           CSW213
     C                     MOVE '022'     DBASE                                               CSW213
     C                     MOVELMGBENN    DBKEY                                               CSW213
     C                     MOVEL'SDCUSTPD'DBFILE                                              CSW213
     C                     OUT  LDA                                                           CSW213
     C                     EXSR *PSSR                                                         CSW213
     C                     ELSE                                                               CSW213
     C                     MOVE '999999'  WBCUST                                              CSW213
     C                     ENDIF                                                              CSW213
     C                     ELSE                                                               CSW213
     C                     MOVE BBCUST    WBCUST                                              CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      **  Output this field only if Pay Ordering Bank/Customer                                CSW213
      **  is not the same as Sender, Receiver and Beneficiary                                 CSW213
      **  Also, Pay Ordering Customer/Bank must have SWIFT address.                           CSW213
      *                                                                                       CSW213
     C           MGPOBN    IFNE *BLANKS                                                       CSW213
     C           MGPOBN    ANDNEWBICN                                                         CSW213
     C           MGPOBN    ANDNEMGCNUM                                                        CSW213
     C           MGPOBN    ANDNEWBCUST                                                        CSW213
     C                     MOVE MGPOBN    WFLD83                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
     C           MGPOCN    IFNE *BLANKS                                                       CSW213
     C           MGPOCN    ANDNEWBICN                                                         CSW213
     C           MGPOCN    ANDNEMGCNUM                                                        CSW213
     C           MGPOCN    ANDNEWBCUST                                                        CSW213
     C                     MOVE MGPOCN    WFLD83                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
     C           WFLD83    IFNE *BLANKS                                                       CSW213
     C                     MOVE *BLANKS   ZDEST                                               CSW213
     C                     MOVELWFLD83    ZDEST                                               CSW213
      *                                                                                       CSW213
     C                     CALL 'ZM0050'               15                                     CSW213
     C                     PARM           ZDEST  12                                           CSW213
     C                     PARM           ZSADD1 35                                           CSW213
     C                     PARM           ZSADD2 35                                           CSW213
     C                     PARM           ZSADD3 35                                           CSW213
     C                     PARM           ZSADD4 35                                           CSW213
     C                     PARM           ZSTAG   1                                           CSW213
     C                     PARM           ZSTYPE  1                                           CSW213
     C                     PARM ' '       ZERR    1                                           CSW213
     C                     PARM           ZDBEI   1                                           CSW213
      *                                                                                       CSW213
     C           *IN15     IFEQ '1'                                                           CSW213
     C           *LOCK     IN   LDA                                                           CSW213
     C                     MOVE '023'     DBASE                                               CSW213
     C                     MOVEL'       ' DBKEY                                               CSW213
     C                     MOVEL'ZM0050'  DBFILE                                              CSW213
     C                     OUT  LDA                                                           CSW213
     C                     EXSR *PSSR                                                         CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      **  Error ?                                                                             CSW213
      *                                                                                       CSW213
     C           ZERR      IFEQ '1'                                                           CSW213
     C                     MOVE 'Y'       @ERR                                                CSW213
     C                     MOVE ZSTAG     TAG                                                 CSW213
     C                     MOVE @MTAG     MTAG                                                CSW213
     C                     MOVELZDEST     MFLD                                                CSW213
     C                     MOVELMSGA,6    MERR                                                CSW213
      *                                                                                       CSW213
     C                     ELSE                                                               CSW213
      *                                                                                       CSW213
      **  Output only if with SWIFT address.                                                  CSW213
      *                                                                                       CSW213
     C           ZSTAG     IFEQ 'A'                                                           CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVE ' '       TAG                                                 CSW213
     C                     MOVE '83'      FLDNO                                               CSW213
     C                     MOVE 'A'       TAG                                                 CSW213
     C                     MOVE @MTAG     MTAG                                                CSW213
      *                                                                                       CSW213
      **  Address 1                                                                           CSW213
      *                                                                                       CSW213
     C                     MOVE *BLANKS   SAVMTG  5                                           CSW213
     C           ACLINE    IFNE *BLANKS                                                       CSW213
     C                     MOVE MTAG      SAVMTG                                              CSW213
     C                     MOVELACLINE    MFLD                                                CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVELZSADD1    MFLD                                                CSW213
     C                     ELSE                                                               CSW213
     C                     MOVELZSADD1    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     EXSR SEXTN                                                         CSW213
      *                                                                                       CSW213
     C                     ELSE                                                               CSW213
     C           CSW024    IFEQ 'Y'                                                           CSW213
     C           DSCORP    ANDEQ'Y'                                                           CSW213
     C           CSW213    ANDEQ'Y'                                                           CSW213
     C           BBRI01    IFNE *BLANK                                                        CSW213
     C           BBRI02    ORNE *BLANK                                                        CSW213
     C           BBRI03    ORNE *BLANK                                                        CSW213
     C           BBRI04    ORNE *BLANK                                                        CSW213
     C           BBRI05    ORNE *BLANK                                                        CSW213
      *                                                                                       CSW213
     C                     MOVE *BLANK    DN83    1                                           CSW213
     C           BBRI01    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVE ':83J:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN83                                                CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELBBRI01    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           BBRI02    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN83      IFNE 'Y'                                                           CSW213
     C                     MOVE ':83J:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN83                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELBBRI02    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           BBRI03    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN83      IFNE 'Y'                                                           CSW213
     C                     MOVE ':83J:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN83                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELBBRI03    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           BBRI04    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN83      IFNE 'Y'                                                           CSW213
     C                     MOVE ':83J:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN83                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELBBRI04    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           BBRI05    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN83      IFNE 'Y'                                                           CSW213
     C                     MOVE ':83J:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN83                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELBBRI05    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
     C                     ENDSR                                                              CSW213
     C/EJECT
      *****************************************************************
      *   INTF - Initalise non-constant fields                        *
      *   Called by - main process                                    *
      *****************************************************************
      *
     C           INTF      BEGSR
      *
     C                     MOVE *BLANKS   AWBA6   6                       088043
     C                     MOVELMGAWBA    AWBA6   6                       088043
      *                                                                   103387
      * Reformat MGAWBA if it contains "DIRECT"                           103387
      *                                                                   103387
     C                     MOVE MGAWBA    MGTEST 29                       103387
     C           WWAWBA    IFEQ 'DIRECT'                                  103387
     C           WWAWBB    ANDEQ*BLANKS                                   103387
     C                     MOVEL'/DIRECT' MGAWBA    P                     103387
     C                     END                                            103387
     C                     MOVE *BLANKS   TRNO
     C                     MOVE *BLANKS   @TRNA
     C                     MOVE *BLANKS   @TRNB
     C                     MOVE '      '  NWRK
     C**********           Z-ADD0         SECN                                                CSD027
     C                     MOVE *BLANKS   SECN                                                CSD027
     C                     MOVE *BLANKS   NWSN
     C**********           Z-ADD0         DECN                                                CSD027
     C                     MOVE *BLANKS   DECN                                                CSD027
     C                     MOVE *BLANKS   NWDS
     C                     MOVE *BLANKS   MGSG
     C                     MOVE *BLANKS   MGST
     C                     MOVE *BLANKS   LSCC
     C                     MOVE *BLANK    F57U
     C                     MOVE *BLANKS   CWRD
     C                     Z-ADD0         MGTM
     C                     Z-ADD0         LATM
     C                     MOVE *BLANKS   RELD
     C                     Z-ADD0         RELT
     C                     MOVE *BLANKS   AMTS
     C                     MOVE *BLANKS   SVDT
     C                     MOVE *BLANKS   CINDV                           141572
      *
     C                     MOVE *BLANKS   @ERR    1
     C                     MOVE *BLANKS   SCSID  12
     C                     MOVE *BLANKS   STELX  10
     C                     MOVE *BLANKS   SSTTX  12
     C                     MOVE *BLANKS   SCRNM  20
     C                     MOVE *BLANKS   SPCNB   6
     C                     MOVE *BLANKS   SPAIN   1
     C/COPY WNCPYSRC,MG0320C028
      *
      **  Currently positioned at line 1 of Field :72:
     C                     MOVE 'N'       LINE2   1
      *
      **  Clear multiple occurrence data structure
     C**********           Z-ADD1         X       20                                          CSW208
     C                     Z-ADD1         X                                                   CSW208
     C           X         OCUR MULT
      *
     C***********X         DOWLE40                                        CSW200
     C           X         DOWLE85                                        CSW200
     C           MULT      ANDNE*BLANKS
     C                     MOVE *BLANKS   MULT
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
      *                                                                   183583
      ** Clear multiple occurrence DS for the extension file.             183583
      *                                                                   183583
     C                     Z-ADD1         V       20                      183583
     C           V         OCUR EXTN                                      183583
     C           V         DOWLE20                                        183583
     C           MCSI      ANDNE*BLANKS                                   183583
     C                     Z-ADD*ZEROS    MPSN                            183583
     C                     MOVE *BLANKS   MTG                             183583
     C                     MOVE *BLANKS   MCSI                            183583
     C                     ADD  1         V                               183583
     C           V         OCUR EXTN                                      183583
     C                     ENDDO                                          183583
     C                     Z-ADD0         V                               183583
      *
      **  Obtain sequence numbers from transaction record
     C                     CALL 'MG5000'               26
     C                     PARM MGMODI    @MODI   2
     C                     PARM MGTNUM    @TRAN  15
     C                     PARM 'CE'      @PROG   2
     C                     PARM *BLANKS   @MODE   1
     C                     PARM *ZEROS    MGLSWC  30
     C                     PARM *ZEROS    MGLSWS  30
     C                     PARM *BLANKS   @ERCD   1
      *
      **  Error on access for sequence number
     C           @ERCD     IFEQ 'Y'
     C           *LOCK     IN   LDA
     C                     MOVE '022'     DBASE            * * * * * * * *
     C                     MOVELMODI      DBKEY            *  DBERR 022  *
     C                     MOVE MTRN      DBKEY            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Program missing on call
     C           *IN26     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '023'     DBASE            * * * * * * * *
     C                     MOVE 'MG5000'  DBKEY            *  DBERR 023  *
     C                     OUT  LDA                        * * * * * * * *
     C                     EXSR *PSSR
     C                     END
     C           *LOCK     IN   LDA
     C                     MOVEL'MG0320  'DBPGM
     C                     OUT  LDA
      *
      * If the branch code on the file MGF320PD is blank,                 081533
      *  then defualt it to the branch code on the SDBRCHPD               081533
     C           MGBRCA    IFEQ *BLANK                                    081533
     C                     MOVELA8BRCD    MGBRCA                          081533
     C                     END                                            081533
      *                                                                   081533
      ** If our receive branch is blank then default it to the            081533
      ** branch code.                                                     081533
     C           MGROBR    IFEQ *BLANK                                    081533
     C                     MOVELMGBRCA    MGROBR                          081533
     C                     END                                            081533
      *                                                                   137909
      **  Access Switchable Features file for CEU003                      137909
      *                                                                   137909
     C                     CALL 'AOSARDR0'                                137909
     C                     PARM *BLANKS   @RTCD                           137909
     C                     PARM '*VERIFY' @OPTN                           137909
     C                     PARM 'CEU003'  @SARD   6                       137909
     C           @RTCD     IFEQ *BLANKS                                   137909
     C                     MOVEL'Y'       CEU003  1                       137909
     C                     ELSE                                           137909
     C                     MOVEL'N'       CEU003                          137909
     C                     ENDIF                                          137909
      *                                                                   137909
      **  Access Switchable Features file for CEU004                      137909
      *                                                                   137909
     C                     CALL 'AOSARDR0'                                137909
     C                     PARM *BLANKS   @RTCD                           137909
     C                     PARM '*VERIFY' @OPTN                           137909
     C                     PARM 'CEU004'  @SARD   6                       137909
     C           @RTCD     IFEQ *BLANKS                                   137909
     C                     MOVEL'Y'       CEU004  1                       137909
     C                     ELSE                                           137909
     C                     MOVEL'N'       CEU004                          137909
     C                     ENDIF                                          137909
     C*                                                                   081533
     C/COPY WNCPYSRC,MG0320C020
      *                                                                                       CSW024
     C                     MOVE *BLANKS   @KEY1                                               CSW024
     C                     MOVELMGCNUM    @KEY1                                               CSW024
     C                     CALL 'AOCUSTR1'                                                    CSW024
     C                     PARM '*MSG   ' @RTCD                                               CSW024
     C                     PARM '*KEY   ' @OPTN                                               CSW024
     C                     PARM           @KEY1                                               CSW024
     C                     PARM *BLANKS   @KYST                                               CSW024
     C           SDCUST    PARM SDCUST    DSLDY                                               CSW024
      *                                                                                       CSW024
     C           @RTCD     IFNE *BLANKS                                                       CSW024
     C           *LOCK     IN   LDA                                                           CSW024
     C                     MOVEL'AOCUSTR0'DBFILE                                              CSW024
     C                     MOVE '034'     DBASE              * * * * * * *                    CSW024
     C                     MOVELMGCNUM    DBKEY              * DBERR 34  *                    CSW024
     C                     OUT  LDA                          * * * * * * *                    CSW024
     C                     EXSR *PSSR                                                         CSW024
     C                     ELSE                                                               CSW024
     C                     MOVE BBCNA1    DSCNA1 35                                           CSW024
     C                     MOVE BBCNA2    DSCNA2 35                                           CSW024
     C                     MOVE BBCNA3    DSCNA3 35                                           CSW024
     C                     MOVE BBCNA4    DSCNA4 35                                           CSW024
     C                     MOVE BBCORP    DSCORP  1                                           CSW024
     C                     MOVE BBCBEI    DSCBEI 11                                           CSW024
     C                     MOVE BBRI01    DSRI01 40                                           CSW024
     C                     MOVE BBRI02    DSRI02 40                                           CSW024
     C                     MOVE BBRI03    DSRI03 40                                           CSW024
     C                     MOVE BBRI04    DSRI04 40                                           CSW024
     C                     MOVE BBRI05    DSRI05 40                                           CSW024
     C                     MOVE BBFUND    DSFUND 34                                           CSW024
     C           CSW037    IFEQ 'Y'                                                           CSW037
     C******               MOVE BBFNAC    DSFNAC 30                                    CSW037CSW037A
     C           *LIKE     DEFN BBFNAC    DSFNAC                                             CSW037A
     C                     MOVELBBFNAC    DSFNAC                                             CSW037A
     C                     ENDIF                                                              CSW037
     C                     ENDIF                                                              CSW024
      *                                                                                       CSW024
     C                     Z-ADD*ZEROS    MSGBYT  60                                          CSW208
     C                     Z-ADD*ZEROS    FMTIBY  60                                          CSW208
     C                     Z-ADD29        BL1BYT  60                                          CSW208
     C                     Z-ADD52        BL2BYT  60                                          CSW208
     C                     Z-ADD*ZEROS    BL3BYT  60                                          CSW208
     C                     Z-ADD17        BLSBYT  60                                          CSW208
     C                     MOVE 'N'       WAMND   1                                         AR916823
      *                                                                                       CSW208
     C                     MOVE *BLANKS   WRK22B  4                                         AR908919
      *                                                                                     AR908919
     C                     ENDSR
     C/EJECT
      *****************************************************************
      ****ROUT*-*determine*message*routing*****************************   CSW096
      ****Called*by*-*main*process*************************************   CSW096
      ****Calls*-*NWAD*determine*default*network*addresses*************   CSW096
      ************PRAD*determine*priority*network*addresses************   CSW096
      ************FILL*fill*up*GNR*array.******************************   CSW096
      *****************************************************************   CSW096
      ***********                                                         CSW096
     C***********ROUT      BEGSR                                          CSW096
      ***********                                                         CSW096
      ***Access*branch*details*with*Branch*code*of*sender.****************CSW096
      ***********                                                         CSW096
     C***********          CALL 'AOBRCHR0'                                CSW096
     C***********          PARM '*MSG   ' @RTCD                           CSW096
     C***********          PARM '*KEY   ' @OPTN                           CSW096
     C***********          PARM MGBRCA    @BRCD   3                       CSW096
     C***********SDBRCH    PARM SDBRCH    DSSDY                           CSW096
      ***********                                                         CSW096
      ***Branch*record*not*found*-*Error**********************************CSW096
      ***********                                                         CSW096
     C***********@RTCD     IFNE *BLANKS                                   CSW096
     C************LOCK     IN   LDA                                       CSW096
     C***********          MOVE '007'     DBASE              * * * * * * *CSW096
     C***********          MOVELMGBRCA    DBKEY              * DBERR 007 *CSW096
     C***********          MOVEL'SDBRCHPD'DBFILE             * * * * * * *CSW096
     C***********          OUT  LDA                                       CSW096
     C***********          EXSR *PSSR                                     CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      *****save*branch*internal*customer*number*&*SWIFT*TID*address*******CSW096
      ***********                                                         CSW096
     C***********          MOVELA8BICN    SECN                            CSW096
     C***********          MOVE A8BTID    SCSID                           CSW096
      ***********                                                         CSW096
      ****Access*SDCUSTPD*using*branch*internal*customer*number***********CSW096
      ***********                                                         CSW096
     C***********          MOVE *BLANKS   @KEY1                           CSW096
     C***********          MOVELSECN      @KEY1                           CSW096
     C***********          CALL 'AOCUSTR0'                                CSW096
     C***********          PARM '*MSG   ' @RTCD                           CSW096
     C***********          PARM '*KEY   ' @OPTN                           CSW096
     C***********          PARM           @KEY1  10                       CSW096
     C***********          PARM *BLANKS   @KYST   7                       CSW096
     C***********SDCUST    PARM SDCUST    DSSDY                           CSW096
      ***********                                                         CSW096
      ***Customer*record*not*found*-*Error********************************CSW096
      ***********                                                         CSW096
     C***********@RTCD     IFNE *BLANKS                                   CSW096
     C************LOCK     IN   LDA                                       CSW096
     C***********          MOVE '008'     DBASE              * * * * * * *CSW096
     C***********          MOVEL@KEY1     DBKEY              * DBERR 008 *CSW096
     C***********          MOVEL'SDCUSTPD'DBFILE             * * * * * * *CSW096
     C***********          OUT  LDA                                       CSW096
     C***********          EXSR *PSSR                                     CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****Save*sender's*addresses*&*parent*customer*number****************CSW096
      ***********                                                         CSW096
     C***********          MOVE BBTXA1    STELX                           CSW096
     C***********          MOVE BBSTAD    SSTTX                           CSW096
     C***********          MOVE BBCRNM    SCRNM                           CSW096
     C***********          MOVE BBPCNB    SPCNB                           CSW096
     C***********          MOVE BBPAIN    SPAIN                           CSW096
      ***********                                                         CSW096
      ****Access*SDCUSTPD*using*destination*customer*number***************CSW096
      ***********                                                         CSW096
     C***********          MOVE *BLANKS   @KEY1                           CSW096
     C***********          MOVELMGCNUM    @KEY1                           CSW096
     C***********          CALL 'AOCUSTR0'                                CSW096
     C***********          PARM '*MSG   ' @RTCD                           CSW096
     C***********          PARM '*KEY   ' @OPTN                           CSW096
     C***********          PARM           @KEY1  10                       CSW096
     C***********          PARM *BLANKS   @KYST   7                       CSW096
     C***********SDCUST    PARM SDCUST    DSSDY                           CSW096
      ***********                                                         CSW096
     C***********          MOVE *BLANKS   DSERR                           CSW096
     C***********          MOVE MGCNUM    DECN                            CSW096
      ***********                                                         CSW096
      ****If*the*Destination*Customer*is*not*found.***********************CSW096
      ***********                                                         CSW096
     C***********@RTCD     IFNE *BLANKS                                   CSW096
     C***********          MOVE 'Y'       @ERR    1                       CSW096
     C***********          MOVELMSGA,2    DSERR  50                       CSW096
      ***********                                                         CSW096
      ****Determine*the*routing*to*the*destination*customer.**************CSW096
      ***********                                                         CSW096
     C***********          ELSE                                           CSW096
     C***********          MOVE BBCSID    CSID                            CSW096
     C***********BBDNW3    IFNE *BLANKS                                   CSW096
     C***********          EXSR NWAD                                      CSW096
     C***********          ELSE                                           CSW096
     C***********          EXSR PRAD                                      CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****Fill*up*the*message*status*released*info.*from*PF/SDCUSTPD******CSW096
      ****if*the*message*status*is*blank.*********************************CSW096
      ***********                                                         CSW096
     C***********MGST      IFEQ *BLANKS                                   CSW096
     C***********          EXSR FILL                                      CSW096
      ***********                                                         CSW096
      ***The*following*message*types*can*be*entered*on*sdcustpd*as*to*****CSW096
      ***be*generated*as*released.****************************************CSW096
      ***(NB.**3***-*any*of*the*300*series*messages.**********************CSW096
      *********32**-*any*of*the*320*series*messages.)*********************CSW096
      ***********                                                         CSW096
     C***********'320'     LOKUPGNR                      20               CSW096
     C***********'32*'     LOKUPGNR                      21               CSW096
     C***********'3**'     LOKUPGNR                      22               CSW096
      ***********                                                         CSW096
     C************IN20     IFEQ '1'                                       CSW096
     C************IN21     OREQ '1'                                       CSW096
     C************IN22     OREQ '1'                                       CSW096
     C***********          MOVE 'RSND'    MGST                            CSW096
     C***********          ELSE                                           CSW096
     C************IN27     IFNE '1'                                CCF001 CSW096
     C***********NWRK      ORNE 'CONCOR'                           CCF001 CSW096
     C***********          MOVE 'CRTD'    MGST                            CSW096
     C***********          END                                     CCF001 CSW096
     C***********          END                                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          ENDSR                                          CSW096
     C/EJECT                                                              CSW096
      *****************************************************************   CSW096
      *   SRROUT - determine message routing                          *   CSW096
      *   Called by - main process                                    *   CSW096
      *   Calls -                                                     *   CSW096
      *****************************************************************   CSW096
      *                                                                   CSW096
     C           SRROUT    BEGSR                                          CSW096
      *                                                                   CSW096
     C                     MOVE MGBRCA    I@SNBR                          CSW096
     C                     MOVE *BLANKS   I@DSCN                          CSW096
     C                     MOVE MGCNUM    I@DSCN                          CSW096
     C                     MOVE '320'     I@MTPY                          CSW096
     C                     MOVE 'Y'       I@CONC                          CSW096
     C                     Z-ADD0         I@SETT                          CSW096
     C                     MOVE *BLANK    I@FTCS                          CSW096
     C                     MOVE MGMODI    I@MMOD                          CSW096
      *                                                                   CSW096
      * Add copy sources for enhancement methodology                      CSW096
      * one copy source for all MG generation programs and one            CSW096
      * specific                                                          CSW096
      *                                                                   CSW096
      * General                                                           CSW096
     C/COPY WNCPYSRC,MG9900CALL                                           CSW096
      * Specific                                                          CSW096
     C/COPY WNCPYSRC,MG0320ROUT                                           CSW096
      *                                                                   CSW096
     C*********************CALL 'MG9900'                            CSW096CSW036
     C                     CALL 'MG9901'                                  CSW036
     C                     PARM *BLANKS   @RTCD                           CSW096
     C                     PARM           P@IN                            CSW096
     C                     PARM *BLANKS   P@OUT                           CSW096
     C                     PARM           P@ZZ  256                       CSW096
      *                                                                   CSW096
     C           @RTCD     IFNE *BLANKS                                   CSW096
     C           *LOCK     IN   LDA                                       CSW096
     C                     MOVE '092'     DBASE              * * * * * * *CSW096
     C                     MOVEL'*CALL  ' DBKEY              * DBERR 092 *CSW096
     C*********************MOVEL'MG9900'  DBFILE             * * * * * * *CSW096CSW036
     C                     MOVEL'MG9901'  DBFILE                          CSW036
     C                     OUT  LDA                                       CSW096
     C                     EXSR *PSSR                                     CSW096
     C                     ELSE                                           CSW096
     C                     MOVE O@NWRK    NWRK                            CSW096
     C**********           Z-ADDO@CNSN    SECN                                         CSW096 CSD027
     C                     MOVE O@CNSN    SECN                                                CSD027
     C                     MOVE O@NWSN    NWSN                            CSW096
     C**********           Z-ADDMGCNUM    DECN                                         CSW096 CSD027
     C                     MOVE MGCNUM    DECN                                                CSD027
     C                     MOVE O@NWDS    NWDS                            CSW096
     C                     MOVE O@MGSG    MGSG                            CSW096
     C                     MOVE O@MGST    MGST                            CSW096
     C                     MOVE O@PCNB    SPCNB                           CSW096
     C                     MOVE O@PAIN    SPAIN                           CSW096
     C                     END                                            CSW096
      *                                                                   CSW096
     C                     Z-ADD36        BL5BYT  60                                          CSW208
     C           WPDE      IFEQ 'Y'                                                           CSW208
     C                     ADD  6         BL5BYT                                              CSW208
     C                     ENDIF                                                              CSW208
     C           1         SUBSTNWDS:8    WCHAR                                               CSW208
     C           WCHAR     IFEQ '0'                                                           CSW208
     C           WCHAR     OREQ '1'                                                           CSW208
     C                     ADD  6         BL5BYT                                              CSW208
     C                     ENDIF                                                              CSW208
     C/COPY WNCPYSRC,MG0320C001
     C                     ENDSR                                          CSW096
     C/EJECT                                                              CSW096
      *****************************************************************
      *   FMTA - Format Message Detail - Sequence A.                  *
      *   Called by - main process                                    *
      *   Calls     - CODE   determine codeword.                      *
      *             - DATES  formats date fields.                     *
      *             - PAY    format fields 53,56 and 57.              *
      *             - RECV   format fields 53,56 and 57.              *
      *             - FLD72  format field 72.                         *
      *****************************************************************
      *
     C           FMTA      BEGSR
      *
      ** Field :20: -  Transaction Reference Number.
      *
     C**********           Z-ADD1         X       20                                          CSW208
     C                     Z-ADD1         X       30                                          CSW208
     C           X         OCUR MULT
     C                     MOVEA*BLANKS   @WRK
      *
     C                     Z-ADD1         Z       20
     C                     MOVEAMGMODI    @WRK
     C                     MOVEAMGTNUM    @WRK,3
     C           MGLSWS    ADD  1         HLSWS   30
     C                     MOVE HLSWS     HSWS    3
      *
     C           ' '       LOKUP@WRK,Z                   31
     C                     MOVEAHSWS      @WRK,Z
      *
      **  Check on MGREFPD for a uniqne TRN,else output as an error.
      **  and store the TRN of the new confirmation message.
      *
     C                     MOVEA@WRK      @TRNA  16
      *
     C           @TRNA     CHAINMGREFL0              11
      *
      ** If no record is found flag field as in error.
      *
     C           *IN11     IFEQ '0'
     C                     MOVE 'Y'       @ERR
     C                     MOVEAMSGA,8    MERR
     C                     END
      *
     C                     MOVEL':20:'    MTAG
     C                     MOVEA@WRK      MFLD
     C/COPY WNCPYSRC,MG0320C019
      *
      ** Field :21: - Related Reference.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      **  Determine the message codeword
      *
     C                     MOVE '1'       *IN11                           083970
     C                     EXSR CODE
      *
      **  Obtain transaction reference of previous MT320                                      190127
     C                     MOVELMGTNUM    HSTRAN                                              190127
     C                     MOVE '320'     HSMTPY                                              190127
      *                                                                                       190127
     C                     MOVE HSTRAN    @HTRN   6                                           190127
      *                                                                                       190127
     C           HSKEY     SETGTMGHISTL0                                                      190127
     C                     READPMGHISTL0                 56                                   190127
      *                                                                                       190127
     C           *IN56     IFEQ '0'                                                           190127
     C           HSMODI    ANDEQMGMODI                                                        190127
     C           HSTRAN    ANDEQ@HTRN                                                         190127
     C           HSMTPY    ANDEQ'320'                                                         190127
     C                     MOVEL@HREF     @TRNB                                               190127
     C                     END                                                                190127
      *
     C           CWRD      IFEQ 'NEW'
     C                     MOVEL'NEW'     MFLD
      *
     C                     ELSE
      *
     C           MGROTN    IFNE *ZEROS
     C           *IN11     ANDEQ'1'                                       083970
     C           HSWS      ANDEQ'001'                                                         260362
      *                                                                                       260362
     C                     MOVELMGROTN    JTRAN                                               260362
     C                     CALL 'MG5000'               26                                     260362
     C                     PARM MGMODI    JMODI   2                                           260362
     C                     PARM           JTRAN  15                                           260362
     C                     PARM 'CE'      JPROG   2                                           260362
     C                     PARM 'N'       JMODE   1                                           260362
     C                     PARM *ZEROS    JCFSEQ  30                                          260362
     C                     PARM *ZEROS    JPRSEQ  30                                          260362
     C                     PARM *BLANKS   JERCD   1                                           260362
      *                                                                                       260362
     C           JERCD     IFNE 'Y'                                                           260362
     C                     MOVELMGMODI    MISSB   8                                           260362
     C                     MOVE MGROTN    MISSB                                               260362
     C                     MOVELMISSB     TURNIP 11                                           260362
     C                     Z-ADDJCFSEQ    CFSEQ                                               260362
     C                     MOVE CFSEQ     TURNIP                                              260362
     C                     MOVELTURNIP    MFLD                                                260362
     C                     ELSE                                                               260362
     C                     MOVELMGROTN    MFLD
     C                     ENDIF                                                              260362
      *                                                                                       260362
     C                     ELSE
     C                     MOVEL@TRNB     MFLD
     C                     END
     C                     END
     C/COPY WNCPYSRC,MG0320C029
      *
     C                     MOVEL':21:'    MTAG
      *
      ** Field :22: - Code/Common Reference.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZCREF
      *
      **  If SWIFT network, use sender & destination customer swift ad.
      **  and the exchange rate to produce the common reference. Else
      **  use the message TRN.
      *
     C           NWRK      IFEQ 'SWIFT'
     C           NWRK      OREQ 'STTX'
      *
     C           NWRK      IFEQ 'SWIFT'
     C                     MOVELNWSN      ZSSWI
     C                     MOVELNWDS      ZDSWI
     C                     ELSE
     C                     MOVELSCSID     ZSSWI
     C                     MOVELCSID      ZDSWI
     C                     END
      *
     C                     MOVE MGINTR    ZRATE
      *
      **  Format SWIFT common reference
      *
     C                     CALL 'ZM0020'               15
     C                     PARM           ZSSWI  12
     C                     PARM           ZDSWI  12
     C                     PARM           ZRATE  138
     C                     PARM           ZCREF  16
      *
      ** If the program ends in error.
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '009'     DBASE              * * * * * * *
     C                     MOVEL'       ' DBKEY              * DBERR 009 *
     C                     MOVEL'ZM0020'  DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     END
      *
     C           O@SWSN    IFNE *BLANKS                                   CSW096
     C           O@SWDS    ANDNE*BLANKS                                   CSW096
      *                                                                   CSW096
     C                     MOVE MGINTR    ZRATE                           CSW096
     C                     MOVELO@SWSN    ZSSWI                           CSW096
     C                     MOVELO@SWDS    ZDSWI                           CSW096
      *                                                                   CSW096
      **  Format SWIFT common reference                                   CSW096
      *                                                                   CSW096
     C                     CALL 'ZM0020'               15                 CSW096
     C                     PARM           ZSSWI  12                       CSW096
     C                     PARM           ZDSWI  12                       CSW096
     C                     PARM           ZRATE  138                      CSW096
     C                     PARM           ZCREF  16                       CSW096
      *                                                                   CSW096
     C           *IN15     IFEQ '1'                                       CSW096
     C           *LOCK     IN   LDA                                       CSW096
     C                     MOVE '005'     DBASE                           CSW096
     C                     MOVEL'       ' DBKEY                           CSW096
     C                     MOVEL'ZM0020'  DBFILE                          CSW096
     C                     OUT  LDA                                       CSW096
     C                     EXSR *PSSR                                     CSW096
     C                     ENDIF                                          CSW096
      *                                                                   CSW096
     C                     ENDIF                                          CSW096
      *                                                                   CSW096
     C           ZCREF     IFEQ *BLANKS
     C                     MOVEL@TRNA     ZCREF
     C                     END
      *
     C                     MOVEL':22:'    MTAG
      *
      ** Construct Field 22  'codeword/common reference'
      *
      **  If change type indicates reversal, codeword equals 'CANCEL'
      *
     C           MGCHTP    IFEQ 'C'
     C                     MOVEL'CANCEL  'CWRD
     C                     END
      *
     C                     Z-ADD1         I       20
     C                     MOVEA*BLANKS   @WRK
     C                     MOVEACWRD      @WRK,I
     C           ' '       LOKUP@WRK,I                   31
      *
     C                     MOVEA'/'       @WRK,I
     C                     ADD  1         I
     C                     MOVEAZCREF     @WRK,I
     C                     MOVEA@WRK      MFLD
      *
      **  Codeword blank
      *
     C           CWRD      IFEQ *BLANKS
     C                     MOVE 'Y'       @ERR
     C                     MOVEAMSGA,7    MERR
     C                     END
      *
      **  Format fields 30, 31C, 32, 33, 34, and 37 via the dates S/R.
      *
     C                     EXSR DATES
      *
      ** Format fields 53, 56 and 57 via PAY  OR RECV  S/R.
      *
      ** If the deal is a taking (deposit - MGLORD = D).
      ** (receive of funds at value date)
      *
     C           MGLORD    IFEQ 'D'
     C                     EXSR RECV
      *
      ** If the deal is a placing (loan - MGLORD = L).
      ** (payment of funds at value date)
      *
     C                     ELSE
     C                     EXSR PAY
     C                     END
      *
      ** Format field 72.
      *
     C                     EXSR FLD72
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   FMTB - Format Message Detail - Sequence B.                  *
      *   Called by - main process                                    *
      *   Calls     - PAY    format fields 53,56 and 57.              *
      *             - RECV   format fields 53,56 and 57.              *
      *****************************************************************
      *
     C           FMTB      BEGSR
      *
      **  Format fields 53, 56 and 57 via RECV OR PAY  S/R.
      **  If the loans or deposit indicator (MGLORD) is D the deal is
      **  a deposit and processing is via the 'PAY' subroutine.
      **  If MGLORD is L the deal is a loan and processing is via
      **  the 'RECV' subroutine.
      *
     C           MGLORD    IFEQ 'D'
     C                     EXSR PAY
     C                     END
      *
     C           MGLORD    IFEQ 'L'
     C                     EXSR RECV
     C                     END
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   CODE - Calculate codeword.                                  *
      *   Called by - FMTA - Format message detail Seq A              *
      *   Calls       PAYE - Pay side field 57 (KNOWN or UNKNOWN)     *
      *****************************************************************
      *
     C           CODE      BEGSR
      *
     C                     MOVE *BLANKS   PRNOUT  4
     C                     MOVE *BLANKS   CODEWD
     C                     MOVEL*BLANKS   ##CWRD                          CSW096
     C**********           MOVEL*BLANKS   INT32H  1                       232540              233056
     C*
     C**  Determine the state of the pay side of the transaction
     C*
     C                     EXSR PAYE
      *
      **  pay field 57 & rec our-nostro are BOTH not blank
      *
     C           PAY57     IFNE *BLANK
     C           MGRONS    ANDNE*BLANK
     C                     MOVE 'BOTH'    PRNOST  4
     C                     END
      *
      **  pay field 57 & rec our-nostro; Both blank/One blank
      *
     C           PAY57     IFEQ *BLANK
     C           MGRONS    OREQ *BLANK
     C                     MOVE 'B/O '    PRNOST
     C                     END
      *
      ** Last Confirmation sequence Value.
      *
     C           MGLSWC    IFEQ 0
      *
      ** Check the rollover deal number for being zero.
      *
     C           MGROTN    IFEQ 0
     C                     MOVEL'NEW'     CWRD
     C                     ELSE
      *
      ** For the rollover deal number being non-zero; check if the
      ** rollover deal amount is GT LT or EQ to the principal amount.
      *
     C           S01434    IFNE 'Y'                                       077898
     C*                                                                                       233003
     C           CSW205    IFNE 'Y'                                                           233003
     C*                                                                                       233003
     C           MGROTA    IFGT MGPCPL
     C                     MOVEL'ROLDEC'  CWRD
     C                     END
      *
      *
     C           MGROTA    IFLT MGPCPL
     C                     MOVEL'ROLSAMIN'CWRD
     C                     END
      *
     C           MGROTA    IFEQ MGPCPL
     C                     MOVEL'ROLSAM'  CWRD
     C                     END
      **  If S01434 is off and SWIFT2005 is on, interest should be included in                233003
      **  the amount comparison.                                                              233003
     C                     ELSE                                                               233003
     C*                                                                                       233056
     C           MGROTA    IFEQ MGPCPL                                                        233056
     C                     MOVEL'ROLSAM'  CWRD                                                233056
     C                     ELSE                                                               233056
     C*                                                                                       233003
     C           MGROTA    ADD  MGTTLI    WKPCPL                                              233003
     C           WKPCPL    IFLT MGPCPL                                                        233003
     C                     MOVEL'ROLINCIN'CWRD                                                233003
     C                     END                                                                233003
     C*                                                                                       233003
     C           WKPCPL    IFEQ MGPCPL                                                        233003
     C                     MOVEL'ROLSAMIN'CWRD                                                233003
     C                     END                                                                233003
     C*                                                                                       233003
     C           WKPCPL    IFGT MGPCPL                                                        233003
     C                     MOVEL'ROLDECIN'CWRD                                                233003
     C                     END                                                                233003
     C                     ENDIF                                                              233056
     C*                                                                                       233003
     C                     ENDIF                                                              233003
     C*                                                                   077898
     C                     ELSE                                           077898
      ***********                                                   CSW200186144
      **If*Swift*2000*Changes*are*in*effect*************************CSW200186144
      ***********                                                   CSW200186144
     C***********CSW200    IFEQ 'Y'                                 CSW200186144
     C***********          MOVE 'N'       W0XINT  1                 CSW200186144
      ***********                                                   CSW200186144
      **If*interest*is*paid*separately*and*interest*settlement******CSW200186144
      **method*is*entered*******************************************CSW200186144
      ***********                                                   CSW200186144
     C***********MGIPDS    IFEQ 'Y'                                 CSW200186144
     C***********MGIMET    ANDNE*BLANKS                             CSW200186144
      ***********                                                   CSW200186144
     C***********MGLORD    IFEQ 'L'                                 CSW200186144
      ***********                                                   CSW200186144
      **exclude*interest*if*receive*account*is*different************CSW200186144
      ***********                                                   CSW200186144
     C***********          MOVE MGRSTM    W0RSTM  2                 CSW200186144
     C***********MGIMET    IFNE W0RSTM                              CSW200186144
     C***********MGINSA    ORNE MGRONS                              CSW200186144
     C***********          MOVE 'Y'       W0XINT                    CSW200186144
     C***********          ENDIF                                    CSW200186144
      ***********                                                   CSW200186144
     C***********          ELSE                                     CSW200186144
      ***********                                                   CSW200186144
     C***********MGINOS    IFEQ *BLANKS                             CSW200186144
     C***********          MOVELMGAWBN    MGINOS                    CSW200186144
     C***********          ENDIF                                    CSW200186144
      ***********                                                   CSW200186144
      **exclude*interest*if*payment*account*is*different************CSW200186144
      ***********                                                   CSW200186144
     C***********          MOVE MGPSTM    W0PSTM  2                 CSW200186144
     C***********MGIMET    IFNE W0PSTM                              CSW200186144
     C***********MGINSA    ORNE MGPONS                              CSW200186144
     C***********MGINOS    ORNE MGAWBN                              CSW200186144
     C***********          MOVE 'Y'       W0XINT                    CSW200186144
     C***********          ENDIF                                    CSW200186144
      ***********                                                   CSW200186144
     C***********          ENDIF                                    CSW200186144
      ***********                                                   CSW200186144
     C***********          ENDIF                                    CSW200186144
      ***********                                                   CSW200186144
     C***********          ENDIF                                    CSW200186144
      *                                                                   CSW205
      * If Swift 2005 Changes are in effect                               CSW205
     C           CSW205    IFEQ 'Y'                                       CSW205
     C                     MOVE 'N'       W0XINT  1                       CSW205
      *                                                                   CSW205
      * If interest is paid separately and interest settlement            CSW205
      * method is entered                                                 CSW205
     C           MGIPDS    IFEQ 'Y'                                       CSW205
     C********** MGIMET    ANDNE*BLANKS                                                CSW205 260490
      *****************************************************************                CSW205 260490
     C********** MGLORD    IFEQ 'L'                                                    CSW205 260490
      *****************************************************************                CSW205 260490
      **exclude*interest*if*receive*account*is*different***************                CSW205 260490
     C**********           MOVE MGRSTM    W0RSTM  2                                    CSW205 260490
     C********** MGIMET    IFNE W0RSTM                                                 CSW205 260490
     C********** MGINSA    ORNE MGRONS                                                 CSW205 260490
      *                                                                                       260490
      ** Exclude interest if Rollover is Increase Principle                                   260490
     C           MGROTA    IFLT MGPCPL                                                        260490
     C                     MOVE 'Y'       W0XINT                          CSW205
     C                     ENDIF                                          CSW205
      *                                                                   CSW205
     C**********           ELSE                                                        CSW205 260490
      *****************************************************************                CSW205 260490
     C********** MGINOS    IFEQ *BLANKS                                                CSW205 260490
     C**********           MOVELMGAWBN    MGINOS                                       CSW205 260490
     C**********           ENDIF                                                       CSW205 260490
      *****************************************************************                CSW205 260490
      **exclude*interest*if*payment*account*is*different***************                CSW205 260490
     C**********           MOVE MGPSTM    W0PSTM  2                                    CSW205 260490
     C********** MGIMET    IFNE W0PSTM                                                 CSW205 260490
     C********** MGINSA    ORNE MGPONS                                                 CSW205 260490
     C********** MGINOS    ORNE MGAWBN                                                 CSW205 260490
     C**********           MOVE 'Y'       W0XINT                                       CSW205 260490
     C**********           ENDIF                                                       CSW205 260490
     C**********           ENDIF                                                       CSW205 260490
     C                     ENDIF                                          CSW205
     C                     ENDIF                                          CSW205
      *                                                                   CSW200
     C***********MGIPDS    IFEQ 'Y'                                       077898              233400
     C***********CSW205    ANDNE'Y'                                       CSW205              233400
     C           CSW205    IFNE 'Y'                                                           233400
     C           W0XINT    OREQ 'Y'                                       CSW205
     C           CSW205    ANDEQ'Y'                                       CSW205
     C***********CSW200    OREQ 'Y'                                 186144CSW205
     C***********CSW200    ANDNE'Y'                                 CSW200186144
     C***********W0XINT    OREQ 'Y'                                 CSW200186144
     C***********CSW200    ANDEQ'Y'                                 CSW200186144
      *                                                                   CSW200
     C           MGROTA    IFGT MGPCPL                                    077898
     C                     MOVEL'ROLDEC'  CWRD                            077898
     C                     END                                            077898
     C*                                                                   077898
     C           MGROTA    IFLT MGPCPL                                    077898
     C                     MOVEL'ROLINC'  CWRD                            077898
     C                     END                                            077898
     C*                                                                   077898
     C           MGROTA    IFEQ MGPCPL                                    077898
     C                     MOVEL'ROLSAM'  CWRD                            077898
     C                     END                                            077898
     C*                                                                   077898
     C                     ELSE                                           077898
     C***********MGROTA    IFGT MGPCPL                              077898079771
     C***********          MOVEL'ROLDEC'  CWRD                      077898079771
     C***********          END                                      077898079771
     C*                                                                   077898
     C           MGROTA    IFEQ MGPCPL                                    077898
     C                     MOVEL'ROLSAM'  CWRD                            077898
     C***********                                                         232540              233056
     C***********CSW205    IFEQ 'Y'                                       232540              233056
     C***********MGTTLI    ANDNE0                                         232540              233056
     C***********          MOVE 'Y'       INT32H                          232540              233056
     C***********          ENDIF                                          232540              233056
     C***********                                                         232540              233056
     C***********          END                                      077898079771
     C                     ELSE                                           079771
     C*                                                                   077898
     C           MGROTA    ADD  MGTTLI    WKPCPL                          077898
     C           WKPCPL    IFLT MGPCPL                                    077898
     C                     MOVEL'ROLINCIN'CWRD                            077898
     C                     END                                            077898
     C*                                                                   077898
     C***********WKPCPL    IFGE MGPCPL                              077898079771
     C           WKPCPL    IFEQ MGPCPL                                    079771
     C                     MOVEL'ROLSAMIN'CWRD                            077898
     C                     END                                            077898
     C*                                                                   079771
     C           WKPCPL    IFGT MGPCPL                                    079771
     C                     MOVEL'ROLDECIN'CWRD                            079771
     C                     END                                            079771
     C*                                                                   079771
     C                     END                                            079771
     C                     END                                            077898
     C                     END                                            077898
      *                                                                   CSW096
     C           CSW096    IFEQ 'Y'                                       CSW096
     C           *LIKE     DEFN CWRD      ##CWRD                          CSW096
     C                     MOVELCWRD      ##CWRD                          CSW096
     C                     MOVEL'ROLLOVER'CWRD                            CSW096
     C                     ELSE                                           CSW096
      *                                                                   CSW096
     C                     ENDIF                           - CSW096='Y'   CSW096
      *
      ** Set up the related reference.
      *
     C                     MOVEA*BLANKS   @WRK
     C                     MOVEAMGMODI    @WRK
     C                     MOVEAMGTNUM    @WRK,3
     C                     MOVE MGLSWC    MLSWC   30
     C                     MOVE MLSWC     MSWC    3
      *
     C           ' '       LOKUP@WRK,Z                   31
     C                     MOVEAMSWC      @WRK,Z
     C                     MOVEA@WRK      @TRNB  16
     C                     END
      *
      **  If both our-nostro fields non-blank the 57 fields are Known
      *
     C           PRNOST    IFEQ 'BOTH'
     C                     MOVE 'K'       F57U
      *
      **  Both or one our-nostro field(s) are blank, Unknown
      *
     C                     ELSE
     C                     MOVE 'U'       F57U
     C                     END
      *
      **  Use the select table.
      *
     C                     ELSE
      *
     C**  The two table TABSLT and TABRST are used to create the
     C**  CONDITION and RESULT, as shown in the table below.
     C**  The position of the CONDITION on TABSLT, is the same
     C**  equivalent position for the RESULT on TABRST. Hence when
     C**  a LOKUP is performed on TABSLT, using the CONDITION as the
     C**  key, the equivalent positional RESULT value is placed
     C**  in TABRST.
     C**
     C**  To retrieve the first 3 fields for the CONDITION, the
     C**  last confrimation created for the Transaction number
     C**  is accessed.
     C**  <----------------Condition------------------->  <--Result-->
     C**  Status   Old Code  Old F57U  Rec Our-Nostro     Code     F57U
     C**           LF/MGOREFL0         Pay Our-Nostro
     C**  -----------------------------------------------------------------
      **                               Both non-blank     COMPLETE  K
      **                               One or both blank  AMEND     U
      **  SENT     NEW ROL*     U      Both non-blank     COMPLETE  K
      **  SENT     NEW ROL*     U      One or both blank  AMEND     U
      **  SENT     NEW ROL*     K      Both non-blank     AMEND     K
      **  SENT     NEW ROL*     K      One or both blank  AMEND     K
      **  NONREC   NEW          U      Both non-blank     NEW       K
      **  NONREC   NEW          U      One or both blank  NEW       U
      **  NONREC   NEW          K      Both non-blank     NEW       K
      **  NONREC   NEW          K      One or both blank  NEW       U
      **  NONREC   ROLDEC       U      Both non-blank     ROLDEC    K
      **  NONREC   ROLDEC       U      One or both blank  ROLDEC    U
      **  NONREC   ROLDEC       K      Both non-blank     ROLDEC    K
      **  NONREC   ROLDEC       K      One or both blank  ROLDEC    K
      **  NONREC   ROLSAM       U      Both non-blank     ROLSAM    K
      **  NONREC   ROLSAM       U      One or both blank  ROLSAM    U
      **  NONREC   ROLSAM       K      Both non-blank     ROLSAM    K
      **  NONREC   ROLSAM       K      One or both blank  ROLSAM    K
      **  NONREC   ROLSAMIN     U      Both non-blank     ROLSAMIN  K
      **  NONREC   ROLSAMIN     U      One or both blank  ROLSAMIN  U
      **  NONREC   ROLSAMIN     K      Both non-blank     ROLSAMIN  K
      **  NONREC   ROLSAMIN     K      One or both blank  ROLSAMIN  K
      **  SENT     AMEND        U      Both non-blank     COMPLETE  K
      **  SENT     AMEND        U      One or both blank  AMEND     U
      **  SENT     AMEND        K      Both non-blank     AMEND     K
      **  SENT     AMEND        K      One or both blank  AMEND     K
      **  SENT     COMPLETE     K      Both non-blank     AMEND     K
      **  SENT     COMPLETE     K      One or both blank  AMEND     K
      **  NONREC   AMEND        U      Both non-blank     COMPLETE  K
      **  NONREC   AMEND        U      One or both blank  AMEND     U
      **  NONREC   AMEND        K      Both non-blank     AMEND     K
      **  NONREC   AMEND        K      One or both blank  AMEND     K
      **  NONREC   COMPLETE     K      Both non-blank     COMPLETE  K
      **  NONREC   COMPLETE     K      One or both blank  AMEND     U
      **  NONREC   ROLDECIN     U      Both non-blank     ROLDECIN  K     085625
      **  NONREC   ROLDECIN     U      One or both blank  ROLDECIN  U     085625
      **  NONREC   ROLDECIN     K      Both non-blank     ROLDECIN  K     085625
      **  NONREC   ROLDECIN     K      One or both blank  ROLDECIN  K     085625
      **  NONREC   ROLINC       U      Both non-blank     ROLINC    K     085625
      **  NONREC   ROLINC       U      One or both blank  ROLINC    U     085625
      **  NONREC   ROLINC       K      Both non-blank     ROLINC    K     085625
      **  NONREC   ROLINC       K      One or both blank  ROLINC    K     085625
      **  NONREC   ROLINCIN     U      Both non-blank     ROLINCIN  K     085625
      **  NONREC   ROLINCIN     U      One or both blank  ROLINCIN  U     085625
      **  NONREC   ROLINCIN     K      Both non-blank     ROLINCIN  K     085625
      **  NONREC   ROLINCIN     K      One or both blank  ROLINCIN  K     085625
      *
      *                                                                   CSW096
      **  For SWIFT Changes 1996, the two new tables TABS96 and           CSW096
      **  TABR96 are used to create the CONDITION and RESULT              CSW096
      **  as shown in the table below.  The position of the               CSW096
      **  CONDITION on TABS96, is the same equivalent position            CSW096
      **  for the RESULT on TABR96. Hence when a LOKUP is performed       CSW096
      **  on TABS96, using the CONDITION as the key, the equivalent       CSW096
      **  positional RESULT value is placed in TABR96.                    CSW096
      **                                                                  CSW096
      **  To retrieve the first 3 fields for the CONDITION, the           CSW096
      **  last confrimation created for the Transaction number            CSW096
      **  is accessed.                                                    CSW096
      **  <----------------Condition------------------->  <--Result-->    CSW096
      **  Status   Old Code  Old F57U  Rec Our-Nostro     Code     F57U   CSW096
      **           LF/MGOREFL0         Pay Our-Nostro                     CSW096
      **  ----------------------------------------------------------------CSW096
      **                               Both non-blank     AMEND     K     CSW096
      **                               One or both blank  AMEND     U     CSW096
      **  NONREC   NEW          U      Both non-blank     NEW       K     CSW096
      **  NONREC   NEW          U      One or both blank  NEW       U     CSW096
      **  NONREC   NEW          K      Both non-blank     NEW       K     CSW096
      **  NONREC   NEW          K      One or both blank  NEW       U     CSW096
      **  SENT     NEW          U      Both non-blank     AMEND     K     CSW096
      **  SENT     NEW          U      One or both blank  AMEND     U     CSW096
      **  SENT     NEW          K      Both non-blank     AMEND     K     CSW096
      **  SENT     NEW          K      One or both blank  AMEND     K     CSW096
      **  NONREC   AMEND        U      Both non-blank     AMEND     K     CSW096
      **  NONREC   AMEND        U      One or both blank  AMEND     U     CSW096
      **  NONREC   AMEND        K      Both non-blank     AMEND     K     CSW096
      **  NONREC   AMEND        K      One or both blank  AMEND     K     CSW096
      **  SENT     AMEND        U      Both non-blank     AMEND     K     CSW096
      **  SENT     AMEND        U      One or both blank  AMEND     U     CSW096
      **  SENT     AMEND        K      Both non-blank     AMEND     K     CSW096
      **  SENT     AMEND        K      One or both blank  AMEND     K     CSW096
      **  NONREC   ROLLOVER     U      Both non-blank     ROLLOVER  K     CSW096
      **  NONREC   ROLLOVER     U      One or both blank  ROLLOVER  U     CSW096
      **  NONREC   ROLLOVER     K      Both non-blank     ROLLOVER  K     CSW096
      **  NONREC   ROLLOVER     K      One or both blank  ROLLOVER  K     CSW096
      **  SENT     ROLLOVER     U      Both non-blank     AMEND     K     CSW096
      **  SENT     ROLLOVER     U      One or both blank  AMEND     U     CSW096
      **  SENT     ROLLOVER     K      Both non-blank     AMEND     K     CSW096
      **  SENT     ROLLOVER     K      One or both blank  AMEND     K     CSW096
      *                                                                   CSW096
     C                     MOVE *BLANKS   SEARCH
      *
      **  Retrieve last confirmation for this transaction.
      **  (@TRNB formatted in field 21.)
      *
     C                     MOVEA*BLANKS   @WRK
     C                     MOVEAMGMODI    @WRK
     C                     MOVEAMGTNUM    @WRK,3
     C                     MOVE MGLSWC    MLSWC   30
     C                     MOVE MLSWC     MSWC    3
      *
     C           ' '       LOKUP@WRK,Z                   31
     C                     MOVEAMSWC      @WRK,Z
     C                     MOVEA@WRK      @TRNB  16
      *
     C           @TRNB     CHAINMGREFL0              11
      *
      **  If a message found build the selection key
      *
     C           *IN11     IFEQ '0'
      *                                                                   CSW096
     C           CSW096    IFEQ 'Y'                                       CSW096
     C           MLSCC     ANDEQ'ROLLOVER'                                CSW096
     C           CSW200    OREQ 'Y'                                       CSW200
     C           MGROTN    ANDNE0                                         CSW200
      *                                                                   CSW096
      ** For the rollover deal number being non-zero; check if the        CSW096
      ** rollover deal amount is GT LT or EQ to the principal amount.     CSW096
      *                                                                   CSW096
     C           S01434    IFNE 'Y'                                       CSW096
     C*                                                                                       233003
     C           CSW205    IFNE 'Y'                                                           233003
     C*                                                                                       233003
     C           MGROTA    IFGT MGPCPL                                    CSW096
     C                     MOVEL'ROLDEC'  CWRD                            CSW096
     C                     END                                            CSW096
      *                                                                   CSW096
      *                                                                   CSW096
     C           MGROTA    IFLT MGPCPL                                    CSW096
     C                     MOVEL'ROLSAMIN'CWRD                            CSW096
     C                     END                                            CSW096
      *                                                                   CSW096
     C           MGROTA    IFEQ MGPCPL                                    CSW096
     C                     MOVEL'ROLSAM'  CWRD                            CSW096
     C                     END                                            CSW096
      **  If S01434 is off and SWIFT2005 is on, interest should be included in                233003
      **  the amount comparison.                                                              233003
     C                     ELSE                                                               233003
     C*                                                                                       233056
     C           MGROTA    IFEQ MGPCPL                                                        233056
     C                     MOVEL'ROLSAM'  CWRD                                                233056
     C                     ELSE                                                               233056
     C*                                                                                       233003
     C*                                                                                       233003
     C           MGROTA    ADD  MGTTLI    WKPCPL                                              233003
     C           WKPCPL    IFLT MGPCPL                                                        233003
     C                     MOVEL'ROLINCIN'CWRD                                                233003
     C                     END                                                                233003
     C*                                                                                       233003
     C           WKPCPL    IFEQ MGPCPL                                                        233003
     C                     MOVEL'ROLSAMIN'CWRD                                                233003
     C                     END                                                                233003
     C*                                                                                       233003
     C           WKPCPL    IFGT MGPCPL                                                        233003
     C                     MOVEL'ROLDECIN'CWRD                                                233003
     C                     END                                                                233003
     C*                                                                                       233056
     C                     ENDIF                                                              233056
     C*                                                                                       233003
     C                     ENDIF                                                              233003
     C*                                                                   CSW096
     C                     ELSE                                           CSW096
      ***********                                                   CSW200186144
     C***********CSW200    IFEQ 'Y'                                 CSW200186144
     C***********          MOVE 'N'       W0XINT  1                 CSW200186144
      ***********                                                   CSW200186144
      **If*interest*is*paid*separately*and*interest*settlement******CSW200186144
      **method*is*entered*******************************************CSW200186144
      ***********                                                   CSW200186144
     C***********MGIPDS    IFEQ 'Y'                                 CSW200186144
     C***********MGIMET    ANDNE*BLANKS                             CSW200186144
      ***********                                                   CSW200186144
     C***********MGLORD    IFEQ 'L'                                 CSW200186144
      ***********                                                   CSW200186144
      **exclude*interest*if*receive*account*is*different************CSW200186144
      ***********                                                   CSW200186144
     C***********          MOVE MGRSTM    W0RSTM  2                 CSW200186144
     C***********MGIMET    IFNE W0RSTM                              CSW200186144
     C***********MGINSA    ORNE MGRONS                              CSW200186144
     C***********          MOVE 'Y'       W0XINT                    CSW200186144
     C***********          ENDIF                                    CSW200186144
      ***********                                                   CSW200186144
     C***********          ELSE                                     CSW200186144
      ***********                                                   CSW200186144
     C***********MGINOS    IFEQ *BLANKS                             CSW200186144
     C***********          MOVELMGINOS    MGAWBN                    CSW200186144
     C***********          ENDIF                                    CSW200186144
      ***********                                                   CSW200186144
      **exclude*interest*if*payment*account*is*different************CSW200186144
      ***********                                                   CSW200186144
     C***********          MOVE MGPSTM    W0PSTM  2                 CSW200186144
     C***********MGIMET    IFNE W0PSTM                              CSW200186144
     C***********MGINSA    ORNE MGPONS                              CSW200186144
     C***********MGINOS    ORNE MGAWBN                              CSW200186144
     C***********          MOVE 'Y'       W0XINT                    CSW200186144
     C***********          ENDIF                                    CSW200186144
      ***********                                                   CSW200186144
     C***********          ENDIF                                    CSW200186144
      ***********                                                   CSW200186144
     C***********          ENDIF                                    CSW200186144
      ***********                                                   CSW200186144
     C***********          ENDIF                                    CSW200186144
      *                                                                   CSW205
      * If Swift 2005 Changes are in effect                               CSW205
     C           CSW205    IFEQ 'Y'                                       CSW205
     C                     MOVE 'N'       W0XINT  1                       CSW205
      *                                                                   CSW205
      * If interest is paid separately and interest settlement            CSW205
      * method is entered                                                 CSW205
     C           MGIPDS    IFEQ 'Y'                                       CSW205
     C*********  MGIMET    ANDNE*BLANKS                                                CSW205 260490
      *****************************************************************                CSW205 260490
     C********** MGLORD    IFEQ 'L'                                                    CSW205 260490
      *****************************************************************                CSW205 260490
      **exclude*interest*if*receive*account*is*different***************                CSW205 260490
     C**********           MOVE MGRSTM    W0RSTM  2                                    CSW205 260490
     C********** MGIMET    IFNE W0RSTM                                                 CSW205 260490
     C********** MGINSA    ORNE MGRONS                                                 CSW205 260490
      *                                                                                       260490
      ** Exclude interest if Rollover is Increase Principle                                   260490
     C           MGROTA    IFLT MGPCPL                                                        260490
     C                     MOVE 'Y'       W0XINT                          CSW205
     C                     ENDIF                                          CSW205
      *                                                                   CSW205
     C**********           ELSE                                                        CSW205 260490
      *****************************************************************                CSW205 260490
     C********** MGINOS    IFEQ *BLANKS                                                CSW205 260490
     C**********           MOVELMGAWBN    MGINOS                                       CSW205 260490
     C**********           ENDIF                                                       CSW205 260490
      *****************************************************************                CSW205 260490
      **exclude*interest*if*payment*account*is*different***************                CSW205 260490
     C**********           MOVE MGPSTM    W0PSTM  2                                    CSW205 260490
     C********** MGIMET    IFNE W0PSTM                                                 CSW205 260490
     C********** MGINSA    ORNE MGPONS                                                 CSW205 260490
     C********** MGINOS    ORNE MGAWBN                                                 CSW205 260490
     C**********           MOVE 'Y'       W0XINT                                       CSW205 260490
     C**********           ENDIF                                                       CSW205 260490
     C**********           ENDIF                                                       CSW205 260490
     C                     ENDIF                                          CSW205
     C                     ENDIF                                          CSW205
      *                                                                   CSW200
     C***********MGIPDS    IFEQ 'Y'                                       CSW096              233400
     C***********CSW205    ANDNE'Y'                                       CSW205              233400
     C           CSW205    IFNE 'Y'                                                           233400
     C           W0XINT    OREQ 'Y'                                       CSW205
     C           CSW205    ANDEQ'Y'                                       CSW205
     C***********CSW200    OREQ 'Y'                                 186144CSW205
     C***********CSW200    ANDNE'Y'                                 CSW200186144
     C***********W0XINT    OREQ 'Y'                                 CSW200186144
     C***********CSW200    ANDEQ'Y'                                 CSW200186144
      *                                                                   CSW200
     C           MGROTA    IFGT MGPCPL                                    CSW096
     C                     MOVEL'ROLDEC'  CWRD                            CSW096
     C                     END                                            CSW096
     C*                                                                   CSW096
     C           MGROTA    IFLT MGPCPL                                    CSW096
     C                     MOVEL'ROLINC'  CWRD                            CSW096
     C                     END                                            CSW096
     C*                                                                   CSW096
     C           MGROTA    IFEQ MGPCPL                                    CSW096
     C                     MOVEL'ROLSAM'  CWRD                            CSW096
     C                     END                                            CSW096
     C*                                                                   CSW096
     C                     ELSE                                           CSW096
     C*                                                                   CSW096
     C           MGROTA    IFEQ MGPCPL                                    CSW096
     C                     MOVEL'ROLSAM'  CWRD                            CSW096
     C***********                                                         232540              233056
     C***********CSW205    IFEQ 'Y'                                       232540              233056
     C***********MGTTLI    ANDNE0                                         232540              233056
     C***********          MOVE 'Y'       INT32H                          232540              233056
     C***********          ENDIF                                          232540              233056
     C***********                                                         232540              233056
     C                     ELSE                                           CSW096
     C*                                                                   CSW096
     C           MGROTA    ADD  MGTTLI    WKPCPL                          CSW096
     C           WKPCPL    IFLT MGPCPL                                    CSW096
     C                     MOVEL'ROLINCIN'CWRD                            CSW096
     C                     END                                            CSW096
     C*                                                                   CSW096
     C           WKPCPL    IFEQ MGPCPL                                    CSW096
     C                     MOVEL'ROLSAMIN'CWRD                            CSW096
     C                     END                                            CSW096
     C*                                                                   CSW096
     C           WKPCPL    IFGT MGPCPL                                    CSW096
     C                     MOVEL'ROLDECIN'CWRD                            CSW096
     C                     END                                            CSW096
     C*                                                                   CSW096
     C                     END                                            CSW096
     C                     END                                            CSW096
     C                     END                                            CSW096
      *                                                                   CSW096
     C                     MOVELCWRD      ##CWRD                          CSW096
     C                     MOVEL'ROLLOVER'CWRD                            CSW096
      *                                                                   CSW096
     C                     ENDIF                                          CSW096
      *
     C           MMGSG     IFEQ '2'
     C           MMGSG     OREQ '3'
     C                     MOVEL'SENT'    @MGST
     C                     ELSE
     C                     MOVE 'NONREC'  @MGST
     C                     END
      *
     C                     MOVELMLSCC     @LSCC
     C                     MOVE MF57U     @OF57
     C                     END
     C                     MOVELPRNOST    @NOST
      *
      **  Use select table to point to the result table
      *
     C           CSW096    IFEQ 'Y'                                       CSW096
     C           SEARCH    LOKUPTABS96    TABR96         24               CSW096
     C                     ELSE                                           CSW096
     C           SEARCH    LOKUPTABSLT    TABRST         24
     C                     ENDIF                                          CSW096
      *
      **  Key matches select table, outputs the corresponding
      **  result table value to 'TABRST'
      *
     C           *IN24     IFEQ '1'
      *                                                                   CSW096
     C           CSW096    IFEQ 'Y'                                       CSW096
     C                     MOVE TABR96    CODEWD                          CSW096
     C                     ELSE                                           CSW096
     C                     MOVE TABRST    CODEWD
     C                     ENDIF                                          CSW096
      *                                                                   CSW096
     C                     ELSE                                           E29588
     C                     MOVEL'AMEND   'CWRD                            E29588
      **  If both our-nostro fields non-blank the 57 fields are Known     E29588
      *                                                                   E29588
     C           PRNOST    IFEQ 'BOTH'                                    E29588
     C                     MOVE 'K'       F57U                            E29588
      *                                                                   E29588
      **  Both or one our-nostro field(s) are blank, Unknown              E29588
     C                     ELSE                                           E29588
     C                     MOVE 'U'       F57U                            E29588
     C                     END                                            E29588
     C                     END
      *
     C                     END
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   PAYE - Pay side field 57 (KNOWN or UNKNOWN)                 *
      *   Called by   CODE  Calculate codeword                        *
      *   Calls       -                                               *
      *****************************************************************
      *
     C           PAYE      BEGSR
      *
     C                     MOVE *BLANKS   PAY57   5
      *
      **  Known when settlement via nostro (MGAWBN is blank)
      *
     C           MGPSTM    IFEQ 02
     C           MGPSTM    OREQ 12
     C                     MOVE 'KNOWN'   PAY57
     C                     END
      *
      **  Known when settlement internal (branch internal customer)
      *
     C                     MOVE MGPSTM    @STM    2
     C           @STM      LOKUPTABINT                   23
     C           *IN23     IFEQ '1'
     C                     MOVE 'KNOWN'   PAY57
     C                     END
      *
      **  Known when settlement via nostro and MGAWBN entered
      *
     C           MGPSTM    IFEQ 01
     C           MGPSTM    OREQ 07
     C           MGPSTM    OREQ 08
     C           MGAWBN    IFNE *BLANKS
     C           MGAWBN    OREQ *BLANKS                                   088043
     C           AWBA6     ANDEQ'DIRECT'                                  088043
     C                     MOVE 'KNOWN'   PAY57
     C                     END
     C                     END
      *
      **  Unknown when settlement internal
      *
     C           MGPSTM    IFEQ 00
     C                     MOVE *BLANKS   PAY57
     C                     END
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   DATES - Format Date fields.                                 *
      *   Called by - FMTA - Format message detail Seq A              *
      *****************************************************************
      *
     C           DATES     BEGSR
      *
      **  Field :30:  Date contract agreed/amended
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE MGTDAT    ZMDAY
      *
      **  Convert Midas date to SWIFT date format
      *
     C                     CALL 'ZM0060'               15
     C                     PARM           ZMDAY   50
     C                     PARM           ZSDATE  6
      *
      **  Call ended in error. (Program not found.)
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '010'     DBASE              * * * * * * *
     C                     MOVEL'       ' DBKEY              * DBERR 010 *
     C                     MOVEL'ZM0060'  DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
     C                     MOVE ':30: '   MTAG
     C                     MOVELZSDATE    MFLD
      *
      **  Field :31C:  Maturity Date of deposit.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE MGMDAT    ZMDAY
      *
      **  Convert Midas date to SWIFT date format
      *
     C                     CALL 'ZM0060'               15
     C                     PARM           ZMDAY   50
     C                     PARM           ZSDATE  6
      *
     C                     MOVE ':31C:'   MTAG
     C                     MOVELZSDATE    MFLD
      *
      *
      **  Field :32:  Value Date of Deposit, Currency, Contract Amount.
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE MGVDAT    ZMDAY
      *
      **  Convert Midas date to SWIFT date format
     C                     CALL 'ZM0060'               15
     C                     PARM           ZMDAY   50
     C                     PARM           ZSDATE  6
      *
      **  Format currency code and contract amount.
      *
     C                     MOVE MGCCY     ZCCY
     C                     MOVE MGPCPL    ZAMNT
     C                     CALL 'ZM0040'
     C                     PARM           ZAMNT  130
     C                     PARM           ZCCY    3
     C                     PARM           ZSAMNT 15
     C                     PARM           ZSCCY   3
     C                     PARM           ZERR    1
     C                     PARM           ZSWDPC  1                                           222373
      *
      ** If the deal is a placing (a loan) MGLORD will be L and
      ** the tag for field 32 is 'P' else the tag is 'R'.
      *
     C           MGLORD    IFEQ 'L'
     C                     MOVE ':32P:'   MTAG
     C                     ELSE
     C                     MOVE ':32R:'   MTAG
     C                     END
      *
      ** Error - indicate erroneous fields;
      *
     C           ZERR      IFEQ '1'
     C                     MOVE 'Y'       @ERR
     C                     MOVELERR3N     MFLD
     C                     MOVELMSGA,5    MERR
      *
     C                     ELSE
     C                     MOVELFLD3N     MFLD
     C                     END
      *
      ** Field 33 - Value Date of Change, Currency, Principal Amount.
      *
      ** Rollover deal number is non-zero.
      *
      ** Code words to include Field 33 are - ROLDEC, ROLINC, ROLINCIN,   084454
      **      ROLDECIN, ROLSAM and ROLSAMIN.                              084454
      *                                                                   084454
     C           CWRD      IFEQ 'ROLDEC'                                  084454
     C           CWRD      OREQ 'ROLINC'                                  084454
     C           CWRD      OREQ 'ROLINCIN'                                084454
     C           CWRD      OREQ 'ROLDECIN'                                084454
     C           CWRD      OREQ 'ROLLOVER'                                CSW096
     C           ##CWRD    ANDEQ'ROLDEC'                                  CSW096
     C           CWRD      OREQ 'ROLLOVER'                                CSW096
     C           ##CWRD    ANDEQ'ROLINC'                                  CSW096
     C           CWRD      OREQ 'ROLLOVER'                                CSW096
     C           ##CWRD    ANDEQ'ROLDECIN'                                CSW096
     C           CWRD      OREQ 'ROLLOVER'                                CSW096
     C           ##CWRD    ANDEQ'ROLINCIN'                                CSW096
      *                                                                   084454
     C           MGROTN    IFNE 0
     C***********CWRD      ANDEQ'ROLDEC'                                  084454
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE MGVDAT    ZMDAY
      *
     C                     CALL 'ZM0060'
     C                     PARM           ZMDAY   50
     C                     PARM           ZSDATE  6
      *
      **  Format purchase currency and rollover amount.
      *
     C                     MOVE MGCCY     ZCCY
     C           CWRD      IFEQ 'ROLDEC'                                  085623
     C           ##CWRD    OREQ 'ROLDEC'                                  CSW096
     C           MGROTA    SUB  MGPCPL    ZAMNT
     C                     END                                            085623
     C           CWRD      IFEQ 'ROLINC'                                  085623
     C           ##CWRD    OREQ 'ROLINC'                                  CSW096
     C           MGPCPL    SUB  MGROTA    ZAMNT                           085623
     C                     END                                            085623
     C           CWRD      IFEQ 'ROLDECIN'                                085623
     C           ##CWRD    OREQ 'ROLDECIN'                                CSW096
     C           WKPCPL    SUB  MGPCPL    ZAMNT                           085623
     C                     END                                            085623
     C           CWRD      IFEQ 'ROLINCIN'                                085623
     C           ##CWRD    OREQ 'ROLINCIN'                                CSW096
     C           MGPCPL    SUB  WKPCPL    ZAMNT                           085623
     C                     END                                            085623
     C                     CALL 'ZM0040'
     C                     PARM           ZAMNT  130
     C                     PARM           ZCCY    3
     C                     PARM           ZSAMNT 15
     C                     PARM           ZSCCY   3
     C                     PARM           ZERR    1
     C                     PARM           ZSWDPC                                              222373
      *
      ** Deal type is a loan
      *
     C           MGLORD    IFEQ 'L'
     C                     MOVE ':33R:'   MTAG
     C                     ELSE
      *
      ** Deal type is a deposit
      *
     C                     MOVE ':33P:'   MTAG
     C                     END
     C*                                                                   087078
     C**  Line 33 should have :33P: on rollover on the conditions         087078
     C**  given below:                                                    087078
     C*                                                                   087078
     C           MGTTYP    IFEQ 'IP'                                      087078
     C           CWRD      ANDEQ'ROLINC'                                  087078
     C*                                                                   087078
     C           MGTTYP    OREQ 'IP'                                      087078
     C           CWRD      ANDEQ'ROLINCIN'                                087078
     C*                                                                   087078
     C           MGTTYP    OREQ 'IT'                                      087078
     C           CWRD      ANDEQ'ROLDEC'                                  087078
     C*                                                                   087078
     C           MGTTYP    OREQ 'IT'                                      087078
     C           CWRD      ANDEQ'ROLDECIN'                                087078
     C*                                                                   CSW096
     C           MGTTYP    OREQ 'IP'                                      CSW096
     C           ##CWRD    ANDEQ'ROLINC'                                  CSW096
     C*                                                                   CSW096
     C           MGTTYP    OREQ 'IP'                                      CSW096
     C           ##CWRD    ANDEQ'ROLINCIN'                                CSW096
     C*                                                                   CSW096
     C           MGTTYP    OREQ 'IT'                                      CSW096
     C           ##CWRD    ANDEQ'ROLDEC'                                  CSW096
     C*                                                                   CSW096
     C           MGTTYP    OREQ 'IT'                                      CSW096
     C           ##CWRD    ANDEQ'ROLDECIN'                                CSW096
     C*                                                                   087078
     C                     MOVE ':33P:'   MTAG                            087078
     C                     END                                            087078
     C*                                                                   087078
     C**  Line 33 should have :33R: on rollover on the conditions         087078
     C**  given below:                                                    087078
     C*                                                                   087078
     C           MGTTYP    IFEQ 'IP'                                      087078
     C           CWRD      ANDEQ'ROLDEC'                                  087078
     C*                                                                   087078
     C           MGTTYP    OREQ 'IP'                                      087078
     C           CWRD      ANDEQ'ROLDECIN'                                087078
     C*                                                                   087078
     C           MGTTYP    OREQ 'IT'                                      087078
     C           CWRD      ANDEQ'ROLINC'                                  087078
     C*                                                                   087078
     C           MGTTYP    OREQ 'IT'                                      087078
     C           CWRD      ANDEQ'ROLINCIN'                                087078
     C*                                                                   CSW096
     C           MGTTYP    OREQ 'IP'                                      CSW096
     C           ##CWRD    ANDEQ'ROLDEC'                                  CSW096
     C*                                                                   CSW096
     C           MGTTYP    OREQ 'IP'                                      CSW096
     C           ##CWRD    ANDEQ'ROLDECIN'                                CSW096
     C*                                                                   CSW096
     C           MGTTYP    OREQ 'IT'                                      CSW096
     C           ##CWRD    ANDEQ'ROLINC'                                  CSW096
     C*                                                                   CSW096
     C           MGTTYP    OREQ 'IT'                                      CSW096
     C           ##CWRD    ANDEQ'ROLINCIN'                                CSW096
     C*                                                                   087078
     C                     MOVE ':33R:'   MTAG                            087078
     C                     END                                            087078
      *
      ** Error - indicate erroneous fields;
     C           ZERR      IFEQ '1'
     C                     MOVE 'Y'       @ERR
     C                     MOVELERR3N     MFLD
     C                     MOVELMSGA,5    MERR
      *
     C                     ELSE
      *
     C                     MOVELFLD3N     MFLD
     C                     END
     C                     END
      *                                                                   084454
     C                     END                                            084454
      *
      ** Field 34 - Next Interest Date, Currency, Interest Amount.
     C*
     C** If no Next Interest Date use MGMDAT
      *
     C/COPY WNCPYSRC,MG0320C023
     C                     ADD  1         X
     C           X         OCUR MULT
      *                                                                   130581
     C                     MOVE ' '       ASFUID                          130581
      *                                                                   130581
     C           MGMODI    IFEQ 'DL'                                      130581
      *                                                                   109795
      ** If Front-up interest for this deal type, use full interest       109795
      ** amount                                                           109795
      *                                                                   109795
     C                     CALL 'AODLSTR0'                                109795
     C                     PARM '*MSG   ' @RTCD                           109795
     C                     PARM '*KEY   ' @OPTN   7                       109795
     C                     PARM MGTSTP    @AQCD   2                       109795
     C           SDDLST    PARM SDDLST    DSFDY                           109795
      *                                                                   109795
      ***Deal*sub-type*record*not*found*-*Error*********************109795130581
      ** Deal sub-type record not found                                   130581
      *                                                                   109795
     C           @RTCD     IFNE *BLANKS                                   109795
     C********** *LOCK     IN   LDA                                 109795130581
     C**********           MOVE '021'     DBASE         * * * * * * 109795130581
     C**********           MOVELMGTSTP    DBKEY         * DBERR 021*109795130581
     C**********           MOVEL'SDDLSTPD'DBFILE        * * * * * **109795130581
     C**********           OUT  LDA                                 109795130581
     C**********           EXSR *PSSR                               109795130581
     C                     MOVE ' '       ASFUID                          130581
     C                     END                                            109795
     C                     ENDIF                                          130581
      *                                                                   109795
     C           ASFUID    IFEQ 'Y'                                       109795
     C           MGMODI    ANDEQ'DL'                                      130581
     C                     MOVE MGTOTI    ZAMNT                           109795
     C                     ELSE                                           109795
      *                                                                   109795
     C*                                                                   109795
     C** If no Next Interest Date use MGMDAT                              109795
      *                                                                   109795
     C           MGNIDT    IFEQ 0
     C                     MOVE MGMDAT    ZMDAY
      *
      **  Calculate total interest if not on file
     C           MGTOTI    IFEQ 0
     C                     Z-ADDMGVDAT    ZIBEG
     C                     Z-ADDMGMDAT    ZIEND
     C                     MOVE MGICBS    ZICALC
     C                     Z-ADDMGINTR    ZIRATE
     C                     Z-ADDMGPCPL    ZIAMT
     C/COPY WNCPYSRC,MG0320C004
     C                     EXSR GLINTC
     C/COPY WNCPYSRC,MG0320C021
     C**********           Z-ADDZINTR     ZAMNT                           E31885
     C                     Z-ADDZINTR     ZAMNT     H                     E31885
     C           ZINTR     IFLT 0
     C**********           Z-SUBZINTR     ZAMNT                           E31885
     C                     Z-SUBZINTR     ZAMNT     H                     E31885
     C                     END
      *
     C                     ELSE
     C                     MOVE MGTOTI    ZAMNT
     C                     END
      *
      **  Calculate part of total interest to be paid using MGNIDT
     C                     ELSE
     C                     MOVE MGNIDT    ZMDAY
     C                     Z-ADDMGSLID    ZIBEG
     C                     Z-ADDMGNIDT    ZIEND
     C                     MOVE MGICBS    ZICALC
     C                     Z-ADDMGINTR    ZIRATE
     C                     Z-ADDMGPCPL    ZIAMT
     C/COPY WNCPYSRC,MG0320C005
     C                     EXSR GLINTC
     C/COPY WNCPYSRC,MG0320C022
     C**********           Z-ADDZINTR     ZAMNT                                               247393
     C                     Z-ADDZINTR     ZAMNT     H                                         247393
     C           ZINTR     IFLT 0
     C**********           Z-SUBZINTR     ZAMNT                                               247393
     C                     Z-SUBZINTR     ZAMNT     H                                         247393
     C                     END
     C                     END
      *                                                                   109795
     C                     END                                            109795
     C/COPY WNCPYSRC,MG0320C039
      *                                                                   109795
      **  Format currency and interest amount.
      *
     C                     MOVE MGCCY     ZCCY
     C                     CALL 'ZM0040'
     C                     PARM           ZAMNT  130
     C                     PARM           ZCCY    3
     C                     PARM           ZSAMNT 15
     C                     PARM           ZSCCY   3
     C                     PARM           ZERR    1
     C                     PARM           ZSWDPC                                              222373
      *
     C/COPY WNCPYSRC,MG0320C007
      **  Format Next Interest date
     C                     CALL 'ZM0060'
     C                     PARM           ZMDAY   50
     C                     PARM           ZSDATE  6
      *
      ** Deal Type is a placing (loan).
      *
     C           MGLORD    IFEQ 'L'
      *
      **  If Loan, interest field is type R(eceive), unless interest
      **  rate is negative...
     C           MGINTR    IFGE 0
     C                     MOVE ':34R:'   MTAG
     C                     ELSE
     C                     MOVE ':34P:'   MTAG
     C                     END
      *
     C                     ELSE
      *
      **  Otherwise, if Deposit, interest field is type P(ay), unless
      **  interest rate is negative.
     C           MGINTR    IFGE 0
     C                     MOVE ':34P:'   MTAG
     C                     ELSE
     C                     MOVE ':34R:'   MTAG
     C                     END
      *
     C                     END
      *
      ** Error - indicate erroneous fields;
     C           ZERR      IFEQ '1'
     C                     MOVE 'Y'       @ERR
     C                     MOVELERR3N     MFLD
     C                     MOVELMSGA,5    MERR
      *
     C                     ELSE
     C                     MOVELFLD3N     MFLD
     C                     END
      *
      ** Field 37 - Interest field.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE MGNIDT    ZMDAY
     C                     MOVE MGMDAT    ZMDAT
      *
     C                     MOVE MGINTR    ZINRT
     C                     MOVE MGNIDT    ZINPD
     C                     MOVE MGIPFR    ZINFC
     C                     MOVE MGICBS    ZCALC
     C                     CALL 'ZM0070'               15
     C                     PARM           ZINRT  117
     C                     PARM           ZINPD   50
     C                     PARM           ZMDAT   50
     C                     PARM           ZINFC   1
     C                     PARM           ZCALC   10
     C                     PARM           ZSTAG   1
     C                     PARM           @VAR   35
     C                     PARM           ZSF72  35
      *
      **  Call ended in error. (Program not found.)
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '011'     DBASE              * * * * * * *
     C                     MOVEL'       ' DBKEY              * DBERR 011 *
     C                     MOVEL'ZM0070'  DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
     C/COPY WNCPYSRC,MG0320C008
     C                     MOVE '37'      FLDNO
     C                     MOVE ZSTAG     TAG
     C                     MOVEL@MTAG     MTAG
     C                     MOVEL@VAR      MFLD
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   RECV  - Format fields 53, 56 and 57 for receive sequence    *
      *   Called by - FMTA - Format message detail Seq A (taking)     *
      *               FMTB - Format message detail Seq B (placing)    *
      *   Calls     - FSWAD  Format swift address.                    *
      *****************************************************************
      *
     C           RECV      BEGSR
      *
     C                     MOVE *BLANKS   @WRK
      *
      ** Field 53 - Senders correspondant.
      *
      ** If the module is lending try to format field 53.
      *
     C           MGMODI    IFEQ 'LE'
      *
      ** If the receipt intermediary branch is not blank ; format
      ** this via FSWAD. (Else no field produced.)
      *
     C           MGRIBN    IFNE *BLANKS
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELMGRIBN    ZDEST
     C                     MOVELMGRIBA    ACLINE                          056739
     C                     MOVE ' '       TAG
     C                     MOVE '53'      FLDNO
     C                     EXSR FSWAD
     C                     END
     C                     END
      *
      ***Format*fields*56*and*57.*****************************************E32363
      ********************************************************************E32363
      ***Branch*code*of*sender*not*equal*to*Receive*settlement*branch.****E32363
      ********************************************************************E32363
      ****Test*if*settlement*via*nostro***********************************E32363
     C*********************MOVE*MGRSTM****@STM****************************E32363
     C***********@STM******LOKUPTABNST*******************23***************E32363
     C***********MGBRCA****IFNE*MGROBR************************************E32363
     C************IN23*****ANDEQ'1'***************************************E32363
      ********************************************************************E32363
     C*********************ADD**1*********X*******************************E32363
     C***********X*********OCUR*MULT**************************************E32363
      ********************************************************************E32363
     C*********************CALL*'AONOSTR0'********************************E32363
     C*********************PARM*'*MSG***'*@RTCD***7***********************E32363
     C*********************PARM*'*KEY***'*@OPTN***7***********************E32363
     C*********************PARM**BLANKS***@CUST***6********I:Customer*No**E32363
     C*********************PARM*MGCCY*****@CYCD***3********I:Currency*****E32363
     C*********************PARM**BLANKS***@ACCD***4********I:A/c*Code*****E32363
     C*********************PARM**BLANKS***@ACSN***2********I:A/c*Seq******E32363
     C*********************PARM*MGRONS****@NONB***2********I:Nostro*No****E32363
     C*********************PARM**BLANKS***@BRCD***3********I:Branch*Code**E32363
     C*********************PARM**BLANKS***@CSSN**10********I:Cust*ShortN**E32363
     C*********************PARM**BLANK****@PNOI***1********I:Prime*Nost*InE32363
     C***********SDNOST****PARM*SDNOST****DSFDY***************************E32363
      ********************************************************************E32363
      ****If*our*receive*nostro*is*not*found.*****************************E32363
      ********************************************************************E32363
     C***********@RTCD*****IFNE**BLANKS***********************************E32363
     C*********************MOVE*'Y'*******@ERR****************************E32363
     C*********************MOVELMGRONS****HLD2****2***********************E32363
     C*********************MOVELMGCCY*****HLD5****************************E32363
     C*********************MOVE*HLD2******HLD5****5***********************E32363
     C*********************MOVELHLD5******MFLD****************************E32363
     C*********************MOVELMSGA,3****MERR****************************E32363
     C*********************MOVE*':56*:'***MTAG****************************E32363
     C*********************ELSE*******************************************E32363
      ********************************************************************E32363
      ****Format*our*Receive*Nostro*Customer*Address**********************E32363
      ********************************************************************E32363
     C*********************MOVE**BLANKS***ZDEST***************************E32363
     C*********************MOVELA7CUST****ZDEST***************************E32363
     C*********************MOVE*'*'*******TAG*****************************E32363
     C*********************MOVE*'56'******FLDNO***************************E32363
     C*********************EXSR*FSWAD*************************************E32363
     C*********************END********************************************E32363
      ********************************************************************E32363
      ****Access*Branch*file*for*the*Internal*customer*number*of*the******E32363
      ****Receive*branch*(this*will*be*used*for*the*Account-With**********E32363
      ****Institution,*because*settlement*is*via*an*account*owned*********E32363
      ****by*a*branch*different*to*the*receive*branch)********************E32363
      ********************************************************************E32363
     C*********************CALL*'AOBRCHR0'********************************E32363
     C*********************PARM*'*MSG***'*@RTCD***************************E32363
     C*********************PARM*'*KEY***'*@OPTN***************************E32363
     C*********************PARM*MGROBR****@BRCD***3***********************E32363
     C***********SDBRCH****PARM*SDBRCH****DSSDY***************************E32363
      ********************************************************************E32363
      ***Branch*record*not*found*-*Error**********************************E32363
      ********************************************************************E32363
     C***********@RTCD*****IFNE**BLANKS***********************************E32363
     C************LOCK*****IN***LDA***************************************E32363
     C*********************MOVE*'026'*****DBASE***************************E32363
     C*********************MOVELMGROBR****DBKEY****************DBERR*026**E32363
     C*********************MOVEL'SDBRCHPD'DBFILE**************************E32363
     C*********************OUT**LDA***************************************E32363
     C*********************EXSR**PSSR*************************************E32363
     C*********************END********************************************E32363
      ********************************************************************E32363
      ***Format*Account-With*using*customer*number*of*receive*branch******E32363
      ********************************************************************E32363
     C*********************ADD**1*********X*******************************E32363
     C***********X*********OCUR*MULT**************************************E32363
     C*********************MOVE**BLANKS***ZDEST***************************E32363
     C*********************MOVELA8BICN****ZDEST***************************E32363
     C*********************MOVE*'*'*******TAG*****************************E32363
     C*********************MOVE*'57'******FLDNO***************************E32363
     C*********************EXSR*FSWAD*************************************E32363
      *
      *                                                                   E32363
      ** Format fields 56 and 57.                                         E32363
      *                                                                   E32363
      ** Branch code of sender not equal to Receive settlement branch.    E32363
      *                                                                   E32363
      **  Test if settlement via nostro                                   E32363
     C                     MOVE MGRSTM    @STM                            E32363
     C           @STM      LOKUPTABNST                   23               E32363
     C/COPY WNCPYSRC,MG0320CJM3
     C           MGBRCA    IFNE MGROBR                                    E32363
     C           *IN23     ANDEQ'1'                                       E32363
      *                                                                   E32363
     C**********           ADD  1         X                                            E32363 249455
     C********** X         OCUR MULT                                                   E32363 249455
      *                                                                   E32363
     C           MGRIBN    IFNE *BLANKS                                   E32363
      *                                                                                       249455
     C                     ADD  1         X                                                   249455
     C           X         OCUR MULT                                                          249455
      *                                                                                       249455
     C                     MOVE *BLANKS   ZDEST                           E32363
     C                     MOVELMGRIBN    ZDEST                           E32363
     C                     MOVELMGRIBA    ACLINE                          056739
     C                     MOVE ' '       TAG                             E32363
     C                     MOVE '56'      FLDNO                           E32363
     C                     EXSR FSWAD                                     E32363
      *                                                                   E32363
     C**********           ELSE                                                        E32363 249455
      **********                                                                       E32363 249455
      ****Access*Branch*file*for*the*Internal*customer*number*of*the***                E32363 249455
      ****Receive*branch*(this*will*be*used*for*the*Intermediary*******                E32363 249455
      ****Bank,*because*settlement*is*via*an*account*owned*************                E32363 249455
      ****by*a*branch*different*to*the*receive*branch)*****************                E32363 249455
      **********                                                                       E32363 249455
     C**********           CALL 'AOBRCHR0'                                             E32363 CGL029
     C**********           CALL 'AOBRCHR1'                                             CGL029 249455
     C**********           PARM '*MSG   ' @RTCD                                        E32363 249455
     C**********           PARM '*KEY   ' @OPTN                                        E32363 249455
     C**********           PARM MGROBR    @BRCD   3                                    E32363 249455
     C********** SDBRCH    PARM SDBRCH    DSSDY                                        E32363 249455
      **********                                                                       E32363 249455
      ***Branch*record*not*found*-*Error*******************************                E32363 249455
      **********                                                                       E32363 249455
     C********** @RTCD     IFNE *BLANKS                                                E32363 249455
     C********** *LOCK     IN   LDA                                                    E32363 249455
     C********** *LOCK     MOVE '026'     DBASE              * * * * * * *             E32363 249455
     C**********           MOVELMGROBR    DBKEY              * DBERR 026 *             E32363 249455
     C**********           MOVEL'SDBRCHPD'DBFILE             * * * * * * *             E32363 249455
     C**********           OUT  LDA       DBFILE                                       E32363 249455
     C**********           EXSR *PSSR                                                  E32363 249455
     C**********           END                                                         E32363 249455
      **********                                                                       E32363 249455
      ***Format*Intermediary*using*customer*number*of*receive*branch***                E32363 249455
      **********                                                                       E32363 249455
     C**********           MOVE *BLANKS   ZDEST                                        E32363 249455
     C**********           MOVELA8BICN    ZDEST                                        E32363 249455
     C**********           MOVE ' '       TAG                                          E32363 249455
     C**********           MOVE '56'      FLDNO                                        E32363 249455
     C**********           EXSR FSWAD                                                  E32363 249455
     C                     END                                            E32363
      *                                                                   E32363
      ** Use settlement currency to access nostro if not blank.           137909
      ** Otherwise use deal currency.                                     137909
     C           CEU003    IFEQ 'Y'                                       137909
     C           MGSTCY    ANDNE*BLANKS                                   137909
     C           CEU004    OREQ 'Y'                                       137909
     C           MGSTCY    ANDNE*BLANKS                                   137909
     C                     MOVE MGSTCY    @CYCD                           137909
     C                     ELSE                                           137909
     C                     MOVE MGCCY     @CYCD                           137909
     C                     ENDIF                                          137909
      *                                                                   137909
      ** Field :57:  A/C With Institution                                 E32363
      *                                                                   E32363
     C/COPY WNCPYSRC,MG0320C011
     C                     ADD  1         X                               E32363
     C           X         OCUR MULT                                      E32363
     C*******              CALL 'AONOSTR0'                                             E32363 CDL094
     C                     CALL 'AONOSTR1'                                                    CDL094
     C                     PARM '*MSG   ' @RTCD   7                       E32363
     C                     PARM '*KEY   ' @OPTN   7                       E32363
     C                     PARM *BLANKS   @CUST   6        I:Customer No  E32363
     C***********          PARM MGCCY     @CYCD   3     I:Currency E32363 137909
     C                     PARM           @CYCD   3        I:Currency     137909
     C**********           PARM *BLANKS   @ACCD   4        I:A/c Code                  E32363 CGL029
     C                     PARM *BLANKS   @ACCD  10                                           CGL029
     C                     PARM *BLANKS   @ACSN   2        I:A/c Seq      E32363
     C                     PARM MGRONS    @NONB   2        I:Nostro No    E32363
     C                     PARM *BLANKS   @BRCD   3        I:Branch Code  E32363
     C                     PARM *BLANKS   @CSSN  10        I:Cust ShortN  E32363
     C                     PARM *BLANK    @PNOI   1        I:Prime Nost InE32363
     C***********SDNOST    PARM SDNOST    DSFDY                                        E32363 CDL094
     C           SDNOST    PARM SDNOST    DSSDY                                               CDL094
      *                                                                   E32363
      **  If our receive nostro is not found.                             E32363
      *                                                                   E32363
     C           @RTCD     IFNE *BLANKS                                   E32363
     C                     MOVE 'Y'       @ERR                            E32363
     C                     MOVELMGRONS    HLD2    2                       E32363
     C                     MOVELMGCCY     HLD5                            E32363
     C                     MOVE HLD2      HLD5    5                       E32363
     C                     MOVELHLD5      MFLD                            E32363
     C                     MOVELMSGA,3    MERR                            E32363
     C                     MOVE ':57 :'   MTAG                            E32363
     C                     ELSE                                           E32363
      *                                                                   E32363
      **  Format our Receive Nostro Customer Address                      E32363
      *                                                                   E32363
      * If CDL094 is On and Delivery Agent details have been defined for                      CDL094
      * the Nostro, use these and not the Customer of the Nostro details                      CDL094
     C           CDL094    IFEQ 'Y'                                                           CDL094
     C           A7RF57    ANDNE*BLANKS                                                       CDL094
      *                                                                                       CDL094
      * If SWIFT BIC defined as the Delivery Agent then obtain related                        CDL094
      * customer number                                                                       CDL094
     C                     MOVE *IN80     IN80    1                                           CDL094
     C                     MOVEL*BLANKS   WSWID  12                                           CDL094
     C                     MOVELA7RF57    WSWID                                               CDL094
     C           WSWID     CHAINSDCUSTL7             80                                       CDL094
     C           *IN80     IFEQ *OFF                                                          CDL094
     C                     MOVEL*BLANKS   ZDEST                                               CDL094
     C                     MOVELBBCUST    ZDEST                                               CDL094
     C                     ELSE                                                               CDL094
     C                     MOVEL*BLANKS   ZDEST                                               CDL094
     C                     MOVELA7RF57    ZDEST                                               CDL094
     C                     ENDIF                                                              CDL094
     C                     MOVEL*BLANKS   ACLINE                                              CDL094
     C                     MOVELA7RA57    ACLINE                                              CDL094
     C                     MOVE IN80      *IN80                                               CDL094
      *                                                                                       CDL094
     C                     ELSE                                                               CDL094
     C                     MOVE *BLANKS   ZDEST                           E32363
     C                     MOVELA7CUST    ZDEST                           E32363
     C                     MOVEL*BLANKS   ACLINE 35                       056739
     C                     ENDIF                                                              CDL094
     C/COPY WNCPYSRC,MG0320C034
     C                     MOVE ' '       TAG                             E32363
     C                     MOVE '57'      FLDNO                           E32363
     C/COPY WNCPYSRC,MG0320C046
     C                     EXSR FSWAD                                     E32363
     C/COPY WNCPYSRC,MG0320C047
     C                     END                                            E32363
     C/COPY WNCPYSRC,MG0320C012
      *                                                                   E32363
      * If Beneficiary details defined for the Nostro are not blank, output                   CDL094
      * these as field 58                                                                     CDL094
     C           CDL094    IFEQ 'Y'                                                           CDL094
     C           A7RF58    ANDNE*BLANKS                                                       CDL094
      *                                                                                       CDL094
     C                     ADD  1         X                                                   CDL094
     C           X         OCUR MULT                                                          CDL094
      * If SWIFT BIC defined as the Beneficiary then obtain related                           CDL094
      * customer number                                                                       CDL094
     C                     MOVE *IN80     IN80    1                                           CDL094
     C                     MOVEL*BLANKS   WSWID                                               CDL094
     C                     MOVELA7RF58    WSWID                                               CDL094
     C           WSWID     CHAINSDCUSTL7             80                                       CDL094
     C           *IN80     IFEQ *OFF                                                          CDL094
     C                     MOVEL*BLANKS   ZDEST                                               CDL094
     C                     MOVELBBCUST    ZDEST                                               CDL094
     C                     ELSE                                                               CDL094
     C                     MOVEL*BLANKS   ZDEST                                               CDL094
     C                     MOVELA7RF58    ZDEST                                               CDL094
     C                     ENDIF                                                              CDL094
     C                     MOVEL*BLANKS   ACLINE                                              CDL094
     C                     MOVELA7RA58    ACLINE                                              CDL094
     C                     MOVE IN80      *IN80                                               CDL094
      *                                                                                       CDL094
     C                     MOVE ' '       TAG                                                 CDL094
     C                     MOVE '58'      FLDNO                                               CDL094
     C                     EXSR FSWAD                                                         CDL094
     C                     ENDIF                                                              CDL094
      *                                                                                       CDL094
      *
      ** Else the branch code of sender = receive settlement branch
      ** and the settlement is via a nostro.
      *
     C                     ELSE
      *
     C           MGRIBN    IFNE *BLANKS                                   E32363
     C                     ADD  1         X                               E32363
     C           X         OCUR MULT                                      E32363
     C                     MOVE *BLANKS   ZDEST                           E32363
     C                     MOVELMGRIBN    ZDEST                           E32363
     C                     MOVELMGRIBA    ACLINE                          056739
     C                     MOVE ' '       TAG                             E32363
     C                     MOVE '56'      FLDNO                           E32363
     C                     EXSR FSWAD                                     E32363
     C                     END                                            E32363
      *                                                                   E32363
     C           @STM      LOKUPTABNST                   23
     C/COPY WNCPYSRC,MG0320C013
      *
     C           *IN23     IFEQ '1'
     C                     ADD  1         X
     C           X         OCUR MULT
      *                                                                   137909
      ** Use settlement currency to access nostro if not blank.           137909
      ** Otherwise use deal currency.                                     137909
     C           CEU003    IFEQ 'Y'                                       137909
     C           MGSTCY    ANDNE*BLANKS                                   137909
     C           CEU004    OREQ 'Y'                                       137909
     C           MGSTCY    ANDNE*BLANKS                                   137909
     C                     MOVE MGSTCY    @CYCD                           137909
     C                     ELSE                                           137909
     C                     MOVE MGCCY     @CYCD                           137909
     C                     ENDIF                                          137909
      *                                                                   137909
     C*******              CALL 'AONOSTR0'                                                    CDL094
     C                     CALL 'AONOSTR1'                                                    CDL094
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM *BLANKS   @CUST   6        I:Customer No
     C***********          PARM MGCCY     @CYCD   3        I:Currency     137909
     C                     PARM           @CYCD   3        I:Currency     137909
     C**********           PARM *BLANKS   @ACCD   4        I:A/c Code                         CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2        I:A/c Seq
     C                     PARM MGRONS    @NONB   2        I:Nostro No
     C                     PARM *BLANKS   @BRCD   3        I:Branch Code
     C                     PARM *BLANKS   @CSSN  10        I:Cust ShortN
     C                     PARM *BLANK    @PNOI   1        I:Prime Nost In
     C***********SDNOST    PARM SDNOST    DSFDY                                               CDL094
     C           SDNOST    PARM SDNOST    DSSDY                                               CDL094
      *
      **  If our receive nostro is not found.
      *
     C           @RTCD     IFNE *BLANKS
     C                     MOVE 'Y'       @ERR
     C                     MOVELMGRONS    HLD2
     C                     MOVELMGCCY     HLD5
     C                     MOVE HLD2      HLD5
     C                     MOVELHLD5      MFLD
     C                     MOVELMSGA,3    MERR
     C                     MOVE ':57 :'   MTAG
     C                     ELSE
      *
      * If CDL094 is On and Delivery Agent details have been defined for                      CDL094
      * the Nostro, use these and not the Customer of the Nostro details                      CDL094
     C           CDL094    IFEQ 'Y'                                                           CDL094
     C           A7RF57    ANDNE*BLANKS                                                       CDL094
      *                                                                                       CDL094
      * If SWIFT BIC defined as the Delivery Agent then obtain related                        CDL094
      * customer number                                                                       CDL094
     C                     MOVE *IN80     IN80    1                                           CDL094
     C                     MOVEL*BLANKS   WSWID                                               CDL094
     C                     MOVELA7RF57    WSWID                                               CDL094
     C           WSWID     CHAINSDCUSTL7             80                                       CDL094
     C           *IN80     IFEQ *OFF                                                          CDL094
     C                     MOVEL*BLANKS   ZDEST                                               CDL094
     C                     MOVELBBCUST    ZDEST                                               CDL094
     C                     ELSE                                                               CDL094
     C                     MOVEL*BLANKS   ZDEST                                               CDL094
     C                     MOVELA7RF57    ZDEST                                               CDL094
     C                     ENDIF                                                              CDL094
     C                     MOVEL*BLANKS   ACLINE                                              CDL094
     C                     MOVELA7RA57    ACLINE                                              CDL094
     C                     MOVE IN80      *IN80                                               CDL094
      *                                                                                       CDL094
     C                     ELSE                                                               CDL094
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELA7CUST    ZDEST
      *                                                                   S01408
     C/COPY WNCPYSRC,MG0320CCP1                                           S01408
      *                                                                   S01408
     C                     MOVEL*BLANKS   ACLINE                          056739
     C                     ENDIF                                                              CDL094
     C/COPY WNCPYSRC,MG0320C035
     C                     MOVE ' '       TAG
     C                     MOVE '57'      FLDNO
     C/COPY WNCPYSRC,MG0320C048
     C                     EXSR FSWAD
     C/COPY WNCPYSRC,MG0320C049
     C                     END
      *
      * If Beneficiary details defined for the Nostro are not blank, output                   CDL094
      * these as field 58                                                                     CDL094
     C           CDL094    IFEQ 'Y'                                                           CDL094
     C           A7RF58    ANDNE*BLANKS                                                       CDL094
      *                                                                                       CDL094
     C                     ADD  1         X                                                   CDL094
     C           X         OCUR MULT                                                          CDL094
      * If SWIFT BIC defined as the Beneficiary then obtain related                           CDL094
      * customer number                                                                       CDL094
     C                     MOVE *IN80     IN80    1                                           CDL094
     C                     MOVEL*BLANKS   WSWID                                               CDL094
     C                     MOVELA7RF58    WSWID                                               CDL094
     C           WSWID     CHAINSDCUSTL7             80                                       CDL094
     C           *IN80     IFEQ *OFF                                                          CDL094
     C                     MOVEL*BLANKS   ZDEST                                               CDL094
     C                     MOVELBBCUST    ZDEST                                               CDL094
     C                     ELSE                                                               CDL094
     C                     MOVEL*BLANKS   ZDEST                                               CDL094
     C                     MOVELA7RF58    ZDEST                                               CDL094
     C                     ENDIF                                                              CDL094
     C                     MOVEL*BLANKS   ACLINE                                              CDL094
     C                     MOVELA7RA58    ACLINE                                              CDL094
     C                     MOVE IN80      *IN80                                               CDL094
      *                                                                                       CDL094
     C                     MOVE ' '       TAG                                                 CDL094
     C                     MOVE '58'      FLDNO                                               CDL094
     C                     EXSR FSWAD                                                         CDL094
     C                     ENDIF                                                              CDL094
      *                                                                                       CDL094
     C                     ELSE
      *
      ** Settlement method internal.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C           MGRSTM    IFNE 00
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELSECN      ZDEST
     C                     MOVEL*BLANKS   ACLINE                          056739
     C                     MOVE ' '       TAG
     C                     MOVE '57'      FLDNO
     C                     EXSR FSWAD
      *
      ** No settlement type entered.
      *
     C                     ELSE
     C                     MOVE ':57D:'   MTAG
     C                     MOVEL'UNKNOWN' MFLD
     C                     END
     C                     END
      *
     C/COPY WNCPYSRC,MG0320C014
     C                     END
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   PAY  - Format fields 53, 56 and 57 for a payment            *
      *   Called by - FMTA - Format message detail Seq A (placing)    *
      *               FMTB - Format message detail Seq B (taking)     *
      *   Calls       FSWAD  Format Swift Address.                    *
      *****************************************************************
      *
     C           PAY       BEGSR
      *
     C                     MOVE *BLANKS   @WRK
      *
      ** Field 53 - Senders correspondant.
      **  Test if settlement via nostro
      *
     C                     MOVE MGPSTM    @STM    2
     C           @STM      LOKUPTABNST                   23
      *
      ** If our pay nostro is not blank and the settlement is via a nostro
      *
     C           MGPONS    IFNE *BLANKS
     C           *IN23     ANDEQ'1'
      *
      **  either A/C with Bank or Receipient entered
      **  or DIRECT entered                                               088043
      *
     C           MGAWBN    IFNE *BLANKS
     C           AWBA6     OREQ 'DIRECT'                                  088043
     C/COPY WNCPYSRC,MG0320C015
      *
      ** Use settlement currency to access nostro if not blank.           137909
      ** Otherwise use deal currency.                                     137909
     C           CEU003    IFEQ 'Y'                                       137909
     C           MGSTCY    ANDNE*BLANKS                                   137909
     C           CEU004    OREQ 'Y'                                       137909
     C           MGSTCY    ANDNE*BLANKS                                   137909
     C                     MOVE MGSTCY    @CYCD                           137909
     C                     ELSE                                           137909
     C                     MOVE MGCCY     @CYCD                           137909
     C                     ENDIF                                          137909
      *                                                                   137909
     C                     MOVELMGPONS    @NONB
     C*******              CALL 'AONOSTR0'                                                    CDL094
     C                     CALL 'AONOSTR1'                                                    CDL094
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM *BLANKS   @CUST   6
     C***********          PARM MGCCY     @CYCD   3                       137909
     C                     PARM           @CYCD   3                       137909
     C**********           PARM *BLANKS   @ACCD   4                                           CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2
     C                     PARM           @NONB   2
     C                     PARM *BLANKS   @BRCD   3
     C                     PARM *BLANKS   @CSSN  10
     C                     PARM *BLANKS   @PNOI   1
     C***********SDNOST    PARM SDNOST    DSFDY                                               CDL094
     C           SDNOST    PARM SDNOST    DSSDY                                               CDL094
      *
      **  Nostro customer not found
      *
     C           @RTCD     IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE 'Y'       @ERR
     C                     MOVE ':53 :'   MTAG
     C                     MOVELMGPONS    HLD2
     C                     MOVELMGCCY     HLD5
     C                     MOVE HLD2      HLD5
     C                     MOVELHLD5      MFLD
     C                     MOVELMSGA,3    MERR
     C                     ELSE
     C/COPY WNCPYSRC,MG0320C024
      *
      ** Branch Internal Customer cf. Customer number of Our Pay Nostro
      *
     C                     MOVELSECN      @SECN   6
     C           @SECN     IFNE A7CUST
     C           MGAWBN    ANDNEA7CUST
     C                     MOVE *BLANKS   ZDEST
     C           MGRVNO    IFEQ *BLANKS                                   096521
     C                     MOVELA7CUST    ZDEST
     C                     ELSE                                           096521
     C                     MOVELMGRVNO    ZDEST                           096521
     C                     ENDIF                                          096521
     C*********************CALL 'ZM0050'                                  CSW036
     C                     CALL 'ZM0051'                                  CSW036
     C                     PARM           ZDEST  12
     C                     PARM           ZSADD1 35
     C                     PARM           ZSADD2 35
     C                     PARM           ZSADD3 35
     C                     PARM           ZSADD4 35
     C                     PARM           ZSTAG   1
     C                     PARM           ZSTYPE  1
     C                     PARM           ZERR    1
     C                     PARM           ZDBEI                                               CSW201
      *
      **  Error when formating address
      *
     C           ZERR      IFEQ '1'
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE 'Y'       @ERR
     C                     MOVE ':53 :'   MTAG
     C                     MOVELZDEST     MFLD
     C                     MOVELMSGA,6    MERR
     C                     ELSE
      *
      **  A Type address
      *
     C           ZSTAG     IFEQ 'A'
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE 'A'       TAG
     C                     MOVE '53'      FLDNO
     C                     MOVE @MTAG     MTAG
     C                     MOVELZSADD1    MFLD
     C                     EXSR SEXTN                                     183583
      *
     C                     ELSE
      *
      **  Access SDCUSTPD using our pay nostro customer number
      *
     C                     MOVE *BLANKS   @KEY1
     C                     MOVELA7CUST    @KEY1
     C*********************CALL 'AOCUSTR0'                                CSW036
     C                     CALL 'AOCUSTR1'                                CSW036
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           @KEY1  10
     C                     PARM *BLANKS   @KYST   7
     C***********SDCUST    PARM SDCUST    DSSDY                           CSW036
     C           SDCUST    PARM SDCUST    DSLDY                           CSW036
      *
      ** Customer record not found - Error
      *
     C           @RTCD     IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE 'Y'       @ERR
     C                     MOVE ':53 :'   MTAG
     C                     MOVELA7CUST    MFLD
     C                     MOVE MSGA,2    MERR
      *
     C                     ELSE
      *
      **  B Type address
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C**********           MOVE BBPCNB    @PCNB   60                                          CSD027
     C                     MOVE BBPCNB    @PCNB   6                                           CSD027
     C           SPAIN     IFEQ 'P'
     C           @PCNB     ANDEQSECN
     C           BBPAIN    OREQ 'P'
     C           A7CUST    ANDEQSPCNB
     C           BBPCNB    OREQ SPCNB
     C           BBPCNB    ANDNE*BLANKS
      *
     C                     MOVE ':53B:'   MTAG
     C                     MOVE *BLANKS   @WRK
     C                     MOVELBBCRNM    @WRK,1
     C                     Z-ADD22        J       20
     C                     MOVEABBCRTN    @WRK,J
     C                     MOVEA@WRK      MFLD
      *
      **  D Type address
     C                     ELSE
     C                     MOVE ':53D:'   MTAG
     C                     MOVELZSADD1    MFLD
      **  Address 2
     C           ZSADD2    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD2    MFLD
      **  Address 3
     C           ZSADD3    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD3    MFLD
      **  Address 4
     C           ZSADD4    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD4    MFLD
     C                     END                             D address 4
     C                     END                             D address 3
     C                     END                             D address 2
     C                     END                             B/D address 1
      *
     C                     END                             Cust. error?
      *
     C                     END                             A/B/D address?
     C                     END                             Fmt ad. error    .
     C                     END                             Brch Int Cust.
     C                     END                             Nostro not fnd.
     C/COPY WNCPYSRC,MG0320C016
     C                     END
     C/COPY WNCPYSRC,MG0320C025
     C                     END                             Pay nostro?
      *
     C                     MOVE 'N'       FLD57O  1
      *
      **  Field :57:  A/C with institution non-blank
      *
     C/COPY WNCPYSRC,MG0320CJM1
     C           MGAWBN    IFNE *BLANKS
      *
      **  Field :56:  Pay Intermediary bank
      **  This field is only produced when the account with institution
      **  is non-blank.
      *
      **  If the pay intermediary is entered.
      *
     C           MGPIBN    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELMGPIBN    ZDEST
     C                     MOVELMGPIBA    ACLINE                          056739
     C                     MOVE ' '       TAG
     C                     MOVE '56'      FLDNO
     C                     EXSR FSWAD
     C                     END
      *
      **  Format Account with institution. (Field 57.)
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELMGAWBN    ZDEST
     C                     MOVELMGAWBA    ACLINE                          056739
     C/COPY WNCPYSRC,MG0320C037
     C                     MOVE ' '       TAG
     C                     MOVE '57'      FLDNO
     C                     EXSR FSWAD
     C                     MOVE 'Y'       FLD57O  1
      *
      **  A/C with Inst. blank
      *
     C                     ELSE
      *                                                                   088043
     C           AWBA6     IFEQ 'DIRECT'                                  088043
      *                                                                   088043
      **  A/C with Inst. set up as DIRECT, use beneficiary details        088043
      **  Format Account with institution. (Field 57.)                    088043
      *                                                                   088043
     C                     ADD  1         X                               088043
     C           X         OCUR MULT                                      088043
     C                     MOVE *BLANKS   ZDEST                           088043
     C                     MOVELMGBENN    ZDEST                           088043
     C                     MOVELMGBENA    ACLINE                          088043
     C                     MOVE ' '       TAG                             088043
     C                     MOVE '57'      FLDNO                           088043
     C/COPY WNCPYSRC,MG0320C006
     C                     EXSR FSWAD                                     088043
     C                     MOVE 'Y'       FLD57O  1                       088043
      *                                                                   088043
      **  A/C with Inst. blank and NOT "DIRECT" entered,                  088043
      *                                                                   088043
     C                     ELSE                                           088043
      *
      *
      **  Field 57 = pay nostro customer if settlement via '02' or '12'
     C           MGPSTM    IFEQ 02
     C           MGPSTM    OREQ 12
     C                     MOVELMGPONS    @NONB
      *                                                                   137909
      ** Use settlement currency to access nostro if not blank.           137909
      ** Otherwise use deal currency.                                     137909
     C           CEU003    IFEQ 'Y'                                       137909
     C           MGSTCY    ANDNE*BLANKS                                   137909
     C           CEU004    OREQ 'Y'                                       137909
     C           MGSTCY    ANDNE*BLANKS                                   137909
     C                     MOVE MGSTCY    @CYCD                           137909
     C                     ELSE                                           137909
     C                     MOVE MGCCY     @CYCD                           137909
     C                     ENDIF                                          137909
      *                                                                   137909
     C*******              CALL 'AONOSTR0'                                                    CDL094
     C                     CALL 'AONOSTR1'                                                    CDL094
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM *BLANKS   @CUST   6
     C***********          PARM MGCCY     @CYCD   3                       137909
     C                     PARM MGCCY     @CYCD   3                       137909
     C**********           PARM *BLANKS   @ACCD   4                                           CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2
     C                     PARM           @NONB   2
     C                     PARM *BLANKS   @BRCD   3
     C                     PARM *BLANKS   @CSSN  10
     C                     PARM *BLANKS   @PNOI   1
     C***********SDNOST    PARM SDNOST    DSFDY                                               CDL094
     C           SDNOST    PARM SDNOST    DSSDY                                               CDL094
      *
      **  Nostro customer not found
      *
     C           @RTCD     IFNE *BLANKS
     C                     MOVE 'Y'       @ERR
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELMGPONS    HLD2    2
     C                     MOVELMGCCY     HLD5
     C                     MOVE HLD2      HLD5    5
     C                     MOVELHLD5      MFLD
     C                     MOVELMSGA,3    MERR
     C                     MOVE ':57 :'   MTAG
     C                     ELSE
      *
      **  Format our Pay Nostro Customer Address
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZDEST
     C           MGRVNO    IFEQ *BLANKS                                   096521
     C                     MOVELA7CUST    ZDEST
     C                     ELSE                                           096521
     C                     MOVELMGRVNO    ZDEST                           096521
     C                     ENDIF                                          096521
     C                     MOVEL*BLANKS   ACLINE                          056739
     C/COPY WNCPYSRC,MG0320C038
     C                     MOVE ' '       TAG
     C                     MOVE '57'      FLDNO
     C                     EXSR FSWAD
     C                     MOVE 'Y'       FLD57O
     C                     END
      *
     C                     ELSE
      *
     C           MGPSTM    IFNE 00
     C                     MOVE MGPSTM    @STM
     C           @STM      LOKUPTABINT                   23
     C*
     C           *IN23     IFEQ '1'
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELSECN      ZDEST
     C                     MOVEL*BLANKS   ACLINE                          056739
     C                     MOVE ' '       TAG
     C                     MOVE '57'      FLDNO
     C                     EXSR FSWAD
     C                     MOVE 'Y'       FLD57O
      *
     C                     ELSE
      *
      **  Field 53 is equal to Our Pay Nostro
     C/COPY WNCPYSRC,MG0320C017
     C                     MOVELMGPONS    @NSKYE
      *                                                                   137909
      ** Use settlement currency to access nostro if not blank.           137909
      ** Otherwise use deal currency.                                     137909
     C           CEU003    IFEQ 'Y'                                       137909
     C           MGSTCY    ANDNE*BLANKS                                   137909
     C           CEU004    OREQ 'Y'                                       137909
     C           MGSTCY    ANDNE*BLANKS                                   137909
     C                     MOVE MGSTCY    @NSKYB                          137909
     C                     ELSE                                           137909
     C                     MOVE MGCCY     @NSKYB                          137909
     C                     ENDIF                                          137909
      *                                                                   137909
     C*******              CALL 'AONOSTR0'                                                    CDL094
     C                     CALL 'AONOSTR1'                                                    CDL094
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM *BLANKS   @NSKYA  6
     C***********          PARM MGCCY     @NSKYB  3                       137909
     C                     PARM           @NSKYB  3                       137909
     C**********           PARM *BLANKS   @NSKYC  4                                           CGL029
     C                     PARM *BLANKS   @NSKYC 10                                           CGL029
     C                     PARM *BLANKS   @NSKYD  2
     C                     PARM           @NSKYE  2
     C                     PARM *BLANKS   @KEYF   3
     C                     PARM *BLANKS   @KEYG  10
     C                     PARM *BLANKS   @KEYH   1
     C***********SDNOST    PARM SDNOST    DSFDY                                               CDL094
     C           SDNOST    PARM SDNOST    DSSDY                                               CDL094
     C*
     C**  Nostro customer not found
     C           @RTCD     IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE 'Y'       @ERR
     C                     MOVE ':53 :'   MTAG
     C                     MOVELMGPONS    MFLD
     C                     MOVELMSGA,3    MERR
     C                     ELSE
     C/COPY WNCPYSRC,MG0320C026
      *
      **  Format our Pay Nostro Customer Address
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELA7CUST    ZDEST
     C                     MOVEL*BLANKS   ACLINE                          056739
     C                     MOVE ' '       TAG
     C                     MOVE '53'      FLDNO
     C                     EXSR FSWAD
     C                     END
     C/COPY WNCPYSRC,MG0320C018
     C                     END
     C                     END
     C                     END
     C                     END                                            088043
     C                     END
     C/COPY WNCPYSRC,MG0320CJM2
      *
      **  Settlement 01,07 or 08 with MGAWBN blank or settlement 00
      *
     C           FLD57O    IFEQ 'N'
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE ':57D:'   MTAG
     C                     MOVEL'UNKNOWN' MFLD
      *                                                                   S01408
     C/COPY WNCPYSRC,MG0320CCP2                                           S01408
      *                                                                   S01408
     C                     END
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   FLD72 - Calculate field 72                                  *
      *   Called by - FMTA - Format message detail Seq A              *
      *****************************************************************
      *
     C           FLD72     BEGSR
      *
     C                     MOVE *BLANKS   @WRK
     C*                                                                   S01408
     C/COPY WNCPYSRC,MG0320CCP3                                           S01408
     C*                                                                   S01408
      *
      **  Output /TELEX/
      *
     C           MGBRKC    IFEQ 'TELX'
     C*                                                                   S01408
     C/COPY WNCPYSRC,MG0320CCP4                                           S01408
     C*                                                                   S01408
     C                     MOVEA'/TELEX/' @WRK,1
     C                     MOVE '1'       *IN25
     C                     END
      *
      **  Output /PHON/
      *
     C           MGBRKC    IFEQ 'PHON'
     C*                                                                   S01408
     C/COPY WNCPYSRC,MG0320CCP5                                           S01408
     C*                                                                   S01408
     C                     MOVEA'/PHON/'  @WRK,1
     C                     MOVE '1'       *IN25
     C                     END
      *
     C           MGBRKC    IFNE 'TELX'
     C           MGBRKC    ANDNE'PHON'
     C           MGBRKC    ANDNE'MAIL'
     C           MGBRKC    ANDNE'SWAP'
     C           MGBRKC    ANDNE*BLANKS
      *
      **  Access the broker file
      *
     C                     CALL 'AOBROKR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM MGBRKC    @BROKY  4
     C           SDBROK    PARM SDBROK    DSFDY
      *
      ** If the broker code is not found.
      *
     C           @RTCD     IFNE *BLANKS
     C                     MOVE 'Y'       @ERR
     C                     MOVELMSGA,4    MERR
     C                     MOVEAMGBRKC    @WRK,1
     C                     MOVE '1'       *IN25
      *
      ** Format the broker field.
      *
     C                     ELSE
     C*                                                                   S01408
     C/COPY WNCPYSRC,MG0320CCP6                                           S01408
     C*                                                                   S01408
     C                     MOVEA'/BROKER/'@WRK,1
     C                     MOVEAA9BKNM    @WRK,9
     C                     MOVE '1'       *IN25
     C*                                                                   S01408
     C/COPY WNCPYSRC,MG0320CCP7                                           S01408
     C*                                                                   S01408
     C                     END
     C                     END
      *                                                                   E33129
      ** Maximum length of field is 35
     C                     MOVEA@WRK,36   @WRK15 15                       E33129
     C           @WRK15    IFNE *BLANK                                    E33129
     C                     Z-ADD36        J       20                      E33129
     C                     MOVEA*BLANK    @WRK,J                          E33129
     C                     END                                            E33129
      *
      **  Output Field :72: as constructed from above
      *
     C           @WRK,1    IFNE *BLANK
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE ':72: '   MTAG
     C                     MOVEA@WRK      MFLD
     C                     END
      *                                                                   E33129
      ** Wrap round to the next line the remainder of the BROKER info.    E33129
     C           @WRK15    IFNE *BLANK                                    E33129
     C                     MOVEA*BLANK    @WRK                            E33129
     C                     MOVEA'//'      @WRK,1                          E33129
     C                     MOVEA@WRK15    @WRK,3                          E33129
     C                     ADD  1         X                               E33129
     C           X         OCUR MULT                                      E33129
     C                     MOVEA@WRK      MFLD                            E33129
     C/COPY WNCPYSRC,MG0320C040
     C                     END                                            E33129
      *                                                                   E33129
      *
      ** If there is a field 72 output from standard program ZM0070.
      *
     C           ZSF72     IFNE *BLANKS
     C*                                                                   S01408
     C/COPY WNCPYSRC,MG0320CCP8                                           S01408
     C*                                                                   S01408
      *
      ** If a line has been previously output no tag is needed for
      ** this field. If no line has been output the tag must be :72:.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      ** If there has been no previous field 72.
      *
     C           *IN25     IFEQ '0'
     C                     MOVE ':72: '   MTAG
     C*                                                                   S01408
     C/COPY WNCPYSRC,MG0320CP10                                           S01408
     C*                                                                   S01408
     C                     MOVE '1'       *IN25                                               255986
     C                     END
      *
     C                     MOVELZSF72     MFLD
     C/COPY WNCPYSRC,MG0320C041
      *
     C                     END
      *                                                                   CDL006
      ** If a fiduciary transaction, add fiduciary message confirmation   CDL006
      *                                                                   CDL006
     C           CDL006    IFEQ 'Y'                                       CDL006
      *                                                                   CDL006
     C           MGTTYP    IFEQ 'FL'                                      CDL006
     C           MGTTYP    OREQ 'FT'                                      CDL006
     C                     MOVEA*BLANK    @WRK                            CDL006
     C                     MOVEA'//'      @WRK,1                          CDL006
     C                     MOVEAMSGA,9    @WRK,3                          CDL006
     C                     ADD  1         X                               CDL006
     C           X         OCUR MULT                                      CDL006
     C                     MOVEA@WRK      MFLD                            CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
     C*                                                                   S01408
     C/COPY WNCPYSRC,MG0320CCP9                                           S01408
     C*                                                                   S01408
      *                                                                                       255986
      * Check all six Bank to Bank Info fields and output any which                           255986
      * contain data                                                                          255986
     C**********           CLEAR@BTB                                                  255986 255986A
     C**********           MOVELMGBTB1    @BTB,1                                      255986 255986A
     C**********           MOVELMGBTB2    @BTB,2                                      255986 255986A
     C**********           MOVELMGBTB3    @BTB,3                                      255986 255986A
     C**********           MOVELMGBTB4    @BTB,4                                      255986 255986A
     C**********           MOVELMGBTB5    @BTB,5                                      255986 255986A
     C**********           MOVELMGBTB6    @BTB,6                                      255986 255986A
      *                                                                                       255986
     C********** 1         DO   6         CT6     10                                  255986 255986A
     C********** @BTB,CT6  IFNE *BLANKS                                               255986 255986A
     C**********           ADD  1         X                                           255986 255986A
     C********** X         OCUR MULT                                                  255986 255986A
     C**********           MOVE *BLANKS   MTAG                                        255986 255986A
      *                                                                                       255986
      **  If this is the first line of field 72 then set tag to ':72: '                       255986
     C********** *IN25     IFNE '1'                                                   255986 255986A
     C**********           MOVE ':72: '   MTAG                                        255986 255986A
     C**********           MOVE '1'       *IN25                                       255986 255986A
     C**********           ENDIF                                                      255986 255986A
     C**********           MOVE *BLANKS   MFLD                                        255986 255986A
     C**********           MOVE *BLANKS   MERR                                        255986 255986A
     C**********           MOVEL@BTB,CT6  MFLD                                        255986 255986A
     C**********           ENDIF                                                      255986 255986A
     C**********           ENDDO                                                      255986 255986A
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************   CSW200
      *   FMA200 - Format Message Detail - Sequence A.                *   CSW200
      *            This subroutine is similar to FMTA with the        *   CSW200
      *            following changes:                                 *   CSW200
      *             - New field :15A: Beginning of sequence A         *   CSW200
      *             - :22A: now just contains the type of operation   *   CSW200
      *             - New field :22B: type of event                   *   CSW200
      *             - New field :22C: common reference                *   CSW200
      *                                                               *   CSW200
      *   Called by - Main processing                                 *   CSW200
      *   Calls     -                                                 *   CSW200
      *****************************************************************   CSW200
      *                                                                   CSW200
     C           FMA200    BEGSR                                          CSW200
      *                                                                   CSW200
      ** FIELD :15A: - New Sequence                                       CSW200
      *                                                                   CSW200
     C**********           Z-ADD1         X       20                                   CSW200 CSW208
     C                     Z-ADD1         X                                                   CSW208
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C                     MOVEL':15A:'   MTAG                            CSW200
     C                     MOVE *BLANKS   MFLD                            CSW200
      *                                                                   CSW200
      ** FIELD :20: -  Transaction Reference Number.                      CSW200
      *                                                                   CSW200
     C**********           ADD  1         X       20                                   CSW200 CSW208
     C                     ADD  1         X                                                   CSW208
     C           X         OCUR MULT                                      CSW200
     C                     MOVEA*BLANKS   @WRK                            CSW200
      *                                                                   CSW200
     C                     Z-ADD1         Z       20                      CSW200
     C                     MOVEAMGMODI    @WRK                            CSW200
     C                     MOVEAMGTNUM    @WRK,3                          CSW200
     C           MGLSWS    ADD  1         HLSWS   30                      CSW200
     C                     MOVE HLSWS     HSWS    3                       CSW200
      *                                                                   CSW200
     C           ' '       LOKUP@WRK,Z                   31               CSW200
     C                     MOVEAHSWS      @WRK,Z                          CSW200
      *                                                                   CSW200
      **  Check on MGREFPD for a uniqne TRN,else output as an error.      CSW200
      **  and store the TRN of the new confirmation message.              CSW200
      *                                                                   CSW200
     C                     MOVEA@WRK      @TRNA  16                       CSW200
      *                                                                   CSW200
     C           @TRNA     CHAINMGREFL0              11                   CSW200
      *                                                                   CSW200
      ** If no record is found flag field as in error.                    CSW200
      *                                                                   CSW200
     C           *IN11     IFEQ '0'                                       CSW200
     C                     MOVE 'Y'       @ERR                            CSW200
     C                     MOVEAMSGA,8    MERR                            CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
     C                     MOVEL':20:'    MTAG                            CSW200
     C                     MOVEA@WRK      MFLD                            CSW200
      *                                                                   CSW200
      ** FIELD :21: - Related Reference.                                  CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
      **  Determine the message codeword                                  CSW200
      *                                                                   CSW200
     C                     MOVE '1'       *IN11                           CSW200
     C                     EXSR CODE                                      CSW200
      *
      **  Obtain transaction reference of previous MT320                                      190127
     C                     MOVELMGTNUM    HSTRAN                                              190127
     C                     MOVE '320'     HSMTPY                                              190127
      *                                                                                       190127
     C                     MOVE HSTRAN    @HTRN   6                                           190127
      *                                                                                       190127
     C           HSKEY     SETGTMGHISTL0                                                      190127
     C                     READPMGHISTL0                 56                                   190127
      *                                                                                       190127
     C           *IN56     IFEQ '0'                                                           190127
     C           HSMODI    ANDEQMGMODI                                                        190127
     C           HSTRAN    ANDEQ@HTRN                                                         190127
     C           HSMTPY    ANDEQ'320'                                                         190127
     C                     MOVEL@HREF     @TRNB                                               190127
     C                     END                                                                190127
      *
     C           MGMATU    IFNE 'C'                                       CSW200
     C           MGMATU    ANDNE'I'                                       CSW200
     C           CWRD      IFEQ 'NEW'                                     CSW200
     C                     MOVEL'NEW'     MFLD                            CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
     C           MGROTN    IFNE *ZEROS                                    CSW200
     C           *IN11     ANDEQ'1'                                       CSW200
     C           HSWS      ANDEQ'001'                                                         260362
      *                                                                                       260362
     C                     MOVELMGROTN    JTRAN                                               260362
     C                     CALL 'MG5000'               26                                     260362
     C                     PARM MGMODI    JMODI   2                                           260362
     C                     PARM           JTRAN  15                                           260362
     C                     PARM 'CE'      JPROG   2                                           260362
     C                     PARM 'N'       JMODE   1                                           260362
     C                     PARM *ZEROS    JCFSEQ  30                                          260362
     C                     PARM *ZEROS    JPRSEQ  30                                          260362
     C                     PARM *BLANKS   JERCD   1                                           260362
      *                                                                                       260362
     C           JERCD     IFNE 'Y'                                                           260362
     C                     MOVELMGMODI    MISSB   8                                           260362
     C                     MOVE MGROTN    MISSB                                               260362
     C                     MOVELMISSB     TURNIP 11                                           260362
     C                     Z-ADDJCFSEQ    CFSEQ                                               260362
     C                     MOVE CFSEQ     TURNIP                                              260362
     C                     MOVELTURNIP    MFLD                                                260362
     C                     ELSE                                                               260362
     C                     MOVELMGROTN    MFLD                            CSW200
     C                     ENDIF                                                              260362
      *                                                                                       260362
     C                     ELSE                                           CSW200
     C                     MOVEL@TRNB     MFLD                            CSW200
     C                     ENDIF                                          CSW200
     C                     ENDIF                                          CSW200
     C                     ELSE                                           CSW200
     C                     MOVEL@TRNB     MFLD                            CSW200
      *                                                                                       246354
     C           MFLD      IFEQ *BLANKS                                                       246354
     C                     MOVEL'NOREF'   MFLD                                                246354
     C                     ENDIF                                                              246354
      *                                                                                       246354
     C                     ENDIF                                          CSW200
     C/COPY WNCPYSRC,MG0320C051
      *                                                                   CSW200
     C                     MOVEL':21:'    MTAG                            CSW200
      *                                                                   CSW200
      ** FIELD :22: - Code/Common Reference.                              CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE *BLANKS   ZCREF                           CSW200
      *                                                                   CSW200
      **  If SWIFT network, use sender & destination customer swift ad.   CSW200
      **  and the exchange rate to produce the common reference. Else     CSW200
      **  use the message TRN.                                            CSW200
      *                                                                   CSW200
     C           NWRK      IFEQ 'SWIFT'                                   CSW200
     C           NWRK      OREQ 'STTX'                                    CSW200
      *                                                                   CSW200
     C           NWRK      IFEQ 'SWIFT'                                   CSW200
     C                     MOVELNWSN      ZSSWI                           CSW200
     C                     MOVELNWDS      ZDSWI                           CSW200
     C                     ELSE                                           CSW200
     C                     MOVELSCSID     ZSSWI                           CSW200
     C                     MOVELCSID      ZDSWI                           CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
     C                     MOVE MGINTR    ZRATE                           CSW200
      *                                                                   CSW200
      **  Format SWIFT common reference                                   CSW200
      *                                                                   CSW200
     C                     CALL 'ZM0020'               15                 CSW200
     C                     PARM           ZSSWI  12                       CSW200
     C                     PARM           ZDSWI  12                       CSW200
     C                     PARM           ZRATE  138                      CSW200
     C                     PARM           ZCREF  16                       CSW200
      *                                                                   CSW200
      ** If the program ends in error.                                    CSW200
      *                                                                   CSW200
     C           *IN15     IFEQ '1'                                       CSW200
     C           *LOCK     IN   LDA                                       CSW200
     C                     MOVE '009'     DBASE              * * * * * * *CSW200
     C                     MOVEL'       ' DBKEY              * DBERR 009 *CSW200
     C                     MOVEL'ZM0020'  DBFILE             * * * * * * *CSW200
     C                     OUT  LDA                                       CSW200
     C                     EXSR *PSSR                                     CSW200
     C                     END                                            CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
     C           O@SWSN    IFNE *BLANKS                                   CSW200
     C           O@SWDS    ANDNE*BLANKS                                   CSW200
      *                                                                   CSW200
     C                     MOVE MGINTR    ZRATE                           CSW200
     C                     MOVELO@SWSN    ZSSWI                           CSW200
     C                     MOVELO@SWDS    ZDSWI                           CSW200
      *                                                                   CSW200
      **  Format SWIFT common reference                                   CSW200
      *                                                                   CSW200
     C                     CALL 'ZM0020'               15                 CSW200
     C                     PARM           ZSSWI  12                       CSW200
     C                     PARM           ZDSWI  12                       CSW200
     C                     PARM           ZRATE  138                      CSW200
     C                     PARM           ZCREF  16                       CSW200
      *                                                                   CSW200
     C           *IN15     IFEQ '1'                                       CSW200
     C           *LOCK     IN   LDA                                       CSW200
     C                     MOVE '005'     DBASE                           CSW200
     C                     MOVEL'       ' DBKEY                           CSW200
     C                     MOVEL'ZM0020'  DBFILE                          CSW200
     C                     OUT  LDA                                       CSW200
     C                     EXSR *PSSR                                     CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C           ZCREF     IFEQ *BLANKS                                   CSW200
     C                     MOVEL@TRNA     ZCREF                           CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
      **  If change type indicates reversal, codeword equals 'CANCEL'     CSW200
      *                                                                   CSW200
     C           MGCHTP    IFEQ 'C'                                       CSW200
     C                     MOVEL'CANCEL  'CWRD                            CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
      ** FIELD 22A   'Type of operation '                                 CSW200
      *                                                                   CSW200
     C                     SELEC                                          CSW200
      *                                                                   CSW200
     C           CWRD      WHEQ 'AMEND'                                   CSW200
     C********** MGMATU    IFEQ 'C'                                                  CSW200 MD034675
     C**********           MOVEL'NEWT'    MFLD                                       CSW200 MD034675
     C**********           ELSE                                                      CSW200 MD034675
     C                     MOVEL'AMND'    MFLD                            CSW200
     C                     MOVE 'Y'       WAMND                                             AR916823
     C**********           ENDIF                                                     CSW200 MD034675
      *                                                                   CSW200
     C           CWRD      WHEQ 'CANCEL'                                  CSW200
     C                     MOVEL'CANC'    MFLD                            CSW200
      *                                                                   CSW200
     C           CWRD      WHEQ 'NEW'                                     CSW200
     C           CWRD      OREQ 'ROLLOVER'                                CSW200
     C                     MOVEL'NEWT'    MFLD                            CSW200
     C                     ENDSL                                          CSW200
      *                                                                                     AR694628
      ** If fixed deposit has a SC amendment 22A should be AMND                             AR694628
      *                                                                                     AR694628
     C           MGEVTP    IFEQ 'SC'                                                        AR694628
     C           MGEVTP    OREQ 'EM'                                                        AR598353
     C           MGEVTP    OREQ 'PI'                                                        MD034675
     C           MGEVTP    OREQ 'PD'                                                        MD034675
     C           MGEVTP    OREQ 'BC'                                                        MD034675
     C                     MOVEL'AMND'    MFLD                                              AR694628
     C                     ENDIF                                                            AR694628
      *                                                                   CSW200
     C                     MOVEL':22A:'   MTAG                            CSW200
      *                                                                                       CSW024
      **  If corporate customer output :94A:                                                  CSW024
     C           CSW024    IFEQ 'Y'                                                           CSW024
     C           DSCORP    ANDEQ'Y'                                                           CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C                     MOVE *BLANK    MFLD                                                CSW024
     C                     MOVEL'AGNT'    MFLD                                                CSW024
     C                     MOVE ':94A:'   MTAG                                                CSW024
     C                     ENDIF                                                              CSW024
      *                                                                   CSW200
      ** Field 22B 'Type of events'                                       CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     SELEC                                          CSW200
      *                                                                   CSW200
     C********** MGEVTP    WHEQ 'SC'                                                 245960 MD034675
     C           MGEVTP    WHEQ 'EM'                                                        MD034675
     C***********          MOVEL'CINT'    MFLD                                         245960 261382
     C                     MOVEL'CONF'    MFLD                                                261382
     C                     MOVE 'CONF'    WRK22B                                            AR908919
      *                                                                                       245960
     C********** MGMATU    WHEQ 'C'                                                  CSW200 MD034675
     C           MGMATU    WHEQ 'I'                                                         MD034675
     C********** MGMATU    OREQ 'I'                                                  CSW200 MD034675
     C                     MOVEL'MATU'    MFLD                            CSW200
      *                                                                   CSW200
     C           CWRD      WHEQ 'NEW'                                     CSW200
     C                     MOVEL'CONF'    MFLD                            CSW200
      *                                                                   CSW200
     C           CWRD      WHEQ 'ROLLOVER'                                CSW200
     C                     MOVEL'ROLL'    MFLD                            CSW200
      *                                                                   CSW200
     C           CWRD      WHEQ 'CANCEL'                                  CSW200
     C           CWRD      OREQ 'AMEND'                                   CSW200
     C           ##CWRD    IFEQ *BLANKS                                   CSW200
     C                     MOVEL'CONF'    MFLD                            CSW200
     C                     ELSE                                           CSW200
     C                     MOVEL'ROLL'    MFLD                            CSW200
     C                     ENDIF                                          CSW200
     C                     ENDSL                                          CSW200
      *                                                                   CSW200
     C                     MOVEL':22B:'   MTAG                            CSW200
      *                                                                   CSW200
      **  FIELD 22C 'Common reference'                                    CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
      *                                                                   CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVELZCREF     MFLD                            CSW200
      *                                                                   CSW200
     C                     MOVEL':22C:'   MTAG                            CSW200
      *                                                                                       CSW024
      **  If corporate customer output :21N:                                                  CSW024
     C           CSW024    IFEQ 'Y'                                                           CSW024
     C           DSCORP    ANDEQ'Y'                                                           CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C                     MOVE *BLANK    MFLD                                                CSW024
     C                     MOVEL@TRNA     WK8     8                                           CSW024
     C                     MOVELWK8       MFLD                                                CSW024
     C                     MOVE ':21N:'   MTAG                                                CSW024
     C                     ENDIF                                                              CSW024
      *                                                                                       CSW201
      ** FIELD 82A 'Party A'                                                                  CSW201
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
      *                                                                                       CSW201
     C                     ADD  1         X                                                   CSW201
     C           X         OCUR MULT                                                          CSW201
      *                                                                                       CSW201
      ** Validate branch                                                                      CSW201
      *                                                                                       CSW201
     C**********           CALL 'AOBRCHR0'                                             CSW201 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD                                               CSW201
     C                     PARM '*KEY   ' @OPTN                                               CSW201
     C                     PARM MGBRCA    @BRCD                                               CSW201
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CSW201
      *                                                                                       CSW201
      ** Branch record not found - Error                                                      CSW201
      *                                                                                       CSW201
     C           @RTCD     IFNE *BLANKS                                                       CSW201
     C           *LOCK     IN   LDA                                                           CSW201
     C                     MOVE '033'     DBASE                                               CSW201
     C                     MOVELMGROBR    DBKEY                                               CSW201
     C                     MOVEL'SDBRCHPD'DBFILE                                              CSW201
     C                     OUT  LDA                                                           CSW201
     C                     EXSR *PSSR                                                         CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW213
     C                     MOVE *BLANKS   WBICN   6                                           CSW213
     C                     MOVELA8BICN    WBICN                                               CSW213
      *                                                                                       CSW201
     C           @RTCD     IFEQ *BLANKS                                                       CSW201
     C                     MOVE *BLANKS   ZDEST                                               CSW201
     C                     MOVELA8BICN    ZDEST                                               CSW201
     C                     MOVE *BLANKS   ACLINE                                              CSW201
     C                     MOVE ' '       TAG                                                 CSW201
     C                     MOVE '82'      FLDNO                                               CSW201
     C                     EXSR FSWAD                                                         CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     ENDIF                                                              CSW024
      *                                                                                       CSW024
      **  If corporate customer...                                                            CSW024
     C           CSW024    IFEQ 'Y'                                                           CSW024
     C           DSCORP    ANDEQ'Y'                                                           CSW024
      *                                                                                       CSW024
      **  If BEI output :87A:                                                                 CSW024
     C           DSCBEI    IFNE *BLANK                                                        CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C                     MOVE *BLANK    MFLD                                                CSW024
     C                     MOVELDSCBEI    MFLD                                                CSW024
     C                     MOVE ':87A:'   MTAG                                                CSW024
     C                     ADD  1         V                                                   260931
     C           V         OCUR EXTN                                                          260931
     C                     Z-ADDX         MPSN                                                260931
     C                     MOVELMTAG      MTG                                                 260931
     C                     MOVELMGCNUM    MCSI                                                260931
      *                                                                                       CSW024
      **  If receiver party info output :87J:                                                 CSW024
     C                     ELSE                                                               CSW024
     C           DSRI01    IFNE *BLANK                                                        CSW024
     C           DSRI02    ORNE *BLANK                                                        CSW024
     C           DSRI03    ORNE *BLANK                                                        CSW024
     C           DSRI04    ORNE *BLANK                                                        CSW024
     C           DSRI05    ORNE *BLANK                                                        CSW024
      *                                                                                       CSW024
     C                     MOVE *BLANK    DN87    1                                           CSW024
     C           DSRI01    IFNE *BLANK                                                        CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C           DN87      IFNE 'Y'                                                           CSW024
     C                     MOVE ':87J:'   MTAG                                                CSW024
     C                     MOVE 'Y'       DN87                                                CSW024
     C                     ENDIF                                                              CSW024
     C                     MOVE *BLANK    MFLD                                                CSW024
     C                     MOVELDSRI01    MFLD                                                CSW024
     C                     ENDIF                                                              CSW024
     C           DSRI02    IFNE *BLANK                                                        CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C           DN87      IFNE 'Y'                                                           CSW024
     C                     MOVE ':87J:'   MTAG                                                CSW024
     C                     MOVE 'Y'       DN87                                                CSW024
     C                     ENDIF                                                              CSW024
     C                     MOVE *BLANK    MFLD                                                CSW024
     C                     MOVELDSRI02    MFLD                                                CSW024
     C                     ENDIF                                                              CSW024
     C           DSRI03    IFNE *BLANK                                                        CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C           DN87      IFNE 'Y'                                                           CSW024
     C                     MOVE ':87J:'   MTAG                                                CSW024
     C                     MOVE 'Y'       DN87                                                CSW024
     C                     ENDIF                                                              CSW024
     C                     MOVE *BLANK    MFLD                                                CSW024
     C                     MOVELDSRI03    MFLD                                                CSW024
     C                     ENDIF                                                              CSW024
     C           DSRI04    IFNE *BLANK                                                        CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C           DN87      IFNE 'Y'                                                           CSW024
     C                     MOVE ':87J:'   MTAG                                                CSW024
     C                     MOVE 'Y'       DN87                                                CSW024
     C                     ENDIF                                                              CSW024
     C                     MOVE *BLANK    MFLD                                                CSW024
     C                     MOVELDSRI04    MFLD                                                CSW024
     C                     ENDIF                                                              CSW024
     C           DSRI05    IFNE *BLANK                                                        CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C           DN87      IFNE 'Y'                                                           CSW024
     C                     MOVE ':87J:'   MTAG                                                CSW024
     C                     MOVE 'Y'       DN87                                                CSW024
     C                     ENDIF                                                              CSW024
     C                     MOVE *BLANK    MFLD                                                CSW024
     C                     MOVELDSRI05    MFLD                                                CSW024
     C                     ENDIF                                                              CSW024
      *                                                                                       CSW024
      ** Else output :87D:                                                                    CSW024
     C                     ELSE                                                               CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C                     MOVE ':87D:'   MTAG                                                CSW024
     C                     MOVELDSCNA1    MFLD                                                CSW024
      **  Address 2                                                                           CSW024
     C           DSCNA2    IFNE *BLANKS                                                       CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C                     MOVELDSCNA2    MFLD                                                CSW024
     C                     ENDIF                                                              CSW024
      **  Address 3                                                                           CSW024
     C           DSCNA3    IFNE *BLANKS                                                       CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C                     MOVELDSCNA3    MFLD                                                CSW024
     C                     ENDIF                                                              CSW024
      **  Address 4                                                                           CSW024
     C           DSCNA4    IFNE *BLANKS                                                       CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C                     MOVELDSCNA4    MFLD                                                CSW024
     C                     ENDIF                                                              CSW024
      *                                                                                       CSW024
     C                     ENDIF                                                              CSW024
     C                     ENDIF                                                              CSW024
      *                                                                                       CSW024
     C                     ELSE                                                               CSW024
      *                                                                                       CSW024
     C           CSW201    IFEQ 'Y'                                                           CSW024
      ** FIELD 87A 'Party B'                                                                  CSW201
      *                                                                                       CSW201
     C                     ADD  1         X                                                   CSW201
     C           X         OCUR MULT                                                          CSW201
     C                     MOVE *BLANKS   ZDEST                                               CSW201
     C                     MOVELMGCNUM    ZDEST                                               CSW201
     C                     MOVE *BLANKS   ACLINE                                              CSW201
     C                     MOVE ' '       TAG                                                 CSW201
     C                     MOVE '87'      FLDNO                                               CSW201
     C                     EXSR FSWAD                                                         CSW201
      *                                                                                       CSW201
     C                     ENDIF                                                              CSW024
     C                     ENDIF                                                              CSW201
      *                                                                   CSW200
      **  Output :83J:                                                                        CSW024
     C********** CSW024    IFEQ 'Y'                                                    CSW024 CSW213
     C********** DSFUND    ANDNE*BLANK                                                 CSW024 CSW213
     C**********           ADD  1         X                                            CSW024 CSW213
     C********** X         OCUR MULT                                                   CSW024 CSW213
     C********** '/NAME/'  CAT  DSFUND    MFLD                                         CSW024 CSW213
     C**********           MOVE ':83J:'   MTAG                                         CSW024 CSW213
     C********** CSW037    IFEQ 'Y'                                                    CSW037 CSW213
     C********** DSFNAC    ANDNE*BLANK                                                 CSW037 CSW213
     C**********           ADD  1         X                                            CSW037 CSW213
     C********** X         OCUR MULT                                                   CSW037 CSW213
     C**********           MOVE ':83J:'   MTAG                                        CSW037 BUG6548
     C**********           MOVE *BLANK    MFLD                                         CSW037 CSW213
     C**********           MOVELDSFNAC    MFLD                                         CSW037 CSW213
     C**********           ENDIF                                                       CSW037 CSW213
      *                                                                                       CSW037
     C**********           ENDIF                                                       CSW024 CSW213
      *                                                                                       CSW213
      ** Format Field :83J:                                                                   CSW213
      *                                                                                       CSW213
     C                     EXSR FMT83                                                         CSW213
      *                                                                                       CSW024
      **  FIELD 77D 'Fiduciary Confirmation'                              CSW200
      *                                                                   CSW200
     C           CDL006    IFEQ 'Y'                                       CSW200
      *                                                                   CSW200
     C           MGTTYP    IFEQ 'FL'                                      CSW200
     C           MGTTYP    OREQ 'FT'                                      CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVEL'/FIDU/'  MFLD                            CSW200
     C                     MOVEL':77D:'   MTAG                            CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ENDIF                                          CSW200
      *                                                                                       CSW208
      **  Add Floating Rate code                                                              CSW208
      *                                                                                       CSW208
     C           CSW208    IFEQ 'Y'                                                           CSW208
     C           MGFLTR    ANDEQ'Y'                                                           CSW208
     C                     ADD  1         X                                                   CSW208
     C           X         OCUR MULT                                                          CSW208
     C                     MOVEL'/FLTR/'  MFLD                                                CSW208
     C                     MOVEL':77D:'   MTAG                                                CSW208
     C                     ENDIF                                                              CSW208
      *                                                                   CSW200
      **  Codeword blank                                                  CSW200
      *                                                                   CSW200
     C           CWRD      IFEQ *BLANKS                                   CSW200
     C                     MOVE 'Y'       @ERR                            CSW200
     C                     MOVEAMSGA,7    MERR                            CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
     C                     ENDSR                                          CSW200
     C/EJECT                                                              CSW200
      *****************************************************************   CSW200
      *   FMB200 - Format Dates fields - Sequence B                   *   CSW200
      *            This subroutine is similar to DATES with the       *   CSW200
      *            following changes.                                 *   CSW200
      *            New Fields:                                        *   CSW200
      *             - :15B: Beginning of sequence B                   *   CSW200
      *             - :17R: Party A's role                            *   CSW200
      *             - :30T: similar to the old field 30               *   CSW200
      *             - :30V: date part of old 32 or 33 if a rollover   *   CSW200
      *             - :30P: similar to the old field 31C              *   CSW200
      *             - :32B: contains the amount part of the old 32    *   CSW200
      *             - :32H: contains the amount part of the old 33    *   CSW200
      *             - :30X: contains the date part of the old 34      *   CSW200
      *             - :34E: contains the amount part of the old 34    *   CSW200
      *             - :37G: contains the rate part of the old 37      *   CSW200
      *             - :14D: contains Day Count Faction(opt. letter 37)*   CSW200
      *             - :30F: contains the date part of the old 37      *   CSW200
      *             - :38J: Number of days te part of the old 37      *   CSW200
      *                                                               *   CSW200
      *   Called by - main process                                    *   CSW200
      *   Calls     -                                                 *   CSW200
      *****************************************************************   CSW200
      *                                                                   CSW200
     C           FMB200    BEGSR                                          CSW200
      *                                                                   CSW200
      **  FIELD :15B: New Sequence                                        CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE *BLANKS   MFLD                            CSW200
     C                     MOVE ':15B:'   MTAG                            CSW200
      *                                                                   CSW200
      **  FIELD :17R: Party's A role                                      CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE *BLANKS   MFLD                            CSW200
     C           MGLORD    IFEQ 'L'                                       CSW200
     C                     MOVEL'L'       MFLD                            CSW200
     C                     ELSE                                           CSW200
     C                     MOVEL'B'       MFLD                            CSW200
     C                     ENDIF                                          CSW200
     C                     MOVE ':17R:'   MTAG                            CSW200
      *                                                                   CSW200
      **  FIELD :30T:  Trade Date                                         CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE MGTDAT    ZMDAY                           CSW200
      *                                                                   CSW200
      **  Convert Midas date to SWIFT date format                         CSW200
      *                                                                   CSW200
     C                     CALL 'ZM0065'               15                 CSW200
     C                     PARM           ZMDAY   50                      CSW200
     C                     PARM           ZSDATE  6                       CSW200
     C                     PARM           ZSDATC  8                       CSW200
      *                                                                   CSW200
      **  Call ended in error. (Program not found.)                       CSW200
      *                                                                   CSW200
     C           *IN15     IFEQ '1'                                       CSW200
     C           *LOCK     IN   LDA                                       CSW200
     C                     MOVE '029'     DBASE              * * * * * * *CSW200
     C                     MOVELZMDAY     DBKEY              * DBERR 029 *CSW200
     C                     MOVEL'ZM0065'  DBFILE             * * * * * * *CSW200
     C                     OUT  LDA                                       CSW200
     C                     EXSR *PSSR                                     CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
     C                     MOVE ':30T:'   MTAG                            CSW200
     C                     MOVELZSDATC    MFLD                            CSW200
      *                                                                   CSW200
      **  FIELD :30V:  Value Date                                         CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE MGVDAT    ZMDAY                           CSW200
      *                                                                   CSW200
      **  Convert Midas date to SWIFT date format                         CSW200
      *                                                                   CSW200
     C                     CALL 'ZM0065'               15                 CSW200
     C                     PARM           ZMDAY   50                      CSW200
     C                     PARM           ZSDATE  6                       CSW200
     C                     PARM           ZSDATC  8                       CSW200
      *                                                                   CSW200
     C                     MOVE ':30V:'   MTAG                            CSW200
     C                     MOVELZSDATC    MFLD                            CSW200
      *                                                                   CSW200
      **  FIELD :30P:  Maturity Date                                      CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE MGMDAT    ZMDAY                           CSW200
      *                                                                   CSW200
      **  Convert Midas date to SWIFT date format                         CSW200
      *                                                                   CSW200
     C                     CALL 'ZM0065'               15                 CSW200
     C                     PARM           ZMDAY   50                      CSW200
     C                     PARM           ZSDATE  6                       CSW200
     C                     PARM           ZSDATC  8                       CSW200
      *                                                                   CSW200
     C                     MOVE ':30P:'   MTAG                            CSW200
     C                     MOVELZSDATC    MFLD                            CSW200
      *                                                                   CSW200
      **  FIELD :32B: Principal Amount                                    CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
      **  Format currency code and contract amount.                       CSW200
      *                                                                   CSW200
     C/COPY WNCPYSRC,MG0320C068
     C                     MOVE MGCCY     ZCCY                            CSW200
     C                     MOVE MGPCPL    ZAMNT                           CSW200
     C                     CALL 'ZM0040'                                  CSW200
     C                     PARM           ZAMNT  130                      CSW200
     C                     PARM           ZCCY    3                       CSW200
     C                     PARM           ZSAMNT 15                       CSW200
     C                     PARM           ZSCCY   3                       CSW200
     C                     PARM           ZERR    1                       CSW200
     C                     PARM           ZSWDPC                                              222373
     C/COPY WNCPYSRC,MG0320C071
      *                                                                   CSW200
     C                     MOVE ':32B:'   MTAG                            CSW200
      *                                                                   CSW200
     C           ZSCCY     CAT  ZSAMNT:0  MFLD                            CSW200
      *                                                                   CSW200
      ** FIELD :32H: - Amount to be Settled                               CSW200
      *                                                                   CSW200
      ** Rollover deal number is non-zero.                                CSW200
      *                                                                   CSW200
      ** Code words to include Field 33 are - ROLDEC, ROLINC, ROLINCIN,   CSW200
      **      ROLDECIN, ROLSAM and ROLSAMIN.                              CSW200
      *                                                                   CSW200
     C           CWRD      IFEQ 'ROLDEC'                                  CSW200
     C           CWRD      OREQ 'ROLINC'                                  CSW200
     C           CWRD      OREQ 'ROLINCIN'                                CSW200
     C           CWRD      OREQ 'ROLDECIN'                                CSW200
     C           ##CWRD    OREQ 'ROLDEC'                                  CSW200
     C           ##CWRD    OREQ 'ROLINC'                                  CSW200
     C           ##CWRD    OREQ 'ROLDECIN'                                CSW200
     C           ##CWRD    OREQ 'ROLINCIN'                                CSW200
     C           CWRD      OREQ 'ROLSAMIN'                                CSW200
     C           ##CWRD    OREQ 'ROLSAMIN'                                CSW200
     C           CWRD      OREQ 'ROLSAM  '                                CSW200
     C           ##CWRD    OREQ 'ROLSAM  '                                CSW200
     C           MGMATU    OREQ 'C'                                       CSW200
     C           MGMATU    OREQ 'I'                                       CSW200
      *                                                                   CSW200
     C           MGROTN    IFNE 0                                         CSW200
     C           MGMATU    OREQ 'C'                                       CSW200
     C           MGEVTP    ANDNE'EM'                                                        AR908919
     C           MGMATU    OREQ 'C'                                                         AR908919
     C           MGEVTP    ANDEQ'EM'                                                        AR908919
     C           WRK22B    ANDNE'CONF'                                                      AR908919
     C           MGMATU    OREQ 'I'                                       CSW200
      *                                                                   CSW200
      **  Format purchase currency and rollover amount.                   CSW200
      *                                                                   CSW200
     C                     MOVE MGCCY     ZCCY                            CSW200
     C           CWRD      IFEQ 'ROLDEC'                                  CSW200
     C           ##CWRD    OREQ 'ROLDEC'                                  CSW200
     C           MGROTA    SUB  MGPCPL    ZAMNT                           CSW200
     C                     END                                            CSW200
     C           CWRD      IFEQ 'ROLINC'                                  CSW200
     C           ##CWRD    OREQ 'ROLINC'                                  CSW200
     C           MGPCPL    SUB  MGROTA    ZAMNT                           CSW200
     C                     END                                            CSW200
     C           CWRD      IFEQ 'ROLDECIN'                                CSW200
     C           ##CWRD    OREQ 'ROLDECIN'                                CSW200
     C           WKPCPL    SUB  MGPCPL    ZAMNT                           CSW200
     C                     END                                            CSW200
     C           CWRD      IFEQ 'ROLINCIN'                                CSW200
     C           ##CWRD    OREQ 'ROLINCIN'                                CSW200
     C           MGPCPL    SUB  WKPCPL    ZAMNT                           CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
     C           CWRD      IFEQ 'ROLSAMIN'                                CSW200
     C           ##CWRD    OREQ 'ROLSAMIN'                                CSW200
     C           CWRD      OREQ 'ROLSAM  '                                CSW200
     C           ##CWRD    OREQ 'ROLSAM  '                                CSW200
     C                     Z-ADD*ZEROS    ZAMNT                           CSW200
     C                     END                                            CSW200
     C***********                                                         232540              233056
     C***********CWRD      IFEQ 'ROLSAM  '                                232540              233056
     C***********CSW205    ANDEQ'Y'                                       232540              233056
     C***********INT32H    ANDEQ'Y'                                       232540              233056
     C***********##CWRD    OREQ 'ROLSAM  '                                232540              233056
     C***********CSW205    ANDEQ'Y'                                       232540              233056
     C***********INT32H    ANDEQ'Y'                                       232540              233056
     C***********          Z-ADDMGTTLI    ZAMNT                           232540              233056
     C***********          ENDIF                                          232540              233056
      *                                                                   CSW200
     C           MGMATU    IFEQ 'C'                                       CSW200
     C           MGMATU    OREQ 'I'                                       CSW200
     C                     Z-ADDMGAMTT    ZAMNT                           CSW200
     C/COPY WNCPYSRC,MGH00098
      *                                                                   CSW200
     C           MGMODI    IFEQ 'DL'                                      CSW200
     C           S01434    ANDEQ'Y'                                       CSW200
     C           MGIPDS    ANDEQ'Y'                                       CSW200
      ** Interest is paid seperately                                      CSW200
      *                                                                   CSW200
     C           MGLORD    IFEQ 'L'                                       CSW200
     C           MGIMET    IFNE *BLANKS                                   CSW200
     C                     MOVE MGRSTM    WK2     2                       CSW200
     C           MGIMET    IFNE WK2                                       CSW200
     C           MGINSA    ORNE MGRONS                                    CSW200
     C           MGAMTT    SUB  MGINTA    ZAMNT                           CSW200
     C/COPY WNCPYSRC,MGH00099
     C                     ENDIF                                          CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
      * This is a deposit                                                 CSW200
     C           MGIMET    IFNE *BLANKS                                   CSW200
      * Default the counterparty nostro if not input                      CSW200
     C           MGINOS    IFEQ *BLANKS                                   CSW200
     C                     MOVELMGAWBN    MGINOS                          CSW200
     C                     ENDIF                                          CSW200
     C                     MOVE MGPSTM    WK2     2                       CSW200
     C           MGIMET    IFNE WK2                                       CSW200
     C           MGINSA    ORNE MGPONS                                    CSW200
     C           MGINOS    ORNE MGAWBN                                    CSW200
     C           MGAMTT    SUB  MGINTA    ZAMNT                           CSW200
     C/COPY WNCPYSRC,MGH00100
     C                     ENDIF                                          CSW200
     C                     ENDIF                                          CSW200
     C                     ENDIF                           MGLORD = 'L'   CSW200
     C                     ENDIF                           MGMODI = 'DL'? CSW200
     C                     ENDIF                           MGMATU = I/C   CSW200
     C/COPY WNCPYSRC,MGH00101
      *                                                                   CSW200
     C           MGLORD    IFEQ 'L'                                       CSW200
     C                     MOVE 'R'       WKTYPE  1                       CSW200
     C                     ELSE                                           CSW200
     C                     MOVE 'P'       WKTYPE                          CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C           MGTTYP    IFEQ 'IP'                                      CSW200
     C           CWRD      ANDEQ'ROLINC  '                                CSW200
     C           MGTTYP    OREQ 'IP'                                      CSW200
     C           CWRD      ANDEQ'ROLINCIN'                                CSW200
     C           MGTTYP    OREQ 'IT'                                      CSW200
     C           CWRD      ANDEQ'ROLDEC  '                                CSW200
     C           MGTTYP    OREQ 'IT'                                      CSW200
     C           CWRD      ANDEQ'ROLDECIN'                                CSW200
     C           MGTTYP    OREQ 'IP'                                      CSW200
     C           ##CWRD    ANDEQ'ROLINC  '                                CSW200
     C           MGTTYP    OREQ 'IP'                                      CSW200
     C           ##CWRD    ANDEQ'ROLINCIN'                                CSW200
     C           MGTTYP    OREQ 'IT'                                      CSW200
     C           ##CWRD    ANDEQ'ROLDEC  '                                CSW200
     C           MGTTYP    OREQ 'IT'                                      CSW200
     C           ##CWRD    ANDEQ'ROLDECIN'                                CSW200
     C                     MOVE 'P'       WKTYPE                          CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C           MGTTYP    IFEQ 'IP'                                      CSW200
     C           CWRD      ANDEQ'ROLDEC  '                                CSW200
     C           MGTTYP    OREQ 'IP'                                      CSW200
     C           CWRD      ANDEQ'ROLDECIN'                                CSW200
     C           MGTTYP    OREQ 'IT'                                      CSW200
     C           CWRD      ANDEQ'ROLINC  '                                CSW200
     C           MGTTYP    OREQ 'IT'                                      CSW200
     C           CWRD      ANDEQ'ROLINCIN'                                CSW200
     C           MGTTYP    OREQ 'IP'                                      CSW200
     C           ##CWRD    ANDEQ'ROLDEC  '                                CSW200
     C           MGTTYP    OREQ 'IP'                                      CSW200
     C           ##CWRD    ANDEQ'ROLDECIN'                                CSW200
     C           MGTTYP    OREQ 'IT'                                      CSW200
     C           ##CWRD    ANDEQ'ROLINC  '                                CSW200
     C           MGTTYP    OREQ 'IT'                                      CSW200
     C           ##CWRD    ANDEQ'ROLINCIN'                                CSW200
     C                     MOVE 'R'       WKTYPE                          CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C           MGMATU    IFEQ 'C'                                       CSW200
     C           MGMATU    OREQ 'I'                                       CSW200
     C           MGLORD    IFEQ 'L'                                       CSW200
      *                                                                   CSW200
     C                     MOVE 'R'       WKTYPE                          CSW200
     C           ZAMNT     IFLE 0                                         CSW200
     C                     Z-ADD0         ZAMNT                           CSW200
     C                     ENDIF                                          CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
     C                     MOVE 'P'       WKTYPE                          CSW200
     C           ZAMNT     IFLE 0                                         CSW200
     C                     Z-ADD0         ZAMNT                           CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ENDIF                                          CSW200
     C                     ENDIF                                          CSW200
     C/COPY WNCPYSRC,MG0320C069
      *                                                                                     AR694628
      ** If fixed depost has SC amendment 32H should be zero.                               AR694628
      *                                                                                     AR694628
     C           MGEVTP    IFEQ 'SC'                                                        AR694628
     C           MGEVTP    OREQ 'EM'                                                        AR598353
     C                     Z-ADD0         ZAMNT                                             AR694628
     C                     ENDIF                                                            AR694628
      *                                                                   CSW200
     C                     CALL 'ZM0040'                                  CSW200
     C                     PARM           ZAMNT  130                      CSW200
     C                     PARM           ZCCY    3                       CSW200
     C                     PARM           ZSAMNT 15                       CSW200
     C                     PARM           ZSCCY   3                       CSW200
     C                     PARM           ZERR    1                       CSW200
     C                     PARM           ZSWDPC                                              222373
     C           MGEVTP    IFEQ 'SC'                                                        MD034675
     C           MGEVTP    OREQ 'BC'                                                        MD034675
     C           MGEVTP    OREQ 'PI'                                                        MD034675
     C           MGEVTP    OREQ 'PD'                                                        MD034675
     C                     ELSE                                                             MD034675
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C                     MOVE ':32H:'   MTAG                            CSW200
     C           ZSCCY     CAT  ZSAMNT:0  MFLD                            CSW200
     C           WKTYPE    IFEQ 'R'                                       CSW200
     C           ZAMNT     ANDNE*ZERO                                     CSW200
     C           'N'       CAT  MFLD      MFLD                            CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ENDIF                                                            MD034675
     C                     END                                            CSW200
     C*                                                                   CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
      ** FIELD :30X: - Next Interest Due Date.                            CSW200
      *        :34E: - Interest Amount                                    CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C                     MOVE ' '       ASFUID                          CSW200
      *                                                                   CSW200
     C           MGMODI    IFEQ 'DL'                                      CSW200
      *                                                                   CSW200
      ** If Front-up interest for this deal type, use full interest       CSW200
      ** amount                                                           CSW200
      *                                                                   CSW200
     C                     CALL 'AODLSTR0'                                CSW200
     C                     PARM '*MSG   ' @RTCD                           CSW200
     C                     PARM '*KEY   ' @OPTN   7                       CSW200
     C                     PARM MGTSTP    @AQCD   2                       CSW200
     C           SDDLST    PARM SDDLST    DSFDY                           CSW200
      *                                                                   CSW200
      ** Deal sub-type record not found                                   CSW200
      *                                                                   CSW200
     C           @RTCD     IFNE *BLANKS                                   CSW200
     C                     MOVE ' '       ASFUID                          CSW200
     C                     END                                            CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C           ASFUID    IFEQ 'Y'                                       CSW200
     C           MGMODI    ANDEQ'DL'                                      CSW200
     C                     MOVE MGTOTI    ZAMNT                           CSW200
     C                     Z-ADDMGTOTI    ZINTR                           208051
     C                     ELSE                                           CSW200
      *                                                                   CSW200
     C                     MOVELMGTNUM    WDLNO   60                                        AR916823
     C           WDLNO     CHAINDEALSC               40                                     AR916823
     C*                                                                   CSW200
     C** If no Next Interest Date use MGMDAT                              CSW200
      *                                                                   CSW200
     C           MGNIDT    IFEQ 0                                         CSW200
     C                     MOVE MGMDAT    ZMDAY                           CSW200
      *                                                                   CSW200
      **  Calculate total interest if not on file                         CSW200
     C           MGTOTI    IFEQ 0                                         CSW200
     C           *IN40     OREQ '0'                                                         AR916823
     C           MGEVTP    ANDEQ*BLANKS                                                     AR916823
      *                                                                                     AR916823
     C           *IN40     IFEQ '0'                                                         AR916823
     C                     Z-ADDFDIACD    ZIBEG                                             AR916823
     C                     ELSE                                                             AR916823
     C                     Z-ADDMGVDAT    ZIBEG                           CSW200
     C                     ENDIF                                                            AR916823
     C                     Z-ADDMGMDAT    ZIEND                           CSW200
     C                     MOVE MGICBS    ZICALC                          CSW200
     C                     Z-ADDMGINTR    ZIRATE                          CSW200
     C                     Z-ADDMGPCPL    ZIAMT                           CSW200
     C                     EXSR GLINTC                                    CSW200
     C                     Z-ADDZINTR     ZAMNT     H                     CSW200
     C           ZINTR     IFLT 0                                         CSW200
     C                     Z-SUBZINTR     ZAMNT     H                     CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
     C                     MOVE MGTOTI    ZAMNT                           CSW200
     C                     Z-ADDMGTOTI    ZINTR                           208051
     C                     END                                            CSW200
      *                                                                   CSW200
      **  Calculate part of total interest to be paid using MGNIDT        CSW200
     C                     ELSE                                           CSW200
     C                     MOVE MGNIDT    ZMDAY                           CSW200
     C           *IN40     IFEQ '0'                                                         AR916823
     C                     Z-ADDFDIACD    ZIBEG                                             AR916823
     C                     ELSE                                                             AR916823
     C                     Z-ADDMGSLID    ZIBEG                           CSW200
     C                     ENDIF                                                            AR916823
     C                     Z-ADDMGNIDT    ZIEND                           CSW200
     C                     MOVE MGICBS    ZICALC                          CSW200
     C                     Z-ADDMGINTR    ZIRATE                          CSW200
     C                     Z-ADDMGPCPL    ZIAMT                           CSW200
     C                     EXSR GLINTC                                    CSW200
     C**********           Z-ADDZINTR     ZAMNT                                               247393
     C                     Z-ADDZINTR     ZAMNT     H                                         247393
     C           ZINTR     IFLT 0                                         CSW200
     C**********           Z-SUBZINTR     ZAMNT                                               247393
     C                     Z-SUBZINTR     ZAMNT     H                                         247393
     C                     END                                            CSW200
     C                     END                                            CSW200
      *                                                                                     AR916823
     C           *IN40     IFEQ '0'                                                         AR916823
     C           ZAMNT     ADD  FDAITC    ZAMNT                                             AR916823
     C           ZAMNT     ADD  FDAIAN    ZAMNT                                             AR916823
     C           ZAMNT     ADD  FDAIAP    ZAMNT                                             AR916823
     C           ZAMNT     SUB  FDIPRD    ZAMNT                                             AR916823
     C           ZAMNT     SUB  FDICTD    ZAMNT                                             AR916823
     C                     ENDIF                                                            AR916823
      *                                                                   CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
     C********** MGMATU    IFEQ 'C'                                                  CSW200 MD051884
     C********** MGMATU    OREQ 'I'                                                  CSW200 MD051884
     C**********           Z-ADDMGINTA    ZAMNT                                      CSW200 MD051884
     C**********           Z-ADDMGINTA    ZINTR                                      CSW200 MD051884
     C********** ZINTR     IFLT 0                                                    186631 MD051884
     C**********           Z-SUBZINTR     ZAMNT                                      186631 MD051884
     C**********           END                                                       186631 MD051884
     C**********           ENDIF                                                     CSW200 MD051884
     C           MGLORD    IFEQ 'L'                                       CSW200
      *                                                                   CSW200
     C           ZINTR     IFGE *ZERO                                     CSW200
     C                     MOVE 'R'       WKTYPE                          CSW200
     C                     ELSE                                           CSW200
     C                     MOVE 'P'       WKTYPE                          CSW200
     C***********          Z-SUBZAMNT     ZAMNT                     CSW200186631
     C                     ENDIF                                          CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
     C           ZINTR     IFGE *ZERO                                     CSW200
     C                     MOVE 'P'       WKTYPE                          CSW200
     C                     ELSE                                           CSW200
     C                     MOVE 'R'       WKTYPE                          CSW200
     C***********          Z-SUBZAMNT     ZAMNT                     CSW200186631
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ENDIF                                          CSW200
      *                                                                                     AR694628
      ** When fixed deposit has SC amendment 34E should be the interest                     AR694628
      ** amount of next interest period.                                                    AR694628
      *                                                                                     AR694628
     C           MGEVTP    IFEQ 'SC'                                                        AR694628
     C           MGEVTP    OREQ 'EM'                                                        AR598353
     C           MGEVTP    OREQ 'BC'                                                        MD050459
     C                     MOVELMGTNUM    WDLNO   60                                        AR694628
     C           WDLNO     CHAINDEALSC               40                                     AR694628
     C           *IN40     IFEQ '0'                                                         AR694628
     C                     Z-ADDFDIACD    ZIBEG                                             AR694628
     C                     Z-ADDMGVDAT    ZIEND                                             AR694628
     C                     Z-ADDMGPCPL    ZIAMT                                             AR694628
     C                     Z-ADDFDINTR    ZIRATE                                            AR694628
     C                     EXSR GLINTC                                                      AR694628
     C                     Z-ADDZINTR     ZAMNT                                             AR694628
      *                                                                                     AR694628
     C           MGEVTP    IFEQ 'EM'                                                        AR598353
     C           FDNIDT    IFNE 0                                                           AR598353
     C           FDNIDT    ANDLTMGMDAT                                                      AR598353
     C                     Z-ADDFDNIDT    ZIEND                                             AR598353
     C                     ELSE                                                             AR598353
     C                     Z-ADDMGMDAT    ZIEND                                             AR598353
     C                     ENDIF                                                            AR598353
     C                     ELSE                                                             AR598353
     C           FDNIDT    IFNE 0                                                           AR694628
     C                     Z-ADDFDNIDT    ZIEND                                             AR694628
     C                     ELSE                                                             AR694628
     C                     Z-ADDFDMDAT    ZIEND                                             AR694628
     C                     ENDIF                                                            AR694628
     C                     ENDIF                                                            AR598353
     C                     Z-ADDMGPCPL    ZIAMT                                             AR694628
     C                     Z-ADDMGVDAT    ZIBEG                                             AR694628
     C                     Z-ADDMGINTR    ZIRATE                                            AR694628
     C                     EXSR GLINTC                                                      AR694628
     C           JRDFC     IFEQ 'Y'                                                         AR694628
     C           ZINTR     ADD  ZAMNT     ZAMNT                                             AR694628
     C                     ELSE                                                             AR694628
     C           ZINTR     ADD  ZAMNT     ZAMNT     H                                       AR694628
     C                     ENDIF                                                            AR694628
     C           ZAMNT     ADD  FDAITC    ZAMNT                                             AR694628
     C           ZAMNT     ADD  FDAIAN    ZAMNT                                             AR694628
     C           ZAMNT     ADD  FDAIAP    ZAMNT                                             AR694628
     C           ZAMNT     SUB  FDIPRD    ZAMNT                                             AR694628
     C           ZAMNT     SUB  FDICTD    ZAMNT                                             AR694628
     C                     ENDIF                                                            AR694628
     C                     ENDIF                                                            AR694628
      *                                                                                     MD034675
     C           MGEVTP    IFEQ 'PI'                                                        MD034675
     C           MGEVTP    OREQ 'PD'                                                        MD034675
     C********** MGEVTP    OREQ 'SC'                                              MD034675 MD034675A
     C                     MOVELMGTNUM    WDLNO   60                                        MD034675
     C           WDLNO     CHAINDEALSC               40                                     MD034675
     C           *IN40     IFEQ '0'                                                         MD034675
     C**********           Z-ADDMGVDAT    ZIBEG                                    MD034675 MD050459
     C**********           Z-ADDMGMDAT    ZIEND                                    MD034675 MD050459
     C**********           Z-ADDMGPCPL    ZIAMT                                    MD034675 MD050459
     C                     Z-ADDFDIACD    ZIBEG                                             MD050459
     C                     Z-ADDMGVDAT    ZIEND                                             MD050459
     C                     Z-ADDFDPCPL    ZIAMT                                             MD050459
     C                     Z-ADDMGINTR    ZIRATE                                            MD034675
     C                     EXSR GLINTC                                                      MD034675
     C                     Z-ADDZINTR     ZAMNT                                             MD050459
     C           FDNIDT    IFNE 0                                                           MD050459
     C                     Z-ADDFDNIDT    ZIEND                                             MD050459
     C                     ELSE                                                             MD050459
     C                     Z-ADDFDMDAT    ZIEND                                             MD050459
     C                     ENDIF                                                            MD050459
     C                     Z-ADDMGPCPL    ZIAMT                                             MD050459
     C                     Z-ADDMGVDAT    ZIBEG                                             MD050459
     C                     Z-ADDMGINTR    ZIRATE                                            MD050459
     C                     EXSR GLINTC                                                      MD050459
     C           JRDFC     IFEQ 'Y'                                                         MD050459
     C           ZINTR     ADD  ZAMNT     ZAMNT                                             MD050459
     C                     ELSE                                                             MD050459
     C           ZINTR     ADD  ZAMNT     ZAMNT     H                                       MD050459
     C                     ENDIF                                                            MD050459
     C**********           Z-ADDZINTR     INTAM  130                               MD034675 MD050459
     C                     Z-ADDZAMNT     INTAM  130                                        MD050459
      *                                                                                     MD034675
     C           INTAM     ADD  FDAITC    INTAM                                             MD034675
     C           INTAM     ADD  FDAIAN    INTAM                                             MD034675
     C           INTAM     ADD  FDAIAP    INTAM                                             MD034675
     C           INTAM     SUB  FDIPRD    INTAM                                             MD034675
     C           INTAM     SUB  FDICTD    INTAM                                             MD034675
     C********** INTAM     ADD  FDAIPD    INTAM                                   MD034675 MD034675A
     C           MGPCPL    ADD  INTAM     ZAMNT                                             MD034675
     C                     ENDIF                                                            MD034675
      *                                                                                     MD034675
     C                     Z-ADDINTAM     ZAMNT                                             MD034675
     C                     ENDIF                                                            MD034675
      *                                                                                     MD034675
      *                                                                                     MD034675
      *                                                                   CSW200
      **  Format currency and interest amount.                            CSW200
     C/COPY WNCPYSRC,MG0320C070
      *                                                                   CSW200
     C                     MOVE MGCCY     ZCCY                            CSW200
     C                     CALL 'ZM0040'                                  CSW200
     C                     PARM           ZAMNT  130                      CSW200
     C                     PARM           ZCCY    3                       CSW200
     C                     PARM           ZSAMNT 15                       CSW200
     C                     PARM           ZSCCY   3                       CSW200
     C                     PARM           ZERR    1                       CSW200
     C                     PARM           ZSWDPC                                              222373
      *                                                                   CSW200
      *                                                                   CSW200
      **  Format Next Interest date                                       CSW200
      *                                                                   CSW200
     C           MGMATU    IFNE 'C'                                       CSW200
     C           MGMATU    ANDNE'I'                                       CSW200
     C           WRK22B    OREQ 'CONF'                                                      AR908919
     C           MGEVTP    ANDEQ'EM'                                                        AR908919
     C                     CALL 'ZM0065'               15                 CSW200
     C                     PARM           ZMDAY   50                      CSW200
     C                     PARM           ZSDATE  6                       CSW200
     C                     PARM           ZSDATC  8                       CSW200
      *                                                                   CSW200
     C                     MOVEL':30X:'   MTAG                            CSW200
     C                     MOVELZSDATC    MFLD                            CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     MOVEL':34E:'   MTAG                            CSW200
     C           ZSCCY     CAT  ZSAMNT:0  MFLD                            CSW200
     C           WKTYPE    IFEQ 'R'                                       CSW200
     C           ZAMNT     ANDNE*ZERO                                     CSW200
     C           'N'       CAT  MFLD      MFLD                            CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      ** Error - indicate erroneous fields;                               CSW200
     C           ZERR      IFEQ '1'                                       CSW200
     C                     MOVE 'Y'       @ERR                            CSW200
     C                     MOVELERR3N     MFLD                            CSW200
     C                     MOVELMSGA,5    MERR                            CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
      ** FIELD :37G: - Interest Rate.                                     CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C           MGINTR    IFLT *ZERO                                     CSW200
     C                     Z-SUBMGINTR    ZINRT                           CSW200
     C                     ELSE                                           CSW200
     C                     Z-ADDMGINTR    ZINRT                           CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     CALL 'ZM0010'               15                 CSW200
     C                     PARM           ZINRT  117                      CSW200
     C                     PARM           ZSINRT 12                       CSW200
      *                                                                   CSW200
      **  Call ended in error. (Program not found.)                       CSW200
      *                                                                   CSW200
     C           *IN15     IFEQ '1'                                       CSW200
     C           *LOCK     IN   LDA                                       CSW200
     C                     MOVE '030'     DBASE              * * * * * * *CSW200
     C                     MOVEL'       ' DBKEY              * DBERR 030 *CSW200
     C                     MOVEL'ZM0010'  DBFILE             * * * * * * *CSW200
     C                     OUT  LDA                                       CSW200
     C                     EXSR *PSSR                                     CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
     C                     MOVEL':37G:'   MTAG                            CSW200
     C                     MOVELZSINRT    MFLD                            CSW200
     C           MGINTR    IFLT *ZERO                                     CSW200
     C           'N'       CAT  MFLD      MFLD                            CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      ** FIELD :14D: - Day Count Fraction                                 CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVEL':14D:'   MTAG                            CSW200
      *                                                                   CSW200
     C                     SELEC                                          CSW200
      *                                                                   CSW200
     C           MGICBS    WHEQ 1                                         CSW200
     C                     MOVEL'AFI/365' MFLD                            CSW200
      *                                                                   CSW200
     C           MGICBS    WHEQ 2                                         CSW200
     C           MGICBS    OREQ 5                                         CSW200
     C                     MOVEL'ACT/360' MFLD                            CSW200
      *                                                                   CSW200
     C           MGICBS    WHEQ 3                                         CSW200
     C                     MOVEL'360/360' MFLD                            CSW200
      *                                                                   CSW200
     C           MGICBS    WHEQ 4                                         CSW200
     C           MGICBS    OREQ 6                                         CSW200
     C                     MOVEL'ACT/365' MFLD                            CSW200
      *                                                                   CSW200
      *                                                                   CDL093
     C           MGICBS    WHEQ 9                                         CDL093
     C                     MOVE *BLANKS   WFLD13 15                       CDL093
     C                     MOVEL'ACT/ACT' WFLD13                          CDL093
     C                     MOVE '(AFB)'   WFLD13                          CDL093
     C                     MOVELWFLD13    MFLD                            CDL093
      *                                                                   CDL093
     C                     ENDSL                                          CSW200
      *                                                                   CSW200
      ** FIELD :30F: - Last day of the first interest period              CSW200
      **       :38J: - Number of days                                     CSW200
      *                                                                   CSW200
     C           MGMATU    IFNE 'C'                                       CSW200
     C           MGMATU    ANDNE'I'                                       CSW200
      *                                                                   CSW200
     C           MGNIDT    IFNE *ZERO                                     CSW200
      * :30F:                                                             CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     Z-ADDMGNIDT    ZMDAY                           CSW200
      *                                                                   CSW200
      **  Convert Midas date to SWIFT date format                         CSW200
      *                                                                   CSW200
     C                     CALL 'ZM0065'               15                 CSW200
     C                     PARM           ZMDAY   50                      CSW200
     C                     PARM           ZSDATE  6                       CSW200
     C                     PARM           ZSDATC  8                       CSW200
      *                                                                   CSW200
     C                     MOVEL':30F:'   MTAG                            CSW200
     C                     MOVELZSDATC    MFLD                            CSW200
      *                                                                   CSW200
      * :38J:                                                             CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVEL':38J:'   MTAG                            CSW200
      *                                                                   CSW200
     C                     SELEC                                          CSW200
      *                                                                   CSW200
     C           MGIPFR    WHEQ 'M'                                       CSW200
     C           MGIPFR    OREQ 'N'                                       CSW200
     C                     MOVEL'M001'    MFLD                            CSW200
      *                                                                   CSW200
     C           MGIPFR    WHEQ 'Q'                                       CSW200
     C                     MOVEL'M003'    MFLD                            CSW200
      *                                                                   CSW200
     C           MGIPFR    WHEQ 'X'                                       CSW200
     C                     MOVEL'M006'    MFLD                            CSW200
      *                                                                   CSW200
     C           MGIPFR    WHEQ 'Y'                                       CSW200
     C                     MOVEL'M012'    MFLD                            CSW200
      *                                                                   CSW200
     C           MGIPFR    WHEQ *BLANK                                    CSW200
     C                     Z-ADDMGNIDT    ZZBEG   50                      CSW200
     C                     Z-ADDMGMDAT    ZZEND   50                      CSW200
     C                     MOVE MGICBS    ZZCALC  1                       CSW200
     C                     EXSR ZINTDY                                    CSW200
      * Use only the 3 last digits.                                       CSW200
      *                                                                                       247842
     C           ZZCALC    IFEQ '6'                                                           247842
     C           ZZCALC    OREQ '9'                                                           247842
     C           #29FEB    ANDEQ'Y'                                                           247842
     C           INT6DY    DIV  1         WK3D    30                                          247842
     C                     MOVE WK3D      WK3                                                 247842
     C                     ELSE                                                               247842
     C                     MOVE ZZINDY    WK3     3                       CSW200
     C                     ENDIF                                                              247842
      *                                                                                       247842
     C           'D'       CAT  WK3       MFLD                            CSW200
      *                                                                   CSW200
     C                     ENDSL                                          CSW200
     C                     ENDIF                                          CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ENDSR                                          CSW200
     C/EJECT                                                              CSW200
      *****************************************************************   CSW200
      *   FMC200 - Format fields 53, 56 and 57 for a payment.         *   CSW200
      *            This subroutine is based on PAY, but format the    *   CSW200
      *            fields always for sequence C.                      *   CSW200
      *            New Field:                                         *   CSW200
      *             - :15C: Beginning of sequence C                   *   CSW200
      *   Called by - Main processing                                 *   CSW200
      *   Calls     - FSWAD  Format Swift Address.                    *   CSW200
      *****************************************************************   CSW200
      *                                                                   CSW200
     C           FMC200    BEGSR                                          CSW200
      *                                                                   CSW200
      ** FIELD :15C: - New Sequence                                       CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C                     MOVEL':15C:'   MTAG                            CSW200
     C                     MOVE *BLANKS   MFLD                            CSW200
      *                                                                   CSW200
     C                     MOVE *BLANKS   @WRK                            CSW200
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C                     MOVE 'Y'       ZDBEI                                               CSW201
     C                     ENDIF                                                              CSW201
      *                                                                   CSW200
      ** Field 53 - Senders correspondant.                                CSW200
      **  Test if settlement via nostro                                   CSW200
      *                                                                   CSW200
     C                     MOVE MGPSTM    @STM    2                       CSW200
     C           @STM      LOKUPTABNST                   23               CSW200
      *                                                                   CSW200
      ** If our pay nostro is not blank and the settlement is via a nostroCSW200
      *                                                                   CSW200
     C           MGPONS    IFNE *BLANKS                                   CSW200
     C           *IN23     ANDEQ'1'                                       CSW200
      *                                                                   CSW200
      **  either A/C with Bank or Receipient entered                      CSW200
      **  or DIRECT entered                                               CSW200
      *                                                                   CSW200
     C           MGAWBN    IFNE *BLANKS                                   CSW200
     C           AWBA6     OREQ 'DIRECT'                                  CSW200
     C/COPY WNCPYSRC,MG0320C056
      *                                                                   CSW200
      ** Use settlement currency to access nostro if not blank.           CSW200
      ** Otherwise use deal currency.                                     CSW200
     C           CEU003    IFEQ 'Y'                                       CSW200
     C           MGSTCY    ANDNE*BLANKS                                   CSW200
     C           CEU004    OREQ 'Y'                                       CSW200
     C           MGSTCY    ANDNE*BLANKS                                   CSW200
     C                     MOVE MGSTCY    @CYCD                           CSW200
     C                     ELSE                                           CSW200
     C                     MOVE MGCCY     @CYCD                           CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     MOVELMGPONS    @NONB                           CSW200
     C*******              CALL 'AONOSTR0'                                             CSW200 CDL094
     C                     CALL 'AONOSTR1'                                                    CDL094
     C                     PARM '*MSG   ' @RTCD   7                       CSW200
     C                     PARM '*KEY   ' @OPTN   7                       CSW200
     C                     PARM *BLANKS   @CUST   6                       CSW200
     C                     PARM           @CYCD   3                       CSW200
     C**********           PARM *BLANKS   @ACCD   4                                    CSW200 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2                       CSW200
     C                     PARM           @NONB   2                       CSW200
     C                     PARM *BLANKS   @BRCD   3                       CSW200
     C                     PARM *BLANKS   @CSSN  10                       CSW200
     C                     PARM *BLANKS   @PNOI   1                       CSW200
     C***********SDNOST    PARM SDNOST    DSFDY                                        CSW200 CDL094
     C           SDNOST    PARM SDNOST    DSSDY                                               CDL094
      *                                                                   CSW200
      **  Nostro customer not found                                       CSW200
      *                                                                   CSW200
     C           @RTCD     IFNE *BLANKS                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE 'Y'       @ERR                            CSW200
     C                     MOVE ':53 :'   MTAG                            CSW200
     C                     MOVELMGPONS    HLD2                            CSW200
     C                     MOVELMGCCY     HLD5                            CSW200
     C                     MOVE HLD2      HLD5                            CSW200
     C                     MOVELHLD5      MFLD                            CSW200
     C                     MOVELMSGA,3    MERR                            CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      ** Branch Internal Customer cf. Customer number of Our Pay Nostro   CSW200
      *                                                                   CSW200
     C                     MOVELSECN      @SECN   6                       CSW200
     C           @SECN     IFNE A7CUST                                    CSW200
     C           MGAWBN    ANDNEA7CUST                                    CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C           MGRVNO    IFEQ *BLANKS                                   CSW200
     C                     MOVELA7CUST    ZDEST                           CSW200
     C                     ELSE                                           CSW200
     C                     MOVELMGRVNO    ZDEST                           CSW200
     C                     ENDIF                                          CSW200
     C*********************CALL 'ZM0050'                            CSW200CSW036
     C                     CALL 'ZM0051'                                  CSW036
     C                     PARM           ZDEST  12                       CSW200
     C                     PARM           ZSADD1 35                       CSW200
     C                     PARM           ZSADD2 35                       CSW200
     C                     PARM           ZSADD3 35                       CSW200
     C                     PARM           ZSADD4 35                       CSW200
     C                     PARM           ZSTAG   1                       CSW200
     C                     PARM           ZSTYPE  1                       CSW200
     C                     PARM           ZERR    1                       CSW200
     C                     PARM           ZDBEI                                               CSW201
      *                                                                   CSW200
      **  Error when formating address                                    CSW200
      *                                                                   CSW200
     C           ZERR      IFEQ '1'                                       CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE 'Y'       @ERR                            CSW200
     C                     MOVE ':53 :'   MTAG                            CSW200
     C                     MOVELZDEST     MFLD                            CSW200
     C                     MOVELMSGA,6    MERR                            CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      **  A Type address                                                  CSW200
      *                                                                   CSW200
     C           ZSTAG     IFEQ 'A'                                       CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE 'A'       TAG                             CSW200
     C                     MOVE '53'      FLDNO                           CSW200
     C                     MOVE @MTAG     MTAG                            CSW200
     C                     MOVELZSADD1    MFLD                            CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      **  D Type address                                                  CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               186748
     C           X         OCUR MULT                                      186748
     C                     MOVE ':53D:'   MTAG                            CSW200
     C                     MOVELZSADD1    MFLD                            CSW200
      **  Address 2                                                       CSW200
     C           ZSADD2    IFNE *BLANKS                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVELZSADD2    MFLD                            CSW200
      **  Address 3                                                       CSW200
     C           ZSADD3    IFNE *BLANKS                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVELZSADD3    MFLD                            CSW200
      **  Address 4                                                       CSW200
     C           ZSADD4    IFNE *BLANKS                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVELZSADD4    MFLD                            CSW200
     C                     END                             D address 4    CSW200
     C                     END                             D address 3    CSW200
     C                     END                             D address 2    CSW200
      *                                                                   CSW200
     C                     END                             A/D address?   CSW200
     C                     END                             Fmt ad. error  CSW200
     C                     END                             Brch Int Cust. CSW200
     C                     END                             Nostro not fnd.CSW200
     C/COPY WNCPYSRC,MG0320C057
     C                     END                                            CSW200
     C                     END                             Pay nostro?    CSW200
      *                                                                   CSW200
     C                     MOVE 'N'       FLD57O  1                       CSW200
      *                                                                   CSW200
      **  Field :57:  A/C with institution non-blank                      CSW200
     C/COPY WNCPYSRC,MG0320C058
      *                                                                   CSW200
     C           MGAWBN    IFNE *BLANKS                                   CSW200
      *                                                                   CSW200
      **  Field :56:  Pay Intermediary bank                               CSW200
      **  This field is only produced when the account with institution   CSW200
      **  is non-blank.                                                   CSW200
      *                                                                   CSW200
      **  If the pay intermediary is entered.                             CSW200
      *                                                                   CSW200
     C           MGPIBN    IFNE *BLANKS                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELMGPIBN    ZDEST                           CSW200
     C                     MOVELMGPIBA    ACLINE                          CSW200
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '56'      FLDNO                           CSW200
     C                     EXSR FSWAD                                     CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
      **  Format Account with institution. (Field 57.)                    CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELMGAWBN    ZDEST                           CSW200
     C**********           MOVELMGAWBA    ACLINE                                       CSW200 193545
     C**********           MOVELMGBENA    ACLINE                                     193545 AR641715
     C                     MOVELMGAWBA    ACLINE                                            AR641715
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '57'      FLDNO                           CSW200
     C                     EXSR FSWAD                                     CSW200
     C                     MOVE 'Y'       FLD57O  1                       CSW200
      *                                                                   CSW200
      **  A/C with Inst. blank                                            CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
     C           AWBA6     IFEQ 'DIRECT'                                  CSW200
      *                                                                   CSW200
      **  A/C with Inst. set up as DIRECT, use beneficiary details        CSW200
      **  Format Account with institution. (Field 57.)                    CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELMGBENN    ZDEST                           CSW200
     C                     MOVELMGBENA    ACLINE                          CSW200
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '57'      FLDNO                           CSW200
     C                     EXSR FSWAD                                     CSW200
     C                     MOVE 'Y'       FLD57O  1                       CSW200
      *                                                                   CSW200
      **  A/C with Inst. blank and NOT "DIRECT" entered,                  CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      *                                                                   CSW200
      **  Field 57 = pay nostro customer if settlement via '02' or '12'   CSW200
     C           MGPSTM    IFEQ 02                                        CSW200
     C           MGPSTM    OREQ 12                                        CSW200
     C                     MOVELMGPONS    @NONB                           CSW200
      *                                                                   CSW200
      ** Use settlement currency to access nostro if not blank.           CSW200
      ** Otherwise use deal currency.                                     CSW200
     C           CEU003    IFEQ 'Y'                                       CSW200
     C           MGSTCY    ANDNE*BLANKS                                   CSW200
     C           CEU004    OREQ 'Y'                                       CSW200
     C           MGSTCY    ANDNE*BLANKS                                   CSW200
     C                     MOVE MGSTCY    @CYCD                           CSW200
     C                     ELSE                                           CSW200
     C                     MOVE MGCCY     @CYCD                           CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C*******              CALL 'AONOSTR0'                                             CSW200 CDL094
     C                     CALL 'AONOSTR1'                                                    CDL094
     C                     PARM '*MSG   ' @RTCD   7                       CSW200
     C                     PARM '*KEY   ' @OPTN   7                       CSW200
     C                     PARM *BLANKS   @CUST   6                       CSW200
     C                     PARM           @CYCD   3                       CSW200
     C**********           PARM *BLANKS   @ACCD   4                                    CSW200 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2                       CSW200
     C                     PARM           @NONB   2                       CSW200
     C                     PARM *BLANKS   @BRCD   3                       CSW200
     C                     PARM *BLANKS   @CSSN  10                       CSW200
     C                     PARM *BLANKS   @PNOI   1                       CSW200
     C***********SDNOST    PARM SDNOST    DSFDY                                        CSW200 CDL094
     C           SDNOST    PARM SDNOST    DSSDY                                               CDL094
      *                                                                   CSW200
      **  Nostro customer not found                                       CSW200
      *                                                                   CSW200
     C           @RTCD     IFNE *BLANKS                                   CSW200
     C                     MOVE 'Y'       @ERR                            CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVELMGPONS    HLD2    2                       CSW200
     C                     MOVELMGCCY     HLD5                            CSW200
     C                     MOVE HLD2      HLD5    5                       CSW200
     C                     MOVELHLD5      MFLD                            CSW200
     C                     MOVELMSGA,3    MERR                            CSW200
     C                     MOVE ':57 :'   MTAG                            CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      **  Format our Pay Nostro Customer Address                          CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C           MGRVNO    IFEQ *BLANKS                                   CSW200
     C                     MOVELA7CUST    ZDEST                           CSW200
     C                     ELSE                                           CSW200
     C                     MOVELMGRVNO    ZDEST                           CSW200
     C                     ENDIF                                          CSW200
     C                     MOVEL*BLANKS   ACLINE                          CSW200
     C                     MOVE *BLANKS   @OANN                           188609
     C***********A7OANN    IFNE *BLANKS                                                188609 201796
     C***********          MOVE A7OANN    @OANN  15                                    188609 210796
     C           A7OACN    IFNE *BLANKS                                                       210796
     C**********           MOVE A7OACN    @OANN  35                                    210796 236852
     C                     MOVE A7OACN    @OANN  36                                           236852
     C                     MOVEL'/'       @OANN                           188609
     C                     END                                            188609
     C                     MOVEL@OANN     ACLINE                          188609
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '57'      FLDNO                           CSW200
     C                     EXSR FSWAD                                     CSW200
     C                     MOVE 'Y'       FLD57O                          CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
     C           MGPSTM    IFNE 00                                        CSW200
     C                     MOVE MGPSTM    @STM                            CSW200
     C           @STM      LOKUPTABINT                   23               CSW200
     C*                                                                   CSW200
     C           *IN23     IFEQ '1'                                       CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELSECN      ZDEST                           CSW200
     C                     MOVEL*BLANKS   ACLINE                          CSW200
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '57'      FLDNO                           CSW200
     C                     EXSR FSWAD                                     CSW200
     C                     MOVE 'Y'       FLD57O                          CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      **  Field 53 is equal to Our Pay Nostro                             CSW200
     C/COPY WNCPYSRC,MG0320C059
     C                     MOVELMGPONS    @NSKYE                          CSW200
      *                                                                   CSW200
      ** Use settlement currency to access nostro if not blank.           CSW200
      ** Otherwise use deal currency.                                     CSW200
     C           CEU003    IFEQ 'Y'                                       CSW200
     C           MGSTCY    ANDNE*BLANKS                                   CSW200
     C           CEU004    OREQ 'Y'                                       CSW200
     C           MGSTCY    ANDNE*BLANKS                                   CSW200
     C                     MOVE MGSTCY    @NSKYB                          CSW200
     C                     ELSE                                           CSW200
     C                     MOVE MGCCY     @NSKYB                          CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C*******              CALL 'AONOSTR0'                                             CSW200 CDL094
     C                     CALL 'AONOSTR1'                                                    CDL094
     C                     PARM '*MSG   ' @RTCD   7                       CSW200
     C                     PARM '*KEY   ' @OPTN   7                       CSW200
     C                     PARM *BLANKS   @NSKYA  6                       CSW200
     C                     PARM           @NSKYB  3                       CSW200
     C**********           PARM *BLANKS   @NSKYC  4                                    CSW200 CGL029
     C                     PARM *BLANKS   @NSKYC                                              CGL029
     C                     PARM *BLANKS   @NSKYD  2                       CSW200
     C                     PARM           @NSKYE  2                       CSW200
     C                     PARM *BLANKS   @KEYF   3                       CSW200
     C                     PARM *BLANKS   @KEYG  10                       CSW200
     C                     PARM *BLANKS   @KEYH   1                       CSW200
     C***********SDNOST    PARM SDNOST    DSFDY                                        CSW200 CDL094
     C           SDNOST    PARM SDNOST    DSSDY                                               CDL094
     C/COPY WNCPYSRC,MG0320C052
     C*                                                                   CSW200
     C**  Nostro customer not found                                       CSW200
     C           @RTCD     IFNE *BLANKS                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE 'Y'       @ERR                            CSW200
     C                     MOVE ':53 :'   MTAG                            CSW200
     C                     MOVELMGPONS    MFLD                            CSW200
     C                     MOVELMSGA,3    MERR                            CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      **  Format our Pay Nostro Customer Address                          CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELA7CUST    ZDEST                           CSW200
     C                     MOVEL*BLANKS   ACLINE                          CSW200
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '53'      FLDNO                           CSW200
     C                     EXSR FSWAD                                     CSW200
     C                     END                                            CSW200
     C/COPY WNCPYSRC,MG0320C053
     C                     END                                            CSW200
     C                     END                                            CSW200
     C                     END                                            CSW200
     C                     END                                            CSW200
     C                     END                                            CSW200
     C/COPY WNCPYSRC,MG0320C060
      *                                                                   CSW200
      **  Settlement 01,07 or 08 with MGAWBN blank or settlement 00       CSW200
      *                                                                   CSW200
     C           FLD57O    IFEQ 'N'                                       CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE ':57D:'   MTAG                            CSW200
     C/COPY WNCPYSRC,MG0320C054
     C                     MOVEL'UNKNOWN' MFLD                            CSW200
     C/COPY WNCPYSRC,MG0320C055
      *                                                                   CSW200
      *                                                                   CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
     C                     MOVE *BLANK    ZDBEI                                               CSW201
      *                                                                                     AR733390
      ** If the beneficiary is entered                                                      AR733390
      *                                                                                     AR733390
     C           MGBENN    IFNE *BLANKS                                                     AR733390
     C                     ADD  1         X                                                 AR733390
     C           X         OCUR MULT                                                        AR733390
     C**********           MOVE *BLANKS   ZDEST                                    AR733390 MD035358
     C**********           MOVELMGBENN    ZDEST                                    AR733390 MD035358
      * If SWIFT BIC defined as the Beneficiary then obtain related                         MD035358
      * customer number                                                                     MD035358
     C                     MOVEL*BLANKS   WSWID                                             MD035358
     C                     MOVELMGBENN    WSWID                                             MD035358
     C           WSWID     CHAINSDCUSTL7             70                                     MD035358
     C           *IN70     IFEQ *OFF                                                        MD035358
     C                     MOVEL*BLANKS   ZDEST                                             MD035358
     C                     MOVELBBCUST    ZDEST                                             MD035358
     C                     ELSE                                                             MD035358
     C                     MOVEL*BLANKS   ZDEST                                             MD035358
     C                     MOVELMGBENN    ZDEST                                             MD035358
     C                     ENDIF                                                            MD035358
     C                     MOVEL*BLANKS   ACLINE                                            MD035358
     C                     MOVELMGBENA    ACLINE                                            AR733390
     C                     MOVE ' '       TAG                                               AR733390
     C                     MOVEL'58'      FLDNO                                             AR733390
     C                     EXSR FSWAD                                                       AR733390
     C                     ENDIF                                                            AR733390
      *                                                                                       CSW201
     C/COPY WNCPYSRC,MG0320C072
     C                     ENDSR                                          CSW200
      *****************************************************************   CSW200
      *   FMD200 - Format fields 53, 56 and 57 for receive sequence  *    CSW200
      *            This subroutine is based on RECV, but format the   *   CSW200
      *            fields always for sequence D.                      *   CSW200
      *            New Field:                                         *   CSW200
      *             - :15D: Beginning of sequence D                   *   CSW200
      *   Called by - Main Processing                                 *   CSW200
      *   Calls     - FSWAD  Format swift address.                    *   CSW200
      *****************************************************************   CSW200
      *                                                                   CSW200
     C           FMD200    BEGSR                                          CSW200
      *                                                                   CSW200
      ** FIELD :15D: - New Sequence                                       CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C                     MOVEL':15D:'   MTAG                            CSW200
     C                     MOVE *BLANKS   MFLD                            CSW200
      *                                                                   CSW200
      *                                                                   CSW200
     C                     MOVE *BLANKS   @WRK                            CSW200
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C                     MOVE 'Y'       ZDBEI                                               CSW201
     C                     ENDIF                                                              CSW201
      *                                                                   CSW200
      ** Field 53 - Senders correspondant.                                CSW200
      *                                                                   CSW200
      ** If the module is lending try to format field 53.                 CSW200
      *                                                                   CSW200
     C           MGMODI    IFEQ 'LE'                                      CSW200
      *                                                                   CSW200
      ** If the receipt intermediary branch is not blank ; format         CSW200
      ** this via FSWAD. (Else no field produced.)                        CSW200
      *                                                                   CSW200
     C           MGRIBN    IFNE *BLANKS                                   CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELMGRIBN    ZDEST                           CSW200
     C                     MOVELMGRIBA    ACLINE                          CSW200
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '53'      FLDNO                           CSW200
     C                     EXSR FSWAD                                     CSW200
     C                     END                                            CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
      ** Format fields 56 and 57.                                         CSW200
      *                                                                   CSW200
      ** Branch code of sender not equal to Receive settlement branch.    CSW200
      *                                                                   CSW200
      **  Test if settlement via nostro                                   CSW200
     C                     MOVE MGRSTM    @STM                            CSW200
     C           @STM      LOKUPTABNST                   23               CSW200
     C/COPY WNCPYSRC,MG0320C061
     C           MGBRCA    IFNE MGROBR                                    CSW200
     C           *IN23     ANDEQ'1'                                       CSW200
      *                                                                   CSW200
     C**********           ADD  1         X                                            CSW200 249455
     C********** X         OCUR MULT                                                   CSW200 249455
      *                                                                   CSW200
     C           MGRIBN    IFNE *BLANKS                                   CSW200
      *                                                                                       249455
     C                     ADD  1         X                                                   249455
     C           X         OCUR MULT                                                          249455
      *                                                                                       249455
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELMGRIBN    ZDEST                           CSW200
     C                     MOVELMGRIBA    ACLINE                          CSW200
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '56'      FLDNO                           CSW200
     C                     EXSR FSWAD                                     CSW200
      *                                                                   CSW200
     C**********           ELSE                                                        CSW200 249455
     C**********                                                                       CSW200 249455
      ****Access*Branch*file*for*the*Internal*customer*number*of*the***                CSW200 249455
      ****Receive*branch*(this*will*be*used*for*the*Intermediary*******                CSW200 249455
      ****Bank,*because*settlement*is*via*an*account*owned*************                CSW200 249455
      ****by*a*branch*different*to*the*receive*branch)*****************                CSW200 249455
     C**********                                                                       CSW200 249455
     C**********           CALL 'AOBRCHR0'                                             CSW200 CGL029
     C**********           CALL 'AOBRCHR1'                                             CGL029 249455
     C**********           PARM '*MSG   ' @RTCD                                        CSW200 249455
     C**********           PARM '*KEY   ' @OPTN                                        CSW200 249455
     C**********           PARM MGROBR    @BRCD   3                                    CSW200 249455
     C********** SDBRCH    PARM SDBRCH    DSSDY                                        CSW200 249455
      **********                                                                       CSW200 249455
      ***Branch*record*not*found*-*Error*******************************                CSW200 249455
      **********                                                                       CSW200 249455
     C********** @RTCD     IFNE *BLANKS                                                CSW200 249455
     C********** *LOCK     IN   LDA                                                    CSW200 249455
     C**********           MOVE '032'     DBASE              * * * * * * *             CSW200 249455
     C**********           MOVELMGROBR    DBKEY              * DBERR 032 *             CSW200 249455
     C**********           MOVEL'SDBRCHPD'DBFILE             * * * * * * *             CSW200 249455
     C**********           OUT  LDA                                                    CSW200 249455
     C**********           EXSR *PSSR                                                  CSW200 249455
     C**********           END                                                         CSW200 249455
      **********                                                                       CSW200 249455
      ***Format*Intermediary*using*customer*number*of*receive*branch***                CSW200 249455
      **********                                                                       CSW200 249455
     C**********           MOVE *BLANKS   ZDEST                                        CSW200 249455
     C**********           MOVELA8BICN    ZDEST                                        CSW200 249455
     C**********           MOVE ' '       TAG                                          CSW200 249455
     C**********           MOVE '56'      FLDNO                                        CSW200 249455
     C**********           EXSR FSWAD                                                  CSW200 249455
     C                     END                                            CSW200
      *                                                                   CSW200
      ** Use settlement currency to access nostro if not blank.           CSW200
      ** Otherwise use deal currency.                                     CSW200
     C           CEU003    IFEQ 'Y'                                       CSW200
     C           MGSTCY    ANDNE*BLANKS                                   CSW200
     C           CEU004    OREQ 'Y'                                       CSW200
     C           MGSTCY    ANDNE*BLANKS                                   CSW200
     C                     MOVE MGSTCY    @CYCD                           CSW200
     C                     ELSE                                           CSW200
     C                     MOVE MGCCY     @CYCD                           CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      ** Field :57:  A/C With Institution                                 CSW200
     C/COPY WNCPYSRC,MG0320C062
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C*******              CALL 'AONOSTR0'                                             CSW200 CDL094
     C                     CALL 'AONOSTR1'                                                    CDL094
     C                     PARM '*MSG   ' @RTCD   7                       CSW200
     C                     PARM '*KEY   ' @OPTN   7                       CSW200
     C                     PARM *BLANKS   @CUST   6        I:Customer No  CSW200
     C                     PARM           @CYCD   3        I:Currency     CSW200
     C**********           PARM *BLANKS   @ACCD   4        I:A/c Code                  CSW200 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2        I:A/c Seq      CSW200
     C                     PARM MGRONS    @NONB   2        I:Nostro No    CSW200
     C                     PARM *BLANKS   @BRCD   3        I:Branch Code  CSW200
     C                     PARM *BLANKS   @CSSN  10        I:Cust ShortN  CSW200
     C                     PARM *BLANK    @PNOI   1        I:Prime Nost InCSW200
     C***********SDNOST    PARM SDNOST    DSFDY                                        CSW200 CDL094
     C           SDNOST    PARM SDNOST    DSSDY                                               CDL094
      *                                                                   CSW200
      **  If our receive nostro is not found.                             CSW200
      *                                                                   CSW200
     C           @RTCD     IFNE *BLANKS                                   CSW200
     C                     MOVE 'Y'       @ERR                            CSW200
     C                     MOVELMGRONS    HLD2    2                       CSW200
     C                     MOVELMGCCY     HLD5                            CSW200
     C                     MOVE HLD2      HLD5    5                       CSW200
     C                     MOVELHLD5      MFLD                            CSW200
     C                     MOVELMSGA,3    MERR                            CSW200
     C                     MOVE ':57 :'   MTAG                            CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      **  Format our Receive Nostro Customer Address                      CSW200
      * If CDL094 is On and Delivery Agent details have been defined for                      CDL094
      * the Nostro, use these and not the Customer of the Nostro details                      CDL094
     C           CDL094    IFEQ 'Y'                                                           CDL094
     C           A7RF57    ANDNE*BLANKS                                                       CDL094
      *                                                                                       CDL094
      * If SWIFT BIC defined as the Delivery Agent then obtain related                        CDL094
      * customer number                                                                       CDL094
     C                     MOVE *IN80     IN80    1                                           CDL094
     C                     MOVEL*BLANKS   WSWID  12                                           CDL094
     C                     MOVELA7RF57    WSWID                                               CDL094
     C           WSWID     CHAINSDCUSTL7             80                                       CDL094
     C           *IN80     IFEQ *OFF                                                          CDL094
     C                     MOVEL*BLANKS   ZDEST                                               CDL094
     C                     MOVELBBCUST    ZDEST                                               CDL094
     C                     ELSE                                                               CDL094
     C                     MOVEL*BLANKS   ZDEST                                               CDL094
     C                     MOVELA7RF57    ZDEST                                               CDL094
     C                     ENDIF                                                              CDL094
     C                     MOVEL*BLANKS   ACLINE                                              CDL094
     C                     MOVELA7RA57    ACLINE                                              CDL094
     C                     MOVE IN80      *IN80                                               CDL094
      *                                                                                       CDL094
     C                     ELSE                                                               CDL094
      *                                                                   CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELA7CUST    ZDEST                           CSW200
     C                     MOVEL*BLANKS   ACLINE 35                       CSW200
     C                     MOVE *BLANKS   @OANN                           188609
     C***********A7OANN    IFNE *BLANKS                                                188609 210796
     C***********          MOVE A7OANN    @OANN  15                                    188609 210796
     C           A7OACN    IFNE *BLANKS                                                       210796
     C                     MOVE A7OACN    @OANN                                               210796
     C                     MOVEL'/'       @OANN                           188609
     C                     END                                            188609
     C                     MOVEL@OANN     ACLINE                          188609
     C                     ENDIF                                                              CDL094
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '57'      FLDNO                           CSW200
     C                     EXSR FSWAD                                     CSW200
     C                     END                                            CSW200
      * If Beneficiary details defined for the Nostro are not blank, output                   CDL094
      * these as field 58                                                                     CDL094
     C           CDL094    IFEQ 'Y'                                                           CDL094
     C           A7RF58    ANDNE*BLANKS                                                       CDL094
      *                                                                                       CDL094
     C                     ADD  1         X                                                   CDL094
     C           X         OCUR MULT                                                          CDL094
      * If SWIFT BIC defined as the Beneficiary then obtain related                           CDL094
      * customer number                                                                       CDL094
     C                     MOVE *IN80     IN80    1                                           CDL094
     C                     MOVEL*BLANKS   WSWID                                               CDL094
     C                     MOVELA7RF58    WSWID                                               CDL094
     C           WSWID     CHAINSDCUSTL7             80                                       CDL094
     C           *IN80     IFEQ *OFF                                                          CDL094
     C                     MOVEL*BLANKS   ZDEST                                               CDL094
     C                     MOVELBBCUST    ZDEST                                               CDL094
     C                     ELSE                                                               CDL094
     C                     MOVEL*BLANKS   ZDEST                                               CDL094
     C                     MOVELA7RF58    ZDEST                                               CDL094
     C                     ENDIF                                                              CDL094
     C                     MOVEL*BLANKS   ACLINE                                              CDL094
     C                     MOVELA7RA58    ACLINE                                              CDL094
     C                     MOVE IN80      *IN80                                               CDL094
      *                                                                                       CDL094
     C                     MOVE ' '       TAG                                                 CDL094
     C                     MOVE '58'      FLDNO                                               CDL094
     C                     EXSR FSWAD                                                         CDL094
     C                     ENDIF                                                              CDL094
      *                                                                                       CDL094
      *                                                                   CSW200
      *                                                                   CSW200
      ** Else the branch code of sender = receive settlement branch       CSW200
      ** and the settlement is via a nostro.                              CSW200
     C/COPY WNCPYSRC,MG0320C063
      *                                                                   CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
     C           MGRIBN    IFNE *BLANKS                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELMGRIBN    ZDEST                           CSW200
     C                     MOVELMGRIBA    ACLINE                          CSW200
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '56'      FLDNO                           CSW200
     C                     EXSR FSWAD                                     CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
     C           @STM      LOKUPTABNST                   23               CSW200
     C/COPY WNCPYSRC,MG0320C064
      *                                                                   CSW200
     C           *IN23     IFEQ '1'                                       CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
      ** Use settlement currency to access nostro if not blank.           CSW200
      ** Otherwise use deal currency.                                     CSW200
     C           CEU003    IFEQ 'Y'                                       CSW200
     C           MGSTCY    ANDNE*BLANKS                                   CSW200
     C           CEU004    OREQ 'Y'                                       CSW200
     C           MGSTCY    ANDNE*BLANKS                                   CSW200
     C                     MOVE MGSTCY    @CYCD                           CSW200
     C                     ELSE                                           CSW200
     C                     MOVE MGCCY     @CYCD                           CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C*******              CALL 'AONOSTR0'                                             CSW200 CDL094
     C                     CALL 'AONOSTR1'                                                    CDL094
     C                     PARM '*MSG   ' @RTCD   7                       CSW200
     C                     PARM '*KEY   ' @OPTN   7                       CSW200
     C                     PARM *BLANKS   @CUST   6        I:Customer No  CSW200
     C                     PARM           @CYCD   3        I:Currency     CSW200
     C**********           PARM *BLANKS   @ACCD   4        I:A/c Code                  CSW200 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2        I:A/c Seq      CSW200
     C                     PARM MGRONS    @NONB   2        I:Nostro No    CSW200
     C                     PARM *BLANKS   @BRCD   3        I:Branch Code  CSW200
     C                     PARM *BLANKS   @CSSN  10        I:Cust ShortN  CSW200
     C                     PARM *BLANK    @PNOI   1        I:Prime Nost InCSW200
     C***********SDNOST    PARM SDNOST    DSFDY                                        CSW200 CDL094
     C           SDNOST    PARM SDNOST    DSSDY                                               CDL094
      *                                                                   CSW200
      **  If our receive nostro is not found.                             CSW200
      *                                                                   CSW200
     C           @RTCD     IFNE *BLANKS                                   CSW200
     C                     MOVE 'Y'       @ERR                            CSW200
     C                     MOVELMGRONS    HLD2                            CSW200
     C                     MOVELMGCCY     HLD5                            CSW200
     C                     MOVE HLD2      HLD5                            CSW200
     C                     MOVELHLD5      MFLD                            CSW200
     C                     MOVELMSGA,3    MERR                            CSW200
     C                     MOVE ':57 :'   MTAG                            CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      * If CDL094 is On and Delivery Agent details have been defined for                      CDL094
      * the Nostro, use these and not the Customer of the Nostro details                      CDL094
     C           CDL094    IFEQ 'Y'                                                           CDL094
     C           A7RF57    ANDNE*BLANKS                                                       CDL094
      *                                                                                       CDL094
      * If SWIFT BIC defined as the Delivery Agent then obtain related                        CDL094
      * customer number                                                                       CDL094
     C                     MOVE *IN80     IN80    1                                           CDL094
     C                     MOVEL*BLANKS   WSWID                                               CDL094
     C                     MOVELA7RF57    WSWID                                               CDL094
     C           WSWID     CHAINSDCUSTL7             80                                       CDL094
     C           *IN80     IFEQ *OFF                                                          CDL094
     C                     MOVEL*BLANKS   ZDEST                                               CDL094
     C                     MOVELBBCUST    ZDEST                                               CDL094
     C                     ELSE                                                               CDL094
     C                     MOVEL*BLANKS   ZDEST                                               CDL094
     C                     MOVELA7RF57    ZDEST                                               CDL094
     C                     ENDIF                                                              CDL094
     C                     MOVEL*BLANKS   ACLINE                                              CDL094
     C                     MOVELA7RA57    ACLINE                                              CDL094
     C                     MOVE IN80      *IN80                                               CDL094
      *                                                                                       CDL094
     C                     ELSE                                                               CDL094
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELA7CUST    ZDEST                           CSW200
      *                                                                   CSW200
      *                                                                   CSW200
     C                     MOVEL*BLANKS   ACLINE                          CSW200
     C                     MOVE *BLANKS   @OANN                           188609
     C***********A7OANN    IFNE *BLANKS                                                188609 210796
     C***********          MOVE A7OANN    @OANN  15                                    188609 210796
     C           A7OACN    IFNE *BLANKS                                                       210796
     C**********           MOVE A7OACN    @OANN  35                                    210796 236852
     C                     MOVE A7OACN    @OANN  36                                           236852
     C                     MOVEL'/'       @OANN                           188609
     C                     END                                            188609
     C                     MOVEL@OANN     ACLINE                          188609
     C                     ENDIF                                                              CDL094
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '57'      FLDNO                           CSW200
     C                     EXSR FSWAD                                     CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
      * If Beneficiary details defined for the Nostro are not blank, output                   CDL094
      * these as field 58                                                                     CDL094
     C           CDL094    IFEQ 'Y'                                                           CDL094
     C           A7RF58    ANDNE*BLANKS                                                       CDL094
      *                                                                                       CDL094
     C                     ADD  1         X                                                   CDL094
     C           X         OCUR MULT                                                          CDL094
      * If SWIFT BIC defined as the Beneficiary then obtain related                           CDL094
      * customer number                                                                       CDL094
     C                     MOVE *IN80     IN80    1                                           CDL094
     C                     MOVEL*BLANKS   WSWID                                               CDL094
     C                     MOVELA7RF58    WSWID                                               CDL094
     C           WSWID     CHAINSDCUSTL7             80                                       CDL094
     C           *IN80     IFEQ *OFF                                                          CDL094
     C                     MOVEL*BLANKS   ZDEST                                               CDL094
     C                     MOVELBBCUST    ZDEST                                               CDL094
     C                     ELSE                                                               CDL094
     C                     MOVEL*BLANKS   ZDEST                                               CDL094
     C                     MOVELA7RF58    ZDEST                                               CDL094
     C                     ENDIF                                                              CDL094
     C                     MOVEL*BLANKS   ACLINE                                              CDL094
     C                     MOVELA7RA58    ACLINE                                              CDL094
     C                     MOVE IN80      *IN80                                               CDL094
      *                                                                                       CDL094
     C                     MOVE ' '       TAG                                                 CDL094
     C                     MOVE '58'      FLDNO                                               CDL094
     C                     EXSR FSWAD                                                         CDL094
     C                     ENDIF                                                              CDL094
      *                                                                                       CDL094
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      ** Settlement method internal.                                      CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C           MGRSTM    IFNE 00                                        CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELSECN      ZDEST                           CSW200
     C                     MOVEL*BLANKS   ACLINE                          CSW200
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '57'      FLDNO                           CSW200
     C                     EXSR FSWAD                                     CSW200
      *                                                                   CSW200
      ** No settlement type entered.                                      CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
     C                     MOVE ':57D:'   MTAG                            CSW200
     C                     MOVEL'UNKNOWN' MFLD                            CSW200
     C                     END                                            CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
     C                     END                                            CSW200
     C/COPY WNCPYSRC,MG0320C065
      *                                                                   CSW200
     C                     MOVE *BLANK    ZDBEI                                               CSW201
      *                                                                                       CSW201
     C                     ENDSR                                          CSW200
     C/EJECT                                                              CSW200
      *****************************************************************   CSW200
      *   FME200 - Format Message Detail - Sequence E.                *   CSW200
      *            This subroutine is based on FMC200 but using the   *   CSW200
      *            interest settlement details instead of the pay     *   CSW200
      *            settlement details.                                    CSW200
      *   Called by - Main processing                                 *   CSW200
      *   Calls     - FSWAD  Format Swift Address.                    *   CSW200
      *****************************************************************   CSW200
      *                                                                   CSW200
     C           FME200    BEGSR                                          CSW200
      *                                                                   CSW200
     C           MGIMET    IFNE *BLANKS                                   CSW200
      *                                                                   CSW200
      * Default the counterparty nostro if not input                      CSW200
      *                                                                   CSW200
     C           MGINOS    IFEQ *BLANKS                                   CSW200
     C                     MOVELMGAWBN    MGINOS                          CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      * Only output this sequence if the interest settlement details      CSW200
      * are different to the the pay settlement details.                  CSW200
      *                                                                   CSW200
     C                     MOVE MGPSTM    WK2     2                       CSW200
     C           MGIMET    IFNE WK2                                       CSW200
     C           MGINSA    ORNE MGPONS                                    CSW200
     C           MGINOS    ORNE MGAWBN                                    CSW200
      *                                                                   CSW200
      ** FIELD :15E: - New Sequence                                       CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C                     MOVEL':15E:'   MTAG                            CSW200
     C                     MOVE *BLANKS   MFLD                            CSW200
      *                                                                   CSW200
     C                     MOVE *BLANKS   @WRK                            CSW200
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C                     MOVE 'Y'       ZDBEI                                               CSW201
     C                     ENDIF                                                              CSW201
      *                                                                   CSW200
      ** Field 53 - Senders correspondant.                                CSW200
      **  Test if Interest settlement via nostro                          CSW200
      *                                                                   CSW200
     C                     MOVE MGIMET    @STM    2                       CSW200
     C           @STM      LOKUPTABNST                   23               CSW200
      *                                                                   CSW200
      ** If interest settlement account is not blank and interest         CSW200
      ** settlement is via nostro.                                        CSW200
      *                                                                   CSW200
     C           MGINSA    IFNE *BLANKS                                   CSW200
     C           *IN23     ANDEQ'1'                                       CSW200
      *                                                                   CSW200
      ** If interest Counterpart Nostro is not blank.                     CSW200
      *                                                                   CSW200
     C           MGINOS    IFNE *BLANKS                                   CSW200
      *                                                                   CSW200
      ** Use interest settlement currency to access nostro if not blank   CSW200
      ** Otherwise use deal currency.                                     CSW200
     C           CEU003    IFEQ 'Y'                                       CSW200
     C           MGISCY    ANDNE*BLANKS                                   CSW200
     C                     MOVE MGISCY    @CYCD                           CSW200
     C                     ELSE                                           CSW200
     C                     MOVE MGCCY     @CYCD                           CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     MOVELMGINSA    @NONB                           CSW200
     C*******              CALL 'AONOSTR0'                                             CSW200 CDL094
     C                     CALL 'AONOSTR1'                                                    CDL094
     C                     PARM '*MSG   ' @RTCD   7                       CSW200
     C                     PARM '*KEY   ' @OPTN   7                       CSW200
     C                     PARM *BLANKS   @CUST   6                       CSW200
     C                     PARM           @CYCD   3                       CSW200
     C**********           PARM *BLANKS   @ACCD   4                                    CSW200 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2                       CSW200
     C                     PARM           @NONB   2                       CSW200
     C                     PARM *BLANKS   @BRCD   3                       CSW200
     C                     PARM *BLANKS   @CSSN  10                       CSW200
     C                     PARM *BLANKS   @PNOI   1                       CSW200
     C***********SDNOST    PARM SDNOST    DSFDY                                        CSW200 CDL094
     C           SDNOST    PARM SDNOST    DSSDY                                               CDL094
      *                                                                   CSW200
      **  Nostro customer not found                                       CSW200
      *                                                                   CSW200
     C           @RTCD     IFNE *BLANKS                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE 'Y'       @ERR                            CSW200
     C                     MOVE ':53 :'   MTAG                            CSW200
     C                     MOVELMGINOS    HLD2                            CSW200
     C                     MOVEL@CYCD     HLD5                            CSW200
     C                     MOVE HLD2      HLD5                            CSW200
     C                     MOVELHLD5      MFLD                            CSW200
     C                     MOVELMSGA,3    MERR                            CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      ** Branch Internal Customer cf. Customer number of Our Pay Nostro   CSW200
      *                                                                   CSW200
     C                     MOVELSECN      @SECN   6                       CSW200
     C           @SECN     IFNE A7CUST                                    CSW200
     C           MGINOS    ANDNEA7CUST                                    CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELA7CUST    ZDEST                           CSW200
     C*********************CALL 'ZM0050'                            CSW200CSW036
     C                     CALL 'ZM0051'                                  CSW036
     C                     PARM           ZDEST  12                       CSW200
     C                     PARM           ZSADD1 35                       CSW200
     C                     PARM           ZSADD2 35                       CSW200
     C                     PARM           ZSADD3 35                       CSW200
     C                     PARM           ZSADD4 35                       CSW200
     C                     PARM           ZSTAG   1                       CSW200
     C                     PARM           ZSTYPE  1                       CSW200
     C                     PARM           ZERR    1                       CSW200
     C                     PARM           ZDBEI                                               CSW201
      *                                                                   CSW200
      **  Error when formating address                                    CSW200
      *                                                                   CSW200
     C           ZERR      IFEQ '1'                                       CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE 'Y'       @ERR                            CSW200
     C                     MOVE ':53 :'   MTAG                            CSW200
     C                     MOVELZDEST     MFLD                            CSW200
     C                     MOVELMSGA,6    MERR                            CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      **  A Type address                                                  CSW200
      *                                                                   CSW200
     C           ZSTAG     IFEQ 'A'                                       CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE 'A'       TAG                             CSW200
     C                     MOVE '53'      FLDNO                           CSW200
     C                     MOVE @MTAG     MTAG                            CSW200
     C                     MOVELZSADD1    MFLD                            CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      **  D Type address                                                  CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE ':53D:'   MTAG                            CSW200
     C                     MOVELZSADD1    MFLD                            CSW200
      **  Address 2                                                       CSW200
     C           ZSADD2    IFNE *BLANKS                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVELZSADD2    MFLD                            CSW200
      **  Address 3                                                       CSW200
     C           ZSADD3    IFNE *BLANKS                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVELZSADD3    MFLD                            CSW200
      **  Address 4                                                       CSW200
     C           ZSADD4    IFNE *BLANKS                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVELZSADD4    MFLD                            CSW200
     C                     END                             D address 4    CSW200
     C                     END                             D address 3    CSW200
     C                     END                             D address 2    CSW200
      *                                                                   CSW200
     C                     END                             A/D address?   CSW200
     C                     END                             Fmt ad. error  CSW200
     C                     END                             Brch Int Cust. CSW200
     C                     END                             Nostro not fnd.CSW200
     C                     END                                            CSW200
     C                     END                             Pay nostro?    CSW200
      *                                                                   CSW200
     C                     MOVE 'N'       FLD57O  1                       CSW200
      *                                                                   CSW200
      **  Field :57:  A/C with institution non-blank                      CSW200
      *                                                                   CSW200
     C           MGINOS    IFNE *BLANKS                                   CSW200
      *                                                                   CSW200
      **  Format Account with institution. (Field 57.)                    CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELMGINOS    ZDEST                           CSW200
     C                     MOVE *BLANKS   ACLINE                          CSW200
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '57'      FLDNO                           CSW200
     C                     EXSR FSWAD                                     CSW200
     C                     MOVE 'Y'       FLD57O  1                       CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      **  Field 57 = pay nostro customer if settlement via '02' or '12'   CSW200
     C           MGIMET    IFEQ '02'                                      CSW200
     C           MGIMET    OREQ '12'                                      CSW200
     C                     MOVELMGINSA    @NONB                           CSW200
      *                                                                   CSW200
      ** Use settlement currency to access nostro if not blank.           CSW200
      ** Otherwise use deal currency.                                     CSW200
     C           CEU003    IFEQ 'Y'                                       CSW200
     C           MGISCY    ANDNE*BLANKS                                   CSW200
     C                     MOVE MGISCY    @CYCD                           CSW200
     C                     ELSE                                           CSW200
     C                     MOVE MGCCY     @CYCD                           CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C*******              CALL 'AONOSTR0'                                             CSW200 CDL094
     C                     CALL 'AONOSTR1'                                                    CDL094
     C                     PARM '*MSG   ' @RTCD   7                       CSW200
     C                     PARM '*KEY   ' @OPTN   7                       CSW200
     C                     PARM *BLANKS   @CUST   6                       CSW200
     C                     PARM           @CYCD   3                       CSW200
     C**********           PARM *BLANKS   @ACCD   4                                    CSW200 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2                       CSW200
     C                     PARM           @NONB   2                       CSW200
     C                     PARM *BLANKS   @BRCD   3                       CSW200
     C                     PARM *BLANKS   @CSSN  10                       CSW200
     C                     PARM *BLANKS   @PNOI   1                       CSW200
     C***********SDNOST    PARM SDNOST    DSFDY                                        CSW200 CDL094
     C           SDNOST    PARM SDNOST    DSSDY                                               CDL094
      *                                                                   CSW200
      **  Nostro customer not found                                       CSW200
      *                                                                   CSW200
     C           @RTCD     IFNE *BLANKS                                   CSW200
     C                     MOVE 'Y'       @ERR                            CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVELMGPONS    HLD2    2                       CSW200
     C                     MOVEL@CYCD     HLD5                            CSW200
     C                     MOVE HLD2      HLD5    5                       CSW200
     C                     MOVELHLD5      MFLD                            CSW200
     C                     MOVELMSGA,3    MERR                            CSW200
     C                     MOVE ':57 :'   MTAG                            CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      **  Format our Pay Nostro Customer Address                          CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELA7CUST    ZDEST                           CSW200
     C                     MOVEL*BLANKS   ACLINE                          CSW200
     C                     MOVE *BLANKS   @OANN                           188609
     C***********A7OANN    IFNE *BLANKS                                                188609 210796
     C***********          MOVE A7OANN    @OANN  15                                    188609 210796
     C           A7OACN    IFNE *BLANKS                                                       210796
     C                     MOVE A7OACN    @OANN                                               210796
     C                     MOVEL'/'       @OANN                           188609
     C                     END                                            188609
     C                     MOVEL@OANN     ACLINE                          188609
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '57'      FLDNO                           CSW200
     C                     EXSR FSWAD                                     CSW200
     C                     MOVE 'Y'       FLD57O                          CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
     C           MGIMET    IFNE '00'                                      CSW200
     C                     MOVE MGIMET    @STM                            CSW200
     C           @STM      LOKUPTABINT                   23               CSW200
     C*                                                                   CSW200
     C           *IN23     IFEQ '1'                                       CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELSECN      ZDEST                           CSW200
     C                     MOVEL*BLANKS   ACLINE                          CSW200
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '57'      FLDNO                           CSW200
     C                     EXSR FSWAD                                     CSW200
     C                     MOVE 'Y'       FLD57O                          CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      **  Field 53 is equal to Our Pay Nostro                             CSW200
     C                     MOVELMGINSA    @NSKYE                          CSW200
      *                                                                   CSW200
      ** Use settlement currency to access nostro if not blank.           CSW200
      ** Otherwise use deal currency.                                     CSW200
     C           CEU003    IFEQ 'Y'                                       CSW200
     C           MGISCY    ANDNE*BLANKS                                   CSW200
     C                     MOVE MGISCY    @NSKYB                          CSW200
     C                     ELSE                                           CSW200
     C                     MOVE MGCCY     @NSKYB                          CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C*******              CALL 'AONOSTR0'                                             CSW200 CDL094
     C                     CALL 'AONOSTR1'                                                    CDL094
     C                     PARM '*MSG   ' @RTCD   7                       CSW200
     C                     PARM '*KEY   ' @OPTN   7                       CSW200
     C                     PARM *BLANKS   @NSKYA  6                       CSW200
     C                     PARM           @NSKYB  3                       CSW200
     C**********           PARM *BLANKS   @NSKYC  4                                    CSW200 CGL029
     C                     PARM *BLANKS   @NSKYC                                              CGL029
     C                     PARM *BLANKS   @NSKYD  2                       CSW200
     C                     PARM           @NSKYE  2                       CSW200
     C                     PARM *BLANKS   @KEYF   3                       CSW200
     C                     PARM *BLANKS   @KEYG  10                       CSW200
     C                     PARM *BLANKS   @KEYH   1                       CSW200
     C***********SDNOST    PARM SDNOST    DSFDY                                        CSW200 CDL094
     C           SDNOST    PARM SDNOST    DSSDY                                               CDL094
     C*                                                                   CSW200
     C**  Nostro customer not found                                       CSW200
     C           @RTCD     IFNE *BLANKS                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE 'Y'       @ERR                            CSW200
     C                     MOVE ':53 :'   MTAG                            CSW200
     C                     MOVELMGINSA    MFLD                            CSW200
     C                     MOVELMSGA,3    MERR                            CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      **  Format our Pay Nostro Customer Address                          CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELA7CUST    ZDEST                           CSW200
     C                     MOVEL*BLANKS   ACLINE                          CSW200
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '53'      FLDNO                           CSW200
     C                     EXSR FSWAD                                     CSW200
     C                     END                                            CSW200
     C                     END                                            CSW200
     C                     END                                            CSW200
     C                     END                                            CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
      **  Settlement 01,07 or 08 with MGAWBN blank or settlement 00       CSW200
      *                                                                   CSW200
     C           FLD57O    IFEQ 'N'                                       CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE ':57D:'   MTAG                            CSW200
     C                     MOVEL'UNKNOWN' MFLD                            CSW200
      *                                                                   CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
     C                     END                                            CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
     C                     MOVE *BLANK    ZDBEI                                               CSW201
      *                                                                                       CSW201
     C                     ENDSR                                          CSW200
      *****************************************************************   CSW200
      *   FMF200 - Format fields 53, 56 and 57 for receive sequence   *   CSW200
      *            This subroutine is similar to FMD200 but using the *   CSW200
      *            interest field instead of the receive settlement   *   CSW200
      *            field.                                             *   CSW200
      *   Called by - Main Processing                                 *   CSW200
      *   Calls     - FSWAD  Format swift address.                    *   CSW200
      *****************************************************************   CSW200
      *                                                                   CSW200
     C           FMF200    BEGSR                                          CSW200
      *                                                                   CSW200
     C           MGIMET    IFNE *BLANKS                                   CSW200
      *                                                                   CSW200
      ** Only output this sequence if the interest settlement details a   CSW200
      ** are different to the receive settlement details.                 CSW200
     C                     MOVE MGRSTM    WK2     2                       CSW200
     C           MGIMET    IFNE WK2                                       CSW200
     C           MGINSA    ORNE MGRONS                                    CSW200
      *                                                                   CSW200
      ** FIELD :15F: - New Sequence                                       CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C                     MOVEL':15F:'   MTAG                            CSW200
     C                     MOVE *BLANKS   MFLD                            CSW200
      *                                                                   CSW200
      *                                                                   CSW200
     C                     MOVE *BLANKS   @WRK                            CSW200
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C                     MOVE 'Y'       ZDBEI                                               CSW201
     C                     ENDIF                                                              CSW201
      *                                                                   CSW200
      ** Branch code of sender not equal to Receive settlement branch.    CSW200
      *                                                                   CSW200
      **  Test if settlement via nostro                                   CSW200
     C                     MOVE MGIMET    @STM                            CSW200
     C           @STM      LOKUPTABNST                   23               CSW200
     C           *IN23     IFEQ '1'                                       CSW200
      *                                                                   CSW200
      ** Use settlement currency to access nostro if not blank.           CSW200
      ** Otherwise use deal currency.                                     CSW200
     C           CEU003    IFEQ 'Y'                                       CSW200
     C           MGISCY    ANDNE*BLANKS                                   CSW200
     C                     MOVE MGISCY    @CYCD                           CSW200
     C                     ELSE                                           CSW200
     C                     MOVE MGCCY     @CYCD                           CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      ** Field :56:  Intermediary                                         CSW200
      *                                                                   CSW200
     C*******              CALL 'AONOSTR0'                                             CSW200 CDL094
     C                     CALL 'AONOSTR1'                                                    CDL094
     C                     PARM '*MSG   ' @RTCD   7                       CSW200
     C                     PARM '*KEY   ' @OPTN   7                       CSW200
     C                     PARM *BLANKS   @CUST   6        I:Customer No  CSW200
     C                     PARM           @CYCD   3        I:Currency     CSW200
     C**********           PARM *BLANKS   @ACCD   4        I:A/c Code                  CSW200 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2        I:A/c Seq      CSW200
     C                     PARM MGINSA    @NONB   2        I:Nostro No    CSW200
     C                     PARM *BLANKS   @BRCD   3        I:Branch Code  CSW200
     C                     PARM *BLANKS   @CSSN  10        I:Cust ShortN  CSW200
     C                     PARM *BLANK    @PNOI   1        I:Prime Nost InCSW200
     C***********SDNOST    PARM SDNOST    DSFDY                                        CSW200 CDL094
     C           SDNOST    PARM SDNOST    DSSDY                                               CDL094
      *                                                                   CSW200
      **  If our receive nostro is not found.                             CSW200
      *                                                                   CSW200
     C           @RTCD     IFNE *BLANKS                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE 'Y'       @ERR                            CSW200
     C                     MOVELMGINSA    HLD2    2                       CSW200
     C                     MOVEL@CYCD     HLD5                            CSW200
     C                     MOVE HLD2      HLD5    5                       CSW200
     C                     MOVELHLD5      MFLD                            CSW200
     C                     MOVELMSGA,3    MERR                            CSW200
     C                     MOVE ':57 :'   MTAG                            CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
     C           MGBRCA    IFNE A7BRCD                                    CSW200
     C**********           CALL 'AOBRCHR0'                                             CSW200 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD                           CSW200
     C                     PARM '*KEY   ' @OPTN                           CSW200
     C                     PARM A7BRCD    @BRCD   3                       CSW200
     C           SDBRCH    PARM SDBRCH    DSSDY                           CSW200
      *                                                                   CSW200
      ** Branch record not found - Error                                  CSW200
      *                                                                   CSW200
     C           @RTCD     IFNE *BLANKS                                   CSW200
     C           *LOCK     IN   LDA                                       CSW200
     C                     MOVE '031'     DBASE              * * * * * * *CSW200
     C                     MOVELA7BRCD    DBKEY              * DBERR 031 *CSW200
     C                     MOVEL'SDBRCHPD'DBFILE             * * * * * * *CSW200
     C                     OUT  LDA                                       CSW200
     C                     EXSR *PSSR                                     CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
      *                                                                   CSW200
      **  Format our Receive Nostro Customer Address                      CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELA8BICN    ZDEST                           CSW200
     C                     MOVEL*BLANKS   ACLINE 35                       CSW200
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '56'      FLDNO                           CSW200
     C                     EXSR FSWAD                                     CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELA7CUST    ZDEST                           CSW200
     C                     MOVE *BLANKS   ACLINE                          CSW200
     C                     MOVE *BLANKS   @OANN                           188609
     C***********A7OANN    IFNE *BLANKS                                                188609 210796
     C***********          MOVE A7OANN    @OANN  15                                    188609 210796
     C           A7OACN    IFNE *BLANKS                                                       210796
     C                     MOVE A7OACN    @OANN                                               210796
     C                     MOVEL'/'       @OANN                           188609
     C                     END                                            188609
     C                     MOVEL@OANN     ACLINE                          188609
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '57'      FLDNO                           CSW200
     C                     EXSR FSWAD                                     CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      ** Settlement method internal.                                      CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C           MGIMET    IFNE '00'                                      CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELSECN      ZDEST                           CSW200
     C                     MOVEL*BLANKS   ACLINE                          CSW200
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '57'      FLDNO                           CSW200
     C                     EXSR FSWAD                                     CSW200
      *                                                                   CSW200
      ** No settlement type entered.                                      CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
     C                     MOVE ':57D:'   MTAG                            CSW200
     C                     MOVEL'UNKNOWN' MFLD                            CSW200
     C                     ENDIF                                          CSW200
     C                     ENDIF                                          CSW200
     C                     ENDIF                                          CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     MOVE *BLANK    ZDBEI                                               CSW201
      *                                                                                       CSW201
     C                     ENDSR                                          CSW200
     C/EJECT                                                              CSW200
      *****************************************************************   CSW200
      *   FMH200  -                                                   *   CSW200
      *              - New field :15H: Beginning of sequence          *   CSW200
      *              - New field :24D: Type of dealing method         *   CSW200
      *              - New field :88D: Broker Identification          *   CSW200
      *   Called by - Main processing                                 *   CSW200
      *****************************************************************   CSW200
      *                                                                   CSW200
     C           FMH200    BEGSR                                          CSW200
      *                                                                   CSW200
     C                     MOVE *BLANKS   @WRK                            CSW200
     C*                                                                   CSW200
     C           MGBRKC    IFNE 'MAIL'                                    CSW200
     C           MGBRKC    ANDNE'TELX'                                    CSW200
     C           MGBRKC    ANDNE*BLANKS                                   CSW200
      *                                                                   CSW200
      ** FIELD :15H: - New Sequence                                       CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C                     MOVEL':15H:'   MTAG                            CSW200
     C                     MOVE *BLANKS   MFLD                            CSW200
     C/COPY WNCPYSRC,MG0320C067
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      ** FIELD :24D: - Dealing method                                     CSW200
      *                                                                   CSW200
     C           MGBRKC    IFNE 'TELX'                                    CSW200
     C           MGBRKC    ANDNE'MAIL'                                    CSW200
     C           MGBRKC    ANDNE*BLANKS                                   CSW200
     C*                                                                   CSW200
      **  Output /PHON/                                                   CSW200
     C           MGBRKC    IFEQ 'PHON'                                    CSW200
      *                                                                   CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C                     MOVEL':24D:'   MTAG                            CSW200
     C                     MOVEL'PHON'    MFLD                            CSW200
      *                                                                   CSW200
      ** Refers to a broker                                               CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      **  Access the broker file                                          CSW200
      *                                                                   CSW200
     C                     CALL 'AOBROKR0'                                CSW200
     C                     PARM '*MSG   ' @RTCD   7                       CSW200
     C                     PARM '*KEY   ' @OPTN   7                       CSW200
     C                     PARM MGBRKC    @BROKY  4                       CSW200
     C           SDBROK    PARM SDBROK    DSFDY                           CSW200
      *                                                                   CSW200
      ** If the broker code is not found.                                 CSW200
      *                                                                   CSW200
     C           @RTCD     IFNE *BLANKS                                   CSW200
     C                     MOVE 'Y'       @ERR                            CSW200
     C                     MOVELMSGA,4    MERR                            CSW200
     C                     MOVEAMGBRKC    @WRK,1                          CSW200
     C                     MOVE '1'       *IN25                           CSW200
      *                                                                   CSW200
      ** Format the broker field.                                         CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
     C           A9EBS     IFEQ 'Y'                                       CSW200
      *                                                                   CSW200
      ** Electronic brokerage system                                      CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C                     MOVEL':24D:'   MTAG                            CSW200
     C************         MOVEL'ELEC'    MFLD                      CSW200186635
     C           'ELEC/'   CAT  A9BKNM    MFLD                            186635
     C*                                                                   CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVEL':24D:'   MTAG                            CSW200
     C                     MOVEL'BROK'    MFLD                            CSW200
      *                                                                   CSW200
      ** FIELD :88D: Broker identification                                CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVEL':88D:'   MTAG                            CSW200
     C                     MOVELA9BKNM    MFLD                            CSW200
     C*                                                                   187089
     C           A9ACBC    IFNE *BLANKS                                   187089
     C                     MOVEL*BLANKS   MFLD                            187089
     C                     MOVELA9ACBC    MFLD                            187089
     C                     ENDIF                                          187089
     C*                                                                   187089
     C           A9BRTN    IFNE *BLANKS                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVELA9BRTN    MFLD                            CSW200
     C                     ENDIF                                          CSW200
     C                     ENDIF                                          CSW200
     C                     ENDIF                                          CSW200
     C                     ENDIF                                          CSW200
     C                     ENDIF                                          CSW200
      *                                                                                      255986A
      * Check all six Bank to Bank Info fields and output any which                          255986A
      * contain data                                                                         255986A
      *                                                                                      255986B
     C           PAPOPB    IFEQ 'Y'                                                          255986B
     C           PAPOPB    OREQ 'P'                                                          255986B
      *                                                                                      255986B
     C                     CLEAR@BTB                                                         255986A
     C                     MOVELMGBTB1    @BTB,1                                             255986A
     C                     MOVELMGBTB2    @BTB,2                                             255986A
     C                     MOVELMGBTB3    @BTB,3                                             255986A
     C                     MOVELMGBTB4    @BTB,4                                             255986A
     C                     MOVELMGBTB5    @BTB,5                                             255986A
     C                     MOVELMGBTB6    @BTB,6                                             255986A
     C                     MOVE *BLANKS   LINE1   1                                           CDL094
      *                                                                                      255986A
     C           1         DO   6         CT6     10                                         255986A
     C           @BTB,CT6  IFNE *BLANKS                                                      255986A
     C                     ADD  1         X                                                  255986A
     C           X         OCUR MULT                                                         255986A
     C                     MOVE *BLANKS   MTAG                                               255986A
      *                                                                                      255986A
      **  If this is the first line of field 72 then set tag to ':72: '                      255986A
     C******     *IN25     IFNE '1'                                                   255986A CDL094
     C           LINE1     IFEQ ' '                                                           CDL094
     C                     MOVE ':72: '   MTAG                                               255986A
     C******               MOVE '1'       *IN25                                       255986A CDL094
     C                     MOVE 'N'       LINE1                                               CDL094
     C                     ENDIF                                                             255986A
     C                     MOVE *BLANKS   MFLD                                               255986A
     C                     MOVE *BLANKS   MERR                                               255986A
     C                     MOVEL@BTB,CT6  MFLD                                               255986A
     C                     ENDIF                                                             255986A
     C                     ENDDO                                                             255986A
     C                     ENDIF                                                             255986B
      *                                                                                      255986A
     C/COPY WNCPYSRC,MG0320C050
      *                                                                   CSW200
     C                     ENDSR                                          CSW200
      *****************************************************************
      ****NWAD*-*determine*default*network*addresses*******************   CSW096
      ****Called*by*-*ROUT*determine*message*routing*******************   CSW096
      *****************************************************************   CSW096
      ***********                                                         CSW096
     C***********NWAD      BEGSR                                          CSW096
      ***********                                                         CSW096
      ****Default*is*SWIFT************************************************CSW096
      ***********                                                         CSW096
     C***********BBDNW3    IFEQ 'SWIFT'                                   CSW096
     C***********BBCSID    ANDNE*BLANKS                                   CSW096
     C***********@BIC      ANDNE'BIC'                                     CSW096
     C***********BGMSDL    ANDEQ'Y'                                       CSW096
     C***********          MOVELSCSID     NWSN                            CSW096
     C***********          MOVELBBCSID    NWDS                            CSW096
     C***********          MOVELBBDNW3    NWRK                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****Default*is*TELEX************************************************CSW096
      ***********                                                         CSW096
     C***********BBDNW3    IFEQ 'TELEX'                                   CSW096
     C***********BBTXA1    ANDNE*BLANKS                                   CSW096
     C***********BGMTMI    ANDEQ'Y'                                       CSW096
     C***********          MOVELSTELX     NWSN                            CSW096
     C***********          MOVELBBTXA1    NWDS                            CSW096
     C***********          MOVE BBDNW3    NWRK                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****Default*is*STTX*************************************************CSW096
      ***********                                                         CSW096
     C***********BBDNW3    IFEQ 'STTX'                                    CSW096
     C***********BBSTAD    ANDNE*BLANKS                                   CSW096
     C***********BGMSDL    ANDEQ'Y'                                       CSW096
     C***********          MOVELSSTTX     NWSN                            CSW096
     C***********          MOVELBBSTAD    NWDS                            CSW096
     C***********          MOVE BBDNW3    NWRK                            CSW096
     C***********          END                                            CSW096
     C***********                                                  CCF001 CSW096
     C*****If*the*ConCord*switch*is*ON,*and*the*customer*is*a*corpoCCF001 CSW096
     C************customer*****************************************CCF001 CSW096
     C***********                                                  CCF001 CSW096
     C************IN27     IFEQ '1'                                CCF001 CSW096
     C***********BBCRPC    ANDEQ'Y'                                CCF001 CSW096
     C***********                                                  CCF001 CSW096
     C****Default*is*Concord***************************************CCF001 CSW096
     C***********                                                  CCF001 CSW096
     C***********BBDNW3    IFEQ 'CONCOR'                           CCF001 CSW096
     C***********BGMSDL    ANDEQ'Y'                                CCF001 CSW096
     C***********          MOVELBBPSWC    NWDS                     CCF001 CSW096
     C***********          MOVELSCSID     NWSN                     CCF001 CSW096
     C***********          MOVE 'RSND'    MGST                     CCF001 CSW096
     C***********          MOVE '2'       MGSG                     CCF001 CSW096
     C***********          END                                     CCF001 CSW096
     C***********          END                                     CCF001 CSW096
      ***********                                                         CSW096
      ****Default*is*PAPER************************************************CSW096
      ***********                                                         CSW096
     C***********BBDNW3    IFEQ 'PAPER'                                   CSW096
     C***********          MOVELSCRNM     NWSN                            CSW096
     C***********          MOVELBBCRNM    NWDS                            CSW096
     C***********          MOVE BBDNW3    NWRK                            CSW096
      ***********                                                         CSW096
      ****If*the*ICD*option*for*free*format*confirmations*is*'Y'**********CSW096
      ****the*message*has*already*been*printed*,*hence*no*further*********CSW096
      ****print*out*is*needed.********************************************CSW096
     C***********ENFFCR    IFEQ 'Y'                                       CSW096
     C***********          MOVEL'PRTD'    MGST                            CSW096
     C***********          MOVE '3'       MGSG                            CSW096
     C***********          ELSE                                           CSW096
     C***********          MOVEL'RSND'    MGST                            CSW096
     C***********          MOVE '2'       MGSG                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****Found*to*be*unroutable******************************************CSW096
      ***********                                                         CSW096
     C***********NWRK      IFEQ *BLANKS                                   CSW096
     C***********NWDS      OREQ *BLANKS                                   CSW096
     C***********NWSN      OREQ *BLANKS                                   CSW096
     C***********          MOVELSCRNM     NWSN                            CSW096
     C***********          MOVELBBCRNM    NWDS                            CSW096
     C***********          MOVEL'UNROUT'  NWRK                            CSW096
     C***********          MOVE 'CRTD'    MGST                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          ENDSR                                          CSW096
     C*/EJECT****                                                         CSW096
      *****************************************************************   CSW096
      ****PRAD*-*determine*priority*network*addresses******************   CSW096
      ****Called*by**ROUT***determine*message*routing******************   CSW096
      ****Calls******TXROUT*priority*routing*to*STTX/Telex*************   CSW096
      ***************SWROUT*priority*routing*to*SWIFT******************   CSW096
      *****************************************************************   CSW096
      ***********                                                         CSW096
     C***********PRAD      BEGSR                                          CSW096
      ***********                                                         CSW096
     C*****If*the*ConCord*switch*is*ON,*and*the*customer*is*a*corpoCCF001 CSW096
     C************customer*****************************************CCF001 CSW096
     C***********                                                  CCF001 CSW096
     C************IN27     IFEQ '1'                                CCF001 CSW096
     C***********BBCRPC    ANDEQ'Y'                                CCF001 CSW096
     C***********                                                  CCF001 CSW096
     C****Set*Default*network*to*be*ConCord************************CCF001 CSW096
     C***********                                                  CCF001 CSW096
     C***********          MOVEL'CONCOR'  NWRK                     CCF001 CSW096
     C***********          MOVELBBPSWC    NWDS                     CCF001 CSW096
     C***********          MOVELSCSID     NWSN                     CCF001 CSW096
     C***********          MOVE 'RSND'    MGST                     CCF001 CSW096
     C***********          MOVE '2'       MGSG                     CCF001 CSW096
     C***********          ELSE                                    CCF001 CSW096
     C***********                                                  CCF001 CSW096
      ****If*STTX/Telex*has*higher*priority*than*SWIFT*attempt************CSW096
      ****STTX/Telex*routing*first,*followed*by*SWIFT.*(nb.*'Higher'******CSW096
      ****priority*is*numerically*lower*ie.*'1'*is*higher*than*'2')*******CSW096
     C***********BLTXPY    IFLT BLSWPY                                    CSW096
     C***********          EXSR TXROUT                                    CSW096
     C***********          EXSR SWROUT                                    CSW096
      ***********                                                         CSW096
      ****otherwise*attempt*SWIFT*routing*first***************************CSW096
     C***********          ELSE                                           CSW096
     C***********          EXSR SWROUT                                    CSW096
     C***********          EXSR TXROUT                                    CSW096
     C***********          END                                            CSW096
     C***********          END                                     CCF001 CSW096
      ***********                                                         CSW096
      ****If*failed*to*route*to*electronic*network,*produce*paper*********CSW096
     C***********NWRK      IFEQ *BLANKS                                   CSW096
     C***********          MOVEL'PAPER'   NWRK                            CSW096
     C***********          MOVELSCRNM     NWSN                            CSW096
     C***********          MOVELBBCRNM    NWDS                            CSW096
      ***********                                                         CSW096
      ****If*the*ICD*option*for*free*format*advices*is*'Y'*the************CSW096
      ****message*has*already*been*printed*,*hence*no*further*************CSW096
      ****print*out*is*needed.********************************************CSW096
     C***********ENFFCR    IFEQ 'Y'                                       CSW096
     C***********          MOVEL'PRTD'    MGST                            CSW096
     C***********          MOVE '3'       MGSG                            CSW096
     C***********          ELSE                                           CSW096
     C***********          MOVEL'RSND'    MGST                            CSW096
     C***********          MOVE '2'       MGSG                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          ENDSR                                          CSW096
     C*/EJECT****                                                         CSW096
      *****************************************************************   CSW096
      ****TXROUT*-*Attempt*priority*routing*to*STTX/Telex,*if*not******   CSW096
      *************already*routed**************************************   CSW096
      ****Called*by***PRAD*********************************************   CSW096
      ****Calls*******-************************************************   CSW096
      *****************************************************************   CSW096
      ***********                                                         CSW096
     C***********TXROUT    BEGSR                                          CSW096
      ***********                                                         CSW096
      ****If*not*already*routed,*attempt*STTX/Telex*routing***************CSW096
     C***********NWRK      IFEQ *BLANKS                                   CSW096
      ***********                                                         CSW096
      ****Note*that*STTX*and*Telex*are*mutually*exclusive*-*try*both******CSW096
     C***********BGMSDL    IFEQ 'Y'                                       CSW096
     C***********BBSTAD    ANDNE*BLANKS                                   CSW096
     C***********SSTTX     ANDNE*BLANKS                                   CSW096
     C***********          MOVELSSTTX     NWSN                            CSW096
     C***********          MOVELBBSTAD    NWDS                            CSW096
     C***********          MOVEL'STTX'    NWRK                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********BGMTMI    IFEQ 'Y'                                       CSW096
     C***********BBTXA1    ANDNE*BLANKS                                   CSW096
     C***********STELX     ANDNE*BLANKS                                   CSW096
     C***********          MOVELSTELX     NWSN                            CSW096
     C***********          MOVELBBTXA1    NWDS                            CSW096
     C***********          MOVEL'TELEX'   NWRK                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          ENDSR                           TXROUT         CSW096
      ***********                                                         CSW096
     C*/EJECT****                                                         CSW096
      *****************************************************************   CSW096
      ****SWROUT*-*Attempt*priority*routing*to*SWIFT*if*not*already****   CSW096
      *************routed**********************************************   CSW096
      ****Called*by***PRAD*********************************************   CSW096
      ****Calls*******-************************************************   CSW096
      *****************************************************************   CSW096
      ***********                                                         CSW096
     C***********SWROUT    BEGSR                                          CSW096
      ***********                                                         CSW096
      ****If*not*already*routed,*attempt*SWIFT*routing********************CSW096
     C***********NWRK      IFEQ *BLANKS                                   CSW096
     C***********BGMSDL    ANDEQ'Y'                                       CSW096
     C***********BBCSID    ANDNE*BLANKS                                   CSW096
     C***********SCSID     ANDNE*BLANKS                                   CSW096
     C***********@BIC      ANDNE'BIC'                                     CSW096
     C***********          MOVELSCSID     NWSN                            CSW096
     C***********          MOVELBBCSID    NWDS                            CSW096
     C***********          MOVEL'SWIFT'   NWRK                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          ENDSR                           SWROUT         CSW096
      ***********                                                         CSW096
     C*/EJECT****                                                         CSW096
     C*/EJECT****                                                         CSW096
      *****************************************************************   CSW096
      ****FILL*-*Fill*up*array*GNR.************************************   CSW096
      ****Called*by*-*ROUT**determine*message*routing******************   CSW096
      *****************************************************************   CSW096
      ***********                                                         CSW096
     C***********FILL      BEGSR                                          CSW096
      ***********                                                         CSW096
      ****Is*message*to*be*generated*as*released*?************************CSW096
     C***********          MOVE BBDS01    GNR,1                           CSW096
     C***********          MOVE BBDS02    GNR,2                           CSW096
     C***********          MOVE BBDS03    GNR,3                           CSW096
     C***********          MOVE BBDS04    GNR,4                           CSW096
     C***********          MOVE BBDS05    GNR,5                           CSW096
     C***********          MOVE BBDS06    GNR,6                           CSW096
     C***********          MOVE BBDS07    GNR,7                           CSW096
     C***********          MOVE BBDS08    GNR,8                           CSW096
     C***********          MOVE BBDS09    GNR,9                           CSW096
     C***********          MOVE BBDS10    GNR,10                          CSW096
     C***********          MOVE BBDS11    GNR,11                          CSW096
     C***********          MOVE BBDS12    GNR,12                          CSW096
     C***********          MOVE BBDS13    GNR,13                          CSW096
     C***********          MOVE BBDS14    GNR,14                          CSW096
     C***********          MOVE BBDS15    GNR,15                          CSW096
      ***********                                                         CSW096
     C***********          ENDSR                                          CSW096
     C/EJECT
      *****************************************************************
      *   REPT - print incorrectly generated messages                 *
      *   Called by - main process                                    *
      *****************************************************************
      *
     C           REPT      BEGSR
      *
      ** If MG0320P1 has not previously opened.
      *
     C           *IN50     IFEQ '0'
     C                     OPEN MG0320P1
     C                     SETON                     50                   084320
     C************         SETON                     50U7                 084320
     C                     END
      *
     C                     WRITEHEADER
     C                     WRITETEXT
      *
      **  Process multiple occurrence data structure
      *
     C                     Z-ADD0         I       20
     C           I         DOWLEX
     C                     ADD  1         I
     C           I         OCUR MULT
     C                     WRITELINE
     C                     END
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   OMSG - output correctly generated messages                  *
      *   Called by - main process                                    *
      *   Calls - WREF Write o/p reference to PF/MGOREFPD.            *
      *****************************************************************
      *
     C           OMSG      BEGSR
      *
      **  Write reference record to PF/MGOREFPD.
      *
     C                     EXSR WREF
      *                                                                                       CSW208
     C                     EXSR MSGSZ                                                         CSW208
      *
      **  Write multiple occurrence data structure to MGOMSGPD
     C**********           Z-ADD1         X       20                                          CSW208
     C                     Z-ADD1         X                                                   CSW208
     C           X         OCUR MULT
      *
     C***********X         DOWLE40                                        CSW200
     C***********MFLD      ANDNE*BLANKS                                   CSW200
     C********** X         DOWLE85                                                     CSW200 CSW208
     C           X         DOWLE999                                                           CSW208
     C           MFLD      ANDNE*BLANKS                                   CSW200
     C********** X         ORLE 85                                                     CSW200 CSW208
     C           X         ORLE 999                                                           CSW208
     C           MTAG      ANDNE*BLANKS                                   CSW200
      *                                                                                       CSW208
     C           CSW208    IFEQ 'Y'                                                           CSW208
     C           CAS009    ANDEQ'Y'                                                           CSW208
     C           MSGBYT    ANDGT10000                                                         CSW208
     C           X         ANDGT@X                                                            CSW208
     C           X         ANDLE@Y                                                            CSW208
     C                     ADD  1         X                                                   CSW208
     C           X         OCUR MULT                                                          CSW208
     C                     ITER                                                               CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C                     WRITEMGOMSGD0               06
      *
      **  Error on write to PF/MGOMSGPD (message data file)
      *
     C           *IN06     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '012'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 012  *
     C                     MOVEL'MGOMSGPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
     C/COPY WNCPYSRC,MG0320C009
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
      *                                                                   183583
      ** Write multiple occurrence data structure to MGOEXTPD             183583
      *                                                                   183583
     C                     Z-ADD1         V       20                      183583
     C           V         OCUR EXTN                                      183583
     C           V         DOWLE20                                        183583
     C           MCSI      ANDNE*BLANKS                                   183583
     C                     WRITEMGOEXTD0               06                 183583
      *                                                                   183583
      ** Error on write to PF/MGOEXTPD (message data extension file)      183583
      *                                                                   183583
     C           *IN06     IFEQ '1'                                       183583
     C           *LOCK     IN   LDA                                       183583
     C                     MOVE '028'     DBASE            ************** 183583
     C                     MOVEL'        'DBKEY            * DBERROR 28 * 183583
     C                     MOVEL'MGOEXTPD'DBFILE           ************** 183583
     C                     OUT  LDA                                       183583
     C                     EXSR *PSSR                                     183583
     C                     ENDIF                                          183583
     C                     ADD  1         V                               183583
     C           V         OCUR EXTN                                      183583
     C                     ENDDO                                          183583
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   CFMAT - produce confirmation matching feedback record       *
      *   Called by   Main process                                    *
      *   Calls       -                                               *
      *****************************************************************
      *
     C           CFMAT     BEGSR
      *
     C                     CALL 'MG5001'
     C                     PARM TRNO      @TRNM  16
     C                     PARM MGBRCA    @BRCA   3
     C                     PARM *BLANK    @FEED   1
      *
     C           @FEED     IFEQ 'Y'
      *
     C           *IN50     IFEQ '0'
     C                     OPEN MG0320P1
     C                     SETON                     50U7
     C                     END
      *
      **   Set up headings and sender/customer information
      **       for the error report
     C                     MOVE '1'       *IN30
     C                     MOVELMGTNUM    TNUM    60
     C                     WRITEHEADER
     C                     WRITETEXT
     C                     WRITEFEED
     C                     MOVE '0'       *IN30
     C                     END
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   WREF - Write reference record to PF/MGOREFPD                *
      *   Called by - OMSG  output message PF/MGOMSGPD                *
      *****************************************************************
      *
     C           WREF      BEGSR
      *
     C                     MOVE *BLANKS   SYTM
     C                     MOVE MGMODI    MODI
     C                     MOVE @TRNA     TRNO
     C                     MOVE *BLANKS   TRNF
     C                     MOVE *BLANKS   TRNM
     C                     MOVELMGTNUM    MTRN
     C                     MOVE MGTTYP    TNTP
     C                     MOVE MGTSTP    SBTP
     C                     MOVE MGEVTP    EVTP                            E29588
     C                     MOVEL*BLANKS   NWBN
     C                     MOVE '320'     MTPY
     C                     MOVE 'N'       MPRY
     C                     MOVELCWRD      LSCC
     C/COPY WNCPYSRC,MG0320C066
     C                     MOVEL*BLANKS   PTST
     C                     MOVEL*BLANKS   CARQ
     C                     MOVEL*BLANKS   MPDE
     C                     MOVEL@HRDT     HRDT
     C                     TIME           MGTM
     C                     MOVE BJMRDT    LADT
     C                     MOVE MGTM      LATM
      *
      ** Initiate the Midas Watch List Checking Engine if CSD015 is                           CSD015
      ** enabled and CSW025 is disabled.                                                      CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           222385
     C           CSW025    ANDEQ'N'                                                           CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           MGST      IFEQ 'RSND'
     C                     MOVE BJMRDT    RELD
     C                     MOVE MGTM      RELT
     C                     MOVE '2'       MGSG
     C                     END
     C           MGST      IFEQ 'CRTD'
     C                     MOVE '1'       MGSG
     C                     END
     C           MGST      IFEQ 'PRTD'
     C                     MOVE '3'       MGSG
     C                     END
     C/COPY WNCPYSRC,MG0320C002
      *
     C                     MOVEL*BLANKS   RUSR
     C                     MOVEL*BLANKS   RWSN
     C                     MOVEL*BLANKS   AMTS
     C                     MOVEL*BLANKS   AMTX
     C                     MOVEL*BLANKS   SVDT
     C                     MOVEL*BLANKS   CINDV                           141572
     C                     MOVEL*BLANKS   CCY
     C                     MOVEL*BLANKS   NSNO
     C                     MOVEL*BLANKS   SACN
     C                     MOVEL*BLANKS   AORR
     C                     MOVEL*BLANKS   DESI
      *
      **  Branch details
      *
     C                     MOVE MGBRCA    BRCA
     C                     MOVE MGPOBR    OTHB
     C           OTHB      IFNE *BLANKS
     C                     MOVELMSGA,1    OTHT
     C                     END
     C                     MOVE MGROBR    RCBR
      *
     C                     MOVE *BLANKS   NETI
     C                     MOVE *BLANKS   DELC
     C                     MOVE *BLANKS   DYST
     C                     MOVE *BLANKS   RSID
     C                     MOVE *BLANKS   MSE1
     C                     MOVE *BLANKS   ELIN
     C                     MOVE *BLANKS   SSAC
     C                     MOVE *BLANKS   MIR
     C                     MOVE *BLANKS   TSKS
     C                     MOVE *BLANKS   TSKY
     C           CSW200    IFEQ 'Y'                                       186781
     C           MGMATU    ANDEQ'C'                                       186781
     C           CSW200    OREQ 'Y'                                       186781
     C           MGMATU    ANDEQ'I'                                       186781
     C                     MOVEL'Y'       CFPF                            186781
     C                     END                                            186781
     C           MGEVTP    IFEQ 'SC'                                                       AR694628A
     C           MGEVTP    OREQ 'EM'                                                       AR694628A
     C                     MOVE 'A'       AORR                                             AR694628A
     C                     ELSE                                                            AR694628A
     C                     MOVE MGCHTP    AORR                                                CSW025
     C                     ENDIF                                                           AR694628A
      *                                                                                     AR916823
      ** For Interest Adjustment, if 22A is AMND, AORR must be 'A'                          AR916823
      *                                                                                     AR916823
     C           WAMND     IFEQ 'Y'                                                         AR916823
     C                     MOVE 'A'       AORR                                              AR916823
     C                     ENDIF                                                            AR916823
     C/COPY WNCPYSRC,MG0320C031
      *
     C                     WRITEMGOREFD0               05
      *
      **  Error on write to PF/MGOREFPD (message reference file)
      *
     C           *IN05     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '014'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 014  *
     C                     MOVEL'MGOREFPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C           CSW200    IFEQ 'Y'                                       186781
     C           CFPF      ANDNE*BLANKS                                   186781
     C                     MOVEL*BLANKS   CFPF                            186781
     C                     END                                            186781
      *
      ** Write transaction history record                                                     190127
     C                     MOVELTRNO      @HREF                                               190127
     C                     MOVE '320'     HSMTPY                                              190127
      *                                                                                       190127
     C                     WRITEMGHISTD0               56                                     190127
      *                                                                                       190127
      **  Error on write to PF/MGHISTPD                                                       190127
     C           *IN56     IFEQ '1'                                                           190127
     C           *LOCK     IN   LDA                                                           190127
     C                     MOVE '027'     DBASE            * * * * * * * *                    190127
     C                     MOVEL'       ' DBKEY            *  DBERR 027  *                    190127
     C                     MOVEL'MGHISTPD'DBFILE           * * * * * * * *                    190127
     C                     OUT  LDA                                                           190127
     C                     EXSR *PSSR                                                         190127
     C                     END                                                                190127
      *
     C/COPY WNCPYSRC,MG0320C010
     C                     ENDSR
      *
     C/EJECT
     C********************************************************************066550
     C***GLINTC**To calculate interest between any two day numbers     .  066550
     C*****Calculation methods are -                                      066550
     C*****1**ACTUAL/365                                                  066550
     C*****2**ACTUAL/360                                                  066550
     C*****3**360/360 (SOMETIMES CALLED 30/360)                           066550
     C*****4**365/365 (EXCLUDING 29/02)                                   066550
     C*****5**365/360 (EXCLUDING 29/02)                                   066550
     C*****6**ACTUAL/366                                                  066550
     C***********                                                         066550
     C*****Calls*         ZSAVE                                           066550
     C***********         ZDATE2                                          066550
     C***********         ZRSTOR                                          066550
     C********************************************************************066550
     C***********                                                         066550
     C***********GLINTC    BEGSR                           ** GLINTC  **  066550
     C***********                                                         066550
     C****Calculations to define input fields.                            066550
     C***********          Z-ADDZIBEG     ZIBEG   50       starting date  066550
     C***********          Z-ADDZIEND     ZIEND   50       finishing date 066550
     C***********          Z-ADDZICALC    ZICALC  10       calc. basis    066550
     C***********          Z-ADDZIAMT     ZIAMT  150       principal      066550
     C***********          Z-ADDZIRATE    ZIRATE 117       rate of intrst 066550
     C***********                                                         066550
     C***To*determine number of days interest to be calculated            066550
     C***********ZIEND     SUB  ZIBEG     ZDAYN1  50                      066550
     C***********                                                         066550
     C****Check*for interest calculation basis                            066550
     C****Use*of*indicators                                               066550
     C*****1-92**2-90  3-91  4-97  5-96  6-95                             066550
     C***********          SETOF                     959697               066550
     C***********ZICALC    COMP 2                    919290               066550
     C**N91******          GOTO ZICAL                                     066550
     C***********ZICALC    COMP 5                    959796               066550
     C***97******ZICALC    COMP 3                    97  91               066550
     C***95******                                                         066550
     C*R*96******          SETOF                     91                   066550
     C**N91******          GOTO ZILPCK                                    066550
     C***********                                                         066550
     C****This*coding will calculate the number of days to use when       066550
     C****using*the 30/360 basis - METHOD 3.                              066550
     C***********          EXSR ZSAVE                                     066550
     C***********          Z-ADDZIBEG     ZDAYNO                          066550
     C***********          EXSR ZDATE2                                    066550
     C***********          MOVE ZDAY      ZISD    20                      066550
     C***********          MOVE ZMTH      ZISM    20                      066550
     C***********          MOVE ZYEAR     ZISY    20                      066550
     C***********          Z-ADDZIEND     ZDAYNO                          066550
     C***********          EXSR ZDATE2                                    066550
     C***********          MOVE ZDAY      ZIFD    20                      066550
     C***********          MOVE ZMTH      ZIFM    20                      066550
     C***********          MOVE ZYEAR     ZIFY    20                      066550
     C***********          EXSR ZRSTOR                                    066550
     C***********          SETOF                     93                   066550
     C****In*order for the finish year to be less than the start year if  066550
     C****ZIEND*is greater than ZIBEG, then the date ZIEND must be in a   066550
     C****different century to ZIBEG. If so add 100 years to it.          066550
     C***********ZIEND     COMP ZIBEG                93                   066550
     C***93******ZIFY      COMP ZISY                   93                 066550
     C***********          Z-ADDZISY      ZISY2   30                      066550
     C**N93******          Z-ADDZIFY      ZIFY2   30                      066550
     C***93******ZIFY      ADD  100       ZIFY2                           066550
     C***********                                                         066550
     C*****Determine whether start year is a leap year and if start       066550
     C*****month*is February.                                             066550
     C***********                                                         066550
     C**N98******          BITOF'0'       ZGLBIT  1                       066550
     C***98******          BITON'0'       ZGLBIT                          066550
     C***********ZISY2     ADD  1900      ZLYCHK  40                      066550
     C***********ZLYCHK    DIV  4         ZLYCHK                          066550
     C***********          MVR            ZLYREM  20                      066550
     C***********ZLYREM    COMP *ZERO                    98*LEAP YEAR     066550
     C***********ZISM      COMP 2                        99*FEBRUARY      066550
     C**N99******30        SUB  ZISD      ZID1    50   93                 066550
     C**N99*93***          Z-ADD0         ZID1                            066550
     C***99N98***28        SUB  ZISD      ZID1                            066550
     C***99*98***29        SUB  ZISD      ZID1                            066550
     C***********ZISM      COMP 12                       93               066550
     C***93******          Z-ADD0         ZISM                            066550
     C***93******ZISY      ADD  1         ZISY                            066550
     C***93******ZISY2     ADD  1         ZISY2                           066550
     C***********                                                         066550
     C*****Determine whether end year is a leap year and is end month     066550
     C*****is*February.                                                   066550
     C***********                                                         066550
     C***********ZIFY2     ADD  1900      ZLYCHK  40                      066550
     C***********ZLYCHK    DIV  4         ZLYCHK                          066550
     C***********          MVR            ZLYREM  20                      066550
     C***********ZLYREM    COMP *ZERO                    98*LEAP YEAR     066550
     C***********ZIFM      COMP 2                        99*FEBRUARY      066550
     C**N99******ZIFD      COMP 31                       93               066550
     C***99N98***ZIFD      COMP 28                       93               066550
     C***99*98***ZIFD      COMP 29                       93               066550
     C***********          SETOF                     98                   066550
     C***********          TESTB'0'       ZGLBIT         98               066550
     C***93******ZID1      ADD  30        ZID1                            066550
     C**N93******ZID1      ADD  ZIFD      ZID1                            066550
     C***********ZIFM      SUB  1         ZIFM                            066550
     C***********ZISY      COMP ZIFY                     93               066550
     C***93******ZIFM      SUB  ZISM      ZINOM   30                      066550
     C***93******          GOTO ZIOUT                                     066550
     C***********12        SUB  ZISM      ZIM1    20                      066550
     C***********          Z-ADD1         ZISM                            066550
     C****Use*enlarged fields that can handle 1999 onwards.               066550
     C***********ZISY2     ADD  1         ZISY2                           066550
     C***********ZIFY2     SUB  ZISY2     ZIY1    20                      066550
     C***********ZIY1      MULT 12        ZIM2    30                      066550
     C***********ZIM2      ADD  ZIFM      ZIM2                            066550
     C***********ZIM1      ADD  ZIM2      ZINOM                           066550
     C***********ZIOUT     TAG                             * ZIOUT TAG *  066550
     C***********ZINOM     MULT 30        ZID2    50                      066550
     C***********ZID2      ADD  ZID1      ZDAYN1                          066550
     C***********          SETOF                     93                   066550
     C***********ZILPCK    TAG                             * ZILPCK TAG * 066550
     C**N96N97***          GOTO ZICAL                                     066550
     C****The*following code applies for methods  4 and 5 only.           066550
     C****1*day*is subtracted from ZDAYN1 for each occurance of 29 FEB    066550
     C****in*the*interest calculation period inclusive of ZIBEG, & ZIEND. 066550
     C***********                                                         066550
     C****Find*no. of 4 year periods between dates                        066550
     C***********ZDAYN1    DIV  1461      ZIMAN   20                      066550
     C***********          MVR            ZIREM   50                      066550
     C****Find*next 29 Feb day no. on or after ZIBEG.                     066550
     C***********ZIBEG     SUB  60        ZIBW1   50                      066550
     C***********ZIBW1     DIV  1461      ZIDW1   20                      066550
     C***********          MVR            ZIDREM  50                      066550
     C***********ZIDREM    COMP 0                        94               066550
     C***94******          Z-ADDZIBEG     ZIDW2   50                      066550
     C***94******          GOTO ZILP1                                     066550
     C****Round*up result.                                                066550
     C***********ZIDW1     ADD  1         ZIDW2                           066550
     C****Calculate next 29 Feb.                                          066550
     C***********ZIDW2     MULT 1461      ZIDW2                           066550
     C***********ZIDW2     ADD  60        ZIDW2                           066550
     C***********ZILP1     TAG                             * ZILP1 TAG *  066550
     C****If*this next 29 Feb. DAYNO - ZIBEG is Gr. Th. or EQ. To         066550
     C*****ZIREM*then add 1 to ZIMAN.                                     066550
     C***********ZIDW2     SUB  ZIBEG     ZILPCP  50                      066550
     C***********ZIREM     COMP ZILPCP               94  94               066550
     C***94******ZIMAN     ADD  1         ZIMAN                           066550
     C****Subtract ZIMAN from ZDAYN1 to give value of ZDAYN1              066550
     C****required for this interest calculation.                         066550
     C***********ZDAYN1    SUB  ZIMAN     ZDAYN1                          066550
     C***********          SETOF                     94                   066550
     C***********ZICAL     TAG                             * ZICAL TAG *  066550
     C***********                                                         066550
     C****Calculate interest                                              066550
     C***90******                                                         066550
     C*R*91******                                                         066550
     C*R*96******ZIAMT     DIV  36000     ZIWRK1 155H                     066550
     C***92******                                                         066550
     C*R*97******ZIAMT     DIV  36500     ZIWRK1    H                     066550
     C***95******ZIAMT     DIV  36600     ZIWRK1    H                     066550
     C***********ZIWRK1    MULT ZIRATE    ZIWRK2 155H                     066550
     C***********ZIWRK2    MULT ZDAYN1    ZINTR  152H      amt. of intrst 066550
     C***********                                                         066550
     C***********          SETOF                     909192               066550
     C***********          SETOF                     959697               066550
     C***********                                                         066550
     C***********          ENDSR                                          066550
     C********************************************************************066550
     C/EJECT
     C********************************************************************
     C**
     C**   ZSAVE SR. TO MEMORISE THE SETTINGS AND TO SET OFF INDICATORS
     C**              90 - 97 BEFORE EXECUTION OF A Z-SUBROUTINE.
     C**
     C**   THIS SR. IS REQUIRED ONLY IF INDICATORS
     C**   90 - 97 ARE USED ELSEWHERE IN A PROGRAM.
     C**
     C           ZSAVE     BEGSR                           *** ZSAVE ***
     C**
     C                     BITOF'01234567'ZBITS   1
     C   90                BITON'0'       ZBITS
     C   91                BITON'1'       ZBITS
     C   92                BITON'2'       ZBITS
     C   93                BITON'3'       ZBITS
     C   94                BITON'4'       ZBITS
     C   95                BITON'5'       ZBITS
     C   96                BITON'6'       ZBITS
     C   97                BITON'7'       ZBITS
     C**
     C                     SETOF                     909192
     C                     SETOF                     939495
     C                     SETOF                     9697
     C**
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C**   ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.
     C**
     C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
     C**
     C           ZDATE2    BEGSR                           *** ZDATE2 ***
     C**
     C**   CLEAR LEAP YEAR WORK FIELD.
     C                     MOVE 'N'       ZLEAP   1
     C**
     C**   CLEAR DATE FIELDS.
     C                     Z-ADD0         ZDATE   60
     C                     MOVEL'       ' ZADATE  7
     C**
     C**   CALCULATION TO DEFINE INPUT DAY NUMBER.
     C                     Z-ADDZDAYNO    ZDAYNO  50
     C**
     C**   DETERMINE YEAR NUMBER.
     C**
     C**   ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.
     C           ZDAYNO    SUB  1         ZDAYN1  50
     C           ZDAYN1    IFLT 0
     C                     GOTO Z2END2
     C                     END
     C**
     C**   CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.
     C           ZDAYN1    DIV  1461      ZLYR    20
     C                     MVR            ZDAYN1           SAVE REMAINING
     C**                                                   DAYS
     C**   CALCULATE NUMBER OF REMAINING YEARS.
     C                     Z-ADD1         ZWRK2   20
     C           Z2TAG1    TAG                             ** Z2TAG1 TAG **
     C           ZDAYN1    IFGE ZYDY,ZWRK2
     C           ZWRK2     ADD  1         ZWRK2
     C                     GOTO Z2TAG1
     C                     END
     C*
     C           ZWRK2     SUB  1         ZWRK2
     C**
     C**   DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.
     C           ZWRK2     IFNE 0
     C           ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1
     C                     END
     C**
     C**   CALCULATE ACTUAL YEAR NUMBER.
     C           ZLYR      MULT 4         ZWRK3   30
     C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972
     C                     Z-ADDZWRK3     ZYEAR   20
     C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR
     C**
     C**   DETERMINE MONTH NUMBER.
     C**
     C**   ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.
     C           ZWRK2     IFEQ 0
     C           ZDAYN1    IFEQ 59
     C                     MOVE 'Y'       ZLEAP
     C                     END
     C           ZDAYN1    IFGE 59
     C           ZDAYN1    SUB  1         ZDAYN1
     C                     END
     C                     END
     C**
     C**   CALCULATE MONTH NUMBER.
     C                     Z-ADD2         ZWRK2
     C           Z2TAG2    TAG                             ** ZDTAG2 TAG *
     C           ZDAYN1    IFGE ZMDY,ZWRK2
     C           ZWRK2     ADD  1         ZWRK2
     C                     GOTO Z2TAG2
     C                     END
     C*
     C           ZWRK2     SUB  1         ZWRK2
     C**
     C                     Z-ADDZWRK2     ZMTH    20       MONTH
     C**
     C**   DETERMINE DAY OF MONTH.
     C**
     C**   ADD BACK LAST DAY OF YEAR ADJUSTMENT.
     C           ZDAYN1    ADD  1         ZDAYN1
     C**
     C**   CALCULATE DAY OF MONTH.
     C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY
     C**
     C**   ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.
     C           ZLEAP     IFEQ 'Y'
     C           ZDAY      ADD  1         ZDAY
     C                     END
     C**
     C**   FORMAT DATE, DDMMYY OR MMDDYY.
     C  N98                MOVELZDAY      ZWRK4   40
     C   98                MOVE ZDAY      ZWRK4
     C  N98                MOVE ZMTH      ZWRK4
     C   98                MOVELZMTH      ZWRK4
     C                     MOVELZWRK4     ZDATE
     C                     MOVE ZYEAR     ZDATE
     C**
     C**   FORMAT ALPHA DATE, DDMMMYY.
     C                     MOVELZDAY      ZWRK5   5
     C           ZDAY      IFLT 10
     C                     MOVEL' '       ZWRK5
     C                     END
     C                     MOVE ZMNM,ZMTH ZWRK5
     C                     MOVELZWRK5     ZADATE
     C                     MOVE ZYEAR     ZADATE
     C**
     C           Z2END2    ENDSR                           * ZDEND2 ENDSR*
     C**
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C*    ZRSTOR SR. To restore indicators 90 - 97 to the settings
     C*               they had before the execution of SR. ZSAVE.
      *****************************************************************
     C*
     C           ZRSTOR    BEGSR                           *** ZRSTOR ***
     C*
     C                     TESTB'0'       ZBITS          90
     C                     TESTB'1'       ZBITS          91
     C                     TESTB'2'       ZBITS          92
     C                     TESTB'3'       ZBITS          93
     C                     TESTB'4'       ZBITS          94
     C                     TESTB'5'       ZBITS          95
     C                     TESTB'6'       ZBITS          96
     C                     TESTB'7'       ZBITS          97
     C*
     C                     ENDSR
      *****************************************************************
     C/EJECT
      *****************************************************************                       CSW208
      *   FMI208 - Format tags 15I, 18A, 30F, 32H                     *                       CSW208
      *   Called by - Main processing                                 *                       CSW208
      *****************************************************************                       CSW208
      *                                                                                       CSW208
     C           FMI208    BEGSR                                                              CSW208
      *                                                                                       CSW208
     C                     Z-ADDX         @X      30                                          CSW208
      *                                                                                       CSW208
     C           MGFTOT    IFGT 0                                                             CSW208
      *                                                                                       CSW208
      ** Output tag :15I:                                                                     CSW208
      *                                                                                       CSW208
     C                     ADD  1         X                                                   CSW208
     C           X         OCUR MULT                                                          CSW208
     C                     MOVEL':15I:'   MTAG                                                CSW208
     C                     MOVEL*BLANKS   MFLD                                                CSW208
     C                     ADD  7         FMTIBY                                              CSW208
      *                                                                                       CSW208
      ** Output tag :18A:                                                                     CSW208
      *                                                                                       CSW208
     C                     ADD  1         X                                                   CSW208
     C           X         OCUR MULT                                                          CSW208
     C                     MOVEL':18A:'   MTAG                                                CSW208
     C                     MOVELMGFTOT    MFLD                                                CSW208
     C                     EXSR MFLDSZ                                                        CSW208
     C                     ADD  LENGTH    FMTIBY                                              CSW208
     C                     ADD  7         FMTIBY                                              CSW208
     C**********           ENDIF                                                     CSW208 BUG20466
      *                                                                                       CSW208
      ** Clear History flag before processing transaction                                   BUG20466
      *                                                                                     BUG20466
     C                     MOVEL*BLANKS   SAVHST                                            BUG20466
      *                                                                                     BUG20466
     C           KX320     KLIST                                                              CSW208
     C                     KFLD           MFSEQN                                              CSW208
      *                                                                                       CSW208
     C                     Z-ADDMGSEQN    MFSEQN                                              CSW208
      *                                                                                       CSW208
     C           KX320     SETLLMGX320L0                                                      CSW208
     C           KX320     READEMGX320L0                 99                                   CSW208
      *                                                                                       CSW208
     C           *IN99     DOWEQ'0'                                                           CSW208
      *                                                                                       CSW208
      ** Output tag :30F:                                                                     CSW208
      *                                                                                       CSW208
     C                     ADD  1         X                                                   CSW208
     C           X         OCUR MULT                                                          CSW208
     C                     MOVE MFPDAT    ZMDAY                                               CSW208
      *                                                                                       CSW208
      **  Convert Midas date to SWIFT date format                                             CSW208
      *                                                                                       CSW208
     C                     CALL 'ZM0065'                                                      CSW208
     C                     PARM           ZMDAY                                               CSW208
     C                     PARM           ZSDATE                                              CSW208
     C                     PARM           ZSDATC                                              CSW208
      *                                                                                       CSW208
     C                     MOVEL':30F:'   MTAG                                                CSW208
     C                     MOVELZSDATC    MFLD                                                CSW208
     C                     EXSR MFLDSZ                                                        CSW208
     C                     ADD  LENGTH    FMTIBY                                              CSW208
     C                     ADD  7         FMTIBY                                              CSW208
      *                                                                                       CSW208
      ** Output tag :32H:                                                                     CSW208
      *                                                                                       CSW208
     C                     ADD  1         X                                                   CSW208
     C           X         OCUR MULT                                                          CSW208
      *                                                                                       CSW208
     C                     MOVE 'N'       WNEG                                                CSW208
      *                                                                                     BUG20466
      ** Determine 32H sign                                                                 BUG20466
      *                                                                                     BUG20466
     C           MGLORD    IFEQ 'L'                                                         BUG20466
     C           MFPAMT    ANDGT0                                                           BUG20466
      *                                                                                     BUG20466
     C           MGLORD    OREQ 'B'                                                         BUG20466
     C           MFPAMT    ANDLT0                                                           BUG20466
     C                     MOVE 'Y'       WNEG    1                                         BUG20466
     C                     ENDIF                                                            BUG20466
      *                                                                                     BUG20466
     C           MFPAMT    IFLT 0                                                             CSW208
     C**********           MOVE 'Y'       WNEG    1                                  CSW208 BUG20466
     C                     Z-SUBMFPAMT    MFPAMT                                              CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C                     MOVE MFPCCY    ZCCY                                                CSW208
     C                     MOVE MFPAMT    ZAMNT                                               CSW208
     C                     CALL 'ZM0040'                                                      CSW208
     C                     PARM           ZAMNT                                               CSW208
     C                     PARM           ZCCY                                                CSW208
     C                     PARM           ZSAMNT                                              CSW208
     C                     PARM           ZSCCY                                               CSW208
     C                     PARM           ZERR                                                CSW208
      *                                                                                       CSW208
     C                     MOVEL':32H:'   MTAG                                                CSW208
     C           ZSCCY     CAT  ZSAMNT:0  MFLD                                                CSW208
      *                                                                                       CSW208
     C           WNEG      IFEQ 'Y'                                                           CSW208
     C           'N'       CAT  MFLD      MFLD                                                CSW208
     C                     ENDIF                                                              CSW208
     C                     EXSR MFLDSZ                                                        CSW208
     C                     ADD  LENGTH    FMTIBY                                              CSW208
     C                     ADD  7         FMTIBY                                              CSW208
      *                                                                                       CSW208
     C           SAVHST    IFEQ 'H'                                                           CSW208
     C           SAVHST    OREQ ' '                                                           CSW208
     C                     MOVELMFHIST    SAVHST  1                                           CSW208
     C                     MOVELMFRIBN    SVRIBN  8                                           CSW208
     C                     MOVELMFRIBA    SVRIBA 35                                           CSW208
     C                     Z-ADDMFRSTM    SVRSTM  20                                          CSW208
     C                     MOVELMFROBR    SVROBR  3                                           CSW208
     C                     MOVELMFSTCY    SVSTCY  3                                           CSW208
     C                     MOVELMFRONS    SVRONS 18                                           CSW208
     C                     MOVELMFPCCY    SVPCCY  3                                           CSW208
     C                     Z-ADDMFPSTM    SVPSTM  20                                          CSW208
     C                     MOVELMFPONS    SVPONS 18                                           CSW208
     C                     MOVELMFAWBN    SVAWBN  8                                           CSW208
     C                     MOVELMFRVNO    SVRVNO  8                                           CSW208
     C                     MOVELMFPIBN    SVPIBN  8                                           CSW208
     C                     MOVELMFPIBA    SVPIBA 35                                           CSW208
     C                     MOVELMFBENA    SVBENA 35                                           CSW208
     C                     MOVELMFBENN    SVBENN  8                                           CSW208
     C                     MOVELMFAWBA    SVAWBA 35                                           CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C           KX320     READEMGX320L0                 99                                   CSW208
     C                     ENDDO                                                              CSW208
      *                                                                                       CSW208
     C********** WNEG      IFEQ 'Y'                                                  CSW208 BUG20466
     C**********           EXSR FM208P                                               CSW208 BUG20466
     C**********           ELSE                                                      CSW208 BUG20466
     C                     EXSR FM208R                                                        CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C                     ENDSR                                                              CSW208
      *****************************************************************                       CSW208
     C/EJECT                                                                                  CSW208
      *****************************************************************                       CSW208
      *   FM208R - Receive details                                    *                       CSW208
      *   Called by - FMI208                                          *                       CSW208
      *****************************************************************                       CSW208
      *                                                                                       CSW208
     C           FM208R    BEGSR                                                              CSW208
      *                                                                                       CSW208
     C                     Z-ADDX         @Y      30                                          CSW208
      *                                                                                       CSW208
     C           CSW201    IFEQ 'Y'                                                           CSW208
     C                     MOVE 'Y'       ZDBEI                                               CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
      ** Field 53 - Senders correspondant.                                                    CSW208
      ** If the module is lending try to format field 53.                                     CSW208
      *                                                                                       CSW208
     C           MGMODI    IFEQ 'LE'                                                          CSW208
      *                                                                                       CSW208
      ** If the receipt intermediary branch is not blank ; format                             CSW208
      ** this via FSWAD. (Else no field produced.)                                            CSW208
      *                                                                                       CSW208
     C           SVRIBN    IFNE *BLANKS                                                       CSW208
      *                                                                                       CSW208
     C                     ADD  1         X                                                   CSW208
     C           X         OCUR MULT                                                          CSW208
      *                                                                                       CSW208
     C                     MOVE *BLANKS   ZDEST                                               CSW208
     C                     MOVELSVRIBN    ZDEST                                               CSW208
     C                     MOVELSVRIBA    ACLINE                                              CSW208
     C                     MOVE ' '       TAG                                                 CSW208
     C                     MOVE '53'      FLDNO                                               CSW208
     C                     EXSR FSWAD                                                         CSW208
     C                     ENDIF                                                              CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
      ** Format fields 56 and 57.                                                             CSW208
      ** Branch code of sender not equal to Receive settlement branch.                        CSW208
      **  Test if settlement via nostro                                                       CSW208
      *                                                                                       CSW208
     C                     MOVE SVRSTM    @STM                                                CSW208
     C           @STM      LOKUPTABNST                   23                                   CSW208
     C/COPY WNCPYSRC,MG0320C061                                                               CSW208
     C           MGBRCA    IFNE SVROBR                                                        CSW208
     C           *IN23     ANDEQ'1'                                                           CSW208
      *                                                                                       CSW208
     C                     ADD  1         X                                                   CSW208
     C           X         OCUR MULT                                                          CSW208
      *                                                                                       CSW208
     C           SVRIBN    IFNE *BLANKS                                                       CSW208
     C                     MOVE *BLANKS   ZDEST                                               CSW208
     C                     MOVELSVRIBN    ZDEST                                               CSW208
     C                     MOVELSVRIBA    ACLINE                                              CSW208
     C                     MOVE ' '       TAG                                                 CSW208
     C                     MOVE '56'      FLDNO                                               CSW208
     C                     EXSR FSWAD                                                         CSW208
      *                                                                                       CSW208
     C                     ELSE                                                               CSW208
      *                                                                                       CSW208
      **  Access Branch file for the Internal customer number of the                          CSW208
      **  Receive branch (this will be used for the Intermediary                              CSW208
      **  Bank, because settlement is via an account owned                                    CSW208
      **  by a branch different to the receive branch)                                        CSW208
      *                                                                                       CSW208
     C                     CALL 'AOBRCHR0'                                                    CSW208
     C                     PARM '*MSG   ' @RTCD                                               CSW208
     C                     PARM '*KEY   ' @OPTN                                               CSW208
     C                     PARM SVROBR    @BRCD                                               CSW208
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CSW208
      *                                                                                       CSW208
      ** Branch record not found - Error                                                      CSW208
      *                                                                                       CSW208
     C           @RTCD     IFNE *BLANKS                                                       CSW208
     C           *LOCK     IN   LDA                                                           CSW208
     C                     MOVE '032'     DBASE              * * * * * * *                    CSW208
     C                     MOVELSVROBR    DBKEY              * DBERR 032 *                    CSW208
     C                     MOVEL'SDBRCHPD'DBFILE             * * * * * * *                    CSW208
     C                     OUT  LDA                                                           CSW208
     C                     EXSR *PSSR                                                         CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
      ** Format Intermediary using customer number of receive branch                          CSW208
      *                                                                                       CSW208
     C                     MOVE *BLANKS   ZDEST                                               CSW208
     C                     MOVELA8BICN    ZDEST                                               CSW208
     C                     MOVE ' '       TAG                                                 CSW208
     C                     MOVE '56'      FLDNO                                               CSW208
     C                     EXSR FSWAD                                                         CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
      ** Use settlement currency to access nostro if not blank.                               CSW208
      ** Otherwise use deal currency.                                                         CSW208
      *                                                                                       CSW208
     C           CEU003    IFEQ 'Y'                                                           CSW208
     C           SVSTCY    ANDNE*BLANKS                                                       CSW208
     C           CEU004    OREQ 'Y'                                                           CSW208
     C           SVSTCY    ANDNE*BLANKS                                                       CSW208
     C                     MOVE SVSTCY    @CYCD                                               CSW208
     C                     ELSE                                                               CSW208
     C                     MOVE SVPCCY    @CYCD                                               CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
      ** Field :57:  A/C With Institution                                                     CSW208
      *                                                                                       CSW208
     C/COPY WNCPYSRC,MG0320C062                                                               CSW208
      *                                                                                       CSW208
     C                     ADD  1         X                                                   CSW208
     C           X         OCUR MULT                                                          CSW208
     C*******              CALL 'AONOSTR0'                                             CSW208 CDL094
     C                     CALL 'AONOSTR1'                                                    CDL094
     C                     PARM '*MSG   ' @RTCD                                               CSW208
     C                     PARM '*KEY   ' @OPTN                                               CSW208
     C                     PARM *BLANKS   @CUST            I:Customer No                      CSW208
     C                     PARM           @CYCD            I:Currency                         CSW208
     C                     PARM *BLANKS   @ACCD            I:A/c Code                         CSW208
     C                     PARM *BLANKS   @ACSN            I:A/c Seq                          CSW208
     C                     PARM SVRONS    @NONB            I:Nostro No                        CSW208
     C                     PARM *BLANKS   @BRCD            I:Branch Code                      CSW208
     C                     PARM *BLANKS   @CSSN            I:Cust ShortN                      CSW208
     C                     PARM *BLANK    @PNOI            I:Prime Nost In                    CSW208
     C***********SDNOST    PARM SDNOST    DSFDY                                        CSW208 CDL094
     C           SDNOST    PARM SDNOST    DSSDY                                               CDL094
      *                                                                                       CSW208
      **  If our receive nostro is not found.                                                 CSW208
      *                                                                                       CSW208
     C           @RTCD     IFNE *BLANKS                                                       CSW208
     C                     MOVE 'Y'       @ERR                                                CSW208
     C                     MOVELSVRONS    HLD2    2                                           CSW208
     C                     MOVELSVPCCY    HLD5                                                CSW208
     C                     MOVE HLD2      HLD5    5                                           CSW208
     C                     MOVELHLD5      MFLD                                                CSW208
     C                     MOVELMSGA,3    MERR                                                CSW208
     C                     MOVE ':57 :'   MTAG                                                CSW208
     C                     ELSE                                                               CSW208
      *                                                                                       CSW208
      **  Format our Receive Nostro Customer Address                                          CSW208
      *                                                                                       CSW208
     C                     MOVE *BLANKS   ZDEST                                               CSW208
     C                     MOVELA7CUST    ZDEST                                               CSW208
     C                     MOVEL*BLANKS   ACLINE 35                                           CSW208
     C                     MOVE *BLANKS   @OANN                                               CSW208
     C           A7OANN    IFNE *BLANKS                                                       CSW208
     C                     MOVE A7OANN    @OANN                                               CSW208
     C                     MOVEL'/'       @OANN                                               CSW208
     C                     ENDIF                                                              CSW208
     C                     MOVEL@OANN     ACLINE                                              CSW208
     C                     MOVE ' '       TAG                                                 CSW208
     C                     MOVE '57'      FLDNO                                               CSW208
     C                     EXSR FSWAD                                                         CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
      ** Else the branch code of sender = receive settlement branch                           CSW208
      ** and the settlement is via a nostro.                                                  CSW208
      *                                                                                       CSW208
     C/COPY WNCPYSRC,MG0320C063                                                               CSW208
      *                                                                                       CSW208
     C                     ELSE                                                               CSW208
      *                                                                                       CSW208
     C           SVRIBN    IFNE *BLANKS                                                       CSW208
     C                     ADD  1         X                                                   CSW208
     C           X         OCUR MULT                                                          CSW208
     C                     MOVE *BLANKS   ZDEST                                               CSW208
     C                     MOVELSVRIBN    ZDEST                                               CSW208
     C                     MOVELSVRIBA    ACLINE                                              CSW208
     C                     MOVE ' '       TAG                                                 CSW208
     C                     MOVE '56'      FLDNO                                               CSW208
     C                     EXSR FSWAD                                                         CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C           @STM      LOKUPTABNST                   23                                   CSW208
     C/COPY WNCPYSRC,MG0320C064                                                               CSW208
      *                                                                                       CSW208
     C           *IN23     IFEQ '1'                                                           CSW208
     C                     ADD  1         X                                                   CSW208
     C           X         OCUR MULT                                                          CSW208
      *                                                                                       CSW208
      ** Use settlement currency to access nostro if not blank.                               CSW208
      ** Otherwise use deal currency.                                                         CSW208
      *                                                                                       CSW208
     C           CEU003    IFEQ 'Y'                                                           CSW208
     C           SVSTCY    ANDNE*BLANKS                                                       CSW208
     C           CEU004    OREQ 'Y'                                                           CSW208
     C           SVSTCY    ANDNE*BLANKS                                                       CSW208
     C                     MOVE SVSTCY    @CYCD                                               CSW208
     C                     ELSE                                                               CSW208
     C                     MOVE SVPCCY    @CYCD                                               CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C*******              CALL 'AONOSTR0'                                             CSW208 CDL094
     C                     CALL 'AONOSTR1'                                                    CDL094
     C                     PARM '*MSG   ' @RTCD                                               CSW208
     C                     PARM '*KEY   ' @OPTN                                               CSW208
     C                     PARM *BLANKS   @CUST            I:Customer No                      CSW208
     C                     PARM           @CYCD            I:Currency                         CSW208
     C                     PARM *BLANKS   @ACCD            I:A/c Code                         CSW208
     C                     PARM *BLANKS   @ACSN            I:A/c Seq                          CSW208
     C                     PARM SVRONS    @NONB            I:Nostro No                        CSW208
     C                     PARM *BLANKS   @BRCD            I:Branch Code                      CSW208
     C                     PARM *BLANKS   @CSSN            I:Cust ShortN                      CSW208
     C                     PARM *BLANK    @PNOI            I:Prime Nost In                    CSW208
     C***********SDNOST    PARM SDNOST    DSFDY                                        CSW208 CDL094
     C           SDNOST    PARM SDNOST    DSSDY                                               CDL094
      *                                                                                       CSW208
      **  If our receive nostro is not found.                                                 CSW208
      *                                                                                       CSW208
     C           @RTCD     IFNE *BLANKS                                                       CSW208
     C                     MOVE 'Y'       @ERR                                                CSW208
     C                     MOVELSVRONS    HLD2                                                CSW208
     C                     MOVELSVPCCY    HLD5                                                CSW208
     C                     MOVE HLD2      HLD5                                                CSW208
     C                     MOVELHLD5      MFLD                                                CSW208
     C                     MOVELMSGA,3    MERR                                                CSW208
     C                     MOVE ':57 :'   MTAG                                                CSW208
     C                     ELSE                                                               CSW208
      *                                                                                       CSW208
     C                     MOVE *BLANKS   ZDEST                                               CSW208
     C                     MOVELA7CUST    ZDEST                                               CSW208
      *                                                                                       CSW208
      *                                                                                       CSW208
     C                     MOVEL*BLANKS   ACLINE                                              CSW208
     C                     MOVE *BLANKS   @OANN                                               CSW208
     C           A7OANN    IFNE *BLANKS                                                       CSW208
     C                     MOVE A7OANN    @OANN                                               CSW208
     C                     MOVEL'/'       @OANN                                               CSW208
     C                     ENDIF                                                              CSW208
     C                     MOVEL@OANN     ACLINE                                              CSW208
     C                     MOVE ' '       TAG                                                 CSW208
     C                     MOVE '57'      FLDNO                                               CSW208
     C                     EXSR FSWAD                                                         CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C                     ELSE                                                               CSW208
      *                                                                                       CSW208
      ** Settlement method internal.                                                          CSW208
      *                                                                                       CSW208
     C                     ADD  1         X                                                   CSW208
     C           X         OCUR MULT                                                          CSW208
      *                                                                                       CSW208
     C           SVRSTM    IFNE 00                                                            CSW208
     C                     MOVE *BLANKS   ZDEST                                               CSW208
     C                     MOVELSECN      ZDEST                                               CSW208
     C                     MOVEL*BLANKS   ACLINE                                              CSW208
     C                     MOVE ' '       TAG                                                 CSW208
     C                     MOVE '57'      FLDNO                                               CSW208
     C                     EXSR FSWAD                                                         CSW208
      *                                                                                       CSW208
      ** No settlement type entered.                                                          CSW208
      *                                                                                       CSW208
     C                     ELSE                                                               CSW208
     C                     MOVE ':57D:'   MTAG                                                CSW208
     C                     MOVEL'UNKNOWN' MFLD                                                CSW208
     C                     ENDIF                                                              CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C                     ENDIF                                                              CSW208
     C/COPY WNCPYSRC,MG0320C065                                                               CSW208
      *                                                                                       CSW208
     C                     MOVE *BLANK    ZDBEI                                               CSW208
      *                                                                                       CSW208
     C                     ENDSR                                                              CSW208
      *****************************************************************                       CSW208
     C/EJECT                                                                                  CSW208
      *****************************************************************                       CSW208
      *   FM208P - Pay details                                        *                       CSW208
      *   Called by - FMI208                                          *                       CSW208
      *****************************************************************                       CSW208
      *                                                                                       CSW208
     C           FM208P    BEGSR                                                              CSW208
      *                                                                                       CSW208
     C                     Z-ADDX         @Y                                                  CSW208
     C                     MOVELSVAWBA    FAWB6   6                                           CSW208
      *                                                                                       CSW208
     C           CSW201    IFEQ 'Y'                                                           CSW208
     C                     MOVE 'Y'       ZDBEI                                               CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
      ** Field 53 - Senders correspondent.                                                    CSW208
      **  Test if settlement via nostro                                                       CSW208
      *                                                                                       CSW208
     C                     MOVE SVPSTM    @STM    2                                           CSW208
     C           @STM      LOKUPTABNST                   23                                   CSW208
      *                                                                                       CSW208
      ** If our pay nostro is not blank and the settlement is via a nostro                    CSW208
      *                                                                                       CSW208
     C           SVPONS    IFNE *BLANKS                                                       CSW208
     C           *IN23     ANDEQ'1'                                                           CSW208
      *                                                                                       CSW208
      **  either A/C with Bank or Receipient entered                                          CSW208
      **  or DIRECT entered                                                                   CSW208
      *                                                                                       CSW208
     C           SVAWBN    IFNE *BLANKS                                                       CSW208
     C           FAWB6     OREQ 'DIRECT'                                                      CSW208
     C/COPY WNCPYSRC,MG0320C056                                                               CSW208
      *                                                                                       CSW208
      ** Use settlement currency to access nostro if not blank.                               CSW208
      ** Otherwise use deal currency.                                                         CSW208
      *                                                                                       CSW208
     C           CEU003    IFEQ 'Y'                                                           CSW208
     C           SVSTCY    ANDNE*BLANKS                                                       CSW208
     C           CEU004    OREQ 'Y'                                                           CSW208
     C           SVSTCY    ANDNE*BLANKS                                                       CSW208
     C                     MOVE SVSTCY    @CYCD                                               CSW208
     C                     ELSE                                                               CSW208
     C                     MOVE SVPCCY    @CYCD                                               CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C                     MOVELSVPONS    @NONB                                               CSW208
     C*******              CALL 'AONOSTR0'                                             CSW208 CDL094
     C                     CALL 'AONOSTR1'                                                    CDL094
     C                     PARM '*MSG   ' @RTCD                                               CSW208
     C                     PARM '*KEY   ' @OPTN                                               CSW208
     C                     PARM *BLANKS   @CUST                                               CSW208
     C                     PARM           @CYCD                                               CSW208
     C                     PARM *BLANKS   @ACCD                                               CSW208
     C                     PARM *BLANKS   @ACSN                                               CSW208
     C                     PARM           @NONB                                               CSW208
     C                     PARM *BLANKS   @BRCD                                               CSW208
     C                     PARM *BLANKS   @CSSN                                               CSW208
     C                     PARM *BLANKS   @PNOI                                               CSW208
     C***********SDNOST    PARM SDNOST    DSFDY                                        CSW208 CDL094
     C           SDNOST    PARM SDNOST    DSSDY                                               CDL094
      *                                                                                       CSW208
      **  Nostro customer not found                                                           CSW208
      *                                                                                       CSW208
     C           @RTCD     IFNE *BLANKS                                                       CSW208
     C                     ADD  1         X                                                   CSW208
     C           X         OCUR MULT                                                          CSW208
     C                     MOVE 'Y'       @ERR                                                CSW208
     C                     MOVE ':53 :'   MTAG                                                CSW208
     C                     MOVELSVPONS    HLD2                                                CSW208
     C                     MOVELSVPCCY    HLD5                                                CSW208
     C                     MOVE HLD2      HLD5                                                CSW208
     C                     MOVELHLD5      MFLD                                                CSW208
     C                     MOVELMSGA,3    MERR                                                CSW208
     C                     ELSE                                                               CSW208
      *                                                                                       CSW208
      ** Branch Internal Customer cf. Customer number of Our Pay Nostro                       CSW208
      *                                                                                       CSW208
     C                     MOVELSECN      @SECN   6                                           CSW208
     C           @SECN     IFNE A7CUST                                                        CSW208
     C           SVAWBN    ANDNEA7CUST                                                        CSW208
     C                     MOVE *BLANKS   ZDEST                                               CSW208
     C           SVRVNO    IFEQ *BLANKS                                                       CSW208
     C                     MOVELA7CUST    ZDEST                                               CSW208
     C                     ELSE                                                               CSW208
     C                     MOVELSVRVNO    ZDEST                                               CSW208
     C                     ENDIF                                                              CSW208
     C                     CALL 'ZM0050'                                                      CSW208
     C                     PARM           ZDEST                                               CSW208
     C                     PARM           ZSADD1                                              CSW208
     C                     PARM           ZSADD2                                              CSW208
     C                     PARM           ZSADD3                                              CSW208
     C                     PARM           ZSADD4                                              CSW208
     C                     PARM           ZSTAG                                               CSW208
     C                     PARM           ZSTYPE                                              CSW208
     C                     PARM           ZERR                                                CSW208
     C                     PARM           ZDBEI                                               CSW208
      *                                                                                       CSW208
      **  Error when formating address                                                        CSW208
      *                                                                                       CSW208
     C           ZERR      IFEQ '1'                                                           CSW208
     C                     ADD  1         X                                                   CSW208
     C           X         OCUR MULT                                                          CSW208
     C                     MOVE 'Y'       @ERR                                                CSW208
     C                     MOVE ':53 :'   MTAG                                                CSW208
     C                     MOVELZDEST     MFLD                                                CSW208
     C                     MOVELMSGA,6    MERR                                                CSW208
     C                     ELSE                                                               CSW208
      *                                                                                       CSW208
      **  A Type address                                                                      CSW208
      *                                                                                       CSW208
     C           ZSTAG     IFEQ 'A'                                                           CSW208
     C                     ADD  1         X                                                   CSW208
     C           X         OCUR MULT                                                          CSW208
     C                     MOVE 'A'       TAG                                                 CSW208
     C                     MOVE '53'      FLDNO                                               CSW208
     C                     MOVE @MTAG     MTAG                                                CSW208
     C                     MOVELZSADD1    MFLD                                                CSW208
      *                                                                                       CSW208
     C                     ELSE                                                               CSW208
      *                                                                                       CSW208
      **  D Type address                                                                      CSW208
      *                                                                                       CSW208
     C                     ADD  1         X                                                   CSW208
     C           X         OCUR MULT                                                          CSW208
     C                     MOVE ':53D:'   MTAG                                                CSW208
     C                     MOVELZSADD1    MFLD                                                CSW208
      **  Address 2                                                                           CSW208
     C           ZSADD2    IFNE *BLANKS                                                       CSW208
     C                     ADD  1         X                                                   CSW208
     C           X         OCUR MULT                                                          CSW208
     C                     MOVELZSADD2    MFLD                                                CSW208
      **  Address 3                                                                           CSW208
     C           ZSADD3    IFNE *BLANKS                                                       CSW208
     C                     ADD  1         X                                                   CSW208
     C           X         OCUR MULT                                                          CSW208
     C                     MOVELZSADD3    MFLD                                                CSW208
      **  Address 4                                                                           CSW208
     C           ZSADD4    IFNE *BLANKS                                                       CSW208
     C                     ADD  1         X                                                   CSW208
     C           X         OCUR MULT                                                          CSW208
     C                     MOVELZSADD4    MFLD                                                CSW208
     C                     ENDIF                           D address 4                        CSW208
     C                     ENDIF                           D address 3                        CSW208
     C                     ENDIF                           D address 2                        CSW208
      *                                                                                       CSW208
     C                     ENDIF                           A/D address?                       CSW208
     C                     ENDIF                           Fmt ad. error                      CSW208
     C                     ENDIF                           Brch Int Cust.                     CSW208
     C                     ENDIF                           Nostro not fnd.                    CSW208
     C/COPY WNCPYSRC,MG0320C057                                                               CSW208
     C                     ENDIF                                                              CSW208
     C                     ENDIF                           Pay nostro?                        CSW208
      *                                                                                       CSW208
     C                     MOVE 'N'       FLD57O  1                                           CSW208
      *                                                                                       CSW208
      **  Field :57:  A/C with institution non-blank                                          CSW208
     C/COPY WNCPYSRC,MG0320C058                                                               CSW208
      *                                                                                       CSW208
     C           SVAWBN    IFNE *BLANKS                                                       CSW208
      *                                                                                       CSW208
      **  Field :56:  Pay Intermediary bank                                                   CSW208
      **  This field is only produced when the account with institution                       CSW208
      **  is non-blank.                                                                       CSW208
      **  If the pay intermediary is entered.                                                 CSW208
      *                                                                                       CSW208
     C           SVPIBN    IFNE *BLANKS                                                       CSW208
     C                     ADD  1         X                                                   CSW208
     C           X         OCUR MULT                                                          CSW208
     C                     MOVE *BLANKS   ZDEST                                               CSW208
     C                     MOVELSVPIBN    ZDEST                                               CSW208
     C                     MOVELSVPIBA    ACLINE                                              CSW208
     C                     MOVE ' '       TAG                                                 CSW208
     C                     MOVE '56'      FLDNO                                               CSW208
     C                     EXSR FSWAD                                                         CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
      **  Format Account with institution. (Field 57.)                                        CSW208
      *                                                                                       CSW208
     C                     ADD  1         X                                                   CSW208
     C           X         OCUR MULT                                                          CSW208
     C                     MOVE *BLANKS   ZDEST                                               CSW208
     C                     MOVELSVAWBN    ZDEST                                               CSW208
     C                     MOVELSVBENA    ACLINE                                              CSW208
     C                     MOVE ' '       TAG                                                 CSW208
     C                     MOVE '57'      FLDNO                                               CSW208
     C                     EXSR FSWAD                                                         CSW208
     C                     MOVE 'Y'       FLD57O  1                                           CSW208
      *                                                                                       CSW208
      **  A/C with Inst. blank                                                                CSW208
      *                                                                                       CSW208
     C                     ELSE                                                               CSW208
      *                                                                                       CSW208
     C           FAWB6     IFEQ 'DIRECT'                                                      CSW208
      *                                                                                       CSW208
      **  A/C with Inst. set up as DIRECT, use beneficiary details                            CSW208
      **  Format Account with institution. (Field 57.)                                        CSW208
      *                                                                                       CSW208
     C                     ADD  1         X                                                   CSW208
     C           X         OCUR MULT                                                          CSW208
     C                     MOVE *BLANKS   ZDEST                                               CSW208
     C                     MOVELSVBENN    ZDEST                                               CSW208
     C                     MOVELSVBENA    ACLINE                                              CSW208
     C                     MOVE ' '       TAG                                                 CSW208
     C                     MOVE '57'      FLDNO                                               CSW208
     C                     EXSR FSWAD                                                         CSW208
     C                     MOVE 'Y'       FLD57O  1                                           CSW208
      *                                                                                       CSW208
      **  A/C with Inst. blank and NOT "DIRECT" entered,                                      CSW208
      *                                                                                       CSW208
     C                     ELSE                                                               CSW208
      *                                                                                       CSW208
      **  Field 57 = pay nostro customer if settlement via '02' or '12'                       CSW208
      *                                                                                       CSW208
     C           SVPSTM    IFEQ 02                                                            CSW208
     C           SVPSTM    OREQ 12                                                            CSW208
     C                     MOVELSVPONS    @NONB                                               CSW208
      *                                                                                       CSW208
      ** Use settlement currency to access nostro if not blank.                               CSW208
      ** Otherwise use deal currency.                                                         CSW208
      *                                                                                       CSW208
     C           CEU003    IFEQ 'Y'                                                           CSW208
     C           SVSTCY    ANDNE*BLANKS                                                       CSW208
     C           CEU004    OREQ 'Y'                                                           CSW208
     C           SVSTCY    ANDNE*BLANKS                                                       CSW208
     C                     MOVE SVSTCY    @CYCD                                               CSW208
     C                     ELSE                                                               CSW208
     C                     MOVE SVPCCY    @CYCD                                               CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C*******              CALL 'AONOSTR0'                                             CSW208 CDL094
     C                     CALL 'AONOSTR1'                                                    CDL094
     C                     PARM '*MSG   ' @RTCD                                               CSW208
     C                     PARM '*KEY   ' @OPTN                                               CSW208
     C                     PARM *BLANKS   @CUST                                               CSW208
     C                     PARM           @CYCD                                               CSW208
     C                     PARM *BLANKS   @ACCD                                               CSW208
     C                     PARM *BLANKS   @ACSN                                               CSW208
     C                     PARM           @NONB                                               CSW208
     C                     PARM *BLANKS   @BRCD                                               CSW208
     C                     PARM *BLANKS   @CSSN                                               CSW208
     C                     PARM *BLANKS   @PNOI                                               CSW208
     C***********SDNOST    PARM SDNOST    DSFDY                                        CSW208 CDL094
     C           SDNOST    PARM SDNOST    DSSDY                                               CDL094
      *                                                                                       CSW208
      **  Nostro customer not found                                                           CSW208
      *                                                                                       CSW208
     C           @RTCD     IFNE *BLANKS                                                       CSW208
     C                     MOVE 'Y'       @ERR                                                CSW208
     C                     ADD  1         X                                                   CSW208
     C           X         OCUR MULT                                                          CSW208
     C                     MOVELSVPONS    HLD2    2                                           CSW208
     C                     MOVELSVPCCY    HLD5                                                CSW208
     C                     MOVE HLD2      HLD5    5                                           CSW208
     C                     MOVELHLD5      MFLD                                                CSW208
     C                     MOVELMSGA,3    MERR                                                CSW208
     C                     MOVE ':57 :'   MTAG                                                CSW208
     C                     ELSE                                                               CSW208
      *                                                                                       CSW208
      **  Format our Pay Nostro Customer Address                                              CSW208
      *                                                                                       CSW208
     C                     ADD  1         X                                                   CSW208
     C           X         OCUR MULT                                                          CSW208
     C                     MOVE *BLANKS   ZDEST                                               CSW208
     C           SVRVNO    IFEQ *BLANKS                                                       CSW208
     C                     MOVELA7CUST    ZDEST                                               CSW208
     C                     ELSE                                                               CSW208
     C                     MOVELSVRVNO    ZDEST                                               CSW208
     C                     ENDIF                                                              CSW208
     C                     MOVEL*BLANKS   ACLINE                                              CSW208
     C                     MOVE *BLANKS   @OANN                                               CSW208
     C           A7OANN    IFNE *BLANKS                                                       CSW208
     C                     MOVE A7OANN    @OANN                                               CSW208
     C                     MOVEL'/'       @OANN                                               CSW208
     C                     END                                                                CSW208
     C                     MOVEL@OANN     ACLINE                                              CSW208
     C                     MOVE ' '       TAG                                                 CSW208
     C                     MOVE '57'      FLDNO                                               CSW208
     C                     EXSR FSWAD                                                         CSW208
     C                     MOVE 'Y'       FLD57O                                              CSW208
     C                     END                                                                CSW208
      *                                                                                       CSW208
     C                     ELSE                                                               CSW208
      *                                                                                       CSW208
     C           SVPSTM    IFNE 00                                                            CSW208
     C                     MOVE SVPSTM    @STM                                                CSW208
     C           @STM      LOKUPTABINT                   23                                   CSW208
      *                                                                                       CSW208
     C           *IN23     IFEQ '1'                                                           CSW208
     C                     ADD  1         X                                                   CSW208
     C           X         OCUR MULT                                                          CSW208
     C                     MOVE *BLANKS   ZDEST                                               CSW208
     C                     MOVELSECN      ZDEST                                               CSW208
     C                     MOVEL*BLANKS   ACLINE                                              CSW208
     C                     MOVE ' '       TAG                                                 CSW208
     C                     MOVE '57'      FLDNO                                               CSW208
     C                     EXSR FSWAD                                                         CSW208
     C                     MOVE 'Y'       FLD57O                                              CSW208
      *                                                                                       CSW208
     C                     ELSE                                                               CSW208
      *                                                                                       CSW208
      **  Field 53 is equal to Our Pay Nostro                                                 CSW208
      *                                                                                       CSW208
     C/COPY WNCPYSRC,MG0320C059                                                               CSW208
     C                     MOVELSVPONS    @NSKYE                                              CSW208
      *                                                                                       CSW208
      ** Use settlement currency to access nostro if not blank.                               CSW208
      ** Otherwise use deal currency.                                                         CSW208
      *                                                                                       CSW208
     C           CEU003    IFEQ 'Y'                                                           CSW208
     C           SVSTCY    ANDNE*BLANKS                                                       CSW208
     C           CEU004    OREQ 'Y'                                                           CSW208
     C           SVSTCY    ANDNE*BLANKS                                                       CSW208
     C                     MOVE SVSTCY    @NSKYB                                              CSW208
     C                     ELSE                                                               CSW208
     C                     MOVE SVPCCY    @NSKYB                                              CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C*******              CALL 'AONOSTR0'                                             CSW208 CDL094
     C                     CALL 'AONOSTR1'                                                    CDL094
     C                     PARM '*MSG   ' @RTCD                                               CSW208
     C                     PARM '*KEY   ' @OPTN                                               CSW208
     C                     PARM *BLANKS   @NSKYA                                              CSW208
     C                     PARM           @NSKYB                                              CSW208
     C                     PARM *BLANKS   @NSKYC                                              CSW208
     C                     PARM *BLANKS   @NSKYD                                              CSW208
     C                     PARM           @NSKYE                                              CSW208
     C                     PARM *BLANKS   @KEYF                                               CSW208
     C                     PARM *BLANKS   @KEYG                                               CSW208
     C                     PARM *BLANKS   @KEYH                                               CSW208
     C***********SDNOST    PARM SDNOST    DSFDY                                        CSW208 CDL094
     C           SDNOST    PARM SDNOST    DSSDY                                               CDL094
     C/COPY WNCPYSRC,MG0320C052                                                               CSW208
      *                                                                                       CSW208
      **  Nostro customer not found                                                           CSW208
      *                                                                                       CSW208
     C           @RTCD     IFNE *BLANKS                                                       CSW208
     C                     ADD  1         X                                                   CSW208
     C           X         OCUR MULT                                                          CSW208
     C                     MOVE 'Y'       @ERR                                                CSW208
     C                     MOVE ':53 :'   MTAG                                                CSW208
     C                     MOVELSVPONS    MFLD                                                CSW208
     C                     MOVELMSGA,3    MERR                                                CSW208
     C                     ELSE                                                               CSW208
      *                                                                                       CSW208
      **  Format our Pay Nostro Customer Address                                              CSW208
      *                                                                                       CSW208
     C                     ADD  1         X                                                   CSW208
     C           X         OCUR MULT                                                          CSW208
     C                     MOVE *BLANKS   ZDEST                                               CSW208
     C                     MOVELA7CUST    ZDEST                                               CSW208
     C                     MOVEL*BLANKS   ACLINE                                              CSW208
     C                     MOVE ' '       TAG                                                 CSW208
     C                     MOVE '53'      FLDNO                                               CSW208
     C                     EXSR FSWAD                                                         CSW208
     C                     ENDIF                                                              CSW208
     C/COPY WNCPYSRC,MG0320C053                                                               CSW208
     C                     ENDIF                                                              CSW208
     C                     ENDIF                                                              CSW208
     C                     ENDIF                                                              CSW208
     C                     ENDIF                                                              CSW208
     C                     ENDIF                                                              CSW208
     C/COPY WNCPYSRC,MG0320C060                                                               CSW208
      *                                                                                       CSW208
      **  Settlement 01,07 or 08 with MFAWBN blank or settlement 00                           CSW208
      *                                                                                       CSW208
     C           FLD57O    IFEQ 'N'                                                           CSW208
     C                     ADD  1         X                                                   CSW208
     C           X         OCUR MULT                                                          CSW208
     C                     MOVE ':57D:'   MTAG                                                CSW208
     C/COPY WNCPYSRC,MG0320C054                                                               CSW208
     C                     MOVEL'UNKNOWN' MFLD                                                CSW208
     C/COPY WNCPYSRC,MG0320C055                                                               CSW208
      *                                                                                       CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C                     MOVE *BLANK    ZDBEI                                               CSW208
      *                                                                                       CSW208
     C                     ENDSR                                                              CSW208
      *****************************************************************                       CSW208
     C/EJECT                                                                                  CSW208
      *****************************************************************                       CSW208
      *   MSGSZ - Get actual message length                           *                       CSW208
      *   Called by - OMSG                                            *                       CSW208
      *****************************************************************                       CSW208
      *                                                                                       CSW208
     C           MSGSZ     BEGSR                                                              CSW208
      *                                                                                       CSW208
     C                     ADD  8         MSGBYT                                              CSW208
     C                     ADD  BL1BYT    MSGBYT                                              CSW208
     C                     ADD  BL2BYT    MSGBYT                                              CSW208
     C                     ADD  BL3BYT    MSGBYT                                              CSW208
     C                     ADD  BL5BYT    MSGBYT                                              CSW208
     C                     ADD  FMTIBY    MSGBYT                                              CSW208
      *                                                                                       CSW208
     C                     Z-ADD1         X                                                   CSW208
     C           X         OCUR MULT                                                          CSW208
      *                                                                                       CSW208
     C           X         DOWLE999                                                           CSW208
     C           MFLD      ANDNE*BLANKS                                                       CSW208
     C           X         ORLE 999                                                           CSW208
     C           MTAG      ANDNE*BLANKS                                                       CSW208
      *                                                                                       CSW208
     C                     EXSR MFLDSZ                                                        CSW208
     C                     ADD  LENGTH    MSGBYT                                              CSW208
     C                     ADD  7         MSGBYT                                              CSW208
      *                                                                                       CSW208
     C                     ADD  1         X                                                   CSW208
     C           X         OCUR MULT                                                          CSW208
      *                                                                                       CSW208
     C                     ENDDO                                                              CSW208
      *                                                                                       CSW208
     C                     ENDSR                                                              CSW208
      *****************************************************************                       CSW208
     C/EJECT                                                                                  CSW208
      *****************************************************************                       CSW208
      *   MFLDSZ - Get MFLD field length                              *                       CSW208
      *   Called by - FMI208, MSGSZ                                   *                       CSW208
      *****************************************************************                       CSW208
      *                                                                                       CSW208
     C           MFLDSZ    BEGSR                                                              CSW208
      *                                                                                       CSW208
     C                     Z-ADD*ZEROS    LENGTH  20                                          CSW208
      *                                                                                       CSW208
     C                     DO   50        WCTR    20                                          CSW208
      *                                                                                       CSW208
     C           1         SUBSTMFLD:WCTR WCHAR   1                                           CSW208
     C           WCHAR     IFNE *BLANK                                                        CSW208
     C                     Z-ADDWCTR      LENGTH                                              CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C                     ENDDO                                                              CSW208
      *                                                                                       CSW208
     C                     ENDSR                                                              CSW208
      *****************************************************************                       CSW208
     C/EJECT                                                                                  CSW208
      *****************************************************************
      *   INIT - initial process                                      *
      *   Called by - main process                                    *
      *****************************************************************
      *
     C           INIT      BEGSR
      *
     C                     MOVEACPY@      BIS@   80
      *
      **  Set up LDA
      *
     C           *NAMVAR   DEFN           LDA
     C           *LOCK     IN   LDA
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     MOVEL'MG0320'  DBPGM
     C                     MOVE *BLANKS   DBASE
     C                     OUT  LDA
      *                                                                                       CSW208
      **  Access MSSTAT to find PDE tag                                                       CSW208
      *                                                                                       CSW208
     C           *NAMVAR   DEFN MSSTAT    DSTAT                                               CSW208
     C           *LOCK     IN   DSTAT                                                         CSW208
     C                     OUT  DSTAT                                                         CSW208
      *
      **  Access SDBANKPD for report title
      *
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
      *
      ** If no record is found on sdbankpd.
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '001'     DBASE              * * * * * * *
     C                     MOVEL'FIRST'   DBKEY              * DBERR 001 *
     C                     MOVEL'SDBANKPD'DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C* Correctly work out Date Format                                    066600
     C*                                                                   066600
     C           BJDFIN    COMP 'M'                      98MMDDYY,*98*ON  066600
      *
      **  Access SDTRADPD for trading information
      *
     C                     CALL 'AOTRADR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDTRAD    PARM SDTRAD    DSFDY
      *
      ** If no record is found on sdtradpd.
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '002'     DBASE              * * * * * * *
     C                     MOVEL'FIRST'   DBKEY              * DBERR 002 *
     C                     MOVEL'SDTRADPD'DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Access SDMMODPD for modules available.
      *
     C                     CALL 'AOMMODR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C           SDMMOD    PARM SDMMOD    DSFDY
      *
      ** If no record is found on sdmmodpd.
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '003'     DBASE              * * * * * * *
     C                     MOVEL'FIRST'   DBKEY              * DBERR 003 *
     C                     MOVEL'SDMMODPD'DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Access SDMGMEPD for message management data.
      *
     C                     CALL 'AOMGMER0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C           SDMGME    PARM SDMGME    DSFDY
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '027'     DBASE            * * * * * * * *
     C                     MOVEL'FIRST'   DBKEY            *  DBERR 027  *
     C                     MOVEL'SDMGMEPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*                                                                   077898
     C**  Access Switchable Features file for Enhanced Rollovers          077898
     C*                                                                   077898
     C                     CALL 'AOSARDR0'                                077898
     C                     PARM *BLANKS   @RTCD                           077898
     C                     PARM '*VERIFY' @OPTN                           077898
     C                     PARM 'S01434'  @SARD   6                       077898
     C           SCSARD    PARM SCSARD    DSFDY                           077898
     C*                                                                   077898
     C           @RTCD     IFEQ *BLANKS                                   077898
     C                     MOVEL'Y'       S01434  1                       077898
     C                     ELSE                                           077898
     C                     MOVEL'N'       S01434  1                       077898
     C                     END                                            077898
     C           *LIKE     DEFN MGROTA    WKPCPL                          077898
      *                                                                   CDL006
      ** Access Switchable Features file to check if Dealing Fiducia      CDL006
      ** ry is installed.                                                 CDL006
      *                                                                   CDL006
     C                     MOVE 'N'       CDL006  1                       CDL006
     C                     CALL 'AOSARDR0'                                CDL006
     C                     PARM *BLANKS   WRTCD   7                       CDL006
     C                     PARM '*VERIFY' WOPTN   7                       CDL006
     C                     PARM 'CDL006'  WSARD   6                       CDL006
     C           SCSARD    PARM SCSARD    DSFDY                           CDL006
      *                                                                   CDL006
     C           WRTCD     IFNE *BLANKS                                   CDL006
     C           WRTCD     ANDNE'*NRF   '                                 CDL006
     C           *LOCK     IN   LDA                                       CDL006
     C                     Z-ADD028       DBASE             ************* CDL006
     C                     MOVEL'SCSARDPD'DBFILE            * DBERR 028 * CDL006
     C                     MOVELWRTCD     DBKEY             ************* CDL006
     C                     OUT  LDA                                       CDL006
     C                     EXSR *PSSR                                     CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C           WRTCD     IFEQ *BLANK                                    CDL006
     C                     MOVEL'Y'       CDL006                          CDL006
     C                     ENDIF                                          CDL006
     C/COPY WNCPYSRC,MG0320C032
      *
      **  Initialise constant fields
      *
     C                     MOVE *LOVAL    CR      1
     C                     BITON'457'     CR
     C                     MOVE *LOVAL    LF      1
     C                     BITON'257'     LF
     C                     MOVELCR        CRLF    2
     C                     MOVE LF        CRLF
     C                     MOVE ':'       COLON1
     C                     MOVE ':'       COLON2
      *
      **  CRLF Control Character for message data records
      *
     C                     MOVE CRLF      CTRC
      *
      **  Convert run date to YYMMDD, for Message Generation Date
     C                     CALL 'ZM0060'               15
     C                     PARM BJRDNB    ZMDAY   50
     C                     PARM           ZSDATE  6
      *
      ** Program ended in error.
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '004'     DBASE              * * * * * * *
     C                     MOVEL'       ' DBKEY              * DBERR 004 *
     C                     MOVEL'ZM0060'  DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     MOVE ZSDATE    MGDE
     C*                                                                   113352
      ** Set-up Message Generation  Century flag                          113352
      *                                                                   113352
     C                     MOVELMGDE      YY      20                      113352
     C           YY        IFLT 72                                        113352
     C                     MOVE '2'       CIND                            113352
     C                     ELSE                                           113352
     C                     MOVE '1'       CIND                            113352
     C                     ENDIF                                          113352
      *
      **  Convert history retention date to YYMMDD
      *
     C           BJRDNB    ADD  ENDSMN    ZMDAY
     C                     CALL 'ZM0060'               15
     C                     PARM           ZMDAY
     C                     PARM           ZSDATE
      *
      ** If the program ends in error.
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '006'     DBASE              * * * * * * *
     C                     MOVEL'       ' DBKEY              * DBERR 006 *
     C                     MOVEL'ZM0060'  DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     MOVE ZSDATE    @HRDT   6
      *                                                                   CSW096
      **  Check if SWIFT Changes 1996 (CSW096) is installed               CSW096
      *                                                                   CSW096
     C                     CALL 'SWIFT96'                                 CSW096
     C                     PARM *BLANKS   @RTCD   7                       CSW096
      *                                                                   CSW096
     C           @RTCD     IFEQ 'CSW096'                                  CSW096
     C                     MOVE 'Y'       CSW096  1                       CSW096
     C                     ELSE                                           CSW096
     C                     MOVE 'N'       CSW096                          CSW096
     C                     ENDIF                                          CSW096
      *                                                                   CSW200
      **  Check if SWIFT Changes 2000 (CSW200) is installed               CSW200
      *                                                                   CSW200
     C                     CALL 'SWIF2000'                                CSW200
     C                     PARM *BLANKS   @RTCD   7                       CSW200
      *                                                                   CSW200
     C           @RTCD     IFEQ 'CSW200'                                  CSW200
     C                     MOVE 'Y'       CSW200  1                       CSW200
     C                     ELSE                                           CSW200
     C                     MOVE 'N'       CSW200                          CSW200
     C                     ENDIF                                          CSW200
      *                                                                                       CSW024
      ** Check if switchable feature CSW024 is switched on                                    CSW024
     C                     CALL 'AOSARDR0'                                                    CSW024
     C                     PARM *BLANKS   @RTCD                                               CSW024
     C                     PARM '*VERIFY' @OPTN                                               CSW024
     C                     PARM 'CSW024'  @SARD                                               CSW024
     C           SCSARD    PARM SCSARD    DSFDY                                               CSW024
      *                                                                                       CSW024
     C           @RTCD     IFNE *BLANK                                                        CSW024
     C           @RTCD     ANDNE'*NRF   '                                                     CSW024
     C           *LOCK     IN   LDA                                                           CSW024
     C                     MOVEL'SCSARDPD'DBFILE           ************                       CSW024
     C                     MOVEL'CSW024'  DBKEY            * DBERR 35 *                       CSW024
     C                     MOVEL'035'     DBASE            ************                       CSW024
     C                     OUT  LDA                                                           CSW024
     C                     EXSR *PSSR                                                         CSW024
     C                     ENDIF                                                              CSW024
      *                                                                                       CSW024
     C           @RTCD     IFEQ *BLANK                                                        CSW024
     C                     MOVE 'Y'       CSW024  1                                           CSW024
     C                     ELSE                                                               CSW024
     C                     MOVE 'N'       CSW024                                              CSW024
     C                     ENDIF                                                              CSW024
      *                                                                                       CSW024
      ** Check if switchable feature CSW037 is switched on                                    CSW037
     C                     CALL 'AOSARDR0'                                                    CSW037
     C                     PARM *BLANKS   @RTCD                                               CSW037
     C                     PARM '*VERIFY' @OPTN                                               CSW037
     C                     PARM 'CSW037'  @SARD                                               CSW037
     C           SCSARD    PARM SCSARD    DSFDY                                               CSW037
      *                                                                                       CSW037
     C           @RTCD     IFNE *BLANK                                                        CSW037
     C           @RTCD     ANDNE'*NRF   '                                                     CSW037
     C           *LOCK     IN   LDA                                                           CSW037
     C                     MOVEL'SCSARDPD'DBFILE           ************                       CSW037
     C                     MOVEL'CSW037'  DBKEY            * DBERR 37 *                       CSW037
     C                     MOVEL'037'     DBASE            ************                       CSW037
     C                     OUT  LDA                                                           CSW037
     C                     EXSR *PSSR                                                         CSW037
     C                     ENDIF                                                              CSW037
      *                                                                                       CSW037
     C           @RTCD     IFEQ *BLANK                                                        CSW037
     C                     MOVE 'Y'       CSW037  1                                           CSW037
     C                     ELSE                                                               CSW037
     C                     MOVE 'N'       CSW037                                              CSW037
     C                     ENDIF                                                              CSW037
      *                                                                                       CSW201
      ** Check if switchable feature CSW201 is switched on                                    CSW201
      *                                                                                       CSW201
     C                     CALL 'SWIF2001'                                                    CSW201
     C                     PARM           @RTCD                                               CSW201
      *                                                                                       CSW201
     C           @RTCD     IFEQ 'CSW2001'                                                     CSW201
     C                     MOVE 'Y'       CSW201  1                                           CSW201
     C                     ELSE                                                               CSW201
     C                     MOVE 'N'       CSW201                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
      ** ACCESS SAR DETAILS TO SEE IF CAS009 IS ENABLED.                                      CSW208
      *                                                                                       CSW208
     C                     MOVE 'N'       CAS009  1                                           CSW208
     C                     CALL 'AOSARDR0'                                                    CSW208
     C                     PARM *BLANKS   @RTCD                                               CSW208
     C                     PARM '*VERIFY' @OPTN                                               CSW208
     C                     PARM 'CAS009'  @SARD                                               CSW208
     C           SCSARD    PARM SCSARD    DSFDY                                               CSW208
      *                                                                                       CSW208
     C           @RTCD     IFEQ *BLANKS                                                       CSW208
     C                     MOVE 'Y'       CAS009                                              CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
      ** Access Switchable Features file for CSW208                                           CSW208
      *                                                                                       CSW208
     C                     MOVE 'N'       CSW208  1                                           CSW208
     C                     CALL 'SWIF2008'                                                    CSW208
     C                     PARM *BLANKS   @RTCD                                               CSW208
      *                                                                                       CSW208
     C           @RTCD     IFEQ 'CSW2008'                                                     CSW208
     C                     MOVE 'Y'       CSW208                                              CSW208
     C                     OPEN MGX320L0                                                      CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                      255986B
      ** Access system value for PopBTBConf                                                  255986B
      *                                                                                      255986B
     C                     CALL 'AOSVALR0'                                                   255986B
     C                     PARM *BLANKS   @RTCD                                              255986B
     C                     PARM APOPB     P@OP01 20                                          255986B
     C                     PARM *BLANKS   P@VL01200                                          255986B
     C                     PARM *BLANKS   P@OP02 20                                          255986B
     C                     PARM *BLANKS   P@VL02200                                          255986B
     C                     PARM *BLANKS   P@OP03 20                                          255986B
     C                     PARM *BLANKS   P@VL03200                                          255986B
     C                     PARM *BLANKS   P@OP04 20                                          255986B
     C                     PARM *BLANKS   P@VL04200                                          255986B
     C                     PARM *BLANKS   P@OP05 20                                          255986B
     C                     PARM *BLANKS   P@VL05200                                          255986B
     C                     PARM *BLANKS   P@OP06 20                                          255986B
     C                     PARM *BLANKS   P@VL06200                                          255986B
     C                     PARM *BLANKS   P@OP07 20                                          255986B
     C                     PARM *BLANKS   P@VL07200                                          255986B
     C                     PARM *BLANKS   P@OP08 20                                          255986B
     C                     PARM *BLANKS   P@VL08200                                          255986B
     C                     PARM *BLANKS   P@OP09 20                                          255986B
     C                     PARM *BLANKS   P@VL09200                                          255986B
     C                     PARM *BLANKS   P@OP10 20                                          255986B
     C                     PARM *BLANKS   P@VL10200                                          255986B
      *                                                                                      255986B
     C                     MOVEL'N'       PAPOPB  1                                          255986B
     C           @RTCD     IFEQ *BLANK                                                       255986B
     C                     MOVELP@VL01    PAPOPB                                             255986B
     C                     ENDIF                                                             255986B
      *                                                                                       CSW208
      ** Check if switchable feature CSW205 is switched on                                    CSW205
     C                     CALL 'SWIF2005'                                                    CSW205
     C                     PARM           @RTCD                                               CSW205
      *                                                                                       CSW205
     C           @RTCD     IFEQ 'CSW2005'                                                     CSW205
     C                     MOVE 'Y'       CSW205  1                                           CSW205
     C                     ELSE                                                               CSW205
     C                     MOVE 'N'       CSW205                                              CSW205
     C                     ENDIF                                                              CSW205
      *
      ** Check if switchable feature CSW213 is switched on                                    CSW213
      *                                                                                       CSW213
     C                     CALL 'SWIF2013'                                                    CSW213
     C                     PARM           @RTCD                                               CSW213
      *                                                                                       CSW213
     C           @RTCD     IFEQ 'CSW2013'                                                     CSW213
     C                     MOVE 'Y'       CSW213  1                                           CSW213
     C                     ELSE                                                               CSW213
     C                     MOVE 'N'       CSW213                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
     C/COPY WNCPYSRC,MG0320C003
      *
      ** Check if CSD015 is enabled.                                                          CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD   7                                           CSD015
     C                     PARM '*VERIFY' POPTN   7                                           CSD015
     C                     PARM 'CSD015'  PSARN   6                                           CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CSD015  1                                           CSD015
     C                     MOVEL'N'       W1EWLC                                              222385
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSD015                                              CSD015
      *                                                                                       222385
      ** Access AOWLCCR0 to check if function code MESSGENT is available                      222385
      *                                                                                       222385
     C                     CALL 'AOWLCCR0'                                                    222385
     C                     PARM *BLANKS   PRTCD                                               222385
     C                     PARM '*KEY'    POPTN                                               222385
     C                     PARM 'MESSGENT'PFUNC   8                                           222385
     C           SDWLCC    PARM SDWLCC    DSFDY                                               222385
      *                                                                                       222385
     C           PRTCD     IFNE *BLANKS                                                       222385
     C           PRTCD     ANDNE'*NRF'                                                        222385
     C                     MOVEL'SDWLCCPD'DBFILE                                              222385
     C                     MOVELPFUNC     DBKEY                                               222385
     C                     Z-ADD32        DBASE                                               222385
     C                     EXSR *PSSR                                                         222385
     C                     ENDIF                                                              222385
      *                                                                                       222385
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE '*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     MOVELPSARN     DBKEY                                               CSD015
     C                     Z-ADD36        DBASE                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Check if CSW025 is enabled.                                                          CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY' POPTN                                               CSD015
     C                     PARM 'CSW025'  PSARN                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CSW025  1                                           CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSW025                                              CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE '*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     MOVELPSARN     DBKEY                                               CSD015
     C                     Z-ADD37        DBASE                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C/COPY WNCPYSRC,MGH00102
      ** Check if Enhanced Receive Settlement Instructions feature                            CDL094
      * is installed                                                                          CDL094
      *                                                                                       CDL094
     C                     MOVE 'N'       CDL094  1                                           CDL094
     C                     CALL 'AOSARDR0'                                                    CDL094
     C                     PARM *BLANKS   @RTCD                                               CDL094
     C                     PARM '*VERIFY' @OPTN                                               CDL094
     C                     PARM 'CDL094'  @SARD                                               CDL094
     C           SCSARD    PARM SCSARD    DSFDY                                               CDL094
      *                                                                                       CDL094
     C           @RTCD     IFEQ *BLANKS                                                       CDL094
     C                     MOVE 'Y'       CDL094                                              CDL094
     C                     ENDIF                                                              CDL094
      *                                                                                       CDL094
      *                                                                                       CSD015
      *****************************************************************            MD035545 MD047993
      ***Call*access*program*for*General*Ledger*details.***************            MD035545 MD047993
      *****************************************************************            MD035545 MD047993
     C**********           CALL 'AOGELRR1'                                         MD035545 MD047993
     C**********           PARM '*MSG   ' @RTCD   7                                MD035545 MD047993
     C**********           PARM '*FIRST ' @OPTN   7                                MD035545 MD047993
     C********** SDGELR    PARM SDGELR    DSSDY                                    MD035545 MD047993
      *                                                                                     MD035545
     C********** @RTCD     IFNE *BLANK                                             MD035545 MD047993
     C**********           MOVEL'SDGELRPD'DBFILE                                   MD035545 MD047993
     C**********           MOVEL'062'     DBASE                                    MD035545 MD047993
     C**********           MOVEL@OPTN     DBKEY                                    MD035545 MD047993
     C**********           EXSR *PSSR                                              MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
      *                                                                                     MD035545
      ** Retrieve system value setting                                                      MD035545
      *                                                                                     MD035545
     C                     MOVELWPARML    P@OP01                                            MD035545
     C                     CALL 'AOSVALR0'                                                  MD035545
     C                     PARM *BLANKS   W0RTCD  7                                         MD035545
     C                     PARM           P@OP01 20                                         MD035545
     C                     PARM           P@VL01200                                         MD035545
     C                     PARM           P@OP02 20                                         MD035545
     C                     PARM           P@VL02200                                         MD035545
     C                     PARM           P@OP03 20                                         MD035545
     C                     PARM           P@VL03200                                         MD035545
     C                     PARM           P@OP04 20                                         MD035545
     C                     PARM           P@VL04200                                         MD035545
     C                     PARM           P@OP05 20                                         MD035545
     C                     PARM           P@VL05200                                         MD035545
     C                     PARM           P@OP06 20                                         MD035545
     C                     PARM           P@VL06200                                         MD035545
     C                     PARM           P@OP07 20                                         MD035545
     C                     PARM           P@VL07200                                         MD035545
     C                     PARM           P@OP08 20                                         MD035545
     C                     PARM           P@VL08200                                         MD035545
     C                     PARM           P@OP09 20                                         MD035545
     C                     PARM           P@VL09200                                         MD035545
     C                     PARM           P@OP10 20                                         MD035545
     C                     PARM           P@VL10200                                         MD035545
      *                                                                                     MD035545
      ** If system value is not found then default value to 'N'                             MD035545
      *                                                                                     MD035545
     C           W0RTCD    IFNE '       '                                                   MD035545
     C                     MOVE 'N'       WCALC6                                            MD035545
     C                     ELSE                                                             MD035545
     C                     MOVELP@VL01    WCALC6                                            MD035545
     C********** WCALC6    IFEQ 'Y'                                                MD035545 MD047993
     C********** BKALDI    ANDEQ'Y'                                                MD035545 MD047993
     C**********           MOVE 'Y'       WCALC6                                   MD035545 MD047993
     C**********           ELSE                                                    MD035545 MD047993
     C**********           MOVE 'N'       WCALC6                                   MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
     C                     ENDIF                                                            MD035545
      *                                                                                     MD035545
     C                     ENDSR
     C/COPY WNCPYSRC,MG0320C033
     C/EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      *                                                               *                       CSD015
      *  SRWTCH - Initiates the Midas Watch List Checking Engine.     *                       CSD015
      *                                                               *                       CSD015
      *****************************************************************                       CSD015
     C           SRWTCH    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Check if the message is for automatic release.                                       CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       PARLS                                               CSD015
      *                                                                                       CSD015
     C           MGST      IFEQ 'RSND'                                                        CSD015
     C           NWRK      IFEQ 'SWIFT '                                                      CSD015
     C           NWRK      OREQ 'TELEX '                                                      CSD015
     C           NWRK      OREQ 'STTX  '                                                      CSD015
     C                     MOVE 'CRTD'    MGST                                                CSD015
     C                     MOVE 'Y'       PARLS   1                                           CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Initialise the Transaction Details parameter.                                        CSD015
      *                                                                                       CSD015
     C                     CLEARWLTDS                                                         CSD015
     C                     Z-ADD*ZERO     W4VDAT                                              CSD015
     C                     Z-ADD*ZERO     W4MDAT                                              CSD015
     C                     Z-ADD*ZERO     W4AMT1                                              CSD015
     C                     Z-ADD*ZERO     W4AMT2                                              CSD015
      *                                                                                       CSD015
     C                     MOVELTRNO      W4IDEN                                              CSD015
     C                     MOVELMTPY      W4ITEM                                              CSD015
     C                     MOVEL'MGOREF  'W4FUNT                                              CSD015
     C                     MOVELMGBRCA    W4BRCH                                              CSD015
     C                     MOVELDECN      W4CNUM                                              CSD015
     C                     Z-ADDBJRDNB    W4DDAT                                              CSD015
     C                     MOVELPARLS     W4ARLS                                              CSD015
      *                                                                                       CSD015
      ***Send*the*Transaction*Details to the Compliance Engine.                        CSD015 221145
      *********************                                                            CSD015 221145
     C*********************CALL 'SDWLCLOP'                                             CSD015 221145
     C*********************PARM           WLTDS                                        CSD015 221145
     C*********************PARM *BLANKS   PSTRNG                                       CSD015 221145
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
     C/EJECT
      *****************************************************************                       221145
      *                                                               *                       221145
      *  WLCDQ - Submit information to Watch List Check Dtaq          *                       221145
      *                                                               *                       221145
      *****************************************************************                       221145
      *                                                                                       221145
     C           WLCDQ     BEGSR                                                              221145
      *                                                                                       221145
      *  Send transaction to compliance engine program                                        221145
      *                                                                                       221145
     C                     CALL 'SDWLCLOP'                                                    221145
     C                     PARM           WLTDS                                               221145
     C                     PARM *BLANKS   PSTRNG                                              221145
      *                                                                                       221145
      *                                                                                       221145
     C                     ENDSR                                                              221145
      *                                                                                       221145
     C/EJECT                                                                                  221145
      *****************************************************************
      *   *PSSR - error handling                                      *
      *****************************************************************
      *
     C           *PSSR     BEGSR
      *
      **  Write database error to report
      *
     C                     OPEN MG0320AU
     C                     WRITEHEAD
     C                     WRITEDBERROR
      *
     C                     SETON                     U7U8LR
     C                     DUMP
     C                     RETRN
      *
     C                     ENDSR
     C/EJECT
     C/COPY WNCPYSRC,MG0320C036
      *
      /EJECT                                                              066550
     C/COPY ZSRSRC,ZINTDYZ2                                               066550
      /EJECT                                                              066550
     C/COPY ZSRSRC,ZDATE9Z3                                               066550
      /EJECT                                                              066550
     C/COPY ZSRSRC,ZDAT10Z2                                               126017
     C/EJECT                                                              126017
     C/COPY ZSRSRC,GLINTCZ1                                               066550
      /EJECT                                                              066550
      /COPY MGCPYSRC,SWIFTTRANS                                           BLI605
** CPY@   Object Copyright
(c) Finastra International Limited 2001
     X/COPY WNCPYSRC,MG0320X001
** MSGA   Messages
Settlement - pay
Customer details not found on SDCUSTPD
Nostro customer not found on SDNOSTPD
Broker code not found on SDBROKPD
ZM0040 (format ccy and amount) call ended in error
ZM0050 (format SWIFT address) call ended in error
Codeword was not found for this message
Duplicate TRN key built for this message
THIS IS A FIDUCIARY DEPOSIT                                               CDL006
** TABSLT - selection criteria for the codeword
                        BOTH
                        B/O
SENT   NEW            U BOTH
SENT   NEW            U B/O
SENT   NEW            K BOTH
SENT   NEW            K B/O
NONREC NEW            U BOTH
NONREC NEW            U B/O
NONREC NEW            K BOTH
NONREC NEW            K B/O
NONREC ROLDEC         U BOTH
NONREC ROLDEC         U B/O
NONREC ROLDEC         K BOTH
NONREC ROLDEC         K B/O
NONREC ROLSAM         U BOTH
NONREC ROLSAM         U B/O
NONREC ROLSAM         K BOTH
NONREC ROLSAM         K B/O
NONREC ROLSAMIN       U BOTH
NONREC ROLSAMIN       U B/O
NONREC ROLSAMIN       K BOTH
NONREC ROLSAMIN       K B/O
SENT   AMEND          U BOTH
SENT   AMEND          U B/O
SENT   AMEND          K BOTH
SENT   AMEND          K B/O
SENT   COMPLETE       K BOTH
SENT   COMPLETE       K B/O
NONREC AMEND          U BOTH
NONREC AMEND          U B/O
NONREC AMEND          K BOTH
NONREC AMEND          K B/O
NONREC COMPLETE       K BOTH
NONREC COMPLETE       K B/O
SENT   ROLDEC         U BOTH
SENT   ROLDEC         U B/O
SENT   ROLDEC         K BOTH
SENT   ROLDEC         K B/O
SENT   ROLSAM         U BOTH
SENT   ROLSAM         U B/O
SENT   ROLSAM         K BOTH
SENT   ROLSAM         K B/O
SENT   ROLSAMIN       U BOTH
SENT   ROLSAMIN       U B/O
SENT   ROLSAMIN       K BOTH
SENT   ROLSAMIN       K B/O
NONREC ROLDECIN       U BOTH                                              085625
NONREC ROLDECIN       U B/O                                               085625
NONREC ROLDECIN       K BOTH                                              085625
NONREC ROLDECIN       K B/O                                               085625
NONREC ROLINC         U BOTH                                              085625
NONREC ROLINC         U B/O                                               085625
NONREC ROLINC         K BOTH                                              085625
NONREC ROLINC         K B/O                                               085625
NONREC ROLINCIN       U BOTH                                              085625
NONREC ROLINCIN       U B/O                                               085625
NONREC ROLINCIN       K BOTH                                              085625
NONREC ROLINCIN       K B/O                                               085625
SENT   ROLDECIN       U BOTH                                              085625
SENT   ROLDECIN       U B/O                                               085625
SENT   ROLDECIN       K BOTH                                              085625
SENT   ROLDECIN       K B/O                                               085625
SENT   ROLINC         U BOTH                                              085625
SENT   ROLINC         U B/O                                               085625
SENT   ROLINC         K BOTH                                              085625
SENT   ROLINC         K B/O                                               085625
SENT   ROLINCIN       U BOTH                                              085625
SENT   ROLINCIN       U B/O                                               085625
SENT   ROLINCIN       K BOTH                                              085625
SENT   ROLINCIN       K B/O                                               085625
** TABRST - Resulting codeword; corresponds to the selection criteria
COMPLETE K
AMEND    U
COMPLETE K
AMEND    U
AMEND    K
AMEND    K
NEW      K
NEW      U
NEW      K
NEW      U
ROLDEC   K
ROLDEC   U
ROLDEC   K
ROLDEC   K
ROLSAM   K
ROLSAM   U
ROLSAM   K
ROLSAM   K
ROLSAMIN K
ROLSAMIN U
ROLSAMIN K
ROLSAMIN K
COMPLETE K
AMEND    U
AMEND    K
AMEND    K
AMEND    K
AMEND    K
COMPLETE K
AMEND    U
AMEND    K
AMEND    K
COMPLETE K
AMEND    U
COMPLETE K
AMEND    U
AMEND    K
AMEND    K
COMPLETE K
AMEND    U
AMEND    K
AMEND    K
COMPLETE K
AMEND    U
AMEND    K
AMEND    K
ROLDECIN K                                                                085625
ROLDECIN U                                                                085625
ROLDECIN K                                                                085625
ROLDECIN K                                                                085625
ROLINC   K                                                                085625
ROLINC   U                                                                085625
ROLINC   K                                                                085625
ROLINC   K                                                                085625
ROLINCIN K                                                                085625
ROLINCIN U                                                                085625
ROLINCIN K                                                                085625
ROLINCIN K                                                                085625
COMPLETE K                                                                085625
AMEND    U                                                                085625
AMEND    K                                                                085625
AMEND    K                                                                085625
COMPLETE K                                                                085625
AMEND    U                                                                085625
AMEND    K                                                                085625
AMEND    K                                                                085625
COMPLETE K                                                                085625
AMEND    U                                                                085625
AMEND    K                                                                085625
AMEND    K                                                                085625
** TABS96 - selection criteria for the codeword                           CSW096
                        BOTHAMEND    K                                    CSW096
                        B/O AMEND    U                                    CSW096
NONREC NEW            U BOTHNEW      K                                    CSW096
NONREC NEW            U B/O NEW      U                                    CSW096
NONREC NEW            K BOTHNEW      K                                    CSW096
NONREC NEW            K B/O NEW      K                                    CSW096
SENT   NEW            U BOTHAMEND    K                                    CSW096
SENT   NEW            U B/O AMEND    U                                    CSW096
SENT   NEW            K BOTHAMEND    K                                    CSW096
SENT   NEW            K B/O AMEND    K                                    CSW096
NONREC AMEND          U BOTHAMEND    K                                    CSW096
NONREC AMEND          U B/O AMEND    U                                    CSW096
NONREC AMEND          K BOTHAMEND    K                                    CSW096
NONREC AMEND          K B/O AMEND    K                                    CSW096
SENT   AMEND          U BOTHAMEND    K                                    CSW096
SENT   AMEND          U B/O AMEND    U                                    CSW096
SENT   AMEND          K BOTHAMEND    K                                    CSW096
SENT   AMEND          K B/O AMEND    K                                    CSW096
NONREC ROLLOVER       U BOTHROLLOVER K                                    CSW096
NONREC ROLLOVER       U B/O ROLLOVER U                                    CSW096
NONREC ROLLOVER       K BOTHROLLOVER K                                    CSW096
NONREC ROLLOVER       K B/O ROLLOVER K                                    CSW096
SENT   ROLLOVER       U BOTHAMEND    K                                    CSW096
SENT   ROLLOVER       U B/O AMEND    U                                    CSW096
SENT   ROLLOVER       K BOTHAMEND    K                                    CSW096
SENT   ROLLOVER       K B/O AMEND    K                                    CSW096
** TABNST - Codes indicating settlement via nostro
01
02
07
08
12
** TABINT - Codes indicating settlement via internal
03
04
05
06
14
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
