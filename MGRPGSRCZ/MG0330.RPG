     H        1                           F
     F*****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas MG Format call/notice loan/dep conf message')    *
     F*****************************************************************
     F*                                                               *
     F*  Midas - MESSAGE GENERATION                                   *
     F*                                                               *
     F*  MG0330 - CALL/NOTICE LOAN/DEPOSIT CONFIRMATION MESSAGE.      *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD053295           Date 13Apr19               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 MD047993           Date 23Sep17               *
      *                 MD035545           Date 11Sep15               *
      *                 MD032057           Date 23Jun15               *
      *                 AR733390           Date 13Mar15               *
      *                 CGL165             Date 17Feb15               *
      *                 MD031101           Date 19Nov14               *
      *                 CDL096             Date 22Sep14               *
      *                 CDL094             Date 03Jun14               *
      *                 CSW213             Date 03Jun13               *
      *                 AR996895           Date 25Nov12               *
      *                 CLE148             Date 23Jul12               *
      *                 263666             Date 01Feb10               *
      *                 255986B            Date 12Nov09               *
      *                 CER059             Date 19Jul10               *
      *                 CER016A            Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 255986             Date 29Aug08               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 110589             Date 29May07               *
      *                 110587             Date 29May07               *
      *                 246141             Date 26Mar07               *
      *                 164847             Date 30Nov06               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242286             Date 25Sep06               *
      *                 CDL049             Date 07Jul06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG11192           Date 10Apr06               *
      *                 CDL038             Date 10May05               *
      *                 CIR013             Date 25Apr05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 222373             Date 10Apr03               *
      *                 222385             Date 23Oct03               *
      *                 221145             Date 08Sep03               *
      *                 210978             Date 10Apr03               *
      *                 219242             Date 01Jul03               *
      *                 219241             Date 01Jul03               *
      *                 CSD015             Date 14Oct02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CSW025             Date 26Mar02               *
      *                 CSW024             Date 31Aug01               *
      *                 195647             Date 16Aug01               *
      *                 179848             Date 16Aug01               *
      *                 179816             Date 16Aug01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CSW201             Date 02May01               *
      *                 183583             Date 11Jun01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 193121             Date 17May01               *
      *                 190127             Date 28Feb01               *
     F*                 190256             Date 21Feb01               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 186783             Date 24Nov00               *
      *                 186781             Date 23Nov00               *
      *                 186635             Date 21Nov00               *
      *                 186631             Date 21Nov00               *
      *                 186338             Date 17Nov00               *
      *                 184810             Date 10Oct00               *
      *                 184808             Date 10Oct00               *
      *                 CDL008             Date 02May00               *
      *                 183752             Date 13Sep00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CSW200             Date 21Aug00               *
      *                 CIR004             Date 20Jan00               *
     F*                 142857             Date 13Jul00               *
     F*                 172657             Date 02Feb00               *
      * Midas DBA 3.02 -----------------------------------------------*
     F*                 136031             DATE 06Oct99               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CDL006             Date 26Apr99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 141572             DATE 21SEP98               *
     F*                 137909             Date 22Jul98               *
     F*                 113352            DATE 13FEB97                *
     F*                 121768             DATE 19FEB98               *
     F*                 126017             DATE 18NOV97               *
     F*                 096521             DATE 04MAR97               *
     F*                 097885             DATE 31JAN97               *
     F*                 S01408             DATE 28OCT96               *
     F*                 CSW096             DATE  3JUN96               *
     F*                 103387             DATE 21MAY96               *
     F*                 087013             DATE 05JUL96               *
     F*                 087012             DATE 05JUL96               *
     F*                 095244             DATE 01NOV95               *
     F*                 095238             DATE 31OCT95               *
     F*                 082906             DATE 20OCT95               *
     F*                 088544             DATE 20OCT95               *
     F*                 082874             DATE 09OCT95               *
     F*                 088043             DATE 14JUN95               *
     F*                 084320             DATE 07MAR95               *
     F*                 080096             DATE 12JAN95               *
     F*                 066600             DATE 04FEB94               *
     F*                 066550             DATE 04FEB94               *
     F*                 056739             DATE 16NOV93               *
     F*                 S01421             DATE 18AUG93               *
     F*                 051850 (BH1164)    DATE 24JUN93               *
     F*                 E42086             DATE 10JUL92               *
     F*                 E40242             DATE 25JUN92               *
     F*                 E33129 (BH2648)    DATE 16DEC91               *
     F*                 E32363             DATE 25NOV91               *
     F*                 E32326             DATE 14NOV91               *
     F*                 E29588             DATE 17OCT91               *
     F*                                                               *
      *****************************************************************
      *                                                               *
      *  MD053295 - Lending loan with Interest Calculation Basis      *
      *             method 3 (30/360) has wrong interest payment      *
      *             amount for month of March (Recompile)             *
      *  MD046248 - Finastra Rebranding                               *
      *  MD047993 - Modified MD035545. Removed dependency on Accrue   *
      *             on Last Day indicator.                            *
      *  MD035545 - LE: Interest Calculation in Leap year. Consider   *
      *             Accrue on Last Day Indicator for method 6.        *      
      *  MD032057 - Interest Frequency = W does not extract 38J field *
      *  AR733390 - Missing account number in tag 58. (Child:AR733391)*
      *           - Applied for MD-8341                               *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  MD031101 - MT300-Missing 'Our Account No. at Nostro' in Field*
      *             57 in subseq. B1 of seq 15B (for Receipt-Nostro)  *
      *           - get Our Account No. at Nostro if no Receipt       *
      *             Delivery Agent defined in Receipt Nostro          *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *  CSW213 - SWIFT Changes 2013                                  *
      *  AR996895 - Incorrect accrual interest calculation.           *
      *             (Child:AR996897) (Recompile)                      *
      *  CLE148 - Alpha Loan Reference (Recompile)                    *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  255986B - Introduce system value 'PopBTBConf' to populate    *
      *            Bank to Bank information in confirmation           *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *            to Midas Plus (Recompile)                          *
      *  255986 - Field 72 not appearing in MT320                     *
      *  110589 - Incorrect Parties specified in fields 56 and 57     *
      *  110587 - Incorrect tag 32 used                               *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      * BUG11192- Field 30X (Interest Due Date) and field 34E         *
      *           (Currency and Interest amount) are not valid unless *
      *           field 22B (Type of Event) is 'CHNG' Gems 233666.    *
      *           Also put in Gems fix 206249 for problems with nil   *
      *           amount in 32H (Currency Amount tobe settled) and nil*
      *           amount in 34E (Currency and Interest Amount) and    *
      *           wrong interest Settlement Date in 30X.              *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over GLINTC and ZINTDY.                   *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222373 - Parameter Mismatch.                                 *
      *  222385 - SWIFT msgs are Watch List checked regardless of     *
      *           configuration file setting                          *
      *  221145 - Compliance Watch WLC: Move compliance check to      *
      *           after COMIT to MGOMSGPD                             *
      *  210978 - Compute interest amount correctly and move correct  *
      *           interest due date to field 30X. Enhanced fix 207450 *
      *           to also cater call deals/loans with next interest   *
      *           payment dates.                                      *
      *  219242 - Not possible to create MT103+ payment msg from      *
      *           non-FT transaction (Recompile)                      *
      *  219241 - Defaulting of "Details of Charges" assign a         *
      *           system value (Recompile)                            *
      *  CSD015 - Midas Compliance Watch - Watch List Checking        *
      *  CSW025 - Midas Message Manager                               *
      *           - Pass original change type                         *
      *  CSW024 - MT3xx field 82/83/87 changes                        *
      *  195647 - Field 34E contains wrong Interest Amount Due.       *
      *           Reinstate in SR/DAT200 the calculations that were   *
      *           added by fixes 179816 and 179848 in SR/FMTB.        *
      *  179848 - Field 34 has a wrong interest amount.  Correct the  *
      *           calculation of interest by subracting ICTD and      *
      *           adding AIAN and AIAP to the interest.               *
      *  179816 - Maturing CD,CL should produce MT330.                *
      *  CSW201 - SWIFT 2001 Standards Update                         *
      *  183583 - Add extension file MGOEXTPD to store customer no.   *
      *           of field with SWIFT address.                        *
     F*  193121 - MT0330s are being Nacked - remove 186783            *
      *  190127 - Related reference should contain tansaction         *
      *           reference of previous message of same type          *
     F*  190256 - 184810 in wrong place                               *
     F*  186783 - Wrong date in field 30X and wrong amount in field   *
     F*           34E.                                                *
     F*         - Field 30X and 34E should not be print for SC deal   *
     F*           amendment.                                          *
     F*  186781 - Flag spread change message so not picked up by TRAM *
     F*  186635 - 24D should specify what electronic broker it is     *
     F*  186631 - if interest is to be received then 34E should have  *
     F*           'N' in front of currency and amount. This replaces  *
     F*           186338.                                             *
     F*           A PD or repayment schedule of a loan or a PI of a   *
     F*           deposit should have 'N' in front of Ccy/Amt for 32H.*
     F*  186338 - :34e: missing 'N' sign                              *
     F*  184810 - 30F and 38J should only be output when interest     *
     F*           frequency is not blanks or maturity date not zero   *
     F*  184808 - 32H should check ZAMNT which is a numeric field     *
     F*           rather than ZSAMNT which is an alphanumeric field   *
      *  CDL008 - Continuous Linked Settlement (Recompiled)           *
     F*  183752 - Output clearing code for account with bank          *
     F*  CSW200 - Swift 2000 Changes                                  *
      *  CIR004 - Dealing Calculation Method Change.                  *
      *         - Recompiled due to GLINTC and ZINTDY changes         *
     F*  142857 - Reverse again :33: for PD as reverse in DL6310      *
     F*           (All are to be reverse but not this field).         *
     F*  172657 - Maturity confirmation field errors. Applied fix     *
     F*           147657.                                             *
     F*  136031 - Additional line in field 38.                        *
      *  CDL006 - Fiduciary Dealing.                                  *
     F*  141572 - Setup0051DV (century flag) SVDT ( value date).      *
     F*  137909 - Use the settlement currency if not blank for        *
     F*           accessing nostro details. This is needed for tag    *
     F*           57A. Use if CEU003 or CEU004 is on.                 *
     F*  113352 - Set-up CIND (Century flag)  to correct year2000     *
     F*           display problem.                                    *
     F*  121768 - Recompile over changed GLINTCZ1                     *
     F*  126017 - Correction to interest calculation for calculation  *
     F*           basis 6 in SR/GLINTC. Add SR/ZDAT10                 *
     F*  096521 - SWIFT Confo (MT300/MT320/MT330) should show :53:    *
     F*           sender correspondent as Recepient of payment        *
     F*           instruction when it is used instead of nostro.      *
     F*  097885 - Recompiled for wrong calculation of number of day   *
     F*           interest (ZINTDYZ2).                                *
     F*  S01408 - Addition of Core Hook MG0330FFP1                    *
     F*           Addition of Core Hook MG0330IIP2                    *
     F*           Addition of Core Hook MG0330IIP1                    *
     F*           Addition of Core Hook MG0330CCP8                    *
     F*           Addition of Core Hook MG0330CCP7                    *
     F*           Addition of Core Hook MG0330CCP6                    *
     F*           Addition of Core Hook MG0330CCP5                    *
     F*           Addition of Core Hook MG0330CCP4                    *
     F*           Addition of Core Hook MG0330CCP3                    *
     F*           Addition of Core Hook MG0330CCP2                    *
     F*           Addition of Core Hook MG0330CCP1                    *
     F*  CSW096 - SWIFT Changes November 1996.                        *
     F*  103387 - If MGAWBA contains DIRECT, reformat it in /DIRECT   *
     F*           See also MG03xx.                                    *
     F*  087013 - Determine the 'P' or 'R' tags for FLD32 correctly.  *
     F*           If deal is a deposit and code word is either        *
     F*           'COMPLETE' or 'CORRECT', the tag should be 'P'.     *
     F*           Otherwise, the tag should be 'R'.                   *
     F*  087012 - In settlement of interest for a deposit, pgm should *
     F*           use the SWIFT address of the pay nostro instead of  *
     F*           the receive nostro.  Code words 'COMPLETE' and      *
     F*           'CORRECT' should be considered when setting up      *
     F*           the nostros and code word tags.                     *
     F*  095244 - Recompiled for Calculation method 3                 *
     F*  095238 - Recompiled for Calculation method 3                 *
     F*  082906 - If branch code on the file is blank then default    *
     F*           it to the branch code on SDBRCHPD.  If our          *
     F*           receive branch is blank then default it the         *
     F*           branch code. Applied fixes 074856 and 073944        *
     F*  088544 - Rename conflicting MGOREFL0 field TODY to resolve   *
     F*           enquiry problem.                                    *
     F*  082874 - Error in field 38A in MT330 message.  Value of      *
     F*           99R output instead of 999 when call notice days     *
     F*           is blank.                                           *
     F*  088043 - If DIRECT entered, use Beneficiary for :57: on Pay  *
     F*           Sequence                                            *
     F*  084320 - Do not set on U7 for a non-fatal error, as this     *
     F*           will cause the controlling component to end         *
     F*           abnormally.                                         *
     F*  080096 - RECOMPILE BECAUSE COPY MEMBER MGCPYSRC,SWIFTTRANS   *
     F*           CHANGED                                             *
     F*  066600 - Was not working out Date Format correctly.          *
     F*  066550 - GLINTC has had historical problems and inaccuracies *
     F*           and is now externaly descibed and changed to use    *
     F*           ZINTDYZ1. See document atached to error no on GEMS  *
     F*  056739 - Add account line for fields :56: and :57:           *
     F*  S01421 - REPLACE THE SWIFT TRANSLATION TABLE WITH A          *
     F*           /COPY STATEMENT (SWIFTTRANS).                       *
     F*  051850 - RENAME CFPF FIELD TO PREVENT MESSAGES BEING         *
     F*           GENERATED AS ALREADY PROCESSED BY CONF. MATCHING.   *
     F*           PREVENTS 'MISSING' MESSAGES ON TRAM.                *
     F*  E42086 - CATER FOR BLANK ADDRESS LINES                       *
     F*  E40242 - RE-COMPILED FOR CHANGE TO ASEQ                      *
     F*  E33129 - BROKER NAME COULD BE 3 OVER 35 LIMIT SO ADD         *
     F*           NEXT LINE FOR FIELD 72                              *
     F*  E32363 - FOR THE RECIVE SIDE:-                               *
     F*           i.   use the intermediary if entered;               *
     F*           ii.  a/c with inst. is equal to the rcv nostro;     *
     F*           iii. if branch code of sender not equal to the      *
     F*                rcv settlement branch and the intermediary     *
     F*                is blank, intermediary is equal to the         *
     F*                internal customer number of the rcv branch.    *
     F*  E32326 - SWIFT MESSAGE SHOWS :32R: & :32F: FOR A LOAN        *
     F*  E29588 - POST COLLECTION SWIFT RATIONALISATION FIXES         *
     F*           o prevent a blank codeword for field 22             *
     F*  RE-WRITTEN FOR S01344 - SWIFT RATIONALISATION PHASE 2        *
     F*                                                               *
     F*****************************************************************
     F*
     F/COPY WNCPYSRC,MG0330FFP1
     F*
     FMGF330PDUF  E                    DISK
     F                                              KCOMIT
     FMGOREFL0IF  E           K        DISK
     F            MGOREFD0                          KRENAMEMGREFL0
     FMGOREFPDO   E                    DISK
     F                                              KCOMIT
     FMGOMSGPDO   E                    DISK
     F                                              KCOMIT
     FMGOMSGL1IF  E           K        DISK                               CSW200
     F            MGOMSGD0                          KRENAMEMGMSGL1        CSW200
      ** SD Customer Details                                                                  CDL094
     FSDCUSTL7IF  E           K        DISK                                                   CDL094
      *                                                                                       CDL094
     F/COPY WNCPYSRC,MG0330F001
     FDEALSC  IF  E           K        DISK                               172657
      *                                                                                       190127
      ** MG Transaction history file                                                          190127
     FMGHISTL0UF  E           K        DISK                      A                            190127
     F                                              KCOMIT                                    190127
     FMGOEXTPDO   E                    DISK                               183583
     F                                              KCOMIT                183583
      ** Midas DL Deal Amendments file - AMENDs                                             BUG11192
     FDEAMSD  IF  E           K        DISK                                                 BUG11192
      *                                                                                     BUG11192
     FMG0330P1O   E                    PRINTER                        UC
     FMG0330AUO   E                    PRINTER                        UC
      ********************************************************************
      *
      * ID C  F  H  L    FUNCTION OF INDICATORS
      *
      *    05            Error on write to MGOREFPD.
      *    06            Error on write to MGOMSGPD
      *    10            EOF MGF330PD
      *    11            Chain to MGREFL0.
      *    15            Error in call to standard program (ZMxxxx)
      *    16            Error on delete of GDF record.
      *    20            LOKUP operation searching array (GNR)
      *    21            LOKUP operation searching array (GNR)
      *    22            LOKUP operation searching array (GNR)
      *    23            Settlement method on TABNST/TABINT
      *    24            Settlement method on TABRST.
      *    25            Array 1st line filled ; fld72.
      *    26            Error on call to MG5000
      *    30            Feedback record not generated
      *    31            @wrk array indicator.
      *    40            Chain to DEALS.                                  172657
      *    50            MG0330P1 open
      *    90            Calculation basis 2
      *    91            Calculation basis 3
      *    92            Calculation basis 1
      *    95            Calculation basis 6
      *    96            Calculation basis 5
      *    97            Calculation basis 4
      *    U7U8          Database error
      *
     F********************************************************************
     E                    CPY@    1   1 80               copyright
     E/COPY WNCPYSRC,MG0330E001
     E***********         MSGA    1   8 60               message text     CDL006
     E                    MSGA    1  10 60               add fidu. dtyp   CDL006
     E/COPY WNCPYSRC,MG0330E002
     E                    TABSLT  1  22 30               cwrd conditions.
     E                    TABRST  1  22  8               selected codeword
     E                    TABS96  1  18 30               cwrd conditions. CSW096
     E                    TABR96  1  18  8               selected codewordCSW096
     E                    TABNST  1   5  2               settlement nostro
     E                    TABINT  1   5  2               settle. internal
     E                    GNR        15  3               msg gen. released.
     E                    @WRK       50  1               work array.
     E                    ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAY
     E                    ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAY
     E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY
     E                    @BTB        6 35               Bank to Bank Info                    255986
      *
     E/COPY ZSRSRC,ZDATE9Z1                                               066550
     E********************************************************************
     I*
     I/COPY WNCPYSRC,MG0330IIP1
     I*
     IMGREFL0
     I              SYTM                            MSYTM
     I              NWRK                            MNWRK
     I              SECN                            MSECN
     I              NWSN                            MNWSN
     I              DECN                            MDECN
     I              NWDS                            MNWDS
     I              MGSG                            MMGSG
     I              MGST                            MMGST
     I              F57U                            MF57U
     I              LSCC                            MLSCC
     I              HRDT                            MHRDT
     I              MGDE                            MMGDE
     I              MGTM                            MMGTM
     I              LADT                            MLADT
     I              RELD                            MRELD
     I              RELT                            MRELT
     I              CFPF                            MCFPF                 051850
     I              TODY                            MTODY                 088544
      **  Rename conflicting MGOREFL0 fields
      *
     IMGMSGL1                                                             CSW200
     I              MTAG                            NMTAG                 CSW200
     I              MFLD                            NMFLD                 CSW200
     I              CTRC                            NCTRC                 CSW200
     I              TRNO                            NTRNO                 CSW200
     I              PTDL                            NPTDL                 CSW200
     I              MSEQ                            NMSEQ                 CSW200
      **  Rename MGOMSGL1 fields                                          CSW200
      *                                                                   CSW200
     IDEAMSDIF                                                                              BUG11192
     I              RECI                            ARECI                                   BUG11192
     I              DLNO                            ADLNO                                   BUG11192
     I              VDAT                            AVDAT                                   BUG11192
     I              DASN                            ADASN                                   BUG11192
     I              DTYP                            ADTYP                                   BUG11192
     I              DLST                            ADLST                                   BUG11192
     I              BRTT                            ABRTT                                   BUG11192
     I              RTSP                            ARTSP                                   BUG11192
     I              CCY                             ACCY                                    BUG11192
     I              CNUM                            ACNUM                                   BUG11192
     I              FACO                            AFACO                                   BUG11192
     I              SPI                             ASPI                                    BUG11192
     I              BRCA                            ABRCA                                   BUG11192
     I              LSWC                            ALSWC                                   BUG11192
     I              ORED                            AORED                                   BUG11192
     I              LCD                             ALCD                                    BUG11192
     I              CHTP                            ACHTP                                   BUG11192
     I              TNLU                            ATNLU                                   BUG11192
     I              RSTM                            ARSTM                                   BUG11192
     I              RONS                            ARONS                                   BUG11192
     I              RIBN                            ARIBN                                   BUG11192
     I              RIBA                            ARIBA                                   BUG11192
     I              ROBN                            AROBN                                   BUG11192
     I              ROCN                            AROCN                                   BUG11192
     I              PSTM                            APSTM                                   BUG11192
     I              PONS                            APONS                                   BUG11192
     I              PIBN                            APIBN                                   BUG11192
     I              PIBA                            APIBA                                   BUG11192
     I              POBN                            APOBN                                   BUG11192
     I              POCN                            APOCN                                   BUG11192
     I              RCRN                            ARCRN                                   BUG11192
     I              RCRA                            ARCRA                                   BUG11192
     I              RVNO                            ARVNO                                   BUG11192
     I              AWBN                            AAWBN                                   BUG11192
     I              AWBA                            AAWBA                                   BUG11192
     I              BENN                            ABENN                                   BUG11192
     I              BENA                            ABENA                                   BUG11192
     I              DTP1                            ADTP1                                   BUG11192
     I              DTP2                            ADTP2                                   BUG11192
     I              DTP3                            ADTP3                                   BUG11192
     I              DTP4                            ADTP4                                   BUG11192
     I              DCHG                            ADCHG                                   BUG11192
     I              BTB1                            ABTB1                                   BUG11192
     I              BTB2                            ABTB2                                   BUG11192
     I              BTB3                            ABTB3                                   BUG11192
     I              BTB4                            ABTB4                                   BUG11192
     I              BTB5                            ABTB5                                   BUG11192
     I              BTB6                            ABTB6                                   BUG11192
     I              CVMR                            ACVMR                                   BUG11192
     I              FSRP                            AFSRP                                   BUG11192
     I              STCY                            ASTCY                                   BUG11192
     I              IC72                            AIC72                                   BUG11192
     I              FCGC                            AFCGC                                   BUG11192
     I              FCGD                            AFCGD                                   BUG11192
     I              FCGA                            AFCGA                                   BUG11192
     I              FCGT                            AFCGT                                   BUG11192
     I              REPI                            AREPI                                   BUG11192
     I              AUTH                            AAUTH                                   BUG11192
      **  Rename DEAMSD fields                                                              BUG11192
      *                                                                                     BUG11192
     I            DS
     I                                        1  12 CSID
     I                                        9  11 @BIC
      **  Data structure to test for BIC code
      *
     IMULT        DS                         95
     I                                        1   5 MTAG
     I                                        6  55 MFLD
     I                                       56 105 MERR
      **  Multiple occurrence data structure for message
      *
     IEXTN        DS                         45                           183583
     I                                        1   20MPSN                  183583
     I                                        3   7 MTG                   183583
     I                                        8  15 MCSI                  183583
      *                                                                   183583
      ** Multiple occurrence data structure for extension file            183583
      *                                                                   183583
     I            DS                                                      183583
     I                                        1   5 @MTG                  183583
     I                                        2   2 FLDTYP                183583
     I                                        4   4 FLDTAG                183583
      *                                                                   183583
      ** Field tag data structure                                         183583
      *                                                                   183583
     ISEARCH      DS                         22
     I                                        1   6 @MGST
     I                                        8  16 @LSCC
     I                                       23  23 @OF57
     I                                       30  30 F57U
      **  Data structure to build key to determine codeword
      *
     IFLD3N       DS                         24
     I                                        1   6 ZSDATE
     I                                        7   9 ZSCCY
     I                                       10  24 ZSAMNT
      **  Data structure containing codeword for fields 32.
      *
     IERR3N       DS                         24
     I                                        1   3 ZCCY
     I                                        5  170ZAMT
      **  Erroneous currency & amounts for Fields 32/33
      *
     I@MTAG       DS                          5
     I                                        1   1 COLON1
     I                                        2   3 FLDNO
     I                                        4   4 TAG
     I                                        5   5 COLON2
      **  Data structure constructing message field tag
      *
     IP@IN        DS                            256                       CSW096
     I                                        1   3 I@SNBR                CSW096
     I                                        4   9 I@DSCN                CSW096
     I                                       10  12 I@MTPY                CSW096
     I                                       13  140I@SETT                CSW096
     I                                       15  15 I@CONC                CSW096
     I                                       16  16 I@FTCS                CSW096
     I                                       17  18 I@MMOD                CSW096
      ** Data structure for input parameter                               CSW096
      *                                                                   CSW096
     IP@OUT       DS                            256                       CSW096
     I**********                              1   60O@CNSN                             CSW096 CSD027
     I                                        1   6 O@CNSN                                    CSD027
     I                                        7  18 O@SWSN                CSW096
     I                                       19  38 O@NWSN                CSW096
     I                                       39  49 O@SWDS                CSW096
     I                                       46  46 W@96CN                CSW096
     I                                       47  49 W@BIC                 CSW096
     I                                       50  69 O@NWDS                CSW096
     I                                       70  75 O@NWRK                CSW096
     I                                       76  76 O@MGSG                CSW096
     I                                       77  80 O@MGST                CSW096
     I                                       81  81 O@PAIN                CSW096
     I                                       82  87 O@PCNB                CSW096
     I                                       88  90 O@SPRS                CSW096
      ** Data structure for ouput parameter                               CSW096
      *                                                                   CSW096
     I@HREF       DS                         16                                               190127
     I                                        1   2 HSMODI                                    190127
     I                                        3   8 HSTRAN                                    190127
     I                                        9  11 HSSEQ                                     190127
      **  Data structure for related reference                                                190127
      *                                                                                       190127
     ISDBANK    E DSSDBANKPD
      **  External Data structure for bank details.
      *
     ISDTRAD    E DSSDTRADPD
      **  External Data structure for trading file.
      *
     ISDCUST    E DSSDCUSTPD
      **  External Data structure for customer details.
      *
     ISDCURR    E DSSDCURRPD
      **  External Data structure for currency details.
      *
     ISDBRCH    E DSSDBRCHPD
     I              QQDFAC                          DFACQQ                                    CGL029
      **  External Data structure for branch details.
      *
     ISDBROK    E DSSDBROKPD
      **  External Data structure for broker file.
      *
     ISDMMOD    E DSSDMMODPD
      **  External Data structure for module ICD file.
      *
     ISDNOST    E DSSDNOSTPD
     I              QQACCD                          ACCDQQ                                    CGL029
      **  External Data structure for nostro details.
      *
     ISDMGME    E DSSDMGMEPD
      **  Data structure for message management data.
      *
     ISCSARD    E DSSCSARDPD                                              CDL006
      **  Data structure for Switchable Features file                     CDL006
      *                                                                   CDL006
     I***SDGELR*   E DSSDGELRPD                                                    MD035545 MD047993
     I* GENERAL LEDGER DETAILS ACCESSED VIA ACCESS PROGRAM                         MD035545 MD047993
     I**********    QQACCD                          ACCDQQ                         MD035545 MD047993
     IDSFDY     E DSDSFDY
      **  Short data structure for access programs
      *
     IDSSDY     E DSDSSDY
      **  Long data structure for access programs
     IDSLDY     E DSDSLDY                                                                     CSW024
      ** Third data structure for access programs                                             CSW024
      *                                                                                       CSD015
     IWLTDS     E DSSDWLTOPD                                                                  CSD015
      ** Watch List Transaction Details Data Structure                                        CSD015
      *                                                                                       CSD015
     IPSTRNG      DS                           9999                                           CSD015
      ** SDWLCLOP Search String Parameter                                                     CSD015
      *                                                                                       CSD015
     ISDWLCC    E DSSDWLCCPD                                                                  222385
      ** Watch list checking details                                                          222385
      *                                                                                       222385
     ISDCNST    E DSSDCNSTPD                                                                  CSW213
      **  Data structure for counterparty nostro file                                         CSW213
      *                                                                                       CSW213
     I/COPY WNCPYSRC,MG0330I001
      *
     ILDA         DS                            256
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
      **  Local data area
     I*
     I/COPY WNCPYSRC,MG0330IIP2
     I*
      *
     I/COPY ZSRSRC,ZINTDYZ1                                               066550
     I/COPY ZSRSRC,ZDATE9Z2                                               066550
     I/COPY ZSRSRC,ZDAT10Z1                                               126017
     IMGAWBA      DS                                                      103387
     I                                        1   6 WWAWBA                103387
     I                                        7  35 WWAWBB                103387
      *                                                                                      255986B
     I              'PopBTBConf          'C         APOPB                                    255986B
     I              'LECalcBasis6LeapYear'C         WPARML                                  MD035545
     C/EJECT
      *****************************************************************
      *                   Index to subroutines                        *
      *   main process                                                *
      *   FSWAD- Format SWIFT Address.                                *
      ****INTF*-*Initialise*non-constant*fields.                      *   172657
      *   INITF - Initialise non-constant fields.                     *   172657
      ****ROUT*-*Determine*Message*Routing.****************************   CSW096
      * SRROUT - Determine Message Routing.                           *   CSW096
      *   FMTA - Format Message Detail - Seq. A.                      *
      *   FMTB - Format Message Detail - Seq. B.                      *
      *   CODE - Calculate the codeword.                              *
      *   PAYE - Pay side field 57 (KNOWN or UNKNOWN)                 *
      *   DATES- Format the Date Fields.                              *
      *   FD53A- Format Fields 53.                                    *
      *   FD56A- Format Fields 56 and 57.                             *
      *   FD53B- Format Fields 53.                                    *
      *   FD56B- Format Fields 56 and 57.                             *
      *   FLD72- Format Field 72.                                     *
      *   FMA200 - Format Message Details - Sequence A                *   CSW200
      *   DAT200 - Format Message Details - Sequence B                *   CSW200
      *   FEF200 - Format Message Details - Sequence E/F.             *   CSW200
      *   RCVI00 - Format Message Details - Field 56 and 57           *   CSW200
      *   PAYI00 - Format Message Details - Field 53, 56 and 57       *   CSW200
      *   F53A00 - Format Message Details - Field 53                  *   CSW200
      *   FMH200 - Calculate field 72                                 *   CSW200
      ****NWAD*-*Determine*Default*Network*Address.********************   CSW096
      ****PRAD*-*Determine*Priority*Network*Address.*******************   CSW096
      **TXROUT*-*Attempt*priority*route*to*STTX/Telex******************   CSW096
      **SWROUT*-*Attempt*priority*route*to*SWIFT***********************   CSW096
      ****FILL*-*Fill*arrays*for*generation*state.*********************   CSW096
      *   REPT - Print Incorrectly Generated Message.                 *
      *   OMSG - Output Correctly Generated Messages.                 *
      *   WREF - Write o/p reference to MGREF.                        *
      *   INIT - Initial Process.                                     *
      *   *PSSR- Error Handling.                                      *
      *                                                               *
      *****************************************************************
     C/EJECT
      *****************************************************************
      *   NOTE:   A multiple occurrence data structure is used to     *
      *           store up the records that make up the SWIFT message *
      *           before writing the whole message to file.           *
      *           To store the records of the message, you must       *
      *           first access an OCUR record, obtain the Message Tag *
      *           & Message field data values for this OCUR record,   *
      *           then go on to the next OCUR record and continue     *
      *           this process until the SWIFT message is complete.   *
      *                                                               *
      *   NOTE2:  :3xP: and :3xR:                                     *
      *           The tag on fields 32 and 34 is either P or R        *
      *           dependant on the value of MGLORD the loans or       *
      *           deposits indicator. If MGLORD = L the deal is a     *
      *           loan (placing), D indicates a deposit (taking).     *
      *           MGLORD:                L         D               *
      *           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~}         *
      *           32 (cwrd =closing)     R         P      } tag    *
      *           32(cwrd ne closing     P         R      } value. *
      *           34                     R         P     }         *
      *           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~          *
      *           :33x:                                               *
      *           Field 33 has a tag value of E or F dependant on     *
      *           the value of MGLORD the loans or deposits indicator *
      *           MGLORD:                L         D               *
      *           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~          *
      *           33                     E         F      } tag    *
      *           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~          *
      *                                                               *
      *   NOTE3:  FD53A, FD56A ; FD53B, FD56B subroutines.            *
      *           These subroutines format fields 53, 56 and 57.      *
      *           fields.However the order in which these are         *
      *           performed depends upon whether the deal is a        *
      *           placing or a taking and also on which format of the *
      *           message is being produced.In format A FD53A         *
      *           calls FD56A and FD53B calls FD56B; whereas          *
      *           in format B no field 53 is produced and subroutines *
      *           FD56A and FD56B are called directly.                *
      *           MGLORD:            L(placing)D(taking)           *
      *           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~          *
      *           Format A (mgmdat=   FD53A      FD53B             *
      *           0)                                               *
      *           Format A(cwrd =     FD53B      FD53A             *
      *           closing)                                         *
      *           Format B            FD56B      FD56A             *
      *           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~          *
      *****************************************************************
     C/EJECT
      *****************************************************************
      *   MAIN - main process                                         *
      *   Called by - none                                            *
      *   Calls - INIT Initial Process.                               *
      ************INTF*Initialise*non-constant*fields.                *   172657
      *           INITF Initialise non-constant fields.               *   172657
      ************ROUT*Determine*Message*Routing.**********************   CSW096
      *           SRROUT Determine Message Routing.                   *   CSW096
      *           FMTA Format Message Detail - Seq. A.                *
      *           FMTB Format Message Detail - Seq. B.                *
      *           REPT Print Incorrectly Generated Messages.          *
      *           OMSG Output Correctly Generated Messages.           *
      *****************************************************************
      *                                                                                       190127
      **  Transaction history key                                                             190127
     C           HSKEY     KLIST                                                              190127
     C                     KFLD           MGMODI                                              190127
     C                     KFLD           HSTRAN                                              190127
     C                     KFLD           HSMTPY                                              190127
      *
      ** Initial process
      *
     C/COPY WNCPYSRC,MG0330C044
     C                     EXSR INIT
      *
      ** Read the first record from the MT330 extract file
      *
     C                     READ MGF330PD                 10
      *
      ** Format Message Control.
      *
      ** Do While records found on the MT330 extract file
      *
     C           *IN10     DOWEQ'0'
      *
      ** Initialise non-constant fields
      *
     C***********          EXSR INTF                                      172657
     C                     EXSR INITF                                     172657
      *
      ** Determine Message Routing.
      *
     C***********          EXSR ROUT                                      CSW096
     C                     EXSR SRROUT                                    CSW096
      *                                                                   CSW200
     C           CSW200    IFEQ 'N'                                       CSW200
      *
      ** Format Message Detail - Seq A.
      *
     C                     EXSR FMTA
      *
      ** Format Message Detail - Seq B.
      ** This subroutine is only executed if the codeword is closing.
      *
     C           CWRD      IFEQ 'CLOSING'
     C           CWRD      OREQ 'SETTLE '                                 CSW096
     C                     EXSR FMTB
     C                     END
      *                                                                   CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      ** Use the Swift 2000 changes                                       CSW200
      *                                                                   CSW200
      ** Format Message Detail - Seq A.                                   CSW200
      *                                                                   CSW200
     C                     EXSR FMA200                                    CSW200
      *                                                                   CSW200
      ** Format Message Detail - Seq E/F                                  CSW200
      *                                                                   CSW200
     C                     EXSR FEF200                                    CSW200
      *                                                                   CSW200
      *                                                                   CSW200
      ** Format Message Detail - Seq H. (calculate field 72)              CSW200
      *                                                                   CSW200
     C                     EXSR FMH200                                    CSW200
      *                                                                   CSW200
     C                     ENDIF                                          CSW200
      *
      ** Print incorrectly generated message
      *
     C           @ERR      IFEQ 'Y'
     C                     EXSR REPT
     C                     ELSE
      *
      ** Output correctly generated message
      *
     C                     EXSR OMSG
      *
      ** If confirmation matching switched on, generate feedback record
      **  (at present only produced for dealing)
      *
     C           BGCFMT    IFEQ 'Y'
     C           MGMODI    ANDEQ'DL'
     C                     EXSR CFMAT
     C                     END
      *
     C                     END
      *
      ** Delete the processed GDF record.
      *
     C                     DELETMGF330PD               16
      *
      **  Error on delete of record.
      *
     C           *IN16     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '013'     DBASE              * * * * * * *
     C                     MOVELMGTNUM    DBKEY              * DBERR 013 *
     C                     MOVEL'MGF330PD'DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Update sequence numbers on transaction record
      **  if no errors have occurred
      *
     C           @ERR      IFNE 'Y'
     C                     CALL 'MG5000'               26
     C                     PARM MGMODI    @MODI   2
     C                     PARM MGTNUM    @TRAN  15
     C                     PARM 'CE'      @PROG   2
     C                     PARM 'U'       @MODE   1
     C                     PARM *ZEROS    MGLSWC  30
     C                     PARM *ZEROS    MGLSWS  30
     C                     PARM *BLANKS   @ERCD   1
      *
      **  Error on access for sequence number
     C           @ERCD     IFEQ 'Y'
     C           *LOCK     IN   LDA
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Program missing on call
     C           *IN26     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '016'     DBASE            * * * * * * * *
     C                     MOVE 'MG5000'  DBKEY            *  DBERR 016  *
     C                     OUT  LDA                        * * * * * * * *
     C                     EXSR *PSSR
     C                     END
      *
     C                     END
     C           *LOCK     IN   LDA
     C                     MOVEL'MG0330  'DBPGM
     C                     OUT  LDA
     C/COPY WNCPYSRC,MG0330C018
      *
      **  COMIT all changes since no error on writing the message
      *
     C                     COMIT
      *                                                                   221145
      **  Call Compliance Watch:Watch List Checking                       221145
      *                                                                   221145
     C           CSD015    IFEQ 'Y'                                       221145
     C           W1EWLC    ANDEQ'Y'                                                           222385
     C           CSW025    ANDEQ'N'                                       221145
     C                     EXSR WLCDQ                                     221145
     C                     ENDIF                                          221145
      *
      **  Read the next record.
      *
     C                     READ MGF330PD                 10
     C                     END
      *
      **  Write end of report, only if the printer file is open
      *
     C           *IN50     IFEQ '1'
     C                     WRITEEOREPT
     C                     END
     C/COPY WNCPYSRC,MG0330C021
      *
     C                     SETON                     LR
     C/EJECT
      *****************************************************************
      *   FSWAD - Format SWIFT address                                *
      *   Called by - FD53A - Format field 53.                        *
      *               FD56A - Format field 56.                        *
      *               FD53B - Format field 53.                        *
      *               FD56B - Format field 56.                        *
      *   Calls     - none.                                           *
      *****************************************************************
      *
     C           FSWAD     BEGSR
      *
     C*********************CALL 'ZM0050'                                  CSW036
     C                     CALL 'ZM0051'                                  CSW036
     C                     PARM           ZDEST  12
     C                     PARM           ZSADD1 35
     C                     PARM           ZSADD2 35
     C                     PARM           ZSADD3 35
     C                     PARM           ZSADD4 35
     C                     PARM           ZSTAG   1
     C                     PARM           ZSTYPE  1
     C                     PARM           ZERR    1
     C                     PARM           ZDBEI   1                                           CSW201
      **  Error ?
     C           ZERR      IFEQ '1'
     C                     MOVE 'Y'       @ERR
     C                     MOVE @MTAG     MTAG
     C                     MOVELZDEST     MFLD
     C                     MOVELMSGA,5    MERR
     C                     ELSE
      **  Address 1
     C           ACLINE    IFNE *BLANKS                                   056739
     C                     MOVELACLINE    MFLD                            056739
     C                     ELSE                                           056739
     C                     MOVELZSADD1    MFLD
     C                     END                                            056739
      *
      **  SWIFT address;  Else full address
     C           ZSTAG     IFEQ 'A'
     C/COPY WNCPYSRC,MG0330C029
     C                     MOVE 'A'       TAG
     C                     MOVE @MTAG     MTAG
     C                     MOVE *BLANKS   SAVMTG  5                       183583
     C/COPY WNCPYSRC,MG0330C030
     C           ACLINE    IFNE *BLANKS                                   056739
     C                     MOVE MTAG      SAVMTG                          183583
     C                     ADD  1         X                               056739
     C           X         OCUR MULT                                      056739
     C                     MOVELZSADD1    MFLD                            056739
     C                     END                                            056739
     C                     EXSR SEXTN                                     183583
      *
     C                     ELSE
     C/COPY WNCPYSRC,MG0330C031
     C                     MOVE 'D'       TAG
     C                     MOVE @MTAG     MTAG                            136031
     C/COPY WNCPYSRC,MG0330C032
     C           ACLINE    IFNE *BLANKS                                   056739
     C                     ADD  1         X                               056739
     C           X         OCUR MULT                                      056739
     C                     MOVELZSADD1    MFLD                            056739
     C                     END                                            056739
     C***********          MOVE @MTAG     MTAG                            136031
      **  Address 2
     C           ZSADD2    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD2    MFLD
     C                     END                             Address 2      E42086
      **  Address 3
     C           ZSADD3    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD3    MFLD
     C                     END                             Address 3      E42086
      **  Address 4
     C           ZSADD4    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD4    MFLD
     C                     END                             Address 4
     C**********           END                             Address 3      E42086
     C**********           END                             Address 2      E42086
     C                     END                             Address 1
      *
     C                     END                             Error ?
      *
     C                     ENDSR
      /EJECT                                                              183583
      *****************************************************************   183583
      *                                                               *   183583
      *   SEXTN - Store customer with SWIFT address to data structure *   183583
      *                                                               *   183583
      *   Called by: FSWAD, FD53A                                     *   183583
      *   Calls    : None                                             *   183583
      *                                                               *   183583
      *****************************************************************   183583
      *                                                                   183583
     C           SEXTN     BEGSR                                          183583
      *                                                                   183583
     C           SAVMTG    IFNE *BLANKS                                   183583
     C                     MOVE SAVMTG    @MTG                            183583
     C                     ELSE                                           183583
     C                     MOVELMTAG      @MTG                            183583
     C                     ENDIF                                          183583
      *                                                                   183583
     C           FLDTYP    IFEQ '5'                                       183583
     C           FLDTAG    ANDEQ'A'                                       183583
     C           FLDTYP    OREQ '8'                                                           CSW213
     C           FLDTAG    ANDEQ'A'                                                           CSW213
     C                     ADD  1         V                               183583
     C           V         OCUR EXTN                                      183583
     C                     Z-ADDX         MPSN                            183583
     C                     MOVEL@MTG      MTG                             183583
     C                     MOVELZDEST     MCSI                            183583
     C                     ENDIF                                          183583
      *                                                                   183583
     C           SEXT9     ENDSR                                          183583
     C/EJECT                                                                                  CSW213
      *****************************************************************                       CSW213
      *   FMT83 - Format Field 83J                                    *                       CSW213
      *   Called by - FMA200  - Format Message Detail - Sequence A    *                       CSW213
      *   Calls -  None                                               *                       CSW213
      *****************************************************************                       CSW213
      *                                                                                       CSW213
     C           FMT83     BEGSR                                                              CSW213
      *                                                                                       CSW213
     C                     MOVE *BLANKS   WFLD83  6                                           CSW213
     C                     MOVE *BLANKS   WBCUST  6                                           CSW213
     C                     MOVE *BLANKS   BBCUST                                              CSW213
      *                                                                                       CSW213
     C           CSW024    IFEQ 'Y'                                                           CSW213
     C           DSFUND    ANDNE*BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           '/NAME/'  CAT  DSFUND    MFLD                                                CSW213
     C                     MOVE ':83J:'   MTAG                                                CSW213
      *                                                                                       CSW213
     C                     ELSE                                                               CSW213
      *                                                                                       CSW213
      **  Access customer file for Beneficiary Customer Number                                CSW213
      *                                                                                       CSW213
     C           MGBENN    IFNE *BLANKS                                                       CSW213
     C                     CALL 'AOCUSTR1'                                                    CSW213
     C                     PARM '*MSG   ' @RTCD                                               CSW213
     C                     PARM '*KEY   ' @OPTN                                               CSW213
     C                     PARM MGBENN    @KEY2  10                                           CSW213
     C                     PARM *BLANKS   @KYST   7                                           CSW213
     C           SDCUST    PARM SDCUST    DSLDY                                               CSW213
      *                                                                                       CSW213
      ** Customer Not found on SDCUSTPD, check the counterparty                               CSW213
      ** Nostro file.                                                                         CSW213
      *                                                                                       CSW213
     C           @RTCD     IFNE *BLANKS                                                       CSW213
     C                     CALL 'AOCNSTR0'                                                    CSW213
     C                     PARM *BLANKS   @RTCD   7                                           CSW213
     C                     PARM '*KEY'    @OPTN   7                                           CSW213
     C                     PARM MGBENN    @CNCD   8                                           CSW213
     C           SDCNST    PARM SDCNST    DSFDY                                               CSW213
      *                                                                                       CSW213
      ** Customer record not found - database error                                           CSW213
      *                                                                                       CSW213
     C           @RTCD     IFNE *BLANKS                                                       CSW213
     C           *LOCK     IN   LDA                                                           CSW213
     C                     MOVE '022'     DBASE                                               CSW213
     C                     MOVELMGBENN    DBKEY                                               CSW213
     C                     MOVEL'SDCUSTPD'DBFILE                                              CSW213
     C                     OUT  LDA                                                           CSW213
     C                     EXSR *PSSR                                                         CSW213
     C                     ELSE                                                               CSW213
     C                     MOVE '999999'  WBCUST                                              CSW213
     C                     ENDIF                                                              CSW213
     C                     ELSE                                                               CSW213
     C                     MOVE BBCUST    WBCUST                                              CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      **  Output this field only if Pay Ordering Bank/Customer                                CSW213
      **  is not the same as Sender, Receiver and Beneficiary                                 CSW213
      **  Also, Pay Ordering Customer/Bank must have SWIFT address.                           CSW213
      *                                                                                       CSW213
     C           MGPOBN    IFNE *BLANKS                                                       CSW213
     C           MGPOBN    ANDNEWBICN                                                         CSW213
     C           MGPOBN    ANDNEMGCNUM                                                        CSW213
     C           MGPOBN    ANDNEWBCUST                                                        CSW213
     C                     MOVE MGPOBN    WFLD83                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
     C           MGPOCN    IFNE *BLANKS                                                       CSW213
     C           MGPOCN    ANDNEWBICN                                                         CSW213
     C           MGPOCN    ANDNEMGCNUM                                                        CSW213
     C           MGPOCN    ANDNEWBCUST                                                        CSW213
     C                     MOVE MGPOCN    WFLD83                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
     C           WFLD83    IFNE *BLANKS                                                       CSW213
     C                     MOVE *BLANKS   ZDEST                                               CSW213
     C                     MOVELWFLD83    ZDEST                                               CSW213
      *                                                                                       CSW213
     C                     CALL 'ZM0050'               15                                     CSW213
     C                     PARM           ZDEST  12                                           CSW213
     C                     PARM           ZSADD1 35                                           CSW213
     C                     PARM           ZSADD2 35                                           CSW213
     C                     PARM           ZSADD3 35                                           CSW213
     C                     PARM           ZSADD4 35                                           CSW213
     C                     PARM           ZSTAG   1                                           CSW213
     C                     PARM           ZSTYPE  1                                           CSW213
     C                     PARM ' '       ZERR    1                                           CSW213
     C                     PARM           ZDBEI   1                                           CSW213
      *                                                                                       CSW213
     C           *IN15     IFEQ '1'                                                           CSW213
     C           *LOCK     IN   LDA                                                           CSW213
     C                     MOVE '023'     DBASE                                               CSW213
     C                     MOVEL'       ' DBKEY                                               CSW213
     C                     MOVEL'ZM0050'  DBFILE                                              CSW213
     C                     OUT  LDA                                                           CSW213
     C                     EXSR *PSSR                                                         CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      **  Error ?                                                                             CSW213
      *                                                                                       CSW213
     C           ZERR      IFEQ '1'                                                           CSW213
     C                     MOVE 'Y'       @ERR                                                CSW213
     C                     MOVE ZSTAG     TAG                                                 CSW213
     C                     MOVE @MTAG     MTAG                                                CSW213
     C                     MOVELZDEST     MFLD                                                CSW213
     C                     MOVELMSGA,6    MERR                                                CSW213
      *                                                                                       CSW213
     C                     ELSE                                                               CSW213
      *                                                                                       CSW213
      **  Output only if with SWIFT address.                                                  CSW213
      *                                                                                       CSW213
     C           ZSTAG     IFEQ 'A'                                                           CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVE ' '       TAG                                                 CSW213
     C                     MOVE '83'      FLDNO                                               CSW213
     C                     MOVE 'A'       TAG                                                 CSW213
     C                     MOVE @MTAG     MTAG                                                CSW213
      *                                                                                       CSW213
      **  Address 1                                                                           CSW213
      *                                                                                       CSW213
     C                     MOVE *BLANKS   SAVMTG  5                                           CSW213
     C           ACLINE    IFNE *BLANKS                                                       CSW213
     C                     MOVE MTAG      SAVMTG                                              CSW213
     C                     MOVELACLINE    MFLD                                                CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVELZSADD1    MFLD                                                CSW213
     C                     ELSE                                                               CSW213
     C                     MOVELZSADD1    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     EXSR SEXTN                                                         CSW213
      *                                                                                       CSW213
     C                     ELSE                                                               CSW213
     C           CSW024    IFEQ 'Y'                                                           CSW213
     C           DSCORP    ANDEQ'Y'                                                           CSW213
     C           CSW213    ANDEQ'Y'                                                           CSW213
     C           BBRI01    IFNE *BLANK                                                        CSW213
     C           BBRI02    ORNE *BLANK                                                        CSW213
     C           BBRI03    ORNE *BLANK                                                        CSW213
     C           BBRI04    ORNE *BLANK                                                        CSW213
     C           BBRI05    ORNE *BLANK                                                        CSW213
      *                                                                                       CSW213
     C                     MOVE *BLANK    DN83    1                                           CSW213
     C           BBRI01    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVE ':83J:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN83                                                CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELBBRI01    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           BBRI02    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN83      IFNE 'Y'                                                           CSW213
     C                     MOVE ':83J:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN83                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELBBRI02    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           BBRI03    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN83      IFNE 'Y'                                                           CSW213
     C                     MOVE ':83J:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN83                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELBBRI03    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           BBRI04    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN83      IFNE 'Y'                                                           CSW213
     C                     MOVE ':83J:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN83                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELBBRI04    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           BBRI05    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN83      IFNE 'Y'                                                           CSW213
     C                     MOVE ':83J:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN83                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELBBRI05    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
     C                     ENDSR                                                              CSW213
     C/EJECT
      *****************************************************************
      ****INTF*-*Initalise*non-constant fields.                       *   172657
      *   INITF - Initalise non-constant fields.                      *   172657
      *   Called by - main process.                                   *
      *   Calls     - none.                                           *
      *****************************************************************
      *
     C***********INTF      BEGSR                                          172657
     C           INITF     BEGSR                                          172657
      *
     C                     MOVE *BLANKS   AWBA6   6                       088043
     C                     MOVELMGAWBA    AWBA6   6                       088043
      *                                                                   103387
      * Reformat MGAWBA if it contains "DIRECT"                           103387
      *                                                                   103387
     C                     MOVE MGAWBA    MGTEST 29                       103387
     C           WWAWBA    IFEQ 'DIRECT'                                  103387
     C           WWAWBB    ANDEQ*BLANKS                                   103387
     C                     MOVEL'/DIRECT' MGAWBA    P                     103387
     C                     END                                            103387
     C                     MOVE *BLANKS   TRNO
     C                     MOVE *BLANKS   @TRNA
     C                     MOVE *BLANKS   @TRNB
     C                     MOVE '      '  NWRK
     C**********           Z-ADD0         SECN                                                CSD027
     C                     MOVE *BLANKS   SECN                                                CSD027
     C                     MOVE *BLANKS   NWSN
     C**********           Z-ADD0         DECN                                                CSD027
     C                     MOVE *BLANKS   DECN                                                CSD027
     C                     MOVE *BLANKS   NWDS
     C                     MOVE *BLANKS   MGSG
     C                     MOVE *BLANKS   MGST
     C                     MOVE *BLANKS   LSCC
     C                     MOVE *BLANK    F57U
     C                     MOVE *BLANKS   CWRD    8
     C                     Z-ADD0         MGTM
     C                     Z-ADD0         LATM
     C                     MOVE *BLANKS   RELD
     C                     Z-ADD0         RELT
     C                     MOVE *BLANKS   AMTS
     C                     MOVE *BLANKS   SVDT
     C                     MOVE *BLANKS   CINDV                           141572
     C                     Z-ADD0         AVDT                            E29588
     C                     Z-ADD0         ASEQ                            E29588
      *
     C                     MOVE *BLANKS   @ERR    1
     C                     MOVE *BLANKS   SCSID  12
     C                     MOVE *BLANKS   STELX  10
     C                     MOVE *BLANKS   SSTTX  12
     C                     MOVE *BLANKS   SCRNM  20
     C                     MOVE *BLANKS   SPCNB   6
     C                     MOVE *BLANKS   SPAIN   1
     C/COPY WNCPYSRC,MG0330C019
      *
      **  Currently positioned at line 1 of Field :72:
      *
     C                     MOVE 'N'       LINE2   1
      *
      **  Clear multiple occurrence data structure
      *
     C                     Z-ADD1         X       20
     C           X         OCUR MULT
      *
     C***********X         DOWLE40                                        CSW200
     C           X         DOWLE94                                        CSW200
     C           MULT      ANDNE*BLANKS
     C                     MOVE *BLANKS   MULT
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
      *                                                                   183583
      ** Clear multiple occurrence DS for the extension file.             183583
      *                                                                   183583
     C                     Z-ADD1         V       20                      183583
     C           V         OCUR EXTN                                      183583
     C           V         DOWLE20                                        183583
     C           MCSI      ANDNE*BLANKS                                   183583
     C                     Z-ADD*ZEROS    MPSN                            183583
     C                     MOVE *BLANKS   MTG                             183583
     C                     MOVE *BLANKS   MCSI                            183583
     C                     ADD  1         V                               183583
     C           V         OCUR EXTN                                      183583
     C                     ENDDO                                          183583
     C                     Z-ADD0         V                               183583
      *
      **  Obtain sequence numbers from transaction record
     C                     CALL 'MG5000'               26
     C                     PARM MGMODI    @MODI   2
     C                     PARM MGTNUM    @TRAN  15
     C                     PARM 'CE'      @PROG   2
     C                     PARM *BLANKS   @MODE   1
     C                     PARM *ZEROS    MGLSWC  30
     C                     PARM *ZEROS    MGLSWS  30
     C                     PARM *BLANKS   @ERCD   1
      *
      **  Error on access for sequence number
     C           @ERCD     IFEQ 'Y'
     C           *LOCK     IN   LDA
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Program missing on call
     C           *IN26     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '018'     DBASE            * * * * * * * *
     C                     MOVE 'MG5000'  DBKEY            *  DBERR 018  *
     C                     OUT  LDA                        * * * * * * * *
     C                     EXSR *PSSR
     C                     END
     C           *LOCK     IN   LDA
     C                     MOVEL'MG0330  'DBPGM
     C                     OUT  LDA
      *
      ** If the branch code on the file MGF320PD is blank,                082906
      ** then default it to the branch code on the SDBRCHPD               082906
      *                                                                   082906
     C           MGBRCA    IFEQ *BLANKS                                   082906
     C                     MOVELA8BRCD    MGBRCA                          082906
     C                     END                                            082906
      ** If our receive branch is blank then default it to the            082906
      ** branch code                                                      082906
      *                                                                   082906
     C           MGROBR    IFEQ *BLANKS                                   082906
     C                     MOVELMGBRCA    MGROBR                          082906
     C                     END                                            082906
      *                                                                   082906
     C                     MOVE *BLANKS   @KEY1                                               CSW024
     C                     MOVELMGCNUM    @KEY1                                               CSW024
     C                     CALL 'AOCUSTR1'                                                    CSW024
     C                     PARM '*MSG   ' @RTCD                                               CSW024
     C                     PARM '*KEY   ' @OPTN                                               CSW024
     C                     PARM           @KEY1                                               CSW024
     C                     PARM *BLANKS   @KYST                                               CSW024
     C           SDCUST    PARM SDCUST    DSLDY                                               CSW024
      *                                                                                       CSW024
     C           @RTCD     IFNE *BLANKS                                                       CSW024
     C           *LOCK     IN   LDA                                                           CSW024
     C                     MOVEL'AOCUSTR0'DBFILE                                              CSW024
     C                     MOVE '037'     DBASE              * * * * * * *                    CSW024
     C                     MOVELMGCNUM    DBKEY              * DBERR 37  *                    CSW024
     C                     OUT  LDA                          * * * * * * *                    CSW024
     C                     EXSR *PSSR                                                         CSW024
     C                     ELSE                                                               CSW024
     C                     MOVE BBCNA1    DSCNA1 35                                           CSW024
     C                     MOVE BBCNA2    DSCNA2 35                                           CSW024
     C                     MOVE BBCNA3    DSCNA3 35                                           CSW024
     C                     MOVE BBCNA4    DSCNA4 35                                           CSW024
     C                     MOVE BBCORP    DSCORP  1                                           CSW024
     C                     MOVE BBCBEI    DSCBEI 11                                           CSW024
     C                     MOVE BBRI01    DSRI01 40                                           CSW024
     C                     MOVE BBRI02    DSRI02 40                                           CSW024
     C                     MOVE BBRI03    DSRI03 40                                           CSW024
     C                     MOVE BBRI04    DSRI04 40                                           CSW024
     C                     MOVE BBRI05    DSRI05 40                                           CSW024
     C                     MOVE BBFUND    DSFUND 34                                           CSW024
     C                     ENDIF                                                              CSW024
      *                                                                                       CSW024
     C                     ENDSR
     C/EJECT
      *****************************************************************   CSW200
      *   FMA200  - Format Message Detail - Sequence A.               *   CSW200
      *            This subroutine is similar to FMTA with the        *   CSW200
      *            following changes:                                 *   CSW200
      *             - New field :15A: Beginning of sequence A         *   CSW200
      *             - :22A: now just contains the type of operation   *   CSW200
      *             - New field :22B: type of event                   *   CSW200
      *             - New field :22C: common reference                *   CSW200
      *             - New field :15B: Beginning of sequence B(party A)*   CSW200
      *             - New field :15C: Beginning of sequence C(party B)*   CSW200
      *                                                               *   CSW200
      *   Called by - main process                                    *   CSW200
      *   Calls     - CODE   determine codeword.                      *   CSW200
      *             - DATES  formats date fields.                     *   CSW200
      *             - FD53A  format field 53.                         *   CSW200
      *             - FD53B  format field 53.                         *   CSW200
      *             - FLD72  format field 72.                         *   CSW200
      *****************************************************************   CSW200
      *                                                                   CSW200
     C           FMA200    BEGSR                                          CSW200
      *                                                                   CSW200
      ** FIELD :15A: - New Sequence                                       CSW200
      *                                                                   CSW200
     C                     Z-ADD1         X       20                      CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C                     MOVEL':15A:'   MTAG                            CSW200
     C                     MOVE *BLANKS   MFLD                            CSW200
      *                                                                   CSW200
      ** Field :20: -  Transaction Reference Number.                      CSW200
      *                                                                   CSW200
     C                     ADD  1         X       20                      CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVEA*BLANKS   @WRK                            CSW200
      *                                                                   CSW200
      ** Build up the trn with the module id, the transaction number      CSW200
      ** and the last swift sequence add 1.                               CSW200
      *                                                                   CSW200
     C                     Z-ADD1         Z       20                      CSW200
     C                     MOVEAMGMODI    @WRK                            CSW200
     C                     MOVEAMGTNUM    @WRK,3                          CSW200
     C           MGLSWS    ADD  1         HLSWS   30                      CSW200
     C                     MOVE HLSWS     HSWS    3                       CSW200
      *                                                                   CSW200
     C           ' '       LOKUP@WRK,Z                   31               CSW200
     C                     MOVEAHSWS      @WRK,Z                          CSW200
      *                                                                   CSW200
      **  Check on MGREFPD for a uniqne TRN,else output as an error.      CSW200
      **  and store the TRN of the new confirmation message.              CSW200
      *                                                                   CSW200
     C                     MOVEA@WRK      @TRNA  16                       CSW200
      *                                                                   CSW200
     C           @TRNA     CHAINMGREFL0              11                   CSW200
      *                                                                   CSW200
      ** If no record is found flag field as in error.                    CSW200
      *                                                                   CSW200
     C           *IN11     IFEQ '0'                                       CSW200
     C                     MOVE 'Y'       @ERR                            CSW200
     C                     MOVEAMSGA,7    MERR                            CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
     C                     MOVEL':20:'    MTAG                            CSW200
     C                     MOVEA@WRK      MFLD                            CSW200
      *                                                                   CSW200
      ** Field :21: - Related Reference.                                  CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
      **  Determine the message codeword                                  CSW200
      *                                                                   CSW200
     C                     EXSR CODE                                      CSW200
      *                                                                   CSW200
     C           CWRD      IFEQ 'NEW'                                     CSW200
     C                     MOVEL'NEW'     MFLD                            CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      **  Set up the related reference.                                   CSW200
      *                                                                   CSW200
     C                     MOVEA*BLANKS   @WRK                            CSW200
     C                     MOVEAMGMODI    @WRK                            CSW200
     C                     MOVEAMGTNUM    @WRK,3                          CSW200
     C                     MOVE MGLSWC    MLSWC   30                      CSW200
     C                     MOVE MLSWC     MSWC    3                       CSW200
      *                                                                   CSW200
     C           ' '       LOKUP@WRK,Z                   31               CSW200
     C                     MOVEAMSWC      @WRK,Z                          CSW200
     C                     MOVEA@WRK      @TRNB  16                       CSW200
      *                                                                   CSW200
     C                     MOVEL@TRNB     MFLD                            CSW200
      *                                                                   CSW200
      **  Obtain transaction reference of previous MT330                                      190127
     C                     MOVELMGTNUM    HSTRAN                                              190127
     C                     MOVE '330'     HSMTPY                                              190127
      *                                                                                       190127
     C                     MOVE HSTRAN    @HTRN   6                                           190127
      *                                                                                       190127
     C           HSKEY     SETGTMGHISTL0                                                      190127
     C                     READPMGHISTL0                 56                                   190127
      *                                                                                       190127
     C           *IN56     IFEQ '0'                                                           190127
     C           HSMODI    ANDEQMGMODI                                                        190127
     C           HSTRAN    ANDEQ@HTRN                                                         190127
     C           HSMTPY    ANDEQ'330'                                                         190127
     C                     MOVEL@HREF     MFLD                                                190127
     C                     END                                                                190127
     C                     END                                            CSW200
     C/COPY WNCPYSRC,MG0330C039
      *                                                                   CSW200
     C                     MOVEL':21:'    MTAG                            CSW200
      *                                                                   CSW200
      ** Field :22A: - Type of operation.                                 CSW200
      *        :22B: - Type of event                                      CSW200
      *        :22C: - Common reference                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE *BLANKS   ZCREF                           CSW200
      *                                                                   CSW200
      **  If SWIFT network, use sender & destination customer             CSW200
     C           NWRK      IFEQ 'SWIFT'                                   CSW200
     C           NWRK      OREQ 'STTX'                                    CSW200
      *                                                                   CSW200
     C           NWRK      IFEQ 'SWIFT'                                   CSW200
     C                     MOVELNWSN      ZSSWI                           CSW200
     C                     MOVELNWDS      ZDSWI                           CSW200
     C                     ELSE                                           CSW200
     C                     MOVELSCSID     ZSSWI                           CSW200
     C                     MOVELCSID      ZDSWI                           CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
     C                     MOVE MGINTR    ZRATE                           CSW200
      *                                                                   CSW200
      **  Format SWIFT common reference                                   CSW200
      *                                                                   CSW200
     C                     CALL 'ZM0020'               15                 CSW200
     C                     PARM           ZSSWI  12                       CSW200
     C                     PARM           ZDSWI  12                       CSW200
     C                     PARM           ZRATE  138                      CSW200
     C                     PARM           ZCREF  16                       CSW200
      *                                                                   CSW200
      ** If the program ends in error.                                    CSW200
      *                                                                   CSW200
     C           *IN15     IFEQ '1'                                       CSW200
     C           *LOCK     IN   LDA                                       CSW200
     C                     MOVE '034'     DBASE              * * * * * * *CSW200
     C                     MOVEL'       ' DBKEY              * DBERR 034 *CSW200
     C                     MOVEL'ZM0020'  DBFILE             * * * * * * *CSW200
     C                     OUT  LDA                                       CSW200
     C                     EXSR *PSSR                                     CSW200
     C                     END                                            CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
     C           O@SWSN    IFNE *BLANKS                                   CSW200
     C           O@SWDS    ANDNE*BLANKS                                   CSW200
      *                                                                   CSW200
     C                     MOVE MGINTR    ZRATE                           CSW200
     C                     MOVELO@SWSN    ZSSWI                           CSW200
     C                     MOVELO@SWDS    ZDSWI                           CSW200
      *                                                                   CSW200
      **  Format SWIFT common reference                                   CSW200
      *                                                                   CSW200
     C                     CALL 'ZM0020'               15                 CSW200
     C                     PARM           ZSSWI  12                       CSW200
     C                     PARM           ZDSWI  12                       CSW200
     C                     PARM           ZRATE  138                      CSW200
     C                     PARM           ZCREF  16                       CSW200
      *                                                                   CSW200
     C           *IN15     IFEQ '1'                                       CSW200
     C           *LOCK     IN   LDA                                       CSW200
     C                     MOVE '035'     DBASE                           CSW200
     C                     MOVEL'       ' DBKEY                           CSW200
     C                     MOVEL'ZM0020'  DBFILE                          CSW200
     C                     OUT  LDA                                       CSW200
     C                     EXSR *PSSR                                     CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C           ZCREF     IFEQ *BLANKS                                   CSW200
     C                     MOVEL@TRNA     ZCREF                           CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
      *                                                                   CSW200
      **  If change type indicates reversal, codeword equals 'CANCEL'     CSW200
      *                                                                   CSW200
     C           MGCHTP    IFEQ 'C'                                       CSW200
     C                     MOVEL'CANCEL  'CWRD                            CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
      ** FIELD 22A   'Type of operation '                                 CSW200
      *                                                                   CSW200
     C                     SELEC                                          CSW200
      *                                                                   CSW200
     C           CWRD      WHEQ 'NEW'                                     CSW200
     C                     MOVEL'NEWT'    MFLD                            CSW200
      *                                                                   CSW200
     C           CWRD      WHEQ 'CANCEL'                                  CSW200
     C                     MOVEL'CANC'    MFLD                            CSW200
      *                                                                   CSW200
      * Determine operation type for Amend                                CSW200
     C           CWRD      WHEQ 'AMEND'                                   CSW200
     C           CWRD      OREQ 'SETTLE'                                  CSW200
      *                                                                   CSW200
      * If change is principal increase, principal decrease,              CSW200
      * repayment, spread change or amount is zero                        CSW200
     C           MGAMTP    IFEQ 'PI'                                      CSW200
     C           MGAMTP    OREQ 'PD'                                      CSW200
     C           MGAMTP    OREQ 'RE'                                      CSW200
     C           MGAMTP    OREQ 'SC'                                      CSW200
     C           MGNAMT    OREQ 0                                         CSW200
      *                                                                   CSW200
     C                     MOVEL@TRNB     KTRNB                           CSW200
     C                     MOVEL':22B:'   KMTAG                           CSW200
      *                                                                   CSW200
      * Chain to msg data file with trans ref and type of operation tag   CSW200
     C           KEYSQN    CHAINMGOMSGL1             11                   CSW200
      *                                                                   CSW200
      * If current amend type and previous event type match...            CSW200
     C           MGAMTP    IFEQ 'PI'                                      CSW200
     C           NMFLD     ANDEQ'CHNG'                                    CSW200
     C           MGAMTP    OREQ 'PD'                                      CSW200
     C           NMFLD     ANDEQ'CHNG'                                    CSW200
     C           MGAMTP    OREQ 'RE'                                      CSW200
     C           NMFLD     ANDEQ'CHNG'                                    CSW200
     C           MGAMTP    OREQ 'SC'                                      CSW200
     C           NMFLD     ANDEQ'CINT'                                    CSW200
     C           MGNAMT    OREQ 0                                         CSW200
     C           NMFLD     ANDEQ'SETT'                                    CSW200
      *                                                                   CSW200
      * If amount is not zero                                             CSW200
     C           MGNAMT    IFNE 0                                         CSW200
      *                                                                   CSW200
      * Get trade date for previous entry                                 CSW200
     C                     MOVEL':30T:'   KMTAG                           CSW200
     C           KEYSQN    CHAINMGOMSGL1             11                   CSW200
      *                                                                   CSW200
      * Get trade date for current entry                                  CSW200
     C                     MOVE MGTDAT    ZMDAY                           CSW200
     C                     CALL 'ZM0065'               15                 CSW200
     C                     PARM           ZMDAY                           CSW200
     C                     PARM           ZSDATE                          CSW200
     C                     PARM           ZSDATC                          CSW200
      *                                                                   CSW200
      * If trade dates are different this is a new entry                  CSW200
     C           NMFLD     IFNE ZSDATC                                    CSW200
     C                     MOVEL'NEWT'    MFLD                            CSW200
      *                                                                   CSW200
      * Otherwise it is an amend                                          CSW200
     C                     ELSE                                           CSW200
     C                     MOVEL'AMND'    MFLD                            CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      * else (MGNAMT is 0)                                                CSW200
     C                     ELSE                                           CSW200
     C                     MOVEL'AMND'    MFLD                            CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      * else (current amend type and previous event type do not match)    CSW200
     C                     ELSE                                           CSW200
     C                     MOVEL'NEWT'    MFLD                            CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      * else (change is not principal increase, principal decrease,       CSW200
      * spread change or settlement amount is not zero)                   CSW200
     C                     ELSE                                           CSW200
     C                     MOVEL'AMND'    MFLD                            CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ENDSL                                          CSW200
      *                                                                   CSW200
     C                     MOVEL':22A:'   MTAG                            CSW200
      *                                                                                       CSW024
      **  If corporate customer output :94A:                                                  CSW024
     C           CSW024    IFEQ 'Y'                                                           CSW024
     C           DSCORP    ANDEQ'Y'                                                           CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C                     MOVE *BLANK    MFLD                                                CSW024
     C                     MOVEL'AGNT'    MFLD                                                CSW024
     C                     MOVE ':94A:'   MTAG                                                CSW024
     C                     ENDIF                                                              CSW024
      *                                                                   CSW200
      ** Field 22B 'Type of events'                                       CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C                     SELEC                                          CSW200
      *                                                                   CSW200
     C           MGAMTP    WHEQ 'SC'                                      CSW200
     C                     MOVEL'CINT'    MFLD                            CSW200
      *                                                                   CSW200
     C           CWRD      WHEQ 'NEW'                                     CSW200
     C                     MOVEL'CONF'    MFLD                            CSW200
      *                                                                   CSW200
     C           CWRD      WHEQ 'SETTLE'                                  CSW200
     C                     MOVEL'SETT'    MFLD                            CSW200
      *                                                                   CSW200
     C           CWRD      WHEQ 'CANCEL'                                  CSW200
     C           CWRD      OREQ 'AMEND'                                   CSW200
      *                                                                   CSW200
     C                     SELEC                                          CSW200
     C           MGAMTP    WHEQ 'PI'                                      CSW200
     C           MGAMTP    OREQ 'PD'                                      CSW200
     C           MGAMTP    OREQ 'RE'                                      CSW200
     C                     MOVEL'CHNG'    MFLD                            CSW200
      *                                                                   CSW200
     C           MGAMTP    WHEQ 'SC'                                      CSW200
     C           MGAMTP    OREQ 'BC'                                      CSW200
     C                     MOVEL'CINT'    MFLD                            CSW200
      *                                                                   CSW200
     C           MGNAMT    WHEQ *ZERO                                     CSW200
     C                     MOVEL'SETT'    MFLD                            CSW200
      *                                                                   CSW200
     C                     OTHER                                          CSW200
     C                     MOVEL'CONF'    MFLD                            CSW200
     C                     ENDSL                                          CSW200
     C                     ENDSL                                          CSW200
      *                                                                   CSW200
      *                                                                   CSW200
     C                     MOVEL':22B:'   MTAG                            CSW200
     C                     MOVE MFLD      WKMFLD 50                       CSW200
      *                                                                   CSW200
      **  FIELD 22C 'Common reference'                                    CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C                     MOVELZCREF     MFLD                            CSW200
      *                                                                   CSW200
     C                     MOVEL':22C:'   MTAG                            CSW200
      *                                                                                       CSW024
      ** If corporate customer output :21N:                                                   CSW024
     C           CSW024    IFEQ 'Y'                                                           CSW024
     C           DSCORP    ANDEQ'Y'                                                           CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C                     MOVE *BLANK    MFLD                                                CSW024
     C                     MOVEL@TRNA     WK8     8                                           CSW024
     C                     MOVELWK8       MFLD                                                CSW024
     C                     MOVE ':21N:'   MTAG                                                CSW024
     C                     ENDIF                                                              CSW024
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
      *                                                                                       CSW201
      ** Field :82a: Party A                                                                  CSW201
      *                                                                                       CSW201
     C                     ADD  1         X                                                   CSW201
     C           X         OCUR MULT                                                          CSW201
      *                                                                                       CSW201
     C**********           CALL 'AOBRCHR0'                                             CSW201 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD                                               CSW201
     C                     PARM '*KEY   ' @OPTN                                               CSW201
     C                     PARM MGBRCA    @BRCD   3                                           CSW201
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CSW201
      *                                                                                       CSW201
      ** Branch record not found - DB Error                                                   CSW201
      *                                                                                       CSW201
     C           @RTCD     IFNE *BLANKS                                                       CSW201
     C           *LOCK     IN   LDA                                                           CSW201
     C                     MOVE '036'     DBASE            ************                       CSW201
     C                     MOVELMGBRCA    DBKEY            * DBERR 36 *                       CSW201
     C                     MOVEL'SDBRCHPD'DBFILE           ************                       CSW201
     C                     OUT  LDA                                                           CSW201
     C                     EXSR *PSSR                                                         CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW213
     C                     MOVE *BLANKS   WBICN   6                                           CSW213
     C                     MOVELA8BICN    WBICN                                               CSW213
      *                                                                                       CSW201
     C                     MOVE *BLANKS   ZDEST                                               CSW201
     C                     MOVE *BLANKS   ACLINE                                              CSW201
     C                     MOVE *BLANKS   TAG                                                 CSW201
     C                     MOVELA8BICN    ZDEST                                               CSW201
     C                     MOVE '82'      FLDNO                                               CSW201
     C                     EXSR FSWAD                                                         CSW201
      *                                                                                       CSW201
     C                     ENDIF                                                              CSW024
      *                                                                                       CSW024
      **  If corporate customer...                                                            CSW024
     C           CSW024    IFEQ 'Y'                                                           CSW024
     C           DSCORP    ANDEQ'Y'                                                           CSW024
      *                                                                                       CSW024
      **  If BEI output :87A:                                                                 CSW024
     C           DSCBEI    IFNE *BLANK                                                        CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C                     MOVE *BLANK    MFLD                                                CSW024
     C                     MOVELDSCBEI    MFLD                                                CSW024
     C                     MOVE ':87A:'   MTAG                                                CSW024
      *                                                                                       CSW024
      **  If receiver party info output :87J:                                                 CSW024
     C                     ELSE                                                               CSW024
     C           DSRI01    IFNE *BLANK                                                        CSW024
     C           DSRI02    ORNE *BLANK                                                        CSW024
     C           DSRI03    ORNE *BLANK                                                        CSW024
     C           DSRI04    ORNE *BLANK                                                        CSW024
     C           DSRI05    ORNE *BLANK                                                        CSW024
      *                                                                                       CSW024
     C                     MOVE *BLANK    DN87    1                                           CSW024
     C           DSRI01    IFNE *BLANK                                                        CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C           DN87      IFNE 'Y'                                                           CSW024
     C                     MOVE ':87J:'   MTAG                                                CSW024
     C                     MOVE 'Y'       DN87                                                CSW024
     C                     ENDIF                                                              CSW024
     C                     MOVE *BLANK    MFLD                                                CSW024
     C                     MOVELDSRI01    MFLD                                                CSW024
     C                     ENDIF                                                              CSW024
     C           DSRI02    IFNE *BLANK                                                        CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C           DN87      IFNE 'Y'                                                           CSW024
     C                     MOVE ':87J:'   MTAG                                                CSW024
     C                     MOVE 'Y'       DN87                                                CSW024
     C                     ENDIF                                                              CSW024
     C                     MOVE *BLANK    MFLD                                                CSW024
     C                     MOVELDSRI02    MFLD                                                CSW024
     C                     ENDIF                                                              CSW024
     C           DSRI03    IFNE *BLANK                                                        CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C           DN87      IFNE 'Y'                                                           CSW024
     C                     MOVE ':87J:'   MTAG                                                CSW024
     C                     MOVE 'Y'       DN87                                                CSW024
     C                     ENDIF                                                              CSW024
     C                     MOVE *BLANK    MFLD                                                CSW024
     C                     MOVELDSRI03    MFLD                                                CSW024
     C                     ENDIF                                                              CSW024
     C           DSRI04    IFNE *BLANK                                                        CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C           DN87      IFNE 'Y'                                                           CSW024
     C                     MOVE ':87J:'   MTAG                                                CSW024
     C                     MOVE 'Y'       DN87                                                CSW024
     C                     ENDIF                                                              CSW024
     C                     MOVE *BLANK    MFLD                                                CSW024
     C                     MOVELDSRI04    MFLD                                                CSW024
     C                     ENDIF                                                              CSW024
     C           DSRI05    IFNE *BLANK                                                        CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C           DN87      IFNE 'Y'                                                           CSW024
     C                     MOVE ':87J:'   MTAG                                                CSW024
     C                     MOVE 'Y'       DN87                                                CSW024
     C                     ENDIF                                                              CSW024
     C                     MOVE *BLANK    MFLD                                                CSW024
     C                     MOVELDSRI05    MFLD                                                CSW024
     C                     ENDIF                                                              CSW024
      *                                                                                       CSW024
      ** Else output :87D:                                                                    CSW024
     C                     ELSE                                                               CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C                     MOVE ':87D:'   MTAG                                                CSW024
     C                     MOVELDSCNA1    MFLD                                                CSW024
      **  Address 2                                                                           CSW024
     C           DSCNA2    IFNE *BLANKS                                                       CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C                     MOVELDSCNA2    MFLD                                                CSW024
     C                     ENDIF                                                              CSW024
      **  Address 3                                                                           CSW024
     C           DSCNA3    IFNE *BLANKS                                                       CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C                     MOVELDSCNA3    MFLD                                                CSW024
     C                     ENDIF                                                              CSW024
      **  Address 4                                                                           CSW024
     C           DSCNA4    IFNE *BLANKS                                                       CSW024
     C                     ADD  1         X                                                   CSW024
     C           X         OCUR MULT                                                          CSW024
     C                     MOVELDSCNA4    MFLD                                                CSW024
     C                     ENDIF                                                              CSW024
      *                                                                                       CSW024
     C                     ENDIF                                                              CSW024
     C                     ENDIF                                                              CSW024
      *                                                                                       CSW024
     C                     ELSE                                                               CSW024
      *                                                                                       CSW024
     C           CSW201    IFEQ 'Y'                                                           CSW024
      **  Field :87a: Party B                                                                 CSW201
      *                                                                                       CSW201
     C                     ADD  1         X                                                   CSW201
     C           X         OCUR MULT                                                          CSW201
      *                                                                                       CSW201
     C                     MOVE *BLANKS   ZDEST                                               CSW201
     C                     MOVE *BLANKS   ACLINE                                              CSW201
     C                     MOVE *BLANKS   TAG                                                 CSW201
     C                     MOVELMGCNUM    ZDEST                                               CSW201
     C                     MOVE '87'      FLDNO                                               CSW201
     C                     EXSR FSWAD                                                         CSW201
      *                                                                                       CSW201
     C                     ENDIF                                                              CSW024
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW024
      ****Output :83J:                                                                 CSW024 CSW213
     C********** CSW024    IFEQ 'Y'                                                    CSW024 CSW213
     C********** DSFUND    ANDNE*BLANK                                                 CSW024 CSW213
     C**********           ADD  1         X                                            CSW024 CSW213
     C********** X         OCUR MULT                                                   CSW024 CSW213
     C********** '/NAME/'  CAT  DSFUND    MFLD                                         CSW024 CSW213
     C**********           MOVE ':83J:'   MTAG                                         CSW024 CSW213
     C**********           ENDIF                                                       CSW024 CSW213
      *                                                                                       CSW213
      ** Format Field :83J:                                                                   CSW213
      *                                                                                       CSW213
     C                     EXSR FMT83                                                         CSW213
      *                                                                   CSW200
      **  FIELD 77D 'Fiduciary Confirmation'                              CSW200
      *                                                                   CSW200
     C           CDL006    IFEQ 'Y'                                       CSW200
      *                                                                   CSW200
     C           MGTTYP    IFEQ 'DT'                                      CSW200
     C           MGTTYP    OREQ 'DP'                                      CSW200
     C           MGTTYP    OREQ 'LT'                                      CSW200
     C           MGTTYP    OREQ 'LP'                                      CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVEL'/FIDU/'  MFLD                            CSW200
     C                     MOVEL':77D:'   MTAG                            CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      **  Fromat Date Fields                                              CSW200
      *                                                                   CSW200
     C                     EXSR DAT200                                    CSW200
      *                                                                   CSW200
      ** Format field 53                                                  CSW200
      *                                                                   CSW200
      ** FIELD :15C: - New Sequence                                       CSW200
     C                     ADD  1         X       20                      CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVEL':15C:'   MTAG                            CSW200
     C                     MOVE *BLANKS   MFLD                            CSW200
     C                     EXSR F53A00                                    CSW200
      *                                                                   CSW200
      ** FIELD :15D: - New Sequence                                       CSW200
     C                     ADD  1         X       20                      CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVEL':15D:'   MTAG                            CSW200
     C                     MOVE *BLANKS   MFLD                            CSW200
     C                     EXSR FD53B                                     CSW200
      *                                                                   CSW200
     C                     ENDSR                                          CSW200
     C/EJECT                                                              CSW200
      *****************************************************************   CSW200
      *   FEF200  - Format Message Detail - Sequence E/F.             *   CSW200
      *            New Fields:                                        *   CSW200
      *             - :15E: Beginning of sequence E; Settlement Ins-  *   CSW200
      *                truction for Interests Payable by Party A.     *   CSW200
      *             - :15F: Beginning of sequence F; Settlement Ins-  *   CSW200
      *                truction for Interests Payable by Party B.     *   CSW200
      *                                                               *   CSW200
      *   Called by - main process                                    *   CSW200
      *   Calls     - PAYI00 format field 53, 56 and 57               *   CSW200
      *             - RCVI00 format field 56 and 57                   *   CSW200
      *****************************************************************   CSW200
      *                                                                   CSW200
     C           FEF200    BEGSR                                          CSW200
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C                     MOVE 'Y'       ZDBEI                                               CSW201
     C                     ENDIF                                                              CSW201
      *                                                                   CSW200
      * Only for dealing module  with interest to pay separately          CSW200
     C           MGMODI    IFEQ 'DL'                                      CSW200
      *                                                                   CSW200
     C           S01434    ANDEQ'Y'                                       CSW200
     C           MGIPDS    ANDEQ'Y'                                       CSW200
      *                                                                   CSW200
     C           MGLORD    IFEQ 'L'                                       CSW200
      * 'L' for Loan                                                      CSW200
      * As interest paid separately is only available  for loan or depo   CSW200
      * sit deals, do not have to check for principal increases and       CSW200
      * repayments for customer or syndicated loans.                      CSW200
      *                                                                   CSW200
     C                     MOVEL'15'      FLDNO                           CSW200
     C                     MOVE 'F'       TAG                             CSW200
     C                     EXSR RCVI00                                    CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C           MGLORD    IFEQ 'D'                                       CSW200
      * 'D' for Deposit                                                   CSW200
      *                                                                   CSW200
     C                     MOVEL'15'      FLDNO                           CSW200
     C                     MOVE 'E'       TAG                             CSW200
     C                     EXSR PAYI00                                    CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ENDIF                                          CSW200
      *                                                                                       CSW201
     C                     MOVE *BLANKS   ZDBEI                                               CSW201
      *                                                                   CSW200
     C                     ENDSR                                          CSW200
     C/EJECT                                                              CSW200
      *****************************************************************   CSW200
      *   RCVI00  - Format Message Detail - Field 56 and 57           *   CSW200
      *                                                               *   CSW200
      *   Called by - FEF200 Format message detail seq. E/F           *   CSW200
      *   Calls     - FSWAD  format swift address                     *   CSW200
      *****************************************************************   CSW200
      *                                                                   CSW200
     C           RCVI00    BEGSR                                          CSW200
      *                                                                   CSW200
      * Interest Settlement Method must not be blanks                     CSW200
     C           MGIMET    IFNE *BLANKS                                   CSW200
      * Only output this sequence if the interest settlement details      CSW200
      * are different to the receive settlement details.                  CSW200
     C                     MOVE MGRSTM    WK2     2                       CSW200
     C           MGIMET    IFNE WK2                                       CSW200
     C           MGINSA    ORNE MGRONS                                    CSW200
      * New sequence                                                      CSW200
     C                     ADD  1         X       20                      CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVEL@MTAG     MTAG                            CSW200
     C                     MOVE *BLANKS   MFLD                            CSW200
      *                                                                   CSW200
     C                     MOVE MGIMET    @STM    2                       CSW200
     C           @STM      LOKUPTABNST                   23               CSW200
     C           *IN23     IFEQ '1'                                       CSW200
     C           CEU003    IFEQ 'Y'                                       CSW200
     C           MGISCY    ANDNE*BLANKS                                   CSW200
     C                     MOVE MGISCY    @CYCD                           CSW200
     C                     ELSE                                           CSW200
     C                     MOVE MGCCY     @CYCD                           CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     MOVELMGINSA    @NONB                           CSW200
     C******               CALL 'AONOSTR0'                                             CSW200 CDL094
     C                     CALL 'AONOSTR1'                                                    CDL094
     C                     PARM '*MSG   ' @RTCD   7                       CSW200
     C                     PARM '*KEY   ' @OPTN   7                       CSW200
     C                     PARM *BLANKS   @CUST   6        I:Customer No  CSW200
     C                     PARM           @CYCD   3        I:Currency     CSW200
     C**********           PARM *BLANKS   @ACCD   4        I:A/c Code                  CSW200 CGL029
     C                     PARM *BLANKS   @ACCD  10                                           CGL029
     C                     PARM *BLANKS   @ACSN   2        I:A/c Seq      CSW200
     C                     PARM           @NONB   2        I:Nostro No    CSW200
     C                     PARM *BLANKS   @BRCD   3        I:Branch Code  CSW200
     C                     PARM *BLANKS   @CSSN  10        I:Cust ShortN  CSW200
     C                     PARM *BLANK    @PNOI   1        I:Prime Nost InCSW200
     C***********SDNOST    PARM SDNOST    DSFDY                                        CSW200 CDL094
     C           SDNOST    PARM SDNOST    DSSDY                                               CDL094
      *                                                                   CSW200
      **  If our receive nostro is not found.                             CSW200
      *                                                                   CSW200
     C           @RTCD     IFNE *BLANKS                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C                     MOVE 'Y'       @ERR                            CSW200
     C                     MOVELMGINSA    HLD2    2                       CSW200
     C                     MOVEL@CYCD     HLD5                            CSW200
     C                     MOVE HLD2      HLD5    5                       CSW200
     C                     MOVELHLD5      MFLD                            CSW200
     C                     MOVELMSGA,3    MERR                            CSW200
     C                     MOVE ':57 :'   MTAG                            CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
     C           MGBRCA    IFNE A7BRCD                                    CSW200
     C**********           CALL 'AOBRCHR0'                                             CSW200 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD                           CSW200
     C                     PARM '*KEY   ' @OPTN                           CSW200
     C                     PARM A7BRCD    @BRCD   3                       CSW200
     C           SDBRCH    PARM SDBRCH    DSSDY                           CSW200
      *                                                                   CSW200
      ** Branch record not found - Error                                  CSW200
      *                                                                   CSW200
     C           @RTCD     IFNE *BLANKS                                   CSW200
     C           *LOCK     IN   LDA                                       CSW200
     C                     MOVE '031'     DBASE              * * * * * * *CSW200
     C                     MOVELA7BRCD    DBKEY              * DBERR 031 *CSW200
     C                     MOVEL'SDBRCHPD'DBFILE             * * * * * * *CSW200
     C                     OUT  LDA                                       CSW200
     C                     EXSR *PSSR                                     CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
      **  Format our Receive Nostro Customer Address                      CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELA8BICN    ZDEST                           CSW200
     C                     MOVEL*BLANKS   ACLINE 35                       CSW200
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '56'      FLDNO                           CSW200
     C                     EXSR FSWAD                                     CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELA7CUST    ZDEST                           CSW200
     C                     MOVEL*BLANKS   ACLINE 35                       CSW200
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '57'      FLDNO                           CSW200
     C                     EXSR FSWAD                                     CSW200
      *                                                                   CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C           MGIMET    IFNE '00'                                      CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELSECN      ZDEST                           CSW200
     C                     MOVEL*BLANKS   ACLINE                          CSW200
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '57'      FLDNO                           CSW200
     C                     EXSR FSWAD                                     CSW200
      *                                                                   CSW200
      ** No settlement type entered.                                      CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
     C                     MOVE ':57D:'   MTAG                            CSW200
     C                     MOVEL'UNKNOWN' MFLD                            CSW200
     C                     ENDIF                                          CSW200
     C                     ENDIF                                          CSW200
     C                     ENDIF                                          CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ENDSR                                          CSW200
     C/EJECT                                                              CSW200
      *****************************************************************   CSW200
      *   PAYI00  - Format Message Detail - Field 53, 56 and 57       *   CSW200
      *                                                               *   CSW200
      *   Called by - FEF200 Format message detail seq. E/F           *   CSW200
      *   Calls     - FSWAD  format swift address                     *   CSW200
      *****************************************************************   CSW200
      *                                                                   CSW200
     C           PAYI00    BEGSR                                          CSW200
      *                                                                   CSW200
      * Interest Settlement Method must not be blanks                     CSW200
     C           MGIMET    IFNE *BLANKS                                   CSW200
      *                                                                   CSW200
     C           MGINOS    IFEQ *BLANKS                                   CSW200
     C                     MOVELMGAWBN    MGINOS                          CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      * Only output this sequence if the interest settlement details      CSW200
      * are different to the receive settlement details.                  CSW200
     C                     MOVE MGPSTM    WK2     2                       CSW200
     C           MGIMET    IFNE WK2                                       CSW200
     C           MGINSA    ORNE MGPONS                                    CSW200
     C           MGINOS    ORNE MGAWBN                                    CSW200
      * New sequence                                                      CSW200
     C                     ADD  1         X       20                      CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVEL@MTAG     MTAG                            CSW200
     C                     MOVE *BLANKS   MFLD                            CSW200
      *                                                                   CSW200
     C                     MOVE MGIMET    @STM    2                       CSW200
     C           @STM      LOKUPTABNST                   23               CSW200
      *                                                                   CSW200
     C           *IN23     IFEQ '1'                                       CSW200
     C           MGINSA    ANDNE*BLANKS                                   CSW200
      *                                                                   CSW200
     C           MGINOS    IFNE *BLANKS                                   CSW200
      *                                                                   CSW200
     C           CEU003    IFEQ 'Y'                                       CSW200
     C           MGISCY    ANDNE*BLANKS                                   CSW200
     C                     MOVE MGISCY    @CYCD                           CSW200
     C                     ELSE                                           CSW200
     C                     MOVE MGCCY     @CYCD                           CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     MOVELMGINSA    @NONB                           CSW200
     C******               CALL 'AONOSTR0'                                             CSW200 CDL094
     C                     CALL 'AONOSTR1'                                                    CDL094
     C                     PARM '*MSG   ' @RTCD   7                       CSW200
     C                     PARM '*KEY   ' @OPTN   7                       CSW200
     C                     PARM *BLANKS   @CUST   6        I:Customer No  CSW200
     C                     PARM           @CYCD   3        I:Currency     CSW200
     C**********           PARM *BLANKS   @ACCD   4        I:A/c Code                  CSW200 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2        I:A/c Seq      CSW200
     C                     PARM           @NONB   2        I:Nostro No    CSW200
     C                     PARM *BLANKS   @BRCD   3        I:Branch Code  CSW200
     C                     PARM *BLANKS   @CSSN  10        I:Cust ShortN  CSW200
     C                     PARM *BLANK    @PNOI   1        I:Prime Nost InCSW200
     C***********SDNOST    PARM SDNOST    DSFDY                                        CSW200 CDL094
     C           SDNOST    PARM SDNOST    DSSDY                                               CDL094
      *                                                                   CSW200
      **  If our receive nostro is not found.                             CSW200
      *                                                                   CSW200
     C           @RTCD     IFNE *BLANKS                                   CSW200
     C                     MOVE 'Y'       @ERR                            CSW200
     C                     MOVELMGINSA    HLD2    2                       CSW200
     C                     MOVEL@CYCD     HLD5                            CSW200
     C                     MOVE HLD2      HLD5    5                       CSW200
     C                     MOVELHLD5      MFLD                            CSW200
     C                     MOVELMSGA,3    MERR                            CSW200
     C                     MOVE ':53 :'   MTAG                            CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      ** Branch Internal Customer cf. Customer number of Our Pay Nostro   CSW200
      *                                                                   CSW200
     C                     MOVELSECN      @SECN   6                       CSW200
     C           @SECN     IFNE A7CUST                                    CSW200
     C           MGINOS    ANDNEA7CUST                                    CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELA7CUST    ZDEST                           CSW200
      *                                                                   CSW200
     C*********************CALL 'ZM0050'                            CSW200CSW036
     C                     CALL 'ZM0051'                                  CSW036
     C                     PARM           ZDEST  12                       CSW200
     C                     PARM           ZSADD1 35                       CSW200
     C                     PARM           ZSADD2 35                       CSW200
     C                     PARM           ZSADD3 35                       CSW200
     C                     PARM           ZSADD4 35                       CSW200
     C                     PARM           ZSTAG   1                       CSW200
     C                     PARM           ZSTYPE  1                       CSW200
     C                     PARM           ZERR    1                       CSW200
     C                     PARM           ZDBEI                                               CSW201
      *                                                                   CSW200
      **  Error when formating address                                    CSW200
      *                                                                   CSW200
     C           ZERR      IFEQ '1'                                       CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE 'Y'       @ERR                            CSW200
     C                     MOVE ':53 :'   MTAG                            CSW200
     C                     MOVELZDEST     MFLD                            CSW200
     C                     MOVELMSGA,6    MERR                            CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      **  A Type address                                                  CSW200
      *                                                                   CSW200
     C           ZSTAG     IFEQ 'A'                                       CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE 'A'       TAG                             CSW200
     C                     MOVE '53'      FLDNO                           CSW200
     C                     MOVE @MTAG     MTAG                            CSW200
     C                     MOVELZSADD1    MFLD                            CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      **  B Type address                                                  CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C                     MOVE ':53D:'   MTAG                            CSW200
     C                     MOVELZSADD1    MFLD                            CSW200
      **  Address 2                                                       CSW200
     C           ZSADD2    IFNE *BLANKS                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVELZSADD2    MFLD                            CSW200
      **  Address 3                                                       CSW200
     C           ZSADD3    IFNE *BLANKS                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVELZSADD3    MFLD                            CSW200
      **  Address 4                                                       CSW200
     C           ZSADD4    IFNE *BLANKS                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVELZSADD4    MFLD                            CSW200
     C                     END                             D address 4    CSW200
     C                     END                             D address 3    CSW200
     C                     END                             D address 2    CSW200
      *                                                                   CSW200
     C                     END                             A/B/D address? CSW200
     C                     END                             ZERR ?      s? CSW200
     C                     END                             Brch Int Cust. CSW200
     C                     END                             Nostro err.?s? CSW200
     C                     END                             MGINOS ?    s? CSW200
     C                     END                             Settlement  s? CSW200
      *                                                                   CSW200
     C                     MOVE 'N'       FLD57O                          CSW200
     C           MGINOS    IFNE *BLANKS                                   CSW200
      *                                                                   CSW200
      **  Format Account with institution. (Field 57.)                    CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELMGINOS    ZDEST                           CSW200
     C                     MOVE *BLANKS   ACLINE                          CSW200
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '57'      FLDNO                           CSW200
     C                     EXSR FSWAD                                     CSW200
     C                     MOVE 'Y'       FLD57O  1                       CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      **  Field 57 = pay nostro customer if settlement via '02' or '12'   CSW200
     C           MGIMET    IFEQ '02'                                      CSW200
     C           MGIMET    OREQ '12'                                      CSW200
     C                     MOVELMGINSA    @NONB                           CSW200
      *                                                                   CSW200
      ** Use settlement currency to access nostro if not blank.           CSW200
      ** Otherwise use deal currency.                                     CSW200
     C           CEU003    IFEQ 'Y'                                       CSW200
     C           MGISCY    ANDNE*BLANKS                                   CSW200
     C                     MOVE MGISCY    @CYCD                           CSW200
     C                     ELSE                                           CSW200
     C                     MOVE MGCCY     @CYCD                           CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C******               CALL 'AONOSTR0'                                             CSW200 CDL094
     C                     CALL 'AONOSTR1'                                                    CDL094
     C                     PARM '*MSG   ' @RTCD   7                       CSW200
     C                     PARM '*KEY   ' @OPTN   7                       CSW200
     C                     PARM *BLANKS   @CUST   6                       CSW200
     C                     PARM           @CYCD   3                       CSW200
     C**********           PARM *BLANKS   @ACCD   4                                    CSW200 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2                       CSW200
     C                     PARM           @NONB   2                       CSW200
     C                     PARM *BLANKS   @BRCD   3                       CSW200
     C                     PARM *BLANKS   @CSSN  10                       CSW200
     C                     PARM *BLANKS   @PNOI   1                       CSW200
     C***********SDNOST    PARM SDNOST    DSFDY                                        CSW200 CDL094
     C           SDNOST    PARM SDNOST    DSSDY                                               CDL094
      *                                                                   CSW200
      **  Nostro customer not found                                       CSW200
      *                                                                   CSW200
     C           @RTCD     IFNE *BLANKS                                   CSW200
     C                     MOVE 'Y'       @ERR                            CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVEL@NONB     HLD2    2                       CSW200
     C                     MOVEL@CYCD     HLD5                            CSW200
     C                     MOVE HLD2      HLD5    5                       CSW200
     C                     MOVELHLD5      MFLD                            CSW200
     C                     MOVELMSGA,3    MERR                            CSW200
     C                     MOVE ':57 :'   MTAG                            CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      **  Format our Pay Nostro Customer Address                          CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELA7CUST    ZDEST                           CSW200
     C                     MOVEL*BLANKS   ACLINE                          CSW200
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '57'      FLDNO                           CSW200
     C                     EXSR FSWAD                                     CSW200
     C                     MOVE 'Y'       FLD57O                          CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
     C           MGIMET    IFNE '00'                                      CSW200
     C                     MOVE MGIMET    @STM                            CSW200
     C           @STM      LOKUPTABINT                   23               CSW200
     C*                                                                   CSW200
     C           *IN23     IFEQ '1'                                       CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELSECN      ZDEST                           CSW200
     C                     MOVEL*BLANKS   ACLINE                          CSW200
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '57'      FLDNO                           CSW200
     C                     EXSR FSWAD                                     CSW200
     C                     MOVE 'Y'       FLD57O                          CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      **  Field 53 is equal to Our Pay Nostro                             CSW200
     C                     MOVELMGINSA    @NSKYE                          CSW200
      *                                                                   CSW200
      ** Use settlement currency to access nostro if not blank.           CSW200
      ** Otherwise use deal currency.                                     CSW200
     C           CEU003    IFEQ 'Y'                                       CSW200
     C           MGSTCY    ANDNE*BLANKS                                   CSW200
     C                     MOVE MGSTCY    @NSKYB                          CSW200
     C                     ELSE                                           CSW200
     C                     MOVE MGCCY     @NSKYB                          CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C******               CALL 'AONOSTR0'                                             CSW200 CDL094
     C                     CALL 'AONOSTR1'                                                    CDL094
     C                     PARM '*MSG   ' @RTCD   7                       CSW200
     C                     PARM '*KEY   ' @OPTN   7                       CSW200
     C                     PARM *BLANKS   @NSKYA  6                       CSW200
     C                     PARM           @NSKYB  3                       CSW200
     C**********           PARM *BLANKS   @NSKYC  4                                    CSW200 CGL029
     C                     PARM *BLANKS   @NSKYC 10                                           CGL029
     C                     PARM *BLANKS   @NSKYD  2                       CSW200
     C                     PARM           @NSKYE  2                       CSW200
     C                     PARM *BLANKS   @KEYF   3                       CSW200
     C                     PARM *BLANKS   @KEYG  10                       CSW200
     C                     PARM *BLANKS   @KEYH   1                       CSW200
     C***********SDNOST    PARM SDNOST    DSFDY                                        CSW200 CDL094
     C           SDNOST    PARM SDNOST    DSSDY                                               CDL094
     C*                                                                   CSW200
     C**  Nostro customer not found                                       CSW200
     C           @RTCD     IFNE *BLANKS                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE 'Y'       @ERR                            CSW200
     C                     MOVE ':53 :'   MTAG                            CSW200
     C                     MOVELMGINSA    MFLD                            CSW200
     C                     MOVELMSGA,3    MERR                            CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      **  Format our Pay Nostro Customer Address                          CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELA7CUST    ZDEST                           CSW200
     C                     MOVEL*BLANKS   ACLINE                          CSW200
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '53'      FLDNO                           CSW200
     C                     EXSR FSWAD                                     CSW200
     C                     END                                            CSW200
     C                     END                                            CSW200
     C                     END                                            CSW200
     C                     END                                            CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
      **  Settlement 01,07 or 08 with MGAWBN blank or settlement 00       CSW200
      *                                                                   CSW200
     C           FLD57O    IFEQ 'N'                                       CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE ':57D:'   MTAG                            CSW200
     C                     MOVEL'UNKNOWN' MFLD                            CSW200
      *                                                                   CSW200
      *                                                                   CSW200
     C                     ENDIF                                          CSW200
     C                     ENDIF                                          CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      *                                                                   CSW200
     C                     ENDSR                                          CSW200
     C/EJECT                                                              CSW200
      *****************************************************************   CSW200
      *   DAT200 - Format Dates fields - Sequence B                   *   CSW200
      *            This subroutine is similar to DATES with the       *   CSW200
      *            following changes.                                 *   CSW200
      *            New Fields:                                        *   CSW200
      *             - :15B: Beginning of sequence B                   *   CSW200
      *             - :17R: Party A's role                            *   CSW200
      *             - :30T: similar to the old field 30               *   CSW200
      *             - :30V: date part of old 32 or 33 if a rollover   *   CSW200
      *             - :30P: similar to the old field 31C              *   CSW200
      *             - :32B: contains the amount part of the old 32    *   CSW200
      *             - :32H: contains the amount part of the old 33    *   CSW200
      *             - :30X: contains the date part of the old 34      *   CSW200
      *             - :34E: contains the amount part of the old 34    *   CSW200
      *             - :37G: contains the rate part of the old 37      *   CSW200
      *             - :14D: contains Day Count Faction(opt. letter 37)*   CSW200
      *             - :30F: contains the date part of the old 37      *   CSW200
      *             - :38J: Number of days te part of the old 37      *   CSW200
      *                                                               *   CSW200
      *   Called by - main process                                    *   CSW200
      *   Calls     -                                                 *   CSW200
      *****************************************************************   CSW200
      *                                                                   CSW200
     C           DAT200    BEGSR                                          CSW200
      *                                                                   CSW200
      **  FIELD :15B: New Sequence                                        CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE *BLANKS   MFLD                            CSW200
     C                     MOVE ':15B:'   MTAG                            CSW200
      *                                                                   CSW200
      **  FIELD :17R: Party's A role                                      CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE *BLANKS   MFLD                            CSW200
     C           MGLORD    IFEQ 'L'                                       CSW200
     C                     MOVEL'L'       MFLD                            CSW200
     C                     ELSE                                           CSW200
     C                     MOVEL'B'       MFLD                            CSW200
     C                     ENDIF                                          CSW200
     C                     MOVE ':17R:'   MTAG                            CSW200
      *                                                                   CSW200
      **  FIELD :30T:  Trade Date                                         CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE MGTDAT    ZMDAY                           CSW200
      *                                                                   CSW200
     C           MGAMTP    IFEQ 'SC'                                      CSW200
     C                     MOVE BJRDNB    ZMDAY                           CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      **  Convert Midas date to SWIFT date format                         CSW200
      *                                                                   CSW200
     C                     CALL 'ZM0065'               15                 CSW200
     C                     PARM           ZMDAY   50                      CSW200
     C                     PARM           ZSDATE  6                       CSW200
     C                     PARM           ZSDATC  8                       CSW200
      *                                                                   CSW200
      **  Call ended in error. (Program not found.)                       CSW200
      *                                                                   CSW200
     C           *IN15     IFEQ '1'                                       CSW200
     C           *LOCK     IN   LDA                                       CSW200
     C                     MOVE '032'     DBASE              * * * * * * *CSW200
     C                     MOVELZMDAY     DBKEY              * DBERR 032 *CSW200
     C                     MOVEL'ZM0065'  DBFILE             * * * * * * *CSW200
     C                     OUT  LDA                                       CSW200
     C                     EXSR *PSSR                                     CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
     C                     MOVE ':30T:'   MTAG                            CSW200
     C                     MOVELZSDATC    MFLD                            CSW200
      *                                                                   CSW200
      **  FIELD :30V:  Value Date                                         CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE MGVDAT    ZMDAY                           CSW200
      *                                                                   CSW200
      **  Convert Midas date to SWIFT date format                         CSW200
      *                                                                   CSW200
     C                     CALL 'ZM0065'               15                 CSW200
     C                     PARM           ZMDAY   50                      CSW200
     C                     PARM           ZSDATE  6                       CSW200
     C                     PARM           ZSDATC  8                       CSW200
      *                                                                   CSW200
     C                     MOVE ':30V:'   MTAG                            CSW200
     C                     MOVELZSDATC    MFLD                            CSW200
      *                                                                   CSW200
      **  FIELD :38A:  Period of notice                                   CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C           MGNOTD    IFEQ -999                                      CSW200
     C                     Z-ADD0         MGNOTD                          CSW200
     C                     ENDIF                                          CSW200
     C                     MOVE ':38A:'   MTAG                            CSW200
      *                                                                   CSW200
     C                     MOVELMGNOTD    MFLD                            CSW200
      *                                                                   CSW200
      **  FIELD :32B: Balance                                             CSW200
      *                                                                   CSW200
      * Produce only if field :22B: is not equal to "SETT"                CSW200
     C           WKMFLD    IFNE 'SETT'                                    CSW200
     C********** MGIPFR    ANDNE*BLANKS                            184810 190256
     C********** MGNIDT    ORNE *ZERO                              184810 190256
     C********** MGMDAT    ANDNE*ZERO                              184810 190256
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C                     MOVE MGCCY     ZCCY                            CSW200
      *                                                                   CSW200
     C           CWRD      IFEQ 'NEW   '                                  CSW200
     C                     Z-ADDMGPCPL    ZAMNT                           CSW200
     C                     ELSE                                           CSW200
     C                     Z-ADDMGNAMT    ZAMNT                           CSW200
     C                     ENDIF                                          CSW200
     C/COPY WNCPYSRC,MG0330C042
      *                                                                   CSW200
      **  Format currency code and balance                                CSW200
      *                                                                   CSW200
     C                     CALL 'ZM0040'                                  CSW200
     C                     PARM           ZAMNT  130                      CSW200
     C                     PARM           ZCCY    3                       CSW200
     C                     PARM           ZSAMNT 15                       CSW200
     C                     PARM           ZSCCY   3                       CSW200
     C                     PARM           ZERR    1                       CSW200
     C                     PARM           ZSWDPC  1                                           222373
      *                                                                   CSW200
     C                     MOVE ':32B:'   MTAG                            CSW200
      *                                                                   CSW200
     C           ZSCCY     CAT  ZSAMNT:0  MFLD                            CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      ** FIELD :32H: Amount to be settled                                 CSW200
      *                                                                   CSW200
      *                                                                   CSW200
      **  Format currency code and contract amount.                       CSW200
      *                                                                   CSW200
     C                     MOVE MGCCY     ZCCY                            CSW200
     C                     MOVE MGPCPL    ZAMNT                           CSW200
     C           MGAMTP    IFEQ 'SC'                                      CSW200
     C                     Z-ADD0         ZAMNT                           CSW200
     C                     ENDIF                                          CSW200
     C                     CALL 'ZM0040'                                  CSW200
     C                     PARM           ZAMNT  130                      CSW200
     C                     PARM           ZCCY    3                       CSW200
     C                     PARM           ZSAMNT 15                       CSW200
     C                     PARM           ZSCCY   3                       CSW200
     C                     PARM           ZERR    1                       CSW200
     C                     PARM           ZSWDPC                                              222373
      *                                                                   CSW200
      *                                                                   CSW200
      * Produce only if field :22B: is not equal to "CONF"                CSW200
     C           WKMFLD    IFNE 'CONF'                                    CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C                     MOVE ':32H:'   MTAG                            CSW200
     C           ZSCCY     CAT  ZSAMNT:0  MFLD                            CSW200
      *                                                                   CSW200
     C           MGLORD    IFEQ 'L'                                       CSW200
     C           WKMFLD    IFEQ 'SETT'                                    CSW200
     C***********ZSAMNT    ANDNE*ZERO                               CSW200184808
     C           ZAMNT     ANDNE*ZERO                                     184808
     C           'N'       CAT  MFLD      MFLD                            CSW200
     C                     ELSE                                           186631
     C           MGAMTP    IFEQ 'PD'                                      186631
     C           MGAMTP    OREQ 'RE'                                      186631
     C           'N'       CAT  MFLD      MFLD                            186631
     C                     ENDIF                                          186631
     C                     ENDIF                                          CSW200
     C                     ELSE                                           186631
     C           MGAMTP    IFEQ 'PI'                                      186631
     C           'N'       CAT  MFLD      MFLD                            186631
     C                     ENDIF                                          186631
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     END                                            CSW200
     C*                                                                   CSW200
      *                                                                   CSW200
      ** FIELD :30X: - Next Interest Due Date.                            CSW200
      *        :34E: - Interest Amount                                    CSW200
      *                                                                   CSW200
      **Produce*only*if*field*:22B:*is*not*equal*to*"CONF"                CSW200            BUG11192
     C********** WKMFLD    IFNE 'CONF'                                    CSW200            BUG11192
      * Produce only if field :22B: is equal to 'SETT'                                      BUG11192
     C           WKMFLD    IFEQ 'SETT'                                                      BUG11192
     C********** MGNIDT    ANDNE0                                   186783193121
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C***********          MOVE MGVDAT    ZMDAY                     CSW200186783
     C**********           MOVE MGNIDT    ZMDAY                     186783193121
     C           MGNIDT    IFNE 0                                                             210978
     C           MGMDAT    ANDEQ0                                                             210978
     C                     MOVE MGNIDT    ZMDAY                                               210978
     C                     ELSE                                                               210978
     C                     MOVE MGVDAT    ZMDAY                           193121
     C                     ENDIF                                                              210978
      *                                                                   CSW200
     C                     CALL 'ZM0065'               15                 CSW200
     C                     PARM           ZMDAY   50                      CSW200
     C                     PARM           ZSDATE  6                       CSW200
     C                     PARM           ZSDATC  8                       CSW200
      *                                                                   CSW200
     C                     MOVEL':30X:'   MTAG                            CSW200
     C                     MOVELZSDATC    MFLD                            CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C                     MOVE MGCCY     ZCCY                            CSW200
     C**********           MOVE MGTNUM    W0TNUM  60                                   CSW200 195647
     C                     MOVELMGTNUM    W0TNUM  60                                          195647
     C           W0TNUM    CHAINDEALSC               11                   CSW200
      *                                                                   CSW200
     C           *IN11     IFEQ *OFF                                      CSW200
     C********** NIDT      ANDEQ*ZEROS                                               CSW200 BUG11192
     C           MGNIDT    ANDEQ*ZEROS                                                      BUG11192
     C**********           Z-ADDIACD      ZIBEG                                      CSW200 BUG11192
     C                     Z-ADDMGMDAT    ZIEND                           CSW200
     C                     ELSE                                           CSW200
     C**********           Z-ADDMGSLID    ZIBEG                           CSW200     CSW200 BUG11192
     C                     Z-ADDMGNIDT    ZIEND                           CSW200
     C                     ENDIF                                          CSW200
      *                                                                                       210978
      ** If CD or CL, then end date should be the same as the                                 210978
      ** date specified in 30X.                                                               210978
      *                                                                   CSW200
     C                     Z-ADDMGVDAT    ZIEND                                               210978
      *                                                                                     BUG11192
      ** Always use the Interest accrual control date for begin                             BUG11192
     C                     Z-ADDIACD      ZIBEG                                             BUG11192
      *                                                                                       210978
     C                     MOVE MGICBS    ZICALC                          CSW200
      *                                                                                       210978
     C           MGAMTP    IFEQ 'SC'                                                          210978
     C                     Z-ADDINTR      ZIRATE                                              210978
     C                     ELSE                                                               210978
     C                     Z-ADDMGINTR    ZIRATE                          CSW200
     C                     ENDIF                                                              210978
      *                                                                                       210978
     C********** MGNAMT    IFNE 0                                  186783 193121
     C**********           Z-ADDMGNAMT    ZIAMT                    186783 193121
     C**********           ELSE                                    186783 193121
     C                     Z-ADDMGPCPL    ZIAMT                           CSW200
     C**********           END                                     186783 193121
      *                                                                   CSW200
      ** If CD or CL, calculate the principal before the deal                                 210978
      ** amendment.                                                                           210978
      *                                                                                       210978
     C           DTYP      IFEQ 'CD'                                                          210978
     C           DTYP      OREQ 'CL'                                                          210978
      *                                                                                       210978
     C           MGAMTP    IFEQ 'PI'                                                          210978
     C           MGNAMT    SUB  MGPCPL    ZIAMT     H                                         210978
     C                     ENDIF                                                              210978
      *                                                                                       210978
     C           MGAMTP    IFEQ 'PD'                                                          210978
     C           MGNAMT    ADD  MGPCPL    ZIAMT     H                                         210978
     C                     ENDIF                                                              210978
      *                                                                                       210978
     C                     ENDIF                                                              210978
      *                                                                                       210978
      ** Read the deal amendment if exist                                                   BUG11192
     C           W0TNUM    CHAINDEAMSD               12                                     BUG11192
      *                                                                                     BUG11192
     C           *IN12     DOWEQ*OFF                                                        BUG11192
      *                                                                                     BUG11192
      ** Process only valid records from Deal amendment file with Value                     BUG11192
      ** date and Seq. less or equal to the processed record from MGF330PD                  BUG11192
     C           ARECI     IFEQ 'D'                                                         BUG11192
      *                                                                                     BUG11192
     C           AVDAT     IFGT MGAVDT                                                      BUG11192
     C           AVDAT     OREQ MGAVDT                                                      BUG11192
     C           ADASN     ANDGTMGASEQ                                                      BUG11192
     C                     SETON                         12                                 BUG11192
     C                     ENDIF                                                            BUG11192
      *                                                                                     BUG11192
     C                     LEAVE                                                            BUG11192
     C                     ENDIF                                                            BUG11192
      *                                                                                     BUG11192
     C           W0TNUM    READEDEAMSD                   12                                 BUG11192
     C                     ENDDO                                                            BUG11192
      *                                                                                     BUG11192
     C           *IN12     IFEQ '0'                                                         BUG11192
     C                     Z-ADDAVDAT     WVDAT   50                                        BUG11192
     C                     Z-ADDAVDAT     ZIEND                                             BUG11192
      *                                                                                     BUG11192
      ** If deal has already maturity date take the amount from the file                    BUG11192
      ** DEALSDC, because in MGF330PD is already amended amount. This                       BUG11192
      ** has to be done for a back value amendments for a closed A/C .                      BUG11192
     C           MDAT      IFNE 0                                                           BUG11192
     C                     Z-ADDPCPL      ZIAMT                                             BUG11192
     C                     ENDIF                                                            BUG11192
      *                                                                                     BUG11192
     C                     ENDIF                                                            BUG11192
      *                                                                                     BUG11192
      ** Calculate int. If deal amendment exist, calculate the interest                     BUG11192
      ** from IACD till 1st amendment.                                                      BUG11192
     C                     EXSR GLINTC                                    CSW200
      *                                                                   CSW200
     C                     Z-ADDZINTR     ZAMNT     H                     CSW200
     C           ZINTR     IFLT *ZERO                                     CSW200
     C                     Z-SUBZINTR     ZAMNT     H                     CSW200
     C                     ENDIF                                          CSW200
      *                                                                                     BUG11192
      ** a deal amendment exists, then calculation:                                         BUG11192
      ** All int. amount = int. amount ZAMNT (calculated above till 1st                     BUG11192
      ** deal amend. date (date1)) + int. amount between (date1 and                         BUG11192
      ** date2) + ... + (dateN and MGNIDT) (the last calucaltion is done                    BUG11192
      ** only if dateN <> MGNIDT )                                                          BUG11192
      *                                                                                     BUG11192
B01  C           *IN12     DOWEQ*OFF                                                        BUG11192
      *                                                                                     BUG11192
     C                     SELEC                                                            BUG11192
     C           AMTP      WHEQ 'SC'                                                        BUG11192
     C                     Z-ADDARTSP     ZIRATE                                            BUG11192
     C           AMTP      WHEQ 'PD'                                                        BUG11192
     C                     SUB  DAAM      ZIAMT                                             BUG11192
     C           AMTP      WHEQ 'PI'                                                        BUG11192
     C                     ADD  DAAM      ZIAMT                                             BUG11192
     C                     ENDSL                                                            BUG11192
      *                                                                                     BUG11192
     C                     Z-ADDAVDAT     ZIBEG                                             BUG11192
     C                     Z-ADDAVDAT     WVDAT                                             BUG11192
      *                                                                                     BUG11192
      ** To be correctly calculated interest amount for all deal amendm.                    BUG11192
      ** check, if some other exist. in Deal amendment file.                                BUG11192
     C           W0TNUM    READEDEAMSD                   12                                 BUG11192
      *                                                                                     BUG11192
     C           *IN12     DOWEQ*OFF                                                        BUG11192
      *                                                                                     BUG11192
      ** Process only valid records from Deal amendment file with Value                     BUG11192
      ** date and Seq. less or equal to the processed record from MGF330PD                  BUG11192
B02  C           ARECI     IFEQ 'D'                                                         BUG11192
      *                                                                                     BUG11192
B03  C           AVDAT     IFGT MGAVDT                                                      BUG11192
     C           AVDAT     OREQ MGAVDT                                                      BUG11192
     C           ADASN     ANDGTMGASEQ                                                      BUG11192
     C                     SETON                         12                                 BUG11192
E03  C                     ENDIF                                                            BUG11192
      *                                                                                     BUG11192
     C                     LEAVE                                                            BUG11192
E02  C                     ENDIF                                                            BUG11192
      *                                                                                     BUG11192
     C           W0TNUM    READEDEAMSD                   12                                 BUG11192
     C                     ENDDO                                                            BUG11192
      *                                                                                     BUG11192
     C   12      MGNIDT    IFEQ *ZEROS                                                      BUG11192
     C                     Z-ADDMGMDAT    ZIEND                                             BUG11192
     C                     ELSE                                                             BUG11192
     C                     Z-ADDMGNIDT    ZIEND                                             BUG11192
     C                     ENDIF                                                            BUG11192
      *                                                                                     BUG11192
     C  N12                Z-ADDAVDAT     ZIEND                                             BUG11192
      * CANNOT HAVE AN OPEN END DATE                                                        BUG11192
     C           ZIEND     IFEQ *ZEROS                                                      BUG11192
     C                     Z-ADDMGVDAT    ZIEND                                             BUG11192
     C                     ENDIF                                                            BUG11192
      *                                                                                     BUG11192
      ** If the value date is changed, calculate interest for appropiate                    BUG11192
      ** period                                                                             BUG11192
     C           AVDAT     IFNE WVDAT                                                       BUG11192
     C           *IN12     OREQ *ON                                                         BUG11192
     C           ZIBEG     ANDNEZIEND                                                       BUG11192
      *                                                                                     BUG11192
      ** Calculate the interest from Interest accrual control dt to the                     BUG11192
      ** next amendment date (for exam.no.1) than from the amend. dt no.1                   BUG11192
      ** to the next amend. dt (for exam.no.2), than ...                                    BUG11192
     C                     EXSR GLINTC                                                      BUG11192
      *                                                                                     BUG11192
     C           ZINTR     IFLT *ZERO                                                       BUG11192
     C                     SUB  ZINTR     ZAMNT     H                                       BUG11192
     C                     ELSE                                                             BUG11192
     C                     ADD  ZINTR     ZAMNT     H                                       BUG11192
     C                     ENDIF                                                            BUG11192
      *                                                                                     BUG11192
     C                     ENDIF                                                            BUG11192
      *                                                                                     BUG11192
     C                     ENDDO                                                            BUG11192
      *                                                                                       195647
     C*********  MGTTYP    IFEQ 'CD'                                                   195647 210978
     C*********  MGTTYP    OREQ 'CL'                                                   195647 210978
     C*********  MGMDAT    IFNE 0                                                      195647 210978
     C*********            Z-ADD0         INTINT                                       195647 210978
     C*********  MGAITC    SUB  MGIPRD    INTINT                                       195647 210978
     C*********  INTINT    SUB  MGICTD    INTINT                                       195647 210978
     C*********  MGAIAN    ADD  MGAIAP    INT2                                         195647 210978
     C*********  INT2      ADD  INTINT    INTINT                                       195647 210978
     C*********  ZAMNT     ADD  INTINT    ZAMNT                                        195647 210978
     C*********            ENDIF                                                       195647 210978
     C*********            ENDIF                                                       195647 210978
      *                                                                                       195647
      ** Calculate the interest amount correctly.                                             210978
      *                                                                                       210978
     C           ZAMNT     ADD  AITC      ZAMNT                                               210978
     C           ZAMNT     ADD  AIAN      ZAMNT                                               210978
     C           ZAMNT     ADD  AIAP      ZAMNT                                               210978
     C           ZAMNT     SUB  IPRD      ZAMNT                                               210978
     C           ZAMNT     SUB  ICTD      ZAMNT                                               210978
      *                                                                                       210978
      ** If the next interest payment date is specified and deal                              210978
      ** amendments particularly PI, PD and SC are inserted,                                  210978
      ** recalculate interest from amendment value date to next                               210978
      ** interest payment date.  Same calculation happens on DL0195.                          210978
      *                                                                                       210978
     C           MGNIDT    IFNE 0                                                             210978
      *                                                                                       210978
     C           MGAMTP    IFEQ 'PD'                                                          210978
     C           MGAMTP    OREQ 'PI'                                                          210978
     C           MGAMTP    OREQ 'SC'                                                          210978
      *                                                                                       210978
     C                     Z-ADDMGAVDT    ZIBEG                                               210978
     C                     Z-ADDMGNIDT    ZIEND                                               210978
      *                                                                                       210978
     C           MGNAMT    IFNE 0                                                             210978
     C                     Z-ADDMGNAMT    ZIAMT                                               210978
     C                     ENDIF                                                              210978
      *                                                                                       210978
     C           MGAMTP    IFEQ 'SC'                                                          210978
     C                     Z-ADDMGINTR    ZIRATE                                              210978
     C                     ENDIF                                                              210978
      *                                                                                       210978
     C                     EXSR GLINTC                                                        210978
     C           ZINTR     ADD  ZAMNT     ZAMNT     H                                         210978
     C                     ENDIF                                                              210978
      *                                                                                       210978
     C                     ENDIF                                                              210978
      *                                                                                       210978
     C                     CALL 'ZM0040'                                  CSW200
     C                     PARM           ZAMNT  130                      CSW200
     C                     PARM           ZCCY    3                       CSW200
     C                     PARM           ZSAMNT 15                       CSW200
     C                     PARM           ZSCCY   3                       CSW200
     C                     PARM           ZERR    1                       CSW200
     C                     PARM           ZSWDPC                                              222373
      *                                                                   CSW200
     C                     MOVEL':34E:'   MTAG                            CSW200
     C           ZSCCY     CAT  ZSAMNT    MFLD                            CSW200
     C***********ZINTR     IFLT *ZERO                               186338186631
     C***********          MOVEL'N'       WRK51  51                 186338186631
     C***********          MOVE MFLD      WRK51                     186338186631
     C***********          MOVELWRK51     MFLD                      186338186631
     C***********          ENDIF                                    186338186631
     C           MGLORD    IFEQ 'L'                                       186631
     C           ZINTR     ANDGT0                                         186631
     C           MGLORD    OREQ 'D'                                       186631
     C           ZINTR     ANDLT0                                         186631
     C           'N'       CAT  MFLD      MFLD                            186631
     C                     ENDIF                                          186631
      *                                                                   CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      *                                                                   CSW200
      ** FIELD :37G: - Interest Rate.                                     CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C           MGINTR    IFLT *ZERO                                     CSW200
     C                     Z-SUBMGINTR    ZINRT                           CSW200
     C                     ELSE                                           CSW200
     C                     Z-ADDMGINTR    ZINRT                           CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     CALL 'ZM0010'               15                 CSW200
     C                     PARM           ZINRT  117                      CSW200
     C                     PARM           ZSINRT 12                       CSW200
      *                                                                   CSW200
      **  Call ended in error. (Program not found.)                       CSW200
      *                                                                   CSW200
     C           *IN15     IFEQ '1'                                       CSW200
     C           *LOCK     IN   LDA                                       CSW200
     C                     MOVE '033'     DBASE              * * * * * * *CSW200
     C                     MOVELZINRT     DBKEY              * DBERR 033 *CSW200
     C                     MOVEL'ZM0010'  DBFILE             * * * * * * *CSW200
     C                     OUT  LDA                                       CSW200
     C                     EXSR *PSSR                                     CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
     C                     MOVEL':37G:'   MTAG                            CSW200
     C                     MOVELZSINRT    MFLD                            CSW200
     C           MGINTR    IFLT *ZERO                                     CSW200
     C           'N'       CAT  MFLD      MFLD                            CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      ** FIELD :14D: - Day Count Fraction                                 CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVEL':14D:'   MTAG                            CSW200
      *                                                                   CSW200
     C                     SELEC                                          CSW200
      *                                                                   CSW200
     C           MGICBS    WHEQ 1                                         CSW200
     C                     MOVEL'AFI/365' MFLD                            CSW200
      *                                                                   CSW200
     C           MGICBS    WHEQ 2                                         CSW200
     C           MGICBS    OREQ 5                                         CSW200
     C                     MOVEL'ACT/360' MFLD                            CSW200
      *                                                                   CSW200
     C           MGICBS    WHEQ 3                                         CSW200
     C                     MOVEL'360/360' MFLD                            CSW200
      *                                                                   CSW200
     C           MGICBS    WHEQ 4                                         CSW200
     C           MGICBS    OREQ 6                                         CSW200
     C                     MOVEL'ACT/365' MFLD                            CSW200
      *                                                                   CSW200
     C                     ENDSL                                          CSW200
      *                                                                   CSW200
      *                                                                   CSW200
      ** FIELD :30F: - Last day of the first interest period              CSW200
      **       :38J: - Number of days                                     CSW200
      *                                                                   CSW200
      * Produce only if field :22B: is not equal to "SETT" and next       CSW200
      * interest is not null.                                             CSW200
     C           WKMFLD    IFNE 'SETT'                                    CSW200
     C           MGNIDT    IFNE *ZERO                                     CSW200
     C           MGIPFR    ANDNE*BLANKS                                   190256
     C           MGNIDT    ORNE *ZERO                                     190256
     C           MGMDAT    ANDNE*ZERO                                     190256
      * :30F:                                                             CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     Z-ADDMGNIDT    ZMDAY                           CSW200
      *                                                                   CSW200
      **  Convert Midas date to SWIFT date format                         CSW200
      *                                                                   CSW200
     C                     CALL 'ZM0065'               15                 CSW200
     C                     PARM           ZMDAY   50                      CSW200
     C                     PARM           ZSDATE  6                       CSW200
     C                     PARM           ZSDATC  8                       CSW200
      *                                                                   CSW200
     C                     MOVEL':30F:'   MTAG                            CSW200
     C                     MOVELZSDATC    MFLD                            CSW200
      *                                                                   CSW200
      * :38J:                                                             CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVEL':38J:'   MTAG                            CSW200
      *                                                                   CSW200
     C                     SELEC                                          CSW200
      *                                                                   CSW200
     C           MGIPFR    WHEQ 'M'                                       CSW200
     C           MGIPFR    OREQ 'N'                                       CSW200
     C                     MOVEL'M001'    MFLD                            CSW200
      *                                                                   CSW200
     C           MGIPFR    WHEQ 'Q'                                       CSW200
     C                     MOVEL'M003'    MFLD                            CSW200
      *                                                                   CSW200
     C           MGIPFR    WHEQ 'X'                                       CSW200
     C                     MOVEL'M006'    MFLD                            CSW200
      *                                                                   CSW200
     C           MGIPFR    WHEQ 'Y'                                       CSW200
     C                     MOVEL'M012'    MFLD                            CSW200
      *                                                                   CSW200
     C           MGIPFR    WHEQ *BLANK                                    CSW200
     C           MGIPFR    OREQ 'W'                                                         MD032057
     C                     Z-ADDMGNIDT    ZZBEG   50                      CSW200
     C                     Z-ADDMGMDAT    ZZEND   50                      CSW200
     C           MGMDAT    IFEQ 0                                                           MD032057
     C           MGNIDT    ANDNE0                                                           MD032057
     C                     Z-ADDMGVDAT    ZZBEG                                             MD032057
     C                     Z-ADDMGNIDT    ZZEND                                             MD032057
     C                     ENDIF                                                            MD032057
     C                     MOVE MGICBS    ZZCALC  1                       CSW200
     C                     EXSR ZINTDY                                    CSW200
      * Use only the 3 last digits.                                       CSW200
     C                     MOVE ZZINDY    WK3     3                       CSW200
     C           'D'       CAT  WK3       MFLD                            CSW200
      *                                                                   CSW200
     C                     ENDSL                                          CSW200
     C                     ENDIF                                          CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ENDSR                                          CSW200
     C/EJECT                                                              CSW200
      *****************************************************************   CSW200
      *   F53A00  - Format fields 53.                                 *   CSW200
      *            This subroutine is similar to FD53A but format     *   CSW200
      *            option B for field 53 is no longer available       *   CSW200
      *   Called by - FMA200 Format message detail Seq A              *   CSW200
      *   Calls     - FD56A  Format fields 56 and 57.                 *   CSW200
      *             - FSWAD  Format the swift address.                *   CSW200
      *****************************************************************   CSW200
      *                                                                   CSW200
     C           F53A00    BEGSR                                          CSW200
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C                     MOVE 'Y'       ZDBEI                                               CSW201
     C                     ENDIF                                                              CSW201
      *                                                                   CSW200
     C                     MOVE *BLANKS   @WRK                            CSW200
      *                                                                   CSW200
      ** Field 53 - Senders correspondant.                                CSW200
      **  Test if settlement via nostro                                   CSW200
      *                                                                   CSW200
     C                     MOVE MGPSTM    @STM    2                       CSW200
     C           @STM      LOKUPTABNST                   23               CSW200
      *                                                                   CSW200
      ** If our pay nostro is not blank.                                  CSW200
      *                                                                   CSW200
     C           MGPONS    IFNE *BLANKS                                   CSW200
     C           *IN23     ANDEQ'1'                                       CSW200
      *                                                                   CSW200
      **  either A/C with Bank or Receipient entered                      CSW200
      **  or DIRECT entered                                               CSW200
      *                                                                   CSW200
     C           MGAWBN    IFNE *BLANKS                                   CSW200
     C           AWBA6     OREQ 'DIRECT'                                  CSW200
      *                                                                   CSW200
     C                     MOVELMGPONS    @NONB                           CSW200
      *                                                                   CSW200
      ** Use settlement currency to access nostro if not blank.           CSW200
      ** Otherwise use deal currency.                                     CSW200
     C           CEU003    IFEQ 'Y'                                       CSW200
     C           MGSTCY    ANDNE*BLANKS                                   CSW200
     C           CEU004    OREQ 'Y'                                       CSW200
     C           MGSTCY    ANDNE*BLANKS                                   CSW200
     C                     MOVE MGSTCY    @CYCD                           CSW200
     C                     ELSE                                           CSW200
     C                     MOVE MGCCY     @CYCD                           CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C******               CALL 'AONOSTR0'                                             CSW200 CDL094
     C                     CALL 'AONOSTR1'                                                    CDL094
     C                     PARM '*MSG   ' @RTCD   7                       CSW200
     C                     PARM '*KEY   ' @OPTN   7                       CSW200
     C                     PARM *BLANKS   @CUST   6                       CSW200
     C                     PARM           @CYCD   3                       CSW200
     C**********           PARM *BLANKS   @ACCD   4                                    CSW200 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2                       CSW200
     C                     PARM           @NONB   2                       CSW200
     C                     PARM *BLANKS   @BRCD   3                       CSW200
     C                     PARM *BLANKS   @CSSN  10                       CSW200
     C                     PARM *BLANKS   @PNOI   1                       CSW200
     C***********SDNOST    PARM SDNOST    DSFDY                                        CSW200 CDL094
     C           SDNOST    PARM SDNOST    DSSDY                                               CDL094
      *                                                                   CSW200
      **  Nostro customer not found                                       CSW200
      *                                                                   CSW200
     C           @RTCD     IFNE *BLANKS                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE 'Y'       @ERR                            CSW200
     C                     MOVE ':53 :'   MTAG                            CSW200
     C                     MOVELMGPONS    HLD2                            CSW200
     C                     MOVELMGCCY     HLD5                            CSW200
     C                     MOVE HLD2      HLD5                            CSW200
     C                     MOVELHLD5      MFLD                            CSW200
     C                     MOVELMSGA,3    MERR                            CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      ** Branch Internal Customer cf. Customer number of Our Pay Nostro   CSW200
      *                                                                   CSW200
     C                     MOVELSECN      @SECN   6                       CSW200
     C           @SECN     IFNE A7CUST                                    CSW200
     C           MGAWBN    ANDNEA7CUST                                    CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C           MGRVNO    IFEQ *BLANKS                                   CSW200
     C                     MOVELA7CUST    ZDEST                           CSW200
     C                     ELSE                                           CSW200
     C                     MOVELMGRVNO    ZDEST                           CSW200
     C                     ENDIF                                          CSW200
     C*********************CALL 'ZM0050'                            CSW200CSW036
     C                     CALL 'ZM0051'                                  CSW036
     C                     PARM           ZDEST  12                       CSW200
     C                     PARM           ZSADD1 35                       CSW200
     C                     PARM           ZSADD2 35                       CSW200
     C                     PARM           ZSADD3 35                       CSW200
     C                     PARM           ZSADD4 35                       CSW200
     C                     PARM           ZSTAG   1                       CSW200
     C                     PARM           ZSTYPE  1                       CSW200
     C                     PARM           ZERR    1                       CSW200
     C                     PARM           ZDBEI                                               CSW201
      *                                                                   CSW200
      **  Error when formating address                                    CSW200
      *                                                                   CSW200
     C           ZERR      IFEQ '1'                                       CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE 'Y'       @ERR                            CSW200
     C                     MOVE ':53 :'   MTAG                            CSW200
     C                     MOVELZDEST     MFLD                            CSW200
     C                     MOVELMSGA,5    MERR                            CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      **  A Type address                                                  CSW200
      *                                                                   CSW200
     C           ZSTAG     IFEQ 'A'                                       CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE 'A'       TAG                             CSW200
     C                     MOVE '53'      FLDNO                           CSW200
     C                     MOVE @MTAG     MTAG                            CSW200
     C                     MOVELZSADD1    MFLD                            CSW200
     C                     EXSR SEXTN                                     183583
      *                                                                   CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      **  Access SDCUSTPD using our pay nostro customer number            CSW200
      *                                                                   CSW200
     C                     MOVE *BLANKS   @KEY1                           CSW200
     C                     MOVELA7CUST    @KEY1                           CSW200
     C                     CALL 'AOCUSTR0'                                CSW200
     C                     PARM '*MSG   ' @RTCD                           CSW200
     C                     PARM '*KEY   ' @OPTN                           CSW200
     C                     PARM           @KEY1  10                       CSW200
     C                     PARM *BLANKS   @KYST   7                       CSW200
     C           SDCUST    PARM SDCUST    DSSDY                           CSW200
      *                                                                   CSW200
      ** Customer record not found - Error                                CSW200
      *                                                                   CSW200
     C           @RTCD     IFNE *BLANKS                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE 'Y'       @ERR                            CSW200
     C                     MOVE ':53 :'   MTAG                            CSW200
     C                     MOVELA7CUST    MFLD                            CSW200
     C                     MOVE MSGA,2    MERR                            CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      **  B Type address                                                  CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C**********           MOVE BBPCNB    @PCNB   60                                   CSW200 CSD027
     C                     MOVE BBPCNB    @PCNB   6                                           CSD027
     C                     MOVE ':53D:'   MTAG                            CSW200
     C                     MOVELZSADD1    MFLD                            CSW200
      **  Address 2                                                       CSW200
     C           ZSADD2    IFNE *BLANKS                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVELZSADD2    MFLD                            CSW200
      **  Address 3                                                       CSW200
     C           ZSADD3    IFNE *BLANKS                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVELZSADD3    MFLD                            CSW200
      **  Address 4                                                       CSW200
     C           ZSADD4    IFNE *BLANKS                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVELZSADD4    MFLD                            CSW200
     C                     END                             D address 4    CSW200
     C                     END                             D address 3    CSW200
     C                     END                             D address 2    CSW200
      *                                                                   CSW200
     C                     END                             Cust. error?   CSW200
      *                                                                   CSW200
     C                     END                             A/B/D address? CSW200
     C                     END                             Fmt ad. error. CSW200
     C                     END                             Brch Int Cust. CSW200
     C                     END                             Nostro not fnd.CSW200
     C                     END                                            CSW200
     C                     END                             Pay nostro?    CSW200
      *                                                                   CSW200
     C                     MOVE 'N'       FLD57O  1                       CSW200
      *                                                                   CSW200
      ** Execute subroutine FD56A to format fields 56 and 57.             CSW200
      *                                                                   CSW200
     C                     EXSR FD56A                                     CSW200
      *                                                                                       CSW201
     C                     MOVE *BLANKS   ZDBEI                                               CSW201
      *                                                                                     AR733390
      ** If the beneficiary is entered                                                      AR733390
      *                                                                                     AR733390
     C           MGBENN    IFNE *BLANKS                                                     AR733390
     C                     ADD  1         X                                                 AR733390
     C           X         OCUR MULT                                                        AR733390
     C                     MOVE *BLANKS   ZDEST                                             AR733390
     C                     MOVELMGBENN    ZDEST                                             AR733390
     C                     MOVELMGBENA    ACLINE                                            AR733390
     C                     MOVE ' '       TAG                                               AR733390
     C                     MOVEL'58'      FLDNO                                             AR733390
     C                     EXSR FSWAD                                                       AR733390
     C                     ENDIF                                                            AR733390
      *                                                                   CSW200
     C                     ENDSR                                          CSW200
      *****************************************************************   CSW200
      *   FMH200 - Calculate field 72                                 *   CSW200
      *            This subroutine is similar to FLD72 with the       *   CSW200
      *            following changes:                                 *   CSW200
      *             - New field :15H: Beginning of sequence H         *   CSW200
      *             - New field :24D: type of dealing method, by phone*   CSW200
      *               or by electronic system.                        *   CSW200
      *             - :72: will now not include details of broker if  *   CSW200
      *               it is by phone or by electron. brokerage system.*   CSW200
      *   Called by - Main Processing                                 *   CSW200
      *****************************************************************   CSW200
      *                                                                   CSW200
     C           FMH200    BEGSR                                          CSW200
      *                                                                   CSW200
      ** FIELD :15H: - New Sequence                                       CSW200
      *                                                                   CSW200
      ** FIELD :24D: - Dealing method                                     CSW200
      *                                                                   CSW200
     C           MGBRKC    IFNE 'TELX'                                    CSW200
     C           MGBRKC    ANDNE'MAIL'                                    CSW200
     C           MGBRKC    ANDNE'SWAP'                                    CSW200
     C           MGBRKC    ANDNE*BLANKS                                   CSW200
     C*                                                                   CSW200
      **  Output /PHON/                                                   CSW200
     C           MGBRKC    IFEQ 'PHON'                                    CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C                     MOVEL':15H:'   MTAG                            CSW200
     C                     MOVE *BLANKS   MFLD                            CSW200
     C/COPY WNCPYSRC,MG0330C041
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C                     MOVEL':24D:'   MTAG                            CSW200
     C                     MOVEL'PHON'    MFLD                            CSW200
      *                                                                   CSW200
      ** Refers to a broker                                               CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      **  Access the broker file                                          CSW200
      *                                                                   CSW200
     C                     CALL 'AOBROKR0'                                CSW200
     C                     PARM '*MSG   ' @RTCD   7                       CSW200
     C                     PARM '*KEY   ' @OPTN   7                       CSW200
     C                     PARM MGBRKC    @BROKY  4                       CSW200
     C           SDBROK    PARM SDBROK    DSFDY                           CSW200
      *                                                                   CSW200
      ** If the broker code is not found.                                 CSW200
      *                                                                   CSW200
     C           @RTCD     IFNE *BLANKS                                   CSW200
     C                     MOVE 'Y'       @ERR                            CSW200
     C                     MOVELMSGA,4    MERR                            CSW200
     C                     MOVEAMGBRKC    @WRK,1                          CSW200
     C                     MOVE '1'       *IN25                           CSW200
      *                                                                   CSW200
      ** Format the broker field.                                         CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
     C           A9EBS     IFEQ 'Y'                                       CSW200
      *                                                                   CSW200
      ** Electronic brokerage system                                      CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C                     MOVEL':15H:'   MTAG                            CSW200
     C                     MOVE *BLANKS   MFLD                            CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C                     MOVEL':24D:'   MTAG                            CSW200
     C************         MOVEL'ELEC'    MFLD                      CSW200186635
     C           'ELEC/'   CAT  A9BKNM    MFLD                            186635
     C*                                                                   CSW200
     C                     ENDIF                                          CSW200
     C                     ENDIF                                          CSW200
     C                     ENDIF                                          CSW200
     C                     ENDIF                                          CSW200
     C/COPY WNCPYSRC,MG0330C040
      *                                                                                      255986B
      ** Check all six Bank to Bank Info fields and output any which                         255986B
      ** contain data                                                                        255986B
      *                                                                                      255986B
     C           PAPOPB    IFEQ 'Y'                                                          255986B
     C           PAPOPB    OREQ 'P'                                                          255986B
      *                                                                                      255986B
      ** Use the Bank to Bank Info if system value PopBTBConf                                255986B
      ** is not equal to 'N'                                                                 255986B
      *                                                                                      255986B
     C                     CLEAR@BTB                                                         255986B
     C                     MOVELMGBTB1    @BTB,1                                             255986B
     C                     MOVELMGBTB2    @BTB,2                                             255986B
     C                     MOVELMGBTB3    @BTB,3                                             255986B
     C                     MOVELMGBTB4    @BTB,4                                             255986B
     C                     MOVELMGBTB5    @BTB,5                                             255986B
     C                     MOVELMGBTB6    @BTB,6                                             255986B
     C                     MOVE *BLANKS   LINE1   1                                           CDL094
      *                                                                                      255986B
     C           1         DO   6         CT6     10                                         255986B
     C           @BTB,CT6  IFNE *BLANKS                                                      255986B
     C                     ADD  1         X                                                  255986B
     C           X         OCUR MULT                                                         255986B
     C                     MOVE *BLANKS   MTAG                                               255986B
      *                                                                                      255986B
      **  If this is the first line of field 72 then set tag to ':72: '                      255986B
     C******     *IN25     IFNE '1'                                                   255986B CDL094
     C           LINE1     IFEQ ' '                                                           CDL094
     C                     MOVE ':72: '   MTAG                                               255986B
     C******               MOVE '1'       *IN25                                       255986B CDL094
     C                     MOVE 'N'       LINE1                                               CDL094
     C                     ENDIF                                                             255986B
     C                     MOVE *BLANKS   MFLD                                               255986B
     C                     MOVE *BLANKS   MERR                                               255986B
     C                     MOVEL@BTB,CT6  MFLD                                               255986B
     C                     ENDIF                                                             255986B
     C                     ENDDO                                                             255986B
      *                                                                                      255986B
     C                     ENDIF                                                             255986B
      *                                                                   CSW200
     C                     ENDSR                                          CSW200
     C/EJECT                                                              CSW200
      *****************************************************************
      ****ROUT*-*determine*message*routing*****************************   CSW096
      ****Called*by*-*main*process*************************************   CSW096
      ****Calls*-*NWAD*determine*default*network*addresses*************   CSW096
      ************PRAD*determine*priority*network*addresses************   CSW096
      ************FILL*fill*up*GNR*array.******************************   CSW096
      *****************************************************************   CSW096
      ***********                                                         CSW096
     C***********ROUT      BEGSR                                          CSW096
      ***********                                                         CSW096
      ***Access*branch*details*with*Branch*code*of*sender.****************CSW096
      ***********                                                         CSW096
     C***********          CALL 'AOBRCHR0'                                CSW096
     C***********          PARM '*MSG   ' @RTCD                           CSW096
     C***********          PARM '*KEY   ' @OPTN                           CSW096
     C***********          PARM MGBRCA    @BRCD   3                       CSW096
     C***********SDBRCH    PARM SDBRCH    DSSDY                           CSW096
      ***********                                                         CSW096
      ***Branch*record*not*found*-*Error**********************************CSW096
      ***********                                                         CSW096
     C***********@RTCD     IFNE *BLANKS                                   CSW096
     C************LOCK     IN   LDA                                       CSW096
     C***********          MOVE '007'     DBASE              * * * * * * *CSW096
     C***********          MOVELMGBRCA    DBKEY              * DBERR 007 *CSW096
     C***********          MOVEL'SDBRCHPD'DBFILE             * * * * * * *CSW096
     C***********          OUT  LDA                                       CSW096
     C***********          EXSR *PSSR                                     CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      *****save*branch*internal*customer*number*&*SWIFT*TID*address*******CSW096
      ***********                                                         CSW096
     C***********          MOVELA8BICN    SECN                            CSW096
     C***********          MOVE A8BTID    SCSID                           CSW096
      ***********                                                         CSW096
      ****Access*SDCUSTPD*using*branch*internal*customer*number***********CSW096
      ***********                                                         CSW096
     C***********          MOVE *BLANKS   @KEY1                           CSW096
     C***********          MOVELSECN      @KEY1                           CSW096
     C***********          CALL 'AOCUSTR0'                                CSW096
     C***********          PARM '*MSG   ' @RTCD                           CSW096
     C***********          PARM '*KEY   ' @OPTN                           CSW096
     C***********          PARM           @KEY1  10                       CSW096
     C***********          PARM *BLANKS   @KYST   7                       CSW096
     C***********SDCUST    PARM SDCUST    DSSDY                           CSW096
      ***********                                                         CSW096
      ***Customer*record*not*found*-*Error********************************CSW096
      ***********                                                         CSW096
     C***********@RTCD     IFNE *BLANKS                                   CSW096
     C************LOCK     IN   LDA                                       CSW096
     C***********          MOVE '008'     DBASE              * * * * * * *CSW096
     C***********          MOVEL@KEY1     DBKEY              * DBERR 008 *CSW096
     C***********          MOVEL'SDCUSTPD'DBFILE             * * * * * * *CSW096
     C***********          OUT  LDA                                       CSW096
     C***********          EXSR *PSSR                                     CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****Save*sender's*addresses*&*parent*customer*number****************CSW096
      ***********                                                         CSW096
     C***********          MOVE BBTXA1    STELX                           CSW096
     C***********          MOVE BBSTAD    SSTTX                           CSW096
     C***********          MOVE BBCRNM    SCRNM                           CSW096
     C***********          MOVE BBPCNB    SPCNB                           CSW096
     C***********          MOVE BBPAIN    SPAIN                           CSW096
      ***********                                                         CSW096
      ****Access*SDCUSTPD*using*destination*customer*number***************CSW096
      ***********                                                         CSW096
     C***********          MOVE *BLANKS   @KEY1                           CSW096
     C***********          MOVELMGCNUM    @KEY1                           CSW096
      ***********                                                         CSW096
     C***********          CALL 'AOCUSTR0'                                CSW096
     C***********          PARM '*MSG   ' @RTCD                           CSW096
     C***********          PARM '*KEY   ' @OPTN                           CSW096
     C***********          PARM           @KEY1  10                       CSW096
     C***********          PARM *BLANKS   @KYST   7                       CSW096
     C***********SDCUST    PARM SDCUST    DSSDY                           CSW096
      ***********                                                         CSW096
     C***********          MOVE *BLANKS   DSERR                           CSW096
     C***********          MOVE MGCNUM    DECN                            CSW096
      ***********                                                         CSW096
      ***Record*not*found*on*sdcustpd.************************************CSW096
      ***********                                                         CSW096
     C***********@RTCD     IFNE *BLANKS                                   CSW096
     C***********          MOVE 'Y'       @ERR    1                       CSW096
     C***********          MOVELMSGA,2    DSERR  50                       CSW096
      ***********                                                         CSW096
      ***Destination*customer*found.**************************************CSW096
      ***********                                                         CSW096
     C***********          ELSE                                           CSW096
     C***********          MOVE BBCSID    CSID                            CSW096
      ***********                                                         CSW096
      ***If*the*default*network*for*the*destination*customer*is***********CSW096
      ***not*blank*execute*subroutine*NWAD*(Default*Network*Address.)*****CSW096
      ***If*the*default*is*blank*execute*subroutine*PRAD*(Priority********CSW096
      ***Network*Address).************************************************CSW096
      ***********                                                         CSW096
     C***********BBDNW3    IFNE *BLANKS                                   CSW096
     C***********          EXSR NWAD                                      CSW096
     C***********          ELSE                                           CSW096
     C***********          EXSR PRAD                                      CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****Fill*up*the*message*status*released*info.*from*PF/SDCUSTPD******CSW096
      ****if*the*message*status*is*blank.*********************************CSW096
      ***********                                                         CSW096
     C***********MGST      IFEQ *BLANKS                                   CSW096
     C***********          EXSR FILL                                      CSW096
      ***********                                                         CSW096
      ***The*following*message*types*can*be*entered*on*sdcustpd*as*to*****CSW096
      ***be*generated*as*released.****************************************CSW096
      ***(NB.**3** -*any*of*the*300*series*messages.**********************CSW096
      *********33* -*any*of*the*330*series*messages.)*********************CSW096
      ***********                                                         CSW096
     C***********'330'     LOKUPGNR                      20               CSW096
     C***********'33*'     LOKUPGNR                      21               CSW096
     C***********'3**'     LOKUPGNR                      22               CSW096
      ***********                                                         CSW096
     C************IN20     IFEQ '1'                                       CSW096
     C************IN21     OREQ '1'                                       CSW096
     C************IN22     OREQ '1'                                       CSW096
     C***********          MOVE 'RSND'    MGST                            CSW096
     C***********          ELSE                                           CSW096
     C***********          MOVE 'CRTD'    MGST                            CSW096
     C***********          END                                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          ENDSR                                          CSW096
     C/EJECT                                                              CSW096
      *****************************************************************   CSW096
      *   SRROUT - determine message routing                          *   CSW096
      *   Called by - main process                                    *   CSW096
      *   Calls -                                                     *   CSW096
      *****************************************************************   CSW096
      *                                                                   CSW096
     C           SRROUT    BEGSR                                          CSW096
      *                                                                   CSW096
     C                     MOVE MGBRCA    I@SNBR                          CSW096
     C                     MOVE *BLANKS   I@DSCN                          CSW096
     C                     MOVE MGCNUM    I@DSCN                          CSW096
     C                     MOVE '330'     I@MTPY                          CSW096
     C                     MOVE 'N'       I@CONC                          CSW096
     C                     Z-ADD0         I@SETT                          CSW096
     C                     MOVE *BLANK    I@FTCS                          CSW096
     C                     MOVE MGMODI    I@MMOD                          CSW096
      *###################################################################CSW096
      *                                                                  #CSW096
      * Below are two copy sources intended for setting up the custom    #CSW096
      * parameter (P@ZZ) in the call to MG9900.                          #CSW096
      * One (MG9900CALL) is in ALL MG generation programs and is for use #CSW096
      * when a change is required to all of them.                        #CSW096
      * The other is only in this program.                               #CSW096
     C/COPY WNCPYSRC,MG9900CALL                                          #CSW096
     C/COPY WNCPYSRC,MG0330ROUT                                          #CSW096
      *                                                                  #CSW096
      *###################################################################CSW096
     C*********************CALL 'MG9900'                            CSW096CSW036
     C                     CALL 'MG9901'                                  CSW036
     C                     PARM *BLANKS   @RTCD                           CSW096
     C                     PARM           P@IN                            CSW096
     C                     PARM *BLANKS   P@OUT                           CSW096
     C                     PARM           P@ZZ  256                       CSW096
      *                                                                   CSW096
     C           @RTCD     IFNE *BLANKS                                   CSW096
     C           *LOCK     IN   LDA                                       CSW096
     C                     MOVE '092'     DBASE              * * * * * * *CSW096
     C                     MOVEL'*CALL  ' DBKEY              * DBERR 092 *CSW096
     C*********************MOVEL'MG9900'  DBFILE             * * * * * * *CSW096CSW036
     C                     MOVEL'MG9901'  DBFILE             * * * * * * *CSW036
     C                     OUT  LDA                                       CSW096
     C                     EXSR *PSSR                                     CSW096
     C                     ELSE                                           CSW096
     C                     MOVE O@NWRK    NWRK                            CSW096
     C**********           Z-ADDO@CNSN    SECN                                         CSW096 CSD027
     C                     MOVE O@CNSN    SECN                                                CSD027
     C                     MOVE O@NWSN    NWSN                            CSW096
     C**********           Z-ADDMGCNUM    DECN                                         CSW096 CSD027
     C                     MOVE MGCNUM    DECN                                                CSD027
     C                     MOVE O@NWDS    NWDS                            CSW096
     C                     MOVE O@MGSG    MGSG                            CSW096
     C                     MOVE O@MGST    MGST                            CSW096
     C                     MOVE O@PCNB    SPCNB                           CSW096
     C                     MOVE O@PAIN    SPAIN                           CSW096
     C                     END                                            CSW096
      *                                                                   CSW096
     C/COPY WNCPYSRC,MG0330C001
     C                     ENDSR                                          CSW096
     C/EJECT                                                              CSW096
      *****************************************************************
      *   FMTA - Format Message Detail - Sequence A.                  *
      *   Called by - main process                                    *
      *   Calls     - CODE   determine codeword.                      *
      *             - DATES  formats date fields.                     *
      *             - FD53A  format field 53.                         *
      *             - FD53B  format field 53.                         *
      *             - FLD72  format field 72.                         *
      *****************************************************************
      *
     C           FMTA      BEGSR
      *
      ** Field :20: -  Transaction Reference Number.
      *
     C                     Z-ADD1         X       20
     C           X         OCUR MULT
     C                     MOVEA*BLANKS   @WRK
      *
      ** Build up the trn with the module id, the transaction number
      ** and the last swift sequence add 1.
      *
     C                     Z-ADD1         Z       20
     C                     MOVEAMGMODI    @WRK
     C                     MOVEAMGTNUM    @WRK,3
     C           MGLSWS    ADD  1         HLSWS   30
     C                     MOVE HLSWS     HSWS    3
      *
     C           ' '       LOKUP@WRK,Z                   31
     C                     MOVEAHSWS      @WRK,Z
      *
      **  Check on MGREFPD for a uniqne TRN,else output as an error.
      **  and store the TRN of the new confirmation message.
      *
     C                     MOVEA@WRK      @TRNA  16
      *
     C           @TRNA     CHAINMGREFL0              11
      *
      ** If no record is found flag field as in error.
      *
     C           *IN11     IFEQ '0'
     C                     MOVE 'Y'       @ERR
     C                     MOVEAMSGA,7    MERR
     C                     END
      *
     C                     MOVEL':20:'    MTAG
     C                     MOVEA@WRK      MFLD
      *
      ** Field :21: - Related Reference.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      **  Determine the message codeword
      *
     C                     EXSR CODE
      *
     C           CWRD      IFEQ 'NEW'
     C                     MOVEL'NEW'     MFLD
      *
     C                     ELSE
      *
      **  Set up the related reference.
      *
     C                     MOVEA*BLANKS   @WRK
     C                     MOVEAMGMODI    @WRK
     C                     MOVEAMGTNUM    @WRK,3
     C                     MOVE MGLSWC    MLSWC   30
     C                     MOVE MLSWC     MSWC    3
      *
     C           ' '       LOKUP@WRK,Z                   31
     C                     MOVEAMSWC      @WRK,Z
     C                     MOVEA@WRK      @TRNB  16
      *
     C                     MOVEL@TRNB     MFLD
      *
      **  Obtain transaction reference of previous MT330                                      190127
     C                     MOVELMGTNUM    HSTRAN                                              190127
     C                     MOVE '330'     HSMTPY                                              190127
      *                                                                                       190127
     C                     MOVE HSTRAN    @HTRN   6                                           190127
      *                                                                                       190127
     C           HSKEY     SETGTMGHISTL0                                                      190127
     C                     READPMGHISTL0                 56                                   190127
      *                                                                                       190127
     C           *IN56     IFEQ '0'                                                           190127
     C           HSMODI    ANDEQMGMODI                                                        190127
     C           HSTRAN    ANDEQ@HTRN                                                         190127
     C           HSMTPY    ANDEQ'330'                                                         190127
     C                     MOVEL@HREF     MFLD                                                190127
     C                     END                                                                190127
     C                     END
     C/COPY WNCPYSRC,MG0330C020
      *
     C                     MOVEL':21:'    MTAG
      *
      ** Field :22: - Code/Common Reference.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZCREF
      *
      **  If SWIFT network, use sender & destination customer
     C           NWRK      IFEQ 'SWIFT'
     C           NWRK      OREQ 'STTX'
      *
     C           NWRK      IFEQ 'SWIFT'
     C                     MOVELNWSN      ZSSWI
     C                     MOVELNWDS      ZDSWI
     C                     ELSE
     C                     MOVELSCSID     ZSSWI
     C                     MOVELCSID      ZDSWI
     C                     END
      *
     C                     MOVE MGINTR    ZRATE
      *
      **  Format SWIFT common reference
      *
     C                     CALL 'ZM0020'               15
     C                     PARM           ZSSWI  12
     C                     PARM           ZDSWI  12
     C                     PARM           ZRATE  138
     C                     PARM           ZCREF  16
      *
      ** If the program ends in error.
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '009'     DBASE              * * * * * * *
     C                     MOVEL'       ' DBKEY              * DBERR 009 *
     C                     MOVEL'ZM0020'  DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     END
      *
     C           O@SWSN    IFNE *BLANKS                                   CSW096
     C           O@SWDS    ANDNE*BLANKS                                   CSW096
      *                                                                   CSW096
     C                     MOVE MGINTR    ZRATE                           CSW096
     C                     MOVELO@SWSN    ZSSWI                           CSW096
     C                     MOVELO@SWDS    ZDSWI                           CSW096
      *                                                                   CSW096
      **  Format SWIFT common reference                                   CSW096
      *                                                                   CSW096
     C                     CALL 'ZM0020'               15                 CSW096
     C                     PARM           ZSSWI  12                       CSW096
     C                     PARM           ZDSWI  12                       CSW096
     C                     PARM           ZRATE  138                      CSW096
     C                     PARM           ZCREF  16                       CSW096
      *                                                                   CSW096
     C           *IN15     IFEQ '1'                                       CSW096
     C           *LOCK     IN   LDA                                       CSW096
     C                     MOVE '005'     DBASE                           CSW096
     C                     MOVEL'       ' DBKEY                           CSW096
     C                     MOVEL'ZM0020'  DBFILE                          CSW096
     C                     OUT  LDA                                       CSW096
     C                     EXSR *PSSR                                     CSW096
     C                     ENDIF                                          CSW096
      *                                                                   CSW096
     C                     ENDIF                                          CSW096
      *                                                                   CSW096
     C           ZCREF     IFEQ *BLANKS
     C                     MOVEL@TRNA     ZCREF
     C                     END
      *
     C                     MOVEL':22:'    MTAG
      *
      ** Construct Field 22  'codeword/common reference'
      *
      **  If change type indicates reversal, codeword equals 'CANCEL'
      *
     C           MGCHTP    IFEQ 'C'
     C                     MOVEL'CANCEL  'CWRD
     C                     END
      *
     C                     Z-ADD1         I       20
     C                     MOVEA*BLANKS   @WRK
     C                     MOVEACWRD      @WRK,I
     C           ' '       LOKUP@WRK,I                   20
      *
     C                     MOVEA'/'       @WRK,I
     C                     ADD  1         I
     C                     MOVEAZCREF     @WRK,I
     C                     MOVEA@WRK      MFLD
      *
      **  Codeword blank
      *
     C           CWRD      IFEQ *BLANKS
     C                     MOVE 'Y'       @ERR
     C                     MOVEAMSGA,6    MERR
     C                     END
      *
     C                     EXSR DATES
      *
      ** Format fields 56 and 57.
      *
     C********** MGLORD    IFEQ 'L'                                                           110589
     C********** MGMDAT    ANDEQ00000                                                         110589
     C********** MGLORD    OREQ 'D'                                                           110589
     C********** CWRD      ANDEQ'CLOSING'                                                     110589
     C********** MGLORD    OREQ 'D'                                                    087012 110589
     C********** CWRD      ANDEQ'CORRECT'                                              087012 110589
     C********** MGLORD    OREQ 'D'                                                    087012 110589
     C********** CWRD      ANDEQ'COMPLETE'                                             087012 110589
     C********** MGLORD    OREQ 'D'                                                    CSW096 110589
     C********** CWRD      ANDEQ'SETTLE '                                              CSW096 110589
     C**********           EXSR FD53A                                                         110589
      **********                                                                              110589
     C**********           ELSE                                                               110589
     C**********           EXSR FD53B                                                         110589
     C**********           END                                                                110589
      **********                                                                              110589
      *                                                                                       110589
      * Fields 56 and 57 depend on the flow of funds, if they                                 110589
      * are incoming use receive side(FD53B) else pay side(FD53A)                             110589
      * If just an amendment use pay for Deposits Taken and                                   110589
      * receive for Deposits placed.                                                          110589
      *                                                                                       110589
     C                     SELEC                                                              110589
      *                                                                                       110589
      * Principal increase for Lending Loans                                                  110589
      *                                                                                       110589
     C           MGAMTP    WHEQ 'PI'                                                          110589
     C           MGMODI    ANDEQ'LE'                                                          110589
      *                                                                                       110589
     C                     EXSR FD53A                      Pay ins                            110589
      *                                                                                       110589
      * Repayment                                                                             110589
      *                                                                                       110589
     C           MGAMTP    WHEQ 'RE'                                                          110589
      *                                                                                       110589
     C                     EXSR FD53B                      Receive Ins                        110589
      *                                                                                       110589
      * Principal increase for Deposit taken                                                  110589
      *                                                                                       110589
     C           MGAMTP    WHEQ 'PI'                                                          110589
     C           MGLORD    ANDEQ'D'                                                           110589
      *                                                                                       110589
     C                     EXSR FD53B                      Receive Ins                        110589
      *                                                                                       110589
      * Principal increase for Deposit placed                                                 110589
      *                                                                                       110589
     C           MGAMTP    WHEQ 'PI'                                                          110589
     C           MGLORD    ANDEQ'L'                                                           110589
      *                                                                                       110589
     C                     EXSR FD53A                      Pay Ins                            110589
      *                                                                                       110589
      * Principal decrease for Deposit taken                                                  110589
      *                                                                                       110589
     C           MGAMTP    WHEQ 'PD'                                                          110589
     C           MGLORD    ANDEQ'D'                                                           110589
      *                                                                                       110589
     C                     EXSR FD53A                      Pay ins                            110589
      *                                                                                       110589
      * Principal decrease for Deposit placed                                                 110589
      *                                                                                       110589
     C           MGAMTP    WHEQ 'PD'                                                          110589
     C           MGLORD    ANDEQ'L'                                                           110589
      *                                                                                       110589
     C                     EXSR FD53B                      Receive ins                        110589
      *                                                                                       110589
      * Deposit Taken - Closing/Settle, Amendment no change in                                110589
      *                 principal                                                             110589
      *                                                                                       110589
      * Closing or Settle Confirmation                                                        110589
     C           MGLORD    WHEQ 'D'                                                           110589
     C           CWRD      ANDEQ'CLOSING'                                                     110589
     C           MGLORD    OREQ 'D'                                                           110589
     C           CWRD      ANDEQ'SETTLE '                                                     110589
      * Amendment Confirmation no change in principal                                         110589
     C           MGLORD    OREQ 'D'                                                           110589
     C           CWRD      ANDEQ'CORRECT'                                                     110589
     C           MGLORD    OREQ 'D'                                                           110589
     C           CWRD      ANDEQ'COMPLETE'                                                    110589
     C           MGLORD    OREQ 'D'                                                           110589
     C           CWRD      ANDEQ'AMEND   '                                                    110589
      *                                                                                       110589
     C                     EXSR FD53A                      Pay ins                            110589
      *                                                                                       110589
      * Deposit Placed - Closing/Settle, Amendment no change in                               110589
      *                  principal                                                            110589
      *                                                                                       110589
      * Closing or Settle Confirmation                                                        110589
     C           MGLORD    WHEQ 'L'                                                           110589
     C           CWRD      ANDEQ'CLOSING'                                                     110589
     C           MGLORD    OREQ 'L'                                                           110589
     C           CWRD      ANDEQ'SETTLE '                                                     110589
      * Amendment Confirmation no change in principal                                         110589
     C           MGLORD    OREQ 'L'                                                           110589
     C           CWRD      ANDEQ'CORRECT'                                                     110589
     C           MGLORD    OREQ 'L'                                                           110589
     C           CWRD      ANDEQ'COMPLETE'                                                    110589
     C           MGLORD    OREQ 'L'                                                           110589
     C           CWRD      ANDEQ'AMEND   '                                                    110589
      *                                                                                       110589
     C                     EXSR FD53B                      Receive ins                        110589
      *                                                                                       110589
      * Catch all processing                                                                  110589
      *                                                                                       110589
      * If a Loan and not maturing then assume Amendment with                                 110589
      * principal increase                                                                    110589
      *                                                                                       110589
     C           MGLORD    WHEQ 'L'                                                           110589
     C           MGMDAT    ANDEQ00000                                                         110589
      *                                                                                       110589
     C                     EXSR FD53A                      Receive ins                        110589
     C                     OTHER                                                              110589
      *                                                                                       110589
     C                     EXSR FD53B                      Pay ins                            110589
     C                     ENDSL                                                              110589
      *                                                                                       110589
      ** Format field 72.
      *
     C                     EXSR FLD72
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   FMTB - Format Message Detail - Sequence B.                  *
      *   Called by - main process if the codeword is Closing.        *
      *   Calls  - FD56A - Format Fields 56 and 57 for a deposit.     *
      *            FD56B - Format Fields 56 and 57 for a loan.        *
      *****************************************************************
      *
     C           FMTB      BEGSR
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      **  Convert value date to SWIFT date format
      *
     C                     CALL 'ZM0060'               15
     C                     PARM MGVDAT    ZMDAY   50
     C                     PARM           ZSDATE  6
      *
      **  Field 34 - Value Date , Currency Code , Interest Amount.
      **  Format currency code and contract amount.
      *
     C                     MOVE MGCCY     ZCCY
      *                                                                   172657
      ** Chain to DEALS file to get additional data for interest          172657
      ** computation. Start date should be - interest accrual control     172657
      ** date and end date should be the maturity date when next          172657
      ** interest date is zero.                                           172657
      *                                                                   172657
     C                     MOVELMGTNUM    WDLNO   60                      172257
     C           WDLNO     CHAINDEALSC               40                   172657
     C           *IN40     IFEQ '0'                                       172657
     C           NIDT      ANDEQ0                                         172657
     C                     Z-ADDIACD      ZIBEG                           172657
     C                     Z-ADDMGMDAT    ZIEND                           172657
     C                     ELSE                                           172657
     C                     Z-ADDMGSLID    ZIBEG
     C                     Z-ADDMGNIDT    ZIEND
     C                     END                                            172657
     C                     MOVE MGICBS    ZICALC
     C                     Z-ADDMGINTR    ZIRATE
     C                     Z-ADDMGPCPL    ZIAMT
     C/COPY WNCPYSRC,MG0330C004
     C                     EXSR GLINTC
     C/COPY WNCPYSRC,MG0330C016
     C                     Z-ADDZINTR     ZAMNT     H                     E31885
     C           ZINTR     IFLT 0
     C                     Z-SUBZINTR     ZAMNT     H                     E31885
     C                     END
     C           MGTTYP    IFEQ 'CD'                                      179816
     C           MGTTYP    OREQ 'CL'                                      179816
     C           MGMDAT    IFNE 0                                         179816
     C                     Z-ADD0         INTINT 130                      179816
     C           MGAITC    SUB  MGIPRD    INTINT                          179816
     C           INTINT    SUB  MGICTD    INTINT                          179848
     C           MGAIAN    ADD  MGAIAP    INT2   130                      179848
     C           INT2      ADD  INTINT    INTINT                          179848
     C           ZAMNT     ADD  INTINT    ZAMNT                           179816
     C                     END                                            179816
     C                     END                                            179816
     C/COPY WNCPYSRC,MG0330C026
      **  Format currency and interest amount.
      *
     C                     MOVE MGCCY     ZCCY
     C                     CALL 'ZM0040'
     C                     PARM           ZAMNT  130
     C                     PARM           ZCCY    3
     C                     PARM           ZSAMNT 15
     C                     PARM           ZSCCY   3
     C                     PARM           ZERR    1
     C                     PARM           ZSWDPC                                              222373
      *
      ** Deal Type is a placing (loan).
     C           MGLORD    IFEQ 'L'
      *
      **  If Loan, interest field is type R(eceive), unless interest
      **  rate is negative...
     C           MGINTR    IFGE 0
     C                     MOVE ':34R:'   MTAG
     C                     ELSE
     C                     MOVE ':34P:'   MTAG
     C                     END
      *
     C                     ELSE
      *
      **  Otherwise, if Deposit, interest field is type P(ay), unless
      **  interest rate is negative.
     C           MGINTR    IFGE 0
     C                     MOVE ':34P:'   MTAG
     C                     ELSE
     C                     MOVE ':34R:'   MTAG
     C                     END
      *
     C                     END
      *                                                                   142857
     C           MGAMTP    IFEQ 'PD'                                      142857
     C           MGMODI    ANDEQ'DL'                                      142857
     C           TAG       IFEQ 'E'                                       142857
     C                     MOVE 'F'       TAG                             142857
     C                     ELSE                                           142857
     C                     MOVE 'E'       TAG                             142857
     C                     END                                            142857
     C                     END                                            142857
      *
      ** Error - indicate erroneous fields;
      *
     C           ZERR      IFEQ '1'
     C                     MOVE 'Y'       @ERR
     C                     MOVELERR3N     MFLD
     C                     MOVELMSGA,4    MERR
      *
     C                     ELSE
     C                     MOVELFLD3N     MFLD
     C                     END
      *
      ** Fields 56 and 57.
      *
     C           MGLORD    IFEQ 'D'
     C                     EXSR FD56A
     C                     ELSE
     C                     EXSR FD56B
     C                     END
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   CODE - Calculate codeword.                                  *
      *   Called by - FMTA - Format message detail Seq A              *
      *   Calls       PAYE - Pay side field 57 (KNOWN or UNKNOWN)     *
      *****************************************************************
      *
     C           CODE      BEGSR
      *
      ** Last Confirmation sequence Value.
      *
     C           MGLSWC    IFEQ 0
     C                     MOVEL'NEW'     CWRD
     C*
     C**  Determine the state of the pay side of the transaction
     C*
     C                     EXSR PAYE
      *
      ** If the deal is a loan (MGLORD = L) and our pay field 57 is
      ** non-blank OR the deal is a deposit (MGLORD = D) and our
      ** receive nostro is non-blank field F57U is K (Known.) else
      ** it is U (Unknown).
      *
     C           MGLORD    IFEQ 'L'
     C           PAY57     ANDNE*BLANKS
     C           MGLORD    OREQ 'D'
     C           MGRONS    ANDNE*BLANKS
     C                     MOVE 'K'       F57U
     C                     ELSE
     C                     MOVE 'U'       F57U
     C                     END
      *
     C                     ELSE
      *
      ** For the rollover deal number being non-zero; check if it
      ** is a principal increase
      *
     C           MGAMTP    IFEQ 'PI'
      *                                                                   CSW096
     C           CSW096    IFEQ 'Y'                                       CSW096
     C                     MOVEL'AMEND   'CWRD                            CSW096
     C                     ELSE                                           CSW096
     C                     MOVEL'INCREASE'CWRD
     C                     ENDIF                                          CSW096
      *                                                                   CSW096
     C                     END
      *
      **  Principal Decrease (Dealing), Scheduled Repayment (Lending)
     C           MGAMTP    IFEQ 'PD'
     C           MGAMTP    OREQ 'RE'
      *                                                                   CSW096
     C           CSW096    IFEQ 'Y'                                       CSW096
     C                     MOVEL'AMEND   'CWRD                            CSW096
     C                     ELSE                                           CSW096
     C                     MOVEL'DECREASE'CWRD
     C                     ENDIF                                          CSW096
      *                                                                   CSW096
     C                     END
      *
      **  Closing of contract i.e. final reduction of the loan/deposit
      **  balance to zero and all interest paid
      *
     C           MGNAMT    IFEQ 0
      *                                                                   CSW096
     C           CSW096    IFEQ 'Y'                                       CSW096
     C                     MOVEL'SETTLE  'CWRD                            CSW096
     C                     ELSE                                           CSW096
     C                     MOVEL'CLOSING 'CWRD
     C                     ENDIF                                          CSW096
      *                                                                   CSW096
     C                     END
      *
     C                     END
      *
      ** If the codeword has still not been calculated, access
      ** LF/MGOREFL0 for the last confirmation.
      *
     C           CWRD      IFEQ *BLANKS
      *
     C                     MOVE *BLANKS   SEARCH
      *
     C           MGLORD    IFEQ 'L'
     C           MGAWBN    ANDNE*BLANKS
     C           MGLORD    OREQ 'D'
     C           MGRONS    ANDNE*BLANKS
     C                     MOVE 'K'       F57U
     C                     ELSE
     C                     MOVE 'U'       F57U
     C                     END
      *
      **  Use the select table.
     C*
     C**  The two table TABSLT and TABRST are used to create the
     C**  CONDITION and RESULT, as shown in the table below.
     C**  The position of the CONDITION on TABSLT, is the same
     C**  equivalent position for the RESULT on TABRST. Hence when
     C**  a LOKUP is performed on TABSLT, using the CONDITION as the
     C**  key, the equivalent positional RESULT value is placed
     C**  in TABRST.
     C**
     C**  To retrieve the first 3 fields for the CONDITION, the
     C**  last confrimation created for the Transaction number
     C**  is accessed.
     C**  <-----------Condition-------------->    <--Result-->
     C**  Status   Old Code  Old F57U   F57U        CODE
     C**           LF/MGOREFL0
     C**  -----------------------------------------------------------------
      **                                 K         COMPLETE
      **                                 U         CORRECT
      **  SENT     NEW          U        K         COMPLETE
      **  SENT     NEW          U        U         CORRECT
      **  SENT     NEW          K        K         CORRECT
      **  SENT     NEW          K        K         CORRECT
      **  NONREC   NEW          U        K         NEW
      **  NONREC   NEW          U        U         NEW
      **  NONREC   NEW          K        K         NEW
      **  NONREC   NEW          K        K         NEW
      **  SENT     CORRECT      U        K         COMPLETE
      **  SENT     CORRECT      U        U         CORRECT
      **  SENT     CORRECT      K        K         CORRECT
      **  SENT     CORRECT      K        K         CORRECT
      **  SENT     COMPLETE     K        K         CORRECT
      **  SENT     COMPLETE     K        K         CORRECT
      **  NONREC   CORRECT      U        K         COMPLETE
      **  NONREC   CORRECT      U        U         CORRECT
      **  NONREC   CORRECT      K        K         CORRECT
      **  NONREC   CORRECT      K        K         CORRECT
      **  NONREC   COMPLETE     K        K         COMPLETE
      **  NONREC   COMPLETE     K        K         CORRECT
      *
      *                                                                   CSW096
      **  For SWIFT Changes 1996, the two new tables TABS96 and           CSW096
      **  TABR96 are used to create the CONDITION and RESULT              CSW096
      **  as shown in the table below.  The position of the               CSW096
      **  CONDITION on TABS96, is the same equivalent position            CSW096
      **  for the RESULT on TABR96. Hence when a LOKUP is performed       CSW096
      **  on TABS96, using the CONDITION as the key, the equivalent       CSW096
      **  positional RESULT value is placed in TABR96.                    CSW096
      **                                                                  CSW096
      **  To retrieve the first 3 fields for the CONDITION, the           CSW096
      **  last confrimation created for the Transaction number            CSW096
      **  is accessed.                                                    CSW096
      **  <-----------Condition-------------->    <--Result-->            CSW096
      **  Status   Old Code  Old F57U   F57U        CODE                  CSW096
      **           LF/MGOREFL0                                            CSW096
      **  ----------------------------------------------------------------CSW096
      **                                 K         AMEND                  CSW096
      **                                 U         AMEND                  CSW096
      **  SENT     NEW          U        K         AMEND                  CSW096
      **  SENT     NEW          U        U         AMEND                  CSW096
      **  SENT     NEW          K        K         AMEND                  CSW096
      **  SENT     NEW          K        K         AMEND                  CSW096
      **  NONREC   NEW          U        K         NEW                    CSW096
      **  NONREC   NEW          U        U         NEW                    CSW096
      **  NONREC   NEW          K        K         NEW                    CSW096
      **  NONREC   NEW          K        K         NEW                    CSW096
      **  SENT     AMEND        U        K         AMEND                  CSW096
      **  SENT     AMEND        U        U         AMEND                  CSW096
      **  SENT     AMEND        K        K         AMEND                  CSW096
      **  SENT     AMEND        K        K         AMEND                  CSW096
      **  NONREC   AMEND        U        K         AMEND                  CSW096
      **  NONREC   AMEND        U        U         AMEND                  CSW096
      **  NONREC   AMEND        K        K         AMEND                  CSW096
      **  NONREC   AMEND        K        K         AMEND                  CSW096
      *                                                                   CSW096
      **  Retrieve last confirmation for this transaction.
      **  (@TRNB formatted in field 21.)
      **  Build up the trn with the module id, the transaction number
      **  and the last swift confirmation number.
      *
     C                     MOVEA*BLANKS   @WRK
     C                     MOVEAMGMODI    @WRK
     C                     MOVEAMGTNUM    @WRK,3
     C                     MOVE MGLSWC    MLSWC   30
     C                     MOVE MLSWC     MSWC    3
      *
     C           ' '       LOKUP@WRK,Z                   31
     C                     MOVEAMSWC      @WRK,Z
     C                     MOVEA@WRK      @TRNB  16
      *
     C           @TRNB     CHAINMGREFL0              11
      *
      **  If a message found build the selection key
      *
     C           *IN11     IFEQ '0'
      *
     C           MMGSG     IFEQ '2'
     C           MMGSG     OREQ '3'
     C                     MOVEL'SENT'    @MGST
     C                     ELSE
     C                     MOVEL'NONREC'  @MGST
     C                     END
      *
     C                     MOVELMLSCC     @LSCC
     C                     MOVE MF57U     @OF57
     C                     END
      *
      **  Use select table to point to the result table
      *
     C           CSW096    IFEQ 'Y'                                       CSW096
     C           SEARCH    LOKUPTABS96    TABR96         24               CSW096
     C                     ELSE                                           CSW096
     C           SEARCH    LOKUPTABSLT    TABRST         24
     C                     ENDIF                                          CSW096
      *
      **  Key matches select table, outputs the corresponding
      **  result table value to 'TABRST'
      *
     C           *IN24     IFEQ '1'
      *                                                                   CSW096
     C           CSW096    IFEQ 'Y'                                       CSW096
     C                     MOVE TABR96    CWRD                            CSW096
     C                     ELSE                                           CSW096
     C                     MOVE TABRST    CWRD
     C                     ENDIF                                          CSW096
      *                                                                   CSW096
     C                     ELSE                                           E29588
     C                     MOVEL'AMEND   'CWRD                            E29588
     C                     END
      *
     C                     END
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   PAYE - Pay side field 57 (KNOWN or UNKNOWN)                 *
      *   Called by   CODE  Calculate codeword                        *
      *   Calls       -                                               *
      *****************************************************************
      *
     C           PAYE      BEGSR
      *
     C                     MOVE *BLANKS   PAY57   5
      *
      **  Known when settlement via nostro (MGAWBN is blank)
      *
     C           MGPSTM    IFEQ 02
     C           MGPSTM    OREQ 12
     C                     MOVE 'KNOWN'   PAY57
     C                     END
      *
      **  Known when settlement internal (branch internal customer)
      *
     C                     MOVE MGPSTM    @STM    2
     C           @STM      LOKUPTABINT                   23
     C           *IN23     IFEQ '1'
     C                     MOVE 'KNOWN'   PAY57
     C                     END
      *
      **  Known when settlement via nostro and MGAWBN entered
      *
     C           MGPSTM    IFEQ 01
     C           MGPSTM    OREQ 07
     C           MGPSTM    OREQ 08
     C           MGAWBN    IFNE *BLANKS
     C           MGAWBN    OREQ *BLANKS                                   088043
     C           AWBA6     ANDEQ'DIRECT'                                  088043
     C                     MOVE 'KNOWN'   PAY57
     C                     END
     C                     END
      *
      **  Unknown when settlement internal
      *
     C           MGPSTM    IFEQ 00
     C                     MOVE *BLANKS   PAY57
     C                     END
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   DATES - Format Date fields.                                 *
      *   Called by - FMTA - Format message detail Seq A              *
      *   Calls     - none.                                           *
      *****************************************************************
      *
     C           DATES     BEGSR
      *
      **  Field :30:  Date contract agreed/amended
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE MGTDAT    ZMDAY
      *                                                                   172657
      ** If notice days is -999, zeroise MGNOTD.                          172657
      *                                                                   172657
     C           MGNOTD    IFEQ -999                                      172657
     C                     Z-ADD0         MGNOTD                          172657
     C                     END                                            172657
      *
      **  Convert Midas date to SWIFT date format
      *
     C                     CALL 'ZM0060'               15
     C                     PARM           ZMDAY   50
     C                     PARM           ZSDATE  6
      *
      ** If the program ends in error.
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '010'     DBASE              * * * * * * *
     C                     MOVEL'       ' DBKEY              * DBERR 010 *
     C                     MOVEL'ZM0060'  DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
     C                     MOVEL':30: '   MTAG
     C                     MOVELZSDATE    MFLD
      *
      **  Field :32:  Value Date of Deposit, Currency, Contract Amount.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE MGVDAT    ZMDAY
      *
      **  Convert Midas date to SWIFT date format
      *
     C                     CALL 'ZM0060'               15
     C                     PARM           ZMDAY   50
     C                     PARM           ZSDATE  6
      *
      **  Format currency code and contract amount.
      *
     C                     MOVE MGCCY     ZCCY
     C                     MOVE MGPCPL    ZAMNT
     C                     CALL 'ZM0040'
     C                     PARM           ZAMNT  130
     C                     PARM           ZCCY    3
     C                     PARM           ZSAMNT 15
     C                     PARM           ZSCCY   3
     C                     PARM           ZERR    1
     C                     PARM           ZSWDPC                                              222373
      ***********                                                         110587
      ***********                                                         110587
      ***The*field 32 tag is dependant on the value of MGLORD and the     110587
      ***value*of the codeword. If the loans/deposit indicator (MGLORD)   110587
      ***is*L*and the codeword is not CLOSING or COMPLETE or MGLORD 087013110587
      ***D*and*codeword is CLOSING or COMPLETE the tag is P. Else th087013110587
      ***tag*is*R.                                                  087013110587
      ***is*L*and*the*codeword*is*not*closing*OR*MGLORD*is*D*and*the***   087013
      ***codeword*is*closing*the*tag*is*P.*Else*the*tag*is*R.**********   087013
      ***********                                                         110587
     C***********MGLORD    IFEQ 'L'                                       110587
     C***********CWRD      ANDNE'CLOSING'                                 110587
     C***********MGLORD    OREQ 'L'                                 087013110587
     C***********CWRD      ANDNE'COMPLETE'                          087013110587
     C***********MGLORD    OREQ 'L'                                 087013110587
     C***********CWRD      ANDNE'CORRECT'                           087013110587
     C***********MGLORD    OREQ 'D'                                       110587
     C***********CWRD      ANDEQ'CLOSING'                                 110587
     C***********MGLORD    OREQ 'D'                                 087013110587
     C***********CWRD      ANDEQ'COMPLETE'                          087013110587
     C***********MGLORD    OREQ 'D'                                 087013110587
     C***********CWRD      ANDEQ'CORRECT'                           087013110587
     C***********MGLORD    OREQ 'L'                                 CSW096110587
     C***********CWRD      ANDNE'SETTLE '                           CSW096110587
     C***********MGLORD    OREQ 'D'                                 CSW096110587
     C***********CWRD      ANDEQ'SETTLE '                           CSW096110587
     C***********          MOVE ':32P:'   MTAG                            110587
     C***********          ELSE                                           110587
     C***********          MOVE ':32R:'   MTAG                            110587
     C***********          END                                            110587
      ***********                                                   172657110587
      ***For*codeword = 'SETTLE', if type is loan then output 32R   172657110587
      ***********                                                   172657110587
     C***********CWRD      IFEQ 'SETTLE '                           172657110587
     C***********MGLORD    ANDEQ'L'                                 172657110587
     C***********          MOVE ':32R:'   MTAG                      172657110587
     C***********          ENDIF                                    172657110587
      ***********                                                         110587
      ****If*Lending extract AMTP = 'PI' (32P); = 'RE' (32R)              110587
      ***********                                                         110587
     C***********MGMODI    IFEQ 'LE'                                      110587
     C***********MGAMTP    IFEQ 'PI'                                      110587
     C***********          MOVE ':32P:'   MTAG                            110587
     C***********          END                                      E32326110587
     C***********          ELSE                                     E32326
     C***********MGAMTP    IFEQ 'RE'                                E32326110587
     C***********          MOVE ':32R:'   MTAG                            110587
     C***********          END                                            110587
     C***********          END                                            110587
      *                                                                   110587
      * Field 32 depends on the flow of funds, if they                    110587
      * are incoming use receive side(32R) else pay side(32P)             110587
      * If just an amendment use pay for Deposits Taken and               110587
      * receive for Deposits placed.                                      110587
      *                                                                   110587
     C                     SELEC                                          110587
      *                                                                   110587
      * Principal increase for Lending Loans                              110587
      *                                                                   110587
     C           MGAMTP    WHEQ 'PI'                                      110587
     C           MGMODI    ANDEQ'LE'                                      110587
      *                                                                   110587
     C                     MOVE ':32P:'   MTAG             Pay Tag        110587
      *                                                                   110587
      * Repayment                                                         110587
      *                                                                   110587
     C           MGAMTP    WHEQ 'RE'                                      110587
      *                                                                   110587
     C                     MOVE ':32R:'   MTAG             Receive Tag    110587
      *                                                                   110587
      * Principal increase for Deposit taken                              110587
      *                                                                   110587
     C           MGAMTP    WHEQ 'PI'                                      110587
     C           MGLORD    ANDEQ'D'                                       110587
      *                                                                   110587
     C                     MOVE ':32R:'   MTAG             Receive Tag    110587
      *                                                                   110587
      * Principal increase for Deposit placed                             110587
      *                                                                   110587
     C           MGAMTP    WHEQ 'PI'                                      110587
     C           MGLORD    ANDEQ'L'                                       110587
      *                                                                   110587
     C                     MOVE ':32P:'   MTAG             Pay Tag        110587
      *                                                                   110587
      * Principal decrease for Deposit taken                              110587
      *                                                                   110587
     C           MGAMTP    WHEQ 'PD'                                      110587
     C           MGLORD    ANDEQ'D'                                       110587
      *                                                                   110587
     C                     MOVE ':32P:'   MTAG             Pay Tag        110587
      *                                                                   110587
      * Principal decrease for Deposit placed                             110587
      *                                                                   110587
     C           MGAMTP    WHEQ 'PD'                                      110587
     C           MGLORD    ANDEQ'L'                                       110587
      *                                                                   110587
     C                     MOVE ':32R:'   MTAG             Receive Tag    110587
      *                                                                   110587
      * Deposit Taken - Closing/Settle, Amendment no change in            110587
      *                 principal                                         110587
      *                                                                   110587
      * Closing or Settle Confirmation                                    110587
     C           MGLORD    WHEQ 'D'                                       110587
     C           CWRD      ANDEQ'CLOSING'                                 110587
     C           MGLORD    OREQ 'D'                                       110587
     C           CWRD      ANDEQ'SETTLE '                                 110587
      * Amendment Confirmation no change in principal                     110587
     C           MGLORD    OREQ 'D'                                       110587
     C           CWRD      ANDEQ'CORRECT'                                 110587
     C           MGLORD    OREQ 'D'                                       110587
     C           CWRD      ANDEQ'COMPLETE'                                110587
     C           MGLORD    OREQ 'D'                                       110587
     C           CWRD      ANDEQ'AMEND   '                                110587
      *                                                                   110587
     C                     MOVE ':32P:'   MTAG             Pay Tag        110587
      *                                                                   110587
      * Deposit Placed - Closing/Settle, Amendment no change in           110587
      *                  principal                                        110587
      *                                                                   110587
      * Closing or Settle Confirmation                                    110587
     C           MGLORD    WHEQ 'L'                                       110587
     C           CWRD      ANDEQ'CLOSING'                                 110587
     C           MGLORD    OREQ 'L'                                       110587
     C           CWRD      ANDEQ'SETTLE '                                 110587
      * Amendment Confirmation no change in principal                     110587
     C           MGLORD    OREQ 'L'                                       110587
     C           CWRD      ANDEQ'CORRECT'                                 110587
     C           MGLORD    OREQ 'L'                                       110587
     C           CWRD      ANDEQ'COMPLETE'                                110587
     C           MGLORD    OREQ 'L'                                       110587
     C           CWRD      ANDEQ'AMEND   '                                110587
      *                                                                   110587
     C                     MOVE ':32R:'   MTAG             Receive Tag    110587
      *                                                                   110587
      * Catch all processing                                              110587
      *                                                                   110587
      * If a Loan and not maturing then assume Amendment with             110587
      * principal increase                                                110587
      *                                                                   110587
     C           MGLORD    WHEQ 'L'                                       110587
     C           MGMDAT    ANDEQ00000                                     110587
      *                                                                   110587
     C                     MOVE ':32R:'   MTAG             Receive Tag    110587
     C                     OTHER                                          110587
      *                                                                   110587
     C                     MOVE ':32P:'   MTAG             Pay Tag        110587
     C                     ENDSL                                          110587
      *                                                                   110587
      *
      ** Error - indicate erroneous fields;
      *
     C           ZERR      IFEQ '1'
     C                     MOVE 'Y'       @ERR
     C                     MOVELERR3N     MFLD
     C                     MOVELMSGA,4    MERR
      *
     C                     ELSE
     C                     MOVELFLD3N     MFLD
     C                     END
      *
      ** Field 33 - Currency, New Balance.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *                                                                   E29588
      ** If generating CANCEL confirmation, amount should be zero.        E29588
      *                                                                   E29588
     C           CWRD      IFEQ 'CANCEL  '                                E29588
     C                     Z-ADD0         MGNAMT                          E29588
     C                     END                                            E29588
      *                                                                   E29588
     C                     MOVE MGCCY     ZCCY
     C           CWRD      IFEQ 'NEW     '
     C                     MOVE MGPCPL    ZAMNT
     C                     ELSE
     C                     MOVE MGNAMT    ZAMNT
     C                     END
     C                     CALL 'ZM0040'
     C                     PARM           ZAMNT  130
     C                     PARM           ZCCY    3
     C                     PARM           ZSAMNT 15
     C                     PARM           ZSCCY   3
     C                     PARM           ZERR    1
      *
      ** The value of the tag is dependant on the loans/deposit
      ** indicator (MGLORD). If MGLORD is L (a loan) the tag is
      ** E , else it is F.
      *
     C                     MOVE '33'      FLDNO
     C           MGLORD    IFEQ 'L'
     C***********          MOVE 'E'       TAG                             E32326
     C                     MOVE 'F'       TAG                             E32326
     C                     ELSE
     C***********          MOVE 'F'       TAG                             E32326
     C                     MOVE 'E'       TAG                             E32326
     C                     END
      *
     C                     MOVE @MTAG     MTAG
      *
      ** Error - indicate erroneous fields;
      *
     C           ZERR      IFEQ '1'
     C                     MOVE 'Y'       @ERR
     C                     MOVELERR3N     MFLD
     C                     MOVELMSGA,4    MERR
      *
      ** Format the field.
      *
     C                     ELSE
     C                     MOVEA*BLANKS   @WRK
     C                     MOVEAZSCCY     @WRK
     C                     MOVEAZSAMNT    @WRK,4
     C                     MOVEA@WRK      MFLD
     C                     END
      *
      ** Field 37 - Interest field.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE MGNIDT    ZMDAY
     C                     MOVE MGMDAT    ZMDAT
      *
     C                     MOVE MGINTR    ZINRT
     C                     MOVE MGNIDT    ZINPD
     C                     MOVE MGIPFR    ZINFC
     C                     MOVE MGICBS    ZCALC
     C                     CALL 'ZM0070'               15
     C                     PARM           ZINRT  117
     C                     PARM           ZINPD   50
     C                     PARM           ZMDAT   50
     C                     PARM           ZINFC   1
     C                     PARM           ZCALC   10
     C                     PARM           ZSTAG   1
     C                     PARM           @VAR   35
     C                     PARM           ZSF72  35
      *
      ** If the program ends in error.
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '011'     DBASE              * * * * * * *
     C                     MOVEL'       ' DBKEY              * DBERR 011 *
     C                     MOVEL'ZM0070'  DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
     C/COPY WNCPYSRC,MG0330C017
     C                     MOVE '37'      FLDNO
     C                     MOVE ZSTAG     TAG
     C                     MOVEL@MTAG     MTAG
     C                     MOVEL@VAR      MFLD
      *
      ** Field 38 - Period of Notice.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *                                                                   082874
      ** If notice days = -999, negate it to make it positive             082874
      *                                                                   082874
     C           MGNOTD    IFEQ -999                                      082874
     C***********          Z-SUB-999      MGNOTD                    082874172657
     C                     Z-ADD0         MGNOTD                          172657
     C                     END                                            082874
      *
     C                     MOVELMGNOTD    MFLD
     C                     MOVEL':38A:'   MTAG
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   FD53B - Format field  53.                                   *
      *   Called by - FMTA - Format message detail Seq A.             *
      *   Calls     - FD56B - Format fields 56 and 57.                *
      *             - FSWAD - Format the swift address.               *
      *****************************************************************
      *
     C           FD53B     BEGSR
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C                     MOVE 'Y'       ZDBEI                                               CSW201
     C                     ENDIF                                                              CSW201
      *
     C                     MOVE *BLANKS   @WRK
      *
      ** Field 53 - Senders correspondant.
      *
      ** If the module is lending attemp to format field 53.
      ** Else no field 53 is produced.
      *
     C           MGMODI    IFEQ 'LE'
      *
      ** If the receipt intermediary bank is not blank format field
      ** 53 , else no field is produced.
      *
     C           MGRIBN    IFNE *BLANKS
     C/COPY WNCPYSRC,MG0330C008
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELMGRIBN    ZDEST
     C                     MOVELMGRIBA    ACLINE                          056739
     C                     MOVE ' '       TAG
     C                     MOVE '53'      FLDNO
     C                     EXSR FSWAD
     C/COPY WNCPYSRC,MG0330C009
     C                     END
     C                     END
      *
      ** Call subroutine FD56B to format fields 56 and 57.
      *
     C                     EXSR FD56B
      *                                                                                       CSW201
     C                     MOVE *BLANKS   ZDBEI                                               CSW201
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   FD56B - Format fields 56 and 57.                            *
      *   Called by - FMTA - Format message detail Seq A              *
      *             - FMTB - Format message detail Seq B              *
      *   Calls     - FSWAD  Format the swift address.                *
      *****************************************************************
      *
     C           FD56B     BEGSR
      *
      ***Format*fields*56*and*57.*****************************************E32363
      ********************************************************************E32363
      ***Branch*code*of*sender*not*equal*to*Receive*settlement*branch.****E32363
      ********************************************************************E32363
      ****Test*if*settlement*via*nostro***********************************E32363
     C*********************MOVE*MGRSTM****@STM****************************E32363
     C***********@STM******LOKUPTABNST*******************23***************E32363
     C***********MGBRCA****IFNE*MGROBR************************************E32363
     C************IN23*****ANDEQ'1'***************************************E32363
      ********************************************************************E32363
     C*********************ADD**1*********X*******************************E32363
     C***********X*********OCUR*MULT**************************************E32363
      ********************************************************************E32363
     C*********************CALL*'AONOSTR0'********************************E32363
     C*********************PARM*'*MSG***'*@RTCD***7***********************E32363
     C*********************PARM*'*KEY***'*@OPTN***7***********************E32363
     C*********************PARM**BLANKS***@CUST***6********I:Customer*No**E32363
     C*********************PARM*MGCCY*****@CYCD***3********I:Currency*****E32363
     C*********************PARM**BLANKS***@ACCD***4********I:A/c*Code*****E32363
     C*********************PARM**BLANKS***@ACSN***2********I:A/c*Seq******E32363
     C*********************PARM*MGRONS****@NONB***2********I:Nostro*No****E32363
     C*********************PARM**BLANKS***@BRCD***3********I:Branch*Code**E32363
     C*********************PARM**BLANKS***@CSSN**10********I:Cust*ShortN**E32363
     C*********************PARM**BLANK****@PNOI***1********I:Prime*Nost*InE32363
     C***********SDNOST****PARM*SDNOST****DSFDY***************************E32363
      ********************************************************************E32363
      ****If*our*receive*nostro*is*not*found.*****************************E32363
      ********************************************************************E32363
     C***********@RTCD*****IFNE**BLANKS***********************************E32363
     C*********************MOVE*'Y'*******@ERR****************************E32363
     C*********************MOVELMGRONS****HLD2****2***********************E32363
     C*********************MOVELMGCCY*****HLD5****************************E32363
     C*********************MOVE*HLD2******HLD5****5***********************E32363
     C*********************MOVELHLD5******MFLD****************************E32363
     C*********************MOVELMSGA,3****MERR****************************E32363
     C*********************MOVE*':56*:'***MTAG****************************E32363
     C*********************ELSE*******************************************E32363
      ********************************************************************E32363
      ****Format*our*Receive*Nostro*Customer*Address**********************E32363
      ********************************************************************E32363
     C*********************MOVE**BLANKS***ZDEST***************************E32363
     C*********************MOVELA7CUST****ZDEST***************************E32363
     C*********************MOVE*'*'*******TAG*****************************E32363
     C*********************MOVE*'56'******FLDNO***************************E32363
     C*********************EXSR*FSWAD*************************************E32363
     C*********************END********************************************E32363
      ********************************************************************E32363
      ****Access*Branch*file*for*the*Internal*customer*number*of*the******E32363
      ****Receive*branch*(this*will*be*used*for*the*Account-With**********E32363
      ****Institution,*because*settlement*is*via*an*account*owned*********E32363
      ****by*a*branch*different*to*the*receive*branch)********************E32363
      ********************************************************************E32363
     C*********************CALL*'AOBRCHR0'********************************E32363
     C*********************PARM*'*MSG***'*@RTCD***************************E32363
     C*********************PARM*'*KEY***'*@OPTN***************************E32363
     C*********************PARM*MGROBR****@BRCD***3***********************E32363
     C***********SDBRCH****PARM*SDBRCH****DSSDY***************************E32363
      ********************************************************************E32363
      ***Branch*record*not*found*-*Error**********************************E32363
      ********************************************************************E32363
     C***********@RTCD*****IFNE**BLANKS***********************************E32363
     C************LOCK*****IN***LDA***************************************E32363
     C*********************MOVE*'026'*****DBASE***************************E32363
     C*********************MOVELMGROBR****DBKEY****************DBERR*026**E32363
     C*********************MOVEL'SDBRCHPD'DBFILE**************************E32363
     C*********************OUT**LDA***************************************E32363
     C*********************EXSR**PSSR*************************************E32363
     C*********************END********************************************E32363
      ********************************************************************E32363
      ***Format*Account-With*using*customer*number*of*receive*branch******E32363
      ********************************************************************E32363
     C*********************ADD**1*********X*******************************E32363
     C***********X*********OCUR*MULT**************************************E32363
     C*********************MOVE**BLANKS***ZDEST***************************E32363
     C*********************MOVELA8BICN****ZDEST***************************E32363
     C*********************MOVE*'*'*******TAG*****************************E32363
     C*********************MOVE*'57'******FLDNO***************************E32363
     C*********************EXSR*FSWAD*************************************E32363
      *
      *                                                                   E32363
      ** Format fields 56 and 57.                                         E32363
      *                                                                   E32363
      ** Branch code of sender not equal to Receive settlement branch.    E32363
      *                                                                   E32363
      **  Test if settlement via nostro                                   E32363
     C                     MOVE MGRSTM    @STM                            E32363
     C           @STM      LOKUPTABNST                   23               E32363
     C           MGBRCA    IFNE MGROBR                                    E32363
     C           *IN23     ANDEQ'1'                                       E32363
      *                                                                   E32363
     C                     ADD  1         X                               E32363
     C           X         OCUR MULT                                      E32363
      *                                                                   E32363
     C           MGRIBN    IFNE *BLANKS                                   E32363
     C                     MOVE *BLANKS   ZDEST                           E32363
     C                     MOVELMGRIBN    ZDEST                           E32363
     C                     MOVELMGRIBA    ACLINE                          056739
     C                     MOVE ' '       TAG                             E32363
     C                     MOVE '56'      FLDNO                           E32363
     C                     EXSR FSWAD                                     E32363
      *                                                                   E32363
     C                     ELSE                                           E32363
      *                                                                   E32363
      **  Access Branch file for the Internal customer number of the      E32363
      **  Receive branch (this will be used for the Intermediary          E32363
      **  Bank, because settlement is via an account owned                E32363
      **  by a branch different to the receive branch)                    E32363
      *                                                                   E32363
     C**********           CALL 'AOBRCHR0'                                E32363              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD                           E32363
     C                     PARM '*KEY   ' @OPTN                           E32363
     C                     PARM MGROBR    @BRCD   3                       E32363
     C           SDBRCH    PARM SDBRCH    DSSDY                           E32363
      *                                                                   E32363
      ** Branch record not found - Error                                  E32363
      *                                                                   E32363
     C           @RTCD     IFNE *BLANKS                                   E32363
     C           *LOCK     IN   LDA                                       E32363
     C                     MOVE '019'     DBASE              * * * * * * *E32363
     C                     MOVELMGROBR    DBKEY              * DBERR 019 *E32363
     C                     MOVEL'SDBRCHPD'DBFILE             * * * * * * *E32363
     C                     OUT  LDA                                       E32363
     C                     EXSR *PSSR                                     E32363
     C                     END                                            E32363
      *                                                                   E32363
      ** Format Intermediary using customer number of receive branch      E32363
      *                                                                   E32363
     C                     MOVE *BLANKS   ZDEST                           E32363
     C                     MOVELA8BICN    ZDEST                           E32363
     C                     MOVEL*BLANKS   ACLINE 35                       056739
     C                     MOVE ' '       TAG                             E32363
     C                     MOVE '56'      FLDNO                           E32363
     C                     EXSR FSWAD                                     E32363
     C                     END                                            E32363
      *                                                                   E32363
      ** Field :57:  A/C With Institution                                 E32363
      *                                                                   E32363
     C                     ADD  1         X                               E32363
     C           X         OCUR MULT                                      E32363
      *                                                                   137909
      ** Use settlement currency to access nostro if not blank.           137909
      ** Otherwise use deal currency.                                     137909
     C           CEU003    IFEQ 'Y'                                       137909
     C           MGSTCY    ANDNE*BLANKS                                   137909
     C           CEU004    OREQ 'Y'                                       137909
     C           MGSTCY    ANDNE*BLANKS                                   137909
     C                     MOVE MGSTCY    @CYCD                           137909
     C                     ELSE                                           137909
     C                     MOVE MGCCY     @CYCD                           137909
     C                     ENDIF                                          137909
      *                                                                   137909
     C******               CALL 'AONOSTR0'                                             E32363 CDL094
     C                     CALL 'AONOSTR1'                                                    CDL094
     C                     PARM '*MSG   ' @RTCD   7                       E32363
     C                     PARM '*KEY   ' @OPTN   7                       E32363
     C                     PARM *BLANKS   @CUST   6        I:Customer No  E32363
     C***********          PARM MGCCY     @CYCD   3     I:Currency E32363 137909
     C                     PARM           @CYCD   3        I:Currency     137909
     C**********           PARM *BLANKS   @ACCD   4        I:A/c Code                  E32363 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2        I:A/c Seq      E32363
     C                     PARM MGRONS    @NONB   2        I:Nostro No    E32363
     C                     PARM *BLANKS   @BRCD   3        I:Branch Code  E32363
     C                     PARM *BLANKS   @CSSN  10        I:Cust ShortN  E32363
     C                     PARM *BLANK    @PNOI   1        I:Prime Nost InE32363
     C***********SDNOST    PARM SDNOST    DSFDY                                        E32363 CDL094
     C           SDNOST    PARM SDNOST    DSSDY                                               CDL094
      *                                                                   E32363
      **  If our receive nostro is not found.                             E32363
      *                                                                   E32363
     C           @RTCD     IFNE *BLANKS                                   E32363
     C                     MOVE 'Y'       @ERR                            E32363
     C                     MOVELMGRONS    HLD2    2                       E32363
     C                     MOVELMGCCY     HLD5                            E32363
     C                     MOVE HLD2      HLD5    5                       E32363
     C                     MOVELHLD5      MFLD                            E32363
     C                     MOVELMSGA,3    MERR                            E32363
     C                     MOVE ':57 :'   MTAG                            E32363
     C                     ELSE                                           E32363
      *                                                                   E32363
      **  Format our Receive Nostro Customer Address                      E32363
      *                                                                   E32363
      * If CDL094 is On and Delivery Agent details have been defined for                      CDL094
      * the Nostro, use these and not the Customer of the Nostro details                      CDL094
     C           CDL094    IFEQ 'Y'                                                           CDL094
     C           A7RF57    ANDNE*BLANKS                                                       CDL094
      *                                                                                       CDL094
      * If SWIFT BIC defined as the Delivery Agent then obtain related                        CDL094
      * customer number                                                                       CDL094
     C                     MOVE *IN80     IN80    1                                           CDL094
     C                     MOVEL*BLANKS   WSWID  12                                           CDL094
     C                     MOVELA7RF57    WSWID                                               CDL094
     C           WSWID     CHAINSDCUSTL7             80                                       CDL094
     C           *IN80     IFEQ *OFF                                                          CDL094
     C                     MOVEL*BLANKS   ZDEST                                               CDL094
     C                     MOVELBBCUST    ZDEST                                               CDL094
     C                     ELSE                                                               CDL094
     C                     MOVEL*BLANKS   ZDEST                                               CDL094
     C                     MOVELA7RF57    ZDEST                                               CDL094
     C                     ENDIF                                                              CDL094
     C                     MOVEL*BLANKS   ACLINE                                              CDL094
     C                     MOVELA7RA57    ACLINE                                              CDL094
     C                     MOVE IN80      *IN80                                               CDL094
      *                                                                                       CDL094
     C                     ELSE                                                               CDL094
     C                     MOVE *BLANKS   ZDEST                           E32363
     C                     MOVELA7CUST    ZDEST                           E32363
     C                     MOVEL*BLANKS   ACLINE                          056739
     C                     MOVE *BLANKS   @OANN  36                                         MD031101
     C           A7OACN    IFNE *BLANKS                                                     MD031101
     C                     MOVE A7OACN    @OANN                                             MD031101
     C                     MOVEL'/'       @OANN                                             MD031101
     C                     ENDIF                                                            MD031101
     C                     MOVEL@OANN     ACLINE                                            MD031101
     C                     ENDIF                                                              CDL094
     C                     MOVE ' '       TAG                             E32363
     C                     MOVE '57'      FLDNO                           E32363
     C/COPY WNCPYSRC,MG0330C033
     C                     EXSR FSWAD                                     E32363
     C/COPY WNCPYSRC,MG0330C034
     C                     END                                            E32363
      *                                                                   E32363
      * If Beneficiary details defined for the Nostro are not blank, output                   CDL094
      * these as field 58                                                                     CDL094
     C           CDL094    IFEQ 'Y'                                                           CDL094
     C           A7RF58    ANDNE*BLANKS                                                       CDL094
      *                                                                                       CDL094
     C                     ADD  1         X                                                   CDL094
     C           X         OCUR MULT                                                          CDL094
      * If SWIFT BIC defined as the Beneficiary then obtain related                           CDL094
      * customer number                                                                       CDL094
     C                     MOVE *IN80     IN80    1                                           CDL094
     C                     MOVEL*BLANKS   WSWID                                               CDL094
     C                     MOVELA7RF58    WSWID                                               CDL094
     C           WSWID     CHAINSDCUSTL7             80                                       CDL094
     C           *IN80     IFEQ *OFF                                                          CDL094
     C                     MOVEL*BLANKS   ZDEST                                               CDL094
     C                     MOVELBBCUST    ZDEST                                               CDL094
     C                     ELSE                                                               CDL094
     C                     MOVEL*BLANKS   ZDEST                                               CDL094
     C                     MOVELA7RF58    ZDEST                                               CDL094
     C                     ENDIF                                                              CDL094
     C                     MOVEL*BLANKS   ACLINE                                              CDL094
     C                     MOVELA7RA58    ACLINE                                              CDL094
     C                     MOVE IN80      *IN80                                               CDL094
      *                                                                                       CDL094
     C                     MOVE ' '       TAG                                                 CDL094
     C                     MOVE '58'      FLDNO                                               CDL094
     C                     EXSR FSWAD                                                         CDL094
     C                     ENDIF                                                              CDL094
      *                                                                                       CDL094
      *
     C                     ELSE
      *
      ** Else the branch code of sender = receive settlement branch
      ** and the settlement is via a nostro.
      *
     C           MGRIBN    IFNE *BLANKS                                   E32363
     C                     ADD  1         X                               E32363
     C           X         OCUR MULT                                      E32363
     C                     MOVE *BLANKS   ZDEST                           E32363
     C                     MOVELMGRIBN    ZDEST                           E32363
     C                     MOVELMGRIBA    ACLINE                          056739
     C                     MOVE ' '       TAG                             E32363
     C                     MOVE '56'      FLDNO                           E32363
     C                     EXSR FSWAD                                     E32363
     C                     END                                            E32363
      *                                                                   E32363
     C           @STM      LOKUPTABNST                   23
      *
     C/COPY WNCPYSRC,MG0330C010
     C           *IN23     IFEQ '1'
     C                     ADD  1         X
     C           X         OCUR MULT
      *                                                                   137909
      ** Use settlement currency to access nostro if not blank.           137909
      ** Otherwise use deal currency.                                     137909
     C           CEU003    IFEQ 'Y'                                       137909
     C           MGSTCY    ANDNE*BLANKS                                   137909
     C           CEU004    OREQ 'Y'                                       137909
     C           MGSTCY    ANDNE*BLANKS                                   137909
     C                     MOVE MGSTCY    @CYCD                           137909
     C                     ELSE                                           137909
     C                     MOVE MGCCY     @CYCD                           137909
     C                     ENDIF                                          137909
      *                                                                   137909
     C******               CALL 'AONOSTR0'                                                    CDL094
     C                     CALL 'AONOSTR1'                                                    CDL094
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM *BLANKS   @CUST   6        I:Customer No
     C***********          PARM MGCCY     @CYCD   3        I:Currency     137909
     C                     PARM           @CYCD   3        I:Currency     137909
     C**********           PARM *BLANKS   @ACCD   4        I:A/c Code                         CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2        I:A/c Seq
     C                     PARM MGRONS    @NONB   2        I:Nostro No
     C                     PARM *BLANKS   @BRCD   3        I:Branch Code
     C                     PARM *BLANKS   @CSSN  10        I:Cust ShortN
     C                     PARM *BLANK    @PNOI   1        I:Prime Nost In
     C***********SDNOST    PARM SDNOST    DSFDY                                               CDL094
     C           SDNOST    PARM SDNOST    DSSDY                                               CDL094
      *
      ** Our receive nostro not found.
      *
     C           @RTCD     IFNE *BLANKS
     C                     MOVE 'Y'       @ERR
     C                     MOVELMGRONS    HLD2    2
     C                     MOVELMGCCY     HLD5
     C                     MOVE HLD2      HLD5    5
     C                     MOVELHLD5      MFLD
     C                     MOVELMSGA,3    MERR
     C                     MOVE ':57 :'   MTAG
     C                     ELSE
      *
      * If CDL094 is On and Delivery Agent details have been defined for                      CDL094
      * the Nostro, use these and not the Customer of the Nostro details                      CDL094
     C           CDL094    IFEQ 'Y'                                                           CDL094
     C           A7RF57    ANDNE*BLANKS                                                       CDL094
      *                                                                                       CDL094
      * If SWIFT BIC defined as the Delivery Agent then obtain related                        CDL094
      * customer number                                                                       CDL094
     C                     MOVE *IN80     IN80    1                                           CDL094
     C                     MOVEL*BLANKS   WSWID                                               CDL094
     C                     MOVELA7RF57    WSWID                                               CDL094
     C           WSWID     CHAINSDCUSTL7             80                                       CDL094
     C           *IN80     IFEQ *OFF                                                          CDL094
     C                     MOVEL*BLANKS   ZDEST                                               CDL094
     C                     MOVELBBCUST    ZDEST                                               CDL094
     C                     ELSE                                                               CDL094
     C                     MOVEL*BLANKS   ZDEST                                               CDL094
     C                     MOVELA7RF57    ZDEST                                               CDL094
     C                     ENDIF                                                              CDL094
     C                     MOVEL*BLANKS   ACLINE                                              CDL094
     C                     MOVELA7RA57    ACLINE                                              CDL094
     C                     MOVE IN80      *IN80                                               CDL094
      *                                                                                       CDL094
     C                     ELSE                                                               CDL094
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELA7CUST    ZDEST
     C                     MOVEL*BLANKS   ACLINE                          056739
     C                     MOVE *BLANKS   @OANN                                             MD031101
     C           A7OACN    IFNE *BLANKS                                                     MD031101
     C                     MOVE A7OACN    @OANN                                             MD031101
     C                     MOVEL'/'       @OANN                                             MD031101
     C                     ENDIF                                                            MD031101
     C                     MOVEL@OANN     ACLINE                                            MD031101
     C                     ENDIF                                                              CDL094
     C                     MOVE ' '       TAG
     C                     MOVE '57'      FLDNO
     C/COPY WNCPYSRC,MG0330C035
     C                     EXSR FSWAD
     C/COPY WNCPYSRC,MG0330C036
     C                     END
      *
      * If Beneficiary details defined for the Nostro are not blank, output                   CDL094
      * these as field 58                                                                     CDL094
     C           CDL094    IFEQ 'Y'                                                           CDL094
     C           A7RF58    ANDNE*BLANKS                                                       CDL094
      *                                                                                       CDL094
     C                     ADD  1         X                                                   CDL094
     C           X         OCUR MULT                                                          CDL094
      * If SWIFT BIC defined as the Beneficiary then obtain related                           CDL094
      * customer number                                                                       CDL094
     C                     MOVE *IN80     IN80    1                                           CDL094
     C                     MOVEL*BLANKS   WSWID                                               CDL094
     C                     MOVELA7RF58    WSWID                                               CDL094
     C           WSWID     CHAINSDCUSTL7             80                                       CDL094
     C           *IN80     IFEQ *OFF                                                          CDL094
     C                     MOVEL*BLANKS   ZDEST                                               CDL094
     C                     MOVELBBCUST    ZDEST                                               CDL094
     C                     ELSE                                                               CDL094
     C                     MOVEL*BLANKS   ZDEST                                               CDL094
     C                     MOVELA7RF58    ZDEST                                               CDL094
     C                     ENDIF                                                              CDL094
     C                     MOVEL*BLANKS   ACLINE                                              CDL094
     C                     MOVELA7RA58    ACLINE                                              CDL094
     C                     MOVE IN80      *IN80                                               CDL094
      *                                                                                       CDL094
     C                     MOVE ' '       TAG                                                 CDL094
     C                     MOVE '58'      FLDNO                                               CDL094
     C                     EXSR FSWAD                                                         CDL094
     C                     ENDIF                                                              CDL094
      *                                                                                       CDL094
     C                     ELSE
      *
      ** Settlement method internal.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C           MGRSTM    IFNE 00
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELSECN      ZDEST
     C                     MOVEL*BLANKS   ACLINE                          056739
     C                     MOVE ' '       TAG
     C                     MOVE '57'      FLDNO
     C                     EXSR FSWAD
      *
      ** No settlement type entered.
      *
     C                     ELSE
     C                     MOVE ':57D:'   MTAG
     C                     MOVEL'UNKNOWN' MFLD
     C                     END
     C                     END
     C/COPY WNCPYSRC,MG0330C011
      *
     C                     END
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   FD53A - Format fields 53.                                   *
      *   Called by - FMTA - Format message detail Seq A              *
      *   Calls     - FD56A  Format fields 56 and 57.                 *
      *             - FSWAD  Format the swift address.                *
      *****************************************************************
      *
     C           FD53A     BEGSR
      *
     C                     MOVE *BLANKS   @WRK
      *
      ** Field 53 - Senders correspondant.
      **  Test if settlement via nostro
      *
     C*********FIX         MOVE MGRSTM    @STM    2
     C                     MOVE MGPSTM    @STM    2
     C           @STM      LOKUPTABNST                   23
      *
      ** If our pay nostro is not blank.
      *
     C           MGPONS    IFNE *BLANKS
     C           *IN23     ANDEQ'1'
      *
      **  either A/C with Bank or Receipient entered
      **  or DIRECT entered                                               088043
      *
     C           MGAWBN    IFNE *BLANKS
     C           AWBA6     OREQ 'DIRECT'                                  088043
     C***********MGRVNO    ORNE *BLANKS
     C/COPY WNCPYSRC,MG0330C012
      *
     C                     MOVELMGPONS    @NONB
      *                                                                   137909
      ** Use settlement currency to access nostro if not blank.           137909
      ** Otherwise use deal currency.                                     137909
     C           CEU003    IFEQ 'Y'                                       137909
     C           MGSTCY    ANDNE*BLANKS                                   137909
     C           CEU004    OREQ 'Y'                                       137909
     C           MGSTCY    ANDNE*BLANKS                                   137909
     C                     MOVE MGSTCY    @CYCD                           137909
     C                     ELSE                                           137909
     C                     MOVE MGCCY     @CYCD                           137909
     C                     ENDIF                                          137909
      *                                                                   137909
     C******               CALL 'AONOSTR0'                                                    CDL094
     C                     CALL 'AONOSTR1'                                                    CDL094
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM *BLANKS   @CUST   6
     C***********          PARM MGCCY     @CYCD   3                       137909
     C                     PARM           @CYCD   3                       137909
     C**********           PARM *BLANKS   @ACCD   4                                           CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2
     C                     PARM           @NONB   2
     C                     PARM *BLANKS   @BRCD   3
     C                     PARM *BLANKS   @CSSN  10
     C                     PARM *BLANKS   @PNOI   1
     C***********SDNOST    PARM SDNOST    DSFDY                                               CDL094
     C           SDNOST    PARM SDNOST    DSSDY                                               CDL094
      *
      **  Nostro customer not found
      *
     C           @RTCD     IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE 'Y'       @ERR
     C                     MOVE ':53 :'   MTAG
     C                     MOVELMGPONS    HLD2
     C                     MOVELMGCCY     HLD5
     C                     MOVE HLD2      HLD5
     C                     MOVELHLD5      MFLD
     C                     MOVELMSGA,3    MERR
     C                     ELSE
      *
      ** Branch Internal Customer cf. Customer number of Our Pay Nostro
      *
     C                     MOVELSECN      @SECN   6
     C           @SECN     IFNE A7CUST
     C           MGAWBN    ANDNEA7CUST
     C                     MOVE *BLANKS   ZDEST
     C           MGRVNO    IFEQ *BLANKS                                   096521
     C                     MOVELA7CUST    ZDEST
     C                     ELSE                                           096521
     C                     MOVELMGRVNO    ZDEST                           096521
     C                     ENDIF                                          096521
     C*********************CALL 'ZM0050'                                  CSW036
     C                     CALL 'ZM0051'                                  CSW036
     C                     PARM           ZDEST  12
     C                     PARM           ZSADD1 35
     C                     PARM           ZSADD2 35
     C                     PARM           ZSADD3 35
     C                     PARM           ZSADD4 35
     C                     PARM           ZSTAG   1
     C                     PARM           ZSTYPE  1
     C                     PARM           ZERR    1
     C                     PARM           ZDBEI                                               CSW201
      *
      **  Error when formating address
      *
     C           ZERR      IFEQ '1'
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE 'Y'       @ERR
     C                     MOVE ':53 :'   MTAG
     C                     MOVELZDEST     MFLD
     C                     MOVELMSGA,5    MERR
     C                     ELSE
      *
      **  A Type address
      *
     C           ZSTAG     IFEQ 'A'
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE 'A'       TAG
     C                     MOVE '53'      FLDNO
     C                     MOVE @MTAG     MTAG
     C                     MOVELZSADD1    MFLD
      *
     C                     ELSE
      *
      **  Access SDCUSTPD using our pay nostro customer number
      *
     C                     MOVE *BLANKS   @KEY1
     C                     MOVELA7CUST    @KEY1
     C                     CALL 'AOCUSTR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           @KEY1  10
     C                     PARM *BLANKS   @KYST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
      ** Customer record not found - Error
      *
     C           @RTCD     IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE 'Y'       @ERR
     C                     MOVE ':53 :'   MTAG
     C                     MOVELA7CUST    MFLD
     C                     MOVE MSGA,2    MERR
      *
     C                     ELSE
      *
      **  B Type address
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C**********           MOVE BBPCNB    @PCNB   60                                          CSD027
     C                     MOVE BBPCNB    @PCNB   6                                           CSD027
     C           SPAIN     IFEQ 'P'
     C           @PCNB     ANDEQSECN
     C           BBPAIN    OREQ 'P'
     C           A7CUST    ANDEQSPCNB
     C           BBPCNB    OREQ SPCNB
     C           BBPCNB    ANDNE*BLANKS
      *
     C                     MOVE ':53B:'   MTAG
     C                     MOVE *BLANKS   @WRK
     C                     MOVELBBCRNM    @WRK,1
     C                     Z-ADD22        J       20
     C                     MOVEABBCRTN    @WRK,J
     C                     MOVEA@WRK      MFLD
      *
      **  D Type address
      *
     C                     ELSE
     C                     MOVE ':53D:'   MTAG
     C                     MOVELZSADD1    MFLD
      **  Address 2
     C           ZSADD2    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD2    MFLD
      **  Address 3
     C           ZSADD3    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD3    MFLD
      **  Address 4
     C           ZSADD4    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD4    MFLD
     C                     END                             D address 4
     C                     END                             D address 3
     C                     END                             D address 2
     C                     END                             B/D address 1
      *
     C                     END                             Cust. error?
      *
     C                     END                             A/B/D address?
     C                     END                             Fmt ad. error.
     C                     END                             Brch Int Cust.
     C                     END                             Nostro not fnd.
     C/COPY WNCPYSRC,MG0330C013
     C                     END
     C                     END                             Pay nostro?
      *
     C                     MOVE 'N'       FLD57O  1
      *
      ** Execute subroutine FD56A to format fields 56 and 57.
      *
     C                     EXSR FD56A
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   FD56A - Format fields 56 and 57.                            *
      *   Called by - FMTA - Format message detail Seq A.             *
      *             - FMTB - Format message detail Seq B.             *
      *   Calls     - FSWAD  Format the swift address.                *
      *****************************************************************
      *
     C           FD56A     BEGSR
      *
      **  Field :57:  A/C with institution non-blank
      *
     C           MGAWBN    IFNE *BLANKS
      *
      **  Field :56:  Pay Intermediary bank
      **  This field is only produced when the account with institution
      **  is non-blank.
      *
      **  If the pay intermediary is entered.
      *
     C           MGPIBN    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELMGPIBN    ZDEST
     C                     MOVELMGPIBA    ACLINE                          056739
     C                     MOVE ' '       TAG
     C                     MOVE '56'      FLDNO
     C                     EXSR FSWAD
     C                     END
      *
      **  Format Account with institution. (Field 57.)
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELMGAWBN    ZDEST
     C                     MOVEL*BLANKS   ACLINE                          056739
     C                     MOVELMGAWBA    ACLINE                          183752
     C                     MOVE ' '       TAG
     C                     MOVE '57'      FLDNO
     C                     EXSR FSWAD
     C                     MOVE 'Y'       FLD57O  1
      *
      **    A/C with Inst. blank
      *
     C                     ELSE
      *                                                                   088043
     C           AWBA6     IFEQ 'DIRECT'                                  088043
      *                                                                   088043
      **  A/C with Inst. set up as DIRECT, use beneficiary details        088043
      **  Format Account with institution. (Field 57.)                    088043
      *                                                                   088043
     C                     ADD  1         X                               088043
     C           X         OCUR MULT                                      088043
     C                     MOVE *BLANKS   ZDEST                           088043
     C                     MOVELMGBENN    ZDEST                           088043
     C                     MOVELMGBENA    ACLINE                          088043
     C                     MOVE ' '       TAG                             088043
     C                     MOVE '57'      FLDNO                           088043
     C/COPY WNCPYSRC,MG0330C005
     C                     EXSR FSWAD                                     088043
     C                     MOVE 'Y'       FLD57O  1                       088043
      *                                                                   088043
      **  A/C with Inst. blank and NOT "DIRECT" entered,                  088043
      *                                                                   088043
     C                     ELSE                                           088043
      *
      **  Field 57 = pay nostro customer if settlement via '02' or '12'
     C           MGPSTM    IFEQ 02
     C           MGPSTM    OREQ 12
     C                     MOVELMGPONS    @NONB
      *                                                                   137909
      ** Use settlement currency to access nostro if not blank.           137909
      ** Otherwise use deal currency.                                     137909
     C           CEU003    IFEQ 'Y'                                       137909
     C           MGSTCY    ANDNE*BLANKS                                   137909
     C           CEU004    OREQ 'Y'                                       137909
     C           MGSTCY    ANDNE*BLANKS                                   137909
     C                     MOVE MGSTCY    @CYCD                           137909
     C                     ELSE                                           137909
     C                     MOVE MGCCY     @CYCD                           137909
     C                     ENDIF                                          137909
      *                                                                   137909
     C******               CALL 'AONOSTR0'                                                    CDL094
     C                     CALL 'AONOSTR1'                                                    CDL094
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM *BLANKS   @CUST   6
     C***********          PARM MGCCY     @CYCD   3                       137909
     C                     PARM           @CYCD   3                       137909
     C**********           PARM *BLANKS   @ACCD   4                                           CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2
     C                     PARM           @NONB   2
     C                     PARM *BLANKS   @BRCD   3
     C                     PARM *BLANKS   @CSSN  10
     C                     PARM *BLANKS   @PNOI   1
     C***********SDNOST    PARM SDNOST    DSFDY                                               CDL094
     C           SDNOST    PARM SDNOST    DSSDY                                               CDL094
      *
      **  Nostro customer not found
      *
     C           @RTCD     IFNE *BLANKS
     C                     MOVE 'Y'       @ERR
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELMGPONS    HLD2    2
     C                     MOVELMGCCY     HLD5
     C                     MOVE HLD2      HLD5    5
     C                     MOVELHLD5      MFLD
     C                     MOVELMSGA,3    MERR
     C                     MOVE ':57 :'   MTAG
     C                     ELSE
      *
      **  Format our Pay Nostro Customer Address
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZDEST
     C           MGRVNO    IFEQ *BLANKS                                   096521
     C                     MOVELA7CUST    ZDEST
     C                     ELSE                                           096521
     C                     MOVELMGRVNO    ZDEST                           096521
     C                     ENDIF                                          096521
     C                     MOVEL*BLANKS   ACLINE                          056739
     C                     MOVE ' '       TAG
     C                     MOVE '57'      FLDNO
     C                     EXSR FSWAD
     C                     END
      *
     C                     ELSE
     C                     MOVE MGPSTM    @STM
     C           @STM      LOKUPTABINT                   23
      *
     C           *IN23     IFEQ '1'
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELSECN      ZDEST
     C                     MOVEL*BLANKS   ACLINE                          056739
     C                     MOVE ' '       TAG
     C                     MOVE '57'      FLDNO
     C/COPY WNCPYSRC,MG0330C037
     C                     EXSR FSWAD
     C/COPY WNCPYSRC,MG0330C038
      *
     C                     ELSE
      *
      **  Field 53 is equal to Our Pay Nostro
     C           MGPSTM    IFNE 00
     C/COPY WNCPYSRC,MG0330C014
     C                     MOVELMGPONS    @NSKYE
      *                                                                   137909
      ** Use settlement currency to access nostro if not blank.           137909
      ** Otherwise use deal currency.                                     137909
     C           CEU003    IFEQ 'Y'                                       137909
     C           MGSTCY    ANDNE*BLANKS                                   137909
     C           CEU004    OREQ 'Y'                                       137909
     C           MGSTCY    ANDNE*BLANKS                                   137909
     C                     MOVE MGSTCY    @NSKYB                          137909
     C                     ELSE                                           137909
     C                     MOVE MGCCY     @NSKYB                          137909
     C                     ENDIF                                          137909
      *                                                                   137909
     C******               CALL 'AONOSTR0'                                                    CDL094
     C                     CALL 'AONOSTR1'                                                    CDL094
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM *BLANKS   @NSKYA  6
     C***********          PARM MGCCY     @NSKYB  3                       137909
     C                     PARM           @NSKYB  3                       137909
     C**********           PARM *BLANKS   @NSKYC  4                                           CGL029
     C                     PARM *BLANKS   @NSKYC                                              CGL029
     C                     PARM *BLANKS   @NSKYD  2
     C                     PARM           @NSKYE  2
     C                     PARM *BLANKS   @KEYF   3
     C                     PARM *BLANKS   @KEYG  10
     C                     PARM *BLANKS   @KEYH   1
     C***********SDNOST    PARM SDNOST    DSFDY                                               CDL094
     C           SDNOST    PARM SDNOST    DSSDY                                               CDL094
     C*
     C**  Nostro customer not found
     C           @RTCD     IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE 'Y'       @ERR
     C                     MOVE ':53 :'   MTAG
     C                     MOVELMGPONS    MFLD
     C                     MOVELMSGA,3    MERR
     C                     ELSE
      *
      **  Format our Pay Nostro Customer Address
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELA7CUST    ZDEST
     C                     MOVEL*BLANKS   ACLINE                          056739
     C                     MOVE ' '       TAG
     C                     MOVE '53'      FLDNO
     C                     EXSR FSWAD
     C                     END
     C/COPY WNCPYSRC,MG0330C015
     C                     END
      *
      **  Settlement 01,07 or 08 with MGAWBN blank or settlement 00
      *
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE ':57D:'   MTAG
     C                     MOVEL'UNKNOWN' MFLD
     C                     END
     C                     END
     C                     END                                            088043
     C                     END
      *
     C/COPY WNCPYSRC,MG0330C043
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   FLD72 - Calculate field 72                                  *
      *   Called by - FMTA - Format message detail Seq A              *
      *****************************************************************
      *
     C           FLD72     BEGSR
      *
     C                     MOVE *BLANKS   @WRK
     C*
     C/COPY WNCPYSRC,MG0330CCP1
     C*
      *
      **  Output /TELEX/
      *
     C           MGBRKC    IFEQ 'TELX'
     C*
     C/COPY WNCPYSRC,MG0330CCP2
     C*
     C                     MOVEA'/TELEX/' @WRK,1
     C                     MOVE '1'       *IN25
     C                     END
      *
      **  Output /PHON/
      *
     C           MGBRKC    IFEQ 'PHON'
     C*
     C/COPY WNCPYSRC,MG0330CCP3
     C*
     C                     MOVEA'/PHON/'  @WRK,1
     C                     MOVE '1'       *IN25
     C                     END
      *
     C           MGBRKC    IFNE 'TELX'
     C           MGBRKC    ANDNE'PHON'
     C           MGBRKC    ANDNE'MAIL'
     C           MGBRKC    ANDNE'SWAP'
     C           MGBRKC    ANDNE*BLANKS
      *
      **  Access the broker file
      *
     C                     CALL 'AOBROKR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM MGBRKC    @BROKY  4
     C           SDBROK    PARM SDBROK    DSFDY
      *
      ** Broker code not found on sdtradpd.
      *
     C           @RTCD     IFNE *BLANKS
     C                     MOVE 'Y'       @ERR
     C                     MOVELMSGA,8    MERR
     C                     MOVEAMGBRKC    @WRK,1
     C                     MOVE '1'       *IN25
      *
      ** Format the broker field.
      *
     C                     ELSE
     C*
     C/COPY WNCPYSRC,MG0330CCP4
     C*
     C                     MOVEA'/BROKER/'@WRK,1
     C                     MOVEAA9BKNM    @WRK,9
     C                     MOVE '1'       *IN25
     C*
     C/COPY WNCPYSRC,MG0330CCP5
     C*
     C                     END
     C                     END
      *
      ** Maximum length of field is 35
     C                     MOVEA@WRK,36   @WRK15 15                       E33129
     C           @WRK15    IFNE *BLANK                                    E33129
     C                     Z-ADD36        J       20                      E33129
     C                     MOVEA*BLANK    @WRK,J                          E33129
     C                     END                                            E33129
      *
      **  Output Field :72: as constructed from above
      *
     C           @WRK,1    IFNE *BLANK
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE ':72: '   MTAG
     C                     MOVEA@WRK      MFLD
     C                     END
      *
      ** Wrap round to the next line the remainder of the BROKER info.    E33129
     C           @WRK15    IFNE *BLANK                                    E33129
     C                     MOVEA*BLANK    @WRK                            E33129
     C                     MOVEA'//'      @WRK,1                          E33129
     C                     MOVEA@WRK15    @WRK,3                          E33129
     C                     ADD  1         X                               E33129
     C           X         OCUR MULT                                      E33129
     C                     MOVEA@WRK      MFLD                            E33129
     C/COPY WNCPYSRC,MG0330C027
     C                     END                                            E33129
      *
      ** If there is a field 72 output from standard program ZM0070.
      *
     C           ZSF72     IFNE *BLANKS
     C*
     C/COPY WNCPYSRC,MG0330CCP6
     C*
      *
      ** If a line has been previously output no tag is needed for
      ** this field. If no line has been output the tag must be :72:.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      ** If there has been no previous field 72.
      *
     C           *IN25     IFEQ '0'
     C                     MOVE ':72: '   MTAG
     C*
     C/COPY WNCPYSRC,MG0330CCP8
     C*
     C                     MOVE '1'       *IN25                                               255986
     C                     END
      *
     C                     MOVELZSF72     MFLD
     C/COPY WNCPYSRC,MG0330C028
      *
     C                     END
      *                                                                   CDL006
      ** If a fiduciary transaction, add fiduciary message confirmation   CDL006
      *                                                                   CDL006
     C           CDL006    IFEQ 'Y'                                       CDL006
      *                                                                   CDL006
      ** Write message 'THIS IS A FIDUCIARY DEPOSIT'                      CDL006
      *                                                                   CDL006
     C           MGTTYP    IFEQ 'DT'                                      CDL006
     C           MGTTYP    OREQ 'DP'                                      CDL006
     C                     MOVEA*BLANK    @WRK                            CDL006
     C                     MOVEA'//'      @WRK,1                          CDL006
     C                     MOVEAMSGA,9    @WRK,3                          CDL006
     C                     ADD  1         X                               CDL006
     C           X         OCUR MULT                                      CDL006
     C                     MOVEA@WRK      MFLD                            CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
      ** Write message 'THIS IS A FIDUCIARY LOAN'                         CDL006
      *                                                                   CDL006
     C           MGTTYP    IFEQ 'LT'                                      CDL006
     C           MGTTYP    OREQ 'LP'                                      CDL006
     C                     MOVEA*BLANK    @WRK                            CDL006
     C                     MOVEA'//'      @WRK,1                          CDL006
     C                     MOVEAMSGA,10   @WRK,3                          CDL006
     C                     ADD  1         X                               CDL006
     C           X         OCUR MULT                                      CDL006
     C                     MOVEA@WRK      MFLD                            CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     ENDIF                                          CDL006
     C*
     C/COPY WNCPYSRC,MG0330CCP7
      ** Check all six Bank to Bank Info fields and output any which                          255986
      ** contain data                                                                         255986
     C                     CLEAR@BTB                                                          255986
     C                     MOVELMGBTB1    @BTB,1                                              255986
     C                     MOVELMGBTB2    @BTB,2                                              255986
     C                     MOVELMGBTB3    @BTB,3                                              255986
     C                     MOVELMGBTB4    @BTB,4                                              255986
     C                     MOVELMGBTB5    @BTB,5                                              255986
     C                     MOVELMGBTB6    @BTB,6                                              255986
      *                                                                                       255986
     C           1         DO   6         CT6     10                                          255986
     C           @BTB,CT6  IFNE *BLANKS                                                       255986
     C                     ADD  1         X                                                   255986
     C           X         OCUR MULT                                                          255986
     C                     MOVE *BLANKS   MTAG                                                255986
      *                                                                                       255986
      **  If this is the first line of field 72 then set tag to ':72: '                       255986
     C           *IN25     IFNE '1'                                                           255986
     C                     MOVE ':72: '   MTAG                                                255986
     C                     MOVE '1'       *IN25                                               255986
     C                     ENDIF                                                              255986
     C                     MOVE *BLANKS   MFLD                                                255986
     C                     MOVE *BLANKS   MERR                                                255986
     C                     MOVEL@BTB,CT6  MFLD                                                255986
     C                     ENDIF                                                              255986
     C                     ENDDO                                                              255986
     C*
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      ****NWAD*-*determine*default*network*addresses*******************   CSW096
      ****Called*by*-*ROUT*determine*message*routing*******************   CSW096
      *****************************************************************   CSW096
      ***********                                                         CSW096
     C***********NWAD      BEGSR                                          CSW096
      ***********                                                         CSW096
      ****Default*is*SWIFT************************************************CSW096
      ***********                                                         CSW096
     C***********BBDNW3    IFEQ 'SWIFT'                                   CSW096
     C***********BBCSID    ANDNE*BLANKS                                   CSW096
     C***********@BIC      ANDNE'BIC'                                     CSW096
     C***********BGMSDL    ANDEQ'Y'                                       CSW096
     C***********          MOVELSCSID     NWSN                            CSW096
     C***********          MOVELBBCSID    NWDS                            CSW096
     C***********          MOVELBBDNW3    NWRK                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****Default*is*TELEX************************************************CSW096
      ***********                                                         CSW096
     C***********BBDNW3    IFEQ 'TELEX'                                   CSW096
     C***********BBTXA1    ANDNE*BLANKS                                   CSW096
     C***********BGMTMI    ANDEQ'Y'                                       CSW096
     C***********          MOVELSTELX     NWSN                            CSW096
     C***********          MOVELBBTXA1    NWDS                            CSW096
     C***********          MOVELBBDNW3    NWRK                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****Default*is*STTX*************************************************CSW096
      ***********                                                         CSW096
     C***********BBDNW3    IFEQ 'STTX'                                    CSW096
     C***********BBSTAD    ANDNE*BLANKS                                   CSW096
     C***********BGMSDL    ANDEQ'Y'                                       CSW096
     C***********          MOVELSSTTX     NWSN                            CSW096
     C***********          MOVELBBSTAD    NWDS                            CSW096
     C***********          MOVELBBDNW3    NWRK                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****Default*is*PAPER************************************************CSW096
      ***********                                                         CSW096
     C***********BBDNW3    IFEQ 'PAPER'                                   CSW096
     C***********          MOVELSCRNM     NWSN                            CSW096
     C***********          MOVELBBCRNM    NWDS                            CSW096
     C***********          MOVELBBDNW3    NWRK                            CSW096
      ***********                                                         CSW096
      ****If*the*ICD*option*for*free*format*confirmations*is*'Y',*********CSW096
      ****the*message*has*already*been*printed*,*hence*no*further*********CSW096
      ****print*out*is*needed.********************************************CSW096
     C***********ENFFCR    IFEQ 'Y'                                       CSW096
     C***********          MOVEL'PRTD'    MGST                            CSW096
     C***********          MOVE '3'       MGSG                            CSW096
     C***********          ELSE                                           CSW096
     C***********          MOVEL'RSND'    MGST                            CSW096
     C***********          MOVE '2'       MGSG                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****Found*to*be*unroutable******************************************CSW096
      ***********                                                         CSW096
     C***********NWRK      IFEQ *BLANKS                                   CSW096
     C***********NWDS      OREQ *BLANKS                                   CSW096
     C***********NWSN      OREQ *BLANKS                                   CSW096
     C***********          MOVELSCRNM     NWSN                            CSW096
     C***********          MOVELBBCRNM    NWDS                            CSW096
     C***********          MOVEL'UNROUT'  NWRK                            CSW096
     C***********          MOVE 'CRTD'    MGST                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          ENDSR                                          CSW096
     C*/EJECT****                                                         CSW096
      *****************************************************************   CSW096
      ****PRAD*-*determine*priority*network*addresses******************   CSW096
      ****Called*by**ROUT****determine*message*routing*****************   CSW096
      ****Calls******TXROUT**priority*routing*to*STTX/Telex************   CSW096
      ***************SWROUT**priority*routing*to*SWIFT*****************   CSW096
      *****************************************************************   CSW096
      ***********                                                         CSW096
     C***********PRAD      BEGSR                                          CSW096
      ***********                                                         CSW096
      ****If*STTX/Telex*has*higher*priority*than*SWIFT*attempt************CSW096
      ****STTX/Telex*routing*first,*followed*by*SWIFT.*(nb.*'Higher'******CSW096
      ****priority*is*numerically*lower*ie.*'1'*is*higher*than*'2')*******CSW096
     C***********BLTXPY    IFLT BLSWPY                                    CSW096
     C***********          EXSR TXROUT                                    CSW096
     C***********          EXSR SWROUT                                    CSW096
      ***********                                                         CSW096
      ****otherwise*attempt*SWIFT*routing*first***************************CSW096
     C***********          ELSE                                           CSW096
     C***********          EXSR SWROUT                                    CSW096
     C***********          EXSR TXROUT                                    CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
      ****If*failed*to*route*to*electronic*network,*produce*paper*********CSW096
     C***********NWRK      IFEQ *BLANKS                                   CSW096
     C***********          MOVEL'PAPER'   NWRK                            CSW096
     C***********          MOVELSCRNM     NWSN                            CSW096
     C***********          MOVELBBCRNM    NWDS                            CSW096
      ***********                                                         CSW096
      ****If*the*ICD*option*for*free*format*advices*is*'Y'*the************CSW096
      ****message*has*already*been*printed*,*hence*no*further*************CSW096
      ****print*out*is*needed.********************************************CSW096
     C***********ENFFCR    IFEQ 'Y'                                       CSW096
     C***********          MOVEL'PRTD'    MGST                            CSW096
     C***********          MOVE '3'       MGSG                            CSW096
     C***********          ELSE                                           CSW096
     C***********          MOVEL'RSND'    MGST                            CSW096
     C***********          MOVE '2'       MGSG                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          ENDSR                                          CSW096
     C*/EJECT****                                                         CSW096
      *****************************************************************   CSW096
      ****TXROUT*-*Attempt*priority*routing*to*STTX/Telex,*if*not******   CSW096
      *************already*routed**************************************   CSW096
      ****Called*by***PRAD*********************************************   CSW096
      ****Calls*******-************************************************   CSW096
      *****************************************************************   CSW096
      ***********                                                         CSW096
     C***********TXROUT    BEGSR                                          CSW096
      ***********                                                         CSW096
      ****If*not*already*routed,*attempt*STTX/Telex*routing***************CSW096
     C***********NWRK      IFEQ *BLANKS                                   CSW096
      ***********                                                         CSW096
      ****Note*that*STTX*and*Telex*are*mutually*exclusive*-*try*both******CSW096
     C***********BGMSDL    IFEQ 'Y'                                       CSW096
     C***********BBSTAD    ANDNE*BLANKS                                   CSW096
     C***********SSTTX     ANDNE*BLANKS                                   CSW096
     C***********          MOVELSSTTX     NWSN                            CSW096
     C***********          MOVELBBSTAD    NWDS                            CSW096
     C***********          MOVEL'STTX'    NWRK                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********BGMTMI    IFEQ 'Y'                                       CSW096
     C***********BBTXA1    ANDNE*BLANKS                                   CSW096
     C***********STELX     ANDNE*BLANKS                                   CSW096
     C***********          MOVELSTELX     NWSN                            CSW096
     C***********          MOVELBBTXA1    NWDS                            CSW096
     C***********          MOVEL'TELEX'   NWRK                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          ENDSR                           TXROUT         CSW096
      ***********                                                         CSW096
     C*/EJECT****                                                         CSW096
      *****************************************************************   CSW096
      ****SWROUT*-*Attempt*priority*routing*to*SWIFT*if*not*already****   CSW096
      *************routed**********************************************   CSW096
      ****Called*by***PRAD*********************************************   CSW096
      ****Calls*******-************************************************   CSW096
      *****************************************************************   CSW096
      ***********                                                         CSW096
     C***********SWROUT    BEGSR                                          CSW096
      ***********                                                         CSW096
      ****If*not*already*routed,*attempt*SWIFT*routing********************CSW096
     C***********NWRK      IFEQ *BLANKS                                   CSW096
     C***********BGMSDL    ANDEQ'Y'                                       CSW096
     C***********BBCSID    ANDNE*BLANKS                                   CSW096
     C***********SCSID     ANDNE*BLANKS                                   CSW096
     C***********@BIC      ANDNE'BIC'                                     CSW096
     C***********          MOVELSCSID     NWSN                            CSW096
     C***********          MOVELBBCSID    NWDS                            CSW096
     C***********          MOVEL'SWIFT'   NWRK                            CSW096
     C***********          END                                            CSW096
      ***********                                                         CSW096
     C***********          ENDSR                           SWROUT         CSW096
     C*/EJECT****                                                         CSW096
      *****************************************************************   CSW096
      ****FILL*-*Fill*up*array*GNR*************************************   CSW096
      ****Called*by*-*ROUT**determine*message*routing******************   CSW096
      *****************************************************************   CSW096
      ***********                                                         CSW096
     C***********FILL      BEGSR                                          CSW096
      ***********                                                         CSW096
      ****Is*message*to*be*generated*as*released*?************************CSW096
      ***********                                                         CSW096
     C***********          MOVE BBDS01    GNR,1                           CSW096
     C***********          MOVE BBDS02    GNR,2                           CSW096
     C***********          MOVE BBDS03    GNR,3                           CSW096
     C***********          MOVE BBDS04    GNR,4                           CSW096
     C***********          MOVE BBDS05    GNR,5                           CSW096
     C***********          MOVE BBDS06    GNR,6                           CSW096
     C***********          MOVE BBDS07    GNR,7                           CSW096
     C***********          MOVE BBDS08    GNR,8                           CSW096
     C***********          MOVE BBDS09    GNR,9                           CSW096
     C***********          MOVE BBDS10    GNR,10                          CSW096
     C***********          MOVE BBDS11    GNR,11                          CSW096
     C***********          MOVE BBDS12    GNR,12                          CSW096
     C***********          MOVE BBDS13    GNR,13                          CSW096
     C***********          MOVE BBDS14    GNR,14                          CSW096
     C***********          MOVE BBDS15    GNR,15                          CSW096
      ***********                                                         CSW096
     C***********          ENDSR                                          CSW096
     C/EJECT
      *****************************************************************
      *   REPT - print incorrectly generated messages                 *
      *   Called by - main process                                    *
      *****************************************************************
      *
     C           REPT      BEGSR
      *
      ** If MG0330P1 has not previously opened.
      *
     C           *IN50     IFEQ '0'
     C                     OPEN MG0330P1
     C                     SETON                     50                   084320
     C************         SETON                     50U7                 084320
     C                     END
      *
     C                     WRITEHEADER
     C                     WRITETEXT
      *
      **  Process multiple occurrence data structure
      *
     C                     Z-ADD0         I       20
     C           I         DOWLEX
     C                     ADD  1         I
     C           I         OCUR MULT
     C                     WRITELINE
     C                     END
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   OMSG - output correctly generated messages                  *
      *   Called by - main process                                    *
      *   Calls - WREF Write o/p reference to PF/MGOREFPD.            *
      *****************************************************************
      *
     C           OMSG      BEGSR
      *
      ** Write reference record to PF/MGOREFPD.
      *
     C                     EXSR WREF
      *
      **  Write multiple occurrence data structure to MGOMSGPD
      *
     C                     Z-ADD1         X       20
     C           X         OCUR MULT
      *
     C***********X         DOWLE40                                        CSW200
     C***********MFLD      ANDNE*BLANKS                                   CSW200
     C           X         DOWLE94                                        CSW200
     C           MFLD      ANDNE*BLANKS                                   CSW200
     C           X         ORLE 94                                        CSW200
     C           MTAG      ANDNE*BLANKS                                   CSW200
     C                     WRITEMGOMSGD0               06
      *
      **  Error on write to PF/MGOMSGPD (message data file)
      *
     C           *IN06     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '012'     DBASE              * * * * * * *
     C                     MOVEL'       ' DBKEY              * DBERR 012 *
     C                     MOVEL'MGOMSGPD'DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
     C/COPY WNCPYSRC,MG0330C006
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
      *                                                                   183583
      ** Write multiple occurrence data structure to MGOEXTPD             183583
      *                                                                   183583
     C                     Z-ADD1         V       20                      183583
     C           V         OCUR EXTN                                      183583
     C           V         DOWLE20                                        183583
     C           MCSI      ANDNE*BLANKS                                   183583
     C                     WRITEMGOEXTD0               06                 183583
      *                                                                   183583
      ** Error on write to PF/MGOEXTPD (message data extension file)      183583
      *                                                                   183583
     C           *IN06     IFEQ '1'                                       183583
     C           *LOCK     IN   LDA                                       183583
     C                     MOVE '028'     DBASE            ************** 183583
     C                     MOVEL'        'DBKEY            * DBERROR 28 * 183583
     C                     MOVEL'MGOEXTPD'DBFILE           ************** 183583
     C                     OUT  LDA                                       183583
     C                     EXSR *PSSR                                     183583
     C                     ENDIF                                          183583
     C                     ADD  1         V                               183583
     C           V         OCUR EXTN                                      183583
     C                     ENDDO                                          183583
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   CFMAT - produce confirmation matching feedback record       *
      *   Called by   Main process                                    *
      *   Calls       -                                               *
      *****************************************************************
      *
     C           CFMAT     BEGSR
      *
     C                     CALL 'MG5001'
     C                     PARM TRNO      @TRNM  16
     C                     PARM MGBRCA    @BRCA   3
     C                     PARM *BLANK    @FEED   1
      *
     C           @FEED     IFEQ 'Y'
      *
     C           *IN50     IFEQ '0'
     C                     OPEN MG0330P1
     C                     SETON                     50U7
     C                     END
      *
      **   Set up headings and sender/customer information
      **       for the error report
     C                     MOVE '1'       *IN30
     C                     MOVELMGTNUM    TNUM    60
     C                     WRITEHEADER
     C                     WRITETEXT
     C                     WRITEFEED
     C                     MOVE '0'       *IN30
     C                     END
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   WREF - Write reference record to PF/MGOREFPD                *
      *   Called by - OMSG  output message PF/MGOMSGPD                *
      *****************************************************************
      *
     C           WREF      BEGSR
      *
     C                     MOVE *BLANKS   SYTM
     C                     MOVE MGMODI    MODI
     C                     MOVE @TRNA     TRNO
     C                     MOVE *BLANKS   TRNF
     C                     MOVE *BLANKS   TRNM
     C                     MOVELMGTNUM    MTRN
     C                     MOVE MGTTYP    TNTP
     C                     MOVE MGTSTP    SBTP
     C                     MOVE MGEVTP    EVTP                            E29588
     C                     Z-ADDMGAVDT    AVDT                            E29588
     C                     Z-ADDMGASEQ    ASEQ                            E29588
     C                     MOVEL*BLANKS   NWBN
     C                     MOVE '330'     MTPY
     C                     MOVE 'N'       MPRY
     C                     MOVELCWRD      LSCC
     C                     MOVEL*BLANKS   PTST
     C                     MOVEL*BLANKS   CARQ
     C                     MOVEL*BLANKS   MPDE
     C                     MOVEL@HRDT     HRDT
     C                     TIME           MGTM
     C                     MOVE BJMRDT    LADT
     C                     MOVE MGTM      LATM
      *                                                                                       CSD015
      ** Initiate the Midas Watch List Checking Engine if CSD015 is                           CSD015
      ** enabled and CSW025 is disabled.                                                      CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           222385
     C           CSW025    ANDEQ'N'                                                           CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *
     C           MGST      IFEQ 'CRTD'
     C                     MOVE '1'       MGSG
     C                     END
     C           MGST      IFEQ 'RSND'
     C                     MOVE BJMRDT    RELD
     C                     MOVE MGTM      RELT
     C                     MOVE '2'       MGSG
     C                     END
     C           MGST      IFEQ 'PRTD'
     C                     MOVE '3'       MGSG
     C                     END
     C/COPY WNCPYSRC,MG0330C002
      *
     C                     MOVEL*BLANKS   RUSR
     C                     MOVEL*BLANKS   RWSN
     C                     MOVEL*BLANKS   AMTS
     C                     MOVEL*BLANKS   AMTX
     C                     MOVEL*BLANKS   SVDT
     C                     MOVEL*BLANKS   CINDV                           141572
     C                     MOVEL*BLANKS   CCY
     C                     MOVEL*BLANKS   NSNO
     C                     MOVEL*BLANKS   SACN
     C                     MOVEL*BLANKS   AORR
     C                     MOVEL*BLANKS   DESI
      *
      **  Branch details
      *
     C                     MOVE MGBRCA    BRCA
     C                     MOVE MGPOBR    OTHB
     C           OTHB      IFNE *BLANKS
     C                     MOVELMSGA,1    OTHT
     C                     END
     C                     MOVE MGROBR    RCBR
      *
     C                     MOVE *BLANKS   NETI
     C                     MOVE *BLANKS   DELC
     C                     MOVE *BLANKS   DYST
     C                     MOVE *BLANKS   RSID
     C                     MOVE *BLANKS   MSE1
     C                     MOVE *BLANKS   ELIN
     C                     MOVE *BLANKS   SSAC
     C                     MOVE *BLANKS   MIR
     C                     MOVE *BLANKS   TSKS
     C                     MOVE *BLANKS   TSKY
     C           CSW200    IFEQ 'Y'                                       186781
     C           MGAMTP    ANDEQ'SC'                                      186781
     C                     MOVEL'Y'       CFPF                            186781
     C                     END                                            186781
     C                     MOVE MGCHTP    AORR                                                CSW025
     C/COPY WNCPYSRC,MG0330C022
      *
     C                     WRITEMGOREFD0               05
      *
      **  Error on write to PF/MGOREFPD (message reference file)
      *
     C           *IN05     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '014'     DBASE              * * * * * * *
     C                     MOVEL'       ' DBKEY              * DBERR 014 *
     C                     MOVEL'MGOREFPD'DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C           CSW200    IFEQ 'Y'                                       186781
     C           CFPF      ANDNE*BLANKS                                   186781
     C                     MOVEL*BLANKS   CFPF                            186781
     C                     END                                            186781
      *
      ** Write transaction history record                                                     190127
     C                     MOVELTRNO      @HREF                                               190127
     C                     MOVE '330'     HSMTPY                                              190127
      *                                                                                       190127
     C                     WRITEMGHISTD0               56                                     190127
      *                                                                                       190127
      **  Error on write to PF/MGHISTPD                                                       190127
     C           *IN56     IFEQ '1'                                                           190127
     C           *LOCK     IN   LDA                                                           190127
     C                     MOVE '027'     DBASE            * * * * * * * *                    190127
     C                     MOVEL'       ' DBKEY            *  DBERR 027  *                    190127
     C                     MOVEL'MGHISTPD'DBFILE           * * * * * * * *                    190127
     C                     OUT  LDA                                                           190127
     C                     EXSR *PSSR                                                         190127
     C                     END                                                                190127
      *
     C/COPY WNCPYSRC,MG0330C007
     C                     ENDSR
     C/COPY WNCPYSRC,MG0330C023
     C/EJECT
     C********************************************************************066550
     C***GLINTC**To calculate interest between any two day numbers     .  066550
     C*****Calculation methods are -                                      066550
     C*****1**ACTUAL/365                                                  066550
     C*****2**ACTUAL/360                                                  066550
     C*****3**360/360 (SOMETIMES CALLED 30/360)                           066550
     C*****4**365/365 (EXCLUDING 29/02)                                   066550
     C*****5**365/360 (EXCLUDING 29/02)                                   066550
     C*****6**ACTUAL/366                                                  066550
     C***********                                                         066550
     C*****Calls*         ZSAVE                                           066550
     C***********         ZDATE2                                          066550
     C***********         ZRSTOR                                          066550
     C********************************************************************066550
     C***********                                                         066550
     C***********GLINTC    BEGSR                           ** GLINTC  **  066550
     C***********                                                         066550
     C****Calculations to define input fields.                            066550
     C***********          Z-ADDZIBEG     ZIBEG   50       starting date  066550
     C***********          Z-ADDZIEND     ZIEND   50       finishing date 066550
     C***********          Z-ADDZICALC    ZICALC  10       calc. basis    066550
     C***********          Z-ADDZIAMT     ZIAMT  150       principal      066550
     C***********          Z-ADDZIRATE    ZIRATE 117       rate of intrst 066550
     C***********                                                         066550
     C***To*determine number of days interest to be calculated            066550
     C***********ZIEND     SUB  ZIBEG     ZDAYN1  50                      066550
     C***********                                                         066550
     C****Check*for interest calculation basis                            066550
     C****Use*of*indicators                                               066550
     C*****1-92**2-90  3-91  4-97  5-96  6-95                             066550
     C***********          SETOF                     959697               066550
     C***********ZICALC    COMP 2                    919290               066550
     C**N91******          GOTO ZICAL                                     066550
     C***********ZICALC    COMP 5                    959796               066550
     C***97******ZICALC    COMP 3                    97  91               066550
     C***95******                                                         066550
     C*R*96******          SETOF                     91                   066550
     C**N91******          GOTO ZILPCK                                    066550
     C***********                                                         066550
     C****This*coding will calculate the number of days to use when       066550
     C****using*the 30/360 basis - METHOD 3.                              066550
     C***********          EXSR ZSAVE                                     066550
     C***********          Z-ADDZIBEG     ZDAYNO                          066550
     C***********          EXSR ZDATE2                                    066550
     C***********          MOVE ZDAY      ZISD    20                      066550
     C***********          MOVE ZMTH      ZISM    20                      066550
     C***********          MOVE ZYEAR     ZISY    20                      066550
     C***********          Z-ADDZIEND     ZDAYNO                          066550
     C***********          EXSR ZDATE2                                    066550
     C***********          MOVE ZDAY      ZIFD    20                      066550
     C***********          MOVE ZMTH      ZIFM    20                      066550
     C***********          MOVE ZYEAR     ZIFY    20                      066550
     C***********          EXSR ZRSTOR                                    066550
     C***********          SETOF                     93                   066550
     C****In*order for the finish year to be less than the start year if  066550
     C****ZIEND*is greater than ZIBEG, then the date ZIEND must be in a   066550
     C****different century to ZIBEG. If so add 100 years to it.          066550
     C***********ZIEND     COMP ZIBEG                93                   066550
     C***93******ZIFY      COMP ZISY                   93                 066550
     C***********          Z-ADDZISY      ZISY2   30                      066550
     C**N93******          Z-ADDZIFY      ZIFY2   30                      066550
     C***93******ZIFY      ADD  100       ZIFY2                           066550
     C***********                                                         066550
     C*****Determine whether start year is a leap year and if start       066550
     C*****month*is February.                                             066550
     C***********                                                         066550
     C**N98******          BITOF'0'       ZGLBIT  1                       066550
     C***98******          BITON'0'       ZGLBIT                          066550
     C***********ZISY2     ADD  1900      ZLYCHK  40                      066550
     C***********ZLYCHK    DIV  4         ZLYCHK                          066550
     C***********          MVR            ZLYREM  20                      066550
     C***********ZLYREM    COMP *ZERO                    98*LEAP YEAR     066550
     C***********ZISM      COMP 2                        99*FEBRUARY      066550
     C**N99******30        SUB  ZISD      ZID1    50   93                 066550
     C**N99*93***          Z-ADD0         ZID1                            066550
     C***99N98***28        SUB  ZISD      ZID1                            066550
     C***99*98***29        SUB  ZISD      ZID1                            066550
     C***********ZISM      COMP 12                       93               066550
     C***93******          Z-ADD0         ZISM                            066550
     C***93******ZISY      ADD  1         ZISY                            066550
     C***93******ZISY2     ADD  1         ZISY2                           066550
     C***********                                                         066550
     C*****Determine whether end year is a leap year and is end month     066550
     C*****is*February.                                                   066550
     C***********                                                         066550
     C***********ZIFY2     ADD  1900      ZLYCHK  40                      066550
     C***********ZLYCHK    DIV  4         ZLYCHK                          066550
     C***********          MVR            ZLYREM  20                      066550
     C***********ZLYREM    COMP *ZERO                    98*LEAP YEAR     066550
     C***********ZIFM      COMP 2                        99*FEBRUARY      066550
     C**N99******ZIFD      COMP 31                       93               066550
     C***99N98***ZIFD      COMP 28                       93               066550
     C***99*98***ZIFD      COMP 29                       93               066550
     C***********          SETOF                     98                   066550
     C***********          TESTB'0'       ZGLBIT         98               066550
     C***93******ZID1      ADD  30        ZID1                            066550
     C**N93******ZID1      ADD  ZIFD      ZID1                            066550
     C***********ZIFM      SUB  1         ZIFM                            066550
     C***********ZISY      COMP ZIFY                     93               066550
     C***93******ZIFM      SUB  ZISM      ZINOM   30                      066550
     C***93******          GOTO ZIOUT                                     066550
     C***********12        SUB  ZISM      ZIM1    20                      066550
     C***********          Z-ADD1         ZISM                            066550
     C****Use*enlarged fields that can handle 1999 onwards.               066550
     C***********ZISY2     ADD  1         ZISY2                           066550
     C***********ZIFY2     SUB  ZISY2     ZIY1    20                      066550
     C***********ZIY1      MULT 12        ZIM2    30                      066550
     C***********ZIM2      ADD  ZIFM      ZIM2                            066550
     C***********ZIM1      ADD  ZIM2      ZINOM                           066550
     C***********ZIOUT     TAG                             * ZIOUT TAG *  066550
     C***********ZINOM     MULT 30        ZID2    50                      066550
     C***********ZID2      ADD  ZID1      ZDAYN1                          066550
     C***********          SETOF                     93                   066550
     C***********ZILPCK    TAG                             * ZILPCK TAG * 066550
     C**N96N97***          GOTO ZICAL                                     066550
     C****The*following code applies for methods  4 and 5 only.           066550
     C****1*day*is subtracted from ZDAYN1 for each occurance of 29 FEB    066550
     C****in*the*interest calculation period inclusive of ZIBEG, & ZIEND. 066550
     C***********                                                         066550
     C****Find*no. of 4 year periods between dates                        066550
     C***********ZDAYN1    DIV  1461      ZIMAN   20                      066550
     C***********          MVR            ZIREM   50                      066550
     C****Find*next 29 Feb day no. on or after ZIBEG.                     066550
     C***********ZIBEG     SUB  60        ZIBW1   50                      066550
     C***********ZIBW1     DIV  1461      ZIDW1   20                      066550
     C***********          MVR            ZIDREM  50                      066550
     C***********ZIDREM    COMP 0                        94               066550
     C***94******          Z-ADDZIBEG     ZIDW2   50                      066550
     C***94******          GOTO ZILP1                                     066550
     C****Round*up result.                                                066550
     C***********ZIDW1     ADD  1         ZIDW2                           066550
     C****Calculate next 29 Feb.                                          066550
     C***********ZIDW2     MULT 1461      ZIDW2                           066550
     C***********ZIDW2     ADD  60        ZIDW2                           066550
     C***********ZILP1     TAG                             * ZILP1 TAG *  066550
     C****If*this next 29 Feb. DAYNO - ZIBEG is Gr. Th. or EQ. To         066550
     C*****ZIREM*then add 1 to ZIMAN.                                     066550
     C***********ZIDW2     SUB  ZIBEG     ZILPCP  50                      066550
     C***********ZIREM     COMP ZILPCP               94  94               066550
     C***94******ZIMAN     ADD  1         ZIMAN                           066550
     C****Subtract ZIMAN from ZDAYN1 to give value of ZDAYN1              066550
     C****required for this interest calculation.                         066550
     C***********ZDAYN1    SUB  ZIMAN     ZDAYN1                          066550
     C***********          SETOF                     94                   066550
     C***********ZICAL     TAG                             * ZICAL TAG *  066550
     C***********                                                         066550
     C****Calculate interest                                              066550
     C***90******                                                         066550
     C*R*91******                                                         066550
     C*R*96******ZIAMT     DIV  36000     ZIWRK1 155H                     066550
     C***92******                                                         066550
     C*R*97******ZIAMT     DIV  36500     ZIWRK1    H                     066550
     C***95******ZIAMT     DIV  36600     ZIWRK1    H                     066550
     C***********ZIWRK1    MULT ZIRATE    ZIWRK2 155H                     066550
     C***********ZIWRK2    MULT ZDAYN1    ZINTR  152H      amt. of intrst 066550
     C***********                                                         066550
     C***********          SETOF                     909192               066550
     C***********          SETOF                     959697               066550
     C***********                                                         066550
     C***********          ENDSR                                          066550
     C********************************************************************066550
     C/EJECT
     C********************************************************************
     C**
     C**   ZSAVE SR. TO MEMORISE THE SETTINGS AND TO SET OFF INDICATORS
     C**              90 - 97 BEFORE EXECUTION OF A Z-SUBROUTINE.
     C**
     C**   THIS SR. IS REQUIRED ONLY IF INDICATORS
     C**   90 - 97 ARE USED ELSEWHERE IN A PROGRAM.
     C**
     C           ZSAVE     BEGSR                           *** ZSAVE ***
     C**
     C                     BITOF'01234567'ZBITS   1
     C   90                BITON'0'       ZBITS
     C   91                BITON'1'       ZBITS
     C   92                BITON'2'       ZBITS
     C   93                BITON'3'       ZBITS
     C   94                BITON'4'       ZBITS
     C   95                BITON'5'       ZBITS
     C   96                BITON'6'       ZBITS
     C   97                BITON'7'       ZBITS
     C**
     C                     SETOF                     909192
     C                     SETOF                     939495
     C                     SETOF                     9697
     C**
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C**   ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.
     C**
     C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
     C**
     C           ZDATE2    BEGSR                           *** ZDATE2 ***
     C**
     C**   CLEAR LEAP YEAR WORK FIELD.
     C                     MOVE 'N'       ZLEAP   1
     C**
     C**   CLEAR DATE FIELDS.
     C                     Z-ADD0         ZDATE   60
     C                     MOVEL'       ' ZADATE  7
     C**
     C**   CALCULATION TO DEFINE INPUT DAY NUMBER.
     C                     Z-ADDZDAYNO    ZDAYNO  50
     C**
     C**   DETERMINE YEAR NUMBER.
     C**
     C**   ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.
     C           ZDAYNO    SUB  1         ZDAYN1  50
     C           ZDAYN1    IFLT 0
     C                     GOTO Z2END2
     C                     END
     C**
     C**   CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.
     C           ZDAYN1    DIV  1461      ZLYR    20
     C                     MVR            ZDAYN1           SAVE REMAINING
     C**                                                   DAYS
     C**   CALCULATE NUMBER OF REMAINING YEARS.
     C                     Z-ADD1         ZWRK2   20
     C           Z2TAG1    TAG                             ** Z2TAG1 TAG **
     C           ZDAYN1    IFGE ZYDY,ZWRK2
     C           ZWRK2     ADD  1         ZWRK2
     C                     GOTO Z2TAG1
     C                     END
     C*
     C           ZWRK2     SUB  1         ZWRK2
     C**
     C**   DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.
     C           ZWRK2     IFNE 0
     C           ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1
     C                     END
     C**
     C**   CALCULATE ACTUAL YEAR NUMBER.
     C           ZLYR      MULT 4         ZWRK3   30
     C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972
     C                     Z-ADDZWRK3     ZYEAR   20
     C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR
     C**
     C**   DETERMINE MONTH NUMBER.
     C**
     C**   ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.
     C           ZWRK2     IFEQ 0
     C           ZDAYN1    IFEQ 59
     C                     MOVE 'Y'       ZLEAP
     C                     END
     C           ZDAYN1    IFGE 59
     C           ZDAYN1    SUB  1         ZDAYN1
     C                     END
     C                     END
     C**
     C**   CALCULATE MONTH NUMBER.
     C                     Z-ADD2         ZWRK2
     C           Z2TAG2    TAG                             ** ZDTAG2 TAG *
     C           ZDAYN1    IFGE ZMDY,ZWRK2
     C           ZWRK2     ADD  1         ZWRK2
     C                     GOTO Z2TAG2
     C                     END
     C*
     C           ZWRK2     SUB  1         ZWRK2
     C**
     C                     Z-ADDZWRK2     ZMTH    20       MONTH
     C**
     C**   DETERMINE DAY OF MONTH.
     C**
     C**   ADD BACK LAST DAY OF YEAR ADJUSTMENT.
     C           ZDAYN1    ADD  1         ZDAYN1
     C**
     C**   CALCULATE DAY OF MONTH.
     C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY
     C**
     C**   ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.
     C           ZLEAP     IFEQ 'Y'
     C           ZDAY      ADD  1         ZDAY
     C                     END
     C**
     C**   FORMAT DATE, DDMMYY OR MMDDYY.
     C  N98                MOVELZDAY      ZWRK4   40
     C   98                MOVE ZDAY      ZWRK4
     C  N98                MOVE ZMTH      ZWRK4
     C   98                MOVELZMTH      ZWRK4
     C                     MOVELZWRK4     ZDATE
     C                     MOVE ZYEAR     ZDATE
     C**
     C**   FORMAT ALPHA DATE, DDMMMYY.
     C                     MOVELZDAY      ZWRK5   5
     C           ZDAY      IFLT 10
     C                     MOVEL' '       ZWRK5
     C                     END
     C                     MOVE ZMNM,ZMTH ZWRK5
     C                     MOVELZWRK5     ZADATE
     C                     MOVE ZYEAR     ZADATE
     C**
     C           Z2END2    ENDSR                           * ZDEND2 ENDSR*
     C**
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C*    ZRSTOR SR. To restore indicators 90 - 97 to the settings
     C*               they had before the execution of SR. ZSAVE.
      *****************************************************************
     C*
     C           ZRSTOR    BEGSR                           *** ZRSTOR ***
     C*
     C                     TESTB'0'       ZBITS          90
     C                     TESTB'1'       ZBITS          91
     C                     TESTB'2'       ZBITS          92
     C                     TESTB'3'       ZBITS          93
     C                     TESTB'4'       ZBITS          94
     C                     TESTB'5'       ZBITS          95
     C                     TESTB'6'       ZBITS          96
     C                     TESTB'7'       ZBITS          97
     C*
     C                     ENDSR
      *****************************************************************
     C/EJECT
      *****************************************************************
      *   INIT - inital process                                       *
      *   Called by - main process                                    *
      *****************************************************************
      *
     C           INIT      BEGSR
      *
     C                     MOVEACPY@      BIS@   80
      *
      **  Set up LDA
      *
     C           *NAMVAR   DEFN           LDA
     C           *LOCK     IN   LDA
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     MOVEL'MG0330'  DBPGM
     C                     MOVE *BLANKS   DBASE
     C                     OUT  LDA
      *
      **  Access SDBANKPD for report title
      *
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
      *
      ** Record not found on sdbankpd
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '001'     DBASE              * * * * * * *
     C                     MOVEL'FIRST'   DBKEY              * DBERR 001 *
     C                     MOVEL'SDBANKPD'DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C* Correctly work out Date Format                                    066600
     C*                                                                   066600
     C           BJDFIN    COMP 'M'                      98MMDDYY,*98*ON  066600
      *
      **  Access SDTRADPD for trading information
      *
     C                     CALL 'AOTRADR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDTRAD    PARM SDTRAD    DSFDY
      *
      ** Record not found on sdtradpd.
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '002'     DBASE              * * * * * * *
     C                     MOVEL'FIRST'   DBKEY              * DBERR 002 *
     C                     MOVEL'SDTRADPD'DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Access SDMMODPD for modules available
      *
     C                     CALL 'AOMMODR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C           SDMMOD    PARM SDMMOD    DSFDY
      *
      ** Record not found on sdmmodpd.
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '003'     DBASE              * * * * * * *
     C                     MOVEL'FIRST'   DBKEY              * DBERR 003 *
     C                     MOVEL'SDMMODPD'DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Access SDMGMEPD for message management data.
      *
     C                     CALL 'AOMGMER0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C           SDMGME    PARM SDMGME    DSFDY
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '027'     DBASE            * * * * * * * *
     C                     MOVEL'FIRST'   DBKEY            *  DBERR 027  *
     C                     MOVEL'SDMGMEPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Initialise constant fields
      *
     C                     MOVE *LOVAL    CR      1
     C                     BITON'457'     CR
     C                     MOVE *LOVAL    LF      1
     C                     BITON'257'     LF
     C                     MOVELCR        CRLF    2
     C                     MOVE LF        CRLF
     C                     MOVE ':'       COLON1
     C                     MOVE ':'       COLON2
      *
      **  CRLF Control Character for message data records
      *
     C                     MOVE CRLF      CTRC
      *
      **  Convert run date to YYMMDD, for Message Generation Date
      *
     C                     CALL 'ZM0060'               15
     C                     PARM BJRDNB    ZMDAY   50
     C                     PARM           ZSDATE  6
      *
      ** If the program ends in error.
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '004'     DBASE              * * * * * * *
     C                     MOVEL'       ' DBKEY              * DBERR 004 *
     C                     MOVEL'ZM0060'  DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     MOVE ZSDATE    MGDE
      *                                                                   113352
      ** Set-up Message Generation  Century flag                          113352
      *                                                                   113352
     C                     MOVELMGDE      YY      20                      113352
     C           YY        IFLT 72                                        113352
     C                     MOVE '2'       CIND                            113352
     C                     ELSE                                           113352
     C                     MOVE '1'       CIND                            113352
     C                     ENDIF                                          113352
      *
      **  Convert history retention date to YYMMDD
      *
     C           BJRDNB    ADD  ENDSMN    ZMDAY
     C                     CALL 'ZM0060'               15
     C                     PARM           ZMDAY
     C                     PARM           ZSDATE
      *
      ** If the program ends in error.
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '006'     DBASE              * * * * * * *
     C                     MOVEL'       ' DBKEY              * DBERR 006 *
     C                     MOVEL'ZM0060'  DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     MOVE ZSDATE    @HRDT   6
      *                                                                   CSW096
      **  Check if SWIFT Changes 1996 (CSW096) is installed               CSW096
      *                                                                   CSW096
     C                     CALL 'SWIFT96'                                 CSW096
     C                     PARM *BLANKS   @RTCD   7                       CSW096
      *                                                                   CSW096
     C           @RTCD     IFEQ 'CSW096'                                  CSW096
     C                     MOVE 'Y'       CSW096  1                       CSW096
     C                     ELSE                                           CSW096
     C                     MOVE 'N'       CSW096                          CSW096
     C                     ENDIF                                          CSW096
     C/COPY WNCPYSRC,MG0330C003
      *                                                                   137909
      **  Access Switchable Features file for CEU003                      137909
      *                                                                   137909
     C                     CALL 'AOSARDR0'                                137909
     C                     PARM *BLANKS   @RTCD                           137909
     C                     PARM '*VERIFY' @OPTN                           137909
     C                     PARM 'CEU003'  @SARD   6                       137909
     C           @RTCD     IFEQ *BLANKS                                   137909
     C                     MOVEL'Y'       CEU003  1                       137909
     C                     ELSE                                           137909
     C                     MOVEL'N'       CEU003                          137909
     C                     ENDIF                                          137909
      *                                                                   137909
      **  Access Switchable Features file for CEU004                      137909
      *                                                                   137909
     C                     CALL 'AOSARDR0'                                137909
     C                     PARM *BLANKS   @RTCD                           137909
     C                     PARM '*VERIFY' @OPTN                           137909
     C                     PARM 'CEU004'  @SARD   6                       137909
     C           @RTCD     IFEQ *BLANKS                                   137909
     C                     MOVEL'Y'       CEU004  1                       137909
     C                     ELSE                                           137909
     C                     MOVEL'N'       CEU004                          137909
     C                     ENDIF                                          137909
      *                                                                   CDL006
      ** Access Switchable Features file to check if Dealing Fiducia      CDL006
      ** ry is installed.                                                 CDL006
      *                                                                   CDL006
     C                     MOVE 'N'       CDL006  1                       CDL006
     C                     CALL 'AOSARDR0'                                CDL006
     C                     PARM *BLANKS   WRTCD   7                       CDL006
     C                     PARM '*VERIFY' WOPTN   7                       CDL006
     C                     PARM 'CDL006'  WSARD   6                       CDL006
     C           SCSARD    PARM SCSARD    DSFDY                           CDL006
      *                                                                   CDL006
     C           WRTCD     IFNE *BLANKS                                   CDL006
     C           WRTCD     ANDNE'*NRF   '                                 CDL006
     C           *LOCK     IN   LDA                                       CDL006
     C                     Z-ADD028       DBASE             ************* CDL006
     C                     MOVEL'SCSARDPD'DBFILE            * DBERR 028 * CDL006
     C                     MOVELWRTCD     DBKEY             ************* CDL006
     C                     OUT  LDA                                       CDL006
     C                     EXSR *PSSR                                     CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C           WRTCD     IFEQ *BLANK                                    CDL006
     C                     MOVEL'Y'       CDL006                          CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CSW200
     C**  Access Switchable Features file for Enhanced Rollovers          CSW200
      *                                                                   CSW200
     C                     MOVE 'N'       S01434  1                       CSW200
     C                     CALL 'AOSARDR0'                                CSW200
     C                     PARM *BLANKS   WRTCD   7                       CSW200
     C                     PARM '*VERIFY' WOPTN   7                       CSW200
     C                     PARM 'S01434'  WSARD   6                       CSW200
     C           SCSARD    PARM SCSARD    DSFDY                           CSW200
      *                                                                   CSW200
     C           WRTCD     IFNE *BLANKS                                   CSW200
     C           WRTCD     ANDNE'*NRF   '                                 CSW200
     C           *LOCK     IN   LDA                                       CSW200
     C                     Z-ADD029       DBASE             ************* CSW200
     C                     MOVEL'SCSARDPD'DBFILE            * DBERR 029 * CSW200
     C                     MOVELWRTCD     DBKEY             ************* CSW200
     C                     OUT  LDA                                       CSW200
     C                     EXSR *PSSR                                     CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C           WRTCD     IFEQ *BLANK                                    CSW200
     C                     MOVEL'Y'       S01434                          CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      **  Check if SWIFT Changes 2000 (CSW200) is installed               CSW200
      *                                                                   CSW200
     C                     CALL 'SWIF2000'                                CSW200
     C                     PARM *BLANKS   @RTCD   7                       CSW200
      *                                                                   CSW200
     C           @RTCD     IFEQ 'CSW200'                                  CSW200
     C                     MOVE 'Y'       CSW200  1                       CSW200
     C                     ELSE                                           CSW200
     C                     MOVE 'N'       CSW200                          CSW200
     C                     ENDIF                                          CSW200
      *                                                                                       CSW024
      ** Check if switchable feature CSW024 is switched on                                    CSW024
     C                     CALL 'AOSARDR0'                                                    CSW024
     C                     PARM *BLANKS   @RTCD                                               CSW024
     C                     PARM '*VERIFY' @OPTN                                               CSW024
     C                     PARM 'CSW024'  @SARD                                               CSW024
     C           SCSARD    PARM SCSARD    DSFDY                                               CSW024
      *                                                                                       CSW024
     C           @RTCD     IFNE *BLANK                                                        CSW024
     C           @RTCD     ANDNE'*NRF   '                                                     CSW024
     C           *LOCK     IN   LDA                                                           CSW024
     C                     MOVEL'SCSARDPD'DBFILE           ************                       CSW024
     C                     MOVEL'CSW024'  DBKEY            * DBERR 38 *                       CSW024
     C                     MOVEL'038'     DBASE            ************                       CSW024
     C                     OUT  LDA                                                           CSW024
     C                     EXSR *PSSR                                                         CSW024
     C                     ENDIF                                                              CSW024
      *                                                                                       CSW024
     C           @RTCD     IFEQ *BLANK                                                        CSW024
     C                     MOVE 'Y'       CSW024  1                                           CSW024
     C                     ELSE                                                               CSW024
     C                     MOVE 'N'       CSW024                                              CSW024
     C                     ENDIF                                                              CSW024
      *                                                                                       CSW201
      **  Access Switchable Features file for CSW201                                          CSW201
      *                                                                                       CSW201
     C                     CALL 'SWIF2001'                                                    CSW201
     C                     PARM *BLANKS   @RTCD                                               CSW201
      *                                                                                       CSW201
     C           @RTCD     IFEQ 'CSW2001'                                                     CSW201
     C                     MOVE 'Y'       CSW201  1                                           CSW201
     C                     ELSE                                                               CSW201
     C                     MOVE 'N'       CSW201                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW213
      ** Check if switchable feature CSW213 is switched on                                    CSW213
      *                                                                                       CSW213
     C                     CALL 'SWIF2013'                                                    CSW213
     C                     PARM           @RTCD                                               CSW213
      *                                                                                       CSW213
     C           @RTCD     IFEQ 'CSW2013'                                                     CSW213
     C                     MOVE 'Y'       CSW213  1                                           CSW213
     C                     ELSE                                                               CSW213
     C                     MOVE 'N'       CSW213                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                      255986B
      ** Access system value for PopBTBConf                                                  255986B
      *                                                                                      255986B
     C                     CALL 'AOSVALR0'                                                   255986B
     C                     PARM *BLANKS   @RTCD                                              255986B
     C                     PARM APOPB     P@OP01 20                                          255986B
     C                     PARM *BLANKS   P@VL01200                                          255986B
     C                     PARM *BLANKS   P@OP02 20                                          255986B
     C                     PARM *BLANKS   P@VL02200                                          255986B
     C                     PARM *BLANKS   P@OP03 20                                          255986B
     C                     PARM *BLANKS   P@VL03200                                          255986B
     C                     PARM *BLANKS   P@OP04 20                                          255986B
     C                     PARM *BLANKS   P@VL04200                                          255986B
     C                     PARM *BLANKS   P@OP05 20                                          255986B
     C                     PARM *BLANKS   P@VL05200                                          255986B
     C                     PARM *BLANKS   P@OP06 20                                          255986B
     C                     PARM *BLANKS   P@VL06200                                          255986B
     C                     PARM *BLANKS   P@OP07 20                                          255986B
     C                     PARM *BLANKS   P@VL07200                                          255986B
     C                     PARM *BLANKS   P@OP08 20                                          255986B
     C                     PARM *BLANKS   P@VL08200                                          255986B
     C                     PARM *BLANKS   P@OP09 20                                          255986B
     C                     PARM *BLANKS   P@VL09200                                          255986B
     C                     PARM *BLANKS   P@OP10 20                                          255986B
     C                     PARM *BLANKS   P@VL10200                                          255986B
      *                                                                                      255986B
     C                     MOVEL'N'       PAPOPB  1                                          255986B
     C           @RTCD     IFEQ *BLANK                                                       255986B
     C                     MOVELP@VL01    PAPOPB                                             255986B
     C                     ENDIF                                                             255986B
      *                                                                                       CSD015
      ** Check if CSD015 is enabled.                                                          CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD   7                                           CSD015
     C                     PARM '*VERIFY' POPTN   7                                           CSD015
     C                     PARM 'CSD015'  PSARN   6                                           CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CSD015  1                                           CSD015
     C                     MOVEL'N'       W1EWLC                                              222385
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSD015                                              CSD015
      *                                                                                       222385
      ** Access AOWLCCR0 to check if function code MESSGENT is available                      222385
      *                                                                                       222385
     C                     CALL 'AOWLCCR0'                                                    222385
     C                     PARM *BLANKS   @RTCD                                               222385
     C                     PARM '*KEY'    @OPTN                                               222385
     C                     PARM 'MESSGENT'PFUNC   8                                           222385
     C           SDWLCC    PARM SDWLCC    DSFDY                                               222385
      *                                                                                       222385
     C           @RTCD     IFNE *BLANKS                                                       222385
     C           @RTCD     ANDNE'*NRF'                                                        222385
     C                     MOVEL'SDWLCCPD'DBFILE                                              222385
     C                     MOVELPFUNC     DBKEY                                               222385
     C                     Z-ADD32        DBASE                                               222385
     C                     EXSR *PSSR                                                         222385
     C                     ENDIF                                                              222385
      *                                                                                       222385
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE '*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     MOVELPSARN     DBKEY                                               CSD015
     C                     Z-ADD40        DBASE                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Check if CSW025 is enabled.                                                          CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY' POPTN                                               CSD015
     C                     PARM 'CSW025'  PSARN                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CSW025  1                                           CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSW025                                              CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE '*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     MOVELPSARN     DBKEY                                               CSD015
     C                     Z-ADD41        DBASE                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Check if Enhanced Receive Settlement Instructions feature                            CDL094
      * is installed                                                                          CDL094
      *                                                                                       CDL094
     C                     MOVE 'N'       CDL094  1                                           CDL094
     C                     CALL 'AOSARDR0'                                                    CDL094
     C                     PARM *BLANKS   @RTCD                                               CDL094
     C                     PARM '*VERIFY' @OPTN                                               CDL094
     C                     PARM 'CDL094'  @SARD                                               CDL094
     C           SCSARD    PARM SCSARD    DSFDY                                               CDL094
      *                                                                                       CDL094
     C           @RTCD     IFEQ *BLANKS                                                       CDL094
     C                     MOVE 'Y'       CDL094                                              CDL094
     C                     ENDIF                                                              CDL094
      *                                                                                       CDL094
      *****************************************************************            MD035545 MD047993
      ***Call*access*program*for*General*Ledger*details.***************            MD035545 MD047993
      *****************************************************************            MD035545 MD047993
     C**********           CALL 'AOGELRR1'                                         MD035545 MD047993
     C**********           PARM '*MSG   ' @RTCD   7                                MD035545 MD047993
     C**********           PARM '*FIRST ' @OPTN   7                                MD035545 MD047993
     C********** SDGELR    PARM SDGELR    DSSDY                                    MD035545 MD047993
      *                                                                                     MD035545
     C********** @RTCD     IFNE *BLANK                                             MD035545 MD047993
     C**********           MOVEL'SDGELRPD'DBFILE                                   MD035545 MD047993
     C**********           MOVEL'062'     DBASE                                    MD035545 MD047993
     C**********           MOVEL@OPTN     DBKEY                                    MD035545 MD047993
     C**********           EXSR *PSSR                                              MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
      *                                                                                     MD035545
      ** Retrieve system value setting                                                      MD035545
      *                                                                                     MD035545
     C                     MOVELWPARML    P@OP01                                            MD035545
     C                     CALL 'AOSVALR0'                                                  MD035545
     C                     PARM *BLANKS   W0RTCD  7                                         MD035545
     C                     PARM           P@OP01 20                                         MD035545
     C                     PARM           P@VL01200                                         MD035545
     C                     PARM           P@OP02 20                                         MD035545
     C                     PARM           P@VL02200                                         MD035545
     C                     PARM           P@OP03 20                                         MD035545
     C                     PARM           P@VL03200                                         MD035545
     C                     PARM           P@OP04 20                                         MD035545
     C                     PARM           P@VL04200                                         MD035545
     C                     PARM           P@OP05 20                                         MD035545
     C                     PARM           P@VL05200                                         MD035545
     C                     PARM           P@OP06 20                                         MD035545
     C                     PARM           P@VL06200                                         MD035545
     C                     PARM           P@OP07 20                                         MD035545
     C                     PARM           P@VL07200                                         MD035545
     C                     PARM           P@OP08 20                                         MD035545
     C                     PARM           P@VL08200                                         MD035545
     C                     PARM           P@OP09 20                                         MD035545
     C                     PARM           P@VL09200                                         MD035545
     C                     PARM           P@OP10 20                                         MD035545
     C                     PARM           P@VL10200                                         MD035545
      *                                                                                     MD035545
      ** If system value is not found then default value to 'N'                             MD035545
      *                                                                                     MD035545
     C           W0RTCD    IFNE '       '                                                   MD035545
     C                     MOVE 'N'       WCALC6                                            MD035545
     C                     ELSE                                                             MD035545
     C                     MOVELP@VL01    WCALC6                                            MD035545
     C********** WCALC6    IFEQ 'Y'                                                MD035545 MD047993
     C********** BKALDI    ANDEQ'Y'                                                MD035545 MD047993
     C**********           MOVE 'Y'       WCALC6                                   MD035545 MD047993
     C**********           ELSE                                                    MD035545 MD047993
     C**********           MOVE 'N'       WCALC6                                   MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
     C                     ENDIF                                                            MD035545
      *                                                                                     MD035545
     C/COPY WNCPYSRC,MG0330C024
      *
      * Key for accessing MGOMSGL1                                        CSW200
      *                                                                   CSW200
     C           KEYSQN    KLIST                                          CSW200
     C                     KFLD           KTRNB  16                       CSW200
     C                     KFLD           KMTAG   5                       CSW200
      *                                                                   CSW200
     C                     ENDSR
      *****************************************************************                       CSD015
     C/EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      *                                                               *                       CSD015
      *  SRWTCH - Initiates the Midas Watch List Checking Engine.     *                       CSD015
      *                                                               *                       CSD015
      *****************************************************************                       CSD015
     C           SRWTCH    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Check if the message is for automatic release.                                       CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       PARLS                                               CSD015
      *                                                                                       CSD015
     C           MGST      IFEQ 'RSND'                                                        CSD015
     C           NWRK      IFEQ 'SWIFT '                                                      CSD015
     C           NWRK      OREQ 'TELEX '                                                      CSD015
     C           NWRK      OREQ 'STTX  '                                                      CSD015
     C                     MOVE 'CRTD'    MGST                                                CSD015
     C                     MOVE 'Y'       PARLS   1                                           CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Initialise the Transaction Details parameter.                                        CSD015
      *                                                                                       CSD015
     C                     CLEARWLTDS                                                         CSD015
     C                     Z-ADD*ZERO     W4VDAT                                              CSD015
     C                     Z-ADD*ZERO     W4MDAT                                              CSD015
     C                     Z-ADD*ZERO     W4AMT1                                              CSD015
     C                     Z-ADD*ZERO     W4AMT2                                              CSD015
      *                                                                                       CSD015
     C                     MOVELTRNO      W4IDEN                                              CSD015
     C                     MOVELMTPY      W4ITEM                                              CSD015
     C                     MOVEL'MGOREF  'W4FUNT                                              CSD015
     C                     MOVELMGBRCA    W4BRCH                                              CSD015
     C                     MOVELDECN      W4CNUM                                              CSD015
     C                     Z-ADDBJRDNB    W4DDAT                                              CSD015
     C                     MOVELPARLS     W4ARLS                                              CSD015
      *                                                                                       CSD015
      ***Send*the*Transaction Details to the Compliance Engine.                        CSD015 221145
     C*********************CALL 'SDWLCLOP'                                             CSD015 221145
     C*********************PARM           WLTDS                                        CSD015 221145
     C*********************PARM *BLANKS   PSTRNG                                       CSD015 221145
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
     C/EJECT
      *****************************************************************                       221145
      *                                                               *                       221145
      *  WLCDQ - Submit information to Watch List Check Dtaq          *                       221145
      *                                                               *                       221145
      *****************************************************************                       221145
      *                                                                                       221145
     C           WLCDQ     BEGSR                                                              221145
      *                                                                                       221145
      *  Send transaction to compliance engine program                                        221145
      *                                                                                       221145
     C                     CALL 'SDWLCLOP'                                                    221145
     C                     PARM           WLTDS                                               221145
     C                     PARM *BLANKS   PSTRNG                                              221145
      *                                                                                       221145
      *                                                                                       221145
     C                     ENDSR                                                              221145
      *                                                                                       221145
     C/EJECT                                                                                  221145
      *****************************************************************
      *   *PSSR - error handling                                      *
      *****************************************************************
      *
     C           *PSSR     BEGSR
      *
      **  Write database error to report
      *
     C                     OPEN MG0330AU
     C                     WRITEHEAD
     C                     WRITEDBERROR
      *
     C                     SETON                     U7U8LR
     C                     DUMP
     C                     RETRN
      *
     C                     ENDSR
     C/EJECT
     C/COPY WNCPYSRC,MG0330C025
      *
      /EJECT                                                              066550
     C/COPY ZSRSRC,ZINTDYZ2                                               066550
      /EJECT                                                              066550
     C/COPY ZSRSRC,ZDATE9Z3                                               066550
      /EJECT                                                              066550
     C/COPY ZSRSRC,ZDAT10Z2                                               126017
     C/EJECT                                                              126017
     C/COPY ZSRSRC,GLINTCZ1                                               066550
      /EJECT                                                              066550
      /COPY MGCPYSRC,SWIFTTRANS                                           BLI605
** CPY@   Object Copyright
(c) Finastra International Limited 2001
     X/COPY WNCPYSRC,MG0330X001
** MSGA   Messages
Settlement - pay
Customer details not found on SDCUSTPD
Nostro customer not found on SDNOSTPD
ZM0040 (format ccy and amount) call ended in error
ZM0050 (format SWIFT address) call ended in error
Codeword was not found for this message
Duplicate TRN key built for this message
Broker code not found on SDBROKPD
THIS IS A FIDUCIARY DEPOSIT                                               CDL006
THIS IS A FIDUCIARY LOAN                                                  CDL006
** TABSLT - selection criteria for the codeword
                             K
                             U
SENT   NEW            U      K
SENT   NEW            U      U
SENT   NEW            K      K
SENT   NEW            K      U
NONREC NEW            U      K
NONREC NEW            U      U
NONREC NEW            K      K
NONREC NEW            K      U
SENT   CORRECT        U      K
SENT   CORRECT        U      U
SENT   CORRECT        K      K
SENT   CORRECT        K      U
SENT   COMPLETE       K      K
SENT   COMPLETE       K      U
NONREC CORRECT        U      K
NONREC CORRECT        U      U
NONREC CORRECT        K      K
NONREC CORRECT        K      U
NONREC COMPLETE       K      K
NONREC COMPLETE       K      U
** TABRST - Resulting codeword; corresponds to the selection criteria
COMPLETE
CORRECT
COMPLETE
CORRECT
CORRECT
CORRECT
NEW
NEW
NEW
NEW
COMPLETE
CORRECT
CORRECT
CORRECT
CORRECT
CORRECT
COMPLETE
CORRECT
CORRECT
CORRECT
COMPLETE
CORRECT
** TABS96 - selection criteria for the codeword                           CSW096
                             K                                            CSW096
                             U                                            CSW096
SENT   NEW            U      K                                            CSW096
SENT   NEW            U      U                                            CSW096
SENT   NEW            K      K                                            CSW096
SENT   NEW            K      U                                            CSW096
NONREC NEW            U      K                                            CSW096
NONREC NEW            U      U                                            CSW096
NONREC NEW            K      K                                            CSW096
NONREC NEW            K      U                                            CSW096
SENT   AMEND          U      K                                            CSW096
SENT   AMEND          U      U                                            CSW096
SENT   AMEND          K      K                                            CSW096
SENT   AMEND          K      U                                            CSW096
NONREC AMEND          U      K                                            CSW096
NONREC AMEND          U      U                                            CSW096
NONREC AMEND          K      K                                            CSW096
NONREC AMEND          K      U                                            CSW096
** TABR96 - Resulting codeword; corresponds to the selection criteria     CSW096
AMEND                                                                     CSW096
AMEND                                                                     CSW096
AMEND                                                                     CSW096
AMEND                                                                     CSW096
AMEND                                                                     CSW096
AMEND                                                                     CSW096
NEW                                                                       CSW096
NEW                                                                       CSW096
NEW                                                                       CSW096
NEW                                                                       CSW096
AMEND                                                                     CSW096
AMEND                                                                     CSW096
AMEND                                                                     CSW096
AMEND                                                                     CSW096
AMEND                                                                     CSW096
AMEND                                                                     CSW096
AMEND                                                                     CSW096
AMEND                                                                     CSW096
** TABNST - Codes indicating settlement via nostro
01
02
07
08
12
** TABINT - Codes indicating settlement via internal
03
04
05
06
14
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
