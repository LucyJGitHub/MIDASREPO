     H        1                           F
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas MG Format FRA definition confirmation')          *
      *****************************************************************
      *                                                               *
      *  Midas - Message Generation Module                            *
      *                                                               *
      *  MG0340 - FORMAT FRA DEFINITION CONFIRMATION                  *
      *                                                               *
      *  Function:  This program will format MT340 messages for       *
      *    (I/C)    output to SWIFT.                                  *
      *                                                               *
      *  Called By: DLC0210A - Dealing I/C Confirmations              *
      *                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. CSW216             Date 14Mar16               *
      *  Prev Amend No. MD031998           Date 20Jan15               *
      *                 CSW214             Date 25Nov14               *
      *                 MD023007           Date 24Oct13               *
      *                 MD023798           Date 26Nov13
      *                 MD022981           Date 12Nov13               *
      *                 MD023802           Date 26Nov13               *
      *                 MD023241           Date 06Nov13               *
      *                 MD022633A          Date 17Oct13               *
      *                 MD023009           Date 23Oct13               *
      *                 MD022633           Date 03Oct13               *
      *                 MD022392           Date 13Sep13               *
      *                 MD022035           Date 04Sep13               *
      *                 MD022033           Date 03Sep13               *
      *                 CSW213             Date 03Jun13               *
      *                 CLE148             Date 23Jul12               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CIR013             Date 22Apr05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 222373             Date 27Oct03               *
      *                 222385             Date 23Oct03               *
      *                 221145             Date 08Sep03               *
      *                 219242             Date 01Jul03               *
      *                 219241             Date 01Jul03               *
      *                 CSD015             Date 14Oct02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 205410             Date 27May02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CSW025             Date 26Mar02               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 193704             Date 23May01               *
      *                 CSW201             Date 02May01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 190127             Date 28Feb01               *
      *                 184718             Date 19Jan01               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 186635             Date 21Nov00               *
      *                 CDL008             Date 02May00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CSW200             Date 21Aug00               *
      *                 176709             Date 28Mar00               *
      *                 175948             Date 07Mar00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 135960             Date 27Apr99               *
      *                 137909             Date 22Jul98               *
      *                 CSW005             Date 01AUG96               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  CSW216 - SWIFT Changes 2016                                  *
      *  MD031998 - Generated MT340 do not output SWIFT 2014          *
      *             introduce fields                                  *
      *  CSW214 - SWIFT Changes 2014                                  *
      *  MD023007 - Inaccurate writing sequence on repeating fields   *
      *             of RPIF details in MT generation                  *
      *  MD023798 - Invalid format for tag 98D                        *
      *  MD022981 - Seq 15G without succeeding field tags generated   *
      *  MD023802 - Missing MT340 CANC for Trade Repo ID              *
      *  MD023241 - No MT340 for Amend                                *
      *  MD022633A - Properly set-up the value for tags 22L and 91J   *
      *  MD023009 - MT300 Message 15E is out of sequence              *
      *  MD022633 - Allow reporting details with '0' Transaction      *
      *             Identifier type for different reporting           *
      *             jurisdiction and reporting party ID combinations. *
      *  MD022392 - MT340 FRA Missing field tags for Reporting        *
      *             Information                                       *
      *  MD022035 - Action delete field tag 22A of Counterparty       *
      *             confirmation MT340 must be CANC instead of NEWT   *
      *             and also field tag 21 is in error and new seq G   *
      *             is missing                                        *
      *  MD022033 - Action insert new_Various error in MT340 where    *
      *             both counterparty and trade repo has SWIFT        *
      *             Identification.                                   *
      *  CSW213 - SWIFT Changes 2013                                  *
      *  CLE148 - Alpha Loan Reference (Recompile)                    *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222373 - Parameter Mismatch.                                 *
      *  222385 - SWIFT msgs are Watch List checked regardless of     *
      *           configuration file setting                          *
      *  221145 - Compliance Watch WLC: Move compliance check to      *
      *           after COMIT to MGOMSGPD                             *
      *  219242 - Not possible to create MT103+ payment msg from      *
      *           non-FT transaction (Recompile)                      *
      *  219241 - Defaulting of "Details of Charges" assign a         *
      *           system value (Recompile)                            *
      *  CSD015 - Midas Compliance Watch - Watch List Checking        *
      *  205410 - Make repititions of 22B have MTAG.                  *
      *  CSW025 - Midas Message Manager                               *
      *           - Pass original change type                         *
      *  193704 - Array SVLC cannot accomodate 11 currencies location *
      *           codes                                               *
      *  CSW201 - SWIFT 2001 Standards Update                         *
      *  190127 - Related reference should contain tansaction         *
      *           reference of previous message of same type          *
      *  184718 - Setup CIND flag to correct Y2K display problems.    *
     F*  186635 - 24D should specify what electronic broker it is     *
      *  CDL008 - Continuous Linked Settlement (Recompiled)           *
      *  CSW200 - Swift 2000 Changes                                  *
      *  176709 - Fields MGS2R1 and MGS2R2 from MGF340PD are          *
      *           overwritten by the defaulting of field 72.          *
      *  175948 - Correct output of codeword in file 22:.             *
      *           In case of a new deal; MGCHTP is 'I' (DL6305).      *
      *  135960 - Add broker details to field 72                      *
      *  137909 - Use the settlement currency if not blank for        *
      *           accessing nostro details. This is needed for tag    *
      *           57A.                                                *
      *  CSW005 - FRA/IRS MG34n and MG36n Message Generation.         *
      *                                                               *
      *****************************************************************
     FMGF340PDUF  E           K        DISK
     F                                              KCOMIT
     FMGU340PDIF  E           K        DISK                           UC  CSW200
     FMGOREFL0IF  E           K        DISK
     F            MGOREFD0                          KRENAMEMGREFL0
     FMGOREFPDO   E                    DISK
     F                                              KCOMIT
     FMGOMSGPDO   E                    DISK
     F                                              KCOMIT
     FDLRPIFL1IF  E           K        DISK                           UC                    MD022981
      *                                                                                       190127
      ** MG Transaction history file                                                          190127
     F***MGHISTL0UF  E           K        DISK                      A                  190127 CSW213
     FMGHISTL7UF  E           K        DISK                      A                            CSW213
     F            MGHISTD0                          KRENAMEMGHIST                             CSW213
     F                                              KCOMIT                                    190127
     F***MG0340P1O   E                    PRINTER                        UC                   CSW213
     FMG0340P1O   E             99     PRINTER                        UC                      C3W213
     FMG0340AUO   E                    PRINTER                        UC
     F/COPY WNCPYSRC,MG0340F001
      *****************************************************************
      *                                                               *
      * FUNCTION OF INDICATORS                                        *
      *                                                               *
      *    01            EOF MGF340PD                                 *
      *    05            Error on write to MGOREFPD.                  *
      *    06            Error on write to MGOMSGPD                   *
      *    11            Chain to MGOREFL0.                           *
      *    15            Error in call to standard program ZM0060     *
      *    16            Error on delete of GDF record.               *
      *    20            LOKUP operation searching array (GNR)        *
      *    21            LOKUP operation searching array (GNR)        *
      *    22            LOKUP operation searching array (GNR)        *
      *    23            Settlement method on TABNST/TABINT.          *
      *    25            Array 1st line filled ; fld72.               *
      *    26            Error on call of MG5000                      *
      *    27            ConCord Interface is ON.                     *
      *    28            Error in call to standard program ZM1190     *
      *    30            Feedback record not generated                *
      *    31            LOKUP operation searching array (@WRK)       *
      *    50            MG0340P1 open                                *
      *    U7U8          Database error                               *
      *                                                               *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                   Index to subroutines                        *
      *   main process                                                *
      *   INIT - Initial Process.                                     *
      *   INTF - Initialise non-constant fields.                      *
      *   SRROUT - Determine Message Routing.                         *
      *   FMTA - Format Sequence A MT340 fields for output.           *
      *   FMTB - Format Sequence B MT340 fields for output.           *
      *   FMTC - Format Sequence C MT340 fields for output.           *
      *   FSWAD- Format SWIFT Address.                                *
      *   DATES- Format the Date Fields.                              *
      *   FLD72- Format Field 72.                                     *
      *   REPT - Print Incorrectly Generated Messages.                *
      *   OMSG - Output Correctly Generated Messages.                 *
      *   WREF - Write o/p reference to PF/MGOREFPD.                  *
      *   CFMAT - Generate feedback record if confo. matching is ON   *
      *   *PSSR- Error Handling.                                      *
      *                                                               *
      *****************************************************************
     E                    CPY@    1   1 80               copyright
     E                    MSGA    1   8 60               message text
     E                    TABNST  1   5  2               settlement nostro
     E                    TABINT  1   5  2               settle. internal
     E                    GNR        15  3               msg gen. released
     E                    @WRK       50  1               work array
     E                    S2RF        6 35               sender-recv. info
     E**********          SVLC       10  3               location codes                CSW200 193704
     E                    SVLC       11  3               location codes                       193704
     E*************       CLCM    1   2 50               calculation meth.CSW200              CIR013
     E                    CLCM    1   3 50               calculation meth.                    CIR013
     E                    IX          4  1 0                                                MD023007
      *                                                                   CSW200
     IMGU340D0                                                            CSW200
     I              MGSEQN                          WSEQNU                CSW200
      *                                                                   CSW200
      ** Rename sequence field on supplementary file                      CSW200
      *
     IMGREFL0
     I              SYTM                            MSYTM
     I              NWRK                            MNWRK
     I              SECN                            MSECN
     I              NWSN                            MNWSN
     I              DECN                            MDECN
     I              NWDS                            MNWDS
     I              MGSG                            MMGSG
     I              MGST                            MMGST
     I              F57U                            MF57U
     I              LSCC                            MLSCC
     I              HRDT                            MHRDT
     I              MGDE                            MMGDE
     I              MGTM                            MMGTM
     I              LADT                            MLADT
     I              RELD                            MRELD
     I              RELT                            MRELT
     I              CFPF                            MCFPF
     I              TODY                            MTODY
      *
      ***Rename conflicting MGHISTD0 fields                                          CSW213 MD022035
      **********                                                                     CSW213 MD022035
     I*MGHIST***                                                                     CSW213 MD022035
     I**********    HSMODI                          HMODI                            CSW213 MD022035
     I**********    HSTRAN                          HTRAN                            CSW213 MD022035
     I**********    HSDEST                          HDEST                            CSW213 MD022035
     I**********    HSSEQ                           HSEQ                             CSW213 MD022035
     I**********    HSMTPY                          HSMTPY                           CSW213 MD022035
     I**********    HSTRNO                          HTRNO                            CSW213 MD022035
     I**********    HSPDAT                          HPDAT                            CSW213 MD022035
     I**********    HSMSSQ                          HMSSQ                            CSW213 MD022035
     I**********    HSEVTP                          HEVTP                            CSW213 MD022035
     I**********    HSFTRN                          HFTRN                            CSW213 MD022035
     I**********    HSCANC                          HCANC                            CSW213 MD022035
      *                                                                                       CSW213
      **  Rename conflicting MGOREFL0 fields
      *
     I            DS
     I                                        1  12 CSID
     I                                        9  11 @BIC
      *
      **  Data structure to test for BIC code
      *
     I***MULT***     DS                         95                                            CSW213
     IMULT        DS                        200                                               CSW213
     I                                        1   5 MTAG
     I                                        6  55 MFLD
     I                                       56 105 MERR
      *
      **  Multiple occurrence data structure for message
      *
     ILDA         DS                            256
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
      *
      **  Local data area
      *
     ICODEWD      DS                         22
     I                                        1   8 CWRD
     I                                       10  10 F57U
      **  Data structure containing codeword for the new message
      *
     IFLD3N       DS                         24
     I                                        1   6 ZSDATE
     I                                        7   9 ZSCCY
     I                                       10  24 ZSAMNT
      *
      **  Data structure containing codeword for fields 32/33.
      *
     IERR3N       DS                         24
     I                                        1   3 ZCCY
     I                                        5  170ZAMT
      *
      **  Erroneous currency & amounts for Fields 32/33
      *
     I@MTAG       DS                          5
     I                                        1   1 COLON1
     I                                        2   3 FLDNO
     I                                        4   4 TAG
     I                                        5   5 COLON2
      *
      **  Data structure constructing message field tag
      *
     IP@IN        DS                            256
     I                                        1   3 I@SNBR
     I                                        4   9 I@DSCN
     I                                       10  12 I@MTPY
     I                                       13  140I@SETT
     I                                       15  15 I@CONC
     I                                       16  16 I@FTCS
     I                                       17  18 I@MMOD
      ** Data structure for input parameter
      *
     IP@OUT       DS                            256
     I**********                              1   60O@CNSN                                    CSD027
     I                                        1   6 O@CNSN                                    CSD027
     I                                        7  18 O@SWSN
     I                                       19  38 O@NWSN
     I                                       39  49 O@SWDS
     I                                       46  46 W@96CN
     I                                       47  49 W@BIC
     I                                       50  69 O@NWDS
     I                                       70  75 O@NWRK
     I                                       76  76 O@MGSG
     I                                       77  80 O@MGST
     I                                       81  81 O@PAIN
     I                                       82  87 O@PCNB
     I                                       88  90 O@SPRS
      ** Data structure for ouput parameter
      *
     I@HREF       DS                         16                                               190127
     I                                        1   2 HSMODI                                    190127
     I                                        3   8 HSTRAN                                    190127
     I                                        9  11 HSSEQ                                     190127
      **  Data structure for related reference                                                190127
      *                                                                                       190127
      **  Data structure for related reference CSW213                                         CSW213
      *                                                                                       CSW213
     I@HREF1      DS                         16                                               CSW213
     I                                        1   2 H1MODI                                    CSW213
     I                                        3   8 H1TRAN                                    CSW213
     I                                        9  14 HSDEST                                    CSW213
     I                                       15  16 @SSEQ                                     CSW213
      *                                                                                       CSW213
      ** Multiple occurrence data structure for reporting party                               CSW213
      *                                                                                       CSW213
     IRPPT        DS                          5                                               CSW213
     I                                        1  35 MGRJXX                                    CSW213
     I                                       36  41 MGRPXX                                    CSW213
     I                                       42  61 MGRNXX                                    CSW213
     I                                       62  71 MGRCXX                                    CSW213
     I                                       72  82 MGRSXX                                    CSW213
     I                                       83 102 MGRLXX                                    CSW213
     I                                      103 136 MGRAXX                                    CSW213
     I**********                            137 146 MGUTXX                             CSW213 CSW214
     I**********                            147 178 MGTNXX                             CSW213 CSW214
     I**********                            179 179 MGTIXX                             CSW213 CSW214
     I**********                            180 180 MGETXX                             CSW213 CSW214
     I**********                            137 156 MGUTXX                             CSW214 CSW216
     I**********                            157 188 MGTNXX                             CSW214 CSW216
     I**********                            189 189 MGTIXX                             CSW214 CSW216
     I**********                            190 190 MGETXX                             CSW214 CSW216
     I                                      137 166 MGUTXX                                    CSW216
     I                                      167 198 MGTNXX                                    CSW216
     I                                      199 199 MGTIXX                                    CSW216
     I                                      200 200 MGETXX                                    CSW216
      *                                                                                       CSW213
      ** Data structure build transaction reference number                                    CSW213
      *                                                                                       CSW213
     I@TRN1       DS                         16                                               CSW213
     I                                        1   2 @TRN11                                    CSW213
     I                                        3   8 @TRN21                                    CSW213
     I                                        9  14 @TRN31                                    CSW213
     I                                       15  160@TRN41                                    CSW213
     I                                        3  14 @TRNID                                    CSW213
      *                                                                                       CSW213
     ISDBANK    E DSSDBANKPD
      *
      **  External Data structure for bank details.
      *
     ISDTRAD    E DSSDTRADPD
      *
      **  External Data structure for trading file.
      *
     ISDCUST    E DSSDCUSTPD
      *
      **  External Data structure for customer details.
      *
     ISDBRCH    E DSSDBRCHPD
     I              QQDFAC                          DFACQQ                                    CGL029
      *
      **  External Data structure for branch details.
      *                                                                   135960
     ISDBROK    E DSSDBROKPD                                              135960
      **  External Data structure for broker file.                        135960
      *
     ISDMMOD    E DSSDMMODPD
      *
      **  External Data structure for module ICD file.
      *
     ISDNOST    E DSSDNOSTPD
     I              QQACCD                          ACCDQQ                                    CGL029
      *
      **  External Data structure for nostro details.
      *
     ISDMGME    E DSSDMGMEPD
      *
      **  Data structure for message management data.
      *
     ISCSARD    E DSSCSARDPD
      *
      **  Data structure for Customer Extensions SWIFT Details                                CSW213
     ISDCSSW    E DSSDCSSWPD                                                                  CSW213
      *
      **  Data structure for Switchable Features file
      *
     ISDLOCN    E DSSDLOCNPD                                              CSW200
      *                                                                   CSW200
      **  Data structure for location codes file                          CSW200
      *                                                                   CSW200
     IDSFDY     E DSDSFDY
      *                                                                                       CSW213
     IDSLDY     E DSDSLDY                                                                     CSW213
      *
      **  Short data structure for access programs
      *
     IDSSDY     E DSDSSDY
      *
      **  Long data structure for access programs
      *
     IWLTDS     E DSSDWLTOPD                                                                  CSD015
      ** Watch List Transaction Details Data Structure                                        CSD015
      *                                                                                       CSD015
     IPSTRNG      DS                           9999                                           CSD015
      ** SDWLCLOP Search String Parameter                                                     CSD015
      *                                                                                       CSD015
     ISDWLCC    E DSSDWLCCPD                                                                  222385
      ** Watch list checking details                                                          222385
      *                                                                                       222385
      /EJECT
      *****************************************************************
      *   MAIN - main process                                         *
      *   Called by - none                                            *
      *   Calls - INIT Initial Process.                               *
      *           INTF Initialise non-constant fields.                *
      *           SRROUT Determine Message Routing.                   *
      *           FMTA Format Sequence A MT340 fields for output.     *
      *           FMTB Format Sequence B MT340 fields for output.     *
      *           FMTC Format Sequence C MT340 fields for output.     *
      *           REPT Print Incorrectly Generated Messages.          *
      *           OMSG Output Correctly Generated Messages.           *
      *****************************************************************
      *
      **  Transaction history key                                                             190127
     C           HSKEY     KLIST                                                              190127
     C                     KFLD           MGMODI                                              190127
     C                     KFLD           HSTRAN                                              190127
     C                     KFLD           HSDEST                                              CSW213
     C                     KFLD           HSMTPY                                              190127
      *                                                                                       190127
      ** Initial Processing.
      *
     C                     EXSR INIT
      *
      ** Read the first record from PF/MGF340PD.
      *
     C                     READ MGF340PD                 01
      *
      ** Do While record is found in file.
      *
     C           *IN01     DOWEQ'0'
      *
      ** Move Sequence Number in Extract (MGSEQN) to KFLD                 CSW200
     C                     Z-ADDMGSEQN    @SEQN                           CSW200
      *                                                                   CSW200
      ** Initialise output fields and format message level fields.
      *
     C                     EXSR INTF
      *
      ** Determine message routing.
      *
     C                     EXSR SRROUT
      *                                                                   CSW200
     C           CSW200    IFNE 'Y'                                       CSW200
      *
      ** Format Sequence A MT340 fields for output.
      *
     C                     EXSR FMTA
      *
      ** Format Sequence B MT340 fields for output.
      ** (field :57a: using our receive nostro)
      *
     C                     EXSR FMTB
      *
      ** Format Sequence C MT340 fields for output.
      ** (field :57a: using account with bank)
      *
     C                     EXSR FMTC
      *                                                                   CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      ** Use the Swift 2000 changes                                       CSW200
      *                                                                   CSW200
      ** Format Message Detail - Seq A.                                   CSW200
      *                                                                   CSW200
     C                     EXSR FMA200                                    CSW200
      *                                                                   CSW200
      ** Format Message Detail - Seq C.                                   CSW200
      *                                                                   CSW200
     C                     EXSR FMC200                                    CSW200
      *                                                                   CSW200
      *                                                                   CSW200
      ** Format Message Detail - Seq D.                                   CSW200
      *                                                                   CSW200
     C                     EXSR FMD200                                    CSW200
      *                                                                   CSW200
      *                                                                   CSW200
      ** Format Message Detail - Seq E.                                   CSW200
      *                                                                   CSW200
     C                     EXSR FME200                                    CSW200
      *                                                                                       CSW213
      ** Format Message Detail - Seq G.                                                       CSW213
      *                                                                                       CSW213
     C           CSW213    IFEQ 'Y'                                                           CSW213
      *                                                                                     MD022981
     C                     MOVELMGTTYP    KDTYP   2                                         MD022981
     C                     MOVELMGTNUM    KDLNO  16                                         MD022981
      *                                                                                     MD022981
     C           RPIFKY    CHAINDLRPIFL1             20                                     MD022981
      *                                                                                     MD022981
     C           *IN20     IFEQ '0'                                                         MD022981
     C                     EXSR SRFMTG                                                        CSW213
     C                     ENDIF                                                            MD022981
     C                     ENDIF                                                              CSW213
      *                                                                   CSW200
     C                     ENDIF                                          CSW200
      *
      ** Print if error in generated message.
      *
     C           @ERR      IFEQ 'Y'
     C                     EXSR REPT
     C                     ELSE
      *
      ** Print if no error in generated message.
      *
     C                     EXSR OMSG
      *
      ** If confirmation matching is switched on, generate
      ** feedback record.
      *
     C           BGCFMT    IFEQ 'Y'
     C                     EXSR CFMAT
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** Delete record after completion of processing.
      *
     C                     DELETMGF340PD               16
      *
      **  Error on delete of record.
      *
     C           *IN16     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '016'     DBASE              * * * * * * *
     C                     MOVELMGTNUM    DBKEY              * DBERR 016 *
     C                     MOVEL'MGF340PD'DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      ** Update sequence numbers on transaction record
      ** if no errors have occurred.
      *
     C           @ERR      IFNE 'Y'
     C           MGACMI    IFEQ 'Y'                                                           CSW213
     C                     CALL 'MG5000'               26                                     CSW213
     C                     PARM MGTTYP    @MODI   2                                           CSW213
     C                     PARM MGTNUM    @TRAN  15                                           CSW213
     C                     PARM 'CE'      @PROG   2                                           CSW213
     C                     PARM 'U'       @MODE   1                                           CSW213
     C                     PARM *ZEROS    MGLSWC  30                                          CSW213
     C                     PARM *ZEROS    MGLSWS  30                                          CSW213
     C                     PARM *BLANKS   @ERCD   1                                           CSW213
      *                                                                                       CSW213
      ** Error on access for sequence number                                                  CSW213
      *                                                                                       CSW213
     C           @ERCD     IFEQ 'Y'                                                           CSW213
     C           *LOCK     IN   LDA                                                           CSW213
     C                     MOVE '017'     DBASE                                               CSW213
     C                     MOVELMGTTYP    DBKEY                                               CSW213
     C                     MOVE MGTNUM    DBKEY                                               CSW213
     C                     OUT  LDA                                                           CSW213
     C                     EXSR *PSSR                                                         CSW213
     C                     END                                                                CSW213
      *                                                                                       CSW213
     C                     ELSE                                                               CSW213
     C                     CALL 'MG5000'               26
     C                     PARM MGMODI    @MODI   2
     C                     PARM MGTNUM    @TRAN  15
     C                     PARM 'CE'      @PROG   2
     C                     PARM 'U'       @MODE   1
     C                     PARM *ZEROS    MGLSWC  30
     C                     PARM *ZEROS    MGLSWS  30
     C                     PARM *BLANKS   @ERCD   1
      *
      **  Error on access for sequence number
      *
     C           @ERCD     IFEQ 'Y'
     C           *LOCK     IN   LDA
     C                     MOVE '017'     DBASE            * * * * * * * *
     C                     MOVELMODI      DBKEY            *  DBERR 017  *
     C                     MOVE MTRN      DBKEY            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
     C                     ENDIF                                                              CSW213
      *
      **  Program missing on call
      *
     C           *IN26     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '018'     DBASE            * * * * * * * *
     C                     MOVE 'MG5000'  DBKEY            *  DBERR 018  *
     C                     OUT  LDA                        * * * * * * * *
     C                     EXSR *PSSR
     C                     END
      *
     C                     END
     C           *LOCK     IN   LDA
     C                     MOVEL'MG0340  'DBPGM
     C                     OUT  LDA
      *
      **  COMIT all changes since no error on writing the message
      *
     C                     COMIT
      *                                                                   221145
      **  Call Compliance Watch:Watch List Checking                       221145
      *                                                                   221145
     C           CSD015    IFEQ 'Y'                                       221145
     C           W1EWLC    ANDEQ'Y'                                                           222385
     C           CSW025    ANDEQ'N'                                       221145
     C                     EXSR WLCDQ                                     221145
     C                     ENDIF                                          221145
      *
      ** Read next available record in MGF340PD.
      *
     C                     READ MGF340PD                 01
      *
     C                     ENDDO
      *
      **  Write end of report, only if the printer file is open
      *
     C           *IN50     IFEQ '1'
     C                     WRITEEOREPT
     C                     END
     C/COPY WNCPYSRC,MG0340C001
      *
     C                     MOVE *ON       *INLR
      *
      /EJECT
      *****************************************************************
      *   INIT - initial process                                      *
      *   Called by - main process                                    *
      *****************************************************************
      *
     C           INIT      BEGSR
      *
     C                     MOVEACPY@      CPY2@  80
      *
      **  Set up LDA
      *
     C           *NAMVAR   DEFN           LDA
     C           *LOCK     IN   LDA
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     MOVEL'MG0340'  DBPGM
     C                     MOVE *BLANKS   DBASE
     C                     OUT  LDA
      *
      **  Access SDBANKPD for report title.
      *
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
      *
      ** If no record is found on sdbankpd.
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '001'     DBASE              * * * * * * *
     C                     MOVEL'FIRST'   DBKEY              * DBERR 001 *
     C                     MOVEL'SDBANKPD'DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      ** Correctly work out Date Format.
      *
     C           BJDFIN    COMP 'M'                      98
      *
      **  Access SDTRADPD for trading information.
      *
     C                     CALL 'AOTRADR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDTRAD    PARM SDTRAD    DSFDY
      *
      ** If no record is found on sdtradpd.
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '002'     DBASE              * * * * * * *
     C                     MOVEL'FIRST'   DBKEY              * DBERR 002 *
     C                     MOVEL'SDTRADPD'DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Access SDMMODPD for modules available.
      *
     C                     CALL 'AOMMODR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C           SDMMOD    PARM SDMMOD    DSFDY
      *
      ** If no record is found on sdmmodpd.
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '003'     DBASE              * * * * * * *
     C                     MOVEL'FIRST'   DBKEY              * DBERR 003 *
     C                     MOVEL'SDMMODPD'DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Access SDMGMEPD for message management data.
      *
     C                     CALL 'AOMGMER0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C           SDMGME    PARM SDMGME    DSFDY
      *
      ** If no record is found on sdmgmepd.
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '004'     DBASE            * * * * * * * *
     C                     MOVEL'FIRST'   DBKEY            *  DBERR 004  *
     C                     MOVEL'SDMGMEPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C/COPY WNCPYSRC,MG0340C002
      *
      ** Initialise constant fields.
      *
     C                     MOVE *LOVAL    CR      1
     C                     BITON'457'     CR
     C                     MOVE *LOVAL    LF      1
     C                     BITON'257'     LF
     C                     MOVELCR        CRLF    2
     C                     MOVE LF        CRLF
     C                     MOVE ':'       COLON1
     C                     MOVE ':'       COLON2
      *
      ** CRLF Control Character for message data records.
      *
     C                     MOVE CRLF      CTRC
      *
      ** Convert run date to YYMMDD, for Message Generation Date.
      *
     C                     CALL 'ZM0060'               15
     C                     PARM BJRDNB    ZMDAY   50
     C                     PARM           ZSDATE  6
      *
      ** Program ended in error.
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '005'     DBASE              * * * * * * *
     C                     MOVEL'       ' DBKEY              * DBERR 005 *
     C                     MOVEL'ZM0060'  DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     MOVE ZSDATE    MGDE
      *
      ** Set-up Message Generation Century flag                           184718
      *                                                                   184718
     C                     MOVELMGDE      YY      20                      184718
     C           YY        IFLT 72                                        184718
     C                     MOVE '2'       CIND                            184718
     C                     ELSE                                           184718
     C                     MOVE '1'       CIND                            184718
     C                     ENDIF                                          184718
     C*                                                                   184718
      ** Convert history retention date to YYMMDD.
      *
     C           BJRDNB    ADD  ENDSMN    ZMDAY
     C                     CALL 'ZM0060'               15
     C                     PARM           ZMDAY
     C                     PARM           ZSDATE
      *
      ** If the program ends in error.
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '006'     DBASE              * * * * * * *
     C                     MOVEL'       ' DBKEY              * DBERR 006 *
     C                     MOVEL'ZM0060'  DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     MOVE ZSDATE    @HRDT   6
      *
      ** Access Switchable features file to see if ConCord is switched
      ** ON.
      *
     C                     CALL 'AOSARDR0'
     C                     PARM '       ' RTCDA   7
     C                     PARM '*VERIFY' RTCDB   7
     C                     PARM 'CCF001'  RTCDC   6
      *
     C           RTCDA     IFEQ *BLANK
     C                     MOVE *ON       *IN27
     C                     END
      *                                                                   137909
      **  Access Switchable Features file for CEU003                      137909
      *                                                                   137909
     C                     CALL 'AOSARDR0'                                137909
     C                     PARM *BLANKS   @RTCD                           137909
     C                     PARM '*VERIFY' @OPTN                           137909
     C                     PARM 'CEU003'  @SARD   6                       137909
     C           @RTCD     IFEQ *BLANKS                                   137909
     C                     MOVEL'Y'       CEU003  1                       137909
     C                     ELSE                                           137909
     C                     MOVEL'N'       CEU003                          137909
     C                     ENDIF                                          137909
      *
      ** Check if Swift 2000 Changes is switched on.                      CSW200
      *                                                                   CSW200
     C                     CALL 'SWIF2000'                                CSW200
     C                     PARM *BLANKS   @RTCD   7                       CSW200
     C*                                                                   CSW200
     C           @RTCD     IFEQ 'CSW200'                                  CSW200
     C                     MOVE 'Y'       CSW200  1                       CSW200
     C                     OPEN MGU340PD                                  CSW200
     C                     END                                            CSW200
      *                                                                                       CSW201
      **  Access Switchable Features file for CSW201                                          CSW201
      *                                                                                       CSW201
     C                     CALL 'SWIF2001'                                                    CSW201
     C                     PARM *BLANKS   @RTCD                                               CSW201
      *                                                                                       CSW201
     C           @RTCD     IFEQ 'CSW2001'                                                     CSW201
     C                     MOVE 'Y'       CSW201  1                                           CSW201
     C                     ELSE                                                               CSW201
     C                     MOVE 'N'       CSW201                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSD015
      ** Check if CSD015 is enabled.                                                          CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD   7                                           CSD015
     C                     PARM '*VERIFY' POPTN   7                                           CSD015
     C                     PARM 'CSD015'  PSARN   6                                           CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CSD015  1                                           CSD015
     C                     MOVEL'N'       W1EWLC                                              222385
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSD015                                              CSD015
      *                                                                                       222385
      ** Access AOWLCCR0 to check if function code MESSGENT is available                      222385
      *                                                                                       222385
     C                     CALL 'AOWLCCR0'                                                    222385
     C                     PARM *BLANKS   PRTCD                                               222385
     C                     PARM '*KEY'    POPTN                                               222385
     C                     PARM 'MESSGENT'PFUNC   8                                           222385
     C           SDWLCC    PARM SDWLCC    DSFDY                                               222385
      *                                                                                       222385
     C           PRTCD     IFNE *BLANKS                                                       222385
     C           PRTCD     ANDNE'*NRF'                                                        222385
     C                     MOVEL'SDWLCCPD'DBFILE                                              222385
     C                     MOVELPFUNC     DBKEY                                               222385
     C                     Z-ADD32        DBASE                                               222385
     C                     EXSR *PSSR                                                         222385
     C                     ENDIF                                                              222385
      *                                                                                       222385
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE '*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     MOVELPSARN     DBKEY                                               CSD015
     C                     Z-ADD31        DBASE                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Check if CSW025 is enabled.                                                          CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY' POPTN                                               CSD015
     C                     PARM 'CSW025'  PSARN                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CSW025  1                                           CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSW025                                              CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE '*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     MOVELPSARN     DBKEY                                               CSD015
     C                     Z-ADD32        DBASE                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                   CSW200
      ** Construct key list to access MGU340PD                            CSW200
      *                                                                   CSW200
     C           KEYSQN    KLIST                                          CSW200
     C                     KFLD           @SEQN   50                      CSW200
      *                                                                   CSW200
      ** Check if switchable feature CSW213 is switched on                                    CSW213
      *                                                                                       CSW213
     C                     CALL 'SWIF2013'                                                    CSW213
     C                     PARM *BLANKS   @RTCD                                               CSW213
      *                                                                                       CSW213
     C           @RTCD     IFEQ 'CSW2013'                                                     CSW213
     C                     MOVE 'Y'       CSW213  1                                           CSW213
     C                     OPEN DLRPIFL1                                                    MD022981
     C                     ELSE                                                               CSW213
     C                     MOVE 'N'       CSW213                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                     MD022981
      ** Setup Key Field for DLRPIFPD                                                       MD022981
      *                                                                                     MD022981
     C           RPIFKY    KLIST                                                            MD022981
     C                     KFLD           KDTYP                                             MD022981
     C                     KFLD           KDLNO                                             MD022981
      *                                                                                       CSW214
      ** Check if switchable feature CSW214 is switched on                                    CSW214
      *                                                                                       CSW214
     C                     CALL 'SWIF2014'                                                    CSW214
     C                     PARM *BLANKS   PRTCD   7                                           CSW214
      *                                                                                       CSW214
     C           PRTCD     IFEQ 'CSW2014'                                                     CSW214
     C                     MOVE 'Y'       CSW214  1                                           CSW214
     C                     ELSE                                                               CSW214
     C                     MOVE 'N'       CSW214                                              CSW214
     C                     ENDIF                                                              CSW214
      *
     C                     ENDSR
     C/EJECT                                                                               MD022633A
      *****************************************************************                    MD022633A
      *                                                               *                    MD022633A
      *  GETRCL- Get record length                                    *                    MD022633A
      *                                                               *                    MD022633A
      *****************************************************************                    MD022633A
      *                                                                                    MD022633A
     C           GETRCL    BEGSR                                                           MD022633A
      *                                                                                    MD022633A
     C           'UTGETRCD'CAT  'LN'      P#PGM  10                                        MD022633A
      *                                                                                    MD022633A
     C                     CALL P#PGM                                                      MD022633A
     C                     PARM           P#RTCD 10                                        MD022633A
     C                     PARM           P#RCDL  50                                       MD022633A
     C                     PARM           P#FILN 10                                        MD022633A
     C                     PARM '*LIBL'   P#LIBN 10                                        MD022633A
      *                                                                                    MD022633A
     C           P#RTCD    IFNE *BLANK                                                     MD022633A
     C                     EXSR *PSSR                                                      MD022633A
     C                     ENDIF                                                           MD022633A
      *                                                                                    MD022633A
     C                     ENDSR                                                           MD022633A
      /EJECT
      *****************************************************************
      *   INTF - Initalise non-constant fields                        *
      *   Called by - main process                                    *
      *****************************************************************
      *
     C           INTF      BEGSR
      *
     C                     MOVE *BLANKS   AWBA6   6
     C                     MOVELMGAWBA    AWBA6   6
     C                     MOVE *BLANKS   TRNO
     C                     MOVE *BLANKS   @TRNA
     C                     MOVE '      '  NWRK
     C**********           Z-ADD0         SECN                                                CSD027
     C                     MOVE *BLANKS   SECN                                                CSD027
     C                     MOVE *BLANKS   NWSN
     C**********           Z-ADD0         DECN                                                CSD027
     C                     MOVE *BLANKS   DECN                                                CSD027
     C                     MOVE *BLANKS   NWDS
     C                     MOVE *BLANKS   MGSG
     C                     MOVE *BLANKS   MGST
     C                     MOVE *BLANKS   LSCC
     C                     MOVE *BLANK    F57U
     C                     MOVE *BLANKS   CWRD
     C                     Z-ADD0         MGTM
     C                     Z-ADD0         LATM
     C                     MOVE *BLANKS   RELD
     C                     Z-ADD0         RELT
     C                     MOVE *BLANKS   AMTS
     C                     MOVE *BLANKS   SVDT
     C                     MOVE *BLANKS   CINDV                           184718
      *
     C                     MOVE *BLANKS   @ERR    1
     C                     MOVE *BLANKS   SCSID  12
     C                     MOVE *BLANKS   STELX  10
     C                     MOVE *BLANKS   SSTTX  12
     C                     MOVE *BLANKS   SCRNM  20
     C                     MOVE *BLANKS   SPCNB   6
     C                     MOVE *BLANKS   SPAIN   1
      *                                                                                     MD022633
     C                     MOVE *BLANKS   WRKMRJ                                            MD022633
     C                     MOVE *BLANKS   WRKMRP                                            MD022633
     C                     MOVE *BLANKS   WRKMRN                                           MD022633A
     C                     MOVE *BLANKS   WRKMRC                                           MD022633A
     C                     MOVE *BLANKS   WRKMRS                                           MD022633A
     C                     MOVE *BLANKS   WRKMRL                                           MD022633A
     C                     MOVE *BLANKS   WRKMRA                                           MD022633A
      *
      **  Currently positioned at line 1 of Field :72:
      *
     C                     MOVE 'N'       LINE2   1
      *
      **  Clear multiple occurrence data structure
      *
     C**********           Z-ADD1         X       20                                          CSW213
     C                     Z-ADD1         X                                                   CSW213
     C           X         OCUR MULT
      *
     C***********X         DOWLE40                                        CSW200
     C********** X         DOWLE82                                                     CSW200 CSW213
     C           X         DOWLE200                                                           CSW213
     C           MULT      ANDNE*BLANKS
     C                     MOVE *BLANKS   MULT
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
      *
      **  Obtain sequence numbers from transaction record
      *
     C           MGACMI    IFEQ 'Y'                                                           CSW213
     C                     CALL 'MG5000'               26                                     CSW213
     C                     PARM MGTTYP    @MODI   2                                           CSW213
     C                     PARM MGTNUM    @TRAN  15                                           CSW213
     C                     PARM 'CE'      @PROG   2                                           CSW213
     C                     PARM *BLANKS   @MODE   1                                           CSW213
     C                     PARM *ZEROS    MGLSWC  30                                          CSW213
     C                     PARM *ZEROS    MGLSWS  30                                          CSW213
     C                     PARM *BLANKS   @ERCD   1                                           CSW213
      *                                                                                       CSW213
      ** Error on access for sequence number                                                  CSW213
      *                                                                                       CSW213
     C           @ERCD     IFEQ 'Y'                                                           CSW213
     C           *LOCK     IN   LDA                                                           CSW213
     C                     MOVE '007'     DBASE                                               CSW213
     C                     MOVELMGTTYP    DBKEY                                               CSW213
     C                     MOVE MGTNUM    DBKEY                                               CSW213
     C                     OUT  LDA                                                           CSW213
     C                     EXSR *PSSR                                                         CSW213
     C                     END                                                                CSW213
      *                                                                                       CSW213
     C                     ELSE                                                               CSW213
     C                     CALL 'MG5000'               26
     C                     PARM MGMODI    @MODI   2
     C                     PARM MGTNUM    @TRAN  15
     C                     PARM 'CF'      @PROG   2
     C                     PARM *BLANKS   @MODE   1
     C                     PARM *ZEROS    MGLSWC  30
     C                     PARM *ZEROS    MGLSWS  30
     C                     PARM *BLANKS   @ERCD   1
      *
      **  Error on access for sequence number
      *
     C           @ERCD     IFEQ 'Y'
     C           *LOCK     IN   LDA
     C                     MOVE '007'     DBASE            * * * * * * * *
     C                     MOVELMODI      DBKEY            *  DBERR 007  *
     C                     MOVE MTRN      DBKEY            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     ENDIF                                                              CSW213
      *
      **  Program missing on call.
      *
     C           *IN26     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '008'     DBASE            * * * * * * * *
     C                     MOVE 'MG5000'  DBKEY            *  DBERR 008  *
     C                     OUT  LDA                        * * * * * * * *
     C                     EXSR *PSSR
     C                     END
     C           *LOCK     IN   LDA
     C                     MOVEL'MG0340  'DBPGM
     C                     OUT  LDA
      *
      * If the branch code on the file MGF340PD is blank,
      * then defualt it to the branch code on the SDBRCHPD.
      *
     C           MGBRCA    IFEQ *BLANK
     C                     MOVELA8BRCD    MGBRCA
     C                     END
      *
      ** If our receive branch is blank then default it to the
      ** branch code.
      *
     C           MGROBR    IFEQ *BLANK
     C                     MOVELMGBRCA    MGROBR
     C                     END
      *
     C                     ENDSR
     C/EJECT                                                                                MD023007
      *****************************************************************                     MD023007
      *   SRRPPT - Match RPPT details for Reporting Jurisdiction and  *                     MD023007
      *            Reporting Party fields                             *                     MD023007
      *   Called by SRFMTG                                            *                     MD023007
      *   Calls -                                                     *                     MD023007
      *****************************************************************                     MD023007
      *                                                                                     MD023007
     C           SRRPPT    BEGSR                                                            MD023007
      *                                                                                     MD023007
      ** Initialize work fields                                                             MD023007
     C                     Z-ADD1         IX1     10                                        MD023007
     C                     Z-ADD1         IX2     10                                        MD023007
     C                     Z-ADD0         IX                                                MD023007
      *                                                                                     MD023007
      ** Main loop for RPPT                                                                 MD023007
      *                                                                                     MD023007
     C           IX1       DOWLE4                                                           MD023007
      *                                                                                     MD023007
     C           IX1       LOKUPIX                       98                                 MD023007
      *                                                                                     MD023007
     C           *IN98     IFEQ '0'                                                         MD023007
     C                     MOVE IX1       IX,IX2                                            MD023007
     C           IX1       OCUR RPPT                                                        MD023007
     C                     MOVELRPPT      WRPPT1136                                         MD023007
     C                     ADD  1         IX2                                               MD023007
      *                                                                                     MD023007
     C                     Z-ADD1         IX3     10                                        MD023007
      *                                                                                     MD023007
      ** Search a match for each Reporting Party details,                                   MD023007
      ** then resequence the occurence for all combined RPPT details                        MD023007
      *                                                                                     MD023007
     C           IX3       DOWLE4                                                           MD023007
      *                                                                                     MD023007
     C           IX3       IFNE IX1                                                         MD023007
     C           IX3       OCUR RPPT                                                        MD023007
     C                     MOVELRPPT      WRPPT2136                                         MD023007
      *                                                                                     MD023007
     C           WRPPT1    IFEQ WRPPT2                                                      MD023007
     C                     MOVE IX3       IX,IX2                                            MD023007
     C                     ADD  1         IX2                                               MD023007
     C                     ENDIF                                                            MD023007
     C                     ENDIF                                                            MD023007
      *                                                                                     MD023007
     C                     ADD  1         IX3                                               MD023007
      *                                                                                     MD023007
     C                     ENDDO                                                            MD023007
     C                     ENDIF                                                            MD023007
      *                                                                                     MD023007
     C                     ADD  1         IX1                                               MD023007
      *                                                                                     MD023007
     C                     ENDDO                                                            MD023007
      *                                                                                     MD023007
     C                     ENDSR                                                            MD023007
      /EJECT
      *****************************************************************
      *   SRROUT - determine message routing                          *
      *   Called by - main process                                    *
      *   Calls - MG9900 (Midas MG Standard routing API)              *
      *****************************************************************
      *
     C           SRROUT    BEGSR
      *
     C                     MOVE MGBRCA    I@SNBR
     C                     MOVE *BLANKS   I@DSCN
     C           MGACMI    IFEQ 'Y'                                                           CSW213
     C                     MOVELMGPTYA    I@DSCN                                              CSW213
     C                     ELSE                                                               CSW213
     C                     MOVE MGCNUM    I@DSCN
     C                     ENDIF                                                              CSW213
     C                     MOVE '340'     I@MTPY
     C                     MOVE 'Y'       I@CONC
     C                     Z-ADD0         I@SETT
     C                     MOVE *BLANK    I@FTCS
     C                     MOVE MGMODI    I@MMOD
      *
      * Add copy sources for enhancement methodology
      * one copy source for all MG generation programs and one
      * specific
      *
      * General
     C/COPY WNCPYSRC,MG9900CALL
      *
     C*********************CALL 'MG9900'                                                      CSW036
     C                     CALL 'MG9901'                                                      CSW036
     C                     PARM *BLANKS   @RTCD
     C                     PARM           P@IN
     C                     PARM *BLANKS   P@OUT
     C                     PARM           P@ZZ  256
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '019'     DBASE              * * * * * * *
     C                     MOVEL'*CALL  ' DBKEY              * DBERR 019 *
     C*********************MOVEL'MG9900'  DBFILE             * * * * * * *                    CSW036
     C                     MOVEL'MG9901'  DBFILE             * * * * * * *                    CSW036
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ELSE
     C                     MOVE O@NWRK    NWRK
     C**********           Z-ADDO@CNSN    SECN                                                CSD027
     C                     MOVE O@CNSN    SECN                                                CSD027
     C                     MOVE O@NWSN    NWSN
     C**********           Z-ADDMGCNUM    DECN                                                CSD027
     C                     MOVE MGCNUM    DECN                                                CSD027
     C                     MOVE O@NWDS    NWDS
     C                     MOVE O@MGSG    MGSG
     C                     MOVE O@MGST    MGST
     C                     MOVE O@PCNB    SPCNB
     C                     MOVE O@PAIN    SPAIN
     C                     END
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   FMTA - Format Sequence A MT340 fields for output.           *
      *   Called by - main process                                    *
      *   Calls - DATES format fields 30, 31C, 31E and 32a.           *
      *         - FLD72 format field 72                               *
      *****************************************************************
      *
     C           FMTA      BEGSR
      *
      ** Field :20: -  Transaction Reference Number.
      *
     C**********           Z-ADD1         X       20                                          CSW213
     C                     Z-ADD1         X                                                   CSW213
     C           X         OCUR MULT
     C                     MOVEA*BLANKS   @WRK
      *
     C                     Z-ADD1         Z       20
     C                     MOVEAMGMODI    @WRK
     C                     MOVEAMGTNUM    @WRK,3
     C           MGLSWS    ADD  1         HLSWS   30
     C                     MOVE HLSWS     HSWS    3
      *
     C           ' '       LOKUP@WRK,Z                   31
     C                     MOVEAHSWS      @WRK,Z
      *
      **  Check on MGREFPD for a uniqne TRN,else output as an error.
      **  and store the TRN of the new confirmation message.
      *
     C                     MOVEA@WRK      @TRNA  16
      *
     C           @TRNA     CHAINMGREFL0              11
      *
      ** If record is found flag field is in error.
      *
     C           *IN11     IFEQ '0'
     C                     MOVE 'Y'       @ERR
     C                     MOVEAMSGA,8    MERR
     C                     END
      *
     C                     MOVEL':20:'    MTAG
     C                     MOVEA@WRK      MFLD
      *
      ** Field :21: - Related Reference.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVEA*BLANKS   @WRK
      *
      ** If related ref. is not blank, then use it as field of tag.
      *
     C           MGRREF    IFNE *BLANKS
     C                     MOVELMGRREF    MFLD
      *
      **  Obtain transaction reference of previous MT340                                      190127
     C                     MOVELMGTNUM    HSTRAN                                              190127
     C                     MOVE '340'     HSMTPY                                              190127
      *                                                                                       190127
     C                     MOVE HSTRAN    @HTRN   6                                           190127
      *                                                                                       190127
     C***********HSKEY     SETGTMGHISTL0                                               190127 CSW213
     C***********          READPMGHISTL0                 56                            190127 CSW213
     C           HSKEY     SETGTMGHISTL7                                                      CSW213
     C                     READPMGHISTL7                 56                                   CSW213
      *                                                                                       190127
     C           *IN56     IFEQ '0'                                                           190127
     C           HSMODI    ANDEQMGMODI                                                        190127
     C           HSTRAN    ANDEQ@HTRN                                                         190127
     C           HSMTPY    ANDEQ'340'                                                         190127
     C                     MOVEL@HREF     MFLD                                                190127
     C                     END                                                                190127
      *                                                                                       190127
     C                     ELSE
     C                     MOVEL'NEW'     MFLD
     C                     ENDIF
      *
     C                     MOVEL':21:'    MTAG
      *
      ** Field :22: - Code/Common Reference.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZCREF
      *
      ** If SWIFT network, use sender & destination customer swift ad.
      ** and the exchange rate to produce the common reference. Else
      ** use the message TRN.
      *
     C           NWRK      IFEQ 'SWIFT'
     C           NWRK      OREQ 'STTX'
      *
     C           NWRK      IFEQ 'SWIFT'
     C                     MOVELNWSN      ZSSWI
     C                     MOVELNWDS      ZDSWI
     C                     ELSE
     C                     MOVELSCSID     ZSSWI
     C                     MOVELCSID      ZDSWI
     C                     END
      *
     C                     MOVE MGINTR    ZRATE
      *
      ** Format SWIFT common reference.
      *
     C                     CALL 'ZM0020'               15
     C                     PARM           ZSSWI  12
     C                     PARM           ZDSWI  12
     C                     PARM           ZRATE  138
     C                     PARM           ZCREF  16
      *
      ** If the program ends in error.
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '011'     DBASE              * * * * * * *
     C                     MOVEL'       ' DBKEY              * DBERR 011 *
     C                     MOVEL'ZM0020'  DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     END
      *
     C           ZCREF     IFEQ *BLANKS
     C                     MOVEL@TRNA     ZCREF
     C                     END
      *
     C                     MOVEL':22:'    MTAG
      *
      ** Construct Field 22 - 'codeword/common reference'.
      *
      ** If last change type is equal to ' ', codeword is set to
      ** 'NEW', if equal to 'A', then set it to 'AMEND', else if
      ** equal to 'C', then set it to 'CANCEL'.
      *
     C***********MGCHTP    IFEQ ' '                                       175948
     C           MGCHTP    IFEQ 'I'                                       175948
     C                     MOVEL'NEW     'CWRD
     C                     ELSE
      *
     C           MGCHTP    IFEQ 'A'
     C                     MOVEL'AMEND   'CWRD
     C                     ELSE
      *
     C                     MOVEL'CANCEL  'CWRD
      *
     C                     ENDIF
     C                     ENDIF
      *
     C**********           Z-ADD1         I       20                                          CSW213
     C                     Z-ADD1         I                                                   CSW213
     C                     MOVEA*BLANKS   @WRK
     C                     MOVEACWRD      @WRK,I
     C           ' '       LOKUP@WRK,I                   31
      *
     C                     MOVEA'/'       @WRK,I
     C                     ADD  1         I
     C                     MOVEAZCREF     @WRK,I
     C                     MOVEA@WRK      MFLD
      *
      ** Codeword blank.
      *
     C           CWRD      IFEQ *BLANKS
     C                     MOVE 'Y'       @ERR
     C                     MOVEAMSGA,7    MERR
     C                     END
      *
      ** Format fields 30, 31C, 31E, and 32a via SR/DATES.
      *
     C                     EXSR DATES
      *
      ** Field :37M: - Contract rate.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     Z-ADDMGINTR    ZPRIC  158
     C                     MOVE *BLANKS   ZSPRIC 16
     C                     MOVE *BLANKS   ZOPRIC 21
      *
      ** Format :37M:
      *
     C                     CALL 'ZM1190'               28
     C                     PARM           ZPRIC
     C                     PARM           ZSPRIC
     C                     PARM           ZOPRIC
      *
      ** If program is not found, then dbase error.
      *
     C           *IN28     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '015'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 015  *
     C                     MOVEL'ZM1190'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
     C                     MOVE ':37M:'   MTAG
      *
     C                     MOVELZSPRIC    MFLD
      *
      ** Format :38D: - Contract Period.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE ':38D:'   MTAG
     C                     MOVELMGCPER    MFLD
      *
      ** Format field :77D: - Conditions.
      *
     C           MGCON1    IFNE *BLANKS
      *
      ** Store the CONDITIONS information for easier use.
      *
     C                     MOVE MGCON1    S2RF,1
     C                     MOVE MGCON2    S2RF,2
     C                     MOVE MGCON3    S2RF,3
     C                     MOVE MGCON4    S2RF,4
     C                     MOVE MGCON5    S2RF,5
     C                     MOVE MGCON6    S2RF,6
      *
     C                     Z-ADD0         I
     C                     MOVE 'N'       FLD77O  1
      *
      ** Search through all six fields & output if not blank.
      *
     C           I         DOWLT6
      *
     C                     ADD  1         I
     C           S2RF,I    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C           FLD77O    IFEQ 'N'
     C                     MOVE ':77D:'   MTAG
     C                     MOVE 'Y'       FLD77O
     C                     ENDIF
     C                     MOVELS2RF,I    MFLD
     C                     ENDIF
      *
     C                     ENDDO
      *
     C                     ENDIF
      *
      ** Format field :72:
      *
     C                     EXSR FLD72
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   REPT - print incorrectly generated messages                 *
      *   Called by - main process                                    *
      *****************************************************************
      *
     C           REPT      BEGSR
      *
      ** If MG0340P1 has not previously opened.
      *
     C           *IN50     IFEQ '0'
     C                     OPEN MG0340P1
     C                     MOVE *ON       *IN50
     C                     END
      *
     C                     WRITEHEADER
     C                     WRITETEXT
      *
      **  Process multiple occurrence data structure
      *
     C**********           Z-ADD0         I       20                                          CSW213
     C                     Z-ADD0         I                                                   CSW213
     C           I         DOWLEX
     C                     ADD  1         I
     C           I         OCUR MULT
      *                                                                                       CSW213
     C           *IN99     IFEQ '1'                                                           CSW213
     C                     WRITEHEADER                                                        CSW213
     C                     WRITETEXT                                                          CSW213
     C                     WRITELINE
     C                     ELSE                                                               CSW213
     C                     WRITELINE                                                          CSW213
     C                     ENDIF                                                              CSW213
      *
     C                     END
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   OMSG - output correctly generated messages                  *
      *   Called by - main process                                    *
      *   Calls - WREF Write o/p reference to PF/MGOREFPD.            *
      *****************************************************************
      *
     C           OMSG      BEGSR
      *
      **  Write reference record to PF/MGOREFPD.
      *
     C                     EXSR WREF
      *
      **  Write multiple occurrence data structure to MGOMSGPD
      *
     C**********           Z-ADD1         X       20                                          CSW213
     C                     Z-ADD1         X       30                                          CSW213
     C           X         OCUR MULT
      *
     C***********X         DOWLE40                                        CSW200
     C***********MFLD      ANDNE*BLANKS                                   CSW200
     C********** X         DOWLE82                                                     CSW200 CSW213
     C           X         DOWLE193                                                           CSW213
     C           MFLD      ANDNE*BLANKS                                   CSW200
     C********** X         ORLE 82                                                     CSW200 CSW213
     C           X         ORLE 193                                                           CSW213
     C           MTAG      ANDNE*BLANKS                                   CSW200
     C                     WRITEMGOMSGD0               06
      *
      **  Error on write to PF/MGOMSGPD (message data file)
      *
     C           *IN06     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '012'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 012  *
     C                     MOVEL'MGOMSGPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   WREF - Write reference record to PF/MGOREFPD                *
      *   Called by - OMSG  output message PF/MGOMSGPD                *
      *****************************************************************
      *
     C           WREF      BEGSR
      *
     C                     MOVE *BLANKS   SYTM
     C                     MOVE MGMODI    MODI
     C                     MOVE @TRNA     TRNO
     C                     MOVE *BLANKS   TRNF
     C                     MOVE *BLANKS   TRNM
      *                                                                                       CSW213
     C           MGACMI    IFEQ 'Y'                                                           CSW213
     C                     MOVEL@TRNID    MTRN                                                CSW213
     C                     ELSE                                                               CSW213
     C                     MOVELMGTNUM    MTRN
     C                     ENDIF                                                              CSW213
     C                     MOVE MGTTYP    TNTP
     C                     MOVE MGTSTP    SBTP
     C                     MOVE MGEVTP    EVTP
     C                     MOVEL*BLANKS   NWBN
     C                     MOVE '340'     MTPY
     C                     MOVE 'N'       MPRY
     C                     MOVELCWRD      LSCC
     C                     MOVEL*BLANKS   PTST
     C                     MOVEL*BLANKS   CARQ
     C                     MOVEL*BLANKS   MPDE
     C                     MOVEL@HRDT     HRDT
     C                     TIME           MGTM
     C                     MOVE BJMRDT    LADT
     C                     MOVE MGTM      LATM
      *                                                                                       CSD015
      ** Initiate the Midas Watch List Checking Engine if CSD015 is                           CSD015
      ** enabled and CSW025 is disabled.                                                      CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           222385
     C           CSW025    ANDEQ'N'                                                           CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *
     C           MGST      IFEQ 'RSND'
     C                     MOVE BJMRDT    RELD
     C                     MOVE MGTM      RELT
     C                     MOVE '2'       MGSG
     C                     END
     C           MGST      IFEQ 'CRTD'
     C                     MOVE '1'       MGSG
     C                     END
     C           MGST      IFEQ 'PRTD'
     C                     MOVE '3'       MGSG
     C                     END
      *
     C                     MOVEL*BLANKS   RUSR
     C                     MOVEL*BLANKS   RWSN
     C                     MOVEL*BLANKS   AMTS
     C                     MOVEL*BLANKS   AMTX
     C                     MOVEL*BLANKS   SVDT
     C                     MOVEL*BLANKS   CINDV                           184718
     C                     MOVEL*BLANKS   CCY
     C                     MOVEL*BLANKS   NSNO
     C                     MOVEL*BLANKS   SACN
     C                     MOVEL*BLANKS   AORR
     C                     MOVEL*BLANKS   DESI
      *
      **  Branch details
      *
     C                     MOVE MGBRCA    BRCA
     C                     MOVE MGPOBR    OTHB
     C           OTHB      IFNE *BLANKS
     C                     MOVELMSGA,1    OTHT
     C                     END
     C                     MOVE MGROBR    RCBR
      *
     C                     MOVE *BLANKS   NETI
     C                     MOVE *BLANKS   DELC
     C                     MOVE *BLANKS   DYST
     C                     MOVE *BLANKS   RSID
     C                     MOVE *BLANKS   MSE1
     C                     MOVE *BLANKS   ELIN
     C                     MOVE *BLANKS   SSAC
     C                     MOVE *BLANKS   MIR
     C                     MOVE *BLANKS   TSKS
     C                     MOVE *BLANKS   TSKY
     C                     MOVE MGCHTP    AORR                                                CSW025
     C/COPY WNCPYSRC,MG0340C003
      *
     C                     WRITEMGOREFD0               05
      *
      **  Error on write to PF/MGOREFPD (message reference file)
      *
     C           *IN05     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '013'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 013  *
     C                     MOVEL'MGOREFPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      ** Write transaction history record                                                     190127
      *                                                                                       CSW213
     C           MGACMI    IFEQ 'Y'                                                           CSW213
     C                     MOVELTRNO      @HREF1                                              CSW213
     C                     MOVE '000'     HSSEQ                                               CSW213
     C                     MOVE @SSEQ     HSSEQ                                               CSW213
     C                     ELSE                                                               CSW213
     C                     MOVELTRNO      @HREF                                               190127
     C                     MOVE *BLANKS   HSDEST                                            MD023802
     C                     ENDIF                                                              CSW213
     C                     MOVE '340'     HSMTPY                                              190127
      *                                                                                       190127
     C**********           WRITEMGHISTD0               56                              190127 CSW213
     C                     WRITEMGHIST                 56                                     CSW213
      *                                                                                       190127
      **  Error on write to PF/MGHISTPD                                                       190127
     C           *IN56     IFEQ '1'                                                           190127
     C           *LOCK     IN   LDA                                                           190127
     C                     MOVE '027'     DBASE            * * * * * * * *                    190127
     C                     MOVEL'       ' DBKEY            *  DBERR 027  *                    190127
     C                     MOVEL'MGHISTPD'DBFILE           * * * * * * * *                    190127
     C                     OUT  LDA                                                           190127
     C                     EXSR *PSSR                                                         190127
     C                     END                                                                190127
      *
     C                     ENDSR
     C/COPY WNCPYSRC,MG0340C004
      /EJECT
      *****************************************************************
      *   DATES - Format Date fields.                                 *
      *   Called by - FMTA  Format Sequence A MT340 fields for output *
      *****************************************************************
      *
     C           DATES     BEGSR
      *
      **  Field :30: - Date contract/agreed/amended.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE MGTDAT    ZMDAY
      *
      ** Convert Midas date to SWIFT date format.
      *
     C                     CALL 'ZM0060'               15
     C                     PARM           ZMDAY   50
     C                     PARM           ZSDATE  6
      *
      ** Call ended in error. (Program not found.)
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '014'     DBASE              * * * * * * *
     C                     MOVEL'       ' DBKEY              * DBERR 014 *
     C                     MOVEL'ZM0060'  DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
     C                     MOVE ':30: '   MTAG
     C                     MOVELZSDATE    MFLD
      *
      ** Field :31C:  Fixing Date.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE MGFDAT    ZMDAY
      *
      ** Convert Midas date to SWIFT date format.
      *
     C                     CALL 'ZM0060'               15
     C                     PARM           ZMDAY   50
     C                     PARM           ZSDATE  6
      *
     C                     MOVE ':31C:'   MTAG
     C                     MOVELZSDATE    MFLD
      *
      *  Field :31E: Settlement Date.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE MGSDAT    ZMDAY
      *
      ** Convert Midas date to SWIFT date format.
      *
     C                     CALL 'ZM0060'               15
     C                     PARM           ZMDAY   50
     C                     PARM           ZSDATE  6
      *
     C                     MOVE ':31E:'   MTAG
     C                     MOVELZSDATE    MFLD
      *
      ** Field :32: Maturity Date, Currency and Notional Amount.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE MGMDAT    ZMDAY
      *
      ** Convert Midas date to SWIFT date format.
      *
     C                     CALL 'ZM0060'               15
     C                     PARM           ZMDAY   50
     C                     PARM           ZSDATE  6
      *
      ** Format currency code and notional amount.
      *
     C                     MOVE MGCCY     ZCCY
     C                     MOVE MGNOAM    ZAMNT
     C                     CALL 'ZM0040'
     C                     PARM           ZAMNT  130
     C                     PARM           ZCCY    3
     C                     PARM           ZSAMNT 15
     C                     PARM           ZSCCY   3
     C                     PARM           ZERR    1
     C                     PARM           ZSWDPC  1                                           222373
      *
      ** If buy/sell indicator is 'S' (SELL) then format field
      ** :32P:, otherwise field :32R:.
      *
     C           MGPORR    IFEQ 'P'
     C                     MOVE ':32P:'   MTAG
     C                     ELSE
     C                     MOVE ':32R:'   MTAG
     C                     END
      *
      ** Error - indicate erroneous fields;
      *
     C           ZERR      IFEQ '1'
     C                     MOVE 'Y'       @ERR
     C                     MOVELERR3N     MFLD
     C                     MOVELMSGA,5    MERR
      *
     C                     ELSE
     C                     MOVELFLD3N     MFLD
     C                     END
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   FMTC - Format Sequence C MT340 fields for output. (57a)     *
      *   Called by - Main Processing                                 *
      *   Calls       FSWAD  Format Swift Address.                    *
      *****************************************************************
      *
     C           FMTC      BEGSR
      *
     C                     MOVE *BLANKS   @WRK
     C                     MOVE MGPSTM    @STM    2
     C                     MOVE 'N'       FLD57O  1
      *
      ** Field :57:  A/C with institution non-blank.
      *
     C           MGAWBN    IFNE *BLANKS
      *
      ** Format Account with institution. (Field 57.)
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELMGAWBN    ZDEST
     C                     MOVELMGAWBA    ACLINE
     C                     MOVE ' '       TAG
     C                     MOVE '57'      FLDNO
     C                     EXSR FSWAD
     C                     MOVE 'Y'       FLD57O  1
      *
      ** A/C with Inst. is equal to blank.
      *
     C                     ELSE
      *
     C           AWBA6     IFEQ 'DIRECT'
      *
      **  A/C with Inst. set up as DIRECT, use beneficiary details
      **  Format Account with institution. (Field 57.)
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELMGBENN    ZDEST
     C                     MOVELMGBENA    ACLINE
     C                     MOVE ' '       TAG
     C                     MOVE '57'      FLDNO
     C                     EXSR FSWAD
     C                     MOVE 'Y'       FLD57O
      *
      **  A/C with Inst. blank and NOT "DIRECT" entered,
      *
     C                     ELSE
      *
      **  Field 57 = pay nostro customer if settlement via '02' or '12'
      *
     C           MGPSTM    IFEQ 02
     C           MGPSTM    OREQ 12
     C                     MOVELMGPONS    @NONB
      *                                                                   137909
      ** Use settlement currency to access nostro if not blank.           137909
      ** Otherwise use deal currency.                                     137909
     C           CEU003    IFEQ 'Y'                                       137909
     C           MGSTCY    ANDNE*BLANKS                                   137909
     C                     MOVE MGSTCY    @CYCD                           137909
     C                     ELSE                                           137909
     C                     MOVE MGCCY     @CYCD                           137909
     C                     ENDIF                                          137909
      *                                                                   137909
     C                     CALL 'AONOSTR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM *BLANKS   @CUST   6
     C***********          PARM MGCCY     @CYCD   3                       137909
     C                     PARM           @CYCD   3                       137909
     C**********           PARM *BLANKS   @ACCD   4                                           CGL029
     C                     PARM *BLANKS   @ACCD  10                                           CGL029
     C                     PARM *BLANKS   @ACSN   2
     C                     PARM           @NONB   2
     C                     PARM *BLANKS   @BRCD   3
     C                     PARM *BLANKS   @CSSN  10
     C                     PARM *BLANKS   @PNOI   1
     C           SDNOST    PARM SDNOST    DSFDY
      *
      **  Nostro customer not found
      *
     C           @RTCD     IFNE *BLANKS
     C                     MOVE 'Y'       @ERR
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELMGPONS    HLD2    2
     C                     MOVELMGCCY     HLD5
     C                     MOVE HLD2      HLD5    5
     C                     MOVELHLD5      MFLD
     C                     MOVELMSGA,3    MERR
     C                     MOVE ':57 :'   MTAG
     C                     ELSE
      *
      **  Format our Pay Nostro Customer Address
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELA7CUST    ZDEST
     C                     MOVEL*BLANKS   ACLINE
     C                     MOVE ' '       TAG
     C                     MOVE '57'      FLDNO
     C                     EXSR FSWAD
     C                     MOVE 'Y'       FLD57O
     C                     END
      *
     C                     ELSE
      *
     C           MGPSTM    IFNE 00
     C                     MOVE MGPSTM    @STM
     C           @STM      LOKUPTABINT                   23
      *
     C           *IN23     IFEQ '1'
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELSECN      ZDEST
     C                     MOVEL*BLANKS   ACLINE
     C                     MOVE ' '       TAG
     C                     MOVE '57'      FLDNO
     C                     EXSR FSWAD
     C                     MOVE 'Y'       FLD57O
     C                     ENDIF
      *
     C                     END
     C                     END
     C                     END
     C                     END
      *
      **  Settlement 01,07 or 08 with MGAWBN blank or settlement 00
      *
     C           FLD57O    IFEQ 'N'
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE ':57D:'   MTAG
     C                     MOVEL'UNKNOWN' MFLD
      *
      *
     C                     END
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   FMTB  - Format Sequence B MT340 fields for output. (57a)    *
      *   Called by - Main Processing                                 *
      *   Calls     - FSWAD  Format swift address.                    *
      *****************************************************************
      *
     C           FMTB      BEGSR
      *
     C                     MOVE *BLANKS   @WRK
      *
      ** Branch code of sender not equal to Receive settlement branch.
      *
      **  Test if settlement via nostro
     C                     MOVE MGRSTM    @STM
     C           @STM      LOKUPTABNST                   23
     C           MGBRCA    IFNE MGROBR
     C           *IN23     ANDEQ'1'
      *
      ** Field :57:  A/C With Institution.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *                                                                   137909
      ** Use settlement currency to access nostro if not blank.           137909
      ** Otherwise use deal currency.                                     137909
     C           CEU003    IFEQ 'Y'                                       137909
     C           MGSTCY    ANDNE*BLANKS                                   137909
     C                     MOVE MGSTCY    @CYCD                           137909
     C                     ELSE                                           137909
     C                     MOVE MGCCY     @CYCD                           137909
     C                     ENDIF                                          137909
      *                                                                   137909
     C                     CALL 'AONOSTR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM *BLANKS   @CUST   6        I:Customer No
     C***********          PARM MGCCY     @CYCD   3        I:Currency     137909
     C                     PARM           @CYCD   3        I:Currency     137909
     C**********           PARM *BLANKS   @ACCD   4        I:A/c Code                         CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2        I:A/c Seq
     C                     PARM MGRONS    @NONB   2        I:Nostro No
     C                     PARM *BLANKS   @BRCD   3        I:Branch Code
     C                     PARM *BLANKS   @CSSN  10        I:Cust ShortN
     C                     PARM *BLANK    @PNOI   1        I:Prime Nost In
     C           SDNOST    PARM SDNOST    DSFDY
      *
      ** If our receive nostro is not found.
      *
     C           @RTCD     IFNE *BLANKS
     C                     MOVE 'Y'       @ERR
     C                     MOVELMGRONS    HLD2    2
     C                     MOVELMGCCY     HLD5
     C                     MOVE HLD2      HLD5    5
     C                     MOVELHLD5      MFLD
     C                     MOVELMSGA,3    MERR
     C                     MOVE ':57 :'   MTAG
     C                     ELSE
      *
      ** Format our Receive Nostro Customer Address.
      *
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELA7CUST    ZDEST
     C                     MOVEL*BLANKS   ACLINE 35
     C                     MOVE ' '       TAG
     C                     MOVE '57'      FLDNO
     C                     EXSR FSWAD
     C                     END
      *
      ** Else the branch code of sender = receive settlement branch
      ** and the settlement is via a nostro.
      *
     C                     ELSE
      *
     C           @STM      LOKUPTABNST                   23
      *
     C           *IN23     IFEQ '1'
     C                     ADD  1         X
     C           X         OCUR MULT
      *                                                                   137909
      ** Use settlement currency to access nostro if not blank.           137909
      ** Otherwise use deal currency.                                     137909
     C           CEU003    IFEQ 'Y'                                       137909
     C           MGSTCY    ANDNE*BLANKS                                   137909
     C                     MOVE MGSTCY    @CYCD                           137909
     C                     ELSE                                           137909
     C                     MOVE MGCCY     @CYCD                           137909
     C                     ENDIF                                          137909
      *                                                                   137909
     C                     CALL 'AONOSTR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM *BLANKS   @CUST   6        I:Customer No
     C**********           PARM MGCCY     @CYCD   3        I:Currency     137909
     C                     PARM           @CYCD   3        I:Currency     137909
     C**********           PARM *BLANKS   @ACCD   4        I:A/c Code                         CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2        I:A/c Seq
     C                     PARM MGRONS    @NONB   2        I:Nostro No
     C                     PARM *BLANKS   @BRCD   3        I:Branch Code
     C                     PARM *BLANKS   @CSSN  10        I:Cust ShortN
     C                     PARM *BLANK    @PNOI   1        I:Prime Nost In
     C           SDNOST    PARM SDNOST    DSFDY
      *
      **  If our receive nostro is not found.
      *
     C           @RTCD     IFNE *BLANKS
     C                     MOVE 'Y'       @ERR
     C                     MOVELMGRONS    HLD2
     C                     MOVELMGCCY     HLD5
     C                     MOVE HLD2      HLD5
     C                     MOVELHLD5      MFLD
     C                     MOVELMSGA,3    MERR
     C                     MOVE ':57 :'   MTAG
     C                     ELSE
      *
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELA7CUST    ZDEST
      *
     C                     MOVEL*BLANKS   ACLINE
     C                     MOVE ' '       TAG
     C                     MOVE '57'      FLDNO
     C                     EXSR FSWAD
     C                     END
      *
     C                     ELSE
      *
      ** Settlement method internal.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C           MGRSTM    IFNE 00
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELSECN      ZDEST
     C                     MOVEL*BLANKS   ACLINE
     C                     MOVE ' '       TAG
     C                     MOVE '57'      FLDNO
     C                     EXSR FSWAD
      *
      ** No settlement type entered.
      *
     C                     ELSE
     C                     MOVE ':57D:'   MTAG
     C                     MOVEL'UNKNOWN' MFLD
     C                     END
     C                     END
      *
     C                     END
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   FSWAD - Format SWIFT address                                *
      *   Called by - FMTB  - Format fields :57a:                     *
      *               FMTC  - Format fields :57a:                     *
      *****************************************************************
      *
     C           FSWAD     BEGSR
      *
     C*********************CALL 'ZM0050'                                                      CSW036
     C                     CALL 'ZM0051'                                                      CSW036
     C                     PARM           ZDEST  12
     C                     PARM           ZSADD1 35
     C                     PARM           ZSADD2 35
     C                     PARM           ZSADD3 35
     C                     PARM           ZSADD4 35
     C                     PARM           ZSTAG   1
     C                     PARM           ZSTYPE  1
     C                     PARM           ZERR    1
     C                     PARM           ZDBEI   1                                           CSW201
      *
      ** Error ?
      *
     C           ZERR      IFEQ '1'
     C                     MOVE 'Y'       @ERR
     C                     MOVE @MTAG     MTAG
     C                     MOVELZDEST     MFLD
     C                     MOVELMSGA,6    MERR
     C                     ELSE
      *
      ** Address 1
      *
     C           ACLINE    IFNE *BLANKS
     C                     MOVELACLINE    MFLD
     C                     ELSE
     C                     MOVELZSADD1    MFLD
     C                     END
      *
      ** SWIFT address;  Else full address.
      *
     C           ZSTAG     IFEQ 'A'
     C                     MOVE 'A'       TAG
     C                     MOVE @MTAG     MTAG
     C           ACLINE    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD1    MFLD
     C                     END
      *
     C                     ELSE
     C                     MOVE 'D'       TAG
     C                     MOVE @MTAG     MTAG
     C           ACLINE    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD1    MFLD
     C                     END
      *
      **  Address 2
      *
     C           ZSADD2    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD2    MFLD
     C                     END                             Address 2
      *
      **  Address 3
      *
     C           ZSADD3    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD3    MFLD
     C                     END                             Address 3
      *
      **  Address 4
      *
     C           ZSADD4    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD4    MFLD
     C                     END                             Address 4
     C                     END                             Address 1
      *
     C                     END                             Error ?
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   FLD72 - Format Field 72 (Sender to Receiver Information)    *
      *   Called by - Main process                                    *
      *   Calls     -                                                 *
      *****************************************************************
      *
     C           FLD72     BEGSR
      *
     C                     MOVE *BLANK    WKS2R1                          176709
     C                     MOVE *BLANK    WKS2R2                          176709
     C                     MOVE *BLANKS   @WRK                            135960
      *                                                                   135960
      **  Output /TELEX/                                                  135960
     C           MGBRKC    IFEQ 'TELX'                                    135960
     C                     MOVEA'/TELEX/' @WRK,1                          135960
     C                     MOVE '1'       *IN25                           135960
     C                     END                                            135960
      *                                                                   135960
      **  Output /PHON/                                                   135960
     C           MGBRKC    IFEQ 'PHON'                                    135960
     C                     MOVEA'/PHON/'  @WRK,1                          135960
     C                     MOVE '1'       *IN25                           135960
     C                     END                                            135960
      *                                                                   135960
     C           MGBRKC    IFNE 'TELX'                                    135960
     C           MGBRKC    ANDNE'PHON'                                    135960
     C           MGBRKC    ANDNE'MAIL'                                    135960
     C           MGBRKC    ANDNE'SWAP'                                    135960
     C           MGBRKC    ANDNE*BLANKS                                   135960
      *                                                                   135960
      **  Access the broker file                                          135960
     C                     CALL 'AOBROKR0'                                135960
     C                     PARM '*MSG   ' @RTCD   7                       135960
     C                     PARM '*KEY   ' @OPTN   7                       135960
     C                     PARM MGBRKC    @BROKY  4                       135960
     C           SDBROK    PARM SDBROK    DSFDY                           135960
      *                                                                   135960
      ** If the broker code is not found.                                 135960
     C           @RTCD     IFNE *BLANKS                                   135960
     C                     MOVE 'Y'       @ERR                            135960
     C                     MOVELMSGA,4    MERR                            135960
     C                     MOVEAMGBRKC    @WRK,1                          135960
     C                     MOVE '1'       *IN25                           135960
      *                                                                   135960
      ** Format the broker field.                                         135960
     C                     ELSE                                           135960
     C                     MOVEA'/BROKER/'@WRK,1                          135960
     C                     MOVEAA9BKNM    @WRK,9                          135960
     C                     MOVE '1'       *IN25                           135960
     C                     END                                            135960
     C                     END                                            135960
      *                                                                   135960
      ** Maximum length of field is 35                                    135960
     C                     MOVEA@WRK,36   @WRK15 15                       135960
     C           @WRK15    IFNE *BLANK                                    135960
     C                     Z-ADD36        J       20                      135960
     C                     MOVEA*BLANK    @WRK,J                          135960
     C                     END                                            135960
      *                                                                   135960
      **  Output Field :72: as constructed from above                     135960
      *                                                                   135960
     C           @WRK,1    IFNE *BLANK                                    135960
     C***********          MOVEA@WRK      MGS2R1                   135960 176709
     C                     MOVEA@WRK      WKS2R1 35                       176709
     C                     END                                            135960
      *                                                                   135960
      ** Wrap round to the next line the remainder of the BROKER info.    135960
     C           @WRK15    IFNE *BLANK                                    135960
     C                     MOVEA*BLANK    @WRK                            135960
     C                     MOVEA'//'      @WRK,1                          135960
     C                     MOVEA@WRK15    @WRK,3                          135960
     C***********          MOVEA@WRK      MGS2R2                   135960 176709
     C                     MOVEA@WRK      WKS2R2 35                       176709
     C                     ENDIF                                          135960
      *                                                                   135960
      ** Store the Sender to Receiver information for easier use.
      *
     C           WKS2R1    IFEQ *BLANKS                                   176709
     C           WKS2R2    ANDEQ*BLANKS                                   176709
     C                     MOVE MGS2R1    S2RF,1
     C                     MOVE MGS2R2    S2RF,2
     C                     MOVE MGS2R3    S2RF,3
     C                     MOVE MGS2R4    S2RF,4
     C                     MOVE MGS2R5    S2RF,5
     C                     MOVE MGS2R6    S2RF,6
     C                     ELSE                                           176709
     C           WKS2R1    IFNE *BLANKS                                   176709
     C           WKS2R2    ANDEQ*BLANKS                                   176709
     C                     MOVE WKS2R1    S2RF,1                          176709
     C                     MOVE MGS2R1    S2RF,2                          176709
     C                     MOVE MGS2R2    S2RF,3                          176709
     C                     MOVE MGS2R3    S2RF,4                          176709
     C                     MOVE MGS2R4    S2RF,5                          176709
     C                     MOVE MGS2R5    S2RF,6                          176709
     C                     ELSE                                           176709
     C           WKS2R1    IFNE *BLANKS                                   176709
     C           WKS2R2    ANDNE*BLANKS                                   176709
     C                     MOVE WKS2R1    S2RF,1                          176709
     C                     MOVE WKS2R2    S2RF,2                          176709
     C                     MOVE MGS2R1    S2RF,3                          176709
     C                     MOVE MGS2R2    S2RF,4                          176709
     C                     MOVE MGS2R3    S2RF,5                          176709
     C                     MOVE MGS2R4    S2RF,6                          176709
     C                     ENDIF                                          176709
     C                     ENDIF                                          176709
     C                     ENDIF                                          176709
      *
     C                     Z-ADD0         I
     C                     MOVE 'N'       FLD72O  1
      *
      ** Search through all six fields & output if not blank.
      *
     C           I         DOWLT6
      *
     C                     ADD  1         I
     C           S2RF,I    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C           FLD72O    IFEQ 'N'
     C                     MOVE ':72: '   MTAG
     C                     MOVE 'Y'       FLD72O
     C                     END
     C                     MOVELS2RF,I    MFLD
     C                     END
      *
     C                     END
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   CFMAT - produce confirmation matching feedback record       *
      *   Called by - Main process                                    *
      *   Calls       -                                               *
      *****************************************************************
      *
     C           CFMAT     BEGSR
      *
     C                     CALL 'MG5001'
     C                     PARM TRNO      @TRNM  16
     C                     PARM MGBRCA    @BRCA   3
     C                     PARM *BLANK    @FEED   1
      *
     C           @FEED     IFEQ 'Y'
      *
     C           *IN50     IFEQ '0'
     C                     OPEN MG0340P1
     C                     SETON                     50U7
     C                     END
      *
      ** Set up headings and sender/customer information
      ** for the error report.
      *
     C                     MOVE '1'       *IN30
     C                     MOVELMGTNUM    TNUM    60
     C                     WRITEHEADER
     C                     WRITETEXT
     C                     WRITEFEED
     C                     MOVE '0'       *IN30
     C                     END
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************   CSW200
      *   FMA200  - Format Message Detail - Sequence A.               *   CSW200
      *            This subroutine is similar to FMTA with the        *   CSW200
      *            following changes for Swift 2000                   *   CSW200
      *             - New field :15A: Beginning of sequence A         *   CSW200
      *             - :22A: now just contains the type of operation   *   CSW200
      *             - :22C: common reference (from old 22A)           *   CSW200
      *             - New field :23D: type of FRA                     *   CSW200
      *             - New field :82 : Party A Identifier              *   CSW200
      *             - New field :87 : Party B Identifier              *   CSW200
      *             - New field :77H: Agreement (type, date and vers.)*   CSW200
      *             - New field :14C: Year Definition                 *   CSW200
      *             - New field :14F: Floating rate option            *   CSW200
      *             - :30V: similar old 31C                           *   CSW200
      *             - :38D: now only ouput if agreement type is AFB   *   CSW200
      *               or FRABBA                                       *   CSW200
      *             - New field :38G: Designated maturity             *   CSW200
      *             - New field :14D: floating rate day fraction      *   CSW200
      *             - New field :17F: FRA discounting(always set to Y)*   CSW200
      *             - New field :18A: Number of repetition of :22B:   *   CSW200
      *             - New field :22B: Financial Centre(list of the    *   CSW200
      *               financial centres involved in the transaction)  *   CSW200
      *                                                               *   CSW200
      *   Called by - main process                                    *   CSW200
      *   Calls     - FSWAD     format Swift address                  *   CSW200
      *             - DAT200    format date fields                    *   CSW200
      *****************************************************************   CSW200
      *                                                                   CSW200
     C           FMA200    BEGSR                                          CSW200
      *                                                                   CSW200
      ** FIELD :15A: - New Sequence                                       CSW200
      *                                                                   CSW200
     C**********           Z-ADD1         X       20                                   CSW200 CSW213
     C                     Z-ADD1         X                                                   CSW213
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C                     MOVEL':15A:'   MTAG                            CSW200
     C                     MOVE *BLANKS   MFLD                            CSW200
      *                                                                   CSW200
      ** Field :20: -  Transaction Reference Number.                      CSW200
      *                                                                   CSW200
     C**********           ADD  1         X       20                                   CSW200 CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                      CSW200
     C                     MOVEA*BLANKS   @WRK                            CSW200
      *                                                                   CSW200
      ** Build up the trn with the module id, the transaction number      CSW200
      ** and the last swift sequence add 1.                               CSW200
      *                                                                   CSW200
     C           MGACMI    IFEQ 'Y'                                                           CSW213
     C                     MOVE MGMODI    @TRN11                                              CSW213
     C                     MOVELMGTNUM    @TRN21                                              CSW213
     C                     MOVELMGCNUM    @TRN31                                              CSW213
     C           MGLSWS    ADD  1         @TRN41                                              CSW213
     C                     MOVE ':20: '   MTAG                                                CSW213
     C**********           MOVEL@TRN1     MFLD                                       CSW213 MD022033
     C                     MOVEA@TRN1     @WRK                                              MD022033
     C                     MOVEL@TRN1     @TRNA                                               CSW213
     C                     ELSE                                                               CSW213
     C                     Z-ADD1         Z                               CSW200
     C                     MOVEAMGMODI    @WRK                            CSW200
     C           MGACMI    IFEQ 'Y'                                                           CSW213
     C           MGLSWS    ADD  1         @TRN41                                              CSW213
     C                     ELSE                                                               CSW213
     C                     MOVEAMGTNUM    @WRK,3                          CSW200
     C                     ENDIF                                                              CSW213
     C           MGLSWS    ADD  1         HLSWS   30                      CSW200
     C                     MOVE HLSWS     HSWS    3                       CSW200
      *                                                                   CSW200
     C           ' '       LOKUP@WRK,Z                   31               CSW200
     C                     MOVEAHSWS      @WRK,Z                          CSW200
      *                                                                   CSW200
      **  Check on MGREFPD for a uniqne TRN,else output as an error.      CSW200
      **  and store the TRN of the new confirmation message.              CSW200
      *                                                                   CSW200
     C                     MOVEA@WRK      @TRNA  16                       CSW200
     C                     ENDIF                                                              CSW213
      *                                                                   CSW200
     C           @TRNA     CHAINMGREFL0              11                   CSW200
      *                                                                   CSW200
      ** If no record is found flag field as in error.                    CSW200
      *                                                                   CSW200
     C           *IN11     IFEQ '0'                                       CSW200
     C                     MOVE 'Y'       @ERR                            CSW200
     C                     MOVEAMSGA,8    MERR                            CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     MOVEL':20:'    MTAG                            CSW200
     C                     MOVEA@WRK      MFLD                            CSW200
      *                                                                   CSW200
      ** Field :21: - Related Reference.                                  CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVEA*BLANKS   @WRK                            CSW200
     C                     MOVEL':21:'    MTAG                            CSW200
      *                                                                                       CSW213
     C           MGACMI    IFEQ 'Y'                                                           CSW213
     C                     MOVELMGCNUM    WDEST   6                                           CSW213
     C                     MOVELMGCNUM    HSDEST                                            MD023241
     C                     ELSE                                                               CSW213
     C                     MOVEL*BLANKS   WDEST                                               CSW213
     C                     ENDIF                                                              CSW213
      *                                                                   CSW200
      ** If related ref. is not blank, then use it as field of tag.       CSW200
      *                                                                   CSW200
     C           MGRREF    IFNE *BLANKS                                   CSW200
     C           MGCHTP    ORNE 'I'                                                         MD023241
     C                     MOVELMGRREF    MFLD                            CSW200
      *
      **  Obtain transaction reference of previous MT340                                      190127
     C                     MOVELMGTNUM    HSTRAN                                              190127
     C                     MOVE '340'     HSMTPY                                              190127
      *                                                                                       190127
     C                     MOVE HSTRAN    @HTRN   6                                           190127
      *                                                                                       190127
     C********** HSKEY     SETGTMGHISTL0                                               190127 CSW213
     C**********           READPMGHISTL0                 56                            190127 CSW213
     C           HSKEY     SETGTMGHISTL7                                                      CSW213
     C                     READPMGHISTL7                 56                                   CSW213
      *                                                                                       190127
     C           *IN56     IFEQ '0'                                                           190127
     C           HSMODI    ANDEQMGMODI                                                        190127
     C           HSTRAN    ANDEQ@HTRN                                                         190127
     C           HSDEST    ANDEQWDEST                                                         CSW213
     C           HSMTPY    ANDEQ'340'                                                         190127
     C           MGACMI    IFEQ 'Y'                                                           CSW213
     C                     MOVE HSSEQ     @SSEQ                                               CSW213
     C                     MOVE HSMODI    H1MODI                                            MD023241
     C                     MOVE HSTRAN    H1TRAN                                            MD023241
     C                     MOVEL@HREF1    MFLD                                                CSW213
     C                     ELSE                                                               CSW213
     C                     MOVEL@HREF     MFLD                                                190127
     C                     ENDIF                                                              CSW213
     C                     END                                                                190127
      *
     C                     ELSE                                           CSW200
     C                     MOVEL'NEW'     MFLD                            CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      *                                                                   CSW200
      ** FIELD 22A   'Type of operation '                                 CSW200
      *                                                                   CSW200
     C**********           ADD  1         X       20                                   CSW200 CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                      CSW200
     C                     MOVEL':22A:'   MTAG                            CSW200
      *                                                                   CSW200
     C                     SELEC                                          CSW200
      *                                                                   CSW200
     C           MGCHTP    WHEQ ' '                                       CSW200
     C                     MOVEL'NEWT'    MFLD                            CSW200
      *                                                                   CSW200
     C           MGCHTP    WHEQ 'I'                                       CSW200
     C                     MOVEL'NEWT'    MFLD                            CSW200
      *                                                                   CSW200
     C           MGCHTP    WHEQ 'A'                                       CSW200
     C                     MOVEL'AMND'    MFLD                            CSW200
      *                                                                   CSW200
     C                     OTHER                                          CSW200
     C                     MOVEL'CANC'    MFLD                            CSW200
      *                                                                   CSW200
     C                     ENDSL                                          CSW200
      *                                                                   CSW200
      *                                                                   CSW200
      ** Field 22C 'Common Reference'                                     CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVEL':22C:'   MTAG                            CSW200
     C                     MOVE *BLANKS   ZCREF                           CSW200
      *                                                                   CSW200
      ** If SWIFT network, use sender & destination customer swift ad.    CSW200
      ** and the exchange rate to produce the common reference. Else      CSW200
      ** use the message TRN.                                             CSW200
      *                                                                   CSW200
     C           NWRK      IFEQ 'SWIFT'                                   CSW200
     C           NWRK      OREQ 'STTX'                                    CSW200
      *                                                                   CSW200
     C           NWRK      IFEQ 'SWIFT'                                   CSW200
     C                     MOVELNWSN      ZSSWI                           CSW200
     C                     MOVELNWDS      ZDSWI                           CSW200
     C                     ELSE                                           CSW200
     C                     MOVELSCSID     ZSSWI                           CSW200
     C                     MOVELCSID      ZDSWI                           CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     MOVE MGINTR    ZRATE                           CSW200
      *                                                                   CSW200
      ** Format SWIFT common reference.                                   CSW200
      *                                                                   CSW200
     C                     CALL 'ZM0020'               15                 CSW200
     C                     PARM           ZSSWI  12                       CSW200
     C                     PARM           ZDSWI  12                       CSW200
     C                     PARM           ZRATE  138                      CSW200
     C                     PARM           ZCREF  16                       CSW200
      *                                                                   CSW200
      ** If the program ends in error.                                    CSW200
      *                                                                   CSW200
     C           *IN15     IFEQ '1'                                       CSW200
     C           *LOCK     IN   LDA                                       CSW200
     C                     MOVE '028'     DBASE              * * * * * * *CSW200
     C                     MOVEL'       ' DBKEY              * DBERR 028 *CSW200
     C                     MOVEL'ZM0020'  DBFILE             * * * * * * *CSW200
     C                     OUT  LDA                                       CSW200
     C                     EXSR *PSSR                                     CSW200
     C                     ENDIF                                          CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C           ZCREF     IFEQ *BLANKS                                   CSW200
     C                     MOVEL@TRNA     ZCREF                           CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     MOVELZCREF     MFLD                            CSW200
      *                                                                   CSW200
      ** Field 23D - Type of FRA                                          CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE ':23D:'   MTAG                            CSW200
      *                                                                   CSW200
     C           MGPORR    IFEQ 'P'                                       CSW200
     C           'FLOAT'   CAT  'FIXED'   MFLD                            CSW200
     C                     ELSE                                           CSW200
     C           'FIXED'   CAT  'FLOAT'   MFLD                            CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      ** Field 82  - Party A Identifier                                   CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C**********           CALL 'AOBRCHR0'                                CSW200              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD                           CSW200
     C                     PARM '*KEY   ' @OPTN                           CSW200
     C                     PARM MGBRCA    @BRCD   3                       CSW200
     C           SDBRCH    PARM SDBRCH    DSSDY                           CSW200
      *                                                                   CSW200
      ** Branch record not found - Error                                  CSW200
      *                                                                   CSW200
     C           @RTCD     IFNE *BLANKS                                   CSW200
     C           *LOCK     IN   LDA                                       CSW200
     C                     MOVE '024'     DBASE              * * * * * * *CSW200
     C                     MOVELMGBRCA    DBKEY              * DBERR 024 *CSW200
     C                     MOVEL'SDBRCHPD'DBFILE             * * * * * * *CSW200
     C                     OUT  LDA                                       CSW200
     C                     EXSR *PSSR                                     CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELA8BICN    ZDEST                           CSW200
     C                     MOVEL*BLANKS   ACLINE 35                       CSW200
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '82'      FLDNO                           CSW200
     C                     EXSR FSWAD                                     CSW200
      *                                                                   CSW200
      ** Field 87  - Party B Identifier                                   CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELMGCNUM    ZDEST                           CSW200
     C                     MOVEL*BLANKS   ACLINE 35                       CSW200
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '87'      FLDNO                           CSW200
     C                     EXSR FSWAD                                     CSW200
      *                                                                   CSW200
      ** Field 77H - Agreement                                            CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE ':77H:'   MTAG                            CSW200
      *                                                                   CSW200
     C                     MOVEA*BLANKS   @WRK                            CSW200
     C                     MOVEAMGAGTY    @WRK                            CSW200
     C                     Z-ADD1         Z                               CSW200
     C           ' '       LOKUP@WRK,Z                   31               CSW200
      *                                                                   CSW200
     C           MGAGDT    IFNE *ZEROS                                    CSW200
     C                     MOVEA'/'       @WRK,Z                          CSW200
     C                     ADD  1         Z                               CSW200
     C                     MOVE MGAGDT    WNAGDT  8                       CSW200
     C                     MOVEAWNAGDT    @WRK,Z                          CSW200
     C           MGAGVV    IFNE *ZEROS                                    CSW200
     C           ' '       LOKUP@WRK,Z                   31               CSW200
     C                     MOVEA'//'      @WRK,Z                          CSW200
     C                     ADD  2         Z                               CSW200
     C                     MOVE MGAGVV    WNAGVV  4                       CSW200
     C                     MOVEAWNAGVV    @WRK,Z                          CSW200
     C                     ENDIF                                          CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     MOVEA@WRK      MFLD                            CSW200
      *                                                                   CSW200
      ** Field 14C - Year Definitions                                     CSW200
      *                                                                   CSW200
     C           MGAGTY    IFEQ 'ISDA'                                    CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE ':14C:'   MTAG                            CSW200
     C                     MOVELMGISDA    MFLD                            CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      *                                                                   CSW200
      **  Format Date Fields                                              CSW200
      *                                                                   CSW200
     C                     EXSR DAT200                                    CSW200
      *                                                                   CSW200
      ** Field :37M: - Contract rate.                                     CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE ':37M:'   MTAG                            CSW200
      *                                                                   CSW200
     C                     Z-ADDMGINTR    ZPRIC  158                      CSW200
     C                     MOVE *BLANKS   ZSPRIC 16                       CSW200
     C                     MOVE *BLANKS   ZOPRIC 21                       CSW200
      *                                                                   CSW200
      ** Format :37M:                                                     CSW200
      *                                                                   CSW200
     C                     CALL 'ZM1190'               28                 CSW200
     C                     PARM           ZPRIC                           CSW200
     C                     PARM           ZSPRIC                          CSW200
     C                     PARM           ZOPRIC                          CSW200
      *                                                                   CSW200
      ** If program is not found, then dbase error.                       CSW200
      *                                                                   CSW200
     C           *IN28     IFEQ '1'                                       CSW200
     C           *LOCK     IN   LDA                                       CSW200
     C                     MOVE '025'     DBASE            * * * * * * * *CSW200
     C                     MOVE *BLANKS   DBKEY            *  DBERR 025  *CSW200
     C                     MOVEL'ZM1190'  DBPGM            * * * * * * * *CSW200
     C                     OUT  LDA                                       CSW200
     C                     EXSR *PSSR                                     CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      *                                                                   CSW200
     C                     MOVELZSPRIC    MFLD                            CSW200
      *                                                                   CSW200
      ** Field :14F: - Floating Rate Option                               CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE ':14F:'   MTAG                            CSW200
     C                     MOVELMGFLOR    MFLD                            CSW200
      *                                                                   CSW200
      ** Field :30V: - Fixing Date                                        CSW200
      *                                                                   CSW200
     C           MGAGTY    IFEQ 'AFB'                                     CSW200
     C           MGAGTY    OREQ 'FRABBA'                                  CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE ':30V:'   MTAG                            CSW200
     C                     Z-ADDMGFDAT    ZMDAY                           CSW200
      *                                                                   CSW200
      **  Convert Midas date to SWIFT date format                         CSW200
      *                                                                   CSW200
     C                     CALL 'ZM0065'               15                 CSW200
     C                     PARM           ZMDAY   50                      CSW200
     C                     PARM           ZSDATE  6                       CSW200
     C                     PARM           ZSDATC  8                       CSW200
      *                                                                   CSW200
      **  Call ended in error. (Program not found.)                       CSW200
      *                                                                   CSW200
     C           *IN15     IFEQ '1'                                       CSW200
     C           *LOCK     IN   LDA                                       CSW200
     C                     MOVE '026'     DBASE              * * * * * * *CSW200
     C                     MOVELZMDAY     DBKEY              * DBERR 026 *CSW200
     C                     MOVEL'ZM0065'  DBFILE             * * * * * * *CSW200
     C                     OUT  LDA                                       CSW200
     C                     EXSR *PSSR                                     CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     MOVELZSDATC    MFLD                            CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      ** Format :38D: - Contract Period.                                  CSW200
      *                                                                   CSW200
     C           MGAGTY    IFEQ 'AFB'                                     CSW200
     C           MGAGTY    OREQ 'FRABBA'                                  CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE ':38D:'   MTAG                            CSW200
     C                     MOVELMGCPER    MFLD                            CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      ** Format :38G: - Designated Maturity                               CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE ':38G:'   MTAG                            CSW200
      *                                                                   CSW200
     C                     MOVEA*BLANKS   @WRK                            CSW200
     C                     MOVEAMGDSMT    @WRK                            CSW200
     C                     Z-ADD1         Z                               CSW200
     C           ' '       LOKUP@WRK,Z                   31               CSW200
      *                                                                   CSW200
     C                     MOVEA'/'       @WRK,Z                          CSW200
     C                     ADD  1         Z                               CSW200
     C                     MOVEAMGDSMT    @WRK,Z                          CSW200
      *                                                                   CSW200
     C                     MOVEA@WRK      MFLD                            CSW200
      *                                                                   CSW200
      *                                                                   CSW200
      ** Format :14D: - Floating rate day count fraction                  CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE ':14D:'   MTAG                            CSW200
     C                     MOVE MGCALC    @CLCM   7                       CSW200
     C           @CLCM     IFEQ '4'                                       CSW200
     C           @CLCM     OREQ '5'                                       CSW200
     C           @CLCM     OREQ '9'                                                           CIR013
     C                     MOVEL'OTHER'   MFLD                            CSW200
     C                     ELSE                                           CSW200
     C                     MOVEL@CLCM     MFLD                            CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      ** Format :17F: - FRA discounting                                   CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE ':17F:'   MTAG                            CSW200
     C                     MOVEL'Y'       MFLD                            CSW200
      *                                                                   CSW200
      *                                                                   CSW200
      ** Add field :18A: to the multiple occurrence data structure        CSW200
      ** and to be formatted after field :22B: has been counted.          CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVEL':18A:'   MTAG                            CSW200
      *                                                                   CSW200
     C                     Z-ADDX         Y       20                      CSW200
     C**********           Z-ADD*ZERO     I       20                                   CSW200 CSW213
     C                     Z-ADD*ZERO     I       30                                          CSW213
     C                     MOVE *BLANKS   SVISFC                          CSW200
      *                                                                   CSW200
     C           KEYSQN    SETLLMGU340PD                        BABC      CSW200
     C                     READ MGU340PD                 13               CSW200
      *                                                                   CSW200
     C           *IN13     DOWEQ'0'                                       CSW200
     C           WSEQNU    ANDEQ@SEQN                                     CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVELMGISFC    MFLD                            CSW200
     C********** I         IFLT 1                                  CSW200 205410
     C                     MOVEL':22B:'   MTAG                            CSW200
     C**********           ENDIF                                   CSW200 205410
      *                                                                   CSW200
     C                     ADD  1         I                               CSW200
     C                     MOVEAMGLOCN    SVLC,I                          CSW200
     C           MGISFC    IFEQ 'OTHR'                                    CSW200
     C                     MOVE MGISFC    SVISFC  4                       CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C           KEYSQN    READEMGU340PD                 13               CSW200
     C                     ENDDO                                          CSW200
      *                                                                   CSW200
      ** Re-access field :18A: and format it using the count              CSW200
      ** of tag :22B:                                                     CSW200
      *                                                                   CSW200
     C           Y         OCUR MULT                                      CSW200
     C                     MOVELI         MFLD                            CSW200
      *                                                                   CSW200
     C                     ENDSR                                          CSW200
      *                                                                   CSW200
      *****************************************************************   CSW200
     C/EJECT                                                              CSW200
      *****************************************************************   CSW200
      *   FMC200  - Format Message Detail - Sequence C.               *   CSW200
      *            This subroutine is similar to FMTB with the        *   CSW200
      *            following changes for Swift 2000                   *   CSW200
      *             - New field :15C: Beginning of sequence C         *   CSW200
      *             - New field :56: Contains the Intermediary        *   CSW200
      *             - :57: Unchanged                                  *   CSW200
      *                                                               *   CSW200
      *   Called by - main process                                    *   CSW200
      *   Calls     - FSWAD     Format Swift address                  *   CSW200
      *****************************************************************   CSW200
      *                                                                   CSW200
     C           FMC200    BEGSR                                          CSW200
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C                     MOVE 'Y'       ZDBEI                                               CSW201
     C                     ENDIF                                                              CSW201
      *                                                                   CSW200
      ** FIELD :15C: - New Sequence                                       CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVEL':15C:'   MTAG                            CSW200
      *                                                                   CSW200
     C                     MOVE *BLANKS   MFLD                            CSW200
      *                                                                   CSW200
      ** FIELD :56: - Intermediary                                        CSW200
      *                                                                   CSW200
     C           MGRIBN    IFNE *BLANKS                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVEL'56'      FLDNO                           CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELMGRIBN    ZDEST                           CSW200
     C                     MOVELMGRIBA    ACLINE                          CSW200
     C                     EXSR FSWAD                                     CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     MOVE *BLANKS   @WRK                            CSW200
      *                                                                   CSW200
      ** Branch code of sender not equal to Receive settlement branch.    CSW200
      *                                                                   CSW200
      **  Test if settlement via nostro                                   CSW200
     C                     MOVE MGRSTM    @STM                            CSW200
     C           @STM      LOKUPTABNST                   23               CSW200
     C           MGBRCA    IFNE MGROBR                                    CSW200
     C           *IN23     ANDEQ'1'                                       CSW200
      *                                                                   CSW200
      ** Field :57:  A/C With Institution.                                CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
      ** Use settlement currency to access nostro if not blank.           CSW200
      ** Otherwise use deal currency.                                     CSW200
     C           CEU003    IFEQ 'Y'                                       CSW200
     C           MGSTCY    ANDNE*BLANKS                                   CSW200
     C                     MOVE MGSTCY    @CYCD                           CSW200
     C                     ELSE                                           CSW200
     C                     MOVE MGCCY     @CYCD                           CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     CALL 'AONOSTR0'                                CSW200
     C                     PARM '*MSG   ' @RTCD                           CSW200
     C                     PARM '*KEY   ' @OPTN                           CSW200
     C                     PARM *BLANKS   @CUST            I:Customer No  CSW200
     C                     PARM           @CYCD            I:Currency     CSW200
     C**********           PARM *BLANKS   @ACCD            I:A/c Code                  CSW200 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN            I:A/c Seq      CSW200
     C                     PARM MGRONS    @NONB            I:Nostro No    CSW200
     C                     PARM *BLANKS   @BRCD            I:Branch Code  CSW200
     C                     PARM *BLANKS   @CSSN            I:Cust ShortN  CSW200
     C                     PARM *BLANK    @PNOI            I:Prime Nost InCSW200
     C           SDNOST    PARM SDNOST    DSFDY                           CSW200
      *                                                                   CSW200
      ** If our receive nostro is not found.                              CSW200
      *                                                                   CSW200
     C           @RTCD     IFNE *BLANKS                                   CSW200
     C                     MOVE 'Y'       @ERR                            CSW200
     C                     MOVELMGRONS    HLD2    2                       CSW200
     C                     MOVELMGCCY     HLD5                            CSW200
     C                     MOVE HLD2      HLD5    5                       CSW200
     C                     MOVELHLD5      MFLD                            CSW200
     C                     MOVELMSGA,3    MERR                            CSW200
     C                     MOVE ':57 :'   MTAG                            CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      ** Format our Receive Nostro Customer Address.                      CSW200
      *                                                                   CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELA7CUST    ZDEST                           CSW200
     C                     MOVEL*BLANKS   ACLINE 35                       CSW200
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '57'      FLDNO                           CSW200
     C                     EXSR FSWAD                                     CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      ** Else the branch code of sender = receive settlement branch       CSW200
      ** and the settlement is via a nostro.                              CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
     C           @STM      LOKUPTABNST                   23               CSW200
      *                                                                   CSW200
     C           *IN23     IFEQ '1'                                       CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
      ** Use settlement currency to access nostro if not blank.           CSW200
      ** Otherwise use deal currency.                                     CSW200
      *                                                                   CSW200
     C           CEU003    IFEQ 'Y'                                       CSW200
     C           MGSTCY    ANDNE*BLANKS                                   CSW200
     C                     MOVE MGSTCY    @CYCD                           CSW200
     C                     ELSE                                           CSW200
     C                     MOVE MGCCY     @CYCD                           CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     CALL 'AONOSTR0'                                CSW200
     C                     PARM '*MSG   ' @RTCD                           CSW200
     C                     PARM '*KEY   ' @OPTN                           CSW200
     C                     PARM *BLANKS   @CUST            I:Customer No  CSW200
     C                     PARM           @CYCD            I:Currency     CSW200
     C**********           PARM *BLANKS   @ACCD            I:A/c Code                  CSW200 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN            I:A/c Seq      CSW200
     C                     PARM MGRONS    @NONB            I:Nostro No    CSW200
     C                     PARM *BLANKS   @BRCD            I:Branch Code  CSW200
     C                     PARM *BLANKS   @CSSN            I:Cust ShortN  CSW200
     C                     PARM *BLANK    @PNOI            I:Prime Nost InCSW200
     C           SDNOST    PARM SDNOST    DSFDY                           CSW200
      *                                                                   CSW200
      **  If our receive nostro is not found.                             CSW200
      *                                                                   CSW200
     C           @RTCD     IFNE *BLANKS                                   CSW200
     C                     MOVE 'Y'       @ERR                            CSW200
     C                     MOVELMGRONS    HLD2                            CSW200
     C                     MOVELMGCCY     HLD5                            CSW200
     C                     MOVE HLD2      HLD5                            CSW200
     C                     MOVELHLD5      MFLD                            CSW200
     C                     MOVELMSGA,3    MERR                            CSW200
     C                     MOVE ':57 :'   MTAG                            CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELA7CUST    ZDEST                           CSW200
      *                                                                   CSW200
     C                     MOVEL*BLANKS   ACLINE                          CSW200
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '57'      FLDNO                           CSW200
     C                     EXSR FSWAD                                     CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      ** Settlement method internal.                                      CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C           MGRSTM    IFNE 00                                        CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELSECN      ZDEST                           CSW200
     C                     MOVEL*BLANKS   ACLINE                          CSW200
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '57'      FLDNO                           CSW200
     C                     EXSR FSWAD                                     CSW200
      *                                                                   CSW200
      ** No settlement type entered.                                      CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
     C                     MOVE ':57D:'   MTAG                            CSW200
     C                     MOVEL'UNKNOWN' MFLD                            CSW200
     C                     ENDIF                                          CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ENDIF                                          CSW200
      *                                                                                       CSW201
     C                     MOVE *BLANKS   ZDBEI                                               CSW201
      *                                                                   CSW200
     C                     ENDSR                                          CSW200
     C/EJECT                                                              CSW200
      *****************************************************************   CSW200
      *   FMD200  - Format Message Detail - Sequence D.               *   CSW200
      *            This subroutine is similar to FMTC with the        *   CSW200
      *            following changes for Swift 2000                   *   CSW200
      *             - New field :15D: Beginning of sequence D         *   CSW200
      *             - New field :53 : DELIVERY AGENT                  *   CSW200
      *             - New field :56 : INTERMEDIARY                    *   CSW200
      *             - :57 : UNCHANGED                                 *   CSW200
      *                                                               *   CSW200
      *   Called by - main process                                    *   CSW200
      *   Calls     - FSWAD    Format Swift address                   *   CSW200
      *****************************************************************   CSW200
      *                                                                   CSW200
     C           FMD200    BEGSR                                          CSW200
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C                     MOVE 'Y'       ZDBEI                                               CSW201
     C                     ENDIF                                                              CSW201
      *                                                                   CSW200
     C                     MOVE 'N'       FLD57O                          CSW200
      *                                                                   CSW200
      ** FIELD :15D: - New Sequence                                       CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C                     MOVEL':15D:'   MTAG                            CSW200
     C                     MOVE *BLANKS   MFLD                            CSW200
      *                                                                   CSW200
      **  Field :53 Delivery Agent                                        CSW200
      *                                                                   CSW200
      **  Test if settlement via nostro                                   CSW200
     C                     MOVE MGPSTM    @STM                            CSW200
     C           @STM      LOKUPTABNST                   23               CSW200
      *                                                                   CSW200
     C           MGPONS    IFNE *BLANKS                                   CSW200
     C           *IN23     ANDEQ'1'                                       CSW200
      *                                                                   CSW200
      **  either A/C with Bank or Receipient entered                      CSW200
      **  or A/C with A/c line = 'DIRECT'                                 CSW200
      *                                                                   CSW200
     C           MGAWBN    IFNE *BLANKS                                   CSW200
     C           MGRVNO    ORNE *BLANKS                                   CSW200
     C           MGAWBA    ANDNE'DIRECT'                                  CSW200
      *                                                                   CSW200
     C           CEU003    IFEQ 'Y'                                       CSW200
     C           MGSTCY    ANDNE*BLANK                                    CSW200
     C                     MOVE MGSTCY    @CYCD                           CSW200
     C                     ELSE                                           CSW200
     C                     MOVE MGCCY     @CYCD                           CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     MOVELMGPONS    @NONB                           CSW200
     C                     CALL 'AONOSTR0'                                CSW200
     C                     PARM '*MSG   ' @RTCD                           CSW200
     C                     PARM '*KEY   ' @OPTN                           CSW200
     C                     PARM *BLANKS   @CUST                           CSW200
     C                     PARM           @CYCD                           CSW200
     C**********           PARM *BLANKS   @ACCD                                        CSW200 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN                           CSW200
     C                     PARM           @NONB                           CSW200
     C                     PARM *BLANKS   @BRCD                           CSW200
     C                     PARM *BLANKS   @CSSN                           CSW200
     C                     PARM *BLANKS   @PNOI                           CSW200
     C           SDNOST    PARM SDNOST    DSFDY                           CSW200
      *                                                                   CSW200
      ** Branch Internal Customer cf. Customer number of Our Pay Nostro   CSW200
     C                     MOVELSECN      @SECN   6                       CSW200
     C           @SECN     IFNE A7CUST                                    CSW200
     C           MGAWBN    ANDNEA7CUST                                    CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C           MGRVNO    IFEQ *BLANKS                                   CSW200
     C                     MOVELA7CUST    ZDEST                           CSW200
     C                     ELSE                                           CSW200
     C                     MOVELMGRVNO    ZDEST                           CSW200
     C                     ENDIF                                          CSW200
     C                     MOVE 53        FLDNO                           CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C                     EXSR FSWAD                                     CSW200
      *                                                                   CSW200
     C           MTAG      IFEQ ':53A:'                                   CSW200
     C                     MOVE 'Y'       IND53   1                       CSW200
      *                                                                   CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      ** Field :57:  A/C with institution non-blank.                      CSW200
      *                                                                   CSW200
     C           MGAWBN    IFNE *BLANKS                                   CSW200
      *                                                                   CSW200
      ** Format Intermediary (Field 56.)                                  CSW200
      *                                                                   CSW200
     C           MGPIBN    IFNE *BLANKS                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELMGPIBN    ZDEST                           CSW200
     C                     MOVELMGPIBA    ACLINE                          CSW200
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '56'      FLDNO                           CSW200
     C                     EXSR FSWAD                                     CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      ** Format Account with institution. (Field 57.)                     CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE '57'      FLDNO                           CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELMGAWBN    ZDEST                           CSW200
     C                     MOVELMGAWBA    ACLINE                          CSW200
     C                     MOVE ' '       TAG                             CSW200
     C                     EXSR FSWAD                                     CSW200
     C                     MOVE 'Y'       FLD57O  1                       CSW200
      *                                                                   CSW200
      ** A/C with Inst. is equal to blank.                                CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
     C           MGAWBA    IFEQ 'DIRECT'                                  CSW200
      *                                                                   CSW200
      **  A/C with Inst. set up as DIRECT, use beneficiary details        CSW200
      **  Format Account with institution. (Field 57.)                    CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELMGBENN    ZDEST                           CSW200
     C                     MOVELMGBENA    ACLINE                          CSW200
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '57'      FLDNO                           CSW200
     C                     EXSR FSWAD                                     CSW200
     C                     MOVE 'Y'       FLD57O                          CSW200
      *                                                                   CSW200
      **  A/C with Inst. blank and NOT "DIRECT" entered,                  CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      **  Field 57 = pay nostro customer if settlement via '02' or '12'   CSW200
      *                                                                   CSW200
     C           MGPSTM    IFEQ 02                                        CSW200
     C           MGPSTM    OREQ 12                                        CSW200
     C                     MOVELMGPONS    @NONB                           CSW200
      *                                                                   CSW200
      ** Use settlement currency to access nostro if not blank.           CSW200
      ** Otherwise use deal currency.                                     CSW200
      *                                                                   CSW200
     C           CEU003    IFEQ 'Y'                                       CSW200
     C           MGSTCY    ANDNE*BLANKS                                   CSW200
     C                     MOVE MGSTCY    @CYCD                           CSW200
     C                     ELSE                                           CSW200
     C                     MOVE MGCCY     @CYCD                           CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     CALL 'AONOSTR0'                                CSW200
     C                     PARM '*MSG   ' @RTCD                           CSW200
     C                     PARM '*KEY   ' @OPTN                           CSW200
     C                     PARM *BLANKS   @CUST                           CSW200
     C                     PARM           @CYCD                           CSW200
     C**********           PARM *BLANKS   @ACCD                                        CSW200 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN                           CSW200
     C                     PARM           @NONB                           CSW200
     C                     PARM *BLANKS   @BRCD                           CSW200
     C                     PARM *BLANKS   @CSSN                           CSW200
     C                     PARM *BLANKS   @PNOI                           CSW200
     C           SDNOST    PARM SDNOST    DSFDY                           CSW200
      *                                                                   CSW200
      **  Nostro customer not found                                       CSW200
      *                                                                   CSW200
     C           @RTCD     IFNE *BLANKS                                   CSW200
     C                     MOVE 'Y'       @ERR                            CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVELMGPONS    HLD2    2                       CSW200
     C                     MOVELMGCCY     HLD5                            CSW200
     C                     MOVE HLD2      HLD5    5                       CSW200
     C                     MOVELHLD5      MFLD                            CSW200
     C                     MOVELMSGA,3    MERR                            CSW200
     C                     MOVE ':57 :'   MTAG                            CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      **  Format our Pay Nostro Customer Address                          CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELA7CUST    ZDEST                           CSW200
     C                     MOVEL*BLANKS   ACLINE                          CSW200
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '57'      FLDNO                           CSW200
     C                     EXSR FSWAD                                     CSW200
     C                     MOVE 'Y'       FLD57O                          CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
      * If Pay Settlement Method is not 00                                CSW200
      *                                                                   CSW200
     C           MGPSTM    IFNE 00                                        CSW200
     C                     MOVE MGPSTM    @STM                            CSW200
     C           @STM      LOKUPTABINT                   23               CSW200
      *                                                                   CSW200
      * If Pay Settlement Method is 03 04 05 06 or 14                     CSW200
      *                                                                   CSW200
     C           *IN23     IFEQ '1'                                       CSW200
      *                                                                   CSW200
      * Produce tag 57                                                    CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C                     MOVE *BLANKS   ZDEST                           CSW200
     C                     MOVELSECN      ZDEST                           CSW200
     C                     MOVEL*BLANKS   ACLINE                          CSW200
     C                     MOVE ' '       TAG                             CSW200
     C                     MOVE '57'      FLDNO                           CSW200
      *                                                                   CSW200
     C                     EXSR FSWAD                                     CSW200
      *                                                                   CSW200
     C                     MOVE 'Y'       FLD57O                          CSW200
      *                                                                   CSW200
      * If Pay Settlement Method is not 00 nor 03 04 05 06 or 14          CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
      *                                                                   CSW200
     C           CEU003    IFEQ 'Y'                                       CSW200
     C           MGSTCY    ANDNE*BLANKS                                   CSW200
     C                     MOVE MGSTCY    @CYCD                           CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
     C                     MOVE MGCCY     @CYCD                           CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     MOVE MGPONS    @NONB                           CSW200
      *                                                                   CSW200
      * Get Nostro Details                                                CSW200
      *                                                                   CSW200
     C                     CALL 'AONOSTR0'                                CSW200
     C                     PARM '*MSG   ' @RTCD                           CSW200
     C                     PARM '*KEY   ' @OPTN                           CSW200
     C                     PARM *BLANKS   @CUST                           CSW200
     C                     PARM           @CYCD                           CSW200
     C**********           PARM *BLANKS   @ACCD                                        CSW200 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN                           CSW200
     C                     PARM           @NONB                           CSW200
     C                     PARM *BLANKS   @BRCD                           CSW200
     C                     PARM *BLANKS   @CSSN                           CSW200
     C                     PARM *BLANKS   @PNOI                           CSW200
     C           SDNOST    PARM SDNOST    DSFDY                           CSW200
      *                                                                   CSW200
      * If tag 53 has not been produced yet, produce it now               CSW200
      *                                                                   CSW200
     C           IND53     IFEQ 'Y'                                       CSW200
     C                     MOVE 'N'       IND53                           CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
     C                     MOVEL*BLANKS   ZDEST                           CSW200
     C                     MOVELA7CUST    ZDEST                           CSW200
     C                     MOVE *BLANKS   ACLINE                          CSW200
     C                     MOVE '53'      FLDNO                           CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     EXSR FSWAD                                     CSW200
      *                                                                   CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      **  Settlement 01,07 or 08 with MGAWBN blank or settlement 00       CSW200
      *                                                                   CSW200
     C           FLD57O    IFEQ 'N'                                       CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE ':57D:'   MTAG                            CSW200
     C                     MOVEL'UNKNOWN' MFLD                            CSW200
      *                                                                   CSW200
     C                     ENDIF                                          CSW200
      *                                                                                       CSW201
     C                     MOVE *BLANKS   ZDBEI                                               CSW201
      *                                                                   CSW200
     C                     ENDSR                                          CSW200
      *****************************************************************   CSW200
     C/EJECT                                                              CSW200
      *****************************************************************   CSW200
      *   FME200  - Format Message Detail - Sequence E.               *   CSW200
      *             - field :15E: Beginning of sequence E             *   CSW200
      *               ONLY OUTPUT IF OUTHER FLDS IN SEQ E OUTPUT      *   CSW200
      *             - field :29A: CONTACT INFORMATION                 *   CSW200
      *             - field :24D: TYPE OF DEALING METHOD              *   CSW200
      *             - field :88 : BROKER                              *   CSW200
      *                                                               *   CSW200
      *   Called by - main process                                    *   CSW200
      *   Calls     - F72200    Format Field 72                       *   CSW200
      *****************************************************************   CSW200
      *                                                                   CSW200
     C           FME200    BEGSR                                          CSW200
      *                                                                   CSW200
     C           MGCTC1    IFNE *BLANKS                                   CSW200
     C           MGS2R1    ORNE *BLANKS                                   CSW200
     C           MGBRKC    ORNE 'MAIL'                                    CSW200
     C           MGFLOR    OREQ 'OTHER'                                   CSW200
     C           MGDSMT    OREQ 'O'                                       CSW200
     C           @CLCM     OREQ '4'                                       CSW200
     C           @CLCM     OREQ '5'                                       CSW200
     C           @CLCM     OREQ '9'                                                           CIR013
     C           SVISFC    OREQ 'OTHR'                                    CSW200
      *                                                                   CSW200
      ** FIELD :15E: - New Sequence                                       CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C                     MOVEL':15E:'   MTAG                            CSW200
     C                     MOVE *BLANKS   MFLD                            CSW200
      *                                                                   CSW200
      ** FIELD :29A: - Contact information                                CSW200
      *                                                                   CSW200
     C           MGCTC1    IFNE *BLANKS                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE MGCTC1    S2RF,1                          CSW200
     C                     MOVE MGCTC2    S2RF,2                          CSW200
     C                     MOVE MGCTC3    S2RF,3                          CSW200
     C                     MOVE MGCTC4    S2RF,4                          CSW200
     C                     MOVE ':29A:'   MTAG                            CSW200
     C                     Z-ADD0         Z                               CSW200
      *                                                                   CSW200
     C           Z         DOWLT4                                         CSW200
     C                     ADD  1         Z                               CSW200
      *                                                                   CSW200
     C           S2RF,Z    IFNE *BLANKS                                   CSW200
      *                                                                   CSW200
     C           Z         IFGT 1                                         CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     MOVELS2RF,Z    MFLD                            CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ENDDO                                          CSW200
      *                                                                   CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      * If Broker is not 'MAIL'                                           CSW200
      *                                                                   CSW200
     C           MGBRKC    IFNE 'MAIL'                                    CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C                     SELEC                                          CSW200
      *                                                                   CSW200
     C           MGBRKC    WHEQ 'PHON'                                    CSW200
     C                     MOVE ':24D:'   MTAG                            CSW200
     C                     MOVEL'PHON'    MFLD                            CSW200
      *                                                                   CSW200
     C           MGBRKC    WHEQ 'TELX'                                    CSW200
     C                     MOVE ':24D:'   MTAG                            CSW200
     C                     MOVEL'TELX'    MFLD                            CSW200
      *                                                                   CSW200
     C                     OTHER                                          CSW200
      *                                                                   CSW200
      **  Access the broker file                                          CSW200
     C                     CALL 'AOBROKR0'                                CSW200
     C                     PARM '*MSG   ' @RTCD                           CSW200
     C                     PARM '*KEY   ' @OPTN                           CSW200
     C                     PARM MGBRKC    @BROKY                          CSW200
     C           SDBROK    PARM SDBROK    DSFDY                           CSW200
      *                                                                   CSW200
      *                                                                   CSW200
     C           A9EBS     IFEQ 'Y'                                       CSW200
     C                     MOVE ':24D:'   MTAG                            CSW200
     C************         MOVEL'ELEC'    MFLD                      CSW200186635
     C           'ELEC/'   CAT  A9BKNM    MFLD                            186635
      *                                                                   CSW200
      * Output Broker details                                             CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
     C                     MOVE ':24D:'   MTAG                            CSW200
     C                     MOVEL'BROK'    MFLD                            CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE ':88D:'   MTAG                            CSW200
     C                     MOVELA9BKNM    MFLD                            CSW200
      *                                                                   CSW200
     C           A9BRTN    IFNE *BLANKS                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVELA9BRTN    MFLD                            CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ENDSL                                          CSW200
      *                                                                   CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      * Format Sender to Receiver Information (tag 72)                    CSW200
      *                                                                   CSW200
     C                     EXSR F72200                                    CSW200
      *                                                                   CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ENDSR                                          CSW200
     C/EJECT
      *****************************************************************                       CSW213
      *   SRFMTG - Format message detail - Sequence G                 *                       CSW213
      *   Called by   Main process                                    *                       CSW213
      *   Calls                                                       *                       CSW213
      *****************************************************************                       CSW213
      *                                                                                       CSW213
     C           SRFMTG    BEGSR                                                              CSW213
      *                                                                                       CSW213
      ** Field :15G: New Sequence                                                             CSW213
      *                                                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVE ':15G:'   MTAG                                                CSW213
     C                     MOVEL*BLANK    MFLD                                                CSW213
     C                     Z-ADDX         X15E    20                                        MD022981
      *                                                                                       CSW213
      ** Clear multiple occurrence DS for the RPPT                                            CSW213
      *                                                                                       CSW213
     C                     Z-ADD1         Y1      10                                          CSW213
     C           Y1        OCUR RPPT                                                          CSW213
     C           Y1        DOWLE4                                                             CSW213
     C                     CLEARRPPT                                                          CSW213
     C                     ADD  1         Y1                                                  CSW213
     C           Y1        OCUR RPPT                                                          CSW213
     C                     ENDDO                                                              CSW213
     C                     Z-ADD0         Y1                                                  CSW213
      *                                                                                       CSW213
      ** Initialize multioccurence DS RPPT with the 4 set of fields                           CSW213
      *                                                                                       CSW213
     C                     Z-ADD1         Y1      10                                          CSW213
     C           Y1        OCUR RPPT                                                          CSW213
     C           Y1        DOWLE4                                                             CSW213
     C           Y1        IFEQ 1                                                             CSW213
     C                     MOVE MGRJ01    MGRJXX                                              CSW213
     C                     MOVE MGRP01    MGRPXX                                              CSW213
     C                     MOVE MGRN01    MGRNXX                                              CSW213
     C                     MOVE MGRC01    MGRCXX                                              CSW213
     C                     MOVE MGRS01    MGRSXX                                              CSW213
     C                     MOVE MGRL01    MGRLXX                                              CSW213
     C                     MOVE MGRA01    MGRAXX                                              CSW213
     C                     MOVE MGUT01    MGUTXX                                              CSW213
     C                     MOVE MGTN01    MGTNXX                                              CSW213
     C                     MOVE MGTI01    MGTIXX                                              CSW213
     C                     MOVE MGET01    MGETXX                                              CSW213
     C                     ENDIF                                                              CSW213
     C           Y1        IFEQ 2                                                             CSW213
     C                     MOVE MGRJ02    MGRJXX                                              CSW213
     C                     MOVE MGRP02    MGRPXX                                              CSW213
     C                     MOVE MGRN02    MGRNXX                                              CSW213
     C                     MOVE MGRC02    MGRCXX                                              CSW213
     C                     MOVE MGRS02    MGRSXX                                              CSW213
     C                     MOVE MGRL02    MGRLXX                                              CSW213
     C                     MOVE MGRA02    MGRAXX                                              CSW213
     C                     MOVE MGUT02    MGUTXX                                              CSW213
     C                     MOVE MGTN02    MGTNXX                                              CSW213
     C                     MOVE MGTI02    MGTIXX                                              CSW213
     C                     MOVE MGET02    MGETXX                                              CSW213
     C                     ENDIF                                                              CSW213
     C           Y1        IFEQ 3                                                             CSW213
     C                     MOVE MGRJ03    MGRJXX                                              CSW213
     C                     MOVE MGRP03    MGRPXX                                              CSW213
     C                     MOVE MGRN03    MGRNXX                                              CSW213
     C                     MOVE MGRC03    MGRCXX                                              CSW213
     C                     MOVE MGRS03    MGRSXX                                              CSW213
     C                     MOVE MGRL03    MGRLXX                                              CSW213
     C                     MOVE MGRA03    MGRAXX                                              CSW213
     C                     MOVE MGUT03    MGUTXX                                              CSW213
     C                     MOVE MGTN03    MGTNXX                                              CSW213
     C                     MOVE MGTI03    MGTIXX                                              CSW213
     C                     MOVE MGET03    MGETXX                                              CSW213
     C                     ENDIF                                                              CSW213
     C           Y1        IFEQ 4                                                             CSW213
     C                     MOVE MGRJ04    MGRJXX                                              CSW213
     C                     MOVE MGRP04    MGRPXX                                              CSW213
     C                     MOVE MGRN04    MGRNXX                                              CSW213
     C                     MOVE MGRC04    MGRCXX                                              CSW213
     C                     MOVE MGRS04    MGRSXX                                              CSW213
     C                     MOVE MGRL04    MGRLXX                                              CSW213
     C                     MOVE MGRA04    MGRAXX                                              CSW213
     C                     MOVE MGUT04    MGUTXX                                              CSW213
     C                     MOVE MGTN04    MGTNXX                                              CSW213
     C                     MOVE MGTI04    MGTIXX                                              CSW213
     C                     MOVE MGET04    MGETXX                                              CSW213
     C                     ENDIF                                                              CSW213
     C                     ADD  1         Y1                                                  CSW213
     C           Y1        OCUR RPPT                                                          CSW213
     C                     ENDDO                                                              CSW213
     C                     Z-ADD0         Y1                                                  CSW213
      *                                                                                       CSW213
     C                     EXSR SRRPPT                                                      MD023007
      *                                                                                     MD023007
     C                     Z-ADD0         WRKIX   10                                          CSW213
     C                     MOVEL'N'       WRKFLG  1                                           CSW213
      *                                                                                       CSW213
      ** Do Loop for 4 times                                                                  CSW213
      *                                                                                       CSW213
     C           WRKIX     DOWLT4                                                             CSW213
     C                     ADD  1         WRKIX                                               CSW213
     C********** WRKIX     OCUR RPPT                                                 CSW213 MD023007
     C           IX,WRKIX  OCUR RPPT                                                        MD023007
      *                                                                                       CSW213
      ** Reporting Jurisdiction                                                               CSW213
      *                                                                                       CSW213
     C           MGRJXX    IFEQ *BLANKS                                                       CSW213
     C                     ADD  5         WRKIX                                               CSW213
     C                     ELSE                                                               CSW213
     C********** MGRJXX    IFNE *BLANKS                                             CSW213 MD022633A
     C********** MGRPXX    ANDNE*BLANKS                                             CSW213 MD022633A
     C********** MGRNXX    ANDNE*BLANKS                                             CSW213 MD022633A
     C********** MGRCXX    ANDNE*BLANKS                                             CSW213 MD022633A
     C********** MGRSXX    ANDNE*BLANKS                                             CSW213 MD022633A
     C********** MGRLXX    ANDNE*BLANKS                                             CSW213 MD022633A
     C********** MGRAXX    ANDNE*BLANKS                                             CSW213 MD022633A
     C           MGRJXX    IFNE WRKMRJ                                                      MD022633
     C           MGRPXX    ORNE WRKMRP                                                      MD022633
     C           MGRNXX    ORNE WRKMRN                                                     MD022633A
     C           MGRCXX    ORNE WRKMRC                                                     MD022633A
     C           MGRSXX    ORNE WRKMRS                                                     MD022633A
     C           MGRLXX    ORNE WRKMRL                                                     MD022633A
     C           MGRAXX    ORNE WRKMRA                                                     MD022633A
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':22L:'   MTAG                                                CSW213
     C                     MOVELMGRJXX    MFLD                                                CSW213
     C                     MOVEL'N'       WRKFLG                                              CSW213
     C**********           ENDIF                                                     CSW213 MD022633
      *                                                                                       CSW213
      ** Reporting Party                                                                      CSW213
      *                                                                                       CSW213
     C           MGRPXX    IFNE *BLANKS                                                       CSW213
     C                     MOVELMGRPXX    WRKMRP  6                                         MD022633
     C                     MOVELMGRJXX    WRKMRJ 35                                         MD022633
     C                     MOVELMGRNXX    WRKMRN 20                                        MD022633A
     C                     MOVELMGRCXX    WRKMRC 10                                        MD022633A
     C                     MOVELMGRSXX    WRKMRS 11                                        MD022633A
     C                     MOVELMGRLXX    WRKMRL 20                                        MD022633A
     C                     MOVELMGRAXX    WRKMRA 34                                        MD022633A
     C                     MOVELMGRPXX    ZDEST                                               CSW213
     C                     MOVELMGRAXX    ACLINE                                              CSW213
     C                     MOVEL'91'      FLDNO                                               CSW213
     C                     MOVE *BLANKS   TAG                                                 CSW213
     C                     EXSR SRFMPY                                                        CSW213
     C                     ELSE                                                               CSW213
     C                     MOVELMGRPXX    WRKMRP                                           MD022633A
     C                     MOVELMGRJXX    WRKMRJ                                           MD022633A
     C                     MOVELMGRNXX    WRKMRN                                           MD022633A
     C                     MOVELMGRCXX    WRKMRC                                           MD022633A
     C                     MOVELMGRSXX    WRKMRS                                           MD022633A
     C                     MOVELMGRLXX    WRKMRL                                           MD022633A
     C                     MOVELMGRAXX    WRKMRA                                           MD022633A
     C           MGRLXX    IFEQ *BLANKS                                                       CSW213
     C           MGRNXX    ANDEQ*BLANKS                                                       CSW213
     C           MGRSXX    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':91A:'   MTAG                                                CSW213
     C                     MOVEL*BLANKS   MFLD                                                CSW213
     C                     MOVELMGRSXX    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     ELSE                                                               CSW213
     C           MGRNXX    IFNE *BLANKS                                                       CSW213
     C           MGRSXX    ANDNE*BLANKS                                                       CSW213
     C           MGRNXX    ORNE *BLANKS                                                       CSW213
     C           MGRLXX    ANDNE*BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':91J:'   MTAG                                                CSW213
     C**********           ADD  1         X                                        MD022392 MD022633
     C********** X         OCUR MULT                                               MD022392 MD022633
     C           MGRSXX    IFNE *BLANKS                                                       CSW213
     C**********           ADD  1         X                                          CSW213 MD022392
     C********** X         OCUR MULT                                                 CSW213 MD022392
     C           '/ABIC/'  CAT  MGRSXX    MFLD                                                CSW213
     C                     ELSE                                                               CSW213
     C           '/ABIC'   CAT  '/UKWN'   MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     ADD  1         X                                                 MD022392
     C           X         OCUR MULT                                                        MD022392
     C           MGRLXX    IFNE *BLANKS                                                       CSW213
     C**********           ADD  1         X                                          CSW213 MD022392
     C********** X         OCUR MULT                                                 CSW213 MD022392
     C           '/LEIC/'  CAT  MGRLXX    MFLD                                                CSW213
     C                     ELSE                                                               CSW213
     C           '/NAME/'  CAT  MGRNXX    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGRCXX    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           '/NAME/'  CAT  MGRCXX    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     ELSE                                                               CSW213
     C           MGRNXX    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':91D:'   MTAG                                                CSW213
     C                     MOVELMGRNXX    MFLD                                                CSW213
     C           MGRCXX    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVELMGRCXX    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                            MD022633
     C**********           ENDIF                                                  MD022633 MD022633A
      *                                                                                       CSW213
      ** Unique Transaction Identifier/Prior Unique Transaction Identifier                    CSW213
      *                                                                                       CSW213
     C           MGUTXX    IFNE *BLANKS                                                       CSW213
     C           MGTNXX    ANDNE*BLANKS                                                       CSW213
     C           MGTIXX    IFEQ '0'                                                           CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':22M:'   MTAG                                                CSW213
     C                     MOVELMGUTXX    MFLD                                                CSW213
     C                     ADD  1         X                                                 MD022392
     C           X         OCUR MULT                                                        MD022392
     C                     MOVEL':22N:'   MTAG                                                CSW213
     C                     MOVELMGTNXX    MFLD                                                CSW213
     C                     MOVEL'Y'       WRKFLG                                              CSW213
     C                     ELSE                                                               CSW213
     C           WRKFLG    IFEQ 'Y'                                                           CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':22P:'   MTAG                                                CSW213
     C                     MOVELMGUTXX    MFLD                                                CSW213
     C                     ADD  1         X                                                 MD022392
     C           X         OCUR MULT                                                        MD022392
     C                     MOVEL':22R:'   MTAG                                                CSW213
     C                     MOVELMGTNXX    MFLD                                                CSW213
     C                     ELSE                                                               CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':22M:'   MTAG                                                CSW213
     C                     MOVELMGUTXX    MFLD                                                CSW213
     C                     ADD  1         X                                                 MD022392
     C           X         OCUR MULT                                                        MD022392
     C                     MOVEL':22N:'   MTAG                                                CSW213
     C                     MOVELMGTNXX    MFLD                                                CSW213
     C                     MOVEL'Y'       WRKFLG                                              CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
     C                     ENDDO                                                              CSW213
      *                                                                                       CSW213
      ** Clearing Exception Party                                                             CSW213
      *                                                                                       CSW213
     C           MGCEPI    IFNE *BLANKS                                                       CSW213
     C                     MOVELMGCEPI    ZDEST                                               CSW213
     C                     MOVELMGCEPA    ACLINE                                              CSW213
     C                     MOVEL'96'      FLDNO                                               CSW213
     C                     MOVE *BLANKS   TAG                                                 CSW213
     C                     EXSR SRFMPY                                                        CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      ** Clearing Broker Identification                                                       CSW213
      *                                                                                       CSW213
     C           MGCBCI    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':22S:'   MTAG                                                CSW213
     C           'C/'      CAT  MGCBCI    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGCBPI    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':22S:'   MTAG                                                CSW213
     C           'P/'      CAT  MGCBPI    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      ** Cleared Product Identification                                                       CSW213
      *                                                                                       CSW213
     C           MGPRID    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':22T:'   MTAG                                                CSW213
     C                     MOVELMGPRID    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      ** Clearing Threshold Indicator                                                         CSW213
      *                                                                                       CSW213
     C           MGCGTI    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':17E:'   MTAG                                                CSW213
     C                     MOVELMGCGTI    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      ** Underlying Product Identifier                                                        CSW213
      *                                                                                       CSW213
     C           MGUPID    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':22U:'   MTAG                                                CSW213
     C                     MOVELMGUPID    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      ** Allocation Indicator                                                                 CSW213
      *                                                                                       CSW213
     C           MGALLI    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':17H:'   MTAG                                                CSW213
     C                     MOVELMGALLI    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      ** Collateralisation Indicator                                                          CSW213
      *                                                                                       CSW213
     C           MGCLLI    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':17P:'   MTAG                                                CSW213
     C                     MOVELMGCLLI    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      ** Execution Venue                                                                      CSW213
      *                                                                                       CSW213
     C           MGEXVE    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':22V:'   MTAG                                                CSW213
     C                     MOVELMGEXVE    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      ** Execution Timestamp                                                                  CSW213
      *                                                                                       CSW213
     C********** MGUTCT    IFNE *ZEROS                                               CSW213 MD023798
     C********** MGGEDT    ORNE *ZEROS                                             MD022981 MD023798
     C********** MGGETM    ORNE *ZEROS                                             MD022981 MD023798
     C           MGGEDT    IFNE *ZEROS                                                      MD023798
     C           MGGETM    ANDNE*ZEROS                                                      MD023798
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':98D:'   MTAG                                                CSW213
     C                     MOVE MGGEDT    DNGEDT  8                                           CSW213
     C                     MOVE MGGETM    DNGETM  6                                           CSW213
     C                     MOVE MGUTCT    DNUTCT  4                                           CSW213
     C           MGUSGN    IFEQ 'N'                                                           CSW213
     C           DNGEDT    CAT  DNGETM    ETIME1 14                                           CSW213
     C           '/N'      CAT  DNUTCT    ETIME2  6                                           CSW213
     C           ETIME1    CAT  ETIME2    MFLD                                                CSW213
     C                     ELSE                                                               CSW213
     C           DNGEDT    CAT  DNGETM    ETIME1 14                                           CSW213
     C********** ETIME1    CAT  DNUTCT    MFLD                                       CSW213 MD023798
      *                                                                                     MD023798
     C           DNUTCT    IFNE *ZEROS                                                      MD023798
     C           '/'       CAT  DNUTCT    ETIME3  5                                         MD023798
     C           ETIME1    CAT  ETIME3    MFLD                                              MD023798
     C                     ELSE                                                             MD023798
     C                     MOVELETIME1    MFLD                                              MD023798
     C                     ENDIF                                                            MD023798
      *                                                                                     MD023798
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      ** Non Standard Flag                                                                    CSW213
      *                                                                                       CSW213
     C           MGNORS    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':17W:'   MTAG                                                CSW213
     C                     MOVELMGNORS    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW214
     C           CSW214    IFEQ 'Y'                                                           CSW214
      *                                                                                       CSW214
      ** Financial Nature of the Counterparty Indicator                                       CSW214
      *                                                                                       CSW214
     C           MGFNCI    IFNE *BLANKS                                                       CSW214
     C                     ADD  1         X                                                   CSW214
     C           X         OCUR MULT                                                          CSW214
     C                     MOVEL':17Y:'   MTAG                                                CSW214
     C                     MOVELMGFNCI    MFLD                                                CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                       CSW214
      ** Collateral Portfolio Indicator                                                       CSW214
      *                                                                                       CSW214
     C           MGCOPI    IFNE *BLANKS                                                       CSW214
     C                     ADD  1         X                                                   CSW214
     C           X         OCUR MULT                                                          CSW214
     C                     MOVEL':17Z:'   MTAG                                                CSW214
     C                     MOVELMGCOPI    MFLD                                                CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                       CSW214
      ** Collateral Portfolio Code                                                            CSW214
      *                                                                                       CSW214
     C           MGCOPI    IFEQ 'Y'                                                           CSW214
     C           MGCOPC    ANDNE*BLANKS                                                       CSW214
     C                     ADD  1         X                                                   CSW214
     C           X         OCUR MULT                                                          CSW214
     C                     MOVEL':22Q:'   MTAG                                                CSW214
     C                     MOVELMGCOPC    MFLD                                                CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                       CSW214
      ** Portfolio Compression Indicator                                                      CSW214
      *                                                                                       CSW214
     C           MGPOCI    IFNE *BLANKS                                                       CSW214
     C                     ADD  1         X                                                   CSW214
     C           X         OCUR MULT                                                          CSW214
     C                     MOVEL':17L:'   MTAG                                                CSW214
     C                     MOVELMGPOCI    MFLD                                                CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                       CSW214
      ** Corporate Sector Indicator                                                           CSW214
      *                                                                                       CSW214
     C           MGCOSI    IFNE *BLANKS                                                       CSW214
     C                     ADD  1         X                                                   CSW214
     C           X         OCUR MULT                                                          CSW214
     C                     MOVEL':17M:'   MTAG                                                CSW214
     C                     MOVELMGCOSI    MFLD                                                CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                       CSW214
      ** Trade with Non-EEA Counterparty Indicator                                            CSW214
      *                                                                                       CSW214
     C           MGTNEI    IFNE *BLANKS                                                       CSW214
     C                     ADD  1         X                                                   CSW214
     C           X         OCUR MULT                                                          CSW214
     C                     MOVEL':17Q:'   MTAG                                                CSW214
     C                     MOVELMGTNEI    MFLD                                                CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                       CSW214
      ** Intragroup Trade Indicator                                                           CSW214
      *                                                                                       CSW214
     C           MGIGTI    IFNE *BLANKS                                                       CSW214
     C                     ADD  1         X                                                   CSW214
     C           X         OCUR MULT                                                          CSW214
     C                     MOVEL':17S:'   MTAG                                                CSW214
     C                     MOVELMGIGTI    MFLD                                                CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                       CSW214
      ** Commercial or Treasury Financial Indicator                                           CSW214
      *                                                                                       CSW214
     C           MGCTFI    IFNE *BLANKS                                                       CSW214
     C                     ADD  1         X                                                   CSW214
     C           X         OCUR MULT                                                          CSW214
     C                     MOVEL':17X:'   MTAG                                                CSW214
     C                     MOVELMGCTFI    MFLD                                                CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                       CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                       CSW213
      ** Additional Reporting Information                                                     CSW213
      *                                                                                       CSW213
     C           MGAR01    IFNE *BLANKS                                                       CSW213
     C           MGAR02    ORNE *BLANK                                                        CSW213
     C           MGAR03    ORNE *BLANK                                                        CSW213
     C           MGAR04    ORNE *BLANK                                                        CSW213
     C           MGAR05    ORNE *BLANK                                                        CSW213
     C           MGAR06    ORNE *BLANK                                                        CSW213
     C           MGAR07    ORNE *BLANK                                                        CSW213
     C           MGAR08    ORNE *BLANK                                                        CSW213
     C           MGAR09    ORNE *BLANK                                                        CSW213
     C           MGAR10    ORNE *BLANK                                                        CSW213
     C           MGAR11    ORNE *BLANK                                                        CSW213
     C           MGAR12    ORNE *BLANK                                                        CSW213
     C           MGAR13    ORNE *BLANK                                                        CSW213
     C           MGAR14    ORNE *BLANK                                                        CSW213
     C           MGAR15    ORNE *BLANK                                                        CSW213
     C           MGAR16    ORNE *BLANK                                                        CSW213
     C           MGAR17    ORNE *BLANK                                                        CSW213
     C           MGAR18    ORNE *BLANK                                                        CSW213
     C           MGAR19    ORNE *BLANK                                                        CSW213
     C           MGAR20    ORNE *BLANK                                                        CSW213
      *                                                                                       CSW213
     C                     MOVE *BLANK    DN77    1                                           CSW213
     C           MGAR01    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR01    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR02    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR02    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR03    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR03    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR04    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR04    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR05    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR05    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR06    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR06    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR07    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR07    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR08    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR08    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR09    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR09    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR10    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR10    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR11    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR11    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR12    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR12    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR13    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR13    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR14    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR14    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR15    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR15    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR16    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR16    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR17    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR17    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR18    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR18    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR19    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR19    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR20    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR20    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
     C           X         IFEQ X15E                                                        MD022981
     C                     MOVE *BLANKS   MTAG                                              MD022981
     C                     SUB  1         X                                                 MD022981
     C                     ENDIF                                                            MD022981
      *                                                                                     MD022981
     C                     ENDSR                                                              CSW213
     C/EJECT                                                                                  CSW213
      *****************************************************************                       CSW213
      *   SRFMPY - Format message - Cust. Extension SWIFT Details     *                       CSW213
      *   Called by   Main process                                    *                       CSW213
      *   Calls                                                       *                       CSW213
      *****************************************************************                       CSW213
      *                                                                                       CSW213
     C           SRFMPY    BEGSR                                                              CSW213
      *                                                                                       CSW213
     C           ACLINE    IFNE *BLANKS                                                       CSW213
     C           1         SUBSTACLINE:1  ACTEMP  1                                           CSW213
     C           ACTEMP    IFNE '/'                                                           CSW213
     C           '/'       CAT  ACLINE    ACLINE                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
     C                     MOVE *BLANKS   ZDEST                                               CSW213
     C                     MOVELMGCNUM    ZDEST                                               CSW213
      *                                                                                       CSW213
     C                     CALL 'AOCSSWR0'                                                    CSW213
     C                     PARM '*MSG   ' @RTCD   7                                           CSW213
     C                     PARM '*KEY   ' @OPTN   7                                           CSW213
     C                     PARM ZDEST     @KEY1  10                                           CSW213
     C                     PARM *BLANKS   @KYST   7                                           CSW213
     C                     PARM           DSLDY                                               CSW213
      *                                                                                       CSW213
      ** Extract SDCUSTPD and SDCSSWPD                                                     MD022633A
      *                                                                                    MD022633A
     C                     MOVEL'SDCUSTPD'P#FILN                                           MD022633A
     C                     EXSR GETRCL                                                     MD022633A
     C           P#RCDL    SUBSTDSLDY     SDCUST                                           MD022633A
     C           P#RCDL    ADD  1         WLEN    50                                       MD022633A
      *                                                                                    MD022633A
     C                     MOVEL'SDCSSWPD'P#FILN                                           MD022633A
     C                     EXSR GETRCL                                                     MD022633A
     C           P#RCDL    SUBSTDSLDY:WLENSDCSSW                                           MD022633A
      *                                                                                    MD022633A
     C           BBCSID    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL'A'       TAG                                                 CSW213
     C                     MOVEL@MTAG     MTAG                                                CSW213
     C           ACLINE    IFNE *BLANKS                                                       CSW213
     C                     MOVELACLINE    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVELBBCSID    MFLD                                                CSW213
     C                     ELSE                                                               CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL'J'       TAG                                                 CSW213
     C                     MOVEL@MTAG     MTAG                                                CSW213
     C           '/ABIC'   CAT  '/UKWN'   ABIUKW 10                                           CSW213
     C                     MOVELABIUKW    MFLD                                                CSW213
     C           CSCLID    IFNE *BLANKS                                                       CSW213
     C           CSCLSY    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           '/CLRC/'  CAT  CSCLSY    CLRTMP 10                                           CSW213
     C           CLRTMP    CAT  CSCLID    MFLD                                                CSW213
     C                     ELSE                                                               CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           '/CLRC/'  CAT  CSCLID    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     ELSE                                                               CSW213
     C           BBCHID    IFNE *ZEROS                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           '/CLRC'   CAT  '/CH'     CLRCH   7                                           CSW213
     C                     MOVE BBCHID    DNCHID  6                                           CSW213
     C           CLRCH     CAT  DNCHID    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           BBCHSC    IFNE *ZEROS                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           '/CLRC'   CAT  '/SC'     CLRSC   7                                           CSW213
     C                     MOVE BBCHSC    DNCHSC  6                                           CSW213
     C           CLRSC     CAT  DNCHSC    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           BBCABA    IFNE *ZEROS                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           '/CLRC'   CAT  '/CP'     CLRCP   7                                           CSW213
     C                     MOVE BBCABA    DNCABA  3                                           CSW213
     C           CLRCP     CAT  DNCABA    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           BBBFIC    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           '/CLRC'   CAT  '/BJ'     CLRBJ   7                                           CSW213
     C           CLRBJ     CAT  BBBFIC    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           BBBLCD    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           '/CLRC'   CAT  '/BL'     CLRBL   7                                           CSW213
     C           CLRBL     CAT  BBBLCD    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           BBFWCD    IFNE *ZEROS                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           '/CLRC'   CAT  '/FW'     CLRFW   7                                           CSW213
     C                     MOVE BBFWCD    DNFWCD  9                                           CSW213
     C           CLRFW     CAT  DNFWCD    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
     C           CSLEIC    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           '/LEIC/'  CAT  CSLEIC    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           '/NAME/'  CAT  BBCNA1    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     ELSE                                                               CSW213
     C                     ADD  1         X                                                 MD023009
     C           X         OCUR MULT                                                        MD023009
     C                     EXSR FSWAD                                                         CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDSR                                                              CSW213
     C/EJECT                                                                                  CSW213
      *****************************************************************   CSW200
      *   F72200 - Format Field 72 (Sender to Receiver Information)   *   CSW200
      *            This subroutine is similar to FLD72 with the       *   CSW200
      *            following changes for Swift 2000                   *   CSW200
      *            Field 72 will now not contain details of broker    *   CSW200
      *            but will include additional details in the         *   CSW200
      *            following circumstances:                           *   CSW200
      *        the floating rate option, 14F = 'OTHER'                *   CSW200
      *        value of period from in 1st subfield, 38G, = 0         *   CSW200
      *        floating day rate cnt fraction, 14D = 'OTHR'           *   CSW200
      *        financial centre, 22B = 'OTHR'                         *   CSW200
      *            the following code words will set up respectively  *   CSW200
      *        /FROP/ followed by floating rate option                *   CSW200
      *        /DESM/ followed by designated maturity                 *   CSW200
      *        /DCTF/ followed by day count fraction                  *   CSW200
      *        /LOCC/ followed by financial centre                    *   CSW200
      *                                                               *   CSW200
      *   Called by - FME200                                          *   CSW200
      *   Calls     - SR@WRK                                          *   CSW200
      *****************************************************************   CSW200
      *                                                                   CSW200
     C           F72200    BEGSR                                          CSW200
      *                                                                   CSW200
     C                     MOVE 'N'       FLD72N  1                       CSW200
     C                     Z-ADD0         MCOUNT  20                      CSW200
     C                     MOVE *BLANKS   @WRK                            CSW200
      *                                                                   CSW200
      * Set up codewords for FROP - Floating Rate Option and              CSW200
      * DESM - Designated Maturity                                        CSW200
      *                                                                   CSW200
     C           MGFLOR    IFEQ 'OTHER'                                   CSW200
     C           MGDSMT    ANDNE'O'                                       CSW200
     C           MGFLOR    ORNE 'OTHER'                                   CSW200
     C           MGDSMT    ANDEQ'O'                                       CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVEL':72:'    MTAG                            CSW200
     C                     MOVE 'Y'       FLD72N                          CSW200
      *                                                                   CSW200
     C           MGFLOR    IFEQ 'OTHER'                                   CSW200
     C                     MOVEA'/FROP/'  @WRK,1                          CSW200
     C                     ELSE                                           CSW200
     C                     MOVEA'/DESM/'  @WRK,1                          CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     MOVEAMGODM1    @WRK,7                          CSW200
     C                     EXSR SR@WRK                                    CSW200
      *                                                                   CSW200
     C           MGODM2    IFNE *BLANKS                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVEA'//'      @WRK,1                          CSW200
     C                     MOVEAMGODM2    @WRK,3                          CSW200
     C                     EXSR SR@WRK                                    CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      * Set up codeword for FROP - Floating Rate Option and               CSW200
      *                                                                   CSW200
     C           MGFLOR    IFEQ 'OTHER'                                   CSW200
     C           MGDSMT    ANDEQ'O'                                       CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVEL':72:'    MTAG                            CSW200
     C                     MOVE 'Y'       FLD72N                          CSW200
     C                     MOVEA'/FROP/'  @WRK,1                          CSW200
     C                     MOVEAMGODM1    @WRK,7                          CSW200
      *                                                                   CSW200
     C                     EXSR SR@WRK                                    CSW200
      *                                                                   CSW200
      * Set up codeword for DESM - Designated Maturity                    CSW200
      *                                                                   CSW200
     C           MGODM2    IFNE *BLANKS                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVEA'/DESM/'  @WRK,1                          CSW200
     C                     MOVEAMGODM2    @WRK,7                          CSW200
     C                     EXSR SR@WRK                                    CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      * Set up codeword for DCTF - Day Count Fraction                     CSW200
      *                                                                   CSW200
     C           @CLCM     IFEQ '4'                                       CSW200
     C           @CLCM     OREQ '5'                                       CSW200
     C           @CLCM     OREQ '9'                                                           CIR013
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C           FLD72N    IFEQ 'N'                                       CSW200
     C                     MOVEL':72:'    MTAG                            CSW200
     C                     MOVE 'Y'       FLD72N                          CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     MOVE *BLANKS   @WRK                            CSW200
     C                     MOVEA'/DCTF/'  @WRK,1                          CSW200
      *                                                                   CSW200
     C           @CLCM     IFEQ '4'                                       CSW200
     C                     MOVEACLCM,1    @WRK,7                          CSW200
      *                                                                   CSW200
     C                     ELSE                                           CSW200
     C           @CLCM     IFEQ '9'                                                           CIR013
     C                     MOVEACLCM,3    @WRK,7                                              CIR013
     C                     ELSE                                                               CIR013
     C                     MOVEACLCM,2    @WRK,7                          CSW200
     C                     ENDIF                                          CSW200
     C                     ENDIF                                                              CIR013
      *                                                                   CSW200
     C                     EXSR SR@WRK                                    CSW200
      *                                                                   CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      * Set up codeword for LOCC - Financial Centre                       CSW200
      *                                                                   CSW200
     C           SVISFC    IFEQ 'OTHR'                                    CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C           FLD72N    IFEQ 'N'                                       CSW200
     C                     MOVEL':72:'    MTAG                            CSW200
     C                     MOVE 'Y'       FLD72N                          CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     MOVEA*BLANKS   @WRK                            CSW200
     C                     Z-ADD0         I                               CSW200
      *                                                                   CSW200
     C           I         DOWLT10                                        CSW200
     C                     ADD  1         I                               CSW200
      *                                                                   CSW200
     C           SVLC,I    IFNE *BLANKS                                   CSW200
     C                     CALL 'AOLOCNR0'                                CSW200
     C                     PARM           @RTCD                           CSW200
     C                     PARM           @OPTN                           CSW200
     C                     PARM SVLC,I    @LCCD   3                       CSW200
     C           SDLOCN    PARM SDLOCN    DSFDY                           CSW200
     C                     MOVEA'/LOCC/'  @WRK,1                          CSW200
     C                     MOVEADVLCNM    @WRK,7                          CSW200
     C                     EXSR SR@WRK                                    CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ENDDO                                          CSW200
      *                                                                   CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     MOVEAMGS2R1    S2RF,1                          CSW200
     C                     MOVEAMGS2R2    S2RF,2                          CSW200
     C                     MOVEAMGS2R3    S2RF,3                          CSW200
     C                     MOVEAMGS2R4    S2RF,4                          CSW200
     C                     MOVEAMGS2R5    S2RF,5                          CSW200
     C                     MOVEAMGS2R6    S2RF,6                          CSW200
     C                     MOVEA*BLANKS   @WRK                            CSW200
     C                     Z-ADD0         I                               CSW200
     C                     Z-ADD0         MCOUNT                                            MD031998
      *                                                                   CSW200
     C           I         DOWLT6                                         CSW200
     C                     ADD  1         I                               CSW200
      *                                                                   CSW200
      * Set up Sender to Receiver Messages free form                      CSW200
      *                                                                   CSW200
     C           S2RF,I    IFNE *BLANKS                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C           FLD72N    IFEQ 'N'                                       CSW200
     C                     MOVEL':72:'    MTAG                            CSW200
     C                     MOVE 'Y'       FLD72N                          CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     MOVEAS2RF,I    @WRK,1                          CSW200
      *                                                                   CSW200
     C                     Z-ADD36        J                               CSW200
     C                     MOVEA@WRK,J    @WRK15                          CSW200
      *                                                                   CSW200
     C           @WRK15    IFNE *BLANKS                                   CSW200
     C                     MOVEA*BLANKS   @WRK,J                          CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     EXSR SR@WRK                                    CSW200
      *                                                                   CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ENDDO                                          CSW200
      *                                                                   CSW200
      *                                                                   CSW200
     C                     ENDSR                                          CSW200
      *****************************************************************   CSW200
     C/EJECT                                                              CSW200
      *****************************************************************   CSW200
      *   SR@WRK - Format WORK FIELD FOR FIELD 72                     *   CSW200
      *   Called by - F72200                                          *   CSW200
      *   Calls     - none                                            *   CSW200
      *****************************************************************   CSW200
      *                                                                   CSW200
     C           SR@WRK    BEGSR                                          CSW200
      *                                                                   CSW200
      * If data in field longer than 35 len, write to subsequent          CSW200
      * line, if available                                                CSW200
      *                                                                   CSW200
     C                     MOVE *BLANKS   @WRK15                          CSW200
     C                     Z-ADD36        J                               CSW200
     C                     MOVEA@WRK,J    @WRK15                          CSW200
      *                                                                   CSW200
     C           @WRK15    IFNE *BLANKS                                   CSW200
     C                     MOVEA*BLANKS   @WRK,J                          CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C           MCOUNT    IFLT 6                                         CSW200
     C                     MOVEA@WRK      MFLD                            CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ADD  1         MCOUNT                          CSW200
      *                                                                   CSW200
     C           @WRK15    IFNE *BLANKS                                   CSW200
     C                     MOVEA*BLANKS   @WRK                            CSW200
     C                     MOVEA'//'      @WRK,1                          CSW200
     C                     MOVEA@WRK15    @WRK,3                          CSW200
      *                                                                   CSW200
     C           MCOUNT    IFLT 6                                         CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVEA@WRK      MFLD                            CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ADD  1         MCOUNT                          CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ENDSR                                          CSW200
      *****************************************************************   CSW200
     C/EJECT                                                              CSW200
      *****************************************************************   CSW200
      *   DAT200 - FORMAT THE DATE FIELDS                             *   CSW200
      *   Called by - FMA200                                          *   CSW200
      *   Calls     - none                                            *   CSW200
      *****************************************************************   CSW200
      *                                                                   CSW200
     C           DAT200    BEGSR                                          CSW200
      *                                                                   CSW200
      ** FIELD :15B: - New Sequence                                       CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C                     MOVEL':15B:'   MTAG                            CSW200
     C                     MOVE *BLANKS   MFLD                            CSW200
      *                                                                   CSW200
      **  Field :30: - Date contract/agreed/amended.                      CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE MGTDAT    ZMDAY                           CSW200
      *                                                                   CSW200
      ** Convert Midas date to SWIFT date format.                         CSW200
      *                                                                   CSW200
     C                     CALL 'ZM0065'               15                 CSW200
     C                     PARM           ZMDAY                           CSW200
     C                     PARM           ZSDATE                          CSW200
     C                     PARM           ZSDATC                          CSW200
      *                                                                   CSW200
      ** Call ended in error. (Program not found.)                        CSW200
      *                                                                   CSW200
     C           *IN15     IFEQ '1'                                       CSW200
     C           *LOCK     IN   LDA                                       CSW200
     C                     MOVE '027'     DBASE              * * * * * * *CSW200
     C                     MOVEL'       ' DBKEY              * DBERR 027 *CSW200
     C                     MOVEL'ZM0060'  DBFILE             * * * * * * *CSW200
     C                     OUT  LDA                                       CSW200
     C                     EXSR *PSSR                                     CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     MOVE ':30T:'   MTAG                            CSW200
     C                     MOVELZSDATC    MFLD                            CSW200
      *                                                                   CSW200
      ** Field :32B:  Notional amount                                     CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE MGCCY     ZCCY                            CSW200
     C                     MOVE MGNOAM    ZAMNT                           CSW200
     C                     CALL 'ZM0040'                                  CSW200
     C                     PARM           ZAMNT                           CSW200
     C                     PARM           ZCCY                            CSW200
     C                     PARM *BLANKS   ZSAMNT                          CSW200
     C                     PARM *BLANKS   ZSCCY                           CSW200
     C                     PARM *BLANKS   ZERR                            CSW200
     C                     PARM           ZSWDPC                                              222373
      *                                                                   CSW200
     C                     MOVE ':32B:'   MTAG                            CSW200
     C           ZSCCY     CAT  ZSAMNT    MFLD                            CSW200
      *                                                                   CSW200
      *  Field :30F: Effective date                                       CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE MGSDAT    ZMDAY                           CSW200
      *                                                                   CSW200
      ** Convert Midas date to SWIFT date format.                         CSW200
      *                                                                   CSW200
     C                     CALL 'ZM0065'               15                 CSW200
     C                     PARM           ZMDAY                           CSW200
     C                     PARM           ZSDATE                          CSW200
     C                     PARM           ZSDATC                          CSW200
      *                                                                   CSW200
     C                     MOVE ':30F:'   MTAG                            CSW200
     C                     MOVELZSDATC    MFLD                            CSW200
      *                                                                   CSW200
      ** Field :30P: Termination date                                     CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
     C                     MOVE MGMDAT    ZMDAY                           CSW200
      *                                                                   CSW200
      ** Convert Midas date to SWIFT date format.                         CSW200
      *                                                                   CSW200
     C                     CALL 'ZM0065'               15                 CSW200
     C                     PARM           ZMDAY                           CSW200
     C                     PARM           ZSDATE                          CSW200
     C                     PARM           ZSDATC                          CSW200
      *                                                                   CSW200
     C                     MOVE ':30P:'   MTAG                            CSW200
     C                     MOVELZSDATC    MFLD                            CSW200
      *                                                                   CSW200
     C                     ENDSR                                          CSW200
      *****************************************************************   CSW200
     C/EJECT                                                              CSW200
      *****************************************************************                       CSD015
      *                                                               *                       CSD015
      *  SRWTCH - Initiates the Midas Watch List Checking Engine.     *                       CSD015
      *                                                               *                       CSD015
      *****************************************************************                       CSD015
     C           SRWTCH    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Check if the message is for automatic release.                                       CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       PARLS                                               CSD015
      *                                                                                       CSD015
     C           MGST      IFEQ 'RSND'                                                        CSD015
     C           NWRK      IFEQ 'SWIFT '                                                      CSD015
     C           NWRK      OREQ 'TELEX '                                                      CSD015
     C           NWRK      OREQ 'STTX  '                                                      CSD015
     C                     MOVE 'CRTD'    MGST                                                CSD015
     C                     MOVE 'Y'       PARLS   1                                           CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Initialise the Transaction Details parameter.                                        CSD015
      *                                                                                       CSD015
     C                     CLEARWLTDS                                                         CSD015
     C                     Z-ADD*ZERO     W4VDAT                                              CSD015
     C                     Z-ADD*ZERO     W4MDAT                                              CSD015
     C                     Z-ADD*ZERO     W4AMT1                                              CSD015
     C                     Z-ADD*ZERO     W4AMT2                                              CSD015
      *                                                                                       CSD015
     C                     MOVELTRNO      W4IDEN                                              CSD015
     C                     MOVELMTPY      W4ITEM                                              CSD015
     C                     MOVEL'MGOREF  'W4FUNT                                              CSD015
     C                     MOVELMGBRCA    W4BRCH                                              CSD015
     C                     MOVELDECN      W4CNUM                                              CSD015
     C                     Z-ADDBJRDNB    W4DDAT                                              CSD015
     C                     MOVELPARLS     W4ARLS                                              CSD015
      *                                                                                       CSD015
      ***Send*the*Transaction Details to the Compliance Engine.                        CSD015 221145
      *********************                                                            CSD015 221145
     C*********************CALL 'SDWLCLOP'                                             CSD015 221145
     C*********************PARM           WLTDS                                        CSD015 221145
     C*********************PARM *BLANKS   PSTRNG                                       CSD015 221145
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
     C/EJECT                                                                                  221145
      *****************************************************************                       221145
      *                                                               *                       221145
      *  WLCDQ - Submit information to Watch List Check Dtaq          *                       221145
      *                                                               *                       221145
      *****************************************************************                       221145
      *                                                                                       221145
     C           WLCDQ     BEGSR                                                              221145
      *                                                                                       221145
      *  Send transaction to compliance engine program                                        221145
      *                                                                                       221145
     C                     CALL 'SDWLCLOP'                                                    221145
     C                     PARM           WLTDS                                               221145
     C                     PARM *BLANKS   PSTRNG                                              221145
      *                                                                                       221145
      *                                                                                       221145
     C                     ENDSR                                                              221145
      *                                                                                       221145
     C/EJECT                                                                                  221145
      *****************************************************************
      *   *PSSR - error handling                                      *
      *****************************************************************
      *
     C           *PSSR     BEGSR
      *
      **  Write database error to report
      *
     C                     OPEN MG0340AU
     C                     WRITEHEAD
     C                     WRITEDBERROR
      *
     C                     MOVE *ON       *INU7
     C                     MOVE *ON       *INU8
     C                     MOVE *ON       *INLR
     C                     DUMP
     C                     RETRN
      *
     C                     ENDSR
      /EJECT
      /COPY MGCPYSRC,SWIFTTRANS
** CPY@   Object Copyright
(c) Misys International Banking Systems Ltd. 2001
** MSGA   Messages
Settlement - pay
Customer details not found on SDCUSTPD
Nostro customer not found on SDNOSTPD
Broker code not found on SDBROKPD
ZM0040 (format ccy and amount) call ended in error
ZM0050 (format SWIFT address) call ended in error
Codeword was not found for this message
Duplicate TRN key built for this message
** TABNST - Codes indicating settlement via nostro
01
02
07
08
12
** TABINT - Codes indicating settlement via internal
03
04
05
06
14
** CLCM - Calculation methods (Change Reference: CSW200)
Actual/365 ignoring 29th of Feb.
Actual/360 ignoring 29th of Feb.
Actual/365, 366 for Feb 29 period
