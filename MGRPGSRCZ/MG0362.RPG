     H        1                           F
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas MG Format IRS rate fix and settlement confo.')   *
      *****************************************************************
      *                                                               *
      *  Midas - Message Generation Module                            *
      *                                                               *
      *  MG0362 - FORMAT IRS RATE FIX AND SETTLEMENT CONFIRMATION     *
      *                                                               *
      *  Function:  This program will format MT362 messages for       *
      *  (IC & COB) output to SWIFT.                                  *
      *                                                               *
      *  Called By: DLC1921 - FRAIRS Rate Fixing                      *
      *             DLC0603 - Close of Business Confirmations         *
      *                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. CSW213             Date 03Jun13               *
      *  Prev Amend No. AR736194           Date 24Apr13               *
      *                 CLE148             Date 23Jul12               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 BUG19661           Date 10Sep08               *
      *                 CSW208             Date 15Apr08               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 222373             Date 27Oct03               *
      *                 222385             Date 23Oct03               *
      *                 221145             Date 08Sep03               *
      *                 219242             Date 01Jul03               *
      *                 219241             Date 01Jul03               *
      *                 CSD015             Date 14Oct02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CSW025             Date 26Mar02               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CSW201             Date 02May01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 190127             Date 28Feb01               *
      *                 184718             Date 19Jan01               *
      *                 189455             Date 31Jan01               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CDL008             Date 02May00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 177594             Date 10Apr00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 171312             Date 09Mar99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CSW097             Date 09Mar99               *
      *                 CCF003             Date 01Aug96               *
      *                 CSW005             Date 01Aug96               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  CSW213 - SWIFT Changes 2013 (Recompile)                      *
      *  AR736194 - Multiple MT362 generated during COB. Move read    *
      *             PF/MGF362PD before ENDDO statement. Apply fix     *
      *             236392 and 251037. (Child: AR736195)              *
      *  CLE148 - Alpha Loan Reference (Recompile)                    *
      *  BUG19661 - No details found when ME0890AU file is opened     *
      *  CSW208 - SWIFT 2008 Changes                                  *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222373 - Parameter mismatch.                                 *
      *  222385 - SWIFT msgs are Watch List checked regardless of     *
      *           configuration file setting                          *
      *  221145 - Compliance Watch WLC: Move compliance check to      *
      *           after COMIT to MGOMSGPD                             *
      *  219242 - Not possible to create MT103+ payment msg from      *
      *           non-FT transaction (Recompile)                      *
      *  219241 - Defaulting of "Details of Charges" assign a         *
      *           system value (Recompile)                            *
      *  CSD015 - Midas Compliance Watch - Watch List Checking        *
      *  CSW025 - Midas Message Manager                               *
      *           - Pass original change type                         *
      *  CSW201 - SWIFT 2001 Standards Update                         *
      *  190127 - Related reference should contain tansaction         *
      *           reference of previous message of same type          *
      *  184718 - Setup CIND flag to correct Y2K display problems.    *
      *  189455 - The variable 'X' should be 3S0, not 2S0.            *
      *           This error was caused by change 171312.             *
      *  CDL008 - Continuous Linked Settlement (Recompiled)           *
      *  177594 - Field 22C should contain YYMM between the CSID's    *
      *           instead of the rate.                                *
      *  171312 - CSW097/CSW005 RELATED FIXES                         *
      *           1) 32M on seq B and D should be :32H and do not     *
      *              output htis for FRs                              *
      *           2) Make MULT longer.                                *
      *           3) Remove eu0200 processing on amounts as           *
      *           SWIFT validation requires currencies to be          *
      *           uniform all throughout the message (FIN Err C02)    *
      *  CSW097 - MT34*, MT36* Message Generation for IRA/IRS.        *
      *           MT362 restructured as per CSW097                    *
      *  CCF003 - Include MT360 and MT632 Confirmation Matching       *
      *  CSW005 - FRA/IRS MG34n and MG36n Message Generation.         *
      *                                                               *
      *****************************************************************
     FMGF362PDUF  E           K        DISK
     F                                              KCOMIT
     FMGOREFL0IF  E           K        DISK
     F            MGOREFD0                          KRENAMEMGREFL0
     FMGX36NPDIF  E           K        DISK                                                   CSW097
     FMGY36NPDIF  E           K        DISK                                                   CSW097
     FMGOREFPDO   E                    DISK
     F                                              KCOMIT
     FMGOMSGPDO   E                    DISK
     F                                              KCOMIT
      *                                                                                       190127
      ** MG Transaction history file                                                          190127
     FMGHISTL0UF  E           K        DISK                      A                            190127
     F                                              KCOMIT                                    190127
     FMGY36NL1UF  E           K        DISK                                                   CSW201
     F            MGY36ND0                          KRENAMEMGY36N1                            CSW201
     F                                              KCOMIT                                    CSW201
     FMGHISTL1IF  E           K        DISK                                                   CSW201
     F            MGHISTD0                          KRENAMEMGHIST1                            CSW201
     FMGHISTL2IF  E           K        DISK                                                   CSW201
     F            MGHISTD0                          KRENAMEMGHIST2                            CSW201
     FMGOMSGLAIF  E           K        DISK                                                   CSW201
     F            MGOMSGD0                          KRENAMEMGOMSGA                            CSW201
     FMG0362P1O   E                    PRINTER                        UC
     FMG0362AUO   E                    PRINTER                        UC
     F/COPY WNCPYSRC,MG0362F001
      *****************************************************************
      *                                                               *
      * FUNCTION OF INDICATORS                                        *
      *                                                               *
      *    01            EOF MGF362PD                                 *
      *    05            Error on write to MGOREFPD.                  *
      *    06            Error on write to MGOMSGPD                   *
      *    11            Chain to MGOREFL0.                           *
      *    15            Error in call to standard program ZM0060     *
      *    16            Error on delete of GDF record.               *
      *    20            LOKUP operation searching array (GNR)        *
      *    21            LOKUP operation searching array (GNR)        *
      *    22            LOKUP operation searching array (GNR)        *
      *    23            Settlement method on TABNST/TABINT.          *
      *    25            Array 1st line filled ; fld72.               *
      *    26            Error on call of MG5000                      *
      *    27            ConCord Interface is ON.                     *
      *    28            Error in call to standard program ZM1190     *
      *    30            Feedback record not generated                *
      *    31            LOKUP operation searching array (@WRK)       *
      *    33            LOKUP operation searching array (@ATAG)      *
      *    50            MG0362P1 open                                *
      *    80            Generic NRF/EOF indicator                    *                       CSW201
      *    81            Error on delete of MGY36NL1 record           *                       CSW201
      *    U7U8          Database error                               *
      *                                                               *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                   Index to subroutines                        *
      *   main process                                                *
      *   INIT - Initial Process.                                     *
      *   INTF - Initialise non-constant fields.                      *
      *   SRROUT - Determine Message Routing.                         *
      *   FMTA - Format Sequence A MT362 fields for output.           *
      *   FMTB - Format Sequence B MT362 fields for output - (THEIR). *
      *   FMTC - Format Sequence C MT362 fields for output - (OUR).   *
      *   FMTD - Format Sequence D MT362 fields for output - (THEIR). *
      *   FMTE - Format Sequence E MT362 fields for output - (OUR).   *
      *   RFXSEQ - Common routine for outputting rate fixing seq.     *
      *   SETSEQ - Common routine for outputting settlement seq.      *
      *   SR1190 - Format fields :37P:, :37R: and :37U:.              *
      ****PAY**-*Format*fields*:53:,*:56a:*and*:57a:*-*(OUR).**********                       CSW097
      ****RECV*-*Format*fields*:56a:*and*:57a:*-*(THEIR).**************                       CSW097
      *   FSWAD- Format SWIFT Address.                                *
      *   FLD72- Format Field 72.                                     *
      *   REPT - Print Incorrectly Generated Messages.                *
      *   OMSG - Output Correctly Generated Messages.                 *
      *   WREF - Write o/p reference to PF/MGOREFPD.                  *
      *   *PSSR- Error Handling.                                      *
      *                                                               *
      *****************************************************************
     E                    CPY@    1   1 80               copyright
     E                    MSGA    1   8 60               message text
     E                    @ATAG   1   5  5               tags w/ blank fld
     E                    TABNST  1   5  2               settlement nostro
     E                    TABINT  1   5  2               settle. internal
     E                    GNR        15  3               msg gen. released
     E                    @WRK       50  1               work array
     E                    SR2F        6 35               sender-recv. info
     E                    TRN        40 16                                                    CSW201
     E                    FTN        40 16                                                    CSW201
      *
     IMGREFL0
     I              SYTM                            MSYTM
     I              MODI                            MMODI                                     CSW201
     I              TRNO                            MTRNO                                     CSW201
     I              TRNF                            MTRNF                                     CSW201
     I              TRNM                            MTRNM                                     CSW201
     I              MTRN                            MMTRN                                     CSW201
     I              TNTP                            MTNTP                                     CSW201
     I              SBTP                            MSBTP                                     CSW201
     I              EVTP                            MEVTP                                     CSW201
     I              NWRK                            MNWRK
     I              SECN                            MSECN
     I              NWSN                            MNWSN
     I              DECN                            MDECN
     I              NWDS                            MNWDS
     I              NWBN                            MNWBN                                     CSW201
     I              MTPY                            MMTPY                                     CSW201
     I              MPRY                            MMPRY                                     CSW201
     I              MGSG                            MMGSG
     I              MGST                            MMGST
     I              F57U                            MF57U
     I              LSCC                            MLSCC
     I              PTST                            MPTST                                     CSW201
     I              CARQ                            MCARQ                                     CSW201
     I              MPDE                            MMPDE                                     CSW201
     I              HRDT                            MHRDT
     I              MGDE                            MMGDE
     I              MGTM                            MMGTM
     I              LADT                            MLADT
     I              LATM                            MLATM                                     CSW201
     I              RELD                            MRELD
     I              RELT                            MRELT
     I              RUSR                            MRUSR                                     CSW201
     I              RWSN                            MRWSN                                     CSW201
     I              AMTX                            MAMTX                                     CSW201
     I              AMTS                            MAMTS                                     CSW201
     I              SVDT                            MSVDT                                     CSW201
     I              CCY                             MCCY                                      CSW201
     I              NSNO                            MNSNO                                     CSW201
     I              SACN                            MSACN                                     CSW201
     I              AORR                            MAORR                                     CSW201
     I              DESI                            MDESI                                     CSW201
     I              BRCA                            MBRCA                                     CSW201
     I              OTHB                            MOTHB                                     CSW201
     I              RCBR                            MRCBR                                     CSW201
     I              OTHT                            MOTHT                                     CSW201
     I              NETI                            MNETI                                     CSW201
     I              DELC                            MDELC                                     CSW201
     I              DYST                            MDYST                                     CSW201
     I              RSID                            MRSID                                     CSW201
     I              MSE1                            MMSE1                                     CSW201
     I              ELIN                            MELIN                                     CSW201
     I              SSAC                            MSSAC                                     CSW201
     I              MIR                             MMIR                                      CSW201
     I              TSKS                            MTSKS                                     CSW201
     I              TSKY                            MTSKY                                     CSW201
     I              TSEQ                            MTSEQ                                     CSW201
     I              CFPF                            MCFPF
     I              PT210                           MPT210                                    CSW201
     I              AVDT                            MAVDT                                     CSW201
     I              ASEQ                            MASEQ                                     CSW201
     I              TODY                            MTODY
     I              CIND                            MCIND                                     CSW201
     I              CINDV                           MCINDV                                    CSW201
     I              CLSS                            MCLSS                                     CSW201
      *
      **  Rename conflicting MGOREFL0 fields
      *
      *                                                                                       CSW201
     IMGY36N1                                                                                 CSW201
      ** Rename conflicting fields                                                            CSW201
      *                                                                                       CSW201
     I              MGSEQN                          Y1SEQN                                    CSW201
     I              MGMSSQ                          Y1MSSQ                                    CSW201
     I              MGPDAT                          Y1PDAT                                    CSW201
     I              MGPAMT                          Y1PAMT                                    CSW201
     I              MGETYP                          Y1EVTP                                    CSW201
      *                                                                                       CSW201
     IMGHIST1                                                                                 CSW201
      ** Rename conflicting fields                                                            CSW201
      *                                                                                       CSW201
     I              HSMODI                          M1MODI                                    CSW201
     I              HSTRAN                          M1TRAN                                    CSW201
     I              HSSEQ                           M1SEQ                                     CSW201
     I              HSMTPY                          M1MTPY                                    CSW201
     I              HSTRNO                          M1TRNO                                    CSW201
     I              HSPDAT                          M1PDAT                                    CSW201
     I              HSMSSQ                          M1MSSQ                                    CSW201
     I              HSEVTP                          M1EVTP                                    CSW201
     I              HSFTRN                          M1FTRN                                    CSW201
      *                                                                                       CSW201
     IMGHIST2                                                                                 CSW201
      ** Rename conflicting fields                                                            CSW201
      *                                                                                       CSW201
     I              HSMODI                          M2MODI                                    CSW201
     I              HSTRAN                          M2TRAN                                    CSW201
     I              HSSEQ                           M2SEQ                                     CSW201
     I              HSMTPY                          M2MTPY                                    CSW201
     I              HSTRNO                          M2TRNO                                    CSW201
     I              HSPDAT                          M2PDAT                                    CSW201
     I              HSMSSQ                          M2MSSQ                                    CSW201
     I              HSEVTP                          M2EVTP                                    CSW201
     I              HSFTRN                          M2FTRN                                    CSW201
      *                                                                                       CSW201
     IMGOMSGA                                                                                 CSW201
      ** Rename conflicting fields                                                            CSW201
      *                                                                                       CSW201
     I              MTAG                            LAMTAG                                    CSW201
     I              MFLD                            LAMFLD                                    CSW201
     I              CTRC                            LACTRC                                    CSW201
     I              TRNO                            LATRNO                                    CSW201
     I              PTDL                            LAPTDL                                    CSW201
     I              MSEQ                            LAMSEQ                                    CSW201
      *                                                                                       CSW201
     I            DS
     I                                        1  12 CSID
     I                                        9  11 @BIC
      *
      **  Data structure to test for BIC code
      *
     I*MULT*******DS                         95                           171312
     IMULT        DS                        200                           171312
     I                                        1   5 MTAG
     I                                        6  55 MFLD
     I                                       56 105 MERR
      *
      **  Multiple occurrence data structure for message
      *
     ILDA         DS                            256
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
      *
      **  Local data area
      *
     ICODEWD      DS                         22
     I                                        1   8 CWRD
     I                                       10  10 F57U
      **  Data structure containing codeword for the new message
      *
     IFLD3N       DS                         24
     I                                        1   6 ZSDATE
     I                                        7   9 ZSCCY
     I                                       10  24 ZSAMNT
      *
      **  Data structure containing codeword for fields 32A.
      *
     IFLD2N       DS                         18
     I                                        1   3 @ZCCY
     I                                        4  18 @ZAMT
      *
      **  Data structure containing codeword for field 33E.
      *
     IERR3N       DS                         24
     I                                        1   3 ZCCY
     I                                        5  170ZAMT
      *
      **  Erroneous currency & amounts for Fields 32A.
      *
     I@MTAG       DS                          5
     I                                        1   1 COLON1
     I                                        2   3 FLDNO
     I                                        4   4 TAG
     I                                        5   5 COLON2
      *
      **  Data structure constructing message field tag
      *
     IP@IN        DS                            256
     I                                        1   3 I@SNBR
     I                                        4   9 I@DSCN
     I                                       10  12 I@MTPY
     I                                       13  140I@SETT
     I                                       15  15 I@CONC
     I                                       16  16 I@FTCS
     I                                       17  18 I@MMOD
      ** Data structure for input parameter
      *
     IP@OUT       DS                            256
     I**********                              1   60O@CNSN                                    CSD027
     I                                        1   6 O@CNSN                                    CSD027
     I                                        7  18 O@SWSN
     I                                       19  38 O@NWSN
     I                                       39  49 O@SWDS
     I                                       46  46 W@96CN
     I                                       47  49 W@BIC
     I                                       50  69 O@NWDS
     I                                       70  75 O@NWRK
     I                                       76  76 O@MGSG
     I                                       77  80 O@MGST
     I                                       81  81 O@PAIN
     I                                       82  87 O@PCNB
     I                                       88  90 O@SPRS
      ** Data structure for ouput parameter
      *
     I@HREF       DS                         16                                               190127
     I                                        1   2 HSMODI                                    190127
     I                                        3   8 HSTRAN                                    190127
     I                                        9  11 HSSEQ                                     190127
      **  Data structure for related reference                                                190127
      *                                                                                       190127
     IWLTDS     E DSSDWLTOPD                                                                  CSD015
      ** DS For Watch List Transaction Details File                                           CSD015
      *                                                                                       CSD015
     IPSTRNG      DS                           9999                                           CSD015
      *                                                                                       CSD015
     ISDWLCC    E DSSDWLCCPD                                                                  222385
      ** Watch list checking details                                                          222385
      *                                                                                       222385
     ISDBANK    E DSSDBANKPD
      *
      **  External Data structure for bank details.
      *
     ISDTRAD    E DSSDTRADPD
      *
      **  External Data structure for trading file.
      *
     ISDCUST    E DSSDCUSTPD
      *
      **  External Data structure for customer details.
      *
     ISDBRCH    E DSSDBRCHPD
     I              QQDFAC                          DFACQQ                                    CGL029
      *
      **  External Data structure for branch details.
      *
     ISDMMOD    E DSSDMMODPD
      *
      **  External Data structure for module ICD file.
      *
     ISDNOST    E DSSDNOSTPD
     I              QQACCD                          ACCDQQ                                    CGL029
      *
      **  External Data structure for nostro details.
      *
     ISDMGME    E DSSDMGMEPD
      *
      **  Data structure for message management data.
      *
     ISCSARD    E DSSCSARDPD
      *
      **  Data structure for Switchable Features file
      *
     IDSFDY     E DSDSFDY
      *
      **  Short data structure for access programs
      *
     IDSSDY     E DSDSSDY
      *
      **  Long data structure for access programs
      *
     IDSLDY     E DSDSLDY                                                                     CSW208
      *                                                                                       CSW208
      ** External Data Structure to hold the Incoming Record format of the file               CSW208
      *                                                                                       CSW208
      /EJECT
      *****************************************************************
      *   MAIN - main process                                         *
      *   Called by - none                                            *
      *   Calls - INIT Initial Process.                               *
      *           INTF Initialise non-constant fields.                *
      *           SRROUT Determine Message Routing.                   *
      *           FMTA Format Sequence A MT362 fields for output.     *
      *           FMTB Format Sequence B MT362 fields for output.     *
      *           FMTC Format Sequence C MT362 fields for output.     *
      *           FMTD Format Sequence D MT362 fields for output.     *
      *           FMTE Format Sequence E MT362 fields for output.     *
      *           REPT Print Incorrectly Generated Messages.          *
      *           OMSG Output Correctly Generated Messages.           *
      *****************************************************************
      *
      **  Transaction history key                                                             190127
     C           HSKEY     KLIST                                                              190127
     C                     KFLD           MGMODI                                              190127
     C                     KFLD           HSTRAN                                              190127
     C                     KFLD           HSMTPY                                              190127
      *
      ** Initial Processing.
      *
     C                     EXSR INIT
      *
      ** Read the first record from PF/MGF362PD.
      *
     C                     READ MGF362PD                 01
      *
      ** Do While record is found in file.
      *
     C           *IN01     DOWEQ'0'
      *
      ** Initialise output fields and format message level fields.
      *
     C                     EXSR INTF
      *                                                                                       CSW097
      ** Save MGSEQN for future use.                                                          CSW097
      *                                                                                       CSW097
     C                     Z-ADDMGSEQN    @MGSEQ                                              CSW097
     C                     MOVELMGTNUM    WTRAN   6                                           CSW201
      *
      ** Determine message routing.
      *
     C                     EXSR SRROUT
      *
      ** Format Sequence A MT362 fields for output.
      *
     C                     EXSR FMTA
      *
     C                     MOVE *BLANK    @SQNCE  1
      *
      ***If*their*daycount*fraction*is*not*blank                                              CSW097
     C***********MGTDCF    IFNE *BLANK                                                        CSW097
      *                                                                                       CSW097
      ** If their side of the swap is floating and has been fixed                             CSW097
      ** by the requesting process (i.e. Current Rate Chg <> 0),                              CSW097
      ** then format and output fields in Sequence B                                          CSW097
     C           MGTCRD    IFNE 0                                                             CSW097
     C                     EXSR FMTB
     C                     ENDIF
      *
      ***If*their*pay*date*is*not*zero.                                                       CSW097
     C***********MGTDCF    IFEQ *BLANK                                                        CSW097
     C***********MGTPDT    ANDNE0                                                             CSW097
      *                                                                                       CSW097
      ** If there are payments receivable from the counterparty to                            CSW097
      ** ourselves within the rate fixing period (i.e. Seq C record                           CSW097
      ** exist in MGY36NPD), then format and output fields in Seq C                           CSW097
     C                     Z-ADD0         NREPT   50                                          CSW097
     C                     MOVEL'C'       @MGMSQ                                              CSW097
     C                     Z-ADD0         WCREPT  50                                          CSW201
      *                                                                                       CSW201
      ** If Single currency, number of sequences C and E                                      CSW201
      ** for a message will be limited to 1                                                   CSW201
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C           KY36N1    CHAINMGY36N1              51                                       CSW201
     C                     ELSE                                                               CSW201
     C           @SEQN     CHAINMGY36NPD             51                                       CSW097
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C           *IN51     IFEQ '0'                                                           CSW097
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C           MGCHTP    ANDEQ'A'                                                           CSW201
     C           WHTRNO    ANDNE*BLANKS                                                       CSW201
     C           KHIST2    CHAINMGHIST2              80                                       CSW201
     C           *IN80     IFEQ *OFF                                                          CSW201
     C                     EXSR FMTC                                                          CSW201
     C                     Z-ADDNREPT     WCREPT                                              CSW201
     C                     ENDIF                                                              CSW201
     C                     ELSE                                                               CSW201
     C                     EXSR FMTC
     C                     Z-ADDNREPT     WCREPT                                              CSW201
     C                     ENDIF                                                              CSW201
     C                     ENDIF
      *
      ***If*our*daycount*fraction*is*not*blank.                                               CSW097
     C***********MGODCF    IFNE *BLANK                                                        CSW097
      *                                                                                       CSW097
      ** If our side of the swap is floating and has been fixed                               CSW097
      ** by the requesting process (i.e. Current Rate Chg <> 0),                              CSW097
      ** then format and output fields in Sequence D                                          CSW097
     C           MGOCRD    IFNE 0                                                             CSW097
     C                     EXSR FMTD
     C                     ENDIF
      *
      ***If*our*pay*date*is*not*zero.                                                         CSW097
     C***********MGODCF    IFEQ *BLANK                                                        CSW097
     C***********MGOPDT    ANDNE0                                                             CSW097
      *                                                                                       CSW097
      ** If there are payments payable from ourselves to the                                  CSW097
      ** counterparty within the rate fixing period (i.e. Seq E record                        CSW097
      ** exist in MGY36NPD), then format and output fields in Seq E                           CSW097
      ** CSW201: If Cross currency, number of sequences will be limited                       CSW201
      ** to 2 if C and E have same payment dates, or 1 if different                           CSW201
      *                                                                                       CSW201
     C                     Z-ADD0         NREPT   50                                          CSW097
     C                     MOVEL'E'       @MGMSQ                                              CSW097
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C           KY36N1    CHAINMGY36N1              51                                       CSW201
     C                     ELSE                                                               CSW201
     C           @SEQN     CHAINMGY36NPD             51                                       CSW097
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C           *IN51     IFEQ '0'                                                           CSW097
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C           MGTTYP    IFEQ 'RX'                                                          CSW201
     C           WCREPT    OREQ *ZERO                                                         CSW201
     C           MGCHTP    IFEQ 'A'                                                           CSW201
     C           WHTRNO    ANDNE*BLANKS                                                       CSW201
     C           KHIST2    CHAINMGHIST2              80                                       CSW201
     C           *IN80     IFEQ *OFF                                                          CSW201
     C                     EXSR FMTE                                                          CSW201
     C                     ENDIF                                                              CSW201
     C                     ELSE                                                               CSW201
     C                     EXSR FMTE                                                          CSW201
     C                     ENDIF                                                              CSW201
     C                     ENDIF                                                              CSW201
     C                     ELSE                                                               CSW201
     C                     EXSR FMTE
     C                     ENDIF                                                              CSW201
     C                     ENDIF
      *
      ** Print if error in generated message.
      *
     C           @ERR      IFEQ 'Y'
     C                     EXSR REPT
      *
      ***Print*if*no*error*in*generated*message.*                                             CSW097
     C                     ELSE
      *                                                                                       CSW097
      ** Otherwise, Output records to MGOREFPD and MGOMSGPD                                   CSW097
     C                     EXSR OMSG
      *                                                                   CCF003
      ** If switchabe feature 'CCF003' is on and confirmation             CCF003
      ** matching is on, generate feedback record.                        CCF003
      *                                                                   CCF003
     C           CCF003    IFEQ 'Y'                                       CCF003
     C           BGCFMT    ANDEQ'Y'                                       CCF003
     C                     EXSR CFMAT                                     CCF003
     C                     ENDIF                                          CCF003
      *
     C                     ENDIF
      *
      ** Delete record after completion of processing.
      ** (For Swift 2001: if any of the messages in MGHISTL1 has not                          CSW201
      ** been used as reference, produce MT362 with codeword 'CANC')                          CSW201
      *
     C           WPROC     IFEQ 'N'                                                           CSW201
     C           @ERR      OREQ 'Y'                                                           CSW201
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C           MGCHTP    ANDEQ'A'                                                           CSW201
     C           FTN,1     ANDNE*BLANKS                                                       CSW201
     C           @ERR      ANDNE'Y'                                                           CSW201
     C                     EXSR SRCANC                                                        CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     DELETMGF362PD               16
      *
      **  Error on delete of record.
      *
     C           *IN16     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '001'     DBASE              * * * * * * *
     C                     MOVELMGTNUM    DBKEY              * DBERR 001 *
     C                     MOVEL'MGF362PD'DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *                                                                                       CSW201
     C                     Z-ADD*ZERO     WF                                                  CSW201
     C                     Z-ADD*ZERO     WX                                                  CSW201
     C                     CLEARTRN                                                           CSW201
     C                     CLEARFTN                                                           CSW201
     C                     ENDIF                                                              CSW201
      *
      **  Update sequence numbers on transaction record
      **  if no errors have occurred
      *
     C           @ERR      IFNE 'Y'
     C                     CALL 'MG5000'               26
     C                     PARM MGMODI    @MODI   2
     C                     PARM MGTNUM    @TRAN  15
     C                     PARM 'CF'      @PROG   2
     C                     PARM 'U'       @MODE   1
     C                     PARM *ZEROS    MGLSWC  30
     C                     PARM *ZEROS    MGLSWS  30
     C                     PARM *BLANKS   @ERCD   1
      *
      **  Error on access for sequence number
      *
     C           @ERCD     IFEQ 'Y'
     C           *LOCK     IN   LDA
     C                     MOVE '002'     DBASE            * * * * * * * *
     C                     MOVELMODI      DBKEY            *  DBERR 002  *
     C                     MOVE MTRN      DBKEY            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Program missing on call
      *
     C           *IN26     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '003'     DBASE            * * * * * * * *
     C                     MOVE 'MG5000'  DBKEY            *  DBERR 003  *
     C                     OUT  LDA                        * * * * * * * *
     C                     EXSR *PSSR
     C                     END
      *
     C                     END
     C           *LOCK     IN   LDA
     C                     MOVEL'MG0362  'DBPGM
     C                     OUT  LDA
      *
      **  COMIT all changes since no error on writing the message
      *
     C********** WPROC     IFEQ 'N'                                                  CSW201 AR736194
     C********** @ERR      OREQ 'Y'                                                  CSW201 AR736194
     C                     COMIT
      *                                                                   221145
      **  Call Compliance Watch:Watch List Checking                       221145
      *                                                                   221145
     C           CSD015    IFEQ 'Y'                                       221145
     C           W1EWLC    ANDEQ'Y'                                                           222385
     C           CSW025    ANDEQ'N'                                       221145
     C                     EXSR WLCDQ                                     221145
     C                     ENDIF                                          221145
      *****************************************************************                     AR736194
      ***Read*next*available*record*in*MGF362PD.***********************                     AR736194
      *****************************************************************                     AR736194
     C**********           READ MGF362PD                 01                                 AR736194
     C**********           ENDIF                                                     CSW201 AR736194
      *
     C                     MOVE 'N'       WPROC                                             AR736194
     C                     MOVE ' '       @ERR                                              AR736194
     C                     READ MGF362PD                 01                                 AR736194
     C                     ENDDO
      *
      **  Write end of report, only if the printer file is open
      *
     C           *IN50     IFEQ '1'
     C                     WRITEEOREPT
     C                     END
     C/COPY WNCPYSRC,MG0362C001
      *
     C                     MOVE *ON       *INLR
      *
      /EJECT
      *****************************************************************
      *   INIT - initial process                                      *
      *   Called by - main process                                    *
      *****************************************************************
      *
     C           INIT      BEGSR
      *
     C                     MOVEACPY@      CPY2@  80
      *
      **  Set up LDA
      *
     C           *NAMVAR   DEFN           LDA
     C           *LOCK     IN   LDA
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     MOVEL'MG0362'  DBPGM
     C                     MOVE *BLANKS   DBASE
     C                     OUT  LDA
      *
      **  Access SDBANKPD for report title.
      *
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
      *
      ** If no record is found on sdbankpd.
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '004'     DBASE              * * * * * * *
     C                     MOVEL'FIRST'   DBKEY              * DBERR 004 *
     C                     MOVEL'SDBANKPD'DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      ** Correctly work out Date Format.
      *
     C           BJDFIN    COMP 'M'                      98
      *
      **  Access SDTRADPD for trading information.
      *
     C                     CALL 'AOTRADR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDTRAD    PARM SDTRAD    DSFDY
      *
      ** If no record is found on sdtradpd.
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '005'     DBASE              * * * * * * *
     C                     MOVEL'FIRST'   DBKEY              * DBERR 005 *
     C                     MOVEL'SDTRADPD'DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Access SDMMODPD for modules available.
      *
     C                     CALL 'AOMMODR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C           SDMMOD    PARM SDMMOD    DSFDY
      *
      ** If no record is found on sdmmodpd.
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '006'     DBASE              * * * * * * *
     C                     MOVEL'FIRST'   DBKEY              * DBERR 006 *
     C                     MOVEL'SDMMODPD'DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Access SDMGMEPD for message management data.
      *
     C                     CALL 'AOMGMER0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C           SDMGME    PARM SDMGME    DSFDY
      *
      ** If no record is found on sdmgmepd.
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '007'     DBASE            * * * * * * * *
     C                     MOVEL'FIRST'   DBKEY            *  DBERR 007  *
     C                     MOVEL'SDMGMEPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      ** Initialise constant fields.
      *
     C                     MOVE *LOVAL    CR      1
     C                     BITON'457'     CR
     C                     MOVE *LOVAL    LF      1
     C                     BITON'257'     LF
     C                     MOVELCR        CRLF    2
     C                     MOVE LF        CRLF
     C                     MOVE ':'       COLON1
     C                     MOVE ':'       COLON2
      *
      ** CRLF Control Character for message data records.
      *
     C                     MOVE CRLF      CTRC
      *
      ** Convert run date to YYMMDD, for Message Generation Date.
      *
     C                     CALL 'ZM0060'               15
     C                     PARM BJRDNB    ZMDAY   50
     C                     PARM           ZSDATE  6
      *
      ** Program ended in error.
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '008'     DBASE              * * * * * * *
     C                     MOVEL'       ' DBKEY              * DBERR 008 *
     C                     MOVEL'ZM0060'  DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     MOVE ZSDATE    MGDE
      ** Set-up Message Generation Century flag                           184718
     C                     MOVELMGDE      YY      20                      184718
     C           YY        IFLT 72                                        184718
     C                     MOVE '2'       CIND                            184718
     C                     ELSE                                           184718
     C                     MOVE '1'       CIND                            184718
     C                     ENDIF                                          184718
      *
      ** Convert history retention date to YYMMDD.
      *
     C           BJRDNB    ADD  ENDSMN    ZMDAY
     C                     CALL 'ZM0060'               15
     C                     PARM           ZMDAY
     C                     PARM           ZSDATE
      *
      ** If the program ends in error.
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '009'     DBASE              * * * * * * *
     C                     MOVEL'       ' DBKEY              * DBERR 009 *
     C                     MOVEL'ZM0060'  DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     MOVE ZSDATE    @HRDT   6
      *
      ** Access Switchable features file to see if ConCord is switched
      ** ON.
      *
     C                     CALL 'AOSARDR0'
     C                     PARM '       ' RTCDA   7
     C                     PARM '*VERIFY' RTCDB   7
     C                     PARM 'CCF001'  RTCDC   6
      *
     C           RTCDA     IFEQ *BLANK
     C                     MOVE *ON       *IN27
     C                     END
      *                                                                   CCF003
      ** Access Switchable features file to see if CCF003 is switched     CCF003
      ** ON.                                                              CCF003
      *                                                                   CCF003
     C                     CALL 'AOSARDR0'                                CCF003
     C                     PARM '       ' RTCDA   7                       CCF003
     C                     PARM '*VERIFY' RTCDB   7                       CCF003
     C                     PARM 'CCF003'  RTCDC   6                       CCF003
      *                                                                   CCF003
     C           RTCDA     IFEQ *BLANK                                    CCF003
     C                     MOVE 'Y'       CCF003  1                       CCF003
     C                     ELSE                                           CCF003
     C                     MOVE 'N'       CCF003                          CCF003
     C                     ENDIF                                          CCF003
      *                                                                                       CSW201
      ** Check if Swift 2001 Standards Update is installed                                    CSW201
      *                                                                                       CSW201
     C                     CALL 'SWIF2001'                                                    CSW201
     C                     PARM *BLANKS   RTCDA                                               CSW201
      *                                                                                       CSW201
     C           RTCDA     IFEQ 'CSW2001'                                                     CSW201
     C                     MOVE 'Y'       CSW201  1                                           CSW201
     C                     ELSE                                                               CSW201
     C                     MOVE 'N'       CSW201                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
      ** Access SAR file to determine if Compliance Watch enhancement is installed.           CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   @RTCD                                               CSD015
     C                     PARM '*VERIFY' @OPTN                                               CSD015
     C                     PARM 'CSD015'  @SARD   6                                           CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C                     MOVEL'N'       CSD015  1                                           CSD015
     C                     MOVEL'N'       W1EWLC                                              222385
     C           @RTCD     IFEQ *BLANK                                                        CSD015
     C                     MOVEL'Y'       CSD015  1                                           CSD015
      *                                                                                       222385
      ** Access AOWLCCR0 to check if function code MESSGENT is available                      222385
      *                                                                                       222385
     C                     CALL 'AOWLCCR0'                                                    222385
     C                     PARM *BLANKS   @RTCD                                               222385
     C                     PARM '*KEY'    @OPTN                                               222385
     C                     PARM 'MESSGENT'PFUNC   8                                           222385
     C           SDWLCC    PARM SDWLCC    DSFDY                                               222385
      *                                                                                       222385
     C           @RTCD     IFNE *BLANKS                                                       222385
     C           @RTCD     ANDNE'*NRF'                                                        222385
     C                     MOVEL'SDWLCCPD'DBFILE                                              222385
     C                     MOVELPFUNC     DBKEY                                               222385
     C                     Z-ADD32        DBASE                                               222385
     C                     EXSR *PSSR                                                         222385
     C                     ENDIF                                                              222385
      *                                                                                       222385
     C                     ELSE                                                               CSD015
     C           @RTCD     IFNE '*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'CSD015'  DBKEY                                               CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     Z-ADD42        DBASE                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Access SAR details file to determine if Midas Message Manager                        CSD015
      ** (CSW025) is installed                                                                CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CSW025  1                                           CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   @RTCD                                               CSD015
     C                     PARM '*VERIFY' @OPTN                                               CSD015
     C                     PARM 'CSW025'  @SARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           @RTCD     IFNE *BLANKS                                                       CSD015
     C           @RTCD     ANDNE'*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     Z-ADD43        DBASE                                               CSD015
     C                     MOVEL'CSW025'  DBKEY                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
     C           @RTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSW025                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Access Switchable features file if CSW024 is installed.                              CSW208
      *                                                                                       CSW208
     C                     CALL 'AOSARDR0'                                                    CSW208
     C                     PARM *BLANKS   RTCDA                                               CSW208
     C                     PARM '*VERIFY' RTCDB                                               CSW208
     C                     PARM 'CSW024'  RTCDC                                               CSW208
     C           SCSARD    PARM SCSARD    DSFDY                                               CSW208
      *                                                                                       CSW208
     C           RTCDA     IFEQ *BLANK                                                        CSW208
     C                     MOVE 'Y'       CSW024  1                                           CSW208
     C                     ELSE                                                               CSW208
     C                     MOVE 'N'       CSW024                                              CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
      ** Access Switchable features file if CSW037 is installed.                              CSW208
      *                                                                                       CSW208
     C                     CALL 'AOSARDR0'                                                    CSW208
     C                     PARM *BLANKS   RTCDA                                               CSW208
     C                     PARM '*VERIFY' RTCDB                                               CSW208
     C                     PARM 'CSW037'  RTCDC                                               CSW208
     C           SCSARD    PARM SCSARD    DSFDY                                               CSW208
      *                                                                                       CSW208
     C           RTCDA     IFEQ *BLANK                                                        CSW208
     C                     MOVE 'Y'       CSW037  1                                           CSW208
     C                     ELSE                                                               CSW208
     C                     MOVE 'N'       CSW037                                              CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
      ** Access Switchable Features file for CSW208                                           CSW208
      *                                                                                       CSW208
     C                     CALL 'SWIF2008'                                                    CSW208
     C                     PARM *BLANKS   @RTCD                                               CSW208
      *                                                                                       CSW208
     C           @RTCD     IFEQ 'CSW2008'                                                     CSW208
     C                     MOVE 'Y'       CSW208  1                                           CSW208
     C                     ELSE                                                               CSW208
     C                     MOVE 'N'       CSW208                                              CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C/COPY WNCPYSRC,MG0362C002
      *
     C                     MOVE *BLANKS   ACLINE 35                                           CSW097
      *                                                                                       CSW097
      ** Define KFLDs to access MGY36NPD                                                      CSW097
     C           MGYKY1    KLIST                                                              CSW097
     C                     KFLD           @MGSEQ                                              CSW097
     C                     KFLD           @MGMSQ                                              CSW097
      *                                                                                       CSW097
      ** Define KFLDs to access MGX36NPD                                                      CSW097
     C           MGXKY1    KLIST                                                              CSW097
     C                     KFLD           @MGSEQ                                              CSW097
     C                     KFLD           @MSTYP  3                                           CSW097
     C                     MOVE *BLANK    @MSTYP                                              CSW097
      *                                                                                       CSW097
     C           *LIKE     DEFN MGSEQN    @MGSEQ                                              CSW097
     C           *LIKE     DEFN MGMSSQ    @MGMSQ                                              CSW097
      *                                                                                       CSW097
     C           @SEQN     KLIST                                                              CSW097
     C                     KFLD           @MGSEQ                                              CSW097
     C                     KFLD           @MGMSQ                                              CSW097
      *                                                                                       CSW201
      ** Define key list to access MGY36NL1                                                   CSW201
      *                                                                                       CSW201
     C           KY36N1    KLIST                                                              CSW201
     C                     KFLD           @MGSEQ                                              CSW201
     C                     KFLD           WFEVTP                                              CSW201
     C                     KFLD           WFPDAT                                              CSW201
     C                     KFLD           @MGMSQ                                              CSW201
      *                                                                                       CSW201
      ** Define key list to access MGY36NL1, (partial key)                                    CSW201
      *                                                                                       CSW201
     C           KY36N2    KLIST                                                              CSW201
     C                     KFLD           @MGSEQ                                              CSW201
     C                     KFLD           WFEVTP                                              CSW201
      *                                                                                       CSW201
      ** Define key list to access MGHISTL1                                                   CSW201
      *                                                                                       CSW201
     C           KHIST1    KLIST                                                              CSW201
     C                     KFLD           WMODI                                               CSW201
     C                     KFLD           WTRAN                                               CSW201
     C                     KFLD           WMTPY                                               CSW201
     C                     KFLD           WFPDAT                                              CSW201
     C                     KFLD           WFMSSQ                                              CSW201
     C                     KFLD           WFEVTP                                              CSW201
      *                                                                                       CSW201
      ** Define key list to access MGHISTL2                                                   CSW201
      *                                                                                       CSW201
     C           KHIST2    KLIST                                                              CSW201
     C                     KFLD           WHFTRN                                              CSW201
     C                     KFLD           WHTRAN                                              CSW201
     C                     KFLD           WHSEQ                                               CSW201
     C                     KFLD           Y1PDAT                                              CSW201
     C                     KFLD           Y1MSSQ                                              CSW201
      *                                                                                       CSW201
      ** Initialise work variables                                                            CSW201
      *                                                                                       CSW201
     C                     Z-ADD*ZEROS    WX      20                                          CSW201
     C                     MOVE *BLANKS   WHTRNO 16                                           CSW201
     C                     MOVE 'FI'      WMODI   2                                           CSW201
     C                     MOVE '362'     WMTPY   3                                           CSW201
     C                     MOVE 'N'       WPROC   1                                           CSW201
     C                     MOVE *BLANKS   WFTRN  16                                           CSW201
     C                     Z-ADD*ZEROS    WJ      30                                          CSW201
     C                     Z-ADD*ZEROS    WF      30                                          CSW201
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   INTF - Initalise non-constant fields                        *
      *   Called by - main process                                    *
      *****************************************************************
      *
     C           INTF      BEGSR
      *
     C***********          MOVE *BLANKS   AWBA6   6                                           CSW097
     C***********          MOVELMGAWBA    AWBA6   6                                           CSW097
     C                     MOVE *BLANKS   TRNO
     C                     MOVE *BLANKS   @TRNA
     C                     MOVE '      '  NWRK
     C**********           Z-ADD0         SECN                                                CSD027
     C                     MOVE *BLANKS   SECN                                                CSD027
     C                     MOVE *BLANKS   NWSN
     C**********           Z-ADD0         DECN                                                CSD027
     C                     MOVE *BLANKS   DECN                                                CSD027
     C                     MOVE *BLANKS   NWDS
     C                     MOVE *BLANKS   MGSG
     C                     MOVE *BLANKS   MGST
     C                     MOVE *BLANKS   LSCC
     C                     MOVE *BLANK    F57U
     C                     MOVE *BLANKS   CWRD
     C                     Z-ADD0         MGTM
     C                     Z-ADD0         LATM
     C                     MOVE *BLANKS   RELD
     C                     Z-ADD0         RELT
     C                     MOVE *BLANKS   AMTS
     C                     MOVE *BLANKS   SVDT
     C                     MOVE *BLANKS   CINDV                           184718
      *
     C                     MOVE *BLANKS   @ERR    1
     C                     MOVE *BLANKS   SCSID  12
     C                     MOVE *BLANKS   STELX  10
     C                     MOVE *BLANKS   SSTTX  12
     C                     MOVE *BLANKS   SCRNM  20
     C                     MOVE *BLANKS   SPCNB   6
     C                     MOVE *BLANKS   SPAIN   1
      *
      **  Currently positioned at line 1 of Field :72:
      *
     C                     MOVE 'N'       LINE2   1
      *
      **  Clear multiple occurrence data structure
      *
     C**********           Z-ADD1         X       20                                          189455
     C                     Z-ADD1         X       30                                          189455
     C           X         OCUR MULT
      *
     C***********X         DOWLE40                                        171312
     C           X         DOWLE200                                       171312
     C           MULT      ANDNE*BLANKS
     C                     MOVE *BLANKS   MULT
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     ENDDO
      *
      **  Obtain sequence numbers from transaction record
      *
     C                     CALL 'MG5000'               26
     C                     PARM MGMODI    @MODI   2
     C                     PARM MGTNUM    @TRAN  15
     C                     PARM 'CF'      @PROG   2
     C                     PARM *BLANKS   @MODE   1
     C                     PARM *ZEROS    MGLSWC  30
     C                     PARM *ZEROS    MGLSWS  30
     C                     PARM *BLANKS   @ERCD   1
      *
      **  Error on access for sequence number
      *
     C           @ERCD     IFEQ 'Y'
     C           *LOCK     IN   LDA
     C                     MOVE '010'     DBASE            * * * * * * * *
     C                     MOVELMODI      DBKEY            *  DBERR 010  *
     C                     MOVE MTRN      DBKEY            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Program missing on call.
      *
     C           *IN26     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '011'     DBASE            * * * * * * * *
     C                     MOVE 'MG5000'  DBKEY            *  DBERR 011  *
     C                     OUT  LDA                        * * * * * * * *
     C                     EXSR *PSSR
     C                     END
     C           *LOCK     IN   LDA
     C                     MOVEL'MG0362  'DBPGM
     C                     OUT  LDA
      *
      * If the branch code on the file MGF362PD is blank,
      * then defualt it to the branch code on the SDBRCHPD.
      *
     C           MGBRCA    IFEQ *BLANK
     C                     MOVELA8BRCD    MGBRCA
     C                     END
      *
      ** If our receive branch is blank then default it to the
      ** branch code.
      *
     C           MGROBR    IFEQ *BLANK
     C                     MOVELMGBRCA    MGROBR
     C                     END
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   SRROUT - determine message routing                          *
      *   Called by - main process                                    *
      *   Calls - MG9900 (Midas MG Standard routing API)              *
      *****************************************************************
      *
     C           SRROUT    BEGSR
      *
     C                     MOVE MGBRCA    I@SNBR
     C                     MOVE *BLANKS   I@DSCN
     C                     MOVE MGCNUM    I@DSCN
     C                     MOVE '362'     I@MTPY
     C                     MOVE 'Y'       I@CONC
     C                     Z-ADD0         I@SETT
     C                     MOVE *BLANK    I@FTCS
     C                     MOVE MGMODI    I@MMOD
      *
      * Add copy sources for enhancement methodology
      * one copy source for all MG generation programs and one
      * specific
      *
      * General
     C/COPY WNCPYSRC,MG9900CALL
      *
     C*********************CALL 'MG9900'                                                      CSW036
     C                     CALL 'MG9901'                                                      CSW036
     C                     PARM *BLANKS   @RTCD
     C                     PARM           P@IN
     C                     PARM *BLANKS   P@OUT
     C                     PARM           P@ZZ  256
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '019'     DBASE              * * * * * * *
     C                     MOVEL'*CALL  ' DBKEY              * DBERR 019 *
     C*********************MOVEL'MG9900'  DBFILE             * * * * * * *                    CSW036
     C                     MOVEL'MG9901'  DBFILE             * * * * * * *                    CSW036
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ELSE
     C                     MOVE O@NWRK    NWRK
     C**********           Z-ADDO@CNSN    SECN                                                CSD027
     C                     MOVE O@CNSN    SECN                                                CSD027
     C                     MOVE O@NWSN    NWSN
     C**********           Z-ADDMGCNUM    DECN                                                CSD027
     C                     MOVE MGCNUM    DECN                                                CSD027
     C                     MOVE O@NWDS    NWDS
     C                     MOVE O@MGSG    MGSG
     C                     MOVE O@MGST    MGST
     C                     MOVE O@PCNB    SPCNB
     C                     MOVE O@PAIN    SPAIN
     C                     END
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   FMTA - Format Sequence A MT362 fields for output.           *
      *   Called by - main process                                    *
      *   Calls -     FLD72 format field 72                           *
      *****************************************************************
      *
     C           FMTA      BEGSR
      *
      ** Field :15A:
      *
     C**********           Z-ADD1         X       20                                          189455
     C                     Z-ADD1         X                                                   189455
     C           X         OCUR MULT
     C                     MOVE *BLANKS   MFLD
     C                     MOVEL':15A:'   MTAG
      *
      ** Field :20: -  Transaction Reference Number.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVEA*BLANKS   @WRK
      *
     C                     Z-ADD1         Z       20
     C                     MOVEAMGMODI    @WRK
     C                     MOVEAMGTNUM    @WRK,3
     C           MGLSWS    ADD  1         HLSWS   30
     C                     MOVE HLSWS     HSWS    3
      *
     C           ' '       LOKUP@WRK,Z                   31
     C                     MOVEAHSWS      @WRK,Z
      *
      **  Check on MGREFPD for a uniqne TRN,else output as an error.
      **  and store the TRN of the new confirmation message.
      *
     C                     MOVEA@WRK      @TRNA  16
      *
     C           @TRNA     CHAINMGREFL0              11
      *
      ** If record is found flag field is in error.
      *
     C           *IN11     IFEQ '0'
     C                     MOVE 'Y'       @ERR
     C                     MOVEAMSGA,8    MERR
     C                     ENDIF
      *
     C                     MOVEL':20:'    MTAG
     C                     MOVEA@WRK      MFLD
      *
      ***Field*:21:*-*Related*Reference.**************************                            CSW097
      ***********                                                                             CSW097
     C***********          ADD  1         X                                                   CSW097
     C***********X         OCUR MULT                                                          CSW097
     C***********          MOVEA*BLANKS   @WRK                                                CSW097
      ***********                                                                             CSW097
     C***********MGCHTP    IFEQ 'A'                                                           CSW097
     C***********          MOVELMGRREF    MFLD                                                CSW097
      ***********                                                                             CSW097
     C***********          ELSE                                                               CSW097
     C***********          MOVEL'FIRST'   MFLD                                                CSW097
      ***********                                                                             CSW097
     C***********          ENDIF                                                              CSW097
      ***********                                                                             CSW097
     C***********          MOVEL':21:'    MTAG                                                CSW097
      ***********                                                                             CSW097
      ***Field*:22:*-*Code/Common*Reference.**************************                        CSW097
      ***********                                                                             CSW097
     C***********          ADD  1         X                                                   CSW097
     C***********X         OCUR MULT                                                          CSW097
     C***********          MOVE *BLANKS   ZCREF                                               CSW097
      ***********                                                                             CSW097
     C***********          MOVE MGMDAT    ZMDAY                                               CSW097
      ***********                                                                             CSW097
      ***Convert*run*date*to*YYMMDD,*for*Message*Generation*Date.*****                        CSW097
      ***********                                                                             CSW097
     C***********          CALL 'ZM0060'               15                                     CSW097
     C***********          PARM           ZMDAY   50                                          CSW097
     C***********          PARM           ZSDATE  6                                           CSW097
      ***********                                                                             CSW097
      ***Program*ended*in*error.**************************************                        CSW097
      ***********                                                                             CSW097
     C************IN15     IFEQ '1'                                                           CSW097
     C************LOCK     IN   LDA                                                           CSW097
     C***********          MOVE '014'     DBASE              * * * * * * *                    CSW097
     C***********          MOVEL'       ' DBKEY              * DBERR 014 *                    CSW097
     C***********          MOVEL'ZM0060'  DBFILE             * * * * * * *                    CSW097
     C***********          OUT  LDA                                                           CSW097
     C***********          EXSR *PSSR                                                         CSW097
     C***********          END                                                                CSW097
      ***********                                                                             CSW097
      ***Use*YYMM*portion*of*the*formatted*maturity*date.*************                        CSW097
      ***********                                                                             CSW097
     C***********          MOVELZSDATE    YYMMDD  6                                           CSW097
     C***********          MOVELYYMMDD    YYMM    4                                           CSW097
     C***********          MOVE YYMM      ZRATE                                               CSW097
      ***********                                                                             CSW097
      ***If*SWIFT*network,*use*sender*&*destination*customer*swift*ad.                        CSW097
      ***and*the*exchange*rate*to*produce*the*common*reference.*Else**                        CSW097
      ***use*the*message*TRN.*****************************************                        CSW097
      ***********                                                                             CSW097
     C***********NWRK      IFEQ 'SWIFT'                                                       CSW097
     C***********NWRK      OREQ 'STTX'                                                        CSW097
      ***********                                                                             CSW097
     C***********NWRK      IFEQ 'SWIFT'                                                       CSW097
     C***********          MOVELNWSN      ZSSWI                                               CSW097
     C***********          MOVELNWDS      ZDSWI                                               CSW097
     C***********          ELSE                                                               CSW097
     C***********          MOVELSCSID     ZSSWI                                               CSW097
     C***********          MOVELCSID      ZDSWI                                               CSW097
     C***********          END                                                                CSW097
      ***********                                                                             CSW097
      ***Format*SWIFT*common*reference.*******************************                        CSW097
      ***********                                                                             CSW097
     C***********          CALL 'ZM0020'               15                                     CSW097
     C***********          PARM           ZSSWI  12                                           CSW097
     C***********          PARM           ZDSWI  12                                           CSW097
     C***********          PARM           ZRATE  138                                          CSW097
     C***********          PARM           ZCREF  16                                           CSW097
      ***********                                                                             CSW097
      ***If*the*program*ends*in*error.********************************                        CSW097
      ***********                                                                             CSW097
     C************IN15     IFEQ '1'                                                           CSW097
     C************LOCK     IN   LDA                                                           CSW097
     C***********          MOVE '015'     DBASE              * * * * * * *                    CSW097
     C***********          MOVEL'       ' DBKEY              * DBERR 015 *                    CSW097
     C***********          MOVEL'ZM0020'  DBFILE             * * * * * * *                    CSW097
     C***********          OUT  LDA                                                           CSW097
     C***********          EXSR *PSSR                                                         CSW097
     C***********          END                                                                CSW097
     C***********          END                                                                CSW097
      ***********                                                                             CSW097
     C***********ZCREF     IFEQ *BLANKS                                                       CSW097
     C***********          MOVEL@TRNA     ZCREF                                               CSW097
     C***********          END                                                                CSW097
      ***********                                                                             CSW097
     C***********          MOVEL':22:'    MTAG                                                CSW097
      ***********                                                                             CSW097
      ***Construct*Field*22*-*'codeword/common*reference'.*******                             CSW097
      ***********                                                                             CSW097
      ***If*last*change*type*is*'A',*then*set*codeword*to*'AMEND'.                            CSW097
      ***********                                                                             CSW097
     C***********MGCHTP    IFEQ 'A'                                                           CSW097
     C***********          MOVEL'AMEND   'CWRD                                                CSW097
     C***********          ELSE                                                               CSW097
      ***********                                                                             CSW097
      ***If*'our'*or*'their'*pay*date*is*not*zero,***************                             CSW097
      ***then*set*codeword*to*'ADVICE'.**************************                             CSW097
      ***********                                                                             CSW097
     C***********MGOPDT    IFNE 0                                                             CSW097
     C***********MGODCF    ANDEQ*BLANKS                                                       CSW097
     C***********MGTPDT    ORNE 0                                                             CSW097
     C***********MGTDCF    ANDEQ*BLANKS                                                       CSW097
     C***********          MOVEL'ADVICE  'CWRD                                                CSW097
     C***********          ELSE                                                               CSW097
      ***********                                                                             CSW097
      ***Check*if*'our'*or*'their'*daycount*fraction*is*not*blank.                            CSW097
      ***********                                                                             CSW097
     C***********MGODCF    IFNE *BLANKS                                                       CSW097
     C***********MGTDCF    ORNE *BLANKS                                                       CSW097
      ***********                                                                             CSW097
      ***If*'our'*or*'their'*next*rate*change*date*=*maturity*date                            CSW097
      ***then*set*codeword*to*'FINRESET'.************************                             CSW097
      ***********                                                                             CSW097
     C***********MGONRD    IFEQ MGMDAT                                                        CSW097
     C***********MGTNRD    OREQ MGMDAT                                                        CSW097
      ***********                                                                             CSW097
     C***********          MOVEL'FINRESET'CWRD                                                CSW097
      ***********                                                                             CSW097
      ***otherwise,*set*codeword*to*'RESET'.*********************                             CSW097
      ***********                                                                             CSW097
     C***********          ELSE                                                               CSW097
     C***********          MOVEL'RESET   'CWRD                                                CSW097
      ***********                                                                             CSW097
     C***********          ENDIF                                                              CSW097
      ***********                                                                             CSW097
     C***********          ENDIF                                                              CSW097
     C***********          ENDIF                                                              CSW097
     C***********          ENDIF                                                              CSW097
      ***********                                                                             CSW097
     C***********          Z-ADD1         I       20                                          CSW097
     C***********          MOVEA*BLANKS   @WRK                                                CSW097
     C***********          MOVEACWRD      @WRK,I                                              CSW097
     C***********' '       LOKUP@WRK,I                   31                                   CSW097
      ***********                                                                             CSW097
     C***********          MOVEA'/'       @WRK,I                                              CSW097
     C***********          ADD  1         I                                                   CSW097
     C***********          MOVEAZCREF     @WRK,I                                              CSW097
     C***********          MOVEA@WRK      MFLD                                                CSW097
      ***********                                                                             CSW097
      ***Codeword*blank.*****************************************                             CSW097
      ***********                                                                             CSW097
     C***********CWRD      IFEQ *BLANKS                                                       CSW097
     C***********          MOVE 'Y'       @ERR                                                CSW097
     C***********          MOVEAMSGA,7    MERR                                                CSW097
     C***********          END                                                                CSW097
      *                                                                                       CSW201
      ** Setup payment date                                                                   CSW201
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
      *                                                                                       CSW201
      ** Initialise work variables.                                                           CSW201
      *                                                                                       CSW201
     C           *LOVAL    SETLLMGY36N1                                                       CSW201
     C                     READ MGY36N1                  80                                   CSW201
     C           *IN80     IFEQ *OFF                                                          CSW201
     C                     Z-ADDY1PDAT    WFPDAT  50                                          CSW201
     C                     MOVE Y1MSSQ    WFMSSQ  1                                           CSW201
     C                     MOVE Y1EVTP    WFEVTP  2                                           CSW201
     C                     ELSE                                                               CSW201
     C                     Z-ADD*ZEROS    WFPDAT                                              CSW201
     C                     MOVE *BLANKS   WFMSSQ                                              CSW201
     C                     MOVE *BLANKS   WFEVTP                                              CSW201
     C                     ENDIF                                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW097
      ** Field :21: - Related Reference.                                                      CSW097
      *                                                                                       CSW097
     C                     MOVEA*BLANKS   @WRK                                                CSW097
      *                                                                                       CSW097
     C           MGCHTP    IFEQ 'A'                                                           CSW097
      *                                                                                       CSW201
      ** If Swift 2001 is on, set Related Reference field equal to the                        CSW201
      ** Transaction number in the History file                                               CSW201
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
      *                                                                                       CSW201
     C           WFPDAT    IFNE *ZERO                                                         CSW201
     C           KHIST1    SETGTMGHIST1                                                       CSW201
     C                     READPMGHIST1                  80                                   CSW201
     C           *IN80     IFEQ *OFF                                                          CSW201
     C           WMODI     ANDEQM1MODI                                                        CSW201
     C           WTRAN     ANDEQM1TRAN                                                        CSW201
     C           WMTPY     ANDEQM1MTPY                                                        CSW201
     C           WFPDAT    ANDEQM1PDAT                                                        CSW201
     C           WFMSSQ    ANDEQM1MSSQ                                                        CSW201
     C           WFEVTP    ANDEQM1EVTP                                                        CSW201
     C                     MOVE *BLANKS   WHTRNO                                              CSW201
     C           M1MODI    CAT  M1TRAN    WCHR08  8                                           CSW201
     C           WCHR08    CAT  M1SEQ:0   WHTRNO                                              CSW201
     C                     MOVELM1FTRN    WHFTRN 16                                           CSW201
     C                     MOVELM1TRAN    WHTRAN  6                                           CSW201
     C                     MOVELM1SEQ     WHSEQ   3                                           CSW201
     C                     ADD  1         WX                                                  CSW201
     C                     MOVELWHTRNO    TRN,WX                                              CSW201
     C           M1FTRN    LOKUPFTN                      31                                   CSW201
     C           *IN31     IFEQ *OFF                                                          CSW201
     C                     ADD  1         WF                                                  CSW201
     C                     MOVELM1FTRN    FTN,WF                                              CSW201
     C                     ENDIF                                                              CSW201
     C                     ELSE                                                               CSW201
     C                     MOVE *BLANKS   WHTRNO                                              CSW201
     C                     MOVE *BLANKS   WHFTRN                                              CSW201
     C                     MOVE *BLANKS   WHTRAN                                              CSW201
     C                     MOVE *BLANKS   WHSEQ                                               CSW201
     C                     ENDIF                                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C           WHTRNO    IFNE *BLANKS                                                       CSW201
     C                     ADD  1         X                                                   CSW201
     C           X         OCUR MULT                                                          CSW201
     C                     MOVEL':21:'    MTAG                                                CSW201
     C                     MOVELWHTRNO    MFLD                                                CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
      ** Otherwise if Swift 2001 is off, do normal processing                                 CSW201
      *                                                                                       CSW201
     C                     ELSE                                                               CSW201
      *                                                                                       CSW097
     C                     ADD  1         X                                                   CSW097
     C           X         OCUR MULT                                                          CSW097
     C                     MOVELMGRREF    MFLD                                                CSW097
      *
      **  Obtain transaction reference of previous MT362                                      190127
     C                     MOVELMGTNUM    HSTRAN                                              190127
     C                     MOVE '362'     HSMTPY                                              190127
      *                                                                                       190127
     C                     MOVE HSTRAN    @HTRN   6                                           190127
      *                                                                                       190127
     C           HSKEY     SETGTMGHISTL0                                                      190127
     C                     READPMGHISTL0                 56                                   190127
      *                                                                                       190127
     C           *IN56     IFEQ '0'                                                           190127
     C           HSMODI    ANDEQMGMODI                                                        190127
     C           HSTRAN    ANDEQ@HTRN                                                         190127
     C           HSMTPY    ANDEQ'362'                                                         190127
     C                     MOVEL@HREF     MFLD                                                190127
     C                     END                                                                190127
      *                                                                                       190127
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C           CSW201    IFEQ 'N'                                                           CSW201
     C           WHTRNO    ORNE *BLANKS                                                       CSW201
     C                     MOVEL':21:'    MTAG                                                CSW097
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     ENDIF                                                              CSW097
      *                                                                                       CSW097
      ** Construct Field 22A - Type of Operations.                                            CSW097
      *                                                                                       CSW097
     C                     ADD  1         X                                                   CSW097
     C           X         OCUR MULT                                                          CSW097
     C           MGCHTP    IFNE 'A'                                                           CSW097
     C                     MOVEL'NEWT'    MFLD                                                CSW097
     C                     ELSE                                                               CSW097
     C                     MOVEL'AMND'    MFLD                                                CSW097
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C           WHTRNO    ANDEQ*BLANKS                                                       CSW201
     C                     MOVEL'NEWT'    MFLD                                                CSW201
     C                     ENDIF                                                              CSW201
     C                     ENDIF                                                              CSW097
     C                     MOVEL':22A:'   MTAG                                                CSW097
      *                                                                                       CSW097
      ** Construct Field 22B - Type of Event.                                                 CSW097
      ** (only if Swift 2001 is off)                                                          CSW201
      *                                                                                       CSW097
     C           CSW201    IFEQ 'N'                                                           CSW201
     C                     ADD  1         X                                                   CSW097
     C           X         OCUR MULT                                                          CSW097
     C                     MOVEL'RSET'    MFLD                                                CSW097
     C                     MOVEL':22B:'   MTAG                                                CSW097
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW097
      ** Construct Field 22C - Common Reference                                               CSW097
      *                                                                                       CSW097
     C                     ADD  1         X                                                   CSW097
     C           X         OCUR MULT                                                          CSW097
     C                     MOVE *BLANKS   ZCREF                                               CSW097
      *                                                                                       CSW097
     C                     MOVE MGMDAT    ZMDAY                                               CSW097
      *                                                                                       CSW097
      ** Convert run date to YYMMDD, for Message Generation Date.                             CSW097
      *                                                                                       CSW097
     C                     CALL 'ZM0065'               15                                     CSW097
     C                     PARM           ZMDAY   50                                          CSW097
     C                     PARM           ZSDATE  6                                           CSW097
     C                     PARM           ZSDATC  8                                           CSW097
      *                                                                                       CSW097
      ** Program ended in error.                                                              CSW097
      *                                                                                       CSW097
     C           *IN15     IFEQ '1'                                                           CSW097
     C           *LOCK     IN   LDA                                                           CSW097
     C                     MOVE '014'     DBASE              * * * * * * *                    CSW097
     C                     MOVEL'       ' DBKEY              * DBERR 014 *                    CSW097
     C                     MOVEL'ZM0065'  DBFILE                                              CSW097
     C                     OUT  LDA                                                           CSW097
     C                     EXSR *PSSR                                                         CSW097
     C                     END                                                                CSW097
      *                                                                                       CSW097
      ** Use YYMM portion of the formatted maturity date.                                     CSW097
      *                                                                                       CSW097
     C                     MOVELZSDATE    YYMMDD  6                                           CSW097
     C                     MOVELZSDATC    CYMD    8                                           CSW097
     C                     MOVELYYMMDD    YYMM    4                                           CSW097
     C                     MOVE YYMM      ZRATE                                               CSW097
      *                                                                                       CSW097
      ** If SWIFT network, use sender & destination customer swift ad.                        CSW097
      ** and the exchange rate to produce the common reference. Else                          CSW097
      ** use the message TRN.                                                                 CSW097
      *                                                                                       CSW097
     C           NWRK      IFEQ 'SWIFT'                                                       CSW097
     C           NWRK      OREQ 'STTX'                                                        CSW097
      *                                                                                       CSW097
     C           NWRK      IFEQ 'SWIFT'                                                       CSW097
     C                     MOVELNWSN      ZSSWI                                               CSW097
     C                     MOVELNWDS      ZDSWI                                               CSW097
     C                     ELSE                                                               CSW097
     C                     MOVELSCSID     ZSSWI                                               CSW097
     C                     MOVELCSID      ZDSWI                                               CSW097
     C                     END                                                                CSW097
      *                                                                                       CSW097
      ** Format SWIFT common reference.                                                       CSW097
      *                                                                                       CSW097
     C                     CALL 'ZM0020'               15                                     CSW097
     C                     PARM           ZSSWI  12                                           CSW097
     C                     PARM           ZDSWI  12                                           CSW097
     C                     PARM           ZRATE  138                                          CSW097
     C                     PARM           ZCREF  16                                           CSW097
      *                                                                                       CSW097
      ** If the program ends in error.                                                        CSW097
      *                                                                                       CSW097
     C           *IN15     IFEQ '1'                                                           CSW097
     C           *LOCK     IN   LDA                                                           CSW097
     C                     MOVE '015'     DBASE              * * * * * * *                    CSW097
     C                     MOVEL'       ' DBKEY              * DBERR 015 *                    CSW097
     C                     MOVEL'ZM0020'  DBFILE             * * * * * * *                    CSW097
     C                     OUT  LDA                                                           CSW097
     C                     EXSR *PSSR                                                         CSW097
     C                     END                                                                CSW097
     C                     END                                                                CSW097
      *                                                                                       CSW097
     C           ZCREF     IFEQ *BLANKS                                                       CSW097
     C                     MOVEL@TRNA     ZCREF                                               CSW097
     C                     ELSE                                           177594
     C                     MOVELZCREF     WRK10L 10                       177594
     C                     MOVE YYMM      WRK10L                          177594
     C                     MOVELWRK10L    ZCREF                           177594
     C                     END                                                                CSW097
      *                                                                                       CSW097
     C                     MOVEL':22C:'   MTAG                                                CSW097
     C                     MOVELZCREF     MFLD                                                CSW097
      *                                                                                       CSW097
      ** Construct Field 23A - Identification of Swap.                                        CSW097
      *                                                                                       CSW097
     C                     ADD  1         X                                                   CSW097
     C           X         OCUR MULT                                                          CSW097
     C                     MOVELMGFUID    MFLD                                                CSW097
     C           MGTTYP    IFEQ 'RS'                                                          CSW097
     C           MFLD      CAT  '/':0     MFLD                                                CSW097
     C           MFLD      CAT  'NET':0   MFLD                                                CSW097
     C                     ELSE                                                               CSW097
     C           MGTTYP    IFEQ 'RX'                                                          CSW097
     C           MFLD      CAT  '/':0     MFLD                                                CSW097
     C           MFLD      CAT  'GROSS':0 MFLD                                                CSW097
     C                     ENDIF                                                              CSW097
     C                     ENDIF                                                              CSW097
     C                     MOVEL':23A:'   MTAG                                                CSW097
      *                                                                                       CSW097
      ** Construct Field 21N - Contract Number - Party A.                                     CSW097
      *                                                                                       CSW097
     C                     ADD  1         X                                                   CSW097
     C           X         OCUR MULT                                                          CSW097
     C                     MOVELMGTNUM    MFLD                                                CSW097
     C                     MOVEL':21N:'   MTAG                                                CSW097
      *                                                                                       CSW097
      ***Format*field*:31L:*using*the*start*date.****************                             CSW097
      ** Format field :30V: using the effective date.                                         CSW097
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE MGTSDT    ZMDAY
      *
      ** Convert run date to YYMMDD, for Message Generation Date.
      *
     C***********          CALL 'ZM0060'               15                                     CSW097
     C                     CALL 'ZM0065'               15                                     CSW097
     C                     PARM           ZMDAY   50
     C                     PARM           ZSDATE  6
     C                     PARM           ZSDATC  8                                           CSW097
      *                                                                                       CSW097
      ** Program ended in error.                                                              CSW097
      *                                                                                       CSW097
     C           *IN15     IFEQ '1'                                                           CSW097
     C           *LOCK     IN   LDA                                                           CSW097
     C                     MOVE '021'     DBASE              * * * * * * *                    CSW097
     C                     MOVEL'       ' DBKEY              * DBERR 021 *                    CSW097
     C                     MOVEL'ZM0065'  DBFILE             * * * * * * *                    CSW097
     C                     OUT  LDA                                                           CSW097
     C                     EXSR *PSSR                                                         CSW097
     C                     END                                                                CSW097
      *
     C***********          MOVELZSDATE    MFLD                                                CSW097
     C***********          MOVEL':31L:'   MTAG                                                CSW097
     C                     MOVELZSDATC    MFLD                                                CSW097
     C                     MOVEL':30V:'   MTAG                                                CSW097
      *
      ***Format*field*:31C:*using*the*maturity*date.*************                             CSW097
      ** Format field :30P: using the termination date.                                       CSW097
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C***********          MOVELYYMMDD    MFLD                                                CSW097
     C***********          MOVEL':31C:'   MTAG                                                CSW097
     C                     MOVELCYMD      MFLD                                                CSW097
     C                     MOVEL':30P:'   MTAG                                                CSW097
      *                                                                                       CSW097
      ** Construct Field 82A - Party A.                                                       CSW097
      *                                                                                       CSW097
     C                     ADD  1         X                                                   CSW097
     C           X         OCUR MULT                                                          CSW097
     C                     MOVE *BLANKS   ZDEST                                               CSW097
     C                     MOVE *BLANKS   ACLINE                                              CSW097
      *                                                                                       CSW097
     C**********           CALL 'AOBRCHR0'                                             CSW097 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD                                               CSW097
     C                     PARM '*KEY   ' @OPTN                                               CSW097
     C                     PARM MGBRCA    @BRCD   3                                           CSW097
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CSW097
      *                                                                                       CSW097
      ** Branch record not found - Error                                                      CSW097
      *                                                                                       CSW097
     C           @RTCD     IFNE *BLANKS                                                       CSW097
     C           *LOCK     IN   LDA                                                           CSW097
     C                     MOVE '016'     DBASE              * * * * * * *                    CSW097
     C                     MOVELMGBRCA    DBKEY              * DBERR 016 *                    CSW097
     C                     MOVEL'SDBRCHPD'DBFILE             * * * * * * *                    CSW097
     C                     OUT  LDA                                                           CSW097
     C                     EXSR *PSSR                                                         CSW097
     C                     END                                                                CSW097
      *                                                                                       CSW097
     C                     MOVELA8BICN    ZDEST                                               CSW097
     C                     MOVE 'A'       TAG                                                 CSW097
     C                     MOVE '82'      FLDNO                                               CSW097
     C                     EXSR FSWAD                                                         CSW097
      *                                                                                       CSW097
      ** Construct Field 87A - Party B.                                                       CSW097
      *                                                                                       CSW097
     C                     ADD  1         X                                                   CSW097
     C           X         OCUR MULT                                                          CSW097
     C                     MOVE *BLANKS   ZDEST                                               CSW097
     C                     MOVE *BLANKS   ACLINE                                              CSW097
     C                     MOVELMGCNUM    ZDEST                                               CSW097
     C                     MOVE 'A'       TAG                                                 CSW097
     C                     MOVE '87'      FLDNO                                               CSW097
     C                     EXSR FSWAD                                                         CSW097
      *
      ** Format field :83J: using the internal customer number                                CSW208
      *                                                                                       CSW208
     C           CSW024    IFEQ 'Y'                                                           CSW208
     C           CSW208    ANDEQ'Y'                                                           CSW208
      *                                                                                       CSW208
     C                     MOVE *BLANKS   @KEY1                                               CSW208
     C                     MOVELMGCNUM    @KEY1                                               CSW208
     C                     CALL 'AOCUSTR1'                                                    CSW208
     C                     PARM *BLANKS   @RTCD                                               CSW208
     C                     PARM '*KEY'    @OPTN                                               CSW208
     C                     PARM           @KEY1                                               CSW208
     C                     PARM           @KYST                                               CSW208
     C           SDCUST    PARM SDCUST    DSLDY                                               CSW208
      *                                                                                       CSW208
     C           @RTCD     IFEQ *BLANKS                                                       CSW208
     C           BBFUND    ANDNE*BLANKS                                                       CSW208
     C                     ADD  1         X                                                   CSW208
     C           X         OCUR MULT                                                          CSW208
     C           '/NAME/'  CAT  BBFUND    MFLD                                                CSW208
     C                     MOVEL':83J:'   MTAG                                                CSW208
      *                                                                                     BUG19661
      ** For R4.4 up and Midasplus releases.                                                BUG19661
      *                                                                                     BUG19661
     C           CSW037    IFEQ 'Y'                                                         BUG19661
     C           BBFNAC    ANDNE*BLANKS                                                     BUG19661
     C                     ADD  1         X                                                 BUG19661
     C           X         OCUR MULT                                                        BUG19661
     C                     MOVE *BLANKS   MFLD                                              BUG19661
     C                     MOVELBBFNAC    MFLD                                              BUG19661
     C                     ENDIF                                                            BUG19661
      *                                                                                       CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
      ** Format field :72:
      *
     C                     EXSR FLD72
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   FMTB - Format Sequence B for output (THEIR)                 *
      *   Called by - main processing                                 *
      *   Calls     - RFXSEQ Common routine for outputtting rate      *
      *                      fixing sequence                          *
      *****************************************************************
      *
     C           FMTB      BEGSR
      *
      ** Output field :15B: as a blank field.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANK    MFLD
     C                     MOVEL':15B:'   MTAG
      *
      ** Set parameters for common routine RFXSEQ.
      *
     C***********          MOVE MGTDCF    @DCF    7                                           CSW097
     C                     MOVE MGTCRD    @CRD    50
     C                     MOVE MGTPDT    @PDT    50
     C                     MOVE MGTCCY    @CCY    3
     C                     MOVE MGTPCL    @PCL   130
     C                     MOVE MGTNRD    @NRD    50
     C                     Z-ADDMGTBAR    @BAR   117
     C                     Z-ADDMGTSPR    @SPR   117
     C                     MOVE MGTTTR    @TTR   117
     C                     MOVE MGTPIA    @IAM   130
     C                     MOVE MGTPAM    @PAM   130
     C                     MOVE 'B'       @SQNCE
      *
      ** Output rate fixing sequence via SR/RFXSEQ.
      *
     C                     EXSR RFXSEQ
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   FMTC - Format Sequence C for output (THEIR)                 *
      *   Called by - main processing                                 *
      *   Calls     - SETSEQ Common routine for outputtting           *
      *                      settlement sequence                      *
      *****************************************************************
      *
     C           FMTC      BEGSR
      *
      ** Output field :15C: as a blank field.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANK    MFLD
     C                     MOVEL':15C:'   MTAG
      *
      ** Set parameters for common routine SETSEQ.
      *
     C***********          MOVE MGTPDT    @PDT    50                                          CSW097
     C                     MOVE MGTCCY    @CCY
DCM  C           MGXKY1    CHAINMGX36NPD             10                                       CSW097
     C           *IN10     IFEQ *OFF                                                          CSW097
DCM  C                     MOVE MGRSCY    WASTCY  3                                           CSW097
     C                     ENDIF                                                              CSW097
     C***********          MOVE MGTIAM    @IAM                                                CSW097
     C                     MOVE 'C'       @SQNCE
      *
      ** Output settlement sequence via SR/SETSEQ.
      *
     C                     EXSR SETSEQ
      *
      ***Format*fields*:56a:*and*:57a:*via*SR/RECV.                                           CSW097
     C***********          EXSR RECV                                                          CSW097
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   FMTD - Format Sequence D for output (OUR)                   *
      *   Called by - main processing                                 *
      *   Calls     - RFXSEQ Common routine for outputtting rate      *
      *                      fixing sequence                          *
      *****************************************************************
      *
     C           FMTD      BEGSR
      *
      ** Output field :15D: as a blank field.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANK    MFLD
     C                     MOVEL':15D:'   MTAG
      *
      ** Set parameters for common routine SETSEQ.
      *
     C***********          MOVE MGODCF    @DCF                                                CSW097
     C                     MOVE MGOCRD    @CRD
     C                     MOVE MGOPDT    @PDT
     C                     MOVE MGOCCY    @CCY
     C                     MOVE MGOPCL    @PCL
     C                     MOVE MGONRD    @NRD
     C                     Z-ADDMGOBAR    @BAR
     C                     Z-ADDMGOSPR    @SPR
     C                     MOVE MGOTTR    @TTR
     C                     MOVE MGOPIA    @IAM
     C                     MOVE MGOPAM    @PAM
     C                     MOVE 'D'       @SQNCE
      *
      ** Output rate fixing sequence via SR/RFXSEQ.
      *
     C                     EXSR RFXSEQ
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   FMTE - Format Sequence E for output (OUR)                   *
      *   Called by - main processing                                 *
      *   Calls     - SETSEQ Common routine for outputtting           *
      *                      settlement sequence                      *
      *****************************************************************
      *
     C           FMTE      BEGSR
      *
      ** Output field :15C: as a blank field.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANK    MFLD
     C                     MOVEL':15E:'   MTAG
      *
      ** Set parameters for common routine SETSEQ.
      *
     C***********          MOVE MGOPDT    @PDT                                                CSW097
     C                     MOVE MGOCCY    @CCY
     C***********          MOVE MGOIAM    @IAM                                                CSW097
     C                     MOVE 'E'       @SQNCE
      *
      ** Output settlement sequence via SR/SETSEQ.
      *
     C                     EXSR SETSEQ
      *
      ***Format*fields*:53:,*:56a:*and*:57a:*via*SR/PAY.                                      CSW097
     C***********          EXSR PAY                                                           CSW097
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   RFXSEQ - Output rate fixing sequence                        *
      *   Called by - FMTB Format Sequence B for output (THEIR)       *
      *               FMTD Format Sequence D for output (OUR)         *
      *****************************************************************
      *
     C           RFXSEQ    BEGSR
      *
      ***Format*field*:14D:*using*daycount*fraction*workfield.                                CSW097
     C***********          ADD  1         X                                                   CSW097
     C***********X         OCUR MULT                                                          CSW097
     C***********          MOVEL':14D:'   MTAG                                                CSW097
     C***********          MOVEL@DCF      MFLD                                                CSW097
      ***********                                                                             CSW097
      ***Format*field*:32A:*using*current*rate*change*date,                                   CSW097
      ***currency*and*principal*amount.                                                       CSW097
     C***********          ADD  1         X                                                   CSW097
     C***********X         OCUR MULT                                                          CSW097
     C***********          MOVE @CRD      ZMDAY                                               CSW097
      ***********                                                                             CSW097
      ***Convert*Midas*date*to*SWIFT*date*format.                                             CSW097
     C***********          CALL 'ZM0060'               15                                     CSW097
     C***********          PARM           ZMDAY   50                                          CSW097
     C***********          PARM           ZSDATE  6                                           CSW097
      ***********                                                                             CSW097
      ***Format*currency*code*and*principal*amount.                                           CSW097
     C***********          MOVE @CCY      ZCCY                                                CSW097
     C***********          MOVE @PCL      ZAMNT                                               CSW097
     C***********          CALL 'ZM0040'                                                      CSW097
     C***********          PARM           ZAMNT  130                                          CSW097
     C***********          PARM           ZCCY    3                                           CSW097
     C***********          PARM           ZSAMNT 15                                           CSW097
     C***********          PARM           ZSCCY   3                                           CSW097
     C***********          PARM           ZERR    1                                           CSW097
      ***********                                                                             CSW097
      ***Error*-*indicate*erroneous*fields;                                                   CSW097
     C***********ZERR      IFEQ '1'                                                           CSW097
     C***********          MOVE 'Y'       @ERR                                                CSW097
     C***********          MOVELERR3N     MFLD                                                CSW097
     C***********          MOVELMSGA,5    MERR                                                CSW097
      ***********                                                                             CSW097
     C***********          ELSE                                                               CSW097
     C***********          MOVELFLD3N     MFLD                                                CSW097
     C***********          ENDIF                                                              CSW097
      ***********                                                                             CSW097
     C***********          MOVEL':32A:'   MTAG                                                CSW097
      ***********                                                                             CSW097
      ***Format*field*:31E:*using*next*rate*change*date.                                      CSW097
     C***********          ADD  1         X                                                   CSW097
     C***********X         OCUR MULT                                                          CSW097
     C***********          MOVE @NRD      ZMDAY                                               CSW097
      ***********                                                                             CSW097
      ***Convert*Midas*date*to*SWIFT*date*format.                                             CSW097
     C***********          CALL 'ZM0060'               15                                     CSW097
     C***********          PARM           ZMDAY   50                                          CSW097
     C***********          PARM           ZSDATE  6                                           CSW097
      ***********                                                                             CSW097
     C***********          MOVELZSDATE    MFLD                                                CSW097
     C***********          MOVEL':31E:'   MTAG                                                CSW097
      ***********                                                                             CSW097
      *                                                                                       CSW097
      ** Format field :33F: Calculation of National Currency & Amount                         CSW097
      *                                                                                       CSW097
     C                     ADD  1         X                                                   CSW097
     C           X         OCUR MULT                                                          CSW097
     C                     MOVE @CCY      ZCCY                                                CSW097
     C                     MOVE @PCL      ZAMNT                                               CSW097
      *                                                                                       CSW097
      ** Format currency code and principal amount.                                           CSW097
      *                                                                                       CSW097
     C                     CALL 'ZM0040'                                                      CSW097
     C                     PARM           ZAMNT  130                                          CSW097
     C                     PARM           ZCCY    3                                           CSW097
     C                     PARM           ZSAMNT 15                                           CSW097
     C                     PARM           ZSCCY   3                                           CSW097
     C                     PARM           ZERR    1                                           CSW097
     C                     PARM           ZSWDPC  1                                           222373
      *                                                                                       CSW097
      ** Error - indicate erroneous fields;                                                   CSW097
      *                                                                                       CSW097
     C           ZERR      IFEQ '1'                                                           CSW097
     C                     MOVE 'Y'       @ERR                                                CSW097
     C                     MOVELERR3N     MFLD                                                CSW097
     C                     MOVELMSGA,5    MERR                                                CSW097
      *                                                                                       CSW097
     C                     ELSE                                                               CSW097
     C                     MOVELZSCCY     @ZCCY                                               CSW097
     C                     MOVELZSAMNT    @ZAMT                                               CSW097
     C                     MOVELFLD2N     MFLD                                                CSW097
     C                     ENDIF                                                              CSW097
      *                                                                                       CSW097
     C                     MOVEL':33F:'   MTAG                                                CSW097
      *                                                                                       CSW097
      ** Format field :30X: - Period Start Date                                               CSW097
      *                                                                                       CSW097
     C                     ADD  1         X                                                   CSW097
     C           X         OCUR MULT                                                          CSW097
     C                     Z-ADD@CRD      ZMDAY                                               CSW097
      *                                                                                       CSW097
      ** Convert Midas date to SWIFT date format.                                             CSW097
      *                                                                                       CSW097
     C                     CALL 'ZM0065'               15                                     CSW097
     C                     PARM           ZMDAY   50                                          CSW097
     C                     PARM           ZSDATE  6                                           CSW097
     C                     PARM           ZSDATC  8                                           CSW097
      *                                                                                       CSW097
      ** Program ended in error.                                                              CSW097
      *                                                                                       CSW097
     C           *IN15     IFEQ '1'                                                           CSW097
     C           *LOCK     IN   LDA                                                           CSW097
     C                     MOVE '022'     DBASE              * * * * * * *                    CSW097
     C                     MOVEL'       ' DBKEY              * DBERR 022 *                    CSW097
     C                     MOVEL'ZM0065'  DBFILE             * * * * * * *                    CSW097
     C                     OUT  LDA                                                           CSW097
     C                     EXSR *PSSR                                                         CSW097
     C                     END                                                                CSW097
      *                                                                                       CSW097
     C                     MOVELZSDATC    MFLD                                                CSW097
     C                     MOVEL':30X:'   MTAG                                                CSW097
      *                                                                                       CSW097
      ** Format field :30Q: - Period End Date                                                 CSW097
      *                                                                                       CSW097
     C                     ADD  1         X                                                   CSW097
     C           X         OCUR MULT                                                          CSW097
     C                     Z-ADD@NRD      ZMDAY                                               CSW097
      *                                                                                       CSW097
      ** Convert Midas date to SWIFT date format.                                             CSW097
      *                                                                                       CSW097
     C                     CALL 'ZM0065'               15                                     CSW097
     C                     PARM           ZMDAY   50                                          CSW097
     C                     PARM           ZSDATE  6                                           CSW097
     C                     PARM           ZSDATC  8                                           CSW097
      *                                                                                       CSW097
      ** ZM0065 - ended in error.                                                             CSW097
      *                                                                                       CSW097
     C           *IN15     IFEQ '1'                                                           CSW097
     C           *LOCK     IN   LDA                                                           CSW097
     C                     MOVE '023'     DBASE              * * * * * * *                    CSW097
     C                     MOVEL'       ' DBKEY              * DBERR 023 *                    CSW097
     C                     MOVEL'ZM0065'  DBFILE             * * * * * * *                    CSW097
     C                     OUT  LDA                                                           CSW097
     C                     EXSR *PSSR                                                         CSW097
     C                     END                                                                CSW097
      *                                                                                       CSW097
     C                     MOVELZSDATC    MFLD                                                CSW097
     C                     MOVEL':30Q:'   MTAG                                                CSW097
      *                                                                                       CSW097
      ***Format*field*:37P:*using*base*rate*value.                                            CSW097
      ** Format field :37G: Reset Rate.                                                       CSW097
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     Z-ADD@BAR      ZPRIC  158
      *
     C                     EXSR SR1190
      *
     C***********          MOVE ':37P:'   MTAG                                                CSW097
     C                     MOVEL':37G:'   MTAG                                                CSW097
      *
      ** Format field :37R: using spread value.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     Z-ADD@SPR      ZPRIC  158
      *
     C                     EXSR SR1190
      *
     C                     MOVE ':37R:'   MTAG
      *
      ***Format*field*:37U:*using*value*of*total*rate.                                        CSW097
      ** Format field :37M: Total Rate.                                                       CSW097
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     Z-ADD@TTR      ZPRIC  158
      *
     C                     EXSR SR1190
      *
     C***********          MOVE ':37U:'   MTAG                                                CSW097
     C                     MOVEL':37M:'   MTAG                                                CSW097
      *
      ***Format*field*:34A:*using*current*rate*change*date,                                   CSW097
      ***currency*and*projected*interest*amount.                                              CSW097
     C***********          ADD  1         X                                                   CSW097
     C***********X         OCUR MULT                                                          CSW097
     C***********          MOVE @PDT      ZMDAY                                               CSW097
      ***********                                                                             CSW097
      ***Convert*Midas*date*to*SWIFT*date*format.                                             CSW097
     C***********          CALL 'ZM0060'               15                                     CSW097
     C***********          PARM           ZMDAY   50                                          CSW097
     C***********          PARM           ZSDATE  6                                           CSW097
      ***********                                                                             CSW097
      ***Format*currency*code*and*interest*amount.                                            CSW097
     C***********          MOVE @CCY      ZCCY                                                CSW097
     C***********          MOVE @IAM      ZAMNT                                               CSW097
     C***********          CALL 'ZM0040'                                                      CSW097
     C***********          PARM           ZAMNT  130                                          CSW097
     C***********          PARM           ZCCY    3                                           CSW097
     C***********          PARM           ZSAMNT 15                                           CSW097
     C***********          PARM           ZSCCY   3                                           CSW097
     C***********          PARM           ZERR    1                                           CSW097
      ***********                                                                             CSW097
      ***Error*-*indicate*erroneous*fields;                                                   CSW097
     C***********ZERR      IFEQ '1'                                                           CSW097
     C***********          MOVE 'Y'       @ERR                                                CSW097
     C***********          MOVELERR3N     MFLD                                                CSW097
     C***********          MOVELMSGA,5    MERR                                                CSW097
      ***********                                                                             CSW097
     C***********          ELSE                                                               CSW097
     C***********          MOVELFLD3N     MFLD                                                CSW097
     C***********          ENDIF                                                              CSW097
      ***********                                                                             CSW097
      ***If*called*by*sequence*B,*then*format*as*':34R:',                                     CSW097
      ***otherwise,*format*as*':34P:'.                                                        CSW097
     C***********@SQNCE    IFEQ 'B'                                                           CSW097
     C***********          MOVEL':34R:'   MTAG                                                CSW097
     C***********          ELSE                                                               CSW097
     C***********          MOVEL':34P:'   MTAG                                                CSW097
     C***********          ENDIF                                                              CSW097
      *                                                                                       CSW097
      ** Format field :30F: - Payment Date                                                    CSW097
      *                                                                                       CSW097
     C                     ADD  1         X          52                                       CSW097
     C           X         OCUR MULT                                                          CSW097
      *                                                                                       CSW097
      ** Convert Midas date to SWIFT date format.                                             CSW097
      *                                                                                       CSW097
     C                     Z-ADD@PDT      ZMDAY                                               CSW097
     C                     CALL 'ZM0065'               15                                     CSW097
     C                     PARM           ZMDAY   50                                          CSW097
     C                     PARM           ZSDATE  6                                           CSW097
     C                     PARM           ZSDATC  8                                           CSW097
      *                                                                                       CSW097
      ** Program ended in error.                                                              CSW097
      *                                                                                       CSW097
     C           *IN15     IFEQ '1'                                                           CSW097
     C           *LOCK     IN   LDA                                                           CSW097
     C                     MOVE '024'     DBASE              * * * * * * *                    CSW097
     C                     MOVEL'       ' DBKEY              * DBERR 024 *                    CSW097
     C                     MOVEL'ZM0065'  DBFILE             * * * * * * *                    CSW097
     C                     OUT  LDA                                                           CSW097
     C                     EXSR *PSSR                                                         CSW097
     C                     END                                                                CSW097
      *                                                                                       CSW097
     C                     MOVELZSDATC    MFLD                                                CSW097
     C                     MOVEL':30F:'   MTAG                                                CSW097
      *                                                                                       CSW097
      ***Format*field*:32M:*(Currency,*Interest*Amount)*if*not*ze  CSW097 171312
      ** Format field :32H: (Currency, Interest Amount) if not zero       171312
      *                                                                                       CSW097
     C           @IAM      IFNE *ZERO                                                         CSW097
     C           MGTTYP    ANDNE'FR'                                      171312
      *                                                                                       CSW097
     C                     ADD  1         X                                                   CSW097
     C           X         OCUR MULT                                                          CSW097
     C                     Z-ADD@IAM      ZAMNT                                               CSW097
     C                     MOVEL@CCY      ZCCY                                                CSW097
      *                                                                                       CSW097
      ** Format currency code and principal payment amount.                                   CSW097
      *                                                                                       CSW097
     C                     CALL 'ZM0040'                                                      CSW097
     C                     PARM           ZAMNT  130                                          CSW097
     C                     PARM           ZCCY    3                                           CSW097
     C                     PARM           ZSAMNT 15                                           CSW097
     C                     PARM           ZSCCY   3                                           CSW097
     C                     PARM           ZERR    1                                           CSW097
     C                     PARM           ZSWDPC                                              222373
      *                                                                                       CSW097
      ** Error - indicate erroneous fields;                                                   CSW097
      *                                                                                       CSW097
     C           ZERR      IFEQ '1'                                                           CSW097
     C                     MOVE 'Y'       @ERR                                                CSW097
     C                     MOVELERR3N     MFLD                                                CSW097
     C                     MOVELMSGA,5    MERR                                                CSW097
      *                                                                                       CSW097
     C                     ELSE                                                               CSW097
      *                                                                                       CSW097
     C                     MOVELZSCCY     @ZCCY                                               CSW097
     C                     MOVELZSAMNT    @ZAMT                                               CSW097
     C                     MOVELFLD2N     MFLD                                                CSW097
     C                     ENDIF                                                              CSW097
      *                                                                                       CSW097
     C***********          MOVEL':32M:'   MTAG                     CSW097 171312
     C                     MOVEL':32H:'   MTAG                                                CSW097
      *                                                                                       CSW097
     C                     ENDIF                                                              CSW097
      *
      ** Format field :33E: using currency and principal payment
      ** amount for principal payment amount NOT EQUAL to ZERO.
      *
     C           MGTTYP    IFNE 'FR'                                                          CSW097
     C           @PAM      IFNE 0
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      ** Format currency code and principal payment amount.
      *
     C                     MOVE @CCY      ZCCY
     C                     MOVE @PAM      ZAMNT
     C                     CALL 'ZM0040'
     C                     PARM           ZAMNT  130
     C                     PARM           ZCCY    3
     C                     PARM           ZSAMNT 15
     C                     PARM           ZSCCY   3
     C                     PARM           ZERR    1
     C                     PARM           ZSWDPC                                              222373
      *
      ** Error - indicate erroneous fields;
      *
     C           ZERR      IFEQ '1'
     C                     MOVE 'Y'       @ERR
     C                     MOVELERR3N     MFLD
     C                     MOVELMSGA,5    MERR
      *
     C                     ELSE
      *
     C                     MOVELZSCCY     @ZCCY
     C                     MOVELZSAMNT    @ZAMT
     C                     MOVELFLD2N     MFLD
     C                     ENDIF
      *
     C                     MOVEL':33E:'   MTAG
     C                     ENDIF
     C                     ENDIF                                                              CSW097
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   SETSEQ    - Output settlement sequence                      *
      *   Called by - FMTC Format Sequence C for output (THEIR)       *
      *               FMTE Format Sequence E for output (OUR)         *
      *****************************************************************
      *
     C           SETSEQ    BEGSR
      *                                                                                       CSW097
      ** Initialise Number of Repetitions counter to *zero                                    CSW097
     C                     Z-ADD*ZERO     NREPT                                               CSW097
      *
      ** Format field :18A:
      *
     C                     ADD  1         X
      *                                                                                       CSW097
      ** Save the current value of X for TAG :18A:                                            CSW097
      *                                                                                       CSW097
     C                     Z-ADDX         Y       30                                          CSW097
      *                                                                                       CSW097
     C           X         OCUR MULT
     C                     MOVEL':18A:'   MTAG
     C           MGTTYP    IFEQ 'FR'                                                          CSW097
     C                     MOVEL'00001'   MFLD
     C                     ENDIF                                                              CSW097
      *
      ***Format*field*:32A:*using*pay*date,*currency*and*********                             CSW097
      ***interest*payment*amount.********************************                             CSW097
     C***********          ADD  1         X                                                   CSW097
     C***********X         OCUR MULT                                                          CSW097
     C***********          MOVE @PDT      ZMDAY                                               CSW097
      ***********                                                                             CSW097
      ***Convert*Midas*date*to*SWIFT*date*format.****************                             CSW097
     C***********          CALL 'ZM0060'               15                                     CSW097
     C***********          PARM           ZMDAY   50                                          CSW097
     C***********          PARM           ZSDATE  6                                           CSW097
      ***********                                                                             CSW097
      ***Format*currency*code*and*interest*amount.***************                             CSW097
     C***********          MOVE @CCY      ZCCY                                                CSW097
     C***********          MOVE @IAM      ZAMNT                                               CSW097
     C***********          CALL 'ZM0040'                                                      CSW097
     C***********          PARM           ZAMNT  130                                          CSW097
     C***********          PARM           ZCCY    3                                           CSW097
     C***********          PARM           ZSAMNT 15                                           CSW097
     C***********          PARM           ZSCCY   3                                           CSW097
     C***********          PARM           ZERR    1                                           CSW097
      ***********                                                                             CSW097
      ***Error*-*indicate*erroneous*fields;**********************                             CSW097
     C***********ZERR      IFEQ '1'                                                           CSW097
     C***********          MOVE 'Y'       @ERR                                                CSW097
     C***********          MOVELERR3N     MFLD                                                CSW097
     C***********          MOVELMSGA,5    MERR                                                CSW097
      ***********                                                                             CSW097
     C***********          ELSE                                                               CSW097
     C***********          MOVELFLD3N     MFLD                                                CSW097
     C***********          END                                                                CSW097
      ***********                                                                             CSW097
      ***If*called*by*sequence*C,*then*format*as*':32R:',********                             CSW097
      ***otherwise,*format*as*':32P:'.***************************                             CSW097
     C***********@SQNCE    IFEQ 'C'                                                           CSW097
     C***********          MOVEL':32R:'   MTAG                                                CSW097
     C***********          ELSE                                                               CSW097
     C***********          MOVEL':32P:'   MTAG                                                CSW097
     C***********          ENDIF                                                              CSW097
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C           KY36N1    SETLLMGY36N1                                                       CSW201
     C           KY36N1    READEMGY36N1                  53                                   CSW201
     C                     ELSE                                                               CSW201
     C           MGYKY1    SETLLMGY36NPD                                                      CSW097
     C           MGYKY1    READEMGY36NPD                 53                                   CSW097
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW097
     C           *IN53     DOWEQ'0'                                                           CSW097
      *                                                                                       CSW097
      ** Number of Repetitions of fields :30F: to :57a:                                       CSW097
     C                     ADD  1         NREPT                                               CSW097
      *                                                                                       CSW097
      ** Format :30F: - Payment Date.                                                         CSW097
      *                                                                                       CSW097
     C                     ADD  1         X                                                   CSW097
     C           X         OCUR MULT                                                          CSW097
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C                     MOVE Y1PDAT    ZMDAY                                               CSW201
     C                     ELSE                                                               CSW201
     C                     MOVE MGPDAT    ZMDAY                                               CSW097
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW097
     C                     CALL 'ZM0065'               15                                     CSW097
     C                     PARM           ZMDAY   50                                          CSW097
     C                     PARM           ZSDATE  6                                           CSW097
     C                     PARM           ZSDATC  8                                           CSW097
      *                                                                                       CSW097
      ** Program ended in error.                                                              CSW097
      *                                                                                       CSW097
     C           *IN15     IFEQ '1'                                                           CSW097
     C           *LOCK     IN   LDA                                                           CSW097
     C                     MOVE '025'     DBASE              * * * * * * *                    CSW097
     C                     MOVEL'       ' DBKEY              * DBERR 025 *                    CSW097
     C                     MOVEL'ZM0065'  DBFILE             * * * * * * *                    CSW097
     C                     OUT  LDA                                                           CSW097
     C                     EXSR *PSSR                                                         CSW097
     C                     END                                                                CSW097
      *                                                                                       CSW097
     C                     MOVELZSDATC    MFLD                                                CSW097
     C                     MOVEL':30F:'   MTAG                                                CSW097
      *                                                                                       CSW097
      ** Format :32M: - Currency, Payment Amount                                              CSW097
      *                                                                                       CSW097
     C                     ADD  1         X                                                   CSW097
     C           X         OCUR MULT                                                          CSW097
      *                                                                                       CSW097
     C***********WASTCY    IFEQ *BLANKS                            CSW097 171312
     C                     MOVE @CCY      ZCCY                                                CSW097
     C***********          ELSE                                    CSW097 171312
     C***********          MOVE WASTCY    ZCCY                     CSW097 171312
     C***********          ENDIF                                   CSW097 171312
      ***********                                                  CSW097 171312
     C***********ZCCY      IFNE @CCY                               CSW097 171312
     C***********@CCY      ANDNE*BLANKS                            CSW097 171312
     C***********          Z-ADDMGPAMT    PAPAMT 183               CSW097 171312
     C***********          CALL 'EU0200'                           CSW097 171312
     C***********          PARM *BLANKS   PARTCD  7        Return CCSW097 171312
     C***********          PARM           PAPAMT           FROM CcyCSW097 171312
     C***********          PARM           @CCY    3        FROM CurCSW097 171312
     C***********          PARM           ZCCY    3        TO CurreCSW097 171312
     C***********          PARM           PAOUTA 150       OutrightCSW097 171312
     C***********          PARM           PAINTA 183       Interim CSW097 171312
     C***********          PARM           PAEXRT 159       ExchangeCSW097 171312
     C***********          PARM           PAMDIN  1        Mult/DivCSW097 171312
     C***********PARTCD    IFEQ '*ERROR*'                          CSW097 171312
     C************LOCK     IN   LDA                                CSW097 171312
     C***********          MOVEL'EU0200  'DBFILE           ********CSW097 171312
     C***********          MOVE '041'     DBASE            * DBERR CSW097 171312
     C***********          MOVE *BLANKS   DBKEY            ********CSW097 171312
     C***********          MOVE *BLANKS   W@OPTN  7                CSW097 171312
     C***********          MOVEL@CCY      W@OPTN                   CSW097 171312
     C***********          MOVE ZCCY      W@OPTN                   CSW097 171312
     C***********          OUT  LDA                                CSW097 171312
     C***********          EXSR *PSSR                              CSW097 171312
     C***********          ELSE                                    CSW097 171312
     C***********          MOVE PAOUTA    ZAMNT                    CSW097 171312
     C***********          ENDIF                                   CSW097 171312
     C***********          ELSE                                    CSW097 171312
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C                     Z-ADDY1PAMT    ZAMNT                                               CSW201
     C                     ELSE                                                               CSW201
     C                     Z-ADDMGPAMT    ZAMNT                                               CSW097
     C                     ENDIF                                                              CSW201
     C***********          ENDIF                                   CSW097 171312
      *                                                                                       CSW097
      ** Format currency code and principal amount.                                           CSW097
      *                                                                                       CSW097
     C                     CALL 'ZM0040'                                                      CSW097
     C                     PARM           ZAMNT  130                                          CSW097
     C                     PARM           ZCCY    3                                           CSW097
     C                     PARM           ZSAMNT 15                                           CSW097
     C                     PARM           ZSCCY   3                                           CSW097
     C                     PARM           ZERR    1                                           CSW097
     C                     PARM           ZSWDPC                                              222373
      *                                                                                       CSW097
      ** Error - indicate erroneous fields;                                                   CSW097
      *                                                                                       CSW097
     C           ZERR      IFEQ '1'                                                           CSW097
     C                     MOVE 'Y'       @ERR                                                CSW097
     C                     Z-ADDZAMNT     ZAMT                                                CSW097
     C                     MOVELERR3N     MFLD                                                CSW097
     C                     MOVELMSGA,5    MERR                                                CSW097
      *                                                                                       CSW097
     C                     ELSE                                                               CSW097
     C                     MOVELZSCCY     @ZCCY                                               CSW097
     C                     MOVELZSAMNT    @ZAMT                                               CSW097
     C                     MOVELFLD2N     MFLD                                                CSW097
     C                     ENDIF                                                              CSW097
      *                                                                                       CSW097
     C                     MOVEL':32M:'   MTAG                                                CSW097
      *                                                                                       CSW097
      ** Access record from Settlement Details File                                           CSW097
     C           MGXKY1    CHAINMGX36NPD             54                                       CSW097
      *                                                                                       CSW097
      ** Error if no record found                                                             CSW097
     C           *IN54     IFEQ '1'                                                           CSW097
     C           *LOCK     IN   LDA                                                           CSW097
     C                     MOVE '020'     DBASE              * * * * * * *                    CSW097
     C                     MOVELMGSEQN    DBKEY              * DBERR 020 *                    CSW097
     C                     MOVEL'MGX36NPD'DBFILE             * * * * * * *                    CSW097
     C                     OUT  LDA                                                           CSW097
     C                     EXSR *PSSR                                                         CSW097
     C                     ENDIF                                                              CSW097
      *                                                                                       CSW097
     C                     MOVE *BLANKS   AWBA6   6                                           CSW097
     C                     MOVELMGAWBA    AWBA6   6                                           CSW097
      *                                                                                       CSW097
     C           @SQNCE    IFEQ 'C'                                                           CSW097
     C                     EXSR SRREC                                                         CSW097
     C                     ELSE                                                               CSW097
     C                     EXSR SRPAY                                                         CSW097
     C                     ENDIF                                                              CSW097
      *                                                                                       CSW201
      ** If Swift 2001 is on, for each record read in MGY36NL1 write                          CSW201
      ** a record to MGHISTPD. Afterwards delete record in MGY36NL1.                          CSW201
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
      *                                                                                       CSW201
     C                     MOVEL@TRNA     @HREF                                               CSW201
     C                     MOVE '362'     HSMTPY                                              CSW201
     C                     MOVE *BLANKS   HSTRNO                                              CSW201
     C                     Z-ADDZMDAY     HSPDAT                                              CSW201
     C                     MOVE @MGMSQ    HSMSSQ                                              CSW201
     C                     MOVE MGEVTP    HSEVTP                                              CSW201
     C           WPROC     IFNE 'Y'                                                           CSW201
     C                     MOVEL@TRNA     WFTRNA 16                                           CSW201
     C                     ENDIF                                                              CSW201
     C                     MOVE WFTRNA    HSFTRN                                              CSW201
     C                     MOVE *BLANK    HSCANC                                              CSW201
      *                                                                                       CSW201
     C                     WRITEMGHISTD0               56                                     CSW201
      *                                                                                       CSW201
     C           *IN56     IFEQ *ON                                                           CSW201
     C           *LOCK     IN   LDA                                                           CSW201
     C                     Z-ADD028       DBASE                                               CSW201
     C                     MOVE *BLANKS   DBKEY                                               CSW201
     C                     MOVEL'MGHISTPD'DBFILE                                              CSW201
     C                     OUT  LDA                                                           CSW201
     C                     EXSR *PSSR                                                         CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     DELETMGY36N1                81                                     CSW201
      *                                                                                       CSW201
     C           *IN81     IFEQ *ON                                                           CSW201
     C           *LOCK     IN   LDA                                                           CSW201
     C                     Z-ADD029       DBASE                                               CSW201
     C                     MOVE *BLANKS   DBKEY                                               CSW201
     C                     MOVEL'MGY36NL1'DBFILE                                              CSW201
     C                     OUT  LDA                                                           CSW201
     C                     EXSR *PSSR                                                         CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW097
      ** Read next matching record from MGY36NPD                                              CSW097
      ** (if Swift 2001 is on, read from MGY36NL1)                                            CSW201
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C           KY36N1    READEMGY36N1                  53                                   CSW201
     C                     ELSE                                                               CSW201
     C           MGYKY1    READEMGY36NPD                 53                                   CSW097
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
      ** If Swift 2001 is on, set WPROC= N to delete record in MGF362PD                       CSW201
      ** if there are no more records with the same Seq. No. in extract                       CSW201
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
      *                                                                                       CSW201
     C           *IN53     IFEQ *ON                                                           CSW201
     C           KY36N2    SETLLMGY36N1                                                       CSW201
     C           KY36N2    READEMGY36N1                  80                                   CSW201
     C           *IN80     IFEQ *ON                                                           CSW201
     C                     MOVE 'N'       WPROC                                               CSW201
     C                     ELSE                                                               CSW201
     C                     MOVE 'Y'       WPROC                                               CSW201
     C                     ENDIF                                                              CSW201
     C                     ENDIF                                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     ENDDO                                                              CSW097
      *                                                                                       CSW097
      ** If Deal Type is not "FR", re-acces tag :18A: to format MFLD                          CSW097
     C           MGTTYP    IFNE 'FR'                                                          CSW097
     C           Y         OCUR MULT                                                          CSW097
     C                     MOVELNREPT     MFLD                                                CSW097
     C                     ENDIF                                                              CSW097
      *                                                                                       CSW097
     C                     ENDSR
     C/EJECT
      *****************************************************************                       CSW097
      ****RECV**-*Format*fields*:56a:*and*:57a:*for*receive*sequence***                       CSW097
      ****Called*by*-*FMTC*-*Format*sequence*C*(THEIR)*****************                       CSW097
      ****Calls*****-*FSWAD**Format*swift*address.*********************                       CSW097
      *****************************************************************                       CSW097
      ***********                                                                             CSW097
     C***********RECV      BEGSR                                                              CSW097
      ***********                                                                             CSW097
     C***********          MOVE *BLANKS   @WRK                                                CSW097
      ***********                                                                             CSW097
      ***Format*fields*56*and*57.********************************                             CSW097
      ***********                                                                             CSW097
      ***Branch*code*of*sender*not*equal*to*Receive*settlement*branch.                        CSW097
      ***********                                                                             CSW097
      ****Test*if*settlement*via*nostro**************************                             CSW097
     C***********          MOVE MGRSTM    @STM                                                CSW097
     C***********@STM      LOKUPTABNST                   23                                   CSW097
     C***********MGBRCA    IFNE MGROBR                                                        CSW097
     C************IN23     ANDEQ'1'                                                           CSW097
      ***********                                                                             CSW097
     C***********          ADD  1         X                                                   CSW097
     C***********X         OCUR MULT                                                          CSW097
      ***********                                                                             CSW097
     C***********MGRIBN    IFNE *BLANKS                                                       CSW097
     C***********          MOVE *BLANKS   ZDEST                                               CSW097
     C***********          MOVELMGRIBN    ZDEST                                               CSW097
     C***********          MOVELMGRIBA    ACLINE                                              CSW097
     C***********          MOVE ' '       TAG                                                 CSW097
     C***********          MOVE '56'      FLDNO                                               CSW097
     C***********          EXSR FSWAD                                                         CSW097
      ***********                                                                             CSW097
     C***********          ELSE                                                               CSW097
      ***********                                                                             CSW097
      ****Access*Branch*file*for*the*Internal*customer*number*of*the                          CSW097
      ****Receive*branch*(this*will*be*used*for*the*Intermediary*                             CSW097
      ****Bank,*because*settlement*is*via*an*account*owned*******                             CSW097
      ****by*a*branch*different*to*the*receive*branch)***********                             CSW097
      ***********                                                                             CSW097
     C***********          CALL 'AOBRCHR0'                                                    CSW097
     C***********          PARM '*MSG   ' @RTCD                                               CSW097
     C***********          PARM '*KEY   ' @OPTN                                               CSW097
     C***********          PARM MGROBR    @BRCD   3                                           CSW097
     C***********SDBRCH    PARM SDBRCH    DSSDY                                               CSW097
      ***********                                                                             CSW097
      ***Branch*record*not*found*-*Error*************************                             CSW097
      ***********                                                                             CSW097
     C***********@RTCD     IFNE *BLANKS                                                       CSW097
     C************LOCK     IN   LDA                                                           CSW097
     C***********          MOVE '016'     DBASE              * * * * * * *                    CSW097
     C***********          MOVELMGROBR    DBKEY              * DBERR 016 *                    CSW097
     C***********          MOVEL'SDBRCHPD'DBFILE             * * * * * * *                    CSW097
     C***********          OUT  LDA                                                           CSW097
     C***********          EXSR *PSSR                                                         CSW097
     C***********          END                                                                CSW097
      ***********                                                                             CSW097
      ***Format*Intermediary*using*customer*number*of*receive*branch                          CSW097
      ***********                                                                             CSW097
     C***********          MOVE *BLANKS   ZDEST                                               CSW097
     C***********          MOVELA8BICN    ZDEST                                               CSW097
     C***********          MOVE *BLANKS   ACLINE                                              CSW097
     C***********          MOVE ' '       TAG                                                 CSW097
     C***********          MOVE '56'      FLDNO                                               CSW097
     C***********          EXSR FSWAD                                                         CSW097
     C***********          END                                                                CSW097
      ***********                                                                             CSW097
      ***Field*:57:**A/C*With*Institution************************                             CSW097
      ***********                                                                             CSW097
     C***********          ADD  1         X                                                   CSW097
     C***********X         OCUR MULT                                                          CSW097
     C***********          CALL 'AONOSTR0'                                                    CSW097
     C***********          PARM '*MSG   ' @RTCD   7                                           CSW097
     C***********          PARM '*KEY   ' @OPTN   7                                           CSW097
     C***********          PARM *BLANKS   @CUST   6        I:Customer No                      CSW097
     C***********          PARM MGTCCY    @CYCD   3        I:Currency                         CSW097
     C***********          PARM *BLANKS   @ACCD   4        I:A/c Code                         CSW097
     C***********          PARM *BLANKS   @ACSN   2        I:A/c Seq                          CSW097
     C***********          PARM MGRONS    @NONB   2        I:Nostro No                        CSW097
     C***********          PARM *BLANKS   @BRCD   3        I:Branch Code                      CSW097
     C***********          PARM *BLANKS   @CSSN  10        I:Cust ShortN                      CSW097
     C***********          PARM *BLANK    @PNOI   1        I:Prime Nost In                    CSW097
     C***********SDNOST    PARM SDNOST    DSFDY                                               CSW097
      ***********                                                                             CSW097
      ****If*our*receive*nostro*is*not*found.********************                             CSW097
      ***********                                                                             CSW097
     C***********@RTCD     IFNE *BLANKS                                                       CSW097
     C***********          MOVE 'Y'       @ERR                                                CSW097
     C***********          MOVELMGRONS    HLD2    2                                           CSW097
     C***********          MOVELMGTCCY    HLD5                                                CSW097
     C***********          MOVE HLD2      HLD5    5                                           CSW097
     C***********          MOVELHLD5      MFLD                                                CSW097
     C***********          MOVELMSGA,3    MERR                                                CSW097
     C***********          MOVE ':57 :'   MTAG                                                CSW097
     C***********          ELSE                                                               CSW097
      ***********                                                                             CSW097
      ****Format*our*Receive*Nostro*Customer*Address*************                             CSW097
      ***********                                                                             CSW097
     C***********          MOVE *BLANKS   ZDEST                                               CSW097
     C***********          MOVELA7CUST    ZDEST                                               CSW097
     C***********          MOVEL*BLANKS   ACLINE 35                                           CSW097
     C***********          MOVE ' '       TAG                                                 CSW097
     C***********          MOVE '57'      FLDNO                                               CSW097
     C***********          EXSR FSWAD                                                         CSW097
     C***********          END                                                                CSW097
      ***********                                                                             CSW097
      ***********                                                                             CSW097
      ***Else*the*branch*code*of*sender*=*receive*settlement*branch                           CSW097
      ***and*the*settlement*is*via*a*nostro.*********************                             CSW097
      ***********                                                                             CSW097
     C***********          ELSE                                                               CSW097
      ***********                                                                             CSW097
     C***********MGRIBN    IFNE *BLANKS                                                       CSW097
     C***********          ADD  1         X                                                   CSW097
     C***********X         OCUR MULT                                                          CSW097
     C***********          MOVE *BLANKS   ZDEST                                               CSW097
     C***********          MOVELMGRIBN    ZDEST                                               CSW097
     C***********          MOVELMGRIBA    ACLINE                                              CSW097
     C***********          MOVE ' '       TAG                                                 CSW097
     C***********          MOVE '56'      FLDNO                                               CSW097
     C***********          EXSR FSWAD                                                         CSW097
     C***********          END                                                                CSW097
      ***********                                                                             CSW097
     C***********@STM      LOKUPTABNST                   23                                   CSW097
      ***********                                                                             CSW097
     C************IN23     IFEQ '1'                                                           CSW097
     C***********          ADD  1         X                                                   CSW097
     C***********X         OCUR MULT                                                          CSW097
     C***********          CALL 'AONOSTR0'                                                    CSW097
     C***********          PARM '*MSG   ' @RTCD   7                                           CSW097
     C***********          PARM '*KEY   ' @OPTN   7                                           CSW097
     C***********          PARM *BLANKS   @CUST   6        I:Customer No                      CSW097
     C***********          PARM MGTCCY    @CYCD   3        I:Currency                         CSW097
     C***********          PARM *BLANKS   @ACCD   4        I:A/c Code                         CSW097
     C***********          PARM *BLANKS   @ACSN   2        I:A/c Seq                          CSW097
     C***********          PARM MGRONS    @NONB   2        I:Nostro No                        CSW097
     C***********          PARM *BLANKS   @BRCD   3        I:Branch Code                      CSW097
     C***********          PARM *BLANKS   @CSSN  10        I:Cust ShortN                      CSW097
     C***********          PARM *BLANK    @PNOI   1        I:Prime Nost In                    CSW097
     C***********SDNOST    PARM SDNOST    DSFDY                                               CSW097
      ***********                                                                             CSW097
      ****If*our*receive*nostro*is*not*found.********************                             CSW097
      ***********                                                                             CSW097
     C***********@RTCD     IFNE *BLANKS                                                       CSW097
     C***********          MOVE 'Y'       @ERR                                                CSW097
     C***********          MOVELMGRONS    HLD2                                                CSW097
     C***********          MOVELMGTCCY    HLD5                                                CSW097
     C***********          MOVE HLD2      HLD5                                                CSW097
     C***********          MOVELHLD5      MFLD                                                CSW097
     C***********          MOVELMSGA,3    MERR                                                CSW097
     C***********          MOVE ':57 :'   MTAG                                                CSW097
     C***********          ELSE                                                               CSW097
      ***********                                                                             CSW097
     C***********          MOVE *BLANKS   ZDEST                                               CSW097
     C***********          MOVELA7CUST    ZDEST                                               CSW097
      ***********                                                                             CSW097
     C***********          MOVEL*BLANKS   ACLINE                                              CSW097
     C***********          MOVE ' '       TAG                                                 CSW097
     C***********          MOVE '57'      FLDNO                                               CSW097
     C***********          EXSR FSWAD                                                         CSW097
     C***********          END                                                                CSW097
      ***********                                                                             CSW097
     C***********          ELSE                                                               CSW097
      ***********                                                                             CSW097
      ***Settlement*method*internal.*****************************                             CSW097
      ***********                                                                             CSW097
     C***********          ADD  1         X                                                   CSW097
     C***********X         OCUR MULT                                                          CSW097
      ***********                                                                             CSW097
     C***********MGRSTM    IFNE 00                                                            CSW097
     C***********          MOVE *BLANKS   ZDEST                                               CSW097
     C***********          MOVELSECN      ZDEST                                               CSW097
     C***********          MOVEL*BLANKS   ACLINE                                              CSW097
     C***********          MOVE ' '       TAG                                                 CSW097
     C***********          MOVE '57'      FLDNO                                               CSW097
     C***********          EXSR FSWAD                                                         CSW097
      ***********                                                                             CSW097
      ***No*settlement*type*entered.*****************************                             CSW097
      ***********                                                                             CSW097
     C***********          ELSE                                                               CSW097
     C***********          MOVE ':57D:'   MTAG                                                CSW097
     C***********          MOVEL'UNKNOWN' MFLD                                                CSW097
     C***********          END                                                                CSW097
     C***********          END                                                                CSW097
      ***********                                                                             CSW097
     C***********          END                                                                CSW097
      ***********                                                                             CSW097
     C***********          ENDSR                                                              CSW097
     C*/EJECT****                                                                             CSW097
      *****************************************************************                       CSW097
      ****PAY**-*Format*fields*:53:,*:56a:*and*:57a:*for*a*payment*****                       CSW097
      ****Called*by*-*FMTE***Format*sequence*E*(OUR)*******************                       CSW097
      ****Calls*******FSWAD**Format*Swift*Address.*********************                       CSW097
      *****************************************************************                       CSW097
      ***********                                                                             CSW097
     C***********PAY       BEGSR                                                              CSW097
      ***********                                                                             CSW097
     C***********          MOVE *BLANKS   @WRK                                                CSW097
      ***********                                                                             CSW097
      ***Field*53*-*Senders*correspondant.***********************                             CSW097
      ****Test*if*settlement*via*nostro**************************                             CSW097
      ***********                                                                             CSW097
     C***********          MOVE MGPSTM    @STM    2                                           CSW097
     C***********@STM      LOKUPTABNST                   23                                   CSW097
      ***********                                                                             CSW097
      ***If*our*pay*nostro*is*not*blank*and*the*settlement*is*via a nostro                    CSW097
      ***********                                                                             CSW097
     C***********MGPONS    IFNE *BLANKS                                                       CSW097
     C************IN23     ANDEQ'1'                                                           CSW097
      ***********                                                                             CSW097
      ****either*A/C*with*Bank*or*Receipient*entered*************                             CSW097
      ****or*DIRECT*entered**************************************                             CSW097
      ***********                                                                             CSW097
     C***********MGAWBN    IFNE *BLANKS                                                       CSW097
     C***********AWBA6     OREQ 'DIRECT'                                                      CSW097
      ***********                                                                             CSW097
     C***********          MOVELMGPONS    @NONB                                               CSW097
     C***********          CALL 'AONOSTR0'                                                    CSW097
     C***********          PARM '*MSG   ' @RTCD   7                                           CSW097
     C***********          PARM '*KEY   ' @OPTN   7                                           CSW097
     C***********          PARM *BLANKS   @CUST   6                                           CSW097
     C***********          PARM MGOCCY    @CYCD   3                                           CSW097
     C***********          PARM *BLANKS   @ACCD   4                                           CSW097
     C***********          PARM *BLANKS   @ACSN   2                                           CSW097
     C***********          PARM           @NONB   2                                           CSW097
     C***********          PARM *BLANKS   @BRCD   3                                           CSW097
     C***********          PARM *BLANKS   @CSSN  10                                           CSW097
     C***********          PARM *BLANKS   @PNOI   1                                           CSW097
     C***********SDNOST    PARM SDNOST    DSFDY                                               CSW097
      ***********                                                                             CSW097
      ****Nostro*customer*not*found******************************                             CSW097
      ***********                                                                             CSW097
     C***********@RTCD     IFNE *BLANKS                                                       CSW097
     C***********          ADD  1         X                                                   CSW097
     C***********X         OCUR MULT                                                          CSW097
     C***********          MOVE 'Y'       @ERR                                                CSW097
     C***********          MOVE ':53 :'   MTAG                                                CSW097
     C***********          MOVELMGPONS    HLD2                                                CSW097
     C***********          MOVELMGOCCY    HLD5                                                CSW097
     C***********          MOVE HLD2      HLD5                                                CSW097
     C***********          MOVELHLD5      MFLD                                                CSW097
     C***********          MOVELMSGA,3    MERR                                                CSW097
     C***********          ELSE                                                               CSW097
      ***********                                                                             CSW097
      ***Branch*Internal*Customer*cf.*Customer*number*of*Our*Pay*Nostro                       CSW097
      ***********                                                                             CSW097
     C***********          MOVELSECN      @SECN   6                                           CSW097
     C***********@SECN     IFNE A7CUST                                                        CSW097
     C***********MGAWBN    ANDNEA7CUST                                                        CSW097
     C***********          MOVE *BLANKS   ZDEST                                               CSW097
     C***********          MOVELA7CUST    ZDEST                                               CSW097
     C***********          CALL 'ZM0050'                                                      CSW097
     C***********          PARM           ZDEST  12                                           CSW097
     C***********          PARM           ZSADD1 35                                           CSW097
     C***********          PARM           ZSADD2 35                                           CSW097
     C***********          PARM           ZSADD3 35                                           CSW097
     C***********          PARM           ZSADD4 35                                           CSW097
     C***********          PARM           ZSTAG   1                                           CSW097
     C***********          PARM           ZSTYPE  1                                           CSW097
     C***********          PARM           ZERR    1                                           CSW097
      ***********                                                                             CSW097
      ****Error*when*formating*address***************************                             CSW097
      ***********                                                                             CSW097
     C***********ZERR      IFEQ '1'                                                           CSW097
     C***********          ADD  1         X                                                   CSW097
     C***********X         OCUR MULT                                                          CSW097
     C***********          MOVE 'Y'       @ERR                                                CSW097
     C***********          MOVE ':53 :'   MTAG                                                CSW097
     C***********          MOVELZDEST     MFLD                                                CSW097
     C***********          MOVELMSGA,6    MERR                                                CSW097
     C***********          ELSE                                                               CSW097
      ***********                                                                             CSW097
      ****A*Type*address*****************************************                             CSW097
      ***********                                                                             CSW097
     C***********ZSTAG     IFEQ 'A'                                                           CSW097
     C***********          ADD  1         X                                                   CSW097
     C***********X         OCUR MULT                                                          CSW097
     C***********          MOVE 'A'       TAG                                                 CSW097
     C***********          MOVE '53'      FLDNO                                               CSW097
     C***********          MOVE @MTAG     MTAG                                                CSW097
     C***********          MOVELZSADD1    MFLD                                                CSW097
      ***********                                                                             CSW097
     C***********          ELSE                                                               CSW097
      ***********                                                                             CSW097
      ****Access*SDCUSTPD*using*our*pay*nostro*customer*number***                             CSW097
      ***********                                                                             CSW097
     C***********          MOVE *BLANKS   @KEY1                                               CSW097
     C***********          MOVELA7CUST    @KEY1                                               CSW097
     C***********          CALL 'AOCUSTR0'                                                    CSW097
     C***********          PARM '*MSG   ' @RTCD                                               CSW097
     C***********          PARM '*KEY   ' @OPTN                                               CSW097
     C***********          PARM           @KEY1  10                                           CSW097
     C***********          PARM *BLANKS   @KYST   7                                           CSW097
     C***********SDCUST    PARM SDCUST    DSSDY                                               CSW097
      ***********                                                                             CSW097
      ***Customer*record*not*found*-*Error***********************                             CSW097
      ***********                                                                             CSW097
     C***********@RTCD     IFNE *BLANKS                                                       CSW097
     C***********          ADD  1         X                                                   CSW097
     C***********X         OCUR MULT                                                          CSW097
     C***********          MOVE 'Y'       @ERR                                                CSW097
     C***********          MOVE ':53 :'   MTAG                                                CSW097
     C***********          MOVELA7CUST    MFLD                                                CSW097
     C***********          MOVE MSGA,2    MERR                                                CSW097
      ***********                                                                             CSW097
     C***********          ELSE                                                               CSW097
      ***********                                                                             CSW097
      ****B*Type*address*****************************************                             CSW097
      ***********                                                                             CSW097
     C***********          ADD  1         X                                                   CSW097
     C***********X         OCUR MULT                                                          CSW097
     C***********          MOVE BBPCNB    @PCNB   60                                          CSW097
     C***********SPAIN     IFEQ 'P'                                                           CSW097
     C***********@PCNB     ANDEQSECN                                                          CSW097
     C***********BBPAIN    OREQ 'P'                                                           CSW097
     C***********A7CUST    ANDEQSPCNB                                                         CSW097
     C***********BBPCNB    OREQ SPCNB                                                         CSW097
     C***********BBPCNB    ANDNE*BLANKS                                                       CSW097
      ***********                                                                             CSW097
     C***********          MOVE ':53B:'   MTAG                                                CSW097
     C***********          MOVE *BLANKS   @WRK                                                CSW097
     C***********          MOVEABBCRNM    @WRK,1                                              CSW097
     C***********          Z-ADD22        J       20                                          CSW097
     C***********          MOVEABBCRTN    @WRK,J                                              CSW097
     C***********          MOVEA@WRK      MFLD                                                CSW097
      ***********                                                                             CSW097
      ****D*Type*address*****************************************                             CSW097
     C***********          ELSE                                                               CSW097
     C***********          MOVE ':53D:'   MTAG                                                CSW097
     C***********          MOVELZSADD1    MFLD                                                CSW097
      ****Address*2**********************************************                             CSW097
     C***********ZSADD2    IFNE *BLANKS                                                       CSW097
     C***********          ADD  1         X                                                   CSW097
     C***********X         OCUR MULT                                                          CSW097
     C***********          MOVELZSADD2    MFLD                                                CSW097
      ****Address*3**********************************************                             CSW097
     C***********ZSADD3    IFNE *BLANKS                                                       CSW097
     C***********          ADD  1         X                                                   CSW097
     C***********X         OCUR MULT                                                          CSW097
     C***********          MOVELZSADD3    MFLD                                                CSW097
      ****Address*4**********************************************                             CSW097
     C***********ZSADD4    IFNE *BLANKS                                                       CSW097
     C***********          ADD  1         X                                                   CSW097
     C***********X         OCUR MULT                                                          CSW097
     C***********          MOVELZSADD4    MFLD                                                CSW097
     C***********          END                             D address 4                        CSW097
     C***********          END                             D address 3                        CSW097
     C***********          END                             D address 2                        CSW097
     C***********          END                             B/D address 1                      CSW097
      ***********                                                                             CSW097
     C***********          END                             Cust. error?                       CSW097
      ***********                                                                             CSW097
     C***********          END                             A/B/D address?                     CSW097
     C***********          END                             Fmt ad. error                      CSW097
     C***********          END                             Brch Int Cust.                     CSW097
     C***********          END                             Nostro not fnd.                    CSW097
     C***********          END                                                                CSW097
     C***********          END                             Pay nostro?                        CSW097
      ***********                                                                             CSW097
     C***********          MOVE 'N'       FLD57O  1                                           CSW097
      ***********                                                                             CSW097
      ****Field*:57:**A/C*with*institution*non-blank*************                             CSW097
      ***********                                                                             CSW097
     C***********MGAWBN    IFNE *BLANKS                                                       CSW097
      ***********                                                                             CSW097
      ****Field*:56:**Pay*Intermediary*bank**********************                             CSW097
      ****This*field*is*only*produced*when*the*account*with*institution                       CSW097
      ****is*non-blank.******************************************                             CSW097
      ***********                                                                             CSW097
      ****If*the*pay*intermediary*is*entered.********************                             CSW097
      ***********                                                                             CSW097
     C***********MGPIBN    IFNE *BLANKS                                                       CSW097
     C***********          ADD  1         X                                                   CSW097
     C***********X         OCUR MULT                                                          CSW097
     C***********          MOVE *BLANKS   ZDEST                                               CSW097
     C***********          MOVELMGPIBN    ZDEST                                               CSW097
     C***********          MOVELMGPIBA    ACLINE                                              CSW097
     C***********          MOVE ' '       TAG                                                 CSW097
     C***********          MOVE '56'      FLDNO                                               CSW097
     C***********          EXSR FSWAD                                                         CSW097
     C***********          END                                                                CSW097
      ***********                                                                             CSW097
      ****Format*Account*with*institution.*(Field*57.)***********                             CSW097
      ***********                                                                             CSW097
     C***********          ADD  1         X                                                   CSW097
     C***********X         OCUR MULT                                                          CSW097
     C***********          MOVE *BLANKS   ZDEST                                               CSW097
     C***********          MOVELMGAWBN    ZDEST                                               CSW097
     C***********          MOVELMGAWBA    ACLINE                                              CSW097
     C***********          MOVE ' '       TAG                                                 CSW097
     C***********          MOVE '57'      FLDNO                                               CSW097
     C***********          EXSR FSWAD                                                         CSW097
     C***********          MOVE 'Y'       FLD57O  1                                           CSW097
      ***********                                                                             CSW097
      ****A/C*with*Inst.*blank***********************************                             CSW097
      ***********                                                                             CSW097
     C***********          ELSE                                                               CSW097
      ***********                                                                             CSW097
     C***********AWBA6     IFEQ 'DIRECT'                                                      CSW097
      ***********                                                                             CSW097
      ****A/C*with*Inst.*set*up*as*DIRECT,*use*beneficiary*details                            CSW097
      ****Format*Account*with*institution.*(Field*57.)***********                             CSW097
      ***********                                                                             CSW097
     C***********          ADD  1         X                                                   CSW097
     C***********X         OCUR MULT                                                          CSW097
     C***********          MOVE *BLANKS   ZDEST                                               CSW097
     C***********          MOVELMGBENN    ZDEST                                               CSW097
     C***********          MOVELMGBENA    ACLINE                                              CSW097
     C***********          MOVE ' '       TAG                                                 CSW097
     C***********          MOVE '57'      FLDNO                                               CSW097
     C***********          EXSR FSWAD                                                         CSW097
     C***********          MOVE 'Y'       FLD57O  1                                           CSW097
      ***********                                                                             CSW097
      ****A/C*with*Inst.*blank*and*NOT*"DIRECT"*entered,*********                             CSW097
      ***********                                                                             CSW097
     C***********          ELSE                                                               CSW097
      ***********                                                                             CSW097
      ***********                                                                             CSW097
      ****Field*57*=*pay*nostro*customer*if*settlement*via*'02'*or '12'                       CSW097
     C***********MGPSTM    IFEQ 02                                                            CSW097
     C***********MGPSTM    OREQ 12                                                            CSW097
     C***********          MOVELMGPONS    @NONB                                               CSW097
     C***********          CALL 'AONOSTR0'                                                    CSW097
     C***********          PARM '*MSG   ' @RTCD   7                                           CSW097
     C***********          PARM '*KEY   ' @OPTN   7                                           CSW097
     C***********          PARM *BLANKS   @CUST   6                                           CSW097
     C***********          PARM MGOCCY    @CYCD   3                                           CSW097
     C***********          PARM *BLANKS   @ACCD   4                                           CSW097
     C***********          PARM *BLANKS   @ACSN   2                                           CSW097
     C***********          PARM           @NONB   2                                           CSW097
     C***********          PARM *BLANKS   @BRCD   3                                           CSW097
     C***********          PARM *BLANKS   @CSSN  10                                           CSW097
     C***********          PARM *BLANKS   @PNOI   1                                           CSW097
     C***********SDNOST    PARM SDNOST    DSFDY                                               CSW097
      ***********                                                                             CSW097
      ****Nostro*customer*not*found******************************                             CSW097
      ***********                                                                             CSW097
     C***********@RTCD     IFNE *BLANKS                                                       CSW097
     C***********          MOVE 'Y'       @ERR                                                CSW097
     C***********          ADD  1         X                                                   CSW097
     C***********X         OCUR MULT                                                          CSW097
     C***********          MOVELMGPONS    HLD2    2                                           CSW097
     C***********          MOVELMGOCCY    HLD5                                                CSW097
     C***********          MOVE HLD2      HLD5    5                                           CSW097
     C***********          MOVELHLD5      MFLD                                                CSW097
     C***********          MOVELMSGA,3    MERR                                                CSW097
     C***********          MOVE ':57 :'   MTAG                                                CSW097
     C***********          ELSE                                                               CSW097
      ***********                                                                             CSW097
      ****Format*our*Pay*Nostro*Customer*Address*****************                             CSW097
      ***********                                                                             CSW097
     C***********          ADD  1         X                                                   CSW097
     C***********X         OCUR MULT                                                          CSW097
     C***********          MOVE *BLANKS   ZDEST                                               CSW097
     C***********          MOVELA7CUST    ZDEST                                               CSW097
     C***********          MOVEL*BLANKS   ACLINE                                              CSW097
     C***********          MOVE ' '       TAG                                                 CSW097
     C***********          MOVE '57'      FLDNO                                               CSW097
     C***********          EXSR FSWAD                                                         CSW097
     C***********          MOVE 'Y'       FLD57O                                              CSW097
     C***********          END                                                                CSW097
      ***********                                                                             CSW097
     C***********          ELSE                                                               CSW097
      ***********                                                                             CSW097
     C***********MGPSTM    IFNE 00                                                            CSW097
     C***********          MOVE MGPSTM    @STM                                                CSW097
     C***********@STM      LOKUPTABINT                   23                                   CSW097
      ***********                                                                             CSW097
     C************IN23     IFEQ '1'                                                           CSW097
     C***********          ADD  1         X                                                   CSW097
     C***********X         OCUR MULT                                                          CSW097
     C***********          MOVE *BLANKS   ZDEST                                               CSW097
     C***********          MOVELSECN      ZDEST                                               CSW097
     C***********          MOVEL*BLANKS   ACLINE                                              CSW097
     C***********          MOVE ' '       TAG                                                 CSW097
     C***********          MOVE '57'      FLDNO                                               CSW097
     C***********          EXSR FSWAD                                                         CSW097
     C***********          MOVE 'Y'       FLD57O                                              CSW097
      ***********                                                                             CSW097
     C***********          ELSE                                                               CSW097
      ***********                                                                             CSW097
      ****Field*53*is*equal*to*Our*Pay*Nostro********************                             CSW097
      ***********                                                                             CSW097
     C***********          MOVELMGPONS    @NSKYE                                              CSW097
     C***********          CALL 'AONOSTR0'                                                    CSW097
     C***********          PARM '*MSG   ' @RTCD   7                                           CSW097
     C***********          PARM '*KEY   ' @OPTN   7                                           CSW097
     C***********          PARM *BLANKS   @NSKYA  6                                           CSW097
     C***********          PARM MGOCCY    @NSKYB  3                                           CSW097
     C***********          PARM *BLANKS   @NSKYC  4                                           CSW097
     C***********          PARM *BLANKS   @NSKYD  2                                           CSW097
     C***********          PARM           @NSKYE  2                                           CSW097
     C***********          PARM *BLANKS   @KEYF   3                                           CSW097
     C***********          PARM *BLANKS   @KEYG  10                                           CSW097
     C***********          PARM *BLANKS   @KEYH   1                                           CSW097
     C***********SDNOST    PARM SDNOST    DSFDY                                               CSW097
      ***********                                                                             CSW097
      ****Nostro*customer*not*found******************************                             CSW097
      ***********                                                                             CSW097
     C***********@RTCD     IFNE *BLANKS                                                       CSW097
     C***********          ADD  1         X                                                   CSW097
     C***********X         OCUR MULT                                                          CSW097
     C***********          MOVE 'Y'       @ERR                                                CSW097
     C***********          MOVE ':53 :'   MTAG                                                CSW097
     C***********          MOVELMGPONS    MFLD                                                CSW097
     C***********          MOVELMSGA,3    MERR                                                CSW097
     C***********          ELSE                                                               CSW097
      ***********                                                                             CSW097
      ****Format*our*Pay*Nostro*Customer*Address*****************                             CSW097
      ***********                                                                             CSW097
     C***********          ADD  1         X                                                   CSW097
     C***********X         OCUR MULT                                                          CSW097
     C***********          MOVE *BLANKS   ZDEST                                               CSW097
     C***********          MOVELA7CUST    ZDEST                                               CSW097
     C***********          MOVEL*BLANKS   ACLINE                                              CSW097
     C***********          MOVE ' '       TAG                                                 CSW097
     C***********          MOVE '53'      FLDNO                                               CSW097
     C***********          EXSR FSWAD                                                         CSW097
     C***********          END                                                                CSW097
     C***********          END                                                                CSW097
     C***********          END                                                                CSW097
     C***********          END                                                                CSW097
     C***********          END                                                                CSW097
     C***********          END                                                                CSW097
      ***********                                                                             CSW097
      ****Settlement*01,07*or*08*with*MGAWBN*blank*or*settlement*00                           CSW097
      ***********                                                                             CSW097
     C***********FLD57O    IFEQ 'N'                                                           CSW097
     C***********          ADD  1         X                                                   CSW097
     C***********X         OCUR MULT                                                          CSW097
     C***********          MOVE ':57D:'   MTAG                                                CSW097
     C***********          MOVEL'UNKNOWN' MFLD                                                CSW097
     C***********          END                                                                CSW097
      ***********                                                                             CSW097
     C***********          ENDSR                                                              CSW097
      */EJECT****                                                                             CSW097
      *****************************************************************                       CSW097
     C/EJECT                                                                                  CSW097
      *****************************************************************                       CSW097
      *   SRREC     - Format fields :56a: and :57a: in Seq. C (THEIR) *                       CSW097
      *   Called by - SETSEQ                                          *                       CSW097
      *   Calls     - FSWAD                                           *                       CSW097
      *****************************************************************                       CSW097
      *                                                                                       CSW097
     C           SRREC     BEGSR                                                              CSW097
      *                                                                                       CSW201
      ** If Swift 2001 is on, output of Intermediary (56a) and                                CSW201
      ** Acct w/ Bank (57a) in Sequence E will not allow entry of BEIs.                       CSW201
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C                     MOVE 'Y'       ZDBEI   1                                           CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW097
      **  Field :56a:  Intermediary                                                           CSW097
      ** (only if Swift 2001 is off or Payment amount <> zero)                                CSW201
      *                                                                                       CSW201
     C           CSW201    IFEQ 'N'                                                           CSW201
     C           Y1PAMT    ORNE *ZERO                                                         CSW201
      *                                                                                       CSW097
      **  Intermediary not blank; retrieve customer address                                   CSW097
     C           MGRIBN    IFNE *BLANKS                                                       CSW097
     C                     ADD  1         X                                                   CSW097
     C           X         OCUR MULT                                                          CSW097
     C                     MOVE *BLANKS   ZDEST                                               CSW097
     C                     MOVELMGRIBN    ZDEST                                               CSW097
     C                     MOVE *BLANKS   ACLINE 35                                           CSW097
     C                     MOVELMGRIBA    ACLINE                                              CSW097
     C                     MOVE ' '       TAG                                                 CSW097
     C                     MOVE '56'      FLDNO                                               CSW097
     C                     EXSR FSWAD                                                         CSW097
     C                     ENDIF                                                              CSW097
      *                                                                                       CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW097
      **  Field :57a: Receiving Agent                                                         CSW097
      ** (only if Swift 2001 is off or Payment amount <> zero)                                CSW201
      *                                                                                       CSW201
     C                     ADD  1         X                                                   CSW097
     C           X         OCUR MULT                                                          CSW097
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C           Y1PAMT    ANDEQ*ZERO                                                         CSW201
     C                     MOVE ':57D:'   MTAG                                                CSW201
     C                     MOVEL'NONE'    MFLD                                                CSW201
     C                     ELSE                                                               CSW201
      *                                                                                       CSW097
      **  Test if settlement via nostro                                                       CSW097
     C                     MOVE MGRSTM    @STM    2                                           CSW097
     C           @STM      LOKUPTABNST                   23                                   CSW097
     C           MGRONS    IFNE *BLANKS                                                       CSW097
     C           *IN23     ANDEQ'1'                                                           CSW097
      *                                                                                       CSW097
     C           MGRSCY    IFNE *BLANK                                                        CSW097
     C                     MOVE MGRSCY    @NSKYB                                              CSW097
     C                     ELSE                                                               CSW097
     C                     MOVE @CCY      @NSKYB                                              CSW097
     C                     ENDIF                                                              CSW097
      *                                                                                       CSW097
     C                     MOVELMGRONS    @NSKYE                                              CSW097
     C                     CALL 'AONOSTR0'                                                    CSW097
     C                     PARM '*MSG   ' @RTCD   7                                           CSW097
     C                     PARM '*KEY   ' @OPTN   7                                           CSW097
     C                     PARM *BLANKS   @NSKYA  6                                           CSW097
     C                     PARM           @NSKYB  3                                           CSW097
     C**********           PARM *BLANKS   @NSKYC  4                                    CSW097 CGL029
     C                     PARM *BLANKS   @NSKYC 10                                           CGL029
     C                     PARM *BLANKS   @NSKYD  2                                           CSW097
     C                     PARM           @NSKYE  2                                           CSW097
     C                     PARM *BLANKS   @KEYF   3                                           CSW097
     C                     PARM *BLANKS   @KEYG  10                                           CSW097
     C                     PARM *BLANKS   @KEYH   1                                           CSW097
     C           SDNOST    PARM SDNOST    DSFDY                                               CSW097
      *                                                                                       CSW097
     C           @RTCD     IFNE *BLANKS                                                       CSW097
     C                     MOVE 'Y'       @ERR                                                CSW097
     C                     MOVELMGRONS    MFLD                                                CSW097
     C                     MOVELMSGA,3    MERR                                                CSW097
     C                     MOVE ':57 :'   MTAG                                                CSW097
     C                     ELSE                                                               CSW097
      *                                                                                       CSW097
     C                     MOVE *BLANKS   ZDEST                                               CSW097
     C                     MOVELA7CUST    ZDEST                                               CSW097
     C                     MOVEL*BLANKS   ACLINE                                              CSW097
     C                     MOVE ' '       TAG                                                 CSW097
     C                     MOVE '57'      FLDNO                                               CSW097
     C                     EXSR FSWAD                                                         CSW097
     C                     ENDIF                                                              CSW097
      *                                                                                       CSW097
      **  Their receive nostro is blank or settlement internal                                CSW097
     C                     ELSE                                                               CSW097
      *                                                                                       CSW097
      **  Test if settlement via internal                                                     CSW097
     C                     MOVE MGRSTM    @STM                                                CSW097
     C           @STM      LOKUPTABINT                   23                                   CSW097
      *                                                                                       CSW097
     C           *IN23     IFEQ '1'                                                           CSW097
     C                     MOVE *BLANKS   ZDEST                                               CSW097
     C                     MOVELSECN      ZDEST                                               CSW097
     C                     MOVEL*BLANKS   ACLINE                                              CSW097
     C                     MOVE ' '       TAG                                                 CSW097
     C                     MOVE '57'      FLDNO                                               CSW097
     C                     EXSR FSWAD                                                         CSW097
      *                                                                                       CSW097
      **  Unknown settlement method                                                           CSW097
     C                     ELSE                                                               CSW097
     C                     MOVE ':57D:'   MTAG                                                CSW097
     C                     MOVEL'UNKNOWN' MFLD                                                CSW097
     C                     ENDIF                                                              CSW097
      *                                                                                       CSW097
     C                     ENDIF                                                              CSW097
      *                                                                                       CSW201
     C                     ENDIF                                                              CSW201
     C                     MOVE *BLANK    ZDBEI                                               CSW201
      *                                                                                       CSW097
     C                     ENDSR                                                              CSW097
      *****************************************************************                       CSW097
     C/EJECT                                                                                  CSW097
      *****************************************************************                       CSW097
      *   SRPAY     - Format fields :53a:, :56a:, and :57a: in        *                       CSW097
      *               Seq. E (OUR).                                   *                       CSW097
      *   Called by - SETSEQ                                          *                       CSW097
      *   Calls     - FSWAD                                           *                       CSW097
      *****************************************************************                       CSW097
      *                                                                                       CSW097
     C           SRPAY     BEGSR                                                              CSW097
      *                                                                                       CSW201
      ** If Swift 2001 is on, output of Sender's Correspondent (53a),                         CSW201
      ** Intermediary (56a), and Account with Bank (57a) in Sequence E                        CSW201
      ** will not allow entry of BEIs.                                                        CSW201
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C                     MOVE 'Y'       ZDBEI                                               CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW097
      **  Field :53a: Delivery Agent                                                          CSW097
      ** (only if Swift 2001 is off or Payment amount <> zero)                                CSW201
      *                                                                                       CSW201
     C           CSW201    IFEQ 'N'                                                           CSW201
     C           Y1PAMT    ORNE *ZERO                                                         CSW201
      *                                                                                       CSW097
      **  Test if settlement via nostro                                                       CSW097
     C                     MOVE MGPSTM    @STM                                                CSW097
     C           @STM      LOKUPTABNST                   23                                   CSW097
      *                                                                                       CSW097
     C           MGPONS    IFNE *BLANKS                                                       CSW097
     C           *IN23     ANDEQ'1'                                                           CSW097
      *                                                                                       CSW097
      **  either A/C with Bank or Receipient entered                                          CSW097
      **  or A/C with A/c line = 'DIRECT'                                                     CSW097
      *                                                                                       CSW097
     C           MGAWBN    IFNE *BLANKS                                                       CSW097
     C           MGRVNO    ORNE *BLANKS                                                       CSW097
     C           AWBA6     ANDNE'DIRECT'                                                      CSW097
      *                                                                                       CSW097
     C           MGPSCY    IFNE *BLANK                                                        CSW097
     C                     MOVE MGPSCY    @NSKYB                                              CSW097
     C                     ELSE                                                               CSW097
     C                     MOVE @CCY      @NSKYB                                              CSW097
     C                     ENDIF                                                              CSW097
      *                                                                                       CSW097
     C                     MOVELMGPONS    @NSKYE                                              CSW097
     C                     CALL 'AONOSTR0'                                                    CSW097
     C                     PARM '*MSG   ' @RTCD   7                                           CSW097
     C                     PARM '*KEY   ' @OPTN   7                                           CSW097
     C                     PARM *BLANKS   @NSKYA  6                                           CSW097
     C                     PARM           @NSKYB  3                                           CSW097
     C**********           PARM *BLANKS   @NSKYC  4                                    CSW097 CGL029
     C                     PARM *BLANKS   @NSKYC                                              CGL029
     C                     PARM *BLANKS   @NSKYD  2                                           CSW097
     C                     PARM           @NSKYE  2                                           CSW097
     C                     PARM *BLANKS   @KEYF   3                                           CSW097
     C                     PARM *BLANKS   @KEYG  10                                           CSW097
     C                     PARM *BLANKS   @KEYH   1                                           CSW097
     C           SDNOST    PARM SDNOST    DSFDY                                               CSW097
      *                                                                                       CSW097
      **  Nostro customer not found                                                           CSW097
     C           @RTCD     IFNE *BLANKS                                                       CSW097
     C                     ADD  1         X                                                   CSW097
     C           X         OCUR MULT                                                          CSW097
     C                     MOVE 'Y'       @ERR                                                CSW097
     C                     MOVE ':53 :'   MTAG                                                CSW097
     C                     MOVELMGPONS    MFLD                                                CSW097
     C                     MOVELMSGA,3    MERR                                                CSW097
     C                     ELSE                                                               CSW097
      *                                                                                       CSW097
      ** Branch Internal Customer cf. Customer number of Our Pay Nostro                       CSW097
     C                     MOVELSECN      @SECN   6                                           CSW097
     C           @SECN     IFNE A7CUST                                                        CSW097
     C           MGAWBN    ANDNEA7CUST                                                        CSW097
     C                     ADD  1         X                                                   CSW097
     C           X         OCUR MULT                                                          CSW097
     C                     MOVE *BLANKS   ZDEST                                               CSW097
     C           MGRVNO    IFEQ *BLANKS                                                       CSW097
     C                     MOVELA7CUST    ZDEST                                               CSW097
     C                     ELSE                                                               CSW097
     C                     MOVELMGRVNO    ZDEST                                               CSW097
     C                     ENDIF                                                              CSW097
     C*********************CALL 'ZM0050'               15                              CSW097 CSW036
     C                     CALL 'ZM0051'               15                                     CSW036
     C                     PARM           ZDEST  12                                           CSW097
     C                     PARM           ZSADD1 35                                           CSW097
     C                     PARM           ZSADD2 35                                           CSW097
     C                     PARM           ZSADD3 35                                           CSW097
     C                     PARM           ZSADD4 35                                           CSW097
     C                     PARM           ZSTAG   1                                           CSW097
     C                     PARM           ZSTYPE  1                                           CSW097
     C                     PARM ' '       ZERR    1                                           CSW097
     C                     PARM           ZDBEI                                               CSW201
      *                                                                                       CSW097
     C           *IN15     IFEQ '1'                                                           CSW097
     C           *LOCK     IN   LDA                                                           CSW097
     C                     MOVE '020'     DBASE            * * * * * * * *                    CSW097
     C                     MOVEL'       ' DBKEY            *  DBERR 020  *                    CSW097
     C*********************MOVEL'ZM0050'  DBFILE           * * * * * * * *             CSW097 CSW036
     C                     MOVEL'ZM0051'  DBFILE           * * * * * * * *                    CSW036
     C                     OUT  LDA                                                           CSW097
     C                     EXSR *PSSR                                                         CSW097
     C                     ENDIF                                                              CSW097
      *                                                                                       CSW097
      **  Error when formating address                                                        CSW097
     C           ZERR      IFEQ '1'                                                           CSW097
     C                     MOVE 'Y'       @ERR                                                CSW097
     C                     MOVE ':53 :'   MTAG                                                CSW097
     C                     MOVELZDEST     MFLD                                                CSW097
     C                     MOVELMSGA,6    MERR                                                CSW097
     C                     ELSE                                                               CSW097
     C                     EXSR FMT53                                                         CSW097
     C                     ENDIF                                                              CSW097
     C                     ENDIF                           Cust. No differ                    CSW097
     C                     ENDIF                           Nostro exist                       CSW097
     C                     ENDIF                           A/C & recepient                    CSW097
     C                     ENDIF                           Pay nostro/set.                    CSW097
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW097
      **  Field :56a: and :57a: Receiving and benefciary inst.                                CSW097
      ** (only if Swift 2001 is off or Payment amount <> zero)                                CSW201
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C           Y1PAMT    ANDEQ*ZERO                                                         CSW201
     C                     ADD  1         X                                                   CSW201
     C           X         OCUR MULT                                                          CSW201
     C                     MOVE ':57D:'   MTAG                                                CSW201
     C                     MOVEL'NONE'    MFLD                                                CSW201
     C                     ELSE                                                               CSW201
      *                                                                                       CSW201
      ** Otherwise,                                                                           CSW201
      **  Nostro field blank                                                                  CSW097
      *                                                                                       CSW097
     C                     MOVE *BLANK    FLD57U  1                                           CSW097
     C           MGPSTM    IFEQ 00                                                            CSW097
     C                     ADD  1         X                                                   CSW097
     C           X         OCUR MULT                                                          CSW097
     C                     MOVE ':57D:'   MTAG                                                CSW097
     C                     MOVEL'UNKNOWN' MFLD                                                CSW097
     C                     MOVE 'Y'       FLD57U                                              CSW097
     C                     ENDIF                                                              CSW097
      *                                                                                       CSW097
      **  Field 57 Seq C is not UNKNOWN                                                       CSW097
     C           FLD57U    IFNE 'Y'                                                           CSW097
      *                                                                                       CSW097
      **  Field :57:  A/C with institution non-blank                                          CSW097
     C           MGAWBN    IFNE *BLANKS                                                       CSW097
      *                                                                                       CSW097
      **  Field :56:  Pay Intermediary bank                                                   CSW097
     C           MGPIBN    IFNE *BLANKS                                                       CSW097
     C                     ADD  1         X                                                   CSW097
     C           X         OCUR MULT                                                          CSW097
     C                     MOVE *BLANKS   ZDEST                                               CSW097
     C                     MOVELMGPIBN    ZDEST                                               CSW097
     C                     MOVEL*BLANKS   ACLINE                                              CSW097
     C                     MOVELMGPIBA    ACLINE                                              CSW097
     C                     MOVE ' '       TAG                                                 CSW097
     C                     MOVE '56'      FLDNO                                               CSW097
     C                     EXSR FSWAD                                                         CSW097
     C                     ENDIF                                                              CSW097
      *                                                                                       CSW097
      **  Format Account with institution                                                     CSW097
     C                     ADD  1         X                                                   CSW097
     C           X         OCUR MULT                                                          CSW097
     C                     MOVE *BLANKS   ZDEST                                               CSW097
     C                     MOVELMGAWBN    ZDEST                                               CSW097
     C                     MOVEL*BLANKS   ACLINE                                              CSW097
     C                     MOVELMGBENA    ACLINE                                              CSW097
     C                     MOVE ' '       TAG                                                 CSW097
     C                     MOVE '57'      FLDNO                                               CSW097
     C                     EXSR FSWAD                                                         CSW097
     C                     MOVE 'Y'       FLD57O  1                                           CSW097
      *                                                                                       CSW097
      **    A/C with Inst. blank                                                              CSW097
     C                     ELSE                                                               CSW097
      *                                                                                       CSW097
      *   Field 57 = pay nostro customer if settlement via '02' or '12'                       CSW097
      **  OR if A/c with Bank Account line set up as 'DIRECT'                                 CSW097
     C           MGPSTM    IFEQ 02                                                            CSW097
     C           MGPSTM    OREQ 12                                                            CSW097
     C           AWBA6     OREQ 'DIRECT'                                                      CSW097
      *                                                                                       CSW097
     C           MGPSCY    IFNE *BLANK                                                        CSW097
     C                     MOVE MGPSCY    @CYCD                                               CSW097
     C                     ELSE                                                               CSW097
     C                     MOVE @CCY      @CYCD                                               CSW097
     C                     ENDIF                                                              CSW097
      *                                                                                       CSW097
     C                     MOVELMGPONS    @NONB                                               CSW097
     C                     CALL 'AONOSTR0'                                                    CSW097
     C                     PARM '*MSG   ' @RTCD   7                                           CSW097
     C                     PARM '*KEY   ' @OPTN   7                                           CSW097
     C                     PARM *BLANKS   @CUST   6                                           CSW097
     C                     PARM           @CYCD   3                                           CSW097
     C**********           PARM *BLANKS   @ACCD   4                                    CSW097 CGL029
     C                     PARM *BLANKS   @ACCD  10                                           CGL029
     C                     PARM *BLANKS   @ACSN   2                                           CSW097
     C                     PARM           @NONB   2                                           CSW097
     C                     PARM *BLANKS   @BRCD   3                                           CSW097
     C                     PARM *BLANKS   @CSSN  10                                           CSW097
     C                     PARM *BLANKS   @PNOI   1                                           CSW097
     C           SDNOST    PARM SDNOST    DSFDY                                               CSW097
      *                                                                                       CSW097
      **  Nostro customer not found                                                           CSW097
      *                                                                                       CSW097
     C           @RTCD     IFNE *BLANKS                                                       CSW097
     C                     MOVE 'Y'       @ERR                                                CSW097
     C                     ADD  1         X                                                   CSW097
     C           X         OCUR MULT                                                          CSW097
     C                     MOVELMGPONS    HLD2    2                                           CSW097
     C                     MOVEL@CCY      HLD5                                                CSW097
     C                     MOVE HLD2      HLD5    5                                           CSW097
     C                     MOVELHLD5      MFLD                                                CSW097
     C                     MOVELMSGA,3    MERR                                                CSW097
     C                     MOVE ':57 :'   MTAG                                                CSW097
     C                     ELSE                                                               CSW097
      *                                                                                       CSW097
      **  Format our Pay Nostro Customer Address                                              CSW097
      *                                                                                       CSW097
     C                     ADD  1         X                                                   CSW097
     C           X         OCUR MULT                                                          CSW097
     C                     MOVE *BLANKS   ZDEST                                               CSW097
     C           MGRVNO    IFEQ *BLANKS                                                       CSW097
     C                     MOVELA7CUST    ZDEST                                               CSW097
     C                     ELSE                                                               CSW097
     C                     MOVELMGRVNO    ZDEST                                               CSW097
     C                     ENDIF                                                              CSW097
     C                     MOVEL*BLANKS   ACLINE                                              CSW097
     C                     MOVE ' '       TAG                                                 CSW097
     C                     MOVE '57'      FLDNO                                               CSW097
     C                     EXSR FSWAD                                                         CSW097
     C                     ENDIF                                                              CSW097
      *                                                                                       CSW097
     C                     ELSE                                                               CSW097
     C                     MOVE MGPSTM    @STM                                                CSW097
     C           @STM      LOKUPTABINT                   23                                   CSW097
      *                                                                                       CSW097
     C           *IN23     IFEQ '1'                                                           CSW097
     C                     ADD  1         X                                                   CSW097
     C           X         OCUR MULT                                                          CSW097
     C                     MOVE *BLANKS   ZDEST                                               CSW097
     C                     MOVELSECN      ZDEST                                               CSW097
     C                     MOVEL*BLANKS   ACLINE                                              CSW097
     C                     MOVE ' '       TAG                                                 CSW097
     C                     MOVE '57'      FLDNO                                               CSW097
     C                     EXSR FSWAD                                                         CSW097
      *                                                                                       CSW097
     C                     ELSE                                                               CSW097
      *                                                                                       CSW097
      **  Field 53 is equal to Our Pay Nostro                                                 CSW097
      *                                                                                       CSW097
     C           MGPSCY    IFNE *BLANK                                                        CSW097
     C                     MOVE MGPSCY    @NSKYB                                              CSW097
     C                     ELSE                                                               CSW097
     C                     MOVE @CCY      @NSKYB                                              CSW097
     C                     ENDIF                                                              CSW097
      *                                                                                       CSW097
     C                     MOVELMGPONS    @NSKYE                                              CSW097
     C                     CALL 'AONOSTR0'                                                    CSW097
     C                     PARM '*MSG   ' @RTCD   7                                           CSW097
     C                     PARM '*KEY   ' @OPTN   7                                           CSW097
     C                     PARM *BLANKS   @NSKYA  6                                           CSW097
     C                     PARM           @NSKYB  3                                           CSW097
     C**********           PARM *BLANKS   @NSKYC  4                                    CSW097 CGL029
     C                     PARM *BLANKS   @NSKYC                                              CGL029
     C                     PARM *BLANKS   @NSKYD  2                                           CSW097
     C                     PARM           @NSKYE  2                                           CSW097
     C                     PARM *BLANKS   @KEYF   3                                           CSW097
     C                     PARM *BLANKS   @KEYG  10                                           CSW097
     C                     PARM *BLANKS   @KEYH   1                                           CSW097
     C           SDNOST    PARM SDNOST    DSFDY                                               CSW097
      *                                                                                       CSW097
      **  Nostro customer not found                                                           CSW097
     C           @RTCD     IFNE *BLANKS                                                       CSW097
     C                     ADD  1         X                                                   CSW097
     C           X         OCUR MULT                                                          CSW097
     C                     MOVE 'Y'       @ERR                                                CSW097
     C                     MOVE ':53 :'   MTAG                                                CSW097
     C                     MOVELMGPONS    MFLD                                                CSW097
     C                     MOVELMSGA,3    MERR                                                CSW097
     C                     ELSE                                                               CSW097
      *                                                                                       CSW097
      **  Format our Pay Nostro Customer Address                                              CSW097
      *      ( only if Tag 53A not yet generated )                                            CSW097
      *                                                                                       CSW097
     C           *IN55     IFEQ '1'                                                           CSW097
     C                     MOVE '0'       *IN55                                               CSW097
     C                     ELSE                                                               CSW097
     C                     ADD  1         X                                                   CSW097
     C           X         OCUR MULT                                                          CSW097
     C                     MOVE *BLANKS   ZDEST                                               CSW097
     C                     MOVELA7CUST    ZDEST                                               CSW097
     C                     MOVEL*BLANKS   ACLINE                                              CSW097
     C                     MOVE ' '       TAG                                                 CSW097
     C                     MOVE '53'      FLDNO                                               CSW097
     C                     EXSR FSWAD                                                         CSW097
     C                     ENDIF                                                              CSW097
     C                     ENDIF                                                              CSW097
      *                                                                                       CSW097
      **  Settlement 01,07 or 08 with MGAWBN blank or settlement 00                           CSW097
      *                                                                                       CSW097
     C                     ADD  1         X                                                   CSW097
     C           X         OCUR MULT                                                          CSW097
     C                     MOVE ':57D:'   MTAG                                                CSW097
     C                     MOVEL'UNKNOWN' MFLD                                                CSW097
      *                                                                                       CSW097
     C                     ENDIF                                                              CSW097
     C                     ENDIF                                                              CSW097
     C                     ENDIF                                                              CSW097
     C                     ENDIF                                                              CSW097
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     MOVE *BLANK    ZDBEI                                               CSW201
      *                                                                                       CSW097
     C                     ENDSR                                                              CSW097
      *****************************************************************                       CSW097
     C/EJECT                                                                                  CSW097
      *****************************************************************                       CSW097
      *   FMT53 - Format Field 53 address                             *                       CSW097
      *   Called by   SREXST                                          *                       CSW097
      *   Calls       - AOCUSTR0                                      *                       CSW097
      *****************************************************************                       CSW097
      *                                                                                       CSW097
     C           FMT53     BEGSR                                                              CSW097
      *                                                                                       CSW097
      **  A Type address                                                                      CSW097
     C           ZSTAG     IFEQ 'A'                                                           CSW097
     C                     MOVE ':53A:'   MTAG                                                CSW097
     C                     MOVELZSADD1    MFLD                                                CSW097
     C                     MOVE '1'       *IN55                                               CSW097
      *                                                                                       CSW097
     C                     ELSE                                                               CSW097
      *                                                                                       CSW097
      **  Access SDCUSTPD using our pay nostro customer number                                CSW097
     C                     MOVE *BLANKS   @KEY1                                               CSW097
     C                     MOVELA7CUST    @KEY1                                               CSW097
     C                     CALL 'AOCUSTR0'                                                    CSW097
     C                     PARM '*MSG   ' @RTCD                                               CSW097
     C                     PARM '*KEY   ' @OPTN                                               CSW097
     C                     PARM           @KEY1  10                                           CSW097
     C                     PARM *BLANKS   @KYST   7                                           CSW097
     C           SDCUST    PARM SDCUST    DSSDY                                               CSW097
      *                                                                                       CSW097
      ** Customer record not found - Error                                                    CSW097
     C           @RTCD     IFNE *BLANKS                                                       CSW097
     C                     MOVE 'Y'       @ERR                                                CSW097
     C                     MOVE ':53 :'   MTAG                                                CSW097
     C                     MOVELA7CUST    MFLD                                                CSW097
     C                     MOVE MSGA,2    MERR                                                CSW097
      *                                                                                       CSW097
     C                     ELSE                                                               CSW097
      *                                                                                       CSW097
      **  B Type address                                                                      CSW097
     C**********           MOVE BBPCNB    @PCNB   60                                   CSW097 CSD027
     C                     MOVE BBPCNB    @PCNB   6                                           CSD027
     C           SPAIN     IFEQ 'P'                                                           CSW097
     C           @PCNB     ANDEQSECN                                                          CSW097
     C           BBPAIN    OREQ 'P'                                                           CSW097
     C           A7CUST    ANDEQSPCNB                                                         CSW097
     C           BBPCNB    OREQ SPCNB                                                         CSW097
     C           BBPCNB    ANDNE*BLANKS                                                       CSW097
      *                                                                                       CSW097
     C                     MOVE ':53B:'   MTAG                                                CSW097
     C                     MOVE *BLANKS   @WRK                                                CSW097
     C                     MOVEABBCRNM    @WRK,1                                              CSW097
     C                     Z-ADD22        J       20                                          CSW097
     C                     MOVEABBCRTN    @WRK,J                                              CSW097
     C                     MOVEA@WRK      MFLD                                                CSW097
      *                                                                                       CSW097
      **  D Type address                                                                      CSW097
     C                     ELSE                                                               CSW097
     C                     MOVE ':53D:'   MTAG                                                CSW097
     C                     MOVELZSADD1    MFLD                                                CSW097
      **  Address 2                                                                           CSW097
     C           ZSADD2    IFNE *BLANKS                                                       CSW097
     C                     ADD  1         X                                                   CSW097
     C           X         OCUR MULT                                                          CSW097
     C                     MOVELZSADD2    MFLD                                                CSW097
     C                     ENDIF                           D address 2                        CSW097
      **  Address 3                                                                           CSW097
     C           ZSADD3    IFNE *BLANKS                                                       CSW097
     C                     ADD  1         X                                                   CSW097
     C           X         OCUR MULT                                                          CSW097
     C                     MOVELZSADD3    MFLD                                                CSW097
     C                     ENDIF                           D address 3                        CSW097
      **  Address 4                                                                           CSW097
     C           ZSADD4    IFNE *BLANKS                                                       CSW097
     C                     ADD  1         X                                                   CSW097
     C           X         OCUR MULT                                                          CSW097
     C                     MOVELZSADD4    MFLD                                                CSW097
     C                     ENDIF                           D address 4                        CSW097
      *                                                                                       CSW097
     C                     ENDIF                           B/D address 1                      CSW097
      *                                                                                       CSW097
     C                     ENDIF                           Cust. error?                       CSW097
      *                                                                                       CSW097
     C                     ENDIF                           A/B/D address?                     CSW097
      *                                                                                       CSW097
     C                     ENDSR                                                              CSW097
      *****************************************************************                       CSW097
      *****************************************************************
      *   SR1190 - Format fields :37P:, :37R: and :37U: using         *
      *            standard program ZM1190                            *
      *   Called by - RFXSEQ                                          *
      *****************************************************************
      *
     C           SR1190    BEGSR
      *
     C                     MOVE *BLANKS   ZSPRIC 16
     C                     MOVE *BLANKS   ZOPRIC 21
     C                     Z-ADDZPRIC     WPRIC  117
      *
     C                     CALL 'ZM1190'               28
     C                     PARM           ZPRIC
     C                     PARM           ZSPRIC
     C                     PARM           ZOPRIC
      *
      ** If program is not found, then dbase error.
      *
     C           *IN28     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '017'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 017  *
     C                     MOVEL'ZM1190'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
     C           WPRIC     IFLT 0
     C           'N'       CAT  ZSPRIC:0  MFLD
     C                     ELSE
     C                     MOVELZSPRIC    MFLD
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   REPT - print incorrectly generated messages                 *
      *   Called by - main process                                    *
      *****************************************************************
      *
     C           REPT      BEGSR
      *
      ** If MG0362P1 has not previously opened.
      *
     C           *IN50     IFEQ '0'
     C                     OPEN MG0362P1
     C                     MOVE *ON       *IN50
     C                     END
      *
     C                     WRITEHEADER
     C                     WRITETEXT
      *
      **  Process multiple occurrence data structure
      *
     C                     Z-ADD0         I       20
     C           I         DOWLEX
     C                     ADD  1         I
     C           I         OCUR MULT
     C                     WRITELINE
     C                     ENDDO
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   OMSG - output correctly generated messages                  *
      *   Called by - main process                                    *
      *   Calls - WREF Write o/p reference to PF/MGOREFPD.            *
      *****************************************************************
      *
     C           OMSG      BEGSR
      *
      **  Write reference record to PF/MGOREFPD.
      *
     C                     EXSR WREF
      *
      **  Write multiple occurrence data structure to MGOMSGPD
      *
     C                     Z-ADDX         LIMIT   30                                          CSW097
     C**********           Z-ADD1         X       20                                          189455
     C                     Z-ADD1         X                                                   189455
     C           X         OCUR MULT
      *
     C           MTAG      LOKUP@ATAG                    33
      *
      ** Write record to MGOMSGPD only if field is not blank,
      ** or field is blank and tag is formatted really with blanks.
      *
     C***********X         DOWLE40                                                            CSW097
     C           X         DOWLELIMIT                                                         CSW097
     C           *IN33     ANDEQ'1'
     C***********X         ORLE 40                                                            CSW097
     C           X         ORLE LIMIT                                                         CSW097
     C           *IN33     ANDEQ'0'
     C           MFLD      ANDNE*BLANKS
      *
     C                     WRITEMGOMSGD0               06
      *
      **  Error on write to PF/MGOMSGPD (message data file)
      *
     C           *IN06     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '018'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 018  *
     C                     MOVEL'MGOMSGPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C           MTAG      LOKUP@ATAG                    33
      *
     C                     ENDDO
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   WREF - Write reference record to PF/MGOREFPD                *
      *   Called by - OMSG  output message PF/MGOMSGPD                *
      *****************************************************************
      *
     C           WREF      BEGSR
      *
     C                     MOVE *BLANKS   SYTM
     C                     MOVE MGMODI    MODI
     C                     MOVE @TRNA     TRNO
     C                     MOVE *BLANKS   TRNF
     C                     MOVE *BLANKS   TRNM
     C                     MOVELMGTNUM    MTRN
     C                     MOVE MGTTYP    TNTP
     C                     MOVE MGTSTP    SBTP
     C                     MOVE MGEVTP    EVTP
     C                     MOVEL*BLANKS   NWBN
     C                     MOVE '362'     MTPY
     C                     MOVE 'N'       MPRY
     C                     MOVELCWRD      LSCC
     C                     MOVEL*BLANKS   PTST
     C                     MOVEL*BLANKS   CARQ
     C                     MOVEL*BLANKS   MPDE
     C                     MOVEL@HRDT     HRDT
     C                     TIME           MGTM
     C                     MOVE BJMRDT    LADT
     C                     MOVE MGTM      LATM
     C                     Z-ADDMGAVDT    AVDT
      *                                                                                       CSD015
      ** Check if message type exists in the watch list                                       CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           222385
     C           W1EWLC    ANDEQ'Y'                                                           222385
     C           CSW025    ANDEQ'N'                                                           CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *
     C           MGST      IFEQ 'RSND'
     C                     MOVE BJMRDT    RELD
     C                     MOVE MGTM      RELT
     C                     MOVE '2'       MGSG
     C                     END
     C           MGST      IFEQ 'CRTD'
     C                     MOVE '1'       MGSG
     C                     END
     C           MGST      IFEQ 'PRTD'
     C                     MOVE '3'       MGSG
     C                     END
      *
     C                     MOVEL*BLANKS   RUSR
     C                     MOVEL*BLANKS   RWSN
     C                     MOVEL*BLANKS   AMTS
     C                     MOVEL*BLANKS   AMTX
     C                     MOVEL*BLANKS   SVDT
     C                     MOVEL*BLANKS   CINDV                           184718
     C                     MOVEL*BLANKS   CCY
     C                     MOVEL*BLANKS   NSNO
     C                     MOVEL*BLANKS   SACN
     C                     MOVEL*BLANKS   AORR
     C                     MOVEL*BLANKS   DESI
      *
      **  Branch details
      *
     C                     MOVE MGBRCA    BRCA
     C                     MOVE MGPOBR    OTHB
     C           OTHB      IFNE *BLANKS
     C                     MOVELMSGA,1    OTHT
     C                     END
     C                     MOVE MGROBR    RCBR
      *
     C                     MOVE *BLANKS   NETI
     C                     MOVE *BLANKS   DELC
     C                     MOVE *BLANKS   DYST
     C                     MOVE *BLANKS   RSID
     C                     MOVE *BLANKS   MSE1
     C                     MOVE *BLANKS   ELIN
     C                     MOVE *BLANKS   SSAC
     C                     MOVE *BLANKS   MIR
     C                     MOVE *BLANKS   TSKS
     C                     MOVE *BLANKS   TSKY
     C                     MOVE MGCHTP    AORR                                                CSW025
     C/COPY WNCPYSRC,MG0362C003
      *
     C                     WRITEMGOREFD0               05
      *
      **  Error on write to PF/MGOREFPD (message reference file)
      *
     C           *IN05     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '019'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 019  *
     C                     MOVEL'MGOREFPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      ** Write transaction history record                                                     190127
      ** (only if Swift 2001 is off)                                                          CSW201
      *                                                                                       CSW201
     C                     MOVELTRNO      @HREF                                               190127
     C                     MOVE '362'     HSMTPY                                              190127
     C                     MOVE MGEVTP    HSEVTP                                              CSW201
     C                     MOVE *BLANK    HSCANC                                              CSW201
      *                                                                                       190127
     C           CSW201    IFEQ 'N'                                                           CSW201
     C                     WRITEMGHISTD0               56                                     190127
      *                                                                                       190127
      **  Error on write to PF/MGHISTPD                                                       190127
     C           *IN56     IFEQ '1'                                                           190127
     C           *LOCK     IN   LDA                                                           190127
     C                     MOVE '027'     DBASE            * * * * * * * *                    190127
     C                     MOVEL'       ' DBKEY            *  DBERR 027  *                    190127
     C                     MOVEL'MGHISTPD'DBFILE           * * * * * * * *                    190127
     C                     OUT  LDA                                                           190127
     C                     EXSR *PSSR                                                         190127
     C                     END                                                                190127
     C                     ENDIF                                                              CSW201
      *
     C                     ENDSR
     C/COPY WNCPYSRC,MG0362C004
      /EJECT
      *****************************************************************
      *   FSWAD - Format SWIFT address                                *
      *   Called by - FMTB  - Format field  :57a:                     *
      *               FMTC  - Format field  :57a:                     *
      *****************************************************************
      *
     C           FSWAD     BEGSR
      *
     C*********************CALL 'ZM0050'                                                      CSW036
     C                     CALL 'ZM0051'                                                      CSW036
     C                     PARM           ZDEST  12
     C                     PARM           ZSADD1 35
     C                     PARM           ZSADD2 35
     C                     PARM           ZSADD3 35
     C                     PARM           ZSADD4 35
     C                     PARM           ZSTAG   1
     C                     PARM           ZSTYPE  1
     C                     PARM           ZERR    1
     C                     PARM           ZDBEI                                               CSW201
      *
      ** Error ?
      *
     C           ZERR      IFEQ '1'
     C                     MOVE 'Y'       @ERR
     C                     MOVE @MTAG     MTAG
     C                     MOVELZDEST     MFLD
     C                     MOVELMSGA,6    MERR
     C                     ELSE
      *
      ** Address 1
      *
     C           ACLINE    IFNE *BLANKS
     C                     MOVELACLINE    MFLD
     C                     ELSE
     C                     MOVELZSADD1    MFLD
     C                     END
      *
      ** SWIFT address;  Else full address.
      *
     C           ZSTAG     IFEQ 'A'
     C                     MOVE 'A'       TAG
     C                     MOVE @MTAG     MTAG
     C           ACLINE    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD1    MFLD
     C                     END
      *
     C                     ELSE
     C                     MOVE 'D'       TAG
     C                     MOVE @MTAG     MTAG
     C           ACLINE    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD1    MFLD
     C                     END
      *
      **  Address 2
      *
     C           ZSADD2    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD2    MFLD
     C                     END                             Address 2
      *
      **  Address 3
      *
     C           ZSADD3    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD3    MFLD
     C                     END                             Address 3
      *
      **  Address 4
      *
     C           ZSADD4    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD4    MFLD
     C                     END                             Address 4
     C                     END                             Address 1
      *
     C                     END                             Error ?
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   FLD72 - Format Field 72 (Sender to Receiver Information)    *
      *   Called by - Main process                                    *
      *   Calls     -                                                 *
      *****************************************************************
      *
     C           FLD72     BEGSR
      *
      ** Store the Sender to Receiver information for easier use.
      *
     C                     MOVE MGS2R1    SR2F,1
     C                     MOVE MGS2R2    SR2F,2
     C                     MOVE MGS2R3    SR2F,3
     C                     MOVE MGS2R4    SR2F,4
     C                     MOVE MGS2R5    SR2F,5
     C                     MOVE MGS2R6    SR2F,6
      *
     C                     Z-ADD0         I
     C                     MOVE 'N'       FLD72O  1
      *
      ** Search through all six fields & output if not blank.
      *
     C           I         DOWLT6
      *
     C                     ADD  1         I
     C           SR2F,I    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C           FLD72O    IFEQ 'N'
     C                     MOVE ':72: '   MTAG
     C                     MOVE 'Y'       FLD72O
     C                     ENDIF
     C                     MOVELSR2F,I    MFLD
     C                     ENDIF
      *
     C                     ENDDO
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************   CCF003
      *   CFMAT - produce confirmation matching feedback record       *   CCF003
      *   Called by - Main process                                    *   CCF003
      *   Calls       -                                               *   CCF003
      *****************************************************************   CCF003
      *                                                                   CCF003
     C           CFMAT     BEGSR                                          CCF003
      *                                                                   CCF003
     C                     CALL 'MG5001'                                  CCF003
     C                     PARM TRNO      @TRNM  16                       CCF003
     C                     PARM MGBRCA    @BRCA   3                       CCF003
     C                     PARM *BLANK    @FEED   1                       CCF003
      *                                                                   CCF003
     C           @FEED     IFEQ 'Y'                                       CCF003
      *                                                                   CCF003
     C           *IN50     IFEQ '0'                                       CCF003
     C                     OPEN MG0362P1                                  CCF003
     C                     SETON                     50U7                 CCF003
     C                     END                                            CCF003
      *                                                                   CCF003
      ** Set up headings and sender/customer information                  CCF003
      ** for the error report.                                            CCF003
      *                                                                   CCF003
     C                     MOVELMGTNUM    TNUM    60                      CCF003
     C                     WRITEHEADER                                    CCF003
     C                     WRITETEXT                                      CCF003
     C                     WRITEFEED                                      CCF003
     C                     END                                            CCF003
      *                                                                   CCF003
     C                     ENDSR                                          CCF003
      /EJECT                                                                                  CSW201
      *****************************************************************                       CSW201
      *                                                               *                       CSW201
      *  SRWREF - Write reference record to MGOREFPD for MT362        *                       CSW201
      *           cancellation message                                *                       CSW201
      *                                                               *                       CSW201
      *****************************************************************                       CSW201
      *                                                                                       CSW201
     C           SRWREF    BEGSR                                                              CSW201
      *                                                                                       CSW201
      ** Increment Last Swift Sequence and setup Transaction number                           CSW201
      *                                                                                       CSW201
     C                     MOVEA*BLANKS   @WRK                                                CSW201
     C                     MOVEAMGMODI    @WRK                                                CSW201
     C                     MOVEAWTRAN     @WRK,3                                              CSW201
     C                     ADD  1         HLSWS                                               CSW201
     C                     MOVE HLSWS     HSWS                                                CSW201
     C           ' '       LOKUP@WRK,Z                   31                                   CSW201
     C                     MOVEAHSWS      @WRK,Z                                              CSW201
      *                                                                                       CSW201
      ** Write new record using same details of the cancelled message                         CSW201
      *                                                                                       CSW201
     C                     MOVEA@WRK      TRNO                                                CSW201
     C                     MOVE MSYTM     SYTM                                                CSW201
     C                     MOVE MMODI     MODI                                                CSW201
     C                     MOVE *BLANKS   TRNF                                                CSW201
     C                     MOVE *BLANKS   TRNM                                                CSW201
     C                     MOVE MMTRN     MTRN                                                CSW201
     C                     MOVE MTNTP     TNTP                                                CSW201
     C                     MOVE MSBTP     SBTP                                                CSW201
     C                     MOVE MEVTP     EVTP                                                CSW201
     C**********           Z-ADDMSECN     SECN                                         CSW201 CSD027
     C                     MOVE MSECN     SECN                                                CSD027
     C                     MOVE MNWSN     NWSN                                                CSW201
     C**********           Z-ADDMDECN     DECN                                         CSW201 CSD027
     C                     MOVE MDECN     DECN                                                CSD027
     C                     MOVE MNWDS     NWDS                                                CSW201
     C                     MOVE MNWBN     NWBN                                                CSW201
     C                     MOVE '362'     MTPY                                                CSW201
     C                     MOVE 'N'       MPRY                                                CSW201
     C                     MOVE '1'       MGSG                                                CSW201
     C                     MOVE 'CRTD'    MGST                                                CSW201
     C                     MOVE *BLANKS   LSCC                                                CSW201
     C                     MOVE *BLANKS   F57U                                                CSW201
     C                     MOVE *BLANKS   PTST                                                CSW201
     C                     MOVE *BLANKS   CARQ                                                CSW201
     C                     MOVE *BLANKS   MPDE                                                CSW201
     C                     TIME           MGTM                                                CSW201
     C                     MOVE BJMRDT    LADT                                                CSW201
     C                     MOVE MGTM      LATM                                                CSW201
     C                     MOVE *BLANKS   RELD                                                CSW201
     C                     MOVE *BLANKS   RELT                                                CSW201
     C                     MOVE *BLANKS   RUSR                                                CSW201
     C                     MOVE *BLANKS   RWSN                                                CSW201
     C                     MOVE MAMTX     AMTX                                                CSW201
     C                     MOVE MAMTS     AMTS                                                CSW201
     C                     MOVE MSVDT     SVDT                                                CSW201
     C                     MOVE MCCY      CCY                                                 CSW201
     C                     Z-ADDMNSNO     NSNO                                                CSW201
     C                     MOVE MSACN     SACN                                                CSW201
     C                     MOVE MAORR     AORR                                                CSW201
     C                     MOVE MDESI     DESI                                                CSW201
     C                     MOVE MBRCA     BRCA                                                CSW201
     C                     MOVE MOTHB     OTHB                                                CSW201
     C                     MOVE MRCBR     RCBR                                                CSW201
     C                     MOVE MOTHT     OTHT                                                CSW201
     C                     MOVE MNETI     NETI                                                CSW201
     C                     MOVE MDELC     DELC                                                CSW201
     C                     MOVE *BLANKS   DYST                                                CSW201
     C                     MOVE MRSID     RSID                                                CSW201
     C                     MOVE *BLANKS   MSE1                                                CSW201
     C                     MOVE *BLANKS   ELIN                                                CSW201
     C                     MOVE *BLANKS   SSAC                                                CSW201
     C                     MOVE MMIR      MIR                                                 CSW201
     C                     MOVE *BLANKS   TSKS                                                CSW201
     C                     MOVE *BLANKS   TSKY                                                CSW201
     C                     Z-ADD*ZERO     TSEQ                                                CSW201
     C                     Z-ADD*ZEROS    PT210                                               CSW201
     C                     Z-ADDMAVDT     AVDT                                                CSW201
     C                     Z-ADD*ZEROS    ASEQ                                                CSW201
     C                     MOVE *BLANKS   CLSS                                                CSW201
      *                                                                                       CSW201
     C                     MOVE MGCHTP    AORR                                                CSW025
     C                     WRITEMGOREFD0               05                                     CSW201
      *                                                                                       CSW201
     C           *IN05     IFEQ *ON                                                           CSW201
     C           *LOCK     IN   LDA                                                           CSW201
     C                     Z-ADD031       DBASE                                               CSW201
     C                     MOVE *BLANKS   DBKEY                                               CSW201
     C                     MOVEL'MGOREFPD'DBFILE                                              CSW201
     C                     OUT  LDA                                                           CSW201
     C                     EXSR *PSSR                                                         CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     ENDSR                                                              CSW201
      /EJECT                                                                                  CSW201
      *****************************************************************                       CSW201
      *                                                               *                       CSW201
      *  SROMSG - Write multiple occurrence data structure to         *                       CSW201
      *           MGOMSGPD for the MT362 cancellation message         *                       CSW201
      *                                                               *                       CSW201
      *****************************************************************                       CSW201
      *                                                                                       CSW201
     C           SROMSG    BEGSR                                                              CSW201
      *                                                                                       CSW201
     C           WCTRNO    CHAINMGOMSGA              80                                       CSW201
      *                                                                                       CSW201
     C           *IN80     IFEQ *ON                                                           CSW201
     C           *LOCK     IN   LDA                                                           CSW201
     C                     Z-ADD032       DBASE                                               CSW201
     C                     MOVELWCTRNO    DBKEY                                               CSW201
     C                     MOVEL'MGOMSGLA'DBFILE                                              CSW201
     C                     OUT  LDA                                                           CSW201
     C                     EXSR *PSSR                                                         CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     Z-ADD*ZERO     X                                                   CSW201
      *                                                                                       CSW201
      ** Set Related Reference tag :21: = transaction number of the                           CSW201
      ** cancelled message. Set Type of Operation tag :22A: = 'CANC'                          CSW201
      *                                                                                       CSW201
     C           *IN80     DOWEQ*OFF                                                          CSW201
     C                     ADD  1         X                                                   CSW201
     C           X         OCUR MULT                                                          CSW201
     C                     SELEC                                                              CSW201
     C           LAMTAG    WHEQ ':20: '                                                       CSW201
     C                     MOVELTRNO      MFLD                                                CSW201
     C           LAMTAG    WHEQ ':22A:'                                                       CSW201
     C                     MOVEL'CANC '   MFLD                                                CSW201
     C                     OTHER                                                              CSW201
     C                     MOVELLAMFLD    MFLD                                                CSW201
     C                     ENDSL                                                              CSW201
     C                     MOVELLAMTAG    MTAG                                                CSW201
     C           MTAG      IFEQ ':20: '                                                       CSW201
     C                     ADD  1         X                                                   CSW201
     C           X         OCUR MULT                                                          CSW201
     C                     MOVEL':21: '   MTAG                                                CSW201
     C                     MOVELWCTRNO    MFLD                                                CSW201
     C                     ENDIF                                                              CSW201
     C           WCTRNO    READEMGOMSGA                  80                                   CSW201
     C                     ENDDO                                                              CSW201
      *                                                                                       CSW201
      ** Write multiple occurrence data structure                                             CSW201
      *                                                                                       CSW201
     C                     Z-ADDX         LIMIT                                               CSW201
     C                     Z-ADD1         X                                                   CSW201
     C           X         OCUR MULT                                                          CSW201
     C           MTAG      LOKUP@ATAG                    33                                   CSW201
      *                                                                                       CSW201
     C           X         DOWLELIMIT                                                         CSW201
     C           *IN33     ANDEQ'1'                                                           CSW201
     C           X         ORLE LIMIT                                                         CSW201
     C           *IN33     ANDEQ'0'                                                           CSW201
     C           MFLD      ANDNE*BLANKS                                                       CSW201
      *                                                                                       CSW201
     C                     WRITEMGOMSGD0               06                                     CSW201
     C           *IN06     IFEQ *ON                                                           CSW201
     C           *LOCK     IN   LDA                                                           CSW201
     C                     Z-ADD033       DBASE                                               CSW201
     C                     MOVE *BLANKS   DBKEY                                               CSW201
     C                     MOVEL'MGOMSGPD'DBFILE                                              CSW201
     C                     OUT  LDA                                                           CSW201
     C                     EXSR *PSSR                                                         CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     ADD  1         X                                                   CSW201
     C           X         OCUR MULT                                                          CSW201
     C           MTAG      LOKUP@ATAG                    33                                   CSW201
     C                     ENDDO                                                              CSW201
      *                                                                                       CSW201
     C                     ENDSR                                                              CSW201
      *****************************************************************                       CSW201
      /EJECT                                                                                  CSW201
      *****************************************************************                       CSW201
      *                                                               *                       CSW201
      *  SRCANC - Produce an MT362 cancellation message               *                       CSW201
      *           If Change type is 'A' and there is a message in     *                       CSW201
      *           MGHISTPD that was not used as reference, then       *                       CSW201
      *           produce an MT362 cancellation with the details of   *                       CSW201
      *           this message.                                       *                       CSW201
      *                                                               *                       CSW201
      *****************************************************************                       CSW201
      *                                                                                       CSW201
     C           SRCANC    BEGSR                                                              CSW201
      *                                                                                       CSW201
      ** Perform cancellation processing for all first transactions read.                     CSW201
      *                                                                                       CSW201
     C           1         DO   WF        WJ                                                  CSW201
     C                     MOVEAFTN,WJ    WFTRN                                               CSW201
     C                     MOVE *BLANKS   WLTRNO 16                                           CSW201
      *                                                                                       CSW201
     C           WFTRN     SETLLMGHIST2                                                       CSW201
     C           WFTRN     READEMGHIST2                  80                                   CSW201
      *                                                                                       CSW201
     C           *IN80     DOWEQ*OFF                                                          CSW201
      *                                                                                       CSW201
      ** Check if first transaction is referenced by another                                  CSW201
      ** message, if yes, bypass writing of cancellation message.                             CSW201
      *                                                                                       CSW201
     C                     MOVE M2TRAN    WTRAN                                               CSW201
     C                     Z-ADDM2PDAT    WFPDAT                                              CSW201
     C                     MOVE M2MSSQ    WFMSSQ                                              CSW201
     C                     MOVE M2EVTP    WFEVTP                                              CSW201
     C           KHIST1    SETLLMGHIST1                                                       CSW201
     C           KHIST1    READEMGHIST1                  80                                   CSW201
     C                     MOVE 'Y'       WCANC   1                                           CSW201
     C           *IN80     DOWEQ*OFF                                                          CSW201
     C           M1FTRN    IFNE WFTRN                                                         CSW201
     C           M1FTRN    LOKUPFTN                      31                                   CSW201
     C           *IN31     IFEQ *ON                                                           CSW201
     C                     MOVE 'N'       WCANC                                               CSW201
     C                     LEAVE                                                              CSW201
     C                     ENDIF                                                              CSW201
     C                     ENDIF                                                              CSW201
     C           KHIST1    READEMGHIST1                  80                                   CSW201
     C                     ENDDO                                                              CSW201
      *                                                                                       CSW201
     C           WCANC     IFEQ 'Y'                                                           CSW201
      *                                                                                       CSW201
     C                     MOVE *BLANKS   WCTRNO 16                                           CSW201
     C           M2MODI    CAT  M2TRAN    WCHR08                                              CSW201
     C           WCHR08    CAT  M2SEQ:0   WCTRNO                                              CSW201
      *                                                                                       CSW201
     C           WCTRNO    IFNE WLTRNO                                                        CSW201
     C           WCTRNO    LOKUPTRN                      31                                   CSW201
      *                                                                                       CSW201
     C           *IN31     IFEQ *OFF                                                          CSW201
      *                                                                                       CSW201
      ** Retrieve details of message to be cancelled                                          CSW201
      *                                                                                       CSW201
     C           WCTRNO    CHAINMGREFL0              80                                       CSW201
      *                                                                                       CSW201
     C           *IN80     IFEQ *ON                                                           CSW201
     C           *LOCK     IN   LDA                                                           CSW201
     C                     Z-ADD030       DBASE                                               CSW201
     C                     MOVELWCTRNO    DBKEY                                               CSW201
     C                     MOVEL'MGOREFL0'DBFILE                                              CSW201
     C                     OUT  LDA                                                           CSW201
     C                     EXSR *PSSR                                                         CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
      ** Write new cancellation message to MGOREFPD and MGOMSGPD                              CSW201
      *                                                                                       CSW201
     C                     EXSR SRWREF                                                        CSW201
     C                     EXSR SROMSG                                                        CSW201
      *                                                                                       CSW201
      ** Write new cancellation message to MGHISTPD                                           CSW201
      *                                                                                       CSW201
     C                     MOVELTRNO      @HREF                                               CSW201
     C                     MOVE '362'     HSMTPY                                              CSW201
     C                     MOVE *BLANKS   HSTRNO                                              CSW201
     C                     Z-ADD*ZERO     HSPDAT                                              CSW201
     C                     MOVE *BLANK    HSMSSQ                                              CSW201
     C                     MOVE EVTP      HSEVTP                                              CSW201
     C                     MOVE WFTRNA    HSFTRN                                              CSW201
     C                     MOVE 'Y'       HSCANC                                              CSW201
      *                                                                                       CSW201
     C                     WRITEMGHISTD0               56                                     CSW201
      *                                                                                       CSW201
     C           *IN56     IFEQ *ON                                                           CSW201
     C           *LOCK     IN   LDA                                                           CSW201
     C                     Z-ADD028       DBASE                                               CSW201
     C                     MOVE *BLANKS   DBKEY                                               CSW201
     C                     MOVEL'MGHISTPD'DBFILE                                              CSW201
     C                     OUT  LDA                                                           CSW201
     C                     EXSR *PSSR                                                         CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
      ** Update sequence numbers on transaction record                                        CSW201
      *                                                                                       CSW201
     C                     CALL 'MG5000'               26                                     CSW201
     C                     PARM MGMODI    @MODI                                               CSW201
     C                     PARM MGTNUM    @TRAN                                               CSW201
     C                     PARM 'CF'      @PROG                                               CSW201
     C                     PARM 'U'       @MODE                                               CSW201
     C                     PARM *ZEROS    MGLSWC                                              CSW201
     C                     PARM *ZEROS    MGLSWS                                              CSW201
     C                     PARM *BLANKS   @ERCD                                               CSW201
      *                                                                                       CSW201
     C           @ERCD     IFEQ 'Y'                                                           CSW201
     C           *LOCK     IN   LDA                                                           CSW201
     C                     Z-ADD034       DBASE                                               CSW201
     C                     MOVELMODI      DBKEY                                               CSW201
     C                     MOVE MTRN      DBKEY                                               CSW201
     C                     OUT  LDA                                                           CSW201
     C                     EXSR *PSSR                                                         CSW201
     C                     ENDIF                                                              CSW201
     C           *IN26     IFEQ *ON                                                           CSW201
     C           *LOCK     IN   LDA                                                           CSW201
     C                     Z-ADD035       DBASE                                               CSW201
     C                     MOVE 'MG5000'  DBKEY                                               CSW201
     C                     OUT  LDA                                                           CSW201
     C                     EXSR *PSSR                                                         CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     MOVE WCTRNO    WLTRNO                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C           WFTRN     READEMGHIST2                  80                                   CSW201
     C                     ENDDO                                                              CSW201
      *                                                                                       CSW201
     C                     ENDDO                                                              CSW201
      *                                                                                       CSW201
     C                     ENDSR                                                              CSW201
      *****************************************************************                       CSW201
      /EJECT                                                                                  CSW201
      *****************************************************************
      *   *PSSR - error handling                                      *
      *****************************************************************
      *
     C           *PSSR     BEGSR
      *
      **  Write database error to report
      *
     C                     OPEN MG0362AU
     C                     WRITEHEAD
     C                     WRITEDBERROR
      *
     C                     MOVE *ON       *INU7
     C                     MOVE *ON       *INU8
     C                     MOVE *ON       *INLR
     C                     DUMP
     C                     RETRN
      *
     C                     ENDSR
     C/EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      *                                                               *                       CSD015
      *  SRWTCH - Watch Processing                                    *                       CSD015
      *                                                               *                       CSD015
      *****************************************************************                       CSD015
      *                                                                                       CSD015
     C           SRWTCH    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Check if message is for automatic release.                                           CSD015
      ** If yes, default to CRTD status and set Automatic Release Flag to 'Y'                 CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       PARLS   1                                           CSD015
     C           MGST      IFEQ 'RSND'                                                        CSD015
     C           NWRK      IFEQ 'SWIFT '                                                      CSD015
     C           NWRK      OREQ 'TELEX '                                                      CSD015
     C           NWRK      OREQ 'STTX  '                                                      CSD015
     C                     MOVE 'CRTD'    MGST                                                CSD015
     C                     MOVE 'Y'       PARLS                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     CLEARWLTDS                                                         CSD015
     C                     MOVE *BLANKS   PSTRNG                                              CSD015
     C                     MOVE *ZEROS    W4VDAT                                              CSD015
     C                     MOVE *ZEROS    W4MDAT                                              CSD015
     C                     MOVE *ZEROS    W4AMT1                                              CSD015
     C                     MOVE *ZEROS    W4AMT2                                              CSD015
      *                                                                                       CSD015
      ** Setup parameters for Compliance engine program                                       CSD015
      *                                                                                       CSD015
     C                     MOVELTRNO      W4IDEN                                              CSD015
     C                     MOVELMTPY      W4ITEM                                              CSD015
     C                     MOVELMGBRCA    W4BRCH                                              CSD015
     C                     MOVEL'MGOREF'  W4FUNT                                              CSD015
     C                     MOVELDECN      W4CNUM                                              CSD015
     C                     Z-ADDBJRDNB    W4DDAT                                              CSD015
     C                     MOVELPARLS     W4ARLS                                              CSD015
      *                                                                                       CSD015
      ***Send*transaction*to compliance engine program                                 CSD015 221145
      *********************                                                            CSD015 221145
     C*********************CALL 'SDWLCLOP'                                             CSD015 221145
     C*********************PARM           WLTDS                                        CSD015 221145
     C*********************PARM *BLANKS   PSTRNG                                       CSD015 221145
      *                                                                                       CSD015
     C           EWATCH    ENDSR                                                              CSD015
      *                                                                                       CSD015
     C/EJECT                                                                                  221145
      *****************************************************************                       221145
      *                                                               *                       221145
      *  WLCDQ - Submit information to Watch List Check Dtaq          *                       221145
      *                                                               *                       221145
      *****************************************************************                       221145
      *                                                                                       221145
     C           WLCDQ     BEGSR                                                              221145
      *                                                                                       221145
      *  Send transaction to compliance engine program                                        221145
      *                                                                                       221145
     C                     CALL 'SDWLCLOP'                                                    221145
     C                     PARM           WLTDS                                               221145
     C                     PARM *BLANKS   PSTRNG                                              221145
      *                                                                                       221145
      *                                                                                       221145
     C                     ENDSR                                                              221145
      *                                                                                       221145
      *****************************************************************                       CSD015
      /EJECT
      /COPY MGCPYSRC,SWIFTTRANS
** CPY@   Object Copyright
(c) Misys International Banking Systems Ltd. 2001
** MSGA   Messages
Settlement - pay
Customer details not found on SDCUSTPD
Nostro customer not found on SDNOSTPD
Broker code not found on SDBROKPD
ZM0040 (format ccy and amount) call ended in error
ZM0050 (format SWIFT address) call ended in error
Codeword was not found for this message
Duplicate TRN key built for this message
** @ATAG - Tag fields with blank fields
:15A:
:15B:
:15C:
:15D:
:15E:
** TABNST - Codes indicating settlement via nostro
01
02
07
08
12
** TABINT - Codes indicating settlement via internal
03
04
05
06
14
