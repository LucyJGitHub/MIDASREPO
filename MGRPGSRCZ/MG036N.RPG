     H        1                           F
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas MG Format IRS definition confirmation')          *
      *****************************************************************
      *                                                               *
      *  Midas - Message Generation Module                            *
      *                                                               *
      *  MG036N - FORMAT IRS DEFINITION CONFIRMATION                  *
      *                                                               *
      *  Function:  This program will format MT360 and MT361 messages *
      *             for output to SWIFT.                              *
      *                                                               *
      *  Called By: DLC0210A - Input Cycle Confirmation Processing    *
      *                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. CSW216             Date 14Mar16               *
      *  Prev Amend No. MD035752           Date 08Sep15               *
      *                 MD031114           Date 06Aug15               *
      *                 MD034496           Date 25May15               *
      *                 CSW215             Date 06Apr15               *
      *                 AR814519           Date 10Mar15               *
      *                 CSW214             Date 25Nov14               *
      *                 CIR017             Date 10Apr14               *
      *                 MD023007           Date 24Oct13               *
      *                 MD023798           Date 26Nov13               *
      *                 MD023229           Date 16Nov13               *
      *                 MD022981           Date 12Nov13               *
      *                 MD022633A          Date 17Oct13               *
      *                 MD023009           Date 23Oct13               *
      *                 MD022633           Date 03Oct13               *
      *                 MD022052           Date 09Sep13               *
      *                 MD022044           Date 03Sep13               *
      *                 CSW213             Date 03Jun13               *
      *                 CLE148             Date 23Jul12               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 BUG20955           Date 02Sep08               *
      *                 CSW208             Date 15Apr08               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 235538             Date 08Nov05               *
      *                 235727             Date 05Aug05               *
      *                 CSW206             Date 03Jul06               *
      *                 CSD031             Date 10Apr06               *
      *                 235545             Date 11Nov05               *
      *                 236232             Date 11Nov05               *
      *                 BUG7977            Date 27Sep05               *
      *                 CSD027             Date 09Dec05               *
      *                 CIR013             Date 22Apr05               *
      *                 BUG7660            Date 23Jun05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 222373             Date 27Oct03               *
      *                 222385             Date 23Oct03               *
      *                 221145             Date 08Sep03               *
      *                 219242             Date 01Jul03               *
      *                 219241             Date 01Jul03               *
      *                 CSW203             Date 26May03               *
      *                 CSD015             Date 14Oct02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 205410             Date 27May02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CSW025             Date 26Mar02               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 195931             Date 20Jul01               *
      *                 CSW201             Date 02May01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 190127             Date 28Feb01               *
      *                 184718             Date 19Jan01               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 178970             Date 28Nov00               *
      *                 184003             Date 02Oct00               *
      *                 CDL008             Date 02May00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 177594             Date 10Apr00               *
      *                 CIR005             Date 21Jan00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 171312             Date 18Jan99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CSW097             Date 09Mar99               *
      *                 CCF003             Date 01Aug96               *
      *                 CSW005             Date 01Aug96               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  CSW216 - SWIFT Changes 2016                                  *
      *  MD035752 - Incomplete data generation for MT361              *
      *  MD031114 - Incomplete output of /LEIC/ on field tag 96J      *
      *  MD034496 - Maintainability of program for CIRS MT seq. H to O*
      *             changed to I to P                                 *
      *  CSW215 - SWIFT Changes 2015                                  *
      *  AR814519 - Allow negative base rate.                         *
      *           - Applied for MD033488                              *
      *  CSW214 - SWIFT Changes 2014                                  *
      *  CIR017 - SIRS Business Day Conventions for both legs         *
      *  MD023007 - Inaccurate writing sequence on repeating fields   *
      *             of RPIF details in MT generation                  *
      *  MD023798 - Invalid format for tag 98D                        *
      *  MD023229 - No MT360 generated for amend action               *
      *  MD022981 - Seq 15O without succeeding field tags generated   *
      *  MD022633A - Properly set-up the value for tags 22L and 91J   *
      *  MD023009 - MT300 Message 15E is out of sequence              *
      *  MD022633 - Allow reporting details with '0' Transaction      *
      *             Identifier type for different reporting           *
      *             jurisdiction and reporting party ID combinations. *
      *  MD022052 - Action amend_Amend maturity date where trade repo *
      *             has SWIFT Id_MT360 for trade repo is not generated*
      *  MD022044 - Seq O and all the other seq is missing in MT360   *
      *             for trade repository if reporting tab during      *
      *             input are entered                                 *
      *  CSW213 - SWIFT Changes 2013                                  *
      *  CLE148 - Alpha Loan Reference (Recompile)                    *
      *  BUG20955 - Value assigned in Fund Acct number (customer      *
      *             details input is not written in field 83J of      *
      *             MT360 and MT361.                                  *
      *  CSW208 - SWIFT 2008 Changes                                  *
      *  235538 - MT361 INT Exch are showing wrong SSIs.              *
      *           Applied fix 233434                                  *
      *  235727 - Extend multiple occurence data structure MULT to    *
      *           9999, increase size of counter X.                   *
      *  CSW206 - Swift 2006 Standard Changes                         *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  235545 - Incomplete message generated due to blank MFLD.     *
      *  236232 - Ensure that tag :37N: will only be output on the    *
      *           1st line.  Lines 2 to 6 should only contain the     *
      *           details.                                            *
      *  BUG7977- Add processing for Stub periods.                    *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *  BUG7660 - MT360 NACK'd due to wrong tag value ':38:O'.       *
      *            Should be :38:0O' for 'OTHER'.                     *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222373 - Parameter Mismatch                                  *
      *  222385 - SWIFT msgs are Watch List checked regardless of     *
      *           configuration file setting                          *
      *  221145 - Compliance Watch WLC: Move compliance check to      *
      *           after COMIT to MGOMSGPD                             *
      *  219242 - Not possible to create MT103+ payment msg from      *
      *           non-FT transaction (Recompile)                      *
      *  219241 - Defaulting of "Details of Charges" assign a         *
      *           system value (Recompile)                            *
      *  CSW203 - SWIFT 2003 Standards Update                         *
      *  CSD015 - Midas Compliance Watch - Watch List Checking        *
      *  205410 - Make repititions of 22B have MTAG.                  *
      *  CSW025 - Midas Message Manager                               *
      *           - Pass original change type                         *
      *  195931 - 77D should output 'NONE' on first line if 14A has   *
      *           field equal to 'OTHER'                              *
      *  CSW201 - SWIFT 2001 Standards Update                         *
      *  190127 - Related reference should contain tansaction         *
      *           reference of previous message of same type          *
      *  184718 - Setup CIND flag to correct Y2K display problems.    *
      *  178970 - 'OTHR' to be used in ISDA Financial centre          *
      *  184003 - 17F should consider the amount convention           *
      *  CDL008 - Continuous Linked Settlement (Recompiled)           *
      *  177594 - Field 22C should contain YYMM between the CSID's    *
      *           instead of the rate.                                *
      *  CIR005 - FRA/IRS Business Day Conventions                    *
      *  171312 - SWIFT '97 - MT340s and MT360s Message Generation    *
      *           related fix: (1) If AGTY is 'OTHER', do not output  *
      *           second and third part of 77H if these are zeroes.   *
      *           (2) Remove eu0200 processing on amounts as          *
      *           SWIFT validation requires currencies to be          *
      *           uniform all throughout the message (FIN Err C02)    *
      *           (3) Suppression of subsequences in B, C, D, F       *
      *           should now be relative to the leg matching the      *
      *           condition.                                          *
      *           (4) Prevent looping on SR/FRJKLM                    *
      *  CSW097 - SWIFT '97 - MT340s and MT360s Message Generation    *
      *           Use settlement currency when different to           *
      *           transaction currency                                *
      *  CCF003 - Include MT360 and MT362 Confirmation Matching       *
      *  CSW005 - FRA/IRS MG34n and MG36n Message Generation.         *
      *                                                               *
      *****************************************************************
     FMGF36NL0UF  E           K        DISK
     F                                              KCOMIT
     FMGU36NPDIF  E           K        DISK                               CSW097
     FMGV36NPDIF  E           K        DISK                               CSW097
     FMGW36NPDIF  E           K        DISK                               CSW097
     FMGX36NPDIF  E           K        DISK                               CSW097
     FMGY36NPDIF  E           K        DISK
     FMGZ36NPDIF  E           K        DISK
     FMGOREFL0IF  E           K        DISK
     F            MGOREFD0                          KRENAMEMGREFL0
     FMGOREFPDO   E                    DISK
     F                                              KCOMIT
     FMGOMSGPDO   E                    DISK
     F                                              KCOMIT
     FDLRPIFL1IF  E           K        DISK                           UC                    MD022981
      *                                                                                       190127
      ** MG Transaction history file                                                          190127
     F***MGHISTL0UF  E           K        DISK                      A                  190127 CSW213
     FMGHISTL7UF  E           K        DISK                      A                            CSW213
     F                                              KCOMIT                                    190127
     FDLGXSTL0IF  E           K        DISK                                                   235538
     FDLCIRSL0IF  E           K        DISK                                                   235538
     FMG036NP1O   E             55     PRINTER                        UC
     FMG036NAUO   E             44     PRINTER                        UC
     F/COPY WNCPYSRC,MG036NF001
      *****************************************************************
      *                                                               *
      * FUNCTION OF INDICATORS                                        *
      *                                                               *
      *    01            EOF MGF36NL0                                 *
      *    05            Error on write to MGOREFPD.                  *
      *    06            Error on write to MGOMSGPD                   *
      *    07            EOF MGY36NPD                                 *
      *    08            EOF MGZ36NPD                                 *
      *    09            EOF MGV36NPD                                 *   CSW097
      *    10            EOF MGW36NPD                                 *   CSW097
      *    11            Chain to MGOREFL0.                           *
      *    12            EOF MGX36NPD                                 *   CSW097
      *    13            EOF MGU36NPD                                 *   CSW097
      *    15            Error in call to standard program ZM0060     *
      *    16            Error on delete of MGF36NL0.                 *
      *    19            LOKUP operation searching array (GNR)        *
      *    20            LOKUP operation searching array (GNR)        *
      *    21            LOKUP operation searching array (GNR)        *
      *    22            LOKUP operation searching array (GNR)        *
      *    23            Settlement method on TABNST/TABINT.          *
      *    25            Array 1st line filled ; fld72.               *
      *    26            Error on call of MG5000                      *
      *    27            ConCord Interface is ON.                     *
      *    28            Error in call to standard program ZM1190     *
      *    31            LOKUP operation searching array (@WRK)       *
      *    33            LOKUP operation searching array (@ATAG)      *
      *    44            34R or 34N i.e. payment amounts are used     *
      *    50            MG036NP1 open                                *
      *    51            Message type is MT360 (MGX360D0)             *
      *    52            Message type is MT361 (MGX361D0)             *
      *    71            LOKUP operation searching array (@FUID1-4)   *
      *    U7U8          Database error                               *
      *                                                               *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                   Index to subroutines                        *
      *   main process                                                *
      *   INIT - Initial Process.                                     *
      *   INTF - Initialise non-constant fields.                      *
      *   SRROUT - Determine Message Routing.                         *
      *   FMTA - Format Sequence A MT360/MT361 fields for output.     *
      *   FMTB - Format Sequence B MT360/MT361 fields for output.     *
      *   FMTC - Format Sequence C MT360/MT361 fields for output.     *
      *   FMTD - Format Sequence D MT360/MT361 fields for output.     *
      *   FMTE - Format Sequence E MT360/MT361 fields for output.     *
      *   FMTF - Format Sequence F MT360/MT361 fields for output.     *
      *   FMTG - Format Sequence G MT360/MT361 fields for output.     *
      *   FMTH - Format Sequence H MT360/MT361 fields for output.     *
      *   FMTI61 - Format Sequence I MT361 fields for output.         *
      *   FMTJ61 - Format Sequence J MT361 fields for output.         *
      *   FMTK61 - Format Sequence K MT361 fields for output.         *
      *   FMTL61 - Format Sequence L MT361 fields for output.         *
      *   FMTM61 - Format Sequence M MT361 fields for output.         *
      ****FMTN/I*-*Format*Sequence*N*MT361*fields*/*Sequence*I*MT360***
      *************for*output******************************************
      ****FMTO/J*-*Format*Sequence*O*MT361*fields*/*Sequence*J*MT360***
      *************for*output******************************************
      *   FRMTBE - Common subroutine for Sequence B and E.            *
      *   FRMTCF - Common subroutine for Sequence C and F.            *
      *   FRMTHI - Common subroutine for Sequence H and I.            *
      *   FRJKLM - Common subroutine for Sequence J, K, L and M.      *
      ****FRNIOJ*-*Common*subroutine*for*Sequence*N,*I,*O*and*J.*******
      ****FLD38C*-*Common*subroutine*to*format*all*field*38C.**********
      *   PAY  - Format fields :53:, :56a: and :57a: - (OUR).         *
      *   RECV - Format fields :56a: and :57a: - (THEIR).             *
      *   FSWAD- Format SWIFT Address.                                *
      *   FLD72- Format Field 72.                                     *
      *   REPT - Print Incorrectly Generated Messages.                *
      *   OMSG - Output Correctly Generated Messages.                 *
      *   WREF - Write o/p reference to PF/MGOREFPD.                  *
      *   *PSSR- Error Handling.                                      *
      *                                                               *
      *****************************************************************
     E                    CPY@    1   1 80               copyright
     E                    MSGA    1   9 60               message text
     E**********          @ATAG   1  15  5               tags w/ blank fld                    CSW215
     E                    @ATAG   1  16  5               tags w/ blank fld                    CSW215
     E                    TABNST  1   5  2               settlement nostro
     E                    TABINT  1   5  2               settle. internal
     E                    GNR        15  3               msg gen. released
     E                    @WRK       50  1               work array
     E***********         @FUID1  1   4 15               further iden. 1  CSW097
     E***********         @FUID2  1   4 15               further iden. 2  CSW097
     E***********         @FUID3  1   4 15               further iden. 3  CSW097
     E***********         @FUID4  1   4 15               further iden. 4  CSW097
     E***********         @CMSG   1   6 50               calc. method textCSW097
     E***********         @CMSG   1   7 50               calc. methCSW097 CIR005
     E*************       @CMSG   1  10 50               calc. method textCIR005 CIR013
     E                    @CMSG   1  11 50               calc. method text       CIR013
     E                    @IDBR1  1   6 24               ISDA Def of B Rt CSW097
     E                    @IDBR2  1   8 24               AFB
     E                    SR2F        6 35               sender-recv. info
     E                    LOCN        6 30               Location name    178970
     E                    IX          4  1 0                                                MD023007
      *
     IMGX360D0    51
     IMGX361D0    52
     IMGU36ND0                                                            CSW097
     I              MGSEQN                          WSEQNU                CSW097
     IMGV36ND0                                                            CSW097
     I              MGSEQN                          WSEQNV                CSW097
     IMGW36ND0                                                            CSW097
     I              MGSEQN                          WSEQNW                CSW097
     IMGX36ND0                                                            CSW097
     I              MGSEQN                          WSEQNX                CSW097
     IMGY36ND0
     I              MGSEQN                          WSEQNY
     IMGZ36ND0
     I              MGSEQN                          WSEQNZ
     IMGREFL0
     I              SYTM                            MSYTM
     I              NWRK                            MNWRK
     I              SECN                            MSECN
     I              NWSN                            MNWSN
     I              DECN                            MDECN
     I              NWDS                            MNWDS
     I              MGSG                            MMGSG
     I              MGST                            MMGST
     I              F57U                            MF57U
     I              LSCC                            MLSCC
     I              HRDT                            MHRDT
     I              MGDE                            MMGDE
     I              MGTM                            MMGTM
     I              LADT                            MLADT
     I              RELD                            MRELD
     I              RELT                            MRELT
     I              CFPF                            MCFPF
     I              TODY                            MTODY
      *
      **  Rename conflicting MGOREFL0 fields
      *
     I            DS
     I                                        1  12 CSID
     I                                        9  11 @BIC
      *
      **  Data structure to test for BIC code
      *
     I******MULT*******DS                        500                                          235727
     IMULT        DS                       9999                                               235727
     I                                        1   5 MTAG
     I                                        6  55 MFLD
     I                                       56 105 MERR
     I                                      106 107 CTRC
      *
      **  Multiple occurrence data structure for message
      *
     ILDA         DS                            256
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
      *
      **  Local data area
      *
     ICODEWD      DS                         22
     I                                        1   8 CWRD
     I                                       10  10 F57U
      *
      **  Data structure containing codeword for the new message
      *
     I*FLD3N*******DS                         24                          CSW097
     I***********                             1   6 ZSDATE                CSW097
     I***********                             7   9 ZSCCY                 CSW097
     I***********                            10  24 ZSAMNT                CSW097
     IFLD3N       DS                         18                           CSW097
     I                                        1   3 ZSCCY                 CSW097
     I                                        4  18 ZSAMNT                CSW097
      *
      ****Data*structure*containing*codeword*for*fields*32A.              CSW097
      **  Data structure containing codeword for fields 32M.              CSW097
      *
     IERR3N       DS                         24
     I                                        1   3 ZCCY
     I                                        5  170ZAMT
      *
      **  Erroneous currency & amounts for Fields 32A.
      *
     I@MTAG       DS                          5
     I                                        1   1 COLON1
     I                                        2   3 FLDNO
     I                                        4   4 TAG
     I                                        5   5 COLON2
      *
      **  Data structure constructing message field tag
      *
     IP@IN        DS                            256
     I                                        1   3 I@SNBR
     I                                        4   9 I@DSCN
     I                                       10  12 I@MTPY
     I                                       13  140I@SETT
     I                                       15  15 I@CONC
     I                                       16  16 I@FTCS
     I                                       17  18 I@MMOD
      ** Data structure for input parameter
      *
     IP@OUT       DS                            256
     I**********                              1   60O@CNSN                                    CSD027
     I                                        1   6 O@CNSN                                    CSD027
     I                                        7  18 O@SWSN
     I                                       19  38 O@NWSN
     I                                       39  49 O@SWDS
     I                                       46  46 W@96CN
     I                                       47  49 W@BIC
     I                                       50  69 O@NWDS
     I                                       70  75 O@NWRK
     I                                       76  76 O@MGSG
     I                                       77  80 O@MGST
     I                                       81  81 O@PAIN
     I                                       82  87 O@PCNB
     I                                       88  90 O@SPRS
      ** Data structure for ouput parameter
      *
     IWFLD        DS                            100
     I                                       51 100 WFLD2
      *
     I** Data structure to hold MFLD longer than 50 characters
      *
     I@HREF       DS                         16                                               190127
     I                                        1   2 HSMODI                                    190127
     I                                        3   8 HSTRAN                                    190127
     I                                        9  11 HSSEQ                                     190127
      *                                                                                       CSW213
      ** Multiple occurrence data structure for reporting party                               CSW213
      *                                                                                       CSW213
     IRPPT        DS                          5                                               CSW213
     I                                        1  35 MGRJXX                                    CSW213
     I                                       36  41 MGRPXX                                    CSW213
     I                                       42  61 MGRNXX                                    CSW213
     I                                       62  71 MGRCXX                                    CSW213
     I                                       72  82 MGRSXX                                    CSW213
     I                                       83 102 MGRLXX                                    CSW213
     I                                      103 136 MGRAXX                                    CSW213
     I**********                            137 146 MGUTXX                             CSW213 CSW214
     I**********                            147 178 MGTNXX                             CSW213 CSW214
     I**********                            179 179 MGTIXX                             CSW213 CSW214
     I**********                            180 180 MGETXX                             CSW213 CSW214
     I**********                            137 156 MGUTXX                             CSW214 CSW216
     I**********                            157 188 MGTNXX                             CSW214 CSW216
     I**********                            189 189 MGTIXX                             CSW214 CSW216
     I**********                            190 190 MGETXX                             CSW214 CSW216
     I                                      137 166 MGUTXX                                    CSW216
     I                                      167 198 MGTNXX                                    CSW216
     I                                      199 199 MGTIXX                                    CSW216
     I                                      200 200 MGETXX                                    CSW216
      *                                                                                       CSW213
      **  Data structure build transaction reference number                                   CSW213
     I@TRN1       DS                         16                                               CSW213
     I                                        1   2 @TRN11                                    CSW213
     I                                        3   8 @TRN21                                    CSW213
     I                                        9  14 @TRN31                                    CSW213
     I                                       15  160@TRN41                                    CSW213
     I                                        3  14 @TRNID                                    CSW213
      *                                                                                       CSW213
      **  Data structure for related reference CSW213                                         CSW213
      *                                                                                       CSW213
     I@HREF1      DS                         16                                               CSW213
     I                                        1   2 H1MODI                                    CSW213
     I                                        3   8 H1TRAN                                    CSW213
     I                                        9  14 HSDEST                                    CSW213
     I                                       15  160@SSEQ                                     CSW213
      **  Data structure for related reference                                                190127
      *                                                                                       190127
     I@WRK7       DS                              7                                          BUG7977
     I                                        1   3 @WRK1                                    BUG7977
     I                                        4   4 @WRK2                                    BUG7977
     I                                        5   7 @WRK3                                    BUG7977
      *                                                                                      BUG7977
     I** Data structure for Stub details                                                     BUG7977
      *                                                                                      BUG7977
     ISDBANK    E DSSDBANKPD
      *
      **  External Data structure for bank details.
      *
     ISDTRAD    E DSSDTRADPD
      *
      **  External Data structure for trading file.
      *
     ISDCUST    E DSSDCUSTPD
      *
      **  External Data structure for customer details.
      *
     ISDBRCH    E DSSDBRCHPD
     I              QQDFAC                          DFACQQ                                    CGL029
      *
      **  External Data structure for branch details.
      *
     ISDMMOD    E DSSDMMODPD
      *
      **  External Data structure for module ICD file.
      *
     ISDNOST    E DSSDNOSTPD
     I              QQACCD                          ACCDQQ                                    CGL029
      *
      **  External Data structure for nostro details.
      *
     ISDMGME    E DSSDMGMEPD
      *
      **  Data structure for message management data.
      *
     ISCSARD    E DSSCSARDPD
      *
      **  Data structure for Switchable Features file
      *
     ISDCSSW    E DSSDCSSWPD                                                                  CSW213
      *                                                                                       CSW213
      ** Data structure for Customer Extensions SWIFT Details                                 CSW213
      *                                                                                       CSW213
     IDSFDY     E DSDSFDY
      *
      **  Short data structure for access programs
      *
     IDSSDY     E DSDSSDY
      *
      **  Long data structure for access programs
      *
     IDSLDY     E DSDSLDY                                                                     CSW208
      ** External Data Structure to hold the Incoming Record format of the file               CSW208
      *                                                                                       CSW208
     I              'OTHR'                C         OTHR                  178970
      *                                                                   178970
      ** 'OTHR' constant                                                  178970
      *                                                                   178970
     I              '/LOCC/'              C         LOCC                  178970
      *                                                                   178970
      ** '/LOCC/' constant                                                178970
      *                                                                   178970
     IWLTDS     E DSSDWLTOPD                                                                  CSD015
      ** DS For Watch List Transaction Details File                                           CSD015
      *                                                                                       CSD015
     IPSTRNG      DS                           9999                                           CSD015
      *                                                                                       CSD015
     ISDWLCC    E DSSDWLCCPD                                                                  222385
      ** Watch list checking details                                                          222385
      *                                                                                       222385
      /EJECT
      *****************************************************************
      *   MAIN - main process                                         *
      *   Called by - none                                            *
      *   Calls - INIT Initial Process.                               *
      *           INTF Initialise non-constant fields.                *
      *           SRROUT Determine Message Routing.                   *
      *           FMTA - Format Sequence A MT360/MT361 fields.        *
      *           FMTB - Format Sequence B MT360/MT361 fields.        *
      *           FMTC - Format Sequence C MT360/MT361 fields.        *
      *           FMTD - Format Sequence D MT360/MT361 fields.        *
      *           FMTE - Format Sequence E MT360/MT361 fields.        *
      *           FMTF - Format Sequence F MT360/MT361 fields.        *
      *           FMTG - Format Sequence G MT360/MT361 fields.        *
      *           FMTH - Format Sequence H MT360/MT361 fields.        *
      *           FMTI61 - Format Sequence I MT361 fields.            *
      *           FMTJ61 - Format Sequence J MT361 fields.            *
      *           FMTK61 - Format Sequence K MT361 fields.            *
      *           FMTL61 - Format Sequence L MT361 fields.            *
      *           FMTM61 - Format Sequence M MT361 fields.            *
      *           FMTN/I - Format Sequence N MT361 fields /           *
      *                    Sequence I MT360 for output.               *
      *           FMTO/J - Format Sequence O MT361 fields /           *
      *                    Sequence J MT360 for output.               *
      *           REPT Print Incorrectly Generated Messages.          *
      *           OMSG Output Correctly Generated Messages.           *
      *****************************************************************
      *
      **  Transaction history key                                                             190127
     C           HSKEY     KLIST                                                              190127
     C                     KFLD           MGMODI                                              190127
     C                     KFLD           HSTRAN                                              190127
     C                     KFLD           HSDEST                                              CSW213
     C                     KFLD           HSMTPY                                              190127
      *
      ** Initial Processing.
      *
     C                     EXSR INIT
      *
      ** Read the first record from PF/MGF36NL0.
      *
     C                     READ MGF36NL0                 01
      *
      ** Do While record is found in file.
      *
     C           *IN01     DOWEQ'0'
      *                                                                   CSW097
      ** Move Sequence Number in Extract (MGSEQN) to KFLD                 CSW097
     C                     Z-ADDMGSEQN    @SEQN                           CSW097
      *
      ** Initialise output fields and format message level fields.
      *
     C                     EXSR INTF
      *
      ** Determine message routing.
      *
     C                     EXSR SRROUT
      *
      ** Format Sequence A MT360/MT361 fields.
      *
     C                     EXSR FMTA
      *
      ** Format Sequence B MT360/MT361 fields.
      *
     C***********MGFUID    LOKUP@FUID1                   71               CSW097
      *
     C************IN71     IFEQ '1'                                       CSW097
      *                                                                   CSW097
      ** If Their Side is Fixed (i.e. Their Fixed Rate <> 0) OR           CSW097
      ** a cash-flow schedule is specified on their side,                 CSW097
      ** THEN, Format & Output fields in Sequence B                       CSW097
      *                                                                   CSW097
     C                     MOVE 'B'       @MSSQ                           CSW097
     C           KEYSQN    CHAINMGY36NPD             71                   CSW097
      *                                                                   CSW097
     C           MGBFXR    IFNE 0                                         CSW097
     C           *IN71     OREQ '0'                                       CSW097
     C                     EXSR FMTB
     C                     ENDIF
      *
      ** Format Sequence C MT360/MT361 fields.
      *
     C***********MGFUID    LOKUP@FUID2                   71               CSW097
      *
     C************IN71     IFEQ '1'                                       CSW097
      *                                                                   CSW097
      ** If Their Side Floating, Format & Output fields in Sequence C     CSW097
      *                                                                   CSW097
     C           MGTFLO    IFNE *BLANK                                    CSW097
     C                     EXSR FMTC
     C                     ENDIF
      *
      ** Format Sequence D MT360/MT361 fields.
      *
     C                     EXSR FMTD
      *
      ** Format Sequence E MT360/MT361 fields.
      *
     C***********MGFUID    LOKUP@FUID3                   71               CSW097
      *
     C************IN71     IFEQ '1'                                       CSW097
      *                                                                   CSW097
      ** If Our Side is Fixed (i.e. Our Fixed Rate <> 0) OR               CSW097
      ** a cash-flow schedule is specified on our side,                   CSW097
      ** THEN, Format & Output fields in Sequence E                       CSW097
     C                     MOVE 'E'       @MSSQ                           CSW097
     C           KEYSQN    CHAINMGY36NPD             71                   CSW097
      *                                                                   CSW097
     C           MGEFXR    IFNE 0                                         CSW097
     C           *IN71     OREQ '0'                                       CSW097
     C                     EXSR FMTE
     C                     ENDIF
      *
      ** Format Sequence F MT360/MT361 fields.
      *
     C***********MGFUID    LOKUP@FUID4                   71               CSW097
      *
     C************IN71     IFEQ '1'                                       CSW097
      *                                                                   CSW097
      ** If Our Side is Floating, Format & Output fields in Sequence F    CSW097
      *                                                                   CSW097
     C           MGOFLO    IFNE *BLANK                                    CSW097
     C                     EXSR FMTF
     C                     ENDIF
      *
      ** Format Sequence G MT360/MT361 fields.
      *
     C                     EXSR FMTG
      *
      ** Format Sequence H MT360/MT361 fields.
      *
     C***********MGAMRT    IFEQ 'Y'                                       CSW097
      *                                                                   CSW097
      ** Check if record(s) exist in PF/MGZ36NPD, if so,                  CSW097
      ** Format and Output fields in Sequence H                           CSW097
      ** SWIFT 2015 Change: Re-label sequences H-O to I-P for MT361                         MD034496
     C           *IN52     IFEQ '1'                                                         MD034496
     C           CSW215    ANDEQ'Y'                                                         MD034496
     C                     MOVE 'I'       @MSSQ                                             MD034496
     C                     ELSE                                                             MD034496
     C                     MOVE 'H'       @MSSQ                           CSW097
     C                     ENDIF                                                            MD034496
     C           KEYSQN    CHAINMGZ36NPD             71                   CSW097
     C           *IN71     IFEQ '0'                                       CSW097
     C                     EXSR FMTH
     C                     ENDIF
      *
      ** If MESSAGE TYPE is MT361, then perform the following
      ** subroutines.
      *
     C           *IN52     IFEQ '1'
      *
      ** Format Sequence I MT361 fields - amortising indicator = 'Y'.
      *
     C***********MGAMRT    IFEQ 'Y'                                       CSW097
      *                                                                   CSW097
      ** Check if record(s) exist in PF/MGZ36NPD, if so,                  CSW097
      ** Format and Output fields in Sequence I                           CSW097
      ** SWIFT 2015 Change: Re-label sequences H-O to I-P for MT361                         MD034496
     C           *IN52     IFEQ '1'                                                         MD034496
     C           CSW215    ANDEQ'Y'                                                         MD034496
     C                     MOVE 'J'       @MSSQ                                             MD034496
     C                     ELSE                                                             MD034496
     C                     MOVE 'I'       @MSSQ                           CSW097
     C                     ENDIF                                                            MD034496
     C           KEYSQN    CHAINMGZ36NPD             71                   CSW097
     C           *IN71     IFEQ '0'                                       CSW097
     C                     EXSR FMTI61
     C                     ENDIF
      *
      ** Format Sequence J MT361 fields - THEIR initial exchange
      ** amount not equal to zero.
      *
     C***********MGTIPA    IFNE 0                                         CSW097
      *                                                                   CSW097
      ** Check if record(s) exist in PF/MGW36NPD, if so,                  CSW097
      ** Format and Output fields in Sequence I                           CSW097
      ** SWIFT 2015 Change: Re-label sequences H-O to I-P for MT361                         MD034496
     C           *IN52     IFEQ '1'                                                         MD034496
     C           CSW215    ANDEQ'Y'                                                         MD034496
     C                     MOVE 'K'       @MSSQ                                             MD034496
     C                     ELSE                                                             MD034496
     C                     MOVE 'J'       @MSSQ                           CSW097
     C                     ENDIF                                                            MD034496
     C           KEYSQN    CHAINMGW36NPD             71                   CSW097
     C           *IN71     IFEQ '0'                                       CSW097
     C                     EXSR FMTJ61
     C                     ENDIF
      *
      ** Format Sequence K MT361 fields - OUR initial exchange
      ** amount not equal to zero.
      *
     C***********MGOIPA    IFNE 0                                         CSW097
      *                                                                   CSW097
      ** Check if record(s) exist in PF/MGW36NPD, if so,                  CSW097
      ** Format and Output fields in Sequence I                           CSW097
      ** SWIFT 2015 Change: Re-label sequences H-O to I-P for MT361                         MD034496
     C           *IN52     IFEQ '1'                                                         MD034496
     C           CSW215    ANDEQ'Y'                                                         MD034496
     C                     MOVE 'L'       @MSSQ                                             MD034496
     C                     ELSE                                                             MD034496
     C                     MOVE 'K'       @MSSQ                           CSW097
     C                     ENDIF                                                            MD034496
     C           KEYSQN    CHAINMGW36NPD             71                   CSW097
     C           *IN71     IFEQ '0'                                       CSW097
     C                     EXSR FMTK61
     C                     ENDIF
      *                                                                   CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C           MGTTYP    IFEQ 'RS'                                      CSW097
     C           MGTTYP    OREQ 'RX'                                      CSW097
      *
      ** Format Sequence L MT361 fields - THEIR final exchange amount
      ** not equal to zero.
      *
     C***********MGTFPA    IFNE 0                                         CSW097
     C           MGTUFF    IFNE 0                                         CSW097
     C                     EXSR FMTL61
     C                     ENDIF
      *
      ** Format Sequence M MT361 fields - OUR final exchange amount
      ** not equal to zero.
      *
     C***********MGOFPA    IFNE 0                                         CSW097
     C           MGOUFF    IFNE 0                                         CSW097
     C                     EXSR FMTM61
     C                     ENDIF
      *
     C                     ENDIF
      *
      ***Format*Sequence*N/I*MT361*fields*-*THEIR*up-front*fee*amount**   CSW097
      ***not*equal*to*zero.                                               CSW097
      *
     C***********MGTUFF    IFNE 0                                         CSW097
     C***********          EXSR FMTNI                                     CSW097
     C***********          ENDIF                                          CSW097
      *
      ***Format*Sequence*O/J*MT361*fields.*-*OUR*up-front*fee*amount***   CSW097
      ** not*equal*to*zero.                                               CSW097
      *
     C***********MGOUFF    IFNE 0                                         CSW097
     C***********          EXSR FMTOJ                                     CSW097
     C***********          ENDIF                                          CSW097
      *                                                                                       CSW213
      ** Format Message Detail - Seq O                                                        CSW213
      *                                                                                       CSW213
     C           CSW213    IFEQ 'Y'                                                           CSW213
      *                                                                                     MD022981
     C                     MOVELMGTTYP    KDTYP   2                                         MD022981
     C                     MOVELMGTNUM    KDLNO  16                                         MD022981
      *                                                                                     MD022981
     C           RPIFKY    CHAINDLRPIFL1             20                                     MD022981
      *                                                                                     MD022981
     C           *IN20     IFEQ '0'                                                         MD022981
     C                     EXSR SRFMTO                                                        CSW213
     C                     ENDIF                                                            MD022981
     C                     ENDIF                                                              CSW213
      *
      ** Print if error in generated message.
      *
     C           @ERR      IFEQ 'Y'
     C                     EXSR REPT
      *
      ** Print if no error in generated message.
      *
     C                     ELSE
      *                                                                   CSW097
      **  Write reference record to PF/MGOREFPD.                          CSW097
      *                                                                   CSW097
     C                     EXSR WREF                                      CSW097
      *                                                                   CSW097
     C                     EXSR OMSG
      *                                                                   CCF003
      ** If switchabe feature 'CCF003' is on and confirmation             CCF003
      ** matching is on, generate feedback record.                        CCF003
      *                                                                   CCF003
     C           CCF003    IFEQ 'Y'                                       CCF003
     C           BGCFMT    ANDEQ'Y'                                       CCF003
     C                     EXSR CFMAT                                     CCF003
     C                     ENDIF                                          CCF003
      *
     C                     ENDIF
      *
      ** Delete record after completion of processing.
      *
     C                     DELETMGF36NL0               16
      *
      **  Error on delete of record.
      *
     C           *IN16     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '013'     DBASE              * * * * * * *
     C                     MOVELMGTNUM    DBKEY              * DBERR 013 *
     C                     MOVEL'MGF36NL0'DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Update sequence numbers on transaction record
      **  if no errors have occurred
      *
     C           @ERR      IFNE 'Y'
     C           MGACMI    IFEQ 'Y'                                                           CSW213
     C                     CALL 'MG5000'               26                                     CSW213
     C                     PARM MGTTYP    @MODI   2                                           CSW213
     C                     PARM MGTNUM    @TRAN  15                                           CSW213
     C                     PARM 'CE'      @PROG   2                                           CSW213
     C                     PARM 'U'       @MODE   1                                           CSW213
     C                     PARM *ZEROS    MGLSWC  30                                          CSW213
     C                     PARM *ZEROS    MGLSWS  30                                          CSW213
     C                     PARM *BLANKS   @ERCD   1                                           CSW213
     C                     ELSE                                                               CSW213
     C                     CALL 'MG5000'               26
     C                     PARM MGMODI    @MODI   2
     C                     PARM MGTNUM    @TRAN  15
     C                     PARM 'CF'      @PROG   2
     C                     PARM 'U'       @MODE   1
     C                     PARM *ZEROS    MGLSWC  30
     C                     PARM *ZEROS    MGLSWS  30
     C                     PARM *BLANKS   @ERCD   1
     C                     ENDIF                                                              CSW213
      *
      **  Error on access for sequence number
      *
     C           @ERCD     IFEQ 'Y'
     C           *LOCK     IN   LDA
     C                     MOVE '024'     DBASE            * * * * * * * *
     C                     MOVELMODI      DBKEY            *  DBERR 024  *
     C                     MOVE MTRN      DBKEY            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Program missing on call
      *
     C           *IN26     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '025'     DBASE            * * * * * * * *
     C                     MOVE 'MG5000'  DBKEY            *  DBERR 025  *
     C                     OUT  LDA                        * * * * * * * *
     C                     EXSR *PSSR
     C                     END
      *
     C                     END
     C           *LOCK     IN   LDA
     C                     MOVEL'MG036N  'DBPGM
     C                     OUT  LDA
      *
      **  COMIT all changes since no error on writing the message
      *
     C                     COMIT
      *                                                                   221145
      **  Call Compliance Watch:Watch List Checking                       221145
      *                                                                   221145
     C           CSD015    IFEQ 'Y'                                       221145
     C           W1EWLC    ANDEQ'Y'                                                           222385
     C           CSW025    ANDEQ'N'                                       221145
     C                     EXSR WLCDQ                                     221145
     C                     ENDIF                                          221145
      *
      ** Set-off record identifying indicators before
      ** rading next record.
      *
     C                     MOVE *OFF      *IN51
     C                     MOVE *OFF      *IN52
      *
      ** Read next available record in MGF36NL0.
      *
     C                     READ MGF36NL0                 01
      *
     C                     ENDDO
      *
      **  Write end of report, only if the printer file is open
      *
     C           *IN50     IFEQ '1'
     C                     WRITEEOREPT
     C                     END
     C/COPY WNCPYSRC,MG036NC001
      *
     C                     MOVE *ON       *INLR
      *
      /EJECT
      *****************************************************************
      *   INIT - initial process                                      *
      *   Called by - main process                                    *
      *****************************************************************
      *
     C           INIT      BEGSR
      *
     C                     MOVEACPY@      BIS@   80
      *
      **  Set up LDA
      *
     C           *NAMVAR   DEFN           LDA
     C           *LOCK     IN   LDA
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     MOVEL'MG036N'  DBPGM
     C                     MOVE *BLANKS   DBASE
     C                     OUT  LDA
      *
      **  Access SDBANKPD for report title.
      *
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
      *
      ** If no record is found on sdbankpd.
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '001'     DBASE              * * * * * * *
     C                     MOVEL'FIRST'   DBKEY              * DBERR 001 *
     C                     MOVEL'SDBANKPD'DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      ** Correctly work out Date Format.
      *
     C           BJDFIN    COMP 'M'                      98
      *
      **  Access SDTRADPD for trading information.
      *
     C                     CALL 'AOTRADR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDTRAD    PARM SDTRAD    DSFDY
      *
      ** If no record is found on sdtradpd.
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '002'     DBASE              * * * * * * *
     C                     MOVEL'FIRST'   DBKEY              * DBERR 002 *
     C                     MOVEL'SDTRADPD'DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Access SDMMODPD for modules available.
      *
     C                     CALL 'AOMMODR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C           SDMMOD    PARM SDMMOD    DSFDY
      *
      ** If no record is found on sdmmodpd.
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '003'     DBASE              * * * * * * *
     C                     MOVEL'FIRST'   DBKEY              * DBERR 003 *
     C                     MOVEL'SDMMODPD'DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Access SDMGMEPD for message management data.
      *
     C                     CALL 'AOMGMER0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C           SDMGME    PARM SDMGME    DSFDY
      *
      ** If no record is found on sdmgmepd.
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '027'     DBASE            * * * * * * * *
     C                     MOVEL'FIRST'   DBKEY            *  DBERR 027  *
     C                     MOVEL'SDMGMEPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      ** Initialise constant fields.
      *
     C                     MOVE *LOVAL    CR      1
     C                     BITON'457'     CR
     C                     MOVE *LOVAL    LF      1
     C                     BITON'257'     LF
     C                     MOVELCR        CRLF    2
     C                     MOVE LF        CRLF
     C                     MOVE ':'       COLON1
     C                     MOVE ':'       COLON2
      *
      ** Convert run date to YYMMDD, for Message Generation Date.
      *
     C                     CALL 'ZM0060'               15
     C                     PARM BJRDNB    ZMDAY   50
     C                     PARM           ZSDATE  6
      *
      ** Program ended in error.
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '004'     DBASE              * * * * * * *
     C                     MOVEL'       ' DBKEY              * DBERR 004 *
     C                     MOVEL'ZM0060'  DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     MOVE ZSDATE    MGDE
      *
      ** Set-up Message Generation Century flag                           184718
      *                                                                   184718
     C                     MOVELMGDE      YY      20                      184718
     C           YY        IFLT 72                                        184718
     C                     MOVE '2'       CIND                            184718
     C                     ELSE                                           184718
     C                     MOVE '1'       CIND                            184718
     C                     ENDIF                                          184718
      *                                                                   184718
      ** Convert history retention date to YYMMDD.
      *
     C           BJRDNB    ADD  ENDSMN    ZMDAY
     C                     CALL 'ZM0060'               15
     C                     PARM           ZMDAY
     C                     PARM           ZSDATE
      *
      ** If the program ends in error.
      *
     C           *IN15     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '006'     DBASE              * * * * * * *
     C                     MOVEL'       ' DBKEY              * DBERR 006 *
     C                     MOVEL'ZM0060'  DBFILE             * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     MOVE ZSDATE    @HRDT   6
      *
      ** Access Switchable features file to see if ConCord is switched
      ** ON.
      *
     C                     CALL 'AOSARDR0'
     C                     PARM '       ' RTCDA   7
     C                     PARM '*VERIFY' RTCDB   7
     C                     PARM 'CCF001'  RTCDC   6
      *
     C           RTCDA     IFEQ *BLANK
     C                     MOVE *ON       *IN27
     C                     END
      *                                                                   CCF003
      ** Access Switchable features file to see if CCF003 is switched     CCF003
      ** ON.                                                              CCF003
      *                                                                   CCF003
     C                     CALL 'AOSARDR0'                                CCF003
     C                     PARM '       ' RTCDA   7                       CCF003
     C                     PARM '*VERIFY' RTCDB   7                       CCF003
     C                     PARM 'CCF003'  RTCDC   6                       CCF003
      *                                                                   CCF003
     C           RTCDA     IFEQ *BLANK                                    CCF003
     C                     MOVE 'Y'       CCF003  1                       CCF003
     C                     ELSE                                           CCF003
     C                     MOVE 'N'       CCF003                          CCF003
     C                     ENDIF                                          CCF003
      *                                                                   CIR005
      ** Access Switchable features file if CIR005 is installed.          CIR005
      *                                                                   CIR005
     C                     CALL 'AOSARDR0'                                CIR005
     C                     PARM *BLANKS   PRTCD   7                       CIR005
     C                     PARM '*VERIFY' POPTN   7                       CIR005
     C                     PARM 'CIR005'  PSARD   6                       CIR005
     C           SCSARD    PARM SCSARD    DSFDY                           CIR005
      *                                                                   CIR005
     C           PRTCD     IFEQ *BLANK                                    CIR005
     C                     MOVE 'Y'       CIR005  1                       CIR005
     C                     ELSE                                           CIR005
     C                     MOVE 'N'       CIR005                          CIR005
     C                     ENDIF                                          CIR005
      **
      ** Check if CIR017 - Separate Business Day Convention for SIRS                          CIR017
     C                     CALL 'AOSARDR0'                                                    CIR017
     C                     PARM *BLANKS   PRTCD                                               CIR017
     C                     PARM '*VERIFY' POPTN                                               CIR017
     C                     PARM 'CIR017'  PSARD                                               CIR017
     C           SCSARD    PARM SCSARD    DSFDY                                               CIR017
      **                                                                                      CIR017
     C           PRTCD     IFEQ *BLANKS                                                       CIR017
     C                     MOVE 'Y'       CIR017  1                                           CIR017
     C                     ELSE                                                               CIR017
     C                     MOVE 'N'       CIR017                                              CIR017
     C                     ENDIF                                                              CIR017
      *                                                                                       CIR017
      *                                                                                       CSW201
      **  Access Switchable Features file for CSW201                                          CSW201
      *                                                                                       CSW201
     C                     CALL 'SWIF2001'                                                    CSW201
     C                     PARM *BLANKS   @RTCD                                               CSW201
      *                                                                                       CSW201
     C           @RTCD     IFEQ 'CSW2001'                                                     CSW201
     C                     MOVE 'Y'       CSW201  1                                           CSW201
     C                     ELSE                                                               CSW201
     C                     MOVE 'N'       CSW201                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSD015
      ** Access SAR details file to determine if Compliance Watch                             CSD015
      ** (CSD015) is installed                                                                CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CSD015  1                                           CSD015
     C                     MOVEL'N'       W1EWLC                                              222385
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY' POPTN                                               CSD015
     C                     PARM 'CSD015'  PSARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     MOVEL'031'     DBASE                                               CSD015
     C                     MOVELPOPTN     DBKEY                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSD015                                              CSD015
      *                                                                                       222385
      ** Access AOWLCCR0 to check if function code MESSGENT is available                      222385
      *                                                                                       222385
     C                     CALL 'AOWLCCR0'                                                    222385
     C                     PARM *BLANKS   PRTCD                                               222385
     C                     PARM '*KEY'    POPTN                                               222385
     C                     PARM 'MESSGENT'PFUNC   8                                           222385
     C           SDWLCC    PARM SDWLCC    DSFDY                                               222385
      *                                                                                       222385
     C           PRTCD     IFNE *BLANKS                                                       222385
     C           PRTCD     ANDNE'*NRF'                                                        222385
     C                     MOVEL'SDWLCCPD'DBFILE                                              222385
     C                     MOVELPFUNC     DBKEY                                               222385
     C                     Z-ADD32        DBASE                                               222385
     C                     EXSR *PSSR                                                         222385
     C                     ENDIF                                                              222385
      *                                                                                       222385
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Access SAR details file to determine if Midas Message Manager                        CSD015
      ** (CSW025) is installed                                                                CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CSW025  1                                           CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY' POPTN                                               CSD015
     C                     PARM 'CSW025'  PSARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     MOVEL'032'     DBASE                                               CSD015
     C                     MOVELPOPTN     DBKEY                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSW025                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSW206
      **  Access Switchable Features file for CSW206                                          CSW206
      *                                                                                       CSW206
     C                     CALL 'SWIF2006'                                                    CSW206
     C                     PARM *BLANKS   @RTCD                                               CSW206
      *                                                                                       CSW206
     C           @RTCD     IFEQ 'CSW2006'                                                     CSW206
     C                     MOVE 'Y'       CSW206  1                                           CSW206
     C                     ELSE                                                               CSW206
     C                     MOVE 'N'       CSW206                                              CSW206
     C                     ENDIF                                                              CSW206
      *                                                                                       CSD015
      ** Access Switchable features file if CSW024 is installed.                              CSW208
      *                                                                                       CSW208
     C                     CALL 'AOSARDR0'                                                    CSW208
     C                     PARM *BLANKS   PRTCD   7                                           CSW208
     C                     PARM '*VERIFY' POPTN   7                                           CSW208
     C                     PARM 'CSW024'  PSARD   6                                           CSW208
     C           SCSARD    PARM SCSARD    DSFDY                                               CSW208
      *                                                                                       CSW208
     C           PRTCD     IFEQ *BLANK                                                        CSW208
     C                     MOVE 'Y'       CSW024  1                                           CSW208
     C                     ELSE                                                               CSW208
     C                     MOVE 'N'       CSW024                                              CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
      ** Access Switchable features file if CSW037 is installed.                              CSW208
      *                                                                                       CSW208
     C                     CALL 'AOSARDR0'                                                    CSW208
     C                     PARM *BLANKS   PRTCD   7                                           CSW208
     C                     PARM '*VERIFY' POPTN   7                                           CSW208
     C                     PARM 'CSW037'  PSARD   6                                           CSW208
     C           SCSARD    PARM SCSARD    DSFDY                                               CSW208
      *                                                                                       CSW208
     C           PRTCD     IFEQ *BLANK                                                        CSW208
     C                     MOVE 'Y'       CSW037  1                                           CSW208
     C                     ELSE                                                               CSW208
     C                     MOVE 'N'       CSW037                                              CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
      ** Access Switchable Features file for CSW208                                           CSW208
      *                                                                                       CSW208
     C                     CALL 'SWIF2008'                                                    CSW208
     C                     PARM *BLANKS   @RTCD                                               CSW208
      *                                                                                       CSW208
     C           @RTCD     IFEQ 'CSW2008'                                                     CSW208
     C                     MOVE 'Y'       CSW208  1                                           CSW208
     C                     ELSE                                                               CSW208
     C                     MOVE 'N'       CSW208                                              CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C/COPY WNCPYSRC,MG036NC002
      *                                                                   CSW097
      ** Construct key list.                                              CSW097
      *                                                                   CSW097
     C           KEYSQN    KLIST                                          CSW097
     C                     KFLD           @SEQN   50                      CSW097
     C                     KFLD           @MSSQ                           CSW097
      *                                                                   CSW097
      ** Construct key list to access PF/MGX36NPD                         CSW097
      *                                                                   CSW097
     C           K@MGX     KLIST                                          CSW097
     C                     KFLD           @SEQN                           CSW097
     C                     KFLD           @STYP   3                       CSW097
      *                                                                   CSW097
     C                     MOVE *BLANK    @STM    2                       CSW097
      *                                                                                       CSW213
      ** Check if switchable feature CSW213 is switched on                                    CSW213
      *                                                                                       CSW213
     C                     CALL 'SWIF2013'                                                    CSW213
     C                     PARM *BLANKS   @RTCD                                               CSW213
      *                                                                                       CSW213
     C           @RTCD     IFEQ 'CSW2013'                                                     CSW213
     C                     MOVE 'Y'       CSW213  1                                           CSW213
     C                     OPEN DLRPIFL1                                                    MD022981
     C                     ELSE                                                               CSW213
     C                     MOVE 'N'       CSW213                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                     MD022981
      ** Setup Key Field for DLRPIFPD                                                       MD022981
      *                                                                                     MD022981
     C           RPIFKY    KLIST                                                            MD022981
     C                     KFLD           KDTYP                                             MD022981
     C                     KFLD           KDLNO                                             MD022981
      *                                                                                       CSW214
      ** Check if SWIFT 2014 is installed                                                     CSW214
      *                                                                                       CSW214
     C                     CALL 'SWIF2014'                                                    CSW214
     C                     PARM *BLANKS   PRTCD                                               CSW214
      *                                                                                       CSW214
     C                     MOVE 'N'       CSW214  1                                           CSW214
     C           PRTCD     IFEQ 'CSW2014'                                                     CSW214
     C                     MOVE 'Y'       CSW214                                              CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                       CSW215
      ** Check if SWIFT 2015 is installed                                                     CSW215
      *                                                                                       CSW215
     C                     CALL 'SWIF2015'                                                    CSW215
     C                     PARM *BLANKS   PRTCD                                               CSW215
      *                                                                                       CSW215
     C                     MOVE 'N'       CSW215  1                                           CSW215
     C           PRTCD     IFEQ 'CSW2015'                                                     CSW215
     C                     MOVE 'Y'       CSW215                                              CSW215
     C                     ENDIF                                                              CSW215
      *
      ** Check if SWIFT 2016 installed                                                        CSW216
      *                                                                                       CSW216
     C                     CALL 'SWIF2016'                                                    CSW216
     C                     PARM *BLANKS   PRTCD                                               CSW216
      *                                                                                       CSW216
     C                     MOVE 'N'       CSW216  1                                           CSW216
     C           PRTCD     IFEQ 'CSW2016'                                                     CSW216
     C                     MOVE 'Y'       CSW216                                              CSW216
     C                     ENDIF                                                              CSW216
      *
      ** Key for access to DLGXSTL0                                                           235538
      *                                                                                       235538
     C           *LIKE     DEFN RXDLNO    K0DLNO                                              235538
     C           *LIKE     DEFN RXEDCD    K0EDCD                                              235538
      *                                                                                       235538
     C           K0GXST    KLIST                                                              235538
     C                     KFLD           K0DLNO                                              235538
     C                     KFLD           K0EDCD                                              235538
      *                                                                                       235538
     C                     ENDSR
     C/EJECT                                                                               MD022633A
      *****************************************************************                    MD022633A
      *                                                               *                    MD022633A
      *  GETRCL- Get record length                                    *                    MD022633A
      *                                                               *                    MD022633A
      *****************************************************************                    MD022633A
      *                                                                                    MD022633A
     C           GETRCL    BEGSR                                                           MD022633A
      *                                                                                    MD022633A
     C           'UTGETRCD'CAT  'LN'      P#PGM  10                                        MD022633A
      *                                                                                    MD022633A
     C                     CALL P#PGM                                                      MD022633A
     C                     PARM           P#RTCD 10                                        MD022633A
     C                     PARM           P#RCDL  50                                       MD022633A
     C                     PARM           P#FILN 10                                        MD022633A
     C                     PARM '*LIBL'   P#LIBN 10                                        MD022633A
      *                                                                                    MD022633A
     C           P#RTCD    IFNE *BLANK                                                     MD022633A
     C                     EXSR *PSSR                                                      MD022633A
     C                     ENDIF                                                           MD022633A
      *                                                                                    MD022633A
     C                     ENDSR                                                           MD022633A
      /EJECT
      *****************************************************************
      *   INTF - Initalise non-constant fields                        *
      *   Called by - main process                                    *
      *****************************************************************
      *
     C           INTF      BEGSR
      *
     C***********          MOVE *BLANKS   AWBA6   6                       CSW097
     C***********          MOVELMGAWBA    AWBA6   6                       CSW097
     C                     MOVE *BLANKS   TRNO
     C                     MOVE *BLANKS   @TRNA
     C                     MOVE '      '  NWRK
     C**********           Z-ADD0         SECN                                                CSD027
     C                     MOVE *BLANKS   SECN                                                CSD027
     C                     MOVE *BLANKS   NWSN
     C**********           Z-ADD0         DECN                                                CSD027
     C                     MOVE *BLANKS   DECN                                                CSD027
     C                     MOVE *BLANKS   NWDS
     C                     MOVE *BLANKS   MGSG
     C                     MOVE *BLANKS   MGST
     C                     MOVE *BLANKS   LSCC
     C                     MOVE *BLANK    F57U
     C                     MOVE *BLANKS   CWRD
     C                     Z-ADD0         MGTM
     C                     Z-ADD0         LATM
     C                     MOVE *BLANKS   RELD
     C                     Z-ADD0         RELT
     C                     MOVE *BLANKS   AMTS
     C                     MOVE *BLANKS   SVDT
     C                     MOVE *BLANKS   CINDV                           184718
      *
     C                     MOVE *BLANKS   @ERR    1
     C                     MOVE *BLANKS   SCSID  12
     C                     MOVE *BLANKS   STELX  10
     C                     MOVE *BLANKS   SSTTX  12
     C                     MOVE *BLANKS   SCRNM  20
     C                     MOVE *BLANKS   SPCNB   6
     C                     MOVE *BLANKS   SPAIN   1
      *                                                                                     MD022633
     C                     MOVE *BLANKS   WRKMRJ                                            MD022633
     C                     MOVE *BLANKS   WRKMRP                                            MD022633
     C                     MOVE *BLANKS   WRKMRN                                           MD022633A
     C                     MOVE *BLANKS   WRKMRC                                           MD022633A
     C                     MOVE *BLANKS   WRKMRS                                           MD022633A
     C                     MOVE *BLANKS   WRKMRL                                           MD022633A
     C                     MOVE *BLANKS   WRKMRA                                           MD022633A
      *
      **  Currently positioned at line 1 of Field :72:
      *
     C                     MOVE 'N'       LINE2   1
      *
      **  Clear multiple occurrence data structure
      *
     C***********          Z-ADD1         X       30                                          235727
     C                     Z-ADD1         X       40                                          235727
     C           X         OCUR MULT
      *
     C***********X         DOWLE500                                                           235727
     C           X         DOWLE9999                                                          235727
     C           MULT      ANDNE*BLANKS
     C                     MOVE *BLANKS   MULT
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     ENDDO
      *
      **  Obtain sequence numbers from transaction record
      *
     C           MGACMI    IFEQ 'Y'                                                           CSW213
     C                     CALL 'MG5000'               26                                     CSW213
     C                     PARM MGTTYP    @MODI   2                                           CSW213
     C                     PARM MGTNUM    @TRAN  15                                           CSW213
     C                     PARM 'CE'      @PROG   2                                           CSW213
     C                     PARM *BLANKS   @MODE   1                                           CSW213
     C                     PARM *ZEROS    MGLSWC  30                                          CSW213
     C                     PARM *ZEROS    MGLSWS  30                                          CSW213
     C                     PARM *BLANKS   @ERCD   1                                           CSW213
     C                     ELSE                                                               CSW213
     C                     CALL 'MG5000'               26
     C                     PARM MGMODI    @MODI   2
     C                     PARM MGTNUM    @TRAN  15
     C                     PARM 'CF'      @PROG   2
     C                     PARM *BLANKS   @MODE   1
     C                     PARM *ZEROS    MGLSWC  30
     C                     PARM *ZEROS    MGLSWS  30
     C                     PARM *BLANKS   @ERCD   1
     C                     ENDIF                                                              CSW213
      *
      **  Error on access for sequence number
      *
     C           @ERCD     IFEQ 'Y'
     C           *LOCK     IN   LDA
     C                     MOVE '022'     DBASE            * * * * * * * *
     C                     MOVELMODI      DBKEY            *  DBERR 022  *
     C                     MOVE MTRN      DBKEY            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      **  Program missing on call.
      *
     C           *IN26     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '023'     DBASE            * * * * * * * *
     C                     MOVE 'MG5000'  DBKEY            *  DBERR 023  *
     C                     OUT  LDA                        * * * * * * * *
     C                     EXSR *PSSR
     C                     END
     C           *LOCK     IN   LDA
     C                     MOVEL'MG036N  'DBPGM
     C                     OUT  LDA
      *                                                                                       CSW203
      ** Call SWIF2003 to check if CSW203 is installed                                        CSW203
      *                                                                                       CSW203
     C                     CALL 'SWIF2003'                                                    CSW203
     C                     PARM *BLANKS   PRTCD                                               CSW203
      *                                                                                       CSW203
      ** If ret. code is "CSW203", set CSW203 flag to "Y", else set it to "N"                 CSW203
      *                                                                                       CSW203
     C           PRTCD     IFEQ 'CSW2003'                                                     CSW203
     C                     MOVE 'Y'       CSW203  1                                           CSW203
     C                     ELSE                                                               CSW203
     C                     MOVE 'N'       CSW203                                              CSW203
     C                     ENDIF                                                              CSW203
      *
      * If the branch code on the file MGF36NL0 is blank,
      * then defualt it to the branch code on the SDBRCHPD.
      *
     C           MGBRCA    IFEQ *BLANK
     C                     MOVELA8BRCD    MGBRCA
     C                     END
      *
      ** If our receive branch is blank then default it to the
      ** branch code.
      *
     C           MGROBR    IFEQ *BLANK
     C                     MOVELMGBRCA    MGROBR
     C                     END
      *
     C                     ENDSR
     C/EJECT                                                                                MD023007
      *****************************************************************                     MD023007
      *   SRRPPT - Match RPPT details for Reporting Jurisdiction and  *                     MD023007
      *            Reporting Party fields                             *                     MD023007
      *   Called by SRFMTO                                            *                     MD023007
      *   Calls -                                                     *                     MD023007
      *****************************************************************                     MD023007
      *                                                                                     MD023007
     C           SRRPPT    BEGSR                                                            MD023007
      *                                                                                     MD023007
      ** Initialize work fields                                                             MD023007
     C                     Z-ADD1         IX1     10                                        MD023007
     C                     Z-ADD1         IX2     10                                        MD023007
     C                     Z-ADD0         IX                                                MD023007
      *                                                                                     MD023007
      ** Main loop for RPPT                                                                 MD023007
      *                                                                                     MD023007
     C           IX1       DOWLE4                                                           MD023007
      *                                                                                     MD023007
     C           IX1       LOKUPIX                       98                                 MD023007
      *                                                                                     MD023007
     C           *IN98     IFEQ '0'                                                         MD023007
     C                     MOVE IX1       IX,IX2                                            MD023007
     C           IX1       OCUR RPPT                                                        MD023007
     C                     MOVELRPPT      WRPPT1136                                         MD023007
     C                     ADD  1         IX2                                               MD023007
      *                                                                                     MD023007
     C                     Z-ADD1         IX3     10                                        MD023007
      *                                                                                     MD023007
      ** Search a match for each Reporting Party details,                                   MD023007
      ** then resequence the occurence for all combined RPPT details                        MD023007
      *                                                                                     MD023007
     C           IX3       DOWLE4                                                           MD023007
      *                                                                                     MD023007
     C           IX3       IFNE IX1                                                         MD023007
     C           IX3       OCUR RPPT                                                        MD023007
     C                     MOVELRPPT      WRPPT2136                                         MD023007
      *                                                                                     MD023007
     C           WRPPT1    IFEQ WRPPT2                                                      MD023007
     C                     MOVE IX3       IX,IX2                                            MD023007
     C                     ADD  1         IX2                                               MD023007
     C                     ENDIF                                                            MD023007
     C                     ENDIF                                                            MD023007
      *                                                                                     MD023007
     C                     ADD  1         IX3                                               MD023007
      *                                                                                     MD023007
     C                     ENDDO                                                            MD023007
     C                     ENDIF                                                            MD023007
      *                                                                                     MD023007
     C                     ADD  1         IX1                                               MD023007
      *                                                                                     MD023007
     C                     ENDDO                                                            MD023007
      *                                                                                     MD023007
     C                     ENDSR                                                            MD023007
      /EJECT
      *****************************************************************
      *   SRROUT - determine message routing                          *
      *   Called by - main process                                    *
      *   Calls - MG9900 (Midas MG Standard routing API)              *
      *****************************************************************
      *
     C           SRROUT    BEGSR
      *
     C                     MOVE MGBRCA    I@SNBR
     C                     MOVE *BLANKS   I@DSCN
     C           MGACMI    IFEQ 'Y'                                                           CSW213
     C                     MOVELMGPTYA    I@DSCN                                              CSW213
     C                     ELSE                                                               CSW213
     C                     MOVE MGCNUM    I@DSCN
     C                     ENDIF                                                              CSW213
     C           MGTTYP    IFEQ 'RS'
     C           MGTTYP    OREQ 'FR'                                      CSW097
     C                     MOVE '360'     I@MTPY
     C                     ELSE
     C           MGTTYP    IFEQ 'RX'
     C                     MOVE '361'     I@MTPY
     C                     ENDIF
     C                     ENDIF
     C                     MOVE 'Y'       I@CONC
     C                     Z-ADD0         I@SETT
     C                     MOVE *BLANK    I@FTCS
     C                     MOVE MGMODI    I@MMOD
      *
      * Add copy sources for enhancement methodology
      * one copy source for all MG generation programs and one
      * specific
      *
      * General
     C/COPY WNCPYSRC,MG9900CALL
      *
     C*********************CALL 'MG9900'                                                      CSW036
     C                     CALL 'MG9901'                                                      CSW036
     C                     PARM *BLANKS   @RTCD
     C                     PARM           P@IN
     C                     PARM *BLANKS   P@OUT
     C                     PARM           P@ZZ  256
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '019'     DBASE              * * * * * * *
     C                     MOVEL'*CALL  ' DBKEY              * DBERR 019 *
     C*********************MOVEL'MG9900'  DBFILE             * * * * * * *                    CSW036
     C                     MOVEL'MG9901'  DBFILE             * * * * * * *                    CSW036
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ELSE
     C                     MOVE O@NWRK    NWRK
     C**********           Z-ADDO@CNSN    SECN                                                CSD027
     C                     MOVE O@CNSN    SECN                                                CSD027
     C                     MOVE O@NWSN    NWSN
     C**********           Z-ADDMGCNUM    DECN                                                CSD027
     C                     MOVE MGCNUM    DECN                                                CSD027
     C                     MOVE O@NWDS    NWDS
     C                     MOVE O@MGSG    MGSG
     C                     MOVE O@MGST    MGST
     C                     MOVE O@PCNB    SPCNB
     C                     MOVE O@PAIN    SPAIN
     C                     END
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   FMTA - Format Sequence A MT360/MT361 fields for output.     *
      *   Called by - main process                                    *
      *   Calls -     FLD72 format field 72                           *
      *****************************************************************
      *
     C           FMTA      BEGSR
      *
      ** Field :15A:
      *
     C                     Z-ADD1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   MFLD
     C                     MOVEL':15A:'   MTAG
      *
      ** Field :20: -  Transaction Reference Number.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *                                                                                       CSW213
     C           MGACMI    IFEQ 'Y'                                                           CSW213
     C                     MOVEA*BLANKS   @WRK                                              MD022044
     C                     MOVE MGMODI    @TRN11                                              CSW213
     C                     MOVELMGTNUM    @TRN21                                              CSW213
     C                     MOVELMGCNUM    @TRN31                                              CSW213
     C           MGLSWS    ADD  1         @TRN41                                              CSW213
     C                     MOVE ':20: '   MTAG                                                CSW213
     C                     MOVEL@TRN1     MFLD                                                CSW213
      *                                                                                       CSW213
     C                     MOVE @TRN1     @TRNA  16                                           CSW213
     C                     MOVEA@TRN1     @WRK                                              MD022044
      *                                                                                       CSW213
     C                     ELSE                                                               C3W213
     C                     MOVEA*BLANKS   @WRK
      *
     C                     Z-ADD1         Z       20
     C                     MOVEAMGMODI    @WRK
     C                     MOVEAMGTNUM    @WRK,3
     C           MGLSWS    ADD  1         HLSWS   30
     C                     MOVE HLSWS     HSWS    3
      *
     C           ' '       LOKUP@WRK,Z                   31
     C                     MOVEAHSWS      @WRK,Z
      *
      **  Check on MGREFPD for a uniqne TRN,else output as an error.
      **  and store the TRN of the new confirmation message.
      *
     C                     MOVEA@WRK      @TRNA  16
      *
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
     C           @TRNA     CHAINMGREFL0              11
      *
      ** If record is found flag field is in error.
      *
     C           *IN11     IFEQ '0'
     C                     MOVE 'Y'       @ERR
     C                     MOVEAMSGA,8    MERR
     C                     ENDIF
      *
     C                     MOVEL':20:'    MTAG
     C                     MOVEA@WRK      MFLD
      *
      ** Field :21: - Related Reference.
      *
      ** If Last Action is Amend/Delete, Format tag :21: using            CSW097
      ** the TRN of previous confirmation                                 CSW097
      *                                                                   CSW097
     C           MGCHTP    IFEQ 'A'                                       CSW097
     C           MGCHTP    OREQ 'C'                                       CSW097
      *                                                                   CSW097
     C                     ADD  1         X
     C           X         OCUR MULT
     C***********          MOVEA*BLANKS   @WRK                            CSW097
      *
      ***If*related*ref.*is*not*blank,*then*use*it*as*field*of*tag.       CSW097
      *
     C***********MGRREF    IFNE *BLANKS                                   CSW097
     C                     MOVELMGRREF    MFLD
     C***********          ELSE                                           CSW097
     C***********          MOVEL'NEW'     MFLD                            CSW097
     C***********          ENDIF                                          CSW097
      *                                                                                       CSW213
     C           MGACMI    IFEQ 'Y'                                                           CSW213
     C                     MOVELMGCNUM    WDEST   6                                           CSW213
     C                     MOVELMGCNUM    HSDEST                                            MD023229
     C                     ELSE                                                               CSW213
     C                     MOVEL*BLANKS   WDEST                                               CSW213
     C                     ENDIF                                                              CSW213
      *
      **  Obtain transaction reference of previous MT36N                                      190127
     C                     MOVELMGTNUM    HSTRAN                                              190127
     C           *IN51     IFEQ '1'                                                           190127
     C                     MOVE '360'     HSMTPY                                              190127
     C                     ELSE                                                               190127
     C                     MOVE '361'     HSMTPY                                              190127
     C                     END                                                                190127
      *                                                                                       190127
     C                     MOVE HSTRAN    @HTRN   6                                           190127
     C                     MOVE HSMTPY    @HTYP   3                                           190127
      *                                                                                       190127
     C********** HSKEY     SETGTMGHISTL0                                               190127 CSW213
     C**********           READPMGHISTL0                 56                            190127 CSW213
     C           HSKEY     SETGTMGHISTL7                                                      CSW213
     C                     READPMGHISTL7                 56                                   CSW213
      *                                                                                       190127
     C           *IN56     IFEQ '0'                                                           190127
     C           HSMODI    ANDEQMGMODI                                                        190127
     C           HSTRAN    ANDEQ@HTRN                                                         190127
     C           HSDEST    ANDEQWDEST                                                         CSW213
     C           HSMTPY    ANDEQ@HTYP                                                         190127
     C           MGACMI    IFEQ 'Y'                                                           CSW213
     C**********           MOVE HSSEQ     @SSEQ                                      CSW213 MD022052
     C**********           MOVEL@HREF1    MFLD                                       CSW213 MD022052
     C**********           MOVELMGRREF    MFLD                                     MD022052 MD023229
     C                     MOVE HSSEQ     @SSEQ                                             MD023229
     C                     MOVE HSMODI    H1MODI                                            MD023229
     C                     MOVE HSTRAN    H1TRAN                                            MD023229
     C                     MOVEL@HREF1    MFLD                                              MD023229
     C                     ELSE                                                               CSW213
     C                     MOVEL@HREF     MFLD                                                190127
     C                     END                                                                190127
     C                     ENDIF                                                              CSW213
      *                                                                                       190127
     C           MFLD      IFEQ *BLANKS                                                       235545
     C                     MOVEL'UNKNOWN' MFLD                                                235545
     C                     ENDIF                                                              235545
      *                                                                                       235545
     C                     MOVEL':21:'    MTAG
      *                                                                   CSW097
     C                     ENDIF                                          CSW097
      *
      ***Field*:22:*-*Code/Common*Reference.                              CSW097
      *                                                                   CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          MOVE *BLANKS   ZCREF                           CSW097
      *                                                                   CSW097
     C***********          MOVE MGMDAT    ZMDAY                           CSW097
      *                                                                   CSW097
      ***Convert*run*date*to*YYMMDD,*for*Message*Generation*Date.         CSW097
      *                                                                   CSW097
     C***********          CALL 'ZM0060'               15                 CSW097
     C***********          PARM           ZMDAY                           CSW097
     C***********          PARM           ZSDATE                          CSW097
      *                                                                   CSW097
      ***Program*ended*in*error.                                          CSW097
      *                                                                   CSW097
     C************IN15     IFEQ '1'                                       CSW097
     C************LOCK     IN   LDA                                       CSW097
     C***********          MOVE '004'     DBASE              * * * * * * *CSW097
     C***********          MOVEL'       ' DBKEY              * DBERR 004 *CSW097
     C***********          MOVEL'ZM0060'  DBFILE             * * * * * * *CSW097
     C***********          OUT  LDA                                       CSW097
     C***********          EXSR *PSSR                                     CSW097
     C***********          END                                            CSW097
      *                                                                   CSW097
      ***Use*YYMM*portion*of*the*formatted*maturity*date.                 CSW097
      *                                                                   CSW097
     C***********          MOVELZSDATE    YYMMDD  6                       CSW097
     C***********          MOVELYYMMDD    YYMM    4                       CSW097
     C***********          MOVE YYMM      ZRATE                           CSW097
      *                                                                   CSW097
      ***If*SWIFT*network,*use*sender*&*destination*customer8swift*ad.    CSW097
      ***and*the*exchange*rate*to*produce*the*common*reference.*Else      CSW097
      ***use*the*message*TRN.                                             CSW097
      *                                                                   CSW097
     C***********NWRK      IFEQ 'SWIFT'                                   CSW097
     C***********NWRK      OREQ 'STTX'                                    CSW097
      *                                                                   CSW097
     C***********NWRK      IFEQ 'SWIFT'                                   CSW097
     C***********          MOVELNWSN      ZSSWI                           CSW097
     C***********          MOVELNWDS      ZDSWI                           CSW097
     C***********          ELSE                                           CSW097
     C***********          MOVELSCSID     ZSSWI                           CSW097
     C***********          MOVELCSID      ZDSWI                           CSW097
     C***********          END                                            CSW097
      *                                                                   CSW097
      ***Format*SWIFT*common*reference.                                   CSW097
      *                                                                   CSW097
     C***********          CALL 'ZM0020'               15                 CSW097
     C***********          PARM           ZSSWI  12                       CSW097
     C***********          PARM           ZDSWI  12                       CSW097
     C***********          PARM           ZRATE  138                      CSW097
     C***********          PARM           ZCREF  16                       CSW097
      *                                                                   CSW097
      ***If*the*program*ends*in*error.                                    CSW097
      *                                                                   CSW097
     C************IN15     IFEQ '1'                                       CSW097
     C************LOCK     IN   LDA                                       CSW097
     C***********          MOVE '009'     DBASE              * * * * * * *CSW097
     C***********          MOVEL'       ' DBKEY              * DBERR 009 *CSW097
     C***********          MOVEL'ZM0020'  DBFILE             * * * * * * *CSW097
     C***********          OUT  LDA                                       CSW097
     C***********          EXSR *PSSR                                     CSW097
     C***********          END                                            CSW097
     C***********          END                                            CSW097
      *                                                                   CSW097
     C***********ZCREF     IFEQ *BLANKS                                   CSW097
     C***********          MOVEL@TRNA     ZCREF                           CSW097
     C***********          ENDIF                                          CSW097
      *                                                                   CSW097
     C***********          MOVEL':22:'    MTAG                            CSW097
      *                                                                   CSW097
      ***Construct*Field*22*-*'codeword/common*reference'.                CSW097
      *                                                                   CSW097
      ***If*last*change*type*is*blank,*then*set*codeword*to*'NEW'.        CSW097
      *                                                                   CSW097
     C***********          SELEC                                          CSW097
     C***********MGCHTP    WHEQ ' '                                       CSW097
     C***********          MOVEL'NEW     'CWRD                            CSW097
      *                                                                   CSW097
      ***else,*if*equal*to8'A',*set*codeword*to*'AMEND'.                  CSW097
      *                                                                   CSW097
     C***********MGCHTP    WHEQ 'A'                                       CSW097
     C***********          MOVEL'AMEND   'CWRD                            CSW097
      *                                                                   CSW097
      ***otherwise,*if*equal*to*'C',*set*codeword*to*'CANCEL'.            CSW097
      *                                                                   CSW097
     C***********MGCHTP    WHEQ 'C'                                       CSW097
     C***********          MOVEL'CANCEL  'CWRD                            CSW097
     C***********          ENDSL                                          CSW097
      *                                                                   CSW097
     C***********          Z-ADD1         I       30                      CSW097
     C***********          MOVEA*BLANKS   @WRK                            CSW097
     C***********          MOVEACWRD      @WRK,I                          CSW097
     C***********' '       LOKUP@WRK,I                   31               CSW097
      *                                                                   CSW097
     C***********          MOVEA'/'       @WRK,I                          CSW097
     C***********          ADD  1         I                               CSW097
     C***********          MOVEAZCREF     @WRK,I                          CSW097
     C***********          MOVEA@WRK      MFLD                            CSW097
      *                                                                   CSW097
      ***Codeword*blank.                                                  CSW097
      *                                                                   CSW097
     C***********CWRD      IFEQ *BLANKS                                   CSW097
     C***********          MOVE 'Y'       @ERR                            CSW097
     C***********          MOVEAMSGA,7    MERR                            CSW097
     C***********          ENDIF                                          CSW097
      *                                                                   CSW097
      ** Format new tag :22A: - Type of Operation                         CSW097
      *                                                                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
      *                                                                   CSW097
     C                     SELEC                                          CSW097
     C           MGCHTP    WHEQ 'I'                                       CSW097
     C                     MOVEL'NEWT'    MFLD                            CSW097
     C           MGCHTP    WHEQ 'A'                                       CSW097
     C                     MOVEL'AMND'    MFLD                            CSW097
     C           MGCHTP    WHEQ 'C'                                       CSW097
     C                     MOVEL'CANC'    MFLD                            CSW097
     C                     ENDSL                                          CSW097
      *                                                                   CSW097
     C                     MOVEL':22A:'   MTAG                            CSW097
      *                                                                   CSW097
      ** Format new tag :22C: - Common Reference                          CSW097
      *                                                                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     MOVE *BLANKS   ZCREF                           CSW097
      *                                                                   CSW097
      ** Convert Maturity Date (MGMDAT) to CCYYMMDD format                CSW097
      *                                                                   CSW097
     C                     MOVE MGMDAT    ZMDAY                           CSW097
      *                                                                   CSW097
     C                     CALL 'ZM0065'               15                 CSW097
     C                     PARM           ZMDAY                           CSW097
     C                     PARM           ZSDATE                          CSW097
     C                     PARM           ZSDATC                          CSW097
      *                                                                   CSW097
      ** Program ended in error.                                          CSW097
      *                                                                   CSW097
     C           *IN15     IFEQ '1'                                       CSW097
     C           *LOCK     IN   LDA                                       CSW097
     C                     MOVE '004'     DBASE              * * * * * * *CSW097
     C                     MOVEL'       ' DBKEY              * DBERR 004 *CSW097
     C                     MOVEL'ZM0065'  DBFILE             * * * * * * *CSW097
     C                     OUT  LDA                                       CSW097
     C                     EXSR *PSSR                                     CSW097
     C                     END                                            CSW097
      *                                                                   CSW097
      ** Store CCYYMMDD format of Maturity Date. Note that this           CSW097
      ** will be used in formatting tag :30P:                             CSW097
      *                                                                   CSW097
     C                     MOVELZSDATC    W@MDAT  8                       CSW097
      *                                                                   CSW097
      ** Use YYMM portion of the formatted maturity date.                 CSW097
      *                                                                   CSW097
     C                     MOVELZSDATE    YYMMDD  6                       CSW097
     C                     MOVELYYMMDD    YYMM    4                       CSW097
     C                     MOVE YYMM      ZRATE                           CSW097
      *                                                                   CSW097
      ** If SWIFT network, use sender & destination customer swift ad.    CSW097
      ** and the exchange rate to produce the common reference. Else      CSW097
      ** use the message TRN.                                             CSW097
      *                                                                   CSW097
     C           NWRK      IFEQ 'SWIFT'                                   CSW097
     C           NWRK      OREQ 'STTX'                                    CSW097
      *                                                                   CSW097
     C           NWRK      IFEQ 'SWIFT'                                   CSW097
     C                     MOVELNWSN      ZSSWI                           CSW097
     C                     MOVELNWDS      ZDSWI                           CSW097
     C                     ELSE                                           CSW097
     C                     MOVELSCSID     ZSSWI                           CSW097
     C                     MOVELCSID      ZDSWI                           CSW097
     C                     END                                            CSW097
      *                                                                   CSW097
      ** Format SWIFT common reference.                                   CSW097
      *                                                                   CSW097
     C                     CALL 'ZM0020'               15                 CSW097
     C                     PARM           ZSSWI  12                       CSW097
     C                     PARM           ZDSWI  12                       CSW097
     C                     PARM           ZRATE  138                      CSW097
     C                     PARM           ZCREF  16                       CSW097
      *                                                                   CSW097
      ** If the program ends in error.                                    CSW097
      *                                                                   CSW097
     C           *IN15     IFEQ '1'                                       CSW097
     C           *LOCK     IN   LDA                                       CSW097
     C                     MOVE '009'     DBASE              * * * * * * *CSW097
     C                     MOVEL'       ' DBKEY              * DBERR 009 *CSW097
     C                     MOVEL'ZM0020'  DBFILE             * * * * * * *CSW097
     C                     OUT  LDA                                       CSW097
     C                     EXSR *PSSR                                     CSW097
     C                     END                                            CSW097
     C                     END                                            CSW097
      *                                                                   CSW097
     C           ZCREF     IFEQ *BLANKS                                   CSW097
     C                     MOVEL@TRNA     ZCREF                           CSW097
     C                     ELSE                                           177594
     C                     MOVELZCREF     WRK10L 10                       177594
     C                     MOVE YYMM      WRK10L                          177594
     C                     MOVELWRK10L    ZCREF                           177594
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     MOVEL':22C:'   MTAG                            CSW097
     C                     MOVELZCREF     MFLD                            CSW097
      *                                                                   CSW097
      ** Format field :23A: using MGFUID (further identification).
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C***********          MOVELMGFUID    @FXFLT 10                       CSW097
     C***********          MOVE MGFUID    @NTG    5                       CSW097
     C***********@FXFLT    CAT  '/':0     MFLD                            CSW097
     C***********MFLD      CAT  @NTG:0    MFLD                            CSW097
      *
     C                     MOVELMGFUID    MFLD                            CSW097
     C                     MOVE *BLANK    @NTG    5                       CSW097
     C           MGTTYP    IFEQ 'RS'                                      CSW097
     C                     MOVE 'NET  '   @NTG                            CSW097
     C                     ELSE                                           CSW097
     C           MGTTYP    IFEQ 'RX'                                      CSW097
     C                     MOVE 'GROSS'   @NTG                            CSW097
     C                     ENDIF                                          CSW097
     C                     ENDIF                                          CSW097
      *
     C           @NTG      IFNE *BLANK                                    CSW097
     C           MFLD      CAT  '/':0     MFLD                            CSW097
     C           MFLD      CAT  @NTG:0    MFLD                            CSW097
     C                     ENDIF                                          CSW097
      *
     C                     MOVEL':23A:'   MTAG
      *                                                                   CSW097
      ** Format new tag :21N: - Contract Number - Party A                 CSW097
      *                                                                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     MOVELMGTNUM    MFLD                            CSW097
     C                     MOVEL':21N:'   MTAG                            CSW097
      *
      ** Format*field*:30:*using*the*transaction*date.                    CSW097
      ** Format field :30T: using the transaction date.                   CSW097
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE MGTDAT    ZMDAY
      *
      ** Convert*run*date*to*YYMMDD,*for*Message*Generation*Date.         CSW097
      ** Convert Transaction Date (MGTDAT) to CCYYMMDD format             CSW097
      *
     C***********          CALL 'ZM0060'               15                 CSW097
     C                     CALL 'ZM0065'               15                 CSW097
     C                     PARM           ZMDAY
     C                     PARM           ZSDATE
     C                     PARM           ZSDATC  8                       CSW097
      *
     C***********          MOVELZSDATE    MFLD                            CSW097
     C                     MOVELZSDATC    MFLD                            CSW097
     C***********          MOVEL':30:'    MTAG                            CSW097
     C                     MOVEL':30T:'   MTAG                            CSW097
      *
      ***Format*field*:31L:*using*the*effective*date.                     CSW097
      ** Format field :30V: using the effective date.                     CSW097
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE MGADAT    ZMDAY
      *
      ** Convert*run*date*to*YYMMDD,*for*Message*Generation*Date.         CSW097
      ** Convert Effective Date (MGADAT) to CCYYMMDD format               CSW097
      *
     C***********          CALL 'ZM0060'               15                 CSW097
     C                     CALL 'ZM0065'               15                 CSW097
     C                     PARM           ZMDAY
     C                     PARM           ZSDATE
     C                     PARM           ZSDATC                          CSW097
      *
     C***********          MOVELZSDATE    MFLD                            CSW097
     C                     MOVELZSDATC    MFLD                            CSW097
     C***********          MOVEL':31L:'   MTAG                            CSW097
     C                     MOVEL':30V:'   MTAG                            CSW097
      *
      ** Format*field*:31C:*using*the*formatted*maturity*date.            CSW097
      ** Format field :30P: using the formatted maturity date.            CSW097
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C***********          MOVELYYMMDD    MFLD                            CSW097
     C                     MOVELW@MDAT    MFLD                            CSW097
     C***********          MOVEL':31C:'   MTAG                            CSW097
     C                     MOVEL':30P:'   MTAG                            CSW097
      *
      ** Format field :14A: using the business day convention.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELMGBDAC    MFLD
     C                     MOVEL':14A:'   MTAG
      *
      ** Format :32B: - If message is '360', use the currency and
      ** notional amount without using a date. Otherwise, use THEIR
      ** currency and THEIR notional amount without using a date.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C           *IN51     IFEQ '1'
      *
     C                     MOVE MGCCY     ZCCY
     C                     MOVE MGNOTA    ZAMNT
      *
     C                     ELSE
     C                     MOVE MGTCCY    ZCCY
     C                     MOVE MGTNAM    ZAMNT
      *
     C                     ENDIF
      *
      ** Format currency and notional amount.
      *
     C                     CALL 'ZM0040'
     C                     PARM           ZAMNT  130
     C                     PARM           ZCCY    3
     C                     PARM           ZSAMNT 15
     C                     PARM           ZSCCY   3
     C                     PARM           ZERR    1
     C                     PARM           ZSWDPC  1                       222373
      *
      ** Error - indicate erroneous fields;
      *
     C           ZERR      IFEQ '1'
     C                     MOVE 'Y'       @ERR
     C                     MOVELERR3N     MFLD
     C                     MOVELMSGA,5    MERR
     C                     ELSE
     C           ZSCCY     CAT  ZSAMNT:0  MFLD
     C                     ENDIF
      *
     C                     MOVEL':32B:'   MTAG
      *
      ** Format field :33B: if message is '361' using OUR currency
      ** and OUR notional amount without using a date.
      *
     C           *IN52     IFEQ '1'
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      ** Format our currency and our notional amount.
      *
     C                     MOVE MGOCCY    ZCCY
     C                     MOVE MGONAM    ZAMNT
      *
     C                     CALL 'ZM0040'
     C                     PARM           ZAMNT
     C                     PARM           ZCCY
     C                     PARM           ZSAMNT
     C                     PARM           ZSCCY
     C                     PARM           ZERR
     C                     PARM           ZSWDPC                          222373
      *
      ** Error - indicate erroneous fields;
      *
     C           ZERR      IFEQ '1'
     C                     MOVE 'Y'       @ERR
     C                     MOVELERR3N     MFLD
     C                     MOVELMSGA,5    MERR
     C                     ELSE
     C           ZSCCY     CAT  ZSAMNT:0  MFLD
     C                     ENDIF
      *
     C                     MOVEL':33B:'   MTAG
      *
     C                     ENDIF
      *                                                                   CSW097
      ***Format*fields*:14B:*using*amortising*indicator.                  CSW097
      *                                                                   CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          MOVELMGAMRT    MFLD                            CSW097
     C***********          MOVEL':14B:'   MTAG                            CSW097
      *
      ** Format field :82a: using the internal customer number
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELSECN      ZDEST
     C                     MOVEL*BLANKS   ACLINE
     C                     MOVE ' '       TAG
     C                     MOVE '82'      FLDNO
     C                     EXSR FSWAD
      *
      ***Format*field*:83a:*using*the*internal*customer*number            CSW097
      ** Format field :87a: using the internal customer number            CSW097
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     MOVE *BLANKS   ZDEST
     C                     MOVELMGCNUM    ZDEST
     C                     MOVEL*BLANKS   ACLINE
     C                     MOVE ' '       TAG
     C***********          MOVE '83'      FLDNO                           CSW097
     C                     MOVE '87'      FLDNO                           CSW097
     C                     EXSR FSWAD
      *                                                                                       CSW208
      ** Format field :83a: using the internal customer number                                CSW208
      *                                                                                       CSW208
     C           CSW024    IFEQ 'Y'                                                           CSW208
     C           CSW208    ANDEQ'Y'                                                           CSW208
      *                                                                                       CSW208
     C                     MOVE *BLANKS   @KEY1                                               CSW208
     C                     MOVELMGCNUM    @KEY1                                               CSW208
     C                     CALL 'AOCUSTR1'                                                    CSW208
     C                     PARM *BLANKS   @RTCD                                               CSW208
     C                     PARM '*KEY'    @OPTN                                               CSW208
     C                     PARM           @KEY1                                               CSW208
     C                     PARM           @KYST                                               CSW208
     C           SDCUST    PARM SDCUST    DSLDY                                               CSW208
      *                                                                                       CSW208
     C           @RTCD     IFEQ *BLANKS                                                       CSW208
     C           BBFUND    ANDNE*BLANKS                                                       CSW208
     C                     ADD  1         X                                                   CSW208
     C           X         OCUR MULT                                                          CSW208
     C           '/NAME/'  CAT  BBFUND    MFLD                                                CSW208
     C                     MOVEL':83J:'   MTAG                                                CSW208
      *                                                                                       CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                     BUG20955
      ** For Midasplus releases only.                                                       BUG20955
      *                                                                                     BUG20955
     C           CSW037    IFEQ 'Y'                                                         BUG20955
     C           BBFNAC    ANDNE*BLANKS                                                     BUG20955
     C                     ADD  1         X                                                 BUG20955
     C           X         OCUR MULT                                                        BUG20955
     C                     MOVE *BLANKS   MFLD                                              BUG20955
     C                     MOVELBBFNAC    MFLD                                              BUG20955
     C                     ENDIF                                                            BUG20955
      *                                                                                       CSW208
     C                     ENDIF                                                              CSW208
      *                                                                   CSW097
      ** Format new tag :17A: - Collateral Agreement Indicator            CSW097
      *                                                                   CSW097
     C           MGCAIN    IFEQ 'N'                                       CSW097
     C           CSW203    ANDNE'Y'                                                           CSW203
      *                                                                                       CSW203
      ** Collateral Agreement Indicator should be conditioned to                              CSW203
      ** MGCAIN <> blanks if CSW203 is installed.                                             CSW203
      *                                                                                       CSW203
     C           MGCAIN    ORNE *BLANKS                                                       CSW203
     C           CSW203    ANDEQ'Y'                                                           CSW203
      *                                                                                       CSW203
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     MOVELMGCAIN    MFLD                            CSW097
     C                     MOVEL':17A:'   MTAG                            CSW097
     C                     ENDIF                                          CSW097
      *
      ** Format field :77H: using TYPE, DATE and VERSION
      ** of ISDA agreement.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C***********          MOVE MGAGDT    @AGDT   6                       CSW097
     C                     MOVE MGAGDT    @AGDT   8                       CSW097
     C***********          MOVE MGAGVV    @AGVV   2                       CSW097
     C                     MOVE MGAGVV    @AGVV   4                       CSW097
      *
     C                     MOVELMGAGTY    MFLD
     C           MGAGTY    IFNE 'OTHER '
     C           MGAGTY    OREQ 'OTHER '                                  171312
     C           MGAGDT    ANDNE0                                         171312
     C           MGAGVV    ANDNE0                                         171312
     C           MGAGTY    ANDNE'BBAIRS'                                  CSW097
     C           MFLD      CAT  '/':0     MFLD
     C           MFLD      CAT  @AGDT:0   MFLD
     C           MFLD      CAT  '//':0    MFLD
     C           MFLD      CAT  @AGVV:0   MFLD
     C                     ENDIF
     C                     MOVEL':77H:'   MTAG
      *
      ** Format field :77D: using contents of conditions - 1 to 6.
      *
     C           MGCON1    IFNE *BLANKS
      *
      ** Store the CONDITIONS information for easier use.
      *
     C                     MOVE MGCON1    SR2F,1
     C                     MOVE MGCON2    SR2F,2
     C                     MOVE MGCON3    SR2F,3
     C                     MOVE MGCON4    SR2F,4
     C                     MOVE MGCON5    SR2F,5
     C                     MOVE MGCON6    SR2F,6
      *
     C                     Z-ADD0         I
      *
      ** Search through all six fields & output if not blank.
      *
     C           I         DOWLT6
      *
     C                     ADD  1         I
     C           SR2F,I    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C           I         IFEQ 1
     C                     MOVE ':77D:'   MTAG
     C                     ENDIF
      *                                                                                       195931
      ** First line of 77D must contain the word 'NONE' if 14A                                195931
      ** has field = 'OTHER'                                                                  195931
      *                                                                                       195931
     C           I         IFEQ 1                                                             195931
     C           MGBDAC    ANDEQ'OTHER   '                                                    195931
     C                     MOVEL'NONE'    MFLD                                                195931
     C                     ELSE                                                               195931
     C                     MOVELSR2F,I    MFLD
     C                     ENDIF                                                              195931
      *                                                                                       195931
     C                     ELSE
     C                     LEAVE
     C                     ENDIF
      *
     C                     ENDDO
      *
     C                     ELSE                                                               195931
     C           MGBDAC    IFEQ 'OTHER   '                                                    195931
     C                     ADD  1         X                                                   195931
     C           X         OCUR MULT                                                          195931
     C                     MOVE ':77D:'   MTAG                                                195931
     C                     MOVEL'NONE'    MFLD                                                195931
     C                     ENDIF                                                              195931
     C                     ENDIF
      *
      ** Format field :14C: using RULES OF ISDA VERSION
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELMGISDA    MFLD
     C                     MOVEL':14C:'   MTAG
      *
      ***Format*field*:29A:*using*contact*name*and*tel.*no.               CSW097
      *                                                                   CSW097
     C***********MGCTC1    IFNE *BLANKS                                   CSW097
      *                                                                   CSW097
      ***Store*the*contact*name*and*tel.*no.*for*easier*use.              CSW097
      *                                                                   CSW097
     C***********          MOVE MGCTC1    SR2F,1                          CSW097
     C***********          MOVE MGCTC2    SR2F,2                          CSW097
     C***********          MOVE MGCTC3    SR2F,3                          CSW097
     C***********          MOVE MGCTC4    SR2F,4                          CSW097
      *                                                                   CSW097
     C***********          Z-ADD0         I                               CSW097
      *                                                                   CSW097
      ***Search*through*all*six*fields*&*output*if*not*blank.             CSW097
      *                                                                   CSW097
     C***********I         DOWLT4                                         CSW097
      *                                                                   CSW097
     C***********          ADD  1         I                               CSW097
     C***********SR2F,I    IFNE *BLANKS                                   CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********I         IFEQ 1                                         CSW097
     C***********          MOVE ':29A:'   MTAG                            CSW097
     C***********          ENDIF                                          CSW097
     C***********          MOVELSR2F,I    MFLD                            CSW097
     C***********          ELSE                                           CSW097
     C***********          LEAVE                                          CSW097
     C***********          ENDIF                                          CSW097
      *                                                                   CSW097
     C***********          ENDDO                                          CSW097
      *                                                                   CSW097
     C***********          ENDIF                                          CSW097
      *
      ** Format field :72: using the sender to receiver info.
      *
     C                     EXSR FLD72
      *                                                                   CSW097
      ** Check if seq B1, C1-C3, E1, and F1-F3 on MT360 message           CSW097
      ** for a Forward Rate Agreement will be suppressed.                 CSW097
      *                                                                   CSW097
     C                     EXSR SRSUPR                                    CSW097
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   FMTB - Format Sequence B MT360/MT361 fields for output.     *
      *   Called by - main processing                                 *
      *   Calls     - FRMTBE Common subroutine for sequence B or E    *
      *****************************************************************
      *
     C           FMTB      BEGSR
      *
      ** Initialise fields for formatting using 'THEIR'.
      *
     C                     MOVEL':15B:'   @TAGTP  5
     C***********          MOVEL':34R:'   @TAGTY  5                       CSW097
     C                     Z-ADDMGBFXR    @FXR   117
     C                     MOVE MGTDCF    @CLCM   7
     C***********          MOVE MGTBSD    @BSD   35                       CSW097
     C                     MOVE MGTIPF    W@IPF   1                       CSW097
     C                     MOVE 'B'       @MSSQ   1
     C           *IN51     IFEQ '1'
     C                     MOVE MGCCY     @CCY
     C                     ELSE
     C                     MOVE MGTCCY    @CCY
     C                     ENDIF
      *                                                                   CSW097
     C           K@MGX     CHAINMGX36NPD             10                   CSW097
     C           *IN10     IFEQ *OFF                                      CSW097
     C                     MOVE MGRSCY    WASTCY  3                       CSW097
     C                     ENDIF                                          CSW097
     C*                                                                   171312
     C                     MOVE WTSUPR    W@SUPR                          171312
     C*                                                                   171312
      *
      ** Call common subroutine to format fields.
      *
     C                     EXSR FRMTBE
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   FMTC - Format Sequence C MT360/MT361 fields for output.     *
      *   Called by - main processing                                 *
      *   Calls     - FRMTCF Common subroutine for sequence C or F    *
      *****************************************************************
      *
     C           FMTC      BEGSR
      *
      ** Initialise fields for formatting using 'THEIR'.
      *
     C                     MOVEL':15C:'   @TAGTP
     C                     MOVE MGTFLO    @FLO   24
     C                     MOVE MGTDSM    @DSM    3
     C                     MOVE MGTCMP    @CMP    1
     C***********          MOVE MGTCPA    @CPA    1                       CSW097
     C***********          MOVE MGTIPF    @IPF    1                       CSW097
     C***********          MOVE MGTRCF    @RCF    1                       CSW097
     C                     MOVE MGTDCF    @CLCM
     C***********          MOVE MGTBSD    @BSD                            CSW097
     C***********          Z-ADDMGTBSV    @BSV   117                      CSW097
     C                     Z-ADDMGTSPD    @SPD   117
     C                     MOVE MGTOM1    @OTM1  35                       CSW097
     C                     MOVE MGTOM2    @OTM2  35                       CSW097
     C                     MOVEL'C'       @MSSQ
     C*                                                                   171312
     C                     MOVE WTSUPR    W@SUPR                          171312
      *
      ** Call common subroutine to format fields.
      *
     C                     EXSR FRMTCF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   FMTD - Format Sequence D MT360/MT361 fields for output.     *
      *   Called by - main processing                                 *
      *   Calls     - RECV                                            *
      *****************************************************************
      *
     C           FMTD      BEGSR
      *
      ** Format field :15D: as blank.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   MFLD
     C                     MOVEL':15D:'   MTAG
      *
      ** Check if message type is '360' or '361' to determine
      ** currency to use.
      *
     C           *IN51     IFEQ '1'
     C                     MOVE MGCCY     @CCY
     C                     ELSE
     C                     MOVE MGTCCY    @CCY
     C                     ENDIF
      *
     C                     EXSR RECV
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   FMTE - Format Sequence E MT360/MT361 fields for output.     *
      *   Called by - main processing                                 *
      *   Calls     - FRMTBE Common subroutine for sequence B or E    *
      *****************************************************************
      *
     C           FMTE      BEGSR
      *
      ** Initialise fields for formatting using 'OUR'.
      *
     C                     MOVEL':15E:'   @TAGTP
     C***********          MOVEL':34P:'   @TAGTY                          CSW097
     C                     Z-ADDMGEFXR    @FXR
     C                     MOVE MGODCF    @CLCM
     C***********          MOVE MGOBSD    @BSD                            CSW097
     C                     MOVE MGOIPF    W@IPF                           CSW097
     C                     MOVE 'E'       @MSSQ
     C           *IN51     IFEQ '1'
     C                     MOVE MGCCY     @CCY
     C                     ELSE
     C                     MOVE MGOCCY    @CCY
     C                     ENDIF
     C           K@MGX     CHAINMGX36NPD             10                   CSW097
     C           *IN10     IFEQ *OFF                                      CSW097
     C                     MOVE MGPSCY    WASTCY                          CSW097
     C                     ENDIF                                          CSW097
     C*                                                                   171312
     C                     MOVE WOSUPR    W@SUPR                          171312
     C*                                                                   171312
      *
      ** Call common subroutine to format fields.
      *
     C                     EXSR FRMTBE
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   FMTF - Format Sequence F MT360/MT361 fields for output.     *
      *   Called by - main processing                                 *
      *   Calls     - FRMTCF Common subroutine for sequence C or F    *
      *****************************************************************
      *
     C           FMTF      BEGSR
      *
      ** Initialise fields for formatting using 'OUR'.
      *
     C                     MOVEL':15F:'   @TAGTP
     C                     MOVE MGOFLO    @FLO
     C                     MOVE MGODSM    @DSM
     C                     MOVE MGOCMP    @CMP
     C***********          MOVE MGOCPA    @CPA                            CSW097
     C***********          MOVE MGOIPF    @IPF                            CSW097
     C***********          MOVE MGORCF    @RCF                            CSW097
     C                     MOVE MGODCF    @CLCM
     C***********          MOVE MGOBSD    @BSD                            CSW097
     C***********          Z-ADDMGOBSV    @BSV                            CSW097
     C                     Z-ADDMGOSPD    @SPD
     C                     MOVE MGOOM1    @OTM1  35                       CSW097
     C                     MOVE MGOOM2    @OTM2  35                       CSW097
     C                     MOVEL'F'       @MSSQ
     C*                                                                   171312
     C                     MOVE WOSUPR    W@SUPR                          171312
      *
      ** Call common subroutine to format fields.
      *
     C                     EXSR FRMTCF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   FMTG - Format Sequence G MT360/MT361 fields for output.     *
      *   Called by - main processing                                 *
      *   Calls     - PAY                                             *
      *****************************************************************
      *
     C           FMTG      BEGSR
      *
      ** Format field :15G: as blank.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   MFLD
     C                     MOVEL':15G:'   MTAG
      *
      ** Check if message type is '360' or '361' to determine
      ** currency to use.
      *
     C           *IN51     IFEQ '1'
     C                     MOVE MGCCY     @CCY
     C                     ELSE
     C                     MOVE MGOCCY    @CCY
     C                     ENDIF
      *
     C                     EXSR PAY
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   FMTH - Format Sequence H MT360/MT361 fields for output.     *
      *   Called by - main processing                                 *
      *   Calls     - FRMTHI                                          *
      *****************************************************************
      *
     C           FMTH      BEGSR
      *
      ** Initialise fields for common subroutine.
      ** SWIFT 2015 Change: Re-label sequences H-O to I-P for MT361                           CSW215
      *
     C           *IN52     IFEQ '1'                                                           CSW215
     C           CSW215    ANDEQ'Y'                                                           CSW215
     C                     MOVEL':15I:'   @TAGTP                                              CSW215
     C                     MOVE 'I'       @MSSQ                                             MD034496
     C                     ELSE                                                               CSW215
     C                     MOVEL':15H:'   @TAGTP
     C**********           ENDIF                                                     CSW215 MD034496
     C                     MOVE 'H'       @MSSQ
     C                     ENDIF                                                            MD034496
     C           *IN51     IFEQ '1'
     C                     MOVE MGCCY     @CCY
     C                     ELSE
     C                     MOVE MGTCCY    @CCY
     C***********          MOVE MGTPRA    @PRA    1                       CSW097
     C                     ENDIF
     C           K@MGX     CHAINMGX36NPD             10                   CSW097
     C           *IN10     IFEQ *OFF                                      CSW097
     C                     MOVE MGRSCY    WASTCY                          CSW097
     C                     ENDIF                                          CSW097
      *
      ** Call common subroutine to format fields for output.
      *
     C                     EXSR FRMTHI
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   FMTI61 - Format Sequence I MT361 fields for output.         *
      *   Called by - main processing                                 *
      *   Calls     - FRMTHI                                          *
      *****************************************************************
      *
     C           FMTI61    BEGSR
      *
      ** Initialise fields for common subroutine.
      ** SWIFT 2015 Change: Re-label sequences H-O to I-P for MT361                           CSW215
      *
     C           *IN52     IFEQ '1'                                                           CSW215
     C           CSW215    ANDEQ'Y'                                                           CSW215
     C                     MOVEL':15J:'   @TAGTP                                              CSW215
     C                     MOVE 'J'       @MSSQ                                             MD034496
     C                     ELSE                                                               CSW215
     C                     MOVEL':15I:'   @TAGTP
     C**********           ENDIF                                                     CSW215 MD034496
     C                     MOVE 'I'       @MSSQ
     C                     ENDIF                                                            MD034496
     C                     MOVE MGOCCY    @CCY
     C***********          MOVE MGOPRA    @PRA                            CSW097
     C           K@MGX     CHAINMGX36NPD             10                   CSW097
     C           *IN10     IFEQ *OFF                                      CSW097
     C                     MOVE MGPSCY    WASTCY                          CSW097
     C                     ENDIF                                          CSW097
      *
      ** Call common subroutine to format fields for output.
      *
     C                     EXSR FRMTHI
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   FMTJ61 - Format Sequence J MT361 fields for output          *
      *   Called by - main processing                                 *
      *   Calls     - FRJKLM                                          *
      *****************************************************************
      *
     C           FMTJ61    BEGSR
      *
      ** Initialise fields for formatting.
      ** SWIFT 2015 Change: Re-label sequences H-O to I-P for MT361                           CSW215
      *
     C           *IN52     IFEQ '1'                                                           CSW215
     C           CSW215    ANDEQ'Y'                                                           CSW215
     C                     MOVEL':15K:'   @TAGTP                                              CSW215
     C                     MOVEL'K'       @MSSQ                                             MD034496
     C                     ELSE                                                               CSW215
     C                     MOVEL':15J:'   @TAGTP
     C                     MOVEL'J'       @MSSQ                                             MD034496
     C                     ENDIF                                                              CSW215
     C                     MOVELMGADAT    @DAT    50
     C                     MOVE MGTCCY    @CCY    3
     C***********          Z-ADDMGTIPA    @AMT   150                      CSW097
     C**********           MOVEL'J'       @MSSQ                                      CSW097 MD034496
     C           K@MGX     CHAINMGX36NPD             10                   CSW097
     C           *IN10     IFEQ *OFF                                      CSW097
     C                     MOVE MGRSCY    WASTCY                          CSW097
     C                     ENDIF                                          CSW097
      *
      ** Call common subroutine for formatting fields.
      *
     C                     EXSR FRJKLM
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   FMTK61 - Format Sequence K MT361 fields for output          *
      *   Called by - main processing                                 *
      *   Calls     - FRJKLM                                          *
      *****************************************************************
      *
     C           FMTK61    BEGSR
      *
      ** Initialise fields for formatting.
      ** SWIFT 2015 Change: Re-label sequences H-O to I-P for MT361                           CSW215
      *
     C           *IN52     IFEQ '1'                                                           CSW215
     C           CSW215    ANDEQ'Y'                                                           CSW215
     C                     MOVEL':15L:'   @TAGTP                                              CSW215
     C                     MOVEL'L'       @MSSQ                                             MD034496
     C                     ELSE                                                               CSW215
     C                     MOVEL':15K:'   @TAGTP
     C                     MOVEL'K'       @MSSQ                                             MD034496
     C                     ENDIF                                                              CSW215
     C                     MOVELMGADAT    @DAT    50
     C                     MOVE MGOCCY    @CCY
     C***********          Z-ADDMGOIPA    @AMT   150                      CSW097
     C**********           MOVEL'K'       @MSSQ                                      CSW097 MD034496
     C           K@MGX     CHAINMGX36NPD             10                   CSW097
     C           *IN10     IFEQ *OFF                                      CSW097
     C                     MOVE MGPSCY    WASTCY                          CSW097
     C                     ENDIF                                          CSW097
      *
      ** Call common subroutine for formatting fields.
      *
     C                     EXSR FRJKLM
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   FMTL61 - Format Sequence L mT361 fields for output          *
      *   Called by - main processing                                 *
      *   Calls     - FRJKLM                                          *
      *****************************************************************
      *
     C           FMTL61    BEGSR
      *
      ** Initialise fields for formatting.
      ** SWIFT 2015 Change: Re-label sequences H-O to I-P for MT361                           CSW215
      *
     C           *IN52     IFEQ '1'                                                           CSW215
     C           CSW215    ANDEQ'Y'                                                           CSW215
     C                     MOVEL':15M:'   @TAGTP                                              CSW215
     C                     MOVEL'M'       @MSSQ                                             MD034496
     C                     ELSE                                                               CSW215
     C                     MOVEL':15L:'   @TAGTP
     C                     MOVEL'L'       @MSSQ                                             MD034496
     C                     ENDIF                                                              CSW215
     C                     MOVELMGMDAT    @DAT
     C           *IN51     IFEQ '1'                                       CSW097
     C                     MOVE MGCCY     @CCY                            CSW097
     C                     ELSE                                           CSW097
     C                     MOVE MGTCCY    @CCY
     C                     ENDIF                                          CSW097
     C***********          Z-ADDMGTFPA    @AMT                            CSW097
     C                     Z-ADDMGTUFF    @AMT   150                      CSW097
     C**********           MOVEL'L'       @MSSQ                                      CSW097 MD034496
     C           K@MGX     CHAINMGX36NPD             10                   CSW097
     C           *IN10     IFEQ *OFF                                      CSW097
     C                     MOVE MGRSCY    WASTCY                          CSW097
     C                     ENDIF                                          CSW097
      *
      ** Call common subroutine for formatting fields.
      *
     C                     EXSR FRJKLM
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   FMTM61 - Format Sequence M MT361 fields for output          *
      *   Called by - main processing                                 *
      *   Calls     - FRJKLM                                          *
      *****************************************************************
      *
     C           FMTM61    BEGSR
      *
      ** Initialise fields for formatting.
      ** SWIFT 2015 Change: Re-label sequences H-O to I-P for MT361                           CSW215
      *
     C           *IN52     IFEQ '1'                                                           CSW215
     C           CSW215    ANDEQ'Y'                                                           CSW215
     C                     MOVEL':15N:'   @TAGTP                                              CSW215
     C                     MOVEL'N'       @MSSQ                                             MD034496
     C                     ELSE                                                               CSW215
     C                     MOVEL':15M:'   @TAGTP
     C                     MOVEL'M'       @MSSQ                                             MD034496
     C                     ENDIF                                                              CSW215
      *                                                                                       CSW215
     C                     MOVELMGMDAT    @DAT
     C           *IN51     IFEQ '1'                                       CSW097
     C                     MOVE MGCCY     @CCY                            CSW097
     C                     ELSE                                           CSW097
     C                     MOVE MGOCCY    @CCY
     C                     ENDIF                                          CSW097
     C***********          Z-ADDMGOFPA    @AMT                            CSW097
     C                     Z-ADDMGOUFF    @AMT                            CSW097
     C**********           MOVEL'M'       @MSSQ                                      CSW097 MD034496
     C           K@MGX     CHAINMGX36NPD             10                   CSW097
     C           *IN10     IFEQ *OFF                                      CSW097
     C                     MOVE MGPSCY    WASTCY                          CSW097
     C                     ENDIF                                          CSW097
      *
      ** Call common subroutine for formatting fields.
      *
     C                     EXSR FRJKLM
      *
     C                     ENDSR
      /EJECT
      *****************************************************************   CSW097
      ****FMTNI**-*Format*Sequence*N*MT361*fields*/*Sequence*I*MT360***   CSW097
      *************for*output******************************************   CSW097
      ****Called*by*-*main*processing**********************************   CSW097
      ****Calls*****-*FRNIOJ*******************************************   CSW097
      *****************************************************************   CSW097
      *                                                                   CSW097
     C***********FMTNI     BEGSR                                          CSW097
      *                                                                   CSW097
      ** Initialise*fields*for*formatting.                                CSW097
      *                                                                   CSW097
     C************IN51     IFEQ '1'                                       CSW097
     C***********          MOVEL':15I:'   @TAGTP                          CSW097
     C***********          MOVE MGCCY     @CCY                            CSW097
     C***********          ELSE                                           CSW097
     C***********          MOVEL':15N:'   @TAGTP                          CSW097
     C***********          MOVE MGTCCY    @CCY                            CSW097
     C***********          ENDIF                                          CSW097
      *                                                                   CSW097
     C***********          MOVELMGUPVD    @DAT                            CSW097
     C***********          Z-ADDMGTUFF    @AMT                            CSW097
      *                                                                   CSW097
      ***Call*common*subroutine*for*formatting*fields.                    CSW097
      *                                                                   CSW097
     C***********          EXSR FRNIOJ                                    CSW097
      *                                                                   CSW097
     C***********          ENDSR                                          CSW097
      /EJECT                                                              CSW097
      *****************************************************************   CSW097
      ****FMTOJ**-*Format*Sequence*O*MT361*fields*/*Sequence*J*MT360***   CSW097
      *************for*output******************************************   CSW097
      ****Called*by*-*main*processing**********************************   CSW097
      ****Calls*****-*FRNIOJ*******************************************   CSW097
      *****************************************************************   CSW097
      *                                                                   CSW097
     C***********FMTOJ     BEGSR                                          CSW097
      *                                                                   CSW097
      ***Initialise*fields*for*formatting.                                CSW097
      *                                                                   CSW097
     C************IN51     IFEQ '1'                                       CSW097
     C***********          MOVEL':15J:'   @TAGTP                          CSW097
     C***********          MOVE MGCCY     @CCY                            CSW097
     C***********          ELSE                                           CSW097
     C***********          MOVEL':15O:'   @TAGTP                          CSW097
     C***********          MOVE MGOCCY    @CCY                            CSW097
     C***********          ENDIF                                          CSW097
      *                                                                   CSW097
     C***********          MOVELMGUPVD    @DAT                            CSW097
     C***********          Z-ADDMGOUFF    @AMT                            CSW097
      *                                                                   CSW097
      ***Call*common*subroutine*for*formatting*fields.                    CSW097
      *                                                                   CSW097
     C***********          EXSR FRNIOJ                                    CSW097
      *                                                                   CSW097
     C***********          ENDSR                                          CSW097
      /EJECT
      *****************************************************************
      *   FRMTBE - Common subroutine for Sequence B or E              *
      *   Called by - FMTB Sequence B (THEIR) fields                  *
      *               FMTC Sequence E (OUR) fields                    *
      *   Calls     -                                                 *
      *****************************************************************
      *
     C           FRMTBE    BEGSR
      *
      ** Output field :15B: as a blank field.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANK    MFLD
     C                     MOVEL@TAGTP    MTAG
      *
      ***Format*field*:37U:*using*THEIR/OUR*fixed*rate*if*it*is           CSW097
      ***not*equal8to*zero.                                               CSW097
      ** Format field :37U: using THEIR/OUR fixed rate if:                CSW097
      **    1. Transaction Type = 'FR'                                    CSW097
      **    2. Transaction Type = 'RS'/'RX'  and                          CSW097
      **       THEIR/OUR Int Pymnt Freq <> 'C'                            CSW097
      *
     C***********@FXR      IFNE 0                                         CSW097
     C           MGTTYP    IFEQ 'FR'                                      CSW097
     C           MGTTYP    OREQ 'RS'                                      CSW097
     C           W@IPF     ANDNE'C'                                       CSW097
     C           MGTTYP    OREQ 'RX'                                      CSW097
     C           W@IPF     ANDNE'C'                                       CSW097
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     Z-ADD@FXR      ZPRIC  158
     C                     MOVE *BLANKS   ZSPRIC 16
     C                     MOVE *BLANKS   ZOPRIC 21
      *
     C                     CALL 'ZM1190'               28
     C                     PARM           ZPRIC
     C                     PARM           ZSPRIC
     C                     PARM           ZOPRIC
      *
      ** If program is not found, then dbase error.
      *
     C           *IN28     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '025'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 025  *
     C                     MOVEL'ZM1190'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C           MGTTYP    IFEQ 'RS'                                                        AR814519
     C           @FXR      ANDLT0                                                           AR814519
     C           MGTTYP    OREQ 'RX'                                                        AR814519
     C           @FXR      ANDLT0                                                           AR814519
     C           'N'       CAT  ZSPRIC:0  MFLD                                              AR814519
     C                     ELSE                                                             AR814519
     C                     MOVELZSPRIC    MFLD
     C                     ENDIF                                                            AR814519
      *                                                                                     AR814519
      *                                                                                       CSW216
      ** If SWIFT 2016 is enabled, use 37M tag.                                               CSW216
      *                                                                                       CSW216
     C           CSW216    IFEQ 'Y'                                                           CSW216
     C                     MOVEL':37M:'   MTAG                                                CSW216
     C                     ELSE                                                               CSW216
     C                     MOVEL':37U:'   MTAG
     C                     ENDIF                                                              CSW216
      *
     C                     ENDIF
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C           @MSSQ     IFEQ 'B'                                       CIR005
     C           MGTTYP    ANDEQ'RX'                                      CIR005
      *                                                                                       CIR017
     C           CIR017    OREQ 'Y'                                                           CIR017
     C           @MSSQ     ANDEQ'B'                                                           CIR017
     C           MGTTYP    ANDEQ'RS'                                                          CIR017
      *                                                                                       CIR017
     C                     MOVELMGBDL2    WBDAC   9                       CIR005
     C                     MOVELMGTPDC    WPDCN   2                       CIR005
     C                     MOVELMGTACN    WAMCN   2                       184003
     C                     ELSE                                           CIR005
     C                     MOVELMGBDAC    WBDAC                           CIR005
     C                     MOVELMGOPDC    WPDCN                           CIR005
     C                     MOVELMGOACN    WAMCN                           184003
     C                     ENDIF                                          CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CSW097
      ** Format field :37N: only if:                                      CSW097
      **    1. Transaction Type = 'FR'                                    CSW097
      **    2. Transaction Type = 'RS'/'RX'  and                          CSW097
      **       THEIR/OUR Int Pymnt Freq <> 'C'                            CSW097
      *                                                                   CSW097
     C                     MOVE *BLANK    FLD37N                          178970
      *                                                                   178970
     C           MGTTYP    IFEQ 'FR'                                      CSW097
     C           MGTTYP    OREQ 'RS'                                      CSW097
     C           W@IPF     ANDNE'C'                                       CSW097
     C           MGTTYP    OREQ 'RX'                                      CSW097
     C           W@IPF     ANDNE'C'                                       CSW097
      *                                                                   CSW097
     C           @CLCM     IFEQ '4'                                       CSW097
     C           @CLCM     OREQ '5'                                       CSW097
     C           @CLCM     OREQ '9'                                       CIR013
      *                                                                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     MOVEA@CMSG,1   MFLD                            CSW097
     C                     MOVEL':37N:'   MTAG                            CSW097
     C                     MOVE 'Y'       FLD37N                          178970
      *                                                                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
      *                                                                   CSW097
     C           @CLCM     IFEQ '4'                                       CSW097
     C                     MOVEA@CMSG,2   MFLD                            CSW097
     C                     ELSE                                           CSW097
     C           @CLCM     IFEQ '9'                                       CIR013
     C                     MOVEA@CMSG,11  MFLD                            CIR013
     C                     ELSE                                           CIR013
     C                     MOVEA@CMSG,3   MFLD                            CSW097
     C                     ENDIF                                          CSW097
     C                     ENDIF                                          CIR013
      *                                                                   CSW097
     C                     ENDIF                                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CIR005
      ** If :22B: contains OTHR, :37N: must contain /LOCC/+ English       178970
      ** Location Name                                                    178970
      *                                                                   178970
     C                     EXSR SR37LC                                    178970
      *                                                                   178970
      ** Business day convention                                          CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C           WBDAC     ANDEQ'OTHER  '                                 CIR005
     C           MGTTYP    IFEQ 'RS'                                      CIR005
     C           MGTTYP    OREQ 'RX'                                      CIR005
      *                                                                   CIR005
     C                     ADD  1         X                               CIR005
     C           X         OCUR MULT                                      CIR005
     C           FLD37N    IFNE 'Y'                                                           236232
     C           W@IPF     IFEQ 'C'                                       CIR005
     C           @CLCM     ANDEQ'4'                                       CIR005
     C           W@IPF     OREQ 'C'                                       CIR005
     C           @CLCM     ANDEQ'5'                                       CIR005
     C           W@IPF     OREQ 'C'                                       CIR013
     C           @CLCM     ANDEQ'9'                                       CIR013
     C           @CLCM     ORNE '4'                                       CIR005
     C           @CLCM     ANDNE'5'                                       CIR005
     C           @CLCM     ANDNE'9'                                       CIR013
     C                     MOVEL':37N:'   MTAG                            CIR005
     C                     MOVE 'Y'       FLD37N                                              236232
     C                     ENDIF                                          CIR005
     C                     ENDIF                                                              236232
      *                                                                   CIR005
     C                     MOVEA@CMSG,8   MFLD                            CIR005
     C                     ADD  1         X                               CIR005
     C           X         OCUR MULT                                      CIR005
      *                                                                   CIR005
     C           WPDCN     IFEQ *BLANKS                                   CIR005
     C                     MOVEA@CMSG,9   MFLD                            CIR005
     C                     ELSE                                           CIR005
     C                     MOVEA@CMSG,10  MFLD                            CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
     C                     ENDIF                                          CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CSW097
     C           W@SUPR    IFNE 'Y'                                       CSW097
      *
      ** Add field :18A: to the multiple occurrence data structure
      ***and*to*be*formatted*after*fields*:34R:*or*:38C:*are*counted.     CSW097
      ** and to be formatted after fields :30F: or :32M: are counted.     CSW097
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVEL':18A:'   MTAG
     C***********          Z-ADDX         @C18A   20                      CSW097
     C                     Z-ADDX         @C18A   30                      CSW097
      *
      ***Format*field*:34R:*or*:38C:                                      CSW097
      ** Format field :30F: and/or :32M:                                  CSW097
      *
      ** Set lower limits on PF/MGY36NPD using key of sequence no.
      ** from MGF36NL0.
      *
     C***********          Z-ADD0         COUNT   20                      CSW097
     C                     Z-ADD0         COUNT   50                      CSW097
     C***********          Z-ADDMGSEQN    @SEQN   50                      CSW097
     C***********          MOVEL*BLANKS   WEXS    1                       CSW097
     C***********          SETOF                     44                   CSW097
      *                                                                   CSW097
      ***Construct*key*list.                                              CSW097
      ** This definition has been moved to SR/INIT                        CSW097
      *                                                                   CSW097
     C***********KEYSQN    KLIST                                          CSW097
     C***********          KFLD           @SEQN                           CSW097
     C***********          KFLD           @MSSQ                           CSW097
      *
     C           KEYSQN    SETLLMGY36NPD
      *
      ** Read a record from MGY36NPD while key is the same.
      *
     C                     READ MGY36NPD                 07
      *
     C           WSEQNY    DOWEQ@SEQN
     C           MGMSSQ    ANDEQ@MSSQ
     C           *IN07     ANDEQ'0'
      *
     C                     MOVE MGPDAT    ZMDAY
      *
      ** Convert Midas date to SWIFT date format.
      *
     C***********          CALL 'ZM0060'               15                 CSW097
     C                     CALL 'ZM0065'               15                 CSW097
     C                     PARM           ZMDAY
     C                     PARM           ZSDATE
     C                     PARM           ZSDATC                          CSW097
      *                                                                   CSW097
      ** Format new tag, :30F: - Payment Date                             CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     MOVELZSDATC    MFLD                            CSW097
     C                     MOVEL':30F:'   MTAG                            CSW097
      *                                                                   CSW097
      ** Increment Number of Repetitions                                  CSW097
     C                     ADD  1         COUNT                           CSW097
      *                                                                   CSW097
     C***********          MOVELZSDATE    YYMMDD                          CSW097
     C***********          MOVE YYMMDD    MMDD    4                       CSW097
     C***********COUNT     IFEQ 0                                         CSW097
     C***********          MOVELYYMMDD    YYOLD   2                       CSW097
     C***********          MOVELYYMMDD    YYNEW   2                       CSW097
     C***********          ELSE                                           CSW097
     C***********          MOVELYYNEW     YYOLD                           CSW097
     C***********          MOVELYYMMDD    YYNEW                           CSW097
     C***********          ENDIF                                          CSW097
      *
     C           MGPAMT    IFNE 0
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      ***Format*field*:34R:*using*payment*date,*payment*amount            CSW097
      ***and*currency*workfield.                                          CSW097
     C************IN44     IFNE '1'                                       CSW097
     C***********          SETON                     44                   CSW097
     C***********          ENDIF                                          CSW097
      *
      ** Format currency code and final/initial exchange amount.
      *
      ***Use*settlement*currency*if*different*to*transaction*currenCSW097 171312
      *                                                                   CSW097
     C           K@MGX     CHAINMGX36NPD             10                   CSW097
      *                                                                   CSW097
     C***********WASTCY    IFEQ *BLANKS                            CSW097 171312
     C                     MOVE @CCY      ZCCY
     C***********          ELSE                                    CSW097 171312
     C***********          MOVE WASTCY    ZCCY                     CSW097 171312
     C***********          ENDIF                                   CSW097 171312
      ***********                                                  CSW097 171312
     C***********ZCCY      IFNE @CCY                               CSW097 171312
     C***********          Z-ADDMGPAMT    PAPAMT 183               CSW097 171312
     C***********          CALL 'EU0200'                           CSW097 171312
     C***********          PARM *BLANKS   PARTCD  7        Return CCSW097 171312
     C***********          PARM           PAPAMT           FROM CcyCSW097 171312
     C***********          PARM           @CCY    3        FROM CurCSW097 171312
     C***********          PARM           ZCCY    3        TO CurreCSW097 171312
     C***********          PARM           PAOUTA 150       OutrightCSW097 171312
     C***********          PARM           PAINTA 183       Interim CSW097 171312
     C***********          PARM           PAEXRT 159       ExchangeCSW097 171312
     C***********          PARM           PAMDIN  1        Mult/DivCSW097 171312
     C***********PARTCD    IFEQ '*ERROR*'                          CSW097 171312
     C************LOCK     IN   LDA                                CSW097 171312
     C***********          MOVEL'EU0200  'DBFILE           ********CSW097 171312
     C***********          MOVE '041'     DBASE            * DBERR CSW097 171312
     C***********          MOVE *BLANKS   DBKEY            ********CSW097 171312
     C***********          MOVE *BLANKS   W@OPTN  7                CSW097 171312
     C***********          MOVEL@CCY      W@OPTN                   CSW097 171312
     C***********          MOVE ZCCY      W@OPTN                   CSW097 171312
     C***********          OUT  LDA                                CSW097 171312
     C***********          EXSR *PSSR                              CSW097 171312
     C***********          ELSE                                    CSW097 171312
     C***********          MOVE PAOUTA    ZAMNT                    CSW097 171312
     C***********          ENDIF                                   CSW097 171312
     C***********          ELSE                                    CSW097 171312
     C                     MOVE MGPAMT    ZAMNT
     C***********          ENDIF                                   CSW097 171312
      *
     C                     CALL 'ZM0040'
     C                     PARM           ZAMNT
     C                     PARM           ZCCY
     C                     PARM           ZSAMNT
     C                     PARM           ZSCCY
     C                     PARM           ZERR
     C                     PARM           ZSWDPC                          222373
      *
      ** Error - indicate erroneous fields;
      *
     C           ZERR      IFEQ '1'
     C                     MOVE 'Y'       @ERR
     C                     MOVELERR3N     MFLD
     C                     MOVELMSGA,5    MERR
      *
     C                     ELSE
     C                     MOVELFLD3N     MFLD
     C                     ENDIF
      *
     C***********          ADD  1         COUNT                           CSW097
      *                                                                   CSW097
     C***********          MOVEL@TAGTY    MTAG                            CSW097
     C                     MOVEL':32M:'   MTAG                            CSW097
      *
     C***********          ELSE                                           CSW097
      *
      ***Format*field*:38C:*using*payment*date*if*first*record*read       CSW097
      ***or*year*on*the*payment*date*is*not*equal*to*year*of*the          CSW097
      ***payment*date*of*previous*record*via*SR/FLD38C.                   CSW097
      *                                                                   CSW097
     C***********          EXSR FLD38C                                    CSW097
      *
     C                     ENDIF
      *
     C                     READ MGY36NPD                 07
      *
     C                     ENDDO
      *
      ** Re-access field :18A: and format it using the count of
      ***fields*:34R:*or*:38C:.                                           CSW097
      ** fields :30F: and/or :32M:.                                       CSW097
      *
     C           @C18A     OCUR MULT
     C                     MOVELCOUNT     MFLD
      *                                                                   CSW097
      ** Format new tag, :17F: - Period End Date Adjustment               CSW097
      *                                                                   CSW097
     C           MGTTYP    IFEQ 'FR'                                      CSW097
     C           MGTTYP    OREQ 'RS'                                      CSW097
     C           W@IPF     ANDNE'C'                                       CSW097
     C           MGTTYP    OREQ 'RX'                                      CSW097
     C           W@IPF     ANDNE'C'                                       CSW097
      *                                                                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C           CIR005    IFEQ 'Y'                                       184003
     C           WAMCN     ANDEQ'A '                                      184003
     C                     MOVEL'N'       MFLD                            184003
     C                     ELSE                                           184003
     C                     MOVEL'Y'       MFLD                            CSW097
     C                     ENDIF                                          184003
     C                     MOVEL':17F:'   MTAG                            CSW097
      *                                                                   CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
      ** Format field :14D: using THEIR/OUR interest calculation method   CSW097
      *                                                                   CSW097
     C           MGTTYP    IFEQ 'FR'                                      CSW097
     C           MGTTYP    OREQ 'RS'                                      CSW097
     C           W@IPF     ANDNE'C'                                       CSW097
     C           MGTTYP    OREQ 'RX'                                      CSW097
     C           W@IPF     ANDNE'C'                                       CSW097
      *                                                                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
      *                                                                   CSW097
     C           @CLCM     IFEQ '4'                                       CSW097
     C           @CLCM     OREQ '5'                                       CSW097
     C           @CLCM     OREQ '9'                                       CIR013
     C                     MOVEL'OTHER'   MFLD                            CSW097
     C                     ELSE                                           CSW097
     C                     MOVEL@CLCM     MFLD                            CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     MOVEL':14D:'   MTAG                            CSW097
      *                                                                   CSW097
     C                     ENDIF                                          CSW097
      *
      ** Format field :14A: using business day convention.
      *
     C**********           ADD  1         X                                                 MD035752
     C********** X         OCUR MULT                                                        MD035752
      *                                                                                       CIR017
     C           CIR005    IFEQ 'Y'                                                           CIR017
     C           CIR017    ANDEQ'Y'                                                           CIR017
      *                                                                                     MD035752
     C           WBDAC     IFNE *BLANKS                                                     MD035752
     C                     ADD  1         X                                                 MD035752
     C           X         OCUR MULT                                                        MD035752
     C                     MOVELWBDAC     MFLD                                                CIR017
     C                     MOVEL':14A:'   MTAG                                              MD035752
     C                     ENDIF                                                            MD035752
      *                                                                                     MD035752
     C                     ELSE                                                               CIR017
      *                                                                                     MD035752
     C           MGBDAC    IFNE *BLANKS                                                     MD035752
     C                     ADD  1         X                                                 MD035752
     C           X         OCUR MULT                                                        MD035752
     C                     MOVELMGBDAC    MFLD
     C                     MOVEL':14A:'   MTAG                                              MD035752
     C                     ENDIF                                                            MD035752
      *                                                                                     MD035752
     C                     ENDIF                                                              CIR017
      *                                                                                       CIR017
     C**********           MOVEL':14A:'   MTAG                                              MD035752
      *
      ***Format*field*:14D:*if*THEIR/OUR*interest*calculation*method      CSW097
      ***is*'4'*or*'5'.                                                   CSW097
      *                                                                   CSW097
     C************IN44     IFEQ '0'                                       CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
      *                                                                   CSW097
     C***********@CLCM     IFEQ '4'                                       CSW097
     C***********@CLCM     OREQ '5'                                       CSW097
      *                                                                   CSW097
     C***********          MOVEL'OTHER'   MFLD                            CSW097
      *                                                                   CSW097
     C***********          ELSE                                           CSW097
      *                                                                   CSW097
     C***********          MOVEL@CLCM     MFLD                            CSW097
      *                                                                   CSW097
     C***********          ENDIF                                          CSW097
      *                                                                   CSW097
     C***********          MOVEL':14D:'   MTAG                            CSW097
     C***********          ENDIF                                          CSW097
      *                                                                   CSW097
      ***Format*field*:18A:*as*'00001'.                                   CSW097
      *                                                                   CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          MOVEL'00001'   MFLD                            CSW097
     C***********          MOVEL':18A:'   MTAG                            CSW097
      *                                                                   CSW097
      ** Format new tag :18A: (Number of Repetitions), and                CSW097
      ** :22B: (Financial Centre) via SR/SRFINC                           CSW097
      *                                                                   CSW097
     C                     EXSR SRFINC                                    CSW097
      *                                                                   CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
      ***Format*field*:14E:*using*THEIR/OUR*business*days.                CSW097
      *                                                                   CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          MOVEL@BSD      MFLD                            CSW097
     C***********          MOVEL':14E:'   MTAG                            CSW097
      *                                                                   CSW097
      ***Format*field*:37N:*with*fields*depending*on*THEIR/OUR            CSW097
      ***interest*calculation*method.                                     CSW097
      *                                                                   CSW097
     C************IN44     IFEQ '0'                                       CSW097
     C***********@CLCM     IFEQ '4'                                       CSW097
     C***********@CLCM     OREQ '5'                                       CSW097
      *                                                                   CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          MOVEA@CMSG,1   MFLD                            CSW097
     C***********          MOVEL':37N:'   MTAG                            CSW097
      *                                                                   CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
      *                                                                   CSW097
     C***********MGTDCF    IFEQ '4'                                       CSW097
     C***********          MOVEA@CMSG,2   MFLD                            CSW097
     C***********          ELSE                                           CSW097
     C***********          MOVEA@CMSG,3   MFLD                            CSW097
     C***********          ENDIF                                          CSW097
      *                                                                   CSW097
     C***********          ENDIF                                          CSW097
     C***********          ENDIF                                          CSW097
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   FRMTCF - Common subroutine for Sequence C or F              *
      *   Called by - FMTC Sequence C (THEIR) fields                  *
      *             - FMTF Sequence F (OUR) fields                    *
      *   Calls     -                                                 *
      *****************************************************************
      *
     C           FRMTCF    BEGSR
      *
      ** Output field :15C: as a blank field.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANK    MFLD
     C                     MOVEL@TAGTP    MTAG
      *
      ** Format field :14F: using THEIR/OUR floating rate option.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C           @FLO      IFEQ *BLANKS
      *
     C                     MOVE 'Y'       @ERR
     C                     MOVEL*BLANKS   MFLD
     C                     MOVELMSGA,9    MERR
      *
     C                     ELSE
     C                     MOVEL@FLO      MFLD
      *
     C                     ENDIF
      *
     C                     MOVEL':14F:'   MTAG
     C           CIR005    IFEQ 'Y'                                       CIR005
     C           @MSSQ     IFEQ 'C'                                       CIR005
     C           MGTTYP    ANDEQ'RX'                                      CIR005
      *                                                                                       CIR017
     C           CIR017    OREQ 'Y'                                                           CIR017
     C           @MSSQ     ANDEQ'C'                                                           CIR017
     C           MGTTYP    ANDEQ'RS'                                                          CIR017
      *                                                                                       CIR017
     C                     MOVELMGBDL2    WBDAC                           CIR005
     C                     MOVELMGTPDC    WPDCN                           CIR005
     C                     MOVELMGTACN    WAMCN                           184003
     C                     ELSE                                           CIR005
     C                     MOVELMGBDAC    WBDAC                           CIR005
     C                     MOVELMGOPDC    WPDCN                           CIR005
     C                     MOVELMGOACN    WAMCN                           184003
     C                     ENDIF                                          CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CSW097
      ** Format field :37N: with fields depending on THEIR/OUR            CSW097
      ** interest calculation method.                                     CSW097
      *                                                                   CSW097
     C                     MOVE *BLANK    FLD37N  1                       CSW097
     C           @CLCM     IFEQ '4'                                       CSW097
     C           @CLCM     OREQ '5'                                       CSW097
     C           @CLCM     OREQ '9'                                       CIR013
      *                                                                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     MOVEA@CMSG,1   MFLD                            CSW097
     C                     MOVEL':37N:'   MTAG                            CSW097
     C                     MOVE 'Y'       FLD37N                          CSW097
      *                                                                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
      *                                                                   CSW097
     C           @CLCM     IFEQ '4'                                       CSW097
     C                     MOVEA@CMSG,2   MFLD                            CSW097
     C                     ELSE                                           CSW097
     C           @CLCM     IFEQ '9'                                       CIR013
     C                     MOVEA@CMSG,11  MFLD                            CIR013
     C                     ELSE                                           CIR013
     C                     MOVEA@CMSG,3   MFLD                            CSW097
     C                     ENDIF                                          CSW097
     C                     ENDIF                                          CIR013
     C                     MOVEL*BLANKS   MTAG                            CSW097
      *                                                                   CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CIR005
      ** Business day convention                                          CIR005
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C           WBDAC     ANDEQ'OTHER  '                                 CIR005
     C           MGTTYP    IFEQ 'RS'                                      CIR005
     C           MGTTYP    OREQ 'RX'                                      CIR005
      *                                                                   CIR005
     C                     ADD  1         X                               CIR005
     C           X         OCUR MULT                                      CIR005
     C           @CLCM     IFNE '4'                                       CIR005
     C           @CLCM     ANDNE'5'                                       CIR005
     C           @CLCM     ANDNE'9'                                       CIR013
     C                     MOVEL':37N:'   MTAG                            CIR005
     C                     MOVE 'Y'       FLD37N                                              236232
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
     C                     MOVEA@CMSG,8   MFLD                            CIR005
     C                     ADD  1         X                               CIR005
     C           X         OCUR MULT                                      CIR005
      *                                                                   CIR005
     C           WPDCN     IFEQ *BLANKS                                   CIR005
     C                     MOVEA@CMSG,9   MFLD                            CIR005
     C                     ELSE                                           CIR005
     C                     MOVEA@CMSG,10  MFLD                            CIR005
     C                     ENDIF                                          CIR005
     C                     MOVEL*BLANKS   MTAG                            CIR005
      *                                                                   CIR005
     C                     ENDIF                                          CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CSW097
     C           @DSM      IFEQ 'O'                                       CSW097
     C           @FLO      OREQ 'OTHER'                                   CSW097
      *                                                                   CSW097
     C           @OTM1     IFNE *BLANKS                                   CSW097
      *                                                                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     MOVEA@CMSG,7   MFLD                            CSW097
     C           FLD37N    IFNE 'Y'                                       CSW097
     C                     MOVEL':37N:'   MTAG                            CSW097
     C                     MOVE 'Y'       FLD37N                                              236232
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     MOVEL*BLANKS   MTAG                            CSW097
     C                     MOVEL@OTM1     MFLD                            CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C           @OTM2     IFNE *BLANKS                                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     MOVEL*BLANKS   MTAG                            CSW097
     C                     MOVEL@OTM2     MFLD                            CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
      ** If :22B: contains OTHR, :37N: must contain /LOCC/+ English       178970
      ** Location Name                                                    178970
      *                                                                   178970
     C                     EXSR SR37LC                                    178970
      *                                                                   178970
     C           W@SUPR    IFNE 'Y'                                       CSW097
      *
      ** Format field :14J: as 'FIRST'.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     MOVEL'FIRST'   MFLD
     C                     MOVEL':14J:'   MTAG
      *
      ** Format field :38E: using THEIR/OUR designated maturity.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C           @DSM      IFEQ *BLANKS
      *
     C                     MOVE 'Y'       @ERR
     C                     MOVEL*BLANKS   MFLD
     C                     MOVELMSGA,9    MERR
      *
     C                     ELSE
      *                                                                                      BUG7660
      ** Format as ':38E:0O' if Designated Maturity is 'O' (Other). Otherwise                BUG7660
      ** move actual value (i.e. '1M' etc.).                                                 BUG7660
      *                                                                                      BUG7660
     C           @DSM      IFEQ 'O'                                                          BUG7660
     C                     MOVEL'0O'      MFLD                                               BUG7660
     C                     ELSE                                                              BUG7660
     C                     MOVEL@DSM      MFLD
     C                     ENDIF                                                             BUG7660
      *
     C                     ENDIF
      *
     C                     MOVEL':38E:'   MTAG
      *
      ***Format*field*:14H:*if*THEIR/OUR*interest*processing              CSW097
      ***method*is*equal*to*'C'*or*switchable*feature                     CSW097
      ***CIR002*is*ON*and*rate*change*dates*do*not*match*payment*dates    CSW097
      **(worked*out*in*DL6305)                                            CSW097
      *                                                                   CSW097
     C***********@CMP      IFEQ 'C'                                       CSW097
     C***********@CPA      OREQ 'N'                                       CSW097
      *                                                                   CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          MOVEL'N'       MFLD                            CSW097
     C***********          MOVEL':14H:'   MTAG                            CSW097
     C***********          ENDIF                                          CSW097
      *                                                                   CSW097
      ***Format*field*:14I:                                               CSW097
      *                                                                   CSW097
      ***(1)*If*THEIR/OUR*interest*processing*method*is*'C',*then         CSW097
      ***format*it*basing*on*THEIR/OUR*interest*payment*frequency.        CSW097
      *                                                                   CSW097
      ***(2)*else,*If*CIR002*is*ON,*then*format*it*basing*on              CSW097
      ***THEIR/OUR*rate*change*frequency.                                 CSW097
      *                                                                   CSW097
     C***********@CMP      IFEQ 'C'                                       CSW097
     C***********@CPA      OREQ 'N'                                       CSW097
      *                                                                   CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          MOVEL':14I:'   MTAG                            CSW097
      *                                                                   CSW097
     C***********@CMP      IFEQ 'C'                                       CSW097
     C***********          MOVE @IPF      @FREQ   1                       CSW097
     C***********          ELSE                                           CSW097
     C***********          MOVE @RCF      @FREQ                           CSW097
     C***********          ENDIF                                          CSW097
      *                                                                   CSW097
     C***********          SELEC                                          CSW097
     C***********@FREQ     WHEQ 'M'                                       CSW097
     C***********          MOVEL'01M'     MFLD                            CSW097
     C***********@FREQ     WHEQ 'Q'                                       CSW097
     C***********          MOVEL'03M'     MFLD                            CSW097
     C***********@FREQ     WHEQ 'X'                                       CSW097
     C***********          MOVEL'06M'     MFLD                            CSW097
     C***********@FREQ     WHEQ 'Y'                                       CSW097
     C***********          MOVEL'01Y'     MFLD                            CSW097
     C***********@FREQ     WHEQ 'Z'                                       CSW097
     C***********@FREQ     OREQ 'C'                                       CSW097
     C***********          MOVEL'00O'     MFLD                            CSW097
     C***********          ENDSL                                          CSW097
      *                                                                   CSW097
     C***********          MOVELMFLD      @MFILD  3                       CSW097
      *                                                                   CSW097
     C***********          ENDIF                                          CSW097
      *
      ** Add field :18A: to the multiple occurrence data structure
      ***and*to*be*formatted*after*field*:38C:*is*counted.                CSW097
      ** and to be formatted after field :30F: is counted.                CSW097
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVEL':18A:'   MTAG
     C                     Z-ADDX         @C18A
      *
      ** Set lower limits on PF/MGY36NPD using key of sequence no.
      ** from MGF36NL0.
      *
     C                     Z-ADD0         COUNT
     C***********          Z-ADDMGSEQN    @SEQN                           CSW097
     C***********          MOVEL*BLANKS   WEXS                            CSW097
      *
     C           KEYSQN    SETLLMGY36NPD
      *
      ** Read a record from MGY36NPD while key is the same.
      *
     C                     READ MGY36NPD                 07
      *
     C           WSEQNY    DOWEQ@SEQN
     C           MGMSSQ    ANDEQ@MSSQ
     C           *IN07     ANDEQ'0'
      *
     C                     MOVE MGPDAT    ZMDAY
      *
      ** Convert Midas date to SWIFT date format.
      *
     C***********          CALL 'ZM0060'               15                 CSW097
     C                     CALL 'ZM0065'               15                 CSW097
     C                     PARM           ZMDAY
     C                     PARM           ZSDATE
     C                     PARM           ZSDATC                          CSW097
      *
     C***********          MOVELZSDATE    YYMMDD                          CSW097
     C***********          MOVE YYMMDD    MMDD                            CSW097
     C***********COUNT     IFEQ 0                                         CSW097
     C***********          MOVELYYMMDD    YYOLD                           CSW097
     C***********          MOVELYYMMDD    YYNEW                           CSW097
     C***********          ELSE                                           CSW097
     C***********          MOVELYYNEW     YYOLD                           CSW097
     C***********          MOVELYYMMDD    YYNEW                           CSW097
     C***********          ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     MOVELZSDATC    MFLD                            CSW097
     C                     MOVEL':30F:'   MTAG                            CSW097
     C*                                                                   CSW097
     C                     ADD  1         COUNT                           CSW097
      *                                                                   CSW097
      ***Format*field*:38C:*using*payment*date*if*first*record*read       CSW097
      ***or*year*on*the*payment*date*is*not*equal*to*year*of*the          CSW097
      ***payment*date*of*previous*record*via*SR/FLD38C                    CSW097
      *                                                                   CSW097
     C***********          EXSR FLD38C                                    CSW097
      *
     C                     READ MGY36NPD                 07
      *
     C                     ENDDO
      *
      ** Re-access field :18A: and format it using the count of
      ***field*:38C:.                                                     CSW097
      ** field :30F:.                                                     CSW097
      *
     C           @C18A     OCUR MULT
     C                     MOVELCOUNT     MFLD
      *                                                                   CSW097
      ** Format field :17F: - Period End Date Adjustment as 'Y'           CSW097
      *                                                                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C           CIR005    IFEQ 'Y'                                       184003
     C           WAMCN     ANDEQ'A '                                      184003
     C                     MOVEL'N'       MFLD                            184003
     C                     ELSE                                           184003
     C                     MOVEL'Y'       MFLD                            CSW097
     C                     ENDIF                                          184003
     C                     MOVEL':17F:'   MTAG                            CSW097
      *                                                                   CSW097
      ** Format field :14D: using THEIR/OUR interest calculation          CSW097
      ** method.                                                          CSW097
      *                                                                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
      *                                                                   CSW097
     C           @CLCM     IFEQ '4'                                       CSW097
     C           @CLCM     OREQ '5'                                       CSW097
     C           @CLCM     OREQ '9'                                       CIR013
     C                     MOVEL'OTHER'   MFLD                            CSW097
      *                                                                   CSW097
     C                     ELSE                                           CSW097
     C                     MOVEL@CLCM     MFLD                            CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     MOVEL':14D:'   MTAG                            CSW097
      *
      ** Format field :14A: using business day convention.
      *
     C**********           ADD  1         X                                                 MD035752
     C********** X         OCUR MULT                                                        MD035752
      *                                                                                       CIR017
     C           CIR005    IFEQ 'Y'                                                           CIR017
     C           CIR017    ANDEQ'Y'                                                           CIR017
      *                                                                                     MD035752
     C           WBDAC     IFNE *BLANKS                                                     MD035752
     C                     ADD  1         X                                                 MD035752
     C           X         OCUR MULT                                                        MD035752
     C                     MOVELWBDAC     MFLD                                                CIR017
     C                     MOVEL':14A:'   MTAG                                              MD035752
     C                     ENDIF                                                            MD035752
      *                                                                                     MD035752
     C                     ELSE                                                               CIR017
      *                                                                                     MD035752
     C           MGBDAC    IFNE *BLANKS                                                     MD035752
     C                     ADD  1         X                                                 MD035752
     C           X         OCUR MULT                                                        MD035752
     C                     MOVELMGBDAC    MFLD
     C                     MOVEL':14A:'   MTAG                                              MD035752
     C                     ENDIF                                                            MD035752
      *                                                                                     MD035752
     C                     ENDIF                                                              CIR017
      *                                                                                       CIR017
     C**********           MOVEL':14A:'   MTAG                                              MD035752
      *
      ***Format*field*:14D:*using*THEIR/OUR*interest*calculation          CSW097
      ***method.                                                          CSW097
      *                                                                   CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
      *                                                                   CSW097
     C***********@CLCM     IFEQ '4'                                       CSW097
     C***********@CLCM     OREQ '5'                                       CSW097
     C***********          MOVEL'OTHER'   MFLD                            CSW097
      *                                                                   CSW097
     C***********          ELSE                                           CSW097
     C***********          MOVEL@CLCM     MFLD                            CSW097
     C***********          ENDIF                                          CSW097
      *                                                                   CSW097
     C***********          MOVEL':14D:'   MTAG                            CSW097
      *                                                                   CSW097
      ***Format*field*:18A:*as*'00001'                                    CSW097
      *                                                                   CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          MOVEL'00001'   MFLD                            CSW097
     C***********          MOVEL':18A:'   MTAG                            CSW097
      *                                                                   CSW097
      ** Format new tag :18A: (Number of Repetitions), and                CSW097
      ** :22B: (Financial Centre) via SR/SRFINC                           CSW097
      *                                                                   CSW097
     C                     EXSR SRFINC                                    CSW097
      *                                                                   CSW097
      ***Format*field*:14E:*using*THEIR/OUR*business*days                 CSW097
      *                                                                   CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          MOVEL@BSD      MFLD                            CSW097
     C***********          MOVEL':14E:'   MTAG                            CSW097
      *                                                                   CSW097
      ***Format*field*:37P:*using*THEIR/OUR*initial*floating*rate         CSW097
      *                                                                   CSW097
     C***********@BSV      IFNE *ZEROS                                    CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          Z-ADD@BSV      ZPRIC                           CSW097
     C***********          MOVE *BLANKS   ZSPRIC                          CSW097
     C***********          MOVE *BLANKS   ZOPRIC                          CSW097
      *                                                                   CSW097
     C***********          CALL 'ZM1190'               28                 CSW097
     C***********          PARM           ZPRIC                           CSW097
     C***********          PARM           ZSPRIC                          CSW097
     C***********          PARM           ZOPRIC                          CSW097
      *                                                                   CSW097
      ***If*program*is*not*found,*then*dbase*error.                       CSW097
      *                                                                   CSW097
     C************IN28     IFEQ '1'                                       CSW097
     C************LOCK     IN   LDA                                       CSW097
     C***********          MOVE '025'     DBASE            * * * * * * * *CSW097
     C***********          MOVE *BLANKS   DBKEY            *  DBERR 025  *CSW097
     C***********          MOVEL'ZM1190'  DBPGM            * * * * * * * *CSW097
     C***********          OUT  LDA                                       CSW097
     C***********          EXSR *PSSR                                     CSW097
     C***********          ENDIF                                          CSW097
      *                                                                   CSW097
     C***********          MOVELZSPRIC    MFLD                            CSW097
     C***********          MOVEL':37P:'   MTAG                            CSW097
     C***********          ENDIF                                          CSW097
      *                                                                   CSW097
     C           MGAGTY    IFNE 'AFB'                                     CSW097
      *                                                                                       CSW206
      ** Message tag 37R: will now be allowed when MGAGTY='AFB' if CSW206 is on.              CSW206
      *                                                                                       CSW206
     C           CSW206    OREQ 'Y'                                                           CSW206
     C           MGAGTY    ANDEQ'AFB'                                                         CSW206
      *
      ** Format field :37R: using THEIR/OUR spread rate.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     Z-ADD@SPD      ZPRIC
     C                     MOVE *BLANKS   ZSPRIC
     C                     MOVE *BLANKS   ZOPRIC
      *
     C                     CALL 'ZM1190'               28
     C                     PARM           ZPRIC
     C                     PARM           ZSPRIC
     C                     PARM           ZOPRIC
      *
      ** If program is not found, then dbase error.
      *
     C           *IN28     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '025'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 025  *
     C                     MOVEL'ZM1190'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** If spread rate is less than zero, format with 'N'.
      *
     C           @SPD      IFLT 0
     C           'N'       CAT  ZSPRIC:0  MFLD
     C                     ELSE
     C                     MOVELZSPRIC    MFLD
     C                     ENDIF
      *
     C                     MOVEL':37R:'   MTAG
      *                                                                   CSW097
     C                     ENDIF                                          CSW097
      *
      ***Format*field*:37N:*with*fields*depending*on*THEIR/OUR            CSW097
      ***interest*calculation*method.                                     CSW097
      *                                                                   CSW097
     C***********@CLCM     IFEQ '4'                                       CSW097
     C***********@CLCM     OREQ '5'                                       CSW097
      *                                                                   CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          MOVEA@CMSG,1   MFLD                            CSW097
     C***********          MOVEL':37N:'   MTAG                            CSW097
      *                                                                   CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
      *                                                                   CSW097
     C***********MGTDCF    IFEQ '4'                                       CSW097
     C***********          MOVEA@CMSG,2   MFLD                            CSW097
     C***********          ELSE                                           CSW097
     C***********          MOVEA@CMSG,3   MFLD                            CSW097
     C***********          ENDIF                                          CSW097
     C***********          MOVEL*BLANKS   MTAG                            CSW097
      *                                                                   CSW097
     C***********          ENDIF                                          CSW097
      *                                                                   CSW097
      ***Check*if*field*:14I:*is*formatted*as*'00O'.*If*it*is,*format     CSW097
      ***subsequent*:37N:*fields.                                         CSW097
      *                                                                   CSW097
     C***********@MFILD    IFEQ '00O'                                     CSW097
      *                                                                   CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          MOVEA@CMSG,4   MFLD                            CSW097
      *                                                                   CSW097
     C***********@CLCM     IFEQ '4'                                       CSW097
     C***********@CLCM     OREQ '5'                                       CSW097
     C***********          MOVEL*BLANKS   MTAG                            CSW097
     C***********          ELSE                                           CSW097
     C***********          MOVEL':37N:'   MTAG                            CSW097
     C***********          ENDIF                                          CSW097
      *                                                                   CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
      *                                                                   CSW097
     C***********@CMP      IFEQ 'C'                                       CSW097
     C***********          MOVEA@CMSG,5   MFLD                            CSW097
     C***********          ELSE                                           CSW097
     C***********          MOVEA@CMSG,6   MFLD                            CSW097
     C***********          ENDIF                                          CSW097
     C***********          MOVEL*BLANKS   MTAG                            CSW097
      *                                                                   CSW097
     C***********          ENDIF                                          CSW097
      *                                                                   CSW097
     C           MGAGTY    IFNE 'AFB'                                  '  CSW097
      *                                                                   CSW097
     C           MGTTYP    IFNE 'FR'                                      CSW097
      *                                                                   CSW097
     C           KEYSQN    SETLLMGV36NPD                                  CSW097
     C                     READ MGV36NPD                 09               CSW097
      *                                                                   CSW097
     C           *IN09     IFEQ '0'                                       CSW097
     C           WSEQNV    ANDEQ@SEQN                                     CSW097
     C           MGMSSQ    ANDEQ@MSSQ                                     CSW097
      *                                                                   CSW097
      ** Format tag :22D: - Compounding Type                              CSW097
      *                                                                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     MOVEL'STRT'    MFLD                            CSW097
     C                     MOVEL':22D:'   MTAG                            CSW097
      *                                                                   CSW097
      ** Add field :18A: to the multiple occurrence data structure        CSW097
      ** and to be formatted after field :30X: has been counted.          CSW097
      *                                                                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     MOVEL':18A:'   MTAG                            CSW097
      *                                                                   CSW097
     C***********          Z-ADDX         Y       30                                   CSW097 235727
     C                     Z-ADDX         Y       40                                   CSW097 235727
     C                     Z-ADD*ZERO     NREPT   50                      CSW097
      *                                                                   CSW097
     C           WSEQNV    DOWEQ@SEQN                                     CSW097
     C           MGMSSQ    ANDEQ@MSSQ                                     CSW097
     C           *IN09     ANDEQ'0'                                       CSW097
      *                                                                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
      *                                                                   CSW097
      ** Convert Compounding Date to CCYYMMDD format.                     CSW097
      *                                                                   CSW097
     C                     MOVE MGCDAT    ZMDAY                           CSW097
     C                     CALL 'ZM0065'               15                 CSW097
     C                     PARM           ZMDAY                           CSW097
     C                     PARM           ZSDATE                          CSW097
     C                     PARM           ZSDATC                          CSW097
      *                                                                   CSW097
     C                     MOVELZSDATC    MFLD                            CSW097
     C                     MOVEL':30X:'   MTAG                            CSW097
      *                                                                   CSW097
     C                     ADD  1         NREPT                           CSW097
     C                     READ MGV36NPD                 09               CSW097
      *                                                                   CSW097
     C                     ENDDO                                          CSW097
      *                                                                   CSW097
      ** Re-access field :18A: and format it using the count              CSW097
      ** of fields :30X:                                                  CSW097
      *                                                                   CSW097
     C           Y         OCUR MULT                                      CSW097
     C                     MOVELNREPT     MFLD                            CSW097
      *                                                                   CSW097
     C                     ENDIF                                          CSW097
      *                                                                                      BUG7977
      ** Format tag :38G: - First Stub Period (Ours)                                         BUG7977
      *                                                                                      BUG7977
     C           @MSSQ     IFEQ 'F'                                                          BUG7977
     C           MGOS1B    IFNE *BLANKS                                                      BUG7977
     C           MGOE1B    ANDNE*BLANKS                                                      BUG7977
     C                     ADD  1         X                                                  BUG7977
     C           X         OCUR MULT                                                         BUG7977
      *                                                                                      BUG7977
     C                     MOVEL':38G:'   MTAG                                               BUG7977
      *                                                                                      BUG7977
     C                     CLEAR@WRK7                                                        BUG7977
     C                     MOVE MGOS1B    @WRK1                                              BUG7977
     C                     MOVE '/'       @WRK2                                              BUG7977
     C                     MOVE MGOE1B    @WRK3                                              BUG7977
     C                     MOVEL@WRK7     MFLD                                               BUG7977
     C                     ENDIF                                                             BUG7977
      *                                                                                      BUG7977
      ** Format tag :38H: - Last Stub Period (Ours)                                          BUG7977
      *                                                                                      BUG7977
     C           MGOS2B    IFNE *BLANKS                                                      BUG7977
     C           MGOE2B    ANDNE*BLANKS                                                      BUG7977
     C                     ADD  1         X                                                  BUG7977
     C           X         OCUR MULT                                                         BUG7977
      *                                                                                      BUG7977
     C                     MOVEL':38H:'   MTAG                                               BUG7977
      *                                                                                      BUG7977
     C                     CLEAR@WRK7                                                        BUG7977
     C                     MOVE MGOS2B    @WRK1                                              BUG7977
     C                     MOVE '/'       @WRK2                                              BUG7977
     C                     MOVE MGOE2B    @WRK3                                              BUG7977
     C                     MOVEL@WRK7     MFLD                                               BUG7977
     C                     ENDIF                                                             BUG7977
     C                     ENDIF                                                             BUG7977
      *                                                                                      BUG7977
      ** Format tag :38G: - First Stub Period (Theirs)                                       BUG7977
      *                                                                                      BUG7977
     C           @MSSQ     IFEQ 'C'                                                          BUG7977
     C           MGTS1B    IFNE *BLANKS                                                      BUG7977
     C           MGTE1B    ANDNE*BLANKS                                                      BUG7977
     C                     ADD  1         X                                                  BUG7977
     C           X         OCUR MULT                                                         BUG7977
      *                                                                                      BUG7977
     C                     MOVEL':38G:'   MTAG                                               BUG7977
      *                                                                                      BUG7977
     C                     CLEAR@WRK7                                                        BUG7977
     C                     MOVE MGTS1B    @WRK1                                              BUG7977
     C                     MOVE '/'       @WRK2                                              BUG7977
     C                     MOVE MGTE1B    @WRK3                                              BUG7977
     C                     MOVEL@WRK7     MFLD                                               BUG7977
     C                     ENDIF                                                             BUG7977
      *                                                                                      BUG7977
      ** Format tag :38H: - Last Stub Period (Theirs)                                        BUG7977
      *                                                                                      BUG7977
     C           MGTS2B    IFNE *BLANKS                                                      BUG7977
     C           MGTE2B    ANDNE*BLANKS                                                      BUG7977
     C                     ADD  1         X                                                  BUG7977
     C           X         OCUR MULT                                                         BUG7977
      *                                                                                      BUG7977
     C                     MOVEL':38H:'   MTAG                                               BUG7977
      *                                                                                      BUG7977
     C                     CLEAR@WRK7                                                        BUG7977
     C                     MOVE MGTS2B    @WRK1                                              BUG7977
     C                     MOVE '/'       @WRK2                                              BUG7977
     C                     MOVE MGTE2B    @WRK3                                              BUG7977
     C                     MOVEL@WRK7     MFLD                                               BUG7977
     C                     ENDIF                                                             BUG7977
     C                     ENDIF                                                             BUG7977
      *                                                                                      BUG7977
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ENDIF                                          CSW097
     C                     ENDIF                                          CSW097
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   FRMTHI - Common subroutine for Sequence H MT360/MT361 fields*
      *            and Sequence I MT361 fields for output             *
      *   Called by - FMTH Sequence H MT360/MT361 fields              *
      *               FMTI61 Sequence I MT361 fields                  *
      *   Calls     -                                                 *
      *****************************************************************
      *
     C           FRMTHI    BEGSR
      *
      ** Format field :15a: as blank.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   MFLD
     C                     MOVEL@TAGTP    MTAG
      *
      ** Add field :18A: to the multiple occurrence data structure
      ** and to be formatted after field :32U: has been counted.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVEL':18A:'   MTAG
     C                     Z-ADDX         @C18A
      *
      ** Set lower limits on PF/MGZ36NPD using key of sequence no.
      ** and 'I'.
      *
     C                     Z-ADD0         COUNT
     C***********          Z-ADDMGSEQN    @SEQN                           CSW097
      *
     C           KEYSQN    SETLLMGZ36NPD
      *
      ** Read a record from MGZ36NPD while key is the same.
      *
     C                     READ MGZ36NPD                 08
      *
     C           WSEQNZ    DOWEQ@SEQN
     C           MGMSSQ    ANDEQ@MSSQ
     C           *IN08     ANDEQ'0'
      *
      ***Format*field*:31A:*using*the*calculation*start*date*and          CSW097
      ** Format field :30G: using the calculation start date and          CSW097
      ** calculation end date.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     MOVE MGCSDT    ZMDAY
      *
      ** Convert Midas date to SWIFT date format.
      *
     C***********          CALL 'ZM0060'               15                 CSW097
     C                     CALL 'ZM0065'               15                 CSW097
     C                     PARM           ZMDAY
     C                     PARM           ZSDATE
     C                     PARM           ZSDATC                          CSW097
      *
     C***********ZSDATE    CAT  '/':0     MFLD                            CSW097
     C           ZSDATC    CAT  '/':0     MFLD                            CSW097
      *
     C                     MOVE MGCEDT    ZMDAY
      *
      ** Convert Midas date to SWIFT date format.
      *
     C***********          CALL 'ZM0060'               15                 CSW097
     C                     CALL 'ZM0065'               15                 CSW097
     C                     PARM           ZMDAY
     C                     PARM           ZSDATE
     C                     PARM           ZSDATC                          CSW097
      *
     C***********MFLD      CAT  ZSDATE:0  MFLD                            CSW097
     C           MFLD      CAT  ZSDATC:0  MFLD                            CSW097
     C***********          MOVEL':31A:'   MTAG                            CSW097
     C                     MOVEL':30G:'   MTAG                            CSW097
      *
      ** Format field :32U: using the currency workfield and
      ** outstanding notional amount.
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      ***Use*settlement*currency*if*different*to*transaction*currenCSW097 171312
      *                                                                   CSW097
     C***********WASTCY    IFEQ *BLANKS                            CSW097 171312
     C                     MOVE @CCY      ZCCY
     C***********          ELSE                                    CSW097 171312
     C***********          MOVE WASTCY    ZCCY                     CSW097 171312
     C***********          ENDIF                                   CSW097 171312
      ***********                                                  CSW097 171312
     C***********ZCCY      IFNE @CCY                               CSW097 171312
     C***********          Z-ADDMGOSNA    PAPAMT 183               CSW097 171312
     C***********          CALL 'EU0200'                           CSW097 171312
     C***********          PARM *BLANKS   PARTCD  7        Return CCSW097 171312
     C***********          PARM           PAPAMT           FROM CcyCSW097 171312
     C***********          PARM           @CCY    3        FROM CurCSW097 171312
     C***********          PARM           ZCCY    3        TO CurreCSW097 171312
     C***********          PARM           PAOUTA 150       OutrightCSW097 171312
     C***********          PARM           PAINTA 183       Interim CSW097 171312
     C***********          PARM           PAEXRT 159       ExchangeCSW097 171312
     C***********          PARM           PAMDIN  1        Mult/DivCSW097 171312
     C***********PARTCD    IFEQ '*ERROR*'                          CSW097 171312
     C************LOCK     IN   LDA                                CSW097 171312
     C***********          MOVEL'EU0200  'DBFILE           ********CSW097 171312
     C***********          MOVE '042'     DBASE            * DBERR CSW097 171312
     C***********          MOVE *BLANKS   DBKEY            ********CSW097 171312
     C***********          MOVE *BLANKS   W@OPTN  7                CSW097 171312
     C***********          MOVEL@CCY      W@OPTN                   CSW097 171312
     C***********          MOVE ZCCY      W@OPTN                   CSW097 171312
     C***********          OUT  LDA                                CSW097 171312
     C***********          EXSR *PSSR                              CSW097 171312
     C***********          ELSE                                    CSW097 171312
     C***********          MOVE PAOUTA    ZAMNT                    CSW097 171312
     C***********          ENDIF                                   CSW097 171312
     C***********          ELSE                                    CSW097 171312
     C                     MOVE MGOSNA    ZAMNT
     C***********          ENDIF                                   CSW097 171312
      *
      ** Format currency and outstanding notional amount.
      *
     C                     CALL 'ZM0040'
     C                     PARM           ZAMNT
     C                     PARM           ZCCY
     C                     PARM           ZSAMNT
     C                     PARM           ZSCCY
     C                     PARM           ZERR
      *
      ** Error - indicate erroneous fields;
      *
     C           ZERR      IFEQ '1'
     C                     MOVE 'Y'       @ERR
     C                     MOVELERR3N     MFLD
     C                     MOVELMSGA,5    MERR
     C                     ELSE
     C           ZSCCY     CAT  ZSAMNT:0  MFLD
     C                     ENDIF
      *
     C                     MOVEL':32U:'   MTAG
     C                     ADD  1         COUNT
      *
     C                     READ MGZ36NPD                 08
      *
     C                     ENDDO
      *
      ** Re-access field :18A: and format it using the count
      ***of*fields*:32U:                                                  CSW097
      ** of fields :30G: and :32U:                                        CSW097
      *
     C           @C18A     OCUR MULT
     C                     MOVELCOUNT     MFLD
      *
      ***Format*field*:14K:*using*contents*of*'Principal*Repayments       CSW097
      ***Applicable'*if*message*type*is*'361'.                            CSW097
      *
     C************IN52     IFEQ '1'                                       CSW097
      *
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          MOVEL@PRA      MFLD                            CSW097
     C***********          MOVEL':14K:'   MTAG                            CSW097
      *                                                                   CSW097
     C***********          ENDIF                                          CSW097
      *                                                                   CSW097
      ** Format field :14A: using the Business Day Convention.            CSW097
      *                                                                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     MOVELMGBDAC    MFLD                            CSW097
     C                     MOVEL':14A:'   MTAG                            CSW097
      *                                                                   CSW097
      ** Format new tag :18A: (Number of Repetitions), and                CSW097
      ** :22B: (Financial Centre) via SR/SRFINC                           CSW097
      *                                                                   CSW097
     C                     EXSR SRFINC                                    CSW097
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   FRJKLM - Common subroutine for Sequence J, K, L and M       *
      *   Called by - FMTJ61 Sequence J MT361 fields                  *
      *               FMTK61 Sequence K MT361 fields                  *
      *               FMTL61 Sequence L MT361 fields                  *
      *               FMTM61 Sequence M MT361 fields                  *
      *   Calls     -                                                 *
      *****************************************************************
      *
     C           FRJKLM    BEGSR
      *
      ***Format*field*:15a:*as*blank.                                     CSW097
      ** Format field :15x: as blank (where X = 'J', 'K', 'L' or 'M').    CSW097
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVE *BLANKS   MFLD
     C                     MOVEL@TAGTP    MTAG
      *
      ***Format*field*:32A:*(sequence*J*and*L)*or                         CSW097
      ***field*:33A:*(sequence*K*and*M).                                  CSW097
      *                                                                   CSW097
      ***Use*the*maturity*or*value date,*THEIR/OUR                        CSW097
      ***final/initial*exchange*amount*and8THEIR/OUR*currency.            CSW097
      *                                                                   CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          MOVE @DAT      ZMDAY                           CSW097
      *                                                                   CSW097
      ***Convert*Midas*date*to*SWIFT*date*format.                         CSW097
      *                                                                   CSW097
     C***********          CALL 'ZM0060'               15                 CSW097
     C***********          PARM           ZMDAY                           CSW097
     C***********          PARM           ZSDATE                          CSW097
      *                                                                   CSW097
      ***Format*currency*code*and*final/initial*exchange*amount.          CSW097
      *                                                                   CSW097
     C***********          MOVE @CCY      ZCCY                            CSW097
     C***********          MOVE @AMT      ZAMNT                           CSW097
      *                                                                   CSW097
     C***********          CALL 'ZM0040'                                  CSW097
     C***********          PARM           ZAMNT                           CSW097
     C***********          PARM           ZCCY                            CSW097
     C***********          PARM           ZSAMNT                          CSW097
     C***********          PARM           ZSCCY                           CSW097
     C***********          PARM           ZERR                            CSW097
      *                                                                   CSW097
      ***Error*-*indicate*erroneous*fields;                               CSW097
      *                                                                   CSW097
     C***********ZERR      IFEQ '1'                                       CSW097
     C***********          MOVE 'Y'       @ERR                            CSW097
     C***********          MOVELERR3N     MFLD                            CSW097
     C***********          MOVELMSGA,5    MERR                            CSW097
      *                                                                   CSW097
     C***********          ELSE                                           CSW097
     C***********          MOVELFLD3N     MFLD                            CSW097
     C***********          ENDIF                                          CSW097
      *                                                                   CSW097
      ***Format*fields*:56a:*and*:57a:*via*SR/RECV                        CSW097
      ***if*sequence*J*or*L.*Otherwise,*format*fields*:53a:,*:56a:        CSW097
      ***and*:57a:*via*SR/PAY*if*sequence*K*or*M.                         CSW097
      *                                                                   CSW097
     C***********          SELEC                                          CSW097
     C***********@TAGTP    WHEQ ':15J:'                                   CSW097
     C***********          MOVEL':33A:'   MTAG                            CSW097
     C***********          EXSR RECV                                      CSW097
     C***********@TAGTP    WHEQ ':15K:'                                   CSW097
     C***********          MOVEL':32A:'   MTAG                            CSW097
     C***********          EXSR PAY                                       CSW097
     C***********@TAGTP    WHEQ ':15L:'                                   CSW097
     C***********          MOVEL':32C:'   MTAG                            CSW097
     C***********          EXSR RECV                                      CSW097
     C***********@TAGTP    WHEQ ':15M:'                                   CSW097
     C***********          MOVEL':33C:'   MTAG                            CSW097
     C***********          EXSR PAY                                       CSW097
     C***********          ENDSL                                          CSW097
      *                                                                   CSW097
      ** SWIFT 2015 Change: Re-label sequences J,K to K,L                                   MD034496
      *                                                                                     MD034496
     C           @MSSQ     IFEQ 'J'                                       CSW097
     C           CSW215    ANDEQ'N'                                                         MD034496
     C           @MSSQ     OREQ 'K'                                                         MD034496
     C           CSW215    ANDEQ'Y'                                                         MD034496
     C           @MSSQ     OREQ 'K'                                       CSW097
     C           CSW215    ANDEQ'N'                                                         MD034496
     C           @MSSQ     OREQ 'L'                                                         MD034496
     C           CSW215    ANDEQ'Y'                                                         MD034496
      *                                                                   CSW097
      ** Add field :18A: to the multiple occurrence data structure        CSW097
      ** and to be formatted after tag :22X: to :57A: has been counted.   CSW097
      *                                                                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     MOVEL':18A:'   MTAG                            CSW097
      *                                                                   CSW097
     C                     Z-ADDX         Y                               CSW097
     C                     Z-ADD0         NREPT                           CSW097
     C           KEYSQN    SETLLMGW36NPD                                  CSW097
     C                     READ MGW36NPD                 10               CSW097
     C           *IN10     DOWEQ'0'                                       CSW097
     C           WSEQNW    ANDEQ@SEQN                                     CSW097
     C           MGMSSQ    ANDEQ@MSSQ                                     CSW097
      *                                                                   CSW097
      ** Format tag :22X: - Type of Exchange                              CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     SELEC                                          CSW097
     C           MGTPEX    WHEQ 'V'                                       CSW097
     C                     MOVEL'INLX'    MFLD                            CSW097
     C           MGTPEX    WHEQ 'P'                                       CSW097
     C                     MOVEL'INTX'    MFLD                            CSW097
     C           MGTPEX    WHEQ 'M'                                       CSW097
     C                     MOVEL'FINX'    MFLD                            CSW097
     C                     ENDSL                                          CSW097
     C                     MOVEL':22X:'   MTAG                            CSW097
      *                                                                   CSW097
      ** Increment Number of Repetitions Workfield (NREPT)                CSW097
     C                     ADD  1         NREPT                           CSW097
      *                                                                   CSW097
      ** Format tag :30F: - Payment Date                                  CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
      *                                                                   CSW097
      ** Convert Payment Date (MGPDAT) to CCYYMMDD to format              CSW097
     C                     MOVE MGPDAT    ZMDAY                           CSW097
     C                     CALL 'ZM0065'               15                 CSW097
     C                     PARM           ZMDAY                           CSW097
     C                     PARM           ZSDATE                          CSW097
     C                     PARM           ZSDATC                          CSW097
      *                                                                   CSW097
     C                     MOVELZSDATC    MFLD                            CSW097
     C                     MOVEL':30F:'   MTAG                            CSW097
      *                                                                   CSW097
      ** Format tag :32M: - Currency and Payment Amount                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
      *                                                                   CSW097
     C                     MOVE MGXCCY    ZCCY                            CSW097
     C                     MOVE MGPAMT    ZAMNT                           CSW097
      *                                                                   CSW097
     C                     CALL 'ZM0040'                                  CSW097
     C                     PARM           ZAMNT                           CSW097
     C                     PARM           ZCCY                            CSW097
     C                     PARM           ZSAMNT                          CSW097
     C                     PARM           ZSCCY                           CSW097
     C                     PARM           ZERR                            CSW097
     C                     PARM           ZSWDPC                          222373
      *                                                                   CSW097
      ** Error - indicate erroneous fields;                               CSW097
     C           ZERR      IFEQ '1'                                       CSW097
     C                     MOVE 'Y'       @ERR                            CSW097
     C                     MOVELERR3N     MFLD                            CSW097
     C                     MOVELMSGA,5    MERR                            CSW097
     C                     ELSE                                           CSW097
     C                     MOVELFLD3N     MFLD                            CSW097
     C                     ENDIF                                          CSW097
     C                     MOVEL':32M:'   MTAG                            CSW097
      *                                                                   CSW097
     C                     MOVE *BLANK    @STYP                           CSW097
     C***********K@MGX     SETLLMGX36NPD                           CSW097 171312
     C***********          READ MGX36NPD                 12        CSW097 171312
     C************IN12     DOWEQ'0'                                CSW097 171312
     C***********WSEQNX    ANDEQ@SEQN                              CSW097 171312
     C***********MGSTYP    ANDEQ@STYP                              CSW097 171312
      *                                                                   CSW097
      ** SWIFT 2015 Change: Re-label sequences J,K to K,L                                   MD034496
      *                                                                                     MD034496
     C           @MSSQ     IFEQ 'J'                                       CSW097
     C           CSW215    ANDEQ'N'                                                         MD034496
     C           @MSSQ     OREQ 'K'                                                         MD034496
     C           CSW215    ANDEQ'Y'                                                         MD034496
     C                     EXSR RECV                                      CSW097
     C                     ENDIF                                          CSW097
     C           @MSSQ     IFEQ 'K'                                       CSW097
     C           CSW215    ANDEQ'N'                                                         MD034496
     C           @MSSQ     OREQ 'L'                                                         MD034496
     C           CSW215    ANDEQ'Y'                                                         MD034496
     C                     EXSR PAY                                       CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C***********          READ MGX36NPD                 12        CSW097 171312
     C***********          ENDDO                                   CSW097 171312
      *                                                                   CSW097
     C                     READ MGW36NPD                 10               CSW097
     C                     ENDDO                                          CSW097
      *                                                                   CSW097
      ** Re-access field :18A: and format it using the count              CSW097
      ** of fields :22X: to :57A:                                         CSW097
      *                                                                   CSW097
     C           Y         OCUR MULT                                      CSW097
     C                     MOVELNREPT     MFLD                            CSW097
      *                                                                   CSW097
      ** Format field :14A: using the business day convention.            CSW097
      *                                                                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     MOVELMGBDAC    MFLD                            CSW097
     C                     MOVEL':14A:'   MTAG                            CSW097
      *                                                                   CSW097
      ** Format new tag :18A: (Number of Repetitions), and                CSW097
      ** :22B: (Financial Centre) via SR/SRFINC                           CSW097
      *                                                                   CSW097
     C                     EXSR SRFINC                                    CSW097
      *                                                                   CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
      ** SWIFT 2015 Change: Re-label sequences L,M to M,N                                   MD034496
      *                                                                                     MD034496
     C           @MSSQ     IFEQ 'L'                                       CSW097
     C           CSW215    ANDEQ'N'                                                         MD034496
     C           @MSSQ     OREQ 'M'                                                         MD034496
     C           CSW215    ANDEQ'Y'                                                         MD034496
     C           @MSSQ     OREQ 'M'                                       CSW097
     C           CSW215    ANDEQ'N'                                                         MD034496
     C           @MSSQ     OREQ 'N'                                                         MD034496
     C           CSW215    ANDEQ'Y'                                                         MD034496
      *                                                                   CSW097
      ** Add field :18A: to the multiple occurrence data structure        CSW097
      ** and to be formatted after tag :22X: to :57A: has been counted.   CSW097
      *                                                                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     MOVEL':18A:'   MTAG                            CSW097
      *                                                                   CSW097
     C                     Z-ADDX         Y                               CSW097
     C                     Z-ADD0         NREPT                           CSW097
      *                                                                   CSW097
      ** Format tag :22E: - Type of Payment                               CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     MOVEL'FEES'    MFLD                            CSW097
     C                     MOVEL':22E:'   MTAG                            CSW097
      *                                                                   CSW097
      ** Format tag :30F: - Payment Date                                  CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
      *                                                                   CSW097
      ** Convert Value Date for Up-front fee CCYYMMDD to format           CSW097
     C                     MOVE MGUPVD    ZMDAY                           CSW097
     C                     CALL 'ZM0065'               15                 CSW097
     C                     PARM           ZMDAY                           CSW097
     C                     PARM           ZSDATE                          CSW097
     C                     PARM           ZSDATC                          CSW097
      *                                                                   CSW097
     C                     MOVELZSDATC    MFLD                            CSW097
     C                     MOVEL':30F:'   MTAG                            CSW097
      *                                                                   CSW097
      ** Format tag :32M: - Currency and Payment Amount                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
      *                                                                   CSW097
      ***Use*settlement*currency*if*different*to*transaction*curre CSW097 171312
      *                                                                   CSW097
     C***********WASTCY    IFNE *BLANKS                            CSW097 171312
     C***********          MOVE WASTCY    ZCCY                     CSW097 171312
     C***********          ELSE                                    CSW097 171312
     C                     MOVE @CCY      ZCCY                            CSW097
     C***********          ENDIF                                   CSW097 171312
     C***********ZCCY      IFNE @CCY                               CSW097 171312
     C***********          Z-ADD@AMT      PAPAMT 183               CSW097 171312
     C***********          CALL 'EU0200'                           CSW097 171312
     C***********          PARM *BLANKS   PARTCD  7        Return CCSW097 171312
     C***********          PARM           PAPAMT           FROM CcyCSW097 171312
     C***********          PARM           @CCY    3        FROM CurCSW097 171312
     C***********          PARM           ZCCY    3        TO CurreCSW097 171312
     C***********          PARM           PAOUTA 150       OutrightCSW097 171312
     C***********          PARM           PAINTA 183       Interim CSW097 171312
     C***********          PARM           PAEXRT 159       ExchangeCSW097 171312
     C***********          PARM           PAMDIN  1        Mult/DivCSW097 171312
     C***********PARTCD    IFEQ '*ERROR*'                          CSW097 171312
     C************LOCK     IN   LDA                                CSW097 171312
     C***********          MOVEL'EU0200  'DBFILE           ********CSW097 171312
     C***********          MOVE '044'     DBASE            * DBERR CSW097 171312
     C***********          MOVE *BLANKS   DBKEY            ********CSW097 171312
     C***********          MOVE *BLANKS   W@OPTN  7                CSW097 171312
     C***********          MOVEL@CCY      W@OPTN                   CSW097 171312
     C***********          MOVE ZCCY      W@OPTN                   CSW097 171312
     C***********          OUT  LDA                                CSW097 171312
     C***********          EXSR *PSSR                              CSW097 171312
     C***********          ELSE                                    CSW097 171312
     C***********          MOVE PAOUTA    ZAMNT                    CSW097 171312
     C***********          ENDIF                                   CSW097 171312
     C***********          ELSE                                    CSW097 171312
     C                     MOVE @AMT      ZAMNT                           CSW097
     C***********          ENDIF                                   CSW097 171312
      *                                                                   CSW097
     C                     CALL 'ZM0040'                                  CSW097
     C                     PARM           ZAMNT                           CSW097
     C                     PARM           ZCCY                            CSW097
     C                     PARM           ZSAMNT                          CSW097
     C                     PARM           ZSCCY                           CSW097
     C                     PARM           ZERR                            CSW097
     C                     PARM           ZSWDPC                          222373
      *                                                                   CSW097
      ** Error - indicate erroneous fields;                               CSW097
     C           ZERR      IFEQ '1'                                       CSW097
     C                     MOVE 'Y'       @ERR                            CSW097
     C                     MOVELERR3N     MFLD                            CSW097
     C                     MOVELMSGA,5    MERR                            CSW097
     C                     ELSE                                           CSW097
     C                     MOVELFLD3N     MFLD                            CSW097
     C                     ENDIF                                          CSW097
     C                     MOVEL':32M:'   MTAG                            CSW097
      *                                                                   CSW097
      ** Increment Number of Repetitions Workfield (NREPT)                CSW097
     C                     ADD  1         NREPT                           CSW097
      *                                                                   CSW097
      ** Re-access field :18A: and format it using the count              CSW097
      ** of fields :22E: to :32M:                                         CSW097
      *                                                                   CSW097
     C           Y         OCUR MULT                                      CSW097
     C                     MOVELNREPT     MFLD                            CSW097
      *                                                                   CSW097
      ** Format field :14A: using the business day convention.            CSW097
      *                                                                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     MOVELMGBDAC    MFLD                            CSW097
     C                     MOVEL':14A:'   MTAG                            CSW097
      *                                                                   CSW097
      ** Format new tag :18A: (Number of Repetitions), and                CSW097
      ** :22B: (Financial Centre) via SR/SRFINC                           CSW097
      *                                                                   CSW097
     C                     EXSR SRFINC                                    CSW097
      *                                                                   CSW097
      ** SWIFT 2015 Change: Re-label sequence L to M                                        MD034496
      *                                                                                     MD034496
     C           @MSSQ     IFEQ 'L'                                       CSW097
     C           CSW215    ANDEQ'N'                                                         MD034496
     C           @MSSQ     OREQ 'M'                                                         MD034496
     C           CSW215    ANDEQ'Y'                                                         MD034496
     C                     EXSR RECV                                      CSW097
     C                     ELSE                                           CSW097
     C                     EXSR PAY                                       CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ENDIF                                          CSW097
      *
     C                     ENDSR
      /EJECT
      *****************************************************************   CSW097
      ****FRNIOJ*-*Common*subroutine*for*Sequence*N/I*AND*O/J**********   CSW097
      ****Called*by*-*FMTNI*Sequence*N*MT361*/*Sequence*I*MT360*fields*   CSW097
      ****************FMTOJ*Sequence*O*MT361*/*Sequence*J*MT360*fields*   CSW097
      ****Calls*****-**************************************************   CSW097
      *****************************************************************   CSW097
      *                                                                   CSW097
     C***********FRNIOJ    BEGSR                                          CSW097
      *                                                                   CSW097
      ***Format8field*:15a:*as*blank.                                     CSW097
      *                                                                   CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          MOVE *BLANKS   MFLD                            CSW097
     C***********          MOVEL@TAGTP    MTAG                            CSW097
      *                                                                   CSW097
      ***Format*field*:34R:*using*effective*date,*THEIR/OUR*up-front***   CSW097
      ***Fee*Amount*and*THEIR/OUR*currency.                               CSW097
      *                                                                   CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          MOVE @DAT      ZMDAY                           CSW097
      *                                                                   CSW097
      ***Convert*Midas*date*to*SWIFT*date*format.                         CSW097
      *                                                                   CSW097
     C***********          CALL 'ZM0060'               15                 CSW097
     C***********          PARM           ZMDAY                           CSW097
     C***********          PARM           ZSDATE                          CSW097
      *                                                                   CSW097
      ***Format*currency*code*and*final/initial*exchange amount.          CSW097
      *                                                                   CSW097
     C***********          MOVE @CCY      ZCCY                            CSW097
     C***********          MOVE @AMT      ZAMNT                           CSW097
      *                                                                   CSW097
     C***********          CALL 'ZM0040'                                  CSW097
     C***********          PARM           ZAMNT                           CSW097
     C***********          PARM           ZCCY                            CSW097
     C***********          PARM           ZSAMNT                          CSW097
     C***********          PARM           ZSCCY                           CSW097
     C***********          PARM           ZERR                            CSW097
      *                                                                   CSW097
      ***Error*-*indicate*erroneous*fields;                               CSW097
      *                                                                   CSW097
     C***********ZERR      IFEQ '1'                                       CSW097
     C***********          MOVE 'Y'       @ERR                            CSW097
     C***********          MOVELERR3N     MFLD                            CSW097
     C***********          MOVELMSGA,5    MERR                            CSW097
      *                                                                   CSW097
     C***********          ELSE                                           CSW097
     C***********          MOVELFLD3N     MFLD                            CSW097
     C***********          ENDIF                                          CSW097
      *                                                                   CSW097
     C***********          MOVEL':34R:'   MTAG                            CSW097
      *                                                                   CSW097
      ***Format*fields*:56a:*and*:57a:*via*SR/RECV*if*sequence*N/I.****   CSW097
      ***Otherwise,*format*fields*:53a:,*:56a:*and*:57a:*if*sequence***   CSW097
      ***O/J.                                                             CSW097
      *                                                                   CSW097
     C***********@TAGTP    IFEQ ':15I:'                                   CSW097
     C***********@TAGTP    OREQ ':15N:'                                   CSW097
     C***********          EXSR RECV                                      CSW097
     C***********          ELSE                                           CSW097
     C***********          EXSR PAY                                       CSW097
     C***********          ENDIF                                          CSW097
      *                                                                   CSW097
     C***********          ENDSR                                          CSW097
      /EJECT                                                              CSW097
      *****************************************************************   CSW097
      ****FLD38C*-*Common*subroutine*to*format*field*:38C:*for*output.*   CSW097
      ****Called*by*-*FRMTBE*Common*subroutine*for*Sequence*B*and*E****   CSW097
      ****************FRMTCF*Common*subroutine*for*Sequence*C*and*F****   CSW097
      ****Calls*****-**************************************************   CSW097
      *****************************************************************   CSW097
      *                                                                   CSW097
     C***********FLD38C    BEGSR                                          CSW097
      *                                                                   CSW097
     C***********COUNT     IFEQ 0                                         CSW097
     C***********YYOLD     ORNE YYNEW                                     CSW097
      *                                                                   CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
      *                                                                   CSW097
     C***********          ADD  1         COUNT                           CSW097
     C***********          MOVELZSDATE    WFLD      P                     CSW097
      *                                                                   CSW097
     C***********          MOVELWFLD      MFLD                            CSW097
     C***********          MOVEL':38C:'   MTAG                            CSW097
      *                                                                   CSW097
     C***********          ELSE                                           CSW097
      *                                                                   CSW097
      ***Otherwise,*add*extension*to*contents*of*field*:38C:              CSW097
      ***using*only*the*MMDD*part.                                        CSW097
      *                                                                   CSW097
     C***********WFLD      CAT  '/':0     WFLD                            CSW097
     C***********WFLD      CAT  MMDD:0    WFLD                            CSW097
     C***********          MOVELWFLD      MFLD      P                     CSW097
      *                                                                   CSW097
     C***********WFLD2     IFNE *BLANKS                                   CSW097
     C***********          MOVE CRLF      CTRC                            CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          MOVELWFLD2     WFLD3  50                       CSW097
     C***********          MOVELWFLD3     WFLD      P                     CSW097
     C***********          MOVELWFLD      MFLD      P                     CSW097
     C***********          MOVEL*BLANKS   WFLD2                           CSW097
     C***********          MOVEL*BLANKS   MTAG                            CSW097
     C***********          ENDIF                                          CSW097
      *                                                                   CSW097
     C***********          ENDIF                                          CSW097
      *                                                                   CSW097
     C***********          ENDSR                                          CSW097
     C/EJECT
      *****************************************************************
      *   RECV  - Format fields :56a: and :57a: for receive sequence  *
      *   Called by - FMTC - Format sequence C (THEIR)                *
      *   Calls     - FSWAD  Format swift address.                    *
      *****************************************************************
      *
     C           RECV      BEGSR
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C                     MOVE 'Y'       ZDBEI                                               CSW201
     C                     ENDIF                                                              CSW201
      *
     C           K@MGX     CHAINMGX36NPD             10                   CSW097
      *                                                                   CSW097
     C                     MOVE *BLANKS   @WRK
      *
      ** Format fields 56 and 57.
      ***********                                                         CSW097
      ***Branch*code*of*sender*not*equal*to*Receive*settlement*branch.*   CSW097
      ***********                                                         CSW097
      ****Test*if*settlement*via*nostro*                                  CSW097
     C***********          MOVE MGRSTM    @STM                            CSW097
     C***********@STM      LOKUPTABNST                   23               CSW097
     C***********MGBRCA    IFNE MGROBR                                    CSW097
     C************IN23     ANDEQ'1'                                       CSW097
      ***********                                                         CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
      ***********                                                         CSW097
     C***********MGRIBN    IFNE *BLANKS                                   CSW097
     C***********          MOVE *BLANKS   ZDEST                           CSW097
     C***********          MOVELMGRIBN    ZDEST                           CSW097
     C***********          MOVELMGRIBA    ACLINE                          CSW097
     C***********          MOVE ' '       TAG                             CSW097
     C***********          MOVE '56'      FLDNO                           CSW097
     C***********          EXSR FSWAD                                     CSW097
      ***********                                                         CSW097
     C***********          ELSE                                           CSW097
      ***********                                                         CSW097
      ****Access*Branch*file*for*the*Internal*customer*number*of*the***   CSW097
      ****Receive*branch*(this*will*be*used*for*the*Intermediary*******   CSW097
      ****Bank,*because*settlement*is*via*an*account*owned*************   CSW097
      ****by*a*branch*different*to*the*receive*branch)*****************   CSW097
      ***********                                                         CSW097
     C***********          CALL 'AOBRCHR0'                                CSW097
     C***********          PARM '*MSG   ' @RTCD                           CSW097
     C***********          PARM '*KEY   ' @OPTN                           CSW097
     C***********          PARM MGROBR    @BRCD   3                       CSW097
     C***********SDBRCH    PARM SDBRCH    DSSDY                           CSW097
      ***********                                                         CSW097
      ***Branch*record*not*found*-*Error                                  CSW097
      ***********                                                         CSW097
     C***********@RTCD     IFNE *BLANKS                                   CSW097
     C************LOCK     IN   LDA                                       CSW097
     C***********          MOVE '026'     DBASE              * * * * * * *CSW097
     C***********          MOVELMGROBR    DBKEY              * DBERR 026 *CSW097
     C***********          MOVEL'SDBRCHPD'DBFILE             * * * * * * *CSW097
     C***********          OUT  LDA                                       CSW097
     C***********          EXSR *PSSR                                     CSW097
     C***********          END                                            CSW097
      ***********                                                         CSW097
      ***Format*Intermediary*using*customer*number*of*receive*branch      CSW097
      ***********                                                         CSW097
     C***********          MOVE *BLANKS   ZDEST                           CSW097
     C***********          MOVELA8BICN    ZDEST                           CSW097
     C***********          MOVE *BLANKS   ACLINE                          CSW097
     C***********          MOVE ' '       TAG                             CSW097
     C***********          MOVE '56'      FLDNO                           CSW097
     C***********          EXSR FSWAD                                     CSW097
     C***********          END                                            CSW097
      ***********                                                         CSW097
      ***Field*:57:**A/C*With*Institution*                                CSW097
      ***********                                                         CSW097
     C***********          ADD  1         X                               CSW097
     C***********          OCUR MULT                                      CSW097
     C***********          CALL 'AONOSTR0'                                CSW097
     C***********          PARM '*MSG   ' @RTCD   7                       CSW097
     C***********          PARM '*KEY   ' @OPTN   7                       CSW097
     C***********          PARM *BLANKS   @CUST   6        I:Customer No  CSW097
     C***********          PARM @CCY      @CYCD   3        I:Currency     CSW097
     C***********          PARM *BLANKS   @ACCD   4        I:A/c Code     CSW097
     C***********          PARM *BLANKS   @ACSN   2        I:A/c Seq      CSW097
     C***********          PARM MGRONS    @NONB   2        I:Nostro No    CSW097
     C***********          PARM *BLANKS   @BRCD   3        I:Branch Code  CSW097
     C***********          PARM *BLANKS   @CSSN  10        I:Cust ShortN  CSW097
     C***********          PARM *BLANK    @PNOI   1        I:Prime Nost InCSW097
     C***********SDNOST    PARM SDNOST    DSFDY                           CSW097
      ***********                                                         CSW097
      ****If*our*receive*nostro*is*not*found.*                            CSW097
      ***********                                                         CSW097
     C***********@RTCD     IFNE *BLANKS                                   CSW097
     C***********          MOVE 'Y'       @ERR                            CSW097
     C***********          MOVELMGRONS    HLD2    2                       CSW097
     C***********          MOVEL@CCY      HLD5                            CSW097
     C***********          MOVE HLD2      HLD5    5                       CSW097
     C***********          MOVELHLD5      MFLD                            CSW097
     C***********          MOVELMSGA,3    MERR                            CSW097
     C***********          MOVE ':57 :'   MTAG                            CSW097
     C***********          ELSE                                           CSW097
      ***********                                                         CSW097
      ****Format*our*Receive*Nostro*Customer*Address*                     CSW097
      ***********                                                         CSW097
     C***********          MOVE *BLANKS   ZDEST                           CSW097
     C***********          MOVELA7CUST    ZDEST                           CSW097
     C***********          MOVEL*BLANKS   ACLINE 35                       CSW097
     C***********          MOVE ' '       TAG                             CSW097
     C***********          MOVE '57'      FLDNO                           CSW097
     C***********          EXSR FSWAD                                     CSW097
     C***********          END                                            CSW097
      ***********                                                         CSW097
      ***********                                                         CSW097
      ***Else*the*branch*code*of*sender*=*receive*settlement*branch*      CSW097
      ***and*the*settlement*is*via*a*nostro.                              CSW097
      ***********                                                         CSW097
     C***********          ELSE                                           CSW097
      ***********                                                         CSW097
     C***********MGRIBN    IFNE *BLANKS                                   CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          MOVE *BLANKS   ZDEST                           CSW097
     C***********          MOVELMGRIBN    ZDEST                           CSW097
     C***********          MOVELMGRIBA    ACLINE                          CSW097
     C***********          MOVE ' '       TAG                             CSW097
     C***********          MOVE '56'      FLDNO                           CSW097
     C***********          EXSR FSWAD                                     CSW097
     C***********          END                                            CSW097
      ***********                                                         CSW097
     C***********@STM      LOKUPTABNST                   23               CSW097
      ***********                                                         CSW097
     C************IN23     IFEQ '1'                                       CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          CALL 'AONOSTR0'                                CSW097
     C***********          PARM '*MSG   ' @RTCD   7                       CSW097
     C***********          PARM '*KEY   ' @OPTN   7                       CSW097
     C***********          PARM *BLANKS   @CUST   6        I:Customer No  CSW097
     C***********          PARM @CCY      @CYCD   3        I:Currency     CSW097
     C***********          PARM *BLANKS   @ACCD   4        I:A/c Code     CSW097
     C***********          PARM *BLANKS   @ACSN   2        I:A/c Seq      CSW097
     C***********          PARM MGRONS    @NONB   2        I:Nostro No    CSW097
     C***********          PARM *BLANKS   @BRCD   3        I:Branch Code  CSW097
     C***********          PARM *BLANKS   @CSSN  10        I:Cust ShortN  CSW097
     C***********          PARM *BLANK    @PNOI   1        I:Prime Nost InCSW097
     C***********SDNOST    PARM SDNOST    DSFDY                           CSW097
      ***********                                                         CSW097
      ****If*our*receive*nostro*is*not*found.                             CSW097
      ***********                                                         CSW097
     C***********@RTCD     IFNE *BLANKS                                   CSW097
     C***********          MOVE 'Y'       @ERR                            CSW097
     C***********          MOVELMGRONS    HLD2                            CSW097
     C***********          MOVEL@CCY      HLD5                            CSW097
     C***********          MOVE HLD2      HLD5                            CSW097
     C***********          MOVELHLD5      MFLD                            CSW097
     C***********          MOVELMSGA,3    MERR                            CSW097
     C***********          MOVE ':57 :'   MTAG                            CSW097
     C***********          ELSE                                           CSW097
      ***********                                                         CSW097
     C***********          MOVE *BLANKS   ZDEST                           CSW097
     C***********          MOVELA7CUST    ZDEST                           CSW097
      ***********                                                         CSW097
     C***********          MOVEL*BLANKS   ACLINE                          CSW097
     C***********          MOVE ' '       TAG                             CSW097
     C***********          MOVE '57'      FLDNO                           CSW097
     C***********          EXSR FSWAD                                     CSW097
     C***********          END                                            CSW097
      ***********                                                         CSW097
     C***********          ELSE                                           CSW097
      ***********                                                         CSW097
      ***Settlement*method*internal.                                      CSW097
      ***********                                                         CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
      ***********                                                         CSW097
     C***********MGRSTM    IFNE 00                                        CSW097
     C***********          MOVE *BLANKS   ZDEST                           CSW097
     C***********          MOVELSECN      ZDEST                           CSW097
     C***********          MOVEL*BLANKS   ACLINE                          CSW097
     C***********          MOVE ' '       TAG                             CSW097
     C***********          MOVE '57'      FLDNO                           CSW097
     C***********          EXSR FSWAD                                     CSW097
      ***********                                                         CSW097
      ***No*settlement*type*entered.*                                     CSW097
      ***********                                                         CSW097
     C***********          ELSE                                           CSW097
     C***********          MOVE ':57D:'   MTAG                            CSW097
     C***********          MOVEL'UNKNOWN' MFLD                            CSW097
     C***********          END                                            CSW097
     C***********          END                                            CSW097
      ***********                                                         CSW097
     C***********          END                                            CSW097
      ***********                                                         CSW097
      *                                                                   CSW097
      **  Field :56a:  Intermediary                                       CSW097
      *                                                                   CSW097
      **  Intermediary not blank; retrieve customer address               CSW097
     C           MGRIBN    IFNE *BLANKS                                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     MOVE *BLANKS   ZDEST                           CSW097
     C                     MOVELMGRIBN    ZDEST                           CSW097
     C                     MOVE *BLANKS   ACLINE 35                       CSW097
     C                     MOVELMGRIBA    ACLINE                          CSW097
     C                     MOVE ' '       TAG                             CSW097
     C                     MOVE '56'      FLDNO                           CSW097
     C                     EXSR FSWAD                                     CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
      **  Field :57a: Receiving Agent                                     CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
      **  Test if settlement via nostro                                   CSW097
     C                     MOVE MGRSTM    @STM    2                       CSW097
     C                     MOVELMGRONS    W#NOS1                                              235538
      *                                                                                       235538
      ** For Principal exchange (SEQ J), our nostro should be used                            235538
      *  during initial exchange.                                                             235538
      *                                                                                       235538
     C           @MSSQ     IFEQ 'J'                                        IF 1               235538
      *                                                                                       235538
     C                     MOVE *BLANKS   W#NOS1 12                                           235538
     C                     MOVE *BLANKS   @STM                                                235538
     C                     MOVELMGTNUM    K0DLNO                                              235538
      *                                                                                       235538
     C           MGTPEX    IFEQ 'V'                                        IF 2               235538
     C                     MOVEL'VAL'     K0EDCD                                              235538
     C                     ELSE                                                               235538
     C           MGTPEX    IFEQ 'M'                                        IF 3               235538
     C                     MOVEL'MAT'     K0EDCD                                              235538
     C                     ELSE                                                               235538
      *                                                                                       235538
     C           MGTPEX    IFEQ 'P'                                        IF 4               235538
     C           K0DLNO    CHAINDLCIRSL0             74                                       235538
     C           *IN74     IFEQ '0'                                        IF 5               235538
     C           MGXCCY    IFEQ UCUCY                                      IF 6               235538
     C                     MOVEL'VAL'     K0EDCD                                              235538
     C                     ELSE                                                               235538
     C                     MOVEL'MAT'     K0EDCD                                              235538
     C                     ENDIF                                           END 6              235538
     C                     ELSE                                            NO REC IN DEALSDG  235538
     C           *LOCK     IN   LDA                                                           235538
     C                     MOVE '998'     DBASE                                               235538
     C                     MOVELK0DLNO    DBKEY                                               235538
     C                     MOVEL'DEALSDG' DBFILE                                              235538
     C                     OUT  LDA                                                           235538
     C                     EXSR *PSSR                                                         235538
     C                     ENDIF                                           END 5              235538
     C                     ENDIF                                           END 4              235538
      *                                                                                       235538
     C                     ENDIF                                           END 3              235538
     C                     ENDIF                                           END 2              235538
      *                                                                                       235538
     C           K0GXST    CHAINDLGXSTL0             73                                       235538
      *                                                                                       235538
      ** For seq J, receipt instructions are always used                                      235538
      *                                                                                       235538
     C           *IN73     IFEQ '0'                                                           235538
     C                     MOVELRXRSTM    @STM                                                235538
     C                     MOVELRXRONS    W#NOS1                                              235538
     C                     ELSE                                                               235538
     C           *LOCK     IN   LDA                                                           235538
     C                     MOVE K0EDCD    DBKEY                                               235538
     C                     MOVE '999'     DBASE                                               235538
     C                     MOVELK0DLNO    DBKEY                                               235538
     C                     MOVEL'DLGXSTL0'DBFILE                                              235538
     C                     OUT  LDA                                                           235538
     C                     EXSR *PSSR                                                         235538
     C                     ENDIF                                                              235538
      *                                                                                       235538
     C                     ENDIF                                           END 1              235538
      *                                                                                       235538
     C           @STM      LOKUPTABNST                   23               CSW097
     C********** MGRONS    IFNE *BLANKS                                                CSW097 235538
     C           W#NOS1    IFNE *BLANKS                                                       235538
     C           *IN23     ANDEQ'1'                                       CSW097
      *                                                                   CSW097
      ** For principal exchange, use the exchange ccy from MGW36NPD                           235538
      *                                                                                       235538
     C           @MSSQ     IFEQ 'J'                                                           235538
     C                     MOVE MGXCCY    @NSKYB                                              235538
     C                     ELSE                                                               235538
      *                                                                                       235538
     C           MGRSCY    IFNE *BLANK                                    CSW097
     C                     MOVE MGRSCY    @NSKYB                          CSW097
     C                     ELSE                                           CSW097
     C                     MOVE @CCY      @NSKYB                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                                       235538
     C                     ENDIF                                                              235538
      *                                                                   CSW097
     C**********           MOVELMGRONS    @NSKYE                                       CSW097 235538
     C                     MOVELW#NOS1    @NSKYE                                              235538
      *                                                                                       235538
     C                     CALL 'AONOSTR0'                                CSW097
     C                     PARM '*MSG   ' @RTCD   7                       CSW097
     C                     PARM '*KEY   ' @OPTN   7                       CSW097
     C                     PARM *BLANKS   @NSKYA  6                       CSW097
     C                     PARM           @NSKYB  3                       CSW097
     C**********           PARM *BLANKS   @NSKYC  4                                    CSW097 CGL029
     C                     PARM *BLANKS   @NSKYC 10                                           CGL029
     C                     PARM *BLANKS   @NSKYD  2                       CSW097
     C                     PARM           @NSKYE  2                       CSW097
     C                     PARM *BLANKS   @KEYF   3                       CSW097
     C                     PARM *BLANKS   @KEYG  10                       CSW097
     C                     PARM *BLANKS   @KEYH   1                       CSW097
     C           SDNOST    PARM SDNOST    DSFDY                           CSW097
      *                                                                   CSW097
     C           @RTCD     IFNE *BLANKS                                   CSW097
     C                     MOVE 'Y'       @ERR                            CSW097
     C**********           MOVELMGRONS    MFLD                                         CSW097 235538
     C                     MOVEL@NSKYE    MFLD                                                235538
     C                     MOVELMSGA,3    MERR                            CSW097
     C                     MOVE ':57 :'   MTAG                            CSW097
     C                     ELSE                                           CSW097
      *                                                                   CSW097
     C                     MOVE *BLANKS   ZDEST                           CSW097
     C                     MOVELA7CUST    ZDEST                           CSW097
     C                     MOVEL*BLANKS   ACLINE                          CSW097
     C                     MOVE ' '       TAG                             CSW097
     C                     MOVE '57'      FLDNO                           CSW097
     C                     EXSR FSWAD                                     CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
      **  Our receive nostro is blank or settlement internal              CSW097
     C                     ELSE                                           CSW097
      **  Test if settlement internal                                     CSW097
      *                                                                                       235538
      ** @STM already contains correct value of settlement method                             235538
      *                                                                                       235538
     C**********           MOVE MGRSTM    @STM                                         CSW097 235538
     C           @STM      LOKUPTABINT                   23               CSW097
      *                                                                   CSW097
     C           *IN23     IFEQ '1'                                       CSW097
     C                     MOVE *BLANKS   ZDEST                           CSW097
     C                     MOVELSECN      ZDEST                           CSW097
     C                     MOVEL*BLANKS   ACLINE                          CSW097
     C                     MOVE ' '       TAG                             CSW097
     C                     MOVE '57'      FLDNO                           CSW097
     C                     EXSR FSWAD                                     CSW097
      *                                                                   CSW097
     C                     ELSE                                           CSW097
     C                     MOVE ':57D:'   MTAG                            CSW097
     C                     MOVEL'UNKNOWN' MFLD                            CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ENDIF                                          CSW097
      *                                                                                       CSW201
     C                     MOVE *BLANKS   ZDBEI                                               CSW201
      *                                                                   CSW097
     C                     ENDSR
     C/EJECT
      *****************************************************************
      ****PAY**-*Format*fields*:53:,*:56a:*and*:57a:*for*a*payment*****   CSW097
      *   PAY  - Format fields :56a: and :57a: for a payment          *   CSW097
      *   Called by - FMTE   Format sequence E (OUR)                  *
      *   Calls       FSWAD  Format Swift Address.                    *
      *****************************************************************
      *
     C           PAY       BEGSR
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C                     MOVE 'Y'       ZDBEI                                               CSW201
     C                     ENDIF                                                              CSW201
      *                                                                   CSW097
     C           K@MGX     CHAINMGX36NPD             10                   CSW097
      *                                                                   CSW097
     C           *IN10     IFEQ *OFF                                      CSW097
     C                     MOVE *BLANKS   AWBA6   6                       CSW097
     C                     MOVELMGAWBA    AWBA6   6                       CSW097
     C                     ENDIF                                          CSW097
      *
     C                     MOVE *BLANKS   @WRK
      ***********
      ***Field*53*-*Senders*correspondant.                                CSW097
      ****Test*if*settlement*via*nostro                                   CSW097
      ***********                                                         CSW097
     C***********          MOVE MGPSTM    @STM    2                       CSW097
     C***********@STM      LOKUPTABNST                   23               CSW097
      ***********                                                         CSW097
      ***If*our*pay*nostro*is*not*blank*and*the*settlement*is*via*a*nostroCSW097
      ***********                                                         CSW097
     C***********MGPONS    IFNE *BLANKS                                   CSW097
     C************IN23     ANDEQ'1'                                       CSW097
      ***********                                                         CSW097
      ****either*A/C*with*Bank*or*Receipient*entered                      CSW097
      ****or*DIRECT*entered                                               CSW097
      ***********                                                         CSW097
     C***********MGAWBN    IFNE *BLANKS                                   CSW097
     C***********AWBA6     OREQ 'DIRECT'                                  CSW097
      ***********                                                         CSW097
     C***********          MOVELMGPONS    @NONB                           CSW097
     C***********          CALL 'AONOSTR0'                                CSW097
     C***********          PARM '*MSG   ' @RTCD   7                       CSW097
     C***********          PARM '*KEY   ' @OPTN   7                       CSW097
     C***********          PARM *BLANKS   @CUST   6                       CSW097
     C***********          PARM @CCY      @CYCD   3                       CSW097
     C***********          PARM *BLANKS   @ACCD   4                       CSW097
     C***********          PARM *BLANKS   @ACSN   2                       CSW097
     C***********          PARM           @NONB   2                       CSW097
     C***********          PARM *BLANKS   @BRCD   3                       CSW097
     C***********          PARM *BLANKS   @CSSN  10                       CSW097
     C***********          PARM *BLANKS   @PNOI   1                       CSW097
     C***********SDNOST    PARM SDNOST    DSFDY                           CSW097
      ***********                                                         CSW097
      ****Nostro*customer*not*found                                       CSW097
      ***********                                                         CSW097
     C***********@RTCD     IFNE *BLANKS                                   CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          MOVE 'Y'       @ERR                            CSW097
     C***********          MOVE ':53 :'   MTAG                            CSW097
     C***********          MOVELMGPONS    HLD2                            CSW097
     C***********          MOVEL@CCY      HLD5                            CSW097
     C***********          MOVE HLD2      HLD5                            CSW097
     C***********          MOVELHLD5      MFLD                            CSW097
     C***********          MOVELMSGA,3    MERR                            CSW097
     C***********          ELSE                                           CSW097
      ***********                                                         CSW097
      ***Branch*Internal*Customer*cf.*Customer*number*of*Our*Pay*Nostro   CSW097
      ***********                                                         CSW097
     C***********          MOVELSECN      @SECN   6                       CSW097
     C***********@SECN     IFNE A7CUST                                    CSW097
     C***********MGAWBN    ANDNEA7CUST                                    CSW097
     C***********          MOVE *BLANKS   ZDEST                           CSW097
     C***********          MOVELA7CUST    ZDEST                           CSW097
     C***********          CALL 'ZM0050'                                  CSW097
     C***********          PARM           ZDEST  12                       CSW097
     C***********          PARM           ZSADD1 35                       CSW097
     C***********          PARM           ZSADD2 35                       CSW097
     C***********          PARM           ZSADD3 35                       CSW097
     C***********          PARM           ZSADD4 35                       CSW097
     C***********          PARM           ZSTAG   1                       CSW097
     C***********          PARM           ZSTYPE  1                       CSW097
     C***********          PARM           ZERR    1                       CSW097
      ***********                                                         CSW097
      ****Error*when*formating*address                                    CSW097
      ***********                                                         CSW097
     C***********ZERR      IFEQ '1'                                       CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          MOVE 'Y'       @ERR                            CSW097
     C***********          MOVE ':53 :'   MTAG                            CSW097
     C***********          MOVELZDEST     MFLD                            CSW097
     C***********          MOVELMSGA,6    MERR                            CSW097
     C***********          ELSE                                           CSW097
      ***********                                                         CSW097
      ****A*Type*address                                                  CSW097
      ***********                                                         CSW097
     C***********ZSTAG     IFEQ 'A'                                       CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          MOVE 'A'       TAG                             CSW097
     C***********          MOVE '53'      FLDNO                           CSW097
     C***********          MOVE @MTAG     MTAG                            CSW097
     C***********          MOVELZSADD1    MFLD                            CSW097
      ***********                                                         CSW097
     C***********          ELSE                                           CSW097
      ***********                                                         CSW097
      ****Access*SDCUSTPD*using*our*pay*nostro*customer*number            CSW097
      ***********                                                         CSW097
     C***********          MOVE *BLANKS   @KEY1                           CSW097
     C***********          MOVELA7CUST    @KEY1                           CSW097
     C***********          CALL 'AOCUSTR0'                                CSW097
     C***********          PARM '*MSG   ' @RTCD                           CSW097
     C***********          PARM '*KEY   ' @OPTN                           CSW097
     C***********          PARM           @KEY1  10                       CSW097
     C***********          PARM *BLANKS   @KYST   7                       CSW097
     C***********SDCUST    PARM SDCUST    DSSDY                           CSW097
      ***********                                                         CSW097
      ***Customer*record*not*found*-*Error                                CSW097
      ***********                                                         CSW097
     C***********@RTCD     IFNE *BLANKS                                   CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          MOVE 'Y'       @ERR                            CSW097
     C***********          MOVE ':53 :'   MTAG                            CSW097
     C***********          MOVELA7CUST    MFLD                            CSW097
     C***********          MOVE MSGA,2    MERR                            CSW097
      ***********                                                         CSW097
     C***********          ELSE                                           CSW097
      ***********                                                         CSW097
      ****B*Type*address                                                  CSW097
      ***********                                                         CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          MOVE BBPCNB    @PCNB   60                      CSW097
     C***********SPAIN     IFEQ 'P'                                       CSW097
     C***********@PCNB     ANDEQSECN                                      CSW097
     C***********BBPAIN    OREQ 'P'                                       CSW097
     C***********A7CUST    ANDEQSPCNB                                     CSW097
     C***********BBPCNB    OREQ SPCNB                                     CSW097
     C***********BBPCNB    ANDNE*BLANKS                                   CSW097
      ***********                                                         CSW097
     C***********          MOVE ':53B:'   MTAG                            CSW097
     C***********          MOVE *BLANKS   @WRK                            CSW097
     C***********          MOVEABBCRNM    @WRK,1                          CSW097
     C***********          Z-ADD22        J       20                      CSW097
     C***********          MOVEABBCRTN    @WRK,J                          CSW097
     C***********          MOVEA@WRK      MFLD                            CSW097
      ***********                                                         CSW097
      ****D*Type*address                                                  CSW097
     C***********          ELSE                                           CSW097
     C***********          MOVE ':53D:'   MTAG                            CSW097
     C***********          MOVELZSADD1    MFLD                            CSW097
      ****Address*2                                                       CSW097
     C***********ZSADD2    IFNE *BLANKS                                   CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          MOVELZSADD2    MFLD                            CSW097
      ****Address*3                                                       CSW097
     C***********ZSADD3    IFNE *BLANKS                                   CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          MOVELZSADD3    MFLD                            CSW097
      ****Address*4                                                       CSW097
     C***********ZSADD4    IFNE *BLANKS                                   CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          MOVELZSADD4    MFLD                            CSW097
     C***********          END                             D address 4    CSW097
     C***********          END                             D address 3    CSW097
     C***********          END                             D address 2    CSW097
     C***********          END                             B/D address 1  CSW097
      ***********                                                         CSW097
     C***********          END                             Cust. error?   CSW097
      ***********                                                         CSW097
     C***********          END                             A/B/D address? CSW097
     C***********          END                             Fmt ad. error  CSW097
     C***********          END                             Brch Int Cust. CSW097
     C***********          END                             Nostro not fnd.CSW097
     C***********          END                                            CSW097
     C***********          END                             Pay nostro?    CSW097
      ************                                                        CSW097
     C***********          MOVE 'N'       FLD57O  1                       CSW097
      ***********                                                         CSW097
      ****Field*:57:**A/C*with*institution*non-blank                      CSW097
      ***********                                                         CSW097
     C***********MGAWBN    IFNE *BLANKS                                   CSW097
      ***********                                                         CSW097
      ****Field**56:**Pay*Intermediary*bank*                              CSW097
      ****This*field*is*only*produced*when*the*account*with*institution   CSW097
      ****is non-blank.*                                                  CSW097
      ***********                                                         CSW097
      ****If*the*pay*intermediary*is*entered.*                            CSW097
      ***********                                                         CSW097
     C***********MGPIBN    IFNE *BLANKS                                   CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          MOVE *BLANKS   ZDEST                           CSW097
     C***********          MOVELMGPIBN    ZDEST                           CSW097
     C***********          MOVELMGPIBA    ACLINE                          CSW097
     C***********          MOVE ' '       TAG                             CSW097
     C***********          MOVE '56'      FLDNO                           CSW097
     C***********          EXSR FSWAD                                     CSW097
     C***********          END                                            CSW097
      ***********                                                         CSW097
      ****Format*Account*with*institution.*(Field*57.)*                   CSW097
      ***********                                                         CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          MOVE *BLANKS   ZDEST                           CSW097
     C***********          MOVELMGAWBN    ZDEST                           CSW097
     C***********          MOVELMGAWBA    ACLINE                          CSW097
     C***********          MOVE ' '       TAG                             CSW097
     C***********          MOVE '57'      FLDNO                           CSW097
     C***********          EXSR FSWAD                                     CSW097
     C***********          MOVE 'Y'       FLD57O  1                       CSW097
      ***********                                                         CSW097
      ****A/C*with*Inst.*blank*                                           CSW097
      ***********                                                         CSW097
     C***********          ELSE                                           CSW097
      ***********                                                         CSW097
     C***********AWBA6     IFEQ 'DIRECT'                                  CSW097
      ***********                                                         CSW097
      ****A/C*with*Inst.*set*up*as*DIRECT,*use*beneficiary*details*       CSW097
      ****Format*Account*with*institution.*(Field*57.)*                   CSW097
      ***********                                                         CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          MOVE *BLANKS   ZDEST                           CSW097
     C***********          MOVELMGBENN    ZDEST                           CSW097
     C***********          MOVELMGBENA    ACLINE                          CSW097
     C***********          MOVE ' '       TAG                             CSW097
     C***********          MOVE '57'      FLDNO                           CSW097
     C***********          EXSR FSWAD                                     CSW097
     C***********          MOVE 'Y'       FLD57O  1                       CSW097
      ***********                                                         CSW097
      ****A/C*with*Inst.*blank*and*NOT*"DIRECT"*entered,                  CSW097
      ***********                                                         CSW097
     C***********          ELSE                                           CSW097
      ***********                                                         CSW097
      ***********                                                         CSW097
      ****Field*57*=*pay*nostro*customer*if*settlement*via*'02'*or*'12'   CSW097
     C***********MGPSTM    IFEQ 02                                        CSW097
     C***********MGPSTM    OREQ 12                                        CSW097
     C***********          MOVELMGPONS    @NONB                           CSW097
     C***********          CALL 'AONOSTR0'                                CSW097
     C***********          PARM '*MSG   ' @RTCD   7                       CSW097
     C***********          PARM '*KEY   ' @OPTN   7                       CSW097
     C***********          PARM *BLANKS   @CUST   6                       CSW097
     C***********          PARM @CCY      @CYCD   3                       CSW097
     C***********          PARM *BLANKS   @ACCD   4                       CSW097
     C***********          PARM *BLANKS   @ACSN   2                       CSW097
     C***********          PARM           @NONB   2                       CSW097
     C***********          PARM *BLANKS   @BRCD   3                       CSW097
     C***********          PARM *BLANKS   @CSSN  10                       CSW097
     C***********          PARM *BLANKS   @PNOI   1                       CSW097
     C***********SDNOST    PARM SDNOST    DSFDY                           CSW097
      ***********                                                         CSW097
      ****Nostro*customer*not*found*                                      CSW097
      ***********                                                         CSW097
     C***********@RTCD     IFNE *BLANKS                                   CSW097
     C***********          MOVE 'Y'       @ERR                            CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          MOVELMGPONS    HLD2    2                       CSW097
     C***********          MOVEL@CCY      HLD5                            CSW097
     C***********          MOVE HLD2      HLD5    5                       CSW097
     C***********          MOVELHLD5      MFLD                            CSW097
     C***********          MOVELMSGA,3    MERR                            CSW097
     C***********          MOVE ':57 :'   MTAG                            CSW097
     C***********          ELSE                                           CSW097
      ***********                                                         CSW097
      ****Format*our*Pay*Nostro*Customer*Address*                         CSW097
      ***********                                                         CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          MOVE *BLANKS   ZDEST                           CSW097
     C***********          MOVELA7CUST    ZDEST                           CSW097
     C***********          MOVEL*BLANKS   ACLINE                          CSW097
     C***********          MOVE ' '       TAG                             CSW097
     C***********          MOVE '57'      FLDNO                           CSW097
     C***********          EXSR FSWAD                                     CSW097
     C***********          MOVE 'Y'       FLD57O                          CSW097
     C***********          END                                            CSW097
      ***********                                                         CSW097
     C***********          ELSE                                           CSW097
      ***********                                                         CSW097
     C***********MGPSTM    IFNE 00                                        CSW097
     C***********          MOVE MGPSTM    @STM                            CSW097
     C***********@STM      LOKUPTABINT                   23               CSW097
      ***********                                                         CSW097
     C************IN23     IFEQ '1'                                       CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          MOVE *BLANKS   ZDEST                           CSW097
     C***********          MOVELSECN      ZDEST                           CSW097
     C***********          MOVEL*BLANKS   ACLINE                          CSW097
     C***********          MOVE ' '       TAG                             CSW097
     C***********          MOVE '57'      FLDNO                           CSW097
     C***********          EXSR FSWAD                                     CSW097
     C***********          MOVE 'Y'       FLD57O                          CSW097
      ***********                                                         CSW097
     C***********          ELSE                                           CSW097
      *                                                                   CSW097
      ****Field*53*is*equal*to*Our*Pay*Nostro                             CSW097
      *                                                                   CSW097
     C***********          MOVELMGPONS    @NSKYE                          CSW097
     C***********          CALL 'AONOSTR0'                                CSW097
     C***********          PARM '*MSG   ' @RTCD   7                       CSW097
     C***********          PARM '*KEY   ' @OPTN   7                       CSW097
     C***********          PARM *BLANKS   @NSKYA  6                       CSW097
     C***********          PARM @CCY      @NSKYB  3                       CSW097
     C***********          PARM *BLANKS   @NSKYC  4                       CSW097
     C***********          PARM *BLANKS   @NSKYD  2                       CSW097
     C***********          PARM           @NSKYE  2                       CSW097
     C***********          PARM *BLANKS   @KEYF   3                       CSW097
     C***********          PARM *BLANKS   @KEYG  10                       CSW097
     C***********          PARM *BLANKS   @KEYH   1                       CSW097
     C***********SDNOST    PARM SDNOST    DSFDY                           CSW097
      ***********                                                         CSW097
      ****Nostro*customer*not*found                                       CSW097
      ***********                                                         CSW097
     C***********@RTCD     IFNE *BLANKS                                   CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          MOVE 'Y'       @ERR                            CSW097
     C***********          MOVE ':53 :'   MTAG                            CSW097
     C***********          MOVELMGPONS    MFLD                            CSW097
     C***********          MOVELMSGA,3    MERR                            CSW097
     C***********          ELSE                                           CSW097
      ***********                                                         CSW097
      ****Format*our*Pay*Nostro*Customer*Address                          CSW097
      ***********                                                         CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          MOVE *BLANKS   ZDEST                           CSW097
     C***********          MOVELA7CUST    ZDEST                           CSW097
     C***********          MOVEL*BLANKS   ACLINE                          CSW097
     C***********          MOVE ' '       TAG                             CSW097
     C***********          MOVE '53'      FLDNO                           CSW097
     C***********          EXSR FSWAD                                     CSW097
     C***********          END                                            CSW097
     C***********          END                                            CSW097
     C***********          END                                            CSW097
     C***********          END                                            CSW097
     C***********          END                                            CSW097
     C***********          END                                            CSW097
      ***********                                                         CSW097
      ****Settlement*01,07*or*08*with*MGAWBN*blank*or*settlement*00****   CSW097
      ***********                                                         CSW097
     C***********FLD57O    IFEQ 'N'                                       CSW097
     C***********          ADD  1         X                               CSW097
     C***********X         OCUR MULT                                      CSW097
     C***********          MOVE ':57D:'   MTAG                            CSW097
     C***********          MOVEL'UNKNOWN' MFLD                            CSW097
     C***********          END                                            CSW097
      *                                                                   CSW097
      **  Field :53a: Delivery Agent                                      CSW097
      *                                                                   CSW097
      **  Test if settlement via nostro                                   CSW097
     C                     MOVE MGPSTM    @STM                            CSW097
     C                     MOVELMGPONS    W#NOS1                                              235538
      *                                                                                       235538
      ** For Principal exchange (SEQ K), use their nostro during                              235538
      ** initial exchange.                                                                    235538
      *                                                                                       235538
     C           @MSSQ     IFEQ 'K'                                        IF 1               235538
      *                                                                                       235538
     C                     MOVE *BLANKS   W#NOS1 12                                           235538
     C                     MOVE *BLANKS   @STM                                                235538
     C                     MOVEL*BLANKS   SXAWBN  8                                           235538
     C                     MOVEL*BLANKS   SXAWBA 35                                           235538
     C                     MOVELMGTNUM    K0DLNO                                              235538
      *                                                                                       235538
     C           MGTPEX    IFEQ 'V'                                        IF 2               235538
     C                     MOVEL'VAL'     K0EDCD                                              235538
     C                     ELSE                                                               235538
     C           MGTPEX    IFEQ 'M'                                        IF 3               235538
     C                     MOVEL'MAT'     K0EDCD                                              235538
     C                     ELSE                                                               235538
      *                                                                                       235538
     C           MGTPEX    IFEQ 'P'                                        IF 4               235538
     C           K0DLNO    CHAINDLCIRSL0             74                                       235538
     C           *IN74     IFEQ '0'                                        IF 5               235538
     C           MGXCCY    IFEQ UCUCY                                      IF 6               235538
     C                     MOVEL'MAT'     K0EDCD                                              235538
     C                     ELSE                                                               235538
     C                     MOVEL'VAL'     K0EDCD                                              235538
     C                     ENDIF                                           END 6              235538
     C                     ELSE                                            NO REC IN DEALSDG  235538
     C           *LOCK     IN   LDA                                                           235538
     C                     MOVE '997'     DBASE                                               235538
     C                     MOVELK0DLNO    DBKEY                                               235538
     C                     MOVEL'DEALSDG' DBFILE                                              235538
     C                     OUT  LDA                                                           235538
     C                     EXSR *PSSR                                                         235538
     C                     ENDIF                                           END 5              235538
     C                     ENDIF                                           END 4              235538
      *                                                                                       235538
     C                     ENDIF                                           END 3              235538
     C                     ENDIF                                           END 2              235538
      *                                                                                       235538
     C           K0GXST    CHAINDLGXSTL0             73                                       235538
      *                                                                                       235538
      ** For seq K, payment instructions are always used                                      235538
      *                                                                                       235538
     C           *IN73     IFEQ '0'                                                           235538
     C                     MOVELRXPSTM    @STM                                                235538
     C                     MOVELRXPONS    W#NOS1                                              235538
     C                     MOVELRXAWBN    SXAWBN                                              235538
     C                     MOVELRXAWBA    SXAWBA                                              235538
     C                     ELSE                                                               235538
     C           *LOCK     IN   LDA                                                           235538
     C                     MOVE K0EDCD    DBKEY                                               235538
     C                     MOVE '996'     DBASE                                               235538
     C                     MOVELK0DLNO    DBKEY                                               235538
     C                     MOVEL'DLGXSTL0'DBFILE                                              235538
     C                     OUT  LDA                                                           235538
     C                     EXSR *PSSR                                                         235538
     C                     ENDIF                                                              235538
      *                                                                                       235538
     C                     ENDIF                                           END 1              235538
      *                                                                                       235538
     C           @STM      LOKUPTABNST                   23               CSW097
      *                                                                   CSW097
     C********** MGPONS    IFNE *BLANKS                                                CSW097 235538
     C           W#NOS1    IFNE *BLANKS                                                       235538
     C           *IN23     ANDEQ'1'                                       CSW097
      *                                                                   CSW097
      **  either A/C with Bank or Receipient entered                      CSW097
      **  or A/C with A/c line = 'DIRECT'                                 CSW097
      *                                                                   CSW097
     C           MGAWBN    IFNE *BLANKS                                   CSW097
     C           MGRVNO    ORNE *BLANKS                                   CSW097
     C           AWBA6     ANDNE'DIRECT'                                  CSW097
      *                                                                   CSW097
      ** For principal exchange, use the exchange ccy from MGW36NPD                           235538
      *                                                                                       235538
     C           @MSSQ     IFEQ 'K'                                                           235538
     C                     MOVE MGXCCY    @NSKYB                                              235538
     C                     ELSE                                                               235538
     C           MGPSCY    IFNE *BLANK                                    CSW097
     C                     MOVE MGPSCY    @NSKYB                          CSW097
     C                     ELSE                                           CSW097
     C                     MOVE @CCY      @NSKYB                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                                       235538
     C                     ENDIF                                                              235538
      *                                                                   CSW097
     C**********           MOVELMGPONS    @NSKYE                                       CSW097 235538
     C                     MOVELW#NOS1    @NSKYE                                              235538
      *                                                                                       235538
     C                     CALL 'AONOSTR0'                                CSW097
     C                     PARM '*MSG   ' @RTCD   7                       CSW097
     C                     PARM '*KEY   ' @OPTN   7                       CSW097
     C                     PARM *BLANKS   @NSKYA  6                       CSW097
     C                     PARM           @NSKYB  3                       CSW097
     C**********           PARM *BLANKS   @NSKYC  4                                    CSW097 CGL029
     C                     PARM *BLANKS   @NSKYC                                              CGL029
     C                     PARM *BLANKS   @NSKYD  2                       CSW097
     C                     PARM           @NSKYE  2                       CSW097
     C                     PARM *BLANKS   @KEYF   3                       CSW097
     C                     PARM *BLANKS   @KEYG  10                       CSW097
     C                     PARM *BLANKS   @KEYH   1                       CSW097
     C           SDNOST    PARM SDNOST    DSFDY                           CSW097
      *                                                                   CSW097
      **  Nostro customer not found                                       CSW097
     C           @RTCD     IFNE *BLANKS                                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     MOVE 'Y'       @ERR                            CSW097
     C                     MOVE ':53 :'   MTAG                            CSW097
     C**********           MOVELMGPONS    MFLD                                         CSW097 235538
     C                     MOVEL@NSKYE    MFLD                                                235538
     C                     MOVELMSGA,3    MERR                            CSW097
     C                     ELSE                                           CSW097
      *                                                                   CSW097
      ** Branch Internal Customer cf. Customer number of Our Pay Nostro   CSW097
     C                     MOVELSECN      @SECN   6                       CSW097
     C           @SECN     IFNE A7CUST                                    CSW097
     C           MGAWBN    ANDNEA7CUST                                    CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     MOVE *BLANKS   ZDEST                           CSW097
     C           MGRVNO    IFEQ *BLANKS                                   CSW097
     C                     MOVELA7CUST    ZDEST                           CSW097
     C                     ELSE                                           CSW097
     C                     MOVELMGRVNO    ZDEST                           CSW097
     C                     ENDIF                                          CSW097
     C*********************CALL 'ZM0050'               15                              CSW097 CSW036
     C                     CALL 'ZM0051'               15                                     CSW036
     C                     PARM           ZDEST  12                       CSW097
     C                     PARM           ZSADD1 35                       CSW097
     C                     PARM           ZSADD2 35                       CSW097
     C                     PARM           ZSADD3 35                       CSW097
     C                     PARM           ZSADD4 35                       CSW097
     C                     PARM           ZSTAG   1                       CSW097
     C                     PARM           ZSTYPE  1                       CSW097
     C                     PARM ' '       ZERR    1                       CSW097
     C                     PARM           ZDBEI   1                                           CSW201
      *                                                                   CSW097
     C           *IN15     IFEQ '1'                                       CSW097
     C           *LOCK     IN   LDA                                       CSW097
     C                     MOVE '020'     DBASE            * * * * * * * *CSW097
     C                     MOVEL'       ' DBKEY            *  DBERR 020  *CSW097
     C*********************MOVEL'ZM0050'  DBFILE           * * * * * * * *             CSW097 CSW036
     C                     MOVEL'ZM0051'  DBFILE           * * * * * * * *                    CSW036
     C                     OUT  LDA                                       CSW097
     C                     EXSR *PSSR                                     CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
      **  Error when formating address                                    CSW097
     C           ZERR      IFEQ '1'                                       CSW097
     C                     MOVE 'Y'       @ERR                            CSW097
     C                     MOVE ':53 :'   MTAG                            CSW097
     C                     MOVELZDEST     MFLD                            CSW097
     C                     MOVELMSGA,6    MERR                            CSW097
     C                     ELSE                                           CSW097
     C                     EXSR FMT53                                     CSW097
     C                     ENDIF                                          CSW097
     C                     ENDIF                           Cust. No differCSW097
     C                     ENDIF                           Nostro exist   CSW097
     C                     ENDIF                           A/C & recepientCSW097
     C                     ENDIF                           Pay nostro/set.CSW097
      *                                                                   CSW097
      **  Field :56a: and :57a: Receiving and benefciary inst.            CSW097
      **  Nostro field blank                                              CSW097
      *                                                                   CSW097
     C                     MOVE *BLANK    FLD57U  1                       CSW097
     C********** MGPSTM    IFEQ 00                                                     CSW097 235538
     C           @STM      IFEQ '00'                                                          235538
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     MOVE ':57D:'   MTAG                            CSW097
     C                     MOVEL'UNKNOWN' MFLD                            CSW097
     C                     MOVE 'Y'       FLD57U                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
      **  Field 57 Seq C is not UNKNOWN                                   CSW097
     C           FLD57U    IFNE 'Y'                                       CSW097
      *                                                                   CSW097
      **  Field :57:  A/C with institution non-blank                      CSW097
     C           MGAWBN    IFNE *BLANKS                                   CSW097
     C           SXAWBN    ORNE *BLANKS                                                       235538
      *                                                                   CSW097
      **  Field :56:  Pay Intermediary bank                               CSW097
     C           MGPIBN    IFNE *BLANKS                                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     MOVE *BLANKS   ZDEST                           CSW097
     C                     MOVELMGPIBN    ZDEST                           CSW097
     C                     MOVEL*BLANKS   ACLINE                          CSW097
     C                     MOVELMGPIBA    ACLINE                          CSW097
     C                     MOVE ' '       TAG                             CSW097
     C                     MOVE '56'      FLDNO                           CSW097
     C                     EXSR FSWAD                                     CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
      **  Format Account with institution                                 CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     MOVE *BLANKS   ZDEST                           CSW097
     C           SXAWBN    IFNE *BLANKS                                                       235538
     C                     MOVELSXAWBN    ZDEST                                               235538
     C                     ELSE                                                               235538
     C                     MOVELMGAWBN    ZDEST                           CSW097
     C                     ENDIF                                                              235538
     C                     MOVEL*BLANKS   ACLINE                          CSW097
     C           SXAWBA    IFNE *BLANKS                                                       235538
     C                     MOVE SXAWBA    ACLINE                                              235538
     C                     ELSE                                                               235538
     C                     MOVELMGBENA    ACLINE                          CSW097
     C                     ENDIF                                                              235538
     C                     MOVE ' '       TAG                             CSW097
     C                     MOVE '57'      FLDNO                           CSW097
     C                     EXSR FSWAD                                     CSW097
     C                     MOVE 'Y'       FLD57O  1                       CSW097
      *                                                                   CSW097
      **    A/C with Inst. blank                                          CSW097
     C                     ELSE                                           CSW097
      *                                                                   CSW097
      *   Field 57 = pay nostro customer if settlement via '02' or '12'   CSW097
      **  OR if A/c with Bank Account line set up as 'DIRECT'             CSW097
     C********** MGPSTM    IFEQ 02                                                     CSW097 235538
     C********** MGPSTM    OREQ 12                                                     CSW097 235538
     C           @STM      IFEQ '02'                                                          235538
     C           @STM      OREQ '12'                                                          235538
     C           AWBA6     OREQ 'DIRECT'                                  CSW097
      *                                                                                       235538
     C           @MSSQ     IFEQ 'K'                                                           235538
     C                     MOVE MGXCCY    @CYCD                                               235538
     C                     ELSE                                                               235538
      *                                                                   CSW097
     C           MGPSCY    IFNE *BLANK                                    CSW097
     C                     MOVE MGPSCY    @CYCD                           CSW097
     C                     ELSE                                           CSW097
     C                     MOVE @CCY      @CYCD                           CSW097
     C                     ENDIF                                          CSW097
      *                                                                                       235538
     C                     ENDIF                                                              235538
      *                                                                   CSW097
     C**********           MOVELMGPONS    @NONB                                        CSW097 235538
     C                     MOVELW#NOS1    @NONB                                               235538
      *                                                                                       235538
     C                     CALL 'AONOSTR0'                                CSW097
     C                     PARM '*MSG   ' @RTCD   7                       CSW097
     C                     PARM '*KEY   ' @OPTN   7                       CSW097
     C                     PARM *BLANKS   @CUST   6                       CSW097
     C                     PARM           @CYCD   3                       CSW097
     C**********           PARM *BLANKS   @ACCD   4                                    CSW097 CGL029
     C                     PARM *BLANKS   @ACCD  10                                           CGL029
     C                     PARM *BLANKS   @ACSN   2                       CSW097
     C                     PARM           @NONB   2                       CSW097
     C                     PARM *BLANKS   @BRCD   3                       CSW097
     C                     PARM *BLANKS   @CSSN  10                       CSW097
     C                     PARM *BLANKS   @PNOI   1                       CSW097
     C           SDNOST    PARM SDNOST    DSFDY                           CSW097
      *                                                                   CSW097
      **  Nostro customer not found                                       CSW097
      *                                                                   CSW097
     C           @RTCD     IFNE *BLANKS                                   CSW097
     C                     MOVE 'Y'       @ERR                            CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C**********           MOVELMGPONS    HLD2    2                                    CSW097 235538
     C                     MOVEL@NONB     HLD2    2                                           235538
     C                     MOVEL@CCY      HLD5                            CSW097
     C                     MOVE HLD2      HLD5    5                       CSW097
     C                     MOVELHLD5      MFLD                            CSW097
     C                     MOVELMSGA,3    MERR                            CSW097
     C                     MOVE ':57 :'   MTAG                            CSW097
     C                     ELSE                                           CSW097
      *                                                                   CSW097
      **  Format our Pay Nostro Customer Address                          CSW097
      *                                                                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     MOVE *BLANKS   ZDEST                           CSW097
     C           MGRVNO    IFEQ *BLANKS                                   CSW097
     C                     MOVELA7CUST    ZDEST                           CSW097
     C                     ELSE                                           CSW097
     C                     MOVELMGRVNO    ZDEST                           CSW097
     C                     ENDIF                                          CSW097
     C                     MOVEL*BLANKS   ACLINE                          CSW097
     C                     MOVE ' '       TAG                             CSW097
     C                     MOVE '57'      FLDNO                           CSW097
     C                     EXSR FSWAD                                     CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ELSE                                           CSW097
      *                                                                                       235538
      ** @STM already contains correct value                                                  235538
      *                                                                                       235538
     C**********           MOVE MGPSTM    @STM                                         CSW097 235538
     C           @STM      LOKUPTABINT                   23               CSW097
      *                                                                   CSW097
     C           *IN23     IFEQ '1'                                       CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     MOVE *BLANKS   ZDEST                           CSW097
     C                     MOVELSECN      ZDEST                           CSW097
     C                     MOVEL*BLANKS   ACLINE                          CSW097
     C                     MOVE ' '       TAG                             CSW097
     C                     MOVE '57'      FLDNO                           CSW097
     C                     EXSR FSWAD                                     CSW097
      *                                                                   CSW097
     C                     ELSE                                           CSW097
      *                                                                   CSW097
      **  Field 53 is equal to Our Pay Nostro                             CSW097
      *                                                                   CSW097
      ** For principal exchange, use the exchange ccy from MGW36NPD                           235538
      *                                                                                       235538
     C           @MSSQ     IFEQ 'K'                                                           235538
     C                     MOVE MGXCCY    @NSKYB                                              235538
     C                     ELSE                                                               235538
      *                                                                                       235538
     C           MGPSCY    IFNE *BLANK                                    CSW097
     C                     MOVE MGPSCY    @NSKYB                          CSW097
     C                     ELSE                                           CSW097
     C                     MOVE @CCY      @NSKYB                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                                       235538
     C                     ENDIF                                                              235538
      *                                                                   CSW097
     C**********           MOVELMGPONS    @NSKYE                                       CSW097 235538
     C                     MOVELW#NOS1    @NSKYE                                              235538
      *                                                                                       235538
     C                     CALL 'AONOSTR0'                                CSW097
     C                     PARM '*MSG   ' @RTCD   7                       CSW097
     C                     PARM '*KEY   ' @OPTN   7                       CSW097
     C                     PARM *BLANKS   @NSKYA  6                       CSW097
     C                     PARM           @NSKYB  3                       CSW097
     C**********           PARM *BLANKS   @NSKYC  4                                    CSW097 CGL029
     C                     PARM *BLANKS   @NSKYC                                              CGL029
     C                     PARM *BLANKS   @NSKYD  2                       CSW097
     C                     PARM           @NSKYE  2                       CSW097
     C                     PARM *BLANKS   @KEYF   3                       CSW097
     C                     PARM *BLANKS   @KEYG  10                       CSW097
     C                     PARM *BLANKS   @KEYH   1                       CSW097
     C           SDNOST    PARM SDNOST    DSFDY                           CSW097
      *                                                                   CSW097
      **  Nostro customer not found                                       CSW097
     C           @RTCD     IFNE *BLANKS                                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     MOVE 'Y'       @ERR                            CSW097
     C                     MOVE ':53 :'   MTAG                            CSW097
     C**********           MOVELMGPONS    MFLD                                         CSW097 235538
     C                     MOVEL@NSKYE    MFLD                                                235538
     C                     MOVELMSGA,3    MERR                            CSW097
     C                     ELSE                                           CSW097
      *                                                                   CSW097
      **  Format our Pay Nostro Customer Address                          CSW097
      *      ( only if Tag 53A not yet generated )                        CSW097
      *                                                                   CSW097
     C           *IN55     IFEQ '1'                                       CSW097
     C                     MOVE '0'       *IN55                           CSW097
     C                     ELSE                                           CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     MOVE *BLANKS   ZDEST                           CSW097
     C                     MOVELA7CUST    ZDEST                           CSW097
     C                     MOVEL*BLANKS   ACLINE                          CSW097
     C                     MOVE ' '       TAG                             CSW097
     C                     MOVE '53'      FLDNO                           CSW097
     C                     EXSR FSWAD                                     CSW097
     C                     ENDIF                                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
      **  Settlement 01,07 or 08 with MGAWBN blank or settlement 00       CSW097
      *                                                                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     MOVE ':57D:'   MTAG                            CSW097
     C                     MOVEL'UNKNOWN' MFLD                            CSW097
      *                                                                   CSW097
     C                     ENDIF                                          CSW097
     C                     ENDIF                                          CSW097
     C                     ENDIF                                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                                       CSW201
     C                     MOVE *BLANKS   ZDBEI                                               CSW201
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   REPT - print incorrectly generated messages                 *
      *   Called by - main process                                    *
      *****************************************************************
      *
     C           REPT      BEGSR
      *
      ** If MG036NP1 has not previously opened.
      *
     C           *IN50     IFEQ '0'
     C                     OPEN MG036NP1
     C                     MOVE *ON       *IN50
     C                     END
      *
     C                     WRITEHEADER
     C                     WRITETEXT
      *
      **  Process multiple occurrence data structure
      *
     C***********          Z-ADD0         I       30                                          235727
     C                     Z-ADD0         I       40                                          235727
     C           I         DOWLEX
     C                     ADD  1         I
     C           I         OCUR MULT
     C           *IN55     IFEQ '1'                                                           CSW213
     C                     WRITEHEADER                                                        CSW213
     C                     WRITETEXT                                                          CSW213
     C                     WRITELINE                                                          CSW213
     C                     ELSE                                                               CSW213
     C                     WRITELINE
     C                     ENDIF                                                              CSW213
     C                     ENDDO
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   OMSG - output correctly generated messages                  *
      *   Called by - main process                                    *
      *   Calls - WREF Write o/p reference to PF/MGOREFPD.            *
      *****************************************************************
      *
     C           OMSG      BEGSR
      *
      ****Write*reference*record*to*PF/MGOREFPD.                          CSW097
      *                                                                   CSW097
     C***********          EXSR WREF                                      CSW097
      *
      **  Write multiple occurrence data structure to MGOMSGPD
      *
     C                     Z-ADDX         W#XX    30                                          235545
     C***********          Z-ADD1         X       30                                          235727
     C                     Z-ADD1         X       40                                          235727
     C           X         OCUR MULT
      *
     C           MTAG      LOKUP@ATAG                    33
      *
      ** Write record to MGOMSGPD only if field is not blank,
      ** or field is blank and tag is formatted really with blanks.
      *
     C***********X         DOWLE500                                                           235727
     C           X         DOWLE9999                                                          235727
     C           *IN33     ANDEQ'1'
     C***********X         ORLE 500                                                           235727
     C           X         ORLE 9999                                                          235727
     C           *IN33     ANDEQ'0'
     C           MFLD      ANDNE*BLANKS
      *
      * Set up carriage return
      ** CRLF Control Character for message data records.
     C           CTRC      IFEQ *BLANKS
     C                     MOVE CRLF      CTRC
     C                     ELSE
     C                     MOVE *BLANKS   CTRC
     C                     END
      *
     C                     WRITEMGOMSGD0               06
      *
      **  Error on write to PF/MGOMSGPD (message data file)
      *
     C           *IN06     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '012'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 012  *
     C                     MOVEL'MGOMSGPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     ADD  1         X
     C           X         OCUR MULT
     C           MTAG      LOKUP@ATAG                    33
      *
     C                     ENDDO
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   WREF - Write reference record to PF/MGOREFPD                *
      *   Called by - OMSG  output message PF/MGOMSGPD                *
      *****************************************************************
      *
     C           WREF      BEGSR
      *
     C                     MOVE *BLANKS   SYTM
     C                     MOVE MGMODI    MODI
     C                     MOVE @TRNA     TRNO
     C                     MOVE *BLANKS   TRNF
     C                     MOVE *BLANKS   TRNM
     C           MGACMI    IFEQ 'Y'                                                           CSW213
     C                     MOVEL@TRNID    MTRN                                                CSW213
     C                     ELSE                                                               CSW213
     C                     MOVELMGTNUM    MTRN
     C                     ENDIF                                                              CSW213
     C                     MOVE MGTTYP    TNTP
     C                     MOVE MGTSTP    SBTP
     C                     MOVE MGEVTP    EVTP
     C                     MOVEL*BLANKS   NWBN
     C           *IN51     IFEQ '1'
     C                     MOVE '360'     MTPY
     C                     ELSE
     C                     MOVE '361'     MTPY
     C                     ENDIF
     C                     MOVE 'N'       MPRY
     C                     MOVELCWRD      LSCC
     C                     MOVEL*BLANKS   PTST
     C                     MOVEL*BLANKS   CARQ
     C                     MOVEL*BLANKS   MPDE
     C                     MOVEL@HRDT     HRDT
     C                     TIME           MGTM
     C                     MOVE BJMRDT    LADT
     C                     MOVE MGTM      LATM
      *                                                                                       CSD015
      ** Check if message type exists in the watch list                                       CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           222385
     C           CSW025    ANDEQ'N'                                                           CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *
     C           MGST      IFEQ 'RSND'
     C                     MOVE BJMRDT    RELD
     C                     MOVE MGTM      RELT
     C                     MOVE '2'       MGSG
     C                     END
     C           MGST      IFEQ 'CRTD'
     C                     MOVE '1'       MGSG
     C                     END
     C           MGST      IFEQ 'PRTD'
     C                     MOVE '3'       MGSG
     C                     END
      *
     C                     MOVEL*BLANKS   RUSR
     C                     MOVEL*BLANKS   RWSN
     C                     MOVEL*BLANKS   AMTS
     C                     MOVEL*BLANKS   AMTX
     C                     MOVEL*BLANKS   SVDT
     C                     MOVEL*BLANKS   CINDV                           184718
     C                     MOVEL*BLANKS   CCY
     C                     MOVEL*BLANKS   NSNO
     C                     MOVEL*BLANKS   SACN
     C                     MOVEL*BLANKS   AORR
     C                     MOVEL*BLANKS   DESI
      *
      **  Branch details
      *
     C                     MOVE MGBRCA    BRCA
     C                     MOVE MGPOBR    OTHB
     C           OTHB      IFNE *BLANKS
     C                     MOVELMSGA,1    OTHT
     C                     END
     C                     MOVE MGROBR    RCBR
      *
     C                     MOVE *BLANKS   NETI
     C                     MOVE *BLANKS   DELC
     C                     MOVE *BLANKS   DYST
     C                     MOVE *BLANKS   RSID
     C                     MOVE *BLANKS   MSE1
     C                     MOVE *BLANKS   ELIN
     C                     MOVE *BLANKS   SSAC
     C                     MOVE *BLANKS   MIR
     C                     MOVE *BLANKS   TSKS
     C                     MOVE *BLANKS   TSKY
     C                     MOVE MGCHTP    AORR                                                CSW025
     C/COPY WNCPYSRC,MG036NC003
      *
     C                     WRITEMGOREFD0               05
      *
      **  Error on write to PF/MGOREFPD (message reference file)
      *
     C           *IN05     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '014'     DBASE            * * * * * * * *
     C                     MOVEL'       ' DBKEY            *  DBERR 014  *
     C                     MOVEL'MGOREFPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      ** Write transaction history record                                                     190127
     C           MGACMI    IFEQ 'Y'                                                           CSW213
     C                     MOVELTRNO      @HREF1                                              CSW213
     C                     MOVE '000'     HSSEQ                                               CSW213
     C                     MOVE @SSEQ     HSSEQ                                               CSW213
     C                     ELSE                                                               CSW213
     C                     MOVELTRNO      @HREF                                               190127
     C                     MOVE *BLANKS   HSDEST                                            MD023229
     C                     ENDIF                                                              CSW213
     C           *IN51     IFEQ '1'                                                           190127
     C                     MOVE '360'     HSMTPY                                              190127
     C                     ELSE                                                               190127
     C                     MOVE '361'     HSMTPY                                              190127
     C                     END                                                                190127
      *                                                                                       190127
     C                     WRITEMGHISTD0               56                                     190127
      *                                                                                       190127
      **  Error on write to PF/MGHISTPD                                                       190127
     C           *IN56     IFEQ '1'                                                           190127
     C           *LOCK     IN   LDA                                                           190127
     C                     MOVE '027'     DBASE            * * * * * * * *                    190127
     C                     MOVEL'       ' DBKEY            *  DBERR 027  *                    190127
     C                     MOVEL'MGHISTPD'DBFILE           * * * * * * * *                    190127
     C                     OUT  LDA                                                           190127
     C                     EXSR *PSSR                                                         190127
     C                     END                                                                190127
      *
     C                     ENDSR
     C/COPY WNCPYSRC,MG036NC004
      /EJECT
      *****************************************************************
      *   FSWAD - Format SWIFT address                                *
      *   Called by - FMTB  - Format field  :57a:                     *
      *               FMTC  - Format field  :57a:                     *
      *****************************************************************
      *
     C           FSWAD     BEGSR
      *
     C*********************CALL 'ZM0050'                                                      CSW036
     C                     CALL 'ZM0051'                                                      CSW036
     C                     PARM           ZDEST  12
     C                     PARM           ZSADD1 35
     C                     PARM           ZSADD2 35
     C                     PARM           ZSADD3 35
     C                     PARM           ZSADD4 35
     C                     PARM           ZSTAG   1
     C                     PARM           ZSTYPE  1
     C                     PARM           ZERR    1
     C                     PARM           ZDBEI                                               CSW201
      *
      ** Error ?
      *
     C           ZERR      IFEQ '1'
     C                     MOVE 'Y'       @ERR
     C                     MOVE @MTAG     MTAG
     C                     MOVELZDEST     MFLD
     C                     MOVELMSGA,6    MERR
     C                     ELSE
      *
      ** Address 1
      *
     C           ACLINE    IFNE *BLANKS
     C                     MOVELACLINE    MFLD
     C                     ELSE
     C                     MOVELZSADD1    MFLD
     C                     END
      *
      ** SWIFT address;  Else full address.
      *
     C           ZSTAG     IFEQ 'A'
     C                     MOVE 'A'       TAG
     C                     MOVE @MTAG     MTAG
     C           ACLINE    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD1    MFLD
     C                     END
      *
     C                     ELSE
     C                     MOVE 'D'       TAG
     C                     MOVE @MTAG     MTAG
     C           ACLINE    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD1    MFLD
     C                     END
      *
      **  Address 2
      *
     C           ZSADD2    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD2    MFLD
     C                     END                             Address 2
      *
      **  Address 3
      *
     C           ZSADD3    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD3    MFLD
     C                     END                             Address 3
      *
      **  Address 4
      *
     C           ZSADD4    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     MOVELZSADD4    MFLD
     C                     END                             Address 4
     C                     END                             Address 1
      *
     C                     END                             Error ?
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *   FLD72 - Format Field 72 (Sender to Receiver Information)    *
      *   Called by - Main process                                    *
      *   Calls     -                                                 *
      *****************************************************************
      *
     C           FLD72     BEGSR
      *
      ** Store the Sender to Receiver information for easier use.
      *
     C                     MOVE MGS2R1    SR2F,1
     C                     MOVE MGS2R2    SR2F,2
     C                     MOVE MGS2R3    SR2F,3
     C                     MOVE MGS2R4    SR2F,4
     C                     MOVE MGS2R5    SR2F,5
     C                     MOVE MGS2R6    SR2F,6
      *                                                                   178970
      ** If :22B: contains OTHR, and :37N: is not in the same sequence,   178970
      ** then /LOCC/+English Location Name must be in :72:                178970
      *                                                                   178970
     C                     MOVE *BLANKS   @MSSQ                           178970
     C                     CLEARLOCN                                      178970
     C                     Z-ADD0         A       60                      178970
      *                                                                   178970
     C           KEYSQN    SETLLMGU36NPD                                  178970
     C                     READ MGU36NPD                 13               178970
      *                                                                   178970
     C           *IN13     DOWEQ'0'                                       178970
     C           WSEQNU    ANDEQ@SEQN                                     178970
      *                                                                   178970
     C           MGISFC    IFEQ OTHR                                      178970
     C           MGMSSQ    ANDNE'B'                                       178970
     C           MGMSSQ    ANDNE'C'                                       178970
     C           MGMSSQ    ANDNE'E'                                       178970
     C           MGMSSQ    ANDNE'F'                                       178970
      *                                                                   178970
      ** Check if location name isn't already in the array                178970
      *                                                                   178970
     C           A         IFEQ 0                                         178970
     C                     Z-ADD1         A                               178970
     C                     ENDIF                                          178970
      *                                                                   178970
     C                     Z-ADDA         B       60                      178970
     C                     MOVE 'N'       LOCFND  1                       178970
      *                                                                   178970
     C           B         DOWNE1                                         178970
     C                     SUB  1         B                               178970
      *                                                                   178970
     C           MGLOCN    IFEQ LOCN,B                                    178970
     C                     MOVE 'Y'       LOCFND                          178970
     C                     LEAVE                                          178970
     C                     ENDIF                                          178970
      *                                                                   178970
     C                     ENDDO                                          178970
      *                                                                   178970
      ** If location isn't already in the array, move location name in    178970
      *                                                                   178970
     C           LOCFND    IFEQ 'N'                                       178970
     C                     MOVELMGLOCN    LOCN,A                          178970
     C                     ADD  1         A                               178970
      *                                                                   178970
     C           A         IFEQ 7                                         178970
     C                     LEAVE                                          178970
     C                     ENDIF                                          178970
      *                                                                   178970
     C                     ENDIF                                          178970
     C                     ENDIF                                          178970
      *                                                                   178970
     C                     READ MGU36NPD                 13               178970
     C                     ENDDO                                          178970
      *                                                                   178970
      ** If the array is not empty, move contents to :72:                 178970
      *                                                                   178970
     C           A         IFNE 0                                         178970
      *                                                                   178970
     C                     SUB  1         A                               178970
      *                                                                   178970
      ** /LOCC/ has priority over other codewords, so need to be on the   178970
      ** top.  If there are existing code words, move the data down the   178970
      ** array as appropriate                                             178970
      *                                                                   178970
     C           6         SUB  A         C       10                      178970
      *                                                                   178970
     C           C         DOWNE0                                         178970
     C           C         ADD  A         D       10                      178970
     C                     MOVE SR2F,C    SR2F,D                          178970
     C                     SUB  1         C                               178970
     C                     ENDDO                                          178970
      *                                                                   178970
      ** Move contents to :72:                                            178970
      *                                                                   178970
     C                     Z-ADD0         E       10                      178970
     C           A         DOWGTE                                         178970
     C                     ADD  1         E                               178970
     C           LOCC      CAT  LOCN,E    SR2F,E                          178970
     C                     ENDDO                                          178970
      *                                                                   178970
     C                     ENDIF                                          178970
      *
     C                     Z-ADD0         I
     C                     MOVE 'N'       FLD72O  1
      *
      ** Search through all six fields & output if not blank.
      *
     C           I         DOWLT6
      *
     C                     ADD  1         I
     C           SR2F,I    IFNE *BLANKS
     C                     ADD  1         X
     C           X         OCUR MULT
     C           FLD72O    IFEQ 'N'
     C                     MOVE ':72: '   MTAG
     C                     MOVE 'Y'       FLD72O
     C                     ENDIF
     C                     MOVELSR2F,I    MFLD
     C                     ELSE
     C                     LEAVE
     C                     ENDIF
      *
     C                     ENDDO
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************   CCF003
      *   CFMAT - produce confirmation matching feedback record       *   CCF003
      *   Called by - Main process                                    *   CCF003
      *   Calls       -                                               *   CCF003
      *****************************************************************   CCF003
      *                                                                   CCF003
     C           CFMAT     BEGSR                                          CCF003
      *                                                                   CCF003
     C                     CALL 'MG5001'                                  CCF003
     C                     PARM TRNO      @TRNM  16                       CCF003
     C                     PARM MGBRCA    @BRCA   3                       CCF003
     C                     PARM *BLANK    @FEED   1                       CCF003
      *                                                                   CCF003
     C           @FEED     IFEQ 'Y'                                       CCF003
      *                                                                   CCF003
     C           *IN50     IFEQ '0'                                       CCF003
     C                     OPEN MG036NP1                                  CCF003
     C                     SETON                     50U7                 CCF003
     C                     ENDIF                                          CCF003
      *                                                                   CCF003
      ** Set up headings and sender/customer information                  CCF003
      ** for the error report.                                            CCF003
      *                                                                   CCF003
     C                     MOVELMGTNUM    TNUM    60                      CCF003
     C                     WRITEHEADER                                    CCF003
     C                     WRITETEXT                                      CCF003
     C                     WRITEFEED                                      CCF003
     C                     ENDIF                                          CCF003
      *                                                                   CCF003
     C                     ENDSR                                          CCF003
      /EJECT                                                              CSW097
      *****************************************************************   CSW097
      *   SRFINC - Common subroutine to format tag :18A: and :22B:    *   CSW097
      *   Called by -                                                 *   CSW097
      *   Calls     - NONE                                            *   CSW097
      *****************************************************************   CSW097
      *                                                                   CSW097
     C           SRFINC    BEGSR                                          CSW097
      *                                                                   CSW097
      ** Add field :18A: to the multiple occurrence data structure        CSW097
      ** and to be formatted after field :22B: has been counted.          CSW097
      *                                                                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     MOVEL':18A:'   MTAG                            CSW097
      *                                                                   CSW097
     C                     Z-ADDX         Y                               CSW097
     C                     Z-ADD*ZERO     NREPT   50                      CSW097
      *                                                                   CSW097
     C           KEYSQN    SETLLMGU36NPD                                  CSW097
     C                     READ MGU36NPD                 13               CSW097
      *                                                                   CSW097
     C           *IN13     DOWEQ'0'                                       CSW097
     C           WSEQNU    ANDEQ@SEQN                                     CSW097
     C           MGMSSQ    ANDEQ@MSSQ                                     CSW097
      *                                                                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     MOVELMGISFC    MFLD                            CSW097
     C********** NREPT     IFLT 1                                  CSW097 205410
     C                     MOVEL':22B:'   MTAG                            CSW097
     C**********           ENDIF                                   CSW097 205410
      *                                                                   CSW097
     C                     ADD  1         NREPT                           CSW097
      *                                                                   CSW097
     C                     READ MGU36NPD                 13               CSW097
     C                     ENDDO                                          CSW097
      *                                                                   CSW097
      ** Re-access field :18A: and format it using the count              CSW097
      ** of tag :22B:                                                     CSW097
      *                                                                   CSW097
     C           Y         OCUR MULT                                      CSW097
     C                     MOVELNREPT     MFLD                            CSW097
      *                                                                   CSW097
     C                     ENDSR                                          CSW097
      *****************************************************************   CSW097
      /EJECT                                                              CSW097
      *****************************************************************   CSW097
      *   SRSUPR - Check if seq. B1, C1-C3, E1, and F1-F3 in MT360 msg*   CSW097
      *            for a Forward Rate Agreement will be suppressed.   *   CSW097
      *            (as per Condition 18)                              *   CSW097
      *   Called by - FMTA                                            *   CSW097
      *   Calls     -                                                 *   CSW097
      *****************************************************************   CSW097
      *                                                                   CSW097
     C           SRSUPR    BEGSR                                          CSW097
      *                                                                   CSW097
     C                     MOVE *BLANK    W@SUPR  1                       CSW097
     C                     MOVE *BLANK    WOSUPR  1                       171312
     C                     MOVE *BLANK    WTSUPR  1                       171312
      *                                                                   CSW097
     C           MGAGTY    IFEQ 'ISDA'                                    CSW097
      *                                                                   CSW097
     C           MGTFLO    LOKUP@IDBR1                   72               CSW097
      *                                                                   CSW097
     C************IN72     IFEQ '0'                                CSW097 171312
     C           *IN72     IFEQ '1'                                       171312
     C                     MOVE 'Y'       WTSUPR                          171312
     C                     ENDIF                                          171312
     C*                                                                   171312
     C           MGOFLO    LOKUP@IDBR1                   72               CSW097
     C***********          ENDIF                                   CSW097 171312
      *                                                                   CSW097
     C           *IN72     IFEQ '1'                                       CSW097
     C***********          MOVE 'Y'       W@SUPR                   CSW097 171312
     C                     MOVE 'Y'       WOSUPR                          171312
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C           MGAGTY    IFEQ 'AFB '                                    CSW097
      *                                                                   CSW097
     C           MGTFLO    LOKUP@IDBR2                   72               CSW097
      *                                                                   CSW097
     C************IN72     IFEQ '0'                                CSW097 171312
     C           *IN72     IFEQ '1'                                       171312
     C                     MOVE 'Y'       WTSUPR                          171312
     C                     ENDIF                                          171312
     C*                                                                   171312
     C           MGOFLO    LOKUP@IDBR2                   72               CSW097
     C***********          ENDIF                                          171312
      *                                                                   CSW097
     C           *IN72     IFEQ '1'                                       CSW097
     C***********          MOVE 'Y'       W@SUPR                   CSW097 171312
     C                     MOVE 'Y'       WOSUPR                          171312
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ENDSR                                          CSW097
      *****************************************************************   CSW097
     C/EJECT                                                              CSW097
      *****************************************************************   CSW097
      *   FMT53 - Format Field 53 address   - Sequence C              *   CSW097
      *   Called by   PAY                                             *   CSW097
      *   Calls       -                                               *   CSW097
      *****************************************************************   CSW097
      *                                                                   CSW097
     C           FMT53     BEGSR                                          CSW097
      *                                                                   CSW097
      **  A Type address                                                  CSW097
     C           ZSTAG     IFEQ 'A'                                       CSW097
     C                     MOVE ':53A:'   MTAG                            CSW097
     C                     MOVELZSADD1    MFLD                            CSW097
     C                     MOVE '1'       *IN55                           CSW097
      *                                                                   CSW097
     C                     ELSE                                           CSW097
      *                                                                   CSW097
      **  Access SDCUSTPD using our pay nostro customer number            CSW097
     C                     MOVE *BLANKS   @KEY1                           CSW097
     C                     MOVELA7CUST    @KEY1                           CSW097
     C                     CALL 'AOCUSTR0'                                CSW097
     C                     PARM '*MSG   ' @RTCD                           CSW097
     C                     PARM '*KEY   ' @OPTN                           CSW097
     C                     PARM           @KEY1  10                       CSW097
     C                     PARM *BLANKS   @KYST   7                       CSW097
     C           SDCUST    PARM SDCUST    DSSDY                           CSW097
      *                                                                   CSW097
      ** Customer record not found - Error                                CSW097
     C           @RTCD     IFNE *BLANKS                                   CSW097
     C                     MOVE 'Y'       @ERR                            CSW097
     C                     MOVE ':53 :'   MTAG                            CSW097
     C                     MOVELA7CUST    MFLD                            CSW097
     C                     MOVE MSGA,2    MERR                            CSW097
      *                                                                   CSW097
     C                     ELSE                                           CSW097
      *                                                                   CSW097
      **  B Type address                                                  CSW097
     C**********           MOVE BBPCNB    @PCNB   60                                   CSW097 CSD027
     C                     MOVE BBPCNB    @PCNB   6                                           CSD027
     C           SPAIN     IFEQ 'P'                                       CSW097
     C           @PCNB     ANDEQSECN                                      CSW097
     C           BBPAIN    OREQ 'P'                                       CSW097
     C           A7CUST    ANDEQSPCNB                                     CSW097
     C           BBPCNB    OREQ SPCNB                                     CSW097
     C           BBPCNB    ANDNE*BLANKS                                   CSW097
      *                                                                   CSW097
     C                     MOVE ':53B:'   MTAG                            CSW097
     C                     MOVE *BLANKS   @WRK                            CSW097
     C                     MOVEABBCRNM    @WRK,1                          CSW097
     C                     Z-ADD22        J       20                      CSW097
     C                     MOVEABBCRTN    @WRK,J                          CSW097
     C                     MOVEA@WRK      MFLD                            CSW097
      *                                                                   CSW097
      **  D Type address                                                  CSW097
     C                     ELSE                                           CSW097
     C                     MOVE ':53D:'   MTAG                            CSW097
     C                     MOVELZSADD1    MFLD                            CSW097
      **  Address 2                                                       CSW097
     C           ZSADD2    IFNE *BLANKS                                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     MOVELZSADD2    MFLD                            CSW097
      **  Address 3                                                       CSW097
     C           ZSADD3    IFNE *BLANKS                                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     MOVELZSADD3    MFLD                            CSW097
      **  Address 4                                                       CSW097
     C           ZSADD4    IFNE *BLANKS                                   CSW097
     C                     ADD  1         X                               CSW097
     C           X         OCUR MULT                                      CSW097
     C                     MOVELZSADD4    MFLD                            CSW097
     C                     ENDIF                           D address 4    CSW097
     C                     ENDIF                           D address 3    CSW097
     C                     ENDIF                           D address 2    CSW097
     C                     ENDIF                           B/D address 1  CSW097
      *                                                                   CSW097
     C                     ENDIF                           Cust. error?   CSW097
      *                                                                   CSW097
     C                     ENDIF                           A/B/D address? CSW097
      *                                                                   CSW097
     C                     ENDSR                                          CSW097
      *****************************************************************   CSW097
      /EJECT                                                              178970
      *****************************************************************   178970
      *   SR37LC - Subroutine to format tag :37N: if :22B: contains   *   178970
      *            'OTHR'                                             *   178970
      *   Called by -                                                 *   178970
      *   Calls     - NONE                                            *   178970
      *****************************************************************   178970
      *                                                                   178970
     C           SR37LC    BEGSR                                          178970
      *                                                                   178970
     C                     MOVE *BLANKS   W#LOCN 30                       178970
      *                                                                   178970
     C           KEYSQN    SETLLMGU36NPD                                  178970
     C                     READ MGU36NPD                 13               178970
      *                                                                   178970
     C           *IN13     DOWEQ'0'                                       178970
     C           WSEQNU    ANDEQ@SEQN                                     178970
     C           MGMSSQ    ANDEQ@MSSQ                                     178970
      *                                                                   178970
     C           MGISFC    IFEQ OTHR                                      178970
     C                     MOVE MGLOCN    W#LOCN                          178970
     C                     LEAVE                                          178970
     C                     ENDIF                                          178970
      *                                                                   178970
     C                     READ MGU36NPD                 13               178970
     C                     ENDDO                                          178970
      *                                                                   178970
     C           W#LOCN    IFNE *BLANKS                                   178970
      *                                                                   178970
     C                     ADD  1         X                               178970
     C           X         OCUR MULT                                      178970
     C           LOCC      CAT  W#LOCN    MFLD                            178970
      *                                                                   178970
     C           FLD37N    IFNE 'Y'                                       178970
     C                     MOVEL':37N:'   MTAG                            178970
     C                     MOVE 'Y'       FLD37N                                              236232
     C                     ENDIF                                          178970
      *                                                                   178970
     C                     ENDIF                                          178970
     C                     ENDSR                                          178970
      *****************************************************************   178970
      /EJECT                                                              CSW097
      *****************************************************************                       CSD015
      *                                                               *                       CSD015
      *  SRWTCH - Watch Processing                                    *                       CSD015
      *                                                               *                       CSD015
      *****************************************************************                       CSD015
      *                                                                                       CSD015
     C           SRWTCH    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Check if message is for automatic release.                                           CSD015
      ** If yes, default to CRTD status and set Automatic Release Flag to 'Y'                 CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       PARLS   1                                           CSD015
     C           MGST      IFEQ 'RSND'                                                        CSD015
     C           NWRK      IFEQ 'SWIFT '                                                      CSD015
     C           NWRK      OREQ 'TELEX '                                                      CSD015
     C           NWRK      OREQ 'STTX  '                                                      CSD015
     C                     MOVE 'CRTD'    MGST                                                CSD015
     C                     MOVE '1'       MGSG                                                CSD015
     C                     MOVE 'Y'       PARLS                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     CLEARWLTDS                                                         CSD015
     C                     MOVE *BLANKS   PSTRNG                                              CSD015
     C                     MOVE *ZEROS    W4VDAT                                              CSD015
     C                     MOVE *ZEROS    W4MDAT                                              CSD015
     C                     MOVE *ZEROS    W4AMT1                                              CSD015
     C                     MOVE *ZEROS    W4AMT2                                              CSD015
      *                                                                                       CSD015
      ** Setup parameters for Compliance engine program                                       CSD015
      *                                                                                       CSD015
     C                     MOVELTRNO      W4IDEN                                              CSD015
     C                     MOVELMTPY      W4ITEM                                              CSD015
     C                     MOVELMGBRCA    W4BRCH                                              CSD015
     C                     MOVEL'MGOREF'  W4FUNT                                              CSD015
     C                     MOVELDECN      W4CNUM                                              CSD015
     C                     Z-ADDBJRDNB    W4DDAT                                              CSD015
     C                     MOVELPARLS     W4ARLS                                              CSD015
      *                                                                                       CSD015
      ***Send*the*Transaction Details to the Compliance Engine.                        CSD015 221145
      *********************                                                            CSD015 221145
     C*********************CALL 'SDWLCLOP'                                             CSD015 221145
     C*********************PARM           WLTDS                                        CSD015 221145
     C*********************PARM *BLANKS   PSTRNG                                       CSD015 221145
      *                                                                                       CSD015
     C           EWATCH    ENDSR                                                              CSD015
      *****************************************************************                       CSW213
      *   SRFMTO - Format message detail - Sequence O                 *                       CSW213
      *   Called by : Main process                                    *                       CSW213
      *   Calls :                                                     *                       CSW213
      *****************************************************************                       CSW213
      *                                                                                       CSW213
     C           SRFMTO    BEGSR                                                              CSW213
      *                                                                                       CSW213
      **  Field :15O: New Sequence                                                            CSW213
      *                                                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
      *                                                                                       CSW215
      ** SWIFT 2015 Change: Re-label sequences H-O to I-P for MT361                           CSW215
      *                                                                                       CSW215
     C           *IN52     IFEQ '1'                                                           CSW215
     C           CSW215    ANDEQ'Y'                                                           CSW215
     C                     MOVEL':15P:'   MTAG                                                CSW215
     C                     ELSE                                                               CSW215
     C                     MOVE ':15O:'   MTAG                                                CSW213
     C                     ENDIF                                                              CSW215
      *                                                                                       CSW215
     C                     MOVEL*BLANK    MFLD                                                CSW213
     C                     Z-ADDX         X15E    20                                        MD022981
      *                                                                                       CSW213
      **  Clear multiple occurrence DS for the RPPT                                           CSW213
      *                                                                                       CSW213
     C                     Z-ADD1         Y1      10                                          CSW213
     C           Y1        OCUR RPPT                                                          CSW213
     C           Y1        DOWLE4                                                             CSW213
      *                                                                                       CSW213
     C                     CLEARRPPT                                                          CSW213
     C                     ADD  1         Y1                                                  CSW213
     C           Y1        OCUR RPPT                                                          CSW213
     C                     ENDDO                                                              CSW213
     C                     Z-ADD0         Y1                                                  CSW213
      *                                                                                       CSW213
      **  Initialize multioccurence DS RPPT with the 4 set of fields                          CSW213
      *                                                                                       CSW213
     C                     Z-ADD1         Y1      10                                          CSW213
     C           Y1        OCUR RPPT                                                          CSW213
     C           Y1        DOWLE4                                                             CSW213
     C           Y1        IFEQ 1                                                             CSW213
     C                     MOVE MGRJ01    MGRJXX                                              CSW213
     C                     MOVE MGRP01    MGRPXX                                              CSW213
     C                     MOVE MGRN01    MGRNXX                                              CSW213
     C                     MOVE MGRC01    MGRCXX                                              CSW213
     C                     MOVE MGRS01    MGRSXX                                              CSW213
     C                     MOVE MGRL01    MGRLXX                                              CSW213
     C                     MOVE MGRA01    MGRAXX                                              CSW213
     C                     MOVE MGUT01    MGUTXX                                              CSW213
     C                     MOVE MGTN01    MGTNXX                                              CSW213
     C                     MOVE MGTI01    MGTIXX                                              CSW213
     C                     MOVE MGET01    MGETXX                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
     C           Y1        IFEQ 2                                                             CSW213
     C                     MOVE MGRJ02    MGRJXX                                              CSW213
     C                     MOVE MGRP02    MGRPXX                                              CSW213
     C                     MOVE MGRN02    MGRNXX                                              CSW213
     C                     MOVE MGRC02    MGRCXX                                              CSW213
     C                     MOVE MGRS02    MGRSXX                                              CSW213
     C                     MOVE MGRL02    MGRLXX                                              CSW213
     C                     MOVE MGRA02    MGRAXX                                              CSW213
     C                     MOVE MGUT02    MGUTXX                                              CSW213
     C                     MOVE MGTN02    MGTNXX                                              CSW213
     C                     MOVE MGTI02    MGTIXX                                              CSW213
     C                     MOVE MGET02    MGETXX                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
     C           Y1        IFEQ 3                                                             CSW213
     C                     MOVE MGRJ03    MGRJXX                                              CSW213
     C                     MOVE MGRP03    MGRPXX                                              CSW213
     C                     MOVE MGRN03    MGRNXX                                              CSW213
     C                     MOVE MGRC03    MGRCXX                                              CSW213
     C                     MOVE MGRS03    MGRSXX                                              CSW213
     C                     MOVE MGRL03    MGRLXX                                              CSW213
     C                     MOVE MGRA03    MGRAXX                                              CSW213
     C                     MOVE MGUT03    MGUTXX                                              CSW213
     C                     MOVE MGTN03    MGTNXX                                              CSW213
     C                     MOVE MGTI03    MGTIXX                                              CSW213
     C                     MOVE MGET03    MGETXX                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
     C           Y1        IFEQ 4                                                             CSW213
     C                     MOVE MGRJ04    MGRJXX                                              CSW213
     C                     MOVE MGRP04    MGRPXX                                              CSW213
     C                     MOVE MGRN04    MGRNXX                                              CSW213
     C                     MOVE MGRC04    MGRCXX                                              CSW213
     C                     MOVE MGRS04    MGRSXX                                              CSW213
     C                     MOVE MGRL04    MGRLXX                                              CSW213
     C                     MOVE MGRA04    MGRAXX                                              CSW213
     C                     MOVE MGUT04    MGUTXX                                              CSW213
     C                     MOVE MGTN04    MGTNXX                                              CSW213
     C                     MOVE MGTI04    MGTIXX                                              CSW213
     C                     MOVE MGET04    MGETXX                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
     C                     ADD  1         Y1                                                  CSW213
     C           Y1        OCUR RPPT                                                          CSW213
     C                     ENDDO                                                              CSW213
     C                     Z-ADD0         Y1                                                  CSW213
      *                                                                                       CSW213
     C                     EXSR SRRPPT                                                      MD023007
      *                                                                                     MD023007
     C                     Z-ADD0         WRKIX   10                                          CSW213
     C                     MOVEL'N'       WRKFLG  1                                           CSW213
      *                                                                                       CSW213
      **  Do Loop for 4 times                                                                 CSW213
      *                                                                                       CSW213
     C           WRKIX     DOWLT4                                                             CSW213
     C                     ADD  1         WRKIX                                               CSW213
     C********** WRKIX     OCUR RPPT                                                 CSW213 MD023007
     C           IX,WRKIX  OCUR RPPT                                                        MD023007
      *                                                                                       CSW213
      **  Reporting Jurisdiction                                                              CSW213
      *                                                                                       CSW213
     C           MGRJXX    IFEQ *BLANKS                                                       CSW213
     C                     ADD  5         WRKIX                                               CSW213
     C                     ELSE                                                               CSW213
     C********** MGRJXX    IFNE *BLANKS                                             CSW213 MD022633A
     C********** MGRPXX    ANDNE*BLANKS                                             CSW213 MD022633A
     C********** MGRNXX    ANDNE*BLANKS                                             CSW213 MD022633A
     C********** MGRCXX    ANDNE*BLANKS                                             CSW213 MD022633A
     C********** MGRSXX    ANDNE*BLANKS                                             CSW213 MD022633A
     C********** MGRLXX    ANDNE*BLANKS                                             CSW213 MD022633A
     C********** MGRAXX    ANDNE*BLANKS                                             CSW213 MD022633A
     C           MGRJXX    IFNE WRKMRJ                                                      MD022633
     C           MGRPXX    ORNE WRKMRP                                                      MD022633
     C           MGRNXX    ORNE WRKMRN                                                     MD022633A
     C           MGRCXX    ORNE WRKMRC                                                     MD022633A
     C           MGRSXX    ORNE WRKMRS                                                     MD022633A
     C           MGRLXX    ORNE WRKMRL                                                     MD022633A
     C           MGRAXX    ORNE WRKMRA                                                     MD022633A
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':22L:'   MTAG                                                CSW213
     C                     MOVELMGRJXX    MFLD                                                CSW213
     C                     MOVEL'N'       WRKFLG                                              CSW213
     C**********           ENDIF                                                     CSW213 MD022633
      *                                                                                       CSW213
      **  Reporting Party                                                                     CSW213
      *                                                                                       CSW213
     C           MGRPXX    IFNE *BLANKS                                                       CSW213
     C                     MOVELMGRPXX    WRKMRP  6                                         MD022633
     C                     MOVELMGRJXX    WRKMRJ 35                                         MD022633
     C                     MOVELMGRNXX    WRKMRN 20                                        MD022633A
     C                     MOVELMGRCXX    WRKMRC 10                                        MD022633A
     C                     MOVELMGRSXX    WRKMRS 11                                        MD022633A
     C                     MOVELMGRLXX    WRKMRL 20                                        MD022633A
     C                     MOVELMGRAXX    WRKMRA 34                                        MD022633A
     C                     MOVE *BLANKS   ZDEST                                               CSW213
     C                     MOVELMGRPXX    ZDEST                                               CSW213
     C                     MOVELMGRAXX    ACLINE                                              CSW213
     C                     MOVEL'91'      FLDNO                                               CSW213
     C                     MOVE *BLANKS   TAG                                                 CSW213
     C                     EXSR SRFMPY                                                        CSW213
     C                     ELSE                                                               CSW213
     C                     MOVELMGRPXX    WRKMRP                                           MD022633A
     C                     MOVELMGRJXX    WRKMRJ                                           MD022633A
     C                     MOVELMGRNXX    WRKMRN                                           MD022633A
     C                     MOVELMGRCXX    WRKMRC                                           MD022633A
     C                     MOVELMGRSXX    WRKMRS                                           MD022633A
     C                     MOVELMGRLXX    WRKMRL                                           MD022633A
     C                     MOVELMGRAXX    WRKMRA                                           MD022633A
     C           MGRLXX    IFEQ *BLANKS                                                       CSW213
     C           MGRNXX    ANDEQ*BLANKS                                                       CSW213
     C           MGRSXX    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':91A:'   MTAG                                                CSW213
     C                     MOVEL*BLANKS   MFLD                                                CSW213
     C                     MOVELMGRSXX    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     ELSE                                                               CSW213
     C           MGRNXX    IFNE *BLANKS                                                       CSW213
     C           MGRSXX    ANDNE*BLANKS                                                       CSW213
     C           MGRNXX    ORNE *BLANKS                                                       CSW213
     C           MGRLXX    ANDNE*BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':91J:'   MTAG                                                CSW213
     C           MGRSXX    IFNE *BLANKS                                                       CSW213
     C           '/ABIC/'  CAT  MGRSXX    MFLD                                                CSW213
     C                     ELSE                                                               CSW213
     C           '/ABIC'   CAT  '/UKWN'   MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           MGRLXX    IFNE *BLANKS                                                       CSW213
     C           '/LEIC/'  CAT  MGRLXX    MFLD                                                CSW213
     C                     ELSE                                                               CSW213
     C           '/NAME/'  CAT  MGRNXX    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGRCXX    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           '/NAME/'  CAT  MGRCXX    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     ELSE                                                               CSW213
     C           MGRNXX    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':91D:'   MTAG                                                CSW213
     C                     MOVELMGRNXX    MFLD                                                CSW213
     C           MGRCXX    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVELMGRCXX    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                            MD022633
     C**********           ENDIF                                                  MD022633 MD022633A
      *                                                                                       CSW213
      **  Unique Transaction Identifier/Prior Unique Transaction Identifier                   CSW213
      *                                                                                       CSW213
     C           MGUTXX    IFNE *BLANKS                                                       CSW213
     C           MGTNXX    ANDNE*BLANKS                                                       CSW213
     C           MGTIXX    IFEQ '0'                                                           CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':22M:'   MTAG                                                CSW213
     C                     MOVELMGUTXX    MFLD                                                CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':22N:'   MTAG                                                CSW213
     C                     MOVELMGTNXX    MFLD                                                CSW213
     C                     MOVEL'Y'       WRKFLG                                              CSW213
     C                     ELSE                                                               CSW213
     C           WRKFLG    IFEQ 'Y'                                                           CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':22P:'   MTAG                                                CSW213
     C                     MOVELMGUTXX    MFLD                                                CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':22R:'   MTAG                                                CSW213
     C                     MOVELMGTNXX    MFLD                                                CSW213
     C                     ELSE                                                               CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':22M:'   MTAG                                                CSW213
     C                     MOVELMGUTXX    MFLD                                                CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':22N:'   MTAG                                                CSW213
     C                     MOVELMGTNXX    MFLD                                                CSW213
     C                     MOVEL'Y'       WRKFLG                                              CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
     C                     ENDDO                                                              CSW213
      *                                                                                       CSW213
      **  Clearing Exception Party                                                            CSW213
      *                                                                                       CSW213
     C           MGCEPI    IFNE *BLANKS                                                       CSW213
     C                     MOVE *BLANKS   ZDEST                                               CSW213
     C                     MOVELMGCEPI    ZDEST                                               CSW213
     C                     MOVELMGCEPA    ACLINE                                              CSW213
     C                     MOVEL'96'      FLDNO                                               CSW213
     C                     MOVE *BLANKS   TAG                                                 CSW213
     C                     EXSR SRFMPY                                                        CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      **  Clearing Broker Identification                                                      CSW213
      *                                                                                       CSW213
     C           MGCBCI    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':22S:'   MTAG                                                CSW213
     C           'C/'      CAT  MGCBCI    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGCBPI    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':22S:'   MTAG                                                CSW213
     C           'P/'      CAT  MGCBPI    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      **  Cleared Product Identification                                                      CSW213
      *                                                                                       CSW213
     C           MGPRID    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':22T:'   MTAG                                                CSW213
     C                     MOVELMGPRID    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      **  Clearing Threshold Indicator                                                        CSW213
      *                                                                                       CSW213
     C           MGCGTI    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':17E:'   MTAG                                                CSW213
     C                     MOVELMGCGTI    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      **  Underlying Product Identifier                                                       CSW213
      *                                                                                       CSW213
     C           MGUPID    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':22U:'   MTAG                                                CSW213
     C                     MOVELMGUPID    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      **  Allocation Indicator                                                                CSW213
      *                                                                                       CSW213
     C           MGALLI    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':17H:'   MTAG                                                CSW213
     C                     MOVELMGALLI    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      **  Collateralisation Indicator                                                         CSW213
      *                                                                                       CSW213
     C           MGCLLI    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':17P:'   MTAG                                                CSW213
     C                     MOVELMGCLLI    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      **  Execution Venue                                                                     CSW213
      *                                                                                       CSW213
     C           MGEXVE    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':22V:'   MTAG                                                CSW213
     C                     MOVELMGEXVE    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      **  Execution Timestamp                                                                 CSW213
      *                                                                                       CSW213
     C********** MGUTCT    IFNE *ZEROS                                               CSW213 MD023798
     C********** MGGEDT    ORNE *ZEROS                                             MD022981 MD023798
     C********** MGGETM    ORNE *ZEROS                                             MD022981 MD023798
     C           MGGEDT    IFNE *ZEROS                                                      MD023798
     C           MGGETM    ANDNE*ZEROS                                                      MD023798
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':98D:'   MTAG                                                CSW213
     C                     MOVE MGGEDT    DNGEDT  8                                           CSW213
     C                     MOVE MGGETM    DNGETM  6                                           CSW213
     C                     MOVE MGUTCT    DNUTCT  4                                           CSW213
     C           MGUSGN    IFEQ 'N'                                                           CSW213
     C           DNGEDT    CAT  DNGETM    ETIME1 14                                           CSW213
     C           '/N'      CAT  DNUTCT    ETIME2  6                                           CSW213
     C           ETIME1    CAT  ETIME2    MFLD                                                CSW213
     C                     ELSE                                                               CSW213
     C           DNGEDT    CAT  DNGETM    ETIME1 14                                           CSW213
     C********** ETIME1    CAT  DNUTCT    MFLD                                       CSW213 MD023798
      *                                                                                     MD023798
     C           DNUTCT    IFNE *ZEROS                                                      MD023798
     C           '/'       CAT  DNUTCT    ETIME3  5                                         MD023798
     C           ETIME1    CAT  ETIME3    MFLD                                              MD023798
     C                     ELSE                                                             MD023798
     C                     MOVELETIME1    MFLD                                              MD023798
     C                     ENDIF                                                            MD023798
      *                                                                                     MD023798
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      **  Non Standard Flag                                                                   CSW213
      *                                                                                       CSW213
     C           MGNORS    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL':17W:'   MTAG                                                CSW213
     C                     MOVELMGNORS    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW214
      ** If SWIFT 2014 is installed                                                           CSW214
      *                                                                                       CSW214
     C           CSW214    IFEQ 'Y'                                                           CSW214
      *                                                                                       CSW214
      ** Financial Nature of the Counterparty Indicator                                       CSW214
      *                                                                                       CSW214
     C           MGFNCI    IFNE *BLANKS                                                       CSW214
     C                     ADD  1         X                                                   CSW214
     C           X         OCUR MULT                                                          CSW214
     C                     MOVEL':17Y:'   MTAG                                                CSW214
     C                     MOVELMGFNCI    MFLD                                                CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                       CSW214
      ** Collateral Portfolio Indicator                                                       CSW214
      *                                                                                       CSW214
     C           MGCOPI    IFNE *BLANKS                                                       CSW214
     C                     ADD  1         X                                                   CSW214
     C           X         OCUR MULT                                                          CSW214
     C                     MOVEL':17Z:'   MTAG                                                CSW214
     C                     MOVELMGCOPI    MFLD                                                CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                       CSW214
      ** Collateral Portfolio Code                                                            CSW214
      *                                                                                       CSW214
     C           MGCOPI    IFEQ 'Y'                                                           CSW214
     C           MGCOPC    ANDNE*BLANKS                                                       CSW214
     C                     ADD  1         X                                                   CSW214
     C           X         OCUR MULT                                                          CSW214
     C                     MOVEL':22Q:'   MTAG                                                CSW214
     C                     MOVELMGCOPC    MFLD                                                CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                       CSW214
      ** Portfolio Compression Indicator                                                      CSW214
      *                                                                                       CSW214
     C           MGPOCI    IFNE *BLANKS                                                       CSW214
     C                     ADD  1         X                                                   CSW214
     C           X         OCUR MULT                                                          CSW214
     C                     MOVEL':17L:'   MTAG                                                CSW214
     C                     MOVELMGPOCI    MFLD                                                CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                       CSW214
      ** Corporate Sector Indicator                                                           CSW214
      *                                                                                       CSW214
     C           MGCOSI    IFNE *BLANKS                                                       CSW214
     C                     ADD  1         X                                                   CSW214
     C           X         OCUR MULT                                                          CSW214
     C                     MOVEL':17M:'   MTAG                                                CSW214
     C                     MOVELMGCOSI    MFLD                                                CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                       CSW214
      ** Trade with Non-EEA Counterparty Indicator                                            CSW214
      *                                                                                       CSW214
     C           MGTNEI    IFNE *BLANKS                                                       CSW214
     C                     ADD  1         X                                                   CSW214
     C           X         OCUR MULT                                                          CSW214
     C                     MOVEL':17Q:'   MTAG                                                CSW214
     C                     MOVELMGTNEI    MFLD                                                CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                       CSW214
      ** Intragroup Trade Indicator                                                           CSW214
      *                                                                                       CSW214
     C           MGIGTI    IFNE *BLANKS                                                       CSW214
     C                     ADD  1         X                                                   CSW214
     C           X         OCUR MULT                                                          CSW214
     C                     MOVEL':17S:'   MTAG                                                CSW214
     C                     MOVELMGIGTI    MFLD                                                CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                       CSW214
      ** Commercial or Treasury Financial Indicator                                           CSW214
      *                                                                                       CSW214
     C           MGCTFI    IFNE *BLANKS                                                       CSW214
     C                     ADD  1         X                                                   CSW214
     C           X         OCUR MULT                                                          CSW214
     C                     MOVEL':17X:'   MTAG                                                CSW214
     C                     MOVELMGCTFI    MFLD                                                CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                       CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                       CSW213
      **  Additional Reporting Information                                                    CSW213
      *                                                                                       CSW213
     C           MGAR01    IFNE *BLANKS                                                       CSW213
     C           MGAR02    ORNE *BLANK                                                        CSW213
     C           MGAR03    ORNE *BLANK                                                        CSW213
     C           MGAR04    ORNE *BLANK                                                        CSW213
     C           MGAR05    ORNE *BLANK                                                        CSW213
     C           MGAR06    ORNE *BLANK                                                        CSW213
     C           MGAR07    ORNE *BLANK                                                        CSW213
     C           MGAR08    ORNE *BLANK                                                        CSW213
     C           MGAR09    ORNE *BLANK                                                        CSW213
     C           MGAR10    ORNE *BLANK                                                        CSW213
     C           MGAR11    ORNE *BLANK                                                        CSW213
     C           MGAR12    ORNE *BLANK                                                        CSW213
     C           MGAR13    ORNE *BLANK                                                        CSW213
     C           MGAR14    ORNE *BLANK                                                        CSW213
     C           MGAR15    ORNE *BLANK                                                        CSW213
     C           MGAR16    ORNE *BLANK                                                        CSW213
     C           MGAR17    ORNE *BLANK                                                        CSW213
     C           MGAR18    ORNE *BLANK                                                        CSW213
     C           MGAR19    ORNE *BLANK                                                        CSW213
     C           MGAR20    ORNE *BLANK                                                        CSW213
      *                                                                                       CSW213
     C                     MOVE *BLANK    DN77    1                                           CSW213
     C           MGAR01    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR01    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR02    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR02    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR03    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR03    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR04    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR04    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR05    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR05    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR06    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR06    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR07    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR07    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR08    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR08    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR09    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR09    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR10    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR10    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR11    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR11    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR12    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR12    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR13    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR13    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR14    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR14    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR15    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR15    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR16    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR16    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR17    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR17    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR18    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR18    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR19    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR19    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           MGAR20    IFNE *BLANK                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           DN77      IFNE 'Y'                                                           CSW213
     C                     MOVE ':77A:'   MTAG                                                CSW213
     C                     MOVE 'Y'       DN77                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     MOVE *BLANK    MFLD                                                CSW213
     C                     MOVELMGAR20    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                     MD022981
     C           X         IFEQ X15E                                                        MD022981
     C                     MOVE *BLANKS   MTAG                                              MD022981
     C                     SUB  1         X                                                 MD022981
     C                     ENDIF                                                            MD022981
      *                                                                                       CSW213
     C                     ENDSR                                                              CSW213
     C/EJECT                                                                                  CSW213
      *****************************************************************                       CSW213
      *   SRFMPY - Format message - Cust. Extension SWIFT Details     *                       CSW213
      *   Called by: SRFMTO                                           *                       CSW213
      *   Calls: None                                                 *                       CSW213
      *****************************************************************                       CSW213
      *                                                                                       CSW213
     C           SRFMPY    BEGSR                                                              CSW213
      *                                                                                       CSW213
     C           ACLINE    IFNE *BLANKS                                                       CSW213
     C           1         SUBSTACLINE:1  ACTEMP  1                                           CSW213
     C           ACTEMP    IFNE '/'                                                           CSW213
     C           '/'       CAT  ACLINE    ACLINE                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
     C                     MOVE *BLANKS   ZDEST                                               CSW213
     C                     MOVELMGCNUM    ZDEST                                               CSW213
      *                                                                                       CSW213
     C                     CALL 'AOCSSWR0'                                                    CSW213
     C                     PARM '*MSG   ' @RTCD   7                                           CSW213
     C                     PARM '*KEY   ' @OPTN   7                                           CSW213
     C                     PARM ZDEST     @KEY1  10                                           CSW213
     C                     PARM *BLANKS   @KYST   7                                           CSW213
     C                     PARM           DSLDY                                               CSW213
      *                                                                                       CSW213
      ** Extract SDCUSTPD and SDCSSWPD                                                     MD022633A
      *                                                                                    MD022633A
     C                     MOVEL'SDCUSTPD'P#FILN                                           MD022633A
     C                     EXSR GETRCL                                                     MD022633A
     C           P#RCDL    SUBSTDSLDY     SDCUST                                           MD022633A
     C           P#RCDL    ADD  1         WLEN    50                                       MD022633A
      *                                                                                    MD022633A
     C                     MOVEL'SDCSSWPD'P#FILN                                           MD022633A
     C                     EXSR GETRCL                                                     MD022633A
     C           P#RCDL    SUBSTDSLDY:WLENSDCSSW                                           MD022633A
      *                                                                                    MD022633A
     C           BBCSID    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL'A'       TAG                                                 CSW213
     C                     MOVEL@MTAG     MTAG                                                CSW213
     C           ACLINE    IFNE *BLANKS                                                       CSW213
     C                     MOVELACLINE    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVELBBCSID    MFLD                                                CSW213
     C                     ELSE                                                               CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C                     MOVEL'J'       TAG                                                 CSW213
     C                     MOVEL@MTAG     MTAG                                                CSW213
     C           '/ABIC'   CAT  '/UKWN'   ABIUKW 10                                           CSW213
     C                     MOVELABIUKW    MFLD                                                CSW213
     C           CSCLID    IFNE *BLANKS                                                       CSW213
     C           CSCLSY    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           '/CLRC/'  CAT  CSCLSY    CLRTMP 10                                           CSW213
     C           CLRTMP    CAT  CSCLID    MFLD                                                CSW213
     C                     ELSE                                                               CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           '/CLRC/'  CAT  CSCLID    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     ELSE                                                               CSW213
     C           BBCHID    IFNE *ZEROS                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           '/CLRC'   CAT  '/CH'     CLRCH   8                                           CSW213
     C                     MOVE BBCHID    DNCHID  6                                           CSW213
     C           CLRCH     CAT  DNCHID    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           BBCHSC    IFNE *ZEROS                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           '/CLRC'   CAT  '/SC'     CLRSC   8                                           CSW213
     C                     MOVE BBCHSC    DNCHSC  6                                           CSW213
     C           CLRSC     CAT  DNCHSC    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           BBCABA    IFNE *ZEROS                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           '/CLRC'   CAT  '/CP'     CLRCP   8                                           CSW213
     C                     MOVE BBCABA    DNCABA  3                                           CSW213
     C           CLRCP     CAT  DNCABA    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           BBBFIC    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           '/CLRC'   CAT  '/BJ'     CLRBJ   8                                           CSW213
     C           CLRBJ     CAT  BBBFIC    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           BBBLCD    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           '/CLRC'   CAT  '/BL'     CLRBL   8                                           CSW213
     C           CLRBL     CAT  BBBLCD    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C           BBFWCD    IFNE *ZEROS                                                        CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           '/CLRC'   CAT  '/FW'     CLRFW   8                                           CSW213
     C                     MOVE BBFWCD    DNFWCD  9                                           CSW213
     C           CLRFW     CAT  DNFWCD    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
     C           CSLEIC    IFNE *BLANKS                                                       CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C********** '/LEIC/'  CAT  MGRLXX    MFLD                                       CSW213 MD031114
     C           '/LEIC/'  CAT  CSLEIC    MFLD                                              MD031114
     C                     ENDIF                                                              CSW213
     C                     ADD  1         X                                                   CSW213
     C           X         OCUR MULT                                                          CSW213
     C           '/NAME/'  CAT  BBCNA1    MFLD                                                CSW213
     C                     ENDIF                                                              CSW213
     C                     ELSE                                                               CSW213
     C                     ADD  1         X                                                 MD023009
     C           X         OCUR MULT                                                        MD023009
     C                     EXSR FSWAD                                                         CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDSR                                                              CSW213
     C/EJECT                                                                                  CSW213
      *****************************************************************
      *                                                               *                       221145
      *  WLCDQ - Submit information to Watch List Check Dtaq          *                       221145
      *                                                               *                       221145
      *****************************************************************                       221145
      *                                                                                       221145
     C           WLCDQ     BEGSR                                                              221145
      *                                                                                       221145
      *  Send transaction to compliance engine program                                        221145
      *                                                                                       221145
     C                     CALL 'SDWLCLOP'                                                    221145
     C                     PARM           WLTDS                                               221145
     C                     PARM *BLANKS   PSTRNG                                              221145
      *                                                                                       221145
      *                                                                                       221145
     C                     ENDSR                                                              221145
      *                                                                                       221145
     C/EJECT                                                                                  221145
      *****************************************************************                       221145
      *   *PSSR - error handling                                      *
      *****************************************************************
      *
     C           *PSSR     BEGSR
      *
      **  Write database error to report
      *
     C                     OPEN MG036NAU
     C                     WRITEHEAD
     C                     WRITEDBERROR
      *
     C                     MOVE *ON       *INU7
     C                     MOVE *ON       *INU8
     C                     MOVE *ON       *INLR
     C                     DUMP
     C                     RETRN
      *
     C                     ENDSR
      /EJECT
      /COPY MGCPYSRC,SWIFTTRANS
** CPY@   Object Copyright
(c) Misys International Banking Systems Ltd. 2001
** MSGA   Messages
Settlement - pay
Customer details not found on SDCUSTPD
Nostro customer not found on SDNOSTPD
Broker code not found on SDBROKPD
ZM0040 (format ccy and amount) call ended in error
ZM0050 (format SWIFT address) call ended in error
Codeword was not found for this message
Duplicate TRN key built for this message
Field formatting error (field is blank)
** @ATAG - Tag fields with blank fields
:15A:
:15B:
:15C:
:15D:
:15E:
:15F:
:15G:
:15H:
:15I:
:15J:
:15K:
:15L:
:15M:
:15N:
:15O:
:15P:                                                                                         CSW215
** TABNST - Codes indicating settlement via nostro
01
02
07
08
12
** TABINT - Codes indicating settlement via internal
03
04
05
06
14
**   @CMSG  - CALCULATION METHOD TEXT
Interest Calculation Method
Actual/365 ignoring 29th of Feb
Actual/360 ignoring 29th of Feb
Compounding Frequency
See Payment Schedule
See Rate Change Schedule
Designated Maturity Details
Business Day Convention                                                   CIR005
No Adjustment                                                             CIR005
Modified Preceding                                                        CIR005
Actual/365, 366 for Feb 29 period                                         CIR013
**   @IDBR1 - ISDA Definition of Base Rate (ISDA)
FRF-TAM-CDC
FRF-T4M-CDC
FRF-T4M-CDCCOMP
FRF-TAG-CDC
FRF-TAG-CDCCOMP
FRF-TMP-CDCAVERAG
**   @IDBR2 - AFB
FRF-SWAP-AMR
FRF-SWAP-TMP-IF
FRF-SWAP-TMP-M
FRF-SWAP-T4M-AMR
FRF-CAP-TAM
FRF-CAP-T4M
FRF-FLOOR-TAM
FRF-FLOOR-T4M
