     H********1**                                                         140440
     H        1                           F
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas MG Format MT515 and MT518 messages')             *
      *****************************************************************
      *                                                               *
      *  Midas - Message Generation Module                            *
      *                                                               *
      *  MG051N - MG Format MT515 and MT518 Messages                  *
      *                                                               *
      *  Function:  This program will generate MT515 and MT518        *
      *  (IC)       messages from the extract file (MGF51NPD)         *
      *             and output them to MGOMSGPD and MGOREFPD          *
      *                                                               *
      *  Called By: SEC0304 - Input Cycle Confirmation Print          *
      *                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. 261402             Date 11May16               *
      *  Prev Amend No. CSW214             Date 25Nov14               *
      *                 CFT050             Date 03Jun13               *
      *                 MD019844           Date 05Apr13               *
      *                 AR589164           Date 13Aug10               *
      *                 AR581757           Date 26Jul10               *
      *                 CSW210             Date 04May10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 BUG25073           Date 21Jul09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 BUG21097           Date 18Sep08               *
      *                 BUG20950           Date 10Sep08               *
      *                 BUG20437           Date 10Sep08               *
      *                 BUG19907           Date 10Jul08               *
      *                 BUG19304           Date 18Jun08               *
      *                 CSW208             Date 15Apr08               *
      *                 BUG18526A          Date 12May08               *
      *                 BUG18526           Date 02May08               *
      *                 248680             Date 28Jul07               *
      *                 CSW207             Date 07Jul07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      *                 234140             Date 26Sep06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 BUG2381            Date 13May04               *
      *                 CGL029             Date 01Sep03               *
      *                 222385             Date 23Oct03               *
      *                 221145             Date 08Sep03               *
      *                 219242             Date 01Jul03               *
      *                 219241             Date 01Jul03               *
      *                 CSW203             Date 26May03               *
      *                 CSD015             Date 14Oct02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 202330             Date 15Apr02               *
      * Midas Release 4.01.01 ----------------------------------------*
      *                 208890             Date 22Aug02               *
      *                 CSW202             Date 20May02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CSW025             Date 26Mar02               *
      *                 196628             Date 10Sep01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CSW201             Date 02May01               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CSE023             Date 20Sep00               *
      *                 CDL008             Date 02May00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CSW200             Date 21Aug00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CSE006             Date 07Sep99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 140966             Date 19Aug98               *
      *                 140440             Date 05Aug98               *
      *                 CSW014             Date 19Jun98               *
      *                 CSW098  *CREATE    Date 16Apr98               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  261402 - If location code of the branch is blank, flag as    *
      *           not MiFID compliant.                                *
      *         - Applied for MD-37893.                               *
      *  CSW214 - SWIFT Changes 2014                                  *
      *  CFT050 - SWIFTRef Directories upload (Recompile)             *
      *  MD019844 - Generate field :17B::ACRU// only for :19A::SETT// *
      *  AR589164 - Additional fix to cater //XX input                *
      *  AR581757 - One MT518 is not generated for a repo transaction *
      *  CSW210 - Swift 2010 Changes                                  *
      *  BUG25073 - MSC0501 00001 failed in COB                       *
      *  BUG21097 - Missing field 22F INFI in MT518.                  *
      *             Applied BUG18526A.                                *
      *  BUG20950 - MT518 should not have 22F INFI if destination     *
      *             customer is not MFID compliant                    *
      *  BUG20437 - MT515 field 98E value is incorrect                *
      *  BUG19907 - For Pledge loan on start date 22F should be COLI  *
      *             and on maturity date it should be COLO.           *
      *             Reverse would be for Pledge deposit.              *
      *  BUG19304 - GMT not reflected in 98E tag                      *
      *  CSW208 - SWIFT 2008 Changes                                  *
      *  BUG18526A- MT518 field tag 22F is missing. Change the access *
      *             object being called.                              *
      *  BUG18526 - MT518 field tag 22F is missing. Applied BUG14851  *
      *             fix                                               *
      *  248680 - For MGDYBS and MGDVBS combinations that are not     *
      *           found in the table, value should be 'OTHR' for MICO.*
      *  CSW207 - SWIFT 2007 Changes                                  *
      *  234140 - EU witholding tax                                   *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222385 - SWIFT msgs are Watch List checked regardless of     *
      *           configuration file setting                          *
      *  221145 - Compliance Watch WLC: Move compliance check to      *
      *           after COMIT to MGOMSGPD                             *
      *  219242 - Not possible to create MT103+ payment msg from      *
      *           non-FT transaction (Recompile)                      *
      *  219241 - Defaulting of "Details of Charges" assign a         *
      *           system value (Recompile)                            *
      *  CSW203 - SWIFT 2003 Standards Update                         *
      *  CSD015 - Midas Compliance Watch - Watch List Checking        *
      *  202330 - Extend 196628 to cover CINDV.                       *
      *  208890 - Various Core Fixes in SWIFT                         *
      *  CSW202 - SWIFT 2002 Standards Update                         *
      *  CSW025 - Midas Message Manager                               *
      *           - Pass original change type                         *
      *  196628 - Assigned value to Century Indicator to correct Y2K  *
      *           problem.                                            *
      *  CSW201 - SWIFT 2001 Standards Update                         *
      *  CSE023 - Treaty Withholding Tax                              *
      *  CDL008 - Continuous Linked Settlement (Recompiled)           *
      *  CSW200 - SWIFT 2000 Changes                                  *
      *  CSE006 - Repurchase Agreements (REPOs) enhancement           *
      *  140966 - SWIFT98 fix                                         *
      *           Negative sign on amounts should be represented      *
      *           by a 'N' rather than '-'.                           *
      *  140440 - SWIFT98 fix                                         *
      *           Include translation table SWIFTRANS                 *
      *  CSW014 - ERI Information for non-EMU users.                  *
      *         - Output Original Currency and Amount                 *
      *  CSW098 - SWIFT 1998 Changes                                  *
      *                                                               *
      *****************************************************************
     FMGF51NPDUF  E           K        DISK         KINFSR *PSSR
     FSDMTAGL0IF  E           K        DISK         KINFSR *PSSR
     FSECRTNL1IF  E           K        DISK         KINFSR *PSSR
     FTRADS   IF  E           K        DISK         KINFSR *PSSR                              CSW201
     FTRADSDY1IF  E           K        DISK         KINFSR *PSSR                              CSW203
     FTRADSDY2IF  E           K        DISK         KINFSR *PSSR                              CSW203
     FSEMKC   IF  E           K        DISK         KINFSR *PSSR                              CSW203
     FMGOREFPDO   E                    DISK         KINFSR *PSSR
     F                                              KCOMIT
     FMGOMSGPDO   E                    DISK         KINFSR *PSSR
     F                                              KCOMIT
     FMEISOCL1IF  E           K        DISK         KINFSR *PSSR                              CSW207
     FDPTMVDL1IF  E           K        DISK         KINFSR *PSSR                              CSW208
     FMG051NA1O   E                    PRINTER      KINFDS OVRFL1
     F                                              KINFSR *PSSR
     FMG051NA2O   E                    PRINTER      KINFDS OVRFL2     UC
     F                                              KINFSR *PSSR
     FMG051NAUO   E                    PRINTER                        UC
     F/COPY WNCPYSRC,MG051NF001
      *****************************************************************
      /TITLE FUNCTION OF INCICATORS
      *****************************************************************
      *                                                               *
      *  F U N C T I O N   O F   I N D I C A T O R S                  *
      *                                                               *
      *    21  - MG5900 not found                                     *
      *    22  - MG5910 not found                                     *
      *    23  - ZM1100 not found                                     *
      *    24  - ZM1190 not found                                     *
      *    25  - ZM1240 not found                                     *
      *    26  - ZM1150 not found                                     *
      *    27  - ZM1140 not found                                     *
      *    28  - ZM1050 not found                                     *
      *    29  - MT0579 not found                                     *
      *                                                               *
      *    50  - End of MGF51NPD                                      *
      *    51  - End of SDMTAGL0                                      *
      *    52  - Charge/Commission Code found in array CCS            *
      *    53  - Message Type found in array @ST                      *
      *    54  - End of SECRTNLN1                                     *
      *    55  - Record not found in TRADS                            *                       CSW201
      *    56  - Record not found in MEISOCL1                         *                       CSW207
      *    58  - Record not found in DPTMVDL1                         *                       CSW208
      *                                                               *
      *    60  - PRTF/MG051NA2 has been opened                        *
      *    61  - Error in write to PF/MGOMSGPD                        *
      *    62  - Error in write to PF/MGOREFPD                        *
      *                                                               *
      *    98  - Date Format: DDMMYY (off); MMDDYY (on)               *
      *  90-99 - Used by Standard Subroutines                         *
      *                                                               *
      *  U7+U8 - Database Error                                       *
      *                                                               *
      *****************************************************************
      /TITLE SUBROUTINE INDEX
      *****************************************************************
      *                                                               *
      *  S U B R O U T I N E   I N D E X                              *
      *                                                               *
      *  SRINIT - Initial Processing                                  *
      *  SRINTF - Initialise non-constant fields                      *
      *  SRROUT - Determine message routing                           *
      *  SRFMT  - Format MT515 or MT518 for message output            *
      *  SRGENL - Format MT515 or MT518 Seq A fields                  *
      *  SRLINK - Format MT515 Subsequence A1 fields                  *
      *  SRCDET - Format MT515 Seq C or MT518 Seq B fields            *
      *  SRCPTY - Format MT515 Subseq C1 or MT518 Subseq B1           *
      *  SRFFIA - Format MT515 Subseq C2 or MT518 Subseq B2           *
      *  SRSDET - Format Mt515 Seq D MT518 Seq C fields               *
      *  SR5SPY - Format MT515 Subseq D1                              *
      *  SR8SPY - Format MT518 Subseq C1                              *
      *  SRCSHP - Format MT515 Subseq D2 or MT518 Subseq C2           *
      *  SRFAMT - Format MT515 Subseq D3 or MT518 Subseq C3           *
      *  SRRDET - Format of additional REPO block after subsequence D *   CSE006
      *  SRPERR - Print message not generated (i.e. in error)         *
      *  SROMSG - Output to PF/MGOMSGPD                               *
      *  SROREF - Output to PF/MGOREFPD                               *
      *  SRPGEN - Print message generated                             *
      *  SRSWCY - Retrieve the SWIFT Currency Code                    *
      *  SRSTAT - Determine message status                            *
      *  SRF95  - Format field :95a: - Party                          *
      *  SR#ZA  - Format addresses                                    *
      *  SRMTAG - Access tag/field description                        *
      *  SRUPDT - Update transaction record                           *
      *                                                               *
      *  *PSSR  - Program error handling routine                      *
      *                                                               *
      *****************************************************************
      /TITLE E-SPECIFICATIONS
      *****************************************************************
     E                    CPY@    1   1 80
      *
      ** Array containing Copyright statement
      *
     E**********          ERRA    1  20 50                                                    CSW203
     E                    ERRA    1  20 80                                                    CSW203
      *
      ** Array used to format error msg field on Mult Occur DS
      *
     E                    TYPA    1   2 20
      *
      ** Array used to format Trade Type Description on Report
      *
     E                    CCA        10 13 0
      *
      ** Array for Charges and Commision Amount
      ** (Will be used to accumulate the amount of charges
      **  and commissions with the same SWIFT ID)
      *
     E                    CCS        10  4
      *
      ** Array for Charges and Commision SWIFT ID
      ** (Will be used to accumulate the amount of charges
      **  and commissions with the same SWIFT ID)
      *
     E                    AMT        10 13 0
      *
      ** Array for Charges and Commision amount
      *
     E                    CDE        10  4
      *
      ** Array for Charges and Commision ID's
      *
     E                    @ST        15  3
     E                    WRKACT     35  1                                                    CSW203
     E                    WRKSFE     40  1                                                    CSW203
      *
      ** Array used to set message status
      *
      /SPACE 3
     IOVRFL1      DS
     I                                    B 188 1890WWOFL1
     I                                    B 367 3680WWPTL1
      *
      ** File Information Date Structure for MG051NA1
      *
     IOVRFL2      DS
     I                                    B 188 1890WWOFL2
     I                                    B 367 3680WWPTL2
      *
      ** File Information Date Structure for MG051NA2
      *
     IMULT        DS                        500
     I                                        1  36 MDES
     I                                       37  41 MTAG
     I                                       42  91 MDAT
     I                                       92 141 MERR
     I                                      142 191 RDAT
     I                                      192 194 MSEQ
      *
      ** Multiple occurrence data structure for message
      *
     ICRLFDS      DS                              2
     I                                        1   2 CTRC
     I                                        1   1 WWCR
     I                                        2   2 WWLF
      *
      ** Date Structure for CRLF control character
      *
     ICCDEDS      DS
     I                                        1  40 CDE
     I                                        1   4 MGTBCI
     I                                        5   8 MGTCCI
     I                                        9  12 MGTCI1
     I                                       13  16 MGTCI2
     I                                       17  20 MGTCI3
     I                                       21  24 MGTCI4
     I                                       25  28 MGTCI5
     I                                       29  32 MGTCI6
     I                                       33  36 MGTCI7
     I                                       37  40 MGTAX1
      *
      ** Charges and Commissions ID Data Structure
      *
     ICAMTDS      DS
     I                                        1 1300AMT
     I                                        1  130MGTBCA
     I                                       14  260MGTCCA
     I                                       27  390MGTCA1
     I                                       40  520MGTCA2
     I                                       53  650MGTCA3
     I                                       66  780MGTCA4
     I                                       79  910MGTCA5
     I                                       92 1040MGTCA6
     I                                      105 1170MGTCA7
     I                                      118 1300MGTAXA
      *
      ** Charges and Commissions  Amount Data Structure
      *
     IDBERR       DS                             20
     I                                        1   2 @MODI
     I                                        3  17 WW0317
      *
      ** Data Structure for DB Error
      *
     IDBERR1      DS                             26
     I                                        1   6 @SNDR
     I                                        7  18 @SCSD
     I                                       19  24 @DEST
     I                                       25  26 @SETP
      *
      ** Data Structure for DB Error in PGM/ZM1100
      *
     IDBERR2      DS                             16
     I                                        1  130WWAMT
     I                                       14  16 ZCCY
      *                                                                                       CSW203
     IWT2FIN      DS                             35                                           CSW203
     I                                        1   1 W01CHR                                    CSW203
     I                                        2  35 WKFINF                                    CSW203
      *                                                                                       CSW203
     IWMPRAC      DS                             12                                           CSW203
     I                                        1   8 WBICCD                                    CSW203
     I                                        5   6 WKMRPR                                    CSW203
     I                                        9  11 WBICBR                                    CSW203
      *
      ** Data Structure for DB Error in PGM/ZM1240
      *
     ILDA       E DSLDA                         256
      *
      ** Local data area for database error details
      ** *LOCK IN LDA immediately before and OUT LDA immediately
      ** after each database error handling.
      **
      **                                    134 141 DBFILE
      **       Defines:                     142 170 DBKEY
      **                                    171 180 DBPGM
      **                                    181 1830DBASE
      *
     IRUNDAT    E DSRUNDAT
      *
      ** Data Area giving Installation Control Details
      *
     IPSDS       SDS
      *
      ** Program Status Data Structure
      *
     I                                     *PROGRAM PGM
     I                                      244 253 WSID
     I                                      254 263 USER
      *                                                                                       CSD015
     ISCSARD    E DSSCSARDPD                                                                  CSD015
      ** Data structure for SAR - Switchable features file                                    CSD015
      *                                                                                       CSD015
     IWLTDS     E DSSDWLTOPD                                                                  CSD015
      ** DS For Watch List Transaction Details File                                           CSD015
      *                                                                                       CSD015
     IPSTRNG      DS                           9999                                           CSD015
      *                                                                                       CSD015
     ISDWLCC    E DSSDWLCCPD                                                                  222385
      ** Watch list checking details                                                          222385
      *                                                                                       222385
     IDSFDY     E DSDSFDY
      *
      ** First Data Structure for Access Objects
      *
     IDSSDY     E DSDSSDY
      *
      ** Second Data Structure for Access Objects
      *
     IDSLDY     E DSDSLDY                                                                     CSW036
      *                                                                                       CSW036
      ** Very Large Data Structure for Access Objects                                         CSW036
      *                                                                                       CSW036
     ISDBANK    E DSSDBANKPD
      *
      ** Bank Details
      *
     ISDCURR    E DSSDCURRPD
      *
      ** Currency Details
      *
     ISDBRCH    E DSSDBRCHPD
      *
      ** Branch Details
      *
     ISDMGME    E DSSDMGMEPD
      *
      ** Branch Details
      *
     ISDCUST    E DSSDCUSTPD
     I              QQDFAC                          QQDFA1                                    CGL029
      *
      ** Customer Details
      *
     IMEBICD    E DSMEBICDPD                                                                  CSW203
     ISDCNST    E DSSDCNSTPD                                                                  CSW203
      *                                                                                       CSW207
     ISDLOCN    E DSSDLOCNPD                                                                  CSW207
      *                                                                                       CSW207
      ** Location Code Details                                                                CSW207
      *                                                                                       CSW207
     ISDSECS    E DSSDSECSPD                                                                  CSW207
      *                                                                                       CSW207
      ** Midas SD Securities clients                                                          CSW207
      *                                                                                       CSW207
     ISDCSSW    E DSSDCSSWPD                                                                  CSW207
      *                                                                                       CSW207
      ** Midas SD Customer Extensions SWIFT Details                                           CSW207
      *                                                                                       CSW207
      ** Variable declaration for ZADTMCVT                                                    CSW208
     I            DS                                                                          CSW208
     I                                        1   60PFRTM                                     CSW208
     I                                       11  160PMKTM                                     CSW208
     I                                       21  240PMKTOF                                    CSW208
     I                                       31  360PLCTM                                     CSW208
     I                                       41  440PLCTOF                                    CSW208
     I                                       51  560PSYTM                                     CSW208
     I                                       61  640PSYTOF                                    CSW208
      *                                                                                     BUG19304
     I              'SDMFID-              C         PGMF                                    BUG19304
     I              'TIM'                                                                   BUG19304
      *                                                                                       CSW210
     I              'ABCDEFGHIJKLMNOPQRST-C         ALPHAN                                    CSW210
     I              'UVWXYZ0123456789'                                                        CSW210
      *                                                                                       CSW210
      *****************************************************************
      /TITLE Main Processing
      *****************************************************************
      *  P R O G R A M     S T A R T                                  *
      *****************************************************************
      *
      ** Initial Processing
      *
     C                     EXSR SRINIT
      *
      ** Read the first record in MGF51NPD
      *
     C                     READ MGF51NPD                 50
      *
      ** Do while there are records read in PF/MGF51NPD
      *
     C           *IN50     DOWEQ*OFF
      *
      ** Initialise non-constant fields
      *
     C                     EXSR SRINTF
      *
      ** Determine message routing
      *
     C                     EXSR SRROUT
      *
      ** Format MT515 or MT518 message fields
      *
     C                     EXSR SRFMT
      *
      ** If any error whilst formatting message fields
      *
     C           @ERR      IFEQ 'Y'
      *
      **   ... print error message
      *
     C                     EXSR SRPERR
      *
      ** Otherwise,
      *
     C                     ELSE
      *
      **   ... output to PF/MGOMSGPD and PF/MGOREFPD
      *
     C                     EXSR SROMSG
      *
      **   ... print message generated details
      *
     C                     EXSR SRPGEN
     C                     MOVE 'Y'       WMSGEN  1
      *
     C                     ENDIF
      *
      ** Delete record in MGF51NPD
      *
     C                     DELETMGF51ND0
      *
      ** If record succesfully generated, update transaction record
      *
     C           @ERR      IFNE 'Y'
     C                     EXSR SRUPDT
     C                     ENDIF
      *
      ** Comit all changes to file
      *
     C                     COMIT
      *                                                                   221145
      **  Call Compliance Watch:Watch List Checking                       221145
      *                                                                   221145
     C           CSD015    IFEQ 'Y'                                       221145
     C           W1EWLC    ANDEQ'Y'                                                           222385
     C           CSW025    ANDEQ'N'                                       221145
     C                     EXSR WLCDQ                                     221145
     C                     ENDIF                                          221145
      *
      ** Read next PF/MGF51NPD record
      *
     C                     READ MGF51NPD                 50
      *
     C                     ENDDO
      *
      ** Write trailer on SWIFT Messages Generated Report
      ** (PRTF/MG051NA1) only if messages generated
      *
     C           WMSGEN    IFNE 'Y'
      *
     C                     WRITEHEADER1
     C                     WRITENODETS
      *
     C                     ELSE
      *
      ** ... Check for Overflow
      *
     C           WWOFL1    SUB  WWPTL1    WWLINE  20
      *
     C           WWLINE    IFLT 4
     C                     WRITEHEADER1
     C                     ENDIF
      *
     C                     WRITEEOREPT1
     C                     ENDIF
      *
      ** Write trailer on SWIFT Messages not Generated Report
      ** (PRTF/MG051NA2) only if the printer file has been opened
      *
     C           *IN60     IFEQ '1'
      *
      ** ... Check for overflow
      *
     C           WWOFL2    SUB  WWPTL2    WWLINE
      *
     C           WWLINE    IFLT 4
     C                     WRITEHEADER2
     C                     ENDIF
      *
     C                     WRITEEOREPT2
      *
     C                     ENDIF
      *
      *****************************************************************
      *  P R O G R A M     E N D                                      *
      *****************************************************************
      *                                                               *
     C/COPY WNCPYSRC,MG051NC001
     C                     MOVE '1'       *INLR
     C                     RETRN
      *
      *****************************************************************
      /TITLE SR/SRINIT
      *****************************************************************
      *                                                               *
      *  SRINIT - Subroutine to do program initialisation.            *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls    :                                                   *
      *                                                               *
      *****************************************************************
      *                                                               *
     C           SRINIT    BEGSR
      *
      ** Set up copyright parameter
      *
     C                     MOVEACPY@      CPY2@  80
      *                                                                                       CSW207
      ** Defining work Variables                                                              CSW207
      *                                                                                       CSW207
     C                     MOVEL*BLANKS   WUTC    5                                           CSW207
     C                     MOVEL*BLANKS   WDEST   1                                           CSW207
     C                     MOVEL*BLANKS   WBRCA   1                                           CSW207
     C                     MOVEL*BLANKS   WMFID   1                                           CSW207
     C                     MOVEL*BLANKS   WFINCA  1                                           CSW207
     C                     MOVEL*BLANKS   WFTRCA  1                                           CSW207
      *
      ** Read in Installation Data
      *
     C           *NAMVAR   DEFN           RUNDAT
     C           *NAMVAR   DEFN           LDA
     C                     IN   RUNDAT
      *
      ** Set Date Format Indicator *IN98  on if date format is MMDDYY
      *
     C           AGDFF     IFEQ 'M'
     C                     SETON                     98
     C                     ENDIF
      *
      ** Access Bank Details
      *
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' WRTCD   7
     C                     PARM '*FIRST ' WOPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
      *
      ** Data base error in file (SDBANKPD)
      *
     C           WRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     Z-ADD001       DBASE            ***************
     C                     MOVEL'SDBANKPD'DBFILE           *DB ERROR 001 *
     C                     MOVE *BLANKS   DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      **  Access SDMGMEPD for message management data
      *
     C                     CALL 'AOMGMER0'
     C                     PARM '*MSG   ' WRTCD
     C                     PARM '*FIRST ' WOPTN
     C           SDMGME    PARM SDMGME    DSFDY
      *
     C           WRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     Z-ADD002       DBASE            ***************
     C                     MOVEL'SDMGMEPD'DBFILE           *DB ERROR 002 *
     C                     MOVEL*BLANKS   DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Check if (CSW003) MT5XX - Phase 2 Message Generation is On
      *
     C                     CALL 'AOSARDR0'
     C                     PARM '*BLANKS' WRTCD
     C                     PARM '*VERIFY' WOPTN
     C                     PARM 'CSW003'  WSARD   6
      *
     C           WRTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       CSW003  1
     C                     ELSE
     C                     MOVE 'N'       CSW003
     C                     ENDIF
      *
      ** Check if (CEU005) SE Settlement Ccy conversion
      *
     C                     CALL 'AOSARDR0'
     C                     PARM '*BLANKS' WRTCD
     C                     PARM '*VERIFY' WOPTN
     C                     PARM 'CEU005'  WSARD   6
      *
     C           WRTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       CEU005  1
     C                     ELSE
     C                     MOVE 'N'       CEU005
     C                     ENDIF
      *                                                                   CSW014
      *** Check if SAR CSW014 is present                                  CSW014
      *                                                                   CSW014
     C                     CALL 'AOSARDR0'                                CSW014
     C                     PARM '*BLANKS' WRTCD                           CSW014
     C                     PARM '*VERIFY' WOPTN                           CSW014
     C                     PARM 'CSW014'  WSARD                           CSW014
      *                                                                   CSW014
     C           WRTCD     IFEQ *BLANKS                                   CSW014
     C                     MOVE 'Y'       CSW014  1                       CSW014
     C                     ELSE                                           CSW014
     C                     MOVE 'N'       CSW014                          CSW014
     C                     ENDIF                                          CSW014
     C/COPY WNCPYSRC,MG051NC002
      *                                                                   CSE006
      *** Check if SAR CSE006 is present                                  CSE006
      *                                                                   CSE006
     C                     CALL 'AOSARDR0'                                CSE006
     C                     PARM '*BLANKS' WRTCD                           CSE006
     C                     PARM '*VERIFY' WOPTN                           CSE006
     C                     PARM 'CSE006'  WSARD                           CSE006
      *                                                                   CSE006
     C           WRTCD     IFEQ *BLANKS                                   CSE006
     C                     MOVE 'Y'       CSE006  1                       CSE006
     C                     ELSE                                           CSE006
     C                     MOVE 'N'       CSE006                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSW200
      * Check if SWIFT 2000 is active                                     CSW200
      *                                                                   CSW200
     C                     CALL 'SWIF2000'             9090               CSW200
     C                     PARM *BLANKS   CSW200  7        B:Return code  CSW200
      *                                                                   CSW200
      *  If return with an error (LR seton in called program) then        CSW200
      *  process for database error.                                      CSW200
      *                                                                   CSW200
     C           *IN90     IFEQ '1'                                       CSW200
     C                     Z-ADD040       DBASE            ***************CSW200
     C                     MOVEL'SWIF2000'DBFILE           *DB ERROR 040 *CSW200
     C                     MOVE '*CALL   'DBKEY            ***************CSW200
     C                     OUT  LDA                                       CSW200
     C                     EXSR *PSSR                                     CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
      *                                                                                       CSW201
      ** Call SWIF2001 to check if CSW201 is switched on.                                     CSW201
      *                                                                                       CSW201
     C                     CALL 'SWIF2001'             9090                                   CSW201
     C                     PARM *BLANKS   PRTCD   7                                           CSW201
      *                                                                                       CSW201
      ** If return with an error (LR seton in called program) then                            CSW201
      ** process for database error.                                                          CSW201
      *                                                                                       CSW201
     C           *IN90     IFEQ *ON                                                           CSW201
     C           *LOCK     IN   LDA                                                           CSW201
     C                     Z-ADD041       DBASE                                               CSW201
     C                     MOVEL'SWIF2001'DBFILE                                              CSW201
     C                     MOVE '*CALL   'DBKEY                                               CSW201
     C                     OUT  LDA                                                           CSW201
     C                     EXSR *PSSR                                                         CSW201
     C                     ELSE                                                               CSW201
      *                                                                                       CSW201
     C           PRTCD     IFEQ 'CSW2001'                                                     CSW201
     C                     MOVE 'Y'       CSW201  1                                           CSW201
     C                     ELSE                                                               CSW201
     C                     MOVE 'N'       CSW201                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW202
      ** Check if CSW202 is installed                                                         CSW202
      *                                                                                       CSW202
     C                     CALL 'SWIF2002'                                                    CSW202
     C                     PARM *BLANKS   PRTCD                                               CSW202
      *                                                                                       CSW202
     C           PRTCD     IFEQ 'CSW2002'                                                     CSW202
     C                     MOVE 'Y'       CSW202  1                                           CSW202
     C                     ELSE                                                               CSW202
     C                     MOVE 'N'       CSW202                                              CSW202
     C                     ENDIF                                                              CSW202
      *                                                                                       CSW203
      ** Check if Swift 2003 Standards Update is installed                                    CSW203
      *                                                                                       CSW203
     C                     CALL 'SWIF2003'                                                    CSW203
     C                     PARM *BLANKS   PRTCD                                               CSW203
      *                                                                                       CSW203
     C           PRTCD     IFEQ 'CSW2003'                                                     CSW203
     C                     MOVE 'Y'       CSW203  1                                           CSW203
     C                     ELSE                                                               CSW203
     C                     MOVE 'N'       CSW203                                              CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSD015
      ** Access SAR Details file to determine if CSD015 is installed                          CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CSD015  1                                           CSD015
     C                     MOVEL'N'       W1EWLC                                              222385
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY' WOPTN                                               CSD015
     C                     PARM 'CSD015'  WSARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
     C           PRTCD     IFNE *BLANK                                                        CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     MOVEL'043'     DBASE                                               CSD015
     C                     MOVELPRTCD     DBKEY                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
     C           PRTCD     IFEQ *BLANK                                                        CSD015
     C                     MOVE 'Y'       CSD015                                              CSD015
      *                                                                                       222385
      ** Access AOWLCCR0 to check if function code MESSGENT is available                      222385
      *                                                                                       222385
     C                     CALL 'AOWLCCR0'                                                    222385
     C                     PARM *BLANKS   PRTCD                                               222385
     C                     PARM '*KEY'    WOPTN                                               222385
     C                     PARM 'MESSGENT'PFUNC   8                                           222385
     C           SDWLCC    PARM SDWLCC    DSFDY                                               222385
      *                                                                                       222385
     C           PRTCD     IFNE *BLANKS                                                       222385
     C           PRTCD     ANDNE'*NRF'                                                        222385
     C                     MOVEL'SDWLCCPD'DBFILE                                              222385
     C                     MOVELPFUNC     DBKEY                                               222385
     C                     Z-ADD32        DBASE                                               222385
     C                     EXSR *PSSR                                                         222385
     C                     ENDIF                                                              222385
      *                                                                                       222385
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Access SAR details file to determine if Midas Message Manager                        CSD015
      ** (CSW025) is installed                                                                CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CSW025  1                                           CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM '*VERIFY' WOPTN                                               CSD015
     C                     PARM 'CSW025'  WSARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
     C           PRTCD     IFNE *BLANK                                                        CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD015
     C                     MOVEL'044'     DBASE                                               CSD015
     C                     MOVELPRTCD     DBKEY                                               CSD015
     C                     OUT  LDA                                                           CSD015
     C                     EXSR *PSSR                                                         CSD015
     C                     ENDIF                                                              CSD015
     C           PRTCD     IFEQ *BLANK                                                        CSD015
     C                     MOVE 'Y'       CSW025                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD036
      ** Access SAR details file to determine if second SWIFT BIC                             CSD036
      ** (CSW036) is installed                                                                CSD036
      *                                                                                       CSD036
     C                     MOVE 'N'       CSW036  1                                           CSD036
     C                     CALL 'AOSARDR0'                                                    CSD036
     C                     PARM *BLANKS   PRTCD                                               CSD036
     C                     PARM '*VERIFY' WOPTN                                               CSD036
     C                     PARM 'CSW036'  WSARD                                               CSD036
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD036
     C           PRTCD     IFNE *BLANK                                                        CSD036
     C           PRTCD     ANDNE'*NRF   '                                                     CSD036
     C           *LOCK     IN   LDA                                                           CSD036
     C                     MOVEL'SCSARDPD'DBFILE                                              CSD036
     C                     MOVEL'045'     DBASE                                               CSD036
     C                     MOVELPRTCD     DBKEY                                               CSD036
     C                     OUT  LDA                                                           CSD036
     C                     EXSR *PSSR                                                         CSD036
     C                     ENDIF                                                              CSD036
     C           PRTCD     IFEQ *BLANK                                                        CSD036
     C                     MOVE 'Y'       CSW036                                              CSD036
     C                     ENDIF                                                              CSD036
      *                                                                                       CSW207
      ** Check if SWIFT Changes 2007 (CSW207) is installed                                    CSW207
      *                                                                                       CSW207
     C                     CALL 'SWIF2007'                                                    CSW207
     C                     PARM *BLANKS   PRTCD   7                                           CSW207
     C*                                                                                       CSW207
     C           PRTCD     IFEQ 'CSW2007'                                                     CSW207
     C                     MOVE 'Y'       CSW207  1                                           CSW207
     C                     ELSE                                                               CSW207
     C                     MOVE 'N'       CSW207                                              CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW208
      ** Check if SWIFT Changes 2008 (CSW208) is installed                                    CSW208
      *                                                                                       CSW208
     C                     CALL 'SWIF2008'                                                    CSW208
     C                     PARM *BLANKS   PRTCD                                               CSW208
      *                                                                                       CSW208
     C           PRTCD     IFEQ 'CSW2008'                                                     CSW208
     C                     MOVE 'Y'       CSW208  1                                           CSW208
     C                     ELSE                                                               CSW208
     C                     MOVE 'N'       CSW208                                              CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW210
      ** Check if SWIFT Changes 2010 (CSW210) is installed.                                   CSW210
      *                                                                                       CSW210
     C                     CALL 'SWIF2010'                                                    CSW210
     C                     PARM *BLANKS   PRTCD                                               CSW210
      *                                                                                       CSW210
     C           PRTCD     IFEQ 'CSW2010'                                                     CSW210
     C                     MOVE 'Y'       CSW210  1                                           CSW210
     C                     ELSE                                                               CSW210
     C                     MOVE 'N'       CSW210                                              CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW214
      ** Check if SWIFT Changes 2014 (CSW214) is installed.                                   CSW214
      *                                                                                       CSW214
     C                     CALL 'SWIF2014'                                                    CSW214
     C                     PARM *BLANKS   PRTCD                                               CSW214
      *                                                                                       CSW214
     C           PRTCD     IFEQ 'CSW2014'                                                     CSW214
     C                     MOVE 'Y'       CSW214  1                                           CSW214
     C                     ELSE                                                               CSW214
     C                     MOVE 'N'       CSW214                                              CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                       CSW210
      ** Access Switchable SAR details for the existence of CFT004                            CSW210
      *                                                                                       CSW210
     C                     CALL 'AOSARDR0'                                                    CSW210
     C                     PARM *BLANKS   WRTCD                                               CSW210
     C                     PARM '*VERIFY' WOPTN                                               CSW210
     C                     PARM 'CFT004'  WSARD                                               CSW210
     C           WRTCD     IFNE *BLANKS                                                       CSW210
     C           WRTCD     ANDNE'*NRF   '                                                     CSW210
     C           *LOCK     IN   LDA                                                           CSW210
     C                     Z-ADD13        DBASE                                               CSW210
     C                     MOVEL'AOSARDR0'DBFILE                                              CSW210
     C                     MOVE '*CALL   'DBKEY                                               CSW210
     C                     OUT  LDA                                                           CSW210
     C                     EXSR *PSSR                                                         CSW210
     C                     ENDIF                                                              CSW210
     C           WRTCD     IFEQ *BLANKS                                                       CSW210
     C                     MOVE 'Y'       CFT004  1                                           CSW210
     C                     ELSE                                                               CSW210
     C                     MOVE 'N'       CFT004                                              CSW210
     C                     ENDIF                                                              CSW210
      *
      ** Set up KLIST for SDMTAGL0
      *
     C           KMTAG     KLIST
     C                     KFLD           MTAG
     C                     KFLD           KTYP    3
     C                     KFLD           KSEQ    3
      *
     C           KCRTN     KLIST
     C                     KFLD           KTDRF   6
      *
      ** Set CRLF control character
      *
     C                     MOVE *LOVAL    CTRC
     C                     BITON'457'     WWCR
     C                     BITON'257'     WWLF
      *
     C                     ENDSR
      *****************************************************************
      /TITLE SR/SRINTF
      *****************************************************************
      *                                                               *
      *  SRINTF - Initialise non-constant fields                      *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls    :                                                   *
      *                                                               *
      *****************************************************************
      *
     C           SRINTF    BEGSR
      *
      ** Obtain Sequence Numbers from transaction record
      ** format @TRAN as follows:
      **   Chars 01-06 equal to leftmost 6 chars from MGTNUM
      **   Chars 07-13 equal to blanks
      **   Chars 14-15 equal to MGTTYP
      *
     C                     MOVE *BLANKS   WWTRAN 15
     C                     MOVE *BLANKS   WWFL06  6
     C                     MOVELMGTNUM    WWFL06
     C                     MOVELWWFL06    WWTRAN
     C                     MOVE MGTTYP    WWTRAN
      *
     C                     CALL 'MG5900'               21
     C                     PARM MGMODI    @MODI   2
     C                     PARM WWTRAN    @TRAN  15
     C                     PARM 'CE'      @PROG   2
     C                     PARM *BLANKS   @MODE   1
     C                     PARM *ZEROS    @LSWS   70
     C                     PARM *BLANKS   @ERCD   1
     C                     PARM           CSW003
      *
      ** If program not found, perform DB Error processing
      *
     C           *IN21     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     Z-ADD0003      DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *DB ERROR 003 *
     C                     MOVEL'MG5900'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** If an error occurred in MG5900, perform DB Error processing
      *
     C           @ERCD     IFEQ 'Y'
     C           *LOCK     IN   LDA
     C                     MOVEL@TRAN     WW0317
     C                     Z-ADD004       DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *DB ERROR 004 *
     C                     MOVELDBERR     DBKEY            * * * * * * * *
     C                     MOVEL'MG5900'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Obtain Confirmation Generated Indicator format @TREF as follows:
      **   Chars 01-06 equal to leftmost 6 chars from MGTNUM
      **   Chars 07-13 equal to blanks
      **   Chars 14-15 equal to MGTTYP
      *
     C                     MOVE *BLANKS   WWTREF 15
     C                     MOVE *BLANKS   WWFL06  6
     C                     MOVELMGTNUM    WWFL06
     C                     MOVELWWFL06    WWTREF
     C                     MOVE MGTTYP    WWTREF
      *
     C                     CALL 'MG5910'               22
     C                     PARM MGMODI    @MODI   2
     C                     PARM WWTREF    @TREF  15
     C                     PARM 'CE'      @PROG   2
     C                     PARM *BLANKS   @MODE   1
     C                     PARM *BLANKS   @CONG   1
     C                     PARM *BLANKS   @RCDG   1
     C                     PARM *BLANKS   @ERCD   1
     C                     PARM           CSW003
      *
      ** If program not found, perform DB Error processing
      *
     C           *IN22     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     Z-ADD005       DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *DB ERROR 005 *
     C                     MOVEL'MG5910'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** If an error occured in MG5910, perform DB Error processing
      *
     C           @ERCD     IFEQ 'Y'
     C           *LOCK     IN   LDA
     C                     MOVEL@TREF     WW0317
     C                     Z-ADD006       DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *DB ERROR 006 *
     C                     MOVELDBERR     DBKEY            * * * * * * * *
     C                     MOVEL'MG5910'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** If @CONG parameter is 'Y', perform DB Error processing
      *
     C           MGTTYP    IFEQ 'TR'
     C           @CONG     ANDEQ'Y'
     C           *LOCK     IN   LDA
     C                     MOVEL@TREF     WW0317
     C                     Z-ADD007       DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *DB ERROR 007 *
     C                     MOVELDBERR     DBKEY            * * * * * * * *
     C                     MOVEL'MG5910'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Clear multiple occurence data structure
      *
     C                     Z-ADD1         X       20
     C           X         OCUR MULT
      *
     C           X         DOWLE500
     C           MULT      ANDNE*BLANKS
     C                     CLEARMULT
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     ENDDO
      *
      ** Access the first occurence in MULT
      *
     C                     Z-ADD1         X
     C           X         OCUR MULT
      *
      ** Set flag for message correctly generated, destination
      ** and network error workfields to blank
      *
     C                     MOVE *BLANKS   @ERR    1
     C                     MOVE *BLANKS   DSERR  50
     C                     MOVE *BLANKS   NWERR  50
      *
      ** Retrieve the SWIFT Ccy Code for the Nominal Currency
      *
     C                     MOVE *BLANK    WNSWCY  3
     C                     MOVELMGNMCY    WCYCD
     C                     EXSR SRSWCY
     C                     MOVELA6SWCY    WNSWCY
      *
      ** Retrieve the SWIFT Ccy Code of the Settlement Ccy
      *
     C                     MOVE *BLANK    WSSWCY  3
     C                     MOVELMGSTCY    WCYCD
     C                     EXSR SRSWCY
     C                     MOVELA6SWCY    WSSWCY
      *
      ** Retrieve the SWIFT Ccy Code of the Original Ccy
      *
     C           MGOTRC    IFNE *BLANKS
     C                     MOVE *BLANK    WOSWCY  3
     C                     MOVELMGOTRC    WCYCD
     C                     EXSR SRSWCY
     C                     MOVELA6SWCY    WOSWCY
     C                     ENDIF
      *
      ** Set up indicator to suppress fields on condition:
      **     1) CSW003 is off
      **     2) Transaction is from Depot Movement
      ** This is because information is not available with the feature
      ** off.
      *
     C           CSW003    IFNE 'Y'
     C           MGTTYP    ANDNE'TR'
     C                     MOVE 'Y'       WSUPP   1
     C                     ELSE
     C                     MOVE 'N'       WSUPP
     C                     ENDIF
      *
     C                     ENDSR
      *****************************************************************
      /TITLE SR/SRROUT
      *****************************************************************
      *                                                               *
      *  SRROUT - Determine message routing                           *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls    :                                                   *
      *                                                               *
      *****************************************************************
      *
     C           SRROUT    BEGSR
      *
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM MGSNBR    WBRCH   3
     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *
      ** Database Error in SDBRCHPD
      *
     C           WRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     Z-ADD008       DBASE            ***************
     C                     MOVEL'SDBRCHPD'DBFILE           *DB ERROR 008 *
     C                     MOVELWBRCH     DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Determine the Network Routing and Addresses
      *
     C                     MOVE A8BICN    @SNDR   6
     C                     MOVE A8BTID    @SCSD  12
     C                     MOVE MGDEST    @DEST   6
     C                     MOVELMGSETP    @SETP   2
     C                     MOVE *BLANKS   @NWSN  20
     C                     MOVE *BLANKS   @NWDS  22
     C                     MOVE *BLANKS   @NWRK   6
     C                     MOVE *BLANKS   @ERRC   1
     C                     MOVE *BLANKS   @SRNM  20
     C                     MOVE *BLANKS   @SRTN  10
     C                     MOVE *BLANKS   @DRNM  20
     C                     MOVE *BLANKS   @DRTN  10
      *
     C*********************CALL 'ZM1100'               23                                     CSW036
     C                     CALL 'ZM1101'               23                                     CSW036
     C                     PARM           @SNDR
     C                     PARM           @SCSD
     C                     PARM           @DEST
     C                     PARM           @SETP
     C                     PARM           @NWSN
     C                     PARM           @NWDS
     C                     PARM           @NWRK
     C                     PARM           @ERRC
     C                     PARM           @SRNM
     C                     PARM           @SRTN
     C                     PARM           @DRNM
     C                     PARM           @DRTN
      *
      ** If program not found, perform DB Error processing
      *
     C           *IN23     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     Z-ADD009       DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *DB ERROR 009 *
     C*********************MOVEL'ZM1100'  DBPGM            * * * * * * * *                    CSW036
     C                     MOVEL'ZM1101'  DBPGM            * * * * * * * *                    CSW036
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** If an error occured in ZM1100, perform DB Error processing
      *
     C           @ERRC     IFEQ 'S'
     C           *LOCK     IN   LDA
     C                     Z-ADD010       DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *DB ERROR 010 *
     C                     MOVELDBERR1    DBKEY            * * * * * * * *
     C*********************MOVEL'ZM1100'  DBPGM                                               CSW036
     C                     MOVEL'ZM1101'  DBPGM                                               CSW036
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Format Destination Error Message
      *
     C           @ERRC     IFEQ 'D'
     C                     MOVE *BLANKS   DSERR  50
     C                     MOVELERRA,1    DSERR
     C                     MOVE 'Y'       @ERR
     C                     ENDIF
      *
      ** Format Network Error Message
      *
     C           @NWRK     IFEQ 'UNROUT'
     C                     MOVELERRA,2    NWERR
     C                     MOVE 'Y'       @ERR
     C                     ENDIF
      *
     C                     ENDSR
      *****************************************************************
      /TITLE SR/SRFMT
      *****************************************************************
      *                                                               *
      *  SRFMT  - Format MT515 or MT518 message fields                *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls    :                                                   *
      *                                                               *
      *****************************************************************
      *
     C           SRFMT     BEGSR
      *
      ** Format Sequence A fields - General Information
      *
     C                     EXSR SRGENL
      *
      ** Format Confirmation Details for MT515 Seq C or MT518 Seq B
      *
     C                     EXSR SRCDET
      *
      ** Format Settlement Details for MT515 Seq D or MT518 Seq C
      *
     C                     EXSR SRSDET
      *                                                                   CSE006
      *** If there is an associated deal number then process additional   CSE006
      *** REPO block.                                                     CSE006
      *                                                                   CSE006
     C           CSE006    IFEQ 'Y'                                       CSE006
     C           MGARF     ANDNE*BLANKS                                   CSE006
     C                     EXSR SRRDET                                    CSE006
     C                     ENDIF                                          CSE006
      *
     C                     ENDSR
      *****************************************************************
      /TITLE SR/SRGENL
      *****************************************************************
      *                                                               *
      *  SRGENL - Format MT515 and MT518 Sequence A - General Info.   *
      *                                                               *
      *  Called By: SR/SRFMT                                          *
      *  Calls    : SR/SRLINK                                         *
      *                                                               *
      *****************************************************************
      *
     C           SRGENL    BEGSR
      *
      ** Set up Message Sequence workfield
      *
     C                     MOVEL'A  '     WSEQ    3
      *
      ** Format field :16R: - Start of Block
      *
     C                     MOVEL':16R:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL'GENL'    MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      ** Format field :20C: - Sender's Reference
      *
     C                     MOVEL':20C:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL':SEME//' MDAT
      *
     C                     MOVE *BLANKS   WWMDAT 16
      *
     C           MGMODI    IFEQ 'SE'
      *
     C                     SELEC
     C           MGTTYP    WHEQ 'TR'
     C                     MOVEL'SET'     WWMDAT
     C           MGTTYP    WHEQ 'DM'
     C                     MOVEL'SED'     WWMDAT
     C           MGTTYP    WHEQ 'DN'
     C                     MOVEL'SEE'     WWMDAT
     C                     ENDSL
      *
     C                     ENDIF
      *
     C           WWMDAT    CAT  MGTNUM:0  WWMDAT
      *
     C           @LSWS     IFEQ 9999999
     C                     Z-ADD1         WWLSWS  70
     C                     ELSE
     C           @LSWS     ADD  1         WWLSWS
     C                     ENDIF
      *
     C                     MOVELWWLSWS    WALSWS  7
      *
     C           WWMDAT    CAT  WALSWS:0  WWMDAT
     C           MDAT      CAT  WWMDAT:0  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      ** Format field :23G: - Function of the Message
      *
     C                     MOVEL':23G:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL'NEWM'    MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      ** Format field :22F: - Trade Transaction Type Indicator
      *
     C                     MOVEL':22F:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL':TRTR//' MDAT
     C           MDAT      CAT  'TRAD':0  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      ** If Message Type is '515', format Subsequence A1 - Linkages
      *
     C           MGMTYP    IFEQ '515'
     C                     MOVEL'A1 '     WSEQ
     C                     EXSR SRLINK
     C                     MOVEL'A  '     WSEQ
     C                     ENDIF
      *
      ** Format field :16S: - End of Block
      *
     C                     MOVEL':16S:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL'GENL'    MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDSR
      *****************************************************************
      /TITLE SR/SRLINK
      *****************************************************************
      *                                                               *
      *  SRLINK - Format MT515 Subsequence A1 - Linkages              *
      *                                                               *
      *  Called By: SRGENL                                            *
      *  Calls    :                                                   *
      *                                                               *
      *****************************************************************
      *
     C           SRLINK    BEGSR
      *
      ** Format field :16R: - Start of Block
      *
     C                     MOVEL':16R:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL'LINK'    MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      ** Format field :20C: - Sender's Reference
      *
     C                     MOVEL':20C:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL':RELA//' MDAT
     C           MDAT      CAT  'NONREF':0MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      ** Format field :16S: - End of Block
      *
     C                     MOVEL':16S:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL'LINK'    MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDSR
      *****************************************************************
      /TITLE SR/SRCDET
      *****************************************************************
      *                                                               *
      *  SRCDET - Format Confirmation Details for MT515 Sequence C or *
      *           MF518 Sequence B                                    *
      *                                                               *
      *  Called By: SR/SRFMT                                          *
      *  Calls    :                                                   *
      *                                                               *
      *****************************************************************
      *
     C           SRCDET    BEGSR
      *
      ** Set up Message Sequence workfield
      *
     C           MGMTYP    IFEQ '515'
     C                     MOVEL'C  '     WSEQ
     C                     ELSE
     C                     MOVEL'B  '     WSEQ
     C                     ENDIF
      *
      ** Save the content WSEQ workfield
      *
     C                     MOVE WSEQ      SV@SEQ  3
      *
      ** Format field :16R: - Start of Block
      *
     C                     MOVEL':16R:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL'CONFDET' MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      ***Format*field*:98A:*or*:98C:*-*Trade*Date                                             CSW208
      ** Format field :98A:, :98C: or :98E: - Trade Date                                      CSW208
      *
     C                     EXSR SRMFID                                                        CSW208
      *                                                                                       CSW208
      ** Retrieve trade time from MiFID Database                                              CSW208
      *                                                                                       CSW208
     C                     MOVEL':TRAD//' MDAT
      *
      ** Convert Trade Date to CCYYMMDD (ZSDATC) format
      *
     C                     Z-ADDMGTDAT    ZMDAY
     C                     CALL 'ZM0065'
     C                     PARM           ZMDAY   50
     C                     PARM           ZSDATE  6
     C                     PARM           ZSDATC  8
      *
      ***Append*the*formatted*date*to*MULT/MDAT                                               CSW208
      *
     C********** MDAT      CAT  ZSDATC:0  MDAT                                                CSW208
      *
      ** If Trade Time is blanks, format field :98A:
      *
     C                     MOVELMGTRTT    W#TRTT  4                                           CSW208
     C********** MGTRTT    IFEQ *BLANKS                                                       CSW208
     C           W#TRTT    IFEQ *BLANKS                                                       CSW208
      *
     C                     MOVEL':98A:'   MTAG
      *                                                                                       CSW208
      ** Append the formatted date to MULT/MDAT                                               CSW208
      *                                                                                       CSW208
     C           MDAT      CAT  ZSDATC:0  MDAT                                                CSW208
      *
     C                     ELSE
      *                                                                                       CSW208
     C                     MOVE ZSDATC    WSDATE  8                                           CSW208
     C                     MOVE MGTRTT    WSTIME  6                                           CSW208
     C                     MOVE *BLANKS   PMRKT                                               CSW208
      *                                                                                       CSW208
      ** If SWIFT 2008 is switched on, convert system date/time to                            CSW208
      ** market date/time                                                                     CSW208
      *                                                                                       CSW208
     C           CSW208    IFEQ 'Y'                                                           CSW208
     C                     MOVELMGTNUM    WKTNUM  6                                           CSW208
      *                                                                                       CSW208
     C           MGTTYP    IFEQ 'TR'                                                          CSW208
     C           WKTNUM    CHAINTRADS                55                                       CSW208
     C           *IN55     IFEQ *OFF                                                          CSW208
     C                     MOVELTMKC      PMRKT                                               CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C                     ELSE                                                               CSW208
     C           WKTNUM    CHAINDPTMVDL1             58                                       CSW208
     C           *IN55     IFEQ *OFF                                                          CSW208
     C                     MOVELMRKT      PMRKT                                               CSW208
     C                     ENDIF                                                              CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C           PMRKT     IFNE *BLANKS                                                       CSW208
     C                     MOVE MGTRTT    PFRTM                                               CSW208
     C                     MOVE MGTDAT    PFRDT                                               CSW208
     C                     CALL 'ZADTMCVT'                                                    CSW208
     C                     PARM *BLANKS   PRTCD   7                                           CSW208
     C                     PARM 'S'       PFRTZ   1                                           CSW208
     C                     PARM           PFRTM                                               CSW208
     C                     PARM           PFRDT   50                                          CSW208
     C                     PARM 'SE'      PMODU   2                                           CSW208
     C                     PARM MGSNBR    PBRCA   3                                           CSW208
     C                     PARM           PMRKT   2                                           CSW208
     C                     PARM *BLANKS   PSESN  10                                           CSW208
     C                     PARM *BLANKS   PMICC   4                                           CSW208
     C                     PARM *ZEROS    PMKTM                                               CSW208
     C                     PARM *ZEROS    PMKDT   50                                          CSW208
     C                     PARM *ZEROS    PMKTOF                                              CSW208
     C                     PARM *BLANKS   PMKTOS  1                                           CSW208
     C                     PARM *ZEROS    PLCTM                                               CSW208
     C                     PARM *ZEROS    PLCDT   50                                          CSW208
     C                     PARM *ZEROS    PLCTOF                                              CSW208
     C                     PARM *BLANKS   PLCTOS  1                                           CSW208
     C                     PARM *ZEROS    PSYTM                                               CSW208
     C                     PARM *ZEROS    PSYDT   50                                          CSW208
     C                     PARM *ZEROS    PSYTOF                                              CSW208
     C                     PARM *BLANKS   PSYTOS  1                                           CSW208
      *                                                                                       CSW208
     C           PRTCD     IFEQ *BLANKS                                                       CSW208
     C                     MOVE PMKTM     WSTIME                                              CSW208
     C                     Z-ADDPMKDT     ZMDAY                                               CSW208
     C                     CALL 'ZM0065'                                                      CSW208
     C                     PARM           ZMDAY                                               CSW208
     C                     PARM           ZSDATE                                              CSW208
     C                     PARM           ZSDATC                                              CSW208
     C                     MOVE ZSDATC    WSDATE                                              CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C                     ELSE                                                             BUG19304
      *                                                                                     BUG19304
      ** Get local time and offset here                                                     BUG19304
      *                                                                                     BUG19304
     C                     EXSR SRLCTM                                                      BUG19304
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C           MDAT      CAT  WSDATE:0  MDAT                                                CSW208
     C           MDAT      CAT  WSTIME:0  MDAT                                                CSW208
      *
      ** Otherwise, format field :98C:
      *
     C                     MOVEL':98C:'   MTAG
     C********** MDAT      CAT  MGTRTT:0  MDAT                                              BUG20437
      *                                                                                       CSW207
     C********** CSW207    IFEQ 'Y'                                                    CSW207 CSW208
     C**********           EXSR SRMFID                                                 CSW207 CSW208
     C********** WMFID     IFEQ 'Y'                                                    CSW207 CSW208
      *                                                                                       CSW208
      ** If SWIFT 2007 or SWIFT 2008 is installed and Branch and                              CSW208
      ** Recieving customer are MiFID compliant                                               CSW208
     C           CSW207    IFEQ 'Y'                                                           CSW208
     C           CSW208    OREQ 'Y'                                                           CSW208
      *                                                                                       CSW208
     C           WMFID     IFEQ 'Y'                                                           CSW208
     C                     MOVEL':98E:'   MTAG                                                CSW207
     C                     MOVE *BLANKS   WTMOF                                               CSW208
     C                     MOVE *BLANKS   WOSIGN                                              CSW208
      *                                                                                       CSW207
      ** Format UTC if MiFID is 'Y'                                                           CSW207
      *                                                                                       CSW207
     C           CSW208    IFEQ 'Y'                                                           CSW208
     C********** PMKTOF    IFNE *ZEROS                                               CSW208 BUG19304
     C           PMRKT     IFNE *BLANKS                                                     BUG19304
     C                     MOVELPMKTOF    WTMOF                                               CSW208
     C                     MOVE PMKTOS    WOSIGN                                              CSW208
     C                     ELSE                                                             BUG19304
     C                     MOVELWBROF     WTMOF                                             BUG19304
     C                     MOVE WBRSG     WOSIGN                                            BUG19304
     C                     ENDIF                                                            BUG19304
     C**********           ENDIF                                                     CSW208 BUG19304
      *                                                                                       CSW208
     C                     ELSE                                                               CSW208
     C           A8TMOF    IFNE *ZEROS                                                        CSW207
     C                     MOVELA8TMOF    WTMOF   4                                           CSW207
     C                     MOVE A8SIGN    WOSIGN  1                                           CSW208
     C                     ENDIF                                                              CSW208
     C                     ENDIF                                                              CSW208
      *                                                                                       CSW208
     C********** A8SIGN    IFEQ '-'                                                    CSW207 CSW208
     C           WTMOF     IFNE *BLANKS                                                       CSW208
     C           WOSIGN    IFEQ '-'                                                           CSW208
     C           'N'       CAT  WTMOF     WUTC                                                CSW207
     C**********           ENDIF                                                       CSW207 CSW208
     C********** A8SIGN    IFEQ '+'                                                    CSW207 CSW208
     C                     ELSE                                                               CSW208
     C                     MOVELWTMOF     WUTC                                                CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
     C           '/'       CAT  WUTC      WMDATE  6                                           CSW207
     C           MDAT      CAT  WMDATE:0  MDAT                                                CSW207
     C                     ENDIF                                                              CSW207
     C                     ENDIF                                                              CSW207
     C                     ENDIF                                                              CSW207
      *
     C                     ENDIF
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      ** Format another :98A: - for Value Date
      *
     C                     MOVEL':98A:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
      ** Convert Value Date to CCYYMMDD (ZSDATC) format
      *
     C                     Z-ADDMGVDAT    ZMDAY
     C                     CALL 'ZM0065'
     C                     PARM           ZMDAY   50
     C                     PARM           ZSDATE  6
     C                     PARM           ZSDATC  8
      *
     C                     MOVEL':SETT//' MDAT
     C           MDAT      CAT  ZSDATC:0  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Save ZSDATE for later file (PF/MGOREFPD) update
      *
     C                     MOVELZSDATE    WWDATE  6
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      ** Format :90a: - Deal Price; where 'a' can be A or B depending
      **                            on the value of MGSPBS (Price Basis)
      *
     C           MGSPBS    IFEQ 'U'
     C           MGSPBS    OREQ 'P'
      *
     C                     MOVEL':DEAL//' MDAT
      *
      ** Convert Price amount to SWIFT format
      *
     C                     Z-ADDMGPRIC    ZPRIC  158
     C                     MOVE *BLANKS   ZSPRIC 16
     C                     MOVE *BLANKS   ZOPRIC 21
      *
     C                     CALL 'ZM1190'               24
     C                     PARM           ZPRIC
     C                     PARM           ZSPRIC
     C                     PARM           ZOPRIC
      *
      ** If program not found, perform DB Error processing
      *
     C           *IN24     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     Z-ADD012       DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *DB ERROR 012 *
     C                     MOVEL'ZM1190'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *
     C                     SELEC
      *
     C           MGSPBS    WHEQ 'U'
      *
      ** Retrieve the SWIFT currency code of the Nominal Currency
      *
     C                     MOVELMGNMCY    WCYCD   3
     C                     EXSR SRSWCY
      *
     C                     MOVEL':90B:'   MTAG
     C           MDAT      CAT  'ACTU/':0 MDAT
     C           MDAT      CAT  A6SWCY:0  MDAT
     C           MDAT      CAT  ZSPRIC:0  MDAT
      *
     C           MGSPBS    WHEQ 'P'
      *
     C                     MOVEL':90A:'   MTAG
     C           MGSTBS    IFEQ 'P'
     C           MDAT      CAT  'PRCT/':0 MDAT
     C                     ELSE
     C           MGSTBS    IFEQ 'D'
     C           MDAT      CAT  'DISC/':0 MDAT
     C                     ELSE
     C           MGSTBS    IFEQ 'Y'
     C           MDAT      CAT  'YIEL/':0 MDAT
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C           MDAT      CAT  ZSPRIC:0  MDAT
      *
     C                     OTHER
      *
     C                     MOVEL':90a:'   MTAG
     C                     MOVELERRA,3    MERR
     C                     MOVEL'Y'       @ERR
      *
     C                     ENDSL
      *
     C                     MOVELMDAT      RDAT
      *
      ** Access tag description
      *
     C           MGSPBS    IFEQ 'U'
     C           MGSPBS    OREQ 'P'
     C                     EXSR SRMTAG
     C                     ENDIF
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      ** Format :99A: - Number of Days Accrued
      *
     C           MGCPNR    IFNE *ZERO
     C           MGPROT    ANDNE'6'
     C           WSUPP     ANDNE'Y'
      *
     C                     MOVEL':99A:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
      ** Move MGACND to alphanumeric
      *
     C                     MOVELMGACND    WACND   3
      *
     C                     MOVEL':DAAC//' MDAT
     C           MDAT      CAT  WACND:0   MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDIF
      *                                                                                       CSW203
      ** Format :94B:                                                                         CSW203
      *                                                                                       CSW203
     C           CSW203    IFEQ 'Y'                                                           CSW203
      *                                                                                       CSW203
     C                     MOVELMGTNUM    WKTNUM                                              CSW203
      *                                                                                       CSW203
     C           WKTNUM    CHAINTRADS                48                                       CSW203
      *                                                                                       CSW203
     C           TMKC      IFNE *BLANKS                                                       CSW203
      *                                                                                       CSW203
     C                     MOVEL':94B:'   MTAG                                                CSW203
      *                                                                                       CSW203
      ** Access tag description                                                               CSW203
      *                                                                                       CSW203
     C                     EXSR SRMTAG                                                        CSW203
      *                                                                                       CSW214
     C           CSW214    IFEQ 'Y'                                                           CSW214
     C                     MOVEL':TRAD//' MDAT                                                CSW214
     C           'EXCH/'   CAT  TMKC:0    WKMDAT                                              CSW214
     C                     CAT  WKMDAT:0  MDAT                                                CSW214
     C                     MOVELMDAT      RDAT                                                CSW214
      *                                                                                       CSW214
     C                     ELSE                                                               CSW214
      *                                                                                       CSW203
      ** Check if Market Centre exists                                                        CSW203
      *                                                                                       CSW203
     C           TMKC      CHAINSEMKC                45                                       CSW203
      *                                                                                       CSW203
     C           *IN45     IFEQ *ON                                                           CSW203
     C                     MOVE 'Y'       @ERR                                                CSW203
     C                     MOVELERRA,12   MERR                                                CSW203
     C                     ELSE                                                               CSW203
     C                     MOVEL':TRAD//' MDAT                                                CSW203
     C           'EXCH/'   CAT  MKTN:0    WKMDAT 25                                           CSW203
     C                     CAT  WKMDAT:0  MDAT                                                CSW203
     C                     MOVELMDAT      RDAT                                                CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                       CSW203
      ** Access the next occurence in MULT                                                    CSW203
      *                                                                                       CSW203
     C                     ADD  1         X                                                   CSW203
     C           X         OCUR MULT                                                          CSW203
      *                                                                                       CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
     C                     EXSR SRF94F                                                        CSW203
     C                     ENDIF                                                              CSW203
      *
      ** Format :22H: - Indicator
      *
     C                     MOVEL':22H:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL':BUSE//' MDAT
      *
     C           MGMTYP    IFEQ '518'
      *
      ** If from TRADES file
      *
     C           MGTTYP    IFEQ 'TR'
     C           MGTSTP    IFEQ 'TP'
     C           MDAT      CAT  'BUYI':0  MDAT
     C                     ELSE
     C           MDAT      CAT  'SELL':0  MDAT
     C                     ENDIF
      *
     C                     ELSE
      *
      ** If from Depot Movements file
      *
     C           MGTTYP    IFEQ 'DM'
     C           MGTSTP    ANDEQ'RP'
     C           MGTTYP    OREQ 'DM'
     C           MGTSTP    ANDEQ'PD'
      *
     C           MGTTYP    OREQ 'DN'
     C           MGTSTP    ANDEQ'RR'
     C           MGTTYP    OREQ 'DN'
     C           MGTSTP    ANDEQ'PL'
     C           MDAT      CAT  'SELL':0  MDAT
     C                     ELSE
     C           MDAT      CAT  'BUYI':0  MDAT
     C                     ENDIF
     C                     ENDIF
      *
     C                     ELSE
      *
     C           MGTSTP    IFEQ 'TP'
     C           MDAT      CAT  'SELL':0  MDAT
     C                     ELSE
     C           MDAT      CAT  'BUYI':0  MDAT
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      ** Format :22A: - Indicator                                         CSW200
      *                                                                   CSW200
     C           CSW200    IFEQ 'CSW200'                                  CSW200
     C                     MOVEL':TTCO//' WFLD07                          CSW200
     C           MGPCOD    IFEQ '5'                                       CSW200
     C                     MOVEL'GTDL'    WFLD08                          CSW200
     C                     MOVEL':22F:'   MTAG                            CSW200
      *                                                                   CSW200
      ** Access tag description                                           CSW200
      *                                                                   CSW200
     C                     EXSR SRMTAG                                    CSW200
      *                                                                   CSW200
     C                     MOVELWFLD07    MDAT                            CSW200
     C           MDAT      CAT  WFLD08:0  MDAT                            CSW200
     C                     MOVELMDAT      RDAT                            CSW200
      *                                                                   CSW200
      ** Access the next occurence in MULT                                CSW200
      *                                                                   CSW200
     C                     ADD  1         X                               CSW200
     C           X         OCUR MULT                                      CSW200
      *                                                                   CSW200
     C                     ENDIF                                          CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C           MGPROT    IFEQ '4'
     C           MGPROT    OREQ '7'
      *
     C           MGEXIN    IFEQ 'C'
      *
      *
     C                     MOVEL':22F:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL':TTCO//' MDAT
     C           MDAT      CAT  'CDIV':0  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ELSE
      *
     C           MGEXIN    IFEQ 'X'
      *
     C                     MOVEL':22F:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL':TTCO//' MDAT
     C           MDAT      CAT  'XDIV':0  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C           MGPROT    IFEQ '1'
     C           MGPROT    OREQ '3'
     C           MGPROT    OREQ '5'
     C           MGPROT    OREQ '6'
     C           MGPROT    OREQ '8'
      *
     C           MGACND    IFNE *ZERO
      *
     C           MGEXIN    IFEQ 'C'
      *
     C                     MOVEL':22F:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
      *
     C                     MOVEL':TTCO//' MDAT
     C           MDAT      CAT  'CCPN':0  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ELSE
      *
     C           MGEXIN    IFEQ 'X'
      *
     C                     MOVEL':22F:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL':TTCO//' MDAT
     C           MDAT      CAT  'XCPN':0  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      *
     C           MGPCOD    IFEQ '2'
     C           MGPCOD    OREQ '3'
     C           MGPCOD    OREQ '4'
      *
     C                     MOVEL':22H:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL':PAYM//' MDAT
     C           MDAT      CAT  'FREE':0  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ELSE
      *
     C                     MOVEL':22H:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL':PAYM//' MDAT
     C           MDAT      CAT  'APMT':0  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDIF
      *
      ** Format MT515 Subseq C1 or MT518 Subseq B1 - Conf Parties
      *
     C                     EXSR SRCPTY
      *
      ** Restore the old value WSEQ
      *
     C                     MOVE SV@SEQ    WSEQ
      *
      ** Format :36B: - Quantity of Financial Instrument
      *
     C                     MOVEL':36B:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C           MGQANT    IFEQ *ZERO
      *
     C                     MOVELERRA,5    MERR
     C                     MOVEL'Y'       @ERR
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ELSE
      *
      ** Convert Quantity of Securities to SWIFT format
      *
     C                     Z-ADDMGQANT    ZAMNT  150
     C                     Z-ADDMGNMDP    ZCDP    10
     C                     MOVE *BLANKS   ZSAMNT 17
     C                     MOVE *BLANKS   ZOAMNT 21
      *
     C                     CALL 'ZM1140'               27
     C                     PARM           ZAMNT
     C                     PARM           ZCDP
     C                     PARM           ZSAMNT
     C                     PARM           ZOAMNT
      *
      ** If program not found, perform DB Error processing
      *
     C           *IN27     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     Z-ADD014       DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *DB ERROR 014 *
     C                     MOVEL'ZM1140'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     MOVEL':CONF//' MDAT
      *
     C           MGPROT    IFEQ '2'
     C           MGPROT    OREQ '4'
     C           MGPROT    OREQ '7'
     C           MDAT      CAT  'UNIT/':0 MDAT
     C                     ELSE
     C           MDAT      CAT  'FAMT/':0 MDAT
     C                     ENDIF
      *
     C           MDAT      CAT  ZSAMNT:0  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDIF
      *
      ** Format :35B: - Identification of Financial Instrument
      *
     C                     MOVEL':35B:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
      ** ISIN/Common Code
      *
     C           MGISIN    IFNE *BLANKS
     C                     MOVEL'ISIN'    MDAT
     C           MDAT      CAT  MGISIN:1  MDAT
     C                     MOVELMDAT      RDAT
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     ENDIF
      *
      ** Security Full Name - 1
     C                     MOVELMGSFN1    MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      ** Security Full Name - 2
      *
     C           MGSFN2    IFNE *BLANKS
      *
     C                     MOVELMGSFN2    MDAT
     C                     MOVELWSEQ      MSEQ
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDIF
      *
      ** Format MT515 Subsequence C2 or MT518 Subsequence B2
      ** (Financial Instrument Attributes)
      *
     C                     EXSR SRFFIA
      *
      ** Restore the old value WSEQ
      *
     C                     MOVE SV@SEQ    WSEQ
      *
      ** If Certificate Number is required,
      *
     C           MGCRTN    IFEQ 'Y'
     C                     EXSR SRCRTN
     C                     ENDIF
      *
      ** Format :16S: - End of Block
      *
      *
     C                     MOVEL':16S:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL'CONFDET' MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDSR
      *****************************************************************
      /TITLE SR/SRCPTY
      *****************************************************************
      *                                                               *
      *  SRCPTY - Format MT515 Subsequence C1 or MT518 Subsequence B1 *
      *           Confirmation Parties                                *
      *                                                               *
      *  Called By: SR/SRCDET                                         *
      *  Calls    :                                                   *
      *                                                               *
      *****************************************************************
      *
     C           SRCPTY    BEGSR
      *
      ** Set up Message Sequence workfield
      *
     C           MGMTYP    IFEQ '515'
     C                     MOVEL'C1 '     WSEQ
     C                     ELSE
     C                     MOVEL'B1 '     WSEQ
     C                     ENDIF
      *
      ** Format field :16R: - Start of Block
      *
     C                     MOVEL':16R:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL'CONFPRTY'MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      ** Format :95a: - Party
      *
     C           MGTTYP    IFEQ 'TR'
      *
     C           MGTSTP    IFEQ 'TP'
     C                     MOVEL':SELL//' WMDAT
     C                     ELSE
     C                     MOVEL':BUYR//' WMDAT
     C                     ENDIF
      *
     C                     ELSE
      *
     C           MGTTYP    IFEQ 'DM'
     C           MGTSTP    ANDEQ'RP'
     C           MGTTYP    OREQ 'DM'
     C           MGTSTP    ANDEQ'PD'
      *
     C           MGTTYP    OREQ 'DN'
     C           MGTSTP    ANDEQ'RR'
     C           MGTTYP    OREQ 'DN'
     C           MGTSTP    ANDEQ'PL'
     C                     MOVEL':BUYR//' WMDAT
     C                     ELSE
     C                     MOVEL':SELL//' WMDAT
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     MOVELMGDEST    ZDEST  12
     C                     EXSR SRF95
      *
      ** Format :97A: - Cash Account
      *
     C           MGMTYP    IFEQ '515'
      *
     C           MGSA1L    IFNE *BLANKS
      *
      *
     C                     MOVEL':97A:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL':SAFE//' MDAT
     C           MDAT      CAT  MGSA1L:0  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDIF
      **********                                                                     CSW207 BUG18526
      ***Check*if CSW207 is installed                                                CSW207 BUG18526
      **********                                                                     CSW207 BUG18526
     C********** CSW207    IFEQ 'Y'                                                  CSW207 BUG18526
     C**********           EXSR SRN22F                                               CSW207 BUG18526
     C**********           ENDIF                                                     CSW207 BUG18526
      *
     C           MGAP1L    IFNE *BLANKS
      *
      *
     C                     MOVEL':97A:'   MTAG
      *                                                                                       CSW210
      ** Check if Account for Payment Line 1 IBAN Flag= 'Y'                                   CSW210
      *                                                                                       CSW210
     C           CSW210    IFEQ 'Y'                                                           CSW210
     C           CFT004    ANDEQ'Y'                                                           CSW210
     C           MGFAP1    ANDEQ'Y'                                                           CSW210
     C                     MOVEL':97E:'   MTAG                                                CSW210
     C                     ENDIF                                                              CSW210
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL':CASH//' MDAT
     C           MDAT      CAT  MGAP1L:0  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDIF
      *
     C                     ENDIF
      *                                                                                     BUG18526
      ** Check if CSW207 is installed                                                       BUG18526
      *                                                                                     BUG18526
     C           CSW207    IFEQ 'Y'                                                         BUG18526
     C           WMFID     ANDEQ'Y'                                                         BUG20950
     C                     EXSR SRN22F                                                      BUG18526
     C                     ENDIF                                                            BUG18526
      *
      ** Format :16S: - End of Block
      *
     C                     MOVEL':16S:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL'CONFPRTY'MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      ** If MGINVE is not ZERO , output another Subsequence B1
      *
     C********** MGINVE    IFNE *ZERO                                                         CSD027
     C           MGINVE    IFNE *BLANKS                                                       CSD027
      *
      ** Format :16R: - Start of Block
      *
     C                     MOVEL':16R:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL'CONFPRTY'MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      ** Format :95a: - Party
      *
     C                     MOVEL':INVE//' WMDAT
     C                     MOVELMGINVE    ZDEST  12
      *
     C                     EXSR SRF95
      *
      ** Format :16S: - End of Block
      *
     C                     MOVEL':16S:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL'CONFPRTY'MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDIF
      *
     C                     ENDSR
      *****************************************************************
      /TITLE SR/SRFFIA
      *****************************************************************
      *                                                               *
      *  SRFFIA - Format MT515 Subsequence C2 or MT518 Subsequence B2 *
      *           (Financial Instrument Attributes)                   *
      *                                                               *
      *  Called By: SR/SRCDET                                         *
      *  Calls    :                                                   *
      *                                                               *
      *****************************************************************
      *
     C           SRFFIA    BEGSR
      *
      ** Set up Message Sequence workfield
      *
     C           MGMTYP    IFEQ '515'
     C                     MOVEL'C2 '     WSEQ
     C                     ELSE
     C                     MOVEL'B2 '     WSEQ
     C                     ENDIF
      *
      ** Format :16R: - Start of Block
      *
     C                     MOVEL':16R:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL'FIA'     MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      ** Format :22F: - Method of Interest Computation
      *
     C           MGCPNR    IFNE *ZERO
      *
     C                     MOVEL':22F:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL':MICO//' MDAT
      *
     C                     SELEC
      *
     C           MGDYBS    WHEQ '5'
     C           MGDVBS    ANDEQ'1'
     C           MDAT      CAT  'A001':0  MDAT
      *
     C           MGDYBS    WHEQ '1'
     C           MGDVBS    ANDEQ'2'
     C           MDAT      CAT  'A002':0  MDAT
      *
     C           MGDYBS    WHEQ '5'
     C           MGDVBS    ANDEQ'3'
     C           MDAT      CAT  'A003':0  MDAT
      *
     C           MGDYBS    WHEQ '2'
     C           MGDYBS    OREQ '3'
      *
     C           MGDVBS    IFEQ '1'
     C           MDAT      CAT  'A004':0  MDAT
     C                     ELSE
     C           MGDVBS    IFEQ '2'
     C           MDAT      CAT  'A005':0  MDAT
     C                     ELSE
     C           MGDVBS    IFEQ '3'
     C           MDAT      CAT  'A006':0  MDAT
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C           MGDYBS    WHEQ '1'
     C           MGDVBS    ANDEQ'1'
     C           MDAT      CAT  'A007':0  MDAT
      *
     C                     ENDSL
      *
     C           1         SUBSTMDAT:8    WK1     1                                           248680
     C           WK1       IFEQ *BLANK                                                        248680
     C           MGDYBS    ANDNE*BLANK                                                        248680
     C           MGDVBS    ANDNE*BLANK                                                        248680
     C           MDAT      CAT  'OTHR':0  MDAT                                                248680
     C                     ENDIF                                                              248680
      *                                                                                       248680
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDIF
      *
     C           MGPFRE    IFNE *BLANKS
      *
     C                     MOVEL':22F:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL':PFRE//' MDAT
     C           MDAT      CAT  MGPFRE:0  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDIF
      *
     C           MGPRTP    IFEQ 'Y'
      *
     C                     MOVEL':22F:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL':PAYS//' MDAT
     C           MDAT      CAT  'PART':0  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDIF
      *
      ** Format :11A: - Currency of Denomination
      *
     C                     MOVEL':11A:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL':DENO//' MDAT
     C           MDAT      CAT  WNSWCY:0  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      ** Format :98A: - Date
      *
     C           MGCPNR    IFNE *ZERO
     C           MGNCDT    ANDNE*ZERO
      *
     C                     MOVEL':98A:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
      ** Convert Next Coupon Date CCYYMMDD format
      *
     C                     Z-ADDMGNCDT    ZMDAY
     C                     CALL 'ZM0065'
     C                     PARM           ZMDAY   50
     C                     PARM           ZSDATE  6
     C                     PARM           ZSDATC  8
      *
     C                     MOVEL':COUP//' MDAT
     C           MDAT      CAT  ZSDATC:0  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDIF
      *
     C           MGPROT    IFEQ '3'
     C           MGNRDT    ANDNE*ZERO
      *
     C                     MOVEL':98A:'   MTAG
      *
      ** Convert Next Rate Change Date CCYYMMDD format
      *
     C                     Z-ADDMGNRDT    ZMDAY
     C                     CALL 'ZM0065'
     C                     PARM           ZMDAY   50
     C                     PARM           ZSDATE  6
     C                     PARM           ZSDATC  8
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL':FRNR//' MDAT
     C           MDAT      CAT  ZSDATC:0  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDIF
      *
     C           MGMDAT    IFNE *ZERO
      *
     C                     MOVEL':98A:'   MTAG
      *
      ** Convert Maturity Date CCYYMMDD format
      *
     C                     Z-ADDMGMDAT    ZMDAY
     C                     CALL 'ZM0065'
     C                     PARM           ZMDAY   50
     C                     PARM           ZSDATE  6
     C                     PARM           ZSDATC  8
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
      *
     C                     MOVEL':MATU//' MDAT
     C           MDAT      CAT  ZSDATC:0  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDIF
      *
      ** Format :92A: - Rate
      *
     C           MGCUFC    IFNE *ZERO
     C           MGPROT    ANDEQ'8'
      *
     C                     MOVEL':92A:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
      ** Convert Current Factor to SWIFT format
      *
     C                     Z-ADDMGCUFC    ZPRIC
     C                     MOVE *BLANKS   ZSPRIC
     C                     MOVE *BLANKS   ZOPRIC
     C*
     C                     CALL 'ZM1190'               24
     C                     PARM           ZPRIC
     C                     PARM           ZSPRIC
     C                     PARM           ZOPRIC
      *
      ** If program not found, perform DB Error processing
      *
     C           *IN24     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     Z-ADD017       DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *DB ERROR 017 *
     C                     MOVEL'ZM1190'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     MOVEL':CUFC//' MDAT
     C           MDAT      CAT  ZSPRIC:0  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDIF
      *
     C           MGCPNR    IFNE *ZERO
     C                     MOVEL':92A:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
      ** Convert Coupon Rate to SWIFT format
      *
     C                     Z-ADDMGCPNR    ZPRIC
     C                     MOVE *BLANKS   ZSPRIC
     C                     MOVE *BLANKS   ZOPRIC
     C*
     C                     CALL 'ZM1190'               24
     C                     PARM           ZPRIC
     C                     PARM           ZSPRIC
     C                     PARM           ZOPRIC
      *
      ** If program not found, perform DB Error processing
      *
     C           *IN24     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     Z-ADD018       DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *DB ERROR 018 *
     C                     MOVEL'ZM1190'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     MOVEL':INTR//' MDAT
      *
     C           MDAT      CAT  ZSPRIC:0  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDIF
      *
      ** Output EU witholding tax if present                                                  234140
     C           EUTS      IFNE 0                                                             234140
     C                     MOVEL':70E:'   MTAG                                                234140
     C           ':FIAN//' CAT  'TSMT'    W@15   15                                           234140
     C                     MOVELW@15      MDAT                                                234140
     C           MDAT      CAT  MGSTCY    MDAT                                                234140
      *                                                                                       234140
      ** Convert tax amount to SWIFT format                                                   234140
     C                     Z-ADDEUTS      ZPRIC                                               234140
     C                     MOVE *BLANKS   ZSPRIC                                              234140
     C                     MOVE *BLANKS   ZOPRIC                                              234140
      *                                                                                       234140
     C                     CALL 'ZM1190'               24                                     234140
     C                     PARM           ZPRIC                                               234140
     C                     PARM           ZSPRIC                                              234140
     C                     PARM           ZOPRIC                                              234140
      *                                                                                       234140
     C           MDAT      CAT  ZSPRIC:0  MDAT                                                234140
     C                     END                                                                234140
      *
      ** Format :16S: - End of Block
      *
     C                     MOVEL':16S:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL'FIA'     MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDSR
      *****************************************************************
      /TITLE SR/SRSDET
      *****************************************************************
      *                                                               *
      *  SRSDET - Format Settlement Details for MT515 Sequence D or   *
      *           MF518 Sequence C                                    *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls    :                                                   *
      *                                                               *
      *****************************************************************
      *
     C           SRSDET    BEGSR
      *
      ** Set up Message Sequence workfield
      *
     C           MGMTYP    IFEQ '515'
     C                     MOVEL'D  '     WSEQ
     C                     ELSE
     C                     MOVEL'C  '     WSEQ
     C                     ENDIF
      *
      ** Save the content WSEQ workfield
      *
     C                     MOVE WSEQ      SV@SEQ
      *
      ** Format :16R: - Start of Block
      *
     C                     MOVEL':16R:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL'SETDET'  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     MOVE *BLANK    WFLD07  7
     C                     MOVE *BLANK    WFLD08  4
     C                     MOVEL':SETR//' WFLD07
      *
     C           MGMTYP    IFEQ '515'
     C           MGMTYP    OREQ '518'
     C           MGTTYP    ANDEQ'TR'
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C           CSE006    ANDEQ'Y'                                                           CSW201
      *                                                                                       CSW201
     C                     MOVELMGTNUM    WTDRF   6                                           CSW201
     C           WTDRF     CHAINTRADS                55                                       CSW201
      *                                                                                       CSW201
     C           *IN55     IFEQ *ON                                                           CSW201
     C           *LOCK     IN   LDA                                                           CSW201
     C                     Z-ADD034       DBASE                                               CSW201
     C                     MOVEL'TRADSD'  DBFILE                                              CSW201
     C                     MOVE *BLANKS   DBKEY                                               CSW201
     C                     OUT  LDA                                                           CSW201
     C                     EXSR *PSSR                                                         CSW201
     C                     ELSE                                                               CSW201
      *                                                                                       CSW201
     C           LKRF      IFNE *BLANKS                                                       CSW201
      *                                                                                       CSW201
     C           LKRF      CHAINTRADS                55                                       CSW201
      *                                                                                       CSW201
     C           *IN55     IFEQ *ON                                                           CSW201
     C           *LOCK     IN   LDA                                                           CSW201
     C                     Z-ADD035       DBASE                                               CSW201
     C                     MOVEL'TRADSD'  DBFILE                                              CSW201
     C                     MOVE *BLANKS   DBKEY                                               CSW201
     C                     OUT  LDA                                                           CSW201
     C                     EXSR *PSSR                                                         CSW201
     C                     ELSE                                                               CSW201
      *                                                                                       CSW201
     C           CSW207    IFEQ 'N'                                                           CSW207
     C           MGTSTP    IFEQ 'TP'                                                          CSW201
     C           MGVDAT    ANDLTTDVD                                                          CSW201
     C           MGTSTP    OREQ 'TS'                                                          CSW201
     C           MGVDAT    ANDLTTDVD                                                          CSW201
     C                     MOVEL'BSBO'    WFLD08                                              CSW201
     C                     ELSE                                                               CSW201
     C                     MOVEL'BSBC'    WFLD08                                              CSW201
     C                     ENDIF                                                              CSW201
     C                     ELSE                                                               CSW207
     C                     MOVEL'BSBK'    WFLD08                                              CSW207
     C                     ENDIF                                                              CSW207
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     ELSE                                                               CSW201
      *                                                                                       CSW201
     C                     MOVEL'TRAD'    WFLD08                                              CSW201
      *                                                                                       CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     ELSE                                                               CSW201
      *                                                                                       CSW201
     C                     MOVEL'TRAD'    WFLD08
      *                                                                                       CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     EXSR SRF22F
     C                     ENDIF
      *
     C           MGMTYP    IFEQ '518'
      *
     C           MGTTYP    IFEQ 'DM'
     C           MGTSTP    ANDEQ'RP'
     C           MGTTYP    OREQ 'DM'
     C           MGTSTP    ANDEQ'RR'
     C                     MOVEL'REPO'    WFLD08
     C           CSW202    IFEQ 'Y'                                                           CSW202
     C                     MOVEL'REPU'    WFLD08                                              CSW202
     C                     ENDIF                                                              CSW202
     C                     EXSR SRF22F
     C                     ENDIF
      *
     C           MGTTYP    IFEQ 'DN'
     C           MGTSTP    ANDEQ'RP'
     C           MGTTYP    OREQ 'DN'
     C           MGTSTP    ANDEQ'RR'
     C                     MOVEL'REPC'    WFLD08
     C           CSW202    IFEQ 'Y'                                                           CSW202
     C                     MOVEL'REPU'    WFLD08                                              CSW202
     C                     ENDIF                                                              CSW202
     C                     EXSR SRF22F
     C                     ENDIF
      *
     C           MGTSTP    IFEQ 'BL'
     C           MGTSTP    OREQ 'BB'
     C                     MOVEL'SECL'    WFLD08
     C                     EXSR SRF22F
     C                     ENDIF
      *
     C           CSW208    IFEQ 'Y'                                                           CSW208
     C           MGTSTP    IFEQ 'PD'                                                          CSW208
     C           MGTTYP    ANDEQ'DM'                                                        BUG19907
     C                     MOVEL'COLO'    WFLD08                                            BUG19907
     C                     EXSR SRF22F                                                      BUG19907
     C                     ENDIF                                                            BUG19907
     C           MGTSTP    IFEQ 'PD'                                                        BUG19907
     C           MGTTYP    ANDEQ'DN'                                                        BUG19907
     C                     MOVEL'COLI'    WFLD08                                              CSW208
     C                     EXSR SRF22F                                                        CSW208
     C                     ENDIF                                                              CSW208
     C           MGTSTP    IFEQ 'PL'                                                          CSW208
     C           MGTTYP    ANDEQ'DM'                                                        BUG19907
     C                     MOVEL'COLI'    WFLD08                                            BUG19907
     C                     EXSR SRF22F                                                      BUG19907
     C                     ENDIF                                                            BUG19907
     C           MGTSTP    IFEQ 'PL'                                                        BUG19907
     C           MGTTYP    ANDEQ'DN'                                                        BUG19907
     C                     MOVEL'COLO'    WFLD08                                              CSW208
     C                     EXSR SRF22F                                                        CSW208
     C                     ENDIF                                                              CSW208
     C                     ELSE                                                               CSW208
     C           MGTSTP    IFEQ 'PD'
     C           MGTSTP    OREQ 'PL'
     C                     MOVEL'COLL'    WFLD08
     C                     EXSR SRF22F
     C                     ENDIF
     C                     ENDIF                                                              CSW208
      *
     C                     ENDIF
      *
      ** GTDL is processed in sequence 'C' since SWIFT 1999 changes       CSW200
      *                                                                   CSW200
     C           CSW200    IFNE 'CSW200'                                  CSW200
     C                     MOVEL':STCO//' WFLD07
     C           MGPCOD    IFEQ '5'
     C                     MOVEL'GTDL'    WFLD08
     C                     EXSR SRF22F
     C                     ENDIF
     C                     ENDIF                                          CSW200
      *
     C           CSW203    IFEQ 'Y'                                                           CSW203
     C                     MOVEL':STCO//' WFLD07                                              CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
     C           MGINSS    IFEQ 'PHYSI'
     C                     MOVEL'PHYS'    WFLD08
     C                     EXSR SRF22F
     C                     ENDIF
      *                                                                                       CSW203
     C           CSW203    IFEQ 'Y'                                                           CSW203
      *                                                                                       CSW203
     C                     MOVELMGTNUM    WKTNUM  6                                           CSW203
      *                                                                                       CSW203
     C           WKTNUM    CHAINTRADSDY1             48                                       CSW203
      *                                                                                       CSW203
      ** STAM Qualifier                                                                       CSW203
      *                                                                                       CSW203
     C           T1STMP    IFNE *BLANKS                                                       CSW203
      *                                                                                       CSW203
     C                     MOVELT2PSET    @KEY                                                CSW203
     C                     MOVE *BLANKS   WMPRAC                                              CSW203
      *                                                                                       CSW203
      ** Get customer details via access object                                               CSW203
      *                                                                                       CSW203
     C*********************CALL 'AOCUSTR0'                                              CSW203CSW036
     C                     CALL 'AOCUSTR1'                                                    CSW036
     C                     PARM *BLANKS   @RTCD                                               CSW203
     C                     PARM '*KEY   ' @OPTN                                               CSW203
     C                     PARM           @KEY                                                CSW203
     C                     PARM *BLANKS   @KYST                                               CSW203
     C***********SDCUST    PARM SDCUST    DSSDY                                         CSW203CSW036
     C           SDCUST    PARM SDCUST    DSLDY                                               CSW036
      *                                                                                       CSW203
     C           @RTCD     IFEQ *BLANKS                                                       CSW203
     C           BBCSI2    IFNE *BLANKS                                                       CSW036
     C           CSW036    ANDEQ'Y'                                                           CSW036
     C                     MOVELBBCSI2    WMPRAC                                              CSW036
     C                     ELSE                                                               CSW036
     C                     MOVELBBCSID    WMPRAC                                              CSW203
     C                     ENDIF                                                              CSW036
     C                     ELSE                                                               CSW203
      *                                                                                       CSW203
     C                     MOVELT2PSET    WMPRAC                                              CSW203
      *                                                                                       CSW203
     C                     CALL 'ME1400'                                                      CSW203
     C                     PARM *BLANKS   PRTCD                                               CSW203
     C                     PARM           WBICCD                                              CSW203
     C                     PARM           WBICBR                                              CSW203
     C                     PARM           SDCUST                                              CSW203
     C                     PARM           SDCNST                                              CSW203
     C                     PARM           MEBICD                                              CSW203
     C                     PARM *BLANKS   W9CUST  1                                           CSW203
     C                     PARM *BLANKS   W9CNST  1                                           CSW203
     C                     PARM *BLANKS   W9BICD  1                                           CSW203
      *                                                                                       CSW203
     C           PRTCD     IFEQ *BLANKS                                                       CSW203
     C                     MOVELT2PSET    WMPRAC                                              CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
     C                     SELEC                                                              CSW203
     C           WKMRPR    WHEQ 'GB'                                                          CSW203
     C                     MOVEL'CRST'    WRKDSS  4                                           CSW203
     C           WKMRPR    WHEQ 'AU'                                                          CSW203
     C                     MOVEL'XASX'    WRKDSS                                              CSW203
     C           WKMRPR    WHEQ 'ZA'                                                          CSW203
     C                     MOVEL'STRA'    WRKDSS                                              CSW203
     C                     ENDSL                                                              CSW203
      *                                                                                       CSW203
     C                     MOVEL':22F:'   MTAG                                                CSW203
      *                                                                                       CSW203
      ** Access tag description                                                               CSW203
      *                                                                                       CSW203
     C                     EXSR SRMTAG                                                        CSW203
      *                                                                                       CSW203
     C                     MOVEL':STAM/'  MDAT                                                CSW203
     C                     CAT  WRKDSS:0  MDAT                                                CSW203
     C                     CAT  '/':0     MDAT                                                CSW203
     C                     CAT  T1STMP:0  MDAT                                                CSW203
     C                     MOVELMDAT      RDAT                                                CSW203
      *                                                                                       CSW203
      ** Access the next occurence in MULT                                                    CSW203
      *                                                                                       CSW203
     C                     ADD  1         X                                                   CSW203
     C           X         OCUR MULT                                                          CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
      ** NRTG/YRTG Qualifier                                                                  CSW203
      *                                                                                       CSW203
     C           T1INSS    IFEQ 'NRTG'                                                        CSW203
     C           T1INSS    OREQ 'YRTG'                                                        CSW203
     C                     MOVEL':RTGS//' WFLD07                                              CSW203
     C                     MOVELT1INSS    WFLD08                                              CSW203
     C                     EXSR SRF22F                                                        CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
      ** REGT Qualifier                                                                       CSW203
      *                                                                                       CSW203
     C           T1SIOR    IFEQ 'Y'                                                           CSW203
     C           T1SIOR    OREQ 'N'                                                           CSW203
     C                     MOVEL':REGT//' WFLD07                                              CSW203
     C           T1SIOR    CAT  'REG':0   WFLD08                                              CSW203
     C                     EXSR SRF22F                                                        CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
      ** Status Codes                                                                         CSW203
      *                                                                                       CSW203
     C           T1NEW     IFEQ 'Y'                                                           CSW203
      *                                                                                       CSW203
     C                     MOVE *OFF      *IN47                                               CSW203
     C                     MOVE 'N'       WPASS                                               CSW203
     C                     MOVELT2FIN1    WT2FIN                                              CSW203
      *                                                                                       CSW203
     C           W01CHR    IFEQ '*'                                                           CSW203
     C                     MOVE *ON       *IN47                                               CSW203
     C                     Z-ADD2         W1      30                                          CSW203
     C                     Z-ADD0         WSTORE                                              CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
     C           *IN47     DOWEQ*ON                                                           CSW203
      *                                                                                       CSW203
     C                     MOVE 'N'       WFMT    1                                           CSW203
      *                                                                                       CSW203
     C           '*'       SCAN WT2FIN:W1 WS      30     47                                   CSW203
      *                                                                                       CSW203
     C           *IN47     IFEQ *ON                                                           CSW203
     C                     MOVEL*BLANKS   WDAT   30                                           CSW203
     C           WS        SUB  W1        WSTART  30                                          CSW203
     C           WSTART    SUBSTWT2FIN:W1 WDAT                                                CSW203
     C                     MOVE 'Y'       WFMT                                                CSW203
     C                     ELSE                                                               CSW203
     C           WPASS     IFEQ 'Y'                                                           CSW203
     C                     MOVEL*BLANKS   WDAT                                                CSW203
     C                     Z-ADDWSTORE    WS                                                  CSW203
     C           1         SUBSTT2FIN1:WS WVAR    1                                           CSW203
     C           WVAR      IFEQ '*'                                                           CSW203
     C                     ADD  1         WS                                                  CSW203
     C                     ENDIF                                                              CSW203
     C           36        SUB  WS        WSTART                                              CSW203
     C           WSTART    SUBSTT2FIN1:WS WDAT                                                CSW203
     C                     MOVE 'Y'       WFMT                                                CSW203
     C                     MOVE 'N'       WPASS                                               CSW203
     C                     ENDIF                                                              CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
     C           WFMT      IFEQ 'Y'                                                           CSW203
     C                     MOVEL':22F:'   MTAG                                                CSW203
      *                                                                                       CSW203
      ** Access tag description                                                               CSW203
      *                                                                                       CSW203
     C                     EXSR SRMTAG                                                        CSW203
      *                                                                                       CSW203
     C           ':'       CAT  WDAT:0    MDAT                                                CSW203
     C                     MOVELMDAT      RDAT                                                CSW203
      *                                                                                       CSW203
      ** Access the next occurence in MULT                                                    CSW203
      *                                                                                       CSW203
     C                     ADD  1         X                                                   CSW203
     C           X         OCUR MULT                                                          CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
     C           *IN47     IFEQ *ON                                                           CSW203
     C           '*'       SCAN WT2FIN:W1 WS             47                                   CSW203
      *                                                                                       CSW203
     C           *IN47     IFEQ *ON                                                           CSW203
     C                     MOVEL*BLANKS   WTFIN2 35                                           CSW203
     C                     MOVELWT2FIN    WTFIN2                                              CSW203
     C                     MOVEL*BLANKS   WT2FIN                                              CSW203
     C           36        SUB  WS        WSTART                                              CSW203
     C           WSTART    SUBSTWTFIN2:WS WT2FIN                                              CSW203
     C                     MOVE 'Y'       WPASS   1                                           CSW203
     C                     ADD  WS        WSTORE  30                                          CSW203
     C                     ENDIF                                                              CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
     C                     ENDDO                                                              CSW203
      *                                                                                       CSW203
     C                     MOVE *OFF      *IN47                                               CSW203
     C                     MOVE 'N'       WPASS                                               CSW203
     C                     MOVELT2FIN2    WT2FIN                                              CSW203
      *                                                                                       CSW203
     C           W01CHR    IFEQ '*'                                                           CSW203
     C                     MOVE *ON       *IN47                                               CSW203
     C                     Z-ADD2         W1                                                  CSW203
     C                     Z-ADD0         WSTORE                                              CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
     C           *IN47     DOWEQ*ON                                                           CSW203
      *                                                                                       CSW203
     C                     MOVE 'N'       WFMT                                                CSW203
      *                                                                                       CSW203
     C           '*'       SCAN WT2FIN:W1 WS             47                                   CSW203
      *                                                                                       CSW203
     C           *IN47     IFEQ *ON                                                           CSW203
     C                     MOVEL*BLANKS   WDAT                                                CSW203
     C           WS        SUB  W1        WSTART                                              CSW203
     C           WSTART    SUBSTWT2FIN:W1 WDAT                                                CSW203
     C                     MOVE 'Y'       WFMT                                                CSW203
     C                     ELSE                                                               CSW203
     C           WPASS     IFEQ 'Y'                                                           CSW203
     C                     MOVEL*BLANKS   WDAT                                                CSW203
     C                     Z-ADDWSTORE    WS                                                  CSW203
     C           1         SUBSTT2FIN2:WS WVAR                                                CSW203
     C           WVAR      IFEQ '*'                                                           CSW203
     C                     ADD  1         WS                                                  CSW203
     C                     ENDIF                                                              CSW203
     C           36        SUB  WS        WSTART                                              CSW203
     C           WSTART    SUBSTT2FIN2:WS WDAT                                                CSW203
     C                     MOVE 'Y'       WFMT                                                CSW203
     C                     MOVE 'N'       WPASS                                               CSW203
     C                     ENDIF                                                              CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
     C           WFMT      IFEQ 'Y'                                                           CSW203
     C                     MOVEL':22F:'   MTAG                                                CSW203
      *                                                                                       CSW203
      ** Access tag description                                                               CSW203
      *                                                                                       CSW203
     C                     EXSR SRMTAG                                                        CSW203
      *                                                                                       CSW203
     C           ':'       CAT  WDAT:0    MDAT                                                CSW203
     C                     MOVELMDAT      RDAT                                                CSW203
      *                                                                                       CSW203
      ** Access the next occurence in MULT                                                    CSW203
      *                                                                                       CSW203
     C                     ADD  1         X                                                   CSW203
     C           X         OCUR MULT                                                          CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
     C           *IN47     IFEQ *ON                                                           CSW203
     C           '*'       SCAN WT2FIN:W1 WS             47                                   CSW203
      *                                                                                       CSW203
     C           *IN47     IFEQ *ON                                                           CSW203
     C                     MOVEL*BLANKS   WTFIN2                                              CSW203
     C                     MOVELWT2FIN    WTFIN2                                              CSW203
     C                     MOVEL*BLANKS   WT2FIN                                              CSW203
     C           36        SUB  WS        WSTART                                              CSW203
     C           WSTART    SUBSTWTFIN2:WS WT2FIN                                              CSW203
     C                     MOVE 'Y'       WPASS                                               CSW203
     C                     ADD  WS        WSTORE                                              CSW203
     C                     ENDIF                                                              CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
     C                     ENDDO                                                              CSW203
      *                                                                                       CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
     C           CSW203    IFEQ 'N'                                                           CSW203
      *                                                                                       CSW201
      ** S.W.I.F.T. 2001: Format 17B: Accrued Interest Flag                                   CSW201
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
      *                                                                                       CSW201
     C           MGCPNR    IFNE *ZEROS                                                        CSW201
     C                     MOVEL':17B:'   MTAG                                                CSW201
     C                     EXSR SRMTAG                                                        CSW201
     C                     MOVEL':ACRU//Y'MDAT                                                CSW201
     C                     MOVELMDAT      RDAT                                                CSW201
      *                                                                                       CSW201
      ** Access the next occurence in MULT                                                    CSW201
     C                     ADD  1         X                                                   CSW201
     C           X         OCUR MULT                                                          CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     ELSE                                                               CSW201
      *
      ** Format :17B: - Instruction Override
      *
     C                     MOVEL':17B:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL':STAN//' MDAT
      *
     C           MGSTAN    IFNE *BLANKS
     C           MDAT      CAT  MGSTAN:0  MDAT
     C                     ELSE
     C           MDAT      CAT  'N':0     MDAT
     C                     ENDIF
      *
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *                                                                                       CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW203
     C                     ENDIF                                                              CSW203
      *
      ** Format Settlement Parties only if MGDSSN or MGRSSS is not blank
      *
     C           MGDSSN    IFNE *BLANKS
     C           MGRSSN    ORNE *BLANKS
      *
     C           MGMTYP    IFEQ '515'
     C                     EXSR SR5SPY
     C                     ENDIF
      *
     C           MGMTYP    IFEQ '518'
     C                     EXSR SR8SPY
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** Format MT515 Subsequence D2 or MT518 Subsequence C2
      *
     C           MGAWIN    IFNE *BLANKS
     C           MGBOFN    ORNE *BLANKS
     C           MGDIDN    ORNE *BLANKS                                                       CSW210
     C           MGDAD1    ORNE *BLANKS                                                       CSW210
     C                     EXSR SRCSHP
     C                     ENDIF
      *
      ** Format MT515 Subsequence D3 or MT518 Subsequence C3
      *
     C                     EXSR SRFAMT
      *
      ** Restore the old value WSEQ
      *
     C                     MOVE SV@SEQ    WSEQ
      *
      ** Format :16S: - End of Block
     C                     MOVEL':16S:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL'SETDET'  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDSR
      *****************************************************************
      /TITLE SR/SRF22F
      *****************************************************************
      *                                                               *
      *  SRF22F - Subroutine to format tag :22F:                      *
      *                                                               *
      *  Called By: SR/SRSDET                                         *
      *  Calls    :                                                   *
      *                                                               *
      *****************************************************************
      *
     C           SRF22F    BEGSR
      *
     C                     MOVEL':22F:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVELWFLD07    MDAT
     C           MDAT      CAT  WFLD08:0  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDSR
      *****************************************************************
      *****************************************************************                       CSW207
      /TITLE SR/SRN22F                                                                        CSW207
      *****************************************************************                       CSW207
      *                                                               *                       CSW207
      *  SRN22F - Subroutine to format tag :22F:                      *                       CSW207
      *                                                               *                       CSW207
      *****************************************************************                       CSW207
      *                                                                                       CSW207
     C           SRN22F    BEGSR                                                              CSW207
      *                                                                                       CSW207
     C                     MOVEL'N'       WFINCA                                              CSW207
     C                     MOVEL'N'       WFTRCA                                              CSW207
      *                                                                                       CSW207
      ** Check if 22F will be formatted for INCA                                              CSW207
      *                                                                                       CSW207
     C           MGDEST    IFNE *ZEROS                                                        CSW207
     C                     MOVE MGDEST    WCUST   6                                           CSW207
     C**********           CALL 'AOCUSTR1'                                           CSW207 BUG21097
     C                     CALL 'AOCSSWR0'                                                  BUG21097
     C                     PARM *BLANKS   @RTCD                                               CSW207
     C                     PARM '*KEY   ' @OPTN                                               CSW207
     C                     PARM WCUST     @KEY                                                CSW207
     C                     PARM *BLANKS   @KYST                                               CSW207
     C********** SDCUST    PARM SDCUST    DSLDY                                      CSW207 BUG21097
     C                     PARM           DSLDY                                             BUG21097
      *                                                                                       CSW207
      ** Database Error                                                                       CSW207
      *                                                                                       CSW207
     C           @RTCD     IFNE *BLANKS                                                       CSW207
     C           *LOCK     IN   LDA                                                           CSW207
     C                     Z-ADD024       DBASE            ***************                    CSW207
     C                     MOVEL'SDCUSTPD'DBFILE           *DB ERROR 024 *                    CSW207
     C                     MOVE @KEY      DBKEY            ***************                    CSW207
     C                     OUT  LDA                                                           CSW207
     C                     EXSR *PSSR                                                         CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
      ** extract SDCUSTPD and SDCSSWPD                                                        CSW207
      *                                                                                       CSW207
     C                     MOVEL'SDCUSTPD'P#FILN                                              CSW207
     C                     EXSR GETRCL                                                        CSW207
     C           P#RCDL    SUBSTDSLDY     SDCUST                                              CSW207
     C           P#RCDL    ADD  1         S       50                                          CSW207
      *                                                                                       CSW207
     C                     MOVEL'SDCSSWPD'P#FILN                                              CSW207
     C                     EXSR GETRCL                                                        CSW207
     C           P#RCDL    SUBSTDSLDY:S   SDCSSW                                              CSW207
      *                                                                                       CSW207
      ** If location code is not blank, check location code.                                  261402
      ** Otherwise, flag as not MiFID compliant.                                              261402
      *                                                                                       261402
     C           A8LCCD    IFNE *BLANKS                                                       261402
      *                                                                                       261402
     C                     CALL 'AOLOCNR0'                                                    CSW207
     C                     PARM *BLANKS   @RTCD                                               CSW207
     C                     PARM '*KEY   ' @OPTN                                               CSW207
     C                     PARM A8LCCD    @LOCN   3                                           CSW207
     C           SDLOCN    PARM SDLOCN    DSFDY                                               CSW207
      *                                                                                       CSW207
      ** Database error proceesing                                                            CSW207
      *                                                                                       CSW207
     C           @RTCD     IFNE *BLANKS                                                       CSW207
     C           *LOCK     IN   LDA                                                           CSW207
     C                     Z-ADD023       DBASE            ***************                    CSW207
     C                     MOVEL'SDLOCNPD'DBFILE           *DB ERROR 023 *                    CSW207
     C                     MOVE @LOCN     DBKEY            ***************                    CSW207
     C                     OUT  LDA                                                           CSW207
     C                     EXSR *PSSR                                                         CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
     C           DVCNCD    CHAINMEISOCL1             56                                       CSW207
     C           M3MFID    IFEQ 'Y'                                                           CSW207
     C           BFCLAS    ANDEQ'S'                                                           CSW207
     C           M3MFID    OREQ 'Y'                                                           CSW207
     C           BFCLAS    ANDEQ'D'                                                           CSW207
     C                     MOVEL'Y'       WFINCA                                              CSW207
     C                     ENDIF                                                              CSW207
     C           M3MFID    IFEQ 'Y'                                                           CSW207
     C           BFCLAS    ANDEQ'M'                                                           CSW207
     C                     MOVEL'Y'       WFTRCA                                              CSW207
     C                     ENDIF                                                              CSW207
     C                     ELSE                                                               261402
     C                     MOVE 'N'       M3MFID                                              261402
     C                     ENDIF                                                              261402
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
      ** Format field :22F:                                                                   CSW207
      *                                                                                       CSW207
     C           WFINCA    IFEQ 'Y'                                                           CSW207
     C           CSCICI    ANDNE*BLANKS                                                     BUG18526
     C                     MOVEL':22F:'   MTAG                                                CSW207
     C                     EXSR SRMTAG                                                        CSW207
     C                     MOVEL':INCA//' MDAT                                                CSW207
     C           MDAT      CAT  CSCICI:0  MDAT                                                CSW207
     C                     MOVELMDAT      RDAT                                                CSW207
     C                     ADD  1         X                                                   CSW207
     C           X         OCUR MULT                                                          CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
     C           WFTRCA    IFEQ 'Y'                                                           CSW207
     C           CSCPCI    ANDNE*BLANKS                                                     BUG18526
     C                     MOVEL':22F:'   MTAG                                                CSW207
     C                     EXSR SRMTAG                                                        CSW207
     C           ':TRCA//' CAT  CSCPCI:0  MDAT                                                CSW207
     C                     MOVELMDAT      RDAT                                                CSW207
     C                     ADD  1         X                                                   CSW207
     C           X         OCUR MULT                                                          CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
     C                     ENDSR                                                              CSW207
      *****************************************************************                       CSW207
      /TITLE SR/SR5SPY
      *****************************************************************
      *                                                               *
      *  SR5SPY - Format MT515 Subsequence D1 - Settlement Parties    *
      *                                                               *
      *  Called By: SR/SRSDET                                         *
      *  Calls    :                                                   *
      *                                                               *
      *****************************************************************
      *
     C           SR5SPY    BEGSR
      *
      ** Set up Message Sequence workfield
      *
     C                     MOVEL'D1 '     WSEQ
      *
      ** Format :16R: - Start of Block
      *
     C                     MOVEL':16R:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL'SETPRTY' MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      ** Format field :95a: - Party ('a' can be 'P' or 'Q')
      *
     C                     MOVE *BLANKS   WMDAT   7
     C                     MOVE *BLANK    ERR95   1
      *
      ** If Trans Sub-Type = 'TP', format Deliverer of Securities
      *
     C           MGTSTP    IFEQ 'TP'
      *
     C           MGDSSN    IFNE *BLANK
     C                     MOVEL':DEAG//' WMDAT
     C                     MOVELMGDSSN    ZDEST  12
     C                     ELSE
     C                     MOVELERRA,10   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       ERR95
     C                     ENDIF
      *
      ** Otherwise ('TS'), format Receiver of Securities
      *
     C                     ELSE
      *
     C           MGRSSN    IFNE *BLANK
     C                     MOVEL':REAG//' WMDAT
     C                     MOVELMGRSSN    ZDEST  12
     C                     ELSE
     C                     MOVELERRA,11   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       ERR95
     C                     ENDIF
      *
     C                     ENDIF
      *
     C           ERR95     IFNE 'Y'
     C                     EXSR SRF95
     C                     ELSE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     ENDIF
      *
      ** Format field :97A: - Safekeeping Account
      *
     C           MGSA1L    IFNE *BLANKS
      *
     C                     MOVEL':97A:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL':SAFE//' MDAT
     C           MDAT      CAT  MGSA1L:0  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ELSE
      *
     C           MGTSTP    IFEQ 'TP'
     C           MGDSS1    ANDNE*BLANKS
      *
     C                     MOVEL':97A:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL':SAFE//' MDAT
     C           MDAT      CAT  MGDSS1:0  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDIF
      *
     C           MGTSTP    IFEQ 'TS'
     C           MGRSS1    ANDNE*BLANKS
      *
     C                     MOVEL':97A:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL':SAFE//' MDAT
     C           MDAT      CAT  MGRSS1:0  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** Format :16S: - End of Block
      *
     C                     MOVEL':16S:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL'SETPRTY' MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDSR
      *****************************************************************
      /TITLE SR/SR8SPY
      *****************************************************************
      *                                                               *
      *  SR8SPY - Format MT518 Subsequence C1 - Settlement Parties    *
      *                                                               *
      *  Called By: SR/SRSDET                                         *
      *  Calls    :                                                   *
      *                                                               *
      *****************************************************************
      *
     C           SR8SPY    BEGSR
      *
      ** Set up Message Sequence workfield
      *
     C                     MOVEL'C1 '     WSEQ
      *
      ** If Deliverer of Securities is not blank
      *
     C           MGDSSN    IFNE *BLANKS
      *
      ** Format :16R: - Start of Block
     C                     MOVEL':16R:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL'SETPRTY' MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      ** Format field :95a: - Party ('a' can be 'P' or 'Q')
      *
     C                     MOVEL':DEAG//' WMDAT   7
     C                     MOVELMGDSSN    ZDEST  12
      *
     C                     EXSR SRF95
      *
      ** Format field :97A: - Safekeeping Account
      *
     C           MGDSS1    IFNE *BLANKS
      *
     C                     MOVEL':97A:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL':SAFE//' MDAT
     C           MDAT      CAT  MGDSS1:0  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ELSE
      *
     C           MGSA1L    IFNE *BLANKS
      *
     C                     MOVEL':97A:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL':SAFE//' MDAT
     C           MDAT      CAT  MGSA1L:0  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDIF
     C                     ENDIF
      *
      ** Format :16S: - End of Block
      *
     C                     MOVEL':16S:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL'SETPRTY' MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDIF
      *
     C           MGRSSN    IFNE *BLANKS
      *
      ** Format :16R: - Start of Block
      *
     C                     MOVEL':16R:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL'SETPRTY' MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      ** Format field :95a: - Party ('a' can be 'P' or 'Q')
      *
     C                     MOVEL':REAG//' WMDAT   7
     C                     MOVELMGRSSN    ZDEST  12
      *
     C                     EXSR SRF95
      *
      ** Format field :97A: - Safekeeping Account
      *
     C           MGRSS1    IFNE *BLANKS
      *
     C                     MOVEL':97A:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL':SAFE//' MDAT
     C           MDAT      CAT  MGRSS1:0  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDIF
      *
      ** Format :16S: - End of Block
      *
     C                     MOVEL':16S:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL'SETPRTY' MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDIF
      *
     C                     ENDSR
      *****************************************************************
      /TITLE SR/SRCSHP
      *****************************************************************
      *                                                               *
      *  SRCSHP - Format MT515 Subsequence D2 or MT518 Subsequence C2 *
      *           (Cash Parties)                                      *
      *                                                               *
      *  Called By: SR/SRSDET                                         *
      *  Calls    :                                                   *
      *                                                               *
      *****************************************************************
      *
     C           SRCSHP    BEGSR
      *
      ** Set up Message Sequence workfield
      *
     C           MGMTYP    IFEQ '515'
     C                     MOVEL'D2 '     WSEQ
     C                     ELSE
     C                     MOVEL'C2 '     WSEQ
     C                     ENDIF
      *
      ** If "Account with Institution" is present
     C           MGAWIN    IFNE *BLANKS
      *
      ** Format :16R: - Start of Block
     C                     MOVEL':16R:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL'CSHPRTY' MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      ** Format field :95a: - Party ('a' can be 'P', 'R' or 'Q')
      *
     C                     MOVE *BLANK    W#95R   1
      *
      ** If A/c with Inst Issuer Code is present, format tag :95R:
     C           MGAWIC    IFNE *BLANKS
      *
      ** Move 'Y' to field :95R: is output indicator
      *
     C                     MOVE 'Y'       W#95R
      *
     C                     MOVEL':95R:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *                                                                                     AR589164
     C                     MOVE *BLANKS   LGDSS  10                                         AR589164
      *                                                                                     AR589164
     C           MGNMCY    IFEQ 'EUR'                                                       AR589164
     C           MGAWIC    IFEQ 'LATI'                                                      AR589164
     C                     MOVEL'IBRCLATI'LGDSS                                             AR589164
     C                     ENDIF                                                            AR589164
     C                     ENDIF                                                            AR589164
      *                                                                                     AR589164
     C           MGNMCY    IFEQ 'USD'                                                       AR589164
     C                     SELEC                                                            AR589164
     C           MGAWIC    WHEQ 'USCH'                                                      AR589164
     C                     MOVEL'NYCHUSCH'LGDSS                                             AR589164
     C           MGAWIC    WHEQ 'USCP'                                                      AR589164
     C                     MOVEL'NYCHUSCP'LGDSS                                             AR589164
     C           MGAWIC    WHEQ 'FINS'                                                      AR589164
     C                     MOVEL'DTCYFINS'LGDSS                                             AR589164
     C           MGAWIC    WHEQ 'PART'                                                      AR589164
     C                     MOVEL'DTCYPART'LGDSS                                             AR589164
     C           MGAWIC    WHEQ 'USER'                                                      AR589164
     C                     MOVEL'DTCYUSER'LGDSS                                             AR589164
     C           MGAWIC    WHEQ 'ID  '                                                      AR589164
     C                     MOVEL'DTCYID'  LGDSS                                             AR589164
     C                     ENDSL                                                            AR589164
     C                     ENDIF                                                            AR589164
      *
     C                     MOVEL':ACCW/'  MDAT
     C           LGDSS     IFEQ *BLANKS                                                     AR589164
     C           MDAT      CAT  MGAWIC:0  MDAT
     C                     ELSE                                                             AR589164
     C           MDAT      CAT  LGDSS:0   MDAT                                              AR589164
     C                     ENDIF                                                            AR589164
     C           MDAT      CAT  '/':0     MDAT
     C           MDAT      CAT  MGAWIL:0  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ELSE
      *
     C                     MOVEL':ACCW//' WMDAT   7
     C                     MOVELMGAWIN    ZDEST  12
      *
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C                     MOVE 'Y'       ZDBEI                                               CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     EXSR SRF95
      *                                                                                       CSW201
     C                     MOVE ' '       ZDBEI                                               CSW201
      *
     C                     ENDIF
      *
      ** Format field :97A: - Safekeeping Account
      *
     C           MGAWIL    IFNE *BLANKS
     C           W#95R     ANDNE'Y'
      *
     C                     MOVEL':97A:'   MTAG
      *                                                                                       CSW210
      ** Check if Account with Institution Line IBAN Flag = 'Y'                               CSW210
      *                                                                                       CSW210
     C           CSW210    IFEQ 'Y'                                                           CSW210
     C           CFT004    ANDEQ'Y'                                                           CSW210
     C           MGFAI1    ANDEQ'Y'                                                           CSW210
     C                     MOVEL':97E:'   MTAG                                                CSW210
     C                     ENDIF                                                              CSW210
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL':CASH//' MDAT
     C           MDAT      CAT  MGAWIL:0  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDIF
      *
      ** Format :16S: - End of Block
     C                     MOVEL':16S:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL'CSHPRTY' MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDIF
      *
      ** If "Beneficiary of Money" is present
     C           MGBOFN    IFNE *BLANKS
      *
      ** Format :16R: - Start of Block
      *
     C                     MOVEL':16R:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL'CSHPRTY' MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      ** Format field :95a: - Party ('a' can be 'P', 'R' or 'Q')
      *
     C                     MOVE *BLANK    W#95R   1
      *
      ** If Ben of Money Issuer Code is present, format tag :95R:
     C           MGBOFC    IFNE *BLANKS
      *
      ** Move 'Y' to field :95R: is output indicator
      *
     C                     MOVE 'Y'       W#95R
      *
     C                     MOVEL':95R:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *                                                                                     AR589164
     C                     MOVE *BLANKS   LGDSS  10                                         AR589164
      *                                                                                     AR589164
     C           MGNMCY    IFEQ 'EUR'                                                       AR589164
     C           MGBOFC    IFEQ 'LATI'                                                      AR589164
     C                     MOVEL'IBRCLATI'LGDSS                                             AR589164
     C                     ENDIF                                                            AR589164
     C                     ENDIF                                                            AR589164
      *                                                                                     AR589164
     C           MGNMCY    IFEQ 'USD'                                                       AR589164
     C                     SELEC                                                            AR589164
     C           MGBOFC    WHEQ 'USCH'                                                      AR589164
     C                     MOVEL'NYCHUSCH'LGDSS                                             AR589164
     C           MGBOFC    WHEQ 'USCP'                                                      AR589164
     C                     MOVEL'NYCHUSCP'LGDSS                                             AR589164
     C           MGBOFC    WHEQ 'FINS'                                                      AR589164
     C                     MOVEL'DTCYFINS'LGDSS                                             AR589164
     C           MGBOFC    WHEQ 'PART'                                                      AR589164
     C                     MOVEL'DTCYPART'LGDSS                                             AR589164
     C           MGBOFC    WHEQ 'USER'                                                      AR589164
     C                     MOVEL'DTCYUSER'LGDSS                                             AR589164
     C           MGBOFC    WHEQ 'ID  '                                                      AR589164
     C                     MOVEL'DTCYID'  LGDSS                                             AR589164
     C                     ENDSL                                                            AR589164
     C                     ENDIF                                                            AR589164
      *
     C                     MOVEL':BENM/'  MDAT
     C           LGDSS     IFEQ *BLANKS                                                     AR589164
     C           MDAT      CAT  MGBOFC:0  MDAT
     C                     ELSE                                                             AR589164
     C           MDAT      CAT  LGDSS:0   MDAT                                              AR589164
     C                     ENDIF                                                            AR589164
     C           MDAT      CAT  '/':0     MDAT
     C           MDAT      CAT  MGBOF1:0  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ELSE
      *
     C                     MOVEL':BENM//' WMDAT   7
     C                     MOVELMGBOFN    ZDEST  12
      *
     C                     EXSR SRF95
      *
     C                     ENDIF
      *
      ** Format field :97A: - Safekeeping Account
      *
     C           MGBOF1    IFNE *BLANKS
     C           W#95R     ANDNE'Y'
      *
     C                     MOVEL':97A:'   MTAG
      *                                                                                       CSW210
      ** Check if Beneficiary of Money Line IBAN Flag = 'Y'                                   CSW210
      *                                                                                       CSW210
     C           CSW210    IFEQ 'Y'                                                           CSW210
     C           CFT004    ANDEQ'Y'                                                           CSW210
     C           MGFBF1    ANDEQ'Y'                                                           CSW210
     C                     MOVEL':97E:'   MTAG                                                CSW210
     C                     ENDIF                                                              CSW210
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL':CASH//' MDAT
     C           MDAT      CAT  MGBOF1:0  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDIF
      *
      ** Format :16S: - End of Block
     C                     MOVEL':16S:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL'CSHPRTY' MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDIF
      *
     C           CSW210    IFEQ 'Y'                                                           CSW210
      *                                                                                       CSW210
     C           MGDIDN    IFNE *BLANKS                                                       CSW210
     C           MGDAD1    ORNE *BLANKS                                                       CSW210
     C           MGDLIN    ORNE *BLANKS                                                       CSW210
      *                                                                                       CSW210
      ** Format :16R: - Start of Block                                                        CSW210
     C                     MOVEL':16R:'   MTAG                                                CSW210
      *                                                                                       CSW210
      ** Access tag description                                                               CSW210
      *                                                                                       CSW210
     C                     EXSR SRMTAG                                                        CSW210
      *                                                                                       CSW210
     C                     MOVEL'CSHPRTY' MDAT                                                CSW210
     C                     MOVELMDAT      RDAT                                                CSW210
      *                                                                                       CSW210
      ** Access the next occurence in MULT                                                    CSW210
      *                                                                                       CSW210
     C                     ADD  1         X                                                   CSW210
     C           X         OCUR MULT                                                          CSW210
      *                                                                                       CSW210
      ** Format field :95a: - Party ('a' can be 'P', 'R' or 'Q')                              CSW210
      ** Check as Debtor ID                                                                   CSW210
      *                                                                                       CSW210
     C           MGDIDN    IFNE *BLANKS                                                       CSW210
     C           MGDAD1    ANDEQ*BLANKS                                                       CSW210
     C                     MOVEL':DEBT//' WMDAT                                               CSW210
     C                     MOVELMGDIDN    ZDEST                                               CSW210
      *                                                                                       CSW210
     C           CSW201    IFEQ 'Y'                                                           CSW210
     C                     MOVE 'Y'       ZDBEI                                               CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
     C                     EXSR SRF95                                                         CSW210
      *                                                                                       CSW210
     C                     MOVE ' '       ZDBEI                                               CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
      ** Check as SWIFT address                                                               CSW210
      *                                                                                       CSW210
     C                     MOVEL'N'       ##CSID                                              CSW210
     C           MGDAD1    IFNE *BLANKS                                                       CSW210
     C           MGDIDN    ANDEQ*BLANKS                                                       CSW210
     C           MGDAD2    ANDEQ*BLANKS                                                       CSW210
     C                     EXSR SRSWFT                                                        CSW210
     C           ##CSID    IFEQ 'Y'                                                           CSW210
     C                     MOVEL':95P:'   MTAG                                                CSW210
      *                                                                                       CSW210
      ** Access tag description                                                               CSW210
      *                                                                                       CSW210
     C                     EXSR SRMTAG                                                        CSW210
      *                                                                                       CSW210
     C                     MOVEL':DEBT//' MDAT                                                CSW210
     C           MDAT      CAT  MGDAD1:0  MDAT                                                CSW210
     C                     MOVELMDAT      RDAT                                                CSW210
      *                                                                                       CSW210
      ** Access the next occurence in MULT                                                    CSW210
      *                                                                                       CSW210
     C                     ADD  1         X                                                   CSW210
     C           X         OCUR MULT                                                          CSW210
     C                     ENDIF                                                              CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
      ** Check as Codeword                                                                    CSW210
      *                                                                                       CSW210
     C           1         SUBSTMGDAD1:1  ##SLSH  1                                           CSW210
     C           ##SLSH    IFEQ '/'                                                           CSW210
     C           MGDAD2    ANDNE*BLANKS                                                       CSW210
     C           MGDIDN    ANDEQ*BLANKS                                                       CSW210
     C                     MOVEL':95R:'   MTAG                                                CSW210
      *                                                                                       CSW210
      ** Access tag description                                                               CSW210
      *                                                                                       CSW210
     C                     EXSR SRMTAG                                                        CSW210
      *                                                                                       CSW210
     C                     MOVEL':DEBT'   MDAT                                                CSW210
     C           MDAT      CAT  MGDAD1:0  MDAT                                                CSW210
     C           MDAT      CAT  MGDAD2:0  MDAT                                                CSW210
     C                     MOVELMDAT      RDAT                                                CSW210
      *                                                                                       CSW210
      ** Access the next occurence in MULT                                                    CSW210
      *                                                                                       CSW210
     C                     ADD  1         X                                                   CSW210
     C           X         OCUR MULT                                                          CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
      ** Standard Address                                                                     CSW210
      *                                                                                       CSW210
     C           ##CSID    IFNE 'Y'                                                           CSW210
     C           ##SLSH    ANDNE'/'                                                           CSW210
     C           MGDIDN    ANDEQ*BLANKS                                                       CSW210
     C                     MOVEL':95Q:'   MTAG                                                CSW210
      *                                                                                       CSW210
      ** Access tag description                                                               CSW210
      *                                                                                       CSW210
     C                     EXSR SRMTAG                                                        CSW210
      *                                                                                       CSW210
     C                     MOVEL':DEBT//' MDAT                                                CSW210
     C           MDAT      CAT  MGDAD1:0  MDAT                                                CSW210
     C                     MOVELMDAT      RDAT                                                CSW210
     C                     ADD  1         X                                                   CSW210
     C           X         OCUR MULT                                                          CSW210
      *                                                                                       CSW210
     C           MGDAD2    IFNE *BLANKS                                                       CSW210
     C                     MOVELMGDAD2    MDAT                                                CSW210
     C                     MOVELMDAT      RDAT                                                CSW210
     C                     MOVELWSEQ      MSEQ                                                CSW210
     C                     ADD  1         X                                                   CSW210
     C           X         OCUR MULT                                                          CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
     C           MGDAD3    IFNE *BLANKS                                                       CSW210
     C                     MOVELMGDAD3    MDAT                                                CSW210
     C                     MOVELMDAT      RDAT                                                CSW210
     C                     MOVELWSEQ      MSEQ                                                CSW210
     C                     ADD  1         X                                                   CSW210
     C           X         OCUR MULT                                                          CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
     C           MGDAD4    IFNE *BLANKS                                                       CSW210
     C                     MOVELMGDAD4    MDAT                                                CSW210
     C                     MOVELMDAT      RDAT                                                CSW210
     C                     MOVELWSEQ      MSEQ                                                CSW210
     C                     ADD  1         X                                                   CSW210
     C           X         OCUR MULT                                                          CSW210
     C                     ENDIF                                                              CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
      ** Debtor account line                                                                  CSW210
      *                                                                                       CSW210
     C           MGDLIN    IFNE *BLANKS                                                       CSW210
     C                     MOVEL':97A:'   MTAG                                                CSW210
      *                                                                                       CSW210
      ** Debtor Account Line IBAN Flag = 'Y'                                                  CSW210
      *                                                                                       CSW210
     C           CSW210    IFEQ 'Y'                                                           CSW210
     C           CFT004    ANDEQ'Y'                                                           CSW210
     C           MGFDBT    ANDEQ'Y'                                                           CSW210
     C                     MOVEL':97E:'   MTAG                                                CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
      ** Access tag description                                                               CSW210
      *                                                                                       CSW210
     C                     EXSR SRMTAG                                                        CSW210
      *                                                                                       CSW210
     C                     MOVEL':CASH//' MDAT                                                CSW210
     C           MDAT      CAT  MGDLIN:0  MDAT                                                CSW210
     C                     MOVELMDAT      RDAT                                                CSW210
     C                     ADD  1         X                                                   CSW210
     C           X         OCUR MULT                                                          CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
      ** Format :16S: - End of Block                                                          CSW210
     C                     MOVEL':16S:'   MTAG                                                CSW210
      *                                                                                       CSW210
      ** Access tag description                                                               CSW210
      *                                                                                       CSW210
     C                     EXSR SRMTAG                                                        CSW210
      *                                                                                       CSW210
     C                     MOVEL'CSHPRTY' MDAT                                                CSW210
     C                     MOVELMDAT      RDAT                                                CSW210
      *                                                                                       CSW210
      ** Access the next occurence in MULT                                                    CSW210
      *                                                                                       CSW210
     C                     ADD  1         X                                                   CSW210
     C           X         OCUR MULT                                                          CSW210
      *                                                                                       CSW210
     C                     ENDIF                                                              CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
     C                     ENDSR
      *****************************************************************
      /TITLE SR/SRFAMT
      *****************************************************************
      *                                                               *
      *  SRFAMT - Format MT515 Subsequence D3 or MT518 Subsequence C3 *
      *           (Amounts)                                           *
      *                                                               *
      *  Called By: SR/SRSDET                                         *
      *  Calls    :                                                   *
      *                                                               *
      *****************************************************************
      *
     C           SRFAMT    BEGSR
      *
      ** Set up Message Sequence workfield
      *
     C           MGMTYP    IFEQ '515'
     C                     MOVEL'D3 '     WSEQ
     C                     ELSE
     C                     MOVEL'C3 '     WSEQ
     C                     ENDIF
      *
      ** Move 'Y' to WO16R workfield to allow output of tag :16R:
      *
     C                     MOVE 'Y'       WO16R   1
      *
      ** Move 'Y' to WO16S workfield to allow output of tag :16S:
      *
     C                     MOVE 'Y'       WO16S   1
      *
      ** Move the SWIFT Ccy Code of Nominal Ccy to workfield
      *
     C                     MOVELWNSWCY    WSWCD   3
      *
      ** Move Nominal Ccy Code to workfield
      *
     C                     MOVELMGNMCY    W@CYCD  3
      *
      ** Move Deal Amount to workfield
      *
     C                     Z-ADDMGDLAM    W@AMNT 150
      *
      ** Set up the first 7 chars of MDAT
      *
     C                     MOVE *BLANKS   WFLD07  7
     C                     MOVEL':DEAL//' WFLD07
      *
      ** Format Seq D3 or C3 for Deal Amount (MGDLAM) field
      *
     C                     EXSR SRF19A
      *
      ** If Coupon Rate <> *Zero, then,
      **    Format another Seq D3 or C3 for Int Amount (MGITRA)
      *
     C           MGCPNR    IFNE *ZERO
     C           MGPROT    ANDNE'6'
     C           WSUPP     ANDNE'Y'
      *
     C                     Z-ADDMGITRA    W@AMNT
      *
      ** Set up the first 7 chars of MDAT
      *
     C                     MOVE *BLANKS   WFLD07  7
     C                     MOVEL':ACRU//' WFLD07
      *
      ** Format 1 block of Seq D3 or C3
      *
     C                     EXSR SRF19A
      *
     C                     ENDIF
      *
      ** If Reallowance Amount is not *zero, then,
      **    Format another block of Seq D3 or Seq C3
      *
     C           MGISDI    IFNE *ZERO
      *
     C                     Z-ADDMGISDI    W@AMNT
      *
      ** Set up the first 7 chars of MDAT
      *
     C                     MOVE *BLANKS   WFLD07  7
     C                     MOVEL':ISDI//' WFLD07
      *
      ** Format 1 block of Seq D3 or C3
      *
     C                     EXSR SRF19A
      *
     C                     ENDIF
      *
      ** Format Charges and Commission Amounts
      *
     C                     Z-ADD1         Y       20
     C                     Z-ADD*ZERO     E       20
     C           Y         DOWLE10
     C                     MOVE *BLANK    CCS
     C                     Z-ADD*ZERO     CCA
     C                     ADD  1         Y
     C                     ENDDO
      *
     C                     Z-ADD1         Y
      *
      ** Total the amounts of Charges/Comm with the same SWIFT ID
      *
     C           Y         DOWLE10
      *
     C           AMT,Y     IFNE *ZERO
      *
      ** Default blank SWIFT ID to 'CHAR'
      *
     C           CDE,Y     IFEQ *BLANKS
     C           CSW203    IFEQ 'N'                                                           CSW203
     C                     MOVEL'CHAR'    CDE,Y
     C                     ELSE                                                               CSW203
     C                     MOVEL'OTHR'    CDE,Y                                               CSW203
     C                     ENDIF                                                              CSW203
     C                     ENDIF
      *
     C                     Z-ADD1         Z       10
     C           CDE,Y     LOKUPCCS,Z                    52
      *
      ** If Charge/Commission Code not found in array CCS, then,
      **    Move Charge/Commission Code and Amount to the next element
     C           *IN52     IFEQ *OFF
     C                     ADD  1         E
     C                     MOVELCDE,Y     CCS,E
     C                     Z-ADDAMT,Y     CCA,E
      *
     C                     ELSE
      *
      ** Otherwise, (Charge/Comm Code was found in array CCS)
      **    Accummulate the amount for this Charge/Commission Code
     C                     ADD  AMT,Y     CCA,Z
     C                     ENDIF
     C                     ENDIF
      *
     C                     ADD  1         Y
      *
     C                     ENDDO
      *
      ** Format the content of array CCS
      *
     C                     Z-ADD1         Y
     C           Y         DOWLE10
     C           CCS,Y     ANDNE*BLANKS
      *
     C                     Z-ADDCCA,Y     W@AMNT
      *
      ** Set up the first 7 chars of MDAT
      *
     C                     MOVE *BLANKS   WFLD07  7
     C                     MOVEL':'       WFLD07
     C           WFLD07    CAT  CCS,Y:0   WFLD07
     C           WFLD07    CAT  '//':0    WFLD07
      *
      ** Format 1 block of Seq D3 or C3
      *
     C                     EXSR SRF19A
      *
     C                     ADD  1         Y
      *
     C                     ENDDO
      *                                                                                       CSW203
     C           CSW203    IFEQ 'Y'                                                           CSW203
     C           MGTAXA    ANDNE*ZEROS                                                        CSW203
     C                     Z-ADDMGTAXA    W@AMNT                                              CSW203
     C                     MOVEL*BLANKS   WFLD07                                              CSW203
     C                     MOVEL':TRAX//' WFLD07                                              CSW203
     C                     EXSR SRF19A                                                        CSW203
     C                     ENDIF                                                              CSW203
      *                                                                   CSE023
      ** If Bachup withholding Tax <> 0                                   CSE023
      **    Format another Seq D3 or C3 for Tax Amount (MGWHTX)           CSE023
      *                                                                   CSE023
     C           MGWHTX    IFNE *ZERO                                     CSE023
      *                                                                   CSE023
     C                     Z-ADDMGWHTX    W@AMNT                          CSE023
      *                                                                   CSE023
      ** Set up the first 7 chars of MDAT                                 CSE023
      *                                                                   CSE023
     C                     MOVE *BLANKS   WFLD07  7                       CSE023
     C                     MOVEL':WITH//' WFLD07                          CSE023
      *                                                                   CSE023
      ** Format 1 block of Seq D3 or C3                                   CSE023
      *                                                                   CSE023
     C                     EXSR SRF19A                                    CSE023
      *                                                                   CSE023
     C                     ENDIF                                          CSE023
      *
     C           WSUPP     IFNE 'Y'
      *
      ** Move 'N' to WO16S to inhibit output of tag :16S:
      *
     C                     MOVE 'N'       WO16S
      *
      ** Move the SWIFT Ccy Code of Settlement Ccy to workfield
     C                     MOVE WSSWCY    WSWCD
      *
      ** Move Settlement Ccy Code to workfield
     C                     MOVELMGSTCY    W@CYCD
      *
      ** Format Settlement Amount
     C                     Z-ADDMGSTAM    W@AMNT
      *
      ** Set up the first 7 chars of MDAT
      *
     C                     MOVE *BLANKS   WFLD07
     C                     MOVEL':SETT//' WFLD07
      *
      ** Format 1 block of Seq D3 or C3
      *
     C                     EXSR SRF19A
      *
      ** If nominal ccy is different from the settlement currency,
      ** output another :19A using nominal currency equivalent
      ** of settlement amount
      *
     C           MGRESU    IFNE 0
      *
      ** Move 'N' to WO16R to inhibit output of tag :16R:
     C                     MOVE 'N'       WO16R
      ** Move the SWIFT Ccy Code of Nominal Ccy to workfield
     C                     MOVE WNSWCY    WSWCD
      ** Move Nominal Ccy Code to workfield
     C                     MOVELMGNMCY    W@CYCD
      ** Move settlement amount equivalent to workfield
     C                     Z-ADDMGRESU    W@AMNT
      ** Move codeword to use
     C                     MOVEL':RESU//' WFLD07
      ** Format field
     C                     EXSR SRF19A
      *
     C                     ENDIF
      *
      ** If EMU Securities Settlement Conversion feature is installed,
      ** and In Ccy in Fld 72 is defined on trade, output original
      ** amount.
      *
     C           CEU005    IFEQ 'Y'
     C           MGOTRC    ANDNE*BLANKS
     C           CSW014    OREQ 'Y'
     C           MGOTRC    ANDNE*BLANKS
      *
      ** Move 'N' to WO16R to inhibit output of tag :16R:
     C                     MOVE 'N'       WO16R
      ** Move the SWIFT Ccy Code of Origianl Ccy to workfield
     C                     MOVE WOSWCY    WSWCD
      ** Move Origianl Ccy Code to workfield
     C                     MOVELMGOTRC    W@CYCD
      ** Move Original Amount to workfield
     C                     Z-ADDMGOTRA    W@AMNT
      ** Move codeword to use
     C                     MOVEL':OCMT//' WFLD07
      ** Format field
     C                     EXSR SRF19A
      *
     C                     ENDIF
      *
      ** Format field :98A: - Value Date
      *
     C                     MOVEL':98A:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
      ** Convert Value Date to CCYYMMDD format
      *
     C                     Z-ADDMGVDAT    ZMDAY
     C                     CALL 'ZM0065'
     C                     PARM           ZMDAY   50
     C                     PARM           ZSDATE  6
     C                     PARM           ZSDATC  8
      *
     C                     MOVEL':VALU//' MDAT
     C           MDAT      CAT  ZSDATC:0  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      ** If ((Orig Ccy <> Blank AND Orig CCy <> Sett Ccy)  OR
      **    Nominal Ccy <> Sett Ccy), then format tag :92B:
      *
     C           MGRESU    IFNE 0
     C           MGDAXR    ANDNE0
      *
      ** Format field :92B: - Exchange Rate
      *
     C                     MOVEL':92B:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
      ** Convert Exchange Rate to SWIFT format
      *
     C                     Z-ADDMGDAXR    ZPRIC
     C                     MOVE *BLANKS   ZSPRIC
     C                     MOVE *BLANKS   ZOPRIC
      *
     C                     CALL 'ZM1190'               24
     C                     PARM           ZPRIC
     C                     PARM           ZSPRIC
     C                     PARM           ZOPRIC
      *
      ** If program not found, perform DB Error processing
     C           *IN24     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     Z-ADD027       DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *DB ERROR 027 *
     C                     MOVEL'ZM1190'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     MOVEL':EXCH//' MDAT
      *
     C           MDAT      CAT  WNSWCY:0  MDAT
     C           MDAT      CAT  '/':0     MDAT
     C           MDAT      CAT  WSSWCY:0  MDAT
     C           MDAT      CAT  '/':0     MDAT
     C           MDAT      CAT  ZSPRIC:0  MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDIF
      *
      *
      ** Format :16S: - End of Block
      *
     C                     MOVEL':16S:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL'AMT'     MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDIF
      *
     C                     ENDSR
      *****************************************************************   CSE006
      /TITLE SR/SRRDET                                                    CSE006
      *****************************************************************   CSE006
      *                                                               *   CSE006
      *  SRRDET - Format of REPO BLOCK - Optional Subsequence E       *   CSE006
      *                                                               *   CSE006
      *  Called By: SRFMT                                             *   CSE006
      *  Calls    :                                                   *   CSE006
      *                                                               *   CSE006
      *****************************************************************   CSE006
      *                                                                   CSE006
     C           SRRDET    BEGSR                                          CSE006
      *                                                                   CSE006
      *** Set up Message Sequence workfield                               CSE006
      *                                                                   CSE006
     C                     MOVEL'E  '     WSEQ                            CSE006
      *                                                                   CSE006
      *** Save the content WSEQ workfield                                 CSE006
      *                                                                   CSE006
     C                     MOVE WSEQ      SV@SEQ                          CSE006
      *                                                                   CSE006
      *** Format 16R:REPO - Start of Block                                CSE006
      *                                                                   CSE006
     C                     MOVEL':16R:'   MTAG                            CSE006
      *                                                                   CSE006
      *** Access tag description                                          CSE006
      *                                                                   CSE006
     C                     EXSR SRMTAG                                    CSE006
      *                                                                   CSE006
     C                     MOVEL'REPO'    MDAT                            CSE006
     C                     MOVELMDAT      RDAT                            CSE006
      *                                                                   CSE006
      *** Access the next occurence in MULT                               CSE006
      *                                                                   CSE006
     C                     ADD  1         X                               CSE006
     C           X         OCUR MULT                                      CSE006
      *                                                                   CSE006
      *** Format field :22F: - Indicator                                  CSE006
      *                                                                   CSE006
     C                     MOVEL':22F:'   MTAG                            CSE006
      *                                                                   CSE006
      *** Access tag description                                          CSE006
      *                                                                   CSE006
     C                     EXSR SRMTAG                                    CSE006
      *                                                                   CSE006
     C**********           MOVEL'RERT//'  MDAT                                         CSE006 208890
     C                     MOVEL':RERT//' MDAT                                                208890
     C           MDAT      CAT  'FIXE':0  MDAT                            CSE006
     C                     MOVELMDAT      RDAT                            CSE006
      *                                                                   CSE006
      *** Access the next occurence in MULT                               CSE006
      *                                                                   CSE006
     C                     ADD  1         X                               CSE006
     C           X         OCUR MULT                                      CSE006
      *                                                                   CSE006
      *** Format field :20C: - Reference                                  CSE006
      *                                                                   CSE006
     C                     MOVEL':20C:'   MTAG                            CSE006
      *                                                                   CSE006
      *** Access tag description                                          CSE006
      *                                                                   CSE006
     C                     EXSR SRMTAG                                    CSE006
      *                                                                   CSE006
     C**********           MOVEL'SECO//'  MDAT                                         CSE006 208890
     C                     MOVEL':SECO//' MDAT                                                208890
     C           MDAT      CAT  MGARF:0   MDAT                            CSE006
     C                     MOVELMDAT      RDAT                            CSE006
      *                                                                   CSE006
      *** Access the next occurence in MULT                               CSE006
      *                                                                   CSE006
     C                     ADD  1         X                               CSE006
     C           X         OCUR MULT                                      CSE006
      *                                                                   CSE006
      *** Format :92A: - Rate                                             CSE006
      *                                                                   CSE006
     C           MGRR      IFNE *ZERO                                     CSE006
      *                                                                   CSE006
     C                     MOVEL':92A:'   MTAG                            CSE006
      *                                                                   CSE006
      *** Access tag description                                          CSE006
      *                                                                   CSE006
     C                     EXSR SRMTAG                                    CSE006
      *                                                                   CSE006
      *** Convert Repo Rate to SWIFT format                               CSE006
      *                                                                   CSE006
     C                     Z-ADDMGRR      ZPRIC                           CSE006
     C                     MOVE *BLANKS   ZSPRIC                          CSE006
     C                     MOVE *BLANKS   ZOPRIC                          CSE006
     C*                                                                   CSE006
     C                     CALL 'ZM1190'               24                 CSE006
     C                     PARM           ZPRIC                           CSE006
     C                     PARM           ZSPRIC                          CSE006
     C                     PARM           ZOPRIC                          CSE006
      *                                                                   CSE006
      *** If program not found, perform DB Error processing               CSE006
      *                                                                   CSE006
     C           *IN24     IFEQ *ON                                       CSE006
     C           *LOCK     IN   LDA                                       CSE006
     C                     Z-ADD021       DBASE            * * * * * * * *CSE006
     C                     MOVE *BLANKS   DBKEY            *DB ERROR 021 *CSE006
     C                     MOVEL'ZM1190'  DBPGM            * * * * * * * *CSE006
     C                     OUT  LDA                                       CSE006
     C                     EXSR *PSSR                                     CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C**********           MOVEL'REPO//'  MDAT                                         CSE006 208890
     C                     MOVEL':REPO//' MDAT                                                208890
      *                                                                   CSE006
     C           MDAT      CAT  ZSPRIC:0  MDAT                            CSE006
     C                     MOVELMDAT      RDAT                            CSE006
      *                                                                   CSE006
      *** Access the next occurence in MULT                               CSE006
      *                                                                   CSE006
     C                     ADD  1         X                               CSE006
     C           X         OCUR MULT                                      CSE006
      *                                                                   CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** Restore sequence value                                          CSE006
      *                                                                   CSE006
     C                     MOVE SV@SEQ    WSEQ                            CSE006
      *                                                                   CSE006
      *** Format :16S: - End of Block                                     CSE006
      *                                                                   CSE006
     C                     MOVEL':16S:'   MTAG                            CSE006
      *                                                                   CSE006
      *** Access tag description                                          CSE006
      *                                                                   CSE006
     C                     EXSR SRMTAG                                    CSE006
      *                                                                   CSE006
     C                     MOVEL'REPO'    MDAT                            CSE006
     C                     MOVELMDAT      RDAT                            CSE006
      *                                                                   CSE006
      *** Access the next occurence in MULT                               CSE006
      *                                                                   CSE006
     C                     ADD  1         X                               CSE006
     C           X         OCUR MULT                                      CSE006
      *                                                                   CSE006
     C                     ENDSR                                          CSE006
      *****************************************************************
      /TITLE SR/SRF19A
      *****************************************************************
      *                                                               *
      *  SRF19A - Subroutine to format tag :19A:                      *
      *                                                               *
      *  Called By: SRFAMT                                            *
      *  Calls    :                                                   *
      *                                                               *
      *****************************************************************
      *
     C           SRF19A    BEGSR
      *
      ** If WO16R workfield is 'Y', output tag :16R:
      *
     C           WO16R     IFEQ 'Y'
      *
      ** Format :16R: - Start of Block
      *
     C                     MOVEL':16R:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL'AMT'     MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDIF
      *                                                                                       CSW203
     C           CSW203    IFEQ 'Y'                                                           CSW203
      *                                                                                       CSW203
      ** S.W.I.F.T. 2001: Format 17B: Accrued Interest Flag                                   CSW203
      *                                                                                       CSW203
     C           WFLD07    IFEQ ':SETT//'                                                   MD019844
     C           CSW201    IFEQ 'Y'                                                           CSW203
      *                                                                                       CSW203
     C           MGCPNR    IFNE *ZEROS                                                        CSW203
     C                     MOVEL':17B:'   MTAG                                                CSW203
     C                     EXSR SRMTAG                                                        CSW203
     C                     MOVEL':ACRU//Y'MDAT                                                CSW203
     C                     MOVELMDAT      RDAT                                                CSW203
      *                                                                                       CSW203
      ** Access the next occurence in MULT                                                    CSW203
     C                     ADD  1         X                                                   CSW203
     C           X         OCUR MULT                                                          CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
     C                     ELSE                                                               CSW203
      *                                                                                       CSW203
      ** Format :17B: - Instruction Override                                                  CSW203
      *                                                                                       CSW203
     C                     MOVEL':17B:'   MTAG                                                CSW203
      *                                                                                       CSW203
      ** Access tag description                                                               CSW203
      *                                                                                       CSW203
     C                     EXSR SRMTAG                                                        CSW203
      *                                                                                       CSW203
     C                     MOVEL':STAN//' MDAT                                                CSW203
      *                                                                                       CSW203
     C           MGSTAN    IFNE *BLANKS                                                       CSW203
     C           MDAT      CAT  MGSTAN:0  MDAT                                                CSW203
     C                     ELSE                                                               CSW203
     C           MDAT      CAT  'N':0     MDAT                                                CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
     C                     MOVELMDAT      RDAT                                                CSW203
      *                                                                                       CSW203
      ** Access the next occurence in MULT                                                    CSW203
      *                                                                                       CSW203
     C                     ADD  1         X                                                   CSW203
     C           X         OCUR MULT                                                          CSW203
      *                                                                                       CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
     C                     ENDIF                                                            MD019844
      *                                                                                     MD019844
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
      *
      ** Format :19A: - Amount
      *
     C                     MOVEL':19A:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
      ** Convert Amount to SWIFT format
      *
     C                     EXSR SRCNVT
      *
     C                     MOVELWFLD07    MDAT
     C           W@AMNT    IFLT *ZERO
     C***********MDAT      CAT  '-':0     MDAT                            140966
     C           MDAT      CAT  'N':0     MDAT                            140966
     C                     ENDIF
     C           MDAT      CAT  WSWCD:0   MDAT
     C           MDAT      CAT  ZSAMT:0   MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
      ** If WO16S workfield is 'Y', output tag :16S:
      *
     C           WO16S     IFEQ 'Y'
      *
      ** Format :16S: - End of Block
      *
     C                     MOVEL':16S:'   MTAG
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
     C                     MOVEL'AMT'     MDAT
     C                     MOVELMDAT      RDAT
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ENDIF
      *
     C                     ENDSR
      *****************************************************************                       CSW203
      /TITLE SR/SRF94F                                                                        CSW203
      *****************************************************************                       CSW203
      *                                                               *                       CSW203
      *  SRF94F - Format Tag :94F:                                    *                       CSW203
      *                                                               *                       CSW203
      *****************************************************************                       CSW203
      *                                                                                       CSW203
     C           SRF94F    BEGSR                                                              CSW203
      *                                                                                       CSW203
     C                     MOVELMGTNUM    WKTNUM                                              CSW203
      *                                                                                       CSW203
     C           WKTNUM    CHAINTRADSDY2             48                                       CSW203
      *                                                                                       CSW203
     C           *IN48     IFEQ *OFF                                                          CSW203
      *                                                                                       CSW203
     C           T2SKAL    IFNE *BLANKS                                                       CSW203
     C                     MOVELT2SKAL    WKACCT 35                                           CSW203
     C                     ELSE                                                               CSW203
     C                     MOVELT2SKAN    WKACCT                                              CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
      ** Determine length of WKACCT                                                           CSW203
      *                                                                                       CSW203
     C                     Z-ADD35        X1      30                                          CSW203
     C                     MOVEAWKACCT    WRKACT                                              CSW203
     C********** WRKACT,X1 DOWEQ*BLANK                                                CSW203 BUG2381
     C********** X1        ANDGT0                                                     CSW203 BUG2381
     C           X1        DOWGT0                                                            BUG2381
     C           WRKACT,X1 ANDEQ*BLANK                                                       BUG2381
     C                     SUB  1         X1                                                  CSW203
     C                     ENDDO                                                              CSW203
      *                                                                                       CSW203
     C                     MOVE 'N'       WFIN    1                                           CSW203
     C                     Z-ADD1         X2      30                                          CSW203
      *                                                                                       CSW203
     C           X1        IFGT 4                                                             CSW203
      *                                                                                       CSW203
      ** Check if leading //XE or //XC is present                                             CSW203
      *                                                                                       CSW203
     C           WFIN      DOWNE'Y'                                                           CSW203
     C           X2        ANDLE35                                                            CSW203
      *                                                                                       CSW203
     C           WRKACT,X2 IFEQ *BLANK                                                        CSW203
     C                     ADD  1         X2                                                  CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
     C           WRKACT,X2 IFEQ '/'                                                           CSW203
     C                     ADD  1         X2                                                  CSW203
     C           WRKACT,X2 IFEQ '/'                                                           CSW203
     C                     ADD  1         X2                                                  CSW203
     C           WRKACT,X2 IFEQ 'X'                                                           CSW203
     C                     ADD  1         X2                                                  CSW203
     C           WRKACT,X2 IFEQ 'E'                                                           CSW203
     C           WRKACT,X2 OREQ 'C'                                                           CSW203
     C           35        SUB  X2        WS                                                  CSW203
     C                     ADD  1         X2                                                  CSW203
     C           X2        IFLE 35                                                           BUG2381
     C           WS        SUBSTWKACCT:X2 WKACCT                                              CSW203
     C                     ENDIF                                                             BUG2381
     C                     MOVE 'Y'       WFIN                                                CSW203
     C                     ENDIF                                                              CSW203
     C                     ELSE                                                               CSW203
     C                     MOVE 'Y'       WFIN                                                CSW203
     C                     ENDIF                                                              CSW203
     C                     ELSE                                                               CSW203
     C                     MOVE 'Y'       WFIN                                                CSW203
     C                     ENDIF                                                              CSW203
     C                     ELSE                                                               CSW203
     C                     MOVE 'Y'       WFIN                                                CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
     C                     ENDDO                                                              CSW203
      *                                                                                       CSW203
     C                     ELSE                                                               CSW203
      *                                                                                       CSW203
      ** Check if leading / are present                                                       CSW203
      *                                                                                       CSW203
     C           WFIN      DOWNE'Y'                                                           CSW203
     C           X2        ANDLE35                                                            CSW203
      *                                                                                       CSW203
     C           WRKACT,X2 IFNE *BLANK                                                        CSW203
     C           WRKACT,X2 ANDNE'/'                                                           CSW203
     C                     MOVE 'Y'       WFIN                                                CSW203
     C                     ELSE                                                               CSW203
     C                     ADD  1         X2                                                  CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
     C                     ENDDO                                                              CSW203
      *                                                                                       CSW203
     C           X2        SUB  1         WX2     30                                          CSW203
     C           WX2       IFGE 1                                                             CSW203
     C           35        SUB  WX2       WS                                                  CSW203
     C           X2        IFLE 35                                                           BUG2381
     C           WS        SUBSTWKACCT:X2 WKACCT                                              CSW203
     C                     ENDIF                                                             BUG2381
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
      ** Check if / is present within WKACCT                                                  CSW203
      *                                                                                       CSW203
     C           '/'       SCAN WKACCT:1  WS             47                                   CSW203
      *                                                                                       CSW203
     C           *IN47     IFEQ *ON                                                           CSW203
     C           36        SUB  WS        WSTART                                              CSW203
     C           WSTART    SUBSTWKACCT:WS WSAFEP 40                                           CSW203
     C                     ELSE                                                               CSW203
     C                     MOVEL*BLANKS   WSAFEP                                              CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
     C           WSAFEP    IFNE *BLANKS                                                       CSW203
      *                                                                                       CSW203
     C                     MOVEAWSAFEP    WRKSFE                                              CSW203
      *                                                                                       CSW203
      ** Determine length of WSAFEP                                                           CSW203
      *                                                                                       CSW203
     C                     Z-ADD40        X1                                                  CSW203
     C********** WRKSFE,X1 DOWEQ*BLANK                                                CSW203 BUG2381
     C********** X1        ANDGT0                                                     CSW203 BUG2381
     C           X1        DOWGT0                                                            BUG2381
     C           WRKSFE,X1 ANDEQ*BLANK                                                       BUG2381
     C                     SUB  1         X1                                                  CSW203
     C                     ENDDO                                                              CSW203
      *                                                                                       CSW203
     C           X1        IFLT 6                                                             CSW203
     C                     MOVE *BLANKS   WSAFEP                                              CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
     C                     MOVELWSAFEP    WSAFE4  4                                           CSW203
      *                                                                                       CSW203
     C           WSAFE4    IFEQ '/CU/'                                                        CSW203
     C                     MOVEL'/CUST/'  WSAFE   6                                           CSW203
     C           36        SUBSTWSAFEP:5  WKSAFE 40                                           CSW203
     C           WSAFE     CAT  WKSAFE:0  WSAFEP                                              CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
     C           WSAFE4    IFEQ '/IC/'                                                        CSW203
     C                     MOVEL'/ICSD/'  WSAFE                                               CSW203
     C           36        SUBSTWSAFEP:5  WKSAFE                                              CSW203
     C           WSAFE     CAT  WKSAFE:0  WSAFEP                                              CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
     C           WSAFE4    IFEQ '/NC/'                                                        CSW203
     C                     MOVEL'/NCSD/'  WSAFE                                               CSW203
     C           36        SUBSTWSAFEP:5  WKSAFE                                              CSW203
     C           WSAFE     CAT  WKSAFE:0  WSAFEP                                              CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
     C           WSAFE4    IFEQ '/SH/'                                                        CSW203
     C                     MOVEL'/SHHE/'  WSAFE                                               CSW203
     C           36        SUBSTWSAFEP:5  WKSAFE                                              CSW203
     C           WSAFE     CAT  WKSAFE:0  WSAFEP                                              CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
     C                     MOVEL':94F:'   MTAG                                                CSW203
      *                                                                                       CSW203
      ** Access tag description                                                               CSW203
      *                                                                                       CSW203
     C                     EXSR SRMTAG                                                        CSW203
      *                                                                                       CSW203
     C           ':SAFE/'  CAT  WSAFEP:0  MDAT                                                CSW203
     C                     MOVELMDAT      RDAT                                                CSW203
      *                                                                                       CSW203
      ** Access the next occurence in MULT                                                    CSW203
      *                                                                                       CSW203
     C                     ADD  1         X                                                   CSW203
     C           X         OCUR MULT                                                          CSW203
      *                                                                                       CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
     C                     ENDIF                                                              CSW203
      *                                                                                       CSW203
     C                     ENDSR                                                              CSW203
      *                                                                                       CSW203
      *****************************************************************
      /TITLE SR/SRCNVT
      *****************************************************************
      *                                                               *
      *  SRCNVT - Convert amount to SWIFT format                      *
      *                                                               *
      *  Called By: SRFAMT                                            *
      *  Calls    : ZM1240                                            *
      *                                                               *
      *****************************************************************
      *
     C           SRCNVT    BEGSR
      *
     C                     Z-ADDW@AMNT    ZAMT   130
     C                     MOVELW@CYCD    ZCCY    3
     C                     MOVE *BLANKS   ZSAMT  17
     C                     MOVE *BLANKS   ZOAMT  21
     C                     MOVE *BLANKS   ZSCCY   3
     C                     MOVE *BLANKS   ZERR
      *
     C                     CALL 'ZM1240'               25
     C                     PARM           ZAMT
     C                     PARM           ZCCY
     C                     PARM           ZSAMT
     C                     PARM           ZOAMT
     C                     PARM           ZSCCY
     C                     PARM           ZERR
      *
      ** If program not found, perform DB Error processing
      *
     C           *IN25     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     Z-ADD020       DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *DB ERROR 020 *
     C                     MOVEL'ZM1240'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** If an error occured in ZM1240, then,
      **    Move 'Y' @ERR workfield to indicate error while
      **    formatting and format MULT/MERR field
      *
     C           ZERR      IFEQ '1'
     C                     MOVEL'Y'       @ERR
     C                     MOVELERRA,9    MERR
     C                     ENDIF
      *
     C                     ENDSR
      *****************************************************************
      /TITLE SR/SRPERR
      *****************************************************************
      *                                                               *
      *  SRPERR - Print message in error                              *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls    :                                                   *
      *                                                               *
      *****************************************************************
      *
     C           SRPERR    BEGSR
      *
      ** Initialise fields used in report
      *
     C                     CLEARTEXT2
      *
      ** Open printer file
      *
     C           *IN60     IFEQ *OFF
     C                     OPEN MG051NA2
     C                     MOVE '1'       *IN60
     C                     ENDIF
      *
      ** Format Message Type
      *
     C                     MOVELMGMTYP    R2MTYP
      *
      ** Format Trade Reference
      *
     C                     MOVELMGTNUM    R2REFE
      *
      ** Format Trade Type
      *
     C                     MOVELMGTSTP    R2TYP1
      *
      ** Format Trade Type Description
      *
     C           MGTSTP    IFEQ 'TS'
     C                     MOVELTYPA,1    R2TYP2
     C                     ELSE
     C           MGTSTP    IFEQ 'TP'
     C                     MOVELTYPA,2    R2TYP2
     C                     ENDIF
     C                     ENDIF
      *
      ** Format Sender Branch
      *
     C                     MOVELMGSNBR    R2SND1
      *
      ** Format Sender Customer Number
      *
     C                     MOVEL@SNDR     R2SND2
      *
      ** Format Sender Network Address
      *
     C                     MOVEL@NWSN     R2SND3
      *
      ** Format Destination Customer Number
      *
     C**********           Z-ADDMGDEST    R2DES1                                              CSD027
     C                     MOVE MGDEST    R2DES1                                              CSD027
      *
      ** Format Destination Network Address
      *
     C                     MOVEL@NWDS     R2DES2
      *
      ** Format Destination error message
      *
     C                     MOVELDSERR     R2EMSG
      *
      ** Format Network
      *
     C                     MOVEL@NWRK     R2NETW
      *
      ** Format Network Error message
      *
     C                     MOVELNWERR     R2NWER
      *
      ** Format Module Id
      *
     C                     MOVELMGMODI    R2MODI
      *
      ** Format Transaction Number
      *
     C                     MOVELMGTNUM    R2TNUM
      *
      ** Format Message Priority
      *
     C                     MOVEL'N'       R2PRTY
      *
      ** Write the header and the main text for the report
      *
     C                     WRITEHEADER2
     C                     WRITETEXT2
      *
      ** Process Multiple Occcurence Date Structure
      *
     C                     Z-ADD0         I       20
     C           I         DOWLEX
      *
     C                     ADD  1         I
     C           I         OCUR MULT
      *
      ** Write a detail line to the report checking for overlfow
      *
     C           WWOFL2    SUB  WWPTL2    WWLINE  20
      *
     C           WWLINE    IFLT 3
     C                     WRITEHEADER2
     C                     ENDIF
      *
     C                     WRITELINE2
      *
     C                     ENDDO
      *
     C                     ENDSR
      *****************************************************************
      /TITLE SR/SROMSG
      *****************************************************************
      *                                                               *
      *  SROMSG - Output to MGOMSGPD                                  *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls    :                                                   *
      *                                                               *
      *****************************************************************
      *
     C           SROMSG    BEGSR
      *
      ** Initialise fields on PF/MGOREFPD
      *
     C                     CLEARMGOREFD0
      *
      ** History Retention Date
      *
     C           MGVDAT    ADD  ENDSMN    WWHDAT  50
     C                     MOVE WWHDAT    ZMDAY   50
     C                     MOVE *BLANKS   ZSDATE  6
      *
     C                     CALL 'ZM0060'               22
     C                     PARM           ZMDAY
     C                     PARM           ZSDATE
      *
      ** If program not found, perform DB Error processing
      *
     C           *IN22     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     Z-ADD029       DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *DB ERROR 029 *
     C                     MOVEL'ZM0060'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Set history retention date to output field
      *
     C                     MOVELZSDATE    HRDT
      *
      ** Message generation date
      *
     C                     MOVE BJRDNB    ZMDAY
     C                     MOVE *BLANKS   ZSDATE
      *
     C                     CALL 'ZM0060'               22
     C                     PARM           ZMDAY
     C                     PARM           ZSDATE
      *
      ** If program not found, perform DB Error processing
      *
     C           *IN22     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     Z-ADD030       DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *DB ERROR 030 *
     C                     MOVEL'ZM0060'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Set message generated date to output field
      *
     C                     MOVELZSDATE    MGDE
      *
      ** Setup CIND to determine in which century the generation                              196628
      ** date falls - current or succeeding                                                   196628
      *                                                                                       196628
     C                     MOVELMGDE      YY      20                                          196628
     C           YY        IFLT 72                                                            196628
     C                     MOVE '2'       CIND                                                196628
     C                     ELSE                                                               196628
     C                     MOVE '1'       CIND                                                196628
     C                     ENDIF                                                              196628
      *                                                                                       196628
      ** Convert Settlement Amount to SWIFT format
      *
     C                     Z-ADDMGSTAM    ZAMT
     C                     MOVELMGSTCY    ZCCY
     C                     MOVE *BLANKS   ZSAMT
     C                     MOVE *BLANKS   ZOAMT
     C                     MOVE *BLANKS   ZSCCY
     C                     MOVE *BLANKS   ZERR
      *
     C                     CALL 'ZM1240'               25
     C                     PARM           ZAMT
     C                     PARM           ZCCY
     C                     PARM           ZSAMT
     C                     PARM           ZOAMT
     C                     PARM           ZSCCY
     C                     PARM           ZERR
      *
      ** If program not found, perform DB Error processing
      *
     C           *IN25     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     Z-ADD031       DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *DB ERROR 031 *
     C                     MOVEL'ZM1240'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** If error occured in ZM1240, perform DB Error processing
      *
     C           ZERR      IFEQ '1'
     C                     Z-ADDZAMT      WWAMT
     C           *LOCK     IN   LDA
     C                     Z-ADD032       DBASE            * * * * * * * *
     C                     MOVELDBERR2    DBKEY            *DB ERROR 032 *
     C                     MOVEL'ZM1240'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Set SWIFT amount to output field
      *
     C                     MOVELZSAMT     AMTS
      *
      ** Format fields on PF/MGOREFPD
      *
     C                     EXSR SROREF
      *                                                                                       202330
      ** Setup CINDV to determine in which century the generation                             202330
      ** date falls - current or succeeding                                                   202330
      *                                                                                       202330
     C           SVDT      IFNE *BLANKS                                                       202330
      *                                                                                       202330
     C                     MOVELSVDT      YY      20                                          202330
     C           YY        IFLT 72                                                            202330
     C                     MOVE '2'       CINDV                                               202330
     C                     ELSE                                                               202330
     C                     MOVE '1'       CINDV                                               202330
     C                     ENDIF                                                              202330
      *                                                                                       202330
     C                     ENDIF                                                              202330
      *                                                                                       202330
     C/COPY WNCPYSRC,MG051NC003
      *
      ** Write record to PF/MGOREFPD
      *
     C                     MOVELMGCHG     AORR                                                CSW025
     C                     WRITEMGOREFD0               62
      *
      ** If error on write of record, perform DB Error processing
      *
     C           *IN62     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     Z-ADD033       DBASE            * * * * * * * *
     C                     MOVELMGTNUM    DBKEY            *DB ERROR 033 *
     C                     MOVEL'MGOREFPD'DBFILE           * * * * * * * *
     C                     MOVEL'MGF51N'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Process Multiple Occurence Data Structure
      *
     C                     Z-ADD1         Y       20
     C           Y         DOWLTX
      *
     C           Y         OCUR MULT
      *
      ** Format fields on PF/MGOMSGPD
      *
     C                     MOVELMDAT      MFLD
     C                     MOVE *BLANKS   PTDL
      *
      ** Write record to PF/MGOMSGPD
      *
     C                     WRITEMGOMSGD0               61
      *
      ** If error on write of record, perform DB Error processing
      *
     C           *IN61     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     Z-ADD028       DBASE            * * * * * * * *
     C                     MOVELMGTNUM    DBKEY            *DB ERROR 028 *
     C                     MOVEL'MGOMSGPD'DBFILE           * * * * * * * *
     C                     MOVEL'MG0510'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Increment MULT index
      *
     C                     ADD  1         Y
      *
     C                     ENDDO
      *
     C                     ENDSR
      *****************************************************************
      /TITLE SR/SROREF
      *****************************************************************
      *                                                               *
      *  SROREF - Format fields on PF/MGOREFPD                        *
      *                                                               *
      *  Called By: SR/SROMSG                                         *
      *  Calls    :                                                   *
      *                                                               *
      *****************************************************************
      *
     C           SROREF    BEGSR
      *
     C                     MOVELMGMODI    MODI
     C                     MOVELWWMDAT    TRNO
     C                     MOVELMGTNUM    MTRN
     C                     MOVELMGTTYP    TNTP
     C                     MOVELMGTSTP    SBTP
     C                     MOVEL@NWRK     NWRK
     C                     MOVELA8BICN    SECN
     C                     MOVEL@NWSN     NWSN
     C**********           Z-ADDMGDEST    DECN                                                CSD027
     C                     MOVE MGDEST    DECN                                                CSD027
     C                     MOVEL@NWDS     NWDS
     C                     MOVELMGDSSN    NWBN
     C                     MOVELMGMTYP    MTPY
     C                     MOVEL'N'       MPRY
      *
     C                     EXSR SRSTAT
      *                                                                                       CSD015
      ** Check if message type exists in the watch list                                       CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           222385
     C           CSW025    ANDEQ'N'                                                           CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *
     C                     TIME           MGTM
     C                     MOVELBJMRDT    LADT
     C                     TIME           LATM
     C                     MOVELWWDATE    SVDT
     C                     MOVELMGSNBR    BRCA
     C                     MOVELMGSTCY    CCY
     C                     MOVEL'Y'       TSKS
      *
     C                     ENDSR
     C/COPY WNCPYSRC,MG051NC004
      *****************************************************************
      /TITLE SR/SRSTAT
      *****************************************************************
      *                                                               *
      *  SRSTAT - Determine message status                            *
      *                                                               *
      *  Called By: SR/SROMSG                                         *
      *  Calls    :                                                   *
      *                                                               *
      *****************************************************************
      *
     C           SRSTAT    BEGSR
      *
      ** Reset status array
      *
     C                     CLEAR@ST
      *
      ** Set key to destination customer number
      *
     C                     MOVELDECN      @KEY      P
      *
      ** Get customer details via access object
      *
     C*********************CALL 'AOCUSTR0'                                                    CSW036
     C                     CALL 'AOCUSTR1'                                                    CSW036
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM           @KEY   10
     C                     PARM *BLANKS   @KYST   7
     C***********SDCUST    PARM SDCUST    DSSDY                                               CSW036
     C           SDCUST    PARM SDCUST    DSLDY                                               CSW036
      *
      ** Fill status array
      *
     C           @RTCD     IFEQ *BLANKS
     C                     MOVELBBDS01    @ST,1
     C                     MOVELBBDS02    @ST,2
     C                     MOVELBBDS03    @ST,3
     C                     MOVELBBDS04    @ST,4
     C                     MOVELBBDS05    @ST,5
     C                     MOVELBBDS06    @ST,6
     C                     MOVELBBDS07    @ST,7
     C                     MOVELBBDS08    @ST,8
     C                     MOVELBBDS09    @ST,9
     C                     MOVELBBDS10    @ST,10
     C                     MOVELBBDS11    @ST,11
     C                     MOVELBBDS12    @ST,12
     C                     MOVELBBDS13    @ST,13
     C                     MOVELBBDS14    @ST,14
     C                     MOVELBBDS15    @ST,15
     C                     ENDIF
      *
      ** Is the message type in the array? Set on *IN60 if it is.
      *
     C           '510'     LOKUP@ST                      53
     C  N53      '51*'     LOKUP@ST                      53
     C  N53      '5**'     LOKUP@ST                      53
      *
      ** If found, set status to 'ready to send', else set to 'created'
      *
     C           *IN53     IFEQ *ON
     C                     MOVEL'RSND'    MGST
     C                     MOVEL'2'       MGSG
     C                     ELSE
     C                     MOVEL'CRTD'    MGST
     C                     MOVEL'1'       MGSG
     C                     ENDIF
      *                                                                                     BUG25073
     C           CSW025    IFEQ 'Y'                                                         BUG25073
     C                     MOVEL'RSND'    MGST                                              BUG25073
     C                     MOVEL'2'       MGSG                                              BUG25073
     C                     ENDIF                                                            BUG25073
      *
     C                     ENDSR
      *****************************************************************
      /TITLE SR/SRPGEN
      *****************************************************************
      *                                                               *
      *  SRPGEN - Print message generated details                     *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls    :                                                   *
      *                                                               *
      *****************************************************************
      *
     C           SRPGEN    BEGSR
      *
      ** Initialise fields used in report
      *
     C                     CLEARTEXT1
      *
      ** Format Message Type
      *
     C                     MOVELMGMTYP    R1MTYP
      *
      ** Format Trade Reference
      *
     C                     MOVELMGTNUM    R1REFE
      *
      ** Format Trade Type
      *
     C                     MOVELMGTSTP    R1TYP1
      *
      ** Format Trade Type Description
      *
     C           MGTSTP    IFEQ 'TS'
     C                     MOVELTYPA,1    R1TYP2
     C                     END
      *
     C           MGTSTP    IFEQ 'TP'
     C                     MOVELTYPA,2    R1TYP2
     C                     END
      *
      ** Format Sender Branch
      *
     C                     MOVELMGSNBR    R1SND1
      *
      ** Format Sender Customer Number
      *
     C                     MOVEL@SNDR     R1SND2
      *
      ** Format Sender Network Address
      *
     C                     MOVEL@NWSN     R1SND3
      *
      ** Format Sender Report Name
      *
     C                     MOVEL@SRNM     R1SRNM
      *
      ** Format Sender Report Town
      *
     C                     MOVEL@SRTN     R1SRTN
      *
      ** Format Destination Report Name
      *
     C                     MOVEL@DRNM     R1DRNM
      *
      ** Format Destination Report Town
      *
     C                     MOVEL@DRTN     R1DRTN
      *
      ** Format Message Priority
      *
     C                     MOVEL'N'       R1PRTY
      *
      ** Format Destination Customer Number
      *
     C**********           Z-ADDMGDEST    R1DES1                                              CSD027
     C                     MOVE MGDEST    R1DES1                                              CSD027
      *
      ** Format Destination Network Address
      *
     C                     MOVEL@NWDS     R1DES2
      *
      ** Format Network
      *
     C                     MOVEL@NWRK     R1NETW
      *
      ** Write the Header and the main test for the report
      *
     C                     WRITEHEADER1
     C                     WRITETEXT1
      *
      ** Process Multiple Occurrence Data Structure
      *
     C                     Z-ADD0         I       20
     C           I         DOWLEX
      *
     C                     ADD  1         I
     C           I         OCUR MULT
      *
      ** Write a detail line to the report checking for overflow
      *
     C           WWOFL1    SUB  WWPTL1    WWLINE
      *
     C           WWLINE    IFLT 3
     C                     WRITEHEADER1
     C                     ENDIF
      *
     C                     WRITELINE1
      *
     C                     ENDDO
      *
     C                     ENDSR
      *****************************************************************
      /TITLE SR/SRF95
      *****************************************************************
      *                                                               *
      *  SRF95  - Format field :95a:                                  *
      *                                                               *
      *  Called By: SR/SR5SPY                                         *
      *  Calls    :                                                   *
      *                                                               *
      *****************************************************************
      *
     C           SRF95     BEGSR
      *
      ** Note that ZDEST must be set up before calling this subroutine
      *
     C                     MOVE *BLANKS   ZSADD1 35
     C                     MOVE *BLANKS   ZSADD2 35
     C                     MOVE *BLANKS   ZSADD3 35
     C                     MOVE *BLANKS   ZSADD4 35
     C                     MOVE *BLANKS   ZSTAG   1
     C                     MOVE *BLANKS   ZSTYPE  1
     C                     MOVE *BLANKS   ZERR    1
     C                     MOVE *BLANKS   ZCRNM  20
     C                     MOVE *BLANKS   ZCRTN  10
      *
     C*********************CALL 'ZM1150'               26                                     CSW036
     C                     CALL 'ZM1151'               26                                     CSW036
     C                     PARM           ZDEST
     C                     PARM           ZSADD1
     C                     PARM           ZSADD2
     C                     PARM           ZSADD3
     C                     PARM           ZSADD4
     C                     PARM           ZSTAG
     C                     PARM           ZSTYPE
     C                     PARM           ZERR
     C                     PARM           ZCRNM
     C                     PARM           ZCRTN
     C                     PARM           ZDBEI   1                                           CSW201
      *                                                                                     AR581757
      ** Clear ZDEST field                                                                  AR581757
      *                                                                                     AR581757
     C                     MOVE *BLANKS   ZDEST                                             AR581757
      *
      ** If program not found, perform DB Error processing
      *
     C           *IN26     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     Z-ADD019       DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *DB ERROR 019 *
     C*********************MOVEL'ZM1150'  DBPGM            * * * * * *                        CSW036
     C                     MOVEL'ZM1151'  DBPGM            * * * * * *                        CSW036
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** If an error occured in ZM1150
      *
     C           ZERR      IFEQ '1'
      *
     C                     MOVELERRA,4    MERR
     C                     MOVE 'Y'       @ERR
      *
      ** Access the next occurence in MULT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     ELSE
      *
      ** If ZSTAG is 'A'
      *
     C           ZSTAG     IFEQ 'A'
     C                     MOVEL':95P:'   MTAG
     C                     ENDIF
      *
      ** If ZSTAG is 'D'
      *
     C           ZSTAG     IFEQ 'D'
     C                     MOVEL':95Q:'   MTAG
     C                     ENDIF
      *
      ** Access tag description
      *
     C                     EXSR SRMTAG
      *
      ** Format Addresses
      *
     C                     EXSR SR#ZA
      *
     C                     ENDIF
      *
     C                     ENDSR
      *****************************************************************
      /TITLE SR/SR#ZA
      *****************************************************************
      *                                                               *
      *  SR#ZA  - Format Addresses                                    *
      *                                                               *
      *  Called By: SR/SRF95                                          *
      *  Calls    :                                                   *
      *                                                               *
      *****************************************************************
      *
     C           SR#ZA     BEGSR
      *
      ** If ZSADD1 is not blank
      *
     C           ZSADD1    IFNE *BLANKS
     C           WMDAT     CAT  ZSADD1:0  MDAT
     C                     MOVELMDAT      RDAT
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     ENDIF
      *
      ** If ZSADD2 is not blank
      *
     C           ZSADD2    IFNE *BLANKS
     C                     MOVELZSADD2    MDAT
     C                     MOVELWSEQ      MSEQ
     C                     MOVELMDAT      RDAT
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     ENDIF
      *
      ** If ZSADD3 is not blank
      *
     C           ZSADD3    IFNE *BLANKS
     C                     MOVELZSADD3    MDAT
     C                     MOVELWSEQ      MSEQ
     C                     MOVELMDAT      RDAT
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     ENDIF
      *
      ** If ZSADD4 is not blank
      *
     C           ZSADD4    IFNE *BLANKS
     C                     MOVELZSADD4    MDAT
     C                     MOVELWSEQ      MSEQ
     C                     MOVELMDAT      RDAT
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     ENDIF
      *
     C                     ENDSR
      *****************************************************************
      /TITLE SR/SRSWCY
      *****************************************************************
      *                                                               *
      *  SRSWCY - Retrieve the SWIFT currency code                    *
      *                                                               *
      *  Called By: SR/SRCDET                                         *
      *  Calls    :                                                   *
      *                                                               *
      *****************************************************************
      *
     C           SRSWCY    BEGSR
      *
     C                     CALL 'AOCURRR0'
     C                     PARM '*MSG   ' WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM           WCYCD
     C           SDCURR    PARM SDCURR    DSSDY
      *
      ** Database Error in SDCURRPD
      *
     C           WRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     Z-ADD011       DBASE            ***************
     C                     MOVEL'SDCURRPD'DBFILE           *DB ERROR 011 *
     C                     MOVELWCYCD     DBKEY            ***************
     C                     MOVEL'MG051N'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     ENDSR
      *****************************************************************
      /TITLE SR/SRCRTN
      *****************************************************************
      *                                                               *
      *  SRCRTN - Subroutine to output Certificate Numbers (:13B:)    *
      *                                                               *
      *  Called By: SRCDET                                            *
      *  Calls    :                                                   *
      *                                                               *
      *****************************************************************
      *
     C           SRCRTN    BEGSR
      *
     C                     MOVELMGTNUM    KTDRF
     C           KCRTN     CHAINSECRTNL1             54
     C           *IN54     DOWEQ*OFF
      *
     C           CNRNG2    SUB  CNRNG1    WDIFF   60
      *
     C           WDIFF     DOULT*ZERO
      *
     C                     MOVEL':13B:'   MTAG
     C                     EXSR SRMTAG
      *
     C           CNRNG2    SUB  WDIFF     W@RNGN  60
     C                     MOVE W@RNGN    W@RNGA  6
      *
     C           ':CERT//' CAT  CNSERI:0  MDAT
     C           MDAT      CAT  '.':0     MDAT
     C           MDAT      CAT  W@RNGA:0  MDAT
     C                     MOVELMDAT      RDAT
      *
     C                     ADD  1         X
     C           X         OCUR MULT
      *
     C                     SUB  1         WDIFF
     C                     ENDDO
      *
     C           KCRTN     READESECRTNL1                 54
      *
     C                     ENDDO
      *
     C                     ENDSR
      *****************************************************************
      /TITLE SR/SRMTAG
      *****************************************************************
      *                                                               *
      *  SRMTAG - Access tag/field description details                *
      *                                                               *
      *  Called By:                                                   *
      *  Calls    :                                                   *
      *                                                               *
      *****************************************************************
      *
     C           SRMTAG    BEGSR
      *
      ** CASE #1: XXXXX, XXX, XXX
      *
     C                     MOVE MGMTYP    KTYP
     C                     MOVE WSEQ      KSEQ
      *
     C           KMTAG     CHAINSDMTAGL0             51
      *
      ** CASE #2: XXXXX, XXX, ___
      *
     C           *IN51     IFEQ *ON
      *
     C                     MOVE MGMTYP    KTYP
     C                     MOVE *BLANK    KSEQ
     C           KMTAG     CHAINSDMTAGL0             51
      *
     C                     ENDIF
      *
      ** CASE #3: XXXXX, ALL, XXX
      *
     C           *IN51     IFEQ *ON
      *
     C                     MOVE 'ALL'     KTYP
     C                     MOVE WSEQ      KSEQ
     C           KMTAG     CHAINSDMTAGL0             51
      *
     C                     ENDIF
      *
      ** CASE #4: XXXXX, ALL, ___
      *
     C           *IN51     IFEQ *ON
      *
     C                     MOVE 'ALL'     KTYP
     C                     MOVE *BLANK    KSEQ
     C           KMTAG     CHAINSDMTAGL0             51
      *
     C                     ENDIF
      *
      ** If found, Move ISO field Desc to MULT/MDES
      *
     C           *IN51     IFEQ *OFF
      *
     C                     MOVELEFISFD    MDES
      *
      ** Otherwise, Move '<Tag Description not found>' MULT/MERR
      *
     C                     ELSE
      *
     C                     MOVELERRA,8    MERR
      *
     C                     ENDIF
      *
      ** Move Message Sequence (WSEQ) to MULT/MSEQ
      *
     C                     MOVE WSEQ      MSEQ
      *
     C                     ENDSR
      *****************************************************************
      /TITLE SR/SRUPDT
      *****************************************************************
      *                                                               *
      *  SRUPDT - Update transaction record                           *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls    :                                                   *
      *                                                               *
      *****************************************************************
      *
     C           SRUPDT    BEGSR
      *
      **   ... update sequence number on TRADSD/DPTMVD
      *
      **   Obtain Sequence Numbers from transaction record
      **   format @TRAN as follows:
      **     Chars 01-06 equal to leftmost 6 chars from MGTNUM
      **     Chars 07-13 equal to blanks
      **     Chars 14-15 equal to MGTTYP
      *
     C                     MOVE *BLANKS   WWTRAN 15
     C                     MOVE *BLANKS   WWFL06  6
     C                     MOVELMGTNUM    WWFL06
     C                     MOVELWWFL06    WWTRAN
     C                     MOVE MGTTYP    WWTRAN
      *
     C                     CALL 'MG5900'               21
     C                     PARM MGMODI    @MODI   2
     C                     PARM WWTRAN    @TRAN  15
     C                     PARM 'CE'      @PROG   2
     C                     PARM 'U'       @MODE   1
     C                     PARM *ZEROS    @LSWS   70
     C                     PARM *BLANKS   @ERCD   1
     C                     PARM           CSW003
      *
      ** If program not found, perform DB Error processing
      *
     C           *IN21     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     Z-ADD039       DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *DB ERROR 039 *
     C                     MOVEL'MG5900'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** If an error occurred in MG5900, perform DB Error processing
      *
     C           @ERCD     IFEQ 'Y'
     C           *LOCK     IN   LDA
     C                     MOVEL@TRAN     WW0317
     C                     Z-ADD035       DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *DB ERROR 040 *
     C                     MOVELDBERR     DBKEY            * * * * * * * *
     C                     MOVEL'MG5900'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      **   ... update confirmation generated indicator
      *
      **   Obtain Generation Generated Indicator format @TREF as follows:
      **     Chars 01-06 equal to leftmost 6 chars from MGTNUM
      **     Chars 07-13 equal to blanks
      **     Chars 14-15 equal to MGTTYP
      *
     C                     MOVE *BLANKS   WWTREF 15
     C                     MOVE *BLANKS   WWFL06  6
     C                     MOVELMGTNUM    WWFL06
     C                     MOVELWWFL06    WWTREF
     C                     MOVE MGTTYP    WWTREF
      *
     C                     CALL 'MG5910'               22
     C                     PARM MGMODI    @MODI   2
     C                     PARM WWTREF    @TREF  15
     C                     PARM 'CE'      @PROG   2
     C                     PARM 'U'       @MODE   1
     C                     PARM *BLANKS   @CONG   1
     C                     PARM *BLANKS   @RCDG   1
     C                     PARM *BLANKS   @ERCD   1
     C                     PARM           CSW003
      *
      ** If program not found, perform DB Error processing
      *
     C           *IN22     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     Z-ADD035       DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *DB ERROR 041 *
     C                     MOVEL'MG5910'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** If an error occured in MG5910, perform DB Error processing
      *
     C           @ERCD     IFEQ 'Y'
     C           *LOCK     IN   LDA
     C                     MOVEL@TREF     WW0317
     C                     Z-ADD037       DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *DB ERROR 0042*
     C                     MOVELDBERR     DBKEY            * * * * * * * *
     C                     MOVEL'MG5910'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     ENDSR
      *****************************************************************                       CSW207
      /TITLE SR/SRMFID                                                                        CSW207
      *****************************************************************                       CSW207
      *                                                               *                       CSW207
      *  SRMFID - Subroutine to check if Sending Branch and Customer  *                       CSW207
      *           are MiFID compliant                                 *                       CSW207
      *                                                               *                       CSW207
      *****************************************************************                       CSW207
      *                                                                                       CSW207
     C           SRMFID    BEGSR                                                              CSW207
     C                     MOVEL'N'       WBRCA                                               CSW207
     C                     MOVEL'N'       WDEST                                               CSW207
     C                     MOVEL'N'       WMFID                                               CSW207
      *                                                                                       CSW207
      ** Check if sending branch is MFID Compliant                                            CSW207
      *                                                                                       CSW207
     C           MGSNBR    IFNE *BLANKS                                                       CSW207
     C                     CALL 'AOBRCHR1'                                                    CSW207
     C                     PARM '*MSG   ' WRTCD                                               CSW207
     C                     PARM '*KEY   ' WOPTN                                               CSW207
     C                     PARM MGSNBR    WBRCH   3                                           CSW207
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CSW207
      *                                                                                       CSW207
      ** Database Error                                                                       CSW207
      *                                                                                       CSW207
     C           WRTCD     IFNE *BLANKS                                                       CSW207
     C           *LOCK     IN   LDA                                                           CSW207
     C                     Z-ADD025       DBASE            ***************                    CSW207
     C                     MOVEL'SDBRCHPD'DBFILE           *DB ERROR 025 *                    CSW207
     C                     MOVE WBRCH     DBKEY            ***************                    CSW207
     C                     OUT  LDA                                                           CSW207
     C                     EXSR *PSSR                                                         CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
      ** If location code is not blank, check location code.                                  261402
      ** Otherwise, flag sending branch as not MiFID compliant.                               261402
      *                                                                                       261402
     C           A8LCCD    IFNE *BLANKS                                                       261402
      *                                                                                       261402
     C                     CALL 'AOLOCNR0'                                                    CSW207
     C                     PARM *BLANKS   @RTCD                                               CSW207
     C                     PARM '*KEY   ' @OPTN                                               CSW207
     C                     PARM A8LCCD    @LOCN   3                                           CSW207
     C           SDLOCN    PARM SDLOCN    DSFDY                                               CSW207
      *                                                                                       CSW207
      ** Database error proceesing                                                            CSW207
      *                                                                                       CSW207
     C           @RTCD     IFNE *BLANKS                                                       CSW207
     C           *LOCK     IN   LDA                                                           CSW207
     C                     Z-ADD047       DBASE            ***************                    CSW207
     C                     MOVEL'SDLOCNPD'DBFILE           *DB ERROR 047 *                    CSW207
     C                     MOVE @LOCN     DBKEY            ***************                    CSW207
     C                     OUT  LDA                                                           CSW207
     C                     EXSR *PSSR                                                         CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
     C           DVCNCD    CHAINMEISOCL1             56                                       CSW207
     C           *IN56     IFEQ '1'                                                           CSW207
     C           *LOCK     IN   LDA                                                           CSW207
     C                     Z-ADD048       DBASE            ***************                    CSW207
     C                     MOVEL'MEISOCPD'DBFILE           *DB ERROR 048 *                    CSW207
     C                     MOVE DVCNCD    DBKEY            ***************                    CSW207
     C                     OUT  LDA                                                           CSW207
     C                     EXSR *PSSR                                                         CSW207
     C                     ENDIF                                                              CSW207
     C           M3MFID    IFEQ 'Y'                                                           CSW207
     C                     MOVEL'Y'       WBRCA                                               CSW207
     C                     ENDIF                                                              CSW207
     C                     ENDIF                                                              261402
     C                     ENDIF                                                              CSW207
      ** Check if Destination Customer is MiFID compliant                                     CSW207
      *                                                                                       CSW207
     C           MGDEST    IFNE *ZEROS                                                        CSW207
     C                     MOVE MGDEST    WCUST                                               CSW207
     C                     CALL 'AOCUSTR0'                                                    CSW207
     C                     PARM *BLANKS   @RTCD                                               CSW207
     C                     PARM '*KEY   ' @OPTN                                               CSW207
     C                     PARM WCUST     @KEY                                                CSW207
     C                     PARM *BLANKS   @KYST                                               CSW207
     C           SDCUST    PARM SDCUST    DSLDY                                               CSW207
      *                                                                                       CSW207
      ** Database Error                                                                       CSW207
      *                                                                                       CSW207
     C           WRTCD     IFNE *BLANKS                                                       CSW207
     C           *LOCK     IN   LDA                                                           CSW207
     C                     Z-ADD049       DBASE            ***************                    CSW207
     C                     MOVEL'SDCUSTPD'DBFILE           *DB ERROR 049 *                    CSW207
     C                     MOVE @KEY      DBKEY            ***************                    CSW207
     C                     OUT  LDA                                                           CSW207
     C                     EXSR *PSSR                                                         CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
     C           BBCOLC    CHAINMEISOCL1             56                                       CSW207
     C           *IN56     IFEQ '1'                                                           CSW207
     C           *LOCK     IN   LDA                                                           CSW207
     C                     Z-ADD053       DBASE            ***************                    CSW207
     C                     MOVEL'MEISOCPD'DBFILE           *DB ERROR 053 *                    CSW207
     C                     MOVE BBCOLC    DBKEY            ***************                    CSW207
     C                     OUT  LDA                                                           CSW207
     C                     EXSR *PSSR                                                         CSW207
     C                     ENDIF                                                              CSW207
     C           M3MFID    IFEQ 'Y'                                                           CSW207
     C                     MOVEL'Y'       WDEST                                               CSW207
     C                     ENDIF                                                              CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
      ** Retrieve the classification of the customer                                          CSW207
      *                                                                                       CSW207
     C                     MOVE MGDEST    WCUST                                               CSW207
     C                     CALL 'AOSECSR0'                                                    CSW207
     C                     PARM *BLANKS   @RTCD                                               CSW207
     C                     PARM '*KEY   ' @OPTN                                               CSW207
     C                     PARM WCUST     @KEY                                                CSW207
     C           SDSECS    PARM SDSECS    DSSDY                                               CSW207
      *                                                                                       CSW207
      ** Database Error                                                                       CSW207
      *                                                                                       CSW207
     C           @RTCD     IFNE *BLANKS                                                       CSW207
     C           *LOCK     IN   LDA                                                           CSW207
     C                     Z-ADD026       DBASE            ***************                    CSW207
     C                     MOVEL'SDSECSPD'DBFILE           *DB ERROR 026 *                    CSW207
     C                     MOVE @KEY      DBKEY            ***************                    CSW207
     C                     OUT  LDA                                                           CSW207
     C                     EXSR *PSSR                                                         CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
      ** Check if both are MiFID compliant                                                    CSW207
      *                                                                                       CSW207
     C           WBRCA     IFEQ 'Y'                                                           CSW207
     C           WDEST     ANDEQ'Y'                                                           CSW207
     C                     MOVEL'Y'       WMFID                                               CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
     C                     ENDSR                                                              CSW207
      *****************************************************************                       CSW207
     C/EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      *                                                               *                       CSD015
      *  SRWTCH - Watch Processing                                    *                       CSD015
      *                                                               *                       CSD015
      *****************************************************************                       CSD015
      *                                                                                       CSD015
     C           SRWTCH    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Check if message is for automatic release.                                           CSD015
      ** If yes, default to CRTD status and set Automatic Release Flag to 'Y'                 CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       PARLS   1                                           CSD015
     C           MGST      IFEQ 'RSND'                                                        CSD015
     C           NWRK      IFEQ 'SWIFT '                                                      CSD015
     C           NWRK      OREQ 'TELEX '                                                      CSD015
     C           NWRK      OREQ 'STTX  '                                                      CSD015
     C                     MOVE 'CRTD'    MGST                                                CSD015
     C                     MOVE '1'       MGSG                                                CSD015
     C                     MOVE 'Y'       PARLS                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     CLEARWLTDS                                                         CSD015
     C                     MOVE *BLANKS   PSTRNG                                              CSD015
     C                     MOVE *ZEROS    W4VDAT                                              CSD015
     C                     MOVE *ZEROS    W4MDAT                                              CSD015
     C                     MOVE *ZEROS    W4AMT1                                              CSD015
     C                     MOVE *ZEROS    W4AMT2                                              CSD015
      *                                                                                       CSD015
      ** Setup parameters for Compliance engine program                                       CSD015
      *                                                                                       CSD015
     C                     MOVELTRNO      W4IDEN                                              CSD015
     C                     MOVELMTPY      W4ITEM                                              CSD015
     C                     MOVELMGSNBR    W4BRCH                                              CSD015
     C                     MOVEL'MGOREF'  W4FUNT                                              CSD015
     C                     MOVELDECN      W4CNUM                                              CSD015
     C                     Z-ADDBJRDNB    W4DDAT                                              CSD015
     C                     MOVELPARLS     W4ARLS                                              CSD015
      *                                                                                       CSD015
      ***Send*transaction*to compliance engine program                                 CSD015 221145
      *********************                                                            CSD015 221145
     C*********************CALL 'SDWLCLOP'                                             CSD015 221145
     C*********************PARM           WLTDS                                        CSD015 221145
     C*********************PARM *BLANKS   PSTRNG                                       CSD015 221145
      *                                                                                       CSD015
     C           EWATCH    ENDSR                                                              CSD015
      *                                                                                       CSD015
     C/EJECT                                                                                  221145
      *****************************************************************                       221145
      *                                                               *                       221145
      *  WLCDQ - Submit information to Watch List Check Dtaq          *                       221145
      *                                                               *                       221145
      *****************************************************************                       221145
      *                                                                                       221145
     C           WLCDQ     BEGSR                                                              221145
      *                                                                                       221145
      *  Send transaction to compliance engine program                                        221145
      *                                                                                       221145
     C                     CALL 'SDWLCLOP'                                                    221145
     C                     PARM           WLTDS                                               221145
     C                     PARM *BLANKS   PSTRNG                                              221145
      *                                                                                       221145
      *                                                                                       221145
     C                     ENDSR                                                              221145
      *                                                                                       221145
      *****************************************************************                       CSD015
      *****************************************************************                     BUG19304
      /TITLE SR/SRLCTM                                                                      BUG19304
      *****************************************************************                     BUG19304
      *                                                               *                     BUG19304
      *  SRLCTM - Subroutine to get local time and offset if Market   *                     BUG19304
      *           is not present                                      *                     BUG19304
      *                                                               *                     BUG19304
      *****************************************************************                     BUG19304
      *                                                                                     BUG19304
     C           SRLCTM    BEGSR                                                            BUG19304
      *                                                                                     BUG19304
     C                     CALL 'ZA0140'                                                    BUG19304
     C                     PARM MGTDAT    SSDAYN  50                                        BUG19304
     C                     PARM BJDFIN    SSDFMT  1                                         BUG19304
     C                     PARM *ZERO     SSDATE  60                                        BUG19304
     C                     PARM *BLANKS   SSDATA  7                                         BUG19304
     C                     PARM *BLANKS   SSRTN   1                                         BUG19304
     C                     PARM *ZERO     SSDAT8  80                                        BUG19304
     C                     MOVE SSDATE    ZSDATE                                            BUG19304
      *                                                                                     BUG19304
      ** Get system offset                                                                  BUG19304
      *                                                                                     BUG19304
     C                     MOVEL*BLANKS   WSYOF   4                                         BUG19304
     C                     MOVEL*BLANKS   WSYSG   1                                         BUG19304
     C                     CALL PGMF                                                        BUG19304
     C                     PARM '05'      POPTYP  2                                         BUG19304
     C                     PARM ZSDATE    PDATE1  6                                         BUG19304
     C                     PARM *BLANKS   PTIME1  6                                         BUG19304
     C           WSYSG     PARM *BLANKS   PSIGN1  1                                         BUG19304
     C           WSYOF     PARM *BLANKS   POFFS1  4                                         BUG19304
     C                     PARM *BLANKS   PDATE2  6                                         BUG19304
     C                     PARM *BLANKS   PTIME2  6                                         BUG19304
     C                     PARM *BLANKS   PSIGN2  1                                         BUG19304
     C                     PARM *BLANKS   POFFS2  4                                         BUG19304
     C                     PARM *BLANKS   PBRCH   3                                         BUG19304
     C                     PARM *BLANKS   PMICD   3                                         BUG19304
      *                                                                                     BUG19304
      ** Get branch offset                                                                  BUG19304
      *                                                                                     BUG19304
     C                     MOVEL*BLANKS   WBROF   4                                         BUG19304
     C                     MOVEL*BLANKS   WBRSG   1                                         BUG19304
     C                     CALL PGMF                                                        BUG19304
     C                     PARM '04'      POPTYP                                            BUG19304
     C                     PARM ZSDATE    PDATE1                                            BUG19304
     C                     PARM *BLANKS   PTIME1                                            BUG19304
     C           WBRSG     PARM *BLANKS   PSIGN1                                            BUG19304
     C           WBROF     PARM *BLANKS   POFFS1                                            BUG19304
     C                     PARM *BLANKS   PDATE2                                            BUG19304
     C                     PARM *BLANKS   PTIME2                                            BUG19304
     C                     PARM *BLANKS   PSIGN2                                            BUG19304
     C                     PARM *BLANKS   POFFS2                                            BUG19304
     C                     PARM MGSNBR    PBRCH                                             BUG19304
     C                     PARM *BLANKS   PMICD                                             BUG19304
      *                                                                                     BUG19304
      ** Get converted branch time                                                          BUG19304
      *                                                                                     BUG19304
     C                     CALL PGMF                                                        BUG19304
     C                     PARM '02'      POPTYP                                            BUG19304
     C                     PARM ZSDATE    PDATE1                                            BUG19304
     C                     PARM MGTRTT    PTIME1                                            BUG19304
     C                     PARM WSYSG     PSIGN1                                            BUG19304
     C                     PARM WSYOF     POFFS1                                            BUG19304
     C                     PARM *BLANKS   PDATE2                                            BUG19304
     C                     PARM *BLANKS   PTIME2                                            BUG19304
     C                     PARM WBRSG     PSIGN2                                            BUG19304
     C                     PARM WBROF     POFFS2                                            BUG19304
     C                     PARM *BLANKS   PBRCH                                             BUG19304
     C                     PARM *BLANKS   PMICD                                             BUG19304
      *                                                                                     BUG19304
     C                     MOVE PDATE2    PZDATE                                            BUG19304
     C                     CALL 'ZDATE1'                                                    BUG19304
     C                     PARM *BLANKS   PRTCD   7                                         BUG19304
     C                     PARM           PZDATE  60                                        BUG19304
     C                     PARM           BJDFIN                                            BUG19304
     C                     PARM *ZERO     PZDAYN  50                                        BUG19304
      *                                                                                     BUG19304
     C           PRTCD     IFEQ *BLANKS                                                     BUG19304
     C                     CALL 'ZM0065'                                                    BUG19304
     C                     PARM PZDAYN    ZMDAY                                             BUG19304
     C                     PARM           ZSDATE                                            BUG19304
     C                     PARM *BLANKS   ZSDATC                                            BUG19304
     C                     MOVE ZSDATC    WSDATE                                            BUG19304
     C                     ENDIF                                                            BUG19304
     C                     MOVE PTIME2    WSTIME                                            BUG19304
      *                                                                                     BUG19304
     C                     ENDSR                                                            BUG19304
      *****************************************************************                       CSW207
      /TITLE SR/GETRCL                                                                        CSW207
      *****************************************************************                       CSW207
      *                                                               *                       CSW207
      *  GETRCL- Get record length                                    *                       CSW207
      *                                                               *                       CSW207
      *****************************************************************                       CSW207
      *                                                                                       CSW207
     C           GETRCL    BEGSR                                                              CSW207
      *                                                                                       CSW207
     C           'UTGETRCD'CAT  'LN'      P#PGM  10                                           CSW207
      *                                                                                       CSW207
     C                     CALL P#PGM                                                         CSW207
     C                     PARM           P#RTCD 10                                           CSW207
     C                     PARM           P#RCDL  50                                          CSW207
     C                     PARM           P#FILN 10                                           CSW207
     C                     PARM '*LIBL'   P#LIBN 10                                           CSW207
      *                                                                                       CSW207
     C           P#RTCD    IFNE *BLANK                                                        CSW207
     C                     EXSR *PSSR                                                         CSW207
     C                     ENDIF                                                              CSW207
      *                                                                                       CSW207
     C                     ENDSR                                                              CSW207
      *                                                                                       CSW207
      *****************************************************************                       CSW210
      **                                                              *                       CSW210
      **  SRSWFT    - SWIFT Address validation                        *                       CSW210
      **                                                              *                       CSW210
      **  Calls     - ME1400                                          *                       CSW210
      **  Called By - SRCSHP                                          *                       CSW210
      **                                                              *                       CSW210
      *****************************************************************                       CSW210
      *                                                                                       CSW210
     C           SRSWFT    BEGSR                                                              CSW210
     C                     SETOF                     90                                       CSW210
      *                                                                                       CSW210
      ** Test positions 1-8 for valid SWIFT Characters                                        CSW210
      ** Check how many characters are alphanumeric                                           CSW210
     C                     MOVEL*BLANKS   FLD    35                                           CSW210
     C                     MOVELMGDAD1    FLD                                                 CSW210
     C           ALPHAN    CHECKFLD       X#      30     90                                   CSW210
      *                                                                                       CSW210
      ** If the first 8 or 11 are ok proceed                                                  CSW210
     C           *IN90     IFEQ *ON                                                           CSW210
     C           X#        ANDEQ9                                                             CSW210
     C           *IN90     OREQ *ON                                                           CSW210
     C           X#        ANDEQ12                                                            CSW210
     C           ' '       CHECKFLD:X#    ##001   10     90                                   CSW210
      *                                                                                       CSW210
      ** Check for blanks if before 8 or 11 then assume address                               CSW210
     C           *IN90     IFEQ *ON                                                           CSW210
     C           X#        ANDEQ11                                                            CSW210
     C                     MOVE 'Y'       ##CSID  1                                           CSW210
     C                     GOTO ENDSWT                                                        CSW210
     C                     ENDIF                                                              CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
      ** Invalid format - Not a S.W.I.F.T.                                                    CSW210
     C           *IN90     IFEQ *ON                                                           CSW210
     C                     MOVE 'N'       ##CSID                                              CSW210
     C                     GOTO ENDSWT                                                        CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
      ** Call Access object to validate identifier                                            CSW210
     C                     MOVELFLD       W9BICC                                              CSW210
     C           3         SUBSTFLD:9     W9BICB                                              CSW210
      *                                                                                       CSW210
     C                     CALL 'ME1400'                                                      CSW210
     C                     PARM *BLANKS   W9RTN   7                                           CSW210
     C                     PARM           W9BICC  8                                           CSW210
     C                     PARM           W9BICB  3                                           CSW210
     C                     PARM           SDCUST                                              CSW210
     C                     PARM           SDCNST                                              CSW210
     C                     PARM           MEBICD                                              CSW210
     C                     PARM *BLANKS   W9CUST  1                                           CSW210
     C                     PARM *BLANKS   W9CNST  1                                           CSW210
     C                     PARM *BLANKS   W9BICD  1                                           CSW210
      *                                                                                       CSW210
      ** Record found - BIC exists                                                            CSW210
     C           W9RTN     IFEQ *BLANKS                                                       CSW210
     C                     MOVE 'Y'       ##CSID                                              CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
     C           ENDSWT    TAG                                                                CSW210
     C                     ENDSR                                                              CSW210
      *****************************************************************
      /TITLE SR/*PSSR
      *****************************************************************
      *                                                               *
      * *PSSR  - Program exception error routine                      *
      *          Called automatically if a program error occurs,      *
      *          or directly by the program code using EXSR.          *
      *          This subroutine DUMPs the program just once.         *
      *                                                               *
      * Called by: (**calling routines**)                             *
      *                                                               *
      * Calls: None                                                   *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           *PSSR     BEGSR                           ** *PSSR SR **
      *
      ** Rollback all file changes
      *
     C                     ROLBK
      *
      ** Write Database Error to report
      *
     C                     OPEN MG051NAU
     C                     WRITEHEADAU
     C                     WRITEDBERROR
      *
     C           @RUN      IFEQ *BLANK
     C                     MOVE 'Y'       @RUN    1
     C                     DUMP
     C                     ENDIF
      *
     C                     SETON                     U7U8LR
     C                     RETRN
      *
     C                     ENDSR
      *
      ********************************************************************
     C/COPY MGCPYSRC,SWIFTTRANS                                           140440
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
** ERRA - Error Message Description
Destination Customer Number not found
*** Message is Unroutable ***
Price Basis (MGSPBS) field is not 'P' or 'U'
ZM1150 (format address) call ended in error
Quantity of Financial Instrument is zero
ISIN Code of Securities is blank
ZM1050 (format cert. no.) call ended in error
<Tag Description not found>
ZM1240 (format ccy and amount) call ended in error
Deliverer of Securities (MGDSSN) is blank
Receiver of Securities (MGRSSN) is blank
Market Centre does not refer to an active Market Centre in SE Standing data file              CSW203
** TYPA - Trade Type Description
TRADE SALE
TRADE PURCHASE
