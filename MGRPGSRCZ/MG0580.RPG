     H******  1                                                           S01421
     H        1                           F                               S01421
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas MG Instrs to clearing system messages')          *
      *****************************************************************
      *                                                               *
      *  Midas - Message Generation Module                            *
      *                                                               *
      *   MG0580 - FORMAT MT580 MESSAGES                              *
      *                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. CER059             Date 19Jul10               *
      *  Prev Amend No. CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 BUG6198            Date 04Apr05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CSW025             Date 26Mar02               *
      *                 192221             Date 26Nov01               *
      *                 184136             Date 29Oct01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CSW201             Date 02May01               *
      *                 183583             Date 25Jun01               *
      *                 CSE022             Date 29Mar01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 188866             Date 20Mar01               *
      *                 185241             Date 29Dec00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CDL008             Date 02May00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 167826             DATE 22Jun00               *
      *                 173491             Date 26Jan00               *
      * Midas DBA 3.02 -----------------------------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 141572             DATE 21SEP98               *
      *                 CEU005             DATE 04FEB98               *
      *                 113207             DATE 03MAR98               *
      *                 113352             DATE 13FEB98               *
      *                 122078             DATE 17Feb98               *
      *                 122283             DATE 16FEB98               *
      *                 CFF004             DATE 02OCT96               *
      *                 064596             DATE 10MAY96               *
      *                 090572             DATE 09MAY96               *
      *                 068695             DATE 09MAY96               *
      *                 056532             DATE 09MAY96               *
      *                 057263             DATE 09MAY96               *
      *                 102916             DATE 08MAY96               *
      *                 073848             DATE 08MAY96               *
      *                 078256             DATE 07MAY96               *
      *                 071394             DATE 03MAY96               *
      *                 102766             DATE 02MAY96               *
      *                 082282             DATE 02MAY96               *
      *                 CSW003             DATE 09JAN96               *
      *                 089450             DATE 12JAN95               *
      *                 091250             DATE 24FEB95               *
      *                 080096             DATE 12JAN95               *
      *                 069020             DATE 15APR94               *
      *                 S01421             DATE 18AUG93               *
      *                 S01401             DATE 14JUN93               *
      *                                                               *
      *****************************************************************
      *                                                               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  BUG6198- Cannot save new Details for CUSD (Recompile)        *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CSW025 - Midas Message Manager                               *
      *           - Pass original change type & suppress multiples    *
      *  192221 - Format message tag 87 to include account lines      *
      *           2 to 4.                                             *
      *  184136 - Allow field 35A to be correctly formatted for       *
      *           several types of Swift Security Code.               *
      *  CSW201 - SWIFT 2001 Standards Update                         *
      *  183583 - Add extension file MGOEXTPD to store customer no.   *
      *           of field with SWIFT address.                        *
      *  CSE022 - Depository Definition Enhancement                   *
      *  188866 - 167826 incomplete - add extra parm to all calls to  *
      *           ZM1340.                                             *
      *  185241 - Database error in SEC0603. Applied fixes 141579,    *
      *           138847 and 130960.                                  *
      *  CDL008 - Continuous Linked Settlement (Recompiled)           *
      *  167826 - DataBase error in ZM1340 at 061. Apply 153374.      *
      *  173491 - Check if MGCCTN contains SWIFT ID else assume it is *
      *           customer no. or shortname. Apply fix 168025.        *
      *  141572 - Setup CINDV (century flag) SVDT ( value date).      *
      *  CEU005 - EMU SE Settlement Ccy Conversion.                   *
      *  113207 - For clearance type 2 or 4 the system should format  *
      *           the clearing correspondent (field 84a) with the     *
      *           counterparty depot reference number.                *
      *           (ie. For 'TP' use "Deliver from" and for 'TS' use   *
      *                "Deliver to".)                                 *
      *  113352 - Set-up CIND (Century flag)  to correct year2000     *
      *           display problem.                                    *
      *  122078 - BYPASS THE ACCOUNT LINE AND GET CSID AFTER IN CASE  *
      *           OPTION TAG 'A' DOES NOT START WITH ACCOUNT LINE.    *
      *  122283 - Blank line in MGOMSGPD if account number is blank   *
      *           and not account line.                               *
      *  CFF004 - Increase in size of Price Fields,(Recompiled Only)  *
      *  064596 - Field 87C report name,town not shown on MG0580P1    *  *
      *  090572 - Processing when WWLENG is greater than 2000 is      *  *
      *           inconsistent.                                       *  *
      *  068695 - Some transactions rejected by EUROCLEAR due to      *
      *           wrong trade price.                                  *
      *  056532 - Process incorrect car. '-' ' ' ':' in first position*
      *  057263 - All postiion in field "MTAG" need to be full.       *
      *  102916 - Field :33T: 'YLD' instead 'REN' if trade basis is
      *           'Y' = yield basis. Price field will already contain
      *           the 'Price/Discount/Yield' value.
      *  073848 - Avoid corruption of message sub-type                *  *
      *  078256 - Use nominal decimal places from file                *
      *  071394 - For MT592, field 33T is formatted in the same       *
      *           way as field 37J,37L,37S,37P. (for report only)     *
      *           That's not correct as they do not have the          *
      *           same syntax.                                        *
      *           Field 33T -> 3a,15n         Field 37x -> 15n        *
      *           All the fields are not correctly formatted on       *
      *           report. File is correctly updated.                  *
      *  102766 - Depot movement messages have wrong price format     *
      *  082282 - Set message status according to customer details    *
      *  CSW003 - MT5XX Message Generation - Phase 2. New structure   *
      *           for TRN of MT580 in order to differenciate between  *
      *           'DN' and 'DT' subtype for depot movement.           *
      *  089450 - Setup WWSENT before it is used for comparison.      *
      *  091250 - Print Files MG0580P1/P2 renamed to MG0580A1/A2 as   *
      *           these are audit reports.                            *
      *  080096 - RECOMPILE BECAUSE COPY MEMBER MGCPYSRC,SWIFTTRANS   *
      *           CHANGED                                             *
      *  069020 - MULTIPLE DATA ARRAYS FOR MGOREFD NOT BEING CLEAR    *
      *           CORRECTLY CAUSED MESSAGE DROP PROGRAM ENDED         *
      *           ABNORMALLY.                                         *
      *  S01421 - REPLACE THE SWIFT TRANSLATION TABLE WITH A          *
      *           /COPY STATEMENT (SWIFTTRANS).                       *
      *  S01401 - MT500 messages for Release 10.                      *
      *           (This also includes SWIFT SEPT 93 message format    *
      *           changes)                                            *
      *                                                               *
      *****************************************************************
     F*
     FMGF580L0UF  E           K        DISK         KCOMIT
     F                                              KINFSR *PSSR
     FMGOREFL0UF  E           K        DISK         KCOMIT
     F                                              KINFSR *PSSR
     F            MGOREFD0                          KRENAMEMGORELA
     FMGOMSGLAIF  E           K        DISK         KINFSR *PSSR
     F            MGOMSGD0                          KRENAMEMGMSGLA
     FSDCUSTL7IF  E           K        DISK         KINFSR *PSSR
     FSDBANKPDIF  E                    DISK         KINFSR *PSSR
     FSDSTRDPDIF  E                    DISK         KINFSR *PSSR
     FSDCUSTL1IF  E           K        DISK         KINFSR *PSSR
     FSDCUSTL6IF  E           K        DISK         KINFSR *PSSR
     FSDSECSL1IF  E           K        DISK         KINFSR *PSSR
     FSDSECSJ4IF  E           K        DISK         KINFSR *PSSR
     F            SDCUSTZ0                          KRENAMESDCUSZ4
     FSDSECSJ5IF  E           K        DISK         KINFSR *PSSR
     F            SDCUSTZ0                          KRENAMESDCUSZ5
     FSDBRCHL1IF  E           K        DISK         KINFSR *PSSR
     FSDCURRL1IF  E           K        DISK         KINFSR *PSSR
     FSDMGMEPDIF  E                    DISK         KINFSR *PSSR
     FSECRTNL1IF  E           K        DISK         KINFSR *PSSR      UC
     FMGE580PDIF  E                    DISK         KINFSR *PSSR
     FMGOREFPDO   E                    DISK         KCOMIT
     F                                              KINFSR *PSSR
     FMGOMSGPDO   E                    DISK         KCOMIT
     F                                              KINFSR *PSSR
     FMGOEXTPDO   E                    DISK         KCOMIT                183583
     F                                              KINFSR *PSSR          183583
     F*G0580P1O***E********************PRINTER******KINFDS*OVRFL1         091250
     FMG0580A1O   E                    PRINTER      KINFDS OVRFL1         091250
     F                                              KINFSR *PSSR
     F*G0580P2O***E********************PRINTER******KINFDS*OVRFL2     UC  091250
     FMG0580A2O   E                    PRINTER      KINFDS OVRFL2     UC  091250
     F                                              KINFSR *PSSR
     FMG0580AUO   E                    PRINTER                        UC
     FMGF579PDO   E                    DISK         KINFSR *PSSR      UC
     F*
     F/COPY WNCPYSRC,MG0580F001
     F*****************************************************************
     F/EJECT
     F*****************************************************************
     E*
     E** ARRAY USED FOR COPYRIGHT
     E                    CPY@    1   1 80
     E*
     E** ARRAY TO DETERMINE FIELD REQUIREMENTS
     E                    ARR1       38 50
     E*
     E** ARRAY OF CASE NUMBERS FOR FIELD :87a: PROCESSING
     E                    ARR2   14  28  2 0
     E*
     E** ARRAY USED TO FORMAT ERROR MESSAGE FIELD ON MULTIPLE
     E** OCCURENCE DATA STRUCTURE
     E**********          ERRA    1  53 55                                 68695
     E                    ERRA    1  54 55                                 68695
     E*
     E** ARRAY USED TO FORMAT DESCRIPTION FIELD ON MULTIPLE
     E** OCCURENCE DATA STRUCTURE
     E                    DESA    1  32 36
     E*
     E** ARRAY OF NUMERIC VALUES
     E                    NUM    10  10  1
     E*
     E** ARRAY USED TO GENERATE ONLY MANDATORY FIELDS
     E                    OPT        50  1
     E*
     E** ARRAY USED TO REMOVE FORBIDDEN CHARACTERS (E.G. %)
     E                    FORB       50  1
     E*
     E** ARRAY FOR FORMATTING CANCELLATION MESSAGES
     E                    TAGAMT  4   4  5
     E                    TAGRAT  5   5  5
     E                    TAGBIC  4   4  5
     E                    TAGOTH 16  18  5
     E                    TABT   11  38  5   TABN    2 0
     E*
     E/COPY ZSRSRC,ZDATE1Z1
     E*
      **  Array used to set message status                                082282
     E                    @ST        15  3                                082282
      *                                                                   082282
     E*****************************************************************
     E/EJECT
     E*****************************************************************
     IMGMSGLA
     I              MTAG                            OMTAG
     I              MFLD                            OMFLD
     I              CTRC                            OCTRC
     I              TRNO                            OTRNO
     I              PTDL                            OPTDL
     I*
     I** Multiple occurrence data structure for message
     IMULT        DS                        500
     I                                        1  36 MDES
     I                                       37  41 MTAG
     I                                       42  91 MDAT
     I                                       92 146 MERR
     I                                      160 179 CRNM
     I                                      182 191 CRTN
     I                                      147 196 RDAT
     I                                      201 220 R1RDNM
     I                                      221 230 R1RDTN
     I*
     I** Multiple occurrence data structure for incorrectly
     I** formatted messages
     IWMULT       DS                        500
     I                                        1   5 WMTAG
     I                                        6  55 WMDAT
     I                                       56 110 WMERR
      *                                                                   183583
      ** Multiple occurrence data structure for extension file            183583
      *                                                                   183583
     IEXTN        DS                         95                           183583
     I                                        1   20MPSN                  183583
     I                                        3   7 MTG                   183583
     I                                        8  15 MCSI                  183583
      *                                                                   183583
      ** Field tag data structure                                         183583
      *                                                                   183583
     I            DS                                                      183583
     I                                        1   5 @MTG                  183583
     I                                        2   2 FLDTYP                183583
     I                                        4   4 FLDTAG                183583
     I*
     I** Multiple occurrence data structure for each MGOREFPD record
     IREFDS       DS                         10
     I                                        1   2 WWMOD
     I                                        3  18 WWTRNO
     I                                       19  33 WWMTRN
     I                                       34  35 WWTNTP
     I                                       36  37 WWSBTP
     I                                       38  43 WWDECN
     I                                       44  63 WWNWBN
     I                                       64  69 WWSVDT
     I                                       70  72 WWCCY
     I                                       73  75 WWBRCA
     I                                       76  81 WWHRDT
     I*
     I** Multiple occurrence data structure for each Transaction field
     ITRANS       DS                         11
     I                                        1  16 WWTRNM
     I*
     I** Local data area
     ILDA         DS                            256
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     I*
     I** DATA STRUCTURE TO OBTAIN THE LATEST MT580 TRN
     IM5STAT    E DS
     I*
     I** DATA STRUCTURE FOR CONSTRUCTING DATA FIELD
     IWWMDAT      DS                         50
     I                                        1   3 WD0103
     I                                        1   4 WD0104
     I                                        1   5 WD0105
     I                                        1   6 WD0106
     I                                        1   7 WD0107
     I                                        1  12 WD0112
     I                                        4   9 WD0409
     I                                        4  19 WD0419
     I                                        4  20 WD0420
     I                                        5  16 WD0516
     I                                        6  17 WD0617
     I                                        7   9 WD0709
     I                                        7  10 WD0710
     I                                        8   8 WD0808
     I                                        8  10 WD0810
     I                                        8  17 WD0817
     I                                        9  13 WD0913
     I                                       10  16 WD1016
     I                                       14  16 WD1416
     I*
     I** DATA STRUCTURE FOR CONSTRUCTING DATA FIELD
     IWWRDAT      DS                         50
     I                                        1   8 WR0108
     I                                        9  12 WR0912
     I                                        1   3 WR0103
     I                                        4  24 WR0424
     I                                        9  37 WR0937
     I*
     I** DATA STRUCTURE TO DETERMINE FIELD REQUIREMENTS
     IWWFDAT      DS
     I                                        1  50 WWFLDS
     I                                        1   1 WWFL01
     I                                        2   2 WWFL02
     I                                        3   3 WWFL03
     I                                        4   4 WWFL04
     I                                        5   5 WWFL05
     I                                        6   6 WWFL06
     I                                        7   7 WWFL07
     I                                        8   8 WWFL08
     I                                        9   9 WWFL09
     I                                       10  10 WWFL10
     I                                       11  11 WWFL11
     I                                       12  12 WWFL12
     I                                       13  13 WWFL13
     I                                       14  14 WWFL14
     I                                       15  15 WWFL15
     I                                       16  16 WWFL16
     I                                       17  17 WWFL17
     I                                       18  18 WWFL18
     I                                       19  19 WWFL19
     I                                       20  20 WWFL20
     I                                       21  21 WWFL21
     I                                       22  22 WWFL22
     I                                       23  23 WWFL23
     I                                       24  24 WWFL24
     I                                       25  25 WWFL25
     I                                       26  26 WWFL26
     I                                       27  27 WWFL27
     I                                       28  28 WWFL28
     I                                       29  29 WWFL29
     I                                       30  30 WWFL30
     I                                       31  31 WWFL31
     I                                       32  32 WWFL32
     I                                       33  33 WWFL33
     I                                       34  34 WWFL34
     I*
     I** DATA STRUCTURE FOR READING MATCHING RECORDS ON MGF580L0
     IWWDS1       DS
     I                                        1  11 WWKDS1
     I                                        1   2 WWMODI
     I**********                              3   80WWDEST                                    CSD027
     I                                        3   8 WWDEST                                    CSD027
     I                                        9  11 WWSNBR
     I*
     I** DATA STRUCTURE FOR READING MATCHING RECORDS ON MGF580L0
     IWWDS2       DS
     I                                        1  11 WWKDS2
     I                                        1   2 MGMODI
     I**********                              3   80MGDEST                                    CSD027
     I                                        3   8 MGDEST                                    CSD027
     I                                        9  11 MGSNBR
     I*
     I** DATA STRUCTURE FOR CRLF CONTROL CHARACTER
     ICRLFDS      DS                              2
     I                                        1   2 CTRC
     I                                        1   1 WWCR
     I                                        2   2 WWLF
     I*
     I** DATA STRUCTURE FOR DBERROR
     IDBERR       DS                             20
     I                                        1   2 @MODI
     I                                        3  17 @TRAN
     I*
     I** DATA STRUCTURE FOR DBERROR
     IDBERR1      DS                             26
     I                                        1   6 @SNDR
     I                                        7  18 @SCSD
     I                                       19  24 @DEST
     I                                       25  26 @SETP
     I*
     I** DATA STRUCTURE FOR DBERROR
     IDBERR2      DS                             20
     I                                        1   2 WWMODE
     I                                        3  17 @TREF
     I*
     I** DATA STRUCTURE TO SPLIT DATE
     I            DS
     I                                        1   6 ZSDATE
     I                                        1   2 WWYEAR
     I                                        3   4 WWMNTH
     I                                        5   6 WWDAY
     I*
     I** DATA STRUCTURE TO BUILD DATE
     I            DS
     I                                        1   8 WRDATE
     I                                        1   2 WRYEAR
     I I            '/'                       3   3 WRSL1
     I                                        4   5 WRMNTH
     I I            '/'                       6   6 WRSL2
     I                                        7   8 WRDAY
     I*
     I** DATA STRUCTURE TO BUILD PARAMETER FOR MG5900
     I            DS
     I                                        1  15 WWTREF
     I                                       13  13 WT1313
     I*
     I** DATA STRUCTURE TO SPLIT OMFLD
     I            DS
     I                                        1  50 OMFLD
     I                                        1   3 OM0103
     I                                        1   6 OM0106
     I                                        1  12 OM0112
     I                                        1  16 OM0116
     I                                        2   4 OM0204
     I                                        4  18 OM0418                071394
     I                                        4  19 OM0419
     I                                        8  16 OM0816
     I                                        7  35 OM0735
     I*
     I** DATA STRUCTURE TO BUILD TAG INPUT FIELD
     I            DS
     I                                        1   5 WWTAG
     I I            ':'                       1   1 WWTAG1
     I                                        2   3 WWTAGN
     I                                        4   4 WWTAGI
     I I            ':'                       5   5 WWTAG5
     I*
     I***DATA*STRUCTURE*FOR*OVERFLOW*ON*PRINTER*MG0580P1***               091250
     I** FILE INFORMATION DATA STRUCTURE FOR MG0580A1                     091250
     IOVRFL1      DS
     I                                    B 188 1890WWOFL1
     I                                    B 367 3680WWPTL1
     I*
     I***DATA*STRUCTURE*FOR*OVERFLOW*ON*PRINTER*MG0580P2***               091250
     I** FILE INFORMATION DATA STRUCTURE FOR MG0580A2                     091250
     IOVRFL2      DS
     I                                    B 188 1890WWOFL2
     I                                    B 367 3680WWPTL2
     I*
     I** DATA STRUCTURE FOR RECEIVER OF SECURITIES AC/LINE
     I            DS
     I                                        1  35 MGRSS1
     I                                        2   6 MGRS26
     I                                        2   7 MGRS27                064596
     I                                        5   9 MGRS59
     I*
     I** DATA STRUCTURE FOR DELIVERER OF SECURITIES AC/LINE
     I            DS
     I                                        1  35 MGDSS1
     I                                        2   6 MGDS26
     I                                        2   7 MGDS27                064596
     I                                        5   9 MGDS59
     I*                                                                   CEU005
     I* Data structure for 'IN' Ccy and amount on FLD72                   CEU005
     I            DS                                                      CEU005
     I                                        1  30 WOCMT                 CEU005
     I                                        1   6 OCMT                  CEU005
     I                                        7   9 OTRC                  CEU005
     I                                       10  30 OTRA                  CEU005
     I*
     ISCSARD    E DSSCSARDPD                                              CSW003
      ** External data structure for Switchable Features                  CSW003
      *                                                                   CSW003
     IDSFDY     E DSDSFDY                                                 CSW003
      ** First Data Structure for Access Objects                          CSW003
      *                                                                   CSW003
      * Data structures for access objects                                082282
     IDSSDY     E DSDSSDY                                                 082282
     ISDCUST    E DSSDCUSTPD                                              082282
      *                                                                   082282
     I*****************************************************************
     I/EJECT
     I*****************************************************************
      *                                                               *
      * 1. Multiple Data Structure MULT                               *
      *      The multiple occurrence data structure is used to        *
      *      store up the records that make up the SWIFT message      *
      *      before writing the whole message to file.                *
      *      To store the records of the message, you must            *
      *      first access an OCUR record, obtain the Message Tag      *
      *      & Message field data values for this OCUR record,        *
      *      then go on to the next OCUR record and continue          *
      *      this process until the SWIFT message is complete.        *
      *                                                               *
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C*   WWCASE, INSTRUCTIONS SENT TO CEDEL.                         *
     C*                                                               *
     C*    1 :   4F =  RECFREE, INTERNAL OR BRIDGE, SETTLEMENT        *
     C*    2 :   4T =  RECFREE, INTERNAL OR BRIDGE, MATCHING ONLY     *
     C*    3 :   6F =  RECFREE, EXTERNAL, BOOK ENTRY                  *
     C*    4 :   6F =  RECFREE, EXTERNAL, PHYSICAL                    *
     C*    5 :   41 =  RECAPMT, INTERNAL OR BRIDGE, SETTLEMENT        *
     C*    6 :   4T =  RECAPMT, INTERNAL OR BRIDGE, MATCHING ONLY     *
     C*    7 :   61 =  RECAPMT, EXTERNAL, BOOK ENTRY                  *
     C*    8 :   61 =  RECAPMT, EXTERNAL, PHYSICAL                    *
     C*    9 :                                                        *
     C*   10 :   31 =  DELFREE, INTERNAL OR BRIDGE, TRANSFER          *
     C*   11 :   5F =  DELFREE, INTERNAL OR BRIDGE, SETTLEMENT        *
     C*   12 :   5T =  DELFREE, INTERNAL OR BRIDGE, MATCHING ONLY     *
     C*   13 :   8D =  DELFREE, EXTERNAL, BOOK ENTRY                  *
     C*   14 :   81 =  DELFREE, EXTERNAL, PHYSICAL                    *
     C*   15 :   51 =  DELAPMT, INTERNAL OR BRIDGE, SETTLEMENT        *
     C*   16 :   5T =  DELAPMT, INTERNAL OR BRIDGE, MATCHING ONLY     *
     C*   17 :   8M =  DELAPMT, EXTERNAL, BOOK ENTRY                  *
     C*   18 :   8A =  DELAPMT, EXTERNAL, PHYSICAL                    *
     C*   19 :         (NOT USED)                                     *
     C*                                                               *
     C*   WWCASE, INSTRUCTIONS SENT TO EUROCLEAR.                     *
     C*                                                               *
     C*   20 :      =  RECFREE, INTERNAL OR BRIDGE, SETTLEMENT        *
     C*   21 :      =  RECFREE, INTERNAL OR BRIDGE, MATCHING ONLY     *
     C*   22 :      =  RECFREE, EXTERNAL, BOOK ENTRY                  *
     C*   23 :      =  RECFREE, EXTERNAL, PHYSICAL                    *
     C*   24 :      =  RECAPMT, INTERNAL OR BRIDGE, SETTLEMENT        *
     C*   25 :      =  RECAPMT, INTERNAL OR BRIDGE, MATCHING ONLY     *
     C*   26 :      =  RECAPMT, EXTERNAL, BOOK ENTRY                  *
     C*   27 :      =  RECAPMT, EXTERNAL, PHYSICAL                    *
     C*   28 :                                                        *
     C*   29 :      =  DELFREE, INTERNAL OR BRIDGE, TRANSFER          *
     C*   30 :      =  DELFREE, INTERNAL OR BRIDGE, SETTLEMENT        *
     C*   31 :      =  DELFREE, INTERNAL OR BRIDGE, MATCHING ONLY     *
     C*   32 :      =  DELFREE, EXTERNAL, BOOK ENTRY                  *
     C*   33 :      =  DELFREE, EXTERNAL, PHYSICAL                    *
     C*   34 :      =  DELAPMT, INTERNAL OR BRIDGE, SETTLEMENT        *
     C*   35 :      =  DELAPMT, INTERNAL OR BRIDGE, MATCHING ONLY     *
     C*   36 :      =  DELAPMT, EXTERNAL, BOOK ENTRY                  *
     C*   37 :      =  DELAPMT, EXTERNAL, PHYSICAL                    *
     C*   38 :         (NOT USED)                                     *
     C*                                                               *
     C*                                                               *
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C*   WWFLDS, FIELDS DEFINITION.                                  *
     C*                                                               *
     C*   WWFL01  =         (NOT USED)                                *
     C*   WWFL02  =         (NOT USED)                                *
     C*   WWFL03  =         (NOT USED)                                *
     C*   WWFL04  =    30   SETTLEMENT DATE                           *
     C*   WWFL05  =         (NOT USED)                                *
     C*   WWFL06  =    31P  DATE AND PLACE OF TRADE                   *
     C*   WWFL07  =    31T  TIME OF TRADE                             *
     C*   WWFL08  =    26J  REQUESTED PRIORITY                        *
     C*   WWFL09  =    35A  QUANTITY OF SECURITIES                    *
     C*   WWFL10  =    35B  IDENTIFICATION OF SECURITIES              *
     C*   WWFL11  =    35E  CERTIFICATE NUMBERS                       *
     C*   WWFL12  =    83R  SENDER'S ROLE                             *
     C*   WWFL13  =    83C  SAFEKEEPING ACCOUNT                       *
     C*   WWFL14  =    84A  CLEARING CORRESPONDENT                    *
     C*   WWFL15  =    87a  DELIVERER/RECEIVER OF SECURITIES          *
     C*   WWFL16  =    85a  DELIVERER'S INSTRUCTING PARTY             *
     C*   WWFL17  =    88a  BENEFICIARY OF SECURITIES                 *
     C*   WWFL18  =    57a  ACCOUNT WITH INSTITUTION                  *
     C*   WWFL19  =    58a  BENEFICIARY OF MONEY                      *
     C*   WWFL20  =    33T  DEAL PRICE                                *
     C*   WWFL21  =    32M  DEAL AMOUNT                               *
     C*   WWFL22  =    37J  DEAL AMOUNT EXCHANGE RATE                 *
     C*   WWFL23  =    34a  ACCRUED INTEREST                          *
     C*   WWFL24  =    37L  ACCRUED INTEREST EXCHANGE RATE            *
     C*   WWFL25  =    37S  ACCRUED INTEREST RATE AND BASIS           *
     C*   WWFL26  =    33S  SPECIAL CONCESSIONS                       *
     C*   WWFL27  =    37P  SPECIAL CONCESSIONS EXCHANGE RATE         *
     C*   WWFL28  =    32B  SETTLEMENT AMOUNT                         *
     C*   WWFL29  =    26L  FUNGIBILITY CODE                          *
     C*   WWFL20  =    26K  DENOMINATION CHOICE                       *
     C*   WWFL31  =    77B  FURTHER INFORMATION                       *
     C*   WWFL32  =    72   SENDER TO RECEIVER INFORMATION            *
     C*   WWFL33  =    79   NARRATIVE                                 *
     C*   WWFL34  =    77D  REGISTRATIONS DETAILS                     *
     C*                                                               *
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C*   MAIN PROCESSING - FORMAT MT580                              *
     C*                                                               *
     C*   CALLS THE FOLLOWING SUBROUTINES                             *
     C*                                                               *
     C*   INIT     - INITIALISATION                                   *
     C*   INTF     - INITIALISE NON-CONSTANT FIELDS                   *
     C*   ROUT     - DETERMINE MESSAGE ROUTING                        *
     C*   FLDR     - DETERMINE FIELD REQUIREMENTS                     *
     C*   NRSEQ    - FORMAT FIELDS FOR NON-REPETITIVE SEQUENCE        *
     C*   RSEQ     - FORMAT FIELDS FOR REPETITIVE SEQUENCE            *
     C*   UGGU     - UPDATE GENERATION GENERATED INDICATOR(@MODE ='U')*
     C*   UGGB     - UPDATE GENERATION GENERATED INDICATOR            *
     C*   FLD20N   - FORMAT FIELD :20: (NON-REPETITIVE SEQUENCE)      *
     C*   FLD23    - FORMAT MANDATORY FIELD :23:                      *
     C*   FLD30    - FORMAT FIELD :30:                                *
     C*   FLD20R   - FORMAT FIELD :20: (REPETITIVE SEQUENCE)          *
     C*   FLD31P   - FORMAT FIELD :31P:                               *
     C*   FLD31T   - FORMAT FIELD :31T:                               *
     C*   FLD26J   - FORMAT FIELD :26J:                               *
     C*   FLD35A   - FORMAT FIELD :35A:                               *
     C*   FLD35B   - FORMAT FIELD :35B:                               *
     C*   FLD35E   - FORMAT FIELD :35E:                               *
     C*   FLD83R   - FORMAT FIELD :83R:                               *
     C*   FLD83C   - FORMAT FIELD :83C:                               *
     C*   FLD84A   - FORMAT FIELD :84A:                               *
     C*   FLD87A   - FORMAT FIELD :87a:                               *
     C*   FLD85A   - FORMAT FIELD :85a:                               *
     C*   FLD88A   - FORMAT FIELD :88a:                               *
     C*   FLD57A   - FORMAT FIELD :57a:                               *
     C*   FLD58A   - FORMAT FIELD :58a:                               *
     C*   FLD33T   - FORMAT FIELD :33T:                               *
     C*   FLD32M   - FORMAT FIELD :32M:                               *
     C*   FLD37J   - FORMAT FIELD :37J:                               *
     C*   FLD34A   - FORMAT FIELD :34a:                               *
     C*   FLD37L   - FORMAT FIELD :37L:                               *
     C*   FLD37S   - FORMAT FIELD :37S:                               *
     C*   FLD33S   - FORMAT FIELD :33S:                               *
     C*   FLD37P   - FORMAT FIELD :37P:                               *
     C*   FLD32B   - FORMAT FIELD :32B:                               *
     C*   FLD26L   - FORMAT FIELD :26L:                               *
     C*   FLD26K   - FORMAT FIELD :26K:                               *
     C*   FLD77B   - FORMAT FIELD :77B:                               *
     C*   FLD77D   - FORMAT FIELD :77D:                               *
     C*   FLD72    - FORMAT FIELD :72:                                *
     C*   FLD79    - FORMAT FIELD :79:                                *
     C*   #ZA      - FORMAT ADDRESSES                                 *
     C*   #W01     - PRINT MESSAGE GENERATED DETAILS                  *
     C*   #W02     - PRINT MESSAGE NOT GENERATED DETAILS              *
     C*   #W03     - PRINT DATABASE ERROR REPORT                      *
     C*   #W05     - WRITE TO MGOREFPD                                *
     C*   *PSSR    - ERROR HANDLING                                   *
     C*   CEDELC   - CEDEL CANCELLATION PROCESSING                    *
     C*   CANCEL   - CEDEL CANCELLATION PROCESSING                    *
     C*   PARTPS   - CEDEL CANCELLATION PROCESSING - FIND PARTS       *
     C*   FORCAN   - CEDEL CANCELLATION PROCESSING - FORMAT           *
     C*   ZDATE1   - CONVERT DATE TO NUMBER OF DAYS                   *
     C*                                                               *
     C*****************************************************************
     C*
     C** INITIALISATION
     C                     EXSR INIT
     C*
     C** READ FIRST RECORD FROM LF/MGF580L0
     C                     READ MGF580L0                 10
     C*
     C** IF RECORDS PRESENT ON THE FILE, STORE KEY FIELDS
     C           *IN10     IFEQ '0'
     C*
     C                     MOVE MGMODI    WWMODI
     C                     MOVE MGDEST    WWDEST
     C                     MOVE MGSNBR    WWSNBR
     C*
     C** DO WHILE RECORDS ON MGF580L0
     C           *IN10     DOWEQ'0'
     C*
     C** CEDEL CANCELLATION PROCESSING
     C           MGFIN1    IFEQ '/CANCEL/'
     C                     MOVEL'Y'       CEDPRO  1
     C                     ELSE
     C                     MOVEL'N'       CEDPRO
     C                     END
     C*
     C** INITIALISE NON-CONSTANT FIELDS
     C                     EXSR INTF
     C*
     C** DETERMINE MESSAGE ROUTING
     C                     EXSR ROUT
     C*
     C** STORE FIELDS FROM MGF580L0 FOR REPORT HEADERS
     C                     MOVE MGSNBR    WWHDR1
     C                     MOVE MGDEST    WWHDR2
     C                     MOVE MGMODI    WWHDR3
     C*
     C** FORMAT FIELD :20: ( NON REPETITIVE SEQUENCE)
     C                     EXSR FLD20N
     C*
     C** FORMAT FIELDS FOR REPETITIVE SEQUENCE IF NOT CEDEL CANCELLATION
     C           CEDPRO    IFEQ 'N'
     C                     EXSR RSEQ
     C*
     C** PROCESS CEDEL CANCELLATION
     C                     ELSE
     C                     EXSR CEDELC
     C                     END
     C*
     C** IF ERROR FOUND ON MESSAGE THEN SET UP DATA STRUCTURE TO WRITE
     C** ONLY THIS PART OF MESSAGE TO MESSAGES NOT CORRECTLY GENERATED
     C** REPORT
     C           WWNGEN    IFEQ 'Y'
     C                     EXSR NGEN
     C                     ELSE
     C*
     C* NO ERROR FOUND, PERFORM UPDATES
     C                     MOVE 'Y'       WWVALP  1
     C*
     C** UPDATE SEQUENCE NUMBERS ON TRANSACTION RECORD
     C*
     C** IF SENT TO CEDEL, PASS THE CEDEL SEQUENCE NO
     C           MGDEST    IFEQ WWCEDN
     C           WWSENT    OREQ 'CEDEL'
     C                     Z-ADDWW80CE    @LSWS
     C                     MOVE 'L'       @MODE
     C                     ELSE
     C                     Z-ADD*ZEROS    @LSWS
     C                     MOVE 'U'       @MODE
     C                     END
     C*
     C** DO NOT UPDATE SEQUENCE NUMBER IF CANCELLATION CEDEL
     C           CEDPRO    IFEQ 'N'
     C*
     C** FORMAT @TRAN AS FOLLOWS
     C** CHARS 1-6 TO LEFTMOST 6 CHARS FROM MGTNUM
     C** CHARS 7-13 TO BLANKS
     C** CHARS 14-15 TO MGTTYP
     C                     MOVELMGTNUM    WWFSIX  6
     C                     MOVELWWFSIX    WWTRAN 15
     C                     MOVE MGTTYP    WWTRAN
     C                     CALL 'MG5900'               20
     C                     PARM MGMODI    @MODI   2
     C                     PARM WWTRAN    @TRAN  15
     C                     PARM 'PR'      @PROG   2
     C                     PARM           @MODE   1
     C                     PARM           @LSWS   70
     C                     PARM *BLANKS   @ERCD   1
     C                     PARM CSW003    @MT5XX  1                       CSW003
     C*
     C** IF PROGRAM MG5900 NOT FOUND
     C           *IN20     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '001'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 001  *
     C                     MOVEL'MG5900'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** IF ERROR DURING PROGRAM MG5900
     C           @ERCD     IFEQ 'Y'
     C           *LOCK     IN   LDA
     C                     MOVE '002'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 002  *
     C                     MOVELDBERR     DBKEY            * * * * * * * *
     C                     MOVEL'MG5900'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     END
     C*
     C** UPDATE GENERATION GENERATED INDICATOR WITH @MODE = 'U'
     C                     EXSR UGGU
     C*
     C                     END
     C*
     C** DELETE THE RECORD ON LF/MGF580L0 PROCESSED
     C                     DELETMGF580D0               11
     C*
     C** IF ERROR ON DELETE OF RECORD
     C           *IN11     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '003'     DBASE              * * * * * * *
     C                     MOVELMGTNUM    DBKEY              * DBERR 003 *
     C                     MOVEL'MGF580L0'DBFILE             * * * * * * *
     C                     MOVEL'MG0580'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** READ NEXT RECORD FROM LF/MGF580L0
     C                     READ MGF580L0                 10
     C*
     C** FORCE A 580 WITH CERTIFICATE NUMBERS TO BE GENERATED
     C** ALONE AND FOLLOWED BY THE RELEVANT 579
     C           MGCRTN    IFEQ 'Y'
     C                     MOVE 'Y'       WKCRTN  1
     C                     END
     C*
     C** INIT LENGTH OF RECORD
     C                     Z-ADD67        WWLENG  40
     C/COPY WNCPYSRC,MG0580C006
     C*
     C** DO WHILE THE KEY FIELDS ON THE RECORD READ MATCH THE
     C** STORED KEY FIELDS, BUT EXECUTE THE LOOP NO MORE THAN
     C** 9 TIMES
     C           WWKDS1    DOWEQWWKDS2                     REPETITIVE/DO
     C/COPY WNCPYSRC,MG0580C007
     C           WWTOT1    ANDLT5
     C/COPY WNCPYSRC,MG0580C008
     C           WWLENG    ANDLT2000
     C           WKCRTN    ANDNE'Y'
     C           *IN10     ANDEQ'0'
     C           CSW025    ANDNE'Y'                                                           CSW025
     C/COPY WNCPYSRC,MG0580C001
     C*
     C                     ADD  1         WWTOT1
     C*
     C** UPDATE SEQUENCE NUMBERS ON TRANSACTION RECORD
     C*
     C** IF SENT TO CEDEL, MODE IS 'L' INSTEAD OF ' '
     C           MGDEST    IFEQ WWCEDN
     C           WWSENT    OREQ 'CEDEL'
     C                     MOVE 'C'       @MODE
     C                     ELSE
     C                     MOVE ' '       @MODE
     C                     END
     C*
     C** CEDEL CANCELLATION PROCESSING
     C           MGFIN1    IFEQ '/CANCEL/'
     C                     MOVEL'Y'       CEDPRO
     C                     ELSE
     C                     MOVEL'N'       CEDPRO
     C                     END
     C*
     C** FORMAT @TRAN AS FOLLOWS
     C** CHARS 1-6 TO LEFTMOST 6 CHARS FROM MGTNUM
     C** CHARS 7-13 TO BLANKS
     C** CHARS 14-15 TO MGTTYP
     C                     MOVELMGTNUM    WWFSIX
     C                     MOVELWWFSIX    WWTRAN
     C                     MOVE MGTTYP    WWTRAN
     C                     CALL 'MG5900'               20
     C                     PARM MGMODI    @MODI
     C                     PARM WWTRAN    @TRAN
     C                     PARM 'PR'      @PROG
     C                     PARM           @MODE
     C                     PARM *ZEROS    @LSWS
     C                     PARM *BLANKS   @ERCD
     C                     PARM CSW003    @MT5XX                          CSW003
     C*
     C** IF PROGRAM MG5900 NOT FOUND
     C           *IN20     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '011'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 011  *
     C                     MOVEL'MG5900'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** IF ERROR DURING PROGRAM MG5900
     C           @ERCD     IFEQ 'Y'
     C           *LOCK     IN   LDA
     C                     MOVE '014'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 014  *
     C                     MOVELDBERR     DBKEY            * * * * * * * *
     C                     MOVEL'MG5900'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** UPDATE GENERATION GENERATED INDICATOR WITH @MODE = BLANKS
     C                     EXSR UGGB
     C*
     C** FORMAT FIELDS FOR REPETITIVE SEQUENCE IF NOT CEDEL CANCELLATION
     C           CEDPRO    IFEQ 'N'
     C                     EXSR RSEQ
     C*
     C** PROCESS CEDEL CANCELLATION
     C                     ELSE
     C                     EXSR CEDELC
     C                     END
     C*
     C** IF ERROR FOUND ON MESSAGE THEN SET UP DATA STRUCTURE TO WRITE
     C** ONLY THIS PART OF MESSAGE TO MESSAGES NOT CORRECTLY GENERATED
     C** REPORT
     C           WWNGEN    IFEQ 'Y'
     C                     EXSR NGEN
     C                     ELSE
     C*
     C** MAXIMUM LENGTH BY MESSAGE IS 2000 (SWIFT RESTRICTION)
     C***********WWLENG    IFLT 2000                                      090572
     C*
     C* NO ERROR FOUND, PERFORM UPDATES
     C                     MOVE 'Y'       WWVALP
     C*
     C** UPDATE SEQUENCE NUMBERS ON TRANSACTION RECORD
     C*
     C** IF SENT TO CEDEL, PASS THE CEDEL SEQUENCE NO
     C           MGDEST    IFEQ WWCEDN
     C           WWSENT    OREQ 'CEDEL'
     C                     Z-ADDWW80CE    @LSWS
     C                     MOVEL'L'       @MODE
     C                     ELSE
     C                     Z-ADD*ZEROS    @LSWS
     C                     MOVEL'U'       @MODE
     C                     END
     C*
     C** DO NOT UPDATE SEQUENCE NUMBER IF CANCELLATION CEDEL
     C           CEDPRO    IFEQ 'N'
     C*
     C** FORMAT @TRAN AS FOLLOWS
     C** CHARS 1-6 TO LEFTMOST 6 CHARS FROM MGTNUM
     C** CHARS 7-13 TO BLANKS
     C** CHARS 14-15 TO MGTTYP
     C                     MOVELMGTNUM    WWFSIX
     C                     MOVELWWFSIX    WWTRAN
     C                     MOVE MGTTYP    WWTRAN
     C                     CALL 'MG5900'               20
     C                     PARM MGMODI    @MODI
     C                     PARM WWTRAN    @TRAN
     C                     PARM 'PR'      @PROG
     C                     PARM           @MODE
     C                     PARM           @LSWS
     C                     PARM *BLANKS   @ERCD
     C                     PARM CSW003    @MT5XX                          CSW003
     C*
     C** IF PROGRAM MG5900 NOT FOUND
     C           *IN20     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '015'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 015  *
     C                     MOVEL'MG5900'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** IF ERROR DURING PROGRAM MG5900
     C           @ERCD     IFEQ 'Y'
     C           *LOCK     IN   LDA
     C                     MOVE '018'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 018  *
     C                     MOVELDBERR     DBKEY            * * * * * * * *
     C                     MOVEL'MG5900'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     END
     C*
     C** UPDATE GENERATION GENERATED INDICATOR WITH @MODE = 'U'
     C                     EXSR UGGU
     C*
     C***********          END                                            090572
     C*
     C                     END
     C*
     C** DELETE THE RECORD PROCESSED
     C***********WWLENG    IFLT 2000                                      090572
     C***********WWTOT1    ORLE 5                                         090572
     C/COPY WNCPYSRC,MG0580C009
     C           WWTOT1    IFLE 5                                         090572
     C/COPY WNCPYSRC,MG0580C010
     C*
     C                     DELETMGF580D0               11
     C*
     C** IF ERROR ON DELETE OF RECORD
     C           *IN11     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '020'     DBASE            * * * * * * * *
     C                     MOVELMGTNUM    DBKEY            *  DBERR 020  *
     C                     MOVEL'MGF580L0'DBFILE           * * * * * * * *
     C                     MOVEL'MG0580'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** READ NEXT RECORD FROM LF/MGF580L0
     C                     READ MGF580L0                 10
     C*
     C                     END
     C*
     C                     END                             REPETITIVE/END
     C*
     C** IF ERROR FOUND WHILE FORMATTING THIS MESSAGE
     C           @ERR      IFEQ 'Y'
     C*
     C** PRINT MESSAGE NOT GENERATED DETAILS AND RESET ERROR FLAG
     C                     EXSR #W02
     C                     MOVE *BLANKS   @ERR
     C                     END
     C*
     C** WRITE TO MIDAS SWIFT DATABASE FILES
     C           WWVALP    IFEQ 'Y'
     C                     EXSR OFLDS
     C*
     C** PRINT MESSAGE GENERATED DETAILS
     C                     EXSR #W01
     C                     MOVE 'Y'       WWPTR1  1
     C                     MOVE *BLANKS   WWVALP
     C                     END
     C*
     C** COMMIT ALL UPDATES TO FILE
     C                     COMIT
     C*
     C** GENERATE THE RELEVANT MT579 MESSAGE
     C           WKCRTN    IFEQ 'Y'
     C                     CALL 'MG0579'               61
     C           *IN61     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '079'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 079  *
     C                     MOVEL'MG0579'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     END
     C*
     C** RESET CERTIFICATE NUMBERS WORKFIELD
     C                     MOVE *BLANKS   WKCRTN
     C*
     C** RE-READ LAST RECORD ON LF/MGF580L0 TO LOCK THE RECORD
     C** FOR THE NEXT DELETE
     C           *LOVAL    SETLLMGF580L0
     C                     READ MGF580L0                 10
     C*
     C** STORE KEY FIELDS OF LAST RECORD READ
     C                     MOVE MGMODI    WWMODI
     C                     MOVE MGDEST    WWDEST
     C                     MOVE MGSNBR    WWSNBR
     C*
     C                     END
     C*
     C** WRITE TRAILER ON SWIFT MESSAGES GENERATED REPORT
     C** ONLY IF MESSAGES GENERATED
     C           WWPTR1    IFNE 'Y'
     C                     WRITEHEADER1
     C                     WRITENODETS
     C*
     C                     ELSE
     C*
     C** CHECK FOR OVERFLOW
     C           WWOFL1    SUB  WWPTL1    WWLINE  20
     C*
     C           WWLINE    IFLT 4
     C                     WRITEHEADER1
     C                     END
     C                     WRITEEOREPT1
     C                     END
     C*
     C** WRITE TRAILER ON SWIFT MESSAGES NOT GENERATED REPORT
     C** IF THE PRINTER FILE HAS BEEN OPENED
     C           *IN50     IFEQ '1'
     C*
     C** CHECK FOR OVERFLOW
     C           WWOFL2    SUB  WWPTL2    WWLINE
     C*
     C           WWLINE    IFLT 4
     C                     WRITEHEADER2
     C                     END
     C*
     C                     WRITEEOREPT2
     C                     END
     C*
     C                     ELSE
     C*
     C** WRITE NO DETAILS TO REPORT
     C                     WRITEHEADER1
     C                     WRITENODETS
     C                     END
     C/COPY WNCPYSRC,MG0580C003
     C*
     C                     SETON                     LR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  INIT      - INITIALISATION                                  *
     C**                                                              *
     C**  CALLS     - *PSSR                                           *
     C**                                                              *
     C**  CALLED BY - MAIN PROCESS                                    *
     C**                                                              *
     C*****************************************************************
     C*
     C           INIT      BEGSR
     C*
     C                     MOVEACPY@      BIS@   80
     C*
     C** DEFINE WORK FIELDS
     C           *LIKE     DEFN A6NBDP    WWCDPN
     C           *LIKE     DEFN MGDEST    WWHDR2
     C           *LIKE     DEFN MGSNBR    WWHDR1
     C           *LIKE     DEFN MGMODI    WWHDR3
     C           *LIKE     DEFN BBCSSN    WWEURC
     C           *LIKE     DEFN BBCSSN    WWCEDL
     C           *LIKE     DEFN MGRSS1    WWRSS1
     C           *LIKE     DEFN BVDR1     WWCNUM
     C           *LIKE     DEFN MGTNUM    WWTNUM
     C           *LIKE     DEFN MGTTYP    WWTTYP
     C           *LIKE     DEFN MGTSTP    WWTSTP
     C           *LIKE     DEFN MGBSSN    WWBSSN
     C           *LIKE     DEFN MGSTCY    WWSTCY
     C*
     C                     Z-ADD0         WWCASE  20
     C*
     C** SET UP LDA
     C           *NAMVAR   DEFN           LDA
     C*
     C** ACCESS SDBANKPD FOR BANK DETAILS
     C           1         SETLLSDBANKPD
     C                     READ SDBANKPD                 12
     C*
     C** IF RECORD NOT FOUND OR LAST CHANGE TYPE = 'D'
     C           *IN12     IFEQ '1'
     C           BJTYLC    OREQ 'D'
     C           *LOCK     IN   LDA
     C                     MOVE '004'     DBASE            * * * * * * * *
     C                     MOVEL*BLANKS   DBKEY            *  DBERR 004  *
     C                     MOVEL'SDBANKPD'DBFILE           * * * * * * * *
     C                     MOVEL'MG0580'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C           BJDFIN    IFEQ 'D'
     C                     MOVE '0'       *IN98
     C                     ELSE
     C                     MOVE '1'       *IN98
     C                     END
     C*
     C** ACCESS SDSTRDPD FOR SE ICD DETAILS
     C           1         SETLLSDSTRDPD
     C                     READ SDSTRDPD                 15
     C*
     C** IF RECORD NOT FOUND OR LAST CHANGE TYPE = 'D'
     C           *IN15     IFEQ '1'
     C           BVTYLC    OREQ 'D'
     C           *LOCK     IN   LDA
     C                     MOVE '030'     DBASE            * * * * * * * *
     C                     MOVEL*BLANKS   DBKEY            *  DBERR 030  *
     C                     MOVEL'SDSTRDPD'DBFILE           * * * * * * * *
     C                     MOVEL'MG0580'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** ACCESS SDCUSTL1 FOR EUROCLEAR SHORTNAME
     C           BVDR1     CHAINSDCUSTL1             16
     C*
     C** IF RECORD NOT FOUND OR LAST CHANGE TYPE = 'D'
     C           *IN16     IFEQ '1'
     C           BBTYLC    OREQ 'D'
     C           *LOCK     IN   LDA
     C                     MOVE '032'     DBASE            * * * * * * * *
     C                     MOVELBVDR1     DBKEY            *  DBERR 032  *
     C                     MOVEL'SDCUSTL1'DBFILE           * * * * * * * *
     C                     MOVEL'MG0580'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C*
     C                     ELSE
     C*
     C** RECORD IS FOUND, STORE SHORTNAME (EUROCLEAR SHORTNAME)
     C                     MOVE BBCSSN    WWEURC
     C                     END
     C*
     C** ACCESS SDCUSTL1 FOR CEDEL SHORTNAME
     C           BVDR2     CHAINSDCUSTL1             16
     C*
     C** IF RECORD NOT FOUND OR LAST CHANGE TYPE = 'D'
     C           *IN16     IFEQ '1'
     C           BBTYLC    OREQ 'D'
     C           *LOCK     IN   LDA
     C                     MOVE '031'     DBASE            * * * * * * * *
     C                     MOVELBVDR2     DBKEY            *  DBERR 031  *
     C                     MOVEL'SDCUSTL1'DBFILE           * * * * * * * *
     C                     MOVEL'MG0580'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C*
     C                     ELSE
     C*
     C** RECORD IS FOUND, STORE SHORTNAME (CEDEL SHORTNAME)
     C** AND CEDEL CUSTOMER NO
     C                     MOVE BBCSSN    WWCEDL
     C**********           MOVELBVDR2     WWCEDN  60                                          CSD027
     C                     MOVELBVDR2     WWCEDN  6                                           CSD027
     C                     END
     C*
     C** ACCESS SDMGMEPD FOR MESSAGE GENERATION & MESSAGE MANAGEMENT
     C           1         SETLLSDMGMEPD
     C                     READ SDMGMEPD                 18
     C*
     C** IF RECORD NOT FOUND OR LAST CHANGE TYPE = 'D'
     C           *IN18     IFEQ '1'
     C           ENTYLC    OREQ 'D'
     C           *LOCK     IN   LDA
     C                     MOVE '034'     DBASE            * * * * * * * *
     C                     MOVEL*BLANKS   DBKEY            *  DBERR 034  *
     C                     MOVEL'SDMGMEPD'DBFILE           * * * * * * * *
     C                     MOVEL'MG0580'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** FULL IN THE ARRAY FOR FIELDS REQUIREMENTS
     C                     Z-ADD0         I       30
     C           1         SETLLMGE580PD
     C                     READ MGE580PD                 60
     C           *IN60     DOWEQ'0'
     C                     ADD  1         I
     C                     MOVELMGMATX    ARR1,I
     C                     READ MGE580PD                 60
     C                     END
     C*
     C** STORE HEX DETAILS OF CRLF CONTROL CHARACTER
     C                     MOVE *LOVAL    CTRC
     C                     BITON'457'     WWCR
     C                     BITON'257'     WWLF
     C*
      ** Check if (CSW003) MT5XX - Phase 2 Message Generation is on.      CSW003
      *                                                                   CSW003
     C                     CALL 'AOSARDR0'                                CSW003
     C                     PARM '*BLANKS' WRTCD   7                       CSW003
     C                     PARM '*VERIFY' WOPTN   7                       CSW003
     C                     PARM 'CSW003'  @SARD   6                       CSW003
     C           SCSARD    PARM SCSARD    DSFDY                           CSW003
      *                                                                   CSW003
     C           WRTCD     IFEQ *BLANKS                                   CSW003
     C                     MOVE 'Y'       CSW003  1                       CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C**  Access SAR details file to see if CEU005 SAR is installed.      CEU005
     C*                                                                   CEU005
     C                     CALL 'AOSARDR0'                                CEU005
     C                     PARM *BLANKS   WRTCD                           CEU005
     C                     PARM '*VERIFY' WOPTN                           CEU005
     C                     PARM 'CEU005'  @SARD                           CEU005
     C*                                                                   CEU005
     C           @RTCD     IFEQ *BLANK                                    CEU005
     C                     MOVE 'Y'       CEU005  1                       CEU005
     C                     ELSE                                           CEU005
     C                     MOVE 'N'       CEU005                          CEU005
     C                     ENDIF                                          CEU005
     C/COPY WNCPYSRC,MG0580C002
     C*                                                                   CEU005
      ** Call SWIF2001 to check if CSW201 is switched on.                                     CSW201
      *                                                                                       CSW201
     C                     CALL 'SWIF2001'             9090                                   CSW201
     C                     PARM *BLANKS   PRTCD   7                                           CSW201
      *                                                                                       CSW201
      ** If return with an error (LR seton in called program) then                            CSW201
      ** process for database error.                                                          CSW201
      *                                                                                       CSW201
     C           *IN90     IFEQ *ON                                                           CSW201
     C           *LOCK     IN   LDA                                                           CSW201
     C                     Z-ADD047       DBASE                                               CSW201
     C                     MOVEL'SWIF2001'DBFILE                                              CSW201
     C                     MOVE '*CALL   'DBKEY                                               CSW201
     C                     OUT  LDA                                                           CSW201
     C                     EXSR *PSSR                                                         CSW201
     C                     ELSE                                                               CSW201
      *                                                                                       CSW201
     C           PRTCD     IFEQ 'CSW2001'                                                     CSW201
     C                     MOVE 'Y'       CSW201  1                                           CSW201
     C                     ELSE                                                               CSW201
     C                     MOVE 'N'       CSW201                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
      ** Is CSW025 installed?                                                                 CSW025
      *                                                                                       CSW025
     C                     CALL 'AOSARDR0'                                                    CSW025
     C                     PARM '       ' @RTCD                                               CSW025
     C                     PARM '*VERIFY' @OPTN                                               CSW025
     C                     PARM 'CSW025'  @SARD                                               CSW025
     C           @RTCD     IFNE *BLANK                                                        CSW025
     C           @RTCD     ANDNE'*NRF   '                                                     CSW025
     C                     MOVEL'SCSARDPD'DBFILE                                              CSW025
     C                     MOVEL'048'     DBASE                                               CSW025
     C                     MOVEL@RTCD     DBKEY                                               CSW025
     C                     MOVE *ON       *INU7                                               CSW025
     C                     MOVE *ON       *INU8                                               CSW025
     C                     EXSR *PSSR                                                         CSW025
     C                     ENDIF                                                              CSW025
     C           @RTCD     IFEQ *BLANK                                                        CSW025
     C                     MOVE 'Y'       CSW025  1                                           CSW025
     C                     ENDIF                                                              CSW025
      *                                                                                       CSW025
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  INTF      - INITIALISE NON-CONSTANT FIELDS                  *
     C**                                                              *
     C**  CALLS     - MG5900, *PSSR                                   *
     C**                                                              *
     C**  CALLED BY - MAIN PROCESS                                    *
     C**                                                              *
     C*****************************************************************
     C*
     C           INTF      BEGSR
     C*                                                                   089450
     C** CHECK IF DESTINATION IS EOC OR CEDEL                             089450
     C                     MOVE MGDEST    ZZCNUM                          089450
     C           ZZCNUM    CHAINSDSECSL1             13                   089450
     C           *IN13     IFEQ '1'                                       089450
     C           *LOCK     IN   LDA                                       089450
     C                     MOVE '068'     DBASE            * * * * * * * *089450
     C                     MOVELZZCNUM    DBKEY            *  DBERR 068  *089450
     C                     MOVEL'SDSECSL1'DBFILE           * * * * * * * *089450
     C                     MOVEL'MG0580'  DBPGM                           089450
     C                     OUT  LDA                                       089450
     C                     EXSR *PSSR                                     089450
     C                     END                                            089450
     C*                                                                   089450
     C                     MOVE *BLANKS   WWSENT                          089450
     C           BFCLAS    IFEQ 'E'                                       089450
     C                     MOVE 'EOC  '   WWSENT                          089450
     C                     END                                            089450
     C           BFCLAS    IFEQ 'C'                                       089450
     C                     MOVE 'CEDEL'   WWSENT                          089450
     C                     END                                            089450
     C*
     C** OBTAIN SEQUENCE NUMBERS FROM TRANSACTION RECORD
     C** IF SENT TO CEDEL, MODE IS 'L' INSTEAD OF ' '
     C           MGDEST    IFEQ WWCEDN
     C           WWSENT    OREQ 'CEDEL'
     C                     MOVE 'C'       @MODE
     C                     ELSE
     C                     MOVE ' '       @MODE
     C                     END
     C*
     C** FORMAT @TRAN AS FOLLOWS
     C** CHARS 1-6 EQUAL TO LEFTMOST 6 CHARS FROM MGTNUM
     C** CHARS 7-13 EQUAL TO BLANKS
     C** CHARS 14-15 EQUAL TO MGTTYP
     C                     MOVELMGTNUM    WWFSIX
     C                     MOVELWWFSIX    WWTRAN
     C                     MOVE MGTTYP    WWTRAN
     C*
     C                     CALL 'MG5900'               20
     C                     PARM MGMODI    @MODI
     C                     PARM WWTRAN    @TRAN
     C                     PARM 'PR'      @PROG
     C                     PARM           @MODE
     C                     PARM *ZEROS    @LSWS
     C                     PARM *BLANKS   @ERCD
     C                     PARM CSW003    @MT5XX                          CSW003
     C*
     C** IF PROGRAM NOT FOUND
     C           *IN20     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '005'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 005  *
     C                     MOVEL'MG5900'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** IF ERROR DURING PROGRAM MG5900
     C           @ERCD     IFEQ 'Y'
     C           *LOCK     IN   LDA
     C                     MOVE '006'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 006  *
     C                     MOVELDBERR     DBKEY            * * * * * * * *
     C                     MOVEL'MG5900'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** UPDATE GENERATION GENERATED INDICATOR WITH @MODE = BLANKS
     C                     EXSR UGGB
     C*
     C** CLEAR MULTIPLE OCCURENCE DATA STRUCTURE, MULT
     C                     Z-ADD1         X       30
     C           X         OCUR MULT
     C*
     C           X         DOWLT500
     C                     MOVE *BLANKS   MULT
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C                     MOVE *BLANKS   MULT
     C*
     C** SET INDEX TO FIRST OCCURENCE
     C                     Z-ADD1         X
     C           X         OCUR MULT
     C*
     C** CLEAR MULTIPLE OCCURENCE DATA STRUCTURE, WMULT
     C                     Z-ADD1         WWZ     30
     C           WWZ       OCUR WMULT
     C*
     C           WWZ       DOWLE500
     C           WMULT     ANDNE*BLANKS
     C                     MOVE *BLANKS   WMULT
     C                     ADD  1         WWZ
     C           WWZ       OCUR WMULT
     C                     END
     C*
     C** SET INDEX TO FIRST OCCURENCE
     C                     Z-ADD1         WWZ
     C           WWZ       OCUR WMULT
     C*
     C** CLEAR MULTIPLE OCCURENCE DS OF RECORDS TO PF/MGOREFPD
     C                     Z-ADD1         WWTOT1  20
     C           WWTOT1    OCUR REFDS
     C/COPY WNCPYSRC,MG0580C011
     C*
     C           WWTOT1    DOWLT5
     C/COPY WNCPYSRC,MG0580C012
     C***********WWLENG    ANDLT2000                                      069020
     C***********REFDS     ANDNE*BLANKS                                   069020
     C                     MOVE *BLANKS   REFDS
     C                     ADD  1         WWTOT1
     C           WWTOT1    OCUR REFDS
     C                     END
     C*
     C** SET INDEX TO FIRST OCCURENCE
     C                     Z-ADD1         WWTOT1
     C           WWTOT1    OCUR REFDS
     C*
     C** CLEAR MULTIPLE OCCURENCE DS OF RECORDS TO PF/MGOMSGPD
     C                     Z-ADD1         WWTOT1
     C           WWTOT1    OCUR TRANS
     C*
     C/COPY WNCPYSRC,MG0580C013
     C           WWTOT1    DOWLT6
     C/COPY WNCPYSRC,MG0580C014
     C***********WWLENG    ANDLT2000                                      069020
     C***********TRANS     ANDNE*BLANKS                                   069020
     C                     MOVE *BLANKS   TRANS
     C                     ADD  1         WWTOT1
     C           WWTOT1    OCUR TRANS
     C                     END
      *                                                                   183583
      ** Clear multiple occurrence DS for the extension file.             183583
      *                                                                   183583
     C                     Z-ADD1         V       20                      183583
     C           V         DOWLE95                                        183583
     C           MCSI      ANDNE*BLANKS                                   183583
     C           V         OCUR EXTN                                      183583
     C                     Z-ADD*ZEROS    MPSN                            183583
     C                     MOVE *BLANKS   MTG                             183583
     C                     MOVE *BLANKS   MCSI                            183583
     C                     ADD  1         V                               183583
     C                     ENDDO                                          183583
     C                     Z-ADD0         V                               183583
     C*
     C** SET INDEX TO FIRST OCCURENCE
     C                     Z-ADD1         WWTOT1
     C           WWTOT1    OCUR TRANS
     C*
     C** SET FLAG FOR MESSAGE CORRECTLY GENERATED
     C                     MOVE *BLANKS   @ERR    1
     C                     MOVE *BLANKS   WWNGEN  1
     C                     MOVE *BLANKS   DSERR
     C                     MOVE *BLANKS   NWERR  50
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  ROUT      - DETERMINE MESSAGE ROUTING                       *
     C**                                                              *
     C**  CALLS     - *PSSR, ZM1100                                   *
     C**                                                              *
     C**  CALLED BY - MAIN PROCESS                                    *
     C**                                                              *
     C*****************************************************************
     C*
     C           ROUT      BEGSR
     C*
     C** ACCESS SDBRCHL1 USING KEY OF MGSNBR FROM PF/MGF554L0
     C           MGSNBR    CHAINSDBRCHL1             13
     C*
     C** IF RECORD NOT FOUND OR LAST CHANGE TYPE = 'D'
     C           *IN13     IFEQ '1'
     C           A8BRCD    OREQ 'D'
     C           *LOCK     IN   LDA
     C                     MOVE '007'     DBASE            * * * * * * * *
     C                     MOVELMGSNBR    DBKEY            *  DBERR 007  *
     C                     MOVEL'SDBRCHL1'DBFILE           * * * * * * * *
     C                     MOVEL'MG0580'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** DETERMINE NETWORK ROUTING AND ADDRESSES
     C                     MOVE A8BICN    @SNDR   6
     C                     MOVE A8BTID    @SCSD  12
     C                     MOVE MGDEST    @DEST   6
     C                     MOVELMGSETP    @SETP   2
     C                     MOVE *BLANKS   @NWSN  20
     C                     MOVE *BLANKS   @NWDS  22
     C                     MOVE *BLANKS   @NWRK   6
     C                     MOVE *BLANKS   @ERRC   1
     C                     MOVE *BLANKS   @SRNM  20
     C                     MOVE *BLANKS   @SRTN  10
     C                     MOVE *BLANKS   @DRNM  20
     C                     MOVE *BLANKS   @DRTN  10
     C*
     C                     CALL 'ZM1100'               21
     C                     PARM           @SNDR
     C                     PARM           @SCSD
     C                     PARM           @DEST
     C                     PARM           @SETP
     C                     PARM           @NWSN
     C                     PARM           @NWDS
     C                     PARM           @NWRK
     C                     PARM           @ERRC
     C                     PARM           @SRNM
     C                     PARM           @SRTN
     C                     PARM           @DRNM
     C                     PARM           @DRTN
     C*
     C** IF PROGRAM ZM1100 NOT FOUND
     C           *IN21     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '008'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 008  *
     C                     MOVEL'ZM1100'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** IF ERROR DURING CALLED PROGRAM
     C           @ERRC     IFEQ 'S'
     C           *LOCK     IN   LDA
     C                     MOVE '009'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 009  *
     C                     MOVELDBERR1    DBKEY            * * * * * * * *
     C                     MOVEL'ZM1100'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** FORMAT DESTINATION ERROR MESSAGE
     C           @ERRC     IFEQ 'D'
     C                     MOVE *BLANKS   DSERR  50
     C                     MOVELERRA,1    DSERR
     C                     MOVE 'Y'       @ERR
     C                     END
     C*
     C** MOVE DESTINATION CUSTOMER NO. MGDEST INTO CHARACTER
     C** FIELD FOR COMPARISON WITH BVDR1  AND BVDR2 - SDSECSL1
     C                     MOVE MGDEST    WWCNUM
     C*
     C** CHECK IF DESTINATION IS NOT EOC OR CEDEL ANYWAY
     C                     MOVE MGDEST    ZZCNUM  6
     C           ZZCNUM    CHAINSDSECSL1             13
     C           *IN13     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '068'     DBASE            * * * * * * * *
     C                     MOVELZZCNUM    DBKEY            *  DBERR 068  *
     C                     MOVEL'SDSECSL1'DBFILE           * * * * * * * *
     C                     MOVEL'MG0580'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C                     MOVE *BLANKS   WWSENT  5
     C           BFCLAS    IFEQ 'E'
     C                     MOVE 'EOC  '   WWSENT
     C                     END
     C           BFCLAS    IFEQ 'C'
     C                     MOVE 'CEDEL'   WWSENT
     C                     END
     C*
     C** IF DESTINATION CUSTOMER NO. IS NOT EOC OR CEDEL CUSTOMER NO.
     C           WWCNUM    IFNE BVDR1
     C           WWCNUM    ANDNEBVDR2
     C           WWSENT    ANDNE'EOC  '
     C           WWSENT    ANDNE'CEDEL'
     C                     MOVE ERRA,47   DSERR
     C                     MOVE 'Y'       @ERR
     C                     END
     C*
     C** FORMAT NETWORK ERROR MESSAGE
     C           @NWRK     IFEQ 'UNROUT'
     C                     MOVELERRA,48   NWERR
     C                     MOVE 'Y'       @ERR
     C                     END
     C*
     C** IF ERROR DETERMINING MESSAGE ROUTING, SET FLAG TO
     C** OUTPUT THIS PART OF MESSAGE TO MG0580P2
     C           @ERR      IFEQ 'Y'
     C                     MOVE 'Y'       WWERR1
     C                     MOVE 'Y'       WWNGEN
     C                     END
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  FLDR      - DETERMINE FIELD REQUIREMENTS                    *
     C**                                                              *
     C**  CALLS     -                                                 *
     C**                                                              *
     C**  CALLED BY - MAIN PROCESSING                                 *
     C**                                                              *
     C*****************************************************************
     C*
     C           FLDR      BEGSR
     C*
     C** INITIALIZE VALID FLAG  AND ERROR FLAG
     C                     MOVE 'N'       WWVALD  1
     C                     MOVE *BLANKS   WWER84  1
     C                     MOVE *BLANKS   WWCOMB  1
     C                     MOVE *BLANKS   WWCASR  1
     C*
     C** ERROR IF CUSTOMER NUMBER IS CEDEL
     C** AND CLEARING CUSTOMER IS BLANK
     C           WWCNUM    IFEQ BVDR2
     C           MGCCTN    ANDEQ*BLANKS
     C           WWSENT    OREQ 'CEDEL'                                   CSW003
     C           MGCCTN    ANDEQ*BLANKS                                   CSW003
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWER84
     C                     MOVE 'Y'       WWNGEN
     C                     GOTO ENDFLD
     C                     END
     C*
     C** RECEIVE FREE OF PAYMENT
     C           MGF231    IFEQ 'RECFREE'
     C*
     C** VALIDATIONS
     C           MGINSS    IFEQ 'TRANS'
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C                     MOVEL'Y'       WWCOMB
     C                     GOTO ENDFLD
     C                     END
     C*
     C** PREVIOUS PROCESSING TO DETECT THE CASE REPLACED BY THE FOLLOWING
     C*
     C** INSTRUCTIONS SUB-TYPE
     C           MGINSS    IFEQ 'SETTL'
     C                     Z-ADD1         WWCASE
     C                     ELSE
     C           MGINSS    IFEQ 'MATCH'
     C                     Z-ADD2         WWCASE
     C                     ELSE
     C           MGINSS    IFEQ 'BOOK '
     C                     Z-ADD3         WWCASE
     C                     ELSE
     C           MGINSS    IFEQ 'PHYSI'
     C                     Z-ADD4         WWCASE
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C*
     C*
     C** RECEIVE AGAINST PAYMENT
     C           MGF231    IFEQ 'RECAPMT'
     C*
     C** VALIDATIONS
     C           MGINSS    IFEQ 'TRANS'
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C                     MOVEL'Y'       WWCOMB
     C                     GOTO ENDFLD
     C                     END
     C*
     C** INSTRUCTIONS SUB-TYPE
     C           MGINSS    IFEQ 'SETTL'
     C                     Z-ADD5         WWCASE
     C                     ELSE
     C           MGINSS    IFEQ 'MATCH'
     C                     Z-ADD6         WWCASE
     C                     ELSE
     C           MGINSS    IFEQ 'BOOK '
     C                     Z-ADD7         WWCASE
     C                     ELSE
     C           MGINSS    IFEQ 'PHYSI'
     C                     Z-ADD8         WWCASE
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C*
     C*
     C** DELIVER FREE OF PAYMENT
     C           MGF231    IFEQ 'DELFREE'
     C*
     C** INSTRUCTIONS SUB-TYPE
     C           MGINSS    IFEQ 'TRANS'
     C                     Z-ADD10        WWCASE
     C                     ELSE
     C           MGINSS    IFEQ 'SETTL'
     C                     Z-ADD11        WWCASE
     C                     ELSE
     C           MGINSS    IFEQ 'MATCH'
     C                     Z-ADD12        WWCASE
     C                     ELSE
     C           MGINSS    IFEQ 'BOOK '
     C                     Z-ADD13        WWCASE
     C                     ELSE
     C           MGINSS    IFEQ 'PHYSI'
     C                     Z-ADD14        WWCASE
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C*
     C*
     C** DELIVER AGAINST PAYMENT
     C           MGF231    IFEQ 'DELAPMT'
     C*
     C** VALIDATIONS
     C           MGINSS    IFEQ 'TRANS'
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C                     MOVEL'Y'       WWCOMB
     C                     GOTO ENDFLD
     C                     END
     C*
     C** INSTRUCTIONS SUB-TYPE
     C           MGINSS    IFEQ 'SETTL'
     C                     Z-ADD15        WWCASE
     C                     ELSE
     C           MGINSS    IFEQ 'MATCH'
     C                     Z-ADD16        WWCASE
     C                     ELSE
     C           MGINSS    IFEQ 'BOOK '
     C                     Z-ADD17        WWCASE
     C                     ELSE
     C           MGINSS    IFEQ 'PHYSI'
     C                     Z-ADD18        WWCASE
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C*
     C*
     C** DESTINATION CUSTOMER IS EUROCLEAR CUSTOMER NO.
     C           WWCNUM    IFEQ BVDR1
     C           WWSENT    OREQ 'EOC  '                                   CSW003
     C                     ADD  19        WWCASE
     C                     END
     C*
     C*
     C** IF VALID THEN SELECT THE ELEMENT OF THE ARRAY CORRESPONDING TO
     C** THE CASE NUMBER SET UP AND MOVE THIS ARRAY FIELD INTO THE
     C** RELEVENT DATA STRUCTURE
     C           WWCASE    IFGT 0
     C                     MOVE 'Y'       WWVALD
     C                     MOVE WWCASE    J       20
     C                     MOVE ARR1,J    WWFLDS
     C                     ELSE
     C*
     C** SET FLAG - FIELD REQUIREMENTS CANNOT BE DETERMINED
     C                     MOVE 'Y'       WWERR1  1
     C                     MOVE 'Y'       WWNGEN
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWCASR
     C                     MOVE 'O'       WWFL14
     C                     END
     C*
     C           ENDFLD    ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  UGGU      - UPDATE GENERATION GENERATED INDICATOR           *
     C**                                                              *
     C**  CALLS     - MG5910                                          *
     C**                                                              *
     C**  CALLED BY - MAIN PROCESSING, INTF                           *
     C**                                                              *
     C*****************************************************************
     C*
     C           UGGU      BEGSR
     C*
     C** FORMAT @TREF AS FOLLOWS
     C** CHARS 7-13 TO BLANKS
     C** CHARS 14-15 TO MGTTYP
     C                     MOVE *BLANKS   WWTREF
     C                     MOVELMGTNUM    WWFL6   6
     C                     MOVELWWFL6     WWTREF
     C                     MOVE MGTTYP    WWTREF
     C*
     C** IF MGTTYP EQUALS 'DM' AND MGTSTP IS ONE OF THE FOLLOWING
     C           MGTTYP    IFEQ 'DM'
     C           CSW003    ANDNE'Y'                                       CSW003
     C*
     C           MGTSTP    IFEQ 'RR'
     C           MGTSTP    OREQ 'RP'
     C           MGTSTP    OREQ 'BB'
     C           MGTSTP    OREQ 'BL'
     C           MGTSTP    OREQ 'PL'
     C           MGTSTP    OREQ 'PD'
     C           MGTSTP    OREQ 'DT'                                      185241
     C*
     C** MOVE 'A' TO POSITION 13 OF PARAMETER
     C** REM : SEE ALSO MG5910 AND SE1873                                 CSW003
     C                     MOVEL'A'       WT1313
     C                     END
     C*
     C                     END
     C*
     C** CANCELLATION CEDEL
     C           CEDPRO    IFEQ 'N'
     C                     MOVEL'U'       @MODE
     C                     ELSE
     C                     MOVEL'C'       @MODE
     C                     END
     C*
     C                     CALL 'MG5910'               27
     C                     PARM MGMODI    @MODI   2
     C                     PARM WWTREF    @TREF  15
     C                     PARM 'PR'      @PROG   2
     C                     PARM           @MODE   1
     C                     PARM *BLANKS   @CONG   1
     C                     PARM *BLANKS   @RCDG   1
     C                     PARM *BLANKS   @ERCD   1
     C                     PARM CSW003    @MT5XX                          CSW003
     C*                                                                   CSW003
     C                     MOVEL@MODI     WWMODE
     C*
     C** IF PROGRAM NOT FOUND
     C           *IN27     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '039'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 039  *
     C                     MOVEL'MG5910'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** IF ERROR DURING PROGRAM
     C           @ERCD     IFEQ 'Y'
     C           MGTSTP    ANDNE'DT'                                      185241
     C           MGTSTP    ANDNE'RP'                                      185241
     C           MGTSTP    ANDNE'RR'                                      185241
     C           MGTSTP    ANDNE'BL'                                      185241
     C           MGTSTP    ANDNE'BB'                                      185241
     C           MGTSTP    ANDNE'PL'                                      185241
     C           MGTSTP    ANDNE'PD'                                      185241
     C           *LOCK     IN   LDA
     C                     MOVE '040'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 040  *
     C                     MOVELDBERR2    DBKEY            * * * * * * * *
     C                     MOVEL'MG5910'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** IF @RCDG EQUALS 'Y'  AND MESSAGE NOT CANCELLATION CEDEL
     C** OR IF @RCDG EQUALS 'N' AND MESSAGE IS CANCELLATION CEDEL
     C           @RCDG     IFEQ 'Y'
     C           CEDPRO    ANDEQ'N'
     C           MGTSTP    ANDNE'DT'                                      185241
     C           MGTSTP    ANDNE'RP'                                      185241
     C           MGTSTP    ANDNE'RR'                                      185241
     C           MGTSTP    ANDNE'BL'                                      185241
     C           MGTSTP    ANDNE'BB'                                      185241
     C           MGTSTP    ANDNE'PL'                                      185241
     C           MGTSTP    ANDNE'PD'                                      185241
     C           @RCDG     OREQ 'N'
     C           CEDPRO    ANDEQ'Y'
     C           MGTSTP    ANDNE'DT'                                      185241
     C           MGTSTP    ANDNE'RP'                                      185241
     C           MGTSTP    ANDNE'RR'                                      185241
     C           MGTSTP    ANDNE'BL'                                      185241
     C           MGTSTP    ANDNE'BB'                                      185241
     C           MGTSTP    ANDNE'PL'                                      185241
     C           MGTSTP    ANDNE'PD'                                      185241
     C           *LOCK     IN   LDA
     C                     MOVE '041'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 041  *
     C                     MOVELDBERR2    DBKEY            * * * * * * * *
     C                     MOVEL'MG5910'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  UGGB      - UPDATE GENERATION GENERATED INDICATOR           *
     C**                                                              *
     C**  CALLS     - MG5910                                          *
     C**                                                              *
     C**  CALLED BY - INTF                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           UGGB      BEGSR
     C*
     C** FORMAT @TREF AS FOLLOWS
     C** CHARS 7-13 TO BLANKS
     C** CHARS 14-15 TO MGTTYP
     C                     MOVE *BLANKS   WWTREF
     C                     MOVELMGTNUM    WWFL6
     C                     MOVELWWFL6     WWTREF
     C                     MOVE MGTTYP    WWTREF
     C*
     C** IF MGTTYP EQUALS 'DM' AND MGTSTP IS ONE OF THE FOLLOWING
     C           MGTTYP    IFEQ 'DM'
     C           CSW003    ANDNE'Y'                                       CSW003
     C*
     C           MGTSTP    IFEQ 'RR'
     C           MGTSTP    OREQ 'RP'
     C           MGTSTP    OREQ 'BB'
     C           MGTSTP    OREQ 'BL'
     C           MGTSTP    OREQ 'PL'
     C           MGTSTP    OREQ 'PD'
     C           MGTSTP    OREQ 'DT'                                      185241
     C*
     C** MOVE 'A' TO POSITION 13 OF PARAMETER
     C                     MOVEL'A'       WT1313
     C                     END
     C*
     C                     END
     C*
     C                     CALL 'MG5910'               27
     C                     PARM MGMODI    @MODI   2
     C                     PARM WWTREF    @TREF  15
     C                     PARM 'PR'      @PROG   2
     C                     PARM *BLANKS   @MODE   1
     C                     PARM *BLANKS   @CONG   1
     C                     PARM *BLANKS   @RCDG   1
     C                     PARM *BLANKS   @ERCD   1
     C                     PARM CSW003    @MT5XX                          CSW003
     C*                                                                   CSW003
     C                     MOVEL@MODI     WWMODE
     C*
     C** IF PROGRAM NOT FOUND
     C           *IN27     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '042'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 042  *
     C                     MOVEL'MG5910'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** IF ERROR DURING PROGRAM
     C           @ERCD     IFEQ 'Y'
     C           MGTSTP    ANDNE'DT'                                      185241
     C           MGTSTP    ANDNE'RP'                                      185241
     C           MGTSTP    ANDNE'RR'                                      185241
     C           MGTSTP    ANDNE'BL'                                      185241
     C           MGTSTP    ANDNE'BB'                                      185241
     C           MGTSTP    ANDNE'PL'                                      185241
     C           MGTSTP    ANDNE'PD'                                      185241
     C           *LOCK     IN   LDA
     C                     MOVE '043'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 043  *
     C                     MOVELDBERR2    DBKEY            * * * * * * * *
     C                     MOVEL'MG5910'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** IF @RCDG EQUALS 'Y'  AND MESSAGE NOT CANCELLATION CEDEL
     C** OR IF @RCDG EQUALS 'N' AND MESSAGE IS CANCELLATION CEDEL
     C           @RCDG     IFEQ 'Y'
     C           CEDPRO    ANDEQ'N'
     C           MGTSTP    ANDNE'DT'                                      185241
     C           MGTSTP    ANDNE'RP'                                      185241
     C           MGTSTP    ANDNE'RR'                                      185241
     C           MGTSTP    ANDNE'BL'                                      185241
     C           MGTSTP    ANDNE'BB'                                      185241
     C           MGTSTP    ANDNE'PL'                                      185241
     C           MGTSTP    ANDNE'PD'                                      185241
     C           @RCDG     OREQ 'N'
     C           CEDPRO    ANDEQ'Y'
     C           MGTSTP    ANDNE'DT'                                      185241
     C           MGTSTP    ANDNE'RP'                                      185241
     C           MGTSTP    ANDNE'RR'                                      185241
     C           MGTSTP    ANDNE'BL'                                      185241
     C           MGTSTP    ANDNE'BB'                                      185241
     C           MGTSTP    ANDNE'PL'                                      185241
     C           MGTSTP    ANDNE'PD'                                      185241
     C           *LOCK     IN   LDA
     C                     MOVE '044'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 044  *
     C                     MOVELDBERR2    DBKEY            * * * * * * * *
     C                     MOVEL'MG5910'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  RSEQ      - FORMAT FIELDS FOR REPETITIVE SEQUENCE           *
     C**                                                              *
     C**  CALLS     - FLDR, FLD23, FLD30, FLD20R, FLD31P, FLD31T,     *
     C**            - FLD26J, FLD35A, FLD35B, FLD35E, FLD83R, FLD83C, *
     C**            - FLD84A, FLD87A, FLD85A, FLD88A, FLD57A, FLD58A  *
     C**            - FLD33T, FLD32M, FLD37J, FLD34A, FLD37L, FLD37S  *
     C**            - FLD33S, FLD37P, FLD32B, FLD26L, FLD26K, FLD77B  *
     C**            - FLD77D, FLD72, FLD79.                           *
     C**                                                              *
     C**  CALLED BY - MAIN PROCESSING                                 *
     C**                                                              *
     C*****************************************************************
     C*
     C           RSEQ      BEGSR
     C*
     C** IF ERROR FLAG IS NOT SET, DETERMINE REQUIREMENTS
     C           WWERR1    IFNE 'Y'
     C                     EXSR FLDR
     C                     END
     C*
     C** IF ERROR FLAG IS NOT SET, FORMAT FIELDS
     C           WWERR1    IFNE 'Y'
     C*
     C** FORMAT MANDATORY FIELD :23:
     C                     EXSR FLD23
     C*
     C** FORMAT FIELD :30:
     C                     EXSR FLD30
     C*
     C** FORMAT MANDATORY FIELD :20:
     C                     EXSR FLD20R
     C*
     C** FORMAT FIELD :31P:
     C                     EXSR FLD31P
     C*
     C** FORMAT FIELD :31T:
     C                     EXSR FLD31T
     C*
     C** FORMAT FIELD :26J:
     C                     EXSR FLD26J
     C*
     C** FORMAT FIELD :35A:
     C                     EXSR FLD35A
     C*
     C** FORMAT FIELD :35B:
     C                     EXSR FLD35B
     C*
     C** FORMAT FIELD :35E:
     C                     EXSR FLD35E
     C*
     C** FORMAT FIELD :83R:
     C                     EXSR FLD83R
     C*
     C** FORMAT FIELD :83C:
     C                     EXSR FLD83C
     C*
     C** FORMAT FIELD :84A:
     C                     EXSR FLD84A
     C*
     C** FORMAT FIELD :87a:
     C                     EXSR FLD87A
     C*
     C** FORMAT FIELD :85a:
     C                     EXSR FLD85A
     C*
     C** FORMAT FIELD :88a:
     C                     EXSR FLD88A
     C*
     C** FORMAT FIELD :57a:
     C                     EXSR FLD57A
     C*
     C** FORMAT FIELD :58a:
     C                     EXSR FLD58A
     C*
     C** FORMAT FIELD :33T:
     C                     EXSR FLD33T
     C*
     C** FORMAT FIELD :32M:
     C                     EXSR FLD32M
     C*
     C** FORMAT FIELD :37J:
     C                     EXSR FLD37J
     C*
     C** FORMAT FIELD :34a:
     C                     EXSR FLD34A
     C*
     C** FORMAT FIELD :37L:
     C                     EXSR FLD37L
     C*
     C** FORMAT FIELD :37S:
     C                     EXSR FLD37S
     C*
     C** FORMAT FIELD :33S:
     C                     EXSR FLD33S
     C*
     C** FORMAT FIELD :37P:
     C                     EXSR FLD37P
     C*
     C** FORMAT FIELD :32B:
     C                     EXSR FLD32B
     C*
     C** FORMAT FIELD :26L:
     C                     EXSR FLD26L
     C*
     C** FORMAT FIELD :26K:
     C                     EXSR FLD26K
     C*
     C** FORMAT FIELD :77B:
     C                     EXSR FLD77B
     C*
     C** FORMAT FIELD :77D:
     C                     EXSR FLD77D
     C*
     C** FORMAT FIELD :72:
     C                     EXSR FLD72
     C*
     C** FORMAT FIELD :79:
     C                     EXSR FLD79
     C*
     C** FOR FURTHER PROCESSING...
     C                     Z-ADDX         Y
     C*
     C** SET UP REFERENCE FILE INFORMATION FOR EACH PART OF MT580
     C                     EXSR WREF
     C*
     C** ELSE ERROR FLAG IS SET
     C                     ELSE
     C*
     C** FORMAT MANDATORY FIELD :23:
     C                     EXSR FLD23
     C*
     C** FORMAT MANDATORY FIELD :20:
     C                     EXSR FLD20R
     C*
     C** FORMAT FIELD :84A:
     C                     EXSR FLD84A
     C*
     C                     MOVE *BLANKS   WWERR1
     C                     END
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  FLD20N    - FORMAT FIELD :20: (NON-REPETITIVE SEQUENCE)     *
     C**                                                              *
     C**  CALLS     - NONE                                            *
     C**                                                              *
     C**  CALLED BY - MAIN                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           FLD20N    BEGSR
     C*
     C** FORMAT DESCRIPTION FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELDESA,5    MDES
     C*
     C** FORMAT TAG FIELD OF MULT OCCURENCE DATA STRUCTURE
     C***********          MOVEL':20:'    MTAG                            057263
     C                     MOVEL':20: '   MTAG                            057263
     C*
     C** OBTAIN THE LATEST MT580 TRN
     C           *NAMVAR   DEFN           M5STAT
     C           *LOCK     IN   M5STAT
     C*
     C** CONVERT MT80TR ALPHANUMERIC FIELD TO NUMERIC
     C                     MOVE MT80TR    WW80TR 130
     C                     ADD  1         WW80TR
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVE *BLANKS   WW80TN 16
     C                     MOVE WW80TR    WW80TN
     C                     MOVEL'SE8'     WW80TN
     C                     MOVE *BLANKS   MDAT
     C                     MOVELWW80TN    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** UPDATE WMULT WITH DETAILS OF THIS FIELD IN CASE PART OF THIS
     C** MESSAGE IS WRITTEN TO MESSAGES INCORRECTLY GENERATED REPORT
     C                     MOVELMDAT      WMDAT
     C                     MOVELMERR      WMERR
     C                     MOVELMTAG      WMTAG
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE - WMULT
     C                     ADD  1         WWZ
     C           WWZ       OCUR WMULT
     C*
     C** UPDATE AND RELEASE DATA AREA
     C                     MOVE WW80TR    MT80TR
     C                     OUT  M5STAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  FLD23     - FORMAT MANDATORY FIELD :23:                     *
     C**                                                              *
     C**  CALLS     - NONE                                            *
     C**                                                              *
     C**  CALLED BY - RSEQ                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           FLD23     BEGSR
     C*
     C** STORE POSITION ON MULT OCCURENCE DATA STRUCTURE IN CASE
     C** THERE IS AN ERROR IN FORMATTING THIS MESSAGE - OUTPUT THIS
     C** PART OF MESSAGE TO MG0580P2
     C                     Z-ADDX         WWX1    30
     C*
     C** IF ERROR FLAG IS SET FORMAT ERROR MESSAGE (COMBINATION ERROR)
     C           WWCOMB    IFEQ 'Y'
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,3    MERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C** END OF FIELD :23: PROCESSING
     C                     GOTO END23
     C                     END
     C*
     C** IF ERROR FLAG IS SET FORMAT ERROR MESSAGE (CASE IS ZERO)
     C           WWCASR    IFEQ 'Y'
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,4    MERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C** END OF FIELD :23: PROCESSING
     C                     GOTO END23
     C*
     C                     END
     C*
     C           MGGDEL    IFNE *BLANKS
     C           MGGDEL    ANDNE'G'
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,5    MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C** END OF FIELD :23: PROCESSING
     C                     GOTO END23
     C                     END
     C*
     C** INCREASE LENGTH
     C                     ADD  22        WWLENG
     C*
     C** FORMAT DESCRIPTION FIELD
     C                     MOVELDESA,2    MDES
     C*
     C** FORMAT TAG FIELD
     C***********          MOVEL':23:'    MTAG                            057263
     C                     MOVEL':23: '   MTAG                            057263
     C*
     C           MGINSS    IFEQ *BLANKS
     C           MGINSS    OREQ 'SETTL'
     C           MGINSS    OREQ 'BOOK '
     C           MGINSS    OREQ 'PHYSI'
     C*
     C** FORMAT DATA FIELD OF MULTIPLE OCCURENCE DATA STRUCTURE
     C                     MOVE *BLANKS   WWMDAT
     C                     MOVELMGF231    WD0107
     C*
     C           MGGDEL    IFEQ 'G'
     C                     MOVEL'//G'     WD0810
     C                     END
     C*
     C                     MOVELWWMDAT    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C                     ELSE
     C*
     C*  ELSE MGFID2 IS NOT BLANK
     C** FORMAT DATA FIELD OF MULTIPLE OCCURENCE DATA STRUCTURE
     C                     MOVE *BLANKS   WWMDAT
     C                     MOVELMGF231    WD0107
     C                     MOVE '/'       WD0808
     C                     MOVELMGINSS    WD0913
     C*
     C           MGGDEL    IFEQ 'G'
     C                     MOVEL'/G '     WD1416
     C                     END
     C*
     C                     MOVELWWMDAT    MDAT
     C                     MOVELMDAT      RDAT
     C                     END
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C           END23     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  FLD30     - FORMAT FIELD :30:                               *
     C**                                                              *
     C**  CALLS     - ZM0060, *PSSR                                   *
     C**                                                              *
     C**  CALLED BY - RSEQ                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           FLD30     BEGSR
     C*
     C** CHECK IF FIELD IS MANDATORY FOR THIS MESSASGE
     C           WWFL04    IFEQ 'M'
     C           MGSDAT    ANDEQ0
     C           MGINSS    ANDNE'MATCH'
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,6    MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** END OF FIELD :30: PROCESSING IF
     C** FIELD IS NOT REQUIRED OR MGSDAT IS ZERO
     C           WWFL04    IFNE 'N'
     C           MGSDAT    ANDNE0
     C*
     C** INCREASE LENGTH
     C                     ADD  12        WWLENG
     C*
     C** FORMAT DESCRIPTION FIELD
     C                     MOVELDESA,1    MDES
     C*
     C** FORMAT TAG FIELD
     C***********          MOVEL':30:'    MTAG                            057263
     C                     MOVEL':30: '   MTAG                            057263
     C*
     C** CONVERT TRADE DATE TO SWIFT FORMAT
     C                     CALL 'ZM0060'               22
     C                     PARM MGSDAT    ZMDAY
     C                     PARM *BLANKS   ZSDATE
     C*
     C** IF PROGRAM NOT FOUND
     C           *IN22     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '010'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 010  *
     C                     MOVEL'ZM0060'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELZSDATE    MDAT
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE FOR REPORT
     C                     MOVELWWYEAR    WRYEAR
     C                     MOVELWWMNTH    WRMNTH
     C                     MOVELWWDAY     WRDAY
     C                     MOVELWRDATE    RDAT
     C*
     C** STORE DATE FOR WRITE TO SWIFT DATABASE FILES
     C                     MOVELZSDATE    WWDATE  6
     C*
     C** CONVERT HISTORY RETENTION DATE TO SWIFT FORMAT
     C           MGDEST    IFNE WWCEDN
     C           WWSENT    ANDNE'CEDEL'
     C           MGSDAT    ADD  ENDSMN    ZMDAY
     C                     ELSE
     C           MGSDAT    ADD  60        ZMDAY
     C                     END
     C                     MOVE *BLANKS   ZSDATE
     C*
     C                     CALL 'ZM0060'               22
     C                     PARM           ZMDAY
     C                     PARM           ZSDATE
     C*
     C** IF PROGRAM NOT FOUND
     C           *IN22     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '035'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 035  *
     C                     MOVEL'ZM0060'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** SET HISTORY RETENTION DATE HRDT TO ZSDATE
     C                     MOVELZSDATE    WWHIST  6
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C                     END
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  FLD20R    - FORMAT MANDATORY FIELD :20: (REPETITIVE SEQ)    *
     C**                                                              *
     C**  CALLS     - NONE                                            *
     C**                                                              *
     C**  CALLED BY - RSEQ                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           FLD20R    BEGSR
     C*
     C** INITIALIZE ERROR FLAG
     C                     MOVE *BLANKS   WWER20  1
     C*
     C** IF TRANSACTION TYPE NOT VALID SET FLAG FOR ERROR IN FIELD :20:
     C           MGTTYP    IFNE 'TR'
     C           MGTTYP    ANDNE'TS'                                      CSW003
     C           MGTTYP    ANDNE'DM'
     C           MGTTYP    ANDNE'DN'                                      CSW003
     C                     MOVE 'Y'       WWER20
     C                     END
     C*
     C           MGMODI    IFNE 'SE'                       1
     C           WWFSIX    OREQ *BLANKS
     C           WWER20    OREQ 'Y'
     C*
     C** FORMAT ERROR MESSAGE FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELERRA,2    MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE                            X1
     C*
     C** INCREASE LENGTH
     C                     ADD  22        WWLENG
     C*
     C** FORMAT DESCRIPTION FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELDESA,5    MDES
     C*
     C** FORMAT TAG FIELD OF MULT OCCURENCE DATA STRUCTURE
     C***********          MOVEL':20:'    MTAG                            057263
     C                     MOVEL':20: '   MTAG                            057263
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVE *BLANKS   WWMDAT
     C*
     C** IF DESTINATION IS NOT CEDEL
     C           MGDEST    IFNE WWCEDN                     2
     C           WWSENT    ANDNE'CEDEL'
     C*
     C** POSITIONS 1-3
     C           MGMODI    IFEQ 'SE'                       3
     C           MGTTYP    ANDEQ'TR'
     C                     MOVEL'SET'     WD0103
     C                     ELSE
     C           MGMODI    IFEQ 'SE'
     C           MGTTYP    ANDEQ'DM'
     C                     MOVEL'SED'     WD0103
     C                     ELSE                                           CSW003
     C           MGMODI    IFEQ 'SE'                                      CSW003
     C           MGTTYP    ANDEQ'DN'                                      CSW003
     C                     MOVEL'SEE'     WD0103                          CSW003
     C                     ELSE                                           CSW003
     C           MGMODI    IFEQ 'SE'                                      CSW003
     C           MGTTYP    ANDEQ'TS'                                      CSW003
     C                     MOVEL'SEU'     WD0103                          CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
     C                     END
     C                     END                             E3
     C*
     C** POSITIONS 4-9
     C                     MOVELMGTNUM    WD0409
     C** POSITIONS 10-12
     C           @LSWS     IFEQ 9999999
     C                     Z-ADD1         WWLSWS  70
     C                     ELSE
     C           @LSWS     ADD  1         WWLSWS
     C                     END
     C                     MOVELWWLSWS    WD1016
     C*
     C                     ELSE                            X2
     C** DESTINATION IS CEDEL
     C*
     C** OBTAIN THE LATEST MT580 TRN FOR CEDEL
     C           *LOCK     IN   M5STAT
     C*
     C** CONVERT MT80CE ALPHANUMERIC FIELD TO NUMERIC
     C                     MOVE MT80CE    WW80CE  70
     C           WW80CE    IFEQ 9999999
     C                     Z-ADD1         WW80CE
     C                     ELSE
     C                     ADD  1         WW80CE
     C                     END
     C           MGTTYP    IFEQ 'DM'
     C                     MOVEL'001'     WD0103
     C                     ELSE
     C           MGTTYP    IFEQ 'DN'                                     CSW003
     C                     MOVEL'002'     WD0103                         CSW003
     C                     ELSE                                          CSW003
     C           MGTTYP    IFEQ 'TS'                                     CSW003
     C                     MOVEL'003'     WD0103                         CSW003
     C                     ELSE                                          CSW003
     C                     MOVEL'000'     WD0103
     C                     END
     C                     ENDIF                                         CSW003
     C                     ENDIF                                         CSW003
     C                     MOVELMGTNUM    WD0409
     C                     MOVELWW80CE    WD1016
     C*
     C** UPDATE AND RELEASE DATA AREA
     C                     MOVE WW80CE    MT80CE
     C                     OUT  M5STAT
     C*
     C                     END                             E2
     C*
     C                     MOVELWWMDAT    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** SAVE DATA FIELD IN WORK FIELD (FOR WRITE TO MGF579PD)
     C                     MOVELWWMDAT    WWD579 16
     C*
     C** SAVE DATA FIELD IN WORK FIELD (FOR WRITE TO MGOREFPD)
     C                     MOVELWWMDAT    WWDATA 16
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  FLD31P    - FORMAT FIELD :31P:                              *
     C**                                                              *
     C**  CALLS     - ZM0060, *PSSR,                                  *
     C**                                                              *
     C**  CALLED BY - RSEQ                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           FLD31P    BEGSR
     C*
     C** SET FLAG TO INDICATE FIELD :31P: PRESENT IN THIS SEQUENCE
     C                     MOVE 'Y'       WWF31P  1
     C*
     C** IF FIELD IS MANDATORY FOR THIS MESSAGE THEN
     C** DATE OF TRADE MUST NOT BE ZERO OR > SETTLEMENT DATE
     C           WWFL06    IFEQ 'M'
     C           MGTDAT    IFEQ 0
     C           MGTDAT    ORGT MGSDAT
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,7    MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C** END OF FIELD :31P: PROCESSING
     C                     GOTO END31P
     C                     END
     C                     END
     C*
     C** END OF FIELD :31P: PROCESSING IF
     C** FIELD IS NOT REQUIRED OR MGTDAT IS ZERO
     C           WWFL06    IFEQ 'N'
     C           MGTDAT    OREQ 0
     C                     MOVE 'N'       WWF31P
     C*
     C                     ELSE
     C*
     C** INCREASE LENGTH
     C                     ADD  17        WWLENG
     C*
     C** FORMAT DESCRIPTION FIELD
     C                     MOVELDESA,3    MDES
     C*
     C** FORMAT TAG FIELD
     C                     MOVEL':31P:'   MTAG
     C*
     C** CONVERT TRADE DATE TO SWIFT FORMAT
     C                     CALL 'ZM0060'               22
     C                     PARM MGTDAT    ZMDAY   50
     C                     PARM *BLANKS   ZSDATE  6
     C*
     C** IF PROGRAM NOT FOUND
     C           *IN22     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '029'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 029  *
     C                     MOVEL'ZM0060'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVEL*BLANKS   WWMDAT
     C                     MOVEL*BLANKS   WWRDAT
     C** POSITIONS 1-6
     C                     MOVELZSDATE    WD0106
     C                     MOVELWWYEAR    WRYEAR
     C                     MOVELWWMNTH    WRMNTH
     C                     MOVELWWDAY     WRDAY
     C                     MOVELWRDATE    WR0108
     C** POSITIONS 7-10
     C           MGMKTI    IFEQ 'P'
     C                     MOVEL'PRIM'    WD0710
     C                     MOVEL'PRIM'    WR0912
     C                     END
     C*
     C           MGMKTI    IFEQ 'S'
     C                     MOVEL'SECM'    WD0710
     C                     MOVEL'SECM'    WR0912
     C                     END
     C                     MOVELWWMDAT    MDAT
     C                     MOVELWWRDAT    RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C           END31P    ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  FLD31T    - FORMAT FIELD :31T:                              *
     C**                                                              *
     C**  CALLS     - NONE                                            *
     C**                                                              *
     C**  CALLED BY - RSEQ                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           FLD31T    BEGSR
     C*
     C** IF FIELD IS MANDATORY FOR THIS MESSAGE THEN
     C** TIME OF TRADE MUST NOT BE BLANK
     C           WWFL07    IFEQ 'M'
     C           MGTRTT    ANDEQ*BLANKS
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,8    MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** END OF FIELD :31T: PROCESSING IF FIELD IS NOT
     C** REQUIRED OR MGTRTT IS BLANK OR :31P: NOT PRESENT
     C           WWFL07    IFNE 'N'
     C           MGTRTT    ANDNE*BLANKS
     C           WWF31P    ANDEQ'Y'
     C*
     C** INCREASE LENGTH
     C                     ADD  11        WWLENG
     C*
     C** FORMAT DESCRIPTION FIELD
     C                     MOVELDESA,6    MDES
     C*
     C** FORMAT TAG FIELD
     C                     MOVEL':31T:'   MTAG
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELMGTRTT    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C                     END
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  FLD26J    - FORMAT FIELD :26J:                              *
     C**                                                              *
     C**  CALLS     - NONE                                            *
     C**                                                              *
     C**  CALLED BY - RSEQ                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           FLD26J    BEGSR
     C*
     C** IF FIELD IS MANDATORY FOR THIS MESSAGE THEN
     C** REQUESTED PRIORITY MUST BE 1, 2, 3, OR 4
     C           WWFL08    IFEQ 'M'
     C           MGRPTY    ANDNE'1'
     C           MGRPTY    ANDNE'2'
     C           MGRPTY    ANDNE'3'
     C           MGRPTY    ANDNE'4'
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,9    MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** END OF FIELD :26J: PROCESSING IF FIELD IS
     C** NOT REQUIRED OR MGRPTY IS BLANK OR MGFID2 = 'MATCH'
     C           WWFL08    IFNE 'N'
     C           MGRPTY    ANDNE*BLANKS
     C           MGINSS    ANDNE'MATCH'
     C*
     C** INCREASE LENGTH
     C                     ADD  8         WWLENG
     C*
     C** FORMAT DESCRIPTION FIELD
     C                     MOVELDESA,4    MDES
     C*
     C** FORMAT TAG FIELD
     C                     MOVEL':26J:'   MTAG
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELMGRPTY    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C                     END
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  FLD35A    - FORMAT FIELD :35A:                              *
     C**                                                              *
     C**  CALLS     - ZM1140 *PSSR                                    *
     C**                                                              *
     C**  CALLED BY - RSEQ                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           FLD35A    BEGSR
     C*
     C** IF FIELD IS MANDATORY FOR THIS MESSAGE THEN
     C** QUANTITY OF SECURITIES MUST NOT BE ZERO,
     C** SWIFT SECURITY TYPE MUST BE 'FMT', 'SHS' OR 'WTS'
     C           WWFL09    IFEQ 'M'
     C           MGQANT    ANDEQ0
     C           MGSWTP    ORNE 'FMT'
     C           MGSWTP    ANDNE'SHS'
     C           MGSWTP    ANDNE'WTS'
     C           MGSWTP    ANDNE'UNT'                                     184136
     C           MGSWTP    ANDNE'RTS'                                     184136
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,10   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** END OF FIELD :35A: PROCESSING IF FIELD IS
     C** NOT REQUIRED OR MGQANT IS ZERO
     C           WWFL09    IFNE 'N'
     C           MGQANT    ANDNE0
     C*
     C** INCREASE LENGTH
     C                     ADD  25        WWLENG
     C*
     C** FORMAT DESCRIPTION FIELD
     C                     MOVELDESA,7    MDES
     C*
     C** FORMAT TAG FIELD
     C                     MOVEL':35A:'   MTAG
     C*
     C** CONVERT MIDAS AMOUNT TO SWIFT FORMAT
     C                     CALL 'ZM1140'               23
     C                     PARM MGQANT    ZAMNT  150
     C***********          PARM 0         ZCDP    10                      078256
     C                     PARM MGNMDP    ZCDP    10                      078256
     C                     PARM *BLANKS   ZSAMNT 17
     C                     PARM *BLANKS   ZOAMNT 21
     C*
     C** IF PROGRAM NOT FOUND
     C           *IN23     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '021'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 021  *
     C                     MOVEL'ZM1140'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVE *BLANKS   WWMDAT
     C                     MOVELMGSWTP    WD0103
     C                     MOVELZSAMNT    WD0420
     C                     MOVELWWMDAT    MDAT
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE FOR REPORT
     C                     MOVE *BLANKS   WWRDAT
     C                     MOVELMGSWTP    WR0103
     C                     MOVELZOAMNT    WR0424
     C                     MOVELWWRDAT    RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C                     END
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  FLD35B    - FORMAT FIELD :35B:                              *
     C**                                                              *
     C**  CALLS     - NONE                                            *
     C**                                                              *
     C**  CALLED BY - RSEQ                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           FLD35B    BEGSR
     C*
     C** IF FIELD IS MANDATORY FOR THIS MESSAGE THEN
     C** SECURITY FULL NAME - MGSFN1 MUST NOT BE BLANK
     C           WWFL10    IFEQ 'M'
     C           MGSFN1    ANDEQ*BLANKS
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,11   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** END OF FIELD :35B: PROCESSING IF FIELD IS
     C** NOT REQUIRED OR MGSFN1 IS BLANK
     C           WWFL10    IFNE 'N'
     C           MGSFN1    ANDNE*BLANKS
     C*
     C** INCREASE LENGTH
     C                     ADD  61        WWLENG
     C*
     C** FORMAT DESCRIPTION FIELD
     C                     MOVELDESA,8    MDES
     C*
     C** FORMAT TAG FIELD
     C                     MOVEL':35B:'   MTAG
     C*
     C** IF ISIN OF SECURITY IS NON BLANK
     C           MGISIN    IFNE *BLANKS
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVE *BLANKS   WWMDAT
     C*
     C** CHECK ISIN OR COMMON CODE
     C                     MOVE MGISIN    WWISIN  1
     C           WWISIN    IFNE *BLANK
     C                     MOVEL'ISIN '   WD0105           ISIN code
     C                     MOVELMGISIN    WD0617
     C                     ELSE
     C                     MOVEL'/XS/'    WD0104           COMMON code
     C                     MOVELMGISIN    WD0516
     C                     END
     C*
     C                     MOVELWWMDAT    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C** REMOVE FORBIDDEN CHARACTERS (E.G. %)
     C                     MOVEAMGSFN1    FORB
     C                     Z-ADD1         J       20
     C           *IN85     DOUEQ'0'                                       056532
     C           '%'       LOKUPFORB,J                   85
     C           *IN85     IFEQ '1'                        found.
     C                     MOVE ' '       FORB,J
     C                     MOVEAFORB      MGSFN1
     C                     END
     C                     ENDDO                                          056532
     C                     Z-ADD1         J
     C           *IN85     DOUEQ'0'                                       056532
     C           '&'       LOKUPFORB,J                   85
     C           *IN85     IFEQ '1'
     C                     MOVE ' '       FORB,J
     C                     MOVEAFORB      MGSFN1
     C                     END
     C                     ENDDO                                          056532
     C                     Z-ADD1         J
     C           *IN85     DOUEQ'0'                                       056532
     C           '/'       LOKUPFORB,J                   85
     C           *IN85     IFEQ '1'
     C                     MOVE ' '       FORB,J
     C                     MOVEAFORB      MGSFN1
     C                     END
     C                     ENDDO                                          056532
     C                     Z-ADD1         J
     C           *IN85     DOUEQ'0'                                       056532
     C           '$'       LOKUPFORB,J                   85
     C           *IN85     IFEQ '1'
     C                     MOVE ' '       FORB,J
     C                     MOVEAFORB      MGSFN1
     C                     END
     C                     ENDDO                                          056532
     C                     Z-ADD1         J                               056532
     C           FORB,J    DOWEQ'-'                                       056532
     C           FORB,J    OREQ ' '                                       056532
     C           FORB,J    OREQ ':'                                       056532
     C                     ADD  1         J                               056532
     C                     MOVE *BLANKS   MGSFN1                          056532
     C                     MOVEAFORB,J    MGSFN1                          056532
     C           J         IFEQ 50                                        056532
     C           FORB,50   IFEQ '-'                                       056532
     C           FORB,50   OREQ ':'                                       056532
     C                     MOVE *BLANKS   MGSFN1                          056532
     C                     ENDIF                                          056532
     C                     LEAVE                                          056532
     C                     ENDIF                                          056532
     C                     ENDDO                                          056532
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELMGSFN1    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C** IF SECURITY FULL NAME 2 IS NON BLANK
     C           MGSFN2    IFNE *BLANKS
     C*
     C** INCREASE LENGTH
     C                     ADD  37        WWLENG
     C*
     C** REMOVE FORBIDDEN CHARACTERS (E.G. %)
     C                     MOVEAMGSFN2    FORB
     C                     Z-ADD1         J       20
     C           *IN85     DOUEQ'0'                                       056532
     C           '%'       LOKUPFORB,J                   85
     C           *IN85     IFEQ '1'                        found.
     C                     MOVE ' '       FORB,J
     C                     MOVEAFORB      MGSFN2
     C                     END
     C                     ENDDO                                          056532
     C                     Z-ADD1         J
     C           *IN85     DOUEQ'0'                                       056532
     C           '&'       LOKUPFORB,J                   85
     C           *IN85     IFEQ '1'
     C                     MOVE ' '       FORB,J
     C                     MOVEAFORB      MGSFN2
     C                     END
     C                     ENDDO                                          056532
     C                     Z-ADD1         J
     C           *IN85     DOUEQ'0'                                       056532
     C           '/'       LOKUPFORB,J                   85
     C           *IN85     IFEQ '1'
     C                     MOVE ' '       FORB,J
     C                     MOVEAFORB      MGSFN2
     C                     END
     C                     ENDDO                                          056532
     C                     Z-ADD1         J
     C           *IN85     DOUEQ'0'                                       056532
     C           '$'       LOKUPFORB,J                   85
     C           *IN85     IFEQ '1'
     C                     MOVE ' '       FORB,J
     C                     MOVEAFORB      MGSFN2
     C                     END
     C                     ENDDO                                          056532
     C                     Z-ADD1         J                               056532
     C           FORB,J    DOWEQ'-'                                       056532
     C           FORB,J    OREQ ' '                                       056532
     C           FORB,J    OREQ ':'                                       056532
     C                     ADD  1         J                               056532
     C                     MOVE *BLANKS   MGSFN2                          056532
     C                     MOVEAFORB,J    MGSFN2                          056532
     C           J         IFEQ 50                                        056532
     C           FORB,50   IFEQ '-'                                       056532
     C           FORB,50   OREQ ':'                                       056532
     C                     MOVE *BLANKS   MGSFN2                          056532
     C                     ENDIF                                          056532
     C                     LEAVE                                          056532
     C                     ENDIF                                          056532
     C                     ENDDO                                          056532
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELMGSFN2    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C                     END
     C*
     C                     END
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  FLD35E    - FORMAT FIELD :35E:                              *
     C**                                                              *
     C**  CALLS     - NONE                                            *
     C**                                                              *
     C**  CALLED BY - RSEQ                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           FLD35E    BEGSR
     C*
     C** SET FLAG TO INDICATE '/MSG579/' REQUIRED ON :72: MESSAGE
     C                     MOVE 'Y'       WWM579  1
     C*
     C** INITIALIZE ERROR FLAG
     C                     MOVE *BLANKS   WWER35  1
     C*
     C** RESET CERTIFICATE NUMBERS WORKFIELD
     C                     MOVE *BLANKS   WKCRTN
     C*
     C** IF FIELD IS MANDATORY FOR THIS MESSAGE AND CERTIFICATE
     C** NUMBERS REQUIRED = 'N' THEN ERROR
     C           WWFL11    IFEQ 'M'
     C           MGCRTN    ANDEQ'N'
     C                     MOVE 'Y'       WWER35
     C                     END
     C*
     C           WWER35    IFEQ 'Y'
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,12   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** END OF FIELD :35E: PROCESSING IF FIELD IS
     C** NOT REQUIRED OR CERTIFICATE NUMBERS REQUIRED = 'N'
     C           WWFL11    IFEQ 'N'
     C           MGCRTN    OREQ 'N'
     C                     MOVE 'N'       WWM579
     C                     GOTO END35E
     C                     END
     C*
     C** END OF FIELD :35E: PROCESSING IF
     C** FUNGIBILITY CODE IS NOT '1' OR '2'
     C           MGFCOD    IFNE '1'
     C           MGFCOD    ANDNE'2'
     C                     MOVE 'N'       WWM579
     C                     GOTO END35E
     C                     END
     C*
     C** ACCESS SECRTNL1 USING KEY OF LEFTMOST 6 CHARS OF
     C** MGTNUM - SECRTNL1
     C                     MOVELMGTNUM    WWKEY1  6
     C*
     C           *IN51     IFEQ '0'
     C                     OPEN SECRTNL1
     C                     MOVE '1'       *IN51
     C                     END
     C           WWKEY1    CHAINSECRTNL1             17
     C*
     C** IF RECORD FOUND
     C           *IN17     IFEQ '0'
     C*
     C** WRITE A RECORD TO MGF579PD
     C                     MOVELWWD579    MGRREF
     C                     OPEN MGF579PD
     C                     WRITEMGF579D0
     C                     CLOSEMGF579PD
     C                     MOVE 'Y'       WKCRTN
     C                     ELSE
     C*
     C** FORMAT ERROR FIELD
     C                     MOVELERRA,13   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C                     END
     C*
     C           END35E    ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  FLD83R    - FORMAT FIELD :83R:                              *
     C**                                                              *
     C**  CALLS     - NONE                                            *
     C**                                                              *
     C**  CALLED BY - RSEQ                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           FLD83R    BEGSR
     C*
     C** IF FIELD IS MANDATORY FOR THIS MESSAGE AND
     C** SENDER'S ROLE IS BLANK
     C           WWFL12    IFEQ 'M'
     C           MGSROL    ANDEQ*BLANKS
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,14   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** END OF FIELD :83R: PROCESSING IF FIELD IS
     C** NOT REQUIRED OR MGSROL IS BLANK
     C           WWFL12    IFNE 'N'
     C           MGSROL    ANDNE*BLANKS
     C*
     C** INCREASE LENGTH
     C                     ADD  11        WWLENG
     C*
     C** FORMAT DESCRIPTION FIELD
     C                     MOVELDESA,10   MDES
     C*
     C** FORMAT TAG FIELD
     C                     MOVEL':83R:'   MTAG
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELMGSROL    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C                     END
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  FLD83C    - FORMAT FIELD :83C:                              *
     C**                                                              *
     C**  CALLS     - NONE                                            *
     C**                                                              *
     C**  CALLED BY - RSEQ                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           FLD83C    BEGSR
     C*
     C** IF FIELD IS MANDATORY FOR THIS MESSAGE AND
     C** SAFEKEEPING ACCOUNT IS BLANK
     C           WWFL13    IFEQ 'M'
     C           MGSAFA    ANDEQ*BLANKS
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,15   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** END OF FIELD :83C: PROCESSING IF FIELD IS  REQUIRED
     C           WWFL13    IFNE 'N'
     C           MGSAFA    ANDNE*BLANKS
     C*
     C** INCREASE LENGTH
     C                     ADD  13        WWLENG
     C*
     C** FORMAT DESCRIPTION FIELD
     C                     MOVELDESA,11   MDES
     C*
     C** FORMAT TAG FIELD
     C                     MOVEL':83C:'   MTAG
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELMGSAFA    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C                     END
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  FLD84A    - FORMAT FIELD :84A:                              *
     C**                                                              *
     C**  CALLS     - ZM0050, *PSSR                                   *
     C**                                                              *
     C**  CALLED BY - RSEQ                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           FLD84A    BEGSR
     C*
     C** IF ERROR FLAG SET FOR :84A:
     C           WWER84    IFEQ 'Y'
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,16   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** IF FIELD IS MANDATORY FOR THIS MESSAGE AND
     C** CLEARING CRRESPONDENT IS BLANK
     C           WWFL14    IFEQ 'M'
     C           MGCCTN    ANDEQ*BLANKS
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,17   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** END OF FIELD :84A: PROCESSING IF FIELD IS
     C** REQUIRED AND MGCCTN IS NOT BLANK
     C           WWFL14    IFNE 'N'
     C           MGCCTN    ANDNE*BLANKS
     C*
     C** INCREASE LENGTH
     C                     ADD  19        WWLENG
     C*
     C** FORMAT DESCRIPTION FIELD
     C                     MOVELDESA,12   MDES
     C*
     C** FORMAT TAG FIELD
     C                     MOVEL':84A:'   MTAG
     C                     MOVE *BLANKS   SAVMTG                          183583
     C                     MOVE MTAG      SAVMTG                          183583
      *******                                                             113207
     C***FORMAT*DATA*FIELD*OF*MULT*OCCURENCE*DATA*STRUCTURE               113207
     C*******              MOVELMGCCTN    MDAT                            113207
     C*******              MOVELMDAT      RDAT                            113207
     C*******                                                             113207
     C***INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE                    113207
     C*******              ADD  1         X                               113207
     C*******    X         OCUR MULT                                      113207
      **                                                                  113207
      *                                                                   173491
      ** If MGCCTN contains SWIFT ID get necessary data else assume       173491
      ** it is a customer number, or shortname.                           173491
      *                                                                   173491
     C                     MOVE MGCCTN    WWCCTN 12                       173491
     C           WWCCTN    CHAINSDCUSTL7             69                   173491
     C           *IN69     IFEQ '0'                                       173491
     C                     MOVELBBCRTN    ZCRTN                           173491
     C                     MOVELBBCRNM    ZCRNM                           173491
     C                     MOVELMGCCTN    ZSADD1                          173491
     C                     MOVE *BLANKS   ZSADD2                          173491
     C                     MOVE *BLANKS   ZSADD3                          173491
     C                     MOVE *BLANKS   ZSADD4                          173491
     C                     MOVE *BLANK    ZERR                            173491
     C                     MOVE 'A'       ZSTAG                           173491
     C                     MOVEL':84A:'   MTAG                            173491
     C                     MOVE *BLANKS   SAVMTG                          183583
     C                     MOVE MTAG      SAVMTG                          183583
     C                     ELSE                                           173491
     C** Format address fields for tag'A' or 'D'                          113207
     C                     CALL 'ZM1150'               25                 113207
     C                     PARM MGCCTN    ZDEST                           113207
     C                     PARM *BLANKS   ZSADD1                          113207
     C                     PARM *BLANKS   ZSADD2                          113207
     C                     PARM *BLANKS   ZSADD3                          113207
     C                     PARM *BLANKS   ZSADD4                          113207
     C                     PARM *BLANKS   ZSTAG                           113207
     C                     PARM *BLANKS   ZSTYPE                          113207
     C                     PARM *BLANKS   ZERR                            113207
     C                     PARM *BLANKS   ZCRNM                           113207
     C                     PARM *BLANKS   ZCRTN                           113207
     C                     PARM *BLANK    ZDBEI                                               CSW201
     C*                                                                   113207
     C** IF PROGRAM NOT FOUND                                             113207
     C           *IN25     IFEQ '1'                                       113207
     C           *LOCK     IN   LDA                                       113207
     C                     MOVE '070'     DBASE            * * * * * * * *113207
     C                     MOVE *BLANKS   DBKEY            *  DBERR 033  *113207
     C                     MOVEL'ZM1150'  DBPGM            * * * * * * * *113207
     C                     OUT  LDA                                       113207
     C                     EXSR *PSSR                                     113207
     C                     END                                            113207
     C                     ENDIF                                          173491
     C*                                                                   113207
     C** IF ERROR DURING CALLED PROGRAM                                   113207
     C           ZERR      IFEQ '1'                                       113207
     C                     MOVELERRA,17   MERR                            113207
     C                     MOVE 'Y'       @ERR                            113207
     C                     MOVE 'Y'       WWNGEN                          113207
     C*                                                                   113207
     C** INCREASE INDEX FOR MULT OCCURRENCE DATA STRUCTURE                113207
     C                     ADD  1         X                               113207
     C           X         OCUR MULT                                      113207
     C*                                                                   113207
     C                     ELSE                                           113207
     C*                                                                   113207
     C** FORMAT TAG FIELD OF MULT OCCURENCE DATA STRUCTURE                113207
     C*                                                                   113207
     C** ZSTAG='A'                                                        113207
     C           ZSTAG     IFEQ 'A'                                       113207
     C                     MOVEL':84A:'   MTAG                            113207
     C                     MOVE *BLANKS   SAVMTG                          183583
     C                     MOVE MTAG      SAVMTG                          183583
     C                     ELSE                                           113207
     C** ZSTAG='D'                                                        113207
     C                     MOVEL':84D:'   MTAG                            113207
     C                     END                                            113207
     C*                                                                   113207
     C*                                                                   113207
     C** SET UP DATA FIELD OF MULT OCCURENCE DATA STRUCTURE               113207
     C                     MOVELMGCCTN    MDAT                            183583
     C                     EXSR #ZA                                       113207
     C*                                                                   113207
     C                     END                                            113207
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C                     Z-ADDX         Y       30
     C           END84     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  FLD87A    - FORMAT FIELD :87a:                              *
     C**                                                              *
     C**  CALLS     - ZM1070, *PSSR                                   *
     C**                                                              *
     C**  CALLED BY - RSEQ                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           FLD87A    BEGSR
     C*
     C** RETRIEVE RECEIVER OF SEC. COUNTERPARTY SHORTNAME & TOWN
     C           MGRSS1    IFNE *BLANKS
     C*
     C***********          MOVE MGRS26    ZZCUST  6                                           CSE022
     C                     MOVE MGRS26    WZCUST  6                                           CSE022
     C                     MOVELWZCUST    ZZCUST 20                                           CSE022
     C           ZZCUST    CHAINSDSECSJ4             62
     C           *IN62     IFEQ '1'
     C***********          MOVE MGRS59    ZZCUST                                              CSE022
     C                     MOVE MGRS26    WZCUST                                              CSE022
     C                     MOVELWZCUST    ZZCUST                                              CSE022
     C           ZZCUST    CHAINSDSECSJ4             62
     C                     END
     C           *IN62     IFEQ '1'
     C***********          MOVE MGRS26    ZZCUST                                              CSE022
     C                     MOVE MGRS59    WZCUST                                              CSE022
     C                     MOVELWZCUST    ZZCUST                                              CSE022
     C           ZZCUST    CHAINSDSECSJ5             62
     C                     END
     C           *IN62     IFEQ '1'
     C***********          MOVE MGRS59    ZZCUST                                              CSE022
     C                     MOVE MGRS27    WZCUST                                              CSE022
     C                     MOVELWZCUST    ZZCUST                                              CSE022
     C           ZZCUST    CHAINSDSECSJ5             62
     C                     END
     C           *IN62     IFEQ '1'                                       064596
     C***********          MOVE MGRS27    ZZCUST                          064596              CSE022
     C                     MOVE MGRS27    WZCUST                                              CSE022
     C                     MOVELWZCUST    ZZCUST                                              CSE022
     C           ZZCUST    CHAINSDSECSJ4             62                   064596
     C                     ENDIF                                          064596
     C           *IN62     IFEQ '1'                                       064596
     C***********          MOVE MGRS27    ZZCUST                          064596              CSE022
     C                     MOVE MGRS27    WZCUST                                              CSE022
     C                     MOVELWZCUST    ZZCUST                                              CSE022
     C           ZZCUST    CHAINSDSECSJ5             62                   064596
     C                     ENDIF                                          064596
     C           *IN62     IFEQ '0'
     C                     MOVELBBCRNM    R1RDNM
     C                     MOVELBBCRTN    R1RDTN
     C                     END
     C                     END
     C*
     C** RETRIEVE DELIVERER OF SEC. COUNTERPARTY SHORTNAME & TOWN
     C           MGDSS1    IFNE *BLANKS
     C*
     C***********          MOVE MGDS26    ZZCUST                                              CSE022
     C                     MOVE MGRS26    WZCUST                                              CSE022
     C                     MOVELWZCUST    ZZCUST                                              CSE022
     C           ZZCUST    CHAINSDSECSJ4             62
     C           *IN62     IFEQ '1'
     C***********          MOVE MGDS59    ZZCUST                                              CSE022
     C                     MOVE MGDS59    WZCUST                                              CSE022
     C                     MOVELWZCUST    ZZCUST                                              CSE022
     C           ZZCUST    CHAINSDSECSJ4             62
     C                     END
     C           *IN62     IFEQ '1'
     C***********          MOVE MGDS26    ZZCUST                                              CSE022
     C                     MOVE MGDS26    WZCUST                                              CSE022
     C                     MOVELWZCUST    ZZCUST                                              CSE022
     C           ZZCUST    CHAINSDSECSJ5             62
     C                     END
     C           *IN62     IFEQ '1'
     C***********          MOVE MGDS59    ZZCUST                                              CSE022
     C                     MOVE MGDS59    WZCUST                                              CSE022
     C                     MOVELWZCUST    ZZCUST                                              CSE022
     C           ZZCUST    CHAINSDSECSJ5             62
     C                     END
     C           *IN62     IFEQ '1'                                       064596
     C***********          MOVE MGDS27    ZZCUST                          064596              CSE022
     C                     MOVE MGDS27    WZCUST                                              CSE022
     C                     MOVELWZCUST    ZZCUST                                              CSE022
     C           ZZCUST    CHAINSDSECSJ4             62                   064596
     C                     ENDIF                                          064596
     C           *IN62     IFEQ '1'                                       064596
     C***********          MOVE MGDS27    ZZCUST                          064596              CSE022
     C                     MOVE MGDS27    WZCUST                                              CSE022
     C                     MOVELWZCUST    ZZCUST                                              CSE022
     C           ZZCUST    CHAINSDSECSJ5             62                   064596
     C                     ENDIF                                          064596
     C           *IN62     IFEQ '0'
     C                     MOVELBBCRNM    R1RDNM
     C                     MOVELBBCRTN    R1RDTN
     C                     END
     C                     END
     C*
     C** MERGE RECEIVER AND DELIVERER INTO RECEIVER/DELIVERER
     C           MGTSTP    IFEQ 'TP'
     C                     MOVE MGDSSA    MGRSSA
     C                     MOVE MGDSSN    MGRSSN
     C                     MOVE MGDSS1    MGRSS1
     C                     MOVE MGDSS2    MGRSS2
     C                     MOVE MGDSS3    MGRSS3
     C                     MOVE MGDSS4    MGRSS4
     C                     END
     C*
     C** WHEN THE USER WANT TO NOT GENERATE THIS FIELD
     C                     MOVELMGRSS1    WKRSS1  1
     C           WKRSS1    IFNE '#'
     C*
     C** INITIALIZE ERROR INDICATOR & OPTION FIELD
     C                     MOVE *BLANKS   WWER87  1
     C                     MOVE *BLANKS   WWOPTC  1
     C*
     C           WWCASE    LOKUPARR2                     30
     C** IF CASE NUMBER FOUND IN ARRAY THEN ONLY OPTION 'C' IS VALID
     C           *IN30     IFEQ '1'                        found.
     C                     MOVE 'Y'       WWOPTC
     C                     END
     C*
     C** IF FIELD IS MANDATORY FOR THIS MESSAGE CHECK IF FIELD
     C** CAN BE FORMATTED
     C           WWFL15    IFEQ 'M'
     C*
     C           MGRSSN    IFEQ *BLANKS
     C           MGRSS1    ANDEQ*BLANKS
     C           WWOPTC    OREQ 'Y'
     C           MGRSS1    ANDEQ*BLANKS
     C           WWCASE    OREQ 33
     C           MGRSS1    ANDEQ*BLANKS
     C                     MOVE 'Y'       WWER87
     C                     END
     C                     END
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C           WWER87    IFEQ 'Y'
     C*
     C                     MOVELERRA,20   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** PROCESSING IF FIELD IS NOT REQUIRED
     C           WWFL15    IFEQ 'N'
     C           MGRSSN    OREQ *BLANKS
     C           MGRSS1    ANDEQ*BLANKS
     C           WWOPTC    OREQ 'Y'
     C           MGRSS1    ANDEQ*BLANKS
     C           WWCASE    OREQ 33
     C           MGRSS1    ANDEQ*BLANKS
     C                     MOVE 'Y'       WWER87
     C                     END
     C*
     C** NO ERROR WAS FOUND AND THIS FIELD IS NOT TO BE REMOVED
     C           WWER87    IFNE 'Y'
     C*
     C** INCREASE LENGTH
     C                     MOVELMGRSS1    ZZRSS1  2
     C           ZZRSS1    IFEQ '//'
     C                     ADD  17        WWLENG
     C                     ELSE
     C                     ADD  42        WWLENG
     C                     END
     C*
     C** FORMAT DESCRIPTION FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELDESA,13   MDES
     C*
     C** (1) - FORMAT DATA FIELD ENTERED FROM SCREEN
     C           MGRSSA    IFNE *BLANK
     C                     MOVE '87'      WWTAGN
     C                     MOVE MGRSSA    WWTAGI
     C                     MOVE WWTAG     MTAG
     C*
     C** IF MGRSS1 IS BLANK
     C           MGRSS1    IFEQ *BLANK
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,50   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** IF MGRSS1 IS NOT BLANK
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELMGRSS1    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C** IF MGRSS2 IS NOT BLANK
     C           MGRSS2    IFNE *BLANK
     C*
     C** INCREASE LENGTH
     C                     ADD  42        WWLENG
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELMGRSS2    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C** IF MGRSS3 IS NOT BLANK
     C           MGRSS3    IFNE *BLANK
     C*
     C** INCREASE LENGTH
     C                     ADD  42        WWLENG
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELMGRSS3    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C** IF MGRSS4 IS NOT BLANK
     C           MGRSS4    IFNE *BLANK
     C*
     C** INCREASE LENGTH
     C                     ADD  42        WWLENG
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELMGRSS4    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C                     ELSE
     C*
     C** (2) - FORMAT TAG FIELD AS EXPECTED TO BE 'C'
     C           WWOPTC    IFEQ 'Y'
     C                     MOVEL':87C:'   MTAG
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELMGRSS1    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
      *                                                                                       192221
      ** Include account lines 2 to 4 for tag 87                                              192221
      *                                                                                       192221
     C           MGRSS2    IFNE *BLANKS                                                       192221
     C                     MOVELMGRSS2    MDAT                                                192221
     C                     MOVELMDAT      RDAT                                                192221
     C                     ADD  1         X                                                   192221
     C           X         OCUR MULT                                                          192221
     C                     ENDIF                                                              192221
      *                                                                                       192221
     C           MGRSS3    IFNE *BLANKS                                                       192221
     C                     MOVELMGRSS3    MDAT                                                192221
     C                     MOVELMDAT      RDAT                                                192221
     C                     ADD  1         X                                                   192221
     C           X         OCUR MULT                                                          192221
     C                     ENDIF                                                              192221
      *                                                                                       192221
     C           MGRSS4    IFNE *BLANKS                                                       192221
     C                     MOVELMGRSS4    MDAT                                                192221
     C                     MOVELMDAT      RDAT                                                192221
     C                     ADD  1         X                                                   192221
     C           X         OCUR MULT                                                          192221
     C                     ENDIF                                                              192221
      *                                                                                       192221
     C*
     C                     ELSE
     C*
     C** (3) - ONLY OPTION 'D' IS VALID
     C           WWCASE    IFEQ 8
     C           WWCASE    OREQ 14
     C           WWCASE    OREQ 18
     C           WWCASE    OREQ 33
     C*
     C** FORMAT TAG FIELD
     C                     MOVEL':87D:'   MTAG
     C*
     C                     MOVELMGRSSN    WWFLD1  1
     C           WWFLD1    LOKUPNUM                      31
     C           *IN31     IFEQ '1'                        cust. number
     C                     MOVELMGRSSN    WWFLD6  6
     C           WWFLD6    CHAINSDCUSTL1             16
     C                     ELSE                            cust. shortname
     C                     MOVELMGRSSN    WWCUST 10
     C           WWCUST    CHAINSDCUSTL6             17
     C                     END
     C*
     C** IF NO RECORD FOUND ON SDCUSTL1 OR SDCUSTL6
     C           *IN16     IFEQ '1'
     C           *IN17     OREQ '1'
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,21   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** ACCOUNT LINE FIELD IS MANDATORY
     C           WWCASE    IFEQ 33
      *                                                                                       192221
      ** Format Rcvr of Securities Account lines for WWCASE = 8 or                            192221
      ** 14 or 18                                                                             192221
      *                                                                                       192221
     C           WWCASE    OREQ 8                                                             192221
     C           WWCASE    OREQ 14                                                            192221
     C           WWCASE    OREQ 18                                                            192221
     C*
     C** SET UP DATA FIELD OF MULT OCCURENCE DATA STRUCUTURE
     C                     MOVELMGRSS1    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
      *                                                                                       192221
      ** Format Rcvr of Securities Account lines 2 to 4 if not                                192221
      ** blank                                                                                192221
      *                                                                                       192221
     C           MGRSS2    IFNE *BLANKS                                                       192221
     C                     MOVELMGRSS2    MDAT                                                192221
     C                     MOVELMDAT      RDAT                                                192221
     C                     ADD  1         X                                                   192221
     C           X         OCUR MULT                                                          192221
     C                     ENDIF                                                              192221
      *                                                                                       192221
     C           MGRSS3    IFNE *BLANKS                                                       192221
     C                     MOVELMGRSS3    MDAT                                                192221
     C                     MOVELMDAT      RDAT                                                192221
     C                     ADD  1         X                                                   192221
     C           X         OCUR MULT                                                          192221
     C                     ENDIF                                                              192221
      *                                                                                       192221
     C           MGRSS4    IFNE *BLANKS                                                       192221
     C                     MOVELMGRSS4    MDAT                                                192221
     C                     MOVELMDAT      RDAT                                                192221
     C                     ADD  1         X                                                   192221
     C           X         OCUR MULT                                                          192221
     C                     ENDIF                                                              192221
      *                                                                                       192221
     C                     END
     C*
     C** SET UP DATA FIELD OF MULT OCCURENCE DATA STRUCUTURE
     C                     ADD  42        WWLENG
     C                     MOVELBBCNA1    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C** SET UP DATA FIELD OF MULT OCCURENCE DATA STRUCUTURE
     C           BBCNA2    IFNE *BLANKS
     C                     ADD  42        WWLENG
     C                     MOVELBBCNA2    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C** SET UP DATA FIELD OF MULT OCCURENCE DATA STRUCUTURE
     C           BBCNA3    IFNE *BLANKS
     C                     ADD  42        WWLENG
     C                     MOVELBBCNA3    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C** SET UP DATA FIELD OF MULT OCCURENCE DATA STRUCUTURE
     C           BBCNA4    IFNE *BLANKS
     C                     ADD  42        WWLENG
     C                     MOVELBBCNA4    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C                     END
     C*
     C                     END
     C*
     C** (4) - OPTION COULD BE ANYTHING AND IS TO BE RETRIEVED
     C           WWCASE    IFNE 8
     C           WWCASE    ANDNE14
     C           WWCASE    ANDNE18
     C           WWCASE    ANDNE33
     C*
     C** FORMAT ADDRESS FIELDS
     C           WWCASE    IFEQ 3
     C                     MOVE *BLANKS   WWRSS1
     C                     ELSE
     C                     MOVE MGRSS1    WWRSS1
     C                     END
     C*
     C                     CALL 'ZM1070'               26
     C                     PARM MGRSSN    ZDEST  12
     C                     PARM WWRSS1    ZACLN  35
     C                     PARM *BLANKS   ZSADD1 35
     C                     PARM *BLANKS   ZSADD2 35
     C                     PARM *BLANKS   ZSADD3 35
     C                     PARM *BLANKS   ZSADD4 35
     C                     PARM *BLANKS   ZSTAG   1
     C                     PARM *BLANKS   ZSTYPE  1
     C                     PARM *BLANKS   ZERR    1
     C                     PARM *BLANKS   ZCRNM  20
     C                     PARM *BLANKS   ZCRTN  10
     C*
     C** IF PROGRAM NOT FOUND
     C           *IN26     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '019'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 019  *
     C                     MOVEL'ZM1070'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** IF ERROR DURING CALLED PROGRAM
     C           ZERR      IFEQ '1'
     C                     MOVELERRA,21   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     ELSE
     C*
     C** FORMAT TAG FIELD OF MULT OCCURENCE DATA STRUCTURE
     C*
     C** IF ZSTAG IS 'A'
     C                     MOVE *BLANKS   SAVMTG  5                       183583
     C           ZSTAG     IFEQ 'A'
     C                     MOVEL':87A:'   MTAG
     C                     MOVE MTAG      SAVMTG                          183583
     C                     END
     C*
     C** IF ZSTAG IS 'C'
     C           ZSTAG     IFEQ 'C'
     C                     MOVEL':87C:'   MTAG
     C                     ELSE
     C*
     C** IF ZSTAG IS 'D'
     C                     MOVEL':87D:'   MTAG
     C                     END
     C*
     C** IF MGRSS1 IS NOT BLANK
     C           MGRSS1    IFNE *BLANKS
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELMGRSS1    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
      *                                                                                       192221
      ** Include account lines 2 to 4 for tag 87                                              192221
      *                                                                                       192221
     C           MGRSS2    IFNE *BLANKS                                                       192221
     C                     MOVELMGRSS2    MDAT                                                192221
     C                     MOVELMDAT      RDAT                                                192221
     C                     ADD  1         X                                                   192221
     C           X         OCUR MULT                                                          192221
     C                     ENDIF                                                              192221
      *                                                                                       192221
     C           MGRSS3    IFNE *BLANKS                                                       192221
     C                     MOVELMGRSS3    MDAT                                                192221
     C                     MOVELMDAT      RDAT                                                192221
     C                     ADD  1         X                                                   192221
     C           X         OCUR MULT                                                          192221
     C                     ENDIF                                                              192221
      *                                                                                       192221
     C           MGRSS4    IFNE *BLANKS                                                       192221
     C                     MOVELMGRSS4    MDAT                                                192221
     C                     MOVELMDAT      RDAT                                                192221
     C                     ADD  1         X                                                   192221
     C           X         OCUR MULT                                                          192221
     C                     ENDIF                                                              192221
      *                                                                                       192221
     C*
     C** FORMAT ADDRESSES (UP TO 4 OCCURENCES)
     C                     EXSR #ZA
     C*
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C*
     C                     MOVEL*BLANKS   R1RDNM
     C                     MOVEL*BLANKS   R1RDTN
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  FLD85A    - FORMAT FIELD :85a:                              *
     C**                                                              *
     C**  CALLS     - NONE                                            *
     C**                                                              *
     C**  CALLED BY - RSEQ                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           FLD85A    BEGSR
     C*
     C** IF FIELD IS MANDATORY FOR THIS MESSAGE AND
     C** DELIVERER'S INSTRUCTING PARTY IS BLANK
     C           WWFL16    IFEQ 'M'
     C           MGDIPL    ANDEQ*BLANKS
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,22   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** END OF FIELD :85a: PROCESSING IF FIELD IS
     C** NOT REQUIRED OR MGDIPL IS BLANK
     C           WWFL16    IFNE 'N'
     C           MGDIPL    ANDNE*BLANKS
     C*
     C** INCREASE LENGTH
     C                     ADD  13        WWLENG
     C*
     C** FORMAT DESCRIPTION FIELD
     C                     MOVELDESA,14   MDES
     C*
     C** FORMAT TAG FIELD
     C                     MOVEL':85C:'   MTAG
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELMGDIPL    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C                     END
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  FLD88A    - FORMAT FIELD :88a:                              *
     C**                                                              *
     C**  CALLS     - NONE                                            *
     C**                                                              *
     C**  CALLED BY - RSEQ                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           FLD88A    BEGSR
     C*
     C** WHEN THE USER WANT TO NOT GENERATE THIS FIELD
     C                     MOVELMGBSS1    WKBSS1  1
     C           WKBSS1    IFNE '#'
     C*
     C** INITIALIZE ERROR FLAG
     C                     MOVE *BLANKS   WWER88  1
     C*
     C** IF FIELD IS MANDATORY FOR THIS MESSAGE CHECK IF FIELD
     C** CAN BE FORMATTED
     C           WWFL17    IFEQ 'M'
     C           MGBSSN    ANDEQ*BLANKS
     C           MGBSS1    ANDEQ*BLANKS
     C** WHEN SENT TO CEDEL
     C           WWFL17    OREQ 'M'
     C           WWCNUM    ANDEQBVDR2
     C           MGBSSA    ANDEQ*BLANKS
     C           MGBSSN    ANDEQ*BLANKS
     C           WWFL17    OREQ 'M'                                       CSW003
     C           WWSENT    ANDEQ'CEDEL'                                   CSW003
     C           MGBSSA    ANDEQ*BLANKS                                   CSW003
     C           MGBSSN    ANDEQ*BLANKS                                   CSW003
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,23   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** PROCESSING IF FIELD IS NOT REQUIRED
     C           WWFL17    IFEQ 'N'
     C           MGBSSN    OREQ *BLANKS
     C           MGBSS1    ANDEQ*BLANKS
     C                     MOVE 'Y'       WWER88
     C                     END
     C*
     C** NO ERROR WAS FOUND AND THIS FIELD IS NOT TO BE REMOVED
     C           WWER88    IFNE 'Y'
     C*
     C** FORMAT DESCRIPTION FIELD OF MULT OCCURENCE DATAT STRUCTURE
     C                     MOVELDESA,15   MDES
     C*
     C** (1) - FORMAT DATA FIELD ENTERED FROM SCREEN
     C           MGBSSA    IFNE *BLANK
     C                     MOVE '88'      WWTAGN
     C                     MOVE MGBSSA    WWTAGI
     C                     MOVE WWTAG     MTAG
     C*
     C** IF MGBSS1 IS BLANK
     C           MGBSS1    IFEQ *BLANK
     C*
     C** INCREASE LENGTH
     C                     ADD  42        WWLENG
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,51   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** IF MGBSS1 IS NOT BLANK
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELMGBSS1    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C** IF MGBSS2 IS NOT BLANK
     C           MGBSS2    IFNE *BLANK
     C*
     C** INCREASE LENGTH
     C                     ADD  42        WWLENG
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELMGBSS2    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C                     ELSE
     C*
     C** (2) FORMAT TAG FIELD AS EXPECTED TO BE 'C' (FOR EUROCLEAR ONLY)
     C           MGBSSN    IFEQ *BLANKS
     C*
     C** FORMAT TAG FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVEL':88C:'   MTAG
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELMGBSS1    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** (3) FORMAT TAG FIELD AS EXPECTED TO BE 'D'
     C                     MOVELMGBSSN    WWFLD1
     C           WWFLD1    LOKUPNUM                      31
     C           *IN31     IFEQ '1'                        cust. number
     C                     MOVELMGBSSN    WWFLD6  6
     C           WWFLD6    CHAINSDCUSTL1             16
     C                     ELSE                            cust. shortname
     C                     MOVELMGBSSN    WWCUST 10
     C           WWCUST    CHAINSDCUSTL6             17
     C                     END
     C*
     C** IF NO RECORD FOUND ON SDCUSTL1 OR SDCUSTL6
     C           *IN16     IFEQ '1'
     C           *IN17     OREQ '1'
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,24   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** FORMAT TAG FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVEL':88D:'   MTAG
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     ADD  42        WWLENG
     C                     MOVELBBCNA1    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C** SET UP DATA FIELD OF MULT OCCURENCE DATA STRUCUTURE
     C           BBCNA2    IFNE *BLANKS
     C                     ADD  42        WWLENG
     C                     MOVELBBCNA2    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C** SET UP DATA FIELD OF MULT OCCURENCE DATA STRUCUTURE
     C           BBCNA3    IFNE *BLANKS
     C                     ADD  42        WWLENG
     C                     MOVELBBCNA3    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C** SET UP DATA FIELD OF MULT OCCURENCE DATA STRUCUTURE
     C           BBCNA4    IFNE *BLANKS
     C                     ADD  42        WWLENG
     C                     MOVELBBCNA4    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  FLD57A    - FORMAT FIELD :57a:                              *
     C**                                                              *
     C**  CALLS     - ZM0050, *PSSR                                   *
     C**                                                              *
     C**  CALLED BY - RSEQ                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           FLD57A    BEGSR
      *                                                                                       CSW201
      ** Set field not to allow BEIs on field dedicated to financial                          CSW201
      ** Institution when enhancement "SWIFT 2001 Standards Update"                           CSW201
      ** is installed.                                                                        CSW201
      *                                                                                       CSW201
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C                     MOVE 'Y'       ZDBEI   1                                           CSW201
     C                     ENDIF                                                              CSW201
     C*
     C** WHEN THE USER WANT TO NOT GENERATE THIS FIELD
     C                     MOVELMGAWIL    WKAWI1  1
     C           WKAWI1    IFNE '#'
     C*
     C** SET FLAG TO INDICATE FIELD :57a: FORMATTED
     C                     MOVE 'Y'       WWFM57  1
     C*
     C** IF FIELD IS MANDATORY FOR THIS MESSAGE CHECK IF FIELD
     C** CAN BE FORMATTED
     C           WWFL18    IFEQ 'M'
     C           MGAWIN    ANDEQ*BLANKS
     C           MGAWIL    ANDEQ*BLANKS
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,25   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** PROCESSING IF FIELD IS NOT REQUIRED
     C           WWFL18    IFEQ 'N'
     C           MGAWIN    OREQ *BLANKS
     C           MGAWIL    ANDEQ*BLANKS
     C*
     C** SET FLAG TO INDICATE FIELD NOT FORMATTED
     C                     MOVE 'N'       WWFM57
     C                     ELSE
     C*
     C** INCREASE LENGTH
     C                     ADD  42        WWLENG
     C*
     C** FORMAT DESCRIPTION FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELDESA,16   MDES
     C*
     C** (1) - FORMAT DATA FIELD ENTERED FROM SCREEN
     C           MGAWIA    IFNE *BLANK
     C                     MOVE '57'      WWTAGN
     C                     MOVE MGAWIA    WWTAGI
     C                     MOVE WWTAG     MTAG
     C*
     C** IF MGAWIL IS BLANK
     C           MGAWIL    IFEQ *BLANK
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,52   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** IF MGAWIL IS NOT BLANK
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELMGAWIL    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C                     ELSE
     C*
     C** (2) FORMAT ADDRESS FIELDS FOR TAG 'A' OR 'D'
     C                     CALL 'ZM1150'               25
     C                     PARM MGAWIN    ZDEST
     C                     PARM *BLANKS   ZSADD1
     C                     PARM *BLANKS   ZSADD2
     C                     PARM *BLANKS   ZSADD3
     C                     PARM *BLANKS   ZSADD4
     C                     PARM *BLANKS   ZSTAG
     C                     PARM *BLANKS   ZSTYPE
     C                     PARM *BLANKS   ZERR
     C                     PARM *BLANKS   ZCRNM
     C                     PARM *BLANKS   ZCRTN
     C                     PARM           ZDBEI                                               CSW201
     C*
     C** IF PROGRAM NOT FOUND
     C           *IN25     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '033'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 033  *
     C                     MOVEL'ZM1150'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** IF ERROR DURING CALLED PROGRAM
     C           ZERR      IFEQ '1'
     C                     MOVELERRA,26   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** FORMAT TAG FIELD OF MULT OCCURENCE DATA STRUCTURE
     C*
     C** IF ZSTAG IS 'A'
     C                     MOVE *BLANKS   SAVMTG  5                       183583
     C           ZSTAG     IFEQ 'A'
     C                     MOVEL':57A:'   MTAG
     C                     MOVE MTAG      SAVMTG                          183583
     C                     ELSE
     C** IF ZSTAG IS 'D'
     C                     MOVEL':57D:'   MTAG
     C                     END
     C*
     C           MGAWIL    IFNE *BLANKS
     C*
     C** SET UP DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELMGAWIL    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C** SET UP DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     EXSR #ZA
     C*
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C*
     C                     MOVE *BLANK    ZDBEI                                               CSW201
      *                                                                                       CSW201
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  FLD58A    - FORMAT FIELD :58a:                              *
     C**                                                              *
     C**  CALLS     - ZM0050, *PSSR                                   *
     C**                                                              *
     C**  CALLED BY - RSEQ                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           FLD58A    BEGSR
     C*
     C** WHEN THE USER WANT TO NOT GENERATE THIS FIELD
     C                     MOVELMGBOF1    WKBOF1  1
     C           WKBOF1    IFNE '#'
     C*
     C** INITIALIZE ERROR FLAG
     C                     MOVE *BLANKS   WWER58  1
     C*
     C** IF FIELD IS MANDATORY FOR THIS MESSAGE AND
     C** BENEFICIARY OF MONEY IS BLANK
     C           WWFL19    IFEQ 'M'
     C           MGBOFN    ANDEQ*BLANKS
     C           MGBOF1    ANDEQ*BLANKS
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,27   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** PROCESSING IF FIELD IS NOT REQUIRED
     C           WWFL19    IFEQ 'N'
     C           MGBOFN    OREQ *BLANKS
     C           MGBOF1    ANDEQ*BLANKS
     C                     MOVE 'Y'       WWER58
     C                     END
     C*
     C** IF FIELD :57a: IS PRESENT THEN FIELD :58a: MUST BE PRESENT
     C           WWFM57    IFEQ 'Y'
     C           WWER58    ANDEQ'Y'
     C*
     C** FORMAT ERROR FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELERRA,28   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** WHEN FIELD :58a: IS PRESENT FIELD :57a: MUST ALSO BE PRESENT
     C           WWER58    IFEQ *BLANKS
     C*
     C           WWFM57    IFEQ 'N'
     C*
     C** FORMAT ERROR FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELERRA,29   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** INCREASE LENGTH
     C                     ADD  42        WWLENG
     C*
     C** FORMAT DESCRIPTION FIELD
     C                     MOVELDESA,17   MDES
     C*
     C** (1) - FORMAT DATA FIELD ENTERED FROM SCREEN
     C           MGBOFA    IFNE *BLANK
     C                     MOVE '58'      WWTAGN
     C                     MOVE MGBOFA    WWTAGI
     C                     MOVE WWTAG     MTAG
     C*
     C** IF MGBOF1 IS BLANK
     C           MGBOF1    IFEQ *BLANK
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,53   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** IF MGBOF1 IS NOT BLANK
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELMGBOF1    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C** IF MGBOF2 IS NOT BLANK
     C           MGBOF2    IFNE *BLANK
     C*
     C** INCREASE LENGTH
     C                     ADD  42        WWLENG
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELMGBOF2    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C                     ELSE
     C*
     C** (2) FORMAT TAG FIELD AS EXPECTED TO BE 'A' OR 'D'
     C           MGBOFN    IFNE *BLANKS
     C*
     C** FORMAT ADDRESS FIELDS
     C                     CALL 'ZM1150'               25
     C                     PARM MGBOFN    ZDEST
     C                     PARM *BLANKS   ZSADD1
     C                     PARM *BLANKS   ZSADD2
     C                     PARM *BLANKS   ZSADD3
     C                     PARM *BLANKS   ZSADD4
     C                     PARM *BLANKS   ZSTAG
     C                     PARM *BLANKS   ZSTYPE
     C                     PARM *BLANKS   ZERR
     C                     PARM *BLANKS   ZCRNM
     C                     PARM *BLANKS   ZCRTN
     C                     PARM *BLANK    ZDBEI                                               CSW201
     C*
     C** IF PROGRAM NOT FOUND
     C           *IN25     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '028'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 028  *
     C                     MOVEL'ZM1150'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** IF ERROR DURING CALLED PROGRAM
     C           ZERR      IFEQ '1'
     C                     MOVELERRA,30   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** FORMAT TAG FIELD OF MULT OCCURENCE DATA STRUCTURE
     C*
     C** IF ZSTAG IS 'A'
     C                     MOVE *BLANKS   SAVMTG                          183583
     C           ZSTAG     IFEQ 'A'
     C                     MOVEL':58A:'   MTAG
     C                     MOVE MTAG      SAVMTG                          183583
     C                     ELSE
     C** IF ZSTAG IS 'D'
     C                     MOVEL':58D:'   MTAG
     C                     END
     C*
     C           MGBOF1    IFNE *BLANKS
     C*
     C** SET UP DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELMGBOF1    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C           MGBOF2    IFNE *BLANKS
     C*
     C** SET UP DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELMGBOF2    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C** SET UP DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     EXSR #ZA
     C*
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  FLD33T    - FORMAT FIELD :33T:                              *
     C**                                                              *
     C**  CALLS     - ZM1190, *PSSR                                   *
     C**                                                              *
     C**  CALLED BY - RSEQ                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           FLD33T    BEGSR
     C*
     C** INITIALIZE ERROR FLAG
     C                     MOVE *BLANKS   WWER33  1
     C*
     C** SET FLAG TO INDICATE FIELD :33T: PRESENT IN THIS SEQUENCE
     C                     MOVE 'N'       WWF33T  1
     C*
     C** IF FIELD IS MANDATORY FOR THIS MESSAGE THEN
     C** CHECK IF THE FIELD CAN BE FORMATTED
     C           WWFL20    IFEQ 'M'
     C           MGPRIC    ANDEQ0
     C                     MOVE 'Y'       WWER33
     C                     END
     C*
     C           MGTTYP    IFEQ 'TR'
     C           MGTTYP    OREQ 'TS'                                      CSW003
     C           MGTTYP    OREQ 'DM'                                      CSW003
     C           MGTTYP    OREQ 'DN'                                      CSW003
     C*
     C           MGSTBS    IFNE 'Y'
     C           MGSTBS    ANDNE'P'
     C           MGSTBS    ANDNE'D'
     C                     MOVE 'Y'       WWER33
     C                     END
     C*
     C           MGSTBS    IFEQ 'P'
     C           MGSPBS    IFNE 'P'
     C           MGSPBS    ANDNE'U'
     C                     MOVE 'Y'       WWER33
     C                     END
     C                     END
     C*
     C                     END
     C*
     C           WWER33    IFEQ 'Y'
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,31   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** END OF FIELD :33T: PROCESSING IF FIELD IS
     C** NOT REQUIRED OR MGPRIC IS ZERO OR FIELD :31P: NOT PRESENT
     C           WWFL20    IFNE 'N'
     C           MGPRIC    ANDNE0
     C           WWF31P    ANDEQ'Y'
     C*
     C** INCREASE LENGTH
     C                     ADD  25        WWLENG
     C*
     C** FORMAT DESCRIPTION FIELD
     C                     MOVELDESA,18   MDES
     C*
     C** FORMAT TAG FIELD
     C                     MOVEL':33T:'   MTAG
     C*
     C** SET UP BASIS WORK FIELD
      *                                                                   102916
     C           MGSTBS    IFEQ 'Y'                                       102916
     C                     MOVEL'YLD'     WWSBAS                          102916
     C                     END                                            102916
     C***********MGSTBS    IFEQ 'Y'                                       102916
     C***********MGSTBS    OREQ 'D'                                       102916
     C           MGSTBS    IFEQ 'D'                                       102916
     C                     MOVE 'REN'     WWSBAS  3
     C                     END
     C*
     C           MGSTBS    IFEQ 'P'
     C***********MGTTYP    OREQ 'DM'                                      102766
     C***********MGTTYP    OREQ 'DN'                               CSW003 102766
     C*
     C           MGSPBS    IFEQ 'P'
     C***********MGTTYP    ANDEQ'TR'                                      102766
     C***********MGSPBS    OREQ 'P'                                CSW003 102766
     C***********MGTTYP    ANDEQ'TS'                               CSW003 102766
     C                     MOVE 'PCT'     WWSBAS
     C                     ELSE
     C*
     C** MGSPBS IS 'U' OR DEPOT MOVEMENT -
     C** ACCESS SDCURRL1 TO OBTAIN SWIFT CURRENCY CODE
     C           MGNMCY    CHAINSDCURRL1             14
     C*
     C** IF CURRENCY NOT FOUND ON FILE
     C           *IN14     IFEQ '1'
     C*
     C** FORMAT ERROR FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELERRA,32   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C                     MOVE MGNMCY    A6SWCY
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     GOTO END33T
     C                     END
     C*
     C** SET BASIS WORK FIELD TO SWIFT CURRENCY CODE, SDCURRL1
     C                     MOVE A6SWCY    WWSBAS
     C                     END
     C*
     C                     END
     C*                                                                   068695
     C** Check security price don't contain too many decs FOR EUROCLEAR   068695
     C           MGDEST    IFNE WWCEDN                                    068695
     C           WWSENT    ANDNE'CEDEL'                                   068695
     C                     Z-ADD0         CHECK  156                      068695
     C                     Z-ADD0         CHECK1 158                      068695
     C                     Z-ADD0         RESUL  158                      068695
     C                     Z-ADDMGPRIC    CHECK1                          068695
     C                     Z-ADDMGPRIC    CHECK                           068695
     C           CHECK1    SUB  CHECK     RESUL                           068695
     C           RESUL     IFGT 0                                         068695
     C*                                                                   068695
     C** FORMAT ERROR FIELD OF MULT OCCURENCE DATA STRUCTURE              068695
     C                     MOVELERRA,54   MERR                            068695
     C                     MOVE 'Y'       @ERR                            068695
     C                     MOVE 'Y'       WWNGEN                          068695
     C*                                                                   068695
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE                    068695
     C                     ADD  1         X                               068695
     C           X         OCUR MULT                                      068695
     C                     GOTO END33T                                    068695
     C                     END                                            068695
     C                     END                                            068695
     C*
     C** CONVERT SECURITY PRICE TO SWIFT FORMAT
     C                     CALL 'ZM1190'               28
     C                     PARM MGPRIC    ZPRIC  158
     C                     PARM *BLANKS   ZSPRIC 16
     C                     PARM *BLANKS   ZOPRIC 21
     C*
     C** IF PROGRAM NOT FOUND
     C           *IN28     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '022'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 022  *
     C                     MOVEL'ZM1190'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** SET FLAG TO INDICATE FIELD :33T: PRESENT IN THIS SEQUENCE
     C                     MOVE 'Y'       WWF33T
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVE *BLANKS   WWMDAT
     C                     MOVELWWSBAS    WD0103
     C                     MOVELZSPRIC    WD0419
     C                     MOVELWWMDAT    MDAT
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE FOR REPORT
     C                     MOVE *BLANKS   WWRDAT
     C                     MOVELWWSBAS    WR0103
     C                     MOVELZOPRIC    WR0424
     C                     MOVELWWRDAT    RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C                     END
     C*
     C           END33T    TAG
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  FLD32M    - FORMAT FIELD :32M:                              *
     C**                                                              *
     C**  CALLS     - ZM1240, *PSSR                                   *
     C**                                                              *
     C**  CALLED BY - RSEQ                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           FLD32M    BEGSR
     C*
     C** IF FIELD IS MANDATORY FOR THIS MESSAGE AND
     C** DEAL AMOUNT IS ZERO
     C           WWFL21    IFEQ 'M'
     C           MGDLAM    ANDEQ0
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,33   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** END OF FIELD :32M: PROCESSING IF FIELD IS NOT REQUIRED
     C** OR MGDLAM IS ZERO OR FIELD :31P: NOT PRESENT
     C           WWFL21    IFNE 'N'
     C           MGDLAM    ANDNE0
     C           WWF31P    ANDEQ'Y'
     C*
     C** INCREASE LENGTH
     C                     ADD  25        WWLENG
     C*
     C** FORMAT DESCRIPTION FIELD
     C                     MOVELDESA,19   MDES
     C*
     C** FORMAT TAG FIELD
     C                     MOVEL':32M:'   MTAG
     C*
     C** CONVERT MIDAS AMOUNT TO SWIFT FORMAT
     C                     Z-ADDMGDLAM    ZAMT   130
     C                     CALL 'ZM1240'               29
     C                     PARM           ZAMT
     C                     PARM MGNMCY    ZCCY    3
     C                     PARM *BLANKS   ZSAMNT 17
     C                     PARM *BLANKS   ZOAMNT 21
     C                     PARM *BLANKS   ZSCCY   3
     C                     PARM *BLANKS   ZERR
     C*
     C** IF PROGRAM NOT FOUND
     C           *IN29     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '023'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 023  *
     C                     MOVEL'ZM1240'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** IF ERROR DURING PROGRAM ZM1240
     C           ZERR      IFEQ '1'
     C                     MOVELERRA,33   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVEL*BLANKS   WWMDAT
     C                     MOVELZSCCY     WD0103
     C                     MOVELZSAMNT    WD0419
     C                     MOVELWWMDAT    MDAT
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE FOR REPORT
     C                     MOVEL*BLANKS   WWRDAT
     C                     MOVELZSCCY     WR0103
     C                     MOVELZOAMNT    WR0424
     C                     MOVELWWRDAT    RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C                     END
     C*
     C                     END
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  FLD37J    - FORMAT FIELD :37J:                              *
     C**                                                              *
     C**  CALLS     - ZM1190, *PSSR                                   *
     C**                                                              *
     C**  CALLED BY - RSEQ                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           FLD37J    BEGSR
     C*
     C** IF FIELD IS MANDATORY FOR THIS MESSAGE AND
     C** MGDAXR IS ZERO
     C           WWFL22    IFEQ 'M'
     C           MGDAXR    ANDEQ0
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,34   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** END OF FIELD :37J: PROCESSING IF FIELD IS NOT REQUIRED
     C** AND THE FOLLOWING CONDITIONS ARE NOT SATISFIED
     C           WWFL22    IFNE 'N'
     C           MGDAXR    ANDNE0
     C           MGNMCY    ANDNEMGSTCY
     C           WWF31P    ANDEQ'Y'
     C*
     C** INCREASE LENGTH
     C                     ADD  19        WWLENG
     C*
     C** FORMAT DESCRIPTION FIELD
     C                     MOVELDESA,20   MDES
     C*
     C** FORMAT TAG FIELD
     C                     MOVEL':37J:'   MTAG
     C*
     C** CONVERT EXCHANGE RATE TO SWIFT FORMAT
     C                     CALL 'ZM1190'               28
     C                     PARM MGDAXR    ZPRIC
     C                     PARM *BLANKS   ZSPRIC
     C                     PARM *BLANKS   ZOPRIC 21
     C*
     C** IF PROGRAM NOT FOUND
     C           *IN28     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '027'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 027  *
     C                     MOVEL'ZM1190'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELZSPRIC    MDAT
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE FOR REPORT
     C                     MOVELZOPRIC    RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C                     END
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  FLD34A    - FORMAT FIELD :34a:                              *
     C**                                                              *
     C**  CALLS     - ZM1240, *PSSR                                   *
     C**                                                              *
     C**  CALLED BY - RSEQ                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           FLD34A    BEGSR
     C*
     C** SET FLAG TO INDICATE THAT FIELD :34a: IS PRESENT
     C                     MOVE 'Y'       WWFM34  1
     C*
     C** IF FIELD IS MANDATORY FOR THIS MESSAGE AND (INTEREST AMOUNT
     C** IS ZERO OR ACCRUED INTEREST CURRENCY IS BLANK)
     C           WWFL23    IFEQ 'M'
     C           MGITRA    IFEQ 0
     C           MGITCY    OREQ *BLANKS
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,35   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C                     ELSE
     C*
     C** END OF FIELD :34a: PROCESSING IF FIELD IS NOT REQUIRED
     C** AND THE FOLLOWING CONDITIONS ARE NOT SATISFIED
     C           WWFL23    IFNE 'N'
     C           MGITRA    ANDNE0
     C           MGITCY    ANDNE*BLANKS
     C           WWF31P    ANDEQ'Y'
     C*
     C** INCREASE LENGTH
     C                     ADD  30        WWLENG
     C*
     C** FORMAT DESCRIPTION FIELD
     C                     MOVELDESA,21   MDES
     C*
     C** FORMAT TAG FIELD
     C           MGACIN    IFEQ 'C'
     C           MGACIN    OREQ *BLANKS
     C                     MOVEL':34G:'   MTAG
     C                     ELSE
     C** ELSE MGACIN = 'X'
     C                     MOVEL':34H:'   MTAG
     C                     END
     C*
     C** CONVERT MIDAS AMOUNT TO SWIFT FORMAT
     C                     Z-ADDMGITRA    ZAMT
     C*
     C                     CALL 'ZM1240'               29
     C                     PARM           ZAMT
     C                     PARM MGITCY    ZCCY
     C                     PARM *BLANKS   ZSAMNT
     C                     PARM *BLANKS   ZOAMNT
     C                     PARM *BLANKS   ZSCCY
     C                     PARM *BLANKS   ZERR
     C*
     C** IF PROGRAM NOT FOUND
     C           *IN29     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '026'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 026  *
     C                     MOVEL'ZM1240'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** IF ERROR DURING PROGRAM ZM1240
     C           ZERR      IFEQ '1'
     C                     MOVELERRA,35   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C           MGACND    IFNE 0
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELMGACND    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVE *BLANKS   WWMDAT
     C                     MOVELZSCCY     WD0103
     C                     MOVELZSAMNT    WD0419
     C                     MOVELWWMDAT    MDAT
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE FOR REPORT
     C                     MOVE *BLANKS   WWRDAT
     C                     MOVELZSCCY     WR0103
     C                     MOVELZOAMNT    WR0424
     C                     MOVELWWRDAT    RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C                     ELSE
     C*
     C** SET FLAG TO INDICATE FIELD IS NOT PRESENT
     C                     MOVE 'N'       WWFM34
     C                     END
     C*
     C                     END
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  FLD37L    - FORMAT FIELD :37L:                              *
     C**                                                              *
     C**  CALLS     - ZM1190, *PSSR                                   *
     C**                                                              *
     C**  CALLED BY - RSEQ                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           FLD37L    BEGSR
     C*
     C** IF FIELD IS MANDATORY FOR THIS MESSAGE AND
     C** MGITXR IS ZERO
     C           WWFL24    IFEQ 'M'
     C           MGITXR    ANDEQ0
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,36   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** END OF FIELD :37L: PROCESSING IF FIELD IS NOT REQUIRED
     C** AND THE FOLLOWING CONDITIONS ARE NOT SATISFIED
     C           WWFL24    IFNE 'N'
     C           MGITXR    ANDNE0
     C           MGITCY    ANDNEMGSTCY
     C           WWFM34    ANDEQ'Y'
     C           WWF31P    ANDEQ'Y'
     C*
     C** INCREASE LENGTH
     C                     ADD  19        WWLENG
     C*
     C** FORMAT DESCRIPTION FIELD
     C                     MOVELDESA,22   MDES
     C*
     C** FORMAT TAG FIELD
     C                     MOVEL':37L:'   MTAG
     C*
     C** CONVERT EXCHANGE RATE TO SWIFT FORMAT
     C                     CALL 'ZM1190'               28
     C                     PARM MGITXR    ZPRIC
     C                     PARM *BLANKS   ZSPRIC
     C                     PARM *BLANKS   ZOPRIC
     C*
     C** IF PROGRAM NOT FOUND
     C           *IN28     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '025'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 025  *
     C                     MOVEL'ZM1190'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELZSPRIC    MDAT
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE FOR REPORT
     C                     MOVELZOPRIC    RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C                     END
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  FLD37S    - FORMAT FIELD :37S:                              *
     C**                                                              *
     C**  CALLS     - ZM1190, *PSSR                                   *
     C**                                                              *
     C**  CALLED BY - RSEQ                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           FLD37S    BEGSR
     C*
     C** IF FIELD IS MANDATORY FOR THIS MESSAGE AND
     C** ACCRUED INTEREST RATE IS ZERO
     C           WWFL25    IFEQ 'M'
     C           MGITRT    ANDEQ0
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,37   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** END OF FIELD :37S: PROCESSING IF FIELD IS NOT REQUIRED
     C** AND THE FOLLOWING CONDITIONS ARE NOT SATISFIED
     C           WWFL25    IFNE 'N'
     C           MGITRT    ANDNE0
     C           MGACND    ANDNE0
     C           WWFM34    ANDEQ'Y'
     C           WWF31P    ANDEQ'Y'
     C*
     C** INCREASE LENGTH
     C                     ADD  24        WWLENG
     C*
     C** FORMAT DESCRIPTION FIELD
     C                     MOVELDESA,23   MDES
     C*
     C** FORMAT TAG FIELD
     C                     MOVEL':37S:'   MTAG
     C*
     C** CONVERT EXCHANGE RATE TO SWIFT FORMAT
     C                     CALL 'ZM1190'               28
     C                     PARM MGITRT    ZPRIC
     C                     PARM *BLANKS   ZSPRIC
     C                     PARM *BLANKS   ZOPRIC
     C*
     C** IF PROGRAM NOT FOUND
     C           *IN28     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '024'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 024  *
     C                     MOVEL'ZM1190'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C** ZSPRIC WITH '/' ADDED TO FIRST NON BLANK CHARACTER
     C** FOLLOWED BY MGITCB
     C                     MOVELZSPRIC    WWPRIC 17
     C                     MOVELZOPRIC    WOPRIC 22
     C           MGITCB    IFNE *BLANKS
     C           WWPRIC    CAT  '/':0     WWPRIC
     C           WOPRIC    CAT  '/':0     WOPRIC
     C           WWPRIC    CAT  MGITCB:0  WWPRIC
     C           WOPRIC    CAT  MGITCB:0  WOPRIC
     C                     END
     C*
     C                     MOVELWWPRIC    MDAT
     C                     MOVELWOPRIC    RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C                     END
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  FLD33S    - FORMAT FIELD :33S:                              *
     C**                                                              *
     C**  CALLS     - ZM1240, *PSSR                                   *
     C**                                                              *
     C**  CALLED BY - RSEQ                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           FLD33S    BEGSR
     C*
     C** SET FLAG TO INDICATE FIELD :33S: IS PRESENT
     C                     MOVE 'Y'       WWFM33  1
     C*
     C** INITIALIZE ERROR FLAG
     C                     MOVE *BLANKS   WWER33
     C*
     C** IF FIELD IS MANDATORY FOR THIS MESSAGE AND (SPECIAL
     C** CONCESSIONS AMOUNT IS ZERO OR CURRENCY IS BLANK)
     C           MGSCAM    IFEQ 0
     C           MGSCCY    OREQ *BLANKS
     C                     MOVE 'Y'       WWER33
     C                     END
     C*
     C           WWFL26    IFEQ 'M'
     C           WWER33    ANDEQ'Y'
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,38   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** END OF FIELD :33S: PROCESSING IF FIELD IS NOT REQUIRED
     C** AND THE FOLLOWING CONDITIONS ARE SATISFIED
     C           WWFL26    IFEQ 'N'
     C           MGSCAM    OREQ 0
     C           MGSCCY    OREQ *BLANKS
     C           WWF31P    OREQ 'N'
     C*
     C** SET FLAG TO INDICATE FIELD :33S: NOT PRESENT
     C                     MOVE 'N'       WWFM33
     C                     ELSE
     C*
     C** INCREASE LENGTH
     C                     ADD  25        WWLENG
     C*
     C** FORMAT DESCRIPTION FIELD
     C                     MOVELDESA,24   MDES
     C*
     C** FORMAT TAG FIELD
     C                     MOVEL':33S:'   MTAG
     C*
     C** CONVERT MIDAS AMOUNT TO SWIFT FORMAT
     C                     Z-ADDMGSCAM    ZAMT
     C*
     C                     CALL 'ZM1240'               29
     C                     PARM           ZAMT
     C                     PARM MGSCCY    ZCCY
     C                     PARM *BLANKS   ZSAMNT
     C                     PARM *BLANKS   ZOAMNT
     C                     PARM *BLANKS   ZSCCY
     C                     PARM *BLANKS   ZERR
     C*
     C** IF PROGRAM NOT FOUND
     C           *IN29     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '013'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 013  *
     C                     MOVEL'ZM1240'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** IF ERROR DURING PROGRAM ZM1240
     C           ZERR      IFEQ '1'
     C                     MOVELERRA,38   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     ELSE
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVEL*BLANKS   WWMDAT
     C                     MOVELZSCCY     WD0103
     C                     MOVELZSAMNT    WD0420
     C                     MOVELWWMDAT    MDAT
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE FOR REPORT
     C                     MOVEL*BLANKS   WWRDAT
     C                     MOVELZSCCY     WR0103
     C                     MOVELZOAMNT    WR0424
     C                     MOVELWWRDAT    RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C                     END
     C*
     C                     END
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  FLD37P    - FORMAT FIELD :37P:                              *
     C**                                                              *
     C**  CALLS     - ZM1190, *PSSR                                   *
     C**                                                              *
     C**  CALLED BY - RSEQ                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           FLD37P    BEGSR
     C*
     C** IF FIELD IS MANDATORY FOR THIS MESSAGE AND
     C** EXCHANGE RATE IS ZERO
     C           WWFL27    IFEQ 'M'
     C           MGSCXR    ANDEQ0
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,39   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** END OF FIELD :37P: PROCESSING IF FIELD IS NOT REQUIRED
     C** AND THE FOLLOWING CONDITIONS ARE NOT SATISFIED
     C           WWFL27    IFNE 'N'
     C           MGSCXR    ANDNE0
     C           MGSCCY    ANDNEMGSTCY
     C           WWFM33    ANDEQ'Y'
     C           WWF31P    ANDEQ'Y'
     C*
     C** INCREASE LENGTH
     C                     ADD  19        WWLENG
     C*
     C** FORMAT DESCRIPTION FIELD
     C                     MOVELDESA,25   MDES
     C*
     C** FORMAT TAG FIELD
     C                     MOVEL':37P:'   MTAG
     C*
     C** CONVERT SECURITY PRICE TO SWIFT FORMAT
     C                     CALL 'ZM1190'               28
     C                     PARM MGSCXR    ZPRIC
     C                     PARM *BLANKS   ZSPRIC
     C                     PARM *BLANKS   ZOPRIC
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELZSPRIC    MDAT
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE FOR REPORT
     C                     MOVELZOPRIC    RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C                     END
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  FLD32B    - FORMAT FIELD :32B:                              *
     C**                                                              *
     C**  CALLS     - ZM1240, *PSSR                                   *
     C**                                                              *
     C**  CALLED BY - RSEQ                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           FLD32B    BEGSR
     C*
     C** INITIALIZE ERROR FIELD
     C                     MOVE *BLANKS   WWER32  1
     C*
     C** IF FIELD IS MANDATORY FOR THIS MESSAGE AND
     C** (SETTLEMENT AMOUNT IS ZERO OR CURRENCY IS BLANK)
     C           MGSTAM    IFEQ 0
     C           MGSTCY    OREQ *BLANKS
     C                     MOVE 'Y'       WWER32
     C                     END
     C*
     C           WWFL28    IFEQ 'M'
     C           WWER32    ANDEQ'Y'
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,40   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** END OF FIELD :32B: PROCESSING IF FIELD IS NOT REQUIRED
     C** AND THE FOLLOWING CONDITIONS ARE NOT SATISFIED
     C           WWFL28    IFNE 'N'
     C           MGSTAM    ANDNE0
     C           MGSTCY    ANDNE*BLANKS
     C*
     C** INCREASE LENGTH
     C                     ADD  25        WWLENG
     C*
     C** FORMAT DESCRIPTION FIELD
     C                     MOVELDESA,26   MDES
     C*
     C** FORMAT TAG FIELD
     C                     MOVEL':32B:'   MTAG
     C*
     C** CONVERT MIDAS AMOUNT TO SWIFT FORMAT
     C                     Z-ADDMGSTAM    ZAMT
     C                     CALL 'ZM1240'               29
     C                     PARM           ZAMT
     C                     PARM MGSTCY    ZCCY
     C                     PARM *BLANKS   ZSAMNT
     C                     PARM *BLANKS   ZOAMNT
     C                     PARM *BLANKS   ZSCCY
     C                     PARM *BLANKS   ZERR
     C*
     C** IF PROGRAM NOT FOUND
     C           *IN29     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '012'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 012  *
     C                     MOVEL'ZM1240'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** IF ERROR DURING PROGRAM ZM1240
     C           ZERR      IFEQ '1'
     C                     MOVELERRA,40   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVEL*BLANKS   WWMDAT
     C                     MOVELZSCCY     WD0103
     C                     MOVELZSAMNT    WD0419
     C                     MOVELWWMDAT    MDAT
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE FOR REPORT
     C                     MOVEL*BLANKS   WWRDAT
     C                     MOVELZSCCY     WR0103
     C                     MOVELZOAMNT    WR0424
     C                     MOVELWWRDAT    RDAT
     C*
     C** STORE ZSAMNT IN WORK FIELD FOR SWIFT MESSAGE FILES
     C                     MOVELZSAMNT    WWSAMT 17
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C                     END
     C*
     C                     END
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  FLD26L    - FORMAT FIELD :26L:                              *
     C**                                                              *
     C**  CALLS     - NONE                                            *
     C**                                                              *
     C**  CALLED BY - RSEQ                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           FLD26L    BEGSR
     C*
     C** THIS FIELD IS NEVER MANDATORY - IF IT IS NOT PRESENT, A
     C** DEFAULT VALUE OF '0' WILL BE APPLIED BY THE RECEIVER
     C*
     C** END OF FIELD :26L: PROCESSING IF FIELD IS NOT REQUIRED
     C** OR MGFCOD IS BLANK
     C           WWFL29    IFNE 'N'
     C           MGFCOD    ANDNE*BLANKS
     C*
     C** INCREASE LENGTH
     C                     ADD  8         WWLENG
     C*
     C** FORMAT DESCRIPTION FIELD
     C                     MOVELDESA,27   MDES
     C*
     C** FORMAT TAG FIELD
     C                     MOVEL':26L:'   MTAG
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELMGFCOD    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  FLD26K    - FORMAT FIELD :26K:                              *
     C**                                                              *
     C**  CALLS     - ZM1060                                          *
     C**                                                              *
     C**  CALLED BY - RSEQ                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           FLD26K    BEGSR
     C*
     C** INITIALIZE ERROR FIELD
     C                     MOVE *BLANKS   WWER26  1
     C*
     C** IF FIELD IS MANDATORY FOR THIS MESSAGE CHECK IF FIELD
     C** :26K: CAN BE FORMATTED
     C           WWFL30    IFEQ 'M'
     C           MGCRTN    ANDEQ'N'
     C                     MOVE 'Y'       WWER26
     C                     END
     C*
     C           MGCRTN    IFEQ 'Y'
     C           WWM579    ANDEQ'N'
     C*
     C           MGFCOD    IFNE '0'
     C           MGFCOD    ANDNE'3'
     C                     MOVE 'Y'       WWER26
     C                     END
     C*
     C                     END
     C*
     C           WWER26    IFEQ 'Y'
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,41   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** END OF FIELD :26K: PROCESSING IF FIELD IS
     C** NOT REQUIRED AND THE FOLLOWING CONDITIONS ARE SATISFIED
     C           WWFL30    IFEQ 'N'
     C           MGCRTN    OREQ 'N'
     C                     MOVE 'Y'       WWER26
     C                     END
     C*
     C           MGFCOD    IFNE '0'
     C           MGFCOD    ANDNE'3'
     C                     MOVE 'Y'       WWER26
     C                     END
     C*
     C           WWER26    IFNE 'Y'
     C*
     C** INCREASE LENGTH
     C                     ADD  42        WWLENG
     C*
     C** FORMAT DESCRIPTION FIELD
     C                     MOVELDESA,28   MDES
     C*
     C** FORMAT TAG FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVEL':26K:'   MTAG
     C*
     C** FORMAT CERTIFICATE NUMBERS
     C                     CALL 'ZM1060'               19
     C                     PARM WWFSIX    WWTDRF  6
     C                     PARM 0         WWSEQN  40
     C                     PARM *BLANKS   WWCRT1 35
     C                     PARM *BLANKS   WWCRT2 35
     C                     PARM *BLANKS   WWCRT3 35
     C                     PARM *BLANKS   WWCRT4 35
     C                     PARM *BLANKS   WWCRT5 35
     C                     PARM *BLANKS   WWCRT6 35
     C                     PARM *BLANKS   WWFIN   1
     C                     PARM *BLANKS   WWERR   1
     C*
     C** IF PROGRAM ZM1060 NOT FOUND
     C           *IN19     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '016'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            * DBERROR 016 *
     C                     MOVEL'ZM1060'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** FORMAT ERROR FIELD OF MULT OCCUR. DATA STRUCTURE
     C           WWERR     IFEQ '1'
     C                     MOVELERRA,42   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C                     END
     C*
     C** FORMAT ERROR FIELD OF MULT OCCUR. DATA STRUCTURE
     C           WWFIN     IFEQ 'N'
     C                     MOVELERRA,43   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C                     END
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELWWCRT1    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C           WWCRT2    IFNE *BLANKS
     C*
     C** INCREASE LENGTH
     C                     ADD  42        WWLENG
     C*
     C** SET UP DATA FIELD OF MULT OCCURENCE DATA STRUCUTURE
     C                     MOVELWWCRT2    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C           WWCRT3    IFNE *BLANKS
     C*
     C** INCREASE LENGTH
     C                     ADD  42        WWLENG
     C*
     C** SET UP DATA FIELD OF MULT OCCURENCE DATA STRUCUTURE
     C                     MOVELWWCRT3    MDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C           WWCRT4    IFNE *BLANKS
     C*
     C** INCREASE LENGTH
     C                     ADD  42        WWLENG
     C*
     C** SET UP DATA FIELD OF MULT OCCURENCE DATA STRUCUTURE
     C                     MOVELWWCRT4    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C           WWCRT5    IFNE *BLANKS
     C*
     C** INCREASE LENGTH
     C                     ADD  42        WWLENG
     C*
     C** SET UP DATA FIELD OF MULT OCCURENCE DATA STRUCUTURE
     C                     MOVELWWCRT5    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C           WWCRT6    IFNE *BLANKS
     C*
     C** INCREASE LENGTH
     C                     ADD  42        WWLENG
     C*
     C** SET UP DATA FIELD OF MULT OCCURENCE DATA STRUCUTURE
     C                     MOVELWWCRT6    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C                     END
     C*
     C                     END
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  FLD77B    - FORMAT FIELD :77B:                              *
     C**                                                              *
     C**  CALLS     - NONE                                            *
     C**                                                              *
     C**  CALLED BY - RSEQ                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           FLD77B    BEGSR
     C*
     C** IF FIELD IS MANDATORY FOR THIS MESSAGE AND
     C** FURTHER INFORMATION FIELD IS BALNK
     C           WWFL31    IFEQ 'M'
     C           MGFIN1    ANDEQ*BLANKS
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,44   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** END OF FIELD :77B: PROCESSING IF FIELD IS NOT REQUIRED
     C** OR MGFIN1 IS BLANK
     C           WWFL31    IFNE 'N'
     C           MGFIN1    ANDNE*BLANKS
     C*
     C** INCREASE LENGTH
     C                     ADD  42        WWLENG
     C*
     C** FORMAT DESCRIPTION FIELD
     C                     MOVELDESA,29   MDES
     C*
     C** FORMAT TAG FIELD
     C                     MOVEL':77B:'   MTAG
     C*
     C** FORMAT DATA FIELD
     C                     MOVELMGFIN1    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C** IF MGFIN2 IS NOT BLANKS
     C           MGFIN2    IFNE *BLANKS
     C*
     C** INCREASE LENGTH
     C                     ADD  42        WWLENG
     C*
     C** FORMAT DATA FIELD
     C                     MOVELMGFIN2    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C                     END
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  FLD77D    - FORMAT FIELD :77D:                              *
     C**                                                              *
     C**  CALLS     - NONE                                            *
     C**                                                              *
     C**  CALLED BY - RSEQ                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           FLD77D    BEGSR
     C*
     C** IF FIELD IS MANDATORY FOR THIS MESSAGE AND
     C** FURTHER INFORMATION FIELD IS BLANK
     C           WWFL34    IFEQ 'M'
     C           MGRED1    ANDEQ*BLANKS
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,49   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** END OF FIELD :77D: PROCESSING IF FIELD IS NOT REQUIRED
     C** OR MGNAL1 IS BLANK
     C           WWFL31    IFNE 'N'
     C           MGRED1    ANDNE*BLANKS
     C*
     C** INCREASE LENGTH
     C                     ADD  42        WWLENG
     C*
     C** FORMAT DESCRIPTION FIELD
     C                     MOVELDESA,32   MDES
     C*
     C** FORMAT TAG FIELD
     C                     MOVEL':77D:'   MTAG
     C*
     C** FORMAT DATA FIELD
     C                     MOVELMGRED1    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C** IF MGRED2 IS NOT BLANKS
     C           MGRED2    IFNE *BLANKS
     C*
     C** INCREASE LENGTH
     C                     ADD  42        WWLENG
     C*
     C** FORMAT DATA FIELD
     C                     MOVELMGRED2    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C                     END
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  FLD72     - FORMAT FIELD :72:                               *
     C**                                                              *
     C**  CALLS     - NONE                                            *
     C**                                                              *
     C**  CALLED BY - RSEQ                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           FLD72     BEGSR
     C*
     C** INITIALIZE ERROR INDICATOR & WORK FIELDS
     C                     MOVE *BLANKS   WWER72  1
     C                     MOVE *BLANKS   WWMDAT
     C*
     C** IF CANCELLATION OF A MESSAGE WITH DESTINATION CEDEL
     C           MGSRL1    IFEQ '/CANCEL/'
     C                     MOVELMGSRL1    MDAT
     C                     MOVELMDAT      RDAT
     C                     MOVE 'N'       WWER72
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** IF FIELD IS MANDATORY FOR THIS MESSAGE CHECK
     C** IF FIELD :72: CAN BE FORMATTED
     C           WWFL32    IFEQ 'M'
     C           MGSRL1    ANDEQ*BLANKS
     C           MGSTBS    ANDNE'P'
     C           MGSTBS    ANDNE'D'
     C           WWM579    ANDEQ'N'
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,45   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** END OF FIELD :72: PROCESSING IF FIELD IS NOT REQUIRED
     C** AND THE FOLLOWING CONDITIONS ARE SATISFIED
     C           WWFL32    IFEQ 'N'
     C                     MOVE 'Y'       WWER72
     C                     END
     C*
     C           WWER72    IFNE 'Y'
     C*
     C** INCREASE LENGTH
     C                     ADD  42        WWLENG
     C*
     C** FORMAT DESCRIPTION FIELD
     C                     MOVELDESA,30   MDES
     C*
     C** FORMAT TAG FIELD
     C***********          MOVEL':72:'    MTAG                            057263
     C                     MOVEL':72: '   MTAG                            057263
     C*
     C           MGCRTN    IFEQ 'Y'
     C*
     C** FORMAT DATA FIELD
     C                     MOVEL'/MSG579/'MDAT
     C                     MOVELMDAT      RDAT
     C                     MOVE 'N'       WWER72
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C           MGDEST    IFEQ WWCEDN
     C           WWSENT    OREQ 'CEDEL'
     C*
     C           WWF33T    IFEQ 'Y'
     C*
     C           MGSTBS    IFEQ 'P'
     C           MGPRIC    ANDGT100
     C*
     C** FORMAT DATA FIELD
     C                     MOVE *BLANKS   WWMDAT
     C                     MOVEL'/PREMI'  WD0106
     C                     MOVEL'UM/'     WD0709
     C                     MOVELWWMDAT    MDAT
     C                     MOVELMDAT      RDAT
     C                     MOVE 'N'       WWER72
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C           MGSTBS    IFEQ 'D'
     C           MGSTBS    OREQ 'P'
     C           MGPRIC    ANDLE100
     C*
     C** FORMAT DATA FIELD
     C                     MOVE *BLANKS   WWMDAT
     C                     MOVEL'/DISCO'  WD0106
     C                     MOVEL'UNT/'    WD0710
     C                     MOVELWWMDAT    MDAT
     C                     MOVELMDAT      RDAT
     C                     MOVE 'N'       WWER72
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C                     END
     C                     END
     C*
     C** FORMAT DATA FIELD
     C           MGSRL1    IFNE *BLANKS
     C                     MOVELMGSRL1    MDAT
     C                     MOVELMDAT      RDAT
     C                     MOVE 'N'       WWER72
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C** IF MGSRL2 IS NOT BLANK
     C           MGSRL2    IFNE *BLANKS
     C*
     C** INCREASE LENGTH
     C                     ADD  42        WWLENG
     C*
     C** FORMAT DATA FIELD
     C                     MOVELMGSRL2    MDAT
     C                     MOVELMDAT      RDAT
     C                     MOVE 'N'       WWER72
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C** IF MGSRL3 IS NOT BLANK
     C           MGSRL3    IFNE *BLANKS
     C*
     C** INCREASE LENGTH
     C                     ADD  42        WWLENG
     C*
     C** FORMAT DATA FIELD
     C                     MOVELMGSRL3    MDAT
     C                     MOVELMDAT      RDAT
     C                     MOVE 'N'       WWER72
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C           WWER72    IFNE 'N'
     C                     MOVE *BLANKS   MTAG
     C                     MOVE *BLANKS   MDES
     C                     END
     C*
     C                     END
     C                     END
     C                     END
     C*                                                                   CEU005
     C** If CEU005 is on and MGOTRA is non zero then amend                CEU005
     C** the FIELD 72 on the MT0580.                                      CEU005
     C*                                                                   CEU005
     C           CEU005    IFEQ 'Y'                                       CEU005
     C           MGOTRA    ANDNE0                                         CEU005
     C*                                                                   CEU005
     C** Format description field of MULT occurence data structure        CEU005
     C                     MOVELDESA,30   MDES                            CEU005
     C*                                                                   CEU005
     C*  Format TAG field of MULT occurence data structure                CEU005
     C                     MOVEL':72: '   MTAG                            CEU005
     C*                                                                   CEU005
     C                     MOVEL'/OCMT/'  OCMT                            CEU005
     C                     MOVELMGOTRC    OTRC                            CEU005
     C*                                                                   CEU005
     C** Call ZM1240 to convert amount into SWIFT format.                 CEU005
     C                     Z-ADDMGOTRA    ZAMT                            CEU005
     C                     MOVE MGOTRC    ZCCY                            CEU005
     C                     MOVE *BLANKS   ZSAMNT                          CEU005
     C                     MOVE *BLANKS   ZOAMNT                          CEU005
     C                     MOVE *BLANKS   ZSCCY                           CEU005
     C                     MOVE *BLANKS   ZERR                            CEU005
     C*                                                                   CEU005
     C                     CALL 'ZM1240'               28                 CEU005
     C                     PARM           ZAMT                            CEU005
     C                     PARM           ZCCY                            CEU005
     C                     PARM           ZSAMNT                          CEU005
     C                     PARM           ZOAMNT                          CEU005
     C                     PARM           ZSCCY                           CEU005
     C                     PARM           ZERR                            CEU005
     C*                                                                   CEU005
     C** IF PROGRAM NOT FOUND                                             CEU005
     C           *IN28     IFEQ '1'                                       CEU005
     C           *LOCK     IN   LDA                                       CEU005
     C                     MOVE '080'     DBASE            * * * * * * * *CEU005
     C                     MOVE *BLANKS   DBKEY            *  DBERR 080  *CEU005
     C                     MOVEL'ZM1240'  DBPGM            * * * * * * * *CEU005
     C                     OUT  LDA                                       CEU005
     C                     EXSR *PSSR                                     CEU005
     C                     END                                            CEU005
     C*                                                                   CEU005
     C** If ERROR during program ZM1240                                   CEU005
     C           ZERR      IFEQ '1'                                       CEU005
     C           *LOCK     IN   LDA                                       CEU005
     C                     MOVE '081'     DBASE            * * * * * * * *CEU005
     C                     MOVELDBERR2    DBKEY            *  DBERR 081  *CEU005
     C                     MOVEL'ZM1240'  DBPGM            * * * * * * * *CEU005
     C                     OUT  LDA                                       CEU005
     C                     EXSR *PSSR                                     CEU005
     C                     END                                            CEU005
     C*                                                                   CEU005
     C                     MOVELZSAMNT    OTRA                            CEU005
     C*                                                                   CEU005
     C** Format DATA field of MULT occurence data structure               CEU005
     C                     MOVELWOCMT     MDAT                            CEU005
     C*                                                                   CEU005
     C** Format FIELD for report                                          CEU005
     C                     MOVELMDAT      RDAT                            CEU005
     C                     MOVE 'N'       WWER72                          CEU005
     C*                                                                   CEU005
     C** Increase INDEX for MULT OCCUR. data structure                    CEU005
     C                     ADD  1         X                               CEU005
     C           X         OCUR MULT                                      CEU005
     C*                                                                   CEU005
     C                     ENDIF                                          CEU005
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  FLD79     - FORMAT FIELD :79:                               *
     C**                                                              *
     C**  CALLS     - NONE                                            *
     C**                                                              *
     C**  CALLED BY - RSEQ                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           FLD79     BEGSR
     C*
     C** INITIALIZE ERROR FLAG
     C                     MOVE *BLANKS   WWER79  1
     C*
     C** IF FIELD IS MANDATORY FOR THIS MESSAGE AND
     C** NARRATIVE FIELDS ARE ALL BLANK
     C           WWFL33    IFEQ 'M'
     C           MGNAL1    ANDEQ*BLANKS
     C*
     C** FORMAT ERROR MESSAGE FIELD
     C                     MOVELERRA,46   MERR
     C                     MOVE 'Y'       @ERR
     C                     MOVE 'Y'       WWNGEN
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ELSE
     C*
     C** END OF FIELD :79: PROCESSING IF FIELD IS NOT REQUIRED
     C** OR NARRATIVE FIELDS ARE BLANK
     C           WWFL33    IFEQ 'N'
     C                     MOVE 'Y'       WWER79
     C                     END
     C*
     C           MGNAL1    IFEQ *BLANKS
     C                     MOVE 'Y'       WWER79
     C                     END
     C*
     C           WWER79    IFNE 'Y'
     C*
     C** INCREASE LENGTH
     C                     ADD  42        WWLENG
     C*
     C** FORMAT DESCRIPTION FIELD
     C                     MOVELDESA,31   MDES
     C*
     C** FORMAT TAG FIELD
     C***********          MOVEL':79:'    MTAG                            057263
     C                     MOVEL':79: '   MTAG                            057263
     C*
     C** FORMAT DATA FIELD
     C                     MOVELMGNAL1    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C           MGNAL2    IFNE *BLANKS
     C*
     C** INCREASE LENGTH
     C                     ADD  42        WWLENG
     C*
     C** FORMAT DATA FIELD
     C                     MOVELMGNAL2    MDAT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C                     END
     C                     END
     C*
     C                     Z-ADDX         Y
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  NGEN      - FORMAT MESSAGE FOR MG0580P2 REPORT              *
     C**                                                              *
     C**  CALLS     - NONE                                            *
     C**                                                              *
     C**  CALLED BY - MAIN PROCESSING                                 *
     C**                                                              *
     C*****************************************************************
     C*
     C           NGEN      BEGSR
     C*
     C** STORE LATEST OCCURENCE OF MULT DATA STRUCTURE AND RETURN TO
     C** THE START OF THIS PART OF MESSAGE
     C                     Z-ADDX         WWX2    30
     C                     Z-ADDWWX1      X
     C           X         OCUR MULT
     C*
     C** SET UP DATA STRUCTURE FOR INCORRECTLY GENERATED MESSAGES
     C** AND CLEAR THESE DETAILS FROM DATA STRUCTURE FOR CORRECTLY
     C** GENERATED MESSAGES
     C           X         DOUEQWWX2
     C                     MOVELMDAT      WMDAT
     C                     MOVELMTAG      WMTAG
     C                     MOVELMERR      WMERR
     C                     MOVE *BLANKS   MULT
     C                     ADD  1         X
     C           X         OCUR MULT
     C*
     C                     ADD  1         WWZ
     C           WWZ       OCUR WMULT
     C*
     C                     END
     C*
     C                     Z-ADDWWZ       WWY     30
     C*
     C** RETURN TO OCCURENCE BEFORE THE ERROR
     C                     Z-ADDWWX1      X
     C                     Z-ADDWWX1      Y
     C           X         OCUR MULT
     C*
     C** REMOVE REFERENCE FROM REFDS AND TRANS TO AVOID OUTPUT OF INCORRECT
     C** MESSAGE TO THE FILES
     C           WWTOT1    OCUR TRANS
     C           WWTOT1    OCUR REFDS
     C                     MOVEL*BLANKS   TRANS
     C                     MOVEL*BLANKS   REFDS
     C                     SUB  1         WWTOT1
     C*
     C** RESET MESSAGE NOT GENERATED CORRECTLY FLAG
     C                     MOVE *BLANKS   WWNGEN
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  WREF      - FORMAT FIELDS FOR PF/MGOREFPD DATA STRUCTURE    *
     C**                                                              *
     C**  CALLS     - NONE                                            *
     C**                                                              *
     C**  CALLED BY - RSEQ                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           WREF      BEGSR
     C*
     C           WWTOT1    OCUR REFDS
     C           WWTOT1    OCUR TRANS
     C                     MOVELMGMODI    WWMOD
     C                     MOVELWWDATA    WWTRNO
     C                     MOVELMGTNUM    WWMTRN
     C                     MOVELMGTTYP    WWTNTP
     C                     MOVELMGTSTP    WWSBTP
     C                     MOVELMGDEST    WWDECN
     C                     MOVELMGBSSN    WWNWBN
     C                     MOVELWWDATE    WWSVDT
     C                     MOVELMGSTCY    WWCCY
     C                     MOVELMGBRCA    WWBRCA
     C                     MOVELWWHIST    WWHRDT
     C                     MOVELWWDATA    WWTRNM
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  OFLDS     - WRITE TO MIDAS SWIFT DATABASE FILES             *
     C**                                                              *
     C**  CALLS     - ZM0060, *PSSR, #W05                             *
     C**                                                              *
     C**  CALLED BY - MAIN PROCESSING                                 *
     C**                                                              *
     C*****************************************************************
     C*
     C           OFLDS     BEGSR
     C*
     C** CLEAR ALL FIELDS IN PF/MGOREFPD
     C                     CLEARMGOREFD0
     C*
     C** CONVERT MESSAGE GEN. DATE TO SWIFT FORMAT
     C                     MOVELBJRDNB    ZMDAY
     C                     MOVE *BLANKS   ZSDATE
     C*
     C                     CALL 'ZM0060'               22
     C                     PARM           ZMDAY
     C                     PARM           ZSDATE
     C*
     C** IF PROGRAM NOT FOUND
     C           *IN22     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '036'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 036  *
     C                     MOVEL'ZM0060'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** SET MESSAGE GEN. DATE MGDE TO ZSDATE
     C                     MOVELZSDATE    MGDE
      *                                                                   113352
      ** Set-up Message Generation  Century flag                          113352
      *                                                                   113352
     C                     MOVELMGDE      YY      20                      113352
     C           YY        IFLT 72                                        113352
     C                     MOVE '2'       CIND                            113352
     C                     ELSE                                           113352
     C                     MOVE '1'       CIND                            113352
     C                     ENDIF                                          113352
     C*
     C** SET INDEX TO PROCESS MULTIPLE OCCURRENCE DS FOR PF/MGOREFPD
     C                     Z-ADD1         W       20
     C*
     C** SAVE FIRST PART OF THE MULTIPLE MESSAGE FOR TRANS NUMBER
     C           W         OCUR TRANS
     C                     MOVE WWTRNM    WWTRNF 16
     C*
     C** PROCESS MULTIPLE OCCURRENCE DATA STRUCTURE FOR PF/MGOREFPD
     C           W         DOWLEWWTOT1
     C           W         OCUR REFDS
     C*
     C** FORMAT FIELDS ON PF/MGOREFPD
     C                     EXSR #W05
     C/COPY WNCPYSRC,MG0580C004
     C*
     C** WRITE RECORD TO PF/MGOREFPD
     C                     MOVELMGCHG     AORR                                                CSW025
     C                     WRITEMGOREFD0               32
     C*
     C** IF ERROR ON WRITE TO RECORD
     C           *IN32     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '037'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 037  *
     C                     MOVEL'MGOREFPD'DBFILE           * * * * * * * *
     C                     MOVEL'MG0580'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C                     END
     C*
     C** PROCESS MULTIPLE OCCURRENCE DATA STRUCTURE
     C                     Z-ADD1         Z       30
     C           Z         DOWLTY
     C           Z         OCUR MULT
     C*
     C** FORMAT FIELDS ON PF/MGOMSGPD
     C                     MOVELMDAT      MFLD
     C                     MOVELWWTRNF    TRNO
     C                     MOVE *BLANKS   PTDL
     C*
     C** WRITE RECORD TO PF/MGOMSGPD
     C                     WRITEMGOMSGD0               33
     C*
     C** IF ERROR ON WRITE TO RECORD
     C           *IN33     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '038'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 038  *
     C                     MOVEL'MGOMSGPD'DBFILE           * * * * * * * *
     C                     MOVEL'MG0580'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** ADD 1 TO INDEX OF MULT OCURENCE DATA STRUCTURE
     C                     ADD  1         Z
     C*
     C                     END
      *                                                                   183583
      ** Write multiple occurrence data structure to MGOEXTPD             183583
      *                                                                   183583
     C                     Z-ADD1         VV      20                      183583
     C           VV        DOWLEV                                         183583
     C           MCSI      ANDNE*BLANKS                                   183583
     C           VV        OCUR EXTN                                      183583
     C                     WRITEMGOEXTD0               06                 183583
      *                                                                   183583
      ** Error on write to PF/MGOEXTPD (message data extension file)      183583
      *                                                                   183583
     C           *IN06     IFEQ '1'                                       183583
     C           *LOCK     IN   LDA                                       183583
     C                     MOVE '067'     DBASE            ************** 183583
     C                     MOVEL'        'DBKEY            * DBERROR 67 * 183583
     C                     MOVEL'MGOEXTPD'DBFILE           ************** 183583
     C                     OUT  LDA                                       183583
     C                     EXSR *PSSR                                     183583
     C                     ENDIF                                          183583
     C                     ADD  1         VV                              183583
     C                     ENDDO                                          183583
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  #W05      - FORMAT FIELDS FOR MGOREFPD                      *
     C**                                                              *
     C**  CALLS     - NONE                                            *
     C**                                                              *
     C**  CALLED BY - MAIN PROCESSING                                 *
     C**                                                              *
     C*****************************************************************
     C*
     C           #W05      BEGSR
     C*
     C** FORMAT FIELDS ON PF/MGOREFPD
     C                     MOVELWWMOD     MODI
     C                     MOVELWWTRNO    TRNO
     C                     MOVELWWMTRN    MTRN
     C                     MOVELWWTNTP    TNTP
     C                     MOVELWWSBTP    SBTP
     C                     MOVEL@NWRK     NWRK
     C                     MOVELA8BICN    SECN
     C                     MOVEL@NWSN     NWSN
     C                     MOVELWWDECN    DECN
     C                     MOVEL@NWDS     NWDS
     C                     MOVELWWNWBN    NWBN
     C                     MOVEL'580'     MTPY
     C                     MOVEL'N'       MPRY
     C***********          MOVEL'1'       MGSG                            082282
     C***********          MOVEL'CRTD'    MGST                            082282
     C                     EXSR MSTAT                                     082282
     C                     TIME           MGTM
     C                     MOVELBJMRDT    LADT
     C                     TIME           LATM
     C                     MOVELWWSVDT    SVDT
      *                                                                   141572
      ** Setup century indicator CINDV for value date SVDT                141572
     C           SVDT      IFEQ *BLANK                                    141572
     C                     MOVE *BLANK    CINDV                           141572
     C                     ELSE                                           141572
     C                     MOVELSVDT      YY      20                      141572
     C           YY        IFLT 72                                        141572
     C                     MOVE '2'       CINDV                           141572
     C                     ELSE                                           141572
     C                     MOVE '1'       CINDV                           141572
     C                     ENDIF                                          141572
     C                     ENDIF                                          141572
      *                                                                   141572
     C                     MOVELWWCCY     CCY
     C                     MOVELWWBRCA    BRCA
     C                     MOVELWWHRDT    HRDT
     C                     MOVEL'Y'       TSKS
     C*
     C** INCREMENT INDEX
     C                     ADD  1         W
     C           WWTOT1    IFGT 1
     C           W         OCUR TRANS
     C                     MOVELWWTRNF    TRNF
     C                     MOVELWWTRNM    TRNM
     C                     END
     C*
     C* FISRT PART OF MULTIPLE MUST HAVE TRNF BLANK
     C           W         IFEQ 2
     C                     MOVEL*BLANKS   TRNF
     C                     END
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT                                                              082282
     C*****************************************************************   082282
     C**                                                              *   082282
     C**  MSTAT     - Determine message status                        *   082282
     C**                                                              *   082282
     C*****************************************************************   082282
      *                                                                   082282
     C           MSTAT     BEGSR                                          082282
      *                                                                   082282
      * Reset status array                                                082282
     C                     CLEAR@ST                                       082282
      *                                                                   082282
      * Set key to destination customer number                            082282
     C                     MOVELDECN      @KEY      P                     082282
      *                                                                   082282
      * Get customer details via access object                            082282
     C                     CALL 'AOCUSTR0'                                082282
     C                     PARM *BLANKS   @RTCD   7                       082282
     C                     PARM '*KEY   ' @OPTN   7                       082282
     C                     PARM           @KEY   10                       082282
     C                     PARM *BLANKS   @KYST   7                       082282
     C           SDCUST    PARM SDCUST    DSSDY                           082282
      *                                                                   082282
      * Fill status array                                                 082282
     C           @RTCD     IFEQ *BLANKS                                   082282
     C                     MOVELBBDS01    @ST,1                           082282
     C                     MOVELBBDS02    @ST,2                           082282
     C                     MOVELBBDS03    @ST,3                           082282
     C                     MOVELBBDS04    @ST,4                           082282
     C                     MOVELBBDS05    @ST,5                           082282
     C                     MOVELBBDS06    @ST,6                           082282
     C                     MOVELBBDS07    @ST,7                           082282
     C                     MOVELBBDS08    @ST,8                           082282
     C                     MOVELBBDS09    @ST,9                           082282
     C                     MOVELBBDS10    @ST,10                          082282
     C                     MOVELBBDS11    @ST,11                          082282
     C                     MOVELBBDS12    @ST,12                          082282
     C                     MOVELBBDS13    @ST,13                          082282
     C                     MOVELBBDS14    @ST,14                          082282
     C                     MOVELBBDS15    @ST,15                          082282
     C                     ENDIF                                          082282
      *                                                                   082282
      * Is the message type in the array? Set on *IN60 if it is.          082282
     C           '580'     LOKUP@ST                      60               082282
     C  N60      '58*'     LOKUP@ST                      60               082282
     C  N60      '5**'     LOKUP@ST                      60               082282
      *                                                                   082282
      * If found, set status to 'ready to send', else set to 'created'    082282
     C           *IN60     IFEQ *ON                                       082282
     C                     MOVEL'RSND'    MGST                            082282
     C                     MOVEL'2'       MGSG                            082282
     C                     ELSE                                           082282
     C                     MOVEL'CRTD'    MGST                            082282
     C                     MOVEL'1'       MGSG                            082282
     C                     ENDIF                                          082282
      *                                                                   082282
     C                     ENDSR                                          082282
      *                                                                   082282
     C*****************************************************************   082282
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  #ZA       - FORMAT ADDRESSES                                *
     C**                                                              *
     C**  CALLS     - NONE                                            *
     C**                                                              *
     C**  CALLED BY - FLD53A, FLD83C, FLD87A                          *
     C**                                                              *
     C*****************************************************************
     C*
     C           #ZA       BEGSR
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C           ZSADD1    IFNE *BLANKS                                   122283
     C                     MOVELZSADD1    MDAT
     C                     EXSR SEXTN                                     183583
     C*
     C** FORMAT FIELD FOR REPORT
     C                     MOVELMDAT      RDAT
     C*
     C** PRINT CUSTOMER REPORT NAME AND REPORT TOWN
     C           MTAG      IFEQ ':84A:'
     C           MTAG      OREQ ':87A:'
     C           MTAG      OREQ ':57A:'
     C           MTAG      OREQ ':58A:'
     C                     MOVELZCRNM     CRNM
     C                     MOVELZCRTN     CRTN
     C                     END
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C*                                                                   122283
     C                     END                                            122283
     C*
     C** IF ZSADD2 IS NOT BLANK
     C           ZSADD2    IFNE *BLANKS
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELZSADD2    MDAT
     C*
     C** FORMAT FIELD FOR REPORT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C** IF ZSADD3 IS NOT BLANK
     C           ZSADD3    IFNE *BLANKS
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELZSADD3    MDAT
     C*
     C** FORMAT FIELD FOR REPORT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C** IF ZSADD4 IS NOT BLANK
     C           ZSADD4    IFNE *BLANKS
     C*
     C** FORMAT DATA FIELD OF MULT OCCURENCE DATA STRUCTURE
     C                     MOVELZSADD4    MDAT
     C*
     C** FORMAT FIELD FOR REPORT
     C                     MOVELMDAT      RDAT
     C*
     C** INCREASE INDEX FOR MULT OCCUR. DATA STRUCTURE
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT                                                              183583
      *****************************************************************   183583
      *                                                               *   183583
      *   SEXTN - Store customer with SWIFT address to data structure *   183583
      *                                                               *   183583
      *   Called by: #ZA                                              *   183583
      *   Calls    : None                                             *   183583
      *                                                               *   183583
      *****************************************************************   183583
      *                                                                   183583
     C           SEXTN     BEGSR                                          183583
      *                                                                   183583
     C           SAVMTG    IFNE *BLANKS                                   183583
     C                     MOVE SAVMTG    @MTG                            183583
     C                     ELSE                                           183583
     C                     MOVELMTAG      @MTG                            183583
     C                     ENDIF                                          183583
      *                                                                   183583
     C           FLDTYP    IFEQ '5'                                       183583
     C           FLDTAG    ANDEQ'A'                                       183583
     C           FLDTYP    OREQ '8'                                       183583
     C           FLDTAG    ANDEQ'A'                                       183583
     C                     ADD  1         V                               183583
     C           V         OCUR EXTN                                      183583
     C                     Z-ADDX         MPSN                            183583
     C                     MOVEL@MTG      MTG                             183583
     C                     MOVELZDEST     MCSI                            183583
     C                     ENDIF                                          183583
      *                                                                   183583
     C           SEXT9     ENDSR                                          183583
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  #W01      - PRINT MESSAGE GENERATED DETAILS                 *
     C**                                                              *
     C**  CALLS     - NONE                                            *
     C**                                                              *
     C**  CALLED BY - MAIN PROCESSING                                 *
     C**                                                              *
     C*****************************************************************
     C*
     C           #W01      BEGSR
     C*
     C** INITIALISE FIELDS USED IN REPORT
     C                     MOVE *BLANKS   R1SNBR
     C                     MOVE *BLANKS   R1SNDR
     C                     MOVE *BLANKS   R1NWSN
     C                     MOVE *BLANKS   R1DEST
     C                     MOVE *BLANKS   R1NWRK
     C                     MOVE *BLANKS   R1NWDS
     C*
     C** FORMAT REPORT FIELDS
     C                     MOVELWWHDR1    R1SNBR
     C                     MOVEL@SNDR     R1SNDR
     C                     MOVEL@NWSN     R1NWSN
     C                     MOVE 'N'       R1MESS
     C                     MOVELWWHDR2    R1DEST
     C                     MOVEL@NWRK     R1NWRK
     C                     MOVEL@NWDS     R1NWDS
     C                     MOVEL@SRNM     R1SRNM
     C                     MOVEL@SRTN     R1SRTN
     C                     MOVEL@DRNM     R1DRNM
     C                     MOVEL@DRTN     R1DRTN
     C*
     C** WRITE THE HEADER AND THE MAIN TEXT FOR THE REPORT
     C                     WRITEHEADER1
     C                     WRITETEXT1
     C                     MOVEL'N'       WWC1    1
     C*
     C** PROCESS MULTIPLE OCCURRENCE DATA STRUCTURE
     C                     Z-ADD0         I       30
     C           I         DOWLEY
     C                     ADD  1         I
     C           I         OCUR MULT
     C*
     C** CHECKING FOR OVERFLOW
     C           WWOFL1    SUB  WWPTL1    WWLINE
     C           WWLINE    IFLT 3
     C                     WRITEHEADER1
     C           MTAG      IFEQ ':23: '
     C                     WRITECONTI1
     C                     END
     C                     ELSE
     C*
     C** NEW PAGE FOR EACH NEW PART
     C           MTAG      IFEQ ':23: '
     C           WWC1      ANDEQ'Y'
     C                     WRITEHEADER1
     C                     WRITECONTI1
     C                     END
     C*
     C                     END
     C*
     C** WRITE A DETAIL LINE TO THE REPORT
     C                     WRITELINE1
     C*
     C           MTAG      IFEQ ':35A:'
     C                     MOVEL'Y'       WWC1
     C                     END
     C*
     C                     END
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  #W02      - PRINT MESSAGE NOT GENERATED DETAILS             *
     C**                                                              *
     C**  CALLS     - NONE                                            *
     C**                                                              *
     C**  CALLED BY - MAIN PROCESSING                                 *
     C**                                                              *
     C*****************************************************************
     C*
     C           #W02      BEGSR
     C*
     C** INITIALISE  FIELDS USED IN REPORT
     C                     MOVE *BLANKS   R2SNBR
     C                     MOVE *BLANKS   R2SNDR
     C                     MOVE *BLANKS   R2NWSN
     C**********           Z-ADD*ZEROS    R2DEST                                              CSD027
     C                     MOVE *BLANKS   R2DEST                                              CSD027
     C                     MOVE *BLANKS   R2NWDS
     C                     MOVE *BLANKS   R2DERR
     C                     MOVE *BLANKS   R2NWRK
     C                     MOVE *BLANKS   R2MODI
     C*
     C** OPEN PRINTER FILE
     C           *IN50     IFEQ '0'
     C************         OPEN MG0580P2                                  091250
     C                     OPEN MG0580A2                                  091250
     C                     MOVE '1'       *IN50
     C                     END
     C*
     C** FORMAT REPORT FIELDS
     C                     MOVELWWHDR1    R2SNBR
     C                     MOVEL@SNDR     R2SNDR
     C                     MOVEL@NWSN     R2NWSN
     C                     MOVELWWHDR2    R2DEST
     C                     MOVEL@NWDS     R2NWDS
     C                     MOVELDSERR     R2DERR
     C                     MOVEL@NWRK     R2NWRK
     C                     MOVELNWERR     R2NWER
     C                     MOVELWWHDR3    R2MODI
     C                     MOVEL'N'       R2PRTY
     C*
     C** WRITE THE HEADER AND THE MAIN TEXT FOR THE REPORT
     C                     WRITEHEADER2
     C                     WRITETEXT2
     C                     MOVEL'N'       WWC2    1
     C*
     C** PROCESS MULTIPLE OCCURRENCE DATA STRUCTURE
     C                     Z-ADD0         I
     C           I         DOWLEWWY
     C                     ADD  1         I
     C           I         OCUR WMULT
     C*
     C** CHECKING FOR OVERFLOW
     C           WWOFL2    SUB  WWPTL2    WWLINE
     C           WWLINE    IFLT 3
     C                     WRITEHEADER2
     C           MTAG      IFEQ ':23: '
     C                     WRITECONTI2
     C                     END
     C                     ELSE
     C*
     C** NEW PAGE FOR EACH NEW PART
     C           MTAG      IFEQ ':23: '
     C           WWC2      ANDEQ'Y'
     C                     WRITEHEADER2
     C                     WRITECONTI2
     C                     END
     C*
     C                     END
     C*
     C** WRITE A DETAIL LINE TO THE REPORT
     C                     WRITELINE2
     C*
     C           MTAG      IFEQ ':35A:'
     C                     MOVEL'Y'       WWC2
     C                     END
     C*
     C                     END
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*   CEDELC - CEDEL CANCELLATION PROCESSING                      *
     C*   Called by   Main process                                    *
     C*   Calls       - CANCEL                                        *
     C*****************************************************************
     C*
     C           CEDELC    BEGSR
     C*
     C*...............................................................*
     C* Single Messages                                               *
     C* 1.  A message is 'deleted' when the message status field on   *
     C*     the reference field (MGST, PF/MGOREFPD), is equal to      *
     C*     'DLTD'.                                                   *
     C*                                                               *
     C* Multiple Messages (MT554, MT580)                              *
     C* 2.  The message status field of the header record on the      *
     C*     message reference file (PF/MGOREFPD), contains the        *
     C*     status for the multiple message. This status is then      *
     C*     the status for all parts within the multiple message.     *
     C*
     C*     If the message status field (MGST, PF/MGOREFPD), of the   *
     C*     header record contains the value 'DLTD' the whole         *
     C*     message is deleted, (i.e. all parts are deleted).         *
     C*                                                               *
     C*     To delete a message part from the multiple message, the   *
     C*     message is descibed as 'part deleted'. The reference      *
     C*     record for the message part being deleted has the         *
     C*     'part deleted' field (PTST, PF/MGOREFPD), set to 'D'.     *
     C*     The header record message status (MGST, PF/MGOREFPD),     *
     C*     is then set to 'AMND', to indicate the multiple message   *
     C*     has been 'amended'.                                       *
     C*...............................................................*
     C*
     C** INITIALISE FLAG FOR MESSAGE SUCCESSFULLY DELETED
     C                     MOVE 'N'       WWFLAG  1
     C           MGTTYP    IFEQ 'DM'
     C                     MOVEL'001'     WWNINE
     C                     ELSE
     C           MGTTYP    IFEQ 'DN'                                     CSW003
     C                     MOVEL'002'     WWNINE                         CSW003
     C                     ELSE                                          CSW003
     C           MGTTYP    IFEQ 'TS'                                     CSW003
     C                     MOVEL'003'     WWNINE                         CSW003
     C                     ELSE                                          CSW003
     C                     MOVEL'000'     WWNINE
     C                     END
     C                     ENDIF                                         CSW003
     C                     ENDIF                                         CSW003
     C                     MOVELMGTNUM    WWFSIX
     C                     MOVE WWFSIX    WWNINE  9
     C                     MOVELWWNINE    @TNUM
     C                     MOVE @LSWS     @TNUM  16
     C                     MOVEL' '       WOUT72  1
     C*
     C**  Use the parameter @TNUM to access the message we are deleting
     C           @TNUM     CHAINMGOREFL0             05
     C*
     C**  Error message not found
     C           *IN05     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '049'     DBASE            * * * * * * * *
     C                     MOVEL@TNUM     DBKEY            *  DBERR 049  *
     C                     MOVEL'MGOREFL0'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** If message not already cancelled, process cancellation
     C           CARQ      IFNE 'Y'
     C                     EXSR CANCEL
     C                     END
     C*
     C** If cancellation message not successfully generated
     C           WWFLAG    IFEQ 'N'
     C           *LOCK     IN   LDA
     C                     MOVE '050'     DBASE            * * * * * * * *
     C                     MOVELWWHEAD    DBKEY            *  DBERR 050  *
     C                     MOVEL'MGOMSGLA'DBFILE           * * * * * * * *
     C                     MOVEL'MG0580'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*   CANCEL - CREATE CANCELLATION MESSAGE                        *
     C*   Called by   Main process                                    *
     C*   Calls       - PARTPS                                        *
     C*****************************************************************
     C*
     C           CANCEL    BEGSR
     C*
     C*----------------------------------------------------------------
     C*  OBTAIN HEADER FIELDS FROM MGOREFPD
     C*----------------------------------------------------------------
     C                     MOVELNWSN      @NWSN
     C                     MOVELNWDS      @NWDS
     C                     MOVELNWRK      @NWRK
     C*
     C*----------------------------------------------------------------
     C** DETERMINE IF MESSAGE IS SINGLE OR MULTIPLE
     C*----------------------------------------------------------------
     C*
     C*
     C** INITIALISE MULTIPLE MESSAGE FLAG
     C                     MOVE 'N'       MMEG    1
     C                     MOVE 'N'       WW72
     C*
     C**  The message being deleted is part of a multiple and
     C**  is part-deleted from the multiple message (PF/MGOREFPD)
     C           TRNF      IFNE *BLANKS
     C           TRNM      ORNE *BLANKS
     C*
     C                     MOVE 'Y'       MMEG
     C*
     C**  The header TRN is the TRN of the message being deleted
     C           TRNF      IFEQ *BLANKS
     C                     MOVEL@TNUM     WWHEAD 16
     C*
     C**  The header TRN is the 'TRN of the first part' (TRNF)
     C                     ELSE
     C*
     C                     MOVELTRNF      WWHEAD
     C                     END
     C*
     C                     ELSE
     C                     MOVEL@TNUM     WWHEAD 16
     C                     END
     C*
     C*----------------------------------------------------------------
     C** DETERMINE POSITION OF PART TO BE CANCELLED
     C*----------------------------------------------------------------
     C*
     C                     EXSR PARTPS
     C*
     C*----------------------------------------------------------------
     C** CANCEL MULTIPLE MESSAGE
     C*----------------------------------------------------------------
     C*
     C** IF MESSAGE TO BE CANCELLED IS A MULTIPLE MESSAGE
     C           MMEG      IFEQ 'Y'
     C*
     C** ACCESS LF/MGOMSGLA WITH KEY OF WWHEAD
     C           WWHEAD    CHAINMGMSGLA              07
     C*
     C           *IN07     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '051'     DBASE            * * * * * * * *
     C                     MOVELWWHEAD    DBKEY            *  DBERR 051  *
     C                     MOVEL'MGOMSGLA'DBFILE           * * * * * * * *
     C                     MOVEL'MG0580'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C                     MOVE 'N'       FOUND
     C                     Z-ADD0         WW23    20
     C*
     C** READ THROUGH THE MULTIPLE MESSAGE RECORDS TO FIND THE
     C** PART BEING CANCELED
     C           WWHEAD    DOWEQOTRNO
     C           *IN07     ANDEQ'0'
     C           FOUND     ANDEQ'N'
     C*
     C**  For MT580, part found when part position within multiple on
     C**  the reference file is equal to the number of field :23:'s
     C**  we have read within the message on the data file
     C           MTPY      IFEQ '580'
     C           OMTAG     ANDEQ':23: '
     C                     ADD  1         WW23
     C*
     C           WW23      IFEQ WWPTPS
     C*
     C**  For this part of the multiple message, flag as part deleted
     C           OMTAG     DOUEQ':23: '
     C           *IN07     OREQ '1'
     C           WWHEAD    ORNE OTRNO
     C*
     C** FORMAT TAG AND DATA FIELD OF MULT. OCCUR DATA STRUCTURE
     C                     EXSR FORCAN
     C*
     C** READ NEXT RECORD FROM PF/MGOMSGLA
     C                     READ MGMSGLA                  07
     C                     END
     C*  IF FIELD 72 HAS NOT BEEN OUTPUT, OUTPUT IT NOW
     C           WOUT72    IFNE 'Y'
     C                     MOVE 'Y'       WOUT72
     C***********          MOVEL':72:'    MTAG                            057263
     C                     MOVEL':72: '   MTAG                            057263
     C                     MOVELDESA,30   MDES
     C                     MOVEL'/CANCEL/'MDAT
     C                     MOVELMDAT      RDAT
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C*
     C**  Message-part flagged as part deleted
     C                     MOVE 'Y'       FOUND   1
     C                     END
     C*
     C                     END
     C*
     C** READ NEXT RECORD FROM PF/MGOMSGLA
     C                     READ MGMSGLA                  07
     C                     END
     C*
     C** IF FOUND EQUALS 'N'
     C           FOUND     IFEQ 'N'
     C           *LOCK     IN   LDA
     C                     MOVE '052'     DBASE            * * * * * * * *
     C                     MOVELOTRNO     DBKEY            *  DBERR 052  *
     C                     MOVEL'MGOMSGLA'DBFILE           * * * * * * * *
     C                     MOVEL'MG0580'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C                     END
     C*
     C*----------------------------------------------------------------
     C** CANCEL SINGLE MESSAGE
     C*----------------------------------------------------------------
     C*
     C** IF MESSAGE TO BE CANCELLED IS A SIGNLE MESSAGE
     C           MMEG      IFEQ 'N'
     C*
     C** ACCESS LF/MGOMSGLA WITH KEY OF @TNUM
     C           @TNUM     CHAINMGMSGLA              07
     C*
     C           *IN07     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '053'     DBASE            * * * * * * * *
     C                     MOVEL@TNUM     DBKEY            *  DBERR 053  *
     C                     MOVEL'MGOMSGLA'DBFILE           * * * * * * * *
     C                     MOVEL'MG0580'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** WHILE OTRNO EQUALS @TNUM AND NOT EOF
     C           OTRNO     DOWEQ@TNUM
     C           *IN07     ANDEQ'0'
     C*
     C** FORMAT TAG AND DATA FIELD OF MULT. OCCUR DATA STRUCTURE
     C           OM0103    IFNE 'SE8'
     C                     EXSR FORCAN
     C                     END
     C*
     C** READ NEXT RECORD FROM PF/MGOMSGLA
     C                     READ MGMSGLA                  07
     C                     END
     C*
     C*  IF FIELD 72 HAS NOT BEEN OUTPUT, OUTPUT IT NOW
     C           WOUT72    IFNE 'Y'
     C                     MOVE 'Y'       WOUT72
     C***********          MOVEL':72:'    MTAG                            057263
     C                     MOVEL':72: '   MTAG                            057263
     C                     MOVELDESA,30   MDES
     C                     MOVEL'/CANCEL/'MDAT
     C                     MOVELMDAT      RDAT
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C                     END
     C*----------------------------------------------------------------
     C** UPDATE THE MESSAGE TO LF/MGOREFL0
     C*----------------------------------------------------------------
     C*
     C** ACCESS LF/MGOREFL0 WITH KEY OF @TNUM
     C           @TNUM     CHAINMGOREFL0             05
     C*
     C           *IN05     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '054'     DBASE            * * * * * * * *
     C                     MOVEL@TNUM     DBKEY            *  DBERR 054  *
     C                     MOVEL'MGOREFL0'DBFILE           * * * * * * * *
     C                     MOVEL'MG0580'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C** UPDATE THE MESSAGE TO BE CANCELLED
     C                     MOVE 'Y'       CARQ
     C                     MOVELBJMRDT    LADT
     C                     TIME           LATM
     C                     UPDATMGORELA
     C*
     C** SET FLAG FOR MESSAGE SUCCESSFULLY DELETED
     C                     MOVE 'Y'       WWFLAG
     C*
     C** STORE INDEX
     C                     Z-ADDX         Y
     C*----------------------------------------------------------------
     C** SET UP REFERENCE FILE INFORMATION
     C*----------------------------------------------------------------
     C*
     C                     EXSR WREF
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/COPY WNCPYSRC,MG0580C005
     C/EJECT
     C*****************************************************************
     C*   PARTPS - DETERMINE POSITION OF PART TO BE CANCELLED         *
     C*   Called by   CANCEL                                          *
     C*   Calls       *PSSR                                           *
     C*****************************************************************
     C*
     C           PARTPS    BEGSR
     C*
     C** Access the next part of the multiple message
     C           WWHEAD    CHAINMGOREFL0             05
     C*
     C**  Next part not found
     C           *IN05     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '055'     DBASE            * * * * * * * *
     C                     MOVELWWHEAD    DBKEY            *  DBERR 055  *
     C                     MOVEL'MGOREFL0'DBFILE           * * * * * * * *
     C                     MOVEL'MG0580'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C**  INITIALISE PARTS READ COUNTER
     C                     Z-ADD1         WWREAD  20
     C                     MOVE 'N'       PARTFO  1
     C*
     C**  IF TRNO EQUALS @TNUM
     C           TRNO      IFEQ @TNUM
     C*
     C**  INITIALISE PART POSITION WITHIN MULTIPLE
     C                     Z-ADD1         WWPTPS  20
     C* PART HAS BEEN FOUND
     C                     MOVE 'Y'       PARTFO
     C*
     C                     ELSE
     C*
     C                     Z-ADD0         WWPTPS
     C                     END
     C*
     C**  Check until no more parts or 2 live parts have been found
     C           MTPY      IFEQ '580'
     C*
     C           TRNM      DOWNE*BLANKS
     C           *IN05     ANDEQ'0'
     C           PARTFO    ANDEQ'N'
     C*
     C**  Access the next part of the multiple message
     C           TRNM      CHAINMGOREFL0             05
     C*
     C**  Next part not found
     C           *IN05     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '056'     DBASE            * * * * * * * *
     C                     MOVELTRNM      DBKEY            *  DBERR 056  *
     C                     MOVEL'MGOREFL0'DBFILE           * * * * * * * *
     C                     MOVEL'MG0580'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C**  ADD 1 TO PARTS READ COUNTER
     C                     ADD  1         WWREAD
     C*
     C** IF TRNO EQUALS @TNUM
     C           TRNO      IFEQ @TNUM
     C*
     C** SET PART POSITION WITHIN MULTIPLE TO PARTS READ COUNTER
     C                     Z-ADDWWREAD    WWPTPS
     C* PART HAS BEEN FOUND
     C                     MOVE 'Y'       PARTFO
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C** ACCESS LF/MGOREFL0 USING KEY OF @TNUM
     C           @TNUM     CHAINMGOREFL0             05
     C*
     C**  Next part not found
     C           *IN05     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '057'     DBASE            * * * * * * * *
     C                     MOVEL@TNUM     DBKEY            *  DBERR 057  *
     C                     MOVEL'MGOREFL0'DBFILE           * * * * * * * *
     C                     MOVEL'MG0580'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*   FORCAN - FORMAT CANCELLATION MESSAGE FOR REPORTING          *
     C*   Called by   CANCEL                                          *
     C*   Calls       *PSSR                                           *
     C*****************************************************************
     C*
     C           FORCAN    BEGSR
     C*
     C                     MOVE ' '       WOC
     C                     MOVE ' '       WWPROC  1
     C*
     C** FORMAT FIELD 20
     C***********OMTAG     IFEQ ':20:'                                    057263
     C           OMTAG     IFEQ ':20: '                                   057263
     C                     MOVE 'Y'       WWPROC
     C           MGTTYP    IFEQ 'DM'
     C           MGTTYP    OREQ 'DN'                                      CSW003
     C                     MOVEL'991'     OM0103
     C                     ELSE
     C                     MOVEL'999'     OM0103
     C                     END
     C                     MOVELOM0116    WWDATA
     C                     MOVELOM0116    MDAT
     C                     MOVELMDAT      RDAT
     C                     END
     C*
     C** FORMAT FIELD 23
     C***********OMTAG     IFEQ ':23:'                                    057263
     C           OMTAG     IFEQ ':23: '                                   057263
     C                     MOVE 'Y'       WWPROC
     C                     MOVELOMFLD     WWDATA
     C                     MOVELOMFLD     MDAT
     C                     MOVELMDAT      RDAT
     C***********OM0204    IFEQ 'REC'                                     073848
     C***********          MOVE 'TP'      MGTSTP                          073848
     C***********          ELSE                                           073848
     C***********          MOVE 'TS'      MGTSTP                          073848
     C***********          END                                            073848
     C                     END
     C** FORMAT DATES
     C***********OMTAG     IFEQ ':30:'                                    057263
     C           OMTAG     IFEQ ':30: '                                   057263
     C           OMTAG     OREQ ':31P:'
     C                     MOVE 'Y'       WWPROC
     C                     MOVELOM0106    ZSDATE
     C                     MOVELOMFLD     MDAT
     C*
     C                     MOVELWWYEAR    WRYEAR
     C                     MOVELWWMNTH    WRMNTH
     C                     MOVELWWDAY     WRDAY
     C                     MOVELOM0735    WR0937
     C                     MOVELWRDATE    WR0108
     C                     MOVELWWRDAT    RDAT
     C*
     C           OMTAG     IFEQ ':30: '
     C                     MOVELZSDATE    WWDATE  6
     C*
     C                     MOVE WWYEAR    WR4     4
     C                     MOVELWWMNTH    WR4
     C                     MOVE WR4       WR6     6
     C                     MOVELWWDAY     WR6
     C                     MOVE WR6       ZDATE
     C                     EXSR ZDATE1
     C*
     C**     if date not correct
     C           *IN99     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '058'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 058  *
     C                     MOVEL'ZDATE1'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     Z-ADDZDAYNO    MGSDAT
     C                     END
     C*
     C** CONVERT HISTORY RETENTION DATE TO SWIFT FORMAT
     C           MGDEST    IFNE WWCEDN
     C           WWSENT    ANDNE'CEDEL'
     C           MGSDAT    ADD  ENDSMN    ZMDAY
     C                     ELSE
     C           MGSDAT    ADD  60        ZMDAY
     C                     END
     C                     MOVE *BLANKS   ZSDATE
     C*
     C                     CALL 'ZM0060'               22
     C                     PARM           ZMDAY
     C                     PARM           ZSDATE
     C*
     C** IF PROGRAM NOT FOUND
     C           *IN22     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '059'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 059  *
     C                     MOVEL'ZM0060'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C                     MOVELZSDATE    WWHIST
     C                     END
     C*
     C** FORMAT AMOUNTS
     C           OMTAG     LOKUPTAGAMT                   70
     C           *IN70     IFEQ '1'
     C                     MOVE 'Y'       WWPROC
     C                     MOVELOMFLD     MDAT
     C*
     C                     MOVE OM0419    @WAMT  16
     C           OMTAG     IFEQ ':35A:'
     C**********           MOVE *BLANKS   @WCCY                           167826
     C                     MOVE MGNMCY    @WCCY                           167826
     C                     ELSE
     C                     MOVE OM0103    @WCCY   3
     C                     END
     C                     CALL 'ZM1340'               21
     C                     PARM           @WAMT
     C                     PARM           @WCCY
     C                     PARM 'A'       @WTYP   1
     C                     PARM *BLANKS   @REST  16
     C                     PARM *BLANKS   @ERRC   1
     C                     PARM MGNMDP    @CDP                            188866
     C*
     C**     if program ZM1340 not found
     C           *IN21     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '060'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 060  *
     C                     MOVEL'ZM1340'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C**      if error during called program
     C           @ERRC     IFEQ 'Y'
     C           *LOCK     IN   LDA
     C                     MOVE '061'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 061  *
     C                     MOVELDBERR1    DBKEY            * * * * * * * *
     C                     MOVEL'ZM1340'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     MOVE *BLANKS   WWRDAT
     C                     MOVELOM0103    WR0103
     C                     MOVEL@REST     WR0424
     C                     MOVELWWRDAT    RDAT
     C                     END
     C*
     C           OMTAG     IFEQ ':32B:'
     C                     MOVELOM0103    MGSTCY
     C                     END
     C*
     C** FORMAT FIELD 34G AND 34H
     C           OMTAG     IFEQ ':34G:'
     C           OMTAG     OREQ ':34H:'
     C                     MOVE 'Y'       WWPROC
     C                     MOVEL'Y'       WW34    1
     C           OM0419    IFEQ *BLANKS
     C                     MOVELOMFLD     MDAT
     C                     MOVELMDAT      RDAT
     C                     END
     C                     END
     C**    if blanks from position 4, this is the amount field
     C           WW34      IFEQ 'Y'
     C           OM0419    ANDNE*BLANKS
     C*
     C                     MOVE 'Y'       WWPROC
     C                     MOVE OM0419    @WAMT  16
     C                     MOVE OM0103    @WCCY   3
     C                     CALL 'ZM1340'               21
     C                     PARM           @WAMT
     C                     PARM           @WCCY
     C                     PARM 'A'       @WTYP   1
     C                     PARM *BLANKS   @REST  16
     C                     PARM *BLANKS   @ERRC   1
     C                     PARM MGNMDP    @CDP    10                      167826
     C*
     C**      if program ZM1340 not found
     C           *IN21     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '062'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 062  *
     C                     MOVEL'ZM1340'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C**      if error during called program
     C           @ERRC     IFEQ 'Y'
     C           *LOCK     IN   LDA
     C                     MOVE '063'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 063  *
     C                     MOVELDBERR1    DBKEY            * * * * * * * *
     C                     MOVEL'ZM1340'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     MOVE *BLANKS   WWRDAT
     C                     MOVELOM0103    WR0103
     C                     MOVEL@REST     WR0424
     C                     MOVELWWRDAT    RDAT
     C                     MOVELOMFLD     MDAT
     C                     MOVEL'N'       WW34
     C                     END
     C*
     C** FORMAT OPTION FIELDS A
     C           OMTAG     LOKUPTAGBIC                   70
     C           *IN70     IFEQ '1'
     C                     MOVE 'Y'       WWPROC
     C                     MOVELOMFLD     MDAT
     C                     MOVELMDAT      RDAT
     C           OMTAG     IFEQ ':88A:'
     C                     MOVELOMFLD     MGBSSN
     C                     END
     C*       if swift id, obtain name and town
     C           OMTAG     IFNE ':84A:'
     C                     MOVE *BLANKS   WRK1    1                       122078
     C                     MOVELOM0112    WRK1                            122078
      * Option tag 'A' may begin with the account line, so bypass the account li
      * line and get the CSID after.                                      122078
     C           WRK1      IFEQ '/'                                       122078
     C                     MOVELOMFLD     MDAT                            122078
     C                     MOVELMDAT      RDAT                            122078
     C                     MOVE 'Y'       WWPROC                          122078
     C                     ELSE                                           122078
     C*
     C**      access SDCUSTL7 to obtain name and town
     C           OM0112    CHAINSDCUSTL7             16
     C*
     C**      if record not found or deleted
     C           *IN16     IFEQ '1'
     C           BBTYLC    OREQ 'D'
     C           *LOCK     IN   LDA
     C                     MOVE '064'     DBASE            * * * * * * * *
     C                     MOVELOM0112    DBKEY            *  DBERR 064  *
     C                     MOVEL'SDCUSTL7'DBFILE           * * * * * * * *
     C                     MOVEL'MG0580'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     END                                            122078
     C*
     C                     END
     C                     END
     C*
     C** FORMAT RATE FIELDS
     C           OMTAG     LOKUPTAGRAT                   70
     C           *IN70     IFEQ '1'
     C                     MOVE 'Y'       WWPROC
     C                     MOVELOMFLD     MDAT
     C*****                MOVE OM0419    @WAMT  16
     C***********          MOVE OMFLD     @WAMT  16                       071394
     C*                                                                   071394
     C** Processing should be different for 33T                           071394
     C*                                                                   071394
     C           OMTAG     IFEQ ':33T:'                                   071394
     C                     MOVE *BLANKS   @WAMT  16                       071394
     C                     MOVELOM0418    @WAMT                           071394
     C                     ELSE                                           071394
     C                     MOVE *BLANKS   @WAMT  16                       071394
     C                     MOVELOMFLD     @WAMT                           071394
     C                     END                                            071394
     C*                                                                   071394
     C                     CALL 'ZM1340'               21
     C                     PARM           @WAMT
     C                     PARM *BLANKS   @WCCY
     C                     PARM 'R'       @WTYP   1
     C                     PARM *BLANKS   @REST  16
     C                     PARM *BLANKS   @ERRC   1
     C                     PARM MGNMDP    @CDP                            167826
     C*
     C**     if program ZM1340 not found
     C           *IN21     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '065'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 065  *
     C                     MOVEL'ZM1340'  DBPGM            * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C**     if error during called program
     C           @ERRC     IFEQ 'Y'
     C           *LOCK     IN   LDA
     C                     MOVE '066'     DBASE            * * * * * * * *
     C                     MOVE *BLANKS   DBKEY            *  DBERR 066  *
     C                     MOVELDBERR1    DBKEY            * * * * * * * *
     C                     MOVEL'ZM1340'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C           OMTAG     IFEQ ':33T:'                                   071394
     C                     MOVEL@REST     WR0424
     C                     MOVELOM0103    WR0103
     C                     MOVELWWRDAT    RDAT
     C*                                                                   071394
     C                     ELSE                                           071394
     C                     MOVEL@REST     RDAT                            071394
     C                     ENDIF                                          071394
     C*                                                                   071394
     C                     END
     C*
     C** FORMAT CONTINUATION LINES
     C** AND FIELDS NOT REQUIRING SPECIAL FORMATTING
     C           WWPROC    IFNE 'Y'
     C           OMTAG     LOKUPTAGOTH                   70
     C           OMTAG     IFEQ *BLANKS
     C           OMFLD     ANDNE*BLANKS
     C           WW72      ANDNE'Y'
     C           *IN70     OREQ '1'
     C                     MOVE 'Y'       WWPROC
     C                     MOVELOMFLD     MDAT
     C                     MOVELMDAT      RDAT
     C                     END
     C                     END
     C*
     C** FORMAT FIELD 72
     C           OMTAG     IFEQ ':72: '
     C                     MOVE 'Y'       WOUT72
     C                     MOVEL'/CANCEL/'MDAT
     C                     MOVELMDAT      RDAT
     C                     MOVEL'Y'       WW72    1
     C                     END
     C*
     C**        BYPASS THE OTHER LINES OF FLD72
     C           WW72      IFEQ 'Y'
     C           OMTAG     ANDEQ*BLANKS
     C                     MOVE 'N'       WOC     1
     C                     END
     C           OMTAG     IFEQ ':79: '
     C           OMTAG     OREQ ':77D:'
     C*    if field 72 has not been output, output it now
     C           WOUT72    IFNE 'Y'
     C                     MOVE 'Y'       WOUT72
     C                     MOVEL'/CANCEL/'MDAT
     C                     MOVELMDAT      RDAT
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     ELSE
     C                     MOVE 'N'       WW72
     C                     END
     C                     END
     C*
     C** FILL TAG AND DESCRIPTION
     C                     MOVELOMTAG     MTAG
     C           OMTAG     LOKUPTABT      TABN           71
     C           *IN71     IFEQ '1'
     C                     MOVELTABN      WI      20
     C                     MOVELDESA,WI   MDES
     C                     ELSE
     C                     MOVEL*BLANKS   MDES
     C                     END
     C*
     C** ADD 1 TO INDEX OF MULT. OCCUR DATA STRUCTURE
     C           WOC       IFEQ ' '
     C                     ADD  1         X
     C           X         OCUR MULT
     C                     END
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C/COPY ZSRSRC,ZDATE1Z2
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  PSSR      - ERROR HANDLING                                  *
     C**                                                              *
     C**  CALLS     -                                                 *
     C**                                                              *
     C**  CALLED BY -                                                 *
     C**                                                              *
     C*****************************************************************
     C*
     C           *PSSR     BEGSR
     C*
     C** WRITE DATABASE ERROR TO REPORT
     C                     OPEN MG0580AU
     C                     WRITEHEAD
     C                     WRITEDBERROR
     C*
     C                     SETON                     U7U8LR
     C                     DUMP
     C                     RETRN
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C****
     C* IF DESA IS AMENDED, THE TABLE DEST/DESN SHOULD BE CHECKED AS DESN IS
     C* THE INDEX USED TO RETRIEVE DESCRIPTION IN DESA
     C****
     C/COPY MGCPYSRC,SWIFTTRANS                                           BLI605
** CPY@   Object Copyright
(c) Misys International Banking Systems Ltd. 2001
** ARR2  CASE NUMBERS
0102050607101112131516172021
2223242526272930313234353637
** ERRA   ERROR MESSAGES
Customer number not found on customer file                                   01
Unable to format mandatory field :20:                                        02
Unable to format field :23: - combination invalid                            03
Unable to format field :23: - subfield 1 or 2 invalid                        04
Unable to format field :23: - subfield 3 invalid                             05
Unable to format mandatory field :30:                                        06
Unable to format mandatory field :31P:                                       07
Unable to format mandatory field :31T:                                       08
Unable to format mandatory field :26J:                                       09
Unable to format mandatory field :35A:                                       10
Unable to format mandatory field :35B:                                       11
Unable to format mandatory field :35E:                                       12
Certificate numbers not found for :35E:                                      13
Unable to format mandatory field :83R:                                       14
Unable to format mandatory field :83C:                                       15
Clearing Corres. must be entered for Cedel :84A:                             16
Unable to format mandatory field :84A:                                       17
(removed)                                                                    18
(removed)                                                                    19
Unable to format mandatory field :87a:                                       20
Address not found for field :87a:                                            21
Unable to format mandatory field :85C:                                       22
Unable to format mandatory field :88a:                                       23
Address not found for field :88a:                                            24
Unable to format mandatory field :57a:                                       25
Unable to format addresses for :57a:                                         26
Unable to format mandatory field :58a:                                       27
Field :58a: must be present when field :57a: is present                      28
Field :57a: must be present when field :58a: is present                      29
Unable to format addresses for :58a:                                         30
Unable to format mandatory field :33T:                                       31
Nominal Currency not found for field :33T:                                   32
Unable to format mandatory field :32M:                                       33
Unable to format mandatory field :37J:                                       34
Unable to format mandatory field :34a:                                       35
Unable to format mandatory field :37L:                                       36
Unable to format mandatory field :37S:                                       37
Unable to format mandatory field :33S:                                       38
Unable to format mandatory field :37P:                                       39
Unable to format mandatory field :32B:                                       40
Unable to format mandatory field :26K:                                       41
Unable to format field :26K:                                                 42
Too many denomination choices for field :26K:                                43
Unable to format mandatory field :77B:                                       44
Unable to format mandatory field :72:                                        45
Unable to format mandatory field :79:                                        46
Destination not Euroclear or Cedel                                           47
*** Message is Unroutable ***                                                48
Unable to format mandatory field :77D:                                       49
Invalid formatting for field :87a:                                           40
Invalid formatting for field :88a:                                           51
Invalid formatting for field :57a:                                           52
Invalid formatting for field :58a:                                           53
** DESA   DESCRIPTIONS
                     SETTLEMENT DATE
              FURTHER IDENTIFICATION
             DATE AND PLACE OF TRADE
                  REQUESTED PRIORITY
                              T.R.N.
                       TIME OF TRADE
              QUANTITY OF SECURITIES
        IDENTIFICATION OF SECURITIES
                 CERTIFICATE NUMBERS
                       SENDER'S ROLE
                 SAFEKEEPING ACCOUNT
              CLEARING CORRESPONDENT
    RECEIVER/DELIVERER OF SECURITIES
       DELIVERER'S INSTRUCTING PARTY
           BENEFICIARY OF SECURITIES
            ACCOUNT WITH INSTITUTION
                BENEFICIARY OF MONEY
                          DEAL PRICE
                         DEAL AMOUNT
           DEAL AMOUNT EXCHANGE RATE
                    ACCRUED INTEREST
      ACCRUED INTEREST EXCHANGE RATE
ACCRUED INTEREST RATE AND CALC BASIS
                 SPECIAL CONCESSIONS
   SPECIAL CONCESSIONS EXCHANGE RATE
                   SETTLEMENT AMOUNT
                    FUNGIBILITY CODE
                 DENOMINATION CHOICE
                 FURTHER INFORMATION
      SENDER TO RECEIVER INFORMATION
                           NARRATIVE
               REGISTRATIONS DETAILS
** NUM
1234567890
** TAGAMT
:32B::33S::35A::32M:
** TAGRAT
:37J::37L::37S::37P::33T:
** TAGBIC
:84A::87A::57A::58A:
** TAGOTH
:26J::26L::26K::31T::35B::35E::57D::58D::77B::77D::79: :83R::83C::85C::87C::87D:
:88C::88D:
** TDEST/TDESN
:30: 01:23: 02:31P:03:26J:04:20: 05:31T:06:35A:07:35B:08:35E:09:83R:10:83C:11
:84A:12:87A:13:87C:13:87D:13:85C:14:88C:15:88D:15:57A:16:57D:16:58A:17:58D:17
:33T:18:32M:19:37J:20:34G:21:34H:31:37L:22:37S:23:33S:24:37P:25:32B:26:26L:27
:26K:28:77B:29:72: 30:79: 31:77D:32
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
