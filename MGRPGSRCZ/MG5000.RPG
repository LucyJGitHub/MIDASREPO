     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas MG Trans. file SWIFT seq. update')               *
      *****************************************************************
      *                                                               *
      *  Midas - Message Generation Module                            *
      *                                                               *
      *   MG5000 - UPDATE S.W.I.F.T. SEQUENCE NUMBERS ON              *
      *            TRANSACTION FILE                                   *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      *  Prev Amend No. CDL099             Date 06Oct17               *
      *                 CSW216             Date 14Mar16               *
      *                 CLE141             Date 08Feb16               *
      *                 CGL165             Date 17Feb15               *
      *                 CSW214             Date 25Nov14               *
      *                 CDL096             Date 22Sep14               *
      *                 CDL094             Date 11Jun14               *
      *                 MD022538           Date 24Sep13               *
      *                 MD023529           Date 19Nov13               *
      *                 MD023402           Date 18Nov13               *
      *                 MD022579           Date 02Oct13               *
      *                 MD023052           Date 25Oct13               *
      *                 MD022052           Date 09Sep13               *
      *                 CSW213             Date 03Jun13               *
      *                 CLE075BO           Date 06Aug12               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 CSW212             Date 03May12               *
      *                 CRE073             Date 06Dec10               *
      *                 CLE143             Date 06Dec10               *
      *                 CLE139             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 CER054             Date 07Apr09               *
      *                 CER048             Date 19May08               *
      *                 CER020             Date 19May08               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 CAS016             Date 28Feb06               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CDL049             Date 07Jul06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 CDL038             Date 10May05               *
      *                 CAS009             Date 16May05               *
      *                 CAS008             Date 16Jun04               *
      *                 CDL028             Date 07Feb05               *
      *                 CGL014             Date 20Oct03               *
      *                 CAP074             Date 08Aug02               *
      *                 217684             Date 12May03               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      *                 CLE028             Date 27Jun02               *
      *                 CAS004             Date 26Jun02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 204452             Date 03May02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CAP056             Date 13Mar02               *
      *                 CIR008             Date 13Mar02               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CLE011             Date 07Nov00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CSE023             Date 12Jul00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CIR005             Date 21Jan00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 169210             Date 19Oct99               *
      *                 CLE009             Date 26Apr99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 142403             Date 26Feb99               *
      *                 CLE007             Date 22May97               *
      *                 CDL002             Date 09Apr97               *
      *                 052254             Date 10Jan94               *
      *                 S01453             Date 14Dec93               *
      *                   042085           DATE 17AUG92               *
      *                   E40242           DATE 25JUN92               *
      *                   S01386           DATE 18MAY92               *
      *                   00000            DATE 00XXX00               *
      *                                                               *
      *****************************************************************
      *                                                               *
      *  MD046248 - Finastra Rebranding                               *
      *  CDL099 - Split Value Date (Recompile)                        *
      *  CSW216 - SWIFT Changes 2016 (Recompile)                      *
      *  CLE141 - Currency and Location Business Day Convention       *
      *           (Recompile)                                         *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CSW214 - SWIFT Changes 2014 (Recompile)                      *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  MD022538 - DLC0603 00002 failed to allocate LEFEEDL1         *
      *  MD023529 - DLC0603 seq 00001 failed in COB                   *
      *  MD023402 - Missing MT300 CANC for previous trade repository  *
      *  MD022579 - MT300 not generated when Trade Repo ID is changed *
      *  MD023052 - DMP in DLC0210A                                   *
      *  MD022052 - Action amend_Amend maturity date where trade repo *
      *             has SWIFT Id_MT360 for trade repo is not generated*
      *  CSW213 - SWIFT Changes 2013                                  *
      *  CLE075BO - COB Restructure - LE COB optimisation Phase 1     *
      *  CLE134 - Past Due Call Loan Processing (Recompile)           *
      *  CLE148 - Alpha Loan Reference                                *
      *  CSW212 - SWIFT 2012 Changes (Recompile)                      *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  CLE143 - Original Loan Contract Date & Effective Interest    *
      *           Rate (Recompile)                                    *
      *  CLE139 - Lending Fee Capitalisation (Recompile)              *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER054 - German Features - Church Tax (Recompile)            *
      *  CER048 - German Features - Taxes (Recompile)                 *
      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
      *           Midas Plus (Recompile)                              *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  CAS016 - IAS18 EIR Recalculation (Fee Amortisation Over      *
      *           Whole Period) -Recompile.                           *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type (Recompile)                  *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CAS009 - EIR/AC Accounting (Recompile)                       *
      *  CAS008 - IAS 39 Enhancements (Recompile)                     *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  CGL014 - Collaterals Processing (Recompile)                  *
      *  CAP074 - Lending API enhancements - Loans input.             *
      *  217684 - Authorisation User Malfunction (Recompile)          *
      *  CAS006 - Hedge Accounting Phase B                            *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *           (Recompile)                                         *
      *  CLE028 - Flat Rate Personal Loans (Rule of 78s)              *
      *           (Recompile)                                         *
      *  CAS004 - Hedge Accounting Phase A (Recompile)                *
      *  204452 - Recompiled due to changed PF/LEFEED.                *
      *  CAP056 - Automatic Authorisation of Interface deals          *
      *           (Recompile)                                         *
      *  CIR008 - FRA/IRS Deals Authorisation (Recompile)             *
      *  CLE011 - Rate Fixing Days for Lending Rollover Processing    *
      *           Recompile                                           *
      *  CSE023 - Treaty Withholding Tax (Recompiled)                 *
      *  CIR005 - FRA/IRS Business Day Conventions to DEALSDG         *
      *           (recompile)                                         *
      *   169210 - Duplicate hooks renamed from MG5000C004, MG5000C005*
      *            to MG5000CABQ, MG5000CABR                       *
      *  CLE009 - LE I/C Swift Message Generation for Fees            *
      *           Recompiled due to changes in LEFEED                 *
      *   142403 - For fee messages the sequence is maintained on     *
      *            lefeed alone.                                      *
      *  CLE007 - Customer Lending Enhancements - Others (T3)         *
      *   CDL002 - FX Netting                                         *
      *   052254 - RECOMPILED as CURRENT FACTOR amended from 9,8      *
      *            to 10,9                                            *
      *   S01453 - MARGIN AND FX POSITIONS/POINTS AND BASE CURRENCY   *
      *            POSITIONS/POINTS ADDED TO FX INPUT (RECOMPILED)    *
      *   042085 - RETURN LSWC AND LSWS CORRECTLY FOR MODULES OTHER   *
      *            THAN SE.                                           *
      *   E40242 - RE-COMPILED FOR CHANGE TO ASEQ                     *
      *   S01386 - MG/SE AMENDMENTS                                   *
      *    o Add trades file (LF/TRADS) to those that can be acessed  *
      *                                                               *
      *****************************************************************
      *                                                               *
      *  C R E A T I O N     P A R A M E T E R S                      *
      *****************************************************************
     F***DEALS** UF  E           K        DISK                           UC                 CLE075BO
     F***DEALS** UF  E           K        DISK                                     CLE075BO MD022538
     FDEALS   UF  E           K        DISK                           UC                    MD022538
     F                                              KCOMIT
     F***CLOAN** UF  E           K        DISK                           UC                 CLE075BO
     F***CLOAN** UF  E           K        DISK                                     CLE075BO MD022538
     FCLOAN   UF  E           K        DISK                           UC                    MD022538
     F            CLOANHHF                          KIGNORE
     F            CLOANCKF                          KIGNORE
     F            CLOANZ1F                          KIGNORE
     F                                              KCOMIT
     F***TRADS** UF  E           K        DISK                           UC          S01386 CLE075BO
     F***TRADS** UF  E           K        DISK                                     CLE075BO MD022538
     FTRADS   UF  E           K        DISK                           UC                    MD022538
     F                                              KCOMIT                S01386
     F/COPY WNCPYSRC,MG5000F001
     FFXNETML4UF  E           K        DISK                           U5  CDL002
     F                                              KCOMIT                CDL002
      *                                                                   CLE007
      ** Lending Fees Master File                                         CLE007
      *                                                                   CLE007
     F***LEFEEDL1UF  E           K        DISK         KINFSR *PSSR      UC          CLE007 CLE075BO
     F***LEFEEDL1UF  E           K        DISK         KINFSR *PSSR                CLE075BO MD022538
     FLEFEEDL1UF  E           K        DISK         KINFSR *PSSR      UC                    MD022538
     F                                              KCOMIT                CLE007
      *                                                                   CLE007
      ***Lending*Fees*Adjustment*for*Fee*Accrual********************CLE007142403
      ***                                                           CLE007142403
     F***LEFEADL1UF  E        K        DISK         KINFSR *PSSRUC  CLE007142403
     F***                                           KCOMIT          CLE007142403
     FDLRPIFL0UF  E           K        DISK         KINFSR *PSSR      UC                      CSW213
     F                                              KCOMIT                                    CSW213
     FMGHISTL5IF  E           K        DISK                                                 MD022579
      ********************************************************************
      *
      * ID C  F  H  L    FUNCTION OF INDICATORS
      *
      *    05            UPDAT/CHAIN to LF/DEALS
      *    06            UPDAT/CHAIN to LF/DEALSDG
      *    07            UPDAT/CHAIN to LF/CLOAN
      *    08            UPDAT/CHAIN to LF/TRADS                          S01386
      *    30            UPDAT/CHAIN to LF/FXNETML4                       CDL002
      *    09            UPDAT/CHAIN to LF/LEFEEDL1                       CLE007
      *    10            UPDAT/CHAIN to LF/LEFEADL1                       CLE007
      *    11            UPDAT/CHAIN to LF/DLRPIFL0                                           CSW213
      *
     E                    CPY@    1   1 80               copyright
      *
     E/COPY WNCPYSRC,MG5000E001
      *                                                                                       CAS006
      ** Rename Credit Risk Spread Field                                                      CAS006
      *                                                                                       CAS006
     ITRADSDF                                                                                 CAS006
     I              CRSK                            ASCRSK                                    CAS006
      *                                                                                       CAS006
     IFXNETMD0                                                            CDL002
     I              AMLSWC                          LSWC                  CDL002
     I              AMLSWS                          LSWS                  CDL002
     I/COPY WNCPYSRC,MG5000I001
     ISDBANK    E DSSDBANKPD
      **  Data structure for bank file
      *
     IDSFDY     E DSDSFDY
      **  Short data structure for access programs
      *
     IDSSDY     E DSDSSDY
      **  Long data structure for access programs
      *
     ISCSARD    E DSSCSARDPD                                              CLE007
      ***  External data structures for SAR Details                       CLE007
      *                                                                   CLE007
     ILDA         DS                            256
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
      **  Local data area
      *
     I            DS                                                      CLE007
     I                                        1  15 WFKEY                 CLE007
     I**********                              1   60KCNUM                              CLE007 CSD027
     I                                        1   6 KCNUM                                     CSD027
     I                                        7  110WFACL                 CLE007
     I**********                              7  120WLOAN                              CLE007 CLE148
     I                                        7  12 WLOAN                                     CLE148
     I                                       12  130WFLSEQ                CLE007
     I                                       13  140WLNSEQ                CLE007
     I                                       14  14 WFLAG                 CLE007
      *
      *****************************************************************
      *                   Index to subroutines                        *
      *  main process                                                 *
      ***INIT**Initial*Processing**************************************                     CLE075BO
      *  *INZSR - Initial Process                                     *                     CLE075BO
      *                                                               *
      *****************************************************************
     C/EJECT
      *****************************************************************
      * Main Process                                                  *
      **Calls*******INIT***Initial*processing**************************                     CLE075BO
      *****************************************************************
      *
      *
      **  Receive the Module Id, Transaction Number and the calling
      **  program id (confirmation or pay/receive program)
      *
     C           *ENTRY    PLIST
     C                     PARM           @MODI   2
     C                     PARM           @TRAN  15
     C                     PARM           @PROG   2
     C                     PARM           @MODE   1
     C                     PARM           MGLSWC  30
     C                     PARM           MGLSWS  30
     C                     PARM           @ERCD   1
      *****************************************************************                     CLE075BO
      ****Initial*processing*******************************************                     CLE075BO
      *****************************************************************                     CLE075BO
     C**********           EXSR INIT                                                        CLE075BO
      *
     C                     MOVE @TRAN     WFKEY  15                       CLE007
     C                     MOVEL@TRAN     MTRAN   60
     C                     MOVEL@TRAN     MTRANA  6                                           CLE148
      *
      **  DEALING transaction
      *
     C           @MODI     IFEQ 'DL'
     C*COP* WN*PYSRC*MG5000C004                                           169210
     C/COPY WNCPYSRC,MG5000CABQ                                           169210
     C**********           OPEN DEALS                                                       CLE075BO
     C                     OPEN DEALS                                                       MD022538
     C           MTRAN     CHAINDEALS                05
      *
      **  Dealing transaction not found
      *
     C           *IN05     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '001'     DBASE            * * * * * * * *
     C                     MOVELMTRAN     DBKEY            *  DBERR 001  *
     C                     MOVEL'LF/DEALS'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     END
     C*COP* WN*PYSRC*MG5000C005                                           169210
     C/COPY WNCPYSRC,MG5000CABR                                           169210
      *
      **  FRA/IRS transaction
      *
     C           @MODI     IFEQ 'FI'
     C**********           OPEN DEALS                                                       CLE075BO
     C                     OPEN DEALS                                                       MD022538
     C           MTRAN     CHAINDEALSDGF             06
      *
      **  Dealing transaction not found
      *
     C           *IN06     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '002'     DBASE            * * * * * * * *
     C                     MOVELMTRAN     DBKEY            *  DBERR 002  *
     C                     MOVEL'DEALSDG 'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     END
      *
      **  LENDING transaction
      *
     C           @MODI     IFEQ 'LE'
     C**********           OPEN CLOAN                                                       CLE075BO
     C                     OPEN CLOAN                                                       MD022538
     C********** MTRAN     CHAINCLOAN                07                                       CLE148
     C           MTRANA    CHAINCLOAN                07                                       CLE148
      *
      **  Lending transaction not found
      *
     C           *IN07     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '003'     DBASE            * * * * * * * *
     C**********           MOVELMTRAN     DBKEY            *  DBERR 003  *                    CLE148
     C                     MOVELMTRANA    DBKEY                                               CLE148
     C                     MOVEL'LF/CLOAN'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     END
      *
      **  SECURITIES TRADING transaction (trade)                          S01386
     C           @MODI     IFEQ 'SE'                                      S01386
     C                     MOVE MTRAN     MTRAD   6                       S01386
     C**********           OPEN TRADS                                                S01386 CLE075BO
     C                     OPEN TRADS                                                       MD022538
     C           MTRAD     CHAINTRADS                08                   S01386
      *                                                                   S01386
      **  Trade not found                                                 S01386
     C           *IN08     IFEQ '1'                                       S01386
     C           *LOCK     IN   LDA                                       S01386
     C                     MOVE '008'     DBASE            * * * * * * * *S01386
     C                     MOVELMTRAD     DBKEY            *  DBERR 008  *S01386
     C                     MOVEL'LF/TRADS'DBFILE           * * * * * * * *S01386
     C                     OUT  LDA                                       S01386
     C                     EXSR *PSSR                                     S01386
     C                     END                                            S01386
      *                                                                   S01386
     C                     END                                            S01386
      *                                                                   CLE007
     C/COPY WNCPYSRC,MG5000C001
      **  Fees and Fees Settlement Transaction                            CLE007
      *                                                                   CLE007
     C           CLE007    IFEQ 'Y'                                       CLE007
      *                                                                   CLE007
     C           FKEY      KLIST                                          CLE007
     C**********           KFLD           KCNUM   60                                   CLE007 CSD027
     C                     KFLD           KCNUM   6                                           CSD027
     C                     KFLD           KFACL   50                      CLE007
     C**********           KFLD           KLOAN   60                                   CLE007 CLE148
     C                     KFLD           KLOAN   6                                           CLE148
     C                     KFLD           KFSEQ   20                      CLE007
      *                                                                   CLE007
      ** Set values for key fields                                        CLE007
      *                                                                   CLE007
     C           WFLAG     IFEQ *BLANK                                    CLE007
     C                     Z-ADDWFACL     KFACL                           CLE007
     C**********           Z-ADD0         KLOAN                                        CLE007 CLE148
     C                     MOVEL*BLANKS   KLOAN                                               CLE148
     C                     Z-ADDWFLSEQ    KFSEQ                           CLE007
     C                     ELSE                                           CLE007
     C                     Z-ADD0         KFACL                           CLE007
     C**********           Z-ADDWLOAN     KLOAN                                        CLE007 CLE148
     C                     MOVELWLOAN     KLOAN                                               CLE148
     C                     Z-ADDWLNSEQ    KFSEQ                           CLE007
     C                     ENDIF                                          CLE007
      *                                                                   CLE007
     C           @MODI     IFEQ 'LF'                                      CLE007
     C           @MODI     OREQ 'LS'                                      142403
     C**********           OPEN LEFEEDL1                                             CLE007 CLE075BO
     C                     OPEN LEFEEDL1                                                    MD022538
     C           FKEY      CHAINLEFEEDL1             09                   CLE007
     C           *IN09     IFEQ '1'                                       CLE007
     C           *LOCK     IN   LDA                                       CLE007
     C                     MOVE '011'     DBASE            * * * * * * * *CLE007
     C                     MOVEL@TRAN     DBKEY            *  DBERR 011  *CLE007
     C                     MOVEL'LEFEEDL1'DBFILE           * * * * * * * *CLE007
     C                     OUT  LDA                                       CLE007
     C                     EXSR *PSSR                                     CLE007
     C                     ENDIF                                          CLE007
     C                     ENDIF                                          CLE007
      *                                                                   CLE007
     C***********@MODI     IFEQ 'LS'                                CLE007142403
     C***********          OPEN LEFEADL1                            CLE007142403
     C***********FKEY      CHAINLEFEADL1             10             CLE007142403
     C************IN10     IFEQ '1'                                 CLE007142403
     C************LOCK     IN   LDA                                 CLE007142403
     C***********          MOVEL'012'     DBASE      * * * * * * * *CLE007142403
     C***********          MOVEL@TRAN     DBKEY      *  DBERR 012  *CLE007142403
     C***********          MOVEL'LEFEADL1'DBFILE     * * * * * * * *CLE007142403
     C***********          OUT  LDA                                 CLE007142403
     C***********          EXSR *PSSR                               CLE007142403
     C***********          ENDIF                                    CLE007142403
     C***********          ENDIF                                    CLE007142403
      *                                                                   CLE007
     C                     ENDIF                                          CLE007
      *                                                                   S01386
      *                                                                   CDL002
      ** If the parameter module id is Netting (NT).Access FXNETMD        CDL002
      *                                                                   CDL002
     C           @MODI     IFEQ 'NT'                                      CDL002
     C***********          OPEN FXNETML4                                  CDL002
     C           MTRAN     CHAINFXNETML4             30                   CDL002
      *                                                                   CDL002
      **  Lending transaction not found                                   CDL002
      *                                                                   CDL002
     C           *IN30     IFEQ '1'                                       CDL002
     C           *LOCK     IN   LDA                                       CDL002
     C                     MOVE '015'     DBASE              * * * * * * *CDL002
     C                     MOVELMTRAN     DBKEY              * DBERR 015 *CDL002
     C                     MOVEL'FXNETML4'DBFILE             * * * * * * *CDL002
     C                     OUT  LDA                                       CDL002
     C                     EXSR *PSSR                                     CDL002
     C                     END                                            CDL002
      *                                                                   CDL002
     C                     ENDIF                                          CDL002
      *                                                                   CDL002
     C/COPY WNCPYSRC,MG5000C004
      *                                                                   CDL002
      **  Save current S.W.I.F.T. sequence numbers. Note that SE does
      **  not produce confirmations. Return MGLSWC such that field 21
      **  will be formatted correctly.
      *   same for netting                                                CDL002
     C           @MODI     IFNE 'SE'                                      042085
     C           @MODI     ANDNE'NT'                                      CDL002
     C/COPY WNCPYSRC,MG5000C002
     C                     Z-ADDLSWC      MGLSWC                          042085
     C                     ELSE                                           042085
     C                     Z-ADDLSWS      MGLSWC
     C                     END                                            042085
      *                                                                   042085
     C                     Z-ADDLSWS      MGLSWS
      **********                                                                            MD022052
      ****Update*the*S.W.I.F.T.*sequence*numbers**************                              MD022052
     C********** @MODE     IFEQ 'U'                                                         MD022052
     C**********           EXSR UPMODE                                                      MD022052
     C**********           END                                                              MD022052
      *
      **  S.W.I.F.T. 2013 MT300 Message Generation                                            CSW213
     C           @MODI     IFEQ 'FX'                                                          CSW213
     C           @MODI     OREQ 'FP'                                                          CSW213
     C           @MODI     OREQ 'FS'                                                          CSW213
     C           @MODI     OREQ 'CX'                                                          CSW213
     C           @MODI     OREQ 'PI'                                                          CSW213
     C           @MODI     OREQ 'SI'                                                          CSW213
     C           @MODI     OREQ 'OP'                                                          CSW213
     C           @MODI     OREQ 'OT'                                                          CSW213
     C           @MODI     OREQ 'SW'                                                          CSW213
     C           @MODI     OREQ 'FR'                                                          CSW213
     C           @MODI     OREQ 'RS'                                                          CSW213
     C           @MODI     OREQ 'RX'                                                          CSW213
     C           @MODI     OREQ 'RP'                                                          CSW213
     C           @MODI     OREQ 'RR'                                                          CSW213
     C           @MODI     OREQ 'RF'                                                          CSW213
      *                                                                                       CSW213
     C           DLKEY     KLIST                                                              CSW213
     C                     KFLD           DLAPID  4                                           CSW213
     C                     KFLD           DLTRRF 16                                           CSW213
      *                                                                                       CSW213
     C                     MOVELMTRAN     DLTRRF                                              CSW213
      *                                                                                       CSW213
     C           @MODI     IFEQ 'FX'                                                          CSW213
     C           @MODI     OREQ 'FP'                                                          CSW213
     C           @MODI     OREQ 'FS'                                                          CSW213
     C           @MODI     OREQ 'CX'                                                          CSW213
     C           @MODI     OREQ 'PI'                                                          CSW213
     C           @MODI     OREQ 'SI'                                                          CSW213
     C           @MODI     OREQ 'OP'                                                          CSW213
     C           @MODI     OREQ 'OT'                                                          CSW213
     C           @MODI     OREQ 'SW'                                                          CSW213
     C                     MOVE 'FXDL'    DLAPID                                              CSW213
     C                     ENDIF                                                              CSW213
     C           @MODI     IFEQ 'FR'                                                          CSW213
     C**********           MOVEL'FRA'     DLAPID                                     CSW213 MD023529
     C                     MOVEL'FRA '    DLAPID                                            MD023529
     C                     ENDIF                                                              CSW213
     C           @MODI     IFEQ 'RS'                                                          CSW213
     C                     MOVE 'SIRS'    DLAPID                                              CSW213
     C                     ENDIF                                                              CSW213
     C           @MODI     IFEQ 'RX'                                                          CSW213
     C                     MOVE 'CIRS'    DLAPID                                              CSW213
     C                     ENDIF                                                              CSW213
     C           @MODI     IFEQ 'RP'                                                          CSW213
     C           @MODI     OREQ 'RR'                                                          CSW213
     C           @MODI     OREQ 'RF'                                                          CSW213
     C                     MOVE 'CACF'    DLAPID                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
     C                     OPEN DLRPIFL0                                                      CSW213
     C           DLKEY     CHAINDLRPIFL0             11                                       CSW213
      *                                                                                       CSW213
      **  Dealing transaction not found                                                       CSW213
      *                                                                                       CSW213
     C           *IN11     IFEQ '1'                                                           CSW213
     C           *LOCK     IN   LDA                                                           CSW213
     C                     MOVE '016'     DBASE                                               CSW213
     C                     MOVELMTRAN     DBKEY                                               CSW213
     C                     MOVEL'DLRPIFL0'DBFILE                                              CSW213
     C                     OUT  LDA                                                           CSW213
     C                     EXSR *PSSR                                                         CSW213
     C                     END                                                                CSW213
      *                                                                                     MD022579
     C           RIPRED    IFNE *BLANKS                                                     MD022579
     C           RICFNR    ANDNE*ZERO                                                       MD022579
     C           RIPRED    ORNE *BLANKS                                                     MD023402
     C           RITRID    ANDEQ*BLANKS                                                     MD023402
     C                     MOVELMTRAN     WDLNO   6                                         MD022579
     C           HSTKEY    KLIST                                                            MD022579
     C                     KFLD           WDLNO                                             MD022579
     C                     KFLD           RIPRED                                            MD022579
     C                     KFLD           SEQ     3                                         MD022579
     C                     MOVEL'999'     SEQ                                               MD022579
     C           HSTKEY    SETLLMGHISTL5                                                    MD022579
     C                     READPMGHISTL5                 14                                 MD022579
     C           *IN14     IFEQ '0'                                                         MD022579
     C                     MOVELHSSEQ     MGLSWS                                            MD022579
     C                     MOVELHSSEQ     MGLSWC                                            MD022579
     C                     ENDIF                                                            MD022579
      *                                                                                     MD022579
     C                     ELSE                                                             MD022579
      *                                                                                     MD022052
     C                     Z-ADDRICFNR    MGLSWS                                            MD022052
     C                     Z-ADDRICFNR    MGLSWC                                            MD022052
     C                     ENDIF                                                            MD022579
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      **  Update the S.W.I.F.T. sequence numbers                                            MD022052
      *                                                                                     MD022052
     C           @MODE     IFEQ 'U'                                                         MD022052
     C                     EXSR UPMODE                                                      MD022052
     C                     END                                                              MD022052
      *                                                                                     MD023052
      ** Close file                                                                         MD023052
      *                                                                                     MD023052
     C                     EXSR SRCLSE                                                      MD023052
      *                                                                                     MD022052
     C**********           SETON                     LR                                     CLE075BO
     C                     RETRN
     C/EJECT
      *****************************************************************
      *   UPMODE  Update the S.W.I.F.T. sequence numbers              *
      *   Called by - main process                                    *
      *   Calls     -                                                 *
      *****************************************************************
      *
     C           UPMODE    BEGSR
      *
      **  Increment S.W.I.F.T. seq. number on the transaction file
      **  (S.W.I.F.T. conf. seq. updated when conf. calling program)
      *
     C                     ADD  1         LSWS
     C           @PROG     IFEQ 'CE'
     C                     Z-ADDLSWS      LSWC
     C                     END
      *
      **  DEALING transaction
      *
     C           @MODI     IFEQ 'DL'
     C/COPY WNCPYSRC,MG5000C006
      *
      **  Foreign Exchange deal (swaps/outrights)
     C           RCDT      IFEQ 'B'
     C                     UPDATDEALSDBF               05
     C                     END
      *
      **  Takings/Placings/Time Deposits/Loans
     C           RCDT      IFEQ 'C'
     C                     UPDATDEALSDCF               05
     C                     END
      *
      **  Negotiable Assets Purchased
     C           RCDT      IFEQ 'D'
     C                     UPDATDEALSDDF               05
     C                     END
      *
      **  Negotiable Assets Sold
     C           RCDT      IFEQ 'E'
     C                     UPDATDEALSDEF               05
     C                     END
      *
      **  Update of dealing record fails
      *
     C           *IN05     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '004'     DBASE            * * * * * * * *
     C                     MOVELMTRAN     DBKEY            *  DBERR 004  *
     C                     MOVEL'LF/DEALS'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
     C                     END
     C/COPY WNCPYSRC,MG5000C007
      *
      **  FRA/IRS transaction
      *
     C           @MODI     IFEQ 'FI'
     C                     UPDATDEALSDGF               06
      *
      **  Update of dealing record fails
      *
     C           *IN06     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '005'     DBASE            * * * * * * * *
     C                     MOVELMTRAN     DBKEY            *  DBERR 005  *
     C                     MOVEL'DEALSDG 'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     END
      *
      **  LENDING transaction
      *
     C           @MODI     IFEQ 'LE'
     C                     UPDATCLOANCLF               07
      *
      **  Update of loan record fails
      *
     C           *IN07     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '006'     DBASE            * * * * * * * *
     C**********           MOVELMTRAN     DBKEY            *  DBERR 006  *                    CLE148
     C                     MOVELMTRANA    DBKEY                                               CLE148
     C                     MOVEL'LF/CLOAN'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     END
      *                                                                   S01386
      **  SECUITIES TRADING transaction (trade)                           S01386
     C           @MODI     IFEQ 'SE'                                      S01386
     C                     UPDATTRADSDF                08                 S01386
      *                                                                   S01386
      **  Update of trade record fails                                    S01386
     C           *IN08     IFEQ '1'                                       S01386
     C           *LOCK     IN   LDA                                       S01386
     C                     MOVE '009'     DBASE            * * * * * * * *S01386
     C                     MOVELMTRAD     DBKEY            *  DBERR 009  *S01386
     C                     MOVEL'LF/TRADS'DBFILE           * * * * * * * *S01386
     C                     OUT  LDA                                       S01386
     C                     EXSR *PSSR                                     S01386
     C                     END                                            S01386
     C                     END                                            S01386
      *                                                                   CLE007
     C/COPY WNCPYSRC,MG5000C003
      **  NETTING transaction                                             CDL002
      *                                                                   CDL002
     C           @MODI     IFEQ 'NT'                                      CDL002
     C                     UPDATFXNETMD0               30                 CDL002
      *                                                                   CDL002
      **  Update of loan record fails                                     CDL002
      *                                                                   CDL002
     C           *IN30     IFEQ '1'                                       CDL002
     C           *LOCK     IN   LDA                                       CDL002
     C                     MOVE '014'     DBASE            * * * * * * * *CDL002
     C*********************MOVELMTRAN*****DBKEY      *  DBERR 014  *CDL002CLE007
     C                     MOVELMTRAN     DBKEY            *  DBERR 015  *CLE007
     C                     MOVEL'FXNETML4'DBFILE           * * * * * * * *CDL002
     C                     OUT  LDA                                       CDL002
     C                     EXSR *PSSR                                     CDL002
     C                     END                                            CDL002
     C                     END                                            CDL002
      *                                                                   CDL002
      **  Fees and Fees Settlement Transaction                            CLE007
      *                                                                   CLE007
     C           CLE007    IFEQ 'Y'                                       CLE007
     C           @MODI     IFEQ 'LF'                                      CLE007
     C           @MODI     OREQ 'LS'                                      142403
     C                     UPDATLEFEEDF                09                 CLE007
      *                                                                   CLE007
      **  Update of Fees record fails                                     CLE007
      *                                                                   CLE007
     C           *IN09     IFEQ '1'                                       CLE007
     C           *LOCK     IN   LDA                                       CLE007
     C                     MOVE '013'     DBASE            * * * * * * * *CLE007
     C                     MOVELMTRAN     DBKEY            *  DBERR 013  *CLE007
     C                     MOVEL'LEFEEDL1'DBFILE           * * * * * * * *CLE007
     C                     OUT  LDA                                       CLE007
     C                     EXSR *PSSR                                     CLE007
     C                     ENDIF                                          CLE007
     C                     ENDIF                                          CLE007
      *                                                                   CLE007
     C***********@MODI     IFEQ 'LS'                                CLE007142403
     C***********          UPDATLEFEEADF               10           CLE007142403
      ***********                                                   CLE007142403
      ****Update*of Fees Settlement record fails                    CLE007142403
      ***********                                                   CLE007142403
     C************IN10     IFEQ '1'                                 CLE007142403
     C************LOCK     IN   LDA                                 CLE007142403
     C***********          MOVE '014'     DBASE      * * * * * * * *CLE007142403
     C***********          MOVELMTRAN     DBKEY      *  DBERR 014  *CLE007142403
     C***********          MOVEL'LEFEADL1'DBFILE     * * * * * * * *CLE007142403
     C***********          OUT  LDA                                 CLE007142403
     C***********          EXSR *PSSR                               CLE007142403
     C***********          ENDIF                                    CLE007142403
     C***********          ENDIF                                    CLE007142403
      *                                                                   CLE007
     C                     ENDIF                                          CLE007
     C/COPY WNCPYSRC,MG5000C005
      *                                                                                       CSW213
      **  S.W.I.F.T. 2013 MT300 Message Generation                                            CSW213
     C           @MODI     IFEQ 'FX'                                                          CSW213
     C           @MODI     OREQ 'FP'                                                          CSW213
     C           @MODI     OREQ 'FS'                                                          CSW213
     C           @MODI     OREQ 'CX'                                                          CSW213
     C           @MODI     OREQ 'PI'                                                          CSW213
     C           @MODI     OREQ 'SI'                                                          CSW213
     C           @MODI     OREQ 'OP'                                                          CSW213
     C           @MODI     OREQ 'OT'                                                          CSW213
     C           @MODI     OREQ 'SW'                                                          CSW213
     C           @MODI     OREQ 'FR'                                                          CSW213
     C           @MODI     OREQ 'RS'                                                          CSW213
     C           @MODI     OREQ 'RX'                                                          CSW213
     C           @MODI     OREQ 'RP'                                                          CSW213
     C           @MODI     OREQ 'RR'                                                          CSW213
     C           @MODI     OREQ 'RF'                                                          CSW213
     C           @PROG     IFEQ 'CE'                                                          CSW213
     C                     ADD  1         RICFNR                                              CSW213
     C                     MOVE 'N'       RICFRQ                                              CSW213
     C                     MOVE 'Y'       RICFGN                                              CSW213
     C**********           MOVE *BLANKS   RIPRED                                     CSW213 MD022579
     C                     UPDATDLRPIFD0               11                                     CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
     C                     ENDSR
     C/EJECT                                                                                MD023052
      *****************************************************************                     MD023052
      *                                                               *                     MD023052
      *   SRCLSE - Close file                                         *                     MD023052
      *                                                               *                     MD023052
      *****************************************************************                     MD023052
      *                                                                                     MD023052
     C           SRCLSE    BEGSR                                                            MD023052
      *                                                                                     MD023052
     C           @MODI     IFEQ 'FX'                                                        MD023052
     C           @MODI     OREQ 'FP'                                                        MD023052
     C           @MODI     OREQ 'FS'                                                        MD023052
     C           @MODI     OREQ 'CX'                                                        MD023052
     C           @MODI     OREQ 'PI'                                                        MD023052
     C           @MODI     OREQ 'SI'                                                        MD023052
     C           @MODI     OREQ 'OP'                                                        MD023052
     C           @MODI     OREQ 'OT'                                                        MD023052
     C           @MODI     OREQ 'SW'                                                        MD023052
     C           @MODI     OREQ 'FR'                                                        MD023052
     C           @MODI     OREQ 'RS'                                                        MD023052
     C           @MODI     OREQ 'RX'                                                        MD023052
     C           @MODI     OREQ 'RP'                                                        MD023052
     C           @MODI     OREQ 'RR'                                                        MD023052
     C           @MODI     OREQ 'RF'                                                        MD023052
      *                                                                                     MD023052
     C                     CLOSEDLRPIFL0                                                    MD023052
      *                                                                                     MD023052
     C                     ENDIF                                                            MD023052
      *                                                                                     MD023052
     C           @MODI     IFEQ 'DL'                                                        MD022538
     C           @MODI     OREQ 'FI'                                                        MD022538
     C                     CLOSEDEALS                                                       MD022538
     C                     ENDIF                                                            MD022538
      *                                                                                     MD022538
     C           @MODI     IFEQ 'LE'                                                        MD022538
     C                     CLOSECLOAN                                                       MD022538
     C                     ENDIF                                                            MD022538
      *                                                                                     MD022538
     C           @MODI     IFEQ 'SE'                                                        MD022538
     C                     CLOSETRADS                                                       MD022538
     C                     ENDIF                                                            MD022538
      *                                                                                     MD022538
     C           CLE007    IFEQ 'Y'                                                         MD022538
     C           @MODI     IFEQ 'LF'                                                        MD022538
     C           @MODI     OREQ 'LS'                                                        MD022538
     C                     CLOSELEFEEDL1                                                    MD022538
     C                     ENDIF                                                            MD022538
     C                     ENDIF                                                            MD022538
      *                                                                                     MD022538
     C                     ENDSR                                                            MD023052
     C/EJECT
      *****************************************************************
      ****INIT*-*inital*process****************************************                     CLE075BO
      *   *INZSR - Initial Process                                    *                     CLE075BO
      *   Called by - main process                                    *
      *   Calls     -                                                 *
      *****************************************************************
      *
     C********** INIT      BEGSR                                                            CLE075BO
     C           *INZSR    BEGSR                                                            CLE075BO
      *
     C                     MOVEACPY@      BIS@   80
      *
      **  Set up LDA for database error processing
      *
     C           *NAMVAR   DEFN           LDA
     C           *LOCK     IN   LDA
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     MOVEL'MG5000'  DBPGM
     C                     MOVE *BLANKS   DBASE
     C                     OUT  LDA
      *
      **  Access SDBANKPD for Midas rundate
      *
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '007'     DBASE            * * * * * * * *
     C                     MOVEL'FIRST'   DBKEY            *  DBERR 007  *
     C                     MOVEL'SDBANKPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *                                                                   CLE007
     C                     CALL 'AOSARDR0'                                CLE007
     C                     PARM '*BLANKS' @RTCD   7                       CLE007
     C                     PARM '*KEY   ' @OPTN   7                       CLE007
     C                     PARM 'CLE007'  WSARD   6                       CLE007
     C           SCSARD    PARM SCSARD    DSFDY                           CLE007
     C           @RTCD     IFEQ *BLANKS                                   CLE007
     C                     MOVE 'Y'       CLE007  1                       CLE007
     C                     ELSE                                           CLE007
     C                     MOVE 'N'       CLE007                          CLE007
      *                                                                   CLE007
      ** Handle Database Error                                            CLE007
      *                                                                   CLE007
     C           @RTCD     IFNE '*NRF    '                                CLE007
     C           *LOCK     IN   LDA                        ************   CLE007
     C                     MOVEL'SCSARDPD'DBFILE           ************   CLE007
     C                     MOVEL'010'     DBASE            * DBERR 10 *   CLE007
     C                     MOVEL'CLE007'  DBKEY            ************   CLE007
     C                     OUT  LDA                                       CLE007
     C                     EXSR *PSSR                                     CLE007
     C                     ENDIF                                          CLE007
      *                                                                   CLE007
     C                     ENDIF                                          CLE007
      *
     C/COPY WNCPYSRC,MG5000C008
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   *PSSR - error handling                                      *
      *****************************************************************
      *
     C           *PSSR     BEGSR
     C                     MOVE 'Y'       @ERCD
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     ENDSR
     C/EJECT
      *
** CPY@   Object Copyright
(c) Finastra International Limited 2001
