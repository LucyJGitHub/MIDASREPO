     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas MM Update forward book')                         *
     F****************************************************************
     F*                                                              *
     F*  Midas - MM Dealer Module
     F*                                                              *
     F*     MM0075    - UPDATE FORWARD BOOK DETAILS                  *
     F*                                                              *
     F*   Function:   This program updates the Money Market forward  *
     F*   (I/C)       book file (MMFWDDPP) during I/C.               *
     F*                                                              *
     F*     Called by: MM0078  - Update MM database.                 *
     F*                                                              *
     F*     Calls    : none                                          *
     F*                                                              *
      *  (c) Finastra International Limited 2001                      *
     F*                                                              *
      *  Last Amend No. MD046248           Date 27Oct17               *
      *  Prev Amend No. MD047993           Date 23Sep17               *
      *                 MD035545           Date 11Sep15               *      
      *                 CDL094             Date 11Jun14               *
      *                 CDL093             Date 08Apr14               *
      *                 AR996895           Date 25Nov12               *
      *                 263666             Date 01Feb10               *
      *                 CER059             Date 19Jul10               *
      *                 CER016A            Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 246141             Date 26Mar07               *
      *                 164847             Date 30Nov06               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242286             Date 25Sep06               *
      *                 CSD027             Date 09Dec05               *
      *                 CIR013             Date 25Apr05               *
      *                 CDL038             Date 10May05               *
      *                 CDL033             Date 10Feb05               *
      *                 CDL022             Date 03Feb04               *
      *                 CDL020             Date 03Feb04               *
      *                 CDL017             Date 03Feb04               *
      *                 CGL029             Date 01Sep03               *
      *                 CDL010             Date 02Aug02               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CIR004             Date 20Jan00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 163136             Date 07Jul99               *
      *                 147381             Date 11Nov98               *
     F*                 CAP002             DATE 23Feb98               *
     F*                 126017             DATE 18NOV97               *
     F*                 097885             DATE 03FEB97               *
     F*                 CAC001             DATE 01FEB96               *
     F*                 092454             DATE 27JUN96               *
     F*                 095244             DATE 01NOV95               *
     F*                 095238             DATE 31OCT95               *
     F*                 S01486             DATE 28OCT94               *
     F*                 061426             DATE 30SEP93               *
     F*                 056095             DATE 07JUN93               *
     F*                 S01378             DATE 13APR92               *
     F*                 S01392             DATE 24AUG92               *
     F*                    E36024             DATE   24FEB92         *
     F*                    E25631             DATE   26JUN91         *
     F*                    RT0150             DATE   12JUN91         *
     F*                    S01279             DATE    8APR91         *
     F*                    DT0015             DATE   20MAR91         *
     F*                    E14186             DATE   21JAN90         *
     F*                    E21172             DATE   21JAN90         *
     F*                    E20679             DATE   21JAN90         *
     F*                    E20540             DATE   11JAN90         *
     F*                    S01227             DATE   20DEC89         *
     F*                    E19980             DATE   17NOV89         *
     F*                E173                   DATE   15DEC89         *
     F*      AMEND NO. E19639                 DATE   05OCT89         *
     F*      AMEND NO. S01218                 DATE   11/08/89        *
     F*      AMEND NO. S01194                 DATE   12/07/89        *
     F*      AMEND NO. E18380                 DATE   18/05/89        *
     F*      AMEND NO. E17051                 DATE   08/03/89        *
     F*      AMEND NO. E12279                 DATE   15/03/88        *
     F*                E12312                 DATE   11/03/88        *
     F*                S01149                 DATE   24/02/88        *
     F*                                                              *
     F****************************************************************
     F*                                                              *
      *  MD046248 - Finastra Rebranding                               *
      *  MD047993 - Modified MD035545. Removed dependency on Accrue   *
      *             on Last Day indicator.                            *
      *  MD035545 - LE: Interest Calculation in Leap year. Consider   *
      *             Accrue on Last Day Indicator for method 6.        *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  CDL093 - MM Interest calculation type 9.                     *
      *  AR996895 - Incorrect accrual interest calculation            *
      *             (Child:AR996897) (Recompile)                      *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *           to Midas Plus                                       *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over ZINTDY.                              *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CDL033 - Floating Rate CDs Issued                            *
      *  CDL022 - Deal Amendment Changes (Recompile)                  *
      *  CDL020 - Apply Base Rate at Value Date (Recompile)           *
      *  CDL017 - Penalty Fee & Early Maturity of Fixed Term Loan/Dep *
      *           (Recompile)                                         *
      *  CGL029 - Increase Account Code to 10 digits                  *
     F*  CDL010 - Prevent last user that actioned the trade from      *
     F*           authorising it.Recompile due to changes in MMDEAMPP *
      *  CIR004 - Dealing Calculation Method Change                   *
      *         - Recompiled due to ZINTDY changes                    *
     F*  163136 - Interest Calculation Method '6'  showing incorrect -*
     F*           ZERO - amount . Addition to Core #126017 which dealt*
     F*           with the issue. It introduced an additional  INT6DY *
     F*           field in s-routine ZINTDY in  /COPY ZSRSRC/ZINTDYZ2 *
     F*           which in turn is usually called from GLINTC s-routine
     F*           in /COPY  ZSRSRC/ GLINTCZ1 .  However, there are at *
     F*           least a dozen other pgms that use ZINTDY but do     *
     F*           GLINTC-processing within the pgms calculation specs *
     F*  147381 - Reset Return code indicator.                       *
     F*  CAP002 - Changed as part of the MM APIs creation to          *
     F*           switch *INU7 and *INU8 of before they are used.     *
     F*           They are used for internal communication
     F*           within this program, but in some circumstances
     F*           they can be on before this program starts, so       *
     F*           error conditions can be incorrectly reported.       *
     F*  126017 - Correction to interest calculation for calculation  *
     F*           basis 6 in SR/GLINTC - recompile program.           *
     F*  097885 - Recompiled for wrong calculation of number of day   *
     F*           interest (ZINTDYZ2).                                *
     F*  CAC001 - Profit Centre Accounting Development:               *
     F*           Recompiled only.                                    *
     F*  092454 - MM net amount in MM Cost to Close Enquiry is        *
     F*           incorrect - fix is to first add the movements in    *
     F*           to the total and then subtract the movements out,   *
     F*           to give a true net figure.                          *
     F*  095244 - Recompiled for Calculation method 3                 *
     F*  095238 - Recompiled for Calculation method 3                 *
     F*  S01486 - Portfolio Management Upgrade to Release 10.         *
     F*           Recompile Only.                                     *
     F*  061426 - Recompile after ZDATE9 correction                  *
     F*  056095 - Interest not calculated consistently in MM.         *
     F*           SR. MM1009 was externally defined as ZINTDY,        *
     F*           while SR. ZA0710 and ZA0680 were replaced by        *
     F*           the externally defined standard SR. ZDATE9 and      *
     F*           ZDAT10, respectively.  Seventeen MM programs        *
     F*           were amended.                                       *
      *     S01378 - Facilitates the partial sale of a parcel        *
      *              of negotiable instruments which have been       *
      *              previously input to the system as a single      *
      *              transaction (was MOF53). Include processing     *
      *              for NAS for partial selling of NAB.             *
     F*     S01392 - JAP.SUB-MODULE INCORPORATION (CORE)             *
     F*              a) Front-Up Interest - interest added/deducted  *
     F*                 at value date rather than maturity.          *
     F*              b) Interest rounded down (new subroutine MM1030)*
     F*              c) First & Last day interest - int due for every*
     F*                 day that deal is live.                       *
     F*     E36024 - Averate rate is being corrupted by amendments   *
     F*     E25631 - Remove E21172 (applicable to R2 MMSTDAPP only)  *
     F*     RT0150 - RECOMPILE PROGRAM FOR CHANGE IN MMSTDSPP        *
     F*     S01279 - Replace CTC with Average rate on TM Daily       *
     F*              Summary enquiry.                                *
     F*              ALSO error fix to correct interest amount calc. *
     F*              pgm muddles up date formats                     *
     F*               - Discounted Bills were being processed as     *
     F*                 interest bearing NAs                         *
     F*               - NA'S SOLD CHKS WRONG DATE FMT FOR INT PROCSNG*
     F*               - DISCOUNTED NAS'S HAD SIGN OF AMOUNTS WRONG   *
     F*                 SO THE INTEREST WAS CALC. WRONG              *
     F*            - Date of last update incorrectly set up as next  *
     F*              working day number.                             *
     F*                                                              *
      *     DT0015  -   RECOMPILED
     F*                                                              *
     F*     E14186 - ENSURE THE TOTAL-FUNDS-LENT FIELD ON MMFWUTLL   *
     F*              IS INCREMENTED CORRECTLY.                       *
     F*                                                              *
     F*     E21172 - Data structure for file MMSTDAPP not updated    *
     F*              when extra fields added re Extended settlements.*
     F*              Subsequently Pgm crashes due array index being  *
     F*              invalid.                                        *
     F*                                                              *
     F*     E20679 - For checking original deal type CCOGDT is used. *
     F*              This field is defined in the program however no *
     F*              value is entered into it.The correct field is   *
     F*              IGOGDT.                                         *
     F*     E20540 - Error in the calculation of Face Value Total    *
     F*              (HVNSFV) and the discount value for N/A         *
     F*                                                              *
     F*     S01227 - RECOMPILED FOR EXTENDED SETTLEMENTS INCORPORATION
     F*     E19980 - The interest amount is 10X too small,and the    *
     F*              interest is added to the file (MMFWDTPP) twice  *
     F*              for L/D deal.                                   *
     F*              The subroutine MM1007 is not the same as the    *
     F*              standard subroutine used by other programs. The *
     F*              interest amount is being multiplied by a factor *
     F*              10 before exit.                                 *
     F*              When MM1007 is replaced by a standard subroutine*
     F*              MM1030, multiply by 10 is not added to it.      *
     F*              In order to keep MM1030 as the same, multi-     *
     F*              plication will be added after the call of       *
     F*              subroutine.                                     *
     F*     E173   - Wrong field moved to @@RATE                     *
     F*                                                              *
     F*     E19639 - Amended program so that when a NAB is amended   *
     F*              the net and face book values on MMFWDTPP are    *
     F*              not updated(TWICE) with the net and face values *
     F*              of the amendment.                               *
     F*                                                              *
     F*     S01218 - Recompiled to include new file layouts for      *
     F*              capital markets dealing interface               *
     F*                                                              *
     F*     S01194 - REL. 10  NEW STANDING DATA                      *
     F*                                                              *
     F*     E18380 - Program was recompiled with new formats for the *
     F*              standard deal files. This stops the book code   *
     F*              and linked reference number fields from being   *
     F*              overwritten.                                    *
     F*                                                              *
     F*     E17051 - Use MM1030 for interest calculations since it   *
     F*              is more accurate than MM1007.                   *
     F*
     F*     E12279 - Core fix to prevent dead-locking.               *
     F*              (In #BBA required forward book file updates     *
     F*               are determined and sorted so that updates;     *
     F*               in #BBAA, #BBAB and #BBAC; are performed in    *
     F*               ascending date order.)                         *
     F*              (In #BBC addition of deam interest has been     *
     F*               moved to take place before removal of later    *
     F*               deam/deal maturity interest.)                  *
     F*                                                              *
     F*     E12312 - BYPASS SI DEAM PROCESSING FOR NAB               *
     F*                                                              *
     F****************************************************************
     F*
     F**  Indicator Function Summary
     F*
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F* ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     F*
     F*       60         General purpose indicator
     F********80         Chain fail om FDICDRLL                           S01194
     F*
     F*          U7    Set on with U8 if a database error occurs.
     F*          U8    File out of balance if on on its own.
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F/EJECT
     F*DICDRLLIF**E**         K        DISK         KINFSR INFSR      UC  S01194
     F******      TABTB11F                          KIGNORE               S01194
     F******      TABTB20F                          KIGNORE               S01194
     FFDMNTHLLIF  E                    DISK         KINFSR INFSR      UC
     FMMLVDMLLIF  E           K        DISK         KINFSR INFSR      UC
     FMMFWUDLLUF  E           K        DISK         KINFSR INFSR A    UC
     F                                              KCOMIT
     FMMFWUHLLUF  E           K        DISK         KINFSR INFSR A    UC
     F                                              KCOMIT
     FMMFWUTLLUF  E           K        DISK         KINFSR INFSR A    UC
     F                                              KCOMIT
     E/EJECT
     E/COPY WNCPYSRC,MM0075E001
     E                    CPY@    1   1 80                                S01194
      *
     E*
     E**  ARRAY FOR DEAL TYPE - LOANS
     E                    @NA     5   5  2
     E*
     E**  ARRAY FOR DEAL TYPE - ALL N/A DEAL TYPES                        S01149
     E                    @ANYNA  7   7  2                                S01149
     E*                                                                   S01149
     E**  ARRAY FOR DEAL TYPE - ALL N/A NON INTEREST BEARING DEAL TYPES   S01149
     E**********          @BILLS  3   3  2                         S01149 S01279
     E                    @BILLS  4   4  2                                S01279
     E*                                                                   S01149
     E****ARRAY*FOR*SR.*ZA0710*-*CUMULATIVE*DAYS*IN*YEAR*FOR*4*YEAR*PERIOD056095
     E***********         @YD     4   4  5 0A                             056095
     E*
     E****ARRAY*FOR*SR.*ZA0710*-*CUMULATIVE*DAYS*IN*YEAR*PER*MONTH*****   056095
     E***********         @MD    13  13  5 0A                             056095
     E*                                                                   056095
     E/COPY ZSRSRC,ZDATE9Z1                                               056095
     E**  Array for SR. ZDATE9                                            056095
     E*
     E**  ARRAY MONTH SHORT NAME
     E                    @MN        12  3
     E*
     E**  MIDAS settlement methods
     E                    @MR    11  11  2 0
     E*
     E**  DRS settlement methods
     E                    @DR    11  11  5
     E*
     E                    @KY         7  9  A                             E12279
     E**  Array to store and sort forward book file keys with             E12279
     E**  sequence numbers for proposed updates                           E12279
     E*
     I/EJECT
     I*
     I** Set month shortnames up as an array
     IFDMNTHP0
     I              MNNM1                           @MN,1
     I              MNNM2                           @MN,2
     I              MNNM3                           @MN,3
     I              MNNM4                           @MN,4
     I              MNNM5                           @MN,5
     I              MNNM6                           @MN,6
     I              MNNM7                           @MN,7
     I              MNNM8                           @MN,8
     I              MNNM9                           @MN,9
     I              MNNM10                          @MN,10
     I              MNNM11                          @MN,11
     I              MNNM12                          @MN,12
     I/EJECT
     I*
     I** Data Structure for Loans format
     I@STDL     E DSMMSTDLPP
     I/EJECT
     I*
     I** Data Structure for NA SOLD Format
     I@STDS     E DSMMSTDSPP
     I              QQDORI                          QQDOR1                                    CGL029
     I              QQMORI                          QQMOR1                                    CGL029
     I              QQBORI                          QQBOR1                                    CGL029
     I              QQBOPI                          QQBOP1                                    CGL029
     I              QQRONS                          QQRON1                                    CGL029
     I              QQPONS                          QQPON1                                    CGL029
     I/EJECT
     I*
     I** Data Structure for NA BOUGHT Format
     I@STDB     E DSMMSTDBPP
     I              QQDORI                          QQDOR2                                    CGL029
     I              QQMORI                          QQMOR2                                    CGL029
     I              QQDOPI                          QQDOP2                                    CGL029
     I              QQMOPI                          QQMOP2                                    CGL029
     I              QQBORI                          QQBOR2                                    CGL029
     I              QQBOPI                          QQBOP2                                    CGL029
     I              QQRORI                          QQROR2                                    CGL029
     I              QQROPI                          QQROP2                                    CGL029
     I              QQRONS                          QQRON2                                    CGL029
     I              QQPONS                          QQPON2                                    CGL029
     I/EJECT
     I*
     I** Data Structure for Standard Deal Format
     I@STDA     E DSMMSTDAPP
     I              QQDORI                          QQDOR3                                    CGL029
     I              QQMORI                          QQMOR3                                    CGL029
     I              QQDOPI                          QQDOP3                                    CGL029
     I              QQMOPI                          QQMOP3                                    CGL029
     I              QQBORI                          QQBOR3                                    CGL029
     I              QQBOPI                          QQBOP3                                    CGL029
     I              QQRORI                          QQROR3                                    CGL029
     I              QQROPI                          QQROP3                                    CGL029
     I              QQRONS                          QQRON3                                    CGL029
     I              QQPONS                          QQPON3                                    CGL029
     I*                                     512 5190@OSDAT
     I*                                     520 5270@OMDAT
     I**************************************514 5210@OSDAT                E21172
     I**************************************522 5290@OMDAT                E21172
     I*************************************114211490@OSDAT          E21172E25631
     I*************************************115011570@OMDAT          E21772E25631
     I                                      514 5210@OSDAT                E25631
     I                                      522 5290@OMDAT                E25631
     I/COPY WNCPYSRC,MM0075I001
     I*                                                                   S01194
     ISDBANK    E DSSDBANKPD                                              S01194
     I** EXTERNAL DS FOR BANK DETAILS                                     S01194
     I*                                                                   S01194
     I***SDGELR*   E DSSDGELRPD                                                    MD035545 MD047993
     I**GENERAL*LEDGER*DETAILS*ACCESSED*VIA*ACCESS*PROGRAM*************            MD035545 MD047993
     IDSFDY     E DSDSFDY                                                 S01194
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01194
     I*                                                                   S01194
     IDSSDY     E DSDSSDY                                                                   MD035545
     I* SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE                                  MD035545
     I/EJECT
     IPSDS       SDS
     I/COPY WNCPYSRC,MM0075I002
     I                                      201 208 @FILE
     I                                      244 253 @JOB
     I                                      254 263 @USER
     I*
     I           UDS
     I**  Local data area for data base errors.
     I**  Field containing name of database file in error.
     I                                      134 141 DBFILE
     I**  Field containing key value causing database error.
     I                                      142 170 DBKEY
     I**  Field containing name of program causing database error.
     I                                      171 180 DBPGM
     I**  Field containing number of database error.
     I                                      181 183 DBASE
     I*
     I@UPDT       DS                              7
     I*
     I** Data structure to hold the time of update from MIDAS run date.
     I                                        1   20HSDLUP
     I                                        1   20HTDLUP
     I                                        1   20HVDLUP
     I                                        3   5 HSMLUP
     I                                        3   5 HTMLUP
     I                                        3   5 HVMLUP
     I                                        6   70HSYLUP
     I                                        6   70HTYLUP
     I                                        6   70HVYLUP
     I*
     I** Data structure to hold Maturity date
     I            DS
     I                                        1   80@MDTD
     I                                        1   40CCMDYY
     I                                        5   60CCMDMM
     I                                        7   80CCMDDD
     I*
     I** Data structure to hold Next Interest payment date
     I            DS
     I                                        1   80@NIPD
     I                                        1   40CCNIYY
     I                                        5   60CCNIMM
     I                                        7   80CCNIDD
     I*
     I** Data structure to hold Before update Start/last Interest date
     I            DS
     I                                        1   80CCBLID
     I                                        1   40@BSLY
     I                                        5   60@BSLM
     I                                        7   80@BSLD
     I*
     I** Data structure to hold deal value date                           S01149
     I            DS                                                      S01149
     I                                        1   80@VDAT                 S01149
     I                                        1   40CCVDYY                S01149
     I                                        5   60CCVDMM                S01149
     I                                        7   80CCVDDD                S01149
     I*
     I** Data structure to hold deal transaction date
     I            DS
     I                                        1   80CCDDAT
     I                                        1   40CCDTYY
     I                                        5   60CCDTMM
     I                                        7   80CCDTDD
     I****DATA*STRUCTURE*FOR*SR.*ZA0680*-*DATE*INPUT*TO*SUBROUTINE*****   056095
     I*********** DS                                                      056095
     I***********                             1   80@@DTIN                056095
     I***********                             1   40@@YYYY                056095
     I***********                             3   40@@YY                  056095
     I***********                             1   20@@CC                  056095
     I***********                             5   60@@MTH                 056095
     I***********                             7   80@@DAY                 056095
     I*                                                                   056095
     I/COPY ZSRSRC,ZDAT10Z1                                               056095
     I**  Data structure for SR. ZDAT10                                   056095
     I*                                                                   056095
     I****DATA*STRUCTURE*FOR*SR.*M1009*-*DATE*FIELD*YYYYMMDD***********   056095
     I*********** DS                                                      056095
     I***********                             1   80@@DATA                056095
     I***********                             1   40@@YY1                 056095
     I***********                             5   60@@MM1                 056095
     I***********                             7   80@@DD1                 056095
     I****DATA*STRUCTURE*FOR*SR.*M1009*-*DATE*FIELD*YYYYMMDD***********   056095
     I*********** DS                                                      056095
     I***********                             1   80@@DATB                056095
     I***********                             1   40@@YY2                 056095
     I***********                             5   60@@MM2                 056095
     I***********                             7   80@@DD2                 056095
     I*                                                                   056095
     I/COPY ZSRSRC,ZINTDYZ1                                               056095
     I**  Data Structure for SR. ZINTDY                                   056095
     I*                                                                   056095
     I****DATA*STRUCTURE*FOR*SR.*ZA0710*-*FIELD*IS*@@Z71Y**************   056095
     I*********** DS                                                      056095
     I***********                             1   40@@Z71Y                056095
     I***********                             1   10@@SSY1                056095
     I***********                             2   20@@SSY2                056095
     I***********                             3   30@@SSY3                056095
     I***********                             4   40@@SSY4                056095
     I****DATA*STRUCTURE*FOR*SR.*ZA0710*-*FIELD*IS*@@VDT***************   056095
     I*********** DS                                                      056095
     I***********                             1   80@@VDT                 056095
     I***********                             1   40@@YR                  056095
     I***********                             5   60@@Z71M                056095
     I***********                             7   80@@Z71D                056095
     I*                                                                   056095
     I/COPY ZSRSRC,ZDATE9Z2                                               056095
     I**  Data structure for SR. ZDATE9                                   056095
     I*                                                                   056095
     I**  DATA STRUCTURE FOR RUNDATE
     I            DS
     I                                        1   7 RUNA
     I                                        1   20@RDD
     I                                        3   5 @RMM
     I                                        6   70@RYY
     I**  DATA STRUCTURE FOR SETTING UP DATES USED ON FILE UPDATES
     I            DS
     I                                        1   80@HNDAT
     I                                        1   40@VDYY
     I                                        5   60@VDMM
     I                                        7   80@VDDD
     I*
     I@KYE        DS                              9                       E12279
     I**  Array element data structure - used by @KY                      E12279
     I                                        1   8 @DAT                  E12279
     I                                        1   4 @DTY                  E12279
     I                                        5   6 @DTM                  E12279
     I                                        7   8 @DTD                  E12279
     I                                        9   9 @SEQ                  E12279
     I*
     I** Data area containing phase flag
     I*
     I** Data structure to hold Phase of system
     I              'LECalcBasis6LeapYear'C         WPARML                                  MD035545
     ISCSARD    E DSSCSARDPD                                                                  CDL033
      /EJECT
     C*****************************************************************
     C/COPY WNCPYSRC,MM0075C028
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* MAIN     - Main controlling routine.                          *
     C*                                                               *
     C* CALLS    #A       - Initial processing                        *
     C*          #B       - Determine which files to be updated       *
     C*          #C       - Termination processing                    *
     C*                                                               *
     C* CALLED BY         -                                           *
     C*                                                               *
     C* FLDS USED  @TERM  - Termination parameter                     *
     C*                                                               *
     C*****************************************************************
     C*
     C**  Initialise termination parameter                                147381
     C                     MOVE *BLANK    @TERM                           147381
     C*                                                                   147381
     C**  Initial processing.
     C**  Perform Initial process if RUNA is blank
     C           RUNA      IFEQ *BLANK                     B1
     C                     EXSR #A                         *1
     C                     END                             E1
     C*
     C**  Main processing
     C           *INU7     IFEQ '0'                        B1
     C           @TERM     ANDNE'T'                        *1
     C                     EXSR #B                         *1
     C                     END                             E1
     C*
     C**  Termination processing
     C                     EXSR #C
     C*
     C           ENDPGM    TAG
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C* SUBROUTINES USED                                              *
     C*                                                               *
     C*  01  #ZA      - Write / update records on LF/MMFWUDLL         *
     C*  02  #ZB      - Write / update records on LF/MMFWUHLL         *
     C*  03  #BBI     - Write / update records on LF/MMFWUTLL         *
     C*  04  #B       - Determine which files to be updated           *
     C*  05  #BA      - Update MM funds in nostro LF/MMFWUTLL         *
     C*  06  #BB      - Routine controlling updating sequence         *
     C*  07  #BBA     - Route program through update sequence         *
     C*  08  #BBAA    - Update forward book for value date details    *
     C*  09  #BBAB    - Update fwd book for next intersest date       *
     C*  10  #BBAC    - Update fwd book for maturity date             *
     C*  11  #BBC     - Update fwd book for SI deam                   *
     C*  12  #BBD     - Update LF/MMFWDTLL total funds lent info      *
     C*  12  #BBE     - Update LF/MMFWDTLL NA net value details       *
     C*            #BBEA  - Update fwd book for N/A's interest at NIPD*   S01149
     C*            #BBEB  - Update fwd book for N/A's interest at mat.*   S01149
     C*            #BBEC  - Update fwd book for N/A's remove interest *   S01149
     C*            #BBED  - Update fwd book for N/A's remove interest *   S01149
     C***13**MM1007***- Calc interest due at next interest date********** E17051
     C*  13  MM1030   - Calc interest due at next interest date       *   E17051
     C***14**MM1009***-*Calculate*number*of*interest*days**************   056095
     C*  14  ZINTDY   - Calculate number of interest days             *   056095
     C***15**ZA0710***-*Convert*a*day*number*to*a*date*****************   056095
     C*  15  ZDATE9   - Convert a day number to a date                *   056095
     C*  16  #A       - Initial processing                            *
     C*  17  #BC      - Move details PF/MMSTDLPP to common fields     *
     C*  18  #BD      - Move details PF/MMSTDSPP to common fields     *
     C*  19  #BE      - Move details PF/MMSTDAPP to common fields     *
     C*  20  #BF      - Move details PF/MMSTDBPP to common fields     *
     C*  21  #C       - Termination processing                        *
     C***22**ZA0150***- Acces LF/FDICDRll                             *   S01194
     C***22**ZA0680***-*Convert*a*date*to*day*number*form**************   056095
     C*  22  ZDAT10   - Convert a date to day number form             *   056095
     C*  23  *PSSR    - Error routine performed on program error      *
     C*  24  INFSR    - Error routine performed on file error         *
     C*                                                               *
     C* EXTERNAL ROUTINE                                              *
     C*                                                               *
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZA      - Write / update records on LF/MMFWUDLL              *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  #BBAA  - Update forward book for value date details*
     C*            #BBAA  - Update forward book for value date details*
     C*            #BBAB  - Update fwd book for next intersest date   *
     C*            #BBAB  - Update fwd book for next intersest date   *
     C*            #BBAC  - Update fwd book for maturity date         *
     C*            #BBAC  - Update fwd book for maturity date         *
     C*            #BBAC  - Update fwd book for maturity date         *
     C*            #BBAC  - Update fwd book for maturity date         *
     C*            #BBAC  - Update fwd book for maturity date         *
     C*            #BBAC  - Update fwd book for maturity date         *
     C*            #BBAC  - Update fwd book for maturity date         *
     C*            #BBAC  - Update fwd book for maturity date         *
     C*            #BBC   - Update fwd book for SI deam               *
     C*            #BBE   - Update fwd book for N/A's                 *   S01149
     C*            #BBEA  - Update fwd book for N/A's interest at NIPD*   S01149
     C*            #BBEB  - Update fwd book for N/A's interest at mat.*   S01149
     C*            #BBEC  - Update fwd book for N/A's remove interest *   S01149
     C*            #BBED  - Update fwd book for N/A's remove interest *   S01149
     C*                                                               *
     C* FLDS USED  @DKEY  - Key to file LF/MMFWUDLL                   *
     C*            @USER  - Job user                                  *
     C*            @VDYY  - Date used in accessing forward book files *
     C*            @VDMM  - Date used in accessing forward book files *
     C*            @VDDD  - Date used in accessing forward book files *
     C*            @DCIN  - Daily cash in                             *
     C*            @DCOT  - Daily cash out                            *
     C*            @DNIM  - Daily net interest movement               *
     C*            @NALD  - N/A L/D indicator                         *   S01149
     C*                                                               *
     C*****************************************************************
     C           #ZA       BEGSR
     C*
     C** SET UP LDNA ELEMENT OF KEY                                       S01149
     C           @NALD     IFEQ 'N'                        B1             S01149
     C                     MOVE 'NA'      HSLDNA           *1             S01149
     C           @DCIN     SUB  @DCOT     @NETMV           *1             S01149
     C                     ELSE                            X1             S01149
     C                     MOVE 'LD'      HSLDNA           *1             S01149
     C           @DCIN     SUB  @DCOT     @NETMV           *1             S01149
     C                     END                             E1             S01149
     C*
     C**  Chain to MMFWUDLL file
     C           @DKEY     CHAINMMFWUDLL             60
     C*
     C** If record not found create new record for that CURRENCY
     C           *IN60     IFEQ '1'                        B1
     C*
     C** Set up standard data
     C                     MOVE 'HS'      HSRCID           *1
     C                     TIME           HSTLUP           *1
     C                     MOVE 'I'       HSCHTP           *1
     C*****                Z-ADDRUND      HSLCD            *1             S01194
     C                     Z-ADDBJRDNB    HSLCD            *1             S01194
     C                     MOVEL@USER     HSLUID           *1
     C                     MOVE CCCCY     HSCCY            *1
     C                     MOVE @VDYY     HSFBYY           *1
     C                     MOVE @VDMM     HSFBMM           *1
     C                     MOVE @VDDD     HSFBDD           *1
     C*
     C** Set up Cash in, Cash out, Net movement and Net int movement
     C                     Z-ADD@DCIN     HSDCIN           *1
     C                     Z-ADD@DCOT     HSDCOT           *1
     C**         HSDCIN    SUB  HSDCOT    HSDNMT           *1             S01149
     C                     Z-ADD@NETMV    HSDNMT           *1             S01149
     C                     Z-ADD@DNIM     HSDNIM           *1
     C                     Z-ADD*ZERO     HSFIXM           *1
     C                     Z-ADD@MAIN     HSMAIN           *1             S01279
     C                     Z-ADD@MAOT     HSMAOT           *1             S01279
     C*                                                                   S01279
     C** only set up the appropriate average rate, ie. cash in or cash outS01279
     C           @MAIN     IFNE *ZERO                      B*2            S01279
     C                     Z-ADD@EFRT     HSAVIN           **2            S01279
     C                     Z-ADD*ZERO     HSAVOT           **2            S01279
     C                     ELSE                            X*2            S01279
     C                     Z-ADD@EFRT     HSAVOT           **2            S01279
     C                     Z-ADD*ZERO     HSAVIN           **2            S01279
     C                     END                             E*2            S01279
     C*
     C                     WRITEMMFWDDP0                   *1
     C*
     C                     ELSE                            X1
     C*
     C** If record already on file update it with new information
     C                     TIME           HSTLUP           *1
     C                     MOVE 'A'       HSCHTP           *1
     C*****                Z-ADDRUND      HSLCD            *1             S01194
     C                     Z-ADDBJRDNB    HSLCD            *1             S01194
     C                     MOVEL@USER     HSLUID           *1
     C                     ADD  @DCIN     HSDCIN           *1
     C                     ADD  @DCOT     HSDCOT           *1
     C**         HSDCIN    SUB  HSDCOT    HSDNMT           *1             S01149
     C                     ADD  @NETMV    HSDNMT           *1             S01149
     C                     ADD  @DNIM     HSDNIM           *1
     C*                                                                   S01279
     C** Must accumulate average rate as a rate weighted by the principal S01279
     C*  The calculation is:                                              S01279
     C*  New average rate, cash in  HSAVIN =                              S01279
     C*                                                                   S01279
     C*  (Current average * Current cash) + (Effective   * cash      )    S01279
     C*   rate, cash in     in at mdate      rate,cash in  in at mdate    S01279
     C*  -------------------------------------------------------------    S01279
     C*   (Current cash in at mdat, HSMAIN + cash in at mdate, @MAIN)     S01279
     C*                                                                   S01279
     C*    ie. =  @WRK1 + @WRK2      in this coding.                      S01279
     C*           -------------                                           S01279
     C*               @WRK3                                               S01279
     C*                                                                   S01279
     C* note that Effective rate, @EFRT, is set to deal interest rate for S01279
     C* loans, deposits, cd's issued and primary cd's bought, to yield    S01279
     C* for other NA's bought and for NA's sold is set to yield/interest  S01279
     C* on the purchased NA.                                              S01279
     C*                                                                   S01279
     C** calculation for average rate cash out is similiar.               S01279
     C*                                                                   S01279
     C           @MAIN     IFNE *ZERO                      B*2            S01279
     C*                                                                   S01279
     C** Could get divide by zero with deletes so check for it            S01279
     C           HSMAIN    ADD  @MAIN     @WRK3            **2            S01279
     C           @WRK3     IFNE *ZERO                      B**3           S01279
     C*                                                                   S01279
     C           @EFRT     MULT @MAIN     @WRK1            ***3           S01279
     C           HSAVIN    MULT HSMAIN    @WRK2            ***3           S01279
     C           @WRK1     ADD  @WRK2     @WRK1            ***3           S01279
     C           @WRK1     DIV  @WRK3     HSAVIN    H      ***3           S01279
     C                     ELSE                            X**3           S01279
     C                     Z-ADD*ZERO     HSAVIN           ***3           S01279
     C                     END                             E**3           S01279
     C*                                                                   S01279
     C                     ADD  @MAIN     HSMAIN           **2            S01279
     C                     END                             E*2            S01279
     C*                                                                   S01279
     C** and also for cash out                                            S01279
     C           @MAOT     IFNE *ZERO                      B*2            S01279
     C*                                                                   S01279
     C** Could get divide by zero with deletes so check for it            S01279
     C           HSMAOT    ADD  @MAOT     @WRK3            **2            S01279
     C           @WRK3     IFNE *ZERO                      B**3           S01279
     C*                                                                   S01279
     C           @EFRT     MULT @MAOT     @WRK1            ***3           S01279
     C           HSAVOT    MULT HSMAOT    @WRK2            ***3           S01279
     C           @WRK1     ADD  @WRK2     @WRK1            ***3           S01279
     C           @WRK1     DIV  @WRK3     HSAVOT    H      ***3           S01279
     C                     ELSE                            X**3           S01279
     C                     Z-ADD*ZERO     HSAVOT           ***3           S01279
     C                     END                             E**3           S01279
     C*                                                                   S01279
     C                     ADD  @MAOT     HSMAOT           **2            S01279
     C                     END                             E*2            S01279
     C*                                                                   S01279
     C                     UPDATMMFWDDP0                   *1
     C                     END                             E1
     C*
     C** Zeroise amount fields
     C                     Z-ADD0         @DCIN  150
     C                     Z-ADD0         @DCOT  150
     C                     Z-ADD0         @DNIM  150
     C                     Z-ADD0         @NETMV                          S01149
     C                     Z-ADD0         @MAIN  150                      S01279
     C                     Z-ADD0         @MAOT  150                      S01279
     C                     Z-ADD0         @EFRT  138                      S01279
     C                     Z-ADD*ZERO     @WRK1  308                      S01279
     C                     Z-ADD*ZERO     @WRK2  308                      S01279
     C                     Z-ADD*ZERO     @WRK3  200                      S01279
     C*
     C           #ZA9      ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZB      - Write / update records on LF/MMFWUHLL              *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  #BBAA  - Update forward book for value date details*
     C*            #BBAA  - Update forward book for value date details*
     C*            #BBAB  - Update fwd book for next intersest date   *
     C*            #BBAB  - Update fwd book for next intersest date   *
     C*            #BBAC  - Update fwd book for maturity date         *
     C*            #BBAC  - Update fwd book for maturity date         *
     C*            #BBAC  - Update fwd book for maturity date         *
     C*            #BBAC  - Update fwd book for maturity date         *
     C*            #BBAC  - Update fwd book for maturity date         *
     C*            #BBAC  - Update fwd book for maturity date         *
     C*            #BBAC  - Update fwd book for maturity date         *
     C*            #BBAC  - Update fwd book for maturity date         *
     C*            #BBC   - Update fwd book for SI deam               *
     C*            #BBE   - Update fwd book for N/A's                 *   S01149
     C*            #BBEA  - Update fwd book for N/A's interest at NIPD*   S01149
     C*            #BBEB  - Update fwd book for N/A's interest at mat.*   S01149
     C*            #BBEC  - Update fwd book for N/A's remove interest *   S01149
     C*            #BBED  - Update fwd book for N/A's remove interest *   S01149
     C*                                                               *
     C* FLDS USED  @HNDAT - Data structure to format date as YYYYMMDD *
     C*            @TSTDT - Date determines LF/MMFWUHLL to be updated *
     C*            @VDDD  - Date used in accessing forward book files *
     C*            @VDHM  - Half month part of key on LF/MMFWUHLL     *
     C*            @HKEY  - Key to LF/MMFWUHLL                        *
     C*            @USER  - Job user                                  *
     C*            @VDYY  - Date used in accessing forward book files *
     C*            @VDMM  - Date used in accessing forward book files *
     C*            @HMCI  - Half month cash in                        *
     C*            @HMCO  - Half month cash out                       *
     C*            @HNIM  - Half month net interest movement          *
     C*            @NALD  - N/A L/D indicator                         *   S01149
     C*            @NTHMV - Temporary store of net movement value     *   S01149
     C*                                                               *
     C*****************************************************************
     C           #ZB       BEGSR
     C*
     C** SET UP LDNA ELEMENT OF KEY                                       S01149
     C           @NALD     IFEQ 'N'                        B1             S01149
     C                     MOVE 'NA'      HTLDNA           *1             S01149
     C           @HMCI     SUB  @HMCO     @NTHMV           *1             S01149
     C                     ELSE                            X1             S01149
     C                     MOVE 'LD'      HTLDNA           *1             S01149
     C           @HMCI     SUB  @HMCO     @NTHMV           *1             S01149
     C                     END                             E1             S01149
     C*
     C** Set deal half month indicator to 01 if date is before the 15th
     C** of the month otherwise set to 02
     C           @VDDD     IFLE 15                         B1
     C                     Z-ADD1         @VDHM            *1
     C                     ELSE                            X1
     C                     Z-ADD2         @VDHM            *1
     C                     END                             E1
     C*
     C** Chain to MMFWUHLL file
     C           @HKEY     CHAINMMFWUHLL             60
     C*
     C**  If record not found create new record for that CURRENCY
     C           *IN60     IFEQ '1'                        B1
     C*
     C                     MOVE 'HT'      HTRCID           *1
     C                     TIME           HTTLUP           *1
     C                     MOVE 'I'       HTCHTP           *1
     C*****                Z-ADDRUND      HTLCD            *1             S01194
     C                     Z-ADDBJRDNB    HTLCD            *1             S01194
     C                     MOVEL@USER     HTLUID           *1
     C                     MOVE CCCCY     HTCCY            *1
     C                     Z-ADD@VDYY     HTFBYY           *1
     C                     Z-ADD@VDMM     HTFBMM           *1
     C                     Z-ADD@VDHM     HTFBHM           *1
     C*
     C** Set up Cash in, Cash out, Net movement and Net int movement
     C                     Z-ADD@HMCI     HTHMCI           *1
     C                     Z-ADD@HMCO     HTHMCO           *1
     C****       HTHMCI    SUB  HTHMCO    HTHMNM           *1             S01149
     C                     Z-ADD@NTHMV    HTHMNM           *1             S01149
     C                     Z-ADD@HNIM     HTHNIM           *1
     C                     Z-ADD*ZERO     HTFIXM           *1
     C                     WRITEMMFWDHP0                   *1
     C*
     C                     ELSE                            X1
     C*
     C** If record already on file update it with new information
     C                     TIME           HTTLUP           *1
     C                     MOVE 'A'       HTCHTP           *1
     C*****                Z-ADDRUND      HTLCD            *1             S01194
     C                     Z-ADDBJRDNB    HTLCD            *1             S01194
     C                     MOVEL@USER     HTLUID           *1
     C                     ADD  @HMCI     HTHMCI           *1
     C                     ADD  @HMCO     HTHMCO           *1
     C****       HTHMCI    SUB  HTHMCO    HTHMNM           *1             S01149
     C                     ADD  @NTHMV    HTHMNM           *1             S01149
     C                     ADD  @HNIM     HTHNIM           *1
     C                     UPDATMMFWDHP0                   *1
     C                     END                             E1
     C*
     C** Zeroise amount fields
     C                     Z-ADD0         @HMCI  150
     C                     Z-ADD0         @HMCO  150
     C                     Z-ADD0         @HNIM  150
     C                     Z-ADD0         @NTHMV                          S01149
     C*
     C           #ZB9      ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BBI     - Write / update records on LF/MMFWUTLL              *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  #BB    - Routine controlling updating sequence     *
     C*                                                               *
     C* FLDS USED  @USER  - Job user                                  *
     C*            @TFDL  - Total funds lent                          *
     C*            @TCIN  - Total cash in                             *
     C*            @TCOT  - Total cash out                            *
     C*            @NIMT  - Net interest movement                     *
     C*            @MMFN  - MM funds in nostro                        *
     C*            @NALD  - N/A L/D indicator                         *   S01149
     C*            @NSNV  - N/A net value                             *   S01149
     C*                                                               *
     C*****************************************************************
     C           #BBI      BEGSR
     C*
     C**  Chain to LF/MMFWUTLL file
     C           CCCCY     CHAINMMFWUTLL             60
     C*
     C**  If record not found create new record for that CURRENCY
     C           *IN60     IFEQ '1'                        B1
     C                     MOVE 'HV'      HVRCID           *1
     C                     TIME           HVTLUP           *1
     C                     MOVE 'I'       HVCHTP           *1
     C*****                Z-ADDRUND      HVLCD            *1             S01194
     C                     Z-ADDBJRDNB    HVLCD            *1             S01194
     C                     MOVEL@USER     HVLUID           *1
     C                     MOVE CCCCY     HVCCY            *1
     C*                    Z-ADD@NSNV     HVNSNV           *1             S01149
     C*                    Z-ADD@TFDL     HVTFDL           *1             S01149
     C*                    Z-ADD@TCIN     HVTCIN           *1             S01149
     C*                    Z-ADD@TCOT     HVTCOT           *1             S01149
     C********   HVTCIN    SUB  HVTCOT    HVNCMT           *1             S01149
     C********             Z-ADD@NIMT     HVNIMT           *1             S01149
     C***********@TCIN*****SUB  @TCOT     HVTFDL           *1             E14186
     C           @FMTY     IFEQ 'B'                        B*2            E14186
     C           @MDTD     ANDGE@RUNDT                     B*2            E14186
     C                     Z-ADD@TFFN     HVTFDL           **2            E14186
     C                     END                             E*2            E14186
     C           @FMTY     IFEQ 'L'                        B*2            E14186
     C           @MDTD     IFGE @RUNDT                     B**3           E14186
     C           IKNTCE    ORNE -999                       ***3           E14186
     C                     Z-ADD@TFDL     HVTFDL           ***3           E14186
     C                     END                             E**3           E14186
     C                     END                             E*2            E14186
     C           @FMTY     IFEQ 'A'                        B*2            E14186
     C                     Z-ADD@TFDL     HVTFDL           **2            E14186
     C                     END                             E*2            E14186
     C*
     C**  SET L/D N/A FIELDS DEPENDING ON FORMAT TYPE  **                 S01149
     C           @NALD     IFEQ 'L'                        B*2            S01149
     C                     Z-ADD@NIMT     HVNIML           **2            S01149
     C                     Z-ADD@TCIN     HVTCIN           **2            S01149
     C                     Z-ADD@TCOT     HVTCOT           **2            S01149
     C           HVTCIN    SUB  HVTCOT    HVNCML           **2            S01149
     C                     Z-ADD0         HVNCMN           **2            S01149
     C                     Z-ADD0         HVNIMN           **2            S01149
     C                     ELSE                            X*2            S01149
     C                     Z-ADD@TFNN     HVNSNV           **2            S01149
     C                     Z-ADD@TFFN     HVNSFV           **2            S01149
     C                     Z-ADD@TCIN     HVTCIN           **2            S01149
     C                     Z-ADD@TCOT     HVTCOT           **2            S01149
     C           HVTCIN    SUB  HVTCOT    HVNCMN           **2            S01149
     C**  E20540 - Face Value already updated by above                    E20540
     C**********           Z-ADD@NSFV     HVNSFV           **2     S01149 E20540
     C                     Z-ADD@NIMT     HVNIMN           **2            S01149
     C                     Z-ADD0         HVNCML           **2            S01149
     C                     Z-ADD0         HVNIML           **2            S01149
     C                     END                             E*2            S01149
     C                     Z-ADD0         HVCPLL           *1             S01149
     C                     Z-ADD0         HVCPLN           *1             S01149
     C                     Z-ADD@MMFN     HVMMFN           *1
     C*****                Z-ADD0         HVCCPL           *1             S01149
     C                     WRITEMMFWDTP0                   *1
     C*
     C                     ELSE                            X1
     C*
     C** If record already on file update it with new information
     C                     TIME           HVTLUP           *1
     C                     MOVE 'A'       HVCHTP           *1
     C*****                Z-ADDRUND      HVLCD            *1             S01194
     C                     Z-ADDBJRDNB    HVLCD            *1             S01194
     C                     MOVEL@USER     HVLUID           *1
     C*                    ADD  @NSNV     HVNSNV           *1
     C*                    ADD  @TFDL     HVTFDL           *1
     C*                    ADD  @TCIN     HVTCIN           *1
     C*                    ADD  @TCOT     HVTCOT           *1
     C*****      HVTCIN    SUB  HVTCOT    HVNCMT           *1             S01149
     C*****                ADD  @NIMT     HVNIMT           *1             S01149
     C***********@TCIN*****SUB  @TCOT     @NCMT            *1   S01149    E14186
     C*********************ADD  @NCMT     HVTFDL           *1             E14186
     C           @FMTY     IFEQ 'B'                        B*2            E14186
     C           @MDTD     ANDGE@RUNDT                     B*2            E14186
     C                     ADD  @TFFN     HVTFDL           **2            E14186
     C                     END                             E*2            E14186
     C           @FMTY     IFEQ 'L'                        B*2            E14186
     C           @MDTD     IFGE @RUNDT                     B**3           E14186
     C           IKNTCE    ORNE -999                       B**3           E14186
     C                     ADD  @TFDL     HVTFDL           ***3           E14186
     C                     END                             E**3           E14186
     C                     END                             E*2            E14186
     C           @FMTY     IFEQ 'A'                        B*2            E14186
     C                     ADD  @TFDL     HVTFDL           **2            E14186
     C                     END                             E*2            E14186
     C*                                                                   S01149
     C**  SET L/D N/A FIELDS DEPENDING ON FORMAT TYPE  **                 S01149
     C           @NALD     IFEQ 'L'                        B*2            S01149
     C                     ADD  @NIMT     HVNIML           **2            S01149
     C***********          ADD  @NCMT     HVNCML           **2     S01149 092454
     C                     ADD  @TCIN     HVNCML           **2            092454
     C                     SUB  @TCOT     HVNCML           **2            092454
     C**  E19980 - INTEREST AMOUNT ALREADY BEING ADDED TO FILE BY
     C**           ABOVE.
     C**********           ADD  @NIMT     HVNIML           **2     S01149 E19980
     C                     ADD  @TCIN     HVTCIN           **2            S01149
     C                     ADD  @TCOT     HVTCOT           **2            S01149
     C                     ELSE                            X*2            S01149
     C                     ADD  @TFNN     HVNSNV           **2            S01149
     C                     ADD  @TFFN     HVNSFV           **2            S01149
     C                     ADD  @TCIN     HVTCIN           **2            S01149
     C                     ADD  @TCOT     HVTCOT           **2            S01149
     C                     ADD  @NIMT     HVNIMN           **2            S01149
     C***********          ADD  @NCMT     HVNCMN           **2     S01149 092454
     C                     ADD  @TCIN     HVNCMN           **2            092454
     C                     SUB  @TCOT     HVNCMN           **2            092454
     C                     END                             E*2            S01149
     C*                                                                   S01149
     C                     ADD  @MMFN     HVMMFN           *1
     C                     UPDATMMFWDTP0                   *1
     C                     END                             E1
     C*
     C** Zeroise amount fields
     C                     Z-ADD0         @NSNV  150
     C                     Z-ADD0         @TFDL  150
     C                     Z-ADD0         @TCIN  150
     C                     Z-ADD0         @TCOT  150
     C                     Z-ADD0         @NIMT  150
     C                     Z-ADD0         @MMFN  150
     C                     Z-ADD0         @DNIM  150                      S01149
     C                     Z-ADD0         @NCMT  150                      S01149
     C                     Z-ADD0         @TFNN  150                      S01149
     C                     Z-ADD0         @TFFN  150                      S01149
     C*
     C           #BBI9     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #B       - Determine which files to be updated                *
     C*                                                               *
     C* CALLS    #BC      - Move details PF/MMSTDLPP to common fields *
     C*          #BD      - Move details PF/MMSTDSPP to common fields *
     C*          #BE      - Move details PF/MMSTDAPP to common fields *
     C*          #BF      - Move details PF/MMSTDBPP to common fields *
     C*          #BA      - Update MM funds in nostro LF/MMFWUTLL     *
     C*          #BB      - Routine controlling updating sequence     *
     C*                                                               *
     C* CALLED BY  MAIN   - Main controlling routine.                 *
     C*                                                               *
     C* FLDS USED  @FMTY  - LF/MMSTDDLL format indicator              *
     C*                                                               *
     C*****************************************************************
     C           #B        BEGSR
     C*
     C** Move File fields to common work fields according to
     C** Format read
     C           @FMTY     CASEQ'L'       #BC              B1
     C           @FMTY     CASEQ'S'       #BD              *1
     C           @FMTY     CASEQ'A'       #BE              *1
     C           @FMTY     CASEQ'B'       #BF              *1
     C                     END                             E1
     C*
     C*
     C** Update MM funds in nostro
     C                     EXSR #BA
     C*
     C** Update fields other than MM funds in nostro
     C                     EXSR #BB
     C*
     C           #B9       ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BA      - Update MM funds in nostro LF/MMFWUTLL              *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  #B     - Determine which files to be updated       *
     C*                                                               *
     C* FLDS USED  @AMEND - Indicates deal BU details being processed *
     C*            @MMFN  - MM funds in nostro                        *
     C*            @FMTY  - LF/MMSTDDLL format indicator              *
     C*            @PYRCV - Contains pay/receive instructions         *
     C*            @RUNDT - Run date as YYYYMMDD format               *
     C*            @I     - Index to arrays of settlement instructions*
     C*            @MR    - Array of possible MIDAS settlement instr  *
     C*            @DR    - Array of possible DRS settlement instr    *
     C*                                                               *
     C*****************************************************************
     C           #BA       BEGSR
     C*
     C                     MOVE *BLANK    @AMEND  1
     C                     Z-ADD0         @MMFN  150
     C*
     C** For deam need only set up details for deam types PI & PD
     C           @FMTY     IFEQ 'A'                        B1
     C           CCTYPE    IFNE 'PI'                       B*2
     C           CCTYPE    ANDNE'PD'                       **2
     C                     GOTO #BA9                       **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C** Need to check pay / receive method to determine whether
     C** settlement type is across a nostro. Whether pay or receive
     C** method is to be checked depends upon the deal type and hence
     C** whether funds are paid or received at deal value date.
     C*
     C** For deam need to check original deal type to determine whether
     C** pay or receive instructions should be checked.
     C           #BA1      TAG
     C           @FMTY     IFEQ 'A'                        B1
     C*
     C           CCTYPE    IFEQ 'PI'                       B*2
     C***********CCOGDT****IFEQ 'CT'                       B**3           E20679
     C           IGOGDT    IFEQ 'CT'                       B**3           E20679
     C                     MOVE CCDORM    @PYRCV  5        ***3
     C                     ELSE                            X**3
     C                     MOVE CCDOPM    @PYRCV           ***3
     C                     END                             E**3
     C*
     C                     ELSE                            X*2
     C***********CCOGDT****IFEQ 'CT'                       B**3           E20679
     C           IGOGDT    IFEQ 'CT'                       B**3           E20679
     C                     MOVE CCDOPM    @PYRCV  5        ***3
     C                     ELSE                            X**3
     C                     MOVE CCDORM    @PYRCV           ***3
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E1
     C*
     C** Set up settlement instructions to be tested for deals.
     C           @FMTY     IFNE 'A'                        B1
     C*
     C           @FMTY     IFEQ 'B'                        B*2
     C           @FMTY     OREQ 'S'                        **2
     C*
     C           @FMTY     IFEQ 'B'                        B**3
     C                     MOVE CCDOPM    @PYRCV           ***3
     C                     ELSE                            X**3
     C                     MOVE CCDORM    @PYRCV           ***3
     C                     END                             E**3
     C*
     C                     ELSE                            X*2
     C           CCTYPE    IFEQ 'IP'                       B**3
     C           CCTYPE    OREQ 'TL'                       ***3
     C           CCTYPE    OREQ 'CP'                       ***3
     C           CCTYPE    OREQ 'CL'                       ***3
     C                     MOVE CCDOPM    @PYRCV           ***3
     C                     ELSE                            X**3
     C                     MOVE CCDORM    @PYRCV           ***3
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E1
     C*
     C** If value date settlement instructions are through a nostro
     C** add deal amount to MM fund in nostro.
     C           @PYRCV    IFEQ 'TELX '                    B1
     C           @PYRCV    OREQ 'CHIPS'                    *1
     C           @PYRCV    OREQ 'SWIFT'                    *1
     C           @PYRCV    OREQ 'CSENT'                    *1
     C           @PYRCV    OREQ 'CCOLL'                    *1
     C*
     C** On insert or amend add deal amount to MM funds in nostro.
     C*
     C** On insert add deal amount to MM funds in nostro.
     C           CCLACT    IFEQ 'I'                        B*2
     C           @AMEND    ANDEQ*BLANK                     **2
     C           CCDVSD    ANDGT0                          **2
     C*****      CCDVSD    ANDLTRUND                       **2            S01194
     C           CCDVSD    ANDLTBJRDNB                     **2            S01194
     C                     ADD  CCAMNP    @MMFN  150       **2
     C                     END                             E*2
     C*
     C** On amend add deal amount to MM funds in nostro.
     C           CCLACT    IFEQ 'A'                        B*2
     C           @AMEND    ANDEQ*BLANK                     **2
     C           CCDVSD    ANDGT0                          **2
     C*****      CCDVSD    ANDLTRUND                       **2            S01194
     C           CCDVSD    ANDLTBJRDNB                     **2            S01194
     C                     ADD  CCAMNP    @MMFN  150       **2
     C                     END                             E*2
     C*
     C** On delete subtract deal amount from MM nostro funds.
     C           CCLACT    IFEQ 'D'                        B*2
     C           CCDVSD    ANDGT0                          **2
     C*****      CCDVSD    ANDLTRUND                       **2            S01194
     C           CCDVSD    ANDLTBJRDNB                     **2            S01194
     C                     SUB  CCAMNP    @MMFN            **2
     C                     END                             E*2
     C*
     C** On amend subtract deal BU amount from MM nostro funds.
     C           CCLACT    IFEQ 'A'                        B*2
     C           @AMEND    ANDEQ'A'                        **2
     C           CCBVDT    ANDGT0                          **2
     C           CCBVDT    ANDLT@RUNDT                     **2
     C                     SUB  CCBAMT    @MMFN            **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C** Set up before update settlement instructions as front
     C** office type and update MM funds in nostro.
     C           CCLACT    IFEQ 'A'                        B1
     C           @AMEND    ANDEQ*BLANK                     *1
     C                     MOVE 'A'       @AMEND  1        *1
     C                     Z-ADD1         @I      30       *1
     C           CCBORM    LOKUP@MR,@I                   60*1
     C                     MOVE @DR,@I    CCDORM           *1
     C*
     C                     Z-ADD1         @I               *1
     C           CCBOPM    LOKUP@MR,@I                   60*1
     C                     MOVE @DR,@I    CCDOPM           *1
     C*
     C                     GOTO #BA1                       *1
     C                     END                             E1
     C*
     C           #BA9      ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BB      - Routine controlling updating sequence              *
     C*                                                               *
     C* CALLS    #BBC     - Update fwd book for SI deam               *
     C*          #BBD     - Update LF/MMFWDTLL total funds lent info  *
     C*          #BBA     - Route program through update sequence     *
     C*          #BBI     - Write / update records on LF/MMFWUTLL     *
     C*                                                               *
     C* CALLED BY  #B     - Determine which files to be updated       *
     C*                                                               *
     C* FLDS USED  @FMTY  - LF/MMSTDDLL format indicator              *
     C*            @DLTYP - Deal type ind - P = placing T = taking    *
     C*            @NA    - Array contains deal type of all placings  *
     C*                                                               *
     C*****************************************************************
     C           #BB       BEGSR
     C/COPY WNCPYSRC,MM0075C004
     C*
     C** Check which record format is processed
     C** If record format is STANDARD DEAL AMENDMENT Format
     C           @FMTY     IFEQ 'A'                        B1
     C*
     C** If Deam type is 'SI'
     C           CCTYPE    IFEQ 'SI'                       B*2
     C*                                                                   E12312
     C** BY PASS SI DEAM PROCESSING FOR NAB                               E12312
     C           IGORBS    ANDNE'B'                                       E12312
     C                     EXSR #BBC                       **2
     C                     END                             E*2
     C*
     C** If Deam type is 'PI' OR 'PD'
     C           CCTYPE    IFEQ 'PI'                       B*2
     C           CCTYPE    OREQ 'PD'                       **2
     C                     EXSR #BBD                       **2
     C                     END                             E*2
     C*
     C** Record format is STANDARD DEALS - NA Sold, NA Bought
     C** OR Loans/Deposit/CD Issued
     C*
     C                     ELSE                            X1
     C*
     C** If DEAL TYPE is 'IT' OR 'TD' OR 'CI'
     C                     MOVE *BLANK    @DLTYP           *1
     C           CCTYPE    IFEQ 'IT'                       B*2
     C           CCTYPE    OREQ 'TD'                       **2
     C           CCTYPE    OREQ 'CI'                       **2
     C/COPY WNCPYSRC,MM0075C027
      *                                                                                       CDL033
     C           CCTYPE    OREQ 'CF'                                                          CDL033
     C           CDL033    ANDEQ'Y'                                                           CDL033
      *                                                                                       CDL033
     C                     MOVE 'T'       @DLTYP  1        **2
     C                     END                             E*2
     C*
     C** If DEAL TYPE is 'IP','TL' OR 'CL'
     C           CCTYPE    IFEQ 'IP'                       B*2
     C           CCTYPE    OREQ 'TL'                       **2
     C           CCTYPE    OREQ 'CL'                       **2
     C                     MOVE 'P'       @DLTYP           **2
     C                     END                             E*2
     C*
     C** If deal type one of IT TD IP TL CI CL perform update routine
     C           @DLTYP    IFNE *BLANK                     B*2
     C                     EXSR #BBA                       **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C** If DEAL TYPE is 'IP', 'TL', 'CP', 'CL', 'DL' or format
     C** processed is for NA BOUGHT update total funds lent
     C           CCTYPE    LOKUP@NA,1                    60
     C           *IN60     IFEQ '1'                        B1
     C                     EXSR #BBD                       *1
     C                     END                             E1
     C*
     C** If NA Sold or Bought update total funds lent and NA net value
     C           @FMTY     IFEQ 'B'                        B1
     C           @FMTY     OREQ 'S'                        *1
     C                     EXSR #BBD                       *1
     C                     EXSR #BBE                       *1
     C                     END                             E1
     C*
     C** Update totals file
     C                     EXSR #BBI
     C*
     C           #BB9      ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BBA     - Route program through update sequence              *
     C*                                                               *
     C* CALLS    #BBAA    - Update forward book for value date details*
     C*          #BBAB    - Update fwd book for next intersest date   *
     C*          #BBAC    - Update fwd book for maturity date         *
     C*                                                               *
     C* CALLED BY  #BB    - Routine controlling updating sequence     *
     C*                                                               *
     C* FLDS USED         -                                           *
     C*                                                               *
     C*****************************************************************
     C           #BBA      BEGSR
     C*
     C** Initialise forward book file keys array, process                 E12279
     C** count and array index                                            E12279
     C                     MOVE *BLANK    @KY                             E12279
     C                     Z-ADD*ZERO     @C      10                      E12279
     C                     Z-ADD*ZERO     @KYI    10                      E12279
     C*                                                                   E12279
     C** Set up forward book file keys array with key date                E12279
     C** and sequence number for each update required                     E12279
     C** (there will be up to 7 keys)                                     E12279
     C*                                                                   E12279
     C** Set up new value date key                                        E12279
     C                     MOVE IKVDYY    @DTY                            E12279
     C                     MOVE IKVDMM    @DTM                            E12279
     C                     MOVE IKVDDD    @DTD                            E12279
     C                     MOVE '1'       @SEQ                            E12279
     C                     MOVE @KYE      @KY,1                           E12279
     C                     ADD  1         @C                              E12279
     C*                                                                   E12279
     C** Set up new maturity date key                                     E12279
     C                     MOVE @MDTD     @DAT                            E12279
     C                     MOVE '5'       @SEQ                            E12279
     C                     MOVE @KYE      @KY,5                           E12279
     C                     ADD  1         @C                              E12279
     C*                                                                   E12279
     C** If there is a new interest date                                  E12279
     C           @NIPD     IFNE 0                          B1             E12279
     C*                                                                   E12279
     C** Set up new interest date key                                     E12279
     C                     MOVE @NIPD     @DAT             *1             E12279
     C                     MOVE '3'       @SEQ             *1             E12279
     C                     MOVE @KYE      @KY,3            *1             E12279
     C                     ADD  1         @C               *1             E12279
     C*                                                                   E12279
     C                     END                             E1             E12279
     C*                                                    E1             E12279
     C** If action is amend                                               E12279
     C           CCLACT    IFEQ 'A'                        B1             E12279
     C*                                                                   E12279
     C** Set up old value date key                                        E12279
     C                     MOVE IKBVDT    @DAT             *1             E12279
     C                     MOVE '2'       @SEQ             *1             E12279
     C                     MOVE @KYE      @KY,2            *1             E12279
     C                     ADD  1         @C               *1             E12279
     C*                                                                   E12279
     C** Set up old maturity date key                                     E12279
     C                     MOVE IKBMTD    @DAT             *1             E12279
     C                     MOVE '6'       @SEQ             *1             E12279
     C                     MOVE @KYE      @KY,6            *1             E12279
     C                     ADD  1         @C               *1             E12279
     C*                                                                   E12279
     C** If there was an old new interest date                            E12279
     C           IKBNID    IFNE 0                          B*2            E12279
     C*                                                                   E12279
     C** Set up old interest date key                                     E12279
     C                     MOVE IKBNID    @DAT             **2            E12279
     C                     MOVE '4'       @SEQ             **2            E12279
     C                     MOVE @KYE      @KY,4            **2            E12279
     C                     ADD  1         @C               **2            E12279
     C*                                                                   E12279
     C                     END                             E*2            E12279
     C*                                                                   E12279
     C** Check for deam existing on deal                                  E12279
     C                     Z-ADDIKDN38    IGDA38           *1             E12279
     C                     Z-ADD0         @HNDAT           *1             E12279
     C                     Z-ADD0         IGDS38           *1             E12279
     C*                                                                   E12279
     C           @MDKEY    SETGTMMLVDMLL                   *1             E12279
     C                     READ MMLVDMLL                 60*1             E12279
     C*                                                                   E12279
     C** Set up flag indicating whether deam exists on deal               E12279
     C           *IN60     IFEQ '1'                        B*2            E12279
     C           HNDA38    ORNE IKDN38                     **2            E12279
     C                     MOVE 'N'       @DMFLG  1        **2            E12279
     C                     ELSE                            X*2            E12279
     C                     MOVE 'Y'       @DMFLG           **2            E12279
     C*                                                                   E12279
     C** Set up SI Deam value date key                                    E12279
     C                     MOVE HNVDYY    @DTY             **2            E12279
     C                     MOVE HNVDMM    @DTM             **2            E12279
     C                     MOVE HNVDDD    @DTD             **2            E12279
     C                     MOVE '7'       @SEQ             **2            E12279
     C                     MOVE @KYE      @KY,7            **2            E12279
     C                     ADD  1         @C               **2            E12279
     C*                                                                   E12279
     C                     END                             E*2            E12279
     C*                                                                   E12279
     C                     END                             E1             E12279
     C*                                                                   E12279
     C** Sort forward book file keys array in ascending order             E12279
     C** (SORTA will place empty elements at front of array)              E12279
     C                     SORTA@KY                                       E12279
     C*                                                                   E12279
     C** Calculate array index of first required event                    E12279
     C           8         SUB  @C        @KYI                            E12279
     C*                                                                   E12279
     C** Execute DO processing for the number of required events          E12279
     C** (the SORTA and DO-loop will cause file updates to be             E12279
     C** performed in ascending date order)                               E12279
     C                     DO   @C                         B1             E12279
     C*                                                                   E12279
     C** Move array element into array element data structure             E12279
     C                     MOVE @KY,@KYI  @KYE             *1             E12279
     C*                                                                   E12279
     C           @SEQ      IFEQ '1'                        B*2            E12279
     C           @SEQ      OREQ '2'                        **2            E12279
     C*
     C** Update forward book for deal start date
     C                     EXSR #BBAA                      **2
     C*
     C                     END                             E*2            E12279
     C*                                                                   E12279
     C           @SEQ      IFEQ '3'                        B*2            E12279
     C           @SEQ      OREQ '4'                        **2            E12279
     C*
     C** Update forward book for next interest date
     C                     EXSR #BBAB                      **2
     C*
     C                     END                             E*2            E12279
     C*                                                                   E12279
     C           @SEQ      IFEQ '4'                        B*2            E12279
     C           @SEQ      OREQ '5'                        **2            E12279
     C           @SEQ      OREQ '6'                        **2            E12279
     C           @SEQ      OREQ '7'                        **2            E12279
     C*
     C** Update forward book for maturity date
     C                     EXSR #BBAC                      **2
     C*
     C                     END                             E*2            E12279
     C*                                                                   E12279
     C                     ADD  1         @KYI             *1             E12279
     C*                                                                   E12279
     C                     END                             E1             E12279
     C*
     C*
     C           #BBA9     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BBAA    - Update forward book for value date details         *
     C*                                                               *
     C* CALLS    #ZA      - Write / update records on LF/MMFWUDLL     *
     C*          #ZB      - Write / update records on LF/MMFWUHLL     *
     C*                                                               *
     C* CALLED BY  #BBA   - Route program through update sequence     *
     C*                                                               *
     C* FLDS USED  @VDYY  - Date used in accessing forward book files *
     C*            @VDMM  - Date used in accessing forward book files *
     C*            @VDDD  - Date used in accessing forward book files *
     C*            @DLTYP - Deal type ind - P = placing T = taking    *
     C*            @DCIN  - Daily cash in                             *
     C*            @HMCI  - Half month cash in                        *
     C*            @TCIN  - Total cash in                             *
     C*            @DCOT  - Daily cash out                            *
     C*            @HMCO  - Half month cash out                       *
     C*            @TCOT  - Total cash out                            *
     C*            @RUNDT - Run date as YYYYMMDD format               *
     C*            @HNDAT - Data structure to format date as YYYYMMDD *
     C*            @@RDFC - Round down interest indicator             *   S01392
     C*                                                               *
     C*****************************************************************
     C           #BBAA     BEGSR
     C*
     C** Set up key to Forward books MMFWUDLL, MMFWUHLL & MMFWUTLL
     C                     Z-ADDIKVDYY    @VDYY
     C                     Z-ADDIKVDMM    @VDMM
     C                     Z-ADDIKVDDD    @VDDD
     C*
     C** Perform update processing for new value date                     E12279
     C           @SEQ      IFEQ '1'                        B1             E12279
     C*
     C** If deal valued date greater than run date update forward
     C** book with start details
     C*****      IKDVSD    IFGE RUND                       B*2            S01194
     C           IKDVSD    IFGE BJRDNB                     B*2            S01194
     C*
     C** Add values into book
     C           CCLACT    IFEQ 'I'                        B**3
     C           CCLACT    OREQ 'A'                        ***3
     C*
     C** If deal type is deposit/taking update cash in ....
     C           @DLTYP    IFEQ 'T'                        B***4
     C                     Z-ADDIKAMNP    @DCIN            ****4
     C                     Z-ADDIKAMNP    @HMCI            ****4
     C                     ADD  IKAMNP    @TCIN            ****4
     C*
     C** ...otherwise if loan/placing update cash out.
     C                     ELSE                            X***4
     C                     Z-SUBIKAMNP    @DCOT            ****4
     C                     Z-SUBIKAMNP    @HMCO            ****4
     C                     SUB  IKAMNP    @TCOT            ****4
     C                     END                             E***4
     C*
     C** Back details out of book on deletion
     C                     ELSE                            X**3
     C*
     C** If deal type is deposit/taking update cash in ....
     C           @DLTYP    IFEQ 'T'                        B***4
     C                     Z-SUBIKAMNP    @DCIN            ****4
     C                     Z-SUBIKAMNP    @HMCI            ****4
     C                     SUB  IKAMNP    @TCIN            ****4
     C*
     C** ...otherwise if loan/placin update cash out.
     C                     ELSE                            X***4
     C                     Z-ADDIKAMNP    @DCOT            ****4
     C                     Z-ADDIKAMNP    @HMCO            ****4
     C                     ADD  IKAMNP    @TCOT            ****4
     C                     END                             E***4
     C                     END                             E**3
     C*
     C** Perform file updating procedures.
     C                     EXSR #ZA                        **2
     C                     EXSR #ZB                        **2
     C                     END                             E*2
     C*
     C                     END                             E1             E12279
     C*                                                                   E12279
     C** Perform update processing for old value date                     E12279
     C           @SEQ      IFEQ '2'                        B1             E12279
     C*
     C** If last action is amend back out before update details
     C** only if before update value date is greater than run date
     C           IKBVDT    IFGE @RUNDT                     B*2
     C           CCLACT    ANDEQ'A'                        **2
     C                     Z-ADDIKBVDT    @HNDAT           **2
     C           @DLTYP    IFEQ 'T'                        B**3
     C                     Z-SUBIKBAMT    @DCIN            ***3
     C                     Z-SUBIKBAMT    @HMCI            ***3
     C                     SUB  IKBAMT    @TCIN            ***3
     C                     ELSE                            X**3
     C                     Z-ADDIKBAMT    @DCOT            ***3
     C                     Z-ADDIKBAMT    @HMCO            ***3
     C                     ADD  IKBAMT    @TCOT            ***3
     C                     END                             E**3
     C*
     C** Update Forward Books
     C                     EXSR #ZA                        **2
     C                     EXSR #ZB                        **2
     C                     END                             E*2
     C*
     C                     END                             E1             E12279
     C*
     C*                                                                   S01392
     C** PROCESSING FOR JAPANESE SUB-MODULE (Front-up Interest)           S01392
     C*                                                                   S01392
     C** If Front up Interest indicator on interest is added/deducted     S01392
     C** at value date into book.                                         S01392
     C           IKFUID    IFEQ 'Y'                        B1             S01392
     C*                                                                   S01392
     C** Calculate interest at value date.                                S01392
     C***********          Z-ADDIKDVSD    @@BEG            *1       S01392056095
     C***********          Z-ADDIKMATD    @@END            *1       S01392056095
     C                     Z-ADDIKDVSD    ZZBEG            *1             056095
     C                     Z-ADDIKMATD    ZZEND            *1             056095
     C**                                                                  S01392
     C** If First & Last Day Interest indicator on add an extra           S01392
     C** day's interest.                                                  S01392
     C           IKFLID    IFEQ 'Y'                        B*2            S01392
     C***********          ADD  1         @@END            **2      S01392056095
     C                     ADD  1         ZZEND            **2            056095
     C                     END                             E*2            S01392
     C**                                                                  S01392
     C***********          MOVE IKICMT    @@CALC           *1       S01392056095
     C                     MOVE IKICMT    ZZCALC           *1             056095
     C                     Z-ADDIKAMNP    @@AMT            *1             S01392
     C                     Z-ADDIKINTR    @@RATE           *1             S01392
     C                     MOVE IKRDFC    @@RDFC  1        *1             S01392
     C/COPY WNCPYSRC,MM0075C005
     C                     EXSR MM1030                     *1             S01392
     C/COPY WNCPYSRC,MM0075C006
     C                     MULT 10        @@INTR           *1             S01392
     C*                                                                   S01392
     C** Perform update processing for new value date.                    S01392
     C           @SEQ      IFEQ '1'                        B*2            S01392
     C*                                                                   S01392
     C** Add interest at value into book on insertion                     S01392
     C           IKDVSD    IFGE BJRDNB                     B**3           S01392
     C           CCLACT    IFEQ 'I'                        B***4          S01392
     C                     Z-SUB@@INTR    @DNIM            ****4          S01392
     C                     DIV  10        @@INTR    H      ****4          S01392
     C                     Z-SUB@@INTR    @HNIM            ****4          S01392
     C                     SUB  @@INTR    @NIMT            ****4          S01392
     C                     END                             E***4          S01392
     C*                                                                   S01392
     C** Subtract interest at value from book on deletion                 S01392
     C           CCLACT    IFEQ 'D'                        B***4          S01392
     C                     Z-ADD@@INTR    @DNIM            ****4          S01392
     C                     DIV  10        @@INTR    H      ****4          S01392
     C                     Z-ADD@@INTR    @HNIM            ****4          S01392
     C                     ADD  @@INTR    @NIMT            ****4          S01392
     C                     END                             E***4          S01392
     C*                                                                   S01392
     C** If last action insertion or deletion update details on           S01392
     C** books otherwise........                                          S01392
     C           CCLACT    IFEQ 'I'                        B***4          S01392
     C           CCLACT    OREQ 'D'                        ****4          S01392
     C                     EXSR #ZA                        ****4          S01392
     C                     EXSR #ZB                        ****4          S01392
     C                     END                             E***4          S01392
     C                     END                             E**3           S01392
     C*                                                                   S01392
     C                     END                             E*2            S01392
     C*                                                                   S01392
     C** ...If last action code is amend add in interest at value to book S01392
     C** and back out BU interest at value from book.                     S01392
     C           CCLACT    IFEQ 'A'                        B*2            S01392
     C*                                                                   S01392
     C** Perform update processing for new value date.                    S01392
     C           @SEQ      IFEQ '1'                        B**3           S01392
     C*                                                                   S01392
     C           IKDVSD    IFGE BJRDNB                     B***4          S01392
     C                     Z-SUB@@INTR    @DNIM            ****4          S01392
     C                     DIV  10        @@INTR    H      ****4          S01392
     C                     Z-SUB@@INTR    @HNIM            ****4          S01392
     C                     SUB  @@INTR    @NIMT            ****4          S01392
     C*                                                                   S01392
     C** Update Forward Books                                             S01392
     C                     EXSR #ZA                        ****4          S01392
     C                     EXSR #ZB                        ****4          S01392
     C                     END                             E***4          S01392
     C*                                                                   S01392
     C                     END                             E**3           S01392
     C*                                                                   S01392
     C** Back out BU interest amount.                                     S01392
     C           @SEQ      IFEQ '2'                        B**3           S01392
     C*                                                                   S01392
     C***********          Z-ADDIKBVDT    @@DTIN           ***3     S01392056095
     C***********          EXSR ZA0680                     ***3     S01392056095
     C***********          Z-ADD@@MDNO    @@BEG            ***3     S01392056095
     C                     Z-ADDIKBVDT    ZZDTIN           ***3           056095
     C                     EXSR ZDAT10                     ***3           056095
     C                     Z-ADDZZMDNO    ZZBEG            ***3           056095
     C*                                                                   S01392
     C***********          Z-ADDIKBMTD    @@DTIN           ***3     S01392056095
     C***********          EXSR ZA0680                     ***3     S01392056095
     C***********          Z-ADD@@MDNO    @@END            ***3     S01392056095
     C                     Z-ADDIKBMTD    ZZDTIN           ***3           056095
     C                     EXSR ZDAT10                     ***3           056095
     C                     Z-ADDZZMDNO    ZZEND            ***3           056095
     C*                                                                   S01392
     C** If Before Update First & Last day Interest indicator on          S01392
     C** add an extra day's interest.                                     S01392
     C           IKBFLI    IFEQ 'Y'                        B***4          S01392
     C***********          ADD  1         @@END            ****4    S01392056095
     C                     ADD  1         ZZEND            ****4          056095
     C                     END                             E***4          S01392
     C*                                                                   S01392
     C** Calculate BU interest.                                           S01392
     C***********          MOVE IKBICM    @@CALC           ***3     S01392056095
     C                     MOVE IKBICM    ZZCALC           ***3           056095
     C                     Z-ADDIKBAMT    @@AMT            ***3           S01392
     C                     Z-ADDIKBIRT    @@RATE           ***3           S01392
     C                     MOVE IKBRDF    @@RDFC           ***3           S01392
     C                     EXSR MM1030                     ***3           S01392
     C/COPY WNCPYSRC,MM0075C007
     C                     MULT 10        @@INTR           ***3           S01392
     C/COPY WNCPYSRC,MM0075C008
     C*                                                                   S01392
     C** If BU deal was 'Front-up Interest' then need to                  S01392
     C** back out interest at VALUE date, else back out                   S01392
     C** interest at MATURITY date.                                       S01392
     C           IKBFUI    IFEQ 'Y'                        B***4          S01392
     C                     Z-ADDIKBVDT    @HNDAT           ****4          S01392
     C                     ELSE                            X***4          S01392
     C                     Z-ADDIKBMTD    @HNDAT           ****4          S01392
     C                     END                             E***4          S01392
     C*                                                                   S01392
     C                     Z-ADD@@INTR    @DNIM            ***3           S01392
     C                     DIV  10        @@INTR    H      ***3           S01392
     C                     Z-ADD@@INTR    @HNIM            ***3           S01392
     C                     ADD  @@INTR    @NIMT            ***3           S01392
     C*                                                                   S01392
     C** Back out BU interest if on forward book                          S01392
     C           @HNDAT    IFGE @RUNDT                     B***4          S01392
     C*                                                                   S01392
     C** Update Forward Books                                             S01392
     C                     EXSR #ZA                        ****4          S01392
     C                     EXSR #ZB                        ****4          S01392
     C                     END                             E***4          S01392
     C*                                                                   S01392
     C                     END                             E**3           S01392
     C                     END                             E*2            S01392
     C*                                                                   S01392
     C** If deal was previously Front-up interest but has been            S01392
     C** amended to 'standard' need to back out value date                S01392
     C** interest (providing value date is on or after today's            S01392
     C** date).                                                           S01392
     C                     ELSE                            X1             S01392
     C*                                                                   S01392
     C           IKBFUI    IFEQ 'Y'                        B*2            S01392
     C           @SEQ      ANDEQ'2'                        B*2            S01392
     C           @HNDAT    ANDGE@RUNDT                     B*2            S01392
     C*                                                                   S01392
     C***********          Z-ADDIKBVDT    @@DTIN           **2      S01392056095
     C***********          EXSR ZA0680                     **2      S01392056095
     C***********          Z-ADD@@MDNO    @@BEG            **2      S01392056095
     C                     Z-ADDIKBVDT    ZZDTIN           **2            056095
     C                     EXSR ZDAT10                     **2            056095
     C                     Z-ADDZZMDNO    ZZBEG            **2            056095
     C*                                                                   S01392
     C***********          Z-ADDIKBMTD    @@DTIN           **2      S01392056095
     C***********          EXSR ZA0680                     **2      S01392056095
     C***********          Z-ADD@@MDNO    @@END            **2      S01392056095
     C                     Z-ADDIKBMTD    ZZDTIN           **2            056095
     C                     EXSR ZDAT10                     **2            056095
     C                     Z-ADDZZMDNO    ZZEND            **2            056095
     C*                                                                   S01392
     C** If Before Update First & Last day Interest indicator on          S01392
     C** add an extra day's interest.                                     S01392
     C           IKBFLI    IFEQ 'Y'                        B**3           S01392
     C***********          ADD  1         @@END            ***3     S01392056095
     C                     ADD  1         ZZEND            ***3           056095
     C                     END                             E**3           S01392
     C**                                                                  S01392
     C** Calculate BU interest.                                           S01392
     C***********          MOVE IKBICM    @@CALC           **2      S01392056095
     C                     MOVE IKBICM    ZZCALC           **2            056095
     C                     Z-ADDIKBAMT    @@AMT            **2            S01392
     C                     Z-ADDIKBIRT    @@RATE           **2            S01392
     C                     MOVE IKBRDF    @@RDFC           **2            S01392
     C/COPY WNCPYSRC,MM0075C009
     C                     EXSR MM1030                     **2            S01392
     C/COPY WNCPYSRC,MM0075C010
     C                     MULT 10        @@INTR           **2            S01392
     C*                                                                   S01392
     C                     Z-ADDIKBVDT    @HNDAT           **2            S01392
     C                     Z-ADD@@INTR    @DNIM            **2            S01392
     C                     DIV  10        @@INTR    H      **2            S01392
     C                     Z-ADD@@INTR    @HNIM            **2            S01392
     C                     ADD  @@INTR    @NIMT            **2            S01392
     C*                                                                   S01392
     C** Update Forward Books                                             S01392
     C                     EXSR #ZA                        **2            S01392
     C                     EXSR #ZB                        **2            S01392
     C*                                                                   S01392
     C                     END                             E*2            S01392
     C*                                                                   S01392
     C                     END                             E1             S01392
     C*                                                                   S01392
     C           #BBAA9    ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BBAB    - Update fwd book for next intersest date            *
     C*                                                               *
     C**CALLS****MM1007***- Calc interest due at next interest date   *   E17051
     C* CALLS    MM1030   - Calc interest due at next interest date   *   E17051
     C*          #ZA      - Write / update records on LF/MMFWUDLL     *
     C*          #ZB      - Write / update records on LF/MMFWUHLL     *
     C***********ZA0680***-*Convert*a*date*to*day*number*form**********   056095
     C*          ZDAT10   - Convert a date to day number form         *   056095
     C*                                                               *
     C* CALLED BY  #BBA   - Route program through update sequence     *
     C*                                                               *
     C* FLDS USED  @NIPD  - DS contains next int payment date         *
     C*            @HNDAT - Data structure to format date as YYYYMMDD *
     C*            @RUNDT - Run date as YYYYMMDD format               *
     C*            @MDTD  - DS contains maturity date                 *
     C*************@@BEG**-*Beginning*of*interest*period***************   056095
     C*************@@END**-*End*of*interest*period*********************   056095
     C*************@@CALC*-*Interest*calculation*method****************   056095
     C*            ZZBEG  - Beginning of interest period              *   056095
     C*            ZZEND  - End of interest period                    *   056095
     C*            ZZCALC - Interest calculation method               *   056095
     C*            @@AMT  - Deal amount                               *
     C*            @@RATE - Deal interest rate                        *
     C*            @@INTR - Amount of interest due                    *
     C*            @DNIM  - Daily net interest movement               *
     C*            @HNIM  - Half month net interest movement          *
     C*            @NIMT  - Net interest movement                     *
     C*************@@DTIN*-*DS*contains*date*in*YYYYMMDD*for*ZA0680****   056095
     C*************@@MDNO*-*MIDAS*day*number***************************   056095
     C*            ZZDTIN - DS contains date in YYYYMMDD for ZDAT10   *   056095
     C*            ZZMDNO - MIDAS day number                          *   056095
     C*                                                               *
     C*****************************************************************
     C           #BBAB     BEGSR
     C*
     C** Perform update processing for new interest date                  E12279
     C           @SEQ      IFEQ '3'                        B1             E12279
     C*
     C** If next interest payment date entered calculate interest at
     C** next interest payment date and update files.
     C                     Z-ADD@NIPD     @HNDAT           *1
     C*
     C** Calculate interest at next interest date.
     C           @NIPD     IFGE @RUNDT                     B*2
     C           @NIPD     ANDLT@MDTD                      **2
     C***********          Z-ADDIKSLID    @@BEG            **2            056095
     C***********          Z-ADDIKNIPD    @@END            **2            056095
     C***********          MOVE IKICMT    @@CALC           **2            056095
     C                     Z-ADDIKSLID    ZZBEG            **2            056095
     C                     Z-ADDIKNIPD    ZZEND            **2            056095
     C                     MOVE IKICMT    ZZCALC           **2            056095
     C                     Z-ADDIKAMNP    @@AMT            **2
     C                     Z-ADDIKINTR    @@RATE           **2
     C******************** EXSR MM1007                     **2            E17051
     C/COPY WNCPYSRC,MM0075C011
     C                     EXSR MM1030                     **2            E17051
     C/COPY WNCPYSRC,MM0075C012
     C                     MULT 10        @@INTR           **2            E19980
     C*
     C** Add interest into book.
     C           CCLACT    IFEQ 'I'                        B**3
     C           CCLACT    OREQ 'A'                        ***3
     C                     Z-SUB@@INTR    @DNIM            ***3
     C                     DIV  10        @@INTR    H      ***3
     C                     Z-SUB@@INTR    @HNIM            ***3
     C                     SUB  @@INTR    @NIMT            ***3
     C                     ELSE                            X**3
     C                     Z-ADD@@INTR    @DNIM            ***3
     C                     DIV  10        @@INTR    H      ***3
     C                     Z-ADD@@INTR    @HNIM            ***3
     C                     ADD  @@INTR    @NIMT            ***3
     C                     END                             E**3
     C*
     C** Update forward book details.
     C                     EXSR #ZA                        **2
     C                     EXSR #ZB                        **2
     C                     END                             E*2
     C*
     C                     END                             E1             E12279
     C*                                                                   E12279
     C** Perform update processing for old interest date                  E12279
     C           @SEQ      IFEQ '4'                        B1             E12279
     C*
     C** If deal is amendment back out before update details
     C           IKBNID    IFGE @RUNDT                     B*2
     C           IKBNID    ANDLTIKBMTD                     **2
     C           CCLACT    ANDEQ'A'                        **2
     C*
     C** If BU next interest payment date entered calculate BU interest
     C** at next interest payment date and update files.
     C                     Z-ADDIKBNID    @HNDAT           **2
     C*
     C** Convert BU start/last int and BU next int date fo MM1007
     C***********          Z-ADDIKBLID    @@DTIN           **2            056095
     C***********          EXSR ZA0680                     **2            056095
     C***********          Z-ADD@@MDNO    @@BEG            **2            056095
     C                     Z-ADDIKBLID    ZZDTIN           **2            056095
     C                     EXSR ZDAT10                     **2            056095
     C                     Z-ADDZZMDNO    ZZBEG            **2            056095
     C*
     C***********          Z-ADDIKBNID    @@DTIN           **2            056095
     C***********          EXSR ZA0680                     **2            056095
     C***********          Z-ADD@@MDNO    @@END            **2            056095
     C                     Z-ADDIKBNID    ZZDTIN           **2            056095
     C                     EXSR ZDAT10                     **2            056095
     C                     Z-ADDZZMDNO    ZZEND            **2            056095
     C*
     C** Calculate interest at next interest date.
     C***********          MOVE IKBICM    @@CALC           **2            056095
     C                     MOVE IKBICM    ZZCALC           **2            056095
     C                     Z-ADDIKBAMT    @@AMT            **2
     C                     Z-ADDIKBIRT    @@RATE           **2
     C******************** EXSR MM1007                     **2            E17051
     C/COPY WNCPYSRC,MM0075C013
     C                     EXSR MM1030                     **2            E17051
     C/COPY WNCPYSRC,MM0075C014
     C                     MULT 10        @@INTR           **2            E19980
     C*
     C** Add interest into book.
     C                     Z-ADD@@INTR    @DNIM            **2
     C                     DIV  10        @@INTR    H      **2
     C                     Z-ADD@@INTR    @HNIM            **2
     C                     ADD  @@INTR    @NIMT            **2
     C*
     C** Update forward book details.
     C                     EXSR #ZA                        **2
     C                     EXSR #ZB                        **2
     C                     END                             E*2
     C*
     C                     END                             E1             E12279
     C*
     C           #BBAB9    ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BBAC    - Update fwd book for maturity date                  *
     C*                                                               *
     C* CALLS    #ZA      - Write / update records on LF/MMFWUDLL     *
     C*          #ZB      - Write / update records on LF/MMFWUHLL     *
     C***********MM1007   - Calc interest due at next interest date   *   E17051
     C*          MM1030   - Calc interest due at next interest date   *   E17051
     C***********ZA0680***-*Convert*a*date*to*day*number*form**********   056095
     C*          ZDAT10   - Convert a date to day number form         *   056095
     C*                                                               *
     C* CALLED BY  #BBA   - Route program through update sequence     *
     C*                                                               *
     C* FLDS USED  @MDTD  - DS contains maturity date                 *
     C*            @RUNDT - Run date as YYYYMMDD format               *
     C*            @DLTYP - Deal type ind - P = placing T = taking    *
     C*            @DCOT  - Daily cash out                            *
     C*            @HMCO  - Half month cash out                       *
     C*            @TCOT  - Total cash out                            *
     C*            @DCIN  - Daily cash in                             *
     C*            @HMCI  - Half month cash in                        *
     C*            @TCIN  - Total cash in                             *
     C*            @HNDAT - Data structure to format date as YYYYMMDD *
     C*            @NIPD  - DS contains next int payment date         *
     C*************@@BEG**-*Beginning*of*interest*period***************   056095
     C*************@@END**-*End*of*interest*period*********************   056095
     C*************@@CALC*-*Interest*calculation*method****************   056095
     C*            ZZBEG  - Beginning of interest period              *   056095
     C*            ZZEND  - End of interest period                    *   056095
     C*            ZZCALC - Interest calculation method               *   056095
     C*            @@AMT  - Deal amount                               *
     C*            @@RATE - Deal interest rate                        *
     C*            @@INTR - Amount of interest due                    *
     C*            @DNIM  - Daily net interest movement               *
     C*            @HNIM  - Half month net interest movement          *
     C*            @NIMT  - Net interest movement                     *
     C*************@@DTIN*-*DS*contains*date*in*YYYYMMDD*for*ZA0680****   056095
     C*************@@MDNO*-*MIDAS*day*number***************************   056095
     C*            ZZDTIN - DS contains date in YYYYMMDD for ZDAT10   *   056095
     C*            ZZMDNO - MIDAS day number                          *   056095
     C*            @MDKEY - Key to LF/MMLVDMLL                        *
     C*            @DMFLG - Flag ind if later deam exists on deal     *
     C*            @VDYY  - Date used in accessing forward book files *
     C*            @VDMM  - Date used in accessing forward book files *
     C*            @VDDD  - Date used in accessing forward book files *
     C*            @DMDVS - Deam value date as MIDAS day number       *
     C*            @@RDFC - Round down interest indicator             *   S01392
     C*                                                               *
     C*****************************************************************
     C           #BBAC     BEGSR
     C*
     C** Perform update processing for new maturity date                  E12279
     C           @SEQ      IFEQ '5'                        B1             E12279
     C*
     C** First update amounts at maturity.
     C           @MDTD     IFGE @RUNDT                     B*2
     C*                                                                   S01279
     C** Set up effective rate as the interest rate (this includes        S01279
     C** any base rate and spread effects on the rate)                    S01279
     C                     Z-ADDIKINTR    @EFRT            **2            S01279
     C*
     C** Add values into book
     C           CCLACT    IFEQ 'I'                        B**3
     C           CCLACT    OREQ 'A'                        ***3
     C*
     C** If deal type is deposit/taking update cash in ....
     C           @DLTYP    IFEQ 'T'                        B***4
     C**********           Z-ADDIKAMNP    @DCOT            ****4          S01279
     C                     Z-ADDIKAMNP    @MAOT            ****4          S01279
     C                     Z-ADDIKAMNP    @HMCO            ****4
     C                     ADD  IKAMNP    @TCOT            ****4
     C*
     C** ...otherwise if loan/placing update cash out.
     C                     ELSE                            X***4
     C**********           Z-SUBIKAMNP    @DCIN            ****4          S01279
     C                     Z-SUBIKAMNP    @MAIN            ****4          S01279
     C                     Z-SUBIKAMNP    @HMCI            ****4
     C                     SUB  IKAMNP    @TCIN            ****4
     C                     END                             E***4
     C*
     C** Back details out of book on deletion
     C                     ELSE                            X**3
     C*
     C** If deal type is deposit/taking update cash in ....
     C           @DLTYP    IFEQ 'T'                        B***4
     C**********           Z-SUBIKAMNP    @DCOT            ****4          S01279
     C                     Z-SUBIKAMNP    @MAOT            ****4          S01279
     C                     Z-SUBIKAMNP    @HMCO            ****4
     C                     SUB  IKAMNP    @TCOT            ****4
     C*
     C** ...otherwise if loan/placing update cash out.
     C                     ELSE                            X***4
     C**********           Z-ADDIKAMNP    @DCIN            ****4          S01279
     C                     Z-ADDIKAMNP    @MAIN            ****4          S01279
     C                     Z-ADDIKAMNP    @HMCI            ****4
     C                     ADD  IKAMNP    @TCIN            ****4
     C                     END                             E***4
     C                     END                             E**3
     C*
     C** Perform file updating procedures.
     C                     Z-ADD@MDTD     @HNDAT           **2
     C                     EXSR #ZA                        **2
     C                     EXSR #ZB                        **2
     C                     END                             E*2
     C*
     C                     END                             E1             E12279
     C*                                                                   E12279
     C** Perform update processing for old maturity date                  E12279
     C           @SEQ      IFEQ '6'                        B1             E12279
     C*
     C** If last action is amend back out before update details
     C** only if before update maturity date is greater than run date
     C           IKBMTD    IFGE @RUNDT                     B*2
     C           CCLACT    ANDEQ'A'                        **2
     C*                                                                   S01279
     C** Set up effective rate as the interest rate (this includes        S01279
     C** any base rate and spread effects on the rate)                    S01279
     C************         Z-SUBIKBIRT    @EFRT            **2     S01279 E36024
     C                     Z-ADDIKBIRT    @EFRT            **2            E36024
     C*                                                                   S01279
     C                     Z-ADDIKBMTD    @HNDAT           **2
     C           @DLTYP    IFEQ 'T'                        B**3
     C**********           Z-SUBIKBAMT    @DCOT            ***3           S01279
     C                     Z-SUBIKBAMT    @MAOT            ***3           S01279
     C                     Z-SUBIKBAMT    @HMCO            ***3
     C                     SUB  IKBAMT    @TCOT            ***3
     C                     ELSE                            X**3
     C**********           Z-ADDIKBAMT    @DCIN            ***3           S01279
     C                     Z-ADDIKBAMT    @MAIN            ***3           S01279
     C                     Z-ADDIKBAMT    @HMCI            ***3
     C                     ADD  IKBAMT    @TCIN            ***3
     C                     END                             E**3
     C*
     C** Update Forward Books
     C                     EXSR #ZA                        **2
     C                     EXSR #ZB                        **2
     C                     END                             E*2
     C*
     C                     END                             E1             E12279
     C*
     C** If next interest payment date is greater than zero update
     C** maturity date details with next interest amount
     C           @NIPD     IFGE @RUNDT                     B1
     C           @NIPD     ANDGE@MDTD                      *1
     C*
     C** Perform update processing for new maturity date                  E12279
     C           @SEQ      IFEQ '5'                        B*2            E12279
     C*
     C                     Z-ADD@MDTD     @HNDAT           **2
     C*
     C** Calc interest amount to be added into book at maturity date
     C***********          Z-ADDIKSLID    @@BEG            **2            056095
     C***********          Z-ADDIKMATD    @@END            **2            056095
     C***********          MOVE IKICMT    @@CALC           **2            056095
     C                     Z-ADDIKSLID    ZZBEG            **2            056095
     C                     Z-ADDIKMATD    ZZEND            **2            056095
     C                     MOVE IKICMT    ZZCALC           **2            056095
     C                     Z-ADDIKAMNP    @@AMT            **2
     C                     Z-ADDIKINTR    @@RATE           **2
     C******************** EXSR MM1007                     **2            E17051
     C/COPY WNCPYSRC,MM0075C015
     C                     EXSR MM1030                     **2            E17051
     C/COPY WNCPYSRC,MM0075C016
     C                     MULT 10        @@INTR           **2            E19980
     C*
     C** For insert/amend add interest into book otherwise ...
     C           CCLACT    IFEQ 'I'                        B**3
     C           CCLACT    OREQ 'A'                        ***3
     C                     Z-SUB@@INTR    @DNIM            ***3
     C                     DIV  10        @@INTR    H      ***3
     C                     Z-SUB@@INTR    @HNIM            ***3
     C                     SUB  @@INTR    @NIMT            ***3
     C*
     C** back interest out of book.
     C                     ELSE                            X**3
     C                     Z-ADD@@INTR    @DNIM            ***3
     C                     DIV  10        @@INTR    H      ***3
     C                     Z-ADD@@INTR    @HNIM            ***3
     C                     ADD  @@INTR    @NIMT            ***3
     C                     END                             E**3
     C*
     C** Update forward book details.
     C                     EXSR #ZA                        **2
     C                     EXSR #ZB                        **2
     C*
     C                     END                             E*2            E12279
     C*                                                                   E12279
     C** Perform update processing for old maturity date                  E12279
     C           @SEQ      IFEQ '6'                        B*2            E12279
     C*
     C** If action is amend back out BU interest at maturity details
     C           IKBNID    IFGE @RUNDT                     B**3
     C           IKBNID    ANDGEIKBMTD                     ***3
     C                     Z-ADDIKBMTD    @HNDAT           ***3
     C*
     C** Calc BU next interest date.
     C***********          Z-ADDIKBLID    @@DTIN           ***3           056095
     C***********          EXSR ZA0680                     ***3           056095
     C***********          Z-ADD@@MDNO    @@BEG            ***3           056095
     C                     Z-ADDIKBLID    ZZDTIN           ***3           056095
     C                     EXSR ZDAT10                     ***3           056095
     C                     Z-ADDZZMDNO    ZZBEG            ***3           056095
     C*
     C                     Z-ADDIKBMTD    @HNDAT           ***3
     C***********          Z-ADDIKBMTD    @@DTIN           ***3           056095
     C***********          EXSR ZA0680                     ***3           056095
     C***********          Z-ADD@@MDNO    @@END            ***3           056095
     C                     Z-ADDIKBMTD    ZZDTIN           ***3           056095
     C                     EXSR ZDAT10                     ***3           056095
     C                     Z-ADDZZMDNO    ZZEND            ***3           056095
     C*
     C** Calc interest amount to be taken from book at maturity date
     C***********          MOVE IKBICM    @@CALC           ***3           056095
     C                     MOVE IKBICM    ZZCALC           ***3           056095
     C                     Z-ADDIKBAMT    @@AMT            ***3
     C                     Z-ADDIKBIRT    @@RATE           ***3
     C******************** EXSR MM1007                     ***3           E17051
     C/COPY WNCPYSRC,MM0075C017
     C                     EXSR MM1030                     ***3           E17051
     C/COPY WNCPYSRC,MM0075C018
     C                     MULT 10        @@INTR           ***3           E19980
     C*
     C** For amend remove BU interest from book
     C                     Z-ADD@@INTR    @DNIM            ***3
     C                     DIV  10        @@INTR    H      ***3
     C                     Z-ADD@@INTR    @HNIM            ***3
     C                     ADD  @@INTR    @NIMT            ***3
     C*
     C** Update forward book details.
     C                     EXSR #ZA                        ***3
     C                     EXSR #ZB                        ***3
     C                     END                             E**3
     C*
     C                     END                             E*2            E12279
     C*
     C                     END                             E1
     C*
     C** If next interest date not entered add interest at
     C** maturity into book.
     C           @NIPD     IFEQ 0                          B1
     C*
     C** If Front up Interest indicator on interest was added/deducted    S01392
     C** at value date into book, so skip maturity date processing.       S01392
     C           IKFUID    ANDNE'Y'                        B1             S01392
     C*                                                                   S01392
     C** Calculate interest at maturity.
     C***********          Z-ADDIKDVSD    @@BEG            *1             056095
     C***********          Z-ADDIKMATD    @@END            *1             056095
     C                     Z-ADDIKDVSD    ZZBEG            *1             056095
     C                     Z-ADDIKMATD    ZZEND            *1             056095
     C*                                                                   S01392
     C** If First & Last Day Interest indicator on add an extra           S01392
     C** day's interest.                                                  S01392
     C           IKFLID    IFEQ 'Y'                        B*2            S01392
     C***********          ADD  1         @@END            **2      S01392056095
     C                     ADD  1         ZZEND            **2            056095
     C                     END                             E*2            S01392
     C**                                                                  S01392
     C***********          MOVE IKICMT    @@CALC           *1             056095
     C                     MOVE IKICMT    ZZCALC           *1             056095
     C                     Z-ADDIKAMNP    @@AMT            *1
     C                     Z-ADDIKINTR    @@RATE           *1
     C                     MOVE IKRDFC    @@RDFC           *1             S01392
     C******************** EXSR MM1007                     *1             E17051
     C/COPY WNCPYSRC,MM0075C019
     C                     EXSR MM1030                     *1             E17051
     C/COPY WNCPYSRC,MM0075C020
     C                     MULT 10        @@INTR           *1             E19980
     C*
     C** Perform update processing for new maturity date                  E12279
     C           @SEQ      IFEQ '5'                        B*2            E12279
     C*
     C** Add interest at maturity into book on insertion
     C           @MDTD     IFGE @RUNDT                     B**3
     C           CCLACT    IFEQ 'I'                        B***4
     C                     Z-SUB@@INTR    @DNIM            ****4
     C                     DIV  10        @@INTR    H      ****4
     C                     Z-SUB@@INTR    @HNIM            ****4
     C                     SUB  @@INTR    @NIMT            ****4
     C                     END                             E***4
     C*
     C** Subtract interest at maturity from book on deletion
     C           CCLACT    IFEQ 'D'                        B***4
     C                     Z-ADD@@INTR    @DNIM            ****4
     C                     DIV  10        @@INTR    H      ****4
     C                     Z-ADD@@INTR    @HNIM            ****4
     C                     ADD  @@INTR    @NIMT            ****4
     C                     END                             E***4
     C*
     C** If last action insertion or deletion update details on
     C** books otherwise........
     C           CCLACT    IFEQ 'I'                        B***4
     C           CCLACT    OREQ 'D'                        ****4
     C                     Z-ADD@MDTD     @HNDAT           ****4
     C                     EXSR #ZA                        ****4
     C                     EXSR #ZB                        ****4
     C                     END                             E***4
     C                     END                             E**3
     C*
     C                     END                             E*2            E12279
     C*
     C** .....If last action code is amend need to check whether 'SI'
     C** deam has been performed on deal.
     C           CCLACT    IFEQ 'A'                        B*2
     C**********           Z-ADDIKDN38    IGDA38           **2            E12279
     C**********           Z-ADD0         @HNDAT           **2            E12279
     C**********           Z-ADD0         IGDS38           **2            E12279
     C**********                                                          E12279
     C********** @MDKEY    SETGTMMLVDMLL                   **2            E12279
     C**********           READ MMLVDMLL                 60**2            E12279
     C**********                                                          E12279
     C***Set*up*flag indicating whether deam exists on deal.              E12279
     C********** *IN60     IFEQ '1'                        B**3           E12279
     C********** HNDA38    ORNE IKDN38                     ***3           E12279
     C**********           MOVE 'N'       @DMFLG  1        ***3           E12279
     C**********           ELSE                            x**3           E12279
     C**********           MOVE 'Y'       @DMFLG           ***3           E12279
     C**********           END                             E**3           E12279
     C*
     C** If no 'SI' deam found add in interest at maturity to book
     C** and back out BU interest at maturity from book.
     C           @DMFLG    IFEQ 'N'                        B**3
     C*
     C** Perform update processing for new maturity date                  E12279
     C           @SEQ      IFEQ '5'                        B***4          E12279
     C*
     C           @MDTD     IFGE @RUNDT                     B****5
     C                     Z-ADD@MDTD     @HNDAT           *****5
     C                     Z-SUB@@INTR    @DNIM            *****5
     C                     DIV  10        @@INTR    H      *****5
     C                     Z-SUB@@INTR    @HNIM            *****5
     C                     SUB  @@INTR    @NIMT            *****5
     C*
     C** Update Forward Books
     C                     EXSR #ZA                        *****5
     C                     EXSR #ZB                        *****5
     C                     END                             E****5
     C*
     C                     END                             E***4          E12279
     C*
     C** If BU next int date non-zero back out BU maturity int amnt
     C** Calculate BU interest at maturity.
     C******     IKBNID    IFGE @RUNDT                     B***4           AMEND
     C*
     C** Perform update processing for old interest or maturity date      E12279
     C           @SEQ      IFEQ '4'                        B***4          E12279
     C           @SEQ      OREQ '6'                        ****4          E12279
     C*
     C** If BU Front up Interest indicator on interest was backed-out     S01392
     C** at value date from book, so skip maturity processing.            S01392
     C           IKBFUI    ANDNE'Y'                        B***4          S01392
     C*                                                                   S01392
     C***********          Z-ADDIKBLID    @@DTIN           ****4          056095
     C***********          EXSR ZA0680                     ****4          056095
     C***********          Z-ADD@@MDNO    @@BEG            ****4          056095
     C                     Z-ADDIKBLID    ZZDTIN           ****4          056095
     C                     EXSR ZDAT10                     ****4          056095
     C                     Z-ADDZZMDNO    ZZBEG            ****4          056095
     C*
     C           IKBNID    IFEQ 0                          B****5          AMEND
     C***********          Z-ADDIKBMTD    @@DTIN           *****5    AMEND056095
     C***********          EXSR ZA0680                     *****5    AMEND056095
     C***********          Z-ADD@@MDNO    @@END            *****5    AMEND056095
     C                     Z-ADDIKBMTD    ZZDTIN           *****5         056095
     C                     EXSR ZDAT10                     *****5         056095
     C                     Z-ADDZZMDNO    ZZEND            *****5         056095
     C                     Z-ADDIKBMTD    @TEST   80       *****5          AMEND
     C                     MOVE '6'       @SEQV   1        *****5         E12279
     C                     ELSE                            X****5          AMEND
     C***********          Z-ADDIKBNID    @@DTIN           *****5    AMEND056095
     C***********          EXSR ZA0680                     *****5    AMEND056095
     C***********          Z-ADD@@MDNO    @@END            *****5    AMEND056095
     C                     Z-ADDIKBNID    ZZDTIN           *****5         056095
     C                     EXSR ZDAT10                     *****5         056095
     C                     Z-ADDZZMDNO    ZZEND            *****5         056095
     C                     Z-ADDIKBNID    @TEST   80       *****5          AMEND
     C                     MOVE '4'       @SEQV            *****5         E12279
     C                     END                             E****5          AMEND
     C*
     C** If Before Update First & Last day Interest indicator on          S01392
     C** add an extra day's interest.                                     S01392
     C           IKBFLI    IFEQ 'Y'                        B****5         S01392
     C***********          ADD  1         @@END            *****5   S01392056095
     C                     ADD  1         ZZEND            *****5         056095
     C                     END                             E****5         S01392
     C**                                                                  S01392
     C** Calculate BU interest at maturity
     C***********          MOVE IKBICM    @@CALC           ****4          056095
     C                     MOVE IKBICM    ZZCALC           ****4          056095
     C                     Z-ADDIKBAMT    @@AMT            ****4
     C                     Z-ADDIKBIRT    @@RATE           ****4
     C                     MOVE IKBRDF    @@RDFC           ****4          S01392
     C******************** EXSR MM1007                     ****4          E17051
     C/COPY WNCPYSRC,MM0075C021
     C                     EXSR MM1030                     ****4          E17051
     C/COPY WNCPYSRC,MM0075C022
     C                     MULT 10        @@INTR           ****4          E19980
     C*
     C           @SEQ      IFEQ @SEQV                      B****5         E12279
     C*
     C** Back out BU interest at maturity from book
     C           @TEST     IFGE @RUNDT                     B*****6         AMEND
     C                     Z-ADD@TEST     @HNDAT           ******6         AMEND
     C                     Z-ADD@@INTR    @DNIM            ******6
     C                     DIV  10        @@INTR    H      ******6
     C                     Z-ADD@@INTR    @HNIM            ******6
     C                     ADD  @@INTR    @NIMT            ******6
     C*
     C** Update Forward Books
     C                     EXSR #ZA                        ******6
     C                     EXSR #ZB                        ******6
     C                     END                             E*****6
     C*
     C                     END                             E****5         E12279
     C*
     C                     END                             E***4          E12279
     C*
     C                     ELSE                            X**3
     C*
     C** Perform update processing for SI Deam value date                 E12279
     C           @SEQ      IFEQ '7'                        B***4          E12279
     C*
     C** Calculate deam value start date as a day number
     C                     Z-ADDHNVDYY    @VDYY            ****4
     C                     Z-ADDHNVDMM    @VDMM            ****4
     C                     Z-ADDHNVDDD    @VDDD            ****4
     C*
     C***********          Z-ADD@HNDAT    @@DTIN           ****4          056095
     C***********          EXSR ZA0680                     ****4          056095
     C***********          Z-ADD@@MDNO    @DMDVS  50       ****4          056095
     C                     Z-ADD@HNDAT    ZZDTIN           ****4          056095
     C                     EXSR ZDAT10                     ****4          056095
     C                     Z-ADDZZMDNO    @DMDVS  50       ****4          056095
     C*
     C** If deam exists for deal being amended calculate new deam
     C** amounts
     C           IKDVSD    IFGE 0                          B****5
     C*****      @DMDVS    ANDGERUND                       *****5         S01194
     C           @DMDVS    ANDGEBJRDNB                     *****5         S01194
     C***********          Z-ADDIKDVSD    @@BEG            *****5         056095
     C***********          Z-ADD@DMDVS    @@END            *****5         056095
     C***********          MOVE IKICMT    @@CALC           *****5         056095
     C                     Z-ADDIKDVSD    ZZBEG            *****5         056095
     C                     Z-ADD@DMDVS    ZZEND            *****5         056095
     C                     MOVE IKICMT    ZZCALC           *****5         056095
     C                     Z-ADDIKAMNP    @@AMT            *****5
     C                     Z-ADDIKINTR    @@RATE           *****5
     C******************** EXSR MM1007                     *****5         E17051
     C/COPY WNCPYSRC,MM0075C023
     C                     EXSR MM1030                     *****5         E17051
     C/COPY WNCPYSRC,MM0075C024
     C                     MULT 10        @@INTR           *****5         E19980
     C                     SUB  @@INTR    @DNIM            *****5
     C                     DIV  10        @@INTR    H      *****5
     C                     SUB  @@INTR    @HNIM            *****5
     C                     SUB  @@INTR    @NIMT            *****5
     C                     END                             E****5
     C*
     C** Calculate before update deam amounts
     C           IKBVDT    IFGE @RUNDT                     B****5
     C*****      @DMDVS    ANDGERUND                       *****5         S01194
     C           @DMDVS    ANDGEBJRDNB                     *****5         S01194
     C*
     C** Calculate before update deam value date day number
     C***********          Z-ADDIKBVDT    @@DTIN           *****5         056095
     C***********          EXSR ZA0680                     *****5         056095
     C***********          Z-ADD@@MDNO    @@BEG            *****5         056095
     C                     Z-ADDIKBVDT    ZZDTIN           *****5         056095
     C                     EXSR ZDAT10                     *****5         056095
     C                     Z-ADDZZMDNO    ZZBEG            *****5         056095
     C*
     C** Calculate before update deam amount
     C***********          Z-ADD@DMDVS    @@END            *****5         056095
     C***********          MOVE IKBICM    @@CALC           *****5         056095
     C                     Z-ADD@DMDVS    ZZEND            *****5         056095
     C                     MOVE IKBICM    ZZCALC           *****5         056095
     C                     Z-ADDIKBAMT    @@AMT            *****5
     C                     Z-ADDIKBIRT    @@RATE           *****5
     C******************** EXSR MM1007                     *****5         E17051
     C/COPY WNCPYSRC,MM0075C025
     C                     EXSR MM1030                     *****5         E17051
     C/COPY WNCPYSRC,MM0075C026
     C                     MULT 10        @@INTR           *****5         E19980
     C                     ADD  @@INTR    @DNIM            *****5
     C                     DIV  10        @@INTR    H      *****5
     C                     ADD  @@INTR    @HNIM            *****5
     C                     ADD  @@INTR    @NIMT            *****5
     C                     END                             E****5
     C*
     C** Update forward book with amended deam amount
     C                     Z-ADDHNVDYY    @VDYY            ****4
     C                     Z-ADDHNVDMM    @VDMM            ****4
     C                     Z-ADDHNVDDD    @VDDD            ****4
     C                     EXSR #ZA                        ****4
     C                     EXSR #ZB                        ****4
     C*
     C                     END                             E***4          E12279
     C*
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E1
     C*
     C           #BBAC9    ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BBC     - Update fwd book for SI deam                        *
     C*                                                               *
     C**CALLS****ZA0680***-*Convert*a*date*to*day*number*form**********   056095
     C***********MM1007   - Calc interest due at next interest date   *   E17051
     C* CALLS    ZDAT10   - Convert a date to day number form         *   056095
     C*          MM1030   - Calc interest due at next interest date   *   E17051
     C*          #ZA      - Write / update records on LF/MMFWUDLL     *
     C*          #ZB      - Write / update records on LF/MMFWUHLL     *
     C*                                                               *
     C* CALLED BY  #BB    - Routine controlling updating sequence     *
     C*                                                               *
     C* FLDS USED  @OSDAT - Deam related deal start date              *
     C*************@@DTIN*-*DS*contains*date*in*YYYYMMDD*for*ZA0680****   056095
     C*************@@MDNO*-*MIDAS*day*number***************************   056095
     C*************@@BEG**-*Beginning*of*interest*period***************   056095
     C*            ZZDTIN - DS contains date in YYYYMMDD for ZDAT10   *   056095
     C*            ZZMDNO - MIDAS day number                          *   056095
     C*            ZZBEG  - Beginning of interest period              *   056095
     C*            @VDYY  - Date used in accessing forward book files *
     C*            @VDMM  - Date used in accessing forward book files *
     C*            @VDDD  - Date used in accessing forward book files *
     C*            @HNDAT - Data structure to format date as YYYYMMDD *
     C*************@@END**-*End*of*interest*period*********************   056095
     C*************@@CALC*-*Interest*calculation*method****************   056095
     C*            ZZEND  - End of interest period                    *   056095
     C*            ZZCALC - Interest calculation method               *   056095
     C*            @@AMT  - Deal amount                               *
     C*            @@RATE - Deal interest rate                        *
     C*            @@INTR - Amount of interest due                    *
     C*            @DNIM  - Daily net interest movement               *
     C*            @HNIM  - Half month net interest movement          *
     C*            @NIMT  - Net interest movement                     *
     C*            @OMDAT - Deam related deal maturity date           *
     C*            @MDKEY - Key to LF/MMLVDMLL                        *
     C*            @DMFLG - Flag ind if later deam exists on deal     *
     C*                                                               *
     C*****************************************************************
     C           #BBC      BEGSR
     C*
     C** Calculate deam amount
     C***********          MOVE IGRICM    @@CALC                          056095
     C                     MOVE IGRICM    ZZCALC                          056095
     C           CCLACT    CABEQ'A'       #BBC9
     C*
     C** If earlier deam exists on deal no need to process entered
     C** details as none of relevant details may have changed.
     C                     Z-ADDIGVDYY    @VDYY
     C                     Z-ADDIGVDMM    @VDMM
     C                     Z-ADDIGVDDD    @VDDD
     C*
     C           @MDKEY    SETLLMMLVDMLL
     C                     READPMMLVDMLL                 60
     C*
     C           *IN60     IFEQ '0'                        B1
     C           HNDA38    ANDEQIGDA38                     *1
     C                     GOTO #BBC9                      *1
     C                     END                             E1
     C*
     C** Check later deam exists on LF/MMLVDMLL
     C           @MDKEY    SETGTMMLVDMLL
     C                     READ MMLVDMLL                 60
     C*
     C** Set up flag indicating whether deam exists on deal.
     C           *IN60     IFEQ '1'                        B1
     C           HNDA38    ORNE IGDA38                     *1
     C                     MOVE 'N'       @DMFLG           *1
     C                     ELSE                            X1
     C                     MOVE 'Y'       @DMFLG           *1
     C                     END                             E1
     C*
     C** Add / subtract deam amount into book                             E12279
     C                     Z-ADDIGVDYY    @VDYY                           E12279
     C                     Z-ADDIGVDMM    @VDMM                           E12279
     C                     Z-ADDIGVDDD    @VDDD                           E12279
     C*                                                                   E12279
     C** Calculate related deal start date                                E12279
     C***********          Z-ADD@OSDAT    @@DTIN                    E12279056095
     C***********          EXSR ZA0680                              E12279056095
     C***********          Z-ADD@@MDNO    @@BEG                     E12279056095
     C                     Z-ADD@OSDAT    ZZDTIN                          056095
     C                     EXSR ZDAT10                                    056095
     C                     Z-ADDZZMDNO    ZZBEG                           056095
     C*                                                                   E12279
     C** Calculate deam amount                                            E12279
     C***********          Z-ADDIGDVSD    @@END                     E12279056095
     C                     Z-ADDIGDVSD    ZZEND                           056095
     C                     Z-ADDIGOGDA    @@AMT                           E12279
     C***********          MOVE IGRICM    @@CALC                    E12279056095
     C                     MOVE IGRICM    ZZCALC                          056095
     C                     Z-ADDIGORAT    @@RATE                          E12279
     C******************** EXSR MM1007                             E12279 E17051
     C                     EXSR MM1030                                    E17051
     C                     MULT 10        @@INTR                          E19980
     C*                                                                   E12279
     C** On insert add in new deal amount; on deletion back amount out    E12279
     C           CCLACT    IFEQ 'I'                        B1             E12279
     C                     Z-SUB@@INTR    @DNIM            *1             E12279
     C                     DIV  10        @@INTR    H      *1             E12279
     C                     Z-SUB@@INTR    @HNIM            *1             E12279
     C                     SUB  @@INTR    @NIMT            *1             E12279
     C*                                                                   E12279
     C                     ELSE                            X1             E12279
     C                     Z-ADD@@INTR    @DNIM            *1             E12279
     C                     DIV  10        @@INTR    H      *1             E12279
     C                     Z-ADD@@INTR    @HNIM            *1             E12279
     C                     ADD  @@INTR    @NIMT            *1             E12279
     C                     END                             E1             E12279
     C*                                                                   E12279
     C** Add interest into book                                           E12279
     C                     EXSR #ZA                                       E12279
     C                     EXSR #ZB                                       E12279
     C*
     C** If Deam with later value date alter forward book
     C           @DMFLG    IFEQ 'Y'                        B1
     C*
     C** For deam insertion back out amount of later deam
     C** For deam deletion re insert amount of later deam
     C***********          Z-ADD@OSDAT    @@DTIN           *1             056095
     C***********          EXSR ZA0680                     *1             056095
     C***********          Z-ADD@@MDNO    @@BEG            *1             056095
     C                     Z-ADD@OSDAT    ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    ZZBEG            *1             056095
     C*
     C                     Z-ADDHNVDYY    @VDYY            *1
     C                     Z-ADDHNVDMM    @VDMM            *1
     C                     Z-ADDHNVDDD    @VDDD            *1
     C*
     C***********          Z-ADD@HNDAT    @@DTIN           *1             056095
     C***********          EXSR ZA0680                     *1             056095
     C***********          Z-ADD@@MDNO    @@END            *1             056095
     C                     Z-ADD@HNDAT    ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    ZZEND            *1             056095
     C*
     C** Calculate deam amount
     C***********          MOVE IGRICM    @@CALC           *1             056095
     C                     MOVE IGRICM    ZZCALC           *1             056095
     C                     Z-ADDIGRBAT    @@AMT            *1
     C                     Z-ADDIGRIRT    @@RATE           *1
     C******************** EXSR MM1007                     *1             E17051
     C                     EXSR MM1030                     *1             E17051
     C                     MULT 10        @@INTR           *1             E19980
     C*
     C** Add / subtract interest for later deam into book
     C           CCLACT    IFEQ 'I'                        B*2
     C                     Z-ADD@@INTR    @DNIM            **2
     C                     DIV  10        @@INTR    H      **2
     C                     Z-ADD@@INTR    @HNIM            **2
     C                     ADD  @@INTR    @NIMT            **2
     C                     ELSE                            X*2
     C                     Z-SUB@@INTR    @DNIM            **2
     C                     DIV  10        @@INTR    H      **2
     C                     Z-SUB@@INTR    @HNIM            **2
     C                     SUB  @@INTR    @NIMT            **2
     C                     END                             E*2
     C*
     C** Add interest into book
     C                     EXSR #ZA                        *1
     C                     EXSR #ZB                        *1
     C*
     C                     ELSE                            X1
     C*
     C** For deam without later associated later deam perform following
     C** processing to calculate DEAL interest at maturity.
     C***********          Z-ADD@OSDAT    @@DTIN           *1             056095
     C***********          EXSR ZA0680                     *1             056095
     C***********          Z-ADD@@MDNO    @@BEG            *1             056095
     C                     Z-ADD@OSDAT    ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    ZZBEG            *1             056095
     C*
     C***********          Z-ADD@OMDAT    @@DTIN           *1             056095
     C***********          EXSR ZA0680                     *1             056095
     C***********          Z-ADD@@MDNO    @@END            *1             056095
     C                     Z-ADD@OMDAT    ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    ZZEND            *1             056095
     C*
     C                     Z-ADDIGOGDA    @@AMT            *1
     C***********          MOVE IGRICM    @@CALC           *1             056095
     C                     MOVE IGRICM    ZZCALC           *1             056095
     C                     Z-ADDIGRIRT    @@RATE           *1
     C******************** EXSR MM1007                     *1             E17051
     C                     EXSR MM1030                     *1             E17051
     C                     MULT 10        @@INTR           *1             E19980
     C*
     C** Alter forward book for interest at maturity details
     C** For deam insertion back out interest at maturity for deal.
     C** For deam deletion reinsert deal interest at maturity
     C           CCLACT    IFEQ 'I'                        B*2
     C                     Z-ADD@@INTR    @DNIM            **2
     C                     DIV  10        @@INTR    H      **2
     C                     Z-ADD@@INTR    @HNIM            **2
     C                     ADD  @@INTR    @NIMT            **2
     C                     ELSE                            X*2
     C                     Z-SUB@@INTR    @DNIM            **2
     C                     DIV  10        @@INTR    H      **2
     C                     Z-SUB@@INTR    @HNIM            **2
     C                     SUB  @@INTR    @NIMT            **2
     C                     END                             E*2
     C*
     C** Update forward book for deal interest at maturity details.
     C                     Z-ADDIGOMYY    @VDYY            *1
     C                     Z-ADDIGOMMM    @VDMM            *1
     C                     Z-ADDIGOMDD    @VDDD            *1
     C*
     C                     EXSR #ZA                        *1
     C                     EXSR #ZB                        *1
     C                     END                             E1
     C*
     C*---------------------------------------------------------------*   E12279
     C***Add*/*subtract deam amount into book                             E12279
     C**********           Z-ADDIGVDYY    @VDYY            *1             E12279
     C**********           Z-ADDIGVDMM    @VDMM            *1             E12279
     C**********           Z-ADDIGVDDD    @VDDD            *1             E12279
     C**********                                                          E12279
     C***Calculate related deal start date                                E12279
     C**********           Z-ADD@OSDAT    @@DTIN           *1             E12279
     C**********           EXSR ZA0680                     *1             E12279
     C**********           Z-ADD@@MDNO    @@BEG            *1             E12279
     C**********                                                          E12279
     C***Calculate deam amount                                            E12279
     C**********           Z-ADDIGDVSD    @@END            *1             E12279
     C**********           Z-ADDIGOGDA    @@AMT            *1             E12279
     C**********           MOVE IGRICM    @@CALC           *1             E12279
     C**********           Z-ADDIGORAT    @@RATE           *1             E12279
     C**********           EXSR MM1007                     *1             E12279
     C**********                                                          E12279
     C***On*insert add in new deal amount; on deletion back amount out    E12279
     C********** CCLACT    IFEQ 'I'                        B*2            E12279
     C**********           Z-SUB@@INTR    @DNIM            **2            E12279
     C**********           DIV  10        @@INTR    H                     E12279
     C**********           Z-SUB@@INTR    @HNIM            **2            E12279
     C**********           SUB  @@INTR    @NIMT            **2            E12279
     C**********                                                          E12279
     C**********           ELSE                            X*2            E12279
     C**********           Z-ADD@@INTR    @DNIM            **2            E12279
     C**********           DIV  10        @@INTR    H                     E12279
     C**********           Z-ADD@@INTR    @HNIM            **2            E12279
     C**********           ADD  @@INTR    @NIMT            **2            E12279
     C**********           END                             E*2            E12279
     C**********                                                          E12279
     C***Add*interest into book                                           E12279
     C**********           EXSR #ZA                        *1             E12279
     C**********           EXSR #ZB                        *1             E12279
     C*---------------------------------------------------------------*   E12279
     C*
     C           #BBC9     ENDSR                                     *
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BBD     - Update LF/MMFWDTLL total funds lent info           *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  #BB    - Routine controlling updating sequence     *
     C*                                                               *
     C* FLDS USED  @FMTY  - LF/MMSTDDLL format indicator              *
     C*            @NA    - Array contains deal type of all placings  *
     C*            @TFDL  - Total funds lent                          *
     C*                                                               *
     C*****************************************************************
     C           #BBD      BEGSR
     C*
     C** Perform deam processing first.
     C           @FMTY     IFEQ 'A'                        B1
     C*
     C** Check if Original Deal type is a Loan
     C           IGOGDT    LOKUP@NA,1                    60*1
     C*
     C** If original deal was a loan update total funds lent
     C           *IN60     IFEQ '1'                        B*2
     C*
     C** Perform processing for insertion of a deam
     C           IGLACT    IFEQ 'I'                        B**3
     C           IGTYPE    IFEQ 'PI'                       B***4
     C                     SUB  IGAMNP    @TFDL  150       ****4
     C                     ELSE                            X***4
     C                     ADD  IGAMNP    @TFDL            ****4
     C                     END                             E***4
     C                     END                             E**3
     C*
     C** Perform processing for deletion of a deam
     C           IGLACT    IFEQ 'D'                        B**3
     C           IGTYPE    IFEQ 'PI'                       B***4
     C                     ADD  IGAMNP    @TFDL            ****4
     C                     ELSE                            X***4
     C                     SUB  IGAMNP    @TFDL            ****4
     C                     END                             E***4
     C                     END                             E**3
     C*
     C** Perform processing for deletion of a deam
     C           IGLACT    IFEQ 'A'                        B**3
     C           IGTYPE    IFEQ 'PI'                       B***4
     C                     ADD  IGBAMT    @TFDL            ****4
     C                     SUB  IGAMNP    @TFDL            ****4
     C                     ELSE                            X***4
     C                     SUB  IGBAMT    @TFDL            ****4
     C                     ADD  IGAMNP    @TFDL            ****4
     C                     END                             E***4
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E1
     C*
     C** Update total funds lent for loans / deposits
     C           @FMTY     IFEQ 'L'                        B1
     C*
     C           IKLACT    IFEQ 'I'                        B*2
     C                     SUB  IKAMNP    @TFDL  150       **2
     C                     END                             E*2
     C*
     C           IKLACT    IFEQ 'D'                        B*2
     C                     ADD  IKAMNP    @TFDL            **2
     C                     END                             E*2
     C*
     C           IKLACT    IFEQ 'A'                        B*2
     C                     SUB  IKAMNP    @TFDL            **2
     C                     ADD  IKBAMT    @TFDL            **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C** Update total funds lent for negotiable assets bought             S01149
     C           @FMTY     IFEQ 'B'                        B1             S01149
     C*                                                                   S01149
     C           IHLACT    IFEQ 'I'                        B*2            S01149
     C                     Z-ADDIHAMNP    @TFNN  150       **2            S01149
     C                     Z-ADDIHFVAL    @TFFN            **2            S01149
     C                     END                             E*2            S01149
     C*                                                                   S01149
     C           IHLACT    IFEQ 'D'                        B*2            S01149
     C                     Z-SUBIHAMNP    @TFNN            **2            S01149
     C                     Z-SUBIHFVAL    @TFFN            **2            S01149
     C                     END                             E*2            S01149
     C*                                                                   S01149
     C********** IHLACT    IFEQ 'A'                        B*2     S01149 E19639
     C**********           Z-ADDIHAMNP    @TFNN            **2     S01149 E19639
     C**********           ADD  IHBAMT    @TFNN            **2     S01149 E19639
     C**********           Z-ADDIHFVAL    @TFFN            **2     S01149 E19639
     C**********           ADD  IHBFVL    @TFFN            **2     S01149 E19639
     C**********           END                             E*2     S01149 E19639
     C           IHLACT    IFEQ 'A'                        B*2  E14186
     C                     Z-ADDIHAMNP    @TFNN            **2  E14186
     C                     ADD  IHBAMT    @TFNN            **2  E14186
     C                     Z-ADDIHFVAL    @TFFN            **2  E14186
     C                     SUB  IHBFVL    @TFFN            **2  E14186
     C                     END                             E*2  E14186
      *                                                                   S01149
     C                     END                             E1             S01149
     C*                                                                   S01149
     C** Update total funds lent for negotiable assets sold               S01149
     C           @FMTY     IFEQ 'S'                        B1             S01149
     C*                                                                   S01149
     C           ILLACT    IFEQ 'I'                        B*2            S01149
     C                     Z-SUBILFVAL    @TFFN            **2            S01149
     C                     Z-SUBILAMNP    @TFNN            **2            S01149
     C                     END                             E*2            S01149
     C*                                                                   S01149
     C           ILLACT    IFEQ 'D'                        B*2            S01149
     C                     Z-ADDILFVAL    @TFFN            **2            S01149
     C                     Z-ADDILAMNP    @TFNN            **2            S01149
     C                     END                             E*2            S01149
     C                     END                             E1             S01149
     C*
     C           #BBD9     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BBE     - Update LF/MMFWDTLL NA net value details            *
     C*                                                               *
     C* CALLS      #ZA    - Write / update records on LF/MMFWUDLL     *
     C*            #ZB    - Write / update records on LF/MMFWUHLL     *
     C*            #BBEA  - Update fwd book for N/A's interest at NIPD*   S01149
     C*            #BBEB  - Update fwd book for N/A's interest at mat.*   S01149
     C*            #BBEC  - Update fwd book for N/A's remove interest *   S01149
     C*            #BBED  - Update fwd book for N/A's remove interest *   S01149
     C*                                                               *
     C* CALLED BY  #BB    - Routine controlling updating sequence     *
     C*                                                               *
     C* FLDS USED  @FMTY  - LF/MMSTDDLL format indicator              *
     C*            @NSNV  - NA net value workfield                    *
     C*            @NSFV  - NA face value workfield                   *   S01149
     C*                                                               *
     C*****************************************************************
     C           #BBE      BEGSR
     C***********                                                         S01149
     C***Following*processing*performed*if*deal*transaction*date*is*the   S01149
     C***same*as*the*run*date*Ie*deal*first*entered*to*system*today       S01149
     C***********CCDDAT    IFEQ @RUNDT                     B1             S01149
     C*
     C** VALUE DATE PROCESSING                                            S01149
     C*
     C** If deal is a NA purchase perform following ....                  S01149
     C           @FMTY     IFEQ 'B'                        B1             S01149
     C           CCLACT    IFEQ 'I'                        B*2            S01149
     C                     Z-SUBIHAMNP    @NSNV            **2            S01149
     C                     END                             E*2            S01149
     C           CCLACT    IFEQ 'D'                        B*2            S01149
     C                     Z-ADDIHAMNP    @NSNV            **2            S01149
     C                     END                             E*2            S01149
     C           CCLACT    IFEQ 'A'                        B*2            S01149
     C                     Z-SUBIHAMNP    @NSNV            **2            S01149
     C                     ADD  IHBAMT    @NSNV            **2            S01149
     C                     END                             E*2            S01149
     C*                                                                   S01149
     C** Update daily and half monthly files                              S01149
     C           @VDAT     IFGE @RUNDT                     B*2            s01149
     C                     MOVE @VDAT     @HNDAT           **2            S01149
     C                     Z-ADD@NSNV     @HMCO            **2            S01149
     C                     Z-ADD@NSNV     @DCOT            **2            S01149
     C*                                                                   S01149
     C** Perform file updating procedures.                 **2            S01149
     C                     EXSR #ZA                        **2            S01149
     C                     EXSR #ZB                        **2            S01149
     C                     END                             E*2            S01149
     C*
     C** .....otherwise for NA sale perform following.                    S01149
     C                     ELSE                            X1             S01149
     C           CCLACT    IFEQ 'I'                        B*2            S01149
     C                     Z-ADDILAMNP    @NSNV            **2            S01149
     C                     Z-ADDILRFVL    @NSFV            **2            S01149
     C                     END                             E*2            S01149
     C           CCLACT    IFEQ 'D'                        B*2            S01149
     C                     Z-SUBILAMNP    @NSNV            **2            S01149
     C                     Z-SUBILRFVL    @NSFV            **2            S01149
     C                     END                             E*2            S01149
     C           CCLACT    IFEQ 'A'                        B*2            S01149
     C                     Z-SUBILBAMT    @NSNV            **2            S01149
     C                     ADD  ILAMNP    @NSNV            **2            S01149
     C                     END                             E*2            S01149
     C*                                                                   S01149
     C** Update daily and half monthly files                              S01149
     C           @VDAT     IFGE @RUNDT                     B*2            s01149
     C                     MOVE @VDAT     @HNDAT           **2            S01149
     C                     Z-ADD@NSNV     @HMCI            **2            S01149
     C                     Z-ADD@NSNV     @DCIN            **2            S01149
     C*
     C** Perform file updating procedures.                 **2            S01149
     C                     EXSR #ZA                        **2            S01149
     C                     EXSR #ZB                        **2            S01149
     C                     END                             E*2            S01149
     C                     END                             E1             S01149
     C*********************END                             E1             S01149
     C*************                                                       S01149
     C***Following*code*will*be*performed*in*two*circumstances            S01149
     C*****1/**When*files*are*rebuilt*as*part*of*next*day*set*up          S01149
     C*****2/**When*a*NAB*or*a*NAS*is*amended*during*input*cycle*and      S01149
     C****an*end*of*day*has*been*run*since*NAB*/*NAS*first*input          S01149
     C*                                                                   S01149
     C** MATURITY DATE PROCESSING                                         S01149
     C*
     C** Set up net value work field for maturity                         S01149
     C           CCTYPE    LOKUP@BILLS                   60               S01149
     C                     MOVE @MDTD     @HNDAT                          S01149
     C*
     C** Interest bearing processing                                      S01149
     C           *IN60     IFEQ '0'                        B1             S01149
     C*
     C** N/A bought                                                       S01149
     C           @FMTY     IFEQ 'B'                        B*2
     C           CCLACT    IFEQ 'I'                        B**3           S01149
     C                     Z-ADDIHFVAL    @NSNV            ***3           S01149
     C                     END                             E**3           S01149
     C           CCLACT    IFEQ 'D'                        B**3           S01149
     C                     Z-SUBIHFVAL    @NSNV            ***3           S01149
     C                     END                             E**3           S01149
     C           CCLACT    IFEQ 'A'                        B**3           S01149
     C                     Z-SUBIHBFVL    @NSNV            ***3           S01149
     C                     ADD  IHFVAL    @NSNV            ***3           S01149
     C                     END                             E**3           S01149
     C                     ELSE                            X*2
     C*
     C** N/A sold                                                         S01149
      ** Use face value of NAS in case partial of parcelled NAB           S01378
     C           CCLACT    IFEQ 'I'                        B**3           S01149
     C***********          Z-ADDILRFVL    @NSNV            ***3     S01149S01378
     C                     Z-ADDILFVAL    @NSNV            ***3           S01378
     C                     END                             E**3           S01149
     C           CCLACT    IFEQ 'D'                        B**3           S01149
     C***********          Z-SUBILRFVL    @NSNV            ***3     S01149S01378
     C                     Z-SUBILFVAL    @NSNV            ***3           S01378
     C                     END                             E**3           S01149
     C                     END                             E*2            S01149
     C                     END                             E1             S01149
     C*
     C** Non interest bearing N/A sold                                    S01149
      ** Use sale amount of NAS in case partial of parcelled NAB          S01378
     C           @FMTY     IFEQ 'S'                        B1             S01149
     C           *IN60     ANDEQ'1'                        *1             S01149
     C           CCLACT    IFEQ 'I'                        B*2            S01149
     C******               Z-ADDILRBAT    @NSNV            **2            S01149
     C***********          Z-SUBILRBAT    @NSNV            **2      S01149S01378
     C                     Z-SUBILAMNP    @NSNV            **2            S01378
     C                     END                             E*2            S01149
     C           CCLACT    IFEQ 'D'                        B*2            S01149
     C******               Z-SUBILRBAT    @NSNV            **2            S01149
     C***********          Z-ADDILRBAT    @NSNV            **2      S01149S01149
     C                     Z-ADDILAMNP    @NSNV            **2            S01378
     C                     END                             E*2            S01149
     C******     CCLACT    IFEQ 'A'                        B*2            S01149
     C******               Z-SUBILRBAT    @NSNV            **2            S01149
     C******               END                             E*2            S01149
     C                     END                             E1             S01149
     C*                                                                   S01149
     C*  At Maturity date for a non interest-bearing N/A bought,          S01149
     C** - the principal value has been set up at Value date and          S01149
     C**   remains unchanged.                                             S01149
     C*                                                                   S01149
     C           @MDTD     IFGE @RUNDT                     B1             S01149
     C*                                                                   S01279
     C** Set up the effective rate, this will be the interest rate for    S01279
     C** Primary CD's purchased and the yield for other NA's bought/sold  S01279
     C           CCMTYP    IFEQ 'C1'                       B*2 face rate  S01279
     C           CCMTYP    OREQ 'C2'                       B*2 yield      S01279
     C           CCMTYP    OREQ 'BD'                       B*2 yield      S01279
     C           CCMTYP    OREQ 'BP'                       B*2 yield      S01279
     C                     Z-ADDCCINTR    @EFRT            **2            S01279
     C                     ELSE                            X*2            S01279
     C                     Z-ADDCCDCRT    @EFRT            **2            S01279
     C                     END                             E*2            S01279
     C*                                                                   S01279
     C           @FMTY     IFEQ 'B'                        B*2            S01149
     C                     Z-ADD@NSNV     @HMCI            ***3           S01149
     C**********           Z-ADD@NSNV     @DCIN            ***3    S01149 S01279
     C                     Z-ADD@NSNV     @MAIN            ***3           S01279
     C                     ELSE                            X*2            S01149
     C*                                                                   S01149
     C**  Back out future movements for an N/A sold                       S01149
     C                     MOVE ILRMTD    @HNDAT           **2            S01149
     C                     Z-SUB@NSNV     @HMCI            **2            S01149
     C**********           Z-SUB@NSNV     @DCIN            **2     S01149 S01279
     C                     Z-SUB@NSNV     @MAIN            **2            S01279
     C                     END                             E*2            S01149
     C*                                                                   S01149
     C** Perform file updating procedures.                 *1             S01149
     C                     EXSR #ZA                        *1             S01149
     C                     EXSR #ZB                        *1             S01149
     C                     END                             E1             S01149
     C*                                                                   S01149
     C** INTEREST/DISCOUNT PROCESSING                                     S01149
     C**                                                                  S01149
     C           CCTYPE    LOKUP@BILLS                   60               S01149
     C           *IN60     IFEQ '1'                        B1             S01149
     C*                                                                   S01149
     C** Non interest bearing N/A bought                                  S01149
     C           @FMTY     IFEQ 'B'                        B*2            S01149
     C                     EXSR #BBEE                      **2            S01149
     C                     END                             E*2            S01149
     C*                                                                   S01149
     C** Non interest bearing N/A sold (back out of discount)             S01149
     C           @FMTY     IFEQ 'S'                        B*2            S01149
     C           CCTYPE    ANDNE'A'                        **2            S01149
     C                     EXSR #BBEF                      **2            S01149
     C                     END                             E*2            S01149
     C                     ELSE                            X1             S01149
     C*                                                                   S01149
     C** Interest bearing N/A bought                                      S01149
     C           @FMTY     IFEQ 'B'                        B*2            S01149
     C                     EXSR #BBEA                      **2            S01149
     C                     EXSR #BBEB                      **2            S01149
     C                     ELSE                            X*2            S01149
     C*                                                                   S01149
     C** Interest bearing N/A sold (back out of interest)                 S01149
     C                     EXSR #BBEC                      **2            S01149
     C                     EXSR #BBED                      **2            S01149
     C                     END                             E*2            S01149
     C                     END                             E1             S01149
     C*
     C           #BBE9     ENDSR
     C*****************************************************************
     C/EJECT                                                              S01149
     C*****************************************************************   S01149
     C*                                                               *   S01149
     C* #BBEA    - Update fwd book for next interest date for N/A's   *   S01149
     C*                                                               *   S01149
     C**CALLS****MM1007***- Calc interest due at next interest dat S01149 E17051
     C*          MM1030   - Calc interest due at next interest date   *   E17051
     C*          #ZA      - Write / update records on LF/MMFWUDLL     *   S01149
     C*          #ZB      - Write / update records on LF/MMFWUHLL     *   S01149
     C***********ZA0680***-*Convert*a*date*to*day*number*form*******S01149056095
     C*          ZDAT10   - Convert a date to day number form         *   056095
     C*                                                               *   S01149
     C* CALLED BY  #BBE                                               *   S01149
     C*                                                               *   S01149
     C* FLDS USED  @NIPD  - DS contains next int payment date         *   S01149
     C*            @HNDAT - Data structure to format date as YYYYMMDD *   S01149
     C*            @RUNDT - Run date as YYYYMMDD format               *   S01149
     C*            @MDTD  - DS contains maturity date                 *   S01149
U    C*************@@BEG**-*Beginning*of*interest*period************S01149056095
     C*************@@END**-*End*of*interest*period******************S01149056095
     C*************@@CALC*-*Interest*calculation*method*************S01149056095
     C*            ZZBEG  - Beginning of interest period              *   056095
     C*            ZZEND  - End of interest period                    *   056095
     C*            ZZCALC - Interest calculation method               *   056095
     C*            @@AMT  - Deal amount                               *   S01149
     C*            @@RATE - Deal interest rate                        *   S01149
     C*            @@INTR - Amount of interest due                    *   S01149
     C*            @DNIM  - Daily net interest movement               *   S01149
     C*            @HNIM  - Half month net interest movement          *   S01149
     C*            @NIMT  - Net interest movement                     *   S01149
     C*************@@DTIN*-*DS*contains*date*in*YYYYMMDD*for*ZA0680*S01149056095
     C*************@@MDNO*-*MIDAS*day*number************************S01149056095
     C*            ZZDTIN - DS contains date in YYYYMMDD for ZDAT10   *   056095
     C*            ZZMDNO - MIDAS day number                          *   056095
     C*                                                               *   S01149
     C*****************************************************************   S01149
     C           #BBEA     BEGSR                                          S01149
     C*                                                                   S01149
     C** If next interest payment date entered calculate interest at      S01149
     C** next interest payment date and update files.                     S01149
     C                     Z-ADD@NIPD     @HNDAT                          S01149
     C*                                                                   S01149
     C** Calculate interest at next interest date.                        S01149
     C           @NIPD     IFGE @RUNDT                     B1             S01149
     C           @NIPD     ANDLT@MDTD                      *1             S01149
     C*                                                                   S01149
     C***********          Z-ADDIHSLID    @@BEG            *1       S01149056095
     C***********          Z-ADDIHNIPD    @@END            *1       S01149056095
     C***********          MOVE IHICMT    @@CALC           *1       S01149056095
     C                     Z-ADDIHSLID    ZZBEG            *1             056095
     C                     Z-ADDIHNIPD    ZZEND            *1             056095
     C                     MOVE IHICMT    ZZCALC           *1             056095
     C                     Z-ADDIHFVAL    @@AMT            *1             S01149
     C                     Z-ADDIHFRAT    @@RATE           *1             S01149
     C******************** EXSR MM1007                     *1      S01149 E17051
     C                     EXSR MM1030                     *1             E17051
     C                     MULT 10        @@INTR           *1             E19980
     C*                                                                   S01149
     C** Add interest into book.                                          S01149
     C           CCLACT    IFEQ 'I'                        B*2            S01149
     C           CCLACT    OREQ 'A'                        **2            S01149
     C                     Z-ADD@@INTR    @DNIM            **2            S01149
     C                     DIV  10        @@INTR    H      **2            S01149
     C                     Z-ADD@@INTR    @HNIM            **2            S01149
     C                     ADD  @@INTR    @NIMT            **2            S01149
     C                     ELSE                            X*2            S01149
     C                     Z-SUB@@INTR    @DNIM            **2            S01149
     C                     DIV  10        @@INTR    H      **2            S01149
     C                     Z-SUB@@INTR    @HNIM            **2            S01149
     C                     SUB  @@INTR    @NIMT            **2            S01149
     C                     END                             E*2            S01149
     C*                                                                   S01149
     C** Update forward book details.                                     S01149
     C                     EXSR #ZA                        *1             S01149
     C                     EXSR #ZB                        *1             S01149
     C                     END                             E1             S01149
     C*                                                                   S01149
     C** If deal is amendment back out before update details              S01149
     C           IHBNID    IFGE @RUNDT                     B1             S01149
     C           IHBNID    ANDLTIHBMTD                     *1             S01149
     C           CCLACT    ANDEQ'A'                        *1             S01149
     C** If N/A is sold before interest due - no need to calc interest    S01149
     C           IHRBSI    IFNE 'S'                        B*2            S01149
     C           IHBNID    ORLT IHRVDT                     **2            S01149
     C*                                                                   S01149
     C** If BU next interest payment date entered calculate BU interest   S01149
     C** at next interest payment date and update files.                  S01149
     C                     Z-ADDIHBNID    @HNDAT           **2            S01149
     C*                                                                   S01149
     C** Convert BU start/last int and BU next int date fo MM1007         S01149
     C***********          Z-ADDIHBLID    @@DTIN           **2      S01149056095
     C***********          EXSR ZA0680                     **2      S01149056095
     C***********          Z-ADD@@MDNO    @@BEG            **2      S01149056095
     C                     Z-ADDIHBLID    ZZDTIN           **2            056095
     C                     EXSR ZDAT10                     **2            056095
     C                     Z-ADDZZMDNO    ZZBEG            **2            056095
     C*                                                                   S01149
     C***********          Z-ADDIHBNID    @@DTIN           **2      S01149056095
     C***********          EXSR ZA0680                     **2      S01149056095
     C***********          Z-ADD@@MDNO    @@END            **2      S01149056095
     C                     Z-ADDIHBNID    ZZDTIN           **2            056095
     C                     EXSR ZDAT10                     **2            056095
     C                     Z-ADDZZMDNO    ZZEND            **2            056095
     C*                                                                   S01149
     C** Calculate interest at next interest date.                        S01149
     C***********          MOVE IHBICM    @@CALC           **2      S01149056095
     C                     MOVE IHBICM    ZZCALC           **2            056095
     C                     Z-ADDIHBFVL    @@AMT            **2            S01149
     C                     Z-ADDIHBFRT    @@RATE           **2            S01149
     C******************** EXSR MM1007                     **2     S01149 E17051
     C                     EXSR MM1030                     **2            E17051
     C                     MULT 10        @@INTR           **2            E19980
     C*                                                                   S01149
     C** Add interest into book.                                          S01149
     C                     Z-ADD@@INTR    @DNIM            **2            S01149
     C                     DIV  10        @@INTR    H      **2            S01149
     C                     Z-ADD@@INTR    @HNIM            **2            S01149
     C                     ADD  @@INTR    @NIMT            **2            S01149
     C*                                                                   S01149
     C** Update forward book details.                                     S01149
     C                     EXSR #ZA                        **2            S01149
     C                     EXSR #ZB                        **2            S01149
     C                     END                             E*2            S01149
     C                     END                             E1             S01149
     C*                                                                   S01149
     C           #BBEA9    ENDSR                           **#BBEA9**     S01149
     C*****************************************************************   S01149
     C/EJECT                                                              S01149
     C*****************************************************************   S01149
     C*                                                               *   S01149
     C* #BBEB    - Update fwd book for maturity date for N/A's        *   S01149
     C*            (Copy of section BBAC except updates N/A's)        *   S01149
     C*                                                               *   S01149
     C* CALLS    #ZA      - Write / update records on LF/MMFWUDLL     *   S01149
     C*          #ZB      - Write / update records on LF/MMFWUHLL     *   S01149
     C********** MM1007   - Calc interest due at next interest dateS01149 E17051
     C*          MM1030   - Calc interest due at next interest date   *   E17051
     C***********ZA0680***-*Convert*a*date*to*day*number*form*******S01149056095
     C*          ZDAT10   - Convert a date to day number form         *   056095
     C*                                                               *   S01149
     C* CALLED BY  #BBE   - Route program through update sequence     *   S01149
     C*                                                               *   S01149
     C* FLDS USED  @MDTD  - DS contains maturity date                 *   S01149
     C*            @RUNDT - Run date as YYYYMMDD format               *   S01149
     C*            @DLTYP - Deal type ind - P = placing T = taking    *   S01149
     C*            @HNDAT - Data structure to format date as YYYYMMDD *   S01149
     C*            @NIPD  - DS contains next int payment date         *   S01149
     C*************@@BEG**-*Beginning*of*interest*period************S01149056095
     C*************@@END**-*End*of*interest*period******************S01149056095
     C*************@@CALC*-*Interest*calculation*method*************S01149056095
     C*            ZZBEG  - Beginning of interest period              *   056095
     C*            ZZEND  - End of interest period                    *   056095
     C*            ZZCALC - Interest calculation method               *   056095
     C*            @@AMT  - Deal amount                               *   S01149
     C*            @@RATE - Deal interest rate                        *   S01149
     C*            @@INTR - Amount of interest due                    *   S01149
     C*            @DNIM  - Daily net interest movement               *   S01149
     C*            @HNIM  - Half month net interest movement          *   S01149
     C*            @NIMT  - Net interest movement                     *   S01149
     C*************@@DTIN*-*DS*contains*date*in*YYYYMMDD*for*ZA0680*S01149056095
     C*************@@MDNO*-*MIDAS*day*number************************S01149056095
     C*            ZZDTIN - DS contains date in YYYYMMDD for ZDAT10   *   056095
     C*            ZZMDNO - MIDAS day number                          *   056095
     C*            @MDKEY - Key to LF/MMLVDMLL                        *   S01149
     C*            @DMFLG - Flag ind if later deam exists on deal     *   S01149
     C*            @VDYY  - Date used in accessing forward book files *   S01149
     C*            @VDMM  - Date used in accessing forward book files *   S01149
     C*            @VDDD  - Date used in accessing forward book files *   S01149
     C*            @DMDVS - Deam value date as MIDAS day number       *   S01149
     C*                                                               *   S01149
     C*****************************************************************   S01149
     C           #BBEB     BEGSR                                          S01149
     C*                                                                   S01149
     C*                                                                   S01149
     C** If next interest payment date is greater than run date updatev   S01149
     C** maturity date details with next interest amount                  S01149
     C           @NIPD     IFGE @RUNDT                     B1             S01149
     C           @NIPD     ANDGE@MDTD                      *1             S01149
     C*                                                                   S01149
     C** If N/A is sold before interest due - no need to calc interest    S01149
     C*****      IHRBSI    IFNE 'S'                        B*2            S01149
     C*****      @NIPD     ORLT IHRVDT                     **2            S01149
     C                     Z-ADD@MDTD     @HNDAT           *1             S01149
     C*                                                                   S01149
     C** Calc interest amount to be added into book at maturity date      S01149
     C***********          Z-ADDIHSLID    @@BEG            *1       S01149056095
     C***********          Z-ADDIHMATD    @@END            *1       S01149056095
     C***********          MOVE IHICMT    @@CALC           *1       S01149056095
     C                     Z-ADDIHSLID    ZZBEG            *1             056095
     C                     Z-ADDIHMATD    ZZEND            *1             056095
     C                     MOVE IHICMT    ZZCALC           *1             056095
     C                     Z-ADDIHFVAL    @@AMT            *1             S01149
     C                     Z-ADDIHFRAT    @@RATE           *1             S01149
     C******************** EXSR MM1007                     *1      S01149 E17051
     C                     EXSR MM1030                     *1             E17051
     C                     MULT 10        @@INTR           *1             E19980
     C*                                                                   S01149
     C** For insert/amend add interest into book otherwise ...            S01149
     C           CCLACT    IFEQ 'I'                        B*2            S01149
     C           CCLACT    OREQ 'A'                        **2            S01149
     C                     Z-ADD@@INTR    @DNIM            **2            S01149
     C                     DIV  10        @@INTR    H      **2            S01149
     C                     Z-ADD@@INTR    @HNIM            **2            S01149
     C                     ADD  @@INTR    @NIMT            **2            S01149
     C*                                                                   S01149
     C** back interest out of book.                                       S01149
     C                     ELSE                            X*2            S01149
     C                     Z-SUB@@INTR    @DNIM            **2            S01149
     C                     DIV  10        @@INTR    H      **2            S01149
     C                     Z-SUB@@INTR    @HNIM            **2            S01149
     C                     SUB  @@INTR    @NIMT            **2            S01149
     C                     END                             E*2            S01149
     C*                                                                   S01149
     C** Update forward book details.                                     S01149
     C                     EXSR #ZA                        *1             S01149
     C                     EXSR #ZB                        *1             S01149
     C*                                                                   S01149
     C** If action is amend back out BU interest at maturity details      S01149
     C           IHBNID    IFGE @RUNDT                     B*2            S01149
     C           IHBNID    ANDGEIHBMTD                     **2            S01149
     C                     Z-ADDIHBMTD    @HNDAT           **2            S01149
     C*                                                                   S01149
     C** Calc BU next interest date.                                      S01149
     C***********          Z-ADDIHBLID    @@DTIN           **2      S01149056095
     C***********          EXSR ZA0680                     **2      S01149056095
     C***********          Z-ADD@@MDNO    @@BEG            **2      S01149056095
     C                     Z-ADDIHBLID    ZZDTIN           **2            056095
     C                     EXSR ZDAT10                     **2            056095
     C                     Z-ADDZZMDNO    ZZBEG            **2            056095
     C*                                                                   S01149
     C                     Z-ADDIHBMTD    @HNDAT           **2            S01149
     C***********          Z-ADDIHBMTD    @@DTIN           **2      S01149056095
     C***********          EXSR ZA0680                     **2      S01149056095
     C***********          Z-ADD@@MDNO    @@END            **2      S01149056095
     C                     Z-ADDIHBMTD    ZZDTIN           **2            056095
     C                     EXSR ZDAT10                     **2            056095
     C                     Z-ADDZZMDNO    ZZEND            **2            056095
     C*                                                                   S01149
     C** Calc interest amount to be taken from book at maturity date      S01149
     C***********          MOVE IHBICM    @@CALC           **2      S01149056095
     C                     MOVE IHBICM    ZZCALC           **2            056095
     C                     Z-ADDIHBAMT    @@AMT            **2            S01149
     C                     Z-ADDIHBIRT    @@RATE           **2            S01149
     C******************** EXSR MM1007                     **2     S01149 E17051
     C                     EXSR MM1030                     **2            E17051
     C                     MULT 10        @@INTR           **2            E19980
     C*                                                                   S01149
     C** For amend remove BU interest from book                           S01149
     C                     Z-SUB@@INTR    @DNIM            **2            S01149
     C                     DIV  10        @@INTR    H      **2            S01149
     C                     Z-SUB@@INTR    @HNIM            **2            S01149
     C                     SUB  @@INTR    @NIMT            **2            S01149
     C*                                                                   S01149
     C** Update forward book details.                                     S01149
     C                     EXSR #ZA                        **2            S01149
     C                     EXSR #ZB                        **2            S01149
     C                     END                             E*2            S01149
     C                     END                             E1             S01149
     C*                                                                   S01149
     C** If next interest date not entered add interest at                S01149
     C** maturity into book.                                              S01149
     C           @NIPD     IFEQ 0                          B1             S01149
     C*                                                                   S01149
     C** Calculate interest at maturity.                                  S01149
     C***********          Z-ADDIHDVSD    @@BEG            *1       S01149056095
     C***********          Z-ADDIHMATD    @@END            *1       S01149056095
     C***********          MOVE IHICMT    @@CALC           *1       S01149056095
     C                     Z-ADDIHDVSD    ZZBEG            *1             056095
     C                     Z-ADDIHMATD    ZZEND            *1             056095
     C                     MOVE IHICMT    ZZCALC           *1             056095
     C                     Z-ADDIHFVAL    @@AMT            *1             S01149
     C                     Z-ADDIHFRAT    @@RATE           *1             S01149
     C******************** EXSR MM1007                     *1      S01149 E17051
     C                     EXSR MM1030                     *1             E17051
     C                     MULT 10        @@INTR           *1             E19980
     C*                                                                   S01149
     C** Add interest at maturity into book on insertion                  S01149
     C           @MDTD     IFGE @RUNDT                     B*2            S01149
     C           CCLACT    IFEQ 'I'                        B**3           S01149
     C                     Z-ADD@@INTR    @DNIM            ***3           S01149
     C                     DIV  10        @@INTR    H      ***3           S01149
     C                     Z-ADD@@INTR    @HNIM            ***3           S01149
     C                     ADD  @@INTR    @NIMT            ***3           S01149
     C                     END                             E**3           S01149
     C*                                                                   S01149
     C** Subtract interest at maturity from book on deletion              S01149
     C           CCLACT    IFEQ 'D'                        B**3           S01149
     C                     Z-SUB@@INTR    @DNIM            ***3           S01149
     C                     DIV  10        @@INTR    H      ***3           S01149
     C                     Z-SUB@@INTR    @HNIM            ***3           S01149
     C                     SUB  @@INTR    @NIMT            ***3           S01149
     C                     END                             E**3           S01149
     C*                                                                   S01149
     C** If last action insertion or deletion update details on           S01149
     C** books otherwise........                                          S01149
     C           CCLACT    IFEQ 'I'                        B**3           S01149
     C           CCLACT    OREQ 'D'                        ***3           S01149
     C                     Z-ADD@MDTD     @HNDAT           ***3           S01149
     C                     EXSR #ZA                        ***3           S01149
     C                     EXSR #ZB                        ***3           S01149
     C                     END                             E**3           S01149
     C                     END                             E*2            S01149
     C*                                                                   S01149
     C** .....If last action code is amend need to check whether 'SI'     S01149
     C** deam has been performed on deal.                                 S01149
     C           CCLACT    IFEQ 'A'                        B*2            S01149
     C                     Z-ADDIHDN38    IGDA38           **2            S01149
     C                     Z-ADD0         @HNDAT           **2            S01149
     C                     Z-ADD0         IGDS38           **2            S01149
     C*                                                                   S01149
     C           @MDKEY    SETGTMMLVDMLL                   **2            S01149
     C                     READ MMLVDMLL                 60**2            S01149
     C*                                                                   S01149
     C** Set up flag indicating whether deam exists on deal.              S01149
     C           *IN60     IFEQ '1'                        B**3           S01149
     C           HNDA38    ORNE IHDN38                     ***3           S01149
     C                     MOVE 'N'       @DMFLG  1        ***3           S01149
     C                     ELSE                            x**3           S01149
     C                     MOVE 'Y'       @DMFLG           ***3           S01149
     C                     END                             E**3           S01149
     C*                                                                   S01149
     C** If no 'SI' deam found add in interest at maturity to book        S01149
     C** and back out BU interest at maturity from book.                  S01149
     C           @DMFLG    IFEQ 'N'                        B**3           S01149
     C           @MDTD     IFGE @RUNDT                     B***4          S01149
     C                     Z-ADD@MDTD     @HNDAT           ****4          S01149
     C                     Z-ADD@@INTR    @DNIM            ****4          S01149
     C                     DIV  10        @@INTR    H      ****4          S01149
     C                     Z-ADD@@INTR    @HNIM            ****4          S01149
     C                     ADD  @@INTR    @NIMT            ****4          S01149
     C*                                                                   S01149
     C** Update Forward Books                                             S01149
     C                     EXSR #ZA                        ****4          S01149
     C                     EXSR #ZB                        ****4          S01149
     C                     END                             E***4          S01149
     C*                                                                   S01149
     C** If BU next int date non-zero back out BU maturity int amnt       S01149
     C** Calculate BU interest at maturity.                               S01149
     C*                                                                   S01149
     C***********          Z-ADDIHBLID    @@DTIN           ***3     S01149056095
     C***********          EXSR ZA0680                     ***3     S01149056095
     C***********          Z-ADD@@MDNO    @@BEG            ***3     S01149056095
     C                     Z-ADDIHBLID    ZZDTIN           ***3           056095
     C                     EXSR ZDAT10                     ***3           056095
     C                     Z-ADDZZMDNO    ZZBEG            ***3           056095
     C*                                                                   S01149
     C           IHBNID    IFEQ 0                          B***4          S01149
     C***********          Z-ADDIHBMTD    @@DTIN           ****4    S01149056095
     C***********          EXSR ZA0680                     ****4    S01149056095
     C***********          Z-ADD@@MDNO    @@END            ****4    S01149056095
     C                     Z-ADDIHBMTD    ZZDTIN           ****4          056095
     C                     EXSR ZDAT10                     ****4          056095
     C                     Z-ADDZZMDNO    ZZEND            ****4          056095
     C                     Z-ADDIHBMTD    @TEST   80       ****4          S01149
     C                     ELSE                            X***4          S01149
     C***********          Z-ADDIHBNID    @@DTIN           ****4    S01149056095
     C***********          EXSR ZA0680                     ****4    S01149056095
     C***********          Z-ADD@@MDNO    @@END            ****4    S01149056095
     C                     Z-ADDIHBNID    ZZDTIN           ****4          056095
     C                     EXSR ZDAT10                     ****4          056095
     C                     Z-ADDZZMDNO    ZZEND            ****4          056095
     C                     Z-ADDIHBNID    @TEST   80       ****4          S01149
     C                     END                             E***4          S01149
     C*                                                                   S01149
     C** Calculate BU interest at maturity                                S01149
     C***********          MOVE IHBICM    @@CALC           ***3     S01149056095
     C                     MOVE IHBICM    ZZCALC           ***3           056095
     C                     Z-ADDIHBFVL    @@AMT            ***3           S01149
     C                     Z-ADDIHBFRT    @@RATE           ***3           S01149
     C******************** EXSR MM1007                     ***3    S01149 E17051
     C                     EXSR MM1030                     ***3           E17051
     C                     MULT 10        @@INTR           ***3           E19980
     C*                                                                   S01149
     C** Back out BU interest at maturity from book                       S01149
     C           @TEST     IFGE @RUNDT                     B***4          S01149
     C                     Z-SUB@TEST     @HNDAT           ****4          S01149
     C                     Z-SUB@@INTR    @DNIM            ****4          S01149
     C                     DIV  10        @@INTR    H      ****4          S01149
     C                     Z-SUB@@INTR    @HNIM            ****4          S01149
     C                     SUB  @@INTR    @NIMT            ****4          S01149
     C*                                                                   S01149
     C** Update Forward Books                                             S01149
     C                     EXSR #ZA                        ****4          S01149
     C                     EXSR #ZB                        ****4          S01149
     C                     END                             E***4          S01149
     C*                                                                   S01149
     C                     ELSE                            X**3           S01149
     C*                                                                   S01149
     C** Calculate deam value start date as a day number                  S01149
     C                     Z-ADDHNVDYY    @VDYY            ***3           S01149
     C                     Z-ADDHNVDMM    @VDMM            ***3           S01149
     C                     Z-ADDHNVDDD    @VDDD            ***3           S01149
     C*                                                                   S01149
     C***********          Z-ADD@HNDAT    @@DTIN           ***3     S01149056095
     C***********          EXSR ZA0680                     ***3     S01149056095
     C***********          Z-ADD@@MDNO    @DMDVS  50       ***3     S01149056095
     C                     Z-ADD@HNDAT    ZZDTIN           ***3           056095
     C                     EXSR ZDAT10                     ***3           056095
     C                     Z-ADDZZMDNO    @DMDVS  50       ***3           056095
     C*                                                                   S01149
     C** If deam exists for deal being amended calculate new deam         S01149
     C** amounts                                                          S01149
     C           IHDVSD    IFGE 0                          B***4          S01149
     C*****      @DMDVS    ANDGERUND                       ****4    S01149S01194
     C           @DMDVS    ANDGEBJRDNB                     ****4          S01194
     C***********          Z-ADDIHDVSD    @@BEG            ****4    S01149056095
     C***********          Z-ADD@DMDVS    @@END            ****4    S01149056095
     C***********          MOVE IHICMT    @@CALC           ****4    S01149056095
     C                     Z-ADDIHDVSD    ZZBEG            ****4          056095
     C                     Z-ADD@DMDVS    ZZEND            ****4          056095
     C                     MOVE IHICMT    ZZCALC           ****4          056095
     C                     Z-ADDIHFVAL    @@AMT            ****4          S01149
     C                     Z-ADDIHFRAT    @@RATE           ****4          S01149
     C******************** EXSR MM1007                     ****4   S01149 E17051
     C                     EXSR MM1030                     ****4          E17051
     C                     MULT 10        @@INTR           ****4          E19980
     C                     ADD  @@INTR    @DNIM            ****4          S01149
     C                     DIV  10        @@INTR    H      ****4          S01149
     C                     ADD  @@INTR    @HNIM            ****4          S01149
     C                     ADD  @@INTR    @NIMT            ****4          S01149
     C                     END                             E***4          S01149
     C*                                                                   S01149
     C** Calculate before update deam amounts                             S01149
     C           IHBVDT    IFGE @RUNDT                     B***4          S01149
     C*****      @DMDVS    ANDGERUND                       ****4    S01149S01194
     C           @DMDVS    ANDGEBJRDNB                     ****4          S01194
     C*                                                                   S01149
     C** Calculate before update deam value date day number               S01149
     C***********          Z-ADDIHBVDT    @@DTIN           ****4    S01149056095
     C***********          EXSR ZA0680                     ****4    S01149056095
     C***********          Z-ADD@@MDNO    @@BEG            ****4    S01149056095
     C                     Z-ADDIHBVDT    ZZDTIN           ****4          056095
     C                     EXSR ZDAT10                     ****4          056095
     C                     Z-ADDZZMDNO    ZZBEG            ****4          056095
     C*                                                                   S01149
     C** Calculate before update deam amount                              S01149
     C***********          Z-ADD@DMDVS    @@END            ****4    S01149056095
     C***********          MOVE IHBICM    @@CALC           ****4    S01149056095
     C                     Z-ADD@DMDVS    ZZEND            ****4          056095
     C                     MOVE IHBICM    ZZCALC           ****4          056095
     C                     Z-ADDIHBFVL    @@AMT            ****4          S01149
     C                     Z-ADDIHBFRT    @@RATE           ****4          S01149
     C******************** EXSR MM1007                     ****4   S01149 E17051
     C                     EXSR MM1030                     ****4          E17051
     C                     MULT 10        @@INTR           ****4          E19980
     C                     SUB  @@INTR    @DNIM            ****4          S01149
     C                     DIV  10        @@INTR    H      ****4          S01149
     C                     SUB  @@INTR    @HNIM            ****4          S01149
     C                     SUB  @@INTR    @NIMT            ****4          S01149
     C                     END                             E***4          S01149
     C*                                                                   S01149
     C** Update forward book with amended deam amount                     S01149
     C                     Z-ADDHNVDYY    @VDYY            ***3           S01149
     C                     Z-ADDHNVDMM    @VDMM            ***3           S01149
     C                     Z-ADDHNVDDD    @VDDD            ***3           S01149
     C                     EXSR #ZA                        ***3           S01149
     C                     EXSR #ZB                        ***3           S01149
     C                     END                             E**3           S01149
     C                     END                             E*2            S01149
     C                     END                             E1             S01149
     C*                                                                   S01149
     C           #BBEB9    ENDSR                           **#BBEB9**     S01149
     C*****************************************************************   S01149
     C/EJECT                                                              S01149
     C*****************************************************************   S01149
     C*                                                               *   S01149
     C* #BBEC    - Update fwd book for next interest date for N/A's   *   S01149
     C*              (Remove interest values for N/A's sold)          *   S01149
     C*                                                               *   S01149
     C**CALLS****MM1007***- Calc interest due at next interest dateS01149 E17051
     C* CALLS    MM1030   - Calc interest due at next interest date   *   E17051
     C*          #ZA      - Write / update records on LF/MMFWUDLL     *   S01149
     C*          #ZB      - Write / update records on LF/MMFWUHLL     *   S01149
     C***********ZA0680***-*Convert*a*date*to*day*number*Form*******S01149056095
     C*          ZDAT10   - Convert a date to day number form         *   056095
     C*                                                               *   S01149
     C* CALLED BY  #BBE                                               *   S01149
     C*                                                               *   S01149
     C* FLDS USED                                                     *   S01149
     C*            @HNDAT - Data structure to format date as YYYYMMDD *   S01149
     C*            @RUNDT - Run date as YYYYMMDD format               *   S01149
     C*            @MDTD  - DS contains maturity date                 *   S01149
     C*************@@BEG**-*Beginning*of*interest*period************S01149056095
     C*************@@END**-*End*of*interest*period******************S01149056095
     C*************@@CALC*-*Interest*calculation*method*************S01149056095
     C*            ZZBEG  - Beginning of interest period              *   056095
     C*            ZZEND  - End of interest period                    *   056095
     C*            ZZCALC - Interest calculation method               *   056095
     C*            @@AMT  - Deal amount                               *   S01149
     C*            @@RATE - Deal interest rate                        *   S01149
     C*            @@INTR - Amount of interest due                    *   S01149
     C*            @DNIM  - Daily net interest movement               *   S01149
     C*            @HNIM  - Half month net interest movement          *   S01149
     C*            @NIMT  - Net interest movement                     *   S01149
     C*************@@DTIN*-*DS*contains*date*in*YYYYMMDD*for*ZA0680*S01149056095
     C*************@@MDNO*-*MIDAS*day*number************************S01149056095
     C*            ZZDTIN - DS contains date in YYYYMMDD for ZDAT10   *   056095
     C*            ZZMDNO - MIDAS day number                          *   056095
     C*                                                               *   S01149
     C*****************************************************************   S01149
     C           #BBEC     BEGSR                                          S01149
     C*                                                                   S01149
     C** If next interest payment date entered calculate interest at      S01149
     C** next interest payment date and update files.                     S01149
     C                     Z-ADDILRNID    @HNDAT                          S01149
     C*                                                                   S01279
     C** convert date from YYYYMMDD to Midas day number                   S01279
     C***********          Z-ADDILRNID    @@DTIN                    S01279056095
     C***********          EXSR ZA0680                              S01279056095
     C***********          Z-ADD@@MDNO    @RNID   50                S01279056095
     C                     Z-ADDILRNID    ZZDTIN                          056095
     C                     EXSR ZDAT10                                    056095
     C                     Z-ADDZZMDNO    @RNID   50                      056095
     C*                                                                   S01149
     C** Calculate interest at next interest date.                        S01149
     C           ILRNID    IFGE @RUNDT                     B1             S01149
     C           ILRNID    ANDLTILRMTD                     *1             S01149
     C*                                                                   S01149
     C** If N/A is sold before interest due - back out interest values    S01149
     C***********ILDVSD    IFLT ILRNID                     **2      S01149S01279
     C           ILDVSD    IFLT @RNID                      **2            S01279
     C*                                                                   S01149
     C** convert date from YYYYMMDD to Midas day number                   S01279
     C***********          Z-ADDILRLID    @@DTIN           **2      S01279056095
     C***********          EXSR ZA0680                     **2      S01279056095
     C***********          Z-ADD@@MDNO    @@BEG            **2      S01279056095
     C**********           Z-ADDILRLID    @@BEG            **2     S01149 S01279
     C***********          Z-ADD@RNID     @@END            **2      S01279056095
     C**********           Z-ADDILRNID    @@END            **2     S01149 S01279
     C***********          MOVE ILRICM    @@CALC           **2      S01149056095
     C                     Z-ADDILRLID    ZZDTIN           **2            056095
     C                     EXSR ZDAT10                     **2            056095
     C                     Z-ADDZZMDNO    ZZBEG            **2            056095
     C                     Z-ADD@RNID     ZZEND            **2            056095
     C                     MOVE ILRICM    ZZCALC           **2            056095
     C                     Z-ADDILRFVL    @@AMT            **2            S01149
     C*****                Z-ADDIHRFRT    @@RATE           **2     S01149 E173
     C                     Z-ADDILRFRT    @@RATE           **2            E173
     C******************** EXSR MM1007                     **2     S01149 E17051
     C                     EXSR MM1030                     **2            E17051
     C                     MULT 10        @@INTR           ****4          E19980
     C*                                                                   S01149
     C** Remove interest from book.                                       S01149
     C           CCLACT    IFEQ 'I'                        B**3           S01149
     C           CCLACT    OREQ 'A'                        ***3           S01149
     C                     Z-SUB@@INTR    @DNIM            ***3           S01149
     C                     DIV  10        @@INTR    H      ***3           S01149
     C                     Z-SUB@@INTR    @HNIM            ***3           S01149
     C                     SUB  @@INTR    @NIMT            ***3           S01149
     C                     ELSE                            X**3           S01149
     C                     Z-ADD@@INTR    @DNIM            ***3           S01149
     C                     DIV  10        @@INTR    H      ***3           S01149
     C                     Z-ADD@@INTR    @HNIM            ***3           S01149
     C                     ADD  @@INTR    @NIMT            ***3           S01149
     C                     END                             E**3           S01149
     C*                                                                   S01149
     C** Update forward book details.                                     S01149
     C                     EXSR #ZA                        **2            S01149
     C                     EXSR #ZB                        **2            S01149
     C                     END                             E*2            S01149
     C                     END                             E1             S01149
     C*                                                                   S01149
     C           #BBEC9    ENDSR                           **#BBEC9**     S01149
     C*****************************************************************   S01149
     C/EJECT                                                              S01149
     C*****************************************************************   S01149
     C*                                                               *   S01149
     C* #BBED    - Update fwd book for maturity date for N/A's        *   S01149
     C*            (Removes interest values for N/A's sold)           *   S01149
     C*                                                               *   S01149
     C* CALLS    #ZA      - Write / update records on LF/MMFWUDLL     *   S01149
     C*          #ZB      - Write / update records on LF/MMFWUHLL     *   S01149
     C********** MM1007   - Calc interest due at next interest dateS01149 E17051
     C*          MM1030   - Calc interest due at next interest date   *   E17051
     C***********ZA0680***-*Convert*a*date*to*day*number*form*******S01149056095
     C*          ZDAT10   - Convert a date to day number form         *   056095
     C*                                                               *   S01149
     C* CALLED BY  #BBE   - Route program through update sequence     *   S01149
     C*                                                               *   S01149
     C* FLDS USED  @MDTD  - DS contains maturity date                 *   S01149
     C*            @RUNDT - Run date as YYYYMMDD format               *   S01149
     C*            @DLTYP - Deal type ind - P = placing T = taking    *   S01149
     C*            @HNDAT - Data structure to format date as YYYYMMDD *   S01149
     C*            @NIPD  - DS contains next int payment date         *   S01149
     C*************@@BEG**-*Beginning*of*interest*period************S01149056095
     C*************@@END**-*End*of*interest*period******************S01149056095
     C*************@@CALC*-*Interest*calculation*method*************S01149056095
     C*            ZZBEG  - Beginning of interest period              *   056095
     C*            ZZEND  - End of interest period                    *   056095
     C*            ZZCALC - Interest calculation method               *   056095
     C*            @@AMT  - Deal amount                               *   S01149
     C*            @@RATE - Deal interest rate                        *   S01149
     C*            @@INTR - Amount of interest due                    *   S01149
     C*            @DNIM  - Daily net interest movement               *   S01149
     C*            @HNIM  - Half month net interest movement          *   S01149
     C*            @NIMT  - Net interest movement                     *   S01149
     C*************@@DTIN*-*DS*contains*date*in*YYYYMMDD*for*ZA0680*S01149056095
     C*************@@MDNO*-*MIDAS*day*number************************S01149056095
     C*            ZZDTIN - DS contains date in YYYYMMDD for ZDAT10   *   056095
     C*            ZZMDNO - MIDAS day number                          *   056095
     C*            @MDKEY - Key to LF/MMLVDMLL                        *   S01149
     C*            @DMFLG - Flag ind if later deam exists on deal     *   S01149
     C*            @VDYY  - Date used in accessing forward book files *   S01149
     C*            @VDMM  - Date used in accessing forward book files *   S01149
     C*            @VDDD  - Date used in accessing forward book files *   S01149
     C*                                                               *   S01149
     C*****************************************************************   S01149
     C           #BBED     BEGSR                                          S01149
     C*                                                                   S01149
     C** convert date from YYYYMMDD to Midas day number                   S01279
     C***********          Z-ADDILRMTD    @@DTIN                    S01279056095
     C***********          EXSR ZA0680                              S01279056095
     C***********          Z-ADD@@MDNO    @RMTD   50                S01279056095
     C                     Z-ADDILRMTD    ZZDTIN                          056095
     C                     EXSR ZDAT10                                    056095
     C                     Z-ADDZZMDNO    @RMTD   50                      056095
     C*                                                                   S01149
     C** If next interest payment date is greater than run date update    S01149
     C** maturity date details with next interest amount                  S01149
     C           ILRNID    IFGE @RUNDT                     B1             S01149
     C           ILRNID    ANDGEILRMTD                     *1             S01149
     C*                                                                   S01149
     C** If N/A is sold before interest due - back out interest values    S01149
     C***********ILRMTD    ANDGTILDVSD                     *1       S01149S01279
     C           @RMTD     ANDGTILDVSD                     *1             S01279
     C                     Z-ADDILRMTD    @HNDAT           *1             S01149
     C*                                                                   S01149
     C** Calc interest amount to be taken from book at maturity date      S01149
     C*                                                                   S01279
     C** convert date from YYYYMMDD to Midas day number                   S01279
     C***********          Z-ADDILRLID    @@DTIN           *1       S01279056095
     C***********          EXSR ZA0680                     *1       S01279056095
     C***********          Z-ADD@@MDNO    @@BEG            *1       S01279056095
     C**********           Z-ADDILRLID    @@BEG            *1      S01149 S01279
     C***********          Z-ADD@RMTD     @@END            *1       S01279056095
     C**********           Z-ADDILRMTD    @@END            *1      S01149 S01279
     C***********          MOVE ILRICM    @@CALC           *1       S01149056095
     C                     Z-ADDILRLID    ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    ZZBEG            *1             056095
     C                     Z-ADD@RMTD     ZZEND            *1             056095
     C                     MOVE ILRICM    ZZCALC           *1             056095
      * Use face value of NAS in case sale of portion of parcelled NAB    S01378
     C***********          Z-ADDILRFVL    @@AMT            *1       S01149S01378
     C                     Z-ADDILFVAL    @@AMT            *1             S01378
     C                     Z-ADDILRFRT    @@RATE           *1             S01149
     C******************** EXSR MM1007                     *1      S01149 E17051
     C                     EXSR MM1030                     *1             E17051
     C                     MULT 10        @@INTR           **2            E19980
     C*                                                                   S01149
     C** For insert/amend back interest out of book                       S01149
     C           CCLACT    IFEQ 'I'                        B*2            S01149
     C           CCLACT    OREQ 'A'                        **2            S01149
     C                     Z-SUB@@INTR    @DNIM            **2            S01149
     C                     DIV  10        @@INTR    H                     S01149
     C                     Z-SUB@@INTR    @HNIM            **2            S01149
     C                     SUB  @@INTR    @NIMT            **2            S01149
     C*                                                                   S01149
     C** else add interest in.                                            S01149
     C                     ELSE                            X*2            S01149
     C                     Z-ADD@@INTR    @DNIM            **2            S01149
     C                     DIV  10        @@INTR    H                     S01149
     C                     Z-ADD@@INTR    @HNIM            **2            S01149
     C                     ADD  @@INTR    @NIMT            **2            S01149
     C                     END                             E*2            S01149
     C*                                                                   S01149
     C** Update forward book details.                                     S01149
     C                     EXSR #ZA                        *1             S01149
     C                     EXSR #ZB                        *1             S01149
     C                     END                             E1             S01149
     C*                                                                   S01149
     C*                                                                   S01149
     C** If next interest date back out interest from sale date to        S01149
     C** maturity date.                                                   S01149
     C           ILRNID    IFEQ 0                          B1             S01149
     C***********ILDVSD    ANDLTILRMTD                     *1       S01149S01279
     C           ILDVSD    ANDLT@RMTD                      *1             S01279
     C*                                                                   S01149
     C** Calculate interest at maturity.                                  S01149
     C*                                                                   S01279
     C** convert date from YYYYMMDD to Midas day number                   S01279
     C***********          Z-ADDILRVDT    @@DTIN           *1       S01279056095
     C***********          EXSR ZA0680                     *1       S01279056095
     C***********          Z-ADD@@MDNO    @@BEG            *1       S01279056095
     C**********           Z-ADDILRVDT    @@BEG            *1      S01149 S01279
     C***********          Z-ADD@RMTD     @@END            *1       S01279056095
     C**********           Z-ADDILRMTD    @@END            *1      S01149 S01279
     C***********          MOVE ILRICM    @@CALC           *1       S01149056095
     C                     Z-ADDILRVDT    ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    ZZBEG            *1             056095
     C                     Z-ADD@RMTD     ZZEND            *1             056095
     C                     MOVE ILRICM    ZZCALC           *1             056095
      * Use face value of NAS in case sale of portion of parcelled NAB    S01378
     C***********          Z-ADDILRFVL    @@AMT            *1       S01149S01378
     C                     Z-ADDILFVAL    @@AMT            *1             S01378
     C                     Z-ADDILRFRT    @@RATE           *1             S01149
     C******************** EXSR MM1007                     *1      S01149 E17051
     C                     EXSR MM1030                     *1             E17051
     C                     MULT 10        @@INTR           *1             E19980
     C*                                                                   S01149
     C** Back interest at maturity out of book .                          S01149
     C           ILRMTD    IFGE @RUNDT                     B*2            S01149
     C           CCLACT    IFEQ 'I'                        B**3           S01149
     C                     Z-SUB@@INTR    @DNIM            ***3           S01149
     C                     DIV  10        @@INTR    H      ***3           S01149
     C                     Z-SUB@@INTR    @HNIM            ***3           S01149
     C                     SUB  @@INTR    @NIMT            ***3           S01149
     C                     END                             E**3           S01149
     C*                                                                   S01149
     C**      Add interest at maturity into book on deletion              S01149
     C           CCLACT    IFEQ 'D'                        B**3           S01149
     C                     Z-ADD@@INTR    @DNIM            ***3           S01149
     C                     DIV  10        @@INTR    H      ***3           S01149
     C                     Z-ADD@@INTR    @HNIM            ***3           S01149
     C                     ADD  @@INTR    @NIMT            ***3           S01149
     C                     END                             E**3           S01149
     C*                                                                   S01149
     C                     Z-ADDILRMTD    @HNDAT           **2            S01149
     C                     EXSR #ZA                        **2            S01149
     C                     EXSR #ZB                        **2            S01149
     C                     END                             E*2            S01149
     C                     END                             E1             S01149
     C*                                                                   S01149
     C           #BBED9    ENDSR                           **#BBED9**     S01149
     C*****************************************************************   S01149
     C/EJECT
     C*****************************************************************   S01149
     C*                                                               *   S01149
     C* #BBEE    - Update fwd book for maturity date for N/A's        *   S01149
     C*            (Adds discount values for N/A's )                  *   S01149
     C*                                                               *   S01149
     C* CALLS    #ZA      - Write / update records on LF/MMFWUDLL     *   S01149
     C*          #ZB      - Write / update records on LF/MMFWUHLL     *   S01149
     C*                                                               *   S01149
     C* CALLED BY  #BBE   - Route program through update sequence     *   S01149
     C*                                                               *   S01149
     C* FLDS USED         -                                           *   S01149
     C*                                                               *   S01149
     C*****************************************************************   S01149
      *                                                                   S01149
     C           #BBEE     BEGSR                                          S01149
      *                                                                   S01149
     C           CCLACT    IFEQ 'I'                        B1             S01149
     C           IHFVAL    ADD  IHAMNP    @DNIM            *1             S01149
     C           IHFVAL    ADD  IHAMNP    @HNIM            *1             S01149
     C                     END                             E1             S01149
      *                                                                   S01149
     C           CCLACT    IFEQ 'D'                        B1             S01149
     C                     Z-SUBIHFVAL    @DNIM            *1             S01149
     C                     Z-SUBIHFVAL    @HNIM            *1             S01149
     C                     SUB  IHAMNP    @DNIM            *1             S01149
     C                     SUB  IHAMNP    @HNIM            *1             S01149
     C                     END                             E1             S01149
      *                                                                   S01149
     C           CCLACT    IFEQ 'A'                        B1             S01149
     C           IHFVAL    ADD  IHAMNP    @DNIM            *1             S01149
     C                     SUB  IHBAMT    @DNIM            *1             S01149
     C                     SUB  IHBFVL    @DNIM            *1             S01149
     C           IHFVAL    ADD  IHAMNP    @HNIM            *1             S01149
     C                     SUB  IHBAMT    @HNIM            *1             S01149
     C                     SUB  IHBFVL    @HNIM            *1             S01149
     C                     END                             E1             S01149
      *                                                                   S01149
     C                     MULT 10        @DNIM                           S01149
     C**  E20540 - @DNIM is always 10X bigger than @HNIM & @NIMT          E20540
     C**********           MULT 10        @HNIM                    S01149 E20540
     C**********           ADD  @DNIM     @NIMT                    S01149 E20540
     C                     ADD  @HNIM     @NIMT                           E20540
     C                     EXSR #ZA                                       S01149
     C                     EXSR #ZB                                       S01149
     C                     ENDSR                                          S01149
      *                                                                   S01149
     C*****************************************************************   S01149
     C/EJECT
     C*****************************************************************   S01149
     C*                                                               *   S01149
     C* #BBEF    - Update fwd book for maturity date for N/A's        *   S01149
     C*            (Removes discount values for N/A's sold)           *   S01149
     C*                                                               *   S01149
     C* CALLS    #ZA      - Write / update records on LF/MMFWUDLL     *   S01149
     C*          #ZB      - Write / update records on LF/MMFWUHLL     *   S01149
     C********** MM1007   - Calc interest due at next interest dateS01149 E17051
     C*          MM1030   - Calc interest due at next interest date   *   E17051
     C***********ZA0680***-*Convert*a*date*to*day*number*form*******S01149056095
     C*          ZDAT10   - Convert a date to day number form         *   056095
     C*                                                               *   S01149
     C* CALLED BY  #BBE   - Route program through update sequence     *   S01149
     C*                                                               *   S01149
     C* FLDS USED         -                                           *   S01149
     C*                                                               *   S01149
     C*****************************************************************   S01149
     C           #BBEF     BEGSR                                          S01149
     C*                                                                   S01149
      *                                                                   S01149
     C           CCLACT    IFEQ 'D'                        B1             S01149
     C***********ILRFVL    ADD  ILRBAT    @DNIM            *1       S01149S01378
     C***********ILRFVL    ADD  ILRBAT    @HNIM            *1       S01149S01378
     C           ILFVAL    ADD  ILAMNP    @DNIM            *1             S01378
     C           ILFVAL    ADD  ILAMNP    @HNIM            *1             S01378
     C                     END                             E1             S01149
      *                                                                   S01149
     C           CCLACT    IFEQ 'I'                        B1             S01149
     C***********          Z-SUBILRBAT    @DNIM            *1       S01149S01378
     C***********ILRBAT    SUB  ILRFVL    @DNIM            *1       S01149S01279
     C***********@DNIM     SUB  ILRFVL    @DNIM            *1       S01279S01378
     C***********          Z-SUBILRBAT    @HNIM            *1       S01149S01378
     C                     Z-SUBILAMNP    @DNIM            *1             S01378
     C           @DNIM     SUB  ILFVAL    @DNIM            *1             S01378
     C                     Z-SUBILAMNP    @HNIM            *1             S01378
     C           @HNIM     SUB  ILFVAL    @HNIM            *1             S01378
     C***********ILRBAT    SUB  ILRFVL    @HNIM            *1       S01149S01279
     C***********@HNIM     SUB  ILRFVL    @HNIM            *1       S01279S01378
     C                     END                             E1             S01149
      *                                                                   S01149
     C                     MULT 10        @DNIM                           S01149
     C**  E20540 - @DNIM is always 10X bigger than @HNIM & @NIMT          E20540
     C**********           MULT 10        @HNIM                    S01149 E20540
     C**********           ADD  @DNIM     @NIMT                    S01149 E20540
     C                     ADD  @HNIM     @NIMT                           E20540
     C*                                                                   S01149
     C** Update forward book details.                                     S01149
     C                     EXSR #ZA                        *1             S01149
     C                     EXSR #ZB                        *1             S01149
     C*                                                                   S01149
     C           #BBEF9    ENDSR                           **#BBEF9**     S01149
     C*****************************************************************   S01149
     C/EJECT
     C*****************************************************************   E17051
     C*   MM1007 - CALCULATE INTEREST                                 *   E17051
     C*                                                               *   E17051
     C*  CALLED BY    -                                               *   E17051
     C*                                                               *   E17051
     C*  CALLS        -   MM1009 CALCULATE NO. OF INTEREST DAYS       *   E17051
     C*                                                               *   E17051
     C*  FIELDS INPUT @@BEG  - START DATE OF PERIOD                   *   E17051
     C*               @@END  - END DATE OF PERIOD                     *   E17051
     C*               @@CALC - INTEREST CALCULATION METHOD            *   E17051
     C*               @@AMT  - PRINCIPAL AMOUMT  15N                  *   E17051
     C*               @@RATE - INTEREST RATE 11,7                     *   E17051
     C*                                                               *   E17051
     C*  FIELDS OUTPUT @@INTR - INTEREST 15,0                         *   E17051
     C*                                                               *   E17051
     C*  WORK FIELDS   @@W155 - 15,5                                      E17051
     C*                                                               *   E17051
     C*****************************************************************   E17051
     C********** MM1007    BEGSR                                          E17051
     C**********                                                          E17051
     C****CALCULATE NUMBER OF INTEREST DAYS                               E17051
     C**********           EXSR MM1009                                    E17051
     C**********                                                          E17051
     C********** @@CALC    IFEQ '2'                        B1             E17051
     C********** @@CALC    OREQ '3'                        *1             E17051
     C********** @@CALC    OREQ '5'                        *1             E17051
     C********** @@AMT     DIV  36000     @@W155 155       *1             E17051
     C**********           END                             E1             E17051
     C**********                                                          E17051
     C********** @@CALC    IFEQ '1'                        B1             E17051
     C********** @@CALC    OREQ '4'                        *1             E17051
     C********** @@AMT     DIV  36500     @@W155           *1             E17051
     C**********           END                             E1             E17051
     C**********                                                          E17051
     C********** @@CALC    IFEQ '6'                        B1             E17051
     C********** @@AMT     DIV  36600     @@W155           *1             E17051
     C**********           END                             E1             E17051
     C**********                                                          E17051
     C**********           MULT @@RATE    @@W155                          E17051
     C********** @@W155    MULT @@INDY    @@W151 151H                     E17051
     C********** @@W151    MULT 10        @@INTR 150H                     E17051
     C**********                                                          E17051
     C********** M10079    ENDSR                                          E17051
     C*****************************************************************   E17051
     C/EJECT                                                              E17051
     C**********************************************************   E17051 S01392
     C****MM1030 - CALCULATE INTEREST                              E17051 S01392
     C******       (MM1030 INCLUDES ADJUSTMENT FOR ERROR IN DIVISIOE17051 S01392
     C******                                                       E17051 S01392
     C***CALLED BY    -                                            E17051 S01392
     C******                                                       E17051 S01392
     C***CALLS        -   MM1009 CALCULATE NO. OF INTEREST DAYS    E17051 S01392
     C******                                                       E17051 S01392
     C***FIELDS INPUT @@BEG  - START DATE OF PERIOD                E17051 S01392
     C******          @@END  - END DATE OF PERIOD                  E17051 S01392
     C******          @@CALC - INTEREST CALCULATION METHOD         E17051 S01392
     C******          @@AMT  - PRINCIPAL AMOUNT  15N               E17051 S01392
     C******          @@RATE - INTEREST RATE 11,7                  E17051 S01392
     C******                                                       E17051 S01392
     C***FIELDS OUTPUT @@INTR - INTEREST 15,0                      E17051 S01392
     C******                                                       E17051 S01392
     C***WORK FIELDS   @@W155 - 15,5                               E17051 S01392
     C******           @@YEAR - (NUMBER OF DAYS IN YEAR) x 100     E17051 S01392
     C******           @@WDIV - 15,5  HOLDS RESULT OF DIVISION     E17051 S01392
     C******           @@ERR  - 15,9  ROUNDING ERROR               E17051 S01392
     C******           @@AMTR - 15,1  AMOUNT FROM ROUNDING ERROR CAE17051 S01392
     C******                    CAN BE 15,1 SINCE IT IS NOT POSSIBLE17051 S01392
     C******                    TO INPUT 15 BYTE FIELDS IN DRS.    E17051 S01392
     C******                                                       E17051 S01392
     C*************************************************************E17051 S01392
     C******     MM1030    BEGSR                                   E17051 S01392
     C******                                                       E17051 S01392
     C****CALCULATE NUMBER OF INTEREST DAYS                        E17051 S01392
     C******               EXSR MM1009                             E17051 S01392
     C******                                                       E17051 S01392
     C******     @@CALC    IFEQ '2'                        *** B 1 E17051 S01392
     C******     @@CALC    OREQ '3'                                E17051 S01392
     C******     @@CALC    OREQ '5'                                E17051 S01392
     C******     @@AMT     DIV  36000     @@WDIV 155               E17051 S01392
     C******               Z-ADD36000     @@YEAR  50               E17051 S01392
     C******               END                             *** E 1 E17051 S01392
     C******                                                       E17051 S01392
     C******     @@CALC    IFEQ '1'                        *** B 1 E17051 S01392
     C******     @@CALC    OREQ '4'                                E17051 S01392
     C******     @@AMT     DIV  36500     @@WDIV                   E17051 S01392
     C******               Z-ADD36500     @@YEAR                   E17051 S01392
     C******               END                              *** E 1E17051 S01392
     C******                                                       E17051 S01392
     C******     @@CALC    IFEQ '6'                         *** B 1E17051 S01392
     C******     @@AMT     DIV  36600     @@WDIV                   E17051 S01392
     C******               Z-ADD36600     @@YEAR                   E17051 S01392
     C******               END                              *** E 1E17051 S01392
     C******                                                       E17051 S01392
     C******     @@WDIV    MULT @@RATE    @@W155 155               E17051 S01392
     C******                                                       E17051 S01392
     C****MULTIPLY @@WDIV BY @@YEAR TO GET ORIGINAL AMOUNT. THE RESE17051 S01392
     C****COULD DIFFER FROM THE ORIGINAL DUE TO ROUNDING ERROR ON  E17051 S01392
     C****DIVISION.                                                E17051 S01392
     C******     @@WDIV    MULT @@YEAR    @@AMTR 151               E17051 S01392
     C******                                                       E17051 S01392
     C****CALCULATE THE ERROR AND DO SAME ARITHMETICAL OPERATIONS AE17051 S01392
     C****@@AMT ABOVE.                                             E17051 S01392
     C******     @@AMT     SUB  @@AMTR    @@ERR  159               E17051 S01392
     C******               MULT @@RATE    @@ERR                    E17051 S01392
     C******               DIV  @@YEAR    @@ERR                    E17051 S01392
     C******                                                       E17051 S01392
     C****ADD RESULT FROM ERROR CALCULATIONS BACK TO THE RESULT FROE17051 S01392
     C****CALCULATIONS ON PRINCIPAL AMOUNT.                        E17051 S01392
     C******               ADD  @@ERR     @@W155                   E17051 S01392
     C******                                                       E17051 S01392
     C****MULTIPLY BY THE PERIOD TO OBTAIN THE INTEREST.           E17051 S01392
     C******     @@W155    MULT @@INDY    @@INTR 150H              E17051 S01392
     C******                                                       E17051 S01392
     C******     M10309    ENDSR                                   E17051 S01392
     C*************************************************************E17051 S01392
     C/EJECT
     C*****************************************************************   S01392
     C*                                                               *   S01392
     C*   MM1030 - CALCULATE INTEREST                                 *   S01392
     C*                                                               *   S01392
      *  (c) Finastra International Limited 2001                      *
     C*  CALLED BY    -                                               *   S01392
     C*                                                               *   S01392
     C***CALLS********-***MM1009*CALCULATE*NO.*OF*INTEREST*DAYS*****S01392056095
     C*  CALLS        -   ZINTDY CALCULATE NO. OF INTEREST DAYS       *   056095
     C*                                                               *   S01392
     C***FIELDS*INPUT*@@BEG**-*START*DATE*OF*PERIOD*****************S01392056095
     C****************@@END**-*END*DATE*OF*PERIOD*******************S01392056095
     C****************@@CALC*-*INTEREST*CALCULATION*METHOD**********S01392056095
     C*  FIELDS INPUT ZZBEG  - START DATE OF PERIOD                   *   056095
     C*               ZZEND  - END DATE OF PERIOD                     *   056095
     C*               ZZCALC - INTEREST CALCULATION METHOD            *   056095
     C*               @@AMT  - PRINCIPAL AMOUNT  15N                  *   S01392
     C*               @@RATE - INTEREST RATE 11,7                     *   S01392
     C*               @@RDFC - ROUND DOWN FACILITY IND 1              *   S01392
     C*                                                               *   S01392
     C*  FIELDS OUTPUT @@INTR - INTEREST 15,0                         *   S01392
     C*                                                               *   S01392
     C*  WORK FIELDS   @@W157 - 15,5                                  *   S01392
     C*                @@W150 - 15,0                                  *   S01392
     C*                @@YEAR - (NUMBER OF DAYS IN YEAR) x 100        *   S01392
     C*                                                               *   S01392
     C*****************************************************************   S01392
     C           MM1030    BEGSR                                          S01392
     C*                                                                   S01392
     C*   CALCULATE NUMBER OF INTEREST DAYS                               S01392
     C/COPY WNCPYSRC,MM0075C001
     C*                                                                   S01392
     C***********          EXSR MM1009                              S01392056095
      *                                                                                       CDL093
      ** set Start and End Date for calculation type 9                                        CDL093
      *                                                                                       CDL093
     C                     Z-ADDZZBEG     ZZBEG9  50                                          CDL093
     C                     Z-ADDZZEND     ZZEND9  50                                          CDL093
      *                                                                                       CDL093
      ** check if 29th Feb is included                                                        CDL093
      *                                                                                       CDL093
     C           ZZCALC    IFEQ '9'                                                           CDL093
      *                                                                                       CDL093
      ** Convert start date to YYYYMMDD format                                                CDL093
      *                                                                                       CDL093
     C                     Z-ADDZZBEG9    @@DAYN  50                                          CDL093
     C                     EXSR ZDATE9                                                        CDL093
     C                     Z-ADD@@VDT     ZZDATA  80                                          CDL093
     C                     Z-ADD@@YR      ZZYY1   40                                          CDL093
      *                                                                                       CDL093
      ** Convert end date to YYYYMMDD format                                                  CDL093
      *                                                                                       CDL093
     C                     Z-ADDZZEND9    @@DAYN                                              CDL093
     C                     EXSR ZDATE9                                                        CDL093
     C                     Z-ADD@@VDT     ZZDATB  80                                          CDL093
     C                     Z-ADD@@YR      ZZYY2   40                                          CDL093
      *                                                                                       CDL093
     C                     EXSR #FEB29                                                        CDL093
      *                                                                                       CDL093
     C                     ENDIF                                                              CDL093
      *                                                                                       CDL093
     C           ZZCALC    IFEQ '9'                                                           CDL093
     C           #29FEB    ANDEQ'Y'                                                           CDL093
     C           IKNIPD    ANDNE*ZERO                                                         CDL093
     C           IKNIPD    ANDLTZZEND                                                         CDL093
      *                                                                                       CDL093
     C                     Z-ADDIKIPDM    @@IPDM  20                                          CDL093
     C                     CALL 'MM001031'                                                    CDL093
     C                     PARM           ZZBEG                                               CDL093
     C                     PARM           ZZEND                                               CDL093
     C                     PARM           IKNIPD                                              CDL093
     C                     PARM '9'       ZZCALC                                              CDL093
     C                     PARM           IKIPFQ                                              CDL093
     C                     PARM           @@AMT                                               CDL093
     C                     PARM           @@RATE                                              CDL093
     C                     PARM 'N'       RNDDWN  1                                           CDL093
     C                     PARM 'N'       FRSLST  1                                           CDL093
     C                     PARM           @@IPDM                                              CDL093
     C                     PARM           WINTR                                               CDL093
      *                                                                                       CDL093
     C                     Z-ADDWINTR     @@INTR                                              CDL093
     C           *LIKE     DEFN @@INTR    WINTR                                               CDL093
      *                                                                                       CDL093
     C                     GOTO INTCLC                                                        CDL093
      *                                                                                       CDL093
     C                     ENDIF                                                              CDL093
      *                                                                                       CDL093
     C                     EXSR ZINTDY                                    056095
     C*                                                                   S01392
     C***********@@CALC    IFEQ '2'                        *** B 1  S01392056095
     C***********@@CALC    OREQ '3'                                 S01392056095
     C***********@@CALC    OREQ '5'                                 S01392056095
     C           ZZCALC    IFEQ '2'                        *** B 1        056095
     C           ZZCALC    OREQ '3'                                       056095
     C           ZZCALC    OREQ '5'                                       056095
     C           ZZCALC    OREQ '0'                                                          CER016A
     C                     Z-ADD36000     @@YEAR  50                      S01392
     C                     END                             *** E 1        S01392
     C*                                                                   S01392
     C***********@@CALC    IFEQ '1'                        *** B 1  S01392056095
     C***********@@CALC    OREQ '4'                                 S01392056095
     C           ZZCALC    IFEQ '1'                        *** B 1        056095
     C           ZZCALC    OREQ '4'                                       056095
     C           ZZCALC    OREQ '9'                                                           CDL093
     C           #29FEB    ANDNE'Y'                                                           CDL093
     C                     Z-ADD36500     @@YEAR                          S01392
     C                     END                              *** E 1       S01392
     C*                                                                   S01392
     C***********@@CALC    IFEQ '6'                         *** B 1 S01392056095
     C           ZZCALC    IFEQ '6'                         *** B 1       056095
     C           ZZCALC    OREQ '9'                                                           CDL093
     C           #29FEB    ANDEQ'Y'                                                           CDL093
     C                     Z-ADD36600     @@YEAR                          S01392
     C                     END                              *** E 1       S01392
     C*                                                                   S01392
     C           ZZCALC    IFEQ '6'                                       163136
     C           ZZCALC    OREQ '9'                                                           CDL093
     C           #29FEB    ANDEQ'Y'                                                           CDL093
     C           INT6DY    MULT @@RATE    @@W157                          163136
     C                     ELSE                                           163136
      *                                                                   163136
     C***********@@INDY    MULT @@RATE    @@W157 157                S01392056095
     C           ZZINDY    MULT @@RATE    @@W157 157                      056095
      *                                                                   163136
     C                     END                                            163136
      *                                                                   163136
     C           @@W157    MULT @@AMT     @@W150 150H                     S01392
     C*                                                                   S01392
     C**  ROUND DOWN IF ROUND DOWN INDICATOR IS 'Y'                       S01392
     C*                                                                   S01392
     C           @@RDFC    IFEQ 'Y'                                       S01392
     C           @@W150    DIV  @@YEAR    @@INTR                          S01392
     C                     ELSE                                           S01392
     C           @@W150    DIV  @@YEAR    @@INTR 150H                     S01392
     C                     END                                            S01392
     C*                                                                   S01392
      * Interest has been calculated                                                          CDL093
     C           INTCLC    TAG                                                                CDL093
     C                     MOVE *BLANK    @@RDFC                          S01392
     C/COPY WNCPYSRC,MM0075C002
     C*                                                                   S01392
     C           M10309    ENDSR                                          S01392
     C*****************************************************************
      /EJECT
     C*                                                                   056095
     C/COPY ZSRSRC,ZINTDYZ2                                               056095
     C*****************************************************************
     C****MM1009*- CALCULATE THE NUMBER OF INTEREST DAYS              *   056095
     C***********                                                     *   056095
     C***CALLED*BY    -                                               *   056095
     C***********                                                     *   056095
     C***CALLS***     -   ZA0710 CONVERT MIDAS DAY NUMBER TO YMD DATE *   056095
     C***********                                                     *   056095
     C***FIELDS*INPUT @@BEG  - START DATE OF PERIOD                   *   056095
     C***********     @@END  - END DATE OF PERIOD                     *   056095
     C***********     @@CALC - INTEREST CALCULATION METHOD            *   056095
     C***********                                                     *   056095
     C***FIELDS*OUTPUT @@INDY - NO. OF INTEREST DAYS                  *   056095
     C***********                                                     *   056095
     C***WORKFIELDS   @@WN5   - WORK FIELD 5N                         *   056095
     C***********     @@WN5A  - WORK FIELD 5N                         *   056095
     C***********     @@WDAT  - WORK FIELD 5N                         *   056095
     C***********     @@DAYN  - WORK FIELD 5N                         *   056095
     C***********     @@P1    - WORK FIELD 5N                         *   056095
     C***********     @@P2    - WORK FIELD 5N                         *   056095
     C***********     @@P3    - WORK FIELD 5N                         *   056095
     C***********     @@LPNM  - WORKFIELD USED IN SETTING UP @@TG10   *   056095
     C***********                                                     *   056095
     C*****************************************************************   056095
     C***********MM1009    BEGSR                                          056095
     C***********                                                         056095
     C***********          MOVE @@BEG     @@BEG   50                      056095
     C***********          MOVE @@END     @@END   50                      056095
     C***********          MOVE @@CALC    @@CALC  1                       056095
     C***********          Z-ADD*ZEROS    @@INDY                          056095
     C***********          Z-ADD*ZEROS    @@LPNM                          056095
     C***********                                                         056095
     C***FIND*NUMBER OF DAYS DIFFERENCE BETWEEN DATES                     056095
     C***********                                                         056095
     C***********@@END     SUB  @@BEG     @@WDAT  50                      056095
     C***********                                                         056095
     C*****FOR*CALCULATION METHODS 3,4 OR 5.                              056095
     C***********                                                         056095
     C***********@@CALC    IFEQ '3'                        B1             056095
     C***********@@CALC    OREQ '4'                        *1             056095
     C***********@@CALC    OREQ '5'                        *1             056095
     C***********                                                         056095
     C***********          Z-ADD@@BEG     @@DAYN  50       *1             056095
     C***********          EXSR ZA0710                     *1             056095
     C***********          Z-ADD@@VDT     @@DATA           *1             056095
     C***********                                                         056095
     C***********          Z-ADD@@END     @@DAYN           *1             056095
     C***********          EXSR ZA0710                     *1             056095
     C***********          Z-ADD@@VDT     @@DATB           *1             056095
     C***IF*IN*SAME MONTH                                                 056095
     C***********@@YY1     IFEQ @@YY2                      B*2            056095
     C***********@@MM1     IFEQ @@MM2                      B**3           056095
     C***********@@DD2     SUB  @@DD1     @@INDY           ***3           056095
     C***********          GOTO M10099                     ***3           056095
     C***********          END                             E**3           056095
     C***********          END                             E*2            056095
     C***********                                                         056095
     C***********          ELSE                            X1             056095
     C**IF*NOT*3,4 OR 5    ****                                           056095
     C**EXIT*PROCESSING                                                   056095
     C***********          Z-ADD@@WDAT    @@INDY  50       *1        PT   056095
     C***********          GOTO M10099                     *1        ->   056095
     C***********          END                             E1             056095
     C***********                                                         056095
     C***********@@CALC    IFEQ '3'                        B1             056095
     C***CALC*NO. DAYS IN FIRST MONTH                                     056095
     C***********@@MM1     IFNE 2                          B*2            056095
     C***********30        SUB  @@DD1     @@P1    50   80  **2            056095
     C***IF*<*0,*INITIALISE TO 0                                          056095
     C***80******          Z-ADD*ZEROS    @@P1             **2            056095
     C***********                                                         056095
     C***********          ELSE                            X*2            056095
     C***TEST*IF*LEAP      ****                                           056095
     C***YEAR****                                                         056095
     C***********@@YY1     DIV  4         @@WN5            **2            056095
     C***********          MVR            @@WN5          80**2            056095
     C***********                                                         056095
     C************IN80     IFEQ '1'                        B**3           056095
     C***********29        SUB  @@DD1     @@P1    50       ***3           056095
     C***********          ELSE                            X**3           056095
     C***IF*NOT*LEAP       ++++                                           056095
     C***********28        SUB  @@DD1     @@P1    50       ***3           056095
     C***********          END                             E**3           056095
     C***********          END                             E*2            056095
     C***CALC.*NO. DAYS IN LAST MONTH                                     056095
     C***********@@DD2     IFLE 30                         B*2            056095
     C***********          Z-ADD@@DD2     @@P2    50       **2            056095
     C***********          ELSE                            X*2            056095
     C***********          ****                                           056095
     C***********          Z-ADD30        @@P2             **2            056095
     C***********          END                             E*2            056095
     C***CALC*NO. DAYS IN INTERVENING MONTHS                              056095
     C***********@@YY2     IFEQ @@YY1                      B*2            056095
     C***********@@MM2     SUB  @@MM1     @@P3    50       **2            056095
     C***********          SUB  1         @@P3             **2            056095
     C***********          MULT 30        @@P3             **2            056095
     C***********          ELSE                            X*2            056095
     C***********          ****                                           056095
     C***********@@YY2     SUB  @@YY1     @@P3             **2            056095
     C***********          SUB  1         @@P3             **2            056095
     C***********          MULT 360       @@P3             **2            056095
     C***********                                                         056095
     C**FIND*NO.*OF MONTHS FOR THE TWO PARTIAL YEARS                      056095
     C***********12        SUB  @@MM1     @@WN5A  50       **2            056095
     C***********          MULT 30        @@WN5A           **2            056095
     C***********                                                         056095
     C***********@@MM2     SUB  1         @@WN5            **2            056095
     C***********@@WN5     MULT 30        @@WN5            **2            056095
     C***ACCUMULATE                                                       056095
     C***********@@WN5A    ADD  @@WN5     @@WN5A           **2            056095
     C***********@@P3      ADD  @@WN5A    @@P3             **2            056095
     C***********          END                             E*2            056095
     C***FINAL*SUM                                                        056095
     C***********                                                         056095
     C***********@@P1      ADD  @@P2      @@INDY           *1             056095
     C***********          ADD  @@P3      @@INDY           *1             056095
     C***********          END                             E1             056095
     C***FOR*METHODS 4 AND 5                                              056095
     C***********                                                         056095
     C***********@@CALC    IFEQ '4'                        B1             056095
     C***********@@CALC    OREQ '5'                        *1             056095
     C****CALCULATE NUMBER OF LEAP YEARS BETWEEN START AND END DATES      056095
     C***********@@MM1     IFLE 2                          B*2            056095
     C***********@@YY1     DIV  4         @@WN5   50       **2         YR 056095
     C***********          MVR            @@WN5          80**2            056095
     C***ADD*1*IF LEAP YEAR                                               056095
     C***80******          ADD  1         @@LPNM  50       **2            056095
     C***********          END                             E*2            056095
     C***BYPASS*IF YEARS ARE THE SAME                                     056095
     C***********@@YY1     IFEQ @@YY2                      B*2            056095
     C***********@@WDAT    SUB  @@LPNM    @@INDY           **2            056095
     C***********          GOTO M10099                     **2       >    056095
     C***********          END                             E*2            056095
     C***LOOP*TO*CALCULATE NO. LEAP YEARS                                 056095
     C***********@@YY1     DOWNE@@YY2                      B*2            056095
     C***INCREMENT START YEAR                                             056095
     C***********          ADD  1         @@YY1            **2            056095
     C***********                                                         056095
     C***********@@YY1     IFEQ @@YY2                      B**3           056095
     C***********@@MM2     IFGT 2                          B***4          056095
     C***********@@YY2     DIV  4         @@WN5            ****4       YR 056095
     C***********          MVR            @@WN5          80****4          056095
     C***INCREMENT IF LEAP YEAR                                           056095
     C***80******          ADD  1         @@LPNM           ****4          056095
     C***********          END                             E***4          056095
     C***********@@WDAT    SUB  @@LPNM    @@INDY           ***3           056095
     C***********          END                             E**3           056095
     C***********@@YY1     IFNE @@YY2                      B**3           056095
     C***********@@YY1     DIV  4         @@WN5            ***3        YR 056095
     C***********          MVR            @@WN5          80***3           056095
     C***ADD*1*IF LEAP YEAR                                               056095
     C***80******          ADD  1         @@LPNM           ***3           056095
     C***********          END                             E**3           056095
     C***********          END                             E*2            056095
     C***********          END                             E1             056095
     C***********                                                         056095
     C***********M10099    ENDSR                                     **   056095
     C*****************************************************************
     C/EJECT
     C*                                                                   056095
     C/COPY ZSRSRC,ZDATE9Z3                                               056095
      *****************************************************************
     C***********                                                     *   056095
     C********TITLE:CALCULATE MIDAS DAY NO. TO DRS (YYYYMMDD) FORMAT. *   056095
     C***********                                                     *   056095
     C********SUBROUTINE ZA0710 EXPECTS FIELD '@@DAYN' TO BE          *   056095
     C********PASSED TO IT IN 5,0 FORMAT.IF THE ABOVE FIELD IS LESS   *   056095
     C********THAN 1 IT RETURNS 1 IN FIELD '@@RTN'.THE MAIN PROGRAM   *   056095
     C********SHOULD CHECK FOR THIS CONDITION AND DO THE NECESSARY.   *   056095
     C********IF*'@@RTN' IS NOT EQUAL TO 1 IT RETURNS THE FIELD       *   056095
     C********'@@VDT'  IN 'YYYYMMDD' FORMAT.                          *   056095
     C***********                                                     *   056095
     C**NOTE:*FIELD TO BE DEFINED BY EXTERNAL ROUTINE IS                  056095
     C***********                                                     *   056095
     C********1)*@@DAYN   LENGTH 5,0.                                 *   056095
     C***********                                                     *   056095
     C********FIELDS USED AND ALREADY DEFINED IN THE ROUTINE ARE:     *   056095
     C***********                                                     *   056095
     C********1)*@@VDT    LENGTH 8,0 DEFINED BY A DS.                 *   056095
     C********2)*@@RTN    LENGTH 1,0.                                 *   056095
     C********3)*@@I      LENGTH 2,0 USED TO ACCESS ARRAY @YD         *   056095
     C********4)*@@J      LENGTH 2,0 USED TO ACCESS ARRAY @MD         *   056095
     C********5)*@@Z71Y   LENGTH 4,0 DEFINED BY A DS.                 *   056095
     C********6)*@@RDAY   LENGTH 5,0.                                 *   056095
     C********7)*@@LEAP   LENGTH 1,0.                                     056095
     C***********                                                     *   056095
     C********INDICATORS USED ARE:                                    *   056095
     C***********                                                     *   056095
     C********1)*80       CHECK FOR LOW AND EQUAL ON ARRAY @YD        *   056095
     C********2)*81       CHECK FOR LOW ON ARRAY @MD.                 *   056095
     C***********                                                     *   056095
     C**INPUT*FIELD:       @@DAYN                                     *   056095
     C***********                                                     *   056095
     C**OUTPUT*FIELD:      @@VDT                                      *   056095
     C***********                                                     *   056095
     C**WORK*FIELDS:       @@RTN                                      *   056095
     C***********          @@Z71Y                                     *   056095
     C***********          @@RDAY                                     *   056095
     C***********          @@LEAP                                     *   056095
     C***********          @@I                                        *   056095
     C***********          @@J                                        *   056095
     C***********                                                     *   056095
     C**ARRAYS*USED:       @YD COMPILE TIME ARRAY.                        056095
     C***********          @MD COMPILE TIME ARRAY.                        056095
     C***********                                                         056095
     C******LAST*AMEND NO. ME1257              DATE 02/04/87          *   056095
     C******When*date input is zero set output date to zeroes         *   056095
     C***********                                                     *   056095
     C*****************************************************************   056095
     C***********                                                         056095
     C***********ZA0710    BEGSR                                          056095
     C***********                                                         056095
     C***********          SETOF                     8081                 056095
     C***********          Z-ADD0         @@RTN   10                      056095
     C***********          Z-ADD0         @@VDT                           056095
     C***********          Z-ADD1         @@I     20                      056095
     C***********          Z-ADD1         @@J     20                      056095
     C***********          Z-ADD1         @@LEAP  10                      056095
     C***********                                                         056095
     C***********@@DAYN    CABEQ0         ZA0719                    ME1257056095
     C***********                                                         056095
     C***********@@DAYN    IFLT 1                          B1             056095
     C***********          Z-ADD1         @@RTN            *1             056095
     C***********          GOTO ZA0719                     *1             056095
     C***********          END                             E1             056095
     C***********                                                         056095
     C**DIVISION*TO DETERMINE WETHER LEAP YEAR.                           056095
     C***********                                                         056095
     C***********@@DAYN    DIV  1461      @@Z71Y                          056095
     C***********          MVR            @@RDAY  50                      056095
     C***********                                                         056095
     C**CALCULATING YEAR.                                                 056095
     C***********                                                         056095
     C***********@@Z71Y    MULT 4         @@Z71Y                          056095
     C***********          ADD  1972      @@Z71Y                          056095
     C***********                                                         056095
     C**CHECKING*IF YEAR IS GREATER THAN OR EQUAL TO 2100                 056095
     C***********                                                         056095
     C***********@@Z71Y    IFGE 2100                       B1             056095
     C***********          ADD  @@SSY2    @@RDAY           *1             056095
     C***********          END                             E1             056095
     C***********                                                         056095
     C**LOKUP*ARRAY @YD TO SEE HOW MANY YEARS OF A FOUR YEAR CYCLE        056095
     C**HAVE*PASSED.                                                      056095
     C***********                                                         056095
     C***********@@RDAY    LOKUP@YD,@@I                8080               056095
     C***********                                                         056095
     C**IF*YEAR*IS A LEAP YEAR SSLEAP IS SET TO ZERO.                     056095
     C***********                                                         056095
     C************IN80     IFEQ '0'                        B1             056095
     C***********          Z-ADD0         @@LEAP           *1             056095
     C***********          END                             E1             056095
     C***********                                                         056095
     C**ADD*INDEX TO YEAR TO GIVE CORRECT YEAR AND ADJUST '@@RDAY'.       056095
     C***********                                                         056095
     C***********@@LEAP    IFEQ 1                          B1             056095
     C***********@@RDAY    SUB  @YD,@@I   @@RDAY           *1             056095
     C***********          ADD  @@I       @@Z71Y           *1             056095
     C***********          END                             E1             056095
     C***********                                                         056095
     C**PROCESSING FOR A LEAP YEAR.                                       056095
     C***********                                                         056095
     C***********@@LEAP    IFEQ 0                          B1             056095
     C***********                                                         056095
     C**IF*'@@RDAY' = 60 DATE MUST BE 29TH OF FEBRUARY.                   056095
     C***********                                                         056095
     C***********@@RDAY    IFEQ 60                         B*2            056095
     C***********          Z-ADD29        @@Z71D           **2            056095
     C***********          Z-ADD2         @@Z71M           **2            056095
     C***********          GOTO ZA0711                     **2            056095
     C***********          END                             E*2            056095
     C***********                                                         056095
     C**IF*'@@RDAY' > 60 DATE IS AFTER 29TH OF FEBRUARY,CONVERSION CAN    056095
     C**PROCEED*AS USUAL AFTER SUBTRACTING THE EXTRA DAY FOR THE LEAP     056095
     C**YEAR.*NOTE : '@@RDAY' < 60 CONVERSION PROCEEDS AS USUAL.          056095
     C***********                                                         056095
     C***********@@RDAY    IFGT 60                         B*2            056095
     C***********@@RDAY    SUB  1         @@RDAY           **2            056095
     C***********          END                             E*2            056095
     C***********                                                         056095
     C***********          END                             E1             056095
     C***********                                                         056095
     C**IF*DAY*'@@DAYN' IS EXACTLY DIVISIBLE BY 1461 (NUMBER OF DAYS      056095
     C**IN*4*YEARS) THEN DATE MUST BE LAST DAY OF PREVIOUS FOUR YEAR      056095
     C**GROUP.***                                                         056095
     C***********                                                         056095
     C***********@@RDAY    IFEQ 0                          B1             056095
     C***********          Z-ADD31        @@Z71D           *1             056095
     C***********          Z-ADD12        @@Z71M           *1             056095
     C***********          SUB  1         @@Z71Y           *1             056095
     C***********          GOTO ZA0711                     *1             056095
     C***********          END                             E1             056095
     C***********                                                         056095
     C**LOOK*UP*ARRAY ARRAY @MD TO DETERMINE WHICH MONTH '@@RDAY'         056095
     C**OCCURS*IN                                                         056095
     C***********                                                         056095
     C***********@@RDAY    LOKUP@MD,@@J                81                 056095
     C***********          Z-ADD@@J       @@Z71M                          056095
     C***********@@RDAY    SUB  @MD,@@J   @@Z71D                          056095
     C***********                                                         056095
     C**DS*@@VDT* IS RETURNED IN YYYYMMDD FORMAT                          056095
     C***********                                                         056095
     C***********ZA0711    TAG                                            056095
     C***********                                                         056095
     C***********          MOVE @@Z71Y    @@YR                            056095
     C***********                                                         056095
     C***********ZA0719    ENDSR                                          056095
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #A       - Initial processing                                 *
     C*                                                               *
     C* CALLS    ZA0150   - Acces LF/FDICDRll                         *
     C*                                                               *
     C* CALLED BY  MAIN   - Main controlling routine.                 *
     C*                                                               *
     C* FLDS USED  @TERM  - Termination parameter                     *
     C*            @FMTY  - LF/MMSTDDLL format indicator              *
     C*            @STDL  - Standard deal details from PF/MMSTDLPP    *
     C*            @STDB  - Standard deal details from PF/MMSTDBPP    *
     C*            @STDS  - Standard deal details from PF/MMSTDSPP    *
     C*            @STDA  - Standard deal details from PF/MMSTDAPP    *
     C*            @DKEY  - Key to file LF/MMFWUDLL                   *
     C*            @VDYY  - Date used in accessing forward book files *
     C*            @VDMM  - Date used in accessing forward book files *
     C*            @VDDD  - Date used in accessing forward book files *
     C*            @HKEY  - Key to LF/MMFWUHLL                        *
     C*            @VDHM  - Half month part of key on LF/MMFWUHLL     *
     C*            @MDKEY - Key to LF/MMLVDMLL                        *
     C*            @UPDT  - DS holds control details for file updating*
     C*            @A     - Index to array of month shortnames        *
     C*            @MN    - Array of month shortnames                 *
     C*            @RUNDT - Run date as YYYYMMDD format               *
     C*            @WRK   - Date work field                           *
     C*            @TSTDT - Date determines LF/MMFWUHLL to be updated *
     C*            @HNDAT - Data structure to format date as YYYYMMDD *
     C*            @@AMT  - Deal amount                               *
     C*            @AMT   -                                           *
     C*            @@RATE - Deal interest rate                        *
     C*                                                               *
     C*****************************************************************
     C           #A        BEGSR
     C*
      ** Switch off *INU7 and *INU8, in case they have been left on       CAP002
      ** by a program elsewhere in the structure.                         CAP002
     C                     CLEAR*INU7                                     CAP002
     C                     CLEAR*INU8                                     CAP002
      *                                                                   CAP002
     C                     MOVEACPY@      BIS@   80                       S01194
     C                     MOVEL'MM0075'  DBPGM
     C*
     C** Open files used in program.
     C*****                OPEN FDICDRLL                                  S01194
     C                     OPEN FDMNTHLL
     C                     OPEN MMLVDMLL
     C                     OPEN MMFWUDLL
     C                     OPEN MMFWUHLL
     C                     OPEN MMFWUTLL
     C*
     C** Receive parameter from MM0078
     C           *ENTRY    PLIST
     C                     PARM           @TERM   1
     C                     PARM           @FMTY   1
     C                     PARM           @STDL
     C                     PARM           @STDB
     C                     PARM           @STDS
     C                     PARM           @STDA
     C*
     C** Build key for MMFWUDLL file
     C           @DKEY     KLIST
     C                     KFLD           CCCCY
     C                     KFLD           @VDYY   40
     C                     KFLD           @VDMM   20
     C                     KFLD           @VDDD   20
     C                     KFLD           HSLDNA                          S01149
     C*
     C** Build key for MMFWUHLL file
     C           @HKEY     KLIST
     C                     KFLD           CCCCY
     C                     KFLD           @VDYY
     C                     KFLD           @VDMM
     C                     KFLD           @VDHM   20
     C                     KFLD           HTLDNA                          S01149
     C*
     C** Build key for MMLVDMLL file
     C           @MDKEY    KLIST
     C                     KFLD           IGDA38
     C                     KFLD           @VDYY
     C                     KFLD           @VDMM
     C                     KFLD           @VDDD
     C                     KFLD           IGDS38
     C*
     C**  Move program name into *LDA field.
     C                     MOVEL'MM0075'  DBPGM
     C*
     C**  Call subroutine to access ICD file for MIDAS run date.
     C******               EXSR ZA0150                                    S01194
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
     C           @RTCD     IFNE *BLANK                     B1             S01194
     C                     MOVEL'SDBANKPD'DBFILE           ************   S01194
     C                     MOVEL'900'     DBASE            * DBERR 900*   S01194
     C                     MOVEL@OPTN     DBKEY            ************   S01194
     C****Check for data base error.                                      S01194
     C*****      *IN80     IFEQ '1'                        B1             S01194
     C                     MOVE '1'       *INU7            *1
     C                     MOVE '1'       *INU8            *1
     C                     DUMP                            *1             S01194
     C                     GOTO #A9                        *1
     C                     END                             E1
     C*                                                                   S01194
     C** Move run date into RUNA to split into data structure fields      S01194
     C*****                MOVELBJDNWD    RUNA                     S01194 S01279
     C                     MOVELBJMRDT    RUNA                            S01279
     C/COPY WNCPYSRC,MM0075C003
     C*
     C** Access file containing month shortnames
     C           1         CHAINFDMNTHLL             60
     C*
     C* Record not found database error
     C           *IN60     IFEQ '1'                        B1
     C           MNRCID    ORNE 'MN'                       *1        ***********
     C                     MOVE '001'     DBASE            *1                  *
     C                     MOVE 'FDMNTHLL'DBFILE           *1         001      *
     C                     MOVE *BLANKS   DBKEY            *1                  *
     C                     MOVE '1'       *INU7            *1        ***********
     C                     MOVE '1'       *INU8            *1
     C                     GOTO #A9                        *1
     C                     END                             E1
     C*
     C** Move RUNA to Data Structure
     C                     MOVE RUNA      @UPDT
     C*
     C** LOCK MPHAS DATA AREA
     C*
     C** Convert run date into 8,0 field so that comparison can be made
     C** with dates on file.
     C                     Z-ADD1         @A      30
     C           HVMLUP    LOKUP@MN,@A                   60
     C           @A        MULT 100       @RUNDT  80
     C           @RUNDT    ADD  HVDLUP    @RUNDT
     C*
     C** Check whether century 19 or 20
     C*****      RUND      IFGE 10228                      B1             S01194
     C           BJRDNB    IFGE 10228                      B1             S01194
     C           HVYLUP    MULT 10000     @WRK    80       *1
     C                     ADD  20000000  @WRK             *1
     C                     ELSE                            X1
     C           HVYLUP    MULT 10000     @WRK    80       *1
     C                     ADD  19000000  @WRK             *1
     C                     END                             E1
     C           @RUNDT    ADD  @WRK      @RUNDT
     C*
     C** DEFN WORK FIELDS WITH SAME ATTRIBUTES
     C           *LIKE     DEFN IKAMNP    @@AMT
     C           *LIKE     DEFN IKINTR    @@RATE
     C           *LIKE     DEFN HVNSFV    @NSFV                           S01149
     C           *LIKE     DEFN IKRBSI    CCRBSI                          S01149
     C*
     C** NEW FIELDS
     C           *LIKE     DEFN IKCCY     CCCCY
     C           *LIKE     DEFN IKTYPE    CCTYPE
     C           *LIKE     DEFN IKAMNP    CCAMNP
     C           *LIKE     DEFN IKINTR    CCINTR
     C           *LIKE     DEFN IKICMT    CCICMT
     C           *LIKE     DEFN IKDORM    CCDORM
     C           *LIKE     DEFN IKDOPM    CCDOPM
     C           *LIKE     DEFN IKDVSD    CCDVSD
     C           *LIKE     DEFN IHDCRT    CCDCRT                          S01279
     C           *LIKE     DEFN IHMTYP    CCMTYP                          S01279
     C*
     C** BEFORE UPDATE FIELDS
     C           *LIKE     DEFN IKBAMT    CCBAMT
     C           *LIKE     DEFN IKBIRT    CCBIRT
     C           *LIKE     DEFN IKBICM    CCBICM
     C           *LIKE     DEFN IKMACT    CCLACT
     C           *LIKE     DEFN IKDN38    CCDA38
     C           *LIKE     DEFN IKBORM    CCBORM
     C           *LIKE     DEFN IKBOPM    CCBOPM
     C           *LIKE     DEFN IKBVDT    CCBVDT
     C************LIKE*****DEFN IGOGDT    CCOGDT                          E20679
     C*
     C**  OUTPUT FIELDS                                                   S01149
     C           *LIKE     DEFN HSDNMT    @NETMV                          S01149
     C           *LIKE     DEFN HSDNMT    @NTHMV                          S01149
     C*
     C                     MOVE *BLANK    CDL033  1                                           CDL033
     C                     CALL 'AOSARDR0'                                                    CDL033
     C                     PARM *BLANKS   @RTCD                                               CDL033
     C                     PARM '*VERIFY' @OPTN                                               CDL033
     C                     PARM 'CDL033'  PSARD   6                                           CDL033
     C           SCSARD    PARM SCSARD    DSFDY                                               CDL033
      *                                                                                       CDL033
     C           @RTCD     IFEQ *BLANKS                                                       CDL033
     C                     MOVE 'Y'       CDL033                                              CDL033
     C                     ELSE                                                               CDL033
     C           @RTCD     IFNE '*NRF   '                                                     CDL033
     C                     MOVE '908'     DBASE                                               CDL033
     C                     MOVEL'CDL033  'DBKEY                                               CDL033
     C                     MOVEL'SCSARDPD'DBFILE                                              CDL033
     C                     EXSR *PSSR                                                         CDL033
     C                     ENDIF                                                              CDL033
     C                     ENDIF                                                              CDL033
      *                                                                                       CDL033
      ** Retrieve system value setting                                                      MD035545
      *                                                                                     MD035545
     C                     MOVELWPARML    P@OP01                                            MD035545
     C                     CALL 'AOSVALR0'                                                  MD035545
     C                     PARM *BLANKS   W0RTCD  7                                         MD035545
     C                     PARM           P@OP01 20                                         MD035545
     C                     PARM           P@VL01200                                         MD035545
     C                     PARM           P@OP02 20                                         MD035545
     C                     PARM           P@VL02200                                         MD035545
     C                     PARM           P@OP03 20                                         MD035545
     C                     PARM           P@VL03200                                         MD035545
     C                     PARM           P@OP04 20                                         MD035545
     C                     PARM           P@VL04200                                         MD035545
     C                     PARM           P@OP05 20                                         MD035545
     C                     PARM           P@VL05200                                         MD035545
     C                     PARM           P@OP06 20                                         MD035545
     C                     PARM           P@VL06200                                         MD035545
     C                     PARM           P@OP07 20                                         MD035545
     C                     PARM           P@VL07200                                         MD035545
     C                     PARM           P@OP08 20                                         MD035545
     C                     PARM           P@VL08200                                         MD035545
     C                     PARM           P@OP09 20                                         MD035545
     C                     PARM           P@VL09200                                         MD035545
     C                     PARM           P@OP10 20                                         MD035545
     C                     PARM           P@VL10200                                         MD035545
      *                                                                                     MD035545
      ** If system value is not found then default value to 'N'                             MD035545
      *                                                                                     MD035545
     C           W0RTCD    IFNE '       '                                                   MD035545
     C                     MOVE 'N'       WCALC6                                            MD035545
     C                     ELSE                                                             MD035545
     C                     MOVELP@VL01    WCALC6                                            MD035545
     C********** WCALC6    IFEQ 'Y'                                                MD035545 MD047993
     C********** BKALDI    ANDEQ'Y'                                                MD035545 MD047993
     C**********           MOVE 'Y'       WCALC6                                   MD035545 MD047993
     C**********           ELSE                                                    MD035545 MD047993
     C**********           MOVE 'N'       WCALC6                                   MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
     C                     ENDIF                                                            MD035545
      *                                                                                     MD035545
     C           #A9       ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BC      - Move details PF/MMSTDLPP to common fields          *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  #B     - Determine which files to be updated       *
     C*                                                               *
     C* FLDS USED         - @NALD - N/A OR L/D INDICATOR (USED IN BBI)*   S01149
     C*                                                               *
     C*****************************************************************
     C           #BC       BEGSR
     C** MMSTDLP0
     C*                                                                   S01149
     C** SET INDICATOR FOR L/D                                            S01149
     C                     MOVE 'L'       @NALD   1                       S01149
     C*                                                                   S01149
     C                     MOVE IKCCY     CCCCY
     C                     Z-ADDIKDVSD    CCDVSD
     C                     MOVE IKTYPE    CCTYPE
     C                     Z-ADDIKAMNP    CCAMNP
     C                     Z-ADDIKINTR    CCINTR
     C                     Z-ADDIKNIYY    CCNIYY
     C                     Z-ADDIKNIMM    CCNIMM
     C                     Z-ADDIKNIDD    CCNIDD
     C                     MOVE IKICMT    CCICMT
     C                     Z-ADDIKMDYY    CCMDYY
     C                     Z-ADDIKMDMM    CCMDMM
     C                     Z-ADDIKMDDD    CCMDDD
     C                     Z-ADDIKDN38    CCDA38
     C                     MOVE IKDORM    CCDORM
     C                     MOVE IKDOPM    CCDOPM
     C                     Z-ADDIKVDYY    CCVDYY                          S01149
     C                     Z-ADDIKVDMM    CCVDMM                          S01149
     C                     Z-ADDIKVDDD    CCVDDD                          S01149
     C*
     C** BEFORE UPDATE FIELDS
     C                     Z-ADDIKBAMT    CCBAMT
     C                     Z-ADDIKBIRT    CCBIRT
     C                     MOVE IKBICM    CCBICM
     C                     Z-ADDIKBLID    CCBLID
     C                     Z-ADDIKBVDT    CCBVDT
     C                     Z-ADDIKBORM    CCBORM
     C                     Z-ADDIKBOPM    CCBOPM
     C                     MOVE IKLACT    CCLACT
     C*
     C           #BC9      ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BD      - Move details PF/MMSTDSPP to common fields          *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  #B     - Determine which files to be updated       *
     C*                                                               *
     C* FLDS USED         - @NALD - N/A OR L/D INDICATOR              *   S01149
     C*                                                               *
     C*****************************************************************
     C           #BD       BEGSR
     C** MMSTDSP0
     C*                                                                   S01149
     C** SET INDICATOR FOR N/A                                            S01149
     C                     MOVE 'N'       @NALD                           S01149
     C*                                                                   S01149
     C                     MOVE ILCCY     CCCCY
     C                     Z-ADDILDVSD    CCDVSD
     C                     MOVE ILTYPE    CCTYPE
     C                     Z-ADDILAMNP    CCAMNP
     C                     Z-ADDILINTR    CCINTR
     C                     Z-ADDILNIYY    CCNIYY
     C                     Z-ADDILNIMM    CCNIMM
     C                     Z-ADDILNIDD    CCNIDD
     C                     MOVE ILICMT    CCICMT
     C                     Z-ADDILMDYY    CCMDYY
     C                     Z-ADDILMDMM    CCMDMM
     C                     Z-ADDILMDDD    CCMDDD
     C                     Z-ADDILDN38    CCDA38
     C                     MOVE ILDORM    CCDORM
     C                     Z-ADDILDTYY    CCDTYY                          ME1350
     C                     Z-ADDILDTMM    CCDTMM                          ME1350
     C                     Z-ADDILDTDD    CCDTDD                          ME1350
     C                     Z-ADDILVDYY    CCVDYY                          S01149
     C                     Z-ADDILVDMM    CCVDMM                          S01149
     C                     Z-ADDILVDDD    CCVDDD                          S01149
     C                     Z-ADDILRYLD    CCDCRT                          S01279
     C*
     C*
     C** BEFORE UPDATE FIELDS
     C                     Z-ADDILBAMT    CCBAMT
     C                     Z-ADDILBIRT    CCBIRT
     C                     MOVE ILBICM    CCBICM
     C                     Z-ADDILBLID    CCBLID
     C                     Z-ADDILBVDT    CCBVDT
     C                     Z-ADDILBORM    CCBORM
     C                     Z-ADDILBOPM    CCBOPM
     C                     MOVE ILLACT    CCLACT
     C*
     C           #BD9      ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BE      - Move details PF/MMSTDAPP to common fields          *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  #B     - Determine which files to be updated       *
     C*                                                               *
     C* FLDS USED         - @NALD   -  N/A OR L/D INDICATOR           *   S01149
     C*                     @ANYNA  -  ARRAY OF ALL N/A DEAL TYPES    *   S01149
     C*                                                               *
     C*****************************************************************
     C           #BE       BEGSR
     C** MMSTDAP0
     C*                                                                   S01149
     C** SET L/D N/A INDICATOR BY CHECKING ORIGINAL DEAL TYPE AGAINST     S01149
     C** ARRAY OF ALL N/A DEAL TYPES                                      S01149
     C           IGOGDT    LOKUP@ANYNA,1                 60               S01149
     C           *IN60     IFEQ '1'                        B1             S01149
     C                     MOVE 'N'       @NALD            *1             S01149
     C                     ELSE                            *1             S01149
     C                     MOVE 'L'       @NALD            *1             S01149
     C                     END                             E1             S01149
     C*                                                                   S01149
     C                     MOVE IGCCY     CCCCY
     C                     Z-ADDIGDVSD    CCDVSD
     C                     MOVE IGTYPE    CCTYPE
     C                     Z-ADDIGAMNP    CCAMNP
     C                     Z-ADDIGINTR    CCINTR
     C                     Z-ADDIGDA38    CCDA38
     C                     MOVE IGDORM    CCDORM
     C                     MOVE IGDOPM    CCDOPM
     C                     Z-ADDIGVDYY    CCVDYY                          S01149
     C                     Z-ADDIGVDMM    CCVDMM                          S01149
     C                     Z-ADDIGVDDD    CCVDDD                          S01149
     C*
     C** BEFORE UPDATE FIELDS
     C                     Z-ADDIGBAMT    CCBAMT
     C                     Z-ADDIGBIRT    CCBIRT
     C                     Z-ADDIGBORM    CCBORM
     C                     Z-ADDIGBOPM    CCBOPM
     C                     Z-ADDIGBVDT    CCBVDT
     C                     MOVE IGLACT    CCLACT
     C*
     C           #BE9      ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BF      - Move details PF/MMSTDBPP to common fields          *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  #B     - Determine which files to be updated       *
     C*                                                               *
     C* FLDS USED         - @NALD  -  N/A OR L/D INDICATOR            *   S01149
     C*                                                               *
     C*****************************************************************
     C           #BF       BEGSR
     C**MMSTDBP0
     C*                                                                   S01149
     C** SET INDICATOR FOR N/A                                            S01149
     C                     MOVE 'N'       @NALD                           S01149
     C*                                                                   S01149
     C                     MOVE IHRBSI    CCRBSI                          S01149
     C                     MOVE IHCCY     CCCCY
     C                     Z-ADDIHDVSD    CCDVSD
     C                     MOVE IHTYPE    CCTYPE
     C                     Z-ADDIHAMNP    CCAMNP
     C                     Z-ADDIHINTR    CCINTR
     C                     Z-ADDIHNIYY    CCNIYY
     C                     Z-ADDIHNIMM    CCNIMM
     C                     Z-ADDIHNIDD    CCNIDD
     C                     MOVE IHICMT    CCICMT
     C                     Z-ADDIHMDYY    CCMDYY
     C                     Z-ADDIHMDMM    CCMDMM
     C                     Z-ADDIHMDDD    CCMDDD
     C                     Z-ADDIHDN38    CCDA38
     C                     MOVE IHDORM    CCDORM
     C                     MOVE IHDOPM    CCDOPM
     C                     Z-ADDIHDTYY    CCDTYY                          ME1350
     C                     Z-ADDIHDTMM    CCDTMM                          ME1350
     C                     Z-ADDIHDTDD    CCDTDD                          ME1350
     C                     Z-ADDIHVDYY    CCVDYY                          S01149
     C                     Z-ADDIHVDMM    CCVDMM                          S01149
     C                     Z-ADDIHVDDD    CCVDDD                          S01149
     C                     Z-ADDIHDCRT    CCDCRT                          S01279
     C                     MOVE IHMTYP    CCMTYP                          S01279
     C*
     C** BEFORE UPDATE FIELDS
     C                     Z-ADDIHBAMT    CCBAMT
     C                     Z-ADDIHBIRT    CCBIRT
     C                     MOVE IHBICM    CCBICM
     C                     Z-ADDIHBLID    CCBLID
     C                     Z-ADDIHBVDT    CCBVDT
     C                     Z-ADDIHBORM    CCBORM
     C                     Z-ADDIHBOPM    CCBOPM
     C                     MOVE IHLACT    CCLACT
     C*
     C           #BF9      ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #C       - Termination processing                             *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  MAIN   - Main controlling routine.                 *
     C*                                                               *
     C* FLDS USED  @TERM  - Termination parameter                     *
     C*                                                               *
     C*****************************************************************
     C           #C        BEGSR
     C*
     C** If termination parameter is 'T' or database error set on LR
     C** before returning control to calling program.
     C           *INU7     IFEQ '1'                        B1
     C                     MOVE 'E'       @TERM            *1
     C                     MOVE '1'       *INLR            *1
     C                     END                             E1
     C*
     C           @TERM     IFEQ 'T'                        B1
     C                     MOVE '1'       *INLR            *1
     C                     END                             E1
     C*
     C                     RETRN
     C*
     C           #C9       ENDSR
     C/COPY ZSRSRC,ZFEB29                                                                     CDL093
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*****                                                           *   S01194
     C*****   SUBROUTINE ZA0150 - THIS SUBROUTINE CHAINS TO FILE LF/  *   S01194
     C*****   FDICDRLL TO GET THE INSTALLATION CONTROL DETAILS RECORD *   S01194
     C*****   1 (HELD ON PF/TABTB10)                                  *   S01194
     C*****   INDICATOR 80 IS SET ON IF THE CHAIN FAILS OR THE RECORD *   S01194
     C*****   IS FLAGGED FOR DELETION.                                *   S01194
     C*****   IF INDICATOR 80 IS SET ON DETAILS OF THE ATTEMPTED      *   S01194
     C*****   ACCESS ARE PLACED IN THE LDA.                           *   S01194
     C*****                                                           *   S01194
     C*****   FIELDS USED : SS0150 - KEY USED TO ACCESS FDICDRLL      *   S01194
     C*****                                                           *   S01194
     C*****************************************************************   S01194
     C*****                                                               S01194
     C*****      ZA0150    BEGSR                                          S01194
     C*****                                                               S01194
     C***SET*UP KEY TO OBTAIN FORMAT TABTB10F '01        10'              S01194
     C*****                MOVEL'01'      SS0150 12                       S01194
     C*****                MOVE '10'      SS0150                          S01194
     C*****                                                               S01194
     C*****AIN TO FILE FDICDRLL                                           S01194
     C*****      SS0150    CHAINFDICDRLL             80                   S01194
     C*****      RECI      IFNE 'D'                        B1             S01194
     C*****                MOVE '1'       *IN80            *1             S01194
     C*****                END                             E1             S01194
     C*****                                                               S01194
     C***DEAL WITH DATA BASE ERROR                                        S01194
     C*****      *IN80     IFEQ '1'                        B1        *****S01194
     C*****                MOVEL'FDICDRLL'DBFILE           *1            *S01194
     C*****                MOVEL'900'     DBASE            *1        900 *S01194
     C*****                MOVELSS0150    DBKEY            *1            *S01194
     C*****                END                             E1        *****S01194
     C*****                                                               S01194
     C*****      ZA0159    ENDSR                                          S01194
     C*****************************************************************   S01194
     C*EJECT**                                                            S01194
     C*                                                                   056095
     C/COPY ZSRSRC,ZDAT10Z2                                               056095
     C******************************************************************* S01194
     C***********                                                         056095
     C**ZA0680*-*THIS SUBROUTINE CONVERTS YYYYMMDD FORMAT DATE TO         056095
     C***********MIDAS DAY NUMBER FORMAT (NO. DAYS FROM 31/12/71)         056095
     C***********                                                         056095
     C**CALLED*BY :                                                       056095
     C***********                                                         056095
     C**CALLS*:**                                                         056095
     C***********                                                         056095
     C**INPUT**:*@@DTIN DATE (YYYYMMDD) - IN DATA STRUCTURE (SIZE : 8N)   056095
     C***********                                                         056095
     C**OUTPUT*:*@@MDNO MIDAS DAY NUMBER  (SIZE : 5N)                     056095
     C***********                                                         056095
     C**USES*:***@@CC   NUMBER OF CENTURIES IN DATE                       056095
     C***********@@DAY  DAY NUMBER                                        056095
     C***********@@REM  REMAINDER FROM DIVIDE                             056095
     C***********@@MTH  MONTH NUMBER                                      056095
     C***********@MD    COMPILATION TIME ARRAY FOR CUMULATIVE DAYS IN     056095
     C***********       MONTH                                             056095
     C***********@@WK2  WORK FIELD (2,0)                                  056095
     C***********@@WK5  WORK FIELD (5,0)                                  056095
     C***********@@YYYY YEAR (4 CHARACTER)                                056095
     C***********@@YY   YEAR (2 CHARACTER)                                056095
     C***********@YD    COMPILATION TIME ARRAY FOR CUMULATIVE DAYS IN     056095
     C***********       A FOUR YEAR PERIOD                                056095
     C***********                                                         056095
     C******LAST*AMEND NO. ME1257              DATE 02/04/87            * 056095
     C******When*date input is zero set output date to zeroes           * 056095
     C***********                                                         056095
     C******************************************************************* 056095
     C***********                                                         056095
     C***********ZA0680    BEGSR                                          056095
     C***********                                                         056095
     C****CLEAR*OUT ANY 'OLD' DATA IN FIELD                               056095
     C***********          Z-ADD0         @@MDNO  50                      056095
     C***********                                                         056095
     C***********@@DTIN    CABEQ0         ZA0689                    ME1257056095
     C***********                                                         056095
     C*****IF*DATE GREATER THAN 31/12/2071 NEED EXTRA PROCESSING          056095
     C*****WORK*OUT THE NUMBER OF CENTURIES PASSED SINCE 1971,            056095
     C*****BY*SUBTRACTING 1972 FROM THE YEAR FIELD.                       056095
     C***********@@YYYY    IFGE 2072                       B1             056095
     C***********@@YYYY    SUB  1972      @@YYYY           *1             056095
     C***********                                                         056095
     C*****MULTIPLY BY NUMBER OF DAYS IN CENTURY (SINCE 1971)             056095
     C*****THEN*RESTORE THE YEAR WHICH WAS INPUT BACK TO THE              056095
     C*****ORIGINAL VALUE BEFORE CONTINUING WITH NORMAL CALCULATIONS.     056095
     C***********                                                         056095
     C***********@@CC      MULT 36524     @@MDNO           *1             056095
     C***********@@YYYY    ADD  1972      @@YYYY           *1             056095
     C***********          END                             E1             056095
     C***********                                                         056095
     C***********@@YYYY    ADD  28        @@WK2   20                      056095
     C***********                                                         056095
     C***********@@WK2     DIV  4         @@WK2                           056095
     C***********          MVR            @@REM   10                      056095
     C***********                                                         056095
     C******MULTIPLY BY NUMBER OF DAYS IN FOUR YEAR PERIOD                056095
     C***********@@WK2     MULT 1461      @@WK5   50                      056095
     C***********          ADD  @@WK5     @@MDNO                          056095
     C***********                                                         056095
     C****CHECK*REMAINDER AND MONTH NUMBER                                056095
     C***********@@REM     IFEQ 0                          B1             056095
     C***********@@MTH     ANDGT2                          *1             056095
     C***********          ADD  1         @@MDNO           *1             056095
     C***********          END                             E1             056095
     C***********                                                         056095
     C****YEAR*NOT LEAP YEAR,  ADD CUMULATIVE DAYS FOR YEAR               056095
     C***********@@REM     IFNE 0                          B1             056095
     C***********          ADD  @YD,@@REM @@MDNO           *1             056095
     C***********          END                             E1             056095
     C***********                                                         056095
     C****ADD*MONTHS THIS YEAR                                            056095
     C***********          ADD  @MD,@@MTH @@MDNO                          056095
     C***********                                                         056095
     C****ADD*DAYS THIS MONTH                                             056095
     C***********          ADD  @@DAY     @@MDNO                          056095
     C***********                                                         056095
     C***********ZA0689    ENDSR                                     AG** 056095
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* *PSSR    - Error routine performed on program error           *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY         -                                           *
     C*                                                               *
     C* FLDS USED  @ERR1  - Error field 1                             *
     C*            @TERM  - Termination parameter                     *
     C*                                                               *
     C*****************************************************************
     C           *PSSR     BEGSR
     C*
     C** SET @ERR1 TO 'Y' TO PREVENT LOOPING IF FURTHER ERRORS
     C           @ERR1     IFNE 'Y'                        B1
     C                     MOVE 'Y'       @ERR1   1        *1
     C                     MOVE '1'       *INU6            *1
     C*
     C** SET UP FIELDS IN LOCAL DATA AREA
     C**********           MOVEL'FX0390'  DBPGM            *1             S01149
     C                     MOVEL'MM0075'  DBPGM            *1             S01149
     C                     MOVEL'991'     DBASE            *1
     C*
     C                     DUMP                            *1
     C                     END                             E1
     C*
     C** TERMINATE THE PROGRAM
     C                     MOVE 'E'       @TERM
     C                     MOVE '1'       *INLR
     C                     RETRN
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* INFSR    - Error routine performed on file error              *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY         -                                           *
     C*                                                               *
     C* FLDS USED  @ERR2  - Error field 2                             *
     C*            @FILE  - File in which file error occurred         *
     C*            @TERM  - Termination parameter                     *
     C*                                                               *
     C*****************************************************************
     C           INFSR     BEGSR
     C*
     C** SET @ERR1 TO 'Y' TO PREVENT LOOPING IF FURTHER ERRORS
     C           @ERR2     IFNE 'Y'                        B1
     C                     MOVE 'Y'       @ERR2   1        *1
     C                     MOVE '1'       *INU7            *1
     C                     MOVE '1'       *INU8            *1
     C*
     C** SET UP FIELDS IN LOCAL DATA AREA
     C                     MOVE @FILE     DBFILE           *1
     C                     MOVEL'MM0075'  DBPGM            *1
     C                     MOVE '992'     DBASE            *1
     C*
     C                     DUMP                            *1
     C                     END                             E1
     C*
     C** TERMINATE THE PROGRAM
     C                     MOVE '1'       *INLR
     C                     MOVE 'E'       @TERM
     C                     RETRN
     C*
     C                     ENDSR
     O/EJECT
      *************                                                       S01279
      * S01279 - ADDED DISCOUNTED BILLS, DEAL TYPE BI, TO ARRAY @BILLS    S01279
      *          SO IT IS PROCESSED AS A DISCOUNTED NA                    S01279
      *************                                                       S01279
      *****************************************************************   056095
      *   The array @YD and @MD are now being used by SR. ZDATE9      *   056095
      *   before they are being used by SR. ZA0680.  The actual       *   056095
      *   changes were only made on the text, ZA0680 was changed      *   056095
      *   to ZDATE9.                                                  *   056095
      *****************************************************************   056095
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
** DEAL TYPES ARRAY @NA - Loans
IPTLCPCLDL
** @ANYNA DEAL TYPE ARRAY  - all N/A deal types                           S01149
C1C2BOBITBBATA                                                            S01149
** @BILLS DEAL TYPE ARRAY  - all N/A non interst bearing deal types       S01149
TBBATABI                                                           S01149 S01279
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
** @MR MIDAS settlement method
0001020304050607081214
** @DR DRS settlement method
NA   TELX CSENTCOMP PCURRMACC SUSP CHIPSSWIFTCCOLLCURR
