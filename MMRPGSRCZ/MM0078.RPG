     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas MM Update MM database')                          *
     F*****************************************************************
     F*                                                               *
     F*  Midas - MM Dealer Module                                     *
     F*                                                               *
     F*     This program will be made redundant at DBA R4.00          *
     F*     In the interim please check the new ILE RPG versions      *
     F*     and apply any new fixes if they are appropriate.          *
     F*                                                               *
     F*  MM0078 - UPDATE MM DATABASE                                  *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. CER050             Date 16Jun19               *
      *  Prev Amend No. MD053295           Date 13Apr19               *
      *                 MD046248           Date 27Oct17               *
      *                 CDL099             Date 06Oct17               *
      *                 MD047993           Date 23Sep17               *
      *                 MD035545           Date 11Sep15               *      
      *                 CGL165             Date 17Feb15               *
      *                 CDL096             Date 22Sep14               *
      *                 MD026189           Date 19Aug14               *
      *                 AR996895           Date 25Nov12               *
      *                 CRE073             Date 06Dec10               *
      *                 263666             Date 01Feb10               *
      *                 CER059             Date 19Jul10               *
      *                 CER054             Date 07Apr09               *
      *                 CER016A            Date 19May08               *
      *                 CER048             Date 19May08               *
      *                 CER020             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CDL081             Date 14Dec09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 246141             Date 26Mar07               *
      *                 164847             Date 30Nov06               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242286             Date 25Sep06               *
      *                 CSD031             Date 10Apr06               *
      *                 CDL013             Date 08Jun06               *
      *                 CDL049             Date 11Jul06               *
      *                 CSD027             Date 09Dec05               *
      *                 CIR013             Date 25Apr05               *
      *                 CDL038             Date 10May05               *
      *                 CSW037A            Date 02May05               *
      *                 CDL028             Date 07Feb05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CDL022             Date 03Feb04               *
      *                 CDL020             Date 03Feb04               *
      *                 CDL019             Date 03Feb04               *
      *                 CDL018             Date 03Feb04               *
      *                 CDL017             Date 03Feb04               *
      *                 CDL016             Date 03Feb04               *
      *                 CGL029             Date 01Sep03               *
      *                 222727             Date 05Nov03               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      *                 CDL010             Date 02Aug02               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 187861             Date 19Feb01               *
      *                 184828             DATE 08Dec00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CIR004             Date 20Jan00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 163136             Date 07Jul99               *
      *                 145001             Date 20Oct98               *
     F*                 CEU015             Date 19Jun98               *
     F*                 114913             Date 09Jun98               *
     F*                 128913             Date 19May98               *
     F*                 CAP002             Date 01May98               *
     F*                 CEU003             Date 15Jan98               *
      *                 109994             DATE 28JAN98               *
      *                 126447             DATE 01DEC97               *
      *                 126017             DATE 18Nov97               *
     F*                 103949             DATE 24FEB97               *
     F*                 097885             DATE 03FEB97               *
     F*                 S01408             DATE 16OCT96               *
     F*                 CAC001             DATE 01FEB96               *
     F*                 S01408             DATE 06FEB96               *
     F*                 076556             DATE 22NOV95               *
     F*                 095244             DATE 01NOV95               *
     F*                 095238             DATE 31OCT95               *
     F*                 S01408             DATE 15SEP95               *
     F*                 S01408             DATE 05SEP95               *
     F*                 S01408             DATE 04AUG95               *
     F*                 082738             DATE 01FEB95               *
     F*                 S01408             DATE 21APR95               *
     F*                 083409             DATE 15MAR95               *
     F*                 082430             DATE 06MAR95               *
     F*                 S01486             DATE 28OCT94               *
     F*                 065930             DATE 29MAR94               *
     F*                 062467             DATE 18FEB94               *
     F*                 056211             DATE 01FEB94               *
     F*                 S01453             DATE 14DEC93               *
     F*                 056121             DATE 04NOV93               *
     F*                 059594             DATE 03NOV93               *
     F*                 061426             DATE 30SEP93               *
     F*                 S01434             DATE 20AUG93               *
     F*                 056095             DATE 07JUN93               *
     F*                 052721             DATE 01APR93               *
     F*                 E49965             DATE 01FEB93               *
     F*                 E47225             DATE 01FEB93               *
     F*                 S01378             DATE 09APR92               *
     F*                 S01392             DATE 20JUL92               *
     F*                 AUS003             DATE 30JUN92               *
     F*                 S01383             DATE 27APR92               *
     F*                 E36306             DATE 20FEB92               *
     F*                 E36024             DATE 17FEB92               *
     F*                 S01354             DATE 10JAN92               *
     F*                 E28286             DATE 06SEP91               *
     F*                 BH1115             DATE 28AUG91               *
     F*                 S01319             DATE 08AUG91               *
     F*                 E21832             DATE 17JUL91               *
     F*                 RT0150             DATE 12JUN91               *
     F*                 S01279             DATE 07NOV90               *
     F*                 BHF901             DATE 24OCT90               *
     F*                 BHF860             DATE 19OCT90               *
     F*                 DT0041             DATE 28MAR91               *
     F*                 DT0008             DATE 20MAR91               *
     F*                 DT0015             DATE 20MAR91               *
     F*                 E22150             DATE 29JUN90               *
     F*                 S01314             DATE 16JAN91               *
     F*                 E20611             DATE 15FEB90               *
     F*                 E13838             DATE 26JAN90               *
     F*                 BHF477             DATE 29AUG90               *
     F*                 BHF410             DATE 19AUG90               *
     F*                 E22405             DATE 16AUG90               *
     F*                 LN0625             DATE 14AUG90               *
     F*                 BHF307             DATE 09AUG90               *
     F*                 E281               DATE 4APR90                *
     F*                 E121               DATE 20MAR90               *
     F*                 S01227             DATE 16NOV89               *
     F*                 E234               DATE 13FEB90               *
     F*                 E140               DATE 04DEC89               *
     F*                 E136               DATE 01DEC89               *
     F*                 E12                DATE 21NOV89               *
     F*                 E80                DATE 20NOV89               *
     F*                 E67                DATE 17NOV89               *
     F*                 S01194             DATE 05/09/89              *
     F*                 S01177             DATE 20/06/89              *
     F*                 S01117             DATE 20/06/89              *
     F*                 E19013             DATE 18SEP89               *
     F*                 E18417             DATE 15SEP89               *
     F*                 E17938             DATE 24AUG89               *
     F*                 S01176             DATE 30/01/89              *
     F*                 E18348             DATE 19JUL89               *
     F*                 E18380             DATE 18/05/89              *
     F*                 E18100             DATE 18/05/89              *
     F*                 E17051             DATE 09/03/89              *
     F*                 E16695             DATE 28/02/89              *
     F*                 E16413             DATE 10/02/89              *
     F*                 E16147             DATE 24/01/89              *
     F*                 E16247             DATE 13/13/88              *
     F*                 E14412             DATE 08/08/88              *
     F*                 E14377             DATE 02/08/88              *
     F*                 E14177             DATE 20/07/88              *
     F*                 E13173             DATE 03/05/88              *
     F*                 E12945             DATE 03/05/88              *
     F*                 E13034             DATE 26/04/88              *
     F*                 E12909             DATE 19/04/88              *
     F*                 E12306             DATE 18/03/88              *
     F*                 E12279             DATE 01/03/88              *
     F*                 S01154             DATE 10/10/88              *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
      *  CER050 - Annualised Percentage Rate (Recompile)              *
      *  MD053295 - Lending loan with Interest Calculation Basis      *
      *             method 3 (30/360) has wrong interest payment      *
      *             amount for month of March (Recompile)             *
      *  MD046248 - Finastra Rebranding                               *
      *  CDL099 - Split Value Date (Recompile)                        *
      *  MD047993 - Modified MD035545. Removed dependency on Accrue   *
      *             on Last Day indicator.                            *
      *  MD035545 - LE: Interest Calculation in Leap year. Consider   *
      *             Accrue on Last Day Indicator for method 6.        *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  MD026189 - Maturity Date is not change after entering the    *
      *             EM transaction                                    *
      *  AR996895 - Incorrect accrual interest calculation            *
      *             (Child:AR996897) (Recompile)                      *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER054 - German Features - Church Tax (Recompile)            *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *           to Midas Plus                                       *
      *  CER048 - German Features - Taxes (Recompile)                 *
      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
      *           Midas Plus (Recompile)                              *
      *  CDL081 - Tiered withholding tax rounding upgrade             *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CDL013 - Tiered Withholding Tax                              *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over ZINTDY.                              *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines                                        *
      *  CDL022 - Deal Amendment Changes (Recompile)                  *
      *  CDL020 - Apply Base Rate at Value Date (Recompile)           *
      *  CDL019 - Allow Base Rate Changes on Fixed Deposits/Loans     *
      *           (Recompile)                                         *
      *  CDL018 - Multiple Settlement Accounts on Loans/Deposits      *
      *           (Recompile)                                         *
      *  CDL017 - Penalty Fee & Early Maturity of Fixed Term Loan/Dep *
      *           (Recompile)                                         *
      *  CDL016 - Automatic rollover of Fixed Term Loans/Deposits     *
      *           (Recompile)                                         *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222727 - Release 5.0 errors  (Recompile)                     *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *           (Recompile)                                         *
     F*  CDL010 - Prevent last user that actioned the trade from      *
     F*           authorising it.Recompile due to changes in MMDEAMPP *
     F*           , MMDELDPP, MMDENBPP AND MMDENSPP.                  *
      *  187861 - Fields HLDDND and HLDVSD are not being updated in   *
      *           Negotiable Assets maintenance. Included fields deal *
      *           value/start date and deal done date in the update   *
      *           of all front office files.                          *
     F*  184828 - Initialise packed fields correcttly to avoid        *
     F*           decimal data errors.                                *
      *  CIR004 - Dealing Calculation Method Change                   *
      *         - Recompiled due to ZINTDY changes                    *
     F*  163136 - Interest Calculation Method '6'  showing incorrect -*
     F*           ZERO - amount . Addition to Core #126017 which dealt*
     F*           with the issue. It introduced an additional  INT6DY *
     F*           field in s-routine ZINTDY in  /COPY ZSRSRC/ZINTDYZ2 *
     F*           which in turn is usually called from GLINTC s-routine
     F*           in /COPY  ZSRSRC/ GLINTCZ1 .  However, there are at *
     F*           least a dozen other pgms that use ZINTDY but do     *
     F*           GLINTC-processing within the pgms calculation specs *
     F*  145001 - CEU015 fix: Write new field 'Original Rollover      *
     F*           Amount' (HKORDA) to MMDELDPP for rollover deals.    *
     F*  CEU015 - Amended to write the new field 'Rollover to/from    *
     F*           Currency' to MMDELDPP for rollover deals.           *
     F*  114913 - Database error occurs upon amendment/deletion of    *
     F*           MM deal specifically Neg. Assets due to a change    *
     F*           of BENEFICIARY customer shortname .                 *
     F*  128913 - Problem with SWIFT msgs for Rollover deals/Rolled   *
     F*           over deals. Amended sub-routine #ZA .               *
     F*  CAP002 - Recompiled as part of conversion of Midas inputs to *
     F*           modular API structure.                              *
     F*  CEU003 - EMU Dealing Settlement Ccy conversion.              *
     F*  109994 - If a rollover deal is deleted then reset the        *
     F*           rollover warning indicator on the maturing deal     *
     F*           to ensure it is reported on MM5530 Rollover         *
     F*           Warning report.                                     *
     F*  126447 - No point in issuing database error 037 when the     *
     F*           deal is about to be deleted.                        *
     F*  126017 - Correction to interest calculation for calculation  *
     F*           basis 6 in SR/GLINTC - recompile program.           *
     F*  103949 - Amount field of deal amendment was blanked out if   *
     F*           the deal amendment was 'A'mended after 'I'nsertion  *
     F*           before authorization for SI type.                   *
     F*  097885 - Recompiled for wrong calculation of number of day   *
     F*           interest (ZINTDYZ2).                                *
     F*  S01408 - Addition of Core Hook MM0078CP12                    *
     F*  CAC001 - Profit Centre Accounting Development:               *
     F*           The MM master files will be updated w/ the new      *
     F*           fields required for PCA.                            *
     F*  S01408 - Core hook MM0078CP10 added                          *
     F*           Core hook MM0078CP11 added                          *
     F*  076556 - A/C No for method 04 not set up, caused by SDRETLPD *
     F*           not being accessed because AORETLPD called before   *
     F*           AOMMODR0 so Retail and IoA flags were not set up -  *
     F*           access to SDRETLPD is conditioned on these modules. *
     F*  095244 - Recompiled for Calculation method 3                 *
     F*  095238 - Recompiled for Calculation method 3                 *
     F*  S01408 - Core hook MM0078CCP6 added                          *
     F*           Core hook MM0078CCP7 added                          *
     F*           Core hook MM0078CCP8 added                          *
     F*           Core hook MM0078CCP9 added                          *
     F*  S01408 - Core hook MM0078CCP2 added                          *
     F*         - Core hook MM0078CCP3 added                          *
     F*         - Core hook MM0078CCP4 added                          *
     F*         - Core hook MM0078CCP5 added                          *
     F*  S01408 - Core hook MM0078FFP1 added                          *
     F*         - Core hook MM0078IIP1 added                          *
     F*  082738 - Rewrite of projected account movements.             *
     F*           Also includes CIBC fix UK2419 to correct DEAM type  *
     F*           'SI'(amended fix for new date subroutines ZDATE9 &  *
     F*           ZDAT10 because original fix was for Release 2).     *
     F*  S01408 - Core hook MM0078CDB1 added                          *
     F*         - Core hook MM0078CDBU added                          *
     F*         - Core hook MM0078CEIP added                          *
     F*         - Core hook ME0078CCPG added                          *
     F*         - Core hook ME0078CCP1 added                          *
     F*  083409 - In calculating interest due on the value date of    *
     F*           an 'SI' amendment, system doesn't take into account *
     F*           all other amendments for same or earlier value date.*
     F*           'SI' after a 'PD' amendment results in incorrect    *
     F*           interest due.  Upgrade fix 044837/046466 and apply. *
     F*  082430 - LAST USER UPDATED INCORRECTLY                       *
     F*  S01486 - Portfolio Management Upgrade to Release 10.         *
     F*  065930 - Negotiable Assets Sold - Transaction Failed.        *
     F*           Should use Midas Our Receive Instructions,          *
     F*           HLMORI, to set up field ILRORI.  Same is to         *
     F*           be done for ILROPI.                                 *
     F*  062467 - Store Before Update Receive & Pay Branch values     *
     F*           which will be returned to MM0089 and passed to      *
     F*           MM0082, MM0080 for correct generation of inter-     *
     F*           branch shadow postings in Deal Deletion.            *
     F*  056211 - Database error at 002 because rollover deal no      *
     F*           entered as 000000.  Ignore rollover deal no if equal*
     F*           to zero.                                            *
     F*  S01453 - MARGIN AND FX POSITIONS/POINTS AND BASE CURRENCY    *
     F*           POSITIONS/POINTS ADDED TO FX INPUT (RECOMPILED)     *
     F*  056121 - Increase size of work field to enable correct       *
     F*           calculation of interest on very large amounts.      *
     F*           (Similar to fix 049499 of MM0089 in MRSLIB1005)     *
     F*  059594 - Ensure originating branch is written to file.       *
     F*  061426 - Recompile after ZDATE9 correction                   *
     F*  S01434 - Enhanced Rollover Processing                        *
     F*  056095 - Interest not calculated consistently in MM.         *
     F*           SR. MM1009 was externally defined as ZINTDY,        *
     F*           while SR. ZA0710 and ZA0680 were replaced by        *
     F*           the externally defined standard SR. ZDATE9 and      *
     F*           ZDAT10, respectively.  Seventeen MM programs        *
     F*           were amended.                                       *
     F*  052721 - Adjusted @STDB6 and @STDB7 to follow the sizes      *
     F*              of @NABS6 and @NABS7 respectively.               *
     F*  E49965 - BOOKING BRANCH ADDED TO DEAMSDI/MMDEAMPP            *
     F*  047225 - CONDITION CALL TO AORETLR0 ON RETAIL BEING          *
     F*           PRESENT. ALSO ONLY CALL ACCESS PROGRAMS WITH        *
     F*           '*DBERR' IF THEY ARE ACCESSING ICDR                 *
     F*  S01378 - Facilitates the partial sale of a parcel            *
     F*           of negotiable instruments which have been           *
     F*           previously input to the system as a single          *
     F*           transaction (was MOF53). Update the 'new'           *
     F*           deals files for NA's bought and sold.               *
     F*  S01392 - JAP.SUB-MODULE INCORPORATION (CORE)                 *
     F*  AUS003 - Australian Release - Interest to Calendar Month End.*
     F*  S01383 - BASIC RATE TAX INCORPORATION                        *
     H*  E36306 - Program loops when looking for a valid              *
     H*           Payment date. ie on a working day                   *
     H*  E36024 - Amendments of authorised deals corrupt FWD          *
     H*           Book details.                                       *
     F*  S01354 - Process New Internal Deal types 'IL' & 'ID'         *
     F*  E28286 - ONLY ACCESS AOBRCHPD IF KEY IS NON BLANK            *
     F*  BH1115 - BHF860 INCOMPLETE FOR PAY NOSTRO                    *
     F*  S01319 - Remove redundant processing                         *
     F*  E21832 - Prevent fields OSDA and OMDA being blank when       *
     F*           deal is written to DEALSDC by MM0081.               *
     F*  RT0150 - RECOMPILE PROGRAM FOR CHANGE IN MMSTDSPP            *
     F*  S01279 - Replace CTC with Average rate on TM Daily           *
     F*           Summary enquiry.                                    *
     F*  BHF901 - E18100 INCORPORATED INCORRECTLY                     *
     F*  BHF860 - GETTING WRONG NOSTRO IF NOT CHAINING BY NOSTRO      *
     F*           NUMBER.                                             *
     F*  DT0041 - Second call to AONOSTR0 will always be              *
     F*           unsuccessful as SDNOSTL6 is keyed on the            *
     F*           Primary Nostro field as well as currency and        *
     F*           nostro shortname.                                   *
     F*  DT0008 - Originating Branch was not being written to         *
     F*           file correctly; this was due to a mismatch          *
     F*           between the MMSTDB data structure (@NABSx           *
     F*           fields) and the @STDB data structure (@STDBx        *
     F*           fields).  The latter was incorrect and was          *
     F*           changed.                                            *
     F*  DT0015 - RECOMPILED                                          *
     F*  E22150 - Do not default MIDAS pay + receive instructions     *
     F*           if they are not blank. Use values inserted by       *
     F*           the back office.                                    *
     F*  S01314 - Release 10 PTF Incorporation amendment: Release     *
     F*           10 has fix BHF410 and Release 2.3 has E20611,       *
     F*           both of which attempt to do the same thing;         *
     F*           they use slightly different mthods, both of         *
     F*           which seem flawed, so the best parts of both of     *
     F*           them have now been applied.                         *
     F*  E20611 - If rolled over deal is no longer on file do not     *
     F*           issue a database error if action is A or X as       *
     F*           deal could have been dropped by deals file purge    *
     F*  E13838 - START/LAST INTEREST DATE SHOULD NOT DEFAULT         *
     F*           TO VALUE DATE FOR LOANS/DEPOSIT IF START/LAST       *
     F*           DATE IS ZERO. ALSO INTEREST ACCRUAL DATE NEED       *
     F*           NOT BE SET FOR INCOMPLETE DEALS.                    *
     F*  BHF477 - EXTRA RECORDS WRITTEN TO RSACMTPD IF AMEND & NO     *
     F*           CHG.. MUST SAVE 'BEFORE SETTLEMENT BRANCHES'.       *
     F*  BHF410 - BHF0032 ALLOWED AMENDMENT OF A DEAL WHICH WAS A     *
     F*           ROLLOVERED DEAL EVEN IF RELATED DEAL WAS DELETED    *
     F*           (EG TO PUT IN SETTLEMENT DETAILS MANY MONTHS AFTER  *
     F*           DEAL WAS STRUCK). UNFORTUNATELY THAT CAUSES DBASE   *
     F*           ERRORS IN MM0078. SO NOW ONLY UPDATE CUSTOMER EXP.  *
     F*           FOR ROLLOVERS IF RELATED DEAL MDAT AND AMOUNT IS    *
     F*           AVAILABLE, IE REL DEAL IS NOT DELETED.(THIS SHOULD  *
     F*           REALLY BE INCLUDED IN RELEASE 2 CORE.)              *
     F*  E22405 - Add new field to Extended Settlements.(Cover        *
     F*           MT202 required).                                    *
     F*  LN0625 - ERROR IN PARM FOR NOSTRO ACCESS OBJECT              *
     F*  E281   - MISMATCH IN INTERNAL DESCRIPTION OF STD DEAL        *
     F*  S01117/E121 - CORRECT BASE RATE PROCESSING, DRS PROCESSING   *
     F*           NOW USES BACK OFFICE MAINT. PGMS SO MUCH            *
     F*           OF THE PROCESSING IS REDUNDANT, E121 ONLY           *
     F*           REMOVES A MINOR PART OF THIS                        *
     F*  S01227 - Copy PC Settlement instructions to new extended     *
     F*           settlement fields.                                  *
     F*  E234   - CALL TO ACCESS OBJECTS SHOULD NOT RETURN            *
     F*           *DBERR IF RECORD NOT FOUND                          *
     F*  E140   - CALL TO AOCUSTR0 IN #ZAE,F,G SHOULD NOT RETURN      *
     F*           *DBERR IF RECORD NOT FOUND                          *
     F*  E136   - CALLS AOBRCHR0 INSTEAD OF AOBROKR0                  *
     F*  E12    - INCORRECT NO. OF PARMS FOR AONOSTR0                 *
     F*  E80    - ERROR ON SDNOSTPD VALIDATION                        *
     F*  E67    - EXTERNAL DS NOT MATCHING EXTERNAL FILE LAYOUTS      *
     F*  S01194 - NEW STANDING DATA FILES                             *
     F*  S01177 - EXTENDED SETTLEMENT DETAILS                         *
     F*  S01117 - MULTI BRANCHING CHANGES                             *
     F*  E19013 - CHAIN TO MMDEAULL IN #BAC NOW ALLOWS FOR CHAIN      *
     F*           FAIL WHEN A DELETED DEAL'S ROLLOVER IS ALSO         *
     F*           DELETED. (DB ERROR NOW REMOVED)                     *
     F*  E18417 - #A Should not be conditioned on DBPGM, it           *
     F*           should use an ordinary variable such as @FIRST.     *
     F*  E17938 - When updating for a NAS or for a DEAM, the          *
     F*           value from the associated NAP was being             *
     F*           incorrectly inserted in Midas Customer Pay          *
     F*           Instructions field.                                 *
     F*  S01176 - Two new fields added (DRID and DDMR) onto the       *
     F*           Deals files.Securities Trading 3.1                  *
     F*  E18348 - Fields @MCRI and @MCPI were being updated with      *
     F*           the wrong values because the program assumed        *
     F*           that the key field in TABLET2 was called KEY.       *
     F*  E18380 - Program was recompiled with new formats for the     *
     F*           standard deal files. This stops the book code       *
     F*           and linked reference number fields from being       *
     F*           overwritten.                                        *
     F*  E18100 - TO CORRECT THE CALCULATION OF PREMIUM/DISCOUNT      *
     F*  E17051 - Use MM1030 for interest calculations since it       *
     F*           is more accurate than MM1007.                       *
     F*  E16695 - Issuer field in deal blotter is being updated       *
     F*           even when they are loans and deposits.              *
     F*  E16413 - Move @IKDEL not MMSTDL to @STDL, as this is how     *
     F*           it is done in other deletion subroutines.           *
     F*  E16147 - Wrong values being set up in Processing             *
     F*           Outstanding field on Download blotters which        *
     F*           prevents downloaded deals being fetched.            *
     F*  E16247 - Midas format Customer Pay/Rec Instructions are      *
     F*           not being cleared before a customer number is       *
     F*           moved in.                                           *
     F*  E14412 - IF BASE RATE CODE HAS BEEN ENTERED, SPREAD RATE     *
     F*           FIELD SET TO INPUT INTEREST RATE.                   *
     F*  E14377 - IF BROKERAGE ON STANDARD DEAL IS ALL 9'S            *
     F*           UPDATE DEALS FILE WITH ALL 9'S.                     *
     F*  E14177 - START/LAST INTEREST DATE SHOULD NOT DEFAULT         *
     F*           TO VALUE DATE FOR NABS IF START/LAST INTEREST       *
     F*           IS ZERO.                                            *
     F*  E13173 - PGM SHOULD CHAIN TO FDSCNMLL INSTEAD OF SNAME       *
     F*  E12945 - BASE RATE CODE UPDATED INCORRECTLY                  *
     F*  E12909 - OUR PAY/RECEIVE INSTRUCTIONS SHOULD ONLY BE         *
     F*           WORKED OUT FOR AN INSERT WHEN LEFT BLANK            *
     F*  E12306 - AFTER READE TO MMDEAMLL SHOULD USE HNDATE DEAM      *
     F*           VALUE DATE                                          *
     F*  E12279 - Core fix to prevent dead-locking.                   *
     F*  S01154 -                                                     *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F* ID F  C  H  L    FUNCTION OF INDICATORS                       *
     F*       61         CHAIN AND DB ERROR INDICATOR                 *
     F*       U6         PROGRAM ERROR - *PSSR EXECUTED               *
     F*       U7         DATA BASE ERROR                              *
     F*       U8         DATA BASE ERROR                              *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F**FDICDRLLIF**E           K        DISK         KINFSR INFSR    UC  S01194
     F**FDINSTLLIF**E                    DISK         KINFSR INFSR   U C  S01194
     F**FDBSNCLLIF**E           K        DISK         KINFSR INFSR    UC  S01194
     F**SNAME IF  E           K        DISK         KINFSR INFSR      UC  E13173
     F**FDCSNMLLIF**E           K        DISK         KINFSR INFSRUCE13173S01194
     F**FDBRKRLLIF**E           K        DISK         KINFSR INFSR    UC  S01194
     F**FDBRTELLIF**E           K        DISK         KINFSR INFSR    UC  S01194
     F**FDCCYTLLIF**E           K        DISK         KINFSR INFSR    UC  S01194
     F*EALS** UF  E           K        DISK         KINFSR INFSR A    UC
     F/COPY WNCPYSRC,MM0078F001
     FSDCBRTL1IF  E           K        DISK         KINFSR *PSSR      UC  S01383
     FSDBRTDL1IF  E           K        DISK         KINFSR *PSSR      UC  S01383
     FDEALS   IF  E           K        DISK         KINFSR INFSR      UC
     F*MMDWD2LLUF**E**********K********DISK*********KINFSR*INFSR*A****UC**S01319
     F**********************************************KCOMIT****************S01319
     F*MMDWA2LLUF**E**********K********DISK*********KINFSR*INFSR*A****UC**S01319
     F**********************************************KCOMIT****************S01319
     F*MMSTDDLLO***E**********K********DISK*********KINFSR*INFSR******UC**S01319
     F**********************************************KCOMIT****************S01319
     FMMDEALLLIF  E           K        DISK         KINFSR INFSR      UC
     F                                              KINFDS FDS1
     F            MMDELDP0                          KRENAMEMMDELDP
     F            MMDENSP0                          KRENAMEMMDENSP
     F            MMDENBP0                          KRENAMEMMDENBP
     FMMDEAULLUF  E           K        DISK         KINFSR INFSR A    UC
     F                                              KCOMIT
     FMMDAMULLUF  E           K        DISK         KINFSR INFSR A    UC
     F                                              KCOMIT
     F**FDSNAMLLIF**E           K        DISK         KINFSR INFSR    UC  S01194
     F**********  TABLET2F                          KRENAMETABLET2        S01194
     F**FDNOSTLLIF**E           K        DISK         KINFSR INFSR    UC  S01194
     FMMDEAMLLIF  E           K        DISK         KINFSR INFSR      UC
     F            MMDEAMP0                          KRENAMEMMDEAMP
     F**FXTB40LLIF**E           K        DISK         KINFSR INFSR    UC  S01194
     F*DTABJLLIF  E           K        DISK         KINFSR INFSR******UC  S01195
     F**FDTBLILLIF**E           K        DISK         KINFSR *PSSRUCS01195S01194
     F************TABLETLF                          KRENAMETBLITLF  S01195S01194
      *                                                                                       CDL013
     FSDSTAAL1IF  E           K        DISK                           UC                      CDL013
      *                                                                                       CDL013
     F*                                                                   S01408
     F/COPY WNCPYSRC,MM0078FFP1                                           S01408
     F*                                                                   S01408
      *
     E                    CPY@    1   1 80
     E/COPY ZSRSRC,ZHOLE                                                  S01195
     E*****                                                               S01195
     E****USED BY SR. ZA0830 - CURRENCY RECORDS                           S01195
     E*****               @CY        50  3                                S01195
     E*
     E****ARRAY*FOR*SR.*ZA0680*-*CUMULATIVE*DAYS*IN*YEAR*FOR*4*YEAR*PERIOD056095
     E***********         @YD     4   4  5 0A                             056095
     E*
     E****ARRAY*FOR*SR.*ZA0680*-*CUMULATIVE*DAYS*IN*YEAR*PER*MONTH*****   056095
     E***********         @MD    13  13  5 0A                             056095
     E*                                                                   056095
     E/COPY ZSRSRC,ZDATE9Z1                                               056095
     E**  Array for SR. ZDATE9                                            056095
     E*
     E**  LOKUP TABLES FOR MIDAS DEAL TYPE
     E********************TAB3    1  25  3   TAB4    2                    S01354
     E                    TAB3    1  27  3   TAB4    2                    S01354
     E*
     E**  ARRAY FOR SR. ZA0850 - DAYS IN A MONTH (COMPILE TIME ARRAY)
     E                    @M     12  12  2 0
     E*
     E** USED TO PREPARE FIELDS FOR TESTN
     E                    @IA        10  1
     E                    @O         10  1
     I*                                                                   S01383
     I**  Rename fields to differentiate DEALSDC from SDBRTDL1 fields.    S01383
     I*                                                                   S01383
     ISDBRTDD0                                                            S01383
     I              LCD                             BRTLCD                S01383
     I              LCT                             BRTLCT                S01383
     I              CHTP                            BRCHTP                S01383
     I/COPY WNCPYSRC,MM0078I001
     I*
     I** PROGRAM STATUS D/S TO HOLD FILE NAME FOR FILE ERROR.
     IPSDS       SDS
     I/COPY WNCPYSRC,MM0078I003
     I                                      201 208 @FILE
     I*************                         244 253 @UID                  082430
     I                                      254 263 @UID                  082430
     IFDS1        DS
     I*
     I** FILE STATUS DATA STRUCTURE - RECORD FORMAT
     I                                     *RECORD  @FORM
     I**  DATA STRUCTURE FOR SR. M1010 - DATE FIELD YYMMDD                E12306
     I            DS                                                      E12306
     I                                        1   80HNDATE                E12306
     I                                        1   40@NVDYY                E12306
     I                                        5   60@NVDMM                E12306
     I                                        7   80@NVDDD                E12306
     I*
     I****DATA*STRUCTURE*FOR*SR.*MM1009*-*DATE*FIELD*YYYYMMDD**********   056095
     I*********** DS                                                      056095
     I***********                             1   80@@DATA                056095
     I***********                             1   40@@YY1                 056095
     I***********                             5   60@@MM1                 056095
     I***********                             7   80@@DD1                 056095
     I****DATA*STRUCTURE*FOR*SR.*MM1009*-*DATE*FIELD*YYYYMMDD**********   056095
     I*********** DS                                                      056095
     I***********                             1   80@@DATB                056095
     I***********                             1   40@@YY2                 056095
     I***********                             5   60@@MM2                 056095
     I***********                             7   80@@DD2                 056095
     I*                                                                   056095
     I/COPY ZSRSRC,ZINTDYZ1                                               056095
     I**  Data Structure for SR. ZINTDY                                   056095
     I*                                                                   056095
     I****DATA*STRUCTURE*FOR*SR.*ZA0710*-*FIELD*IS*@@Z71Y**************   056095
     I*********** DS                                                      056095
     I***********                             1   40@@Z71Y                056095
     I***********                             1   10@@SSY1                056095
     I***********                             2   20@@SSY2                056095
     I***********                             3   30@@SSY3                056095
     I***********                             4   40@@SSY4                056095
     I*
     I****DATA*STRUCTURE*FOR*SR.*ZA0710*-*FIELD*IS*@@VDT***************   056095
     I*********** DS                                                      056095
     I***********                             1   80@@VDT                 056095
     I***********                             1   40@@YR                  056095
     I***********                             5   60@@Z71M                056095
     I***********                             7   80@@Z71D                056095
     I*                                                                   056095
     I/COPY ZSRSRC,ZDATE9Z2                                               056095
     I**  Data structure for SR. ZDATE9                                   056095
     I*
     I**  DATA STRUCTURE FOR SR. MM1004 - MANIPULATE DATE INPUT
     I@@WKDS      DS
     I                                        1   80@@WKDT
     I                                        1   40@@WKYY
     I                                        3   40@@WKY
     I                                        5   60@@WKM
     I                                        7   80@@WKD
     I*
     I            DS
     I********************************************************************S01319
     I****USED*BY*SR.*ZA0830*-*ARRAY*DATA*STRUCTURE***********************S01319
     I****************************************1*150*@CY*******************S01319
     I****************************************1**75*@@CY1*****************S01319
     I***************************************76*150*@@CY2*****************S01319
     I*
     I****DATA*STRUCTURE*FOR*SR.*ZA0680*-*DATE*INPUT*TO*SUBROUTINE*****   056095
     I*********** DS                                                      056095
     I***********                             1   80@@DTIN                056095
     I***********                             1   40@@YYYY                056095
     I***********                             3   40@@YY                  056095
     I***********                             1   20@@CC                  056095
     I***********                             5   60@@MTH                 056095
     I***********                             7   80@@DAY                 056095
     I***********                             1  150@ALINT                056095
     I*                                                                   056095
     I/COPY ZSRSRC,ZDAT10Z1                                               056095
     I**  Data structure for SR. ZDAT10                                   056095
     I*
     I@INAMT      DS
     I                                        1  10 @IN
     I                                        1  10 @IA
     I@OUTAM      DS
     I                                        1  10 @OUT
     I                                        1  10 @O
     I*
     I***         DS                                                      BHF307
     I***                                     1   7 RUNA                  BHF307
     I***                                     1   20@DLUP                 BHF307
     I***                                     3   5 @MLUP                 BHF307
     I***                                     6   70@YLUP                 BHF307
     I********************************************************************S01319
     I************DS******************************************************S01319
     I****************************************1**150I1IMTI****************S01319
     I***************************************16**180I1IMTD****************S01319
     I****************************************2**160@1MTI1****************S01319
     I****************************************3**170@1MTI2****************S01319
     I****************************************4**180@1MTI3****************S01319
     I********************************************************************S01319
     I************DS******************************************************S01319
     I****************************************1**150I1AMNI****************S01319
     I***************************************16**180I1AMND****************S01319
     I****************************************2**160@1AMN1****************S01319
     I****************************************3**170@1AMN2****************S01319
     I****************************************4**180@1AMN3****************S01319
     I********************************************************************S01319
     I************DS******************************************************S01319
     I****************************************1**150I1BRKI****************S01319
     I***************************************16**180I1BRKD****************S01319
     I****************************************2**160@1BRK1****************S01319
     I****************************************3**170@1BRK2****************S01319
     I****************************************4**180@1BRK3****************S01319
     I********************************************************************S01319
     I********************************************************************S01319
     I************DS******************************************************S01319
     I****************************************1**150I2AMNI****************S01319
     I***************************************16**180I2AMND****************S01319
     I****************************************2**160@2AMN1****************S01319
     I****************************************3**170@2AMN2****************S01319
     I****************************************4**180@2AMN3****************S01319
     I********************************************************************S01319
     I********************************************************************S01319
     I********************************************************************S01319
     I****DATA*STRUCTURES*TO*REFORMAT*DATES*FROM*DOWNLOAD*FILE*LOANS******S01319
     I****DEPOSITS*CD'S*ISSUED********************************************S01319
     I********************************************************************S01319
     I****VALUE*DATE******************************************************S01319
     I************DS******************************************************S01319
     I****************************************1***80@I1VDY****************S01319
     I****************************************1***40I1VDYY****************S01319
     I****************************************5***60I1VDMM****************S01319
     I****************************************7***80I1VDDD****************S01319
     I********************************************************************S01319
     I****TRANSACTION*DATE************************************************S01319
     I************DS******************************************************S01319
     I****************************************1***80@I1DTY****************S01319
     I****************************************1***40I1DTYY****************S01319
     I****************************************5***60I1DTMM****************S01319
     I****************************************7***80I1DTDD****************S01319
     I********************************************************************S01319
     I****DEAL*DONE*DATE**************************************************S01319
     I************DS******************************************************S01319
     I****************************************1***80@I1DDY****************S01319
     I****************************************1***40I1DDYY****************S01319
     I****************************************5***60I1DDMM****************S01319
     I****************************************7***80I1DDDD****************S01319
     I********************************************************************S01319
     I****INTEREST*ACCRUAL*CONTROL*DATE***********************************S01319
     I************DS******************************************************S01319
     I****************************************1***80@I1IAY****************S01319
     I****************************************1***40I1IAYY****************S01319
     I****************************************5***60I1IAMM****************S01319
     I****************************************7***80I1IADD****************S01319
     I********************************************************************S01319
     I****LAST*INTEREST*DATE**********************************************S01319
     I*@DOWNF*****DS**************************2**86***********************S01319
     I****************************************1***3*I1DBRC****************S01319
     I****************************************4**180@NUM1*****************S01319
     I***************************************19**330@NUM2*****************S01319
     I***************************************34**480@NUM3*****************S01319
     I***************************************49**560@NUM4*****************S01319
     I****************************************4**110@I1MDY****************S01319
     I****************************************4***70I1MDYY****************S01319
     I****************************************8***90I1MDMM****************S01319
     I***************************************10**110I1MDDD****************S01319
     I***************************************12**190@I1NIY****************S01319
     I***************************************12**150I1NIYY****************S01319
     I***************************************16**170I1NIMM****************S01319
     I***************************************18**190I1NIDD****************S01319
     I***************************************20**270@I1SLY****************S01319
     I***************************************20**230I1SLYY****************S01319
     I***************************************24**250I1SLMM****************S01319
     I***************************************26**270I1SLDD****************S01319
     I***************************************28**420I1FVLI****************S01319
     I***************************************29**430@1FVL1****************S01319
     I***************************************30**440@1FVL2****************S01319
     I***************************************31**450@1FVL3****************S01319
     I***************************************43**450I1FVLD****************S01319
     I***************************************46**567I1FRTS****************S01319
     I***************************************57**76*I1CDRF****************S01319
     I***************************************77**86*I1ISUR****************S01319
     I********************************************************************S01319
     I********************************************************************S01319
     I********************************************************************S01319
     I****DATA*STRUCTURES*TO*REFORMAT*DATES*FROM*DOWNLOAD*FILE*DEAMS******S01319
     I********************************************************************S01319
     I****VALUE*DATE******************************************************S01319
     I************DS******************************************************S01319
     I****************************************1***80@I2VDY****************S01319
     I****************************************1***40I2VDYY****************S01319
     I****************************************5***60I2VDMM****************S01319
     I****************************************7***80I2VDDD****************S01319
     I****************************************1***40I2VDY1****************S01319
     I****************************************5***60I2VDM1****************S01319
     I****************************************7***80I2VDD1****************S01319
     I********************************************************************S01319
     I****TRANSACTION*DATE************************************************S01319
     I************DS******************************************************S01319
     I****************************************1***80@I2DTY****************S01319
     I****************************************1***40I2DTYY****************S01319
     I****************************************5***60I2DTMM****************S01319
     I****************************************7***80I2DTDD****************S01319
     I********************************************************************S01319
     I****ORIGINAL*DEAL*START*DATE****************************************S01319
     I************DS******************************************************S01319
     I****************************************1***80@I2OSY****************S01319
     I****************************************1***40I2OSYY****************S01319
     I****************************************5***60I2OSMM****************S01319
     I****************************************7***80I2OSDD****************S01319
     I********************************************************************S01319
     I****DEAL*ORIGINAL*END*DATE******************************************S01319
     I************DS******************************************************S01319
     I****************************************1***80@I2OMY****************S01319
     I****************************************1***40I2OMYY****************S01319
     I****************************************5***60I2OMMM****************S01319
     I****************************************7***80I2OMDD****************S01319
     I********************************************************************S01319
     I****DEAM*DONE*DATE**************************************************S01319
     I************DS******************************************************S01319
     I****************************************1***80@I2DDY****************S01319
     I****************************************1***40I2DDYY****************S01319
     I****************************************5***60I2DDMM****************S01319
     I****************************************7***80I2DDDD****************S01319
     I*
     I*@KEY********DS                             12               S01195 S01194
     I**  Data structure for keying to the MIDAS table files       S01195 S01194
     I*********                               1   2 @KEY1          S01195 S01194
     I*********                               9  11 @KEY2          S01195 S01194
     I*********                              12  12 @KEY3          S01195 S01194
     I*
     I**  DEALS FILE LOANS DEPOSITS ETC
     I@STDL     E DSMMDELDPP
     I                                       50  570@HKVDY
     I************                           58  650@HKDTY                E281
     I************                          111 1180@HKDDY                E281
     I                                      179 1860@HKSLY
     I                                      205 2120@HKNIY
     I************                          237 2440@HKIAY                E281
     I                                      252 2590@HKMDY
     I                                        1 255 @STDL1                S01177
     I                                      256 447 @STDL2                S01177
     I*****************************         448 687 @STDL3        S01177  S01117
     I********************                  688 900 @STDL4        S01177  S01117
     I****************************          9011075 @STDL5        S01177  S01117
     I********                              448 695 @STDL3                E67
     I********                              696 943 @STDL4                E67
     I********                              9441083 @STDL5                E67
     I********                             10841096 @STDL6                S01117
     I                                      456 687 @STDL3                S01117
     I                                      688 908 @STDL4                S01117
     I                                      9091083 @STDL5                S01117
     I                                     10841096 @STDL6                S01117
     I                                     11051107 @STDL7                S01392
     I                                     11081175 @STDL8                S01434
     I                                     11801190 @STDL9                CAC001
     I*
     I**  DEALS FILE NAS
     I@STDS     E DSMMDENSPP
     I                                       50  570@HMVDY
     I**************                         58  650@HMDTY                E281
     I**************                        111 1180@HMDDY                E281
     I                                      152 1590@HMNIY
     I*********                             188 1910@HMLIY
     I                                      188 1950@HMLIY
     I                                      208 2150@HMMDY
     I******************************          1 201 @STDS1        S01177  S01117
     I******************************        202 305 @STDS2        S01177  S01117
     I******************************        306 537 @STDS3        S01177  S01117
     I******************************        538 758 @STDS4        S01177  S01117
     I******************************        759 933 @STDS5        S01177  S01117
     I                                        1 246 @STDS1                S01177
     I                                      247 313 @STDS2                S01177
     I                                      314 553 @STDS3                S01117
     I                                      554 801 @STDS4                S01117
     I                                      802 941 @STDS5                S01117
     I                                      942 952 @STDS6                S01378
     I                                      953 956 @STDS7                S01378
     I***********                           942 951 @STDS6          S01117S01378
     I********                              247 305 @STDS2                E67
     I********                              306 553 @STDS3                E67
     I********                              554 801 @STDS4                E67
     I********                              802 941 @STDS5                E67
     I********                              942 954 @STDS6                E67
     I*
     I**  DEALS FILE NABS
     I@STDB     E DSMMDENBPP
     I              DORIQQ                          QQDOR1                                    CGL029
     I              MORIQQ                          QQMOR1                                    CGL029
     I              RONSQQ                          QQRON1                                    CGL029
     I              PONSQQ                          QQPON1                                    CGL029
     I                                       50  570@HLVDY
     I                                       58  650@HLDTY
     I*************                         111 1180@HLDDY                E281
     I                                      179 1860@HLNIY
     I                                      223 2300@HLLIY
     I*************                         257 2640@HLIAY                E281
     I                                      265 2720@HLMDY
     I*****************************           1 206 @STDB1        S01177  S01117
     I*****************************         207 450 @STDB2        S01177  S01117
     I**********************                451 682 @STDB3        S01177  S01117
     I******************                    683 903 @STDB4        S01177  S01117
     I*****                                 9041078 @STDB5        S01177  S01117
     I**************************            451 655 @STDB3                S01117
     I                                        1 255 @STDB1                S01117
     I********                              256 450 @STDB2                S01117
     I********                              451 698 @STDB3                S01117
     I********                              699 946 @STDB4                S01117
     I********                              9471086 @STDB5                S01117
     I********                             10871099 @STDB6                S01117
     I                                      256 458 @STDB2                S01117
     I*                                                                   DT0008
     I** Field positions redefined to match up with data structure MMSTDB.DT0008
     I************************************* 459 604 @STDB3          S01117DT0008
     I************************************* 605 838 @STDB4          S01117DT0008
     I************************************* 8391086 @STDB5          S01117DT0008
     I*************************************10871099 @STDB6          S01117DT0008
     I                                      463 608 @STDB3                DT0008
     I                                      609 842 @STDB4                DT0008
     I                                      8431090 @STDB5                DT0008
     I***********                          10911103 @STDB6          DT0008S01378
     I***********                          10911094 @STDB6          S01378052721
     I                                     10911104 @STDB6                S01378
     I***********                          10951122 @STDB7          S01378052721
     I                                     11051122 @STDB7                S01378
     I                                     11231133 @STDB8                CAC001
     I*
     I**  DEAMS FILE
     I@STDA     E DSMMDEAMPP
     I              QQDORI                          QQDOR2                                    CGL029
     I              QQMORI                          QQMOR2                                    CGL029
     I              QQDOPI                          QQDOP2                                    CGL029
     I              QQMOPI                          QQMOP2                                    CGL029
     I              QQRONS                          QQRON2                                    CGL029
     I              QQPONS                          QQPON2                                    CGL029
     I                                       49  560@HNVDY
     I                                       57  640@HNDTY
     I                                       71  780@NDMDY
     I************                            1 150 @STDA1       S01177   S01117
     I**************                        151 299 @STDA2       S01177   S01117
     I**************                        300 531 @STDA3       S01177   S01117
     I*********************************     532 752 @STDA4        S01177  S01117
     I*****                                 753 927 @STDA5        S01177  S01117
     I                                        1 254 @STDA1
     I                                      255 299 @STDA2
     I                                      300 496 @STDA3
     I                                      497 717 @STDA4                S01117
     I                                      718 927 @STDA5                S01117
     I                                      928 930 @STDA6                S01117
     I                                      932 934 @STDA7                E49965
     I                                      935 942 @STDA8                CAC001
     I*
     I**  EXTERNALLY DESCRIBED DATA STRUCTURES FOR TEMPLATE FILES FOR     087238
     I**  PROJECTED ACCOUNT MOVEMENTS UPDATES                             087238
     IZ#BSTS    E DSZ#BST                                                 082738
     IZ#ASTS    E DSZ#AST                                                 082738
     IZ#WSTS    E DSZ#WST                                                 082738
     I*                                                                   082738
     I**  EXTERNALLY DESCRIBED DATA STRUCTURE FOR STANDARD DEAL FORMAT
     IMMSTDL    E DSMMSTDLPP
     I              QQDORI                          QQDOR3                                    CGL029
     I              QQMORI                          QQMOR3                                    CGL029
     I              QQDOPI                          QQDOP3                                    CGL029
     I              QQMOPI                          QQMOP3                                    CGL029
     I              QQRONS                          QQRON3                                    CGL029
     I              QQPONS                          QQPON3                                    CGL029
     I              QQINSA                          QQINS3                                    CGL029
     I                                        1  23 @IKDEL
     I                                       36  410@IKDAD
     I*
     I**  REFORMAT DATES FROM DEALS FILE LOANS DEPOSITS CD'S ISSUED
     I                                       50  570@IKVDY
     I                                       58  650@IKDTY
     I                                      111 1180@IKDDY
     I                                      179 1860@IKSLY
     I                                      205 2120@IKNIY
     I                                      237 2440@IKIAY
     I                                      252 2590@IKMDY
     I                                        1 255 @LIDS1                S01177
     I                                      256 447 @LIDS2                S01177
     I                                      723 954 @LIDS3                S01117
     I***********************************   708 955 @LIDS3                E67
     I***********************************   708 947 @LIDS3        S01177  S01117
     I*****                                 9481160 @LIDS4        S01177  S01117
     I********************************     11611335 @LIDS5        S01177  S01117
     I********                              9561203 @LIDS4                S01117
     I********                             12041343 @LIDS5                S01117
     I********                             13501362 @LIDS6                S01117
     I                                      9551175 @LIDS4                E67
     I                                     11761350 @LIDS5                E67
     I                                     13571369 @LIDS6                E67
     I                                     13821384 @LIDS7                S01392
     I                                     13851452 @LIDS8                S01434
     I                                     14571467 @LIDS9                CAC001
     I**  EXTERNALLY DESCRIBED DATA STRUCTURE FOR NA BOUGHT FORMAT
     IMMSTDB    E DSMMSTDBPP
     I              QQDORI                          QQDOR4                                    CGL029
     I              QQMORI                          QQMOR4                                    CGL029
     I              QQDOPI                          QQDOP4                                    CGL029
     I              QQMOPI                          QQMOP4                                    CGL029
     I              QQBORI                          QQBOR4                                    CGL029
     I              QQBOPI                          QQBOP4                                    CGL029
     I              QQRONS                          QQRON4                                    CGL029
     I              QQPONS                          QQPON4                                    CGL029
     I                                        1  23 @IHDEL
     I                                       36  410@IHDAD
     I****************                        1 206 @NABS1        S01177  S01117
     I***************                       207 450 @NABS2        S01177  S01117
     I*****                                 8481079 @NABS3        S01177  S01117
     I*****                                10801300 @NABS4        S01177  S01117
     I*****                                13011475 @NABS5        S01177  S01117
     I                                        1 255 @NABS1                S01177
     I****************                      256 450 @NABS2                S01177
     I********                              8481095 @NABS3                E67
     I********                             10961343 @NABS4                E67
     I********                             13441483 @NABS5                E67
     I****************                     14901502 @NABS6                E67
     I                                      256 458 @NABS2                E67
     I                                      8601005 @NABS3                S01117
     I                                     10061239 @NABS4                S01117
     I                                     12401487 @NABS5                S01117
     I***********                          14941506 @NABS6          S01117S01378
     I                                     14941507 @NABS6                S01378
     I                                     15091526 @NABS7                S01378
     I                                     15271537 @NABS8                CAC001
     I*
     I**  REFORMAT DATES FROM DEALS FILE NA'S BOUGHT
     I                                       50  570@IHVDY
     I                                       58  650@IHDTY
     I                                      111 1180@IHDDY
     I                                      179 1860@IHNIY
     I                                      223 2300@IHLIY
     I                                      257 2640@IHIAY
     I                                      265 2720@IHMDY
     I*
     I*
     I**  EXTERNALLY DESCRIBED DATA STRUCTURE FOR NA SOLD FORMAT
     IMMSTDS    E DSMMSTDSPP
     I              QQDORI                          QQDOR5                                    CGL029
     I              QQMORI                          QQMOR5                                    CGL029
     I              QQBORI                          QQBOR5                                    CGL029
     I              QQBOPI                          QQBOP5                                    CGL029
     I              QQRORI                          QQROR5                                    CGL029
     I              QQROPI                          QQROP5                                    CGL029
     I              QQRONS                          QQRON5                                    CGL029
     I              QQPONS                          QQPON5                                    CGL029
     I                                        1  23 @ILDEL
     I                                       36  410@ILDAD
     I*
     I**  REFORMAT DATES FROM STANDARD DEAL NA'S SOLD
     I                                       50  570@ILVDY
     I**************                         58  650@ILDTY                E281
     I                                      111 1180@ILDDY
     I                                      188 1950@ILNIY
     I                                      188 1950@ILLIY
     I                                      208 2150@ILMDY
     I********                                1 201 @NASS1        S01177  S01117
     I********                              202 305 @NASS2        S01177  S01117
     I*****                                 700 931 @NASS3        S01177  S01117
     I*****                                 9321152 @NASS4        S01177  S01117
     I**********************************   11531327 @NASS5        S01177  S01117
     I                                        1 246 @NASS1                S01177
     I                                      247 313 @NASS2                S01177
     I                                      708 947 @NASS3                S01117
     I                                      9481195 @NASS4                S01117
     I                                     11961335 @NASS5                S01117
     I***********                          13391348 @NASS6          S01117S01378
     I                                     13391349 @NASS6                S01378
     I                                     13561359 @NASS7                S01378
     I********                              247 305 @NASS2                E67
     I********                              700 947 @NASS3                E67
     I********                              9481195 @NASS4                E67
     I********                             11961335 @NASS5                E67
     I********                             13421354 @NASS6                E67
     I*
     I**  EXTERNALLY DESCRIBED DATA STRUCTURE FOR DEAL AMENDMENTS
     IMMSTDA    E DSMMSTDAPP
     I              QQDORI                          QQDOR6                                    CGL029
     I              QQMORI                          QQMOR6                                    CGL029
     I              QQDOPI                          QQDOP6                                    CGL029
     I              QQMOPI                          QQMOP6                                    CGL029
     I              QQBORI                          QQBOR6                                    CGL029
     I              QQBOPI                          QQBOP6                                    CGL029
     I              QQRORI                          QQROR6                                    CGL029
     I              QQROPI                          QQROP6                                    CGL029
     I              QQRONS                          QQRON6                                    CGL029
     I              QQPONS                          QQPON6                                    CGL029
     I*
     I**  REFORMAT DATES FROM STANDARD DEAL DEAMS
     I                                        1  23 @IGDEL
     I****************                       36  410@IGDAD                E281
     I                                       49  560@IGVDY
     I                                       57  640@IGDTY
     I                                       71  780@IGDMY
     I*********                             512 5190@IGOSY
     I*********                             520 5270@IGOMY
     I**********                            514 5210@IGOSY                S01227
     I**********                            522 5290@IGOMY                S01227
     I***************                      114211490@IGOSY                E281
     I***************                      115011570@IGOMY                E281
     I                                      514 5210@IGOSY                E281
     I                                      522 5290@IGOMY                E281
     I********************                    1 150 @MDAM1        S01177  S01117
     I********************                  151 299 @MDAM2        S01177  S01117
     I********************                  573 804 @MDAM3        S01177  S01117
     I*****                                 8051025 @MDAM4        S01177  S01117
     I*****                                10261200 @MDAM5        S01177  S01117
     I                                        1 254 @MDAM1                S01117
     I                                      255 299 @MDAM2                S01117
     I                                      573 769 @MDAM3                S01117
     I                                      770 990 @MDAM4                S01117
     I                                      9911200 @MDAM5                S01117
     I                                     12071209 @MDAM6                S01117
     I                                     12101212 @MDAM7                E49965
     I                                     12141221 @MDAM8                CAC001
     I*
     I**  DATA STRUCTURE TO HOLD INFORMATION ON DATABASE ERROR.
     I           UDS                            256
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      142 1470@WK6N
     I                                      148 1550@WK8N
     I                                      156 1580@WK3N
     I                                      171 180 DBPGM
     I                                      181 183 DBASE
     I*                                                                   S01194
     I* DATA STRUCTURES FOR USE WITH ACCESS PROGRAMS                      S01194
     I*                                                                   S01194
     ISDBANK    E DSSDBANKPD                                              S01194
     I* DATA STRUCTURE FOR BANK DETAILS                                   S01194
     I*                                                                   S01194
     ISDBRCH    E DSSDBRCHPD                                              S01194
     I* DATA STRUCTURE FOR BRANCH CODES                                   S01194
     I*                                                                   S01194
     ISDBROK    E DSSDBROKPD                                              S01194
     I* DATA STRUCTURE FOR BROKER CODES                                   S01194
     I*                                                                   S01194
     I***SDBSRT****E DSSDBSRTPD                                     S01194E121
     I**DATA*STRUCTURE FOR BASE RATES                               S01194E121
     I*                                                                   S01194
     ISDCNST    E DSSDCNSTPD                                              S01194
     I* DATA STRUCTURE FOR COUNTERPARTY SHORTNAMES                        S01194
     I*                                                                   S01194
     ISDCURR    E DSSDCURRPD                                              S01194
     I* DATA STRUCTURE FOR CURRENCY DETAILS                               S01194
     I*                                                                   S01194
     ISDCUST    E DSSDCUSTPD                                              S01194
     I* DATA STRUCTURE FOR CUSTOMER DETAILS                               S01194
     I              QQDFAC                          QQ1DFA                                    CGL029
     I*                                                                   S01194
     ISDDEAL    E DSSDDEALPD                                              S01194
     I* DATA STRUCTURE FOR DEAL DATA CODES                                S01194
     I*                                                                   S01194
     ISDNOST    E DSSDNOSTPD                                              S01194
     I* DATA STRUCTURE FOR NOSTRO CODES                                   S01194
     I              QQACCD                          QQ2ACD                                    CGL029
     I*                                                                   S01194
     ISDRETL    E DSSDRETLPD                                              S01194
     I* DATA STRUCTURE FOR RETAIL DETAILS                                 S01194
     I              QQACCD                          QQ3ACD                                    CGL029
     I*                                                                   S01194
     ISDMMOD    E DSSDMMODPD                                              S01319
     I* DATA STRUCTURE FOR MODULE DETAILS                                 S01319
     I*                                                                   S01319
     ISCSARD    E DSSCSARDPD                                              CEU003
      ** Switchable Features File                                         CEU003
      *                                                                   CEU003
     ISDGELR    E DSSDGELRPD                                              CEU015
     I              QQACCD                          QQ4ACD                                    CGL029
     I* GENERAL LEDGER DETAILS ACCESSED VIA ACCESS PROGRAM                CEU015
      *                                                                   CEU015
     IDSFDY     E DSDSFDY                                                 S01194
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01194
     I*                                                                   S01117
     IDSSDY     E DSDSSDY                                                 S01194
     I* SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE                S01194
     IRUNDAT      DS                                                      S01117
     I                                        1   20@DLUP                 BHF307
     I                                        3   5 @MLUP                 BHF307
     I                                        6   70@YLUP                 BHF307
     I                                       13  13 MBIN                  S01117
      *                                                                                       CDL081
      ** Named constants                                                                      CDL081
      *                                                                                       CDL081
     I              'BasCcyTaxRoundDown'  C         C#BASE                                    CDL081
     I              'NBasCcyTaxRoundDown' C         C#NBAS                                    CDL081
     I              'LECalcBasis6LeapYear'C         WPARML                                  MD035545
     I/COPY WNCPYSRC,MM0078I002
     I/COPY ZSRSRC,ZHOLI                                                  S01117
     I*                                                                   S01408
     I/COPY WNCPYSRC,MM0078IIP1                                           S01408
     I*                                                                   S01408
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* MAIN     - Main Processing                                    *
     C*                                                               *
     C* CALLS    #B       - Update Standard Deal                      *
     C*          #C       - Termination                               *
     C*          #A       - Initialisation                            *
     C*                                                               *
     C* CALLED BY         -                                           *
     C*                                                               *
     C* FLDS USED         -                                           *
     C*                                                               *
     C*****************************************************************
     C/COPY WNCPYSRC,MM0078C028
     C*
     C**  INITIAL PROCESSING.
     C***********DBPGM     CASNE'MM0078'  #A                              E18417
     C           @FIRST    CASNE'N'       #A                              E18417
     C                     END
     C*
     C**  MAIN PROCESSING
     C           *INLR     CASEQ'0'       #B
     C                     END
     C*
     C**  TERMINATION PROCESSING
     C                     EXSR #C
     C*
     C           ENDPGM    TAG                             **ENDPGM**
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C* SUBROUTINES USED                                              *
     C*                                                               *
     C*  01  #B       - Update Standard Deal                          *
     C*  02  #BA      - Loans Deposits Processing                     *
     C*  03  #BAA     - Loans Deposits Inserts                        *
     C*  04  #BAB     - Loans Deposits Amends                         *
     C*  05  #BAC     - Loans DEposits Deletes                        *
     C*  06  #BB      - NAB Processing                                *
     C*  07  #BBA     - NAB Inserts                                   *
     C*  08  #BBB     - NAB Amends                                    *
     C*  09  #BBC     - NAB Deletes                                   *
     C*  10  #BC      - NAS Processing                                *
     C*  11  #BCA     - NAS Inserts                                   *
     C*  12  #BCB     - NAS Amends                                    *
     C*  13  #BCC     - NAS Deletes                                   *
     C*  14  #BD      - Deam Processing                               *
     C*  15  #BDA     - Deam Inserts                                  *
     C*  16  #BDB     - Deam Amends                                   *
     C*  17  #BDC     - Deam Deletes                                  *
     C*  18  #ZA      - Loans Deposits Supplementary Fields           *
     C*  19  #ZAA     - Midas Our Receive Method                      *
     C*  20  #ZAB     - Midas Our Receive Instructions                *
     C*  21  #ZAC     - Midas Our Pay Method                          *
     C*  22  #ZAD     - Midas Our Pay Instructions                    *
     C*  23  #ZAE     - Midas Customer Pay Instructions               *
     C*  24  #ZAF     - Midas Customer Receive Instructions           *
     C*  25  #ZAG     - Midas For Account Of                          *
     C*  26  #ZB      - Loans Deposits Before Fields                  *
     C***27**#ZC******-*Loans*Deposits*Download*Blotter*******************S01319
     C*  28  #ZD      - NAB's Supplementary Fields                    *
     C*  29  #ZE      - NAB's Before Fields                           *
     C*  30  #ZF      - NAB's Related Fields                          *
     C***31**#ZG******-*NAB's*Download*Blotter****************************S01319
     C*  32  #ZH      - NAS's Supplementary Fields                    *
     C*  33  #ZI      - MAS's Before Fields                           *
     C*  34  #ZJ      - NAS's Related Fields                          *
     C***35**#ZK******-*NAS's*Download*Blotter****************************S01319
     C*  36  #ZL      - Deams Supplementary Fields                    *
     C*  37  #ZLA     - Deams - Find Original Deal                    *
     C*  38  #ZLAA    - Deams Pay Instructions                        *
     C*  39  #ZLAB    - Deams Receive Instructions                    *
     C*  40  #ZLB     - Deams - Original Type Loans Deposits          *
     C*  41  #ZLC     - Deams - Original Type NABs                    *
     C*  42  #ZLD     - Deams Settle Interest - Loans Deposits        *
     C*  43  #ZLE     - Deams Settle Interest - NABs                  *
     C*  44  #ZM      - Deams Before Fields                           *
     C***45**#ZO******-*Deams*Download*Blotter****************************S01319
     C*  46  #ZP      - Prepare for testn                             *
     C***47**MM1007***-*Calculate interest                            *   E17051
     C*  47  MM1030   - Calculate interest                            *   E17051
     C***48**ZA0710***-*Calculate*8,0*date*format**********************   056095
     C***49**ZA0680***-*Calculate*midas*day*no*************************   056095
     C*  48  ZDATE9   - Calculate 8,0 date format                     *   056095
     C*  49  ZDAT10   - Calculate midas day no                        *   056095
     C*  50  MM1010   - Calculate interest at maturity                *
     C***51**MM1009***-*Calculate*no.*of*day**interest*****************   056095
     C*  51  ZINTDY   - Calculate no. of days interest                *   056095
     C***52**ZA0830***-*Check*for*a*holiday*******************************S01319
     C*  53  MM1004   - Calculate next interest payment date          *
     C*  54  #C       - Termination                                   *
     C*  55  #A       - Initialisation                                *
     C*  56  ZA0150   - Access TABTB10                                *
     C*  57  #Z       - Data base errors                              *
     C*  58  *PSSR    - Program error subroutine                      *
     C*  59  INFSR    - File error subroutine                         *
     C*                                                               *
     C* EXTERNAL ROUTINE                                              *
     C*  46  MM0075   - Forward Book Update                           *
     C*  47  MM0073   - Update near dates summary                     *
     C***48**MM0074***-*Update*customer*exposures*************************S01319
     C*  49  MM0094   - Update liquidity exposures                    *
     C*                                                               *
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #B       - Update Standard Deal                               *
     C*                                                               *
     C* CALLS    #Z       - Data base errors                          *
     C*          #BA      - Loans Deposits Processing                 *
     C*          #BB      - NAB Processing                            *
     C*          #BC      - NAS Processing                            *
     C*          #BD      - Deam Processing                           *
     C*          MM0075   - Forward Book Update                       *
     C*          MM0073   - Update near dates summary                 *
     C***********MM0074***-*Update*customer*exposures*********************S01319
     C*          MM0094   - Update liquidity exposures                *
     C*                                                               *
     C* CALLED BY  MAIN   - Main Processing                           *
     C*                                                               *
     C* FLDS USED  @ENQ   - Processing Type L, B, S, A                *
     C*            @CCY   - Currency                                  *
     C************ @@KEY  - 12 Byte Key                               *   S01194
     C************ @@KEY4 - 4 Byte Key Work Field                     *   S01194
     C*            @TERM  - Termination Parameter                     *
     C*                                                               *
     C*****************************************************************
     C           #B        BEGSR
     C*
     C           @ENQ      IFEQ 'L'                        B1
     C                     MOVELIKCCY     @CCY    3        *1
     C                     END                             E1
     C*
     C           @ENQ      IFEQ 'B'                        B1
     C                     MOVELIHCCY     @CCY             *1
     C                     END                             E1
     C*
     C           @ENQ      IFEQ 'S'                        B1
     C                     MOVELILCCY     @CCY             *1
     C                     END                             E1
     C*
     C           @ENQ      IFEQ 'A'                        B1
     C                     MOVELIGCCY     @CCY             *1
     C                     END                             E1
     C*
     C**  ACCESS CURRENCY FILE FOR CURRENCY DECIMAL PLACES
      *
      ** NOTE USE OF @WRK3 IN CASE ACCESS OBJECT CORRUPTS FIELD AND       S01194
      ** CAUSES AN ERROR LATER IN PGM. CAN LOOK AT DUMP FOR @CCY AND @WRK3S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM @CCY      @WRK3   3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01194
     C*********            MOVEL'20'      @@KEY  12                       S01194
     C*********            MOVE *BLANK    @@KEY4  4                       S01194
     C*********            MOVE '1'       @@KEY4                          S01194
     C*********            MOVEL@CCY      @@KEY4                          S01194
     C*********            MOVE @@KEY4    @@KEY                           S01194
     C*********                                                           S01194
     C*********  @@KEY     CHAINFDCCYTLL             61                   S01194
     C*
     C**  CHECK FOR DATA BASE ERROR
     C********** *IN61     IFEQ '1'                        B1             S01194
     C           @RTCD     IFNE *BLANK                     B1             S01194
     C**********           MOVEL'FDCCYTLL'DBFILE                          S01194
     C                     MOVEL'SDBANKPD'DBFILE           ************   S01194
     C                     MOVEL'001'     DBASE            * DB ERR 01*
     C                     MOVEL@OPTN     DBOPTN  7        *              S01194
     C                     EXSR #Z                         ************
     C                     END                             E1
     C*
     C**  LOAN DEPOSIT OR CD PROCESSING
     C           @ENQ      CASEQ'L'       #BA
     C           @ENQ      CASEQ'B'       #BB
     C           @ENQ      CASEQ'S'       #BC
     C           @ENQ      CASEQ'A'       #BD
     C                     END
     C*
     C**  IF AUTHORISATION ONLY DO NOT CALL UPDATE PROGRAMS
     C           @CALL     CABEQ'NO '     #B9
     C*
     C***CALL*MM0074************************************************E12279S01319
     C*********************CALL*'MM0074'****************************E12279S01319
     C*********************PARM***********@TERM********************E12279*S01319
     C*********************PARM***********@ENQ**********************E12279S01319
     C*********************PARM***********MMSTDL********************E12279S01319
     C*********************PARM***********MMSTDB********************E12279S01319
     C*********************PARM***********MMSTDS********************E12279S01319
     C*********************PARM***********MMSTDA********************E12279S01319
     C*                                                                   S01319
      ** Only call MM0073, MM0075 and MM0094 if Treasury Management is    S01319
      ** present                                                          S01319
      *                                                                   S01319
     C           BGTRMG    IFEQ 'Y'                                       S01319
     C*
     C** CALL MM0075 - FORWARD BOOK  PDATE
     C                     CALL 'MM0075'
     C                     PARM           @TERM   1
     C                     PARM           @ENQ    1
     C                     PARM           MMSTDL
     C                     PARM           MMSTDB
     C                     PARM           MMSTDS
     C                     PARM           MMSTDA
     C*
     C** CALL MM0073
     C                     CALL 'MM0073'
     C                     PARM           @TERM
     C                     PARM           @ENQ
     C                     PARM           MMSTDL
     C                     PARM           MMSTDB
     C                     PARM           MMSTDS
     C                     PARM           MMSTDA
     C*
     C***CALL*MM0074                                                      E12279
     C**********           CALL 'MM0074'                                  E12279
     C**********           PARM           @TERM                           E12279
     C**********           PARM           @ENQ                            E12279
     C**********           PARM           MMSTDL                          E12279
     C**********           PARM           MMSTDB                          E12279
     C**********           PARM           MMSTDS                          E12279
     C**********           PARM           MMSTDA                          E12279
     C*
     C** CALL MM0094
     C                     CALL 'MM0094'
     C                     PARM           @TERM
     C                     PARM           @ENQ
     C                     PARM           MMSTDL
     C                     PARM           MMSTDB
     C                     PARM           MMSTDS
     C                     PARM           MMSTDA
     C*
     C                     END                                            S01319
     C*
     C           #B9       ENDSR                           ****#B9****
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BA      - Loans Deposits Processing                          *
     C*                                                               *
     C* CALLS    #BAA     - Loans Deposits Inserts                    *
     C*          #BAB     - Loans Deposits Amends                     *
     C*          #BAC     - Loans DEposits Deletes                    *
     C*                                                               *
     C* CALLED BY  #B     - Update Standard Deal                      *
     C*                                                               *
     C* FLDS USED  @DLUP  - Day of last update                        *
     C*            @MLUP  - Month of last update                      *
     C*            @YLUP  - Year of last update                       *
     C*            @UID   - User id                                   *
     C*                                                               *
     C*****************************************************************
     C           #BA       BEGSR
     C*
     C                     MOVE 'IK'      IKRCID
     C                     Z-ADD@DLUP     IKDLUP
     C                     MOVEL@MLUP     IKMLUP
     C                     Z-ADD@YLUP     IKYLUP
     C                     TIME           IKTLUP
     C                     MOVELIKLACT    IKCHTP
     C**************       Z-ADDRUND      IKLCD                           S01194
     C                     Z-ADDBJRDNB    IKLCD                           S01194
     C                     MOVEL@UID      IKLUID
      *                                                                   184828
      ** Initialise packed fields to prevent decimal data error           184828
      *                                                                   184828
     C                     Z-ADDHKDVSD    HKDVSD                          184828
     C                     Z-ADDHKDDND    HKDDND                          184828
     C                     Z-ADDHKNIPD    HKNIPD                          184828
     C                     Z-ADDHKSLID    HKSLID                          184828
     C                     Z-ADDHKNIPD    HKNIPD                          184828
     C                     Z-ADDHKMATD    HKMATD                          184828
      *                                                                   184828
     C                     Z-ADDHKFCGA    HKFCGA                          184828
     C                     Z-ADDHKFCGT    HKFCGT                          184828
     C                     Z-ADDHKFCMA    HKFCMA                          184828
     C                     Z-ADDHKFCMT    HKFCMT                          184828
      *                                                                   184828
     C                     Z-ADDHKPENA    HKPENA                          184828
     C                     Z-ADDHKCOLA    HKCOLA                          184828
      *                                                                   CEU003
      ** Setup the standard-effective-currency-workfield                  CEU003
      *                                                                   CEU003
     C                     MOVEL*BLANKS   WSECY   3                       CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           IKSTCY    ANDNE*BLANKS                                   CEU003
      *                                                                   CEU003
     C                     MOVELIKSTCY    WSECY                           CEU003
      *                                                                   CEU003
     C                     ELSE                                           CEU003
      *                                                                   CEU003
     C                     MOVELIKCCY     WSECY                           CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
      ** Setup the standard-interest-currency-workfield                   CEU003
      *                                                                   CEU003
     C                     MOVEL*BLANKS   WSICY   3                       CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           S01434    ANDEQ'Y'                                       CEU003
      *                                                                   CEU003
     C           IKIPDS    IFEQ 'Y'                                       CEU003
     C           IKISCY    ANDNE*BLANKS                                   CEU003
      *                                                                   CEU003
     C                     MOVELIKISCY    WSICY                           CEU003
      *                                                                   CEU003
     C                     ELSE                                           CEU003
      *                                                                   CEU003
     C           IKSTCY    IFNE *BLANKS                                   CEU003
     C                     MOVELIKSTCY    WSICY                           CEU003
     C                     ELSE                                           CEU003
     C                     MOVELIKCCY     WSICY                           CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C                     ELSE                                           CEU003
     C                     MOVELIKCCY     WSICY                           CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
      ** Setup the deals-effective-currency-workfield                     CEU003
     C                     MOVEL*BLANKS   WDECY   3                       CEU003
     C*
     C           IKLACT    CASEQ'I'       #BAA
     C           IKLACT    CASEQ'A'       #BAB
     C           IKLACT    CASEQ'X'       #BAB
     C           IKLACT    CASEQ'D'       #BAC
     C                     END
     C*
     C****WRITE*RECORD*TO*STANDARD*DEAL***********************************S01319
     C                     Z-ADDUDATE     IKMCHD
     C                     TIME           IKTIME
     C*********************WRITEMMSTDLP0**********************************S01319
     C*
     C           IKLACT    IFEQ 'X'                        B1
     C           IKMTYP    OREQ 'IL'                       B1             S01354
     C           IKMTYP    OREQ 'ID'                       B1             S01354
     C                     MOVEL'NO '     @CALL   3        *1
     C                     ELSE                            X1
     C                     MOVEL'YES'     @CALL            *1
     C                     END                             E1
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0078CCPG                                           S01408
     C*                                                                   S01408
     C           #BA9      ENDSR                           ****#BA9****
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BAA     - Loans Deposits Inserts                             *
     C*                                                               *
     C* CALLS    #ZA      - Loans Deposits Supplementary Fields       *
     C*          #Z       - Data base errors                          *
     C***********#ZC******-*Loans*Deposits*Download*Blotter***************S01319
     C*                                                               *
     C* CALLED BY  #BA    - Loans Deposits Processing                 *
     C*                                                               *
     C* FLDS USED  @STDL  - Loans Deposits Data Structure             *
     C*            @IKDAD - Associated Deal Number Numeric            *
     C*            @IKDEL - File update information                   *
     C*************@FB****-*Front/back*office*call************************S01319
     C*                                                               *
     C*****************************************************************
     C           #BAA      BEGSR
     C*
     C**  SET UP SUPPLEMENTARY FIELDS
     C                     EXSR #ZA
     C*
     C**  DEALS FILE PROCESSING
     C           IKDN38    CHAINMMDEAULL             61
     C*******              MOVELMMSTDL    @STDL                   *****   S01177
     C                     MOVEL@STDL     Z#BSTS                          082738
     C                     MOVE @LIDS1    @STDL1                          S01177
     C                     MOVE @LIDS2    @STDL2                          S01177
     C                     MOVE @LIDS3    @STDL3                          S01177
     C                     MOVE @LIDS4    @STDL4                          S01177
     C                     MOVE @LIDS5    @STDL5                          S01177
     C                     MOVE @LIDS6    @STDL6                          S01117
     C                     MOVE @LIDS7    @STDL7                          S01392
     C                     MOVE @LIDS8    @STDL8                          S01434
     C                     MOVE @LIDS9    @STDL9                          CAC001
     C                     MOVEL'HK'      HKRCID
     C                     MOVELIKDRID    HKDRID                          S01176
     C                     MOVELIKDDMR    HKDDMR                          S01176
     C                     MOVE IKCVMR    HKCVMR                          E22405
     C                     MOVELIKBOKC    HKBOKC                          E67
     C                     MOVELIKLNKN    HKLNKN                          E67
     C                     MOVE IKPTFR    HKPTFR                          S01486
     C                     MOVELIKSTCY    HKSTCY                          CEU003
     C                     MOVELIKISCY    HKISCY                          CEU003
     C                     MOVELIKIC72    HKIC72                          CEU003
     C                     MOVELIKII72    HKII72                          CEU003
     C                     MOVE IKRTFC    HKRTFC                          CEU015
     C                     Z-ADDIKORDA    HKORDA                          145001
     C                     Z-ADDIKDVSD    HKDVSD                          187861
     C                     Z-ADDIKDDND    HKDDND                          187861
     C*
     C           *IN61     IFEQ '0'                        B1
     C                     UPDATMMDELDP0                   *1
     C                     ELSE                            X1
     C                     Z-ADD0         HKBCAM                                              CLE025
     C                     WRITEMMDELDP0                   *1
     C                     END                             E1
     C/COPY WNCPYSRC,MM0078C006
     C*
     C                     MOVEL@STDL     Z#ASTS                          082738
      *                                                                   082738
     C**  IF ASSOCIATED DEAL FOUND ON DEALS FILE
     C           IKDADN    IFNE *BLANKS                    B1
     C           IKDADN    ANDNE*ZEROS                                    056211
     C           IKMTYP    ANDNE'IL'                       B1             S01354
     C           IKMTYP    ANDNE'ID'                       B1             S01354
     C           @IKDAD    CHAINMMDEAULL             61    *1
     C*
     C**  CHECK FOR DATA BASE ERROR
     C           *IN61     IFEQ '1'                        B2
     C                     MOVEL@IKDAD    DBKEY
     C                     MOVEL'MMDEAULL'DBFILE           ************
     C                     MOVEL'002'     DBASE            * DB ERR 02*
     C                     EXSR #Z                         ************
     C                     END                             E2
     C*
     C                     MOVE IKDN38    HKROBY           *1
      *                                                                   CEU015
     C           CEU015    IFEQ 'Y'                                       CEU015
     C           IKCCY     ANDEQBKEURO                                    CEU015
     C           IKRTFC    ANDNE*BLANKS                                   CEU015
     C                     MOVE IKCCY     HKRTFC                          CEU015
     C                     ELSE                                           CEU015
     C                     MOVE *BLANKS   HKRTFC                          CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
     C                     Z-ADD*ZERO     HKORDA                          145001
     C                     MOVEL'O'       HKRBSI           *1
     C                     MOVE 'Y'       HKWRPI                          S01434
     C                     MOVEL@IKDEL    @STDL            *1
     C                     MOVE 'HK'      HKRCID           *1
     C                     UPDATMMDELDP0                   *1
     C                     END                             E1
     C*
     C****DOWNLOAD*BLOTTER*PROCESSING*************************************S01319
     C***********@FB*******IFEQ*'F'************************B1*************S01319
     C***********IKDN38****CHAINMMDWD2LL*************61*****1*************S01319
     C*********************EXSR*#ZC*************************1*************S01319
     C************IN61*****IFEQ*'0'************************B*2************S01319
     C*********************UPDATMMDWNDP0*********************2************S01319
     C*********************ELSE****************************X*2************S01319
     C*********************WRITEMMDWNDP0*********************2************S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C***********IKDADN****IFNE**BLANKS********************B*2************S01319
     C***********@IKDAD****CHAINMMDWD2LL*************61******2************S01319
     C********************************************************************S01319
     C************IN61*****IFEQ*'0'************************B**3***********S01319
     C*********************MOVE*IKDN38****I1ROBY**************3***********S01319
     C*********************MOVEL'O'*******I1RBSI**************3***********S01319
     C*********************UPDATMMDWNDP0**********************3***********S01319
     C*********************END*****************************E**3***********S01319
     C********************************************************************S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C*********************END*****************************E1*************S01319
     C*
     C           #BAA9     ENDSR                           ****#BAA9***
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BAB     - Loans Deposits Amends                              *
     C*                                                               *
     C* CALLS    #ZA      - Loans Deposits Supplementary Fields       *
     C*          #ZB      - Loans Deposits Before Fields              *
     C*          #Z       - Data base errors                          *
     C***********#ZC******-*Loans*Deposits*Download*Blotter***************S01319
     C*                                                               *
     C* CALLED BY  #BA    - Loans Deposits Processing                 *
     C*                                                               *
     C* FLDS USED  @STDL  - Loans Deposits Data Structure             *
     C*************@FB****-*Front/back*office*call************************S01319
     C*                                                               *
     C*****************************************************************
     C           #BAB      BEGSR
     C*
     C**  SET UP SUPPLEMENTARY & BEFORE FIELDS
     C                     EXSR #ZA
     C                     EXSR #ZB
     C*
     C**  AMEND DEALS FILE
     C           IKDN38    CHAINMMDEAULL             61
     C*
     C                     MOVEL@STDL     Z#BSTS                          082738
      *                                                                   082738
     C**  CHECK FOR DATA BASE ERROR
     C           *IN61     IFEQ '1'                        B2
     C                     MOVELIKDN38    DBKEY            *2
     C                     MOVEL'MMDEAULL'DBFILE           ************
     C                     MOVEL'003'     DBASE            * DB ERR 03*
     C                     EXSR #Z                         ************
     C                     END                             E2
     C*
     C********             MOVELMMSTDL    @STDL                   *****   S01177
     C                     MOVE @LIDS1    @STDL1                          S01177
     C                     MOVE @LIDS2    @STDL2                          S01177
     C                     MOVE @LIDS3    @STDL3                          S01177
     C                     MOVE @LIDS4    @STDL4                          S01177
     C                     MOVE @LIDS5    @STDL5                          S01177
     C                     MOVE @LIDS6    @STDL6                          S01117
     C                     MOVE @LIDS7    @STDL7                          S01392
     C                     MOVE @LIDS8    @STDL8                          S01434
     C                     MOVE @LIDS9    @STDL9                          CAC001
     C                     MOVEL'HK'      HKRCID
     C                     MOVELIKDRID    HKDRID                          S01176
     C                     MOVELIKDDMR    HKDDMR                          S01176
     C                     MOVE IKCVMR    HKCVMR                          E22405
     C                     MOVELIKBOKC    HKBOKC                          E67
     C                     MOVELIKLNKN    HKLNKN                          E67
     C                     MOVE IKPTFR    HKPTFR                          S01486
     C                     MOVELIKSTCY    HKSTCY                          CEU003
     C                     MOVELIKIC72    HKIC72                          CEU003
     C                     MOVELIKISCY    HKISCY                          CEU003
     C                     MOVELIKII72    HKII72                          CEU003
     C                     MOVELIKRTFC    HKRTFC                          CEU015
     C                     Z-ADDIKORDA    HKORDA                          145001
     C                     Z-ADDIKMATD    HKMATD                                            MD026189
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0078CP12                                           S01408
     C*                                                                   S01408
     C                     UPDATMMDELDP0
     C/COPY WNCPYSRC,MM0078C007
     C*
     C                     MOVEL@STDL     Z#ASTS                          082738
      *                                                                   082738
     C****IF*FRONT*OFFICE*CALL*PERFORM*DOWNLOAD*BLOTTER*PROCESSING********S01319
     C***********@FB*******IFEQ*'F'************************B1*************S01319
     C***********IKDN38****CHAINMMDWD2LL*************61*****1*************S01319
     C*********************EXSR*#ZC*************************1*************S01319
     C********************************************************************S01319
     C************IN61*****IFEQ*'0'************************B*2************S01319
     C*********************UPDATMMDWNDP0*********************2************S01319
     C*********************ELSE****************************X*2************S01319
     C*********************WRITEMMDWNDP0*********************2************S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C*********************END*****************************E1*************S01319
     C*
     C           #BAB9     ENDSR                           ****#BAB9***
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BAC     - Loans DEposits Deletes                             *
     C*                                                               *
     C* CALLS    #ZA      - Loans Deposits Supplementary Fields       *
     C*          #Z       - Data base errors                          *
     C***********#ZC******-*Loans*Deposits*Download*Blotter***************S01319
     C*                                                               *
     C* CALLED BY  #BA    - Loans Deposits Processing                 *
     C*                                                               *
     C* FLDS USED  @STDL  - Loans Deposits Data Structure             *
     C*            @IKDAD - Associated Deal Number Numeric            *
     C*************@FB****-*Front/back*office*call************************S01319
     C*                                                               *
     C*****************************************************************
     C           #BAC      BEGSR
     C*
     C**  SET UP SUPPLEMENTARY FIELDS
     C                     EXSR #ZA
     C                     MOVEL'D'       IKDDLT
     C*
     C**  UPDATE DEALS FILE
     C           IKDN38    CHAINMMDEAULL             61
     C*
     C                     MOVEL@STDL     Z#BSTS                          082738
      *                                                                   082738
     C**  CHECK FOR DATA BASE ERROR
     C           *IN61     IFEQ '1'                        B1
     C                     MOVELIKDN38    DBKEY            *1
     C                     MOVEL'MMDEAULL'DBFILE           ************
     C                     MOVEL'004'     DBASE            * DB ERR 04*
     C                     EXSR #Z                         ************
     C                     END                             E1
     C*
     C                     MOVEL'D'       HKDDLT
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0078CDBU                                           S01408
     C*                                                                   S01408
     C*********************MOVELMMSTDL    @STDL                    E16413 S01177
     C                     MOVEL@IKDEL    @STDL                    E16413 S01177
     C                     MOVEL'HK'      HKRCID
     C                     UPDATMMDELDP0
     C/COPY WNCPYSRC,MM0078C008
     C*                                                                   062467
     C                     MOVEL@STDL     Z#ASTS                          082738
      *                                                                   082738
     C** Store Before Update Receive/Pay Branch values in DS              062467
     C** to return to MM0089 for use in subsequent shadow postings        062467
     C*                                                                   062467
     C                     MOVELHKROBR    IKBROB                          062467
     C                     MOVELHKPOBR    IKBPOB                          062467
     C*
     C**  CHECK FOR RELATED DEAL
     C           IKDADN    IFNE *BLANKS                    B1
     C           IKMTYP    ANDNE'IL'                       B1             S01354
     C           IKMTYP    ANDNE'ID'                       B1             S01354
     C           @IKDAD    CHAINMMDEAULL             61    *1
     C*
     C****CHECK*FOR*DATA*BASE*ERROR                                       E19013
     C************IN61*****IFEQ '1'                        B*2            E19013
     C*********************MOVEL@IKDAD    DBKEY            **2            E19013
     C*********************MOVEL'MMDEAULL'DBFILE           ************   E19013
     C*********************MOVEL'005'     DBASE            * DB ERR 05*   E19013
     C*********************EXSR #Z                         ************   E19013
     C*********************END                             E*2            E19013
     C*
     C           *IN61     IFNE '1'                        B2             E19013
     C                     MOVE *BLANKS   HKROBY           *1
     C                     MOVEL*BLANK    HKRBSI           *1
     C                     MOVE *BLANKS   HKWRPI                          109994
     C                     MOVE *BLANKS   HKRTFC                          CEU015
     C                     UPDATMMDELDP0                   *1
     C                     END                             E2             E19013
     C                     END                             E1
     C*
     C****DOWNLOAD*BLOTTER*PROCESSING*************************************S01319
     C***********@FB*******IFEQ*'F'************************B1*************S01319
     C***********IKDN38****CHAINMMDWD2LL*************61*****1*************S01319
     C********************************************************************S01319
     C************IN61*****IFEQ*'0'************************B*2************S01319
     C*********************MOVEL'D'*******I1DDLT*************2************S01319
     C*********************UPDATMMDWNDP0*********************2************S01319
     C********************************************************************S01319
     C*********************ELSE****************************X*2************S01319
     C********************************************************************S01319
     C*********************EXSR*#ZC**************************2************S01319
     C*********************MOVEL'D'*******I1DDLT*************2************S01319
     C*********************WRITEMMDWNDP0*********************2************S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C****CHECK*FOR*RELATED*DEAL******************************************S01319
     C***********IKDADN****IFNE**BLANKS********************B*2************S01319
     C***********@IKDAD****CHAINMMDWD2LL*************61******2************S01319
     C********************************************************************S01319
     C************IN61*****IFEQ*'0'************************B**3***********S01319
     C*********************MOVE**BLANK****I1RBSI**************3***********S01319
     C*********************MOVE**BLANKS***I1ROBY**************3***********S01319
     C*********************UPDATMMDWNDP0**********************3***********S01319
     C*********************END*****************************E**3***********S01319
     C********************************************************************S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C*********************END*****************************E1*************S01319
     C*
     C           #BAC9     ENDSR                           ****#BAC9***
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BB      - NAB Processing                                     *
     C*                                                               *
     C* CALLS    #BBA     - NAB Inserts                               *
     C*          #BBB     - NAB Amends                                *
     C*          #BBC     - NAB Deletes                               *
     C*                                                               *
     C* CALLED BY  #B     - Update Standard Deal                      *
     C*                                                               *
     C* FLDS USED  @DLUP  - Day of last update                        *
     C*            @MLUP  - Month of last update                      *
     C*            @YLUP  - Year of last update                       *
     C*            @UID   - User id                                   *
     C*                                                               *
     C*****************************************************************
     C           #BB       BEGSR
     C*
     C                     MOVE 'IH'      IHRCID
     C                     Z-ADD@DLUP     IHDLUP
     C                     MOVEL@MLUP     IHMLUP
     C                     Z-ADD@YLUP     IHYLUP
     C                     TIME           IHTLUP
     C                     MOVELIHLACT    IHCHTP
     C******************   Z-ADDRUND      IHLCD                           S01194
     C                     Z-ADDBJRDNB    IHLCD                           S01194
     C                     MOVEL@UID      IHLUID
      *                                                                   CEU003
      ** Setup the standard-effective-currency-workfield                  CEU003
      *                                                                   CEU003
     C                     MOVEL*BLANKS   WSECY                           CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           IHSTCY    ANDNE*BLANKS                                   CEU003
      *                                                                   CEU003
     C                     MOVELIHSTCY    WSECY                           CEU003
      *                                                                   CEU003
     C                     ELSE                                           CEU003
      *                                                                   CEU003
     C                     MOVELIHCCY     WSECY                           CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
      ** Setup the standard-interest-currency-workfield                   CEU003
     C                     MOVE *BLANKS   WSICY                           CEU003
      *                                                                   CEU003
      ** Setup the deals-effective-currency-workfield                     CEU003
     C                     MOVE *BLANKS   WDECY                           CEU003
     C*
     C           IHLACT    CASEQ'I'       #BBA
     C           IHLACT    CASEQ'A'       #BBB
     C           IHLACT    CASEQ'X'       #BBB
     C           IHLACT    CASEQ'S'       #BBB
     C           IHLACT    CASEQ'D'       #BBC
     C                     END
     C*
     C****WRITE*RECORD*TO*STANDARD*DEAL***********************************S01319
     C                     Z-ADDUDATE     IHMCHD
     C                     TIME           IHTIME
     C*********************WRITEMMSTDBP0**********************************S01319
     C*
     C           IHLACT    IFEQ 'X'                        B1
     C           IHLACT    OREQ 'S'                        B1
     C                     MOVEL'NO '     @CALL            *1
     C                     ELSE                            X1
     C                     MOVEL'YES'     @CALL            *1
     C                     END                             E1
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0078CCP6                                           S01408
     C*                                                                   S01408
     C           #BB9      ENDSR                           ****#BB9****
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BBA     - NAB Inserts                                        *
     C*                                                               *
     C* CALLS    #ZD      - NAB's Supplementary Fields                *
     C***********#ZG******-*NAB's*Download*Blotter************************S01319
     C*                                                               *
     C* CALLED BY  #BB    - NAB Processing                            *
     C*                                                               *
     C* FLDS USED  @STDB  - NAB's data structure                      *
     C*************@FB****-*Front/back*office*call************************S01319
     C*                                                               *
     C*****************************************************************
     C           #BBA      BEGSR
     C*
     C**  SET UP SUPPLEMENTARY FIELDS
     C                     EXSR #ZD
     C*
     C**  UPDATE DEALS FILE
     C           IHDN38    CHAINMMDEAULL             61
     C****                 MOVELMMSTDB    @STDB                   *****   S01177
     C                     MOVEL@STDB     Z#BSTS                          082738
     C                     MOVE @NABS1    @STDB1                          S01177
     C                     MOVE @NABS2    @STDB2                          S01177
     C                     MOVE @NABS3    @STDB3                          S01177
     C                     MOVE @NABS4    @STDB4                          S01177
     C                     MOVE @NABS5    @STDB5                          S01177
     C                     MOVE @NABS6    @STDB6                          S01117
     C                     MOVE @NABS7    @STDB7                          S01378
     C                     MOVE @NABS8    @STDB8                          CAC001
     C                     MOVE 'HL'      HLRCID
     C****************     MOVE IHCVMR    HLCVMR                    E22405S01378
     C                     MOVE IHRDFC    HLRDFC                          S01392
     C                     MOVE IHORBR    HLORBR                          059594
     C                     MOVELIHSTCY    HLSTCY                          CEU003
     C                     MOVELIHIC72    HLIC72                          CEU003
     C                     Z-ADDIHDVSD    HLDVSD                          187861
     C                     Z-ADDIHDDND    HLDDND                          187861
     C*
     C           *IN61     IFEQ '0'                        B1
     C                     UPDATMMDENBP0                   *1
     C                     ELSE                            X1
     C                     WRITEMMDENBP0                   *1
     C                     END                             E1
     C/COPY WNCPYSRC,MM0078C009
     C*
     C                     MOVEL@STDB     Z#ASTS                          082738
      *                                                                   082738
     C****WRITE*A*RECORD*TO*THE*DOWNLOAD*BLOTTER*(IF*FRONT*OFFICE*CALL)***S01319
     C***********@FB*******IFEQ*'F'************************B1*************S01319
     C***********IHDN38****CHAINMMDWD2LL*************61*****1*************S01319
     C*********************EXSR*#ZG*************************1*************S01319
     C********************************************************************S01319
     C************IN61*****IFEQ*'0'************************B*2************S01319
     C*********************UPDATMMDWNDP0*********************2************S01319
     C*********************ELSE****************************X*2************S01319
     C*********************WRITEMMDWNDP0*********************2************S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C*********************END*****************************E1*************S01319
     C*
     C           #BBA9     ENDSR                           ****#BBA9***
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BBB     - NAB Amends                                         *
     C*                                                               *
     C* CALLS    #ZD      - NAB's Supplementary Fields                *
     C*          #ZE      - NAB's Before Fields                       *
     C*          #Z       - Data base errors                          *
     C***********#ZG******-*NAB's*Download*Blotter************************S01319
     C*                                                               *
     C* CALLED BY  #BB    - NAB Processing                            *
     C*                                                               *
     C* FLDS USED  @STDB  - NAB's data structure                      *
     C*            @IHDAD - File update information                   *
     C*            @HLNIY - Next interest date                        *
     C*            @HMNIY - Next interest date                        *
     C*            @HLLIY - Last interest date                        *
     C*            @HMLIY - Last interest date                        *
     C*            @HLMDY - Maturity Date                             *
     C*            @HMMDY - Maturity Date                             *
     C*************@FB****-*Front/back*office*call************************S01319
     C*            @DOWNF - Download Blotter Ocur Data Structure      *
     C*                                                               *
     C*****************************************************************
     C           #BBB      BEGSR
     C*
     C**  UPDATE SUPPLEMENTARY & BEFORE FIELDS
     C                     EXSR #ZD
     C                     EXSR #ZE
     C*
     C**  UPDATE RELATED FIELDS IF RELATED NAS
     C           IHDADN    CASNE*BLANK    #ZF
     C                     END
     C*
     C**  UPDATE DEALS FILE
     C           IHDN38    CHAINMMDEAULL             61
     C*
     C                     MOVEL@STDB     Z#BSTS                          082738
      *                                                                   082738
     C**  CHECK FOR DATA BASE ERROR
     C           *IN61     IFEQ '1'                        B1
     C                     MOVELIHDN38    DBKEY            *1
     C                     MOVEL'MMDEAULL'DBFILE           ************
     C                     MOVEL'006'     DBASE            * DB ERR 06*
     C                     EXSR #Z                         ************
     C                     END                             E1
     C*
     C********             MOVELMMSTDB    @STDB                   *****   S01177
     C                     MOVE @NABS1    @STDB1                          S01177
     C                     MOVE @NABS2    @STDB2                          S01177
     C                     MOVE @NABS3    @STDB3                          S01177
     C                     MOVE @NABS4    @STDB4                          S01177
     C                     MOVE @NABS5    @STDB5                          S01177
     C                     MOVE @NABS6    @STDB6                          S01117
     C                     MOVE @NABS7    @STDB7                          S01378
     C                     MOVE @NABS8    @STDB8                          CAC001
     C                     MOVE 'HL'      HLRCID
     C***********          MOVE IHCVMR    HLCVMR                    E22405S01378
     C                     MOVE IHRDFC    HLRDFC                          S01392
     C                     MOVE IHORBR    HLORBR                          059594
     C                     MOVELIHSTCY    HLSTCY                          CEU003
     C                     MOVELIHIC72    HLIC72                          CEU003
     C                     UPDATMMDENBP0
     C/COPY WNCPYSRC,MM0078C010
     C*
     C                     MOVEL@STDB     Z#ASTS                          082738
      *                                                                   082738
     C**  IF RELATED DEAL EXISTS UPDATE RELATED RECORD ON DEALS FILE
     C           IHDADN    IFNE *BLANK                     B1
     C           @IHDAD    CHAINMMDEAULL             61    *1
     C*
     C**  CHECK FOR DATA BASE ERROR
     C           *IN61     IFEQ '1'                        B*2
     C                     MOVEL@IHDAD    DBKEY            **2
     C                     MOVEL'MMDEAULL'DBFILE           ************
     C                     MOVEL'007'     DBASE            * DB ERR 07*
     C                     EXSR #Z                         ************
     C                     END                             E*2
     C*
     C                     MOVELHLDBRC    HMDBRC           *1
     C                     MOVELHLCDRF    HMCDRF           *1
     C                     Z-ADD@HLNIY    @HMNIY           *1
     C                     MOVELHLIPFQ    HMIPFQ           *1
     C                     MOVELHLICMT    HMICMT           *1
     C                     Z-ADDHLIPDM    HMIPDM           *1
     C                     Z-ADDHLFVAL    HMFVAL           *1
     C                     MOVELHLISUR    HMISUR           *1
     C                     Z-ADD@HLLIY    @HMLIY           *1
     C                     Z-ADDHLFRAT    HMFRAT           *1
     C                     Z-ADD@HLMDY    @HMMDY           *1
     C                     UPDATMMDENSP0                   *1
     C                     END                             E1
     C*
     C****IF*FRONT*OFFICE*CALL*UPDATE*DOWNLOAD*BLOTTER********************S01319
     C***********@FB*******IFEQ*'F'************************B1*************S01319
     C***********IHDN38****CHAINMMDWD2LL*************61*****1*************S01319
     C*********************EXSR*#ZG*************************1*************S01319
     C********************************************************************S01319
     C************IN61*****IFEQ*'0'************************B*2************S01319
     C*********************UPDATMMDWNDP0*********************2************S01319
     C*********************ELSE****************************X*2************S01319
     C*********************WRITEMMDWNDP0*********************2************S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C****IF*RELATED*DEAL*EXISTS*UPDATE*RELATED*RECORD*ON*BLOTTER*FILE****S01319
     C***********IHDADN****IFNE**BLANK*********************B*2************S01319
     C***********2*********OCUR*@DOWNF***********************2************S01319
     C***********@IHDAD****CHAINMMDWD2LL*************61******2************S01319
     C***********1*********OCUR*@DOWNF***********************2************S01319
     C********************************************************************S01319
     C************IN61*****IFEQ*'0'************************B**3***********S01319
     C*********************UPDATMMDWNDP0**********************3***********S01319
     C*********************END*****************************E**3***********S01319
     C********************************************************************S01319
     C*********************END*****************************E*2************S01319
     C*********************END*****************************E1*************S01319
     C*
     C           #BBB9     ENDSR                           ***#BBB9***
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BBC     - NAB Deletes                                        *
     C*                                                               *
     C* CALLS    #ZD      - NAB's Supplementary Fields                *
     C*          #Z       - Data base errors                          *
     C***********#ZG******-*NAB's*Download*Blotter************************S01319
     C*                                                               *
     C* CALLED BY  #BB    - NAB Processing                            *
     C*                                                               *
     C* FLDS USED  @IHDEL - File update information                   *
     C*            @STDB  - NAB's data structure                      *
     C*************@FB****-*Front/back*office*call************************S01319
     C*                                                               *
     C*****************************************************************
     C           #BBC      BEGSR
     C*
     C**  SET UP SUPPLEMENTARY & RELATED FIELDS
     C                     EXSR #ZD
     C           IHDADN    CASNE*BLANK    #ZF
     C                     END
     C*
     C                     MOVEL'D'       IHDDLT
     C*
     C**  CHAIN TO DEALS FILE
     C           IHDN38    CHAINMMDEAULL             61
     C*
     C                     MOVEL@STDB     Z#BSTS                          082738
      *                                                                   082738
     C**  CHECK FOR DATA BASE ERROR
     C           *IN61     IFEQ '1'                        B1
     C                     MOVELIHDN38    DBKEY            *1
     C                     MOVEL'MMDEAULL'DBFILE           ************
     C                     MOVEL'008'     DBASE            * DB ERR 08*
     C                     EXSR #Z                         ************
     C                     END                             E1
     C*
     C                     MOVEL'D'       HLDDLT
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0078CCP8                                           S01408
     C*                                                                   S01408
     C                     MOVEL@IHDEL    @STDB
     C                     MOVEL'HL'      HLRCID
     C                     UPDATMMDENBP0
     C/COPY WNCPYSRC,MM0078C011
     C*
     C                     MOVEL@STDB     Z#ASTS                          082738
      *                                                                   082738
     C****CHAIN*TO*DOWNLOAD*BLOTTER*(IF*FRONT*OFFICE*CALL)****************S01319
     C***********@FB*******IFEQ*'F'************************B1*************S01319
     C***********IHDN38****CHAINMMDWD2LL*************61*****1*************S01319
     C*********************EXSR*#ZG*************************1*************S01319
     C********************************************************************S01319
     C************IN61*****IFEQ*'0'************************B*2************S01319
     C*********************UPDATMMDWNDP0*********************2************S01319
     C*********************ELSE****************************X*2************S01319
     C*********************WRITEMMDWNDP0*********************2************S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C*********************END*****************************E1*************S01319
     C*
     C           #BBC9     ENDSR                           ****#BBC9***
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BC      - NAS Processing                                     *
     C*                                                               *
     C* CALLS    #BCA     - NAS Inserts                               *
     C*          #BCB     - NAS Amends                                *
     C*          #BCC     - NAS Deletes                               *
     C*                                                               *
     C* CALLED BY  #B     - Update Standard Deal                      *
     C*                                                               *
     C* FLDS USED  @DLUP  - Day of last update                        *
     C*            @MLUP  - Month of last update                      *
     C*            @YLUP  - Year of last update                       *
     C*            @UID   - User id                                   *
     C*                                                               *
     C*****************************************************************
     C           #BC       BEGSR
     C*
     C                     MOVE 'IL'      ILRCID
     C                     Z-ADD@DLUP     ILDLUP
     C                     MOVEL@MLUP     ILMLUP
     C                     Z-ADD@YLUP     ILYLUP
     C                     TIME           ILTLUP
     C                     MOVELILLACT    ILCHTP
     C******************   Z-ADDRUND      ILLCD                           S01194
     C                     Z-ADDBJRDNB    ILLCD                           S01194
     C                     MOVEL@UID      ILLUID
      *                                                                   CEU003
      ** Setup the standard-effective-currency-workfield                  CEU003
      *                                                                   CEU003
     C                     MOVEL*BLANKS   WSECY                           CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           ILSTCY    ANDNE*BLANKS                                   CEU003
      *                                                                   CEU003
     C                     MOVELILSTCY    WSECY                           CEU003
      *                                                                   CEU003
     C                     ELSE                                           CEU003
      *                                                                   CEU003
     C                     MOVELILCCY     WSECY                           CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
      ** Setup the standard-interest-currency-workfield                   CEU003
     C                     MOVE *BLANKS   WSICY                           CEU003
      *                                                                   CEU003
      ** Setup the deals-effective-currency-workfield                     CEU003
     C                     MOVE *BLANKS   WDECY                           CEU003
     C*
     C           ILLACT    CASEQ'I'       #BCA
     C           ILLACT    CASEQ'A'       #BCB
     C           ILLACT    CASEQ'X'       #BCB
     C           ILLACT    CASEQ'D'       #BCC
     C                     END
     C*
     C****WRITE*RECORD*TO*STANDARD*DEAL***********************************S01319
     C                     Z-ADDUDATE     ILMCHD
     C                     TIME           ILTIME
     C*********************WRITEMMSTDSP0**********************************S01319
     C*
     C           ILLACT    IFEQ 'X'                        B1
     C                     MOVEL'NO '     @CALL            *1
     C                     ELSE                            X1
     C                     MOVEL'YES'     @CALL            *1
     C                     END                             E1
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0078CCP7                                           S01408
     C*                                                                   S01408
     C           #BC9      ENDSR                           ****#BC9****
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BCA     - NAS Inserts                                        *
     C*                                                               *
     C* CALLS    #ZH      - NAS's Supplementary Fields                *
     C*          #ZJ      - NAS's Related Fields                      *
     C*          #Z       - Data base errors                          *
     C***********#ZK******-*NAS's*Download*Blotter************************S01319
     C*                                                               *
     C* CALLED BY  #BC    - NAS Processing                            *
     C*                                                               *
     C* FLDS USED  @STDS  - NAS data structure                        *
     C*            @ILDAD - Associated deal number numeric            *
     C*************@FB****-*Front/back*office*call************************S01319
     C*                                                               *
     C*****************************************************************
     C           #BCA      BEGSR
     C*
     C**  SET UP SUPPLEMENTARY, RELATED FIELDS
     C                     EXSR #ZH
     C                     EXSR #ZJ
     C*
     C**  WRITE RECORD TO THE DEALS FILE
     C           ILDN38    CHAINMMDEAULL             61
     C********             MOVELMMSTDS    @STDS                   *****   S01177
     C                     MOVEL@STDS     Z#BSTS                          082738
     C                     MOVE @NASS1    @STDS1                          S01177
     C                     MOVE @NASS2    @STDS2                          S01177
     C                     MOVE @NASS3    @STDS3                          S01177
     C                     MOVE @NASS4    @STDS4                          S01177
     C                     MOVE @NASS5    @STDS5                          S01177
     C                     MOVE @NASS6    @STDS6                          S01117
     C                     MOVE @NASS7    @STDS7                          S01378
     C                     MOVEL'HM'      HMRCID
     C                     MOVE ILCVMR    HMCVMR                          E22405
     C                     MOVELILSTCY    HMSTCY                          CEU003
     C                     MOVELILIC72    HMIC72                          CEU003
     C                     Z-ADDILDVSD    HMDVSD                          187861
     C                     Z-ADDILDDND    HMDDND                          187861
     C*
     C           *IN61     IFEQ '0'                        B1
     C                     UPDATMMDENSP0                   *1
     C                     ELSE                            X1
     C                     WRITEMMDENSP0                   *1
     C                     END                             E1
     C/COPY WNCPYSRC,MM0078C012
     C*
     C                     MOVEL@STDS     Z#ASTS                          082738
      *                                                                   082738
     C**  UPDATE RELATED RECORD
     C           @ILDAD    CHAINMMDEAULL             61
     C*
     C**  CHECK FOR DATA BASE ERROR
     C           *IN61     IFEQ '1'                        B1
     C                     MOVEL@ILDAD    DBKEY            *1
     C                     MOVEL'MMDEAULL'DBFILE           ************
     C                     MOVEL'009'     DBASE            * DB ERR 09*
     C                     EXSR #Z                         ************
     C                     END                             E1
     C*
     C                     MOVEL@STDB     Z#WSTS                          082738
      *                                                                   082738
     C** If parcelled NA must update number sold/not sold fields          S01378
     C** on NAB. Check the Parcel indicator on the NA bought file.        S01378
     C** Also blanks out associated deal number, there may be many.       S01378
     C** Note: On the NAB record the No. sold/not sold are maintained     S01378
     C** here, during CoB DL0280 reduces Parcel size, Purchase amount,    S01378
     C** Face value (on NAB rcd) to reflect the sold portion.             S01378
     C           HLPCLI    IFEQ 'P'                        B1             S01378
     C                     ADD  ILPSZE    HLNSLD           *1             S01378
     C                     SUB  ILPSZE    HLNSDD           *1             S01378
     C                     MOVE *BLANKS   HLDADN           *1             S01378
     C                     ELSE                            X1             S01378
     C*                                                                   S01378
     C** if not parcelled can update with single related deal number      S01378
     C                     MOVELILDN38    HLDADN
     C                     END                             E1             S01378
     C*****                MOVEL'S'       HLRBSI
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0078CCP2                                           S01408
     C*                                                                   S01408
     C                     UPDATMMDENBP0
     C*
     C****WRITE*RECORD*TO*THE*DOWNLOAD*BLOTTER****************************S01319
     C***********@FB*******IFEQ*'F'************************B1*************S01319
     C***********ILDN38****CHAINMMDWD2LL*************61*****1*************S01319
     C*********************EXSR*#ZK*************************1*************S01319
     C********************************************************************S01319
     C************IN61*****IFEQ*'0'************************B*2************S01319
     C*********************UPDATMMDWNDP0*********************2************S01319
     C*********************ELSE****************************X*2************S01319
     C*********************WRITEMMDWNDP0*********************2************S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C****UPDATE*RELATED*RECORD*IF*IT*EXISTS*ON*BLOTTER*******************S01319
     C***********@ILDAD****CHAINMMDWD2LL*************61*****1*************S01319
     C********************************************************************S01319
     C************IN61*****IFEQ*'0'************************B*2************S01319
     C*********************MOVEL'S'*******I1RBSI*************2************S01319
     C*********************MOVE*HMDN38****I1ROBY*************2************S01319
     C*********************UPDATMMDWNDP0*********************2************S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C*********************END*****************************E1*************S01319
     C*
     C           #BCA9     ENDSR                           ***#BCA9***
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BCB     - NAS Amends                                         *
     C*                                                               *
     C* CALLS    #ZH      - NAS's Supplementary Fields                *
     C*          #ZI      - MAS's Before Fields                       *
     C*          #ZJ      - NAS's Related Fields                      *
     C*          #Z       - Data base errors                          *
     C***********#ZK******-*NAS's*Download*Blotter************************S01319
     C*                                                               *
     C* CALLED BY  #BC    - NAS Processing                            *
     C*                                                               *
     C* FLDS USED  @STDS  - NAS data structure                        *
     C*************@FB****-*Front/back*office*call************************S01319
     C*                                                               *
     C*****************************************************************
     C           #BCB      BEGSR
     C*
     C**  SET UP SUPPLEMENTARY, RELATED & BEFORE FIELDS
     C                     EXSR #ZH
     C                     EXSR #ZI
     C                     EXSR #ZJ
     C*
     C**  UPDATE DEALS FILE
     C           ILDN38    CHAINMMDEAULL             61
     C*
     C                     MOVEL@STDS     Z#BSTS                          082738
      *                                                                   082738
     C**  CHECK FOR DATA BASE ERROR
     C           *IN61     IFEQ '1'                        B1
     C                     MOVELILDN38    DBKEY            *1
     C                     MOVEL'MMDEAULL'DBFILE           ************
     C                     MOVEL'010'     DBASE            * DB ERR 10*
     C                     EXSR #Z                         ************
     C                     END                             E1
     C*
     C*****                MOVELMMSTDS    @STDS                   *****   S01177
     C                     MOVE @NASS1    @STDS1                          S01177
     C                     MOVE @NASS2    @STDS2                          S01177
     C                     MOVE @NASS3    @STDS3                          S01177
     C                     MOVE @NASS4    @STDS4                          S01177
     C                     MOVE @NASS5    @STDS5                          S01177
     C                     MOVE @NASS6    @STDS6                          S01117
     C                     MOVE @NASS7    @STDS7                          S01378
     C                     MOVEL'HM'      HMRCID
     C***********          MOVE ILCVMR    HMCVMR                    E22405S01378
     C                     MOVELILSTCY    HMSTCY                          CEU003
     C                     MOVELILIC72    HMIC72                          CEU003
     C                     UPDATMMDENSP0
     C/COPY WNCPYSRC,MM0078C013
     C*
     C                     MOVEL@STDS     Z#ASTS                          082738
      *                                                                   082738
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0078CCP3                                           S01408
     C*                                                                   S01408
     C****UPDATE*DOWNLOAD*BLOTTER*****************************************S01319
     C***********@FB*******IFEQ*'F'************************B1*************S01319
     C***********ILDN38****CHAINMMDWD2LL*************61*****1*************S01319
     C*********************EXSR*#ZK*************************1*************S01319
     C********************************************************************S01319
     C************IN61*****IFEQ*'0'************************B*2************S01319
     C*********************UPDATMMDWNDP0*********************2************S01319
     C*********************ELSE****************************X*2************S01319
     C*********************WRITEMMDWNDP0*********************2************S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C*********************END*****************************E1*************S01319
     C*
     C           #BCB9     ENDSR                           ***#BCB9***
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BCC     - NAS Deletes                                        *
     C*                                                               *
     C* CALLS    #ZH      - NAS's Supplementary Fields                *
     C*          #Z       - Data base errors                          *
     C***********#ZK******-*NAS's*Download*Blotter************************S01319
     C*                                                               *
     C* CALLED BY  #BC    - NAS Processing                            *
     C*                                                               *
     C* FLDS USED  @ILDEL - File update information                   *
     C*            @STDS  - NAS data structure                        *
     C*************@FB****-*Front/back*office*call************************S01319
     C*                                                               *
     C*****************************************************************
     C           #BCC      BEGSR
     C*
     C**  SET UP SUPPLEMENTARY & RELATED FIELDS
     C                     EXSR #ZH
     C           ILDADN    CASNE*BLANK    #ZJ
     C                     END
     C*
     C                     MOVEL'D'       ILDDLT
     C*
     C**  CHAIN TO DEALS FILE
     C           ILDN38    CHAINMMDEAULL             61
     C*
     C                     MOVEL@STDS     Z#BSTS                          082738
      *                                                                   082738
     C**  CHECK FOR DATA BASE ERROR
     C           *IN61     IFEQ '1'                        B1
     C                     MOVELILDN38    DBKEY            *1
     C                     MOVEL'MMDEAULL'DBFILE           ************
     C                     MOVEL'011'     DBASE            * DB ERR 11*
     C                     EXSR #Z                         ************
     C                     END                             E1
     C*
     C                     MOVEL'D'       HMDDLT
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0078CCP9                                           S01408
     C*                                                                   S01408
     C                     MOVEL@ILDEL    @STDS
     C                     MOVEL'HM'      HMRCID
     C                     UPDATMMDENSP0
     C/COPY WNCPYSRC,MM0078C014
     C*
     C                     MOVEL@STDS     Z#ASTS                          082738
      *                                                                   082738
     C**  UPDATE RELATED RECORD
     C           @ILDAD    CHAINMMDEAULL             61
     C*
     C**  CHECK FOR DATA BASE ERROR
     C           *IN61     IFEQ '1'                        B1
     C                     MOVEL@ILDAD    DBKEY            *1
     C                     MOVEL'MMDEAULL'DBFILE           ************
     C                     MOVEL'009'     DBASE            * DB ERR 09*
     C                     EXSR #Z                         ************
     C                     END                             E1
      *                                                                   S01378
     C                     MOVEL@STDB     Z#WSTS                          082738
      *                                                                   082738
      ** If NA is parcelled must update number sold/unsold on related     S01378
      ** NAB record.                                                      S01378
     C** Note: On the NAB record the No. sold/not sold are maintained     S01378
     C** here, during CoB DL0280 updates Parcel size, Purchase amount,    S01378
     C** Face value (on NAB rcd) to reflect the deleted sold portion.     S01378
     C           HLPCLI    IFEQ 'P'                        B1             S01378
     C                     SUB  HMPSZE    HLNSLD           *1             S01378
     C                     ADD  HMPSZE    HLNSDD           *1             S01378
     C                     END                             E1             S01378
     C*
     C                     MOVE *BLANK    HLDADN
     C*******              MOVEL*BLANK    HLRBSI
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0078CCP4                                           S01408
     C*                                                                   S01408
     C                     UPDATMMDENBP0
     C*
     C****CHAIN*TO*DOWNLOAD*BLOTTER*(IF*FRONT*OFFICE*CALL)****************S01319
     C***********@FB*******IFEQ*'F'************************B1*************S01319
     C***********ILDN38****CHAINMMDWD2LL*************61*****1*************S01319
     C*********************EXSR*#ZK*************************1*************S01319
     C********************************************************************S01319
     C************IN61*****IFEQ*'0'************************B*2************S01319
     C*********************UPDATMMDWNDP0*********************2************S01319
     C*********************ELSE****************************X*2************S01319
     C*********************WRITEMMDWNDP0*********************2************S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C****UPDATE*RELATED*RECORD*IF*IT*EXISTS*ON*BLOTTER*******************S01319
     C***********@ILDAD****CHAINMMDWD2LL*************61*****1*************S01319
     C********************************************************************S01319
     C************IN61*****IFEQ*'0'************************B*2************S01319
     C*********************MOVE**BLANK****I1RBSI*************2************S01319
     C*********************MOVE**BLANK****I1ROBY*************2************S01319
     C*********************UPDATMMDWNDP0*********************2************S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C*********************END*****************************E1*************S01319
     C*
     C           #BCC9     ENDSR                           ****#BCC9***
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BD      - Deam Processing                                    *
     C*                                                               *
     C* CALLS    #BDA     - Deam Inserts                              *
     C*          #BDB     - Deam Amends                               *
     C*          #BDC     - Deam Deletes                              *
     C*                                                               *
     C* CALLED BY  #B     - Update Standard Deal                      *
     C*                                                               *
     C* FLDS USED  @DLUP  - Day of last update                        *
     C*            @MLUP  - Month of last update                      *
     C*            @YLUP  - Year of last update                       *
     C*            @UID   - User id                                   *
     C*                                                               *
     C*****************************************************************
     C           #BD       BEGSR
     C*
     C                     MOVE 'IG'      IGRCID
     C                     Z-ADD@DLUP     IGDLUP
     C                     MOVEL@MLUP     IGMLUP
     C                     Z-ADD@YLUP     IGYLUP
     C                     TIME           IGTLUP
     C                     MOVELIGLACT    IGCHTP
     C******************   Z-ADDRUND      IGLCD                           S01194
     C                     Z-ADDBJRDNB    IGLCD                           S01194
     C                     MOVEL@UID      IGLUID
      *                                                                   CEU003
      ** Setup the standard-effective-currency-workfield                  CEU003
      *                                                                   CEU003
     C                     MOVEL*BLANKS   WSECY                           CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           IGSTCY    ANDNE*BLANKS                                   CEU003
      *                                                                   CEU003
     C                     MOVELIGSTCY    WSECY                           CEU003
      *                                                                   CEU003
     C                     ELSE                                           CEU003
      *                                                                   CEU003
     C                     MOVELIGCCY     WSECY                           CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
      ** Setup the standard-interest-currency-workfield                   CEU003
     C                     MOVE *BLANKS   WSICY                           CEU003
      *                                                                   CEU003
      ** Setup the deals-effective-currency-workfield                     CEU003
     C                     MOVE *BLANKS   WDECY                           CEU003
     C*
     C           IGLACT    CASEQ'I'       #BDA
     C           IGLACT    CASEQ'A'       #BDB
     C           IGLACT    CASEQ'X'       #BDB
     C           IGLACT    CASEQ'D'       #BDC
     C                     END
     C*
     C****WRITE*RECORD*TO*STANDARD*DEAL***********************************S01319
     C                     Z-ADDUDATE     IGMCHD
     C                     TIME           IGTIME
     C*********************WRITEMMSTDAP0**********************************S01319
     C*
     C           IGLACT    IFEQ 'X'                        B1
     C           IGOGDT    OREQ 'IL'                                      S01354
     C           IGOGDT    OREQ 'ID'                                      S01354
     C                     MOVEL'NO '     @CALL            *1
     C                     ELSE                            X1
     C                     MOVEL'YES'     @CALL            *1
     C                     END                             E1
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0078CCP1                                           S01408
     C*                                                                   S01408
     C*
     C           #BD9      ENDSR                           ****#BD9****
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BDA     - Deam Inserts                                       *
     C*                                                               *
     C* CALLS    #ZL      - Deams Supplementary Fields                *
     C***********#ZO******-*Deams*Download*Blotter************************S01319
     C*                                                               *
     C* CALLED BY  #BD    - Deam Processing                           *
     C*                                                               *
     C* FLDS USED  @DEAMK - Deam file key                             *
     C*            @STDA  - Deam data structure                       *
     C*************@FB****-*Front/back*office*call************************S01319
     C*                                                               *
     C*****************************************************************
     C           #BDA      BEGSR
     C*
     C**  SET UP SUPPLEMENTARY & RELATED FIELDS
     C                     EXSR #ZL
     C*
     C**  WRITE RECORD TO DEAMS FILE
     C           @DEAMK    CHAINMMDAMULL             61
     C*****                MOVELMMSTDA    @STDA                   *****   S01177
     C                     MOVEL@STDA     Z#BSTS                          082738
     C                     MOVE @MDAM1    @STDA1                          S01177
     C                     MOVE @MDAM2    @STDA2                          S01177
     C                     MOVE @MDAM3    @STDA3                          S01177
     C                     MOVE @MDAM4    @STDA4                          S01177
     C                     MOVE @MDAM5    @STDA5                          S01177
     C                     MOVE @MDAM6    @STDA6                          S01117
     C                     MOVE @MDAM7    @STDA7                          E49965
     C                     MOVE @MDAM8    @STDA8                          CAC001
     C                     MOVEL'HN'      HNRCID
     C                     MOVE IGCVMR    HNCVMR                          E22405
     C                     MOVE HNOGDT    IGOGDT                          ME????
     C                     MOVELIGSTCY    HNSTCY                          CEU003
     C                     MOVELIGIC72    HNIC72                          CEU003
     C*
     C           *IN61     IFEQ '0'                        B1
     C                     UPDATMMDEAMP0                   *1
     C                     ELSE                            X1
     C                     WRITEMMDEAMP0                   *1
     C                     END                             E1
     C*
     C                     MOVEL@STDA     Z#ASTS                          082738
      *                                                                   082738
     C****WRITE*DOWNLOAD*BLOTTER******************************************S01319
     C***********@FB*******IFEQ*'F'************************B1*************S01319
     C***********@DEAMK****CHAINMMDWA2LL*************61*****1*************S01319
     C*********************EXSR*#ZO*************************1*************S01319
     C********************************************************************S01319
     C************IN61*****IFEQ*'0'************************B*2************S01319
     C*********************UPDATMMDWNAP0*********************2************S01319
     C*********************ELSE****************************X*2************S01319
     C*********************WRITEMMDWNAP0*********************2************S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C*********************END*****************************E1*************S01319
     C*
     C           #BDA9     ENDSR                           ***#BDA9***
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BDB     - Deam Amends                                        *
     C*                                                               *
     C* CALLS    #ZL      - Deams Supplementary Fields                *
     C*          #ZM      - Deams Before Fields                       *
     C*          #Z       - Data base errors                          *
     C***********#ZO******-*Deams*Download*Blotter************************S01319
     C*                                                               *
     C* CALLED BY  #BD    - Deam Processing                           *
     C*                                                               *
     C* FLDS USED  @DEAMK - Deam file key                             *
     C*            @STDA  - Deam data structure                       *
     C*************@FB****-*Front/back*office*call************************S01319
     C*                                                               *
     C*****************************************************************
     C           #BDB      BEGSR
     C*
     C**  SET UP SUPPLEMENTARY, RELATED & BEFORE FIELDS
     C                     EXSR #ZM                                       083409
     C                     EXSR #ZL
     C*********************EXSR #ZM                                       083409
     C*
     C**  UPDATE DEAMS FILE
     C           @DEAMK    CHAINMMDAMULL             61
     C*
     C                     MOVEL@STDA     Z#BSTS                          082738
      *                                                                   082738
     C**  CHECK FOR DATA BASE ERROR
     C           *IN61     IFEQ '1'                        B1
     C                     Z-ADDIGDA38    @WK6N            *1
     C                     Z-ADD@IGVDY    @WK8N            *1
     C                     Z-ADDIGDS38    @WK3N            *1
     C                     MOVEL'MMDAMULL'DBFILE           ************
     C                     MOVEL'012'     DBASE            * DB ERR 12*
     C                     EXSR #Z                         ************
     C                     END                             E1
     C*
     C********             MOVELMMSTDA    @STDA                   *****   S01177
     C                     MOVE @MDAM1    @STDA1                          S01177
     C                     MOVE @MDAM2    @STDA2                          S01177
     C                     MOVE @MDAM3    @STDA3                          S01177
     C                     MOVE @MDAM4    @STDA4                          S01177
     C                     MOVE @MDAM5    @STDA5                          S01177
     C                     MOVE @MDAM6    @STDA6                          S01117
     C                     MOVE @MDAM7    @STDA7                          E49965
     C                     MOVE @MDAM8    @STDA8                          CAC001
     C                     MOVEL'HN'      HNRCID
     C                     MOVE IGCVMR    HNCVMR                          E22405
     C                     MOVELIGSTCY    HNSTCY                          CEU003
     C                     MOVELIGIC72    HNIC72                          CEU003
     C                     UPDATMMDEAMP0
     C*
     C                     MOVEL@STDA     Z#ASTS                          082738
      *                                                                   082738
     C****UPDATE*DOWNLOAD*BLOTTER*****************************************S01319
     C***********@FB*******IFEQ*'F'************************B1*************S01319
     C***********@DEAMK****CHAINMMDWA2LL*************61*****1*************S01319
     C*********************EXSR*#ZO*************************1*************S01319
     C********************************************************************S01319
     C************IN61*****IFEQ*'0'************************B*2************S01319
     C*********************UPDATMMDWNAP0*********************2************S01319
     C*********************ELSE****************************X*2************S01319
     C*********************WRITEMMDWNAP0*********************2************S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C*********************END*****************************E1*************S01319
     C*
     C           #BDB9     ENDSR                           ***#BDB9***
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BDC     - Deam Deletes                                       *
     C*                                                               *
     C* CALLS    #ZL      - Deams Supplementary Fields                *
     C*          #ZM      - Deams Before Fields                       *
     C*          #Z       - Data base errors                          *
     C***********#ZO******-*NAS's*Download*Blotter************************S01319
     C*                                                               *
     C* CALLED BY  #BD    - Deam Processing                           *
     C*                                                               *
     C* FLDS USED  @DEAMK - Deam file key                             *
     C*            @IGDEL - File update information                   *
     C*            @STDA  - Deam data structure                       *
     C*************@FB****-*Front/back*office*call************************S01319
     C*                                                               *
     C*****************************************************************
     C           #BDC      BEGSR
     C*
     C**  SET UP SUPPLEMENTARY & RELATED FIELDS
     C                     EXSR #ZM                                       083409
     C                     EXSR #ZL
     C*********************EXSR #ZM                                       083409
     C                     MOVEL'D'       IGDDLT
     C*
     C**  CHAIN TO DEALS FILE
     C           @DEAMK    CHAINMMDAMULL             61
     C*
     C                     MOVEL@STDA     Z#BSTS                          082738
      *                                                                   082738
     C**  CHECK FOR DATA BASE ERROR
     C           *IN61     IFEQ '1'                        B1
     C                     Z-ADDIGDA38    @WK6N            *1
     C                     Z-ADD@IGVDY    @WK8N            *1
     C                     Z-ADDIGDS38    @WK3N            *1
     C                     MOVEL'MMDAMULL'DBFILE           ************
     C                     MOVEL'013'     DBASE            * DB ERR 13*
     C                     EXSR #Z                         ************
     C                     END                             E1
     C*
     C                     MOVEL'D'       HNDDLT
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0078CDB1                                           S01408
     C*                                                                   S01408
     C                     MOVEL@IGDEL    @STDA
     C                     MOVEL'HN'      HNRCID
     C                     UPDATMMDEAMP0
     C*
     C                     MOVEL@STDA     Z#ASTS                          082738
      *                                                                   082738
     C****CHAIN*TO*DOWNLOAD*BLOTTER*(IF*FRONT*OFFICE*CALL)****************S01319
     C***********@FB*******IFEQ*'F'************************B1*************S01319
     C***********@DEAMK****CHAINMMDWA2LL*************61*****1*************S01319
     C*********************EXSR*#ZO***************************************S01319
     C********************************************************************S01319
     C************IN61*****IFEQ*'0'************************B*2************S01319
     C*********************UPDATMMDWNAP0*********************2************S01319
     C*********************ELSE****************************X*2************S01319
     C*********************WRITEMMDWNAP0*********************2************S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C*********************END*****************************E1*************S01319
     C*
     C           #BDC9     ENDSR                           ****#BDC9***
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZA      - Loans Deposits Supplementary Fields                *
     C*                                                               *
     C* CALLS    #Z       - Data base errors                          *
     C***********ZA0710***-*Calculate*8,0*format***********************   056095
     C***********ZA0680***-*Calculate*midas*day*no.********************   056095
     C*          ZDATE9   - Calculate 8,0 format                      *   056095
     C*          ZDAT10   - Calculate midas day no.                   *   056095
     C***********MM1007***- Calculate interest                        *   E17051
     C*          MM1030   - Calculate interest                        *   E17051
     C*          MM1010   - Calculate interest at maturity            *
     C*          #ZAA     - Midas Our Receive Method                  *
     C*          #ZAB     - Midas Our Receive Instructions            *
     C*          #ZAC     - Midas Our Pay Method                      *
     C*          #ZAD     - Midas Our Pay Instructions                *
     C*          #ZAE     - Midas Customer Pay Instructions           *
     C*          #ZAF     - Midas Customer Receive Instructions       *
     C*          #ZAG     - Midas For Account Of                      *
     C*                                                               *
     C* CALLED BY  #BAA   - Loans Deposits Inserts                    *
     C*            #BAB   - Loans Deposits Amends                     *
     C*            #BAC   - Loans DEposits Deletes                    *
     C*                                                               *
     C* FLDS USED**@KEY   - File Key                                  *   S01194
     C************ @KEY4  - 4 bytes of File key                       *   S01194
     C*            @@DAYN - Date 5,0 format                           *
     C*            @@VDT  - Date 8,0 format                           *
     C*            @IKSLY - Start/last interest date                  *
     C*            @IKVDY - Value Date                                *
     C*************@@DTIN*-*Date*8,0*format****************************   056095
     C*************@@MDNO*-*Date*5,0*format****************************   056095
     C*            ZZDTIN - Date 8,0 format                           *   056095
     C*            ZZMDNO - Date 5,0 format                           *   056095
     C*            @IKDDY - Deal Done Date                            *
     C*            @IKNIY - Next Interest Date                        *
     C*            @IKMDY - Maturity Date                             *
     C*            @@RATE - Interest Rate                             *
     C*            @@AMT  - Amount                                    *
     C*************@@CALC*-*Interest*Calculation Method****************   056095
     C*************@@END**-*End*date***********************************   056095
     C*************@@BEG**-*Start*date*********************************   056095
     C*            ZZCALC - Interest Calculation Method               *   056095
     C*            ZZEND  - End date                                  *   056095
     C*            ZZBEG  - Start date                                *   056095
     C*            @@INTR - Interest                                  *
     C*            @IKIAY - Interest accrual control date             *
     C*            @BRTEK - File key                                  *
     C*            @@TINT - Total Interest                            *
     C*            @@INTD - Interest to Date                          *
     C*            @@INFQ - Interest payment frequency                *
     C*            @@NXIP - Next interest payment date                *
     C*            @@VDAT - Value date                                *
     C*            @@INCM - Interest Calculation Method               *
     C*            @@DLAM - Deal Amount                               *
     C*            @@EIRT - Effective interest rate                   *
     C*            @@MTXI - Taxable indicator                         *
     C*            @@DEAL - Deal number                               *
     C*            @@CCY  - Currency                                  *
     C*            @TB40K - File key                                  *
     C*            @@INMT - Interest at Maturity                      *
     C*            @DORM  - Deal our receive method                   *
     C*            @ORCM  - Midas our recive method                   *
     C*            @DORI  - Deal our receive instructions             *
     C*            @CCY   - Currency                                  *
     C*            @CNUM  - Customer number                           *
     C*            @MORI  - Midas our receive insructions             *
     C*            @DOPM  - Deal our pay method                       *
     C*            @MOPM  - Midas our pay method                      *
     C*            @DOPI  - Deal our pay instructions                 *
     C*            @MOPI  - Midas our pay instructions                *
     C*            @DCPI  - Deal customer pay instructions            *
     C*            @MCPI  - Midas customer pay instructions           *
     C*            @DCRI  - Deal customer receive instructions        *
     C*            @MCRI  - Midas customer receive instructions       *
     C*            @DFAC  - Deal for account of                       *
     C*            @MFAO  - Midas for account of                      *
     C*            @@BRMD - Maturity date for BRT calculation         *   S01383
     C*                                                               *
     C*****************************************************************
     C           #ZA       BEGSR
     C/COPY WNCPYSRC,MM0078C024
     C*
     C****SET*UP*SUPPLEMENTARY FIELDS FOR STANDARD DEAL TYPES L,B,S       S01194
     C*****************    MOVEL'20'      @KEY   12                       S01194
     C*****************    MOVE '1'       @KEY4   4                       S01194
     C*
     C**  FIND MIDAS DEAL TYPE
     C           IKTYPE    IFEQ *BLANKS                    B1
     C                     MOVE *BLANKS   IKMTYP           *1
     C                     ELSE                            X1
     C                     MOVELIKTYPE    @KTYPE  3        *1
     C*********            MOVE IKRBSI    @KTYPE           *1
     C                     MOVE ' '       @KTYPE           *1
     C           @KTYPE    LOKUPTAB3      TAB4           61*1
     C                     MOVELTAB4      IKMTYP           *1
     C                     END                             E1
     C*
     C**  FIND MIDAS BRANCH CODE & BRANCH NAME
     C           IKDBRC    IFNE *BLANKS                    B1
     C**********                                                          S01194
     C***ACCESS*FDBSNCLL USING DEAL BRANCH CODE                           S01194
     C********** IKDBRC    CHAINFDBSNCLL             61    **2            S01194
      *                                                                   S01194
      ** ACCESS BRANCH CODES FILE FOR DEAL BRANCH CODE                    S01194
     C**********           CALL 'AOBRCHR0'                                             S01194 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD            **2            S01194
     C                     PARM '*KEY   ' @OPTN            **2            S01194
     C                     PARM IKDBRC    @WRK3            **2            S01194
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01194 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*
     C**  CHECK FOR DATA BASE ERROR
     C********** *IN61     IFEQ '1'                        B**3           S01194
     C           @RTCD     IFNE *BLANK                     B**3           S01194
     C                     MOVELIKDBRC    DBKEY            ***3
     C**********           MOVEL'FDBSNCLL'DBFILE           ************   S01194
     C                     MOVEL'SDBRCHPD'DBFILE                          S01194
     C                     MOVEL'014'     DBASE            * DB ERR 14*
     C                     MOVEL@OPTN     DBOPTN                          S01194
     C                     EXSR #Z                         ************
     C                     END                             E**3
     C*
     C****                 MOVE KEY       IKBRCD           **2            S01117
     C*********            MOVE KEY       IKBRCA           **2     S01117 S01194
     C*********            MOVE BRNM      IKBRNM           **2            S01194
     C                     MOVE A8BRCD    IKBRCA           **2            S01194
     C                     MOVE A8BRNM    IKBRNM           **2            S01194
     C                     END                             E1
     C*
     C**  FIND LAST ACTION DATE
     C****************     Z-ADDRUND      @@DAYN                          S01194
     C                     Z-ADDBJRDNB    @@DAYN                          S01194
     C***********          EXSR ZA0710                                    056095
     C                     EXSR ZDATE9                                    056095
     C                     Z-ADD@@VDT     IKLDAT
     C*
     C**  FIND BROKER NAME & TOWN - ACCESS FILE WITH BROKER CODE
     C           IKBKCD    IFNE *BLANKS                    B1
     C           IKBKCD    ANDNE'TELX'                     *1
     C           IKBKCD    ANDNE'PHON'                     *1
     C           IKBKCD    ANDNE'MAIL'                     *1
     C*
     C*********            MOVE *BLANKS   @KEY             *1             S01194
     C*********            MOVEL'80'      @KEY   12        *1             S01194
     C*********            MOVE IKBKCD    @KEY             *1             S01194
     C*********                                                           S01194
     C*********  @KEY      CHAINFDBRKRLL             61    *1             S01194
      *                                                                   S01194
     C                     CALL 'AOBROKR0'                 *1             S01194
     C*********************PARM '*DBERR ' @RTCD            *1       S01194E234
     C                     PARM '*MSG   ' @RTCD            *1             E234
     C                     PARM '*KEY   ' @OPTN            *1             S01194
     C                     PARM IKBKCD    @WRK4   4        *1             S01194
     C           SDBROK    PARM SDBROK    DSFDY                           S01194
     C*
     C**  CHECK FOR DATA BASE ERROR
     C           @RTCD     IFNE *BLANK                     B*2            S01194
     C*********  *IN61     IFEQ '1'                        B**3           S01194
     C*********            MOVEL@KEY      DBKEY            **2            S01194
     C*********            MOVEL'FDBRKRLL'DBFILE           ************   S01194
     C                     MOVELIKBKCD    DBKEY                           S01194
     C                     MOVEL'SDBROKPD'DBFILE                          S01194
     C                     MOVEL'015'     DBASE            * DB ERR 15*
     C                     MOVEL@OPTN     DBOPTN           **2            S01194
     C                     EXSR #Z                         ************
     C                     END                             E*2
     C*
     C***********          MOVELBKNM      IKBKNM           *1             S01194
     C***********          MOVELBKTN      IKBKTN           *1             S01194
     C                     MOVELA9BKNM    IKBKNM           *1             S01194
     C                     MOVELA9BRTN    IKBKTN           *1             S01194
     C*
     C                     END                             E1
     C*
     C** E13838 START/LAST INTEREST SHOULD NOT BE SET TO VALUE            E13838
     C** DATE                                                             E13838
     C****MOVE VALUE/START DATE  INTO START LAST INTEREST DATE IF         E13838
     C****START LAST INTEREST DATE = ZERO                                 E13838
     C******     @IKSLY    IFEQ *ZERO                      B1             E13838
     C******     IKLACT    ANDEQ'I'                        *1
     C******               Z-ADD@IKVDY    @IKSLY           *1             E13838
     C******               END                             E1             E13838
     C*
     C**  CONVERT DATES FROM 8,0 TO DAY NUMBER FORMAT
     C**  DEAL VALUE/START DATE
     C           @IKSLY    IFNE *ZERO                      B1
     C***********          Z-ADD@IKSLY    @@DTIN           *1             056095
     C***********          EXSR ZA0680                     *1             056095
     C***********          Z-ADD@@MDNO    IKSLID           *1             056095
     C                     Z-ADD@IKSLY    ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    IKSLID           *1             056095
     C                     END                             E1
     C*
     C**  DEAL VALUE/START DATE
     C           @IKVDY    IFNE *ZERO                      B1
     C***********          Z-ADD@IKVDY    @@DTIN           *1             056095
     C***********          EXSR ZA0680                     *1             056095
     C***********          Z-ADD@@MDNO    IKDVSD           *1             056095
     C                     Z-ADD@IKVDY    ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    IKDVSD           *1             056095
     C                     END                             E1
     C*
     C**  DEAL DONE DATE
     C           @IKDDY    IFNE *ZERO                      B1
     C***********          Z-ADD@IKDDY    @@DTIN           *1             056095
     C***********          EXSR ZA0680                     *1             056095
     C***********          Z-ADD@@MDNO    IKDDND           *1             056095
     C                     Z-ADD@IKDDY    ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    IKDDND           *1             056095
     C                     END                             E1
     C*
     C**  DEAL LAST ACTION DATE
     C************         Z-ADDRUND      IKDLAD                          S01194
     C                     Z-ADDBJRDNB    IKDLAD                          S01194
     C*
     C**  NEXT INTEREST PAYMENT DATE
     C           @IKNIY    IFNE *ZERO                      B1
     C***********          Z-ADD@IKNIY    @@DTIN           *1             056095
     C***********          EXSR ZA0680                     *1             056095
     C***********          Z-ADD@@MDNO    IKNIPD           *1             056095
     C                     Z-ADD@IKNIY    ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    IKNIPD           *1             056095
     C                     END                             E1
     C*
     C**  DEAL MATURITY DATE
     C           @IKMDY    IFNE *ZERO                      B1
     C***********          Z-ADD@IKMDY    @@DTIN           *1             056095
     C***********          EXSR ZA0680                     *1             056095
     C***********          Z-ADD@@MDNO    IKMATD           *1             056095
     C                     Z-ADD@IKMDY    ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    IKMATD           *1             056095
     C                     END                             E1
     C*
     C****FIND*MIDAS CUSTOMER A/C SEQ. NUMBER
     C*****      MBIN      IFEQ 'Y'                        B1     *****   SO1117
     C*****      IKLACT    ANDEQ'I'                        *1     *****   S01117
     C*****      IKACSQ    ANDEQ*ZERO                      *1     *****   S01117
     C*****                Z-ADDNSACS     IKACSQ           *1     *****   S01117
     C*****                END                             E1     *****   S01117
     C*
     C           MBIN      IFNE 'Y'                        B1
     C           IKLACT    ANDEQ'I'                        *1
     C           IKACSQ    ANDEQ*ZERO                      *1
     C                     Z-ADD1         IKACSQ           *1
     C                     END                             E1
     C*
     C**  FIND NEGATIVE INTEREST INDICATOR
     C           IKINTR    IFLT *ZERO                      B1
     C                     MOVEL'Y'       IKNGVI           *1
     C                     END                             E1
     C*
     C**  FIND MIDAS BASE RATE CODE
     C*********  @BRTEK    KLIST                                          S01194
     C*********            KFLD           IKCCY                           S01194
     C*********            KFLD           IKDBSR                          S01194
     C*********  @BRTEK    CHAINFDBRTELL             61                   S01194
      *                                                                   S01194
      * S01194/E121 - MIDAS BASE RATE IS PASSED BY STANDARD               E121
      * DEAL IN *ENTRY PARMS, THEREFORE THIS IS NOT REQUIRED              E121
     C******               CALL 'AOBSRTR0'                                E121
     C******               PARM *BLANKS   @RTCD                           E121
     C******               PARM '*KEY   ' @OPTN                           E121
     C******               PARM IKDBSR    @WRK2   2                       E121
     C******               PARM IKCCY     @WRK3                           E121
     C******     SDBSRT    PARM SDBSRT    DSFDY                           E121
     C******                                                              E121
     C********** *IN61     IFEQ '0'                        B1             E121
     C******     @RTCD     IFEQ *BLANKS                                   E121
     C***********          MOVE KEY       IKBSRC           *1      E12945 S01194
     C***********          MOVE BRTT      IKBSRC           *1      E12945 S01194
     C******               MOVE BABSRC    IKBSRC           *1             E121
     C******               END                             E1             E121
     C*
     C**  SET UP INPUT INTEREST RATE AND FOR A DEAL WITH A BASE
     C**  RATE SET THE SPREAD RATE.
     C                     Z-ADDIKINTR    IKIIRT
     C***********@FB*******IFEQ*'F'************************B1*************S01319
     C***********IKDBSR****IFEQ**BLANK*********************B*2************S01319
     C*********************Z-ADD0*********IKSPRD*************2************S01319
     C*********************ELSE****************************X*2************S01319
     C****SET*SPREAD*RATE*TO*INPUT*INTEREST*RATE********************E14412S01319
     C*********************Z-ADDIKIIRT****IKSPRD*************2******E14412S01319
     C**************       ADD  NBRT      IKINTR           **2     ME2306 S01194
     C* E121 - BECAUSE RELEASE 10 CHANGES THE WAY FRONT OFFICE            E121
     C*      TRADES ARE INPUT THIS WILL NEVER BE RUN AND CAN BE REMOVED   E121
     C*                                          PBC 20/3/90              E121
     C*********************ADD  BANBRT    IKINTR           **2      S01194E121
     C*********************END*****************************E*2************S01319
     C*********************END*****************************E1*************S01319
     C*
     C**  FIND MIDAS TOTAL INTEREST
     C*                                                                   S01383
     C**  STORE MIDAS MATURITY DAY NO. FOR MM1010 BRT CALCULATIONS IN     S01383
     C**  FIELD @@BRMD                                                    S01383
     C*                                                                   S01383
     C                     Z-ADD0         @@BRMD  50                      S01383
     C           IKMATD    IFEQ 0
     C           IKTYPE    ANDNE'CP'
     C           IKTYPE    ANDNE'CT'
     C           IKTYPE    ANDNE'CL'
     C                     ELSE
      *
     C           IKINTR    IFNE *ZERO                      B1
     C           IKAMNP    ANDNE*ZERO                      *1
     C           IKICMT    ANDNE*BLANK                     *1
     C*********  IKMATD    ANDNE*ZERO
     C           IKDVSD    ANDNE*ZERO                      *1
     C           IKMATD    IFNE 0
     C*                                                                   S01392
     C* IF FIRST & LAST DAY INTEREST, CALCULATE TO MATURITY DATE + 1      S01392
     C*                                                                   S01392
     C           IKFLID    IFEQ 'Y'                                       S01392
     C***********IKMATD    ADD  1         @@END                     S01392056095
     C           IKMATD    ADD  1         ZZEND                           056095
     C                     ELSE                                           S01392
     C***********          Z-ADDIKMATD    @@END                           056095
     C                     Z-ADDIKMATD    ZZEND                           056095
     C                     END                                            S01392
     C                     ELSE
     C           IKNTCE    IFGT *ZERO                      ME2197
     C***********IKDVSD    ADD  IKNTCE    @@END                           056095
     C           IKDVSD    ADD  IKNTCE    ZZEND                           056095
     C                     ELSE                            ME2197
     C***********IKDVSD    ADD  1         @@END            ME2197         056095
     C           IKDVSD    ADD  1         ZZEND                           056095
     C                     END                             ME2197
     C                     END
     C***********          Z-ADD@@END     @@BRMD                    S01383056095
     C                     Z-ADDZZEND     @@BRMD                          056095
     C                     Z-ADDIKINTR    @@RATE           *1
     C                     Z-ADDIKAMNP    @@AMT            *1
     C***********          MOVELIKICMT    @@CALC           *1             056095
     C***********          Z-ADDIKDVSD    @@BEG            *1             056095
     C                     MOVELIKICMT    ZZCALC           *1             056095
     C                     Z-ADDIKDVSD    ZZBEG            *1             056095
     C                     MOVE IKRDFC    @@RDFC  1        *1             S01392
     C*********************EXSR MM1007                     *1             E17051
     C/COPY WNCPYSRC,MM0078C003
     C                     EXSR MM1030                     *1             E17051
     C/COPY WNCPYSRC,MM0078C004
     C                     Z-SUB@@INTR    IKMTTI           *1
     C                     END                             E1
     C                     END
     C*
     C**  SET INTEREST ACCRUAL CONTROL DATE TO VALUE DATE
     C**  IF DEAL STATUS TYPE NOT INCOMPLETE                              E13838
     C           IKDSTS    IFNE 'I'                                       E13838
     C                     Z-ADD@IKVDY    @IKIAY
     C                     END                                            E13838
     C*
     C**  FIND MIDAS BASE RATE CODE
     C********   @BRTEK    KLIST
     C********             KFLD           IKCCY
     C********             KFLD           IKDBSR
     C********   @BRTEK    CHAINFDBRTELL             61
     C********
     C********   *IN61     IFEQ '0'
     C********             MOVE KEY       IKBSRC
     C********             END
     C*
     C*
     C**  CALCULATE INPUT INTEREST RATE
     C*
     C*
     C**  CALCULATE INTEREST AT MATURITY
     C**  @@BRMD CALCULATED ABOVE, IN MIDAS TOTAL INTEREST CALCULATIONS   S01383
     C                     Z-ADDIKMTTI    @@TINT 150
     C*
     C**  IF AMEND / DELETE OBTAIN PREVIOUS DEAL STATUS FROM DEALS FILE
     C           IKLACT    IFNE 'I'                        B1
     C           IKDN38    CHAINMMDEALLL             61    *1
     C*
     C**  CHECK FOR DATA BASE ERROR
     C           *IN61     IFEQ '1'                        B*2
     C                     MOVELIKDN38    DBKEY            **2
     C                     MOVEL'MMDEALLL'DBFILE           ************
     C                     MOVEL'038'     DBASE            * DB ERR 21*
     C                     EXSR #Z                         ************
     C                     END                             E*2
     C*
     C                     MOVE HKDSTS    @PSTS   1        *1
     C*
     C**  ....OTHERWISE SET PREVIOUS DEAL STATUS TO BLANK
     C                     ELSE                            X1
     C                     MOVE *BLANK    @PSTS            *1
     C                     END                             E1
      *                                                                   CEU003
      ** Setup deals-effective-currency-workfield                         CEU003
      *                                                                   CEU003
     C                     MOVE *BLANKS   WDECY                           CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           HKSTCY    ANDNE*BLANKS                                   CEU003
      *                                                                   CEU003
     C                     MOVELHKSTCY    WDECY                           CEU003
      *                                                                   CEU003
     C                     ELSE                                           CEU003
      *                                                                   CEU003
     C                     MOVELHKCCY     WDECY                           CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
     C*
     C*   INTEREST TO DATE FROM MIDAS FILE IF DEAL STAT = R OR A ELSE 0
     C           IKDSTS    IFEQ 'R'                        B1
     C           IKDSTS    OREQ 'A'                        *1
     C           @PSTS     IFEQ 'R'                        B1
     C           @PSTS     OREQ 'A'                        *1
     C           IKDN38    CHAINDEALS                61    *1
     C*
     C**  CHECK FOR DATA BASE ERROR ***********
     C*           IN61     IFEQ '1'                        B1
      *
      ** IF NOT FOUND MUST BE BECAUSE A/H DEAL INPUT
     C                     Z-ADD*ZERO     @@INTD           *1
     C                     END                             E1
     C*
     C                     Z-ADDAIPD      @@INTD 150       *1
     C                     ELSE                            X1
     C                     Z-ADD*ZERO     @@INTD           *1
     C                     END                             E1
     C*
     C                     MOVELIKIPFQ    @@INFQ  1
     C                     Z-ADDIKNIPD    @@DAYN
     C***********          EXSR ZA0710                                    056095
     C                     EXSR ZDATE9                                    056095
     C                     Z-ADD@@VDT     @@NXIP  80
     C                     Z-ADDIKDVSD    @@VDAT  50
     C                     MOVELIKICMT    @@INCM  1
     C                     Z-ADDIKAMNP    @@DLAM 150
     C                     Z-ADDIKINTR    @@EIRT 117
     C                     MOVELIKMTAX    @@MTXI  1
     C                     MOVELIKRDFC    @@RDFC                          S01392
     C                     Z-ADDIKDN38    @@DEAL
     C*****                MOVELIKCCY     @@CCY   3               *****   S01195
     C***********          MOVELIKCCY     ZCCY                     S01195 CEU003
     C                     MOVELWSICY     ZCCY                            CEU003
     C                     Z-ADD@IKMDY    @@MDAT  80
     C**********                                                          S01194
     C****SET*KEY & ACCESS FXTB40LL                                       S01194
     C**********           MOVEL'01'      @TB40K 12                       S01194
     C**********           MOVE '40'      @TB40K                          S01194
     C********** @TB40K    CHAINFXTB40LL             61                   S01194
     C*                                                                   S01194
     C*  USE ACCESS PROGRAM TO READ DEAL DATA CODES FILE                  S01194
     C**********           CALL 'AODEALR0'                                S01194              CGL029
     C                     CALL 'AODEALR1'                                                    CGL029
     C                     PARM '*MSG    '@RTCD                           S01194
     C                     PARM '*FIRST  '@OPTN                           S01194
     C********** SDDEAL    PARM SDDEAL    DSFDY                           S01194              CGL029
     C           SDDEAL    PARM SDDEAL    DSSDY                                               CGL029
     C*
     C**  CHECK FOR DATA BASE ERROR
     C********** *IN61     IFEQ '1'                        B1             S01194
     C**********           MOVEL@TB40K    DBKEY            *1             S01194
     C           @RTCD     IFNE *BLANK                     *1             S01194
     C                     MOVEL@OPTN     DBKEY            *1             S01194
     C**********           MOVEL'FXTB40LL'DBFILE           ************   S01194
     C                     MOVEL'SDDEALPD'DBFILE                          S01194
     C                     MOVEL'019'     DBASE            * DB ERR 19*
     C                     MOVEL@OPTN     DBOPTN           *1             S01194
     C                     EXSR #Z                         ************
     C                     END                             E1
     C*
     C                     EXSR MM1010
     C*
     C** ENSURE INTEREST AT MATURITY IS OPPOSITE SIGN TO AMT.
     C*
     C** AMOUNT -VE
     C*
     C           IKAMNP    IFLT 0                          B1
     C           @@INMT    IFLT 0                          B*2
     C                     Z-SUB@@INMT    IKIMAT           **2
     C                     ELSE                            X*2
     C                     Z-ADD@@INMT    IKIMAT           **2
     C                     END                             E*2
     C*
     C** AMOUNT +VE
     C*
     C                     ELSE                            X1
     C           @@INMT    IFLT 0                          B*2
     C                     Z-ADD@@INMT    IKIMAT           **2
     C                     ELSE                            X*2
     C                     Z-SUB@@INMT    IKIMAT           **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C** ENSURE INTEREST AT MATURITY IS SAME SIGN AS AMT. IF -VE INT.
     C*
     C           IKNGVI    IFEQ 'Y'                        B1
     C           IKAMNP    IFLT 0                          B*2
     C           @@INMT    IFLT 0                          B**3
     C                     Z-ADD@@INMT    IKIMAT           ***3
     C                     ELSE                            X**3
     C                     Z-SUB@@INMT    IKIMAT           ***3
     C                     END                             E**3
     C*
     C                     ELSE                            X*2
     C*
     C** AMOUNT +VE
     C*
     C           @@INMT    IFLT 0                          B**3
     C                     Z-SUB@@INMT    IKIMAT           ***3
     C                     ELSE                            X**3
     C                     Z-ADD@@INMT    IKIMAT           ***3
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E1
     C*
     C********             Z-ADD@@INMT    IKIMAT
     C*
     C**  CONVERT INTEREST ACCRUAL CONTROL DATE TO 5,0
     C           @IKIAY    IFNE *ZERO                      B1
     C***********          Z-ADD@IKIAY    @@DTIN           *1             056095
     C***********          EXSR ZA0680                     *1             056095
     C***********          Z-ADD@@MDNO    IKIACD           *1             056095
     C                     Z-ADD@IKIAY    ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    IKIACD           *1             056095
     C                     END                             E1
     C*
     C** MIDAS OUR RECEIVE METHOD
     C**  Extended settlement fields for PC are set up                    S01227
     C**  at the end of the subroutine.                                   S01227
     C           IKORCM    IFEQ *ZERO                      B1
     C*
     C           IKDORM    ORNE HKDORM                     B*2
     C                     MOVELIKDORM    @DORM            **2
     C                     EXSR #ZAA                       **2
     C                     Z-ADD@ORCM     IKORCM           **2
     C                     ELSE                            X*2
     C           HKDORM    IFEQ *BLANK                     B**3
     C                     Z-ADD*ZERO     IKORCM           ***3
     C                     ELSE                            X**3
     C                     Z-ADDHKORCM    IKORCM           ***3
     C                     END                             E**3
     C*
     C                     END                             E1
     C*
     C**  MIDAS OUR RECEIVE INSTRUCTIONS
     C**  Extended settlement fields for PC are set up                    S01227
     C**  at the end of the subroutine.                                   S01227
     C           IKLACT    IFEQ 'I'                        B1             E12909
     C           IKMORI    IFEQ *BLANKS                    B2             E12909
     C                     MOVELIKDORM    @DORM            **2            E12909
     C                     MOVELIKDORI    @DORI            **2            E12909
     C***********          MOVELIKCCY     @CCY             **2     E12909 CEU003
     C                     MOVELWSECY     @CCY                            CEU003
     C                     MOVELIKCNUM    @CNUM            **2            E12909
     C                     MOVELIKMORI    NOSN3            **2            BHF860
     C                     EXSR #ZAB                       **2            E12909
     C                     MOVEL@MORI     IKMORI           **2            E12909
     C                     END                             E2             E12909
     C                     ELSE                            X1             E12909
     C           IKMORI    IFEQ *BLANKS                    B2
     C***********IKDORI    ORNE HKDORI                     **2            E22150
     C           IKDORI    IFNE HKDORI                     B**3           E22150
     C           IKDORM    ORNE HKDORM                     ***3
     C***********HKCCY     ORNE IKBUCY                     ***3           E21832
     C***********HKCCY     ORNE IKCCY                      ***3    E21832 CEU003
     C           WDECY     ORNE WSECY                                     CEU003
     C                     MOVELIKDORM    @DORM            ***3
     C                     MOVELIKDORI    @DORI            ***3
     C***********          MOVELIKCCY     @CCY             ***3           CEU003
     C                     MOVELWSECY     @CCY                            CEU003
     C                     MOVELIKCNUM    @CNUM            ***3
     C                     MOVELIKMORI    NOSN3   2        **2            BHF860
     C                     EXSR #ZAB                       ***3
     C                     MOVEL@MORI     IKMORI           ***3
     C                     ELSE                            X**3
     C                     MOVE HKMORI    IKMORI           ***3
     C                     END                             E**3
     C                     END                             E2
     C                     END                             E1             E12909
     C*
     C** MIDAS OUR PAY METHOD
     C**  Extended settlement fields for PC are set up                    S01227
     C**  at the end of the subroutine.                                   S01227
     C           IKMOPM    IFEQ *ZEROS                     B1
     C           IKDOPM    ORNE HKDOPM                     B*2
     C                     MOVELIKDOPM    @DOPM            **2
     C                     EXSR #ZAC                       **2
     C                     Z-ADD@MOPM     IKMOPM           **2
     C                     ELSE                            X*2
     C           HKDOPM    IFEQ *BLANK                     B**3
     C                     Z-ADD*ZERO     IKMOPM           ***3
     C                     ELSE                            X**3
     C                     Z-ADDHKMOPM    IKMOPM           ***3
     C                     END                             E*2
     C                     END                             E1
     C*
     C** MIDAS OUR PAY INSTRUCTIONS
     C**  Extended settlement fields for PC are set up                    S01227
     C**  at the end of the subroutine.                                   S01227
     C           IKLACT    IFEQ 'I'                        B1             E12909
     C           IKMOPI    IFEQ *BLANKS                    B2             E12909
     C                     MOVELIKDOPM    @DOPM            **2            E12909
     C                     MOVELIKDOPI    @DOPI            **2            E12909
     C***********          MOVELIKCCY     @CCY             **2     E12909 CEU003
     C                     MOVELWSECY     @CCY                            CEU003
     C                     MOVELIKCNUM    @CNUM            **2            E12909
     C                     MOVELIKMOPI    NOSN3            **2            BHF860
     C                     EXSR #ZAD                       **2            E12909
     C                     MOVEL@MOPI     IKMOPI           **2            E12909
     C                     END                             E2             E12909
     C                     ELSE                            X1             E12909
     C           IKMOPI    IFEQ *BLANKS                    B2
     C***********IKDOPI    ORNE HKDOPI                     **2            E22150
     C           IKDOPI    IFNE HKDOPI                     B**3           E22150
     C           IKDOPM    ORNE HKDOPM                     ***3
     C***********HKCCY     ORNE IKBUCY                     ***3           E21832
     C***********HKCCY     ORNE IKCCY                      ***3    E21832 CEU003
     C           WDECY     ORNE WSECY                                     CEU003
     C                     MOVELIKDOPM    @DOPM            ***3
     C                     MOVELIKDOPI    @DOPI            ***3
     C***********          MOVELIKCCY     @CCY             ***3           CEU003
     C                     MOVELWSECY     @CCY                            CEU003
     C                     MOVELIKCNUM    @CNUM            ***3
     C                     MOVELIKMOPI    NOSN3                           BHF860
     C                     EXSR #ZAD                       ***3
     C                     MOVEL@MOPI     IKMOPI           ***3
     C                     ELSE                            X**3
     C                     MOVE HKMOPI    IKMOPI           ***3
     C                     END                             E**3           E22150
     C                     END                             E2
     C                     END                             E1             E12909
     C*
     C** MIDAS CUSTOMER PAY INSTRUCTIONS
     C**  Extended settlement fields for PC are set up                    S01227
     C**  at the end of the subroutine.                                   S01227
     C           IKMCPI    IFEQ *BLANKS                    B1
     C           IKDCPI    ORNE HKDCPI                     B*2
     C                     MOVELIKDCPI    @DCPI            **2
     C                     EXSR #ZAE                       **2
     C                     MOVEL@MCPI     IKMCPI           **2
     C                     ELSE                            X*2
     C***********          MOVE HKMCPI    IKMCPI           **2            E25322
     C                     END                             E1
     C*
     C** MIDAS CUSTOMER RECEIVE INSTRUCTIONS
     C**  Extended settlement fields for PC are set up                    S01227
     C**  at the end of the subroutine.                                   S01227
     C           IKMCRI    IFEQ *BLANKS                    B1
     C           IKDCRI    ORNE HKDCRI                     B*2
     C                     MOVELIKDCRI    @DCRI            **2
     C                     EXSR #ZAF                       **2
     C                     MOVEL@MCRI     IKMCRI           **2
     C                     ELSE                            X*2
     C***********          MOVE HKMCRI    IKMCRI           **2            E25322
     C                     END                             E1
     C*
     C** MIDAS FOR ACCOUNT OF
     C**  Extended settlement fields for PC are set up                    S01227
     C**  at the end of the subroutine.                                   S01227
     C           IKMFAO    IFEQ *BLANKS                    B1
     C           IKDFAC    ORNE HKDFAC                     B*2
     C                     MOVELIKDFAC    @DFAC            **2
     C                     EXSR #ZAG                       **2
     C                     MOVEL@MFAO     IKMFAO           **2
     C                     ELSE                            X*2
     C                     MOVE HKMFAO    IKMFAO           **2
     C                     END                             E1
      *                                                                   128913
      **  Set up related deal fields for rollover of loan / deposit       128913
      **  This is specially for case where authorization required='N'     128913
      *                                                                   128913
     C           IKDADN    IFNE *BLANKS                    B1             128913
     C                     MOVE IKDADN    @IHDAD           *1             128913
     C           @IHDAD    CHAINMMDEALLL             61    *1             128913
      *                                                                   128913
      ** Check for data base error                                        128913
      ** Release 10 incorporation amendments: both R10's BHF410 and R2.3's128913
      ** E20611 attempt to do the same thing here, and both are flawed;   128913
      ** this combines the best parts of both. If this is amend and       128913
      ** related deal not found set up related deal maturity date and     128913
      ** amount to 0. Because the related deal's maturity date cannot     128913
      ** have been amended and it must be prior to rundate.               128913
      *                                                                   128913
     C           *IN61     IFEQ '1'                        B*2            128913
     C           IKLACT    IFEQ 'I'                        B**3           128913
     C                     MOVEL@IHDAD    DBKEY            ***3           128913
     C                     MOVEL'MMDEALLL'DBFILE           ************   128913
     C                     MOVEL'041'     DBASE            * DB ERR 41*   128913
     C                     EXSR #Z                         ************   128913
     C*                                                                   128913
     C                     ELSE                            X**3           128913
     C                     Z-ADD0         IKRMTD           ***3           128913
     C                     Z-ADD0         IKRBAT           ***3           128913
     C                     END                             E**3           128913
     C                     ELSE                            X*2            128913
     C*                                                                   128913
     C                     Z-ADD@HKMDY    IKRMTD           *1             128913
     C                     Z-ADDHKAMNP    IKRBAT           *1             128913
     C                     END                             E*2            128913
     C                     ELSE                            X1             128913
     C                     Z-ADD0         IKRMTD           *1             128913
     C                     Z-ADD0         IKRBAT           *1             128913
     C                     END                             E1             128913
     C*
     C***Set*up*extended*settlement*fields*for*the*PC***************S01227S01319
     C***********@FB*******IFEQ*'F'************************B1*******S01227S01319
     C*********************MOVELIKORCM****IKRSTM************1*******S01227S01319
     C*********************MOVELIKMORI****IKRONS************1*******S01227S01319
     C*********************MOVELIKMOPM****IKPSTM************1*******S01227S01319
     C*********************MOVELIKMOPI****IKPONS************1*******S01227S01319
     C*********************MOVELIKSPEC****IKBTB1************1*******S01227S01319
     C*********************MOVELIKMCPI****IKRIBN************1*******S01227S01319
     C*********************MOVELIKMCRI****IKAWBN************1*******S01227S01319
     C*********************MOVELIKMFAO****IKBENN************1*******S01227S01319
     C*********************MOVE*'N'*******IKCVMR************1*******E22405S01319
     C*********************END*****************************E1*******S01227S01319
     C*************************************************************S01227*S01319
     C           #ZA9      ENDSR                           ****#ZA9****
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZAA     - Midas Our Receive Method                           *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  #ZA    - Loans Deposits Supplementary Fields       *
     C*            #ZD    - NAB's Supplementary Fields                *
     C*            #ZH    - NAS's Supplementary Fields                *
     C*            #ZLAB  - Deams Receive Instructions                *
     C*                                                               *
     C* FLDS USED  @DORM  - Deal our receive method                   *
     C*            @ORCM  - Midas our recive method                   *
     C*                                                               *
     C*****************************************************************
     C           #ZAA      BEGSR
     C*
     C           @DORM     IFEQ 'NA'                       B1
     C           @DORM     OREQ *BLANKS                    *1
     C                     Z-ADD0         @ORCM            *1
     C                     END                             E1
     C*
     C           @DORM     IFEQ 'TELX '                    B1
     C                     Z-ADD1         @ORCM            *1
     C                     END                             E1
     C*
     C           @DORM     IFEQ 'CHIPS'                    B1
     C                     Z-ADD7         @ORCM            *1
     C                     END                             E1
     C*
     C           @DORM     IFEQ 'SWIFT'                    B1
     C                     Z-ADD8         @ORCM            *1
     C                     END                             E1
     C*
     C           @DORM     IFEQ 'CSENT'                    B1
     C                     Z-ADD2         @ORCM            *1
     C                     END                             E1
     C*
     C           @DORM     IFEQ 'CCOLL'                    B1
     C                     Z-ADD12        @ORCM            *1
     C                     END                             E1
     C*
     C           @DORM     IFEQ 'COMP '                    B1
     C                     Z-ADD3         @ORCM            *1
     C                     END                             E1
     C*
     C           @DORM     IFEQ 'PCURR'                    B1
     C                     Z-ADD4         @ORCM            *1
     C                     END                             E1
     C*
     C           @DORM     IFEQ 'CURR '                    B1
     C                     Z-ADD14        @ORCM            *1
     C                     END                             E1
     C*
     C           @DORM     IFEQ 'MACC '                    B1
     C                     Z-ADD5         @ORCM            *1
     C                     END                             E1
     C*
     C           @DORM     IFEQ 'SUSP '                    B1
     C                     Z-ADD6         @ORCM            *1
     C                     END                             E1
     C*
     C           #ZAA9     ENDSR                           ****#ZAA9***
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZAB     - Midas Our Receive Instructions                     *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  #ZA    - Loans Deposits Supplementary Fields       *
     C*            #ZD    - NAB's Supplementary Fields                *
     C*            #ZH    - NAS's Supplementary Fields                *
     C*            #ZLAB  - Deams Receive Instructions                *
     C*                                                               *
     C* FLDS USED  @DORM  - Deal our receive method                   *
     C*            @DORI  - Deal our receive instructions             *
     C*            @MORI  - Midas our receive insructions             *
     C*            @CCY   - Currency                                  *
     C*            @CNUM  - Customer number                           *
     C*            @WK6   - Work field 6 bytes                        *
     C*                                                               *
     C*****************************************************************
     C           #ZAB      BEGSR
     C*
     C           @DORM     IFNE 'TELX '                    B1
     C           @DORM     ANDNE'CHIPS'                    *1
     C           @DORM     ANDNE'SWIFT'                    *1
     C           @DORM     ANDNE'CCOLL'                    *1
     C           @DORM     ANDNE'CSENT'                    *1
     C           @DORM     ANDNE'PCURR'                    *1
     C           @DORI     ANDNE'NODEF'                    *1
     C                     MOVE @DORI     @MORI            *1
     C                     END                             E1
     C*
     C           @DORM     IFEQ 'TELX'                     B1
     C           @DORM     OREQ 'CHIPS'                    *1
     C           @DORM     OREQ 'SWIFT'                    *1
     C           @DORM     OREQ 'CCOLL'                    *1
     C           @DORM     OREQ 'CSENT'                    *1
     C*
     C***ACCESS*FDNOSTLL USING DEAL BRANCH CODE                           S01194
      ** READ NOSTRO CODES FILE                                           S01194
     C           @DORI     IFNE *BLANKS                    B*2
     C******************   MOVEL@DORI     CSNM             **2            S01194
     C******************   MOVE @CCY      CCY              **2            S01194
     C******************   MOVE 'P'       PNOI             **2            S01194
     C********** KEY3      CHAINFDNOSTLL             61    **2            S01194
     C*
     C*********************CALL 'AONOSTR0'                 **2      S01194E12
     C*********************PARM '*MSG   ' @RTCD            **2      S01194E12
     C*********************PARM '*KEY   ' @OPTN            **2      S01194E12
     C*********************PARM @DORI     @WRK10           **2      S01194E12
     C*********************PARM @CCY      @WRK3            **2      S01194E12
     C*********************PARM 'P'       @WRK1            **2      S01194E12
     C*********************PARM           SDNOST           **2      S01194E12
     C                     MOVEL@DORI     @CSSN            ***3           S01194
     C                     CALL 'AONOSTR0'                                E12
     C                     PARM '       ' @RTCD                           E12
     C                     PARM '*KEY   ' @OPTN                           E12
     C                     PARM *BLANKS   @CUST   6                       S01194
     C                     PARM @CCY      @CYCD   3                       S01194
     C**********           PARM *BLANKS   @ACCD   4                                    S01194 CGL029
     C                     PARM *BLANKS   @ACCD  10                                           CGL029
     C                     PARM *BLANKS   @ACSN   2                       S01194
     C                     PARM *BLANKS   @NONB   2                       S01194
     C                     PARM *BLANKS   @BRCD   3                       S01194
     C                     PARM           @CSSN  10                       S01194
     C                     PARM 'P'       @PNOI   1                       S01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
     C***IF*ACCESS*FAILS*THEN*USE*BLANK*PNOI*****                         DT0041
     C********** *IN61     IFEQ '1'                        B**3           S01194
     C**********           MOVE ' '       PNOI             ***3           S01194
     C********** KEY3      CHAINFDNOSTLL             61    ***3           S01194
     C***********@RTCD     IFNE *BLANK                     B**3     S01194DT0041
     C*********************CALL 'AONOSTR0'                 ***3     S01194E12
     C*********************PARM '*MSG   ' @RTCD            ***3     S01194E12
     C*********************PARM '*KEY   ' @OPTN            ***3     S01194E12
     C*********************PARM @DORI     @WRK10           ***3     S01194E12
     C*********************PARM @CCY      @WRK3            ***3     S01194E12
     C*********************PARM ' '       @WRK1            ***3     S01194E12
     C*********************PARM           SDNOST           ***3     S01194E12
     C***********          CALL 'AONOSTR0'                             E12DT0041
     C***********          PARM '       ' @RTCD                        E12DT0041
     C***********          PARM '*KEY   ' @OPTN                        E12DT0041
     C***********          PARM *BLANKS   @CUST   6                 S01194DT0041
     C***********          PARM @CCY      @CYCD   3                 S01194DT0041
     C***********          PARM *BLANKS   @ACCD   4                 S01194DT0041
     C***********          PARM *BLANKS   @ACSN   2                 S01194DT0041
     C***********          PARM *BLANKS   @NONB   2                 S01194DT0041
     C***********          PARM *BLANKS   @BRCD   3                 S01194DT0041
     C***********          PARM           @CSSN  10                 S01194DT0041
     C***********          PARM *BLANKS   @PNOI   1                 S01194DT0041
     C***********SDNOST    PARM SDNOST    DSFDY                     S01194DT0041
     C***********          END                             E**3           DT0041
     C*                                                                   DT0041
     C                     MOVE *BLANKS   @MORI            **2
     C************         MOVELNOSN      @MORI            **2            S01194
     C                     MOVELA7NONB    @MORI            **2            S01194
     C                     ELSE                            X*2
     C                     MOVE *BLANKS   @MORI            **2
     C****************     MOVEL'00'      @MORI            **2            E13034
     C                     END                             E*2
     C                     END                             E1
     C*
     C           @DORM     IFEQ 'PCURR'                    B1
     C                     MOVEL@CNUM     @MORI            *1
     C******************   MOVELCADC      @WK6    6        *1             S01194
     C**********           MOVELBMACCD    @WK6    6        *1                          S01194 CGL029
     C                     MOVELBMACCD    @WK6   12                                           CGL029
     C                     MOVE '01'      @WK6             *1
     C                     MOVE @WK6      @MORI            *1
     C                     END                             E1
     C*
     C           @DORI     IFEQ 'NODEF'                    B1
     C                     MOVE *BLANKS   @MORI            *1
     C                     END                             E1
     C*
     C           #ZAB9     ENDSR                           ****#ZAB9***
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZAC     - Midas Our Pay Method                               *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  #ZA    - Loans Deposits Supplementary Fields       *
     C*            #ZD    - NAB's Supplementary Fields                *
     C*            #ZLAA  - Deams Pay Instructions                    *
     C*                                                               *
     C* FLDS USED  @DOPM  - Deal our pay method                       *
     C*            @MOPM  - Midas our pay method                      *
     C*                                                               *
     C*****************************************************************
     C           #ZAC      BEGSR
     C*
     C           @DOPM     IFEQ 'NA'                       B1
     C           @DOPM     OREQ *BLANKS                    *1
     C                     Z-ADD0         @MOPM            *1
     C                     END                             E1
     C*
     C           @DOPM     IFEQ 'TELX '                    B1
     C                     Z-ADD1         @MOPM            *1
     C                     END                             E1
     C*
     C           @DOPM     IFEQ 'CHIPS'                    B1
     C                     Z-ADD7         @MOPM            *1
     C                     END                             E1
     C*
     C           @DOPM     IFEQ 'SWIFT'                    B1
     C                     Z-ADD8         @MOPM            *1
     C                     END                             E1
     C*
     C           @DOPM     IFEQ 'CSENT'                    B1
     C                     Z-ADD2         @MOPM            *1
     C                     END                             E1
     C*
     C           @DOPM     IFEQ 'CCOLL'                    B1
     C                     Z-ADD12        @MOPM            *1
     C                     END                             E1
     C*
     C           @DOPM     IFEQ 'COMP '                    B1
     C                     Z-ADD3         @MOPM            *1
     C                     END                             E1
     C*
     C           @DOPM     IFEQ 'PCURR'                    B1
     C                     Z-ADD4         @MOPM            *1
     C                     END                             E1
     C*
     C           @DOPM     IFEQ 'CURR '                    B1
     C                     Z-ADD14        @MOPM            *1
     C                     END                             E1
     C*
     C           @DOPM     IFEQ 'MACC '                    B1
     C                     Z-ADD5         @MOPM            *1
     C                     END                             E1
     C*
     C           @DOPM     IFEQ 'SUSP '                    B1
     C                     Z-ADD6         @MOPM            *1
     C                     END                             E1
     C*
     C           #ZAC9     ENDSR                           ***#ZAC9***
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZAD     - Midas Our Pay Instructions                         *
     C*                                                               *
     C* CALLS             -                                           *
     C*                                                               *
     C* CALLED BY  #ZA    - Loans Deposits Supplementary Fields       *
     C*            #ZD    - NAB's Supplementary Fields                *
     C*            #ZLAA  - Deams Pay Instructions                    *
     C*                                                               *
     C* FLDS USED  @DOPM  - Deal our pay method                       *
     C*            @DOPI  - Deal our pay instructions                 *
     C*            @MOPI  - Midas our pay instructions                *
     C*            @CCY   - Currency                                  *
     C*            @CNUM  - Customer number                           *
     C*            @WK6   - Work field 6 bytes                        *
     C*                                                               *
     C*****************************************************************
     C           #ZAD      BEGSR
     C*
     C           @DOPM     IFNE 'TELX '                    B1
     C           @DOPM     ANDNE'CHIPS'                    *1
     C           @DOPM     ANDNE'SWIFT'                    *1
     C           @DOPM     ANDNE'CCOLL'                    *1
     C           @DOPM     ANDNE'CSENT'                    *1
     C           @DOPM     ANDNE'PCURR'                    *1
     C           @DOPI     ANDNE'NODEF'                    *1
     C                     MOVE @DOPI     @MOPI            *1
     C                     END                             E1
     C*
     C           @DOPM     IFEQ 'TELX'                     B1
     C           @DOPM     OREQ 'CHIPS'                    *1
     C           @DOPM     OREQ 'SWIFT'                    *1
     C           @DOPM     OREQ 'CCOLL'                    *1
     C           @DOPM     OREQ 'CSENT'                    *1
     C*
     C***ACCESS*FDNOSTLL USING DEAL BRANCH CODE                           S01194
     C*********            MOVEL@DOPI     CSNM             **2            S01194
     C*********            MOVE @CCY      CCY              **2            S01194
     C*********            MOVE 'P'       PNOI             **2            S01194
     C********** KEY3      CHAINFDNOSTLL             61    **2            S01194
      *                                                                   S01194
      ** READ NOSTRO CODES FILE VIA ACCESS OBJECT                         S01194
     C           @DOPI     IFNE *BLANKS                    B*2            S01194
     C*********************CALL 'AONOSTR0'                 **2      S01194E12
     C*********************PARM '*MSG   ' @RTCD            **2      S01194E12
     C*********************PARM '*KEY   ' @OPTN            **2      S01194E12
     C*********************PARM @DOPI     @WRK10 10        **2      S01194E12
     C*********************PARM @CCY      @WRK3            **2      S01194E12
     C*********************PARM 'P'       @WRK1   1        **2      S01194E12
     C*********************PARM           SDNOST           **2      S01194E12
     C                     MOVEL@DOPI     @CSSN                           S01194
     C                     CALL 'AONOSTR0'                                E12
     C                     PARM '       ' @RTCD                           E12
     C                     PARM '*KEY   ' @OPTN                           E12
     C                     PARM *BLANKS   @CUST   6                       S01194
     C                     PARM @CCY      @CYCD   3                       S01194
     C**********           PARM *BLANKS   @ACCD   4                                    S01194 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2                       S01194
     C************         PARM *BLANKS   @NONB   2                 S01194BH1115
     C                     PARM NOSN3     @NONB   2                       BH1115
     C                     PARM *BLANKS   @BRCD   3                       S01194
     C                     PARM           @CSSN  10                       S01194
     C                     PARM 'P'       @PNOI   1                       S01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
     C*
     C***IF*ACCESS*FAILS*THEN*USE*BLANK*PNOI******                        DT0041
     C********** *IN61     IFEQ '1'                        B**3           S01194
     C***********          MOVE ' '       PNOI             ***3           S01194
     C********** KEY3      CHAINFDNOSTLL             61    ***3           S01194
      *                                                                   S01194
     C***********@RTCD     IFNE *BLANK                     B**3     S01194DT0041
     C*********************CALL 'AONOSTR0'                 ***3     S01194E12
     C*********************PARM '*MSG   ' @RTCD            ***3     S01194E12
     C*********************PARM '*KEY   ' @OPTN            ***3     S01194E12
     C*********************PARM @DOPI     @WRK10           ***3     S01194E12
     C*********************PARM @CCY      @WRK3            ***3     S01194E12
     C*********************PARM ' '       @WRK1            ***3     S01194E12
     C*********************PARM           SDNOST           ***3     S01194E12
     C***********          CALL 'AONOSTR0'                             E12DT0041
     C***********          PARM '       ' @RTCD                        E12DT0041
     C***********          PARM '*KEY   ' @OPTN                        E12DT0041
     C***********          PARM *BLANKS   @CUST   6                 S01194DT0041
     C***********          PARM @CCY      @CYCD   3                 S01194DT0041
     C***********          PARM *BLANKS   @ACCD   4                 S01194DT0041
     C***********          PARM *BLANKS   @ACSN   2                 S01194DT0041
     C***********          PARM *BLANKS   @NONB   2                 S01194DT0041
     C***********          PARM *BLANKS   @BRCD   3                 S01194DT0041
     C***********          PARM           @CSSN  10                 S01194DT0041
     C***********          PARM *BLANKS   @PNOI   1                 S01194DT0041
     C***********SDNOST    PARM SDNOST    DSFDY                     S01194DT0041
     C***********          END                             E**3           DT0041
     C*
     C                     MOVE *BLANKS   @MOPI            **2
     C**********           MOVELNOSN      @MOPI            **2            S01194
     C                     MOVELA7NONB    @MOPI            **2            S01194
     C                     ELSE                            X*2
     C                     MOVE *BLANKS   @MOPI            **2
     C*************        MOVEL'00'      @MOPI            **2            E13034
     C                     END                             E*2
     C                     END                             E1
     C*
     C           @DOPM     IFEQ 'PCURR'                    B1
     C                     MOVEL@CNUM     @MOPI            *1
     C*************        MOVELCADC      @WK6    6        *1             S01194
     C**********           MOVELBMACCD    @WK6    6        *1                          S01194 CGL029
     C                     MOVELBMACCD    @WK6                                                CGL029
     C                     MOVE '01'      @WK6             *1
     C                     MOVE @WK6      @MOPI            *1
     C                     END                             E1
     C*
     C           @DOPI     IFEQ 'NODEF'                    B1
     C                     MOVE *BLANKS   @MOPI            *1
     C                     END                             E1
     C*
     C           #ZAD9     ENDSR                           ***#ZAD9****
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZAE     - Midas Customer Pay Instructions                    *
     C*                                                               *
     C* CALLS    #ZP      - Prepare for testn                         *
     C*          #Z       - Data base errors                          *
     C*                                                               *
     C* CALLED BY  #ZA    - Loans Deposits Supplementary Fields       *
     C*            #ZD    - NAB's Supplementary Fields                *
     C*            #ZH    - NAS's Supplementary Fields                *
     C*            #ZLAB  - Deams Receive Instructions                *
     C*                                                               *
     C* FLDS USED  @DCPI  - Deal customer pay instructions            *
     C*            @MCPI  - Midas customer pay instructions           *
     C*            @IN    - Testn s/r input field                     *
     C*            @OUT   - Testn s/r output field                    *
     C*            @WK8   - Work field 8 bytes                        *
     C*                                                               *
     C*****************************************************************
     C           #ZAE      BEGSR
     C*
     C           @DCPI     IFEQ 'NODEF'                    B1
     C           @DCPI     OREQ *BLANKS                    *1
     C                     MOVE *BLANKS   @MCPI            *1
     C                     GOTO #ZAE9                      *1
     C                     END                             E1
     C*
     C** TEST DEAL CUST PAY INSTR IS A NUMBER
     C*
     C** REMOVE TRAILING BLANKS SO TESTN WORKS
     C                     MOVE @DCPI     @IN
     C                     EXSR #ZP
     C                     TESTN          @OUT       7979
     C           *IN79     IFEQ '1'                        B1
     C                     MOVE @DCPI     @MCPI            *1
     C                     GOTO #ZAE9                      *1
     C                     END                             E1
     C*
     C***ACCESS*SNAME*USING*DEAL*CUSTOMER*PAY*INSTR                       E13173
     C***ACCESS*FDCSNMLL USING DEAL CUSTOMER PAY INSTR            E13173  S01194
     C********   @DCPI     CHAINSNAME                61                   E13173
     C*********  @DCPI     CHAINFDCSNMLL             61           E13173  S01194
     C                     CALL 'AOCUSTR0'                                S01194
     C*****                PARM '*DBERR ' @RTCD                    S01194 E140
     C                     PARM *BLANKS   @RTCD                           E140
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM @DCPI     @WRK10                          S01194
     C                     PARM *BLANKS   @WRK7   7                       S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
     C*                                                                   S01194
     C*********  *IN61     IFEQ '0'                        B1             S01194
     C           @RTCD     IFEQ *BLANK                     B1             S01194
     C                     MOVE *BLANKS   @MCPI            *1             E16247
     C*********            MOVELCNUM      @MCPI            *1             S01194
     C                     MOVELBBCUST    @MCPI            *1             S01194
     C                     GOTO #ZAE9                      *1
     C                     END                             E1
     C*
     C***ACCESS*TABLET2 VIA FDSNAMLL USING DCPI                           S01194
     C*********            MOVE *BLANKS   CSN1                            S01194
     C*********            MOVE *BLANKS   CSN2                            S01194
     C*********            MOVEL@DCPI     CSN1                            S01194
     C*********            MOVE @DCPI     CSN2                            S01194
     C********** KEY4      CHAINFDSNAMLL             61                   S01194
      *                                                                   S01194
      **  ACCESS COUNTERPARTY NOSTROS FILE                                S01194
     C                     CALL 'AOCNSTR0'                                S01194
     C*********************PARM '*DBERR ' @RTCD            *1       S01194E234
     C                     PARM '*MSG   ' @RTCD            *1             E234
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM @DCPI     @WRK8   8                       S01194
     C           SDCNST    PARM SDCNST    DSFDY                           S01194
     C*
     C********** *IN61     IFEQ '1'                        B1             S01194
     C           @RTCD     IFNE *BLANKS                    B1             S01194
     C                     MOVE @DCPI     DBKEY            ************
     C**********           MOVEL'FDSNAMLL'DBFILE           * DB ERR 35*   S01194
     C                     MOVEL'SDCNSTPD'DBFILE           *              S01194
     C                     MOVEL'035'     DBASE            ************
     C                     MOVEL@OPTN     DBOPTN           *1             S01194
     C                     EXSR #Z                         *1
     C                     END                             E1
     C*
     C***********          MOVE KEY       @WK8    8                       S01194
     C***********          MOVEL@WK8      @MCPI                           S01194
     C*********************MOVELCPSH      @MCPI                    E18348 S01194
     C                     MOVELAWCPNC    @MCPI                           S01194
     C*
     C           #ZAE9     ENDSR                           ****#ZAE9***
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZAF     - Midas Customer Receive Instructions                *
     C*                                                               *
     C* CALLS    #ZP      - Prepare for testn                         *
     C*          #Z       - Data base errors                          *
     C*                                                               *
     C* CALLED BY  #ZA    - Loans Deposits Supplementary Fields       *
     C*            #ZD    - NAB's Supplementary Fields                *
     C*            #ZLAA  - Deams Pay Instructions                    *
     C*                                                               *
     C* FLDS USED  @DCRI  - Deal customer receive instructions        *
     C*            @MCRI  - Midas customer receive instructions       *
     C*            @IN    - Testn s/r input field                     *
     C*            @OUT   - Testn s/r output field                    *
     C*            @WK8   - Work field 8 bytes                        *
     C*                                                               *
     C*****************************************************************
     C           #ZAF      BEGSR
     C*
     C           @DCRI     IFEQ 'NODEF'                    B1
     C           @DCRI     OREQ *BLANKS                    *1
     C                     MOVE *BLANKS   @MCRI            *1
     C                     GOTO #ZAF9                      *1
     C                     END                             E1
     C*
     C** TEST DEAL CUST RECEIVE INSTR IS A NUMBER
     C                     MOVE @DCRI     @IN
     C                     EXSR #ZP
     C                     TESTN          @OUT       7979
     C*
     C           *IN79     IFEQ '1'                        B1
     C                     MOVE @DCRI     @MCRI            *1
     C                     GOTO #ZAF9                      *1
     C                     END                             E1
     C*
     C***ACCESS*SNAME*USING*DEAL*CUSTOMER*RECEIVE*INSTR                   E13173
     C***ACCESS*FDCSNMLL USING DEAL CUSTOMER RECEIVE INSTR         E13173 S01194
     C*******    @DCRI     CHAINSNAME                61                   E13173
     C*********  @DCRI     CHAINFDCSNMLL             61            E13173 S01194
     C                     CALL 'AOCUSTR0'                                S01194
     C*****                PARM '*DBERR ' @RTCD                    S01194 E140
     C                     PARM *BLANKS   @RTCD                           E140
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM @DCRI     @WRK10 10                       S01194
     C                     PARM *BLANKS   @WRK7   7                       S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
     C********** *IN61     IFEQ '0'                        B1             S01194
     C           @RTCD     IFEQ *BLANKS                    B1             S01194
     C                     MOVE *BLANKS   @MCRI            *1             E16247
     C***********          MOVELCNUM      @MCRI            *1             S01194
     C                     MOVELBBCUST    @MCRI            *1             S01194
     C                     GOTO #ZAF9                      *1
     C                     END                             E1
     C*
     C***ACCESS*TABLET2 VIA FDSNAMLL USING DCRI                           S01194
     C*********            MOVE *BLANKS   CSN1                            S01194
     C*********            MOVE *BLANKS   CSN2                            S01194
     C*********            MOVEL@DCRI     CSN1                            S01194
     C*********            MOVE @DCRI     CSN2                            S01194
     C*********  KEY4      CHAINFDSNAMLL             61                   S01194
      *                                                                   S01194
      **  ACCESS COUNTERPARTY NOSTROS FILE                                S01194
     C                     CALL 'AOCNSTR0'                                S01194
     C*********************PARM '*DBERR ' @RTCD            *1       S01194E234
     C                     PARM '*MSG   ' @RTCD            *1             E234
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM @DCRI     @WRK8   8                       S01194
     C           SDCNST    PARM SDCNST    DSFDY                           S01194
     C*
     C********** *IN61     IFEQ '1'                        B1             S01194
     C           @RTCD     IFNE *BLANK                     B1             S01194
     C                     MOVEL@DCRI     DBKEY            ************
     C****************     MOVEL'FDSNAMLL'DBFILE                          S01194
     C                     MOVEL'SDCNSTPD'DBFILE           * DB ERR 36*   S01194
     C                     MOVEL'036'     DBASE            ************
     C                     MOVEL@OPTN     DBOPTN           *1             S01194
     C                     EXSR #Z                         *1
     C                     END                             E1
     C*
     C*************        MOVE KEY       @WK8    8                       S01194
     C*************        MOVEL@WK8      @MCRI                           S01194
     C*********************MOVELCPSH      @MCRI                    E18348 S01194
     C                     MOVELAWCPNC    @MCRI                           S01194
     C*
     C           #ZAF9     ENDSR                           ***#ZAF9***
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZAG     - Midas For Account Of                               *
     C*                                                               *
     C* CALLS    #ZP      - Prepare for testn                         *
     C*          #Z       - Data base errors                          *
     C*                                                               *
     C* CALLED BY  #ZA    - Loans Deposits Supplementary Fields       *
     C*            #ZD    - NAB's Supplementary Fields                *
     C*            #ZLAA  - Deams Pay Instructions                    *
     C*                                                               *
     C* FLDS USED  @DFAC  - Deal for account of                       *
     C*            @MFAO  - Midas for account of                      *
     C*            @IN    - Testn s/r input field                     *
     C*            @OUT   - Testn s/r output field                    *
     C*            @WK8   - Work field 8 bytes                        *
     C*                                                               *
     C*****************************************************************
     C           #ZAG      BEGSR
     C*
     C           @DFAC     IFEQ 'NODEF'                    B1
     C           @DFAC     OREQ *BLANKS                    *1
     C                     MOVE *BLANKS   @MFAO            *1
     C                     GOTO #ZAG9                      *1
     C                     END                             E1
     C*
     C** TEST DEAL FOR A/C OF IS A NUMBER
     C                     MOVE @DFAC     @IN
     C                     EXSR #ZP
     C                     TESTN          @OUT       7979
     C           *IN79     IFEQ '1'                        B1
     C                     MOVE @DFAC     @MFAO            *1
     C                     GOTO #ZAG9                      *1
     C                     END                             E1
     C*
     C***ACCESS*SNAME*USING*DEAL*FOR*A/C*OF                               E13173
     C***ACCESS*FDCSNMLL USING DEAL FOR A/C OF                     E13173 S01194
     C********   @DFAC     CHAINSNAME                61                   E13173
     C********** @DFAC     CHAINFDCSNMLL             61            E13173 S01194
     C                     CALL 'AOCUSTR0'                                S01194
     C*****                PARM '*DBERR ' @RTCD                    S01194 E140
     C                     PARM *BLANKS   @RTCD                           E140
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM @DFAC     @WRK10                          S01194
     C                     PARM *BLANKS   @WRK7                           S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
      *                                                                   S01194
     C********** *IN61     IFEQ '0'                        B1             S01194
     C           @RTCD     IFEQ *BLANK                     B1             S01194
     C                     MOVE *BLANKS   @MFAO            *1             E16247
     C***********          MOVELCNUM      @MFAO            *1             S01194
     C                     MOVELBBCUST    @MFAO            *1             S01194
     C                     GOTO #ZAG9                      *1
     C                     END                             E1
     C*
     C***ACCESS*TABLET2 VIA FDSNAMLL USING DEAL FOR A/C OF                S01194
     C*********            MOVE *BLANKS   CSN1                            S01194
     C*********            MOVE *BLANKS   CSN2                            S01194
     C*********            MOVEL@DFAC     CSN1                            S01194
     C*********            MOVE @DFAC     CSN2                            S01194
     C*********  KEY4      CHAINFDSNAMLL             61                   S01194
      *                                                                   S01194
      **  ACCESS COUNTERPARTY NOSTROS FILE                                S01194
     C                     CALL 'AOCNSTR0'                                S01194
     C*********************PARM '*DBERR ' @RTCD            *1       S01194E234
     C                     PARM '*MSG   ' @RTCD            *1             E234
     C                     PARM '*KEY   ' @OPTN                           S01194
     C*****************    PARM @DFAC     @WRK10                          S01194
     C*********************PARM @PFWK8    @PFWK8                    S01194BHF625
     C                     PARM @DFAC     @WRK8   8                       BHF625
     C           SDCNST    PARM SDCNST    DSFDY                           S01194
     C*
     C********** *IN61     IFEQ '1'                        B1             S01194
     C           @RTCD     IFNE *BLANK                     B1             S01194
     C           IHLACT    IFNE 'D'                                       126447
     C                     MOVEL@DFAC     DBKEY            ************
     C**************       MOVEL'FDSNAMLL'DBFILE                          S01194
     C                     MOVEL'SDCNSTPD'DBFILE           * DB ERR 37*   S01194
     C                     MOVEL'037'     DBASE            ************
     C                     MOVEL@OPTN     DBOPTN           *1             S01194
     C                     EXSR #Z                         *1
     C                     END                             E1
     C*
     C**********           MOVE KEY       @WK8    8                       S01194
     C**********           MOVEL@WK8      @MFAO                           S01194
     C*********************MOVELCPSH      @MFAO                    E18348 S01194
     C                     MOVELAWCPNC    @MFAO                           S01194
     C                     END                                            126447
     C*
     C           #ZAG9     ENDSR                           ****#ZAG9***
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZB      - Loans Deposits Before Fields                       *
     C*                                                               *
     C* CALLS    #Z       - Data base errors                          *
     C*                                                               *
     C* CALLED BY  #BAB   - Loans Deposits Amends                     *
     C*                                                               *
     C* FLDS USED  @HKVDY - Value date                                *
     C*            @HKNIY - Next interest date                        *
     C*            @HKSLY - Start/last interset date                  *
     C*            @HKMDY - Maturity Date                             *
     C*            @IKRMT - Related deal maturity date                *
     C*                                                               *
     C*****************************************************************
     C           #ZB       BEGSR
     C*
     C**  CHAIN TO DEALS FILE
     C           IKDN38    CHAINMMDEALLL             61
     C*
     C**  CHECK FOR DATA BASE ERROR
     C           *IN61     IFEQ '1'                        B1
     C                     MOVELIKDN38    DBKEY            *1
     C                     MOVEL'MMDEALLL'DBFILE           ************
     C                     MOVEL'021'     DBASE            * DB ERR 21*
     C                     EXSR #Z                         ************
     C                     END                             E1
     C/COPY WNCPYSRC,MM0078C015
     C*
     C                     MOVELHKORCM    IKBORM
     C                     MOVELHKMORI    IKBORI
     C                     MOVELHKDCPI    IKBCPI
     C                     MOVELHKMOPM    IKBOPM
     C                     MOVELHKMOPI    IKBOPI
     C                     MOVELHKDCRI    IKBCRI
     C                     Z-ADDHKAMNP    IKBAMT
     C                     MOVELHKCCY     IKBUCY
     C                     MOVELHKCNUM    IKBCNM
     C                     Z-ADD@HKVDY    IKBVDT
     C                     MOVELHKDSTS    IKBSTS
     C                     MOVELHKCSNM    IKBCSN
     C***********          Z-ADDHKIIRT    IKBIRT                          E36024
     C                     Z-ADDHKINTR    IKBIRT                          E36024
     C                     Z-ADD@HKNIY    IKBNID
     C                     MOVELHKIPFQ    IKBIPF
     C                     MOVELHKICMT    IKBICM
     C                     Z-ADDHKIPDM    IKBIDM
     C*                    Z-ADDHKINTR    IKBFVL
     C*                    Z-ADDHKINTR    IKBISR
     C                     Z-ADD@HKSLY    IKBLID
     C                     Z-ADD@HKMDY    IKBMTD
     C                     Z-ADDHKNTCE    IKBNTC
     C                     MOVELHKROBR    IKBROB                          BHF477
     C                     MOVELHKPOBR    IKBPOB                          BHF477
     C                     Z-ADDHKMTTI    IKBMTI                          S01392
     C                     MOVELHKRDFC    IKBRDF                          S01392
     C                     MOVELHKFLID    IKBFLI                          S01392
     C                     MOVELHKFUID    IKBFUI                          S01392
     C*
     C**  Set up related deal fields for rollover of loan / deposit
     C           IKDADN    IFNE *BLANKS                    B1
     C                     MOVE IKDADN    @IHDAD           *1
     C           @IHDAD    CHAINMMDEALLL             61    *1
     C*
     C**  CHECK FOR DATA BASE ERROR
     C*                                                                   S01314
     C** Release 10 incorporation amendments: both R10's BHF410 and R2.3'sS01314
     C** E20611 attempt to do the same thing here, and both are flawed;   S01314
     C** this combines the best parts of both.                            S01314
     C**  IF THIS IS AMEND AND REL. DEAL NOT FOUND SET UP REL DEAL MDAT   BHF410
     C**  AND AMNT TO 0. B'COS THE REL DEAL MDAT CANNOT HAVE BEEN         BHF410
     C**  AMENDED AND IT MUST BE PRIOR TO RUNDATE. THEREFORE DO NOT       BHF410
     C**  WANT TO UPDATE CUST EXP (MM0074), (ONLY PLACE THESE FIELDS      BHF410
     C**  USED.)  SAME LOGIC APPLIES TO DELETE AND AUTHORISE.             BHF410
     C           *IN61     IFEQ '1'                        B*2
     C***********IKLACT****ANDEQ'I'                        **2      BHF410S01314
     C           IKLACT    IFEQ 'I'                        B**3           BHF410
     C                     MOVEL@IHDAD    DBKEY            ***3
     C                     MOVEL'MMDEALLL'DBFILE           ************
     C                     MOVEL'035'     DBASE            * DB ERR 35*
     C                     EXSR #Z                         ************
     C*                                                                   BHF410
     C                     ELSE                            X**3           BHF410
     C                     Z-ADD0         IKRMTD           ***3           BHF410
     C                     Z-ADD0         IKRBAT           ***3           BHF410
     C                     END                             E**3           S01314
     C                     ELSE                            X*2            S01314
     C*
     C                     Z-ADD@HKMDY    IKRMTD           *1
     C                     Z-ADDHKAMNP    IKRBAT           *1
     C                     END                             E*2            S01314
     C                     ELSE                            X1
     C                     Z-ADD0         IKRMTD           *1
     C                     Z-ADD0         IKRBAT           *1
     C                     END                             E1
     C*
     C           #ZB9      ENDSR                           ****#ZB9****
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C********************************************************************S01319
     C**#ZC******-*Loans*Deposits*Download*Blotter************************S01319
     C********************************************************************S01319
     C**CALLS*************-***********************************************S01319
     C********************************************************************S01319
     C**CALLED*BY**#BAA***-*Loans*Deposits*Inserts************************S01319
     C*************#BAB***-*Loans*Deposits*Amends*************************S01319
     C*************#BAC***-*Loans*DEposits*Deletes************************S01319
     C********************************************************************S01319
     C**FLDS*USED**@IKVDY*-*Value*Date************************************S01319
     C*************@I1VDY*-*Value*Date************************************S01319
     C*************@IKDTY*-*Deal*transaction*date*************************S01319
     C*************@I1DTY*-*Deal*transaction*date*************************S01319
     C*************@IKDDY*-*Deal*Done*Date********************************S01319
     C*************@I1DDY*-*Deal*done*date********************************S01319
     C*************@IKMDY*-*Maturity*Date*********************************S01319
     C*************@I1MDY*-*Maturity*date*********************************S01319
     C*************@IKNIY*-*Next*Interest*Date****************************S01319
     C*************@I1NIY*-*Next*interest*date****************************S01319
     C*************@IKSLY*-*Start/last*interest*date**********************S01319
     C*************@I1SLY*-*Start/last*interest*date**********************S01319
     C*************@IKIAY*-*Interest*accrual*control*date*****************S01319
     C*************@I1IAY*-*Interest*accrual*control*date*****************S01319
     C*************@1MTI1*-*Interest*at*maturity**************************S01319
     C*************@1FVL1*-*Face*value************************************S01319
     C*************@1AMN1*-*Amount****************************************S01319
     C*************@1BRK1*-*Brokerage*************************************S01319
     C*************@1MTI2*-*Interest*at*maturity**************************S01319
     C*************@1FVL2*-*Face*value************************************S01319
     C*************@1AMN2*-*Amount****************************************S01319
     C*************@1BRK2*-*Brokerage*************************************S01319
     C*************@1MTI3*-*Interest*at*maturirty*************************S01319
     C*************@1FVL3*-*Face*value************************************S01319
     C*************@1AMN3*-*Amount****************************************S01319
     C*************@1BRK3*-*Brokerage*************************************S01319
     C********************************************************************S01319
     C********************************************************************S01319
     C***********#ZC*******BEGSR******************************************S01319
     C********************************************************************S01319
     C****UPDATE*FIELDS*ON*BLOTTER****************************************S01319
     C*********************MOVEL'I1'******I1RCID**************************S01319
     C*********************Z-ADDIKDN38****I1DN38**************************S01319
     C********************************************************************S01319
     C*********************MOVELIKPCDN****I1PCDN**************************S01319
     C*********************MOVELIKPCDN****I1PCD1**************************S01319
     C********************************************************************S01319
     C*********************MOVELIKBKCD****I1BKCD**************************S01319
     C*********************MOVELIKBKCD****I1BKC1**************************S01319
     C********************************************************************S01319
     C*********************Z-ADDIKTIME****I1TIME**************************S01319
     C*********************Z-ADDIKTIME****I1TIM1**************************S01319
     C*********************Z-ADDIKTIME****I1TIM2**************************S01319
     C********************************************************************S01319
     C*********************MOVELIKCCY*****I1CCY1**************************S01319
     C*********************MOVELIKCCY*****I1CCY2**************************S01319
     C*********************MOVELIKCCY*****I1CCY3**************************S01319
     C********************************************************************S01319
     C*********************Z-ADD@IKVDY****@I1VDY**************************S01319
     C********************************************************************S01319
     C*********************Z-ADD@IKDTY****@I1DTY**************************S01319
     C********************************************************************S01319
     C*********************MOVELIKDADN****I1DA38**************************S01319
     C********************************************************************S01319
     C***********IKLACT****IFEQ*'D'************************B1*************S01319
     C*********************MOVEL'D'*******I1DDLT************1*************S01319
     C*********************ELSE****************************X1*************S01319
     C*********************MOVEL*BLANK****I1DDLT************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C*********************MOVELIKDSTS****I1DSTS**************************S01319
     C*********************MOVELIKTYPE****I1TYPE**************************S01319
     C*********************MOVELIKRBSI****I1RBSI**************************S01319
     C*********************MOVELIKSTYP****I1STYP**************************S01319
     C*********************MOVELIKCSNM****I1CSNM**************************S01319
     C********************************************************************S01319
     C***********IKIIRT****IFLT**ZERO**********************B1*************S01319
     C*********************Z-SUBIKIIRT****I1INTS************1*************S01319
     C*********************MOVEL'-'*******I1INSN************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***********IKIIRT****IFGT**ZERO**********************B1*************S01319
     C*********************Z-ADDIKIIRT****I1INTS**************************S01319
     C*********************MOVEL'+'*******I1INSN************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***********IKIIRT****IFEQ**ZERO**********************B1*************S01319
     C*********************Z-ADD*ZERO*****I1INTS**************************S01319
     C*********************MOVE**BLANK****I1INSN************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C*********************MOVELIKDBSR****I1DBSR**************************S01319
     C*********************MOVELIKDBRC****I1DBRC**************************S01319
     C********************************************************************S01319
     C*********************Z-ADD@IKDDY****@I1DDY**************************S01319
     C********************************************************************S01319
     C*********************Z-ADD@IKMDY****@I1MDY**************************S01319
     C********************************************************************S01319
     C*********************Z-ADDIKNTCE****I1NTCE**************************S01319
     C********************************************************************S01319
     C***********IKNTCE****IFLT**ZERO**********************B1*************S01319
     C*********************Z-SUBI1NTCE****I1NTCE************1*************S01319
     C*********************MOVEL'-'*******I1NTSN************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***********IKNTCE****IFGT**ZERO**********************B1*************S01319
     C*********************MOVEL'+'*******I1NTSN************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***********IKNTCE****IFEQ**ZERO**********************B1*************S01319
     C*********************MOVE**BLANK****I1NTSN************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C*********************Z-ADDIKFCLY****I1FCLY**************************S01319
     C*********************Z-ADDIKBRAT****I1BRTS**************************S01319
     C********************************************************************S01319
     C*********************MOVELIKDORM****I1DORM**************************S01319
     C*********************MOVELIKDORI****I1DORI**************************S01319
     C*********************MOVELIKDCPI****I1DCPI**************************S01319
     C*********************MOVELIKDOPM****I1DOPM**************************S01319
     C*********************MOVELIKDOPI****I1DOPI**************************S01319
     C*********************MOVELIKDCRI****I1DCRI**************************S01319
     C********************************************************************S01319
     C*********************MOVELIKMFAO****I1MFAO**************************S01319
     C*********************MOVELIKSPEC****I1SPEC**************************S01319
     C********************************************************************S01319
     C*********************Z-ADD@IKNIY****@I1NIY**************************S01319
     C********************************************************************S01319
     C*********************MOVELIKIPFQ****I1IPFQ**************************S01319
     C*********************MOVELIKCPTI****I1CPTI**************************S01319
     C*********************MOVELIKICMT****I1ICMT**************************S01319
     C*********************MOVELIKIPDM****I1IPDM**************************S01319
     C*********************MOVE**BLANKS***I1SLDB**************************S01319
     C********************************************************************S01319
     C*********************Z-ADD@IKSLY****@I1SLY**************************S01319
     C********************************************************************S01319
     C*********************MOVELIKCDRF****I1CDRF**************************S01319
     C*********************Z-ADD*ZERO*****I1FRTS**************************S01319
     C*********************MOVELIKFEDF****I1FEDF**************************S01319
     C********************************************************************S01319
     C*********************Z-ADDIKPCTN****I1PCTN**************************S01319
     C*********************MOVELIKCDRP****I1CDRP**************************S01319
     C*********************MOVELIKLACT****I1LACT**************************S01319
     C*********************Z-ADDIKTIME****I1TIM1**************************S01319
     C*********************MOVELIKCNTI****I1CNTI**************************S01319
     C********************************************************************S01319
     C*********************Z-ADD@IKIAY****@I1IAY**************************S01319
     C*********************MOVELIKBKCY****I1BKCY**************************S01319
     C********************************************************************S01319
     C*********************Z-ADD*ZERO*****I1IMTI**************************S01319
     C*********************Z-ADD*ZERO*****I1IMTD**************************S01319
     C*********************Z-ADD*ZERO*****I1FVLI**************************S01319
     C*********************Z-ADD*ZERO*****I1FVLD**************************S01319
     C*********************Z-ADD*ZERO*****I1DRTS**************************S01319
     C*********************Z-ADD*ZERO*****I1AMNI**************************S01319
     C*********************Z-ADD*ZERO*****I1AMND**************************S01319
     C*********            Z-ADD*ZERO     I1BRKI                          E14377
     C*********            Z-ADD*ZERO     I1BRKD                          E14377
     C********************************************************************S01319
     C*********************MOVE*IKROBY****I1ROBY**************************S01319
     C********************************************************************S01319
     C***********IKTYPE****IFEQ*'CI'**************************************S01319
     C*********************MOVE*'Y'*******I1NAID**************************S01319
     C*********************ELSE*******************************************S01319
     C*********************MOVE*'N'*******I1NAID**************************S01319
     C*********************END********************************************S01319
     C********************************************************************S01319
     C***********IKIMAT****IFLT**ZERO**********************B1*************S01319
     C*********************Z-SUBIKIMAT****@KIMAT************1*************S01319
     C*********************MOVEL'-'*******I1IMTS************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***********IKIMAT****IFGT**ZERO**********************B1*************S01319
     C*********************Z-ADDIKIMAT****@KIMAT************1*************S01319
     C*********************MOVEL'+'*******I1IMTS************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***********IKIMAT****IFEQ**ZERO**********************B1*************S01319
     C*********************Z-ADD*ZERO*****@KIMAT************1*************S01319
     C*********************MOVE**BLANK****I1IMTS************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***********IKAMNP****IFLT**ZERO**********************B1*************S01319
     C*********************Z-SUBIKAMNP****@KAMNP************1*************S01319
     C*********************MOVEL'-'*******I1AMSN************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***********IKAMNP****IFGT**ZERO**********************B1*************S01319
     C*********************Z-ADDIKAMNP****@KAMNP************1*************S01319
     C*********************MOVEL'+'*******I1AMSN************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***********IKAMNP****IFEQ**ZERO**********************B1*************S01319
     C*********************Z-ADD*ZERO*****@KAMNP************1*************S01319
     C*********************MOVE**BLANK****I1AMSN************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***********CDP       IFEQ *ZERO                      B1             S01194
     C***********A6NBDP****IFEQ**ZERO**********************B1*******S01194S01319
     C*********************Z-ADD@KIMAT****I1IMTI************1*************S01319
     C*********************Z-ADD@KAMNP****I1AMNI************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***********CDP       IFEQ 1                          B1             S01194
     C***********A6NBDP****IFEQ*1**************************B1*******S01194S01319
     C*********************Z-ADD@KIMAT****@1MTI1************1*************S01319
     C*********************Z-ADD@KAMNP****@1AMN1************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C*********  CDP       IFEQ 2                          B1             S01194
     C***********A6NBDP****IFEQ*2**************************B1*******S01194S01319
     C*********************Z-ADD@KIMAT****@1MTI2************1*************S01319
     C*********************Z-ADD@KAMNP****@1AMN2************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C*********  CDP       IFEQ 3                          B1             S01194
     C***********A6NBDP****IFEQ*3**************************B1*******S01194S01319
     C*********************Z-ADD@KIMAT****@1MTI3************1*************S01319
     C*********************Z-ADD@KAMNP****@1AMN3************1*************S01319
     C*********************END*****************************E1*************S01319
     C**************************************************************E14377S01319
     C***********IKBRKG****IFEQ**ALL'9'********************B0.5*****E14377S01319
     C*********************MOVE**ALL'9'***I1BRKI************0.5*****E14377S01319
     C*********************MOVE**ALL'9'***I1BRKD************0.5*****E14377S01319
     C*********************ELSE****************************X0.5*****E14377S01319
     C********************************************************************S01319
     C***********IKBCDP****IFEQ**ZERO**********************B1*************S01319
     C*********************Z-ADDIKBRKG****I1BRKI************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***********IKBCDP****IFEQ*1**************************B1*************S01319
     C*********************Z-ADDIKBRKG****@1BRK1************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***********IKBCDP****IFEQ*2**************************B1*************S01319
     C*********************Z-ADDIKBRKG****@1BRK2************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***********IKBCDP****IFEQ*3**************************B1*************S01319
     C*********************Z-ADDIKBRKG****@1BRK3************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C*********************END*****************************E0.5*****E14377S01319
     C**************************************************************E14377S01319
     C*********************MOVE*IKDUSC****I1DUSC**************************S01319
     C********************************************************************S01319
     C****SET*UP*PROCESSING*OUTSTANDING***********************************S01319
     C***********I1DPCO****IFNE*'8'************************B1*************S01319
     C***********IKLACT****ANDNE'D'*************************1*************S01319
     C********************************************************************S01319
     C***********IKDSTS****IFEQ*'I'************************B*2************S01319
     C*********************MOVEL'1'       I1DPCO           **2            E16147
     C*********************MOVEL'2'*******I1DPCO*************2******E16147S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C***********IKDSTS****IFEQ*'C'************************B*2************S01319
     C***********IKCDRF****ANDEQ*BLANK*********************B*2************S01319
     C*********************MOVEL'4'       I1DPCO           **2            E16147
     C*********************MOVEL'5'*******I1DPCO*************2******E16147S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C***********IKCDRF****IFEQ*'Y'************************B*2************S01319
     C*********************MOVEL'7'       I1DPCO           **2            E16147
     C*********************MOVEL'8'*******I1DPCO*************2*****E16147*S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C****IF*RECORD*EXISTS************************************************S01319
     C************IN61*****IFEQ*'0'************************B1*************S01319
     C********************************************************************S01319
     C****DEAL*PREVIOUS*STATUS*INDICATOR**********************************S01319
     C***********I1PSTI****IFNE*'I'************************B*2************S01319
     C*********************MOVELIKBSTS****I1PSTI*************2************S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C*********************ELSE****************************X1*************S01319
     C********************************************************************S01319
     C*********************MOVEL'I'*******I1PSTI************1*************S01319
     C********************************************************************S01319
     C*********************END*****************************E1*************S01319
     C**************************************************************E16695S01319
     C****Issuer*field*should*be*blank*forloans*and*deposits.*******E16695S01319
     C*********************MOVE**BLANKS***I1ISUR********************E16695S01319
     C********************************************************************S01319
     C***********#ZC9******ENDSR*******************************#ZC9*******S01319
     C********************************************************************S01319
     C*/EJECT*************************************************************S01319
     C*****************************************************************
     C*                                                               *
     C* #ZD      - NAB's Supplementary Fields                         *
     C*                                                               *
     C* CALLS    #Z       - Data base errors                          *
     C***********ZA0710***-*Calculate*8,0*date*format******************   056095
     C***********ZA0680***-*Calculate*midas*day*no.********************   056095
     C*          ZDATE9   - Calculate 8,0 date format                 *   056095
     C*          ZDAT10   - Calculate midas day no.                   *   056095
     C***********MM1007***- Calculate interest                        *   E17051
     C*          MM1030   - Calculate interest                        *   E17051
     C*          #ZAA     - Midas Our Receive Method                  *
     C*          #ZAB     - Midas Our Receive Instructions            *
     C*          #ZAC     - Midas Our Pay Method                      *
     C*          #ZAD     - Midas Our Pay Instructions                *
     C*          #ZAE     - Midas Customer Pay Instructions           *
     C*          #ZAF     - Midas Customer Receive Instructions       *
     C*          #ZAG     - Midas For Account Of                      *
     C*                                                               *
     C* CALLED BY  #BBA   - NAB Inserts                               *
     C*            #BBB   - NAB Amends                                *
     C*            #BBC   - NAB Deletes                               *
     C*                                                               *
     C* FLDS USED**@KEY   - File Key                                  *   S01194
     C**********   @KEY4  - 4 bytes of File key                       *   S01194
     C*            @@DAYN - Date 5,0 format                           *
     C*            @@VDT  - Date 8,0 format                           *
     C*            @IHLIY - Last interest date                        *
     C*            @IHVDY - Value date                                *
     C*************@@DTIN*-*Date*8,0*format****************************   056095
     C*************@@MDNO*-*Date*5,0*format****************************   056095
     C*            ZZDTIN - Date 8,0 format                           *   056095
     C*            ZZMDNO - Date 5,0 format                           *   056095
     C*            @IHIAY - Interest accrual control date             *
     C*            @IHDDY - Deal done date                            *
     C*            @IHNIY - Next interest date                        *
     C*            @IHMDY - Maturity date                             *
     C*            @@RATE - Interest Rate                             *
     C*            @@AMT  - Amount                                    *
     C*************@@CALC*-*Interest*Calculation*Method****************   056095
     C*************@@END**-*End*date***********************************   056095
     C*************@@BEG**-*Start*date*********************************   056095
     C*            ZZCALC - Interest Calculation Method               *   056095
     C*            ZZEND  - End date                                  *   056095
     C*            ZZBEG  - Start date                                *   056095
     C*            @@INTR - Interest                                  *
     C*            @DORM  - Deal our receive method                   *
     C*            @ORCM  - Midas our recive method                   *
     C*            @DORI  - Deal our receive instructions             *
     C*            @CCY   - Currency                                  *
     C*            @CNUM  - Customer number                           *
     C*            @MORI  - Midas our receive insructions             *
     C*            @DOPM  - Deal our pay method                       *
     C*            @MOPM  - Midas our pay method                      *
     C*            @DOPI  - Deal our pay instructions                 *
     C*            @MOPI  - Midas our pay instructions                *
     C*            @DCPI  - Deal customer pay instructions            *
     C*            @MCPI  - Midas customer pay instructions           *
     C*            @DCRI  - Deal customer receive instructions        *
     C*            @MCRI  - Midas customer receive instructions       *
     C*            @DFAC  - Deal for account of                       *
     C*            @MFAO  - Midas for account of                      *
     C*                                                               *
     C*****************************************************************
     C           #ZD       BEGSR
     C*
     C****SET*UP*SUPPLEMENTARY FIELDS FOR STANDARD DEAL NA'S BOUGHT       S01194
     C***********          MOVEL'20'      @KEY                            S01194
     C***********          MOVE '1'       @KEY4                           S01194
     C*
     C**  FIND MIDAS DEAL TYPE
     C           IHTYPE    IFEQ *BLANKS                    B1
     C                     MOVEL*BLANKS   IHMTYP           *1
     C                     ELSE                            X1
     C                     MOVELIHTYPE    @HTYPE  3        *1
     C                     MOVE IHRBSI    @HTYPE           *1
     C           @HTYPE    LOKUPTAB3      TAB4           61*1
     C                     MOVELTAB4      IHMTYP           *1
     C                     END                             E1
     C*
     C**  FIND MIDAS BRANCH CODE & BRANCH NAME
     C           IHDBRC    IFNE *BLANKS                    B1
     C*
     C***ACCESS*FDBSNCLL USING DEAL BRANCH CODE                           S01194
     C*********  IHDBRC    CHAINFDBSNCLL             61    **2            S01194
      *                                                                   S01194
      ** ACCESS BRANCH CODES FILE FOR DEAL BRANCH CODE                    S01194
     C**********           CALL 'AOBRCHR0'                                             S01194 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD            **2            S01194
     C                     PARM '*KEY   ' @OPTN            **2            S01194
     C                     PARM IHDBRC    @WRK3            **2            S01194
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01194 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*
     C**  CHECK FOR DATA BASE ERROR
     C*********  *IN61     IFEQ '1'                        B**3           S01194
     C           @RTCD     IFNE *BLANK                     B**3           S01194
     C                     MOVELIHDBRC    DBKEY            ***3
     C*********            MOVEL'FDBSNCLL'DBFILE                          S01194
     C                     MOVEL'SDBRCHPD'DBFILE           ************   S01194
     C                     MOVEL'022'     DBASE            * DB ERR 22*
     C                     MOVEL@OPTN     DBOPTN           **3            S01194
     C                     EXSR #Z                         ************
     C                     END                             E**3
     C*
     C*****                MOVE KEY       IHBRCD           **2            S01117
     C**********           MOVE KEY       IHBRCA           **2     S01117 S01194
     C**********           MOVE BRNM      IHBRNM           **2            S01194
     C                     MOVE A8BRCD    IHBRCA           **2            S01194
     C                     MOVE A8BRNM    IHBRNM           **2            S01194
     C                     END                             E1
     C*
     C**  FIND LAST ACTION DATE
     C***********          Z-ADDRUND      @@DAYN                          S01194
     C                     Z-ADDBJRDNB    @@DAYN                          S01194
     C***********          EXSR ZA0710                                    056095
     C                     EXSR ZDATE9                                    056095
     C                     Z-ADD@@VDT     IHLDAT
     C*
     C****FIND*BROKER*NAME*&*TOWN*-*ACCESS*FDBRKRLL*WITH*BROKER CODE      S01194
     C**  FIND BROKER NAME & TOWN - ACCESS BROKER FILE                    S01194
     C           IHBKCD    IFNE *BLANKS                    B1
     C           IHBKCD    ANDNE'TELX'                     *1
     C           IHBKCD    ANDNE'PHON'                     *1
     C           IHBKCD    ANDNE'MAIL'                     *1
     C*
     C*********            MOVE *BLANKS   @KEY             *1             S01194
     C*********            MOVEL'80'      @KEY             *1             S01194
     C*********            MOVE IHBKCD    @KEY             *1             S01194
     C*********                                                           S01194
     C*********  @KEY      CHAINFDBRKRLL             61    *1             S01194
      *                                                                   S01194
     C*****                CALL 'AOBRCHR0'                         S01194 E136
     C                     CALL 'AOBROKR0'                                E136
     C                     PARM '*MSG   ' @RTCD            *1             S01194
     C                     PARM '*KEY   ' @OPTN            *1             S01194
     C*****                PARM IHBKCD    @WRK3            *1      S01194 E136
     C                     PARM IHBKCD    @BQTX   4        *1             E136
     C           SDBROK    PARM SDBROK    DSFDY                           S01194
      *                                                                   S01194
     C**  CHECK FOR DATA BASE ERROR
     C*********  *IN61     IFEQ '1'                        B*2            S01194
     C*********            MOVELIHBKCD    DBKEY            **2            S01194
     C*********            MOVEL'FDBRKRLL'DBFILE                          S01194
     C*********            MOVEL@KEY      DBKEY            **2            S01194
     C           @RTCD     IFNE *BLANKS                    B*2            S01194
     C                     MOVELIHBKCD    DBKEY            **2            S01194
     C                     MOVEL'SDBROKPD'DBFILE           ************   S01194
     C                     MOVEL'023'     DBASE            * DB ERR 23*
     C                     MOVEL@OPTN     DBOPTN           **2            S01194
     C                     EXSR #Z                         ************
     C                     END                             E*2
     C*
     C*********            MOVELBKNM      IHBKNM           *1             S01194
     C*********            MOVELBKTN      IHBKTN           *1             S01194
     C                     MOVELA9BKNM    IHBKNM           *1             S01194
     C                     MOVELA9BRTN    IHBKTN           *1             S01194
     C*
     C                     END                             E1
     C*
     C****MOVE*VALUE/START*DATE**INTO*START*LAST*INTEREST*DATE*IF         E14177
     C****START*LAST*INTEREST*DATE*=*ZERO                                 E14177
     C********   @IHLIY    IFEQ *ZERO                      B1             E14177
     C********   IHLACT    ANDEQ'I'                        *1             E14177
     C********             Z-ADD@IHVDY    @IHLIY           *1             E14177
     C********             END                             E1             E14177
     C*
     C**  CONVERT DATES FROM 8,0 TO DAY NUMBER FORMAT
     C**  DEAL VALUE/START DATE
     C           @IHLIY    IFNE *ZERO                      B1
     C***********          Z-ADD@IHLIY    @@DTIN           *1             056095
     C***********          EXSR ZA0680                     *1             056095
     C***********          Z-ADD@@MDNO    IHSLID           *1             056095
     C                     Z-ADD@IHLIY    ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    IHSLID           *1             056095
     C                     END                             E1
     C*
     C**  DEAL VALUE/START DATE
     C           @IHVDY    IFNE *ZERO                      B1
     C***********          Z-ADD@IHVDY    @@DTIN           *1             056095
     C***********          EXSR ZA0680                     *1             056095
     C***********          Z-ADD@@MDNO    IHDVSD           *1             056095
     C                     Z-ADD@IHVDY    ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    IHDVSD           *1             056095
     C*
     C**  SET INTEREST ACCRUAL DATE TO VALUE DATE
     C                     Z-ADD@IHVDY    @IHIAY           *1
     C                     Z-ADDIHDVSD    IHIACD           *1
     C                     END                             E1
     C*
     C**  DEAL DONE DATE
     C           @IHDDY    IFNE *ZERO                      B1
     C***********          Z-ADD@IHDDY    @@DTIN           *1             056095
     C***********          EXSR ZA0680                     *1             056095
     C***********          Z-ADD@@MDNO    IHDDND           *1             056095
     C                     Z-ADD@IHDDY    ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    IHDDND           *1             056095
     C                     END                             E1
     C*
     C**  DEAL LAST ACTION DATE
     C           IHLDAT    IFNE *ZERO                      B1
     C***********          Z-ADDIHLDAT    @@DTIN           *1             056095
     C***********          EXSR ZA0680                     *1             056095
     C***********          Z-ADD@@MDNO    IHDLAD           *1             056095
     C                     Z-ADDIHLDAT    ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    IHDLAD           *1             056095
     C                     END                             E1
     C*
     C**  NEXT INTEREST PAYMENT DATE
     C           @IHNIY    IFNE *ZERO                      B1
     C***********          Z-ADD@IHNIY    @@DTIN           *1             056095
     C***********          EXSR ZA0680                     *1             056095
     C***********          Z-ADD@@MDNO    IHNIPD           *1             056095
     C                     Z-ADD@IHNIY    ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    IHNIPD           *1             056095
     C                     END                             E1
     C*
     C**  DEAL MATURITY DATE
     C           @IHMDY    IFNE *ZERO                      B1
     C***********          Z-ADD@IHMDY    @@DTIN           *1             056095
     C***********          EXSR ZA0680                     *1             056095
     C***********          Z-ADD@@MDNO    IHMATD           *1             056095
     C                     Z-ADD@IHMDY    ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    IHMATD           *1             056095
     C                     END                             E1
     C*
     C**  FIND MIDAS TOTAL INTEREST
     C           IHTYPE    IFEQ 'C1'                       B1
     C           IHINTR    ANDNE*ZERO                      *1
     C           IHAMNP    ANDNE*ZERO                      *1
     C           IHICMT    ANDNE*BLANK                     *1
     C           IHMATD    ANDNE*ZERO                      *1
     C           IHDVSD    ANDNE*ZERO                      *1
     C                     Z-ADDIHINTR    @@RATE           *1
     C                     Z-ADDIHAMNP    @@AMT            *1
     C***********          MOVELIHICMT    @@CALC           *1             056095
     C***********          Z-ADDIHMATD    @@END            *1             056095
     C***********          Z-ADDIHDVSD    @@BEG            *1             056095
     C                     MOVELIHICMT    ZZCALC           *1             056095
     C                     Z-ADDIHMATD    ZZEND            *1             056095
     C                     Z-ADDIHDVSD    ZZBEG            *1             056095
     C                     MOVE IHRDFC    @@RDFC           *1             S01392
     C*********************EXSR MM1007                     *1             E17051
     C                     EXSR MM1030                     *1             E17051
     C                     Z-SUB@@INTR    IHMTTI           *1
     C                     END                             E1
     C*
     C**  IF INTEREST BEARING NA CALCULATE MIDAS PURCHASED INTEREST
     C           IHTYPE    IFEQ 'C1'                       B1
     C           IHTYPE    OREQ 'C2'                       *1
     C           IHTYPE    OREQ 'BI'                       *1
     C           IHTYPE    OREQ 'BP'                       *1             083409
     C           IHTYPE    OREQ 'BO'                       *1
     C***********IHFRAT    ANDNE*ZERO                      *1             083409
     C           IHFRAT    IFNE *ZERO                      *1             083409
     C           IHFVAL    ANDNE*ZERO                      *1
     C           IHICMT    ANDNE*ZERO                      *1
     C           IHSLID    ANDNE*ZERO                      *1
     C           IHDVSD    ANDNE*ZERO                      *1
     C***********          Z-ADDIHSLID    @@BEG            *1             056095
     C***********          Z-ADDIHDVSD    @@END            *1             056095
     C                     Z-ADDIHSLID    ZZBEG            *1             056095
     C                     Z-ADDIHDVSD    ZZEND            *1             056095
     C                     Z-ADDIHFRAT    @@RATE           *1
     C                     Z-ADDIHFVAL    @@AMT            *1
     C***********          MOVELIHICMT    @@CALC           *1             056095
     C                     MOVELIHICMT    ZZCALC           *1             056095
     C                     MOVE IHRDFC    @@RDFC           *1             S01392
     C*********************EXSR MM1007                     *1             E17051
     C                     EXSR MM1030                     *1             E17051
     C                     Z-ADD@@INTR    IHMPIT           *1
     C                     END                             E1             083409
     C                     END                             E1
     C*
     C**  DEAL ISSUER IS NOT BLANK FIND MIDAS ISSUER ON SHORT NAME FILE
     C           IHISUR    IFNE *BLANK
     C********   IHISUR    CHAINSNAME                61                   E13173
     C********   IHISUR    CHAINFDCSNMLL             61            E13173 S01194
      *
     C                     CALL 'AOCUSTR0'                                S01194
     C*********************PARM '*DBERR ' @RTCD            *1       S01194E234
     C                     PARM '*MSG   ' @RTCD            *1             E234
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM IHISUR    @WRK10                          S01194
     C                     PARM *BLANKS   @WRK7                           S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
     C*
     C**  CHECK FOR DATA BASE ERROR
     C********   *IN61     IFEQ '1'                        B1             S01194
     C           @RTCD     IFNE *BLANK                     B1             S01194
     C                     MOVELIHISUR    DBKEY            *1
     C********             MOVEL'SNAME   'DBFILE           ************   E13173
     C********             MOVEL'FDCSNMLL'DBFILE                   E13176 S01194
     C                     MOVEL'SDCUSTPD'DBFILE           ************   S01194
     C                     MOVEL'024'     DBASE            * DB ERR 24*
     C                     MOVEL@OPTN     DBOPTN           **2            S01194
     C                     EXSR #Z                         ************
     C                     END                             E1
     C*
     C********             Z-ADDCNUM      IHISCN                          S01194
     C                     MOVE BBCUST    IHISCN                          S01194
     C                     END
     C*
     C**  DISCOUNT AMOUNT = FACE VALUE + AMOUNT + PURCHASED INTEREST
     C***********IHFVAL****ADD  IHAMNP    IHDCAM                          E18100
     C           IHFVAL    ADD  IHAMNP    IHDCAM                          BHF901
     C                     ADD  IHMPIT    IHDCAM                          E18100
     C*                                                                   ME1395
     C** FOR DISCOUNT NABS I.E. NO YIELD INPUT, CALCULATE YIELD.          ME1395
     C*                                                                   ME1395
     C           IHTYPE    IFNE 'C1'                       B1             ME2062
     C           IHINTR    ANDEQ0                          A1             ME2062
     C*******              Z-SUBIHAMNP    @PUPR  150       *1             ME2062
     C*******    IHDCAM    DIV  @PUPR     @YDRT  139       *1             ME2062
     C*******    @YDRT     MULT 100       IHINTR           *1             ME2062
     C*
     C**  SETUP FIELDS FOR SR.MM1025                                      ME2062
     C*                                                                   ME2062
     C***********          MOVE IHVDYY    @@YYYY           *1       ME2062056095
     C***********          MOVE IHVDMM    @@MTH            *1       ME2062056095
     C***********          MOVE IHVDDD    @@DAY            *1       ME2062056095
     C***********          EXSR ZA0680                     *1       ME2062056095
     C***********          Z-ADD@@MDNO    @@BEG            *1       ME2062056095
     C                     MOVE IHVDYY    ZWYYYY           *1             056095
     C                     MOVE IHVDMM    ZWMTH            *1             056095
     C                     MOVE IHVDDD    ZWDAY            *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    ZZBEG            *1             056095
     C*                                                                   ME2062
     C***********          MOVE IHMDYY    @@YYYY           *1       ME2062056095
     C***********          MOVE IHMDMM    @@MTH            *1       ME2062056095
     C***********          MOVE IHMDDD    @@DAY            *1       ME2062056095
     C***********          EXSR ZA0680                     *1       ME2062056095
     C***********          Z-ADD@@MDNO    @@END            *1       ME2062056095
     C                     MOVE IHMDYY    ZWYYYY           *1             056095
     C                     MOVE IHMDMM    ZWMTH            *1             056095
     C                     MOVE IHMDDD    ZWDAY            *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    ZZEND            *1             056095
     C*                                                                   ME2062
     C                     Z-ADDIHDCRT    @@DIRT           *1             ME2062
     C***********          MOVE IHICMT    @@CALC           *1       ME2062056095
     C                     MOVE IHICMT    ZZCALC           *1             056095
     C*                                                                   ME2062
     C                     EXSR MM1025                     *1             ME2062
     C*                                                                   ME2062
     C                     Z-ADD@@YLD     IHINTR           *1             ME2062
     C*                                                                   ME2062
     C                     END                             E1             ME1395
     C*                                                                   ME2062
     C****FIND*MIDAS A/C SEQUENCE NUMBER                          *****   S01117
     C*****      MBIN      IFEQ 'Y'                        B1     *****   S01117
     C*****      IHLACT    ANDEQ'I'                        *1     *****   S01117
     C*****      IHACSQ    ANDEQ*ZERO                      *1     *****   S01117
     C*****                Z-ADDNSACS     IHACSQ           *1     *****   S01117
     C*****                END                             E1     *****   S01117
     C*
     C           MBIN      IFNE 'Y'                        B1
     C           IHLACT    ANDEQ'I'                        *1
     C           IHACSQ    ANDEQ*ZERO                      *1
     C                     Z-ADD1         IHACSQ           *1
     C                     END                             E1
     C*
     C**  SET UP SOLD INDICATOR
     C           IHDADN    IFNE *BLANK                     B1
     C                     MOVEL'2'       IHSOLD           *1
     C                     ELSE                            X1
     C*
     C           IHSLDB    IFNE *BLANK                     B*2
     C                     MOVEL'1'       IHSOLD           **2
     C                     ELSE                            X*2
     C                     MOVEL*BLANK    IHSOLD           **2
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C**  CONVERT INTEREST ACCRUAL DATE TO 5,0 FORMAT
     C           @IHIAY    IFNE *ZERO                      B1
     C***********          Z-ADD@IHIAY    @@DTIN           *1             056095
     C***********          EXSR ZA0680                     *1             056095
     C***********          Z-ADD@@MDNO    IHIACD           *1             056095
     C                     Z-ADD@IHIAY    ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    IHIACD           *1             056095
     C                     END                             E1
     C*
     C*
     C** MIDAS OUR RECEIVE METHOD
     C**  Extended settlement fields for PC are set up                    S01227
     C**  at the end of the subroutine.                                   S01227
     C           IHORCM    IFEQ *ZERO                      B1
     C*
     C           IHDORM    ORNE HLDORM                     B*2
     C                     MOVELIHDORM    @DORM            **2
     C                     EXSR #ZAA                       **2
     C                     Z-ADD@ORCM     IHORCM           **2
     C                     ELSE                            X*2
     C           HLDORM    IFEQ *BLANK                     B**3
     C                     Z-ADD*ZERO     IHORCM           ***3
     C                     ELSE                            X**3
     C                     Z-ADDHLORCM    IHORCM           ***3
     C                     END                             E**3
     C*
     C                     END                             E1
      *                                                                   CEU003
      ** Setup deals-effective-currency-workfield                         CEU003
      *                                                                   CEU003
     C                     MOVE *BLANKS   WDECY                           CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           HLSTCY    ANDNE*BLANKS                                   CEU003
      *                                                                   CEU003
     C                     MOVELHLSTCY    WDECY                           CEU003
      *                                                                   CEU003
     C                     ELSE                                           CEU003
      *                                                                   CEU003
     C                     MOVELHLCCY     WDECY                           CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
     C*
     C** MIDAS OUR RECEIVE INSTRUCTIONS
     C**  Extended settlement fields for PC are set up                    S01227
     C**  at the end of the subroutine.                                   S01227
     C           IHLACT    IFEQ 'I'                        B1             E12909
     C           IHMORI    IFEQ *BLANKS                    B2             E12909
     C                     MOVELIHDORM    @DORM            **2            E12909
     C                     MOVELIHDORI    @DORI            **2            E12909
     C***********          MOVELIHCCY     @CCY             **2     E12909 CEU003
     C                     MOVELWSECY     @CCY                            CEU003
     C                     MOVELIHCNUM    @CNUM            **2            E12909
     C                     MOVELIHMORI    NOSN3            **2            BHF860
     C                     EXSR #ZAB                       **2            E12909
     C                     MOVEL@MORI     IHMORI           **2            E12909
     C                     END                             E2             E12909
     C                     ELSE                            X1             E12909
     C           IHMORI    IFEQ *BLANKS                    B2
     C***********IHDORI    ORNE HLDORI                     **2            E22150
     C           IHDORI    IFNE HLDORI                     B**3           E22150
     C           IHDORM    ORNE HLDORM                     ***3
     C***********IHCCY     ORNE HLCCY                      ***3           CEU003
     C           WDECY     ORNE WSECY                                     CEU003
     C                     MOVELIHDORM    @DORM            ***3
     C                     MOVELIHDORI    @DORI            ***3
     C***********          MOVELIHCCY     @CCY             ***3           CEU003
     C                     MOVELWSECY     @CCY                            CEU003
     C                     MOVELIHCNUM    @CNUM            ***3
     C                     MOVELIHMORI    NOSN3            **2            BHF860
     C                     EXSR #ZAB                       ***3
     C                     MOVEL@MORI     IHMORI           ***3
     C                     ELSE                            X**3
     C                     MOVE HLMORI    IHMORI           ***3
     C                     END                             E**3           E22150
     C                     END                             E2
     C                     END                             E1             E12909
     C*
     C** MIDAS OUR PAY METHOD
     C**  Extended settlement fields for PC are set up                    S01227
     C**  at the end of the subroutine.                                   S01227
     C           IHMOPM    IFEQ *ZEROS                     B1
     C           IHDOPM    IFNE HLDOPM                     B*2
     C                     MOVELIHDOPM    @DOPM            **2
     C                     EXSR #ZAC                       **2
     C                     Z-ADD@MOPM     IHMOPM           **2
     C                     ELSE                            X*2
     C           HLDOPM    IFEQ *BLANK                     B**3
     C                     Z-ADD*ZERO     IHMOPM           ***3
     C                     ELSE                            X**3
     C                     MOVE HLMOPM    IHMOPM           ***3
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E1
     C*
     C** MIDAS OUR PAY INSTRUCTIONS
     C**  Extended settlement fields for PC are set up                    S01227
     C**  at the end of the subroutine.                                   S01227
     C           IHLACT    IFEQ 'I'                        B1             E12909
     C           IHMOPI    IFEQ *BLANKS                    B2             E12909
     C                     MOVELIHDOPM    @DOPM            **2            E12909
     C                     MOVELIHDOPI    @DOPI            **2            E12909
     C***********          MOVELIHCCY     @CCY             **2     E12909 CEU003
     C                     MOVELWSECY     @CCY                            CEU003
     C                     MOVELIHCNUM    @CNUM            **2            E12909
     C                     MOVELIHMOPI    NOSN3                           BHF860
     C                     EXSR #ZAD                       **2            E12909
     C                     MOVEL@MOPI     IHMOPI           **2            E12909
     C                     END                             E2             E12909
     C                     ELSE                            X1             E12909
     C           IHMOPI    IFEQ *BLANKS                    B2
     C***********IHDOPI    ORNE HLDOPI                     **2            E22150
     C           IHDOPI    IFNE HLDOPI                     B**3           E22150
     C           IHDOPM    ORNE HLDOPM                     ***3
     C***********HLCCY     ORNE IHBUCY                     ***3           CEU003
     C           WDECY     ORNE IHBUCY                                    CEU003
     C                     MOVELIHDOPM    @DOPM            ***3
     C                     MOVELIHDOPI    @DOPI            ***3
     C***********          MOVELIHCCY     @CCY             ***3           CEU003
     C                     MOVELWSECY     @CCY                            CEU003
     C                     MOVELIHCNUM    @CNUM            ***3
     C                     MOVELIHMOPI    NOSN3                           BHF860
     C                     EXSR #ZAD                       ***3
     C                     MOVEL@MOPI     IHMOPI           ***3
     C                     ELSE                            X**3
     C                     MOVE HLMOPI    IHMOPI           ***3
     C                     END                             E**3           E22150
     C                     END                             E2
     C                     END                             E1             E12909
     C*
     C** MIDAS CUSTOMER PAY INSTRUCTIONS
     C**  Extended settlement fields for PC are set up                    S01227
     C**  at the end of the subroutine.                                   S01227
     C           IHMCPI    IFEQ *BLANKS                    B1
     C           IHDCPI    ORNE HLDCPI                     B*2
     C                     MOVELIHDCPI    @DCPI            **2
     C                     EXSR #ZAE                       **2
     C                     MOVEL@MCPI     IHMCPI           **2
     C                     ELSE                            X*2
     C                     MOVE HLMCPI    IHMCPI           **2
     C                     END                             E1
     C*
     C** MIDAS CUSTOMER RECEIVE INSTRUCTIONS
     C**  Extended settlement fields for PC are set up                    S01227
     C**  at the end of the subroutine.                                   S01227
     C           IHMCRI    IFEQ *BLANKS                    B1
     C           IHDCRI    ORNE HLDCRI                     B*2
     C                     MOVELIHDCRI    @DCRI            **2
     C                     EXSR #ZAF                       **2
     C                     MOVEL@MCRI     IHMCRI           **2
     C                     ELSE                            X*2
     C                     MOVE HLMCRI    IHMCRI           **2
     C                     END                             E1
     C*
     C** MIDAS FOR ACCOUNT OF
     C**  Extended settlement fields for PC are set up                    S01227
     C**  at the end of the subroutine.                                   S01227
     C           IHMFAO    IFEQ *BLANKS                    B1
     C           IHDFAC    ORNE HLDFAC                     B*2
     C************         MOVELIHDFAC    @DFAC            **2      BHF307114913
     C                     MOVELIHBENN    @DFAC            **2            114913
     C                     EXSR #ZAG                       **2
     C                     MOVEL@MFAO     IHMFAO           **2
     C                     ELSE                            X*2
     C                     MOVE HLMFAO    IHMFAO           **2
     C                     END                             E1
     C*
     C***Set*up*extended*settlement*fields*for*the*PC***************S01227S01319
     C***********@FB*******IFEQ*'F'************************B1*******S01227S01319
     C*********************MOVELIHORCM****IHRSTM************1*******S01227S01319
     C*********************MOVELIHMORI****IHRONS************1*******S01227S01319
     C*********************MOVELIHMOPM****IHPSTM************1*******S01227S01319
     C*********************MOVELIHMOPI****IHPONS************1*******S01227S01319
     C*********************MOVELIHSPEC****IHBTB1************1*******S01227S01319
     C*********************MOVELIHMCPI****IHRIBN************1*******S01227S01319
     C*********************MOVELIHMCRI****IHAWBN************1*******S01227S01319
     C*********************MOVELIHMFAO****IHBENN************1*******S01227S01319
     C*********************MOVE*'N'*******IHCVMR************1*******E22405S01319
     C*********************END*****************************E1*******S01227S01319
     C*                                                                   S01227
     C           #ZD9      ENDSR                           ****#ZD9****
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZE      - NAB's Before Fields                                *
     C*                                                               *
     C* CALLS    #Z       - Data base errors                          *
     C*                                                               *
     C* CALLED BY  #BBB   - NAB Amends                                *
     C*                                                               *
     C* FLDS USED  @HLVDY - Vlaue date                                *
     C*            @HLNIY - Next interest date                        *
     C*            @HLLIY - Last interest date                        *
     C*            @HLMDY - Maturity Date                             *
     C*                                                               *
     C*****************************************************************
     C           #ZE       BEGSR
     C*
     C**  CHAIN TO DEALS FILE
     C           IHDN38    CHAINMMDEALLL             61
     C*
     C**  CHECK FOR DATA BASE ERROR
     C           *IN61     IFEQ '1'                        B1
     C                     MOVELIHDN38    DBKEY            *1
     C                     MOVEL'MMDEALLL'DBFILE           ************
     C                     MOVEL'025'     DBASE            * DB ERR 25*
     C                     EXSR #Z                         ************
     C                     END                             E1
     C/COPY WNCPYSRC,MM0078C016
     C*
     C                     MOVELHLORCM    IHBORM
     C                     MOVELHLMORI    IHBORI
     C                     MOVELHLDCPI    IHBCPI
     C                     MOVELHLMOPM    IHBOPM
     C                     MOVELHLMOPI    IHBOPI
     C                     MOVELHLDCRI    IHBCRI
     C                     Z-ADDHLAMNP    IHBAMT
     C                     MOVELHLCCY     IHBUCY
     C                     MOVELHLCNUM    IHBCNM
     C                     Z-ADD@HLVDY    IHBVDT
     C                     MOVELHLDSTS    IHBSTS
     C                     MOVELHLCSNM    IHBCSN
     C                     Z-ADDHLINTR    IHBIRT
     C                     Z-ADD@HLNIY    IHBNID
     C                     MOVELHLIPFQ    IHBIPF
     C                     MOVELHLICMT    IHBICM
     C                     Z-ADDHLIPDM    IHBIDM
     C                     Z-ADDHLFVAL    IHBFVL
     C                     Z-ADDHLFRAT    IHBFRT
     C                     MOVELHLISUR    IHBISR
     C                     Z-ADD@HLLIY    IHBLID
     C                     Z-ADD@HLMDY    IHBMTD
     C                     MOVELHLRDFC    IHRDFC                          S01392
     C                     MOVELHLORBR    IHORBR                          059594
     C                     MOVELHLROBR    IHBROB                          BHF477
     C                     MOVELHLPOBR    IHBPOB                          BHF477
     C*
     C           #ZE9      ENDSR                           ****#ZE9****
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZF      - NAB's Related Fields                               *
     C*                                                               *
     C* CALLS    #Z       - Data base errors                          *
     C*                                                               *
     C* CALLED BY         -                                           *
     C*                                                               *
     C* FLDS USED  @IHDAD - File update information                   *
     C*            @HMVDY - Value date                                *
     C*            @HMNIY - Next interest date                        *
     C*            @HMLIY - Last interest date                        *
     C*            @HMMDY - Maturity Date                             *
     C*                                                               *
     C*****************************************************************
     C           #ZF       BEGSR
     C*
     C**  CHAIN TO DEALS FILE
     C           @IHDAD    CHAINMMDEALLL             61
     C*
     C**  CHECK FOR DATA BASE ERROR
     C           *IN61     IFEQ '1'                        B1
     C                     MOVEL@IHDAD    DBKEY            *1
     C                     MOVEL'MMDEALLL'DBFILE           ************
     C                     MOVEL'026'     DBASE            * DB ERR 26*
     C                     EXSR #Z                         ************
     C                     END                             E1
     C*
     C                     MOVELHMDORM    IHRORM
     C                     MOVELHMDORI    IHRORI
     C                     MOVELHMDCPI    IHRCPI
     C                     Z-ADDHMAMNP    IHRBAT
     C                     MOVELHMCCY     IHRBCY
     C**********           Z-ADDHMCNUM    IHRCNM                                              CSD027
     C                     MOVE HMCNUM    IHRCNM                                              CSD027
     C                     Z-ADD@HMVDY    IHRVDT
     C                     MOVELHMDSTS    IHRSTS
     C                     MOVELHMCSNM    IHRCSN
     C                     Z-ADDHMINTR    IHRIRT
     C                     Z-ADD@HMNIY    IHRNID
     C                     MOVELHMIPFQ    IHRIPF
     C                     MOVELHMICMT    IHRICM
     C                     Z-ADDHMIPDM    IHRIDM
     C                     Z-ADDHMFVAL    IHRFVL
     C                     MOVELHMISUR    IHRISR
     C                     Z-ADD@HMLIY    IHRLID
     C                     Z-ADD@HMMDY    IHRMTD
     C*
     C           #ZF9      ENDSR                           ****#ZF9****
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C********************************************************************S01319
     C**#ZG******-*NAB's*Download*Blotter*********************************S01319
     C********************************************************************S01319
     C**CALLS*************-***********************************************S01319
     C********************************************************************S01319
     C**CALLED*BY**#BBA***-*NAB*Inserts***********************************S01319
     C*************#BBB***-*NAB*Amends************************************S01319
     C*************#BBC***-*NAB*Deletes***********************************S01319
     C********************************************************************S01319
     C**FLDS*USED**@IHVDY*-*Value*date************************************S01319
     C*************@I1VDY*-*Value*Date************************************S01319
     C*************@IHDTY*-*Deal*transaction*date*************************S01319
     C*************@I1DTY*-*Deal*transaction*date*************************S01319
     C*************@IHDDY*-*Deal*done*date********************************S01319
     C*************@I1DDY*-*Deal*done*date********************************S01319
     C*************@IHMDY*-*Maturity*date*********************************S01319
     C*************@I1MDY*-*Maturity*date*********************************S01319
     C*************@IHNIY*-*Next*interest*date****************************S01319
     C*************@I1NIY*-*Next*interest*date****************************S01319
     C*************@IHLIY*-*Last*interest*date****************************S01319
     C*************@I1SLY*-*Start/last*interest*date**********************S01319
     C*************@IHIAY*-*Interest*accrual*control*date*****************S01319
     C*************@I1IAY*-*Interest*accrual*control*date*****************S01319
     C********************************************************************S01319
     C********************************************************************S01319
     C***********#ZG*******BEGSR******************************************S01319
     C********************************************************************S01319
     C*********************MOVEL'I1'******I1RCID**************************S01319
     C*********************MOVELIHPCDN****I1PCDN**************************S01319
     C*********************MOVELIHPCDN****I1PCD1**************************S01319
     C*********************Z-ADDIHDN38****I1DN38**************************S01319
     C*********************MOVELIHBKCD****I1BKCD**************************S01319
     C*********************MOVELIHBKCD****I1BKC1**************************S01319
     C*********************MOVELIHCCY*****I1CCY1**************************S01319
     C*********************MOVELIHCCY*****I1CCY2**************************S01319
     C*********************MOVELIHCCY*****I1CCY3**************************S01319
     C*********************Z-ADDIHTIME****I1TIME**************************S01319
     C*********************Z-ADDIHTIME****I1TIM1**************************S01319
     C********************************************************************S01319
     C*********************Z-ADD@IHVDY****@I1VDY**************************S01319
     C********************************************************************S01319
     C*********************Z-ADD@IHDTY****@I1DTY**************************S01319
     C********************************************************************S01319
     C*********************MOVELIHDADN****I1DA38**************************S01319
     C********************************************************************S01319
     C***********IHLACT****IFEQ*'D'************************B1*************S01319
     C*********************MOVEL'D'*******I1DDLT************1*************S01319
     C*********************ELSE****************************X1*************S01319
     C*********************MOVEL*BLANK****I1DDLT************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C*********************MOVELIHDSTS****I1DSTS**************************S01319
     C*********************MOVELIHTYPE****I1TYPE**************************S01319
     C*********************MOVELIHRBSI****I1RBSI**************************S01319
     C*********************MOVELIHSTYP****I1STYP**************************S01319
     C*********************MOVELIHCSNM****I1CSNM**************************S01319
     C********************************************************************S01319
     C*********************Z-ADDIHINTR****I1INTS**************************S01319
     C***********IHINTR****IFLT**ZERO*************************************S01319
     C*********************Z-SUBI1INTS****I1INTS**************************S01319
     C*********************MOVEL'-'*******I1INSN**************************S01319
     C*********************END********************************************S01319
     C********************************************************************S01319
     C***********IHINTR****IFEQ**ZERO*************************************S01319
     C*********************MOVE**BLANK****I1INSN**************************S01319
     C*********************END********************************************S01319
     C********************************************************************S01319
     C***********IHINTR****IFGT**ZERO*************************************S01319
     C*********************MOVEL'+'*******I1INSN**************************S01319
     C*********************END********************************************S01319
     C********************************************************************S01319
     C*********************MOVE**BLANKS***I1DBSR**************************S01319
     C*********************MOVELIHDBRC****I1DBRC**************************S01319
     C*******              Z-ADD*ZERO     I1NTCE                          ME2054
     C*******              MOVE *BLANK    I1NTSN                          ME2054
     C*********************Z-ADD999*******I1NTCE********************ME2054S01319
     C*********************MOVE*'-'*******I1NTSN********************ME2054S01319
     C********************************************************************S01319
     C*********************Z-ADD@IHDDY****@I1DDY**************************S01319
     C********************************************************************S01319
     C*********************Z-ADD@IHMDY****@I1MDY**************************S01319
     C********************************************************************S01319
     C*********************Z-ADDIHFCLY****I1FCLY**************************S01319
     C*********************Z-ADDIHBRAT****I1BRTS**************************S01319
     C********************************************************************S01319
     C*********************MOVELIHDORM****I1DORM**************************S01319
     C*********************MOVELIHDORI****I1DORI**************************S01319
     C*********************MOVELIHDCPI****I1DCPI**************************S01319
     C*********************MOVELIHDOPM****I1DOPM**************************S01319
     C*********************MOVELIHDOPI****I1DOPI**************************S01319
     C*********************MOVELIHDCRI****I1DCRI**************************S01319
     C********************************************************************S01319
     C*********************MOVELIHMFAO****I1MFAO**************************S01319
     C*********************MOVELIHSPEC****I1SPEC**************************S01319
     C********************************************************************S01319
     C*********************Z-ADD@IHNIY****@I1NIY**************************S01319
     C********************************************************************S01319
     C*********************MOVELIHIPFQ****I1IPFQ**************************S01319
     C*********************MOVELIHICMT****I1ICMT**************************S01319
     C*********************Z-ADDIHIPDM****I1IPDM**************************S01319
     C********************************************************************S01319
     C*********************Z-ADD@IHLIY****@I1SLY**************************S01319
     C*********************Z-ADD@IHIAY****@I1IAY**************************S01319
     C********************************************************************S01319
     C*********************Z-ADDIHFRAT****I1FRTS**************************S01319
     C*********************Z-ADDIHDCRT****I1DRTS**************************S01319
     C*********************MOVELIHSLDB****I1SLDB**************************S01319
     C*********************MOVELIHISUR****I1ISUR**************************S01319
     C*********************MOVELIHCDRF****I1CDRF**************************S01319
     C*********************MOVELIHFEDF****I1FEDF**************************S01319
     C********************************************************************S01319
     C*********************Z-ADDIHPCTN****I1PCTN**************************S01319
     C*********************MOVELIHCDRP****I1CDRP**************************S01319
     C*********************MOVELIHLACT****I1LACT**************************S01319
     C*********************Z-ADDIHTIME****I1TIM1**************************S01319
     C*********************Z-ADDIHTIME****I1TIM2**************************S01319
     C*********************MOVELIHBKCY****I1BKCY**************************S01319
     C*********************MOVELIHDUSC****I1DUSC**************************S01319
     C*********************MOVE**BLANK****I1CNTI**************************S01319
     C*********************Z-ADD*ZERO*****I1IMTI**************************S01319
     C*********************Z-ADD*ZERO*****I1IMTD**************************S01319
     C*********************MOVE**BLANK****I1IMTS**************************S01319
     C*********************MOVE**BLANKS***I1ROBY**************************S01319
     C*********************MOVE*'N'*******I1NAID**************************S01319
     C********             Z-ADD*ZERO     I1BRKI                          E14377
     C********             Z-ADD*ZERO     I1BRKD                          E14377
     C********************************************************************S01319
     C****FIND*AMOUNT*&*FACE*VALUE*TO*CORRECT*DECIMAL*PLACES**************S01319
     C*********************Z-ADD*ZERO*****I1AMNI**************************S01319
     C*********************Z-ADD*ZERO*****I1AMND**************************S01319
     C*********************Z-ADD*ZERO*****I1FVLI**************************S01319
     C*********************Z-ADD*ZERO*****I1FVLD**************************S01319
     C********************************************************************S01319
     C***********IHAMNP****IFLT**ZERO*************************************S01319
     C*********************Z-SUBIHAMNP****@HAMNP**************************S01319
     C*********************MOVEL'-'*******I1AMSN**************************S01319
     C*********************END********************************************S01319
     C********************************************************************S01319
     C***********IHAMNP****IFEQ**ZERO*************************************S01319
     C*********************Z-ADD*ZERO*****@HAMNP**************************S01319
     C*********************MOVE**BLANK****I1AMSN**************************S01319
     C*********************END********************************************S01319
     C********************************************************************S01319
     C***********IHAMNP****IFGT**ZERO*************************************S01319
     C*********************Z-ADDIHAMNP****@HAMNP**************************S01319
     C*********************MOVEL'+'*******I1AMSN**************************S01319
     C*********************END********************************************S01319
     C********************************************************************S01319
     C***********CDP       IFEQ *ZERO                      B1             S01194
     C***********A6NBDP****IFEQ**ZERO**********************B1*******S01194S01319
     C*********************Z-ADD@HAMNP****I1AMNI************1*************S01319
     C*********************Z-ADDIHFVAL****I1FVLI************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C*********  CDP       IFEQ 1                          B1             S01194
     C***********A6NBDP****IFEQ*1**************************B1*******S01194S01319
     C*********************Z-ADDIHFVAL****@1FVL1************1*************S01319
     C*********************Z-ADD@HAMNP****@1AMN1************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C********** CDP       IFEQ 2                          B1             S01194
     C***********A6NBDP****IFEQ*2**************************B1*******S01194S01319
     C*********************Z-ADDIHFVAL****@1FVL2************1*************S01319
     C*********************Z-ADD@HAMNP****@1AMN2************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C********** CDP       IFEQ 3                          B1             S01194
     C***********A6NBDP****IFEQ*3**************************B1*******S01194S01319
     C*********************Z-ADDIHFVAL****@1FVL3************1*************S01319
     C*********************Z-ADD@HAMNP****@1AMN3************1*************S01319
     C*********************END*****************************E1*************S01319
     C*************************************************************E14377*S01319
     C***********IHBRKG****IFEQ**ALL'9'********************B0.5*****E14377S01319
     C*********************MOVE**ALL'9'***I1BRKI************0.5*****E14377S01319
     C*********************MOVE**ALL'9'***I1BRKD************0.5*****E14377S01319
     C*********************ELSE****************************X0.5****E14377*S01319
     C********************************************************************S01319
     C***********IHBCDP****IFEQ**ZERO**********************B1*************S01319
     C*********************Z-ADDIHBRKG****I1BRKI************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***********IHBCDP****IFEQ*1**************************B1*************S01319
     C*********************Z-ADDIHBRKG****@1BRK1************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***********IHBCDP****IFEQ*2**************************B1*************S01319
     C*********************Z-ADDIHBRKG****@1BRK2************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***********IHBCDP****IFEQ*3**************************B1*************S01319
     C*********************Z-ADDIHBRKG****@1BRK3************1*************S01319
     C*********************END*****************************E1*************S01319
     C**************************************************************E14377S01319
     C*********************END*****************************E0.5*****E14377S01319
     C********************************************************************S01319
     C****SET*UP*PROCESSING*OUTSTANDING***********************************S01319
     C***********I1DPCO****IFNE*'8'************************B1*************S01319
     C***********IHLACT****IFNE*'D'************************B*2************S01319
     C********************************************************************S01319
     C***********IHDSTS****IFEQ*'I'************************B**3***********S01319
     C*********************MOVEL'1'       I1DPCO           ***3           E16147
     C*********************MOVEL'2'*******I1DPCO**************3*****E16147S01319
     C*********************END*****************************E**3***********S01319
     C********************************************************************S01319
     C***********IHDSTS****IFEQ*'C'************************B**3***********S01319
     C***********IHCDRF****IFEQ**BLANK*********************B***4**********S01319
     C*********************MOVEL'4'       I1DPCO           ****4          E16147
     C*********************MOVEL'5'*******I1DPCO***************4****E16147S01319
     C*********************END*****************************E***4**********S01319
     C********************************************************************S01319
     C***********IHCDRF****IFEQ*'Y'************************B***4**********S01319
     C*********************MOVEL'7'       I1DPCO           ****4          E16147
     C*********************MOVEL'8'*******I1DPCO***************4****E16147S01319
     C*********************END*****************************E***4**********S01319
     C*********************END*****************************E**3***********S01319
     C********************************************************************S01319
     C*********************END*****************************E*2************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C****IF*RECORD*EXISTS*UPDATE*FILE*ELSE*WRITE*NEW*RECORD**************S01319
     C************IN61*****IFEQ*'0'************************B1*************S01319
     C********************************************************************S01319
     C****DEAL*PREVIOUS*STATUS*INDICATOR**********************************S01319
     C***********I1PSTI****IFNE*'I'************************B*2************S01319
     C*********************MOVELIHBSTS****I1PSTI*************2************S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C*********************ELSE****************************X1*************S01319
     C********************************************************************S01319
     C*********************MOVEL'I'*******I1PSTI************1*************S01319
     C********************************************************************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***********#ZG9******ENDSR*******************************#ZG9*******S01319
     C********************************************************************S01319
     C*/EJECT*************************************************************S01319
     C*****************************************************************
     C*                                                               *
     C* #ZH      - NAS's Supplementary Fields                         *
     C*                                                               *
     C* CALLS    #Z       - Data base errors                          *
     C***********ZA0710***-*Calculate*8,0*date*format******************   056095
     C***********ZA0680***-*Calculate*midas*day*no.********************   056095
     C*          ZDATE9   - Calculate 8,0 date format                 *   056095
     C*          ZDAT10   - Calculate midas day no.                   *   056095
     C*          #ZAA     - Midas Our Receive Method                  *
     C*          #ZAB     - Midas Our Receive Instructions            *
     C*          #ZAE     - Midas Customer Pay Instructions           *
     C*                                                               *
     C* CALLED BY  #BCA   - NAS Inserts                               *
     C*            #BCB   - NAS Amends                                *
     C*            #BCC   - NAS Deletes                               *
     C*                                                               *
     C* FLDS USED**@KEY   - File Key                                  *   S01194
     C************ @KEY4  - 4 bytes of File key                       *   S01194
     C*            @@DAYN - Date 5,0 format                           *
     C*            @@VDT  - Date 8,0 format                           *
     C*            @ILLIY - Last interest date                        *
     C*            @ILVDY - Value date                                *
     C*************@@DTIN*-*Date*8,0*format****************************   056095
     C*************@@MDNO*-*Date*5,0*format****************************   056095
     C*            ZZDTIN - Date 8,0 format                           *   056095
     C*            ZZMDNO - Date 5,0 format                           *   056095
     C*            @ILDDY - Deal done date                            *
     C*            @ILNIY - Next interest date                        *
     C*            @ILMDY - Maturity date                             *
     C*            @DORM  - Deal our receive method                   *
     C*            @ORCM  - Midas our recive method                   *
     C*            @DORI  - Deal our receive instructions             *
     C*            @CCY   - Currency                                  *
     C*            @CNUM  - Customer number                           *
     C*            @MORI  - Midas our receive insructions             *
     C*            @DCPI  - Deal customer pay instructions            *
     C*            @MCPI  - Midas customer pay instructions           *
     C*                                                               *
     C*****************************************************************
     C           #ZH       BEGSR
     C*
     C****SET*UP*SUPPLEMENTARY FIELDS FOR STANDARD DEAL TYPES L,B,S       S01194
     C*********            MOVEL'20'      @KEY                            S01194
     C*********            MOVE '1'       @KEY4                           S01194
     C*
     C**  FIND MIDAS DEAL TYPE
     C           ILTYPE    IFEQ *BLANKS                    B1
     C                     MOVE *BLANKS   ILMTYP           *1
     C                     ELSE                            X1
     C                     MOVELILTYPE    @LTYPE  3        *1
     C                     MOVE ILRBSI    @LTYPE           *1
     C           @LTYPE    LOKUPTAB3      TAB4           61*1
     C                     MOVELTAB4      ILMTYP           *1
     C                     END                             E1
     C*
     C**  FIND MIDAS BRANCH CODE & BRANCH NAME
     C           ILDBRC    IFNE *BLANKS                    B1
     C*
     C***ACCESS*FDBSNCLL USING DEAL BRANCH CODE                           S01194
     C********** ILDBRC    CHAINFDBSNCLL             61    **2            S01194
      *                                                                   S01194
      ** ACCESS BRANCH CODES FILES                                        S01194
     C**********           CALL 'AOBRCHR0'                                             S01194 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD            **2            S01194
     C                     PARM '*KEY   ' @OPTN            **2            S01194
     C                     PARM ILDBRC    @WRK3            **2            S01194
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01194 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*
     C**  CHECK FOR DATA BASE ERROR
     C********** *IN61     IFEQ '1'                        B**3           S01194
     C           @RTCD     IFNE *BLANK                     B**3           S01194
     C                     MOVELILDBRC    DBKEY            ***3
     C**********           MOVEL'FDBSNCLL'DBFILE                          S01194
     C                     MOVEL'SDBRCHPD'DBFILE           ************   S01194
     C                     MOVEL'027'     DBASE            * DB ERR 27*
     C                     MOVEL@OPTN     DBOPTN           **2            S01194
     C                     EXSR #Z                         ************
     C                     END                             E**3
     C*
     C*****                MOVE KEY       ILBRCD           **2            S01117
     C***********          MOVE KEY       ILBRCA           **2     S01117 S01194
     C***********          MOVE BRNM      ILBRNM           **2            S01194
     C                     MOVE A8BRCD    ILBRCA           **2            S01194
     C                     MOVE A8BRNM    ILBRNM           **2            S01194
     C                     END                             E1
     C*
     C**  FIND LAST ACTION DATE
     C************         Z-ADDRUND      @@DAYN                          S01194
     C                     Z-ADDBJRDNB    @@DAYN                          S01194
     C***********          EXSR ZA0710                                    056095
     C                     EXSR ZDATE9                                    056095
     C                     Z-ADD@@VDT     ILLDAT
     C*
     C**  FIND BROKER NAME & TOWN - ACCESS BROKERS WITH BROKER CODE
     C           ILBKCD    IFNE *BLANKS                    B1
     C           ILBKCD    ANDNE'TELX'                     *1
     C           ILBKCD    ANDNE'PHON'                     *1
     C           ILBKCD    ANDNE'MAIL'                     *1
     C*
     C*********            MOVE *BLANKS   @KEY             *1             S01194
     C*********            MOVEL'80'      @KEY             *1             S01194
     C*********            MOVE ILBKCD    @KEY             *1             S01194
     C*********                                                           S01194
     C*********  @KEY      CHAINFDBRKRLL             61    *1             S01194
     C                     CALL 'AOBROKR0'                 *1             S01194
     C*********************PARM '*DBERR ' @RTCD            *1       S01194E234
     C                     PARM '*MSG   ' @RTCD            *1             E234
     C                     PARM '*KEY   ' @OPTN            *1             S01194
     C                     PARM ILBKCD    @WRK4            *1             S01194
     C           SDBROK    PARM SDBROK    DSFDY                           S01194
     C*                                                                   S01194
     C**  CHECK FOR DATA BASE ERROR
     C*********  *IN61     IFEQ '1'                        B**3           S01194
     C*********            MOVEL@KEY      DBKEY            ***3           S01194
     C*********            MOVEL'FDBRKRLL'DBFILE           ***3           S01194
     C           @RTCD     IFNE *BLANK                     B**3           S01194
     C                     MOVELILBKCD    DBKEY            ***3           S01194
     C                     MOVEL'SDBROKPD'DBFILE           ************   S01194
     C                     MOVEL'028'     DBASE            * DB ERR 28*
     C                     MOVEL@OPTN     DBOPTN           **2            S01194
     C                     EXSR #Z                         ************
     C                     END                             E**3
     C*
     C*********            MOVELBKNM      ILBKNM           *1             S01194
     C*********            MOVELBKTN      ILBKTN           *1             S01194
     C                     MOVELA9BKNM    ILBKNM           *1             S01194
     C                     MOVELA9BRTN    ILBKTN           *1             S01194
     C*
     C                     END                             E1
     C*
     C**  MOVE VALUE/START DATE  INTO START LAST INTEREST DATE IF
     C**  START LAST INTEREST DATE = ZERO
     C           @ILLIY    IFEQ *ZERO                      B1
     C           ILLACT    ANDEQ'I'                        *1
     C                     Z-ADD@ILVDY    @ILLIY           *1
     C                     END                             E1
     C*
     C**  CONVERT DATES FROM 8,0 TO DAY NUMBER FORMAT
     C**  DEAL VALUE/START DATE
     C           @ILLIY    IFNE *ZERO                      B1
     C***********          Z-ADD@ILLIY    @@DTIN           *1             056095
     C***********          EXSR ZA0680                     *1             056095
     C***********          Z-ADD@@MDNO    ILSLID           *1             056095
     C                     Z-ADD@ILLIY    ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    ILSLID           *1             056095
     C                     END                             E1
     C*
     C**  DEAL VALUE/START DATE
     C           @ILVDY    IFNE *ZERO                      B1
     C***********          Z-ADD@ILVDY    @@DTIN           *1             056095
     C***********          EXSR ZA0680                     *1             056095
     C***********          Z-ADD@@MDNO    ILDVSD           *1             056095
     C                     Z-ADD@ILVDY    ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    ILDVSD           *1             056095
     C                     END                             E1
     C*
     C**  DEAL DONE DATE
     C           @ILDDY    IFNE *ZERO                      B1
     C***********          Z-ADD@ILDDY    @@DTIN           *1             056095
     C***********          EXSR ZA0680                     *1             056095
     C***********          Z-ADD@@MDNO    ILDDND           *1             056095
     C                     Z-ADD@ILDDY    ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    ILDDND           *1             056095
     C                     END                             E1
     C*
     C**  DEAL LAST ACTION DATE
     C           ILLDAT    IFNE *ZERO                      B1
     C***********          Z-ADDILLDAT    @@DTIN           *1             056095
     C***********          EXSR ZA0680                     *1             056095
     C***********          Z-ADD@@MDNO    ILDLAD           *1             056095
     C                     Z-ADDILLDAT    ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    ILDLAD           *1             056095
     C                     END                             E1
     C*
     C**  NEXT INTEREST PAYMENT DATE
     C           @ILNIY    IFNE *ZERO                      B1
     C***********          Z-ADD@ILNIY    @@DTIN           *1             056095
     C***********          EXSR ZA0680                     *1             056095
     C***********          Z-ADD@@MDNO    ILNIPD           *1             056095
     C                     Z-ADD@ILNIY    ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    ILNIPD           *1             056095
     C                     END                             E1
     C*
     C**  DEAL MATURITY DATE
     C           @ILMDY    IFNE *ZERO                      B1
     C***********          Z-ADD@ILMDY    @@DTIN           *1             056095
     C***********          EXSR ZA0680                     *1             056095
     C***********          Z-ADD@@MDNO    ILMATD           *1             056095
     C                     Z-ADD@ILMDY    ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    ILMATD           *1             056095
     C                     END                             E1
     C*
     C**  SETUP FIELDS FOR SR.MM1025
     C*
     C           ILDCRT    IFNE *ZERO                      B1
     C***********          Z-ADDILDVSD    @@BEG            *1             056095
     C                     Z-ADDILDVSD    ZZBEG            *1             056095
     C*
     C***********          Z-ADDILMATD    @@END            *1             056095
     C                     Z-ADDILMATD    ZZEND            *1             056095
     C*
     C                     Z-ADDILDCRT    @@DIRT           *1
     C***********          MOVE ILICMT    @@CALC           *1             056095
     C                     MOVE ILICMT    ZZCALC           *1             056095
     C*
     C                     EXSR MM1025                     *1
     C*
     C                     Z-ADD@@YLD     ILINTR           *1
     C                     END                             E1
     C*
     C*
     C**  MATURITY DATE SHOULD BE ZERO FOR NA'S SOLD
     C*
     C                     Z-ADD0         ILMATD
     C*
     C****SET BASE CURRENCY RATE TO SPOT RATE FROM TABTG10
      ***********DONT OVERWRITE BASE CCY************
     C*********************Z-ADDSPOT      ILBRAT
      *                                                                   CEU003
      ** Setup deals-effective-currency-workfield                         CEU003
      *                                                                   CEU003
     C                     MOVE *BLANKS   WDECY                           CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           HMSTCY    ANDNE*BLANKS                                   CEU003
      *                                                                   CEU003
     C                     MOVELHMSTCY    WDECY                           CEU003
      *                                                                   CEU003
     C                     ELSE                                           CEU003
      *                                                                   CEU003
     C                     MOVELHMCCY     WDECY                           CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
     C*
     C** MIDAS OUR RECEIVE METHOD
     C**  Extended settlement fields for PC are set up                    S01227
     C**  at the end of the subroutine.                                   S01227
     C           ILORCM    IFEQ *ZEROS                     B1
     C           ILDORM    IFNE HMDORM                     B*2
     C                     MOVELILDORM    @DORM            **2
     C                     EXSR #ZAA                       **2
     C                     Z-ADD@ORCM     ILORCM           **2
     C                     ELSE                            X*2
     C           HMDORM    IFEQ *BLANK                     B**3
     C                     Z-ADD*ZERO     ILORCM           ***3
     C                     ELSE                            X**3
     C                     Z-ADDHMORCM    ILORCM           ***3
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E1
     C*
     C** MIDAS OUR RECEIVE INSTRUCTIONS
     C**  Extended settlement fields for PC are set up                    S01227
     C**  at the end of the subroutine.                                   S01227
     C*
     C           ILLACT    IFEQ 'I'                        B1             E12909
     C           ILMORI    IFEQ *BLANKS                    B2             E12909
     C                     MOVELILDORM    @DORM            **2            E12909
     C                     MOVELILDORI    @DORI            **2            E12909
     C***********          MOVELILCCY     @CCY             **2     E12909 CEU003
     C                     MOVELWSECY     @CCY                            CEU003
     C                     MOVELILCNUM    @CNUM            **2            E12909
     C                     MOVELILMORI    NOSN3            **2            BHF860
     C                     EXSR #ZAB                       **2            E12909
     C                     MOVEL@MORI     ILMORI           **2            E12909
     C                     END                             E*2            E12909
     C                     ELSE                            X1             E12909
     C           ILMORI    IFEQ *BLANKS                    B*2
     C*******    ILDORI    IFNE HMDORI                     **2            E12909
     C*******    ILDORI    ORNE HMDORI                     **2     E12909 E22150
     C           ILDORI    IFNE HMDORI                     B**3           E22150
     C           ILDORM    ORNE HMDORM                     ***3
     C***********HMCCY     ORNE ILBUCY                     ***3           CEU003
     C           WDECY     ORNE ILBUCY                                    CEU003
     C                     MOVELILDORM    @DORM            ***3
     C                     MOVELILDORI    @DORI            ***3
     C***********          MOVELILCCY     @CCY             ***3           CEU003
     C                     MOVELWSECY     @CCY                            CEU003
     C                     MOVELILCNUM    @CNUM            ***3
     C                     MOVELILMORI    NOSN3            **2            BHF860
     C                     EXSR #ZAB                       ***3
     C                     MOVEL@MORI     ILMORI           ***3
     C                     ELSE                            X**3
     C                     MOVE HMMORI    ILMORI           ***3
     C                     END                             E**3           E22150
     C                     END                             E*2
     C                     END                             E1
     C*
     C**  MIDAS CUSTOMER PAYMENT INSTRUCTIONS
     C**  Extended settlement fields for PC are set up                    S01227
     C**  at the end of the subroutine.                                   S01227
     C           ILMCPI    IFEQ *BLANKS                    B1
     C           ILDCPI    ORNE HMDCPI                     B*2
     C                     MOVELILDCPI    @DCPI            **2
     C                     EXSR #ZAE                       **2
     C                     MOVEL@MCPI     ILMCPI           **2
     C                     ELSE                            X*2
     C*********************MOVE HLMCPI    ILMCPI           **2     E17938 S01177
     C                     MOVE HMMCPI    ILMCPI           **2     E17938 S01177
     C                     END                             E1
     C*
     C***Set*up*extended*settlement*fields*for*the*PC***************S01227S01319
     C***********@FB*******IFEQ*'F'************************B1******S01227*S01319
     C*********************MOVELILORCM****ILRSTM************1*******S01227S01319
     C*********************MOVELILMORI****ILRONS************1*******S01227S01319
     C*********************MOVELILMCPI****ILRIBN************1*******S01227S01319
     C*********************MOVE*'N'*******ILCVMR************1*******E22405S01319
     C*********************END*****************************E1*******S01227S01319
     C**************************************************************S01227S01319
     C           #ZH9      ENDSR                           ****#ZH9****
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZI      - MAS's Before Fields                                *
     C*                                                               *
     C* CALLS    #Z       - Data base errors                          *
     C*                                                               *
     C* CALLED BY  #BCB   - NAS Amends                                *
     C*                                                               *
     C* FLDS USED  @HMVDY - Value date                                *
     C*            @HMNIY - Next interest date                        *
     C*            @HMLIY - Last interest date                        *
     C*            @HMMDY - Maturity Date                             *
     C*                                                               *
     C*****************************************************************
     C           #ZI       BEGSR
     C*
     C**  CHAIN TO DEALS FILE
     C           ILDN38    CHAINMMDEALLL             61
     C*
     C**  CHECK FOR DATA BASE ERROR
     C           *IN61     IFEQ '1'                        B1
     C                     MOVELILDN38    DBKEY            *1
     C                     MOVEL'MMDEALLL'DBFILE           ************
     C                     MOVEL'029'     DBASE            * DB ERR 29*
     C                     EXSR #Z                         ************
     C                     END                             E1
     C*
     C                     MOVELHMORCM    ILBORM
     C                     MOVELHMDCPI    ILBCPI
     C                     MOVELHMMORI    ILBORI
     C                     Z-ADDHMAMNP    ILBAMT
     C                     MOVELHMCCY     ILBUCY
     C                     MOVELHMCNUM    ILBCNM
     C                     Z-ADD@HMVDY    ILBVDT
     C                     MOVELHMDSTS    ILBSTS
     C                     MOVELHMCSNM    ILBCSN
     C                     Z-ADDHMINTR    ILBIRT
     C                     Z-ADD@HMNIY    ILBNID
     C                     MOVELHMIPFQ    ILBIPF
     C                     MOVELHMICMT    ILBICM
     C                     Z-ADDHMIPDM    ILBIDM
     C                     Z-ADDHMFVAL    ILBFVL
     C                     Z-ADDHMFRAT    ILBFRT
     C                     MOVELHMISUR    ILBISR
     C                     Z-ADD@HMLIY    ILBLID
     C                     Z-ADD@HMMDY    ILBMTD
     C*
     C           #ZI9      ENDSR                           ****#ZI9****
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZJ      - NAS's Related Fields                               *
     C*                                                               *
     C* CALLS    #Z       - Data base errors                          *
     C*                                                               *
     C* CALLED BY  #BCA   - NAS Inserts                               *
     C*            #BCB   - NAS Amends                                *
     C*                                                               *
     C* FLDS USED  @ILDAD - Associated deal number numeric            *
     C*            @HLVDY - Vlaue date                                *
     C*            @HLNIY - Next interest date                        *
     C*            @HLLIY - Last interest date                        *
     C*            @HLMDY - Maturity Date                             *
     C*                                                               *
     C*****************************************************************
     C           #ZJ       BEGSR
     C*
     C**  CHAIN TO DEALS FILE
     C           @ILDAD    CHAINMMDEALLL             61
     C********             MOVELHLDORM    ILRORM                          S01154
     C                     MOVELHLORCM    ILRORM                          S01154
     C*
     C**  CHECK FOR DATA BASE ERROR
     C           *IN61     IFEQ '1'                        B1
     C                     MOVEL@ILDAD    DBKEY            *1
     C                     MOVEL'MMDEALLL'DBFILE           ************
     C                     MOVEL'030'     DBASE            * DB ERR 30*
     C                     EXSR #Z                         ************
     C                     END                             E1
     C*
     C***********          MOVELHLDORI    ILRORI                          065930
     C                     MOVEL@STDB     Z#WSTS                          082738
     C                     MOVELHLMORI    ILRORI                          065930
     C                     MOVELHLDCPI    ILRCPI
     C********             MOVELHLDOPM    ILROPM                          S01154
     C                     MOVELHLMOPM    ILROPM                          S01154
     C***********          MOVELHLDOPI    ILROPI                          065930
     C                     MOVELHLMOPI    ILROPI                          065930
     C                     MOVELHLDCRI    ILRCRI
     C                     Z-ADDHLAMNP    ILRBAT
     C                     MOVELHLCCY     ILRBCY
     C**********           Z-ADDHLCNUM    ILRCNM                                              CSD027
     C                     MOVE HLCNUM    ILRCNM                                              CSD027
     C                     Z-ADD@HLVDY    ILRVDT
     C                     MOVELHLDSTS    ILRSTS
     C                     MOVELHLCSNM    ILRCSN
     C                     Z-ADDHLINTR    ILRIRT
     C                     Z-ADD@HLNIY    ILRNID
     C                     MOVELHLIPFQ    ILRIPF
     C                     MOVELHLICMT    ILRICM
     C                     Z-ADDHLIPDM    ILRIDM
     C                     Z-ADDHLFVAL    ILRFVL
     C                     Z-ADDHLFRAT    ILRFRT
     C                     MOVELHLISUR    ILRISR
     C                     Z-ADD@HLLIY    ILRLID
     C                     Z-ADD@HLMDY    ILRMTD
     C                     Z-ADDHLNANV    ILRNAV
     C*                                                                   S01279
     C** MM0075 uses the related deal yield field, for purchased NA's     S01279
     C** apart from Primary CD's Purchased (ie. this field ignored then). S01279
     C** Note that this will be set to face rate for C1 N/A's bought,     S01279
     C** to yield for other interest bearing N/A's bought and to          S01279
     C** yield for discounted N/A's bought.                               S01279
     C           HLMTYP    IFEQ 'C1'                       B1             S01279
     C           HLMTYP    OREQ 'C2'                       B1             S01279
     C           HLMTYP    OREQ 'BP'                       B1             S01279
     C           HLMTYP    OREQ 'BD'                       B1             S01279
     C                     Z-ADDHLINTR    ILRYLD           *1             S01279
     C                     ELSE                            X1             S01279
     C                     Z-ADDHLDCRT    ILRYLD           *1             S01279
     C                     END                             E1             S01279
     C*
     C           #ZJ9      ENDSR                           ****#ZJ9****
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C********************************************************************S01319
     C**#ZK******-*NAS's*Download*Blotter*********************************S01319
     C********************************************************************S01319
     C**CALLS*************-***********************************************S01319
     C********************************************************************S01319
     C**CALLED*BY**#BCA***-*NAS*Inserts***********************************S01319
     C*************#BCB***-*NAS*Amends************************************S01319
     C*************#BCC***-*NAS*Deletes***********************************S01319
     C*************#BDC***-*Deam*Deletes**********************************S01319
     C********************************************************************S01319
     C**FLDS*USED**@HLVDY*-*Vlaue*date************************************S01319
     C*************@I1VDY*-*Value*Date************************************S01319
     C*************@HLDTY*-*Deal*transaction*date*************************S01319
     C*************@I1DTY*-*Deal*transaction*date*************************S01319
     C*************@ILDDY*-*Deal*done*date********************************S01319
     C*************@I1DDY*-*Deal*done*date********************************S01319
     C*************@ILMDY*-*Maturity*date*********************************S01319
     C*************@I1MDY*-*Maturity*date*********************************S01319
     C*************@ILNIY*-*Next*interest*date****************************S01319
     C*************@I1NIY*-*Next*interest*date****************************S01319
     C*************@ILLIY*-*Last*interest*date****************************S01319
     C*************@I1SLY*-*Start/last*interest*date**********************S01319
     C********************************************************************S01319
     C********************************************************************S01319
     C***********#ZK*******BEGSR******************************************S01319
     C********************************************************************S01319
     C*********************MOVEL'I1'******I1RCID**************************S01319
     C*********************MOVELILPCDN****I1PCDN**************************S01319
     C*********************MOVELILPCDN****I1PCD1**************************S01319
     C*********************Z-ADDILDN38****I1DN38**************************S01319
     C*********************MOVELILBKCD****I1BKCD**************************S01319
     C*********************MOVELILBKCD****I1BKC1**************************S01319
     C*********************MOVELILCCY*****I1CCY1**************************S01319
     C*********************MOVELILCCY*****I1CCY2**************************S01319
     C*********************MOVELILCCY*****I1CCY3**************************S01319
     C********************************************************************S01319
     C*********************Z-ADD@HLVDY****@I1VDY**************************S01319
     C********************************************************************S01319
     C*********************Z-ADD@HLDTY****@I1DTY**************************S01319
     C********************************************************************S01319
     C*********************MOVELILDADN****I1DA38**************************S01319
     C********************************************************************S01319
     C***********ILLACT****IFEQ*'D'************************B1*************S01319
     C*********************MOVEL'D'*******I1DDLT************1*************S01319
     C*********************ELSE****************************X1*************S01319
     C*********************MOVEL*BLANK****I1DDLT************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C*********************MOVELILDSTS****I1DSTS**************************S01319
     C*********************MOVELILTYPE****I1TYPE**************************S01319
     C*********************MOVELILRBSI****I1RBSI**************************S01319
     C*********************MOVELILSTYP****I1STYP**************************S01319
     C*********************MOVELILCSNM****I1CSNM**************************S01319
     C********************************************************************S01319
     C*********************Z-ADDILINTR****I1INTS**************************S01319
     C********************************************************************S01319
     C***********ILINTR****IFLT**ZERO**********************B1*************S01319
     C*********************Z-SUBI1INTS****I1INTS************1*************S01319
     C*********************MOVEL'-'*******I1INSN************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***********ILINTR****IFGT**ZERO**********************B1*************S01319
     C*********************MOVEL'+'*******I1INSN************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***********ILINTR****IFEQ**ZERO**********************B1*************S01319
     C*********************MOVEL*BLANK****I1INSN************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C*********************MOVE**BLANKS***I1DBSR**************************S01319
     C*********************MOVELILDBRC****I1DBRC**************************S01319
     C*******              Z-ADD*ZERO     I1NTCE                          ME2054
     C*******              MOVE *BLANK    I1NTSN                          ME2054
     C*********************Z-ADD999*******I1NTCE********************ME2054S01319
     C*********************MOVE*'-'*******I1NTSN********************ME2054S01319
     C********************************************************************S01319
     C*********************Z-ADD0*********I1MDYY********************ME2055S01319
     C*********************Z-ADD0*********I1MDMM********************ME2055S01319
     C*********************Z-ADD0*********I1MDDD********************ME2055S01319
     C**************************************************************ME2055S01319
     C*********************Z-ADD@ILDDY****@I1DDY**************************S01319
     C********************************************************************S01319
     C*********************Z-ADD@ILMDY****@I1MDY**************************S01319
     C********************************************************************S01319
     C*********************Z-ADDILFCLY****I1FCLY**************************S01319
     C*********************Z-ADDILBRAT****I1BRTS**************************S01319
     C********************************************************************S01319
     C*********************MOVELILDORM****I1DORM**************************S01319
     C*********************MOVELILDORI****I1DORI**************************S01319
     C*********************MOVELILDCPI****I1DCPI**************************S01319
     C********************************************************************S01319
     C*********************MOVE**BLANKS***I1DOPM**************************S01319
     C*********************MOVE**BLANKS***I1DOPI**************************S01319
     C*********************MOVE**BLANKS***I1DCRI**************************S01319
     C********************************************************************S01319
     C*********************Z-ADD@ILNIY****@I1NIY**************************S01319
     C********************************************************************S01319
     C*********************MOVELILIPFQ****I1IPFQ**************************S01319
     C*********************MOVELILIPDM****I1IPDM**************************S01319
     C*********************MOVELILICMT****I1ICMT**************************S01319
     C********************************************************************S01319
     C*********************Z-ADD@ILLIY****@I1SLY**************************S01319
     C********************************************************************S01319
     C*********************Z-ADDILFRAT****I1FRTS**************************S01319
     C*********************Z-ADDILDCRT****I1DRTS**************************S01319
     C*********************MOVELILISUR****I1ISUR**************************S01319
     C*********************MOVELILCDRF****I1CDRF**************************S01319
     C*********************MOVELILFEDF****I1FEDF**************************S01319
     C********************************************************************S01319
     C*********************MOVE**BLANK****I1CPTI**************************S01319
     C*********************Z-ADDILPCTN****I1PCTN**************************S01319
     C*********************MOVELILCDRP****I1CDRP**************************S01319
     C*********************MOVELILLACT****I1LACT**************************S01319
     C*********************Z-ADDILTIME****I1TIME**************************S01319
     C*********************Z-ADDILTIME****I1TIM1**************************S01319
     C*********************Z-ADDILTIME****I1TIM2**************************S01319
     C********************************************************************S01319
     C*********************MOVELILBKCY****I1BKCY**************************S01319
     C*******              Z-ADD*ZERO     I1BRKI                          E14377
     C*******              Z-ADD*ZERO     I1BRKD                          E14377
     C********************************************************************S01319
     C*********************Z-ADD*ZERO*****I1IMTI**************************S01319
     C*********************Z-ADD*ZERO*****I1IMTD**************************S01319
     C*********************MOVE**BLANK****I1IMTS**************************S01319
     C*********************MOVE**BLANK****I1PSTI**************************S01319
     C*********************MOVE**BLANKS***I1ROBY**************************S01319
     C*********************MOVE**BLANKS***I1SLDB**************************S01319
     C*********************MOVE*'N'*******I1NAID**************************S01319
     C*********************MOVE**BLANKS***I1SPEC**************************S01319
     C*********************Z-ADD*ZERO*****@I1IAY**************************S01319
     C********************************************************************S01319
     C***********ILAMNP****IFLT**ZERO*************************************S01319
     C*********************Z-SUBILAMNP****@LAMNP**************************S01319
     C*********************MOVEL'-'*******I1AMSN**************************S01319
     C*********************END********************************************S01319
     C********************************************************************S01319
     C***********ILAMNP****IFEQ**ZERO*************************************S01319
     C*********************Z-ADD*ZERO*****@LAMNP**************************S01319
     C*********************MOVE**BLANK****I1AMSN**************************S01319
     C*********************END********************************************S01319
     C********************************************************************S01319
     C***********ILAMNP****IFGT**ZERO*************************************S01319
     C*********************Z-ADDILAMNP****@LAMNP**************************S01319
     C*********************MOVEL'+'*******I1AMSN**************************S01319
     C*********************END********************************************S01319
     C********************************************************************S01319
     C***********CDP       IFEQ *ZERO                      B1             S01194
     C***********A6NBDP****IFEQ**ZERO**********************B1*******S01194S01319
     C*********************Z-ADD@LAMNP****I1AMNI************1*************S01319
     C*********************Z-ADDILFVAL****I1FVLI************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C********** CDP       IFEQ 1                          B1             S01194
     C***********A6NBDP****IFEQ*1**************************B1*******S01194S01319
     C*********************Z-ADDILFVAL****@1FVL1************1*************S01319
     C*********************Z-ADD@LAMNP****@1AMN1************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C********** CDP       IFEQ 2                          B1             S01194
     C***********A6NBDP****IFEQ*2**************************B1*******S01194S01319
     C*********************Z-ADDILFVAL****@1FVL2************1*************S01319
     C*********************Z-ADD@LAMNP****@1AMN2************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C*********  CDP       IFEQ 3                          B1             S01194
     C***********A6NBDP****IFEQ*3**************************B1*******S01194S01319
     C*********************Z-ADDILFVAL****@1FVL3************1*************S01319
     C*********************Z-ADD@LAMNP****@1AMN3************1*************S01319
     C*********************END*****************************E1*************S01319
     C**************************************************************E14377S01319
     C***********IHBRKG****IFEQ**ALL'9'********************B0.5*****E14377S01319
     C*********************MOVE**ALL'9'***I1BRKI************0.5****E14377*S01319
     C*********************MOVE**ALL'9'***I1BRKD************0.5*****E14377S01319
     C*********************ELSE****************************X0.5*****E14377S01319
     C********************************************************************S01319
     C***********ILBCDP****IFEQ**ZERO**********************B1*************S01319
     C*********************Z-ADDILBRKG****I1BRKI************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***********ILBCDP****IFEQ*1**************************B1*************S01319
     C*********************Z-ADDILBRKG****@1BRK1************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***********ILBCDP****IFEQ*2**************************B1*************S01319
     C*********************Z-ADDILBRKG****@1BRK2************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***********ILBCDP****IFEQ*3**************************B1*************S01319
     C*********************Z-ADDILBRKG****@1BRK3************1*************S01319
     C*********************END*****************************E1*************S01319
     C**************************************************************E14377S01319
     C*********************END*****************************E0.5*****E14377S01319
     C********************************************************************S01319
     C*********************MOVE*ILDUSC****I1DUSC**************************S01319
     C********************************************************************S01319
     C****SET*UP*PROCESSING*OUTSTANDING***********************************S01319
     C***********I1DPCO****IFNE*'8'************************B1*************S01319
     C***********ILLACT****ANDNE'D'*************************1*************S01319
     C********************************************************************S01319
     C***********ILDSTS****IFEQ*'I'************************B*2************S01319
     C*********************MOVEL'1'       I1DPCO           **2            E16147
     C*********************MOVEL'2'*******I1DPCO*************2******E16147S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C***********ILDSTS****IFEQ*'C'************************B*2************S01319
     C***********ILCDRF****ANDEQ*BLANK***********************2************S01319
     C*********************MOVEL'4'       I1DPCO           **2            E16147
     C*********************MOVEL'5'*******I1DPCO*************2******E16147S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C***********ILCDRF****IFEQ*'Y'************************B*2************S01319
     C*********************MOVEL'7'       I1DPCO           **2            E16147
     C*********************MOVEL'8'*******I1DPCO*************2******E16147S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***********#ZK9******ENDSR*******************************#ZK9*******S01319
     C********************************************************************S01319
     C*/EJECT*************************************************************S01319
     C*****************************************************************
     C*                                                               *
     C* #ZL      - Deams Supplementary Fields                         *
     C*                                                               *
     C**CALLS****ZA0680***-*Calculate*midas*day*no*********************   056095
     C* CALLS    ZDAT10   - Calculate midas day no                    *   056095
     C*          #Z       - Data base errors                          *
     C*          #ZLA     - Deams - Find Original Deal                *
     C*          #ZLB     - Deams - Original Type Loans Deposits      *
     C*          #ZLD     - Deams Settle Interest - Loans Deposits    *
     C*          #ZLC     - Deams - Original Type NABs                *
     C*          #ZLE     - Deams Settle Interest - NABs              *
     C*                                                               *
     C* CALLED BY  #BDA   - Deam Inserts                              *
     C*            #BDB   - Deam Amends                               *
     C*            #BDC   - Deam Deletes                              *
     C*                                                               *
     C* FLDS USED  @IGVDY - Value date                                *
     C*************@@DTIN*-*Date*8,0*format****************************   056095
     C*************@@MDNO*-*Date*5,0*format****************************   056095
     C*            ZZDTIN - Date 8,0 format                           *   056095
     C*            ZZMDNO - Date 5,0 format                           *   056095
     C*            @IGDMY - Deal done date                            *
     C*            @FORM  - Format                                    *
     C*            @MTYP  - Midas deal type                           *
     C*                                                               *
     C*****************************************************************
     C           #ZL       BEGSR
     C*
     C**  CONVERT DATES TO 5,0 FORMAT
     C           @IGVDY    IFNE *ZERO                      B1
     C***********          Z-ADD@IGVDY    @@DTIN           *1             056095
     C***********          EXSR ZA0680                     *1             056095
     C***********          Z-ADD@@MDNO    IGDVSD           *1             056095
     C                     Z-ADD@IGVDY    ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    IGDVSD           *1             056095
     C                     END                             E1
     C*
     C           @IGDMY    IFNE *ZERO                      B1
     C***********          Z-ADD@IGDMY    @@DTIN           *1             056095
     C***********          EXSR ZA0680                     *1             056095
     C***********          Z-ADD@@MDNO    IGDDLD           *1             056095
     C                     Z-ADD@IGDMY    ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    IGDDLD           *1             056095
     C                     END                             E1
     C*
     C           IGLDAT    IFNE *ZERO                      B1
     C***********          Z-ADDIGLDAT    @@DTIN           *1             056095
     C***********          EXSR ZA0680                     *1             056095
     C***********          Z-ADD@@MDNO    IGDLAD           *1             056095
     C                     Z-ADDIGLDAT    ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    IGDLAD           *1             056095
     C                     END                             E1
     C*
     C**  FIND MIDAS DEAL TYPE
     C           IGTYPE    IFEQ 'RC'                       B1
     C                     MOVEL'SC'      IGMTYP           *1
     C                     ELSE                            X1
     C                     MOVELIGTYPE    IGMTYP           *1
     C                     END                             E1
     C*
     C**  CHAIN FOR ORIGINAL DEAL AND EXECUTE SR
     C           IGDA38    CHAINMMDEALLL             61
     C*
     C                     MOVEL@STDL     Z#WSTS                          082738
      *                                                                   082738
     C**  CHECK FOR DATA BASE ERROR
     C           *IN61     IFEQ '1'                        B1
     C                     MOVELIGDA38    DBKEY            *1
     C                     MOVEL'MMDEALLL'DBFILE           ************
     C                     MOVEL'031'     DBASE            * DB ERR 31*
     C                     EXSR #Z                         ************
     C                     END                             E1
     C*
     C           @FORM     IFEQ 'MMDELDP '                 B1
     C                     MOVELHKMTYP    @MTYP            *1
     C                     EXSR #ZLA                       *1
     C*
     C**  UPDATE SUPPLEMENTARY FIELDS AND RELATED FIELDS
     C                     EXSR #ZLB                       *1
     C*
     C**  PERFORM SETTLE INTEREST PROCESSING IF DEAL TYPE IS SI
     C***********IGTYPE    CASEQ'SI'      #ZLD             *1             083409
     C           IGLACT    IFEQ 'I'                        *1             083409
     C           IGTYPE    ANDEQ'SI'                                      083409
     C                     EXSR #ZLD                                      083409
     C                     END                             *1
     C**  IF DEAL AMENDMENT TYPE IS 'SI' AND ACTION CODE IS NOT 'I',      103949
     C**  SET THE DEAL AMENDMENT AMOUNT TO THE DEAL AMENDMENT AMOUNT      103949
     C**  BEFORE UPDATE                                                   103949
     C           IGTYPE    IFEQ 'SI'                                      103949
     C           IGLACT    ANDNE'I'                                       103949
     C                     Z-ADDIGBAMT    IGAMNP                          103949
     C                     END                                            103949
     C*
     C                     ELSE                            X1
     C*
     C                     MOVELHLMTYP    @MTYP            *1
     C                     EXSR #ZLA                       *1
     C*
     C**  UPDATE SUPPLEMENTARY & RELATED FIELDS
     C                     EXSR #ZLC                       *1
     C*
     C**  PERFORM SETTLE INTEREST PROCESSING IF DEAL TYPE IS SI
     C           IGTYPE    CASEQ'SI'      #ZLE             *1
     C                     END                             *1
     C*
     C                     END                             E1
     C*
     C***Set*up*extended*settlement*fields*for*the*PC***************S01227S01319
     C***********@FB*******IFEQ*'F'************************B1******S01227*S01319
     C*********************MOVELIGORCM****IGRSTM************1*******S01227S01319
     C*********************MOVELIGMORI****IGRONS************1*******S01227S01319
     C*********************MOVELIGMOPM****IGPSTM************1*******S01227S01319
     C*********************MOVELIGMOPI****IGPONS************1*******S01227S01319
     C*********************MOVELIGSPEC****IGBTB1************1*******S01227S01319
     C*********************MOVELIGMCPI****IGRIBN************1*******S01227S01319
     C*********************MOVELIGMCRI****IGAWBN************1*******S01227S01319
     C*********************MOVELIGMFAO****IGBENN************1*******S01227S01319
     C*********************MOVE*'N'*******IGCVMR************1*******E22405S01319
     C*********************END*****************************E1*******S01227S01319
     C**************************************************************S01227S01319
     C           #ZL9      ENDSR                           ***#ZL9***
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZLA     - Deams - Find Original Deal                         *
     C*                                                               *
     C* CALLS    #ZLAA    - Deams Pay Instructions                    *
     C*          #ZLAB    - Deams Receive Instructions                *
     C*                                                               *
     C* CALLED BY  #ZL    - Deams Supplementary Fields                *
     C*                                                               *
     C* FLDS USED  @MTYP  - Midas deal type                           *
     C*                                                               *
     C*****************************************************************
     C           #ZLA      BEGSR
     C*
     C** IF DRS TYPE = PD & MIDAS TYPE = CD PERFORM PAY INSTRUCTIONS
     C           IGTYPE    IFEQ 'PD'                       B1
     C           @MTYP     IFEQ 'CD'                       B*2
     C                     EXSR #ZLAA                      **2
     C*
     C** IF DRS TYPE = PD & MIDAS TYPE NOT CD PERFORM RECEIVE INS
     C                     ELSE                            X*2
     C                     EXSR #ZLAB                      **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C** IF DRS TYPE = PI & MIDAS TYPE = CD PERFORM RECEIVE INS
     C           IGTYPE    IFEQ 'PI'                       B1
     C           @MTYP     IFEQ 'CD'                       B*2
     C                     EXSR #ZLAB                      **2
     C*
     C** IF DRS TYPE = PI & MIDAS TYPE NOT = CD PERFORM PAY INSTRUCTION
     C                     ELSE                            X*2
     C                     EXSR #ZLAA                      **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C** IF DRS TYPE = SI & MIDAS TYPE = IT, TD, CI PERFORM PAY INS
     C           IGTYPE    IFEQ 'SI'                       B1
     C           @MTYP     IFEQ 'IT'                       B*2
     C           @MTYP     OREQ 'TD'                       **2
     C           @MTYP     OREQ 'CI'                       **2
     C           @MTYP     OREQ 'CD'                       B*2            083409
     C                     EXSR #ZLAA                      **2
     C*
     C** IF DRS TYPE = SI & MIDAS TYPE NOT = IT, TD, CI PERFORM REC INS
     C                     ELSE                            X*2
     C                     EXSR #ZLAB                      **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C           #ZLA9     ENDSR                           ***#ZLA9***
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZLAA    - Deams Pay Instructions                             *
     C*                                                               *
     C* CALLS    #ZAC     - Midas Our Pay Method                      *
     C*          #ZAD     - Midas Our Pay Instructions                *
     C*          #ZAF     - Midas Customer Receive Instructions       *
     C*          #ZAG     - Midas For Account Of                      *
     C*                                                               *
     C* CALLED BY  #ZLA   - Deams - Find Original Deal                *
     C*                                                               *
     C* FLDS USED  @DOPM  - Deal our pay method                       *
     C*            @MOPM  - Midas our pay method                      *
     C*            @DOPI  - Deal our pay instructions                 *
     C*            @CCY   - Currency                                  *
     C*            @CNUM  - Customer number                           *
     C*            @MOPI  - Midas our pay instructions                *
     C*            @DCRI  - Deal customer receive instructions        *
     C*            @MCRI  - Midas customer receive instructions       *
     C*            @DFAC  - Deal for account of                       *
     C*            @MFAO  - Midas for account of                      *
     C*                                                               *
     C*****************************************************************
     C           #ZLAA     BEGSR
      *                                                                   CEU003
      ** Setup deals-effective-currency-workfield                         CEU003
      *                                                                   CEU003
     C                     MOVE *BLANKS   WDECY                           CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           HNSTCY    ANDNE*BLANKS                                   CEU003
      *                                                                   CEU003
     C                     MOVELHNSTCY    WDECY                           CEU003
      *                                                                   CEU003
     C                     ELSE                                           CEU003
      *                                                                   CEU003
     C                     MOVELHNCCY     WDECY                           CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
     C*
     C** MIDAS OUR PAY METHOD
     C**  Extended settlement fields for PC are set up                    S01227
     C**  at the end of the subroutine #ZL.                               S01227
     C           IGMOPM    IFEQ *ZEROS                     B1
     C           IGDOPM    ORNE HNDOPM                     B*2
     C           IGLACT    OREQ 'I'                        B1             083409
     C                     MOVELIGDOPM    @DOPM            **2
     C                     EXSR #ZAC                       **2
     C                     Z-ADD@MOPM     IGMOPM           **2
     C                     ELSE                            X*2
     C           HNDOPM    IFEQ *BLANK                     B**3
     C                     Z-ADD*ZERO     IGMOPM           ***3
     C                     ELSE                            X**3
     C                     MOVE HNMOPM    IGMOPM           ***3
     C                     END                             E**3
     C                     END                             E*2
     C*
     C** MIDAS OUR PAY INSTRUCTIONS
     C**  Extended settlement fields for PC are set up                    S01227
     C**  at the end of the subroutine #ZL.                               S01227
     C           IGLACT    IFEQ 'I'                        B1             E12909
     C           IGMOPI    IFEQ *BLANKS                    B2             E12909
     C                     MOVELIGDOPM    @DOPM            **2            E12909
     C                     MOVELIGDOPI    @DOPI            **2            E12909
     C***********          MOVELIGCCY     @CCY             **2     E12909 CEU003
     C                     MOVELWSECY     @CCY                            CEU003
     C                     MOVELIGCNUM    @CNUM            **2            E12909
     C                     MOVELIGMOPI    NOSN3                           BHF860
     C                     EXSR #ZAD                       **2            E12909
     C                     MOVEL@MOPI     IGMOPI           **2            E12909
     C                     END                             E2             E12909
     C                     ELSE                            X1             E12909
     C           IGMOPI    IFEQ *BLANKS                    B*2
     C*******    IGDOPI    IFNE HNDOPI                     **2            E12909
     C*******    IGDOPI    ORNE HNDOPI                     **2     E12909 E22150
     C           IGDOPI    IFNE HNDOPI                     B**3           E22150
     C           IGDOPM    ORNE HNDOPM                     ***3
     C***********HNCCY     ORNE IGBUCY                     ***3           CEU003
     C           WDECY     ORNE IGBUCY                                    CEU003
     C                     MOVELIGDOPM    @DOPM            ***3
     C                     MOVELIGDOPI    @DOPI            ***3
     C***********          MOVELIGCCY     @CCY             ***3           CEU003
     C                     MOVELWSECY     @CCY                            CEU003
     C                     MOVELIGCNUM    @CNUM            ***3
     C                     MOVELIGMOPI    NOSN3                           BHF860
     C                     EXSR #ZAD                       ***3
     C                     MOVEL@MOPI     IGMOPI           ***3
     C                     ELSE                            X**3
     C                     MOVE HNMOPI    IGMOPI           ***3
     C                     END                             E**3           E22150
     C                     END                             E*2
     C                     END                             E1
     C*
     C** MIDAS CUSTOMER RECEIVE INSTRUCTIONS
     C**  Extended settlement fields for PC are set up                    S01227
     C**  at the end of the subroutine #ZL.                               S01227
     C           IGMCRI    IFEQ *BLANKS                    B1
     C           IGDCRI    IFNE HNDCRI                     B*2
     C                     MOVELIGDCRI    @DCRI            **2
     C                     EXSR #ZAF                       **2
     C                     MOVEL@MCRI     IGMCRI           **2
     C                     ELSE                            X*2
     C                     MOVE HNMCRI    IGMCRI           **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C** MIDAS FOR ACCOUNT OF
     C**  Extended settlement fields for PC are set up                    S01227
     C**  at the end of the subroutine #ZL.                               S01227
     C           IGMFAO    IFEQ *BLANKS                    B1
     C           IGDFAC    IFNE HNDFAC                     B*2
     C                     MOVELIGDFAC    @DFAC            **2
     C                     EXSR #ZAG                       **2
     C                     MOVEL@MFAO     IGMFAO           **2
     C                     ELSE                            X*2
     C                     MOVE HNMFAO    IGMFAO           **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C           #ZLAA9    ENDSR                           ***#ZLAA9***
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZLAB    - Deams Receive Instructions                         *
     C*                                                               *
     C* CALLS    #ZAA     - Midas Our Receive Method                  *
     C*          #ZAB     - Midas Our Receive Instructions            *
     C*          #ZAE     - Midas Customer Pay Instructions           *
     C*                                                               *
     C* CALLED BY  #ZLA   - Deams - Find Original Deal                *
     C*                                                               *
     C* FLDS USED  @DORM  - Deal our receive method                   *
     C*            @ORCM  - Midas our recive method                   *
     C*            @DORI  - Deal our receive instructions             *
     C*            @CCY   - Currency                                  *
     C*            @CNUM  - Customer number                           *
     C*            @MORI  - Midas our receive insructions             *
     C*            @DCPI  - Deal customer pay instructions            *
     C*            @MCPI  - Midas customer pay instructions           *
     C*                                                               *
     C*****************************************************************
     C           #ZLAB     BEGSR
      *                                                                   CEU003
      ** Setup deals-effective-currency-workfield                         CEU003
      *                                                                   CEU003
     C                     MOVE *BLANKS   WDECY                           CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           HNSTCY    ANDNE*BLANKS                                   CEU003
      *                                                                   CEU003
     C                     MOVELHNSTCY    WDECY                           CEU003
      *                                                                   CEU003
     C                     ELSE                                           CEU003
      *                                                                   CEU003
     C                     MOVELHNCCY     WDECY                           CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
     C*
     C** MIDAS OUR RECEIVE METHOD
     C**  Extended settlement fields for PC are set up                    S01227
     C**  at the end of the subroutine #ZL.                               S01227
     C           IGORCM    IFEQ *ZEROS                     B1
     C           IGDORM    ORNE HNDORM                     B*2
     C           IGLACT    OREQ 'I'                        B1             083409
     C                     MOVELIGDORM    @DORM            **2
     C                     EXSR #ZAA                       **2
     C                     Z-ADD@ORCM     IGORCM           **2
     C                     ELSE                            X*2
     C           HNDORM    IFEQ *BLANK                     B**3
     C                     Z-ADD*ZERO     IGORCM           ***3
     C                     ELSE                            X**3
     C                     Z-ADDHNORCM    IGORCM           ***3
     C                     END                             E**3
     C                     END                             E*2
     C*
     C** MIDAS OUR RECEIVE INSTRUCTIONS
     C**  Extended settlement fields for PC are set up                    S01227
     C**  at the end of the subroutine #ZL.                               S01227
     C           IGLACT    IFEQ 'I'                        B1             E12909
     C           IGMORI    IFEQ *BLANKS                    B*2            E12909
     C                     MOVELIGDORM    @DORM            **2            E12909
     C                     MOVELIGDORI    @DORI            **2            E12909
     C***********          MOVELIGCCY     @CCY             **2     E12909 E12909
     C                     MOVELWSECY     @CCY                            CEU003
     C                     MOVELIGCNUM    @CNUM            **2            E12909
     C                     MOVELIGMORI    NOSN3            **2            BHF860
     C                     EXSR #ZAB                       **2            E12909
     C                     MOVEL@MORI     IGMORI           **2            E12909
     C                     END                             E*2            E12909
     C                     ELSE                            X1             E12909
     C           IGMORI    IFEQ *BLANKS                    B*2
     C*******    IGDORI    IFNE HNDORI                     **2            E12909
     C*******    IGDORI    ORNE HNDORI                     **2     E12909 E22150
     C           IGDORI    IFNE HNDORI                     B**3           E22150
     C           IGDORM    ORNE HNDORM                     ***3
     C***********HNCCY     ORNE IGBUCY                     ***3           CEU003
     C           WDECY     ORNE IGBUCY                                    CEU003
     C                     MOVELIGDORM    @DORM            ***3
     C                     MOVELIGDORI    @DORI            ***3
     C***********          MOVELIGCCY     @CCY             ***3           CEU003
     C                     MOVELWSECY     @CCY                            CEU003
     C                     MOVELIGCNUM    @CNUM            ***3
     C                     MOVELIGMORI    NOSN3            **2            BHF860
     C                     EXSR #ZAB                       ***3
     C                     MOVEL@MORI     IGMORI           ***3
     C                     ELSE                            X**3
     C                     MOVE HNMORI    IGMORI           ***3
     C                     END                             E**3           E22150
     C                     END                             E*2
     C                     END                             E1
     C*
     C** MIDAS CUSTOMER PAY INSTRUCTIONS
     C**  Extended settlement fields for PC are set up                    S01227
     C**  at the end of the subroutine #ZL.                               S01227
     C           IGMCPI    IFEQ *BLANKS                    B1
     C           IGDCPI    IFNE HNDCPI                     B*2
     C                     MOVELIGDCPI    @DCPI            **2
     C                     EXSR #ZAE                       **2
     C                     MOVEL@MCPI     IGMCPI           **2
     C                     ELSE                            X*2
     C*********************MOVE HLMCPI    IGMCPI           **2     E17938 S01177
     C                     MOVE HNMCPI    IGMCPI           **2     E17938 S01177
     C                     END                             E*2
     C                     END                             E1
     C*
     C           #ZLAB9    ENDSR                           ****#ZLAB9**
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZLB     - Deams - Original Type Loans Deposits               *
     C*                                                               *
     C* CALLS    #Z       - Data base errors                          *
     C*                                                               *
     C* CALLED BY  #ZL    - Deams Supplementary Fields                *
     C*                                                               *
     C* FLDS USED  @HKMDY - Maturity Date                             *
     C*            @IGOMY - Original deal end date                    *
     C*            @HKVDY - Value date                                *
     C*            @IGOSY - Original deal start date                  *
     C*                                                               *
     C*****************************************************************
     C           #ZLB      BEGSR
     C*
     C                     MOVE HKTYPE    IGOGDT
     C                     MOVE HKMTYP    IGOMDT
     C                     MOVE HKSTYP    IGOSTP
     C                     Z-ADDHKAMNP    IGOGDA
     C                     Z-ADDHKNTCE    IGONTC
     C                     MOVELHKCSNM    IGOCNM
     C                     Z-ADD@HKMDY    @IGOMY
     C                     Z-ADD@HKVDY    @IGOSY
     C           HKDBRC    IFNE *BLANKS                    B1             E28286
     C********   HKDBRC    CHAINFDBSNCLL             61                   S01194
     C**********           CALL 'AOBRCHR0'                                             S01194 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM HKDBRC    @WRK3                           S01194
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01194 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*
     C**  CHECK FOR DATA BASE ERROR
     C*********  *IN61     IFEQ '1'                        B1             S01194
     C           @RTCD     IFNE *BLANK                     B1             S01194
     C                     MOVELHKDBRC    DBKEY            *1
     C*********            MOVEL'FDBSNCLL'DBFILE                          S01194
     C                     MOVEL'SDBRCHPD'DBFILE           ************   S01194
     C                     MOVEL'032'     DBASE            * DB ERR 32*
     C                     MOVEL@OPTN     DBOPTN           *              S01194
     C                     EXSR #Z                         ************
     C                     END                             E1
     C**********           MOVELBRNM      IGBRNM                          S01194
     C                     MOVELA8BRNM    IGBRNM                          S01194
     C                     END                             E1             E28286
     C*
     C           HKDBSR    IFNE *BLANKS                    B1
     C                     Z-ADDHKSPRD    IGORAT           *1
     C                     MOVELHKDBSR    IGOBRC           *1
     C                     ELSE                            X1
     C                     Z-ADDHKINTR    IGORAT           *1
     C                     END                             E1
     C*
     C                     Z-ADDHKORCM    IGRORM
     C                     MOVELHKDORI    IGRORI
     C                     MOVELHKDCPI    IGRCPI
     C                     Z-ADDHKMOPM    IGROPM
     C                     MOVELHKDOPI    IGROPI
     C                     MOVELHKDCRI    IGRCRI
     C                     Z-ADDHKAMNP    IGRBAT
     C                     MOVELHKCCY     IGRBCY
     C**********           Z-ADDHKCNUM    IGRCNM                                              CSD027
     C                     MOVE HKCNUM    IGRCNM                                              CSD027
     C                     Z-ADD@HKVDY    IGRVDT
     C                     MOVELHKDSTS    IGRSTS
     C                     Z-ADDHKINTR    IGRIRT
     C                     MOVE HKICMT    IGRICM
     C*
     C           #ZLB9     ENDSR                           ****#ZLB9***
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZLC     - Deams - Original Type NABs                         *
     C*                                                               *
     C* CALLS    #Z       - Data base errors                          *
     C*                                                               *
     C* CALLED BY  #ZL    - Deams Supplementary Fields                *
     C*                                                               *
     C* FLDS USED  @HLMDY - Maturity Date                             *
     C*            @IGOMY - Original deal end date                    *
     C*            @HLVDY - Vlaue date                                *
     C*            @IGOSY - Original deal start date                  *
     C*                                                               *
     C*****************************************************************
     C           #ZLC      BEGSR
     C*
     C                     MOVE HLTYPE    IGOGDT
     C                     MOVE HLMTYP    IGOMDT
     C                     Z-ADDHLFVAL    IGOGDA
     C                     MOVELHLISUR    IGOCNM
     C                     Z-ADD@HLMDY    @IGOMY
     C                     Z-ADD@HLVDY    @IGOSY
      *
     C*********  HLDBRC    CHAINFDBSNCLL             61
     C           HLDBRC    IFNE *BLANKS                                   E28286
     C**********           CALL 'AOBRCHR0'                                             S01194 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM HLDBRC    @WRK3                           S01194
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01194 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*
     C**  CHECK FOR DATA BASE ERROR
     C*********  *IN61     IFEQ '1'                        B1             S01194
     C           @RTCD     IFNE *BLANK                     B1             S01194
     C                     MOVELHLDBRC    DBKEY            *1
     C*********            MOVEL'FDBSNCLL'DBFILE           ************   S01194
     C                     MOVEL'SDBRCHPD'DBFILE           ************   S01194
     C                     MOVEL'033'     DBASE            * DB ERR 33*
     C                     MOVEL@OPTN     DBOPTN           *              S01194
     C                     EXSR #Z                         ************
     C                     END                             E1
     C**********           MOVELBRNM      IGBRNM                          S01194
     C                     MOVELA8BRNM    IGBRNM                          S01194
     C                     END                                            E28286
     C*
     C           HLTYPE    IFEQ 'C1'                       B1
     C           HLTYPE    OREQ 'C2'                       *1
     C           HLTYPE    OREQ 'BO'                       *1
     C           HLTYPE    OREQ 'BI'                       *1
     C                     Z-ADDHLFRAT    IGORAT           *1
     C                     END                             E1
     C*
     C           HLTYPE    IFEQ 'TA'                       B1
     C           HLTYPE    OREQ 'TB'                       *1
     C           HLTYPE    OREQ 'BA'                       *1
     C                     Z-ADDHLDCRT    IGORAT           *1
     C                     END                             E1
     C*
     C                     Z-ADDHLORCM    IGRORM
     C                     MOVELHLDORI    IGRORI
     C                     MOVELHLDCPI    IGRCPI
     C                     Z-ADDHLMOPM    IGROPM
     C                     MOVELHLDOPI    IGROPI
     C                     MOVELHLDCRI    IGRCRI
     C                     Z-ADDHLAMNP    IGRBAT
     C                     MOVELHLCCY     IGRBCY
     C**********           Z-ADDHLCNUM    IGRCNM                                              CSD027
     C                     MOVE HLCNUM    IGRCNM                                              CSD027
     C                     Z-ADD@HLVDY    IGRVDT
     C                     MOVELHLDSTS    IGRSTS
     C                     Z-ADDHLINTR    IGRIRT
     C                     MOVE HLICMT    IGRICM
     C*
     C           #ZLC9     ENDSR                           ***#ZLC9***
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZLD     - Deams Settle Interest - Loans Deposits             *
     C*                                                               *
     C**CALLS****ZA0680***-*Calculate*midas*day*no*********************   056095
     C***********MM1007***- Calculate interest                        *   E17051
     C* CALLS    ZDAT10   - Calculate midas day no                    *   056095
     C*          MM1030   - Calculate interest                        *   E17051
     C*                                                               *
     C* CALLED BY  #ZL    - Deams Supplementary Fields                *
     C*                                                               *
     C* FLDS USED  @IGVDY - Value date                                *
     C*            @HNVDY - Value date                                *
     C*            @HKSLY - Start/last interset date                  *
     C*************@@DTIN*-*Date*8,0*format****************************   056095
     C*************@@MDNO*-*Date*5,0*format****************************   056095
     C*************@@BEG**-*Start*date*********************************   056095
     C*************@@END**-*End*date***********************************   056095
     C*************@@CALC*-*Interest*Calculation*Method****************   056095
     C*            ZZDTIN - Date 8,0 format                           *   056095
     C*            ZZMDNO - Date 5,0 format                           *   056095
     C*            ZZBEG  - Start date                                *   056095
     C*            ZZEND  - End date                                  *   056095
     C*            ZZCALC - Interest Calculation Method               *   056095
     C*            @@AMT  - Amount                                    *
     C*            @@RATE - Interest Rate                             *
     C*            @@INTR - Interest                                  *
     C*                                                               *
     C*****************************************************************
     C           #ZLD      BEGSR
     C*
     C****CHECK*IF ANYOTHER DEAMS EXIST ON MMDEAMLL WITH VALUE DATE       083409
     C****<*PRESENT DEAM AND TYPE = 'SI'                                  083409
     C***********IGDA38    SETLLMMDEAMLL                                  083409
     C*
     C***********          MOVEL'NO '     @FOUND                          083409
     C****ACCESS*FILE UNTIL 'SI' TYPE FOUND, NO RECORD FOR DEAL NO OR     083409
     C****VALUE*DATE BECOMES GREATER OR EQUAL DEALS FILE VALUE DATE       083409
     C************IN61     DOUEQ'1'                        B1             083409
     C***********HNTYPE    OREQ 'SI'                       *1             083409
     C***********@IGVDY    ANDLT@HNVDY                     *1             083409
     C***********HNDDLT    ANDNE'D'                        *1             083409
     C***********IGDA38    READEMMDEAMLL                 61*1             083409
     C*
     C****RECORD*FOUND SET FLAG                                           083409
     C************IN61     IFEQ '0'                        B*2            083409
     C***********HNTYPE    ANDEQ'SI'                       **2            083409
     C***********HNDDLT    ANDNE'D'                        **2            083409
     C*
     C***********          MOVEL'YES'     @FOUND           **2            083409
     C***********          END                             E*2            083409
     C*
     C****Set*flag off if this is a not a deam amend  & the record found  083409
     C****is*record being amended in which case it should be treated as   083409
     C****it*was when initially inserted (so that if amount was           083409
     C****calculated before amendment it will be recalculated).           083409
     C***********IGLACT    IFEQ 'A'                        B*2            083409
     C************IN61     ANDEQ'0'                        **2            083409
     C***********HNTYPE    ANDEQ'SI'                       **2            083409
     C***********HNDDLT    ANDNE'D'                        **2            083409
     C***********IGDA38    ANDEQHNDA38                     **2            083409
     C***********IGVDYY    ANDEQHNVDYY                     **2            083409
     C***********IGVDMM    ANDEQHNVDMM                     **2            083409
     C***********IGVDDD    ANDEQHNVDDD                     **2            083409
     C***********IGDS38    ANDEQHNDS38                     **2            083409
     C***********          MOVEL'NO '     @FOUND           **2            083409
     C***********          END                             E*2            083409
     C*
     C***********          END                             E1             083409
     C*
     C***********@IGVDY    IFLT @HNVDY                     B1             083409
     C***********@FOUND    OREQ 'NO '                      *1             083409
     C*
     C***********          Z-ADD@HKSLY    @@DTIN           *1             056095
     C***********          EXSR ZA0680                     *1             056095
     C***********          Z-ADD@@MDNO    @@BEG            *1             056095
     C***********          Z-ADD@HKSLY    ZZDTIN           *1      056095 083409
     C***********          EXSR ZDAT10                     *1      056095 083409
     C***********          Z-ADDZZMDNO    ZZBEG            *1      056095 083409
     C*
     C***********          Z-ADDIGDVSD    @@END            *1             056095
     C***********          MOVELHKICMT    @@CALC           *1             056095
     C***********          Z-ADDIGDVSD    ZZEND            *1      056095 083409
     C***********          MOVELHKICMT    ZZCALC           *1      056095 083409
     C***********          Z-ADDHKAMNP    @@AMT            *1             083409
     C***********          Z-ADDHKINTR    @@RATE           *1             083409
     C***********          MOVE *BLANK    @@RDFC           *1      S01392 083409
     C*
     C*********************EXSR MM1007                     *1             E17051
     C***********          EXSR MM1030                     *1      E17051 083409
     C*
     C***********          Z-SUB@@INTR    IGAMNP           *1             083409
     C*
     C************         END                             E1             083409
     C*                                                                   083409
     C* DO CALCULATION BASED ON DEAL AMENDMENTS WHICH                     083409
     C* HAPPENED BEFORE VALUE DATE OF INPUT 'SI' DEAL AMENDMENT           083409
     C*                                                                   083409
     C*********************Z-ADD@IGVDY    @@DTIN           *1       UK2419082738
     C*********************EXSR ZA0680                              UK2419082738
     C*********************Z-ADD@@MDNO    SCVDAT           *1       UK2419082738
     C                     Z-ADD@IGVDY    ZZDTIN           *1             082738
     C                     EXSR ZDAT10                                    082738
     C                     Z-ADDZZMDNO    SCVDAT           *1             082738
     C*                                                                   083409
     C           HKAMNP    IFLT *ZERO                                     083409
     C                     Z-SUBHKAMNP    SCAMNP           *1             083409
     C                     ELSE                                           083409
     C                     Z-ADDHKAMNP    SCAMNP           *1             083409
     C                     END                                            083409
     C*                                                                   083409
     C                     MOVELHKDN38    SCDLNO           *1             083409
     C                     Z-ADDHKINTR    SCINTR           *1             083409
     C                     MOVELHKICMT    SCCALC           *1             083409
     C*                                                                   083409
     C                     EXSR SCINT                      *1             083409
     C*                                                                   083409
     C           HKMTYP    IFEQ 'IT'                                      083409
     C           HKMTYP    OREQ 'TD'                                      083409
     C           HKMTYP    OREQ 'CI'                                      083409
     C           HKMTYP    OREQ 'CD'                                      083409
     C                     Z-SUBINTAMT    IGAMNP           *1 PAY         083409
     C                     ELSE                                           083409
     C                     Z-ADDINTAMT    IGAMNP           *1 RECEIVE     083409
     C                     END                                            083409
     C/COPY WNCPYSRC,MM0078C005
     C*
     C           #ZLD9     ENDSR                           ***#ZLD9***
     C*****************************************************************   083409
     C/EJECT                                                              083409
     C*****************************************************************   083409
     C*                                                               *   083409
     C* SCINT    - CALCULATION OF INTEREST FOR 'CD' AND 'CL' DEALS    *   083409
     C*            FOR 'SI' AMENDMENT                                 *   083409
     C*                                                               *   083409
     C* CALLS    MM1030   - Calculate interest                        *   083409
     C*                                                               *   083409
     C* CALLED BY  #ZLD   - Deams SETTLE INTEREST - LN/DEP            *   083409
     C*            #ZLE   - DEAMS SETTLE INTEREST - NABS              *   083409
     C*                                                               *   083409
     C* FLDS USED  SCAMNP - AMOUNT AT CONTROL DATE                    *   083409
     C*            SCAITC - ACCRUED INTEREST TO CONTROL DATE          *   083409
     C*            SCCALC - CALCULATION METHOD                        *   083409
     C*            SCDLNO - DEAL NUMBER OF RELATED DEAL               *   083409
     C*            SCVDAT - VALUE DATE OF DEAL AMENDMENT              *   083409
     C*            INTAMT - AMOUNT OF INTEREST AT VALUE DATE          *   083409
     C*            SCICTD - INTEREST CAPITALISED UPTO CONTROL DATE    *   083409
     C*            SCINTR - INTEREST RATE AT CONTROL DATE             *   083409
     C*            SCIPRD - INTEREST PAID/RECD UPTO CONTROL DATE      *   083409
     C*                                                               *   083409
     C*****************************************************************   083409
     C           SCINT     BEGSR                                          083409
     C*                                                               *   083409
     C/COPY WNCPYSRC,MM0078C023
     C           SCDLNO    CHAINDEALS                89    *1             083409
     C*                                                                   083409
     C**  CHECK FOR DEAL NOT FOUND                                        083409
     C           *IN89     IFEQ '1'                        B2             083409
     C*********************Z-ADDIGRVDT    @@DTIN                    UK2419082738
     C*********************EXSR ZA0680                              UK2419082738
     C*********************Z-ADD@@MDNO    SCIACD                    UK2419082738
     C                     Z-ADDIGRVDT    ZZDTIN                          082738
     C                     EXSR ZDAT10                                    082738
     C                     Z-ADDZZMDNO    SCIACD                          082738
     C                     Z-ADD*ZERO     SCAITC                          083409
     C                     Z-ADD*ZERO     SCIPRD                          083409
     C                     Z-ADD*ZERO     SCICTD                          083409
     C                     ELSE                                           083409
     C                     Z-ADDIACD      SCIACD                          083409
     C           AITC      ADD  AIAN      SCAITC                          083409
     C                     ADD  AIAP      SCAITC                          083409
     C                     Z-ADDIPRD      SCIPRD                          083409
     C                     Z-ADDICTD      SCICTD                          083409
     C                     END                             E2             083409
     C*                                                                   083409
     C           SCKEY     KLIST                                          083409
     C                     KFLD           SCDLNO                          083409
     C                     KFLD           SCCDYY                          083409
     C                     KFLD           SCCDMM                          083409
     C                     KFLD           SCCDDD                          083409
     C*                                                                   083409
     C           SCKYP     KLIST                                          083409
     C                     KFLD           SCDLNO                          083409
     C*                                                                   083409
     C*  CHANGE CONTROL DATE IN THE FORMAT OF YYYYMMDD                    083409
     C*                                                                   083409
     C                     Z-ADDSCIACD    @@DAYN           *1             083409
     C                     EXSR ZDATE9                     *1             083409
     C                     Z-ADD@@YR      SCCDYY           *1             083409
     C                     Z-ADD@@Z71M    SCCDMM           *1             083409
     C                     Z-ADD@@Z71D    SCCDDD           *1             083409
     C*                                                                   083409
     C           SCKEY     SETLLMMDEAMLL                                  083409
     C           SCKYP     READEMMDEAMLL                 89               083409
     C                     MOVELSCCALC    ZZCALC           *1             083409
     C*                                                                   083409
     C* WHILEST A DEAL AMENDMENT CAN BE FOUND,                            083409
     C* APPLY THE CHANGES                                                 083409
     C*                                                                   083409
     C           *IN89     DOWNE'1'                                       083409
     C           @HNVDY    ANDLT@IGVDY                                    083409
     C*                                                                   083409
     C* CALCULATE THE INTEREST BETWEEN THE CONTROL DATE AND               083409
     C* THE VALUE DATE OF THE DEAL AMENDMENT OFF THE FILE                 083409
     C           HNDDLT    IFNE 'D'                                       083409
     C*********************Z-ADDSCIACD    @@BEG                     UK2419082738
     C*********************Z-ADD@HNVDY    @@DTIN           *1       UK2419082738
     C*********************EXSR ZA0680                     *1       UK2419082738
     C*********************Z-ADD@@MDNO    SCAMDD           *1       UK2419082738
     C*********************Z-ADDSCAMDD    @@END            *1       UK2419082738
     C                     Z-ADDSCIACD    ZZBEG                           082738
     C                     Z-ADD@HNVDY    ZZDTIN           *1             082738
     C                     EXSR ZDAT10                     *1             082738
     C                     Z-ADDZZMDNO    SCAMDD           *1             082738
     C                     Z-ADDSCAMDD    ZZEND            *1             082738
     C*                                                                   083409
     C                     Z-ADDSCAMNP    @@AMT            *1             083409
     C                     Z-ADDSCINTR    @@RATE           *1             083409
     C                     EXSR MM1030                     *1             083409
     C*                                                                   083409
     C                     ADD  @@INTR    SCAITC           *1             083409
     C                     Z-ADDSCAMDD    SCIACD           *1             083409
     C*                                                                   083409
     C* DEAL AMENDMENT AMOUNT IS SIGNED -VE FOR PAY, +VE FOR RECEIVE      083409
     C*                                                                   083409
     C           HNAMNP    IFLT *ZEROS                                    083409
     C                     Z-SUBHNAMNP    HNAMNP                          083409
     C                     END                                            083409
     C*                                                                   083409
     C* IF THE DEAL AMENDMENT IS A RATE CHANGE,                           083409
     C* CHANGE THE RATE USED                                              083409
     C           HNMTYP    IFEQ 'SC'                                      083409
     C                     Z-ADDHNINTR    SCINTR                          083409
     C                     END                                            083409
     C*                                                                   083409
     C* IF THE DEAL AMENDMENT IS A SETTLE INTEREST,                       083409
     C* UPDATE INTEREST PAID/RECD TODAY FIELD                             083409
     C           HNMTYP    IFEQ 'SI'                                      083409
     C                     ADD  HNAMNP    SCIPRD                          083409
     C                     END                                            083409
     C*                                                                   083409
     C* IF THE DEAL AMENDMENT IS A PRINCIPAL INCREASE,                    083409
     C* UPDATE AMOUNT                                                     083409
     C           HNMTYP    IFEQ 'PI'                                      083409
     C                     ADD  HNAMNP    SCAMNP                          083409
     C                     END                                            083409
     C*                                                                   083409
     C* IF THE DEAL AMENDMENT IS A PRINCIPAL DECREASE,                    083409
     C* UPDATE AMOUNT                                                     083409
     C           HNMTYP    IFEQ 'PD'                                      083409
     C                     SUB  HNAMNP    SCAMNP                          083409
     C                     END                                            083409
     C*                                                                   083409
     C* IF THE DEAL AMENDMENT IS A CAPITALISED INTEREST,                  083409
     C* UPDATE AMOUNT AND INT CAPITALISED TO DATE FIELDS                  083409
     C           HNMTYP    IFEQ 'CI'                                      083409
     C                     ADD  HNAMNP    SCICTD                          083409
     C                     ADD  HNAMNP    SCAMNP                          083409
     C                     END                                            083409
     C                     END                                            083409
     C*                                                                   083409
     C* READ NEXT RECORD OFF FILE                                         083409
     C*                                                                   083409
     C           SCKYP     READEMMDEAMLL                 89               083409
     C                     END                                            083409
     C*                                                                   083409
     C* IF STILL HAVE NOT COVERED ALL THE PERIOD BETWEEN                  083409
     C* INITIAL CONTROL DATE AND VALUE DATE OF THE DEAL                   083409
     C* AMENDMENT, CALCULATE INTEREST ACCRUED DURING                      083409
     C* THE REMAINING PERIOD                                              083409
     C           SCIACD    IFLT SCVDAT                                    083409
     C*********************Z-ADDSCIACD    @@BEG                     UK2419082738
     C*********************Z-ADDSCVDAT    @@END            *1       UK2419082738
     C                     Z-ADDSCIACD    ZZBEG                           082738
     C                     Z-ADDSCVDAT    ZZEND            *1             082738
     C                     Z-ADDSCAMNP    @@AMT            *1             083409
     C                     Z-ADDSCINTR    @@RATE           *1             083409
     C                     EXSR MM1030                     *1             083409
     C*                                                                   083409
     C                     ADD  @@INTR    SCAITC           *1             083409
     C                     Z-ADDSCVDAT    SCIACD           *1             083409
     C                     END                                            083409
     C*                                                                   083409
     C* THE FINAL INTEREST AMOUNT IS THE AMOUNT ACCRUED SO FAR            083409
     C* MINUS INTEREST PAID/RECD AND INTEREST CAPITALISED TO DATE         083409
     C                     Z-ADDSCAITC    INTAMT                          083409
     C                     SUB  SCIPRD    INTAMT                          083409
     C                     SUB  SCICTD    INTAMT                          083409
     C*                                                                   083409
     C           SCINT9    ENDSR                                          083409
     C*                                                                   083409
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZLE     - Deams Settle Interest - NABs                       *
     C*                                                               *
     C**CALLS****ZA0680***-*Calculate*midas*day*no*********************   056095
     C***********MM1007***- Calculate interest                        *   E17051
     C* CALLS    ZDAT10   - Calculate midas day no                    *   056095
     C*          MM1030   - Calculate interest                        *   E17051
     C*                                                               *
     C* CALLED BY  #ZL    - Deams Supplementary Fields                *
     C*                                                               *
     C* FLDS USED  @IGVDY - Value date                                *
     C*            @HNVDY - Value date                                *
     C*            @HLLIY - Last interest date                        *
     C*************@@DTIN*-*Date*8,0*format****************************   056095
     C*************@@MDNO*-*Date*5,0*format****************************   056095
     C*************@@BEG**-*Start*date*********************************   056095
     C*************@@END**-*End*date***********************************   056095
     C*************@@CALC*-*Interest*Calculation*Method****************   056095
     C*            ZZDTIN - Date 8,0 format                           *   056095
     C*            ZZMDNO - Date 5,0 format                           *   056095
     C*            ZZBEG  - Start date                                *   056095
     C*            ZZEND  - End date                                  *   056095
     C*            ZZCALC - Interest Calculation Method               *   056095
     C*            @@AMT  - Amount                                    *
     C*            @@RATE - Interest Rate                             *
     C*            @@INTR - Interest                                  *
     C*                                                               *
     C*****************************************************************
     C           #ZLE      BEGSR
     C*
     C**  CHECK IF ANYOTHER DEAMS EXIST ON MMDEAMLL WITH VALUE DATE
     C**  < PRESENT DEAM AND TYPE = 'SI'
     C           IGDA38    SETLLMMDEAMLL
     C*
     C**  RESET RECORD FOUND FLAG
     C                     MOVEL'NO '     @FOUND  3
     C*
     C**  ACCESS FILE UNTIL 'SI' TYPE FOUND, NO RECORD FOR DEAL NO OR
     C**  VALUE DATE BECOMES GREATER OR EQUAL DEALS FILE VALUE DATE
     C           *IN61     DOUEQ'1'                        B1
     C           HNTYPE    OREQ 'SI'                       *1
     C           @IGVDY    ANDLT@HNVDY                     *1
     C           HNDDLT    ANDNE'D'                        *1
     C           IGDA38    READEMMDEAMLL                 61*1
     C*
     C**  RECORD FOUND SET FLAG
     C           *IN61     IFEQ '0'                        B*2
     C           HNTYPE    ANDEQ'SI'                       **2
     C           HNDDLT    ANDNE'D'                        **2
     C                     MOVEL'YES'     @FOUND           **2
     C                     END                             E*2
     C*
     C**  Set flag off if this is a not a deam insert & the record found
     C**  is record being amended in which case it should be treated as
     C**  it was when initially inserted (so that if amount was
     C**  calculated before amendment it will be recalculated).
     C           IGLACT    IFEQ 'A'                        B*2
     C           *IN61     ANDEQ'0'                        **2
     C           HNTYPE    ANDEQ'SI'                       **2
     C           HNDDLT    ANDNE'D'                        **2
     C           IGDA38    ANDEQHNDA38                     **2
     C           IGVDYY    ANDEQHNVDYY                     **2
     C           IGVDMM    ANDEQHNVDMM                     **2
     C           IGVDDD    ANDEQHNVDDD                     **2
     C           IGDS38    ANDEQHNDS38                     **2
     C                     MOVEL'NO '     @FOUND           **2
     C                     END                             E*2
     C*
     C*
     C                     END                             E1
     C*
     C           @IGVDY    IFLT @HNVDY                     B1
     C           @FOUND    OREQ 'NO '                      *1
     C*
     C***********          Z-ADD@HLLIY    @@DTIN           *1             056095
     C***********          EXSR ZA0680                     *1             056095
     C***********          Z-ADD@@MDNO    @@BEG            *1             056095
     C                     Z-ADD@HLLIY    ZZDTIN           *1             056095
     C                     EXSR ZDAT10                     *1             056095
     C                     Z-ADDZZMDNO    ZZBEG            *1             056095
     C*
     C***********          Z-ADDIGDVSD    @@END            *1             056095
     C***********          MOVELHLICMT    @@CALC           *1             056095
     C                     Z-ADDIGDVSD    ZZEND            *1             056095
     C                     MOVELHLICMT    ZZCALC           *1             056095
     C                     Z-ADDHLAMNP    @@AMT            *1
     C                     Z-ADDHLINTR    @@RATE           *1
     C                     MOVE HLRDFC    @@RDFC           *1             S01392
     C*
     C******************   EXSR MM1007                     *1             E17051
     C                     EXSR MM1030                     *1             E17051
     C*
     C                     Z-SUB@@INTR    IGAMNP           *1
     C*
     C                     END                             E1
     C*
     C           #ZLE9     ENDSR                           ***#ZLE9***
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZM      - Deams Before Fields                                *
     C*                                                               *
     C* CALLS    #Z       - Data base errors                          *
     C*                                                               *
     C* CALLED BY  #BDB   - Deam Amends                               *
     C*            #BDC   - Deam Deletes                              *
     C*                                                               *
     C* FLDS USED  @DEAMK - Deam file key                             *
     C*            @HNVDY - Value date                                *
     C*                                                               *
     C*****************************************************************
     C           #ZM       BEGSR
     C*
     C**  CHAIN TO DEALS FILE
     C           @DEAMK    CHAINMMDEAMLL             61
     C*
     C**  CHECK FOR DATA BASE ERROR
     C           *IN61     IFEQ '1'                        B1
     C                     Z-ADDIGDA38    @WK6N            *1
     C                     Z-ADD@IGVDY    @WK8N            *1
     C                     Z-ADDIGDS38    @WK3N            *1
     C                     MOVEL'MMDEAMLL'DBFILE           ************
     C                     MOVEL'034'     DBASE            * DB ERR 34*
     C                     EXSR #Z                         ************
     C                     END                             E1
     C*
     C                     Z-ADDHNORCM    IGBORM
     C                     MOVELHNMORI    IGBORI
     C                     MOVELHNDCPI    IGBCPI
     C                     Z-ADDHNMOPM    IGBOPM
     C                     MOVELHNMOPI    IGBOPI
     C                     MOVELHNDCRI    IGBCRI
     C                     Z-ADDHNAMNP    IGBAMT
     C                     MOVELHNCCY     IGBUCY
     C**********           Z-ADDHNCNUM    IGBCNM                                              CSD027
     C                     MOVE HNCNUM    IGBCNM                                              CSD027
     C                     MOVELHNCSNM    IGBCSN
     C                     Z-ADD@HNVDY    IGBVDT
     C                     MOVELHNDSTS    IGBSTS
     C                     Z-ADDHNINTR    IGBIRT
     C* NOTE THAT IGBPOB = IGBROB, SHOULD REALLY REPLACE BOTH WITH        BHF477
     C* ONE FIELD                                                         BHF477
     C                     MOVELHNOSBR    IGBPOB                          BHF477
     C                     MOVELHNOSBR    IGBROB                          BHF477
     C*
     C           #ZM9      ENDSR                           ***#ZM9***
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C********************************************************************S01319
     C**#ZO******-*Deams*Download*Blotter*********************************S01319
     C********************************************************************S01319
     C**CALLS*************-***********************************************S01319
     C********************************************************************S01319
     C**CALLED*BY**#BDA***-*Deam*Inserts**********************************S01319
     C*************#BDB***-*Deam*Amends***********************************S01319
     C********************************************************************S01319
     C**FLDS*USED**@IGVDY*-*Value*date************************************S01319
     C*************@I2VDY*-*Value*date************************************S01319
     C*************@IGDTY*-*Deal*transaction*date*************************S01319
     C*************@I2DTY*-*Deal*transaction*date*************************S01319
     C*************@IGDMY*-*Deal*done*date********************************S01319
     C********************************************************************S01319
     C********************************************************************S01319
     C***********#ZO*******BEGSR******************************************S01319
     C********************************************************************S01319
     C*********************MOVEL'I2'******I2RCID**************************S01319
     C*********************MOVELIGDMAD****I2PCDN**************************S01319
     C*********************MOVELIGDA38****I2DN38**************************S01319
     C*********************MOVELIGDA38****I2DN31**************************S01319
     C*********************MOVELIGDS38****I2DM38**************************S01319
     C*********************MOVELIGDS38****I2DM31**************************S01319
     C*********************MOVELIGDMSQ****I2DMS1**************************S01319
     C*********************MOVELIGDMSQ****I2DMS2**************************S01319
     C*********************MOVELIGDMSQ****I2DMS3**************************S01319
     C*********************MOVELIGCCY*****I2CCY***************************S01319
     C*********************MOVELIGCCY*****I2CCY1**************************S01319
     C*********************Z-ADDIGPCTN****I2PCT2**************************S01319
     C*********************MOVELIGOGDT****I2OGDT**************************S01319
     C********************************************************************S01319
     C*********************Z-ADD@IGVDY****@I2VDY**************************S01319
     C********************************************************************S01319
     C*********************Z-ADD@IGDTY****@I2DTY**************************S01319
     C********************************************************************S01319
     C*********************Z-ADD*ZERO*****@I2DDY**************************S01319
     C********************************************************************S01319
     C***********IGLACT****IFEQ*'D'************************B1*************S01319
     C*********************MOVEL'D'*******I2DDLT************1*************S01319
     C*********************ELSE****************************X1*************S01319
     C*********************MOVEL*BLANK****I2DDLT************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C*********************MOVELIGDSTS****I2DSTS**************************S01319
     C*********************MOVELIGTYPE****I2TYPE**************************S01319
     C*********************MOVELIGCSNM****I2CSNM**************************S01319
     C********************************************************************S01319
     C*********************Z-ADD@IGDMY****@I2DDY**************************S01319
     C********************************************************************S01319
     C*********************MOVELIGDORM****I2DORM**************************S01319
     C*********************MOVELIGDORI****I2DORI**************************S01319
     C*********************MOVELIGDCPI****I2DCPI**************************S01319
     C*********************MOVELIGDOPM****I2DOPM**************************S01319
     C*********************MOVELIGDOPI****I2DOPI**************************S01319
     C*********************MOVELIGDCRI****I2DCRI**************************S01319
     C********************************************************************S01319
     C*********************MOVELIGMFAO****I2MFAO**************************S01319
     C*********************MOVELIGSPEC****I2SPEC**************************S01319
     C********************************************************************S01319
     C*********************MOVELIGCDRP****I2CDRP**************************S01319
     C*********************MOVELIGLACT****I2LACT**************************S01319
     C*********************Z-ADDIGTIME****I2TIME**************************S01319
     C********************************************************************S01319
     C*********************Z-ADD*ZERO*****I2AMND**************************S01319
     C*********************MOVELIGDUSC****I2DUSC**************************S01319
     C********************************************************************S01319
     C***********IGINTR****IFLT**ZERO*************************************S01319
     C*********************Z-SUBIGINTR****I2INTS**************************S01319
     C*********************MOVEL'-'*******I2INSN**************************S01319
     C*********************END********************************************S01319
     C********************************************************************S01319
     C***********IGINTR****IFEQ**ZERO*************************************S01319
     C*********************Z-ADD*ZERO*****I2INTS**************************S01319
     C*********************MOVE**BLANK****I2INSN**************************S01319
     C*********************END********************************************S01319
     C********************************************************************S01319
     C***********IGINTR****IFGT**ZERO*************************************S01319
     C*********************Z-ADDIGINTR****I2INTS**************************S01319
     C*********************MOVEL'+'*******I2INSN**************************S01319
     C*********************END********************************************S01319
     C********************************************************************S01319
     C***********IGAMNP****IFLT**ZERO*************************************S01319
     C*********************Z-SUBIGAMNP****@GAMNP**************************S01319
     C*********************MOVEL'-'*******I2AMSN**************************S01319
     C*********************END********************************************S01319
     C********************************************************************S01319
     C***********IGAMNP****IFEQ**ZERO*************************************S01319
     C*********************Z-ADD*ZERO*****@GAMNP**************************S01319
     C*********************MOVE**BLANK****I2AMSN**************************S01319
     C*********************END********************************************S01319
     C********************************************************************S01319
     C***********IGAMNP****IFGT**ZERO*************************************S01319
     C*********************Z-ADDIGAMNP****@GAMNP**************************S01319
     C*********************MOVEL'+'*******I2AMSN**************************S01319
     C*********************END********************************************S01319
     C********************************************************************S01319
     C********** CDP       IFEQ *ZERO                      B1             S01194
     C***********A6NBDP****IFEQ**ZERO**********************B1*******S01194S01319
     C*********************Z-ADD@GAMNP****I2AMNI************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C*********  CDP       IFEQ 1                          B1             S01194
     C***********A6NBDP****IFEQ*1**************************B1*******S01194S01319
     C*********************Z-ADD@GAMNP****@2AMN1************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C********** CDP       IFEQ 2                          B1             S01194
     C***********A6NBDP****IFEQ*2**************************B1*******S01194S01319
     C*********************Z-ADD@GAMNP****@2AMN2************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C*********  CDP       IFEQ 3                          B1             S01194
     C***********A6NBDP****IFEQ*3**************************B1*******S01194S01319
     C*********************Z-ADD@GAMNP****@2AMN3************1*************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C****SET*UP*PROCESSING*OUTSTANDING***********************************S01319
     C***********I2DPCO****IFNE*'8'************************B1*************S01319
     C***********IGLACT****ANDNE'D'*************************1*************S01319
     C********************************************************************S01319
     C***********IGDSTS****IFEQ*'I'************************B*2************S01319
     C*********************MOVEL'1'       I2DPCO           **2            E16147
     C*********************MOVEL'2'*******I2DPCO*************2******E16147S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C***********IGDSTS****IFEQ*'C'************************B*2************S01319
     C***********IGCDRP****ANDEQ*BLANK***********************2************S01319
     C*********************MOVEL'4'       I2DPCO           **2            E16147
     C*********************MOVEL'5'*******I2DPCO*************2******E16147S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C***********IGCDRP****IFEQ*'Y'************************B*2************S01319
     C*********************MOVEL'7'       I2DPCO           **2            E16147
     C*********************MOVEL'8'*******I2DPCO*************2******E16147S01319
     C*********************END*****************************E*2************S01319
     C********************************************************************S01319
     C*********************END*****************************E1*************S01319
     C********************************************************************S01319
     C***********#ZO9******ENDSR*******************************#ZO9*******S01319
     C********************************************************************S01319
     C*/EJECT*************************************************************S01319
     C****************************************************************
     C*                                                              *
     C*  SUBROUTINE: #ZP   PREPARES FIELD FOR TESTN                  *
     C*                    REMOVES TRAILING BLANKS                   *
     C*                                                              *
     C*  FIELDS USED :     @OUT   -  FIELD OUTPUT                    *
     C*                    @IP    -  INPUT INDEX                     *
     C*                    @END   -                                  *
     C*                    @STP   -  STOP FLAG                       *
     C*                    @IA    -  INPUT AMOUNT                    *
     C*                    @O     -  OUTPUT FIELD                    *
     C*                    @OP    -  OUTPUT INDEX                    *
     C*                                                              *
     C*  CALLED BY :       #ZA   UPDATE SUPPLEMENTARY STANDARD DEAL  *
     C*                                                              *
     C*  CALLS :                                                     *
     C*                                                              *
     C****************************************************************
     C           #ZP       BEGSR
     C                     MOVE *BLANKS   @OUT
     C                     Z-ADD11        @IP     20
     C                     Z-ADD10        @END    20
     C                     MOVE 'N'       @STP    1
     C           @STP      DOWNE'Y'                        B1
     C           @IP       SUB  1         @IP              *1
     C           @IA,@IP   IFNE ' '                        B*2
     C                     MOVE 'Y'       @STP             **2
     C                     END                             E*2
     C                     END                             E1
     C                     Z-ADD10        @OP     20
     C                     MOVE 'N'       @STP    1
     C           @STP      DOWNE'Y'                        B1
     C                     MOVE @IA,@IP   @O,@OP           *1
     C           @IP       SUB  1         @IP              *1
     C           @OP       SUB  1         @OP              *1
     C           @IP       IFEQ 0                          B*2
     C                     MOVE 'Y'       @STP             **2
     C                     END                             E*2
     C                     END                             E1
     C           #ZP9      ENDSR
     //EJECT
     C*****************************************************************
     C*   MM1007 - CALCULATE INTEREST                                 *
     C*                                                               *
     C*  CALLED BY    -                                               *
     C*                                                               *
     C*  CALLS        -   MM1009 CALCULATE NO. OF INTEREST DAYS       *
     C*                                                               *
     C*  FIELDS INPUT @@BEG  - START DATE OF PERIOD                   *
     C*               @@END  - END DATE OF PERIOD                     *
     C*               @@CALC - INTEREST CALCULATION METHOD            *
     C*               @@AMT  - PRINCIPAL AMOUNT  15N                  *
     C*               @@RATE - INTEREST RATE 11,7                     *
     C*                                                               *
     C*  FIELDS OUTPUT @@INTR - INTEREST 15,0                         *
     C*                                                               *
     C*  WORK FIELDS   @@W155 - 15,5
     C*                                                               *
     C*****************************************************************
     C***********MM1007****BEGSR                                          E17051
     C*********************
     C*** CALCULATE NUMBER*OF INTEREST DAYS
     C*********************EXSR MM1009                                    E17051
     C*********************
     C***********@@CALC****IFEQ '2'                        *** B 1        E17051
     C***********@@CALC****OREQ '3'                                       E17051
     C***********@@CALC****OREQ '5'                                       E17051
     C***********@@AMT*****DIV  36000     @@W155 155                      E17051
     C*********************END                             *** E 1        E17051
     C*********************
     C***********@@CALC****IFEQ '1'                        *** B 1        E17051
     C***********@@CALC****OREQ '4'                                       E17051
     C***********@@AMT*****DIV  36500     @@W155                          E17051
     C*********************END                              *** E 1       E17051
     C*********************
     C***********@@CALC****IFEQ '6'                         *** B 1       E17051
     C***********@@AMT*****DIV  36600     @@W155                          E17051
     C*********************END                              *** E 1       E17051
     C*********************
     C*********************MULT @@RATE    @@W155                          E17051
     C***********@@W155****MULT @@INDY    @@INTR 150H                     E17051
     C*********************
     C***********M10079****ENDSR                                          E17051
     C*****************************************************************
     C/EJECT                                                              E17051
     C*****************************************************************   E17051
     C****MM1030*- CALCULATE INTEREST                              E17051 S01392
     C***********  (MM1030 INCLUDES ADJUSTMENT FOR ERROR IN DIVISIOE17051 S01392
     C***********                                                  E17051 S01392
     C***CALLED*BY    -                                            E17051 S01392
     C***********                                                  E17051 S01392
     C***CALLS***     -   MM1009 CALCULATE NO. OF INTEREST DAYS    E17051 S01392
     C***********                                                  E17051 S01392
     C***FIELDS*INPUT @@BEG  - START DATE OF PERIOD                E17051 S01392
     C***********     @@END  - END DATE OF PERIOD                  E17051 S01392
     C***********     @@CALC - INTEREST CALCULATION METHOD         E17051 S01392
     C***********     @@AMT  - PRINCIPAL AMOUNT  15N               E17051 S01392
     C***********     @@RATE - INTEREST RATE 11,7                  E17051 S01392
     C***********                                                  E17051 S01392
     C***FIELDS*OUTPUT @@INTR - INTEREST 15,0                      E17051 S01392
     C***********                                                  E17051 S01392
     C***WORK*FIELDS   @@W155 - 15,5                               E17051 S01392
     C***********      @@YEAR - (NUMBER OF DAYS IN YEAR) x 100     E17051 S01392
     C***********      @@WDIV - 15,5  HOLDS RESULT OF DIVISION     E17051 S01392
     C***********      @@ERR  - 15,9  ROUNDING ERROR               E17051 S01392
     C***********      @@AMTR - 15,1  AMOUNT FROM ROUNDING ERROR   E17051 S01392
     C***********               CAN BE 15,1 SINCE IT IS NOT POSSIBLE17051 S01392
     C***********               TO INPUT 15 BYTE FIELDS IN DRS.    E17051 S01392
     C***********                                                  E17051 S01392
     C***********************************************************  E17051 S01392
     C***********MM1030    BEGSR                                   E17051 S01392
     C***********                                                  E17051 S01392
     C****CALCULATE NUMBER OF INTEREST DAYS                        E17051 S01392
     C***********          EXSR MM1009                             E17051 S01392
     C***********                                                  E17051 S01392
     C***********@@CALC    IFEQ '2'                        *** B   E17051 S01392
     C***********@@CALC    OREQ '3'                                E17051 S01392
     C***********@@CALC    OREQ '5'                                E17051 S01392
     C***********@@AMT     DIV  36000     @@WDIV 155               E17051 S01392
     C***********          Z-ADD36000     @@YEAR  50               E17051 S01392
     C***********          END                             *** E 1 E17051 S01392
     C***********                                                  E17051 S01392
     C***********@@CALC    IFEQ '1'                        *** B 1 E17051 S01392
     C***********@@CALC    OREQ '4'                                E17051 S01392
     C***********@@AMT     DIV  36500     @@WDIV                   E17051 S01392
     C***********          Z-ADD36500     @@YEAR                   E17051 S01392
     C***********          END                              *** E 1E17051 S01392
     C***********                                                  E17051 S01392
     C***********@@CALC    IFEQ '6'                         *** B 1E17051 S01392
     C***********@@AMT     DIV  36600     @@WDIV                   E17051 S01392
     C***********          Z-ADD36600     @@YEAR                   E17051 S01392
     C***********          END                              *** E  E17051 S01392
     C***********                                                  E17051 S01392
     C***********@@WDIV    MULT @@RATE    @@W155 155               E17051 S01392
     C***********                                                  E17051 S01392
     C****MULTIPLY @@WDIV BY @@YEAR TO GET ORIGINAL AMOUNT. THE R  E17051 S01392
     C****COULD*DIFFER FROM THE ORIGINAL DUE TO ROUNDING ERROR ON  E17051 S01392
     C****DIVISION.                                                E17051 S01392
     C***********@@WDIV    MULT @@YEAR    @@AMTR 151               E17051 S01392
     C***********                                                  E17051 S01392
     C****CALCULATE THE ERROR AND DO SAME ARITHMETICAL OPERATIONS AE17051 S01392
     C*** @@AMT*ABOVE.                                             E17051 S01392
     C***********@@AMT     SUB  @@AMTR    @@ERR  159               E17051 S01392
     C***********          MULT @@RATE    @@ERR                    E17051 S01392
     C***********          DIV  @@YEAR    @@ERR                    E17051 S01392
     C***********                                                  E17051 S01392
     C****ADD*RESULT FROM ERROR CALCULATIONS BACK TO THE RESULT FROE17051 S01392
     C****CALCULATIONS ON PRINCIPAL AMOUNT.                        E17051 S01392
     C***********          ADD  @@ERR     @@W155                   E17051 S01392
     C***********                                                  E17051 S01392
     C****MULTIPLY BY THE PERIOD TO OBTAIN THE INTEREST.           E17051 S01392
     C***********@@W155    MULT @@INDY    @@INTR 150H              E17051 S01392
     C***********                                                  E17051 S01392
     C***********M10309    ENDSR                                   E17051 S01392
     C*****************************************************************   S01392
     C*                                                               *   S01392
     C*   MM1030 - CALCULATE INTEREST                                 *   S01392
     C*                                                               *   S01392
      *  (c) Finastra International Limited 2001                      *
     C*  CALLED BY    -                                               *   S01392
     C*                                                               *   S01392
     C***CALLS********-***MM1009*CALCULATE*NO.*OF*INTEREST*DAYS*****S01392056095
     C*  CALLS        -   ZINTDY CALCULATE NO. OF INTEREST DAYS       *   056095
     C*                                                               *   S01392
     C***FIELDS*INPUT*@@BEG**-*START*DATE*OF*PERIOD*****************S01392056095
     C****************@@END**-*END*DATE*OF*PERIOD*******************S01392056095
     C****************@@CALC*-*INTEREST*CALCULATION*METHOD**********S01392056095
     C*  FIELDS INPUT ZZBEG  - START DATE OF PERIOD                   *   056095
     C*               ZZEND  - END DATE OF PERIOD                     *   056095
     C*               ZZCALC - INTEREST CALCULATION METHOD            *   056095
     C*               @@AMT  - PRINCIPAL AMOUNT  15N                  *   S01392
     C*               @@RATE - INTEREST RATE 11,7                     *   S01392
     C*               @@RDFC - ROUND DOWN FACILITY IND 1              *   S01392
     C*                                                               *   S01392
     C*  FIELDS OUTPUT @@INTR - INTEREST 15,0                         *   S01392
     C*                                                               *   S01392
     C*  WORK FIELDS   @@W157 - 15,5                                  *   S01392
     C*****************@@W150*-*15,0*******************************S01392 056121
     C*                @@W210 - 21,0                                  *   056121
     C*                @@YEAR - (NUMBER OF DAYS IN YEAR) x 100        *   S01392
     C*                                                               *   S01392
     C*****************************************************************   S01392
     C           MM1030    BEGSR                                          S01392
     C*                                                                   S01392
     C*   CALCULATE NUMBER OF INTEREST DAYS                               S01392
     C/COPY WNCPYSRC,MM0078C001
     C*                                                                   S01392
     C***********          EXSR MM1009                              S01392056095
     C                     EXSR ZINTDY                                    056095
     C*                                                                   S01392
     C***********@@CALC    IFEQ '2'                        *** B 1  S01392056095
     C***********@@CALC    OREQ '3'                                 S01392056095
     C***********@@CALC    OREQ '5'                                 S01392056095
     C           ZZCALC    IFEQ '2'                        *** B 1        056095
     C           ZZCALC    OREQ '3'                                       056095
     C           ZZCALC    OREQ '5'                                       056095
     C           ZZCALC    OREQ '0'                                                          CER016A
     C                     Z-ADD36000     @@YEAR  50                      S01392
     C                     END                             *** E 1        S01392
     C*                                                                   S01392
     C***********@@CALC    IFEQ '1'                        *** B 1  S01392056095
     C***********@@CALC    OREQ '4'                                 S01392056095
     C           ZZCALC    IFEQ '1'                        *** B 1        056095
     C           ZZCALC    OREQ '4'                                       056095
     C                     Z-ADD36500     @@YEAR                          S01392
     C                     END                              *** E 1       S01392
     C*                                                                   S01392
     C***********@@CALC    IFEQ '6'                         *** B 1 S01392056095
     C           ZZCALC    IFEQ '6'                         *** B 1       056095
     C                     Z-ADD36600     @@YEAR                          S01392
     C                     END                              *** E 1       S01392
     C*                                                                   S01392
     C           ZZCALC    IFEQ '6'                                       163136
     C           INT6DY    MULT @@RATE    @@W157                          163136
     C                     ELSE                                           163136
      *                                                                   163136
     C***********@@INDY    MULT @@RATE    @@W157 157                S01392056095
     C           ZZINDY    MULT @@RATE    @@W157 157                      056095
      *                                                                   163136
     C                     END                                            163136
      *                                                                   163136
     C***********@@W157    MULT @@AMT     @@W150 150H              S01392 056121
     C           @@W157    MULT @@AMT     @@W210 210H                     056121
     C*                                                                   S01392
     C**  ROUND DOWN IF ROUND DOWN INDICATOR IS 'Y'                       S01392
     C*                                                                   S01392
     C           @@RDFC    IFEQ 'Y'                                       S01392
     C***********@@W150    DIV  @@YEAR    @@INTR                   S01392 056121
     C           @@W210    DIV  @@YEAR    @@INTR                          056121
     C                     ELSE                                           S01392
     C***********@@W150    DIV  @@YEAR    @@INTR 150H              S01392 056121
     C           @@W210    DIV  @@YEAR    @@INTR 150H                     056121
     C                     END                                            S01392
     C*                                                                   S01392
     C/COPY WNCPYSRC,MM0078C002
     C           M10309    ENDSR                                          S01392
     C*****************************************************************   E17051
     C/EJECT                                                              E17051
     C*                                                                   056095
     C/COPY ZSRSRC,ZDATE9Z3                                               056095
     C*****************************************************************
      *****************************************************************
     C***********                                                     *   056095
     C********TITLE:CALCULATE MIDAS DAY NO. TO DRS (YYYYMMDD) FORMAT. *   056095
     C***********                                                     *   056095
     C********SUBROUTINE ZA0710 EXPECTS FIELD '@@DAYN' TO BE          *   056095
     C********PASSED TO IT IN 5,0 FORMAT.IF THE ABOVE FIELD IS LESS   *   056095
     C********THAN 1 IT RETURNS 1 IN FIELD '@@RTN'.THE MAIN PROGRAM   *   056095
     C********SHOULD CHECK FOR THIS CONDITION AND DO THE NECESSARY.   *   056095
     C********IF*'@@RTN' IS NOT EQUAL TO 1 IT RETURNS THE FIELD       *   056095
     C********'@@VDT'  IN 'YYYYMMDD' FORMAT.                          *   056095
     C***********                                                     *   056095
     C**NOTE:*FIELD TO BE DEFINED BY EXTERNAL ROUTINE IS                  056095
     C***********                                                     *   056095
     C********1)*@@DAYN   LENGTH 5,0.                                 *   056095
     C***********                                                     *   056095
     C********FIELDS USED AND ALREADY DEFINED IN THE ROUTINE ARE:     *   056095
     C***********                                                     *   056095
     C********1)*@@VDT    LENGTH 8,0 DEFINED BY A DS.                 *   056095
     C********2)*@@RTN    LENGTH 1,0.                                 *   056095
     C********3)*@@I      LENGTH 2,0 USED TO ACCESS ARRAY @YD         *   056095
     C********4)*@@J      LENGTH 2,0 USED TO ACCESS ARRAY @MD         *   056095
     C********5)*@@Z71Y   LENGTH 4,0 DEFINED BY A DS.                 *   056095
     C********6)*@@RDAY   LENGTH 5,0.                                 *   056095
     C********7)*@@LEAP   LENGTH 1,0.                                     056095
     C***********                                                     *   056095
     C********INDICATORS USED ARE:                                    *   056095
     C***********                                                     *   056095
     C********1)*80       CHECK FOR LOW AND EQUAL ON ARRAY @YD        *   056095
     C********2)*81       CHECK FOR LOW ON ARRAY @MD.                 *   056095
     C***********                                                     *   056095
     C**INPUT*FIELD:       @@DAYN                                     *   056095
     C***********                                                     *   056095
     C**OUTPUT*FIELD:      @@VDT                                      *   056095
     C***********                                                     *   056095
     C**WORK*FIELDS:       @@RTN                                      *   056095
     C***********          @@Z71Y                                     *   056095
     C***********          @@RDAY                                     *   056095
     C***********          @@LEAP                                     *   056095
     C***********          @@I                                        *   056095
     C***********          @@J                                        *   056095
     C***********                                                     *   056095
     C**ARRAYS*USED:       @YD COMPIGE TIME ARRAY.                        056095
     C***********          @MD COMPIGE TIME ARRAY.                        056095
     C***********                                                         056095
     C*****************************************************************   056095
     C***********                                                         056095
     C***********ZA0710    BEGSR                                          056095
     C***********                                                         056095
     C***********          SETOF                     8081                 056095
     C***********          Z-ADD0         @@RTN   10                      056095
     C***********          Z-ADD0         @@VDT                           056095
     C***********          Z-ADD1         @@I     20                      056095
     C***********          Z-ADD1         @@J     20                      056095
     C***********          Z-ADD1         @@LEAP  10                      056095
     C***********                                                         056095
     C***********@@DAYN    CABEQ0         ZA0719                    ME1257056095
     C***********                                                         056095
     C***********@@DAYN    IFLT 1                                         056095
     C***********          Z-ADD1         @@RTN                           056095
     C***********          GOTO ZA0719                                    056095
     C***********          END                                            056095
     C***********                                                         056095
     C**DIVISION*TO DETERMINE WETHER LEAP YEAR.                           056095
     C***********                                                         056095
     C***********@@DAYN    DIV  1461      @@Z71Y                          056095
     C***********          MVR            @@RDAY  50                      056095
     C***********                                                         056095
     C**CALCULATING YEAR.                                                 056095
     C***********                                                         056095
     C***********@@Z71Y    MULT 4         @@Z71Y                          056095
     C***********          ADD  1972      @@Z71Y                          056095
     C***********                                                         056095
     C**CHECKING*IF YEAR IS GREATER THAN OR EQUAL TO 2100                 056095
     C***********                                                         056095
     C***********@@Z71Y    IFGE 2100                                      056095
     C***********          ADD  @@SSY2    @@RDAY                          056095
     C***********          END                                            056095
     C***********                                                         056095
     C**LOKUP*ARRAY @YD TO SEE HOW MANY YEARS OF A FOUR YEAR CYCLE        056095
     C**HAVE*PASSED.                                                      056095
     C***********                                                         056095
     C***********@@RDAY    LOKUP@YD,@@I                8080               056095
     C***********                                                         056095
     C**IF*YEAR*IS A LEAP YEAR SSLEAP IS SET TO ZERO.                     056095
     C***********                                                         056095
     C************IN80     IFEQ '0'                                       056095
     C***********          Z-ADD0         @@LEAP                          056095
     C***********          END                                            056095
     C***********                                                         056095
     C**ADD*INDEX TO YEAR TO GIVE CORRECT YEAR AND ADJUST '@@RDAY'.       056095
     C***********                                                         056095
     C***********@@LEAP    IFEQ 1                                         056095
     C***********@@RDAY    SUB  @YD,@@I   @@RDAY                          056095
     C***********          ADD  @@I       @@Z71Y                          056095
     C***********          END                                            056095
     C***********                                                         056095
     C**PROCESSING FOR A LEAP YEAR.                                       056095
     C***********                                                         056095
     C***********@@LEAP    IFEQ 0                                         056095
     C***********                                                         056095
     C**IF*'@@RDAY' = 60 DATE MUST BE 29TH OF FEBRUARY.                   056095
     C***********                                                         056095
     C***********@@RDAY    IFEQ 60                                        056095
     C***********          Z-ADD29        @@Z71D                          056095
     C***********          Z-ADD2         @@Z71M                          056095
     C***********          GOTO ZA0711                                    056095
     C***********          END                                            056095
     C***********                                                         056095
     C**IF*'@@RDAY' > 60 DATE IS AFTER 29TH OF FEBRUARY,CONVERSION CAN    056095
     C**PROCEED*AS USUAL AFTER SUBTRACTING THE EXTRA DAY FOR THE LEAP     056095
     C**YEAR.*NOTE : '@@RDAY' < 60 CONVERSION PROCEEDS AS USUAL.          056095
     C***********                                                         056095
     C***********@@RDAY    IFGT 60                                        056095
     C***********@@RDAY    SUB  1         @@RDAY                          056095
     C***********          END                                            056095
     C***********                                                         056095
     C***********          END                                            056095
     C***********                                                         056095
     C**IF*DAY*'@@DAYN' IS EXACTLY DIVISIBLE BY 1461 (NUMBER OF DAYS      056095
     C**IN*4*YEARS) THEN DATE MUST BE LAST DAY OF PREVIOUS FOUR YEAR      056095
     C**GROUP.***                                                         056095
     C***********                                                         056095
     C***********@@RDAY    IFEQ 0                                         056095
     C***********          Z-ADD31        @@Z71D                          056095
     C***********          Z-ADD12        @@Z71M                          056095
     C***********          SUB  1         @@Z71Y                          056095
     C***********          GOTO ZA0711                                    056095
     C***********          END                                            056095
     C***********                                                         056095
     C**LOOK*UP*ARRAY ARRAY @MD TO DETERMINE WHICH MONTH '@@RDAY'         056095
     C**OCCURS*IN                                                         056095
     C***********                                                         056095
     C***********@@RDAY    LOKUP@MD,@@J                81                 056095
     C***********          Z-ADD@@J       @@Z71M                          056095
     C***********@@RDAY    SUB  @MD,@@J   @@Z71D                          056095
     C***********                                                         056095
     C**DS*@@VDT* IS RETURNED IN YYYYMMDD FORMAT                          056095
     C***********                                                         056095
     C***********ZA0711    TAG                                            056095
     C***********                                                         056095
     C***********          MOVE @@Z71Y    @@YR                            056095
     C***********                                                         056095
     C***********ZA0719    ENDSR                                          056095
     C/EJECT                                                              056095
     C*                                                                   056095
     C/COPY ZSRSRC,ZDAT10Z2                                               056095
     C*******************************************************************
     C***********                                                         056095
     C**ZA0680*-*THIS SUBROUTINE CONVERTS YYYYMMDD FORMAT DATE TO         056095
     C***********MIDAS DAY NUMBER FORMAT (NO. DAYS FROM 31/12/71)         056095
     C***********                                                         056095
     C**CALLED*BY :                                                       056095
     C***********                                                         056095
     C**CALLS*:**                                                         056095
     C***********                                                         056095
     C**INPUT**:*@@DTIN DATE (YYYYMMDD) - IN DATA STRUCTURE (SIZE : 8N)   056095
     C***********                                                         056095
     C**OUTPUT*:*@@MDNO MIDAS DAY NUMBER  (SIZE : 5N)                     056095
     C***********                                                         056095
     C**USES*:***@@CC   NUMBER OF CENTURIES IN DATE                       056095
     C***********@@DAY  DAY NUMBER                                        056095
     C***********@@REM  REMAINDER FROM DIVIDE                             056095
     C***********@@MTH  MONTH NUMBER                                      056095
     C***********@MD    COMPIGATION TIME ARRAY FOR CUMULATIVE DAYS IN     056095
     C***********       MONTH                                             056095
     C***********@@WK2  WORK FIELD (2,0)                                  056095
     C***********@@WK5  WORK FIELD (5,0)                                  056095
     C***********@@YYYY YEAR (4 CHARACTER)                                056095
     C***********@@YY   YEAR (2 CHARACTER)                                056095
     C***********@YD    COMPILATION TIME ARRAY FOR CUMULATIVE DAYS IN     056095
     C***********       A FOUR YEAR PERIOD                                056095
     C***********                                                         056095
     C******************************************************************* 056095
     C***********                                                         056095
     C***********ZA0680    BEGSR                                          056095
     C***********                                                         056095
     C****CLEAR*OUT ANY 'OLD' DATA IN FIELD                               056095
     C***********          Z-ADD0         @@MDNO  50                      056095
     C***********                                                         056095
     C***********@@DTIN    CABEQ0         ZA0689                    ME1257056095
     C***********                                                         056095
     C*****IF*DATE GREATER THAN 31/12/2071 NEED EXTRA PROCESSING          056095
     C*****WORK*OUT THE NUMBER OF CENTURIES PASSED SINCE 1971,            056095
     C*****BY*SUBTRACTING 1972 FROM THE YEAR FIELD.                       056095
     C***********@@YYYY    IFGE 2072                       B1             056095
     C***********@@YYYY    SUB  1972      @@YYYY           *1             056095
     C***********                                                         056095
     C*****MULTIPLY BY NUMBER OF DAYS IN CENTURY (SINCE 1971)             056095
     C*****THEN*RESTORE THE YEAR WHICH WAS INPUT BACK TO THE              056095
     C*****ORIGINAL VALUE BEFORE CONTINUING WITH NORMAL CALCULATIONS.     056095
     C***********                                                         056095
     C***********@@CC      MULT 36524     @@MDNO           *1             056095
     C***********@@YYYY    ADD  1972      @@YYYY           *1             056095
     C***********          END                             E1             056095
     C***********                                                         056095
     C***********@@YYYY    ADD  28        @@WK2   20                      056095
     C***********                                                         056095
     C***********@@WK2     DIV  4         @@WK2                           056095
     C***********          MVR            @@REM   10                      056095
     C***********                                                         056095
     C******MULTIPLY BY NUMBER OF DAYS IN FOUR YEAR PERIOD                056095
     C***********@@WK2     MULT 1461      @@WK5   50                      056095
     C***********          ADD  @@WK5     @@MDNO                          056095
     C***********                                                         056095
     C****CHECK*REMAINDER AND MONTH NUMBER                                056095
     C***********@@REM     IFEQ 0                          B1             056095
     C***********@@MTH     ANDGT2                          B1             056095
     C***********          ADD  1         @@MDNO           *1             056095
     C***********          END                             E1             056095
     C***********                                                         056095
     C****YEAR*NOT LEAP YEAR,  ADD CUMULATIVE DAYS FOR YEAR               056095
     C***********@@REM     IFNE 0                          B1             056095
     C***********          ADD  @YD,@@REM @@MDNO           *1             056095
     C***********          END                             E1             056095
     C***********                                                         056095
     C****ADD*MONTHS THIS YEAR                                            056095
     C***********          ADD  @MD,@@MTH @@MDNO                          056095
     C***********                                                         056095
     C****ADD*DAYS THIS MONTH                                             056095
     C***********          ADD  @@DAY     @@MDNO                          056095
     C***********                                                         056095
     C***********ZA0689    ENDSR                           **ZA0689 TAG** 056095
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*   MM1010 - CALCULATION OF INTEREST AT MATURITY                *
     C*                                                               *
     C*  FILES EXPECTED  -  FXTB40LL                                  *
     C*  FILES PROCESSED -  MMDEAMLL  DEAL AMENDMENTS FILE            *
     C*                  -  SDCBRTL1  BRT CUSTOMER DETAILS FILE       *   S01383
     C*                                                               *
     C*  CALLED BY    -                                               *
     C*                                                               *
     C***CALLS********-* MM1007, CALCULATE INTEREST.                  *   E17051
     C*  CALLS        -  MM1030, CALCULATE INTEREST.                  *   E17051
     C*               -  MM1004, DETERMINE DATE OF NEXT PAYMENT.      *
     C****************-**ZA0680,*DATE*CONVERSION*PROGRAM***************   056095
     C****************-**ZA0710,*DATE*CONVERSION*PROGRAM***************   056095
     C*               -  ZDAT10, DATE CONVERSION PROGRAM              *   056095
     C*               -  ZDATE9, DATE CONVERSION PROGRAM              *   056095
     C*                                                               *
     C*  FIELDS INPUT @@TINT - TOTAL INTEREST                         *
     C*               @@INTD - INTEREST TO DATE                       *
     C*               @@INFQ - INTEREST PAYMENT FREQUENCY             *
     C*               @@NXIP - NEXT INTEREST PAYMENT DATE             *
     C*               @@VDAT - VALUE DATE                             *
     C*               @@INCM - INTEREST CALCULATION METHOD            *
     C*               @@DLAM - DEAL AMOUNT                            *
     C*               @@EIRT - EFFECTIVE INTEREST RATE                *
     C*               @@MTXI - TAXABLE INDICATOR                      *
     C*               @@DEAL - DEAL NUMBER   6N                       *
     C*               @@CCY  - DEAL CURRENCY 3A                       *
     C*               @@BRMD - MATURITY DATE FOR BRT CALCULATION      *   S01383
     C*               @BRTRT - BRT TAX RATE FROM LF/SDBRTDL1          *   S01383
     C*               @BTAXR - @BRTRT MULT. BY 1 OR 0.5               *   S01383
     C*                                                               *
     C*  FIELD OUTPUT @@INMT - INTEREST AT MATURITY                   *
     C*                                                               *
     C*  WORKFIELDS   @O     - ARRAY FIELD HOLDING FORMATTED AMOUNT   *
     C*               @@A    - INDEX FIELD FOR REFERENCING @O         *
     C*                                                               *
     C*****************************************************************
     C           MM1010    BEGSR
     C*
     C*   CODE TO READ TABLE FILE IF NOT ALREADY READ
     C*
     C*          KEY       IFNE @@KEY                      *** B 1
     C*          @@KEY     CHAINFXTB40LL             90
     C*                    END                             *** E 1
     C*
     C*   INITIALISE FIELDS
     C*************        MOVEL'01'      @@KEY  12                       S01194
     C*************        MOVE '40'      @@KEY                           S01194
     C                     Z-ADD*ZEROS    @@NPDT  50
     C                     Z-ADD@@DEAL    @@DEAL  60
     C*
     C*   CALCULATE TAX AMOUNT
     C*   (ZERO IF TAX INDICATOR IS NOT 'Y')                              S01383
      *                                                                                       CDL013
      *** if CAR CDL013 is installed.                                                         CDL013
     C           CDL013    IFEQ '1'                                                           CDL013
      *                                                                                       CDL013
      *** if Tax indicator is ZERO set WHT rate to ZERO.                                      CDL013
     C           @@MTXI    IFEQ '0'                                                           CDL013
     C                     Z-ADD0         ULWHTR  52                                          CDL013
     C                     ELSE                                                               CDL013
      *                                                                                       CDL013
      *** otherwise Access WHT ICD record to determine WHT rate.                              CDL013
     C                     MOVEL*BLANKS   ULSTAX 10                                           CDL013
     C                     MOVEL'RETAIL'  ULSTAX                                              CDL013
     C           ULSTAX    CHAINSDSTAAL1             88                                       CDL013
      *                                                                                       CDL013
     C           *IN88     IFEQ '1'                                                           CDL013
     C                     MOVEL'SDSTAAL1'DBFILE           ***************                    CDL013
     C                     MOVELULSTAX    DBKEY            * DBERR0R 016 *                    CDL013
     C                     MOVE '016'     DBASE            ***************                    CDL013
     C                     MOVEL'MM0078'  DBPGM                                               CDL013
     C                     EXSR #Z                                                            CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
      *** Set WHT rate.                                                                       CDL013
     C                     SELEC                                                              CDL013
     C           @@MTXI    WHEQ '1'                                                           CDL013
     C                     Z-ADDETXR1     ULWHTR                                              CDL013
     C           @@MTXI    WHEQ '2'                                                           CDL013
     C                     Z-ADDETXR2     ULWHTR                                              CDL013
     C           @@MTXI    WHEQ '3'                                                           CDL013
     C                     Z-ADDETXR3     ULWHTR                                              CDL013
     C           @@MTXI    WHEQ '4'                                                           CDL013
     C                     Z-ADDETXR4     ULWHTR                                              CDL013
     C           @@MTXI    WHEQ '5'                                                           CDL013
     C                     Z-ADDETXR5     ULWHTR                                              CDL013
     C           @@MTXI    WHEQ '6'                                                           CDL013
     C                     Z-ADDETXR6     ULWHTR                                              CDL013
     C           @@MTXI    WHEQ '7'                                                           CDL013
     C                     Z-ADDETXR7     ULWHTR                                              CDL013
     C           @@MTXI    WHEQ '8'                                                           CDL013
     C                     Z-ADDETXR8     ULWHTR                                              CDL013
     C           @@MTXI    WHEQ '9'                                                           CDL013
     C                     Z-ADDETXR9     ULWHTR                                              CDL013
     C                     ENDSL                                                              CDL013
      *                                                                                       CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
      *** If WHT rate is ZERO set tax amount to ZERO.                                         CDL013
     C           ULWHTR    IFEQ *ZERO                                                         CDL013
     C                     Z-ADD0         @@TXAM                                              CDL013
      *                                                                                       CDL013
      *** otherwise calculate tax amount.                                                     CDL013
     C                     ELSE                                                               CDL013
      *                                                                                       CDL013
      *** if Deal Ccy is equal to Base Ccy round down Interest Amount.                        CDL013
      ** and CDL081 is off                                                                    CDL081
      *                                                                                       CDL081
     C           @CCY      IFEQ BJCYCD                                                        CDL013
     C           CDL081    ANDEQ'N'                                                           CDL081
      *                                                                                       CDL013
      *** set work adjustment field according to decimal places.                              CDL013
     C                     SELEC                                                              CDL013
     C           A6NBDP    WHEQ 1                                                             CDL013
     C                     Z-ADD10        ULWKAD  40                                          CDL013
     C           A6NBDP    WHEQ 2                                                             CDL013
     C                     Z-ADD100       ULWKAD                                              CDL013
     C           A6NBDP    WHEQ 3                                                             CDL013
     C                     Z-ADD1000      ULWKAD                                              CDL013
     C           A6NBDP    WHEQ 0                                                             CDL013
     C                     Z-ADD1         ULWKAD                                              CDL013
     C                     ENDSL                                                              CDL013
      *                                                                                       CDL013
      *** round down Interest Amount.                                                         CDL013
     C           @@TINT    DIV  ULWKAD    ULTINT 150                                          CDL013
     C                     MULT ULWKAD    ULTINT                                              CDL013
      *                                                                                       CDL013
      *** calculate and then round down Tax Amount.                                           CDL013
     C           ULTINT    MULT ULWHTR    @@TXAM                                              CDL013
     C                     DIV  100       @@TXAM                                              CDL013
     C           @@TXAM    DIV  ULWKAD    ULTXAM 150                                          CDL013
     C           ULTXAM    MULT ULWKAD    @@TXAM                                              CDL013
      *                                                                                       CDL013
      *** otherwise (Deal Ccy NOT = Base Ccy) calculate Tax amount                            CDL013
      *** without rounding down.                                                              CDL013
     C                     ELSE                                                               CDL013
     C           @@TINT    MULT ULWHTR    @@TXAM                                              CDL013
      *                                                                                       CDL081
      ** Check if tax amount is to be rounded down                                            CDL081
      *                                                                                       CDL081
     C           @CCY      IFEQ BJCYCD                                                        CDL081
     C           CDL081    ANDEQ'Y'                                                           CDL081
     C           W#BSRD    ANDEQ'Y'                                                           CDL081
     C           @CCY      ORNE BJCYCD                                                        CDL081
     C           CDL081    ANDEQ'Y'                                                           CDL081
     C           W#NBRD    ANDEQ'Y'                                                           CDL081
     C                     DIV  100       @@TXAM                                              CDL081
     C                     ELSE                                                               CDL081
     C                     DIV  100       @@TXAM    H                                         CDL013
     C                     ENDIF                                                              CDL081
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
      *** otherwise perform Original Tax calculations.                                        CDL013
     C                     ELSE                                                               CDL013
      *                                                                                       CDL013
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0078CP10                                           S01408
     C*                                                                   S01408
     C*                                                                   S01383
     C           @@MTXI    IFEQ *BLANKS                    *** B 1
     C           @@MTXI    OREQ 'X'                                       S01383
     C           @@MTXI    OREQ 'N'                                       S01383
     C                     Z-ADD*ZEROS    @@TXAM 155
     C                     ELSE                            *** X
      *                    ****
     C                     Z-ADD*ZEROS    @@TXAM                          S01383
     C/COPY WNCPYSRC,MM0078C017
     C*                                                                   S01383
     C** IF BRT SAR INSTALLED                                             S01383
     C*                                                                   S01383
     C           S01383    IFEQ 'Y'                        *** B 2        S01383
     C*                                                                   S01383
     C           @@BRMD    IFGT 0                          *** B 3        S01383
     C*                                                                   S01383
     C           @@BRMD    IFGE DEFF                       *** B 4        S01383
     C                     Z-ADDBRTR      @BRTRT  75                      S01383
     C                     ELSE                                           S01383
     C                     Z-ADDPBRTR     @BRTRT                          S01383
     C                     END                             *** E 4        S01383
     C*                                                                   S01383
     C** ACCESS SDCBRTL1 FOR DEAL CUSTOMER'S BRT TAX INDICATOR (TAXIND)   S01383
     C** if *in61 is on, then it is a data base error                     S01383
     C*                                                                   S01383
     C           IKCNUM    CHAINSDCBRTL1             61                   S01383
     C*                                                                   S01383
     C           *IN61     IFEQ '1'                        *** B 4        S01383
     C           XRECI     ORNE 'D'                        ***************S01383
     C                     MOVEL'SDCBRTPD'DBFILE           * DBERROR 040 *S01383
     C                     MOVEL'040'     DBASE            ***************S01383
     C                     MOVELIKCNUM    DBKEY                           S01383
     C                     EXSR #Z                                        S01383
     C                     END                             *** E 4        S01383
     C*                                                                   S01383
     C           TAXIND    IFEQ 'L'                        *** B 4        S01383
     C           TAXIND    OREQ 'P'                                       S01383
     C*                                                                   S01383
     C** TAX RATE FOR PART-LIABLE CUSTOMERS IS HALF THE BASIC RATE.       S01383
     C*                                                                   S01383
     C           TAXIND    IFEQ 'L'                        *** B 5        S01383
     C                     Z-ADD@BRTRT    @BTAXR  86                      S01383
     C                     ELSE                                X 5        S01383
     C           0.5       MULT @BRTRT    @BTAXR                          S01383
     C                     END                             *** E 5        S01383
     C/COPY WNCPYSRC,MM0078C018
     C*                                                                   S01383
     C           @@TINT    MULT @BTAXR    @@TXAM                          S01383
     C/COPY WNCPYSRC,MM0078C019
     C           @@TXAM    DIV  100       @@TXAM                          S01383
     C                     END                             *** E 4        S01383
     C*                                                                   S01383
     C                     END                             *** E 3        S01383
     C*                                                                   S01383
     C** ELSE BRT SAR NOT INSTALLED                                       S01383
     C*                                                                   S01383
     C                     ELSE                            *** X 2        S01383
     C********** @@TINT    MULT TAXR      @@TXAM                          S01194
     C/COPY WNCPYSRC,MM0078C020
     C           @@TINT    MULT BNHKTR    @@TXAM                          S01194
     C/COPY WNCPYSRC,MM0078C021
     C           @@TXAM    DIV  100       @@TXAM
     C                     END                             *** E 2        S01383
     C                     END                             *** E 1
     C/COPY WNCPYSRC,MMH00191
      *                                                                                       CDL013
     C                     ENDIF                                                              CDL013
      *                                                                                       CDL013
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0078CP11                                           S01408
     C*                                                                   S01408
     C*
     C*  FIND INTEREST AT MATURITY - NO INTERIM PAYMENTS
     C*
     C           @@NXIP    IFEQ *ZEROS                     *** B 1
     C           FXKEY     KLIST
     C                     KFLD           @@DEAL
      *  CHECK THERE ARE NO DEAL AMENDMENTS
     C           @@DEAL    CHAINMMDEAMLL             90
     C           *IN90     IFEQ '1'
     C           @@TINT    SUB  @@INTD    @@INMT 150        *** B 2
     C                     SUB  @@TXAM    @@INMT
     C                     GOTO M10109                      ---------->
     C                     END                              *** E 2
      *
     C                     END                              *** E 1
      *
      *  CHECK THERE ARE NO DEAL AMENDMENTS
     C           @@DEAL    CHAINMMDEAMLL             90
      *  IF THERE ARE GET THE LATEST
     C           *IN90     IFEQ '0'                         *** B 1
     C           @@EOF     DOUEQ'Y'                         *** B 2
     C           @@DEAL    READEMMDEAMLL               9090
     C           *IN90     IFEQ '1'
     C                     MOVE 'Y'       @@EOF   1
     C                     END                              *** E 3
     C                     END                              *** E 2
      *REFORMAT DATE FROM YYYMMDD TO MIDAS FORM
     C** REFORMAT DEAM VALUE DATE                                         E12306
     C*********            Z-ADD@@NXIP    @@DTIN                          E12306
     C*                                                                   E12306
     C** MOVE VALUE DATE TO DATA STRUCTURE FIELDS                         E12306
     C                     Z-ADDHNVDYY    @NVDYY                          E12306
     C                     Z-ADDHNVDMM    @NVDMM                          E12306
     C                     Z-ADDHNVDDD    @NVDDD                          E12306
     C***********          Z-ADDHNDATE    @@DTIN                    E12306056095
     C***********          EXSR ZA0680                                    056095
     C                     Z-ADDHNDATE    ZZDTIN                          056095
     C                     EXSR ZDAT10                                    056095
      *   STORE DATE
     C***********          Z-ADD@@MDNO    @@ENDD  50                      056095
     C                     Z-ADDZZMDNO    @@ENDD  50                      056095
     C                     ELSE                            *** X
      *  IF NO AMENDMENTS  ****
      *  DETERMINE END DATE
      *
     C           @@NXIP    IFNE *ZEROS                     *** B 2
     C           @@INFQ    IFEQ *BLANKS                    *** B 3
     C*   LOAD FIELD
     C*********************Z-ADD@@NXIP    @@ENDD                          S01392
     C***********          Z-ADD@@NXIP    @@DTIN                    S01392056095
     C***********          EXSR ZA0680                              S01392056095
     C***********          Z-ADD@@MDNO    @@ENDD                    S01392056095
     C                     Z-ADD@@NXIP    ZZDTIN                          056095
     C                     EXSR ZDAT10                                    056095
     C                     Z-ADDZZMDNO    @@ENDD                          056095
     C                     ELSE                            *** X
     C*                    ****
     C                     Z-ADD@@NXIP    @@DAYN
     C***********          EXSR ZA0710                                    056095
     C                     EXSR ZDATE9                                    056095
      *  LOAD INPUT PARAMETER
     C                     Z-ADD@@VDT     @@STRT  80
     C                     MOVE @@INFQ    @@FREQ  1
     C*  CALL COMMON ROUTINE
     C                     EXSR MM1004
     C*  LOAD RETURNED PARAMETER - AND REFORMAT
     C***********          Z-ADD@@NDAT    @@DTIN                          056095
     C***********          EXSR ZA0680                                    056095
     C***********          Z-ADD@@MDNO    @@ENDD                          056095
     C                     Z-ADD@@NDAT    ZZDTIN                          056095
     C                     EXSR ZDAT10                                    056095
     C                     Z-ADDZZMDNO    @@ENDD                          056095
      *
     C                     END                             *** E 3
     C                     ELSE                            *** X 2        S01392
     C*                                                                   S01392
     C* IF FIRST & LAST DAY INTEREST, CALCULATE TO MATURITY DATE + 1      S01392
     C*                                                                   S01392
     C           IKFLID    IFEQ 'Y'                                       S01392
     C           IKMATD    ADD  1         @@ENDD                          S01392
     C                     ELSE                                           S01392
     C                     Z-ADDIKMATD    @@ENDD                          S01392
     C                     END                                            S01392
     C                     END                             *** E 2
     C                     END                             *** E 1
      *
      *   CALCULATE INTEREST THAT WIGL BE PAID PRIOR TO MATURITY
      *
      *   LOAD PARAMETERS
      *   ===============
      *
     C***********          Z-ADD@@VDAT    @@BEG                           056095
     C***********          Z-ADD@@ENDD    @@END                           056095
     C***********          MOVE @@INCM    @@CALC                          056095
     C                     Z-ADD@@VDAT    ZZBEG                           056095
     C                     Z-ADD@@ENDD    ZZEND                           056095
     C                     MOVE @@INCM    ZZCALC                          056095
     C                     Z-ADD@@DLAM    @@AMT  150
     C                     Z-ADD@@EIRT    @@RATE 117
     C*
     C*   CALL COMMON ROUTINE
     C*********************EXSR MM1007                                    E17051
     C/COPY WNCPYSRC,MM0078C025
     C                     EXSR MM1030                                    E17051
     C/COPY WNCPYSRC,MM0078C026
     C*
     C*   CALCULATE INTEREST AT MATURITY
     C**  ASSUME BRT TAX RATE SAME AT PRIOR PAYMENT AS AT MATURITY        S01383
     C*
     C           @@TINT    SUB  @@INTR    @@INMT
     C           @@INMT    SUB  @@TXAM    @@INMT
      *
     C           M10109    ENDSR
     C/EJECT
     C*                                                                   056095
     C/COPY ZSRSRC,ZINTDYZ2                                               056095
     C*****************************************************************
     C****MM1009*- CALCULATE THE NUMBER OF INTEREST DAYS              *   056095
     C***********                                                     *   056095
     C***CALLED*BY    -                                               *   056095
     C***********                                                     *   056095
     C***CALLS***     -   ZA0710 CONVERT MIDAS DAY NUMBER TO YMD DATE *   056095
     C***********                                                     *   056095
     C***FIELDS*INPUT @@BEG  - START DATE OF PERIOD                   *   056095
     C***********     @@END  - END DATE OF PERIOD                     *   056095
     C***********     @@CALC - INTEREST CALCULATION METHOD            *   056095
     C***********                                                     *   056095
     C***FIELDS*OUTPUT @@INDY - NO. OF INTEREST DAYS                  *   056095
     C***********                                                     *   056095
     C***WORKFIELDS   @@WN5   - WORK FIELD 5N                         *   056095
     C***********     @@WN5A  - WORK FIELD 5N                         *   056095
     C***********     @@WDAT  - WORK FIELD 5N                         *   056095
     C***********     @@DAYN  - WORK FIELD 5N                         *   056095
     C***********     @@P1    - WORK FIELD 5N                         *   056095
     C***********     @@P2    - WORK FIELD 5N                         *   056095
     C***********     @@P3    - WORK FIELD 5N                         *   056095
     C***********     @@LPNM  - WORKFIELD USED IN SETTING UP @@TG10   *   056095
     C***********                                                     *   056095
     C*****************************************************************   056095
     C***********MM1009    BEGSR                                          056095
     C***********                                                         056095
     C***********          MOVE @@BEG     @@BEG   50                      056095
     C***********          MOVE @@END     @@END   50                      056095
     C***********          MOVE @@CALC    @@CALC  1                       056095
     C***********          Z-ADD*ZEROS    @@INDY                          056095
     C***********          Z-ADD*ZEROS    @@LPNM                          056095
     C***********                                                         056095
     C***FIND*NUMBER OF DAYS DIFFERENCE BETWEEN DATES                     056095
     C***********                                                         056095
     C***********@@END     SUB  @@BEG     @@WDAT  50                      056095
     C***********                                                         056095
     C*****FOR*CALCULATION METHODS 3,4 OR 5.                              056095
     C***********                                                         056095
     C***********@@CALC    IFEQ '3'                        **** B 1       056095
     C***********@@CALC    OREQ '4'                                       056095
     C***********@@CALC    OREQ '5'                                       056095
     C***********                                                         056095
     C***********          Z-ADD@@BEG     @@DAYN  50                      056095
     C***********          EXSR ZA0710                                    056095
     C***********          Z-ADD@@VDT     @@DATA                          056095
     C***********                                                         056095
     C***********          Z-ADD@@END     @@DAYN                          056095
     C***********          EXSR ZA0710                                    056095
     C***********          Z-ADD@@VDT     @@DATB                          056095
     C***IF*IN*SAME MONTH                                                 056095
     C***********@@YY1     IFEQ @@YY2                      **** B 2       056095
     C***********@@MM1     IFEQ @@MM2                      **** B 3       056095
     C***********@@DD2     SUB  @@DD1     @@INDY                          056095
     C***********          GOTO M10099                     --------->     056095
     C***********          END                             **** E 3       056095
     C***********          END                             **** E 2       056095
     C***********                                                         056095
     C***********          ELSE                            **** X         056095
     C**IF*NOT*3,4 OR 5    ****                                           056095
     C**EXIT*PROCESSING                                                   056095
     C***********          Z-ADD@@WDAT    @@INDY  50       - LOAD OUTPT   056095
     C***********          GOTO M10099                     ----------->   056095
     C***********          END                             **** E 1       056095
     C***********                                                         056095
     C***********@@CALC    IFEQ '3'                        **** B 1       056095
     C***CALC*NO. DAYS IN FIRST MONTH                                     056095
     C***********@@MM1     IFNE 2                          **** B 2       056095
     C***********30        SUB  @@DD1     @@P1    50   80                 056095
     C***IF*<*0,*INITIALISE TO 0                                          056095
     C***80******          Z-ADD*ZEROS    @@P1                            056095
     C***********                                                         056095
     C***********          ELSE                            **** X         056095
     C***TEST*IF*LEAP      ****                                           056095
     C***YEAR****                                                         056095
     C***********@@YY1     DIV  4         @@WN5                           056095
     C***********          MVR            @@WN5          80               056095
     C***********                                                         056095
     C************IN80     IFEQ '1'                        **** B 3       056095
     C***********29        SUB  @@DD1     @@P1    50                      056095
     C***********          ELSE                                           056095
     C***IF*NOT*LEAP       ++++                                           056095
     C***********28        SUB  @@DD1     @@P1    50                      056095
     C***********          END                             **** E 3       056095
     C***********          END                             **** E 2       056095
     C***CALC.*NO. DAYS IN LAST MONTH                                     056095
     C***********@@DD2     IFLE 30                         **** B 2       056095
     C***********          Z-ADD@@DD2     @@P2    50                      056095
     C***********          ELSE                            **** X         056095
     C***********          ****                                           056095
     C***********          Z-ADD30        @@P2                            056095
     C***********          END                             **** E 2       056095
     C***CALC*NO. DAYS IN INTERVENING MONTHS                              056095
     C***********@@YY2     IFEQ @@YY1                      **** B 2       056095
     C***********@@MM2     SUB  @@MM1     @@P3    50                      056095
     C***********          SUB  1         @@P3                            056095
     C***********          MULT 30        @@P3                            056095
     C***********          ELSE                            **** X         056095
     C***********          ****                                           056095
     C***********@@YY2     SUB  @@YY1     @@P3                            056095
     C***********          SUB  1         @@P3                            056095
     C***********          MULT 360       @@P3                            056095
     C***********                                                         056095
     C**FIND*NO.*OF MONTHS FOR THE TWO PARTIAL YEARS                      056095
     C***********12        SUB  @@MM1     @@WN5A  50                      056095
     C***********          MULT 30        @@WN5A                          056095
     C***********                                                         056095
     C***********@@MM2     SUB  1         @@WN5                           056095
     C***********@@WN5     MULT 30        @@WN5                           056095
     C***ACCUMULATE                                                       056095
     C***********@@WN5A    ADD  @@WN5     @@WN5A                          056095
     C***********@@P3      ADD  @@WN5A    @@P3                            056095
     C***********          END                             **** E 2       056095
     C***FINAL*SUM                                                        056095
     C***********                                                         056095
     C***********@@P1      ADD  @@P2      @@INDY                          056095
     C***********          ADD  @@P3      @@INDY                          056095
     C***********          END                             **** E 1       056095
     C***FOR*METHODS 4 AND 5                                              056095
     C***********                                                         056095
     C***********@@CALC    IFEQ '4'                        **** B 1       056095
     C***********@@CALC    OREQ '5'                                       056095
     C****CALCULATE NUMBER OF LEAP YEARS BETWEEN START AND END DATES      056095
     C***********@@MM1     IFLE 2                          **** B 2       056095
     C***********@@YY1     DIV  4         @@WN5   50                   YR 056095
     C***********          MVR            @@WN5          80               056095
     C***ADD*1*IF LEAP YEAR                                               056095
     C***80******          ADD  1         @@LPNM  50                      056095
     C***********          END                             **** E 3       056095
     C***BYPASS*IF YEARS ARE THE SAME                                     056095
     C***********@@YY1     IFEQ @@YY2                      **** B 3       056095
     C***********@@WDAT    SUB  @@LPNM    @@INDY                          056095
     C***********          GOTO M10099                     ---------->    056095
     C***********          END                             **** E 2       056095
     C***LOOP*TO*CALCULATE NO. LEAP YEARS                                 056095
     C***********@@YY1     DOWNE@@YY2                      **** B 2       056095
     C***INCREMENT START YEAR                                             056095
     C***********          ADD  1         @@YY1                           056095
     C***********                                                         056095
     C***********@@YY1     IFEQ @@YY2                      **** B 3       056095
     C***********@@MM2     IFGT 2                          **** B 4       056095
     C***********@@YY2     DIV  4         @@WN5                        YR 056095
     C***********          MVR            @@WN5          80               056095
     C***INCREMENT IF LEAP YEAR                                           056095
     C***80******          ADD  1         @@LPNM                          056095
     C***********          END                              **** E 4      056095
     C***********@@WDAT    SUB  @@LPNM    @@INDY                          056095
     C***********          END                              **** E 3      056095
     C***********@@YY1     IFNE @@YY2                       **** B 3      056095
     C***********@@YY1     DIV  4         @@WN5                        YR 056095
     C***********          MVR            @@WN5          80               056095
     C***ADD*1*IF LEAP YEAR                                               056095
     C***80******          ADD  1         @@LPNM                          056095
     C***********          END                              **** E 3      056095
     C***********          END                              **** E 2      056095
     C***********          END                              **** E 1      056095
     C***********                                                         056095
     C***********M10099    ENDSR                           ***M10099***   056095
     C/EJECT
     C********************************************************************S01195
     C*****                                                               S01195
     C**ZA0830 - THIS SUBROUTINE FINDS OUT WHETHER A PARTICULAR DAY       S01195
     C*****      IS A HOLIDAY IN A PARTICULAR CURRENCY                    S01195
     C*****                                                               S01195
     C**CALLED BY :                                                       S01195
     C*****                                                               S01195
     C**CALLS :                                                           S01195
     C*****                                                               S01195
     C**INPUT  : @@MNO  MIDAS DAY NUMBER 5N                               S01195
     C*****      @@CCY  CURRENCY CODE 3A                                  S01195
     C*****                                                               S01195
     C**OUTPUT : @@HIND HOLIDAY/WORKING DAY INDICATOR 1A                  S01195
     C*****                                                               S01195
     C**USES :   @@MNO  MIDAS DAY NUMBER                                  S01195
     C*****      @@CCY  CURRENCY CODE                                     S01195
     C*****      @@ONCE FIRST TIME THROUGH INDICATOR                      S01195
     C*****      @@CY1  FIRST HALF OF CURRENCY ARRAY                      S01195
     C*****      @@CY2  SECOND HALF OF CURRENCY ARRAY                     S01195
     C*****      @@MNO6 MIDAS NUMBER WITH TRAIGING BLANK                  S01195
     C*****      @@HIND HOLIDAY/WORKING DAY INDICATOR                     S01195
     C*****      @@INEX INCLUDE/EXCLUDE INDICATOR                         S01195
     C*****                                                               S01195
     C*****      INDICATORS                                               S01195
     C*****      80 RECORD NOT FOUND                                      S01195
     C*****      81 CURRENCY NOT FOUND ON RECORD                          S01195
     C*****                                                               S01195
     C********************************************************************S01195
     C*****      ZA0830    BEGSR                                          S01195
     C*****                                                               S01195
     C***OPEN CURRENCY/HOLIDAY FILE IF FIRST TIME THROUGH                 S01195
     C*****      @@ONCE    IFNE 'Y'                        B1             S01195
     C*****                OPEN FDTABJLL                   *1             S01195
     C*****                MOVE 'Y'       @@ONCE  1        *1             S01195
     C*****                END                             E1             S01195
     C*****                                                               S01195
     C***BLANK OUT ARRAY                                                  S01195
     C*****                MOVE *BLANKS   @@CY1                           S01195
     C*****                MOVE *BLANKS   @@CY2                           S01195
     C*****                                                               S01195
     C***ACCESS TABLE ON FIRST KEY                                        S01195
     C*****                MOVEL@@MNO     @@MNO6  6                       S01195
     C*****                MOVE @@MNO6    @@0830 12                       S01195
     C*****                MOVEL'22    '  @@0830                          S01195
     C*****                MOVE '1'       @@0830                          S01195
     C*****      @@0830    CHAINTABLETJF             80                   S01195
     C*****                                                               S01195
     C***IF RECORD NOT FOUND OR DELETED                                   S01195
     C*****      *IN80     IFEQ '1'                        B1             S01195
     C*****      RECI      OREQ '*'                        *1             S01195
     C*****                MOVE 'W'       @@HIND           *1             S01195
     C*****                GOTO ZA0839                     *1             S01195
     C*****                END                             E1             S01195
     C*****                                                               S01195
     C***MOVE FIRST 25 CURRENCIES TO ARRAY                                S01195
     C*****                MOVE HCCY      @@CY1                           S01195
     C*****                                                               S01195
     C***ACCESS TABLE ON SECOND KEY                                       S01195
     C*****                MOVE '2'       @@0830                          S01195
     C*****      @@0830    CHAINTABLETJF             80                   S01195
     C*****                                                               S01195
     C***IF SECOND RECORD FOUND AND NOT DELETED                           S01195
     C*****      *IN80     IFEQ '0'                        B1             S01195
     C*****      RECI      ANDNE'*'                        *1             S01195
     C*****                MOVE HCCY      @@CY2            *1             S01195
     C*****                END                             E1             S01195
     C*****                                                               S01195
     C***SEARCH ARRAY FOR INPUT CURRENCY                                  S01195
     C*****      @@CCY     LOKUP@CY                      81               S01195
     C*****                                                               S01195
     C***IF INPUT CURRENCY IS IN ARRAY                                    S01195
     C*****      *IN81     IFEQ '1'                        B1             S01195
     C*****                                                               S01195
     C***IF INCLUDE/EXCLUDE INDICATOR EQ 'E'                              S01195
     C*****      INEX      IFEQ 'E'                        B*2            S01195
     C*****                MOVE 'W'       @@HIND  1        **2            S01195
     C*****                ELSE                            X*2            S01195
     C*****                MOVE 'H'       @@HIND           **2            S01195
     C*****                END                             E*2            S01195
     C*****                END                             E1             S01195
     C*****                                                               S01195
     C***IF INPUT CURRENCY IS NOT IN ARRAY                                S01195
     C*****      *IN81     IFEQ '0'                        B1             S01195
     C*****                                                               S01195
     C***IF INCLUDE/EXCLUDE INDICATOR EQ 'I'                              S01195
     C*****      INEX      IFEQ 'I'                        B*2            S01195
     C*****                MOVE 'W'       @@HIND           **2            S01195
     C*****                ELSE                            X*2            S01195
     C*****                MOVE 'H'       @@HIND           **2            S01195
     C*****                END                             E*2            S01195
     C*****                END                             E1             S01195
     C*****      ZA0839    ENDSR                                          S01195
     C/EJECT                                                              S01195
     C/COPY ZSRSRC,ZCHKH                                                  S01195
     C/COPY ZSRSRC,ZACCH                                                  S01195
     C*                                                                     *
     C* MM1004 - CALCULATE THE NEXT INTEREST PAYMENT DATE                   *
     C*
     C* CALLED BY :                                                         *
     C*                                                                     *
     C**CALLS*:**ZA0830,*A*COMMON*ROUTINE*TO*DETERMINE*WHETHER*A*DATE*****S01319
     C* CALLS :  ZCHKH , A COMMON ROUTINE TO DETERMINE WHETHER A DATE       *
     C*          IS A WORKING DAY OR A HOLIDAY.                             *
     C********:**ZA0680,*A*COMMON*ROUTINE*TO*CONVERT*DATE*IN*YYYYMMDD**   056095
     C*       :  ZDAT10, A COMMON ROUTINE TO CONVERT DATE IN YYYYMMDD     056095
     C*          FORMAT TO MIDAS DAY NUMBER.
     C********:**ZA0710,*A*COMMON*ROUTINE*TO*CONVERT*MIDAS*DAY*NUMBER**   056095
     C*       :  ZDATE9, A COMMON ROUTINE TO CONVERT MIDAS DAY NUMBER     056095
     C*          TO DATE FORMAT OF YYYYMMDD.                                *
     C*                                                                     *
     C* INPUT  : @@STRT START DATE                           (8N)           *
     C*          @@FREQ PAYMENT FREQUENCY                    (1A)           *
     C*          @@CCY  CURRENCY CODE                        (3A)           *
     C*          @@MDAY INTEREST PAYMENT DAY IN THE MONTH    (2N)           *
     C*          @@MDAT MATURITY DATE                        (8N)
     C*                                                                     *
     C* OUTPUT : @@NDAT NEXT PAYMENT DATE (MIDAS DAY NUMBER) (8N)           *
     C*
     C**USES*:***@@DTIN*DATE*PASSED*TO***********SR*ZA0680***(8N)******   056095
     C***********@@MDNO*MIDAS*DAY*NUMBER*FROM****SR*ZA0680***(5N)******   056095
     C* USES :   ZZDTIN DATE PASSED TO           SR ZDAT10   (8N)         056095
     C*          ZZMDNO MIDAS DAY NUMBER FROM    SR ZDAT10   (5N)         056095
     C*****      @@MNO  DAY NUMBER PASSED TO     SR ZA0830   (5N)         S01195
     C*****      @@HIND HOLIDAY/WORKING DAY IND. SR ZA0830   (1A)         S01195
     C***********@@DAYN*DAY*NUMBER*PASSED*TO*****SR*ZA0710***(5N)******   056095
     C***********@@VDT**DATE*IN*FORMAT*YYYYMMDD**SR*ZA0710***(8N)******   056095
     C*          @@DAYN DAY NUMBER PASSED TO     SR ZDATE9   (5N)         056095
     C*          @@VDT  DATE IN FORMAT YYYYMMDD  SR ZDATE9   (8N)         056095
     C*          @@DNO  WORK FIELD - DAY NUMBER              (5N)           *
     C*          @@CCY  CURRENCY CODE                        (3A)           *
     C*          @@WF16 WORK FIELD - # DAYS IN THE MONTH     (2N)           *
     C*          @@HWIN WORK FIELD - HOLIDAY/WORK INDICATOR  (1A)           *
     C*          @@WKDT WORK FIELDS DS TO MANIPULATE DATE    (8N)           *
     C*          @@WKYY WORK FIELDS DS  - YEAR FIELD YYYY    (4N)           *
     C*          @@WKY  WORK FIELDS DS  - YEAR FIELD   YY    (2N)           *
     C*          @@WKM  WORK FIELDS DS  - MONTH FIELD        (2N)           *
     C*          @@WKD  WORK FIELDS DS  - DAY FIELD          (2N)           *
     C*          @@WKD2 WORK FIELDS - MAXIMUM DAYS IN MONTH  (2N)           *
     C*          @@REM2 LEAP YEAR CALCS - REMAINDER FIELD    (3N)           *
     C*                                                                     *
     C***********************************************************************
     C           MM1004    BEGSR
     C*
     C** Re-set the indicators used within this subroutine.
     C                     MOVE '0'       *IN80
     C                     MOVE '0'       *IN82
     C*
     C** Move the start date input into a working fields DS.
     C                     MOVE @@STRT    @@WKDS
     C*
     C** IF     the interest payment day in month is blank
     C**        THEN     substitue day from start date into that field.
     C** END
     C*
     C           @@MDAY    IFEQ 0                          B1
     C                     Z-ADD@@WKD     @@MDAY  20       *1
     C                     END                             E1
     C*
     C** IF     the payment frequency is blank                            ME1002
     C**        THEN next interest date is set to maturity date           ME1002
     C** END                                                              ME1002
     C*                                                                   ME1002
     C           @@FREQ    IFEQ *BLANK                     B1             ME1002
     C                     Z-ADD@@MDAT    @@NDAT           *1             ME1002
     C                     GOTO M10049                     *1             ME1002
     C                     END                             E1             ME1002
     C*                                                                   ME1002
     C** IF     the payment frequency is monthly
     C**        THEN     increment the month by 1.
     C** END
     C           @@FREQ    IFEQ 'M'                        B1
     C           @@FREQ    OREQ 'N'                        B1             AUS003
     C                     ADD  1         @@WKM            *1
     C                     END                             E1
     C*
     C** IF     the payment frequency is quarterly.
     C**        THEN     increment the month by 3.
     C** END
     C           @@FREQ    IFEQ 'Q'                        B1
     C                     ADD  3         @@WKM            *1
     C                     END                             E1
     C*
     C** IF     the payment frequency is six-monthly
     C**        THEN     increment the month by 6.
     C** END
     C           @@FREQ    IFEQ 'X'                        B1
     C                     ADD  6         @@WKM            *1
     C                     END                             E1
     C*
     C** IF     the payment frequency is yearly
     C**        THEN     increment the year by 1.
     C** END
     C           @@FREQ    IFEQ 'Y'                        B1
     C                     ADD  1         @@WKYY           *1
     C                     END                             E1
     C*
     C** Substitute day in month into the day field.
     C*
     C                     Z-ADD@@MDAY    @@WKD
     C*
     C** IF     the new month now exceeds 12
     C**        THEN     subtract 12 from the month
     C**                 increment the year by 1
     C** END
     C*
     C           @@WKM     IFGT 12                         B1
     C           @@WKM     SUB  12        @@WKM            *1
     C                     ADD  1         @@WKYY           *1
     C                     END                             E1
     C*
     C** IF     the days now exceed the number of days for that month
     C**        THEN     substitue the maximum # of days to that field
     C**              IF     leap year and month is February
     C**                     THEN     add an extra day to the day field
     C**              END
     C** END
     C*
     C                     MOVE @M,@@WKM  @@WKD2  20     80
     C           @@WKD     IFGT @@WKD2                     E1
     C                     Z-ADD@@WKD2    @@WKD            *1
     C*
     C** Test for leap year, and turn of century leap year.
     C** NB: only every 400 years is a leap year.
     C           @@WKY     IFEQ 0                          B*2
     C           @@WKYY    DIV  400       @@WF16  30       **2
     C                     MVR            @@REM2  30     82**2
     C                     ELSE                            X*2
     C           @@WKYY    DIV  4         @@WF16           **2
     C                     MVR            @@REM2         82**2
     C                     END                             E*2
     C*
     C           *IN82     IFEQ '1'                        B*2
     C           @@WKM     IFEQ 2                          B**3
     C                     ADD  1         @@WKD            ***3
     C                     END                             E**3
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C** Convert payment date to midas format.
     C*
     C***********          Z-ADD@@WKDT    @@DTIN                          056095
     C***********          EXSR ZA0680                                    056095
     C***********          Z-ADD@@MDNO    @@DNO   50                      056095
     C                     Z-ADD@@WKDT    ZZDTIN                          056095
     C                     EXSR ZDAT10                                    056095
     C                     Z-ADDZZMDNO    @@DNO   50                      056095
     C*
     C**  Check whether loan or deposit in order to set up location       S01195
     C           IKAMNP    IFGT 0                          B1       DEP   S01195
     C*                                                                   S01195
     C*  Set up location used by ZCHKH - if Our PAY Settlement            S01195
     C*  Method is a nostro then use nostro code and currency to find     S01195
     C*  Nostro Location                                                  S01195
     C           IKPSTM    IFEQ 01                         B*2            S01195
     C           IKPSTM    OREQ 02                         **2            S01195
     C           IKPSTM    OREQ 07                         **2            S01195
     C           IKPSTM    OREQ 08                         **2            S01195
     C           IKPSTM    OREQ 12                         **2            S01195
     C*                                                                   S01195
     C*********            MOVE *BLANKS   @KEY             **2     S01195 S01194
     C*********            MOVE '70'      @KEY1            **2     S01195 S01194
     C*********            MOVELIKCCY     @5      5        **2     S01195 S01194
     C*********            MOVELIKPONS    @2      2        **2     S01195 S01194
     C*********            MOVE @2        @5               **2     S01195 S01194
     C*********            MOVE @5        @KEY             **2     S01195 S01194
     C*********  @KEY      CHAINFDTBLILL             65    **2     S01195 S01194
     C*                                                            S01195 S01194
     C                     MOVELIKPONS    @NONB                           S01194
     C                     CALL 'AONOSTR0'                                S01194
     C*********************PARM '*DBERR ' @RTCD                     S01194E234
     C                     PARM '*MSG   ' @RTCD                           E234
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM *BLANKS   @CUST   6                       S01194
     C***********          PARM IKCCY     @CYCD   3                S01194 CEU003
     C                     PARM WSICY     @CYCD   3                       CEU003
     C**********           PARM *BLANKS   @ACCD   4                                    S01194 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2                       S01194
     C                     PARM           @NONB   2                       S01194
     C                     PARM *BLANKS   @BRCD   3                       S01194
     C                     PARM *BLANKS   @CSSN  10                       S01194
     C                     PARM *BLANKS   @PNOI   1                       S01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
      *                                                                   S01194
     C*********  *IN65     IFEQ '1'                        B**3    S01195 S01194
     C           @RTCD     IFNE *BLANKS                    B**3           S01194
     C***********RECI******ORNE 'D'                        B**3     S01195E80
     C                     MOVE '1'       *INLR            ***3           S01195
     C                     MOVE '1'       *INU7            ***3           S01195
     C                     MOVE '1'       *INU8            ***3           S01195
     C                     MOVE '1'       *INKC            ***************S01195
     C**********           MOVEL'NOSTRO  'DBFILE           * DBERROR 030 *S01195
     C                     MOVEL'SDNOSTPD'DBFILE           * DBERROR 030 *S01194
     C**********           MOVEL@DLKEY    DBKEY            ********S01195 S01194
     C                     MOVEL@CYCD     DBKEYA  5                       S01194
     C                     MOVE @NONB     DBKEYA           ***************S01194
     C                     MOVELDBKEYA    DBKEY                           S01194
     C                     MOVE '030'     DBASE            ***3           S01195
     C                     MOVEL@OPTN     DBOPTN           ***3           S01194
     C                     EXSR #Z                         ***3           S01195
     C                     END                             E**3           S01195
     C*                                                                   S01195
     C**********           MOVE CSNM      ZLOC             **2     S01195 S01194
     C                     MOVE A7NOSN    ZLOC             **2            S01194
     C*                                                                   S01195
     C                     ELSE                            X*2            S01195
     C                     MOVE *BLANKS   ZLOC             **2            S01195
     C                     END                             E*2            S01195
     C*                                                                   S01195
     C                     ELSE                            X1             S01195
     C*                                                                   S01195
     C**  IKAMNP is less than zero so deal is a loan                      S01195
     C*  Set up location used by ZCHKH - if Our receive Settlement        S01195
     C*  Method is a nostro then use nostro code and currency to find     S01195
     C*  Nostro Location                                                  S01195
     C*                                                                   S01195
     C           IKRSTM    IFEQ 01                         B*2            S01195
     C           IKRSTM    OREQ 02                         **2            S01195
     C           IKRSTM    OREQ 07                         **2            S01195
     C           IKRSTM    OREQ 08                         **2            S01195
     C           IKRSTM    OREQ 12                         **2            S01195
     C*                                                                   S01195
     C*********            MOVE *BLANKS   @KEY             **2    S01195  S01194
     C*********            MOVE '70'      @KEY1            **2    S01195  S01194
     C*********            MOVELIKCCY     @5               **2    S01195  S01194
     C*********            MOVELIKRONS    @2               **2    S01195  S01194
     C*********            MOVE @2        @5               **2    S01195  S01194
     C*********            MOVE @5        @KEY             **2    S01195  S01194
     C*********  @KEY      CHAINFDTBLILL             65    **2    S01195  S01194
     C                     MOVELIKRONS    @NONB            **2            S01194
     C                     CALL 'AONOSTR0'                 **2            S01194
     C                     PARM '*MSG   ' @RTCD            **2            S01194
     C                     PARM '*KEY   ' @OPTN            **2            S01194
     C                     PARM *BLANKS   @CUST   6                       S01194
     C***********          PARM IKCCY     @CYCD   3                S01194 CEU003
     C                     PARM WSICY     @CYCD   3                       CEU003
     C**********           PARM *BLANKS   @ACCD   4                                    S01194 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2                       S01194
     C                     PARM           @NONB   2                       S01194
     C                     PARM *BLANKS   @BRCD   3                       S01194
     C                     PARM *BLANKS   @CSSN  10                       S01194
     C                     PARM *BLANKS   @PNOI   1                       S01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
     C*                                                                   S01195
     C*********  *IN65     IFEQ '1'                        B**3   S01195  S01194
     C*********  RECI      ORNE 'D'                        B**3   S01195  S01194
     C           @RTCD     IFNE *BLANKS                    B**3           S01194
     C                     MOVE '1'       *INLR            ***3           S01195
     C                     MOVE '1'       *INU7            ***3           S01195
     C                     MOVE '1'       *INU8            ***3           S01195
     C                     MOVE '1'       *INKC            ***************S01195
     C*********            MOVEL'NOSTRO  'DBFILE           * DBERROR 031 *S01194
     C*********            MOVEL@DLKEY    DBKEY            *******S01195  S01194
     C                     MOVEL'SDNOSTPD'DBFILE           * DBERROR 031 *S01195
     C                     MOVEL@CYCD     DBKEYA           ***************S01195
     C                     MOVE @NONB     DBKEYA           ***3    S01195 S01194
     C                     MOVELDBKEYA    DBKEY            ***3           S01194
     C                     MOVE '031'     DBASE            ***3           S01195
     C                     MOVEL@OPTN     DBOPTN           ***3           S01194
     C                     EXSR #Z                         ***3           S01195
     C                     END                             E**3           S01195
     C*                                                                   S01195
      * OBTAIN LOCATION PORTION OF SHORTNAME                              S01194
     C************         MOVE CSNM      ZLOC             **2    S01195  S01194
     C                     MOVE A7NOSN    ZLOC             **2    S01195  S01194
     C*                                                                   S01195
     C                     ELSE                            X*2            S01195
     C                     MOVE *BLANKS   ZLOC             **2            S01195
     C                     END                             E*2            S01195
     C*                                                                   S01195
     C                     END                             E1             S01195
     C*                                                                   S01195
     C*
     C** DOWHILE     payment date is NOT a valid woking day
     C**             increment the day number
     C** WEND
     C*
     C           @@FREQ    IFNE 'N'                                       AUS003
     C*****      @@HWIN    DOUEQ'W'                        B1
     C           ZIND      DOUEQ'W'                        B1
     C*****                Z-ADD@@DNO     @@MNO   50       *1             S01195
     C                     Z-ADD@@DNO     ZDAYNO                          S01195
     C*****                EXSR ZA0830                     *1             S01195
     C                     EXSR ZCHKH                      *1             S01195
     C*****                MOVE @@HIND    @@HWIN  1        *1             S01195
     C                     MOVE ZIND      @@HWIN  1        *1             S01195
     C*****      @@HWIN    IFNE 'W'                        B*2            S01195
     C           ZIND      IFNE 'W'                        B*2            S01195
     C***********          ADD  1         ZDAYNO           **2            E36306
     C                     ADD  1         @@DNO                           E36306
     C                     END                             E**2
     C                     END                             E1
     C                     END                                            AUS003
     C*
     C** Convert payment day number back to YYYYMMDD format.
     C*
     C                     Z-ADD@@DNO     @@DAYN  50
     C***********          EXSR ZA0710                                    056095
     C                     EXSR ZDATE9                                    056095
     C                     Z-ADD@@VDT     @@NDAT  80
     C                     GOTO M10049
     C*
     C**  Unexecuted code to define fields
     C                     MOVEL@@FREQ    @@FREQ  1
     C                     MOVEL@@STRT    @@STRT  80
     C                     MOVEL@@MDAT    @@MDAT  80
     C*****                MOVEL@@CCY     @@CCY   3               *****   S01195
     C*
     C           M10049    ENDSR
     C*****************************************************************   ME2062
     C/EJECT                                                              ME2062
     C*****************************************************************   ME2062
     C*   MM1025 - CALCULATE YIELD RATE FOR BILLS BOUGHT              *   ME2062
     C*                                                               *   ME2062
     C*  CALLED BY    -                                               *   ME2062
     C*                                                               *   ME2062
     C*  CALLS        -                                               *   ME2062
     C*                                                               *   ME2062
     C***FIELDS*INPUT*@@BEG**-*START*DATE*OF*PERIOD*****************ME2062056095
     C****************@@END**-*END*DATE*OF*PERIOD*******************ME2062056095
     C****************@@CALC*-*INTEREST*CALCULATION*METHOD**********ME2062056095
     C*  FIELDS INPUT ZZBEG  - START DATE OF PERIOD                   *   056095
     C*               ZZEND  - END DATE OF PERIOD                     *   056095
     C*               ZZCALC - INTEREST CALCULATION METHOD            *   056095
     C*               @@DIRT - DISCOUNT RATE 11,7                     *   ME2062
     C*                                                               *   ME2062
     C*  FIELDS OUTPUT @@YLD  - YIELD RATE 11,7                       *   ME2062
     C*                                                               *   ME2062
     C*  WORK FIELDS  @@155A - 15,5                                   *   ME2062
     C*               @@155B - 15,5                                   *   ME2062
     C*               @@155C - 15,5                                   *   ME2062
     C*               @@DMAT -  5,0                                   *   ME2062
     C*               @@DINY -  3,0                                   *   ME2062
     C*                                                               *   ME2062
     C*****************************************************************   ME2062
     C           MM1025    BEGSR                                          ME2062
     C*                                                                   ME2062
     C**  DEFINE FIELDS                                                   ME2062
     C*                                                                   ME2062
     C                     Z-ADD@@DIRT    @@DIRT 117                      ME2062
     C*                                                                   ME2062
     C**  CALCULATE DAYS TO MATURITY                                      ME2062
     C*                                                                   ME2062
     C***********@@END     SUB  @@BEG     @@DMAT  50                ME2062056095
     C           ZZEND     SUB  ZZBEG     @@DMAT  50                      056095
     C*                                                                   ME2062
     C**  DETERMINE DAYS IN YEAR                                          ME2062
     C*                                                                   ME2062
     C***********@@CALC    IFEQ '2'                                 ME2062056095
     C***********@@CALC    OREQ '3'                                 ME2062056095
     C***********@@CALC    OREQ '5'                                 ME2062056095
     C           ZZCALC    IFEQ '2'                                       056095
     C           ZZCALC    OREQ '3'                                       056095
     C           ZZCALC    OREQ '5'                                       056095
     C                     Z-ADD360       @@DINY  30                      ME2062
     C                     END                                            ME2062
     C*                                                                   ME2062
     C***********@@CALC    IFEQ '1'                                 ME2062056095
     C***********@@CALC    OREQ '4'                                 ME2062056095
     C           ZZCALC    IFEQ '1'                                       056095
     C           ZZCALC    OREQ '4'                                       056095
     C                     Z-ADD365       @@DINY                          ME2062
     C                     END                                            ME2062
     C*                                                                   ME2062
     C***********@@CALC    IFEQ '6'                                 ME2062056095
     C           ZZCALC    IFEQ '6'                                       056095
     C                     Z-ADD366       @@DINY                          ME2062
     C                     END                                            ME2062
     C*                                                                   ME2062
     C**  CALCULATE YIELD RATE                                            ME2062
     C*                                                                   ME2062
     C           @@DIRT    MULT @@DINY    @@155A 155                      ME2062
     C           @@155A    MULT 100       @@155A                          ME2062
     C*                                                                   ME2062
     C           @@DINY    MULT 100       @@155B 155                      ME2062
     C           @@DIRT    MULT @@DMAT    @@155C 155                      ME2062
     C*                                                                   ME2062
     C           @@155B    SUB  @@155C    @@155B                          ME2062
     C*                                                                   ME2062
     C           @@155A    DIV  @@155B    @@YLD  117                      ME2062
     C*                                                                   ME2062
     C           M10259    ENDSR                                          ME2062
     C*****************************************************************   ME2062
     C****************************************************************
     C*                                                              *
     C*     #C CARRIES OUT TERMINATION PROCESSING.                   *
     C*        CALLED BY  : MAIN PROGRAM                             *
     C*        CALLS      :                                          *
     C*                                                              *
     C*        WORK FIELDS:                                          *
     C*                                                              *
     C****************************************************************
     C           #C        BEGSR
     C*
     C                     RETRN
     C*
     C           #C9       ENDSR                           ***#C9***
     C*
     C/EJECT
     C****************************************************************
     C*                                                              *
     C*     #A CARRIES OUT INITIALISATION PROCESSING.                *
     C*        CALLED BY  : MAIN PROGRAM                             *
     C*        CALLS      :                                          *
     C*                                                              *
     C*        WORK FIELDS: @T       - TERMINATION INPUT PARAMETER   *
     C********************:*@FB******-*FRONT/BACK*OFFICE*CALL*************S01319
     C*                   : @ENQ     - ENQUIRY TYPE INPUT PARAMETER  *
     C*                   : @FORM    - FORMAT TO BE USED             *
     C*                                                              *
     C****************************************************************
     C           #A        BEGSR
     C*
     C                     MOVEACPY@      BIS@   80
     C**  RECEIVE INPUT PARAMETERS
     C           *ENTRY    PLIST
     C                     PARM           @TERM   1
     C*********************PARM***********@FB*****1***********************S01319
     C                     PARM           @ENQ    1
     C                     PARM           MMSTDL
     C                     PARM           MMSTDB
     C                     PARM           MMSTDS
     C                     PARM           MMSTDA
     C                     PARM           Z#BSTS                          082738
     C                     PARM           Z#ASTS                          082738
     C                     PARM           Z#WSTS                          082738
     C                     MOVEL*BLANK    Z#BSTS                          082738
     C                     MOVEL*BLANK    Z#ASTS                          082738
     C                     MOVEL*BLANK    Z#WSTS                          082738
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0078CCP5                                           S01408
     C*                                                                   S01408
     C*
     C**  MOVE PROGRAM NAME INTO STATUS DATA STRUCTURE FIELD.
     C                     MOVEL'MM0078'  DBPGM
     C                     MOVE 'N'       @FIRST  1                       E18417
     C*
     C**  OPEN ALL FILES
     C**********           OPEN FDICDRLL                                  S01194
     C**********           OPEN FDINSTLL                                  S01194
     C**********           OPEN FDBSNCLL                                  S01194
     C********             OPEN SNAME                                     E13173
     C**********           OPEN FDCSNMLL                          E13173  S01194
     C**********           OPEN FDTBLILL                          S01195  S01194
     C                     OPEN SDBRTDL1                                  S01383
     C                     OPEN SDCBRTL1                                  S01383
     C                     OPEN DEALS
     C**********           OPEN FDBRKRLL                                  S01194
     C**********           OPEN FDCCYTLL                                  S01194
     C**********           OPEN FDBRTELL                                  S01194
     C*********************OPEN*MMSTDDLL**********************************S01319
     C                     OPEN MMDEALLL
     C                     OPEN MMDEAULL
     C                     OPEN MMDAMULL
     C**********           OPEN FDSNAMLL                                  S01194
     C**********           OPEN FDNOSTLL                                  S01194
     C                     OPEN MMDEAMLL
     C**********           OPEN FXTB40LL                                  S01194
     C/COPY WNCPYSRC,MM0078C027
     C*
     C****IF*PROGRAM*IS*RUNNING*IN*FRONT*OFFICE*OPEN*DEAL*BLOTTERS********S01319
     C***********@FB*******IFEQ*'F'************************B1*************S01319
     C*********************OPEN*MMDWD2LL********************1*************S01319
     C*********************OPEN*MMDWA2LL********************1*************S01319
     C*********************END*****************************E1*************S01319
     C*
     C**  DEFINE WORK FIELDS
     C           *LIKE     DEFN IKCNUM    @CNUM
     C           *LIKE     DEFN IKMTYP    @MTYP
     C           *LIKE     DEFN IKDCPI    @DCPI
     C           *LIKE     DEFN IKDCRI    @DCRI
     C           *LIKE     DEFN IKDFAC    @DFAC
     C           *LIKE     DEFN IKDOPI    @DOPI
     C           *LIKE     DEFN IKDOPM    @DOPM
     C           *LIKE     DEFN IKDORI    @DORI
     C           *LIKE     DEFN IKDORM    @DORM
     C           *LIKE     DEFN IKMCPI    @MCPI
     C           *LIKE     DEFN IKMCRI    @MCRI
     C           *LIKE     DEFN IKMFAO    @MFAO
     C           *LIKE     DEFN IKMOPI    @MOPI
     C           *LIKE     DEFN IKMOPM    @MOPM
     C           *LIKE     DEFN IKMORI    @MORI
     C           *LIKE     DEFN IKORCM    @ORCM
     C           *LIKE     DEFN IKIMAT    @KIMAT
     C           *LIKE     DEFN IKAMNP    @KAMNP
     C           *LIKE     DEFN IHAMNP    @HAMNP
     C           *LIKE     DEFN ILAMNP    @LAMNP
     C           *LIKE     DEFN IGAMNP    @GAMNP
     C           *LIKE     DEFN IKDN38    @DLKEY                          S01195
     C*
     C           *LIKE     DEFN HKAMNP    INTAMT                          083409
     C           *LIKE     DEFN HKAMNP    SCAMNP                          083409
     C           *LIKE     DEFN HKDN38    SCDLNO                          083409
     C           *LIKE     DEFN HKINTR    SCINTR                          083409
     C           *LIKE     DEFN HKICMT    SCCALC                          083409
     C           *LIKE     DEFN HKVDYY    SCCDYY                          083409
     C           *LIKE     DEFN HKVDMM    SCCDMM                          083409
     C           *LIKE     DEFN HKVDDD    SCCDDD                          083409
     C           *LIKE     DEFN AITC      SCAITC                          083409
     C           *LIKE     DEFN IACD      SCIACD                          083409
     C           *LIKE     DEFN IACD      SCVDAT                          083409
     C           *LIKE     DEFN IACD      SCAMDD                          083409
     C           *LIKE     DEFN ICTD      SCICTD                          083409
     C           *LIKE     DEFN IPRD      SCIPRD                          083409
     C*                                                                   083409
     C           @DEAMK    KLIST
     C                     KFLD           IGDA38
     C                     KFLD           IGVDYY
     C                     KFLD           IGVDMM
     C                     KFLD           IGVDDD
     C                     KFLD           IGDS38
     C*
     C*********  KEY3      KLIST                                          S01194
     C*********            KFLD           CSNM                            S01194
     C*********            KFLD           CCY                             S01194
     C*********            KFLD           PNOI                            S01194
     C*********                                                           S01194
     C*********  KEY4      KLIST                                          S01194
     C*********            KFLD           CSN1                            S01194
     C*********            KFLD           CSN2                            S01194
     C/COPY WNCPYSRC,MMH00192
      *
      *   Perform dummy update to LF/DEALS to allow program to compile
     C***        @FCYC     IFEQ 'Y'                        B1
     C***                  MOVE 'N'       @FCYC   1        *1
     C***                  WRITEDEALSDCF                   *1
     C***                  END                             E1
     C*
     C**       STANDING DATA FILES
      *
      ****Get*Installation control record for decimal separator.          S01194
     C********** 1         CHAINFDINSTLL             61                   S01194
     C**********                                                          S01194
     C****DEAL*WITH DATA BASE ERROR                                       S01194
     C*********  *IN61     IFEQ '1'                        B1             S01194
     C*********  IDDLTF    OREQ '*'                        *1             S01194
     C*********            MOVE 'FDINSTLL'DBFILE           *1**********   S01194
     C*********            MOVE '002'     DBASE            *1DB ERR 02*   S01194
     C*********            MOVEL@OPTN     DBOPTN           *              S01194
     C*********            EXSR #Z                         *1**********   S01194
     C*********            END                             E1             S01194
      *                                                                   S01194
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*MSG    '@RTCD                           S01194
     C                     PARM '*FIRST  '@OPTN                           S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C                     MOVEL'SDBANKPD'DBFILE           *************  S01194
     C                     MOVEL'903'     DBASE            * DBERR 903 *  S01194
     C                     MOVEL@OPTN     DBOPTN  7        *************  S01194
     C                     EXSR #Z                                        S01194
     C                     END                                            S01194
      *                                                                   S01194
     C***********BGRTBN    IFEQ 'Y'                                E47225 076556
     C***********BGIOAC    OREQ 'Y'                                E47225 076556
     C***********          CALL 'AORETLR0'                         S01194 076556
     C***********          PARM '*MSG    '@RTCD                    S01194 076556
     C***********          PARM '*FIRST  '@OPTN                    S01194 076556
     C***********SDRETL    PARM SDRETL    DSFDY                    S01194 076556
     C***********                                                  S01194 076556
     C***********@RTCD     IFNE *BLANK                             S01194 076556
     C***********          MOVEL'SDRETLPD'DBFILE           ********S01194 076556
     C***********          MOVEL'904'     DBASE            * DBERR S01194 076556
     C***********          MOVEL@OPTN     DBOPTN           ********S01194 076556
     C***********          EXSR #Z                                 S01194 076556
     C***********          END                                     S01194 076556
     C***********          END                                     E47225 076556
      *                                                                   S01194
     C                     CALL 'AOMMODR0'                                S01319
     C                     PARM '*MSG    '@RTCD                           S01319
     C                     PARM '*FIRST  '@OPTN                           S01319
     C           SDMMOD    PARM SDMMOD    DSFDY                           S01319
     C*                                                                   S01319
     C           @RTCD     IFNE *BLANK                                    S01319
     C                     MOVEL'SDMMODPD'DBFILE           *************  S01319
     C                     MOVEL'905'     DBASE            * DBERR 905 *  S01319
     C                     MOVEL@OPTN     DBOPTN           *************  S01319
     C                     EXSR #Z                                        S01319
     C                     END                                            S01319
     C*                                                                   076556
     C           BGRTBN    IFEQ 'Y'                                       076556
     C           BGIOAC    OREQ 'Y'                                       076556
     C                     CALL 'AORETLR0'                                076556
     C                     PARM '*MSG    '@RTCD                           076556
     C                     PARM '*FIRST  '@OPTN                           076556
     C           SDRETL    PARM SDRETL    DSFDY                           076556
     C*                                                                   076556
     C           @RTCD     IFNE *BLANK                                    076556
     C                     MOVEL'SDRETLPD'DBFILE           *************  076556
     C                     MOVEL'904'     DBASE            * DBERR 904 *  076556
     C                     MOVEL@OPTN     DBOPTN           *************  076556
     C                     EXSR #Z                                        076556
     C                     END                                            076556
     C                     END                                            076556
     C**                                                                  S01383
     C** ACCESS SAR DETAILS FILE TO DETERMINE IF BRT SAR IS INSTALLED     S01383
     C**                                                                  S01383
     C                     CALL 'AOSARDR0'                                S01383
     C                     PARM '       ' @RTCD                           S01383
     C                     PARM '*VERIFY' @OPTN                           S01383
     C                     PARM 'S01383'  @SARD   6                       S01383
     C           @RTCD     IFNE *BLANK                                    S01383
     C           @RTCD     ANDNE'*NRF   '                                 S01383
     C                     MOVEL'SCSARDPD'DBFILE            **************S01383
     C                     MOVEL'906'     DBASE             *DBERROR 906* S01383
     C                     MOVEL@RTCD     DBKEY             **************S01383
     C                     EXSR #Z                                        S01383
     C                     END                                            S01383
     C           @RTCD     IFEQ *BLANK                                    S01383
     C                     MOVEL'Y'       S01383  1                       S01383
     C                     END                                            S01383
     C*                                                                   S01383
     C** IF BRT SAR INSTALLED, ACCESS BRT INSTALLATION CONTROL DATA       S01383
     C*                                                                   S01383
     C           S01383    IFEQ 'Y'                                       S01383
     C                     MOVE 'D'       BRTKEY  1                       S01383
     C           BRTKEY    CHAINSDBRTDD0             61                   S01383
     C*                                                                   S01383
     C** if *in61 is on, then it is a data base error                     S01383
     C*                                                                   S01383
     C           *IN61     IFEQ '1'                                       S01383
     C           RECI      ORNE 'D'                        ***************S01383
     C                     MOVEL'SDBRTDPD'DBFILE           * DBERROR 907 *S01383
     C                     MOVEL'907'     DBASE            ***************S01383
     C                     MOVELBRTKEY    DBKEY                           S01383
     C                     EXSR #Z                                        S01383
     C                     END                                            S01383
     C                     END                                            S01383
      *                                                                   CEU003
      ** Check if CEU003 is switched *ON.                                 CEU003
      *                                                                   CEU003
     C                     CALL 'AOSARDR0'                                CEU003
     C                     PARM *BLANKS   @RTCD   7                       CEU003
     C                     PARM '*VERIFY' @OPTN   7                       CEU003
     C                     PARM 'CEU003'  @SARD   6                       CEU003
     C           SCSARD    PARM SCSARD    DSFDY                           CEU003
      *                                                                   CEU003
     C           @RTCD     IFEQ *BLANKS                                   CEU003
     C                     MOVE 'Y'       CEU003  1                       CEU003
     C                     ELSE                                           CEU003
     C                     MOVE 'N'       CEU003                          CEU003
      *                                                                   CEU003
     C           @RTCD     IFNE '*NRF   '                                 CEU003
     C                     MOVEL'SCSARDPD'DBFILE                          CEU003
     C                     MOVEL'CEU003  'DBKEY                           CEU003
     C                     MOVEL'907'     DBASE                           CEU003
     C                     EXSR #Z                                        CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
      ** Check if S01434 is switched *ON.                                 CEU003
      *                                                                   CEU003
     C                     CALL 'AOSARDR0'                                CEU003
     C                     PARM *BLANKS   @RTCD   7                       CEU003
     C                     PARM '*VERIFY' @OPTN   7                       CEU003
     C                     PARM 'S01434'  @SARD   6                       CEU003
     C           SCSARD    PARM SCSARD    DSFDY                           CEU003
      *                                                                   CEU003
     C           @RTCD     IFEQ *BLANKS                                   CEU003
     C                     MOVE 'Y'       S01434  1                       CEU003
     C                     ELSE                                           CEU003
     C                     MOVE 'N'       S01434                          CEU003
      *                                                                   CEU003
     C           @RTCD     IFNE '*NRF   '                                 CEU003
     C                     MOVEL'SCSARDPD'DBFILE                          CEU003
     C                     MOVEL'S01434  'DBKEY                           CEU003
     C                     MOVEL'908'     DBASE                           CEU003
     C                     EXSR #Z                                        CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
     C/COPY WNCPYSRC,MM0078C022
      *                                                                   CEU003
      ** Access AOSARDR0 to check if CEU015 is installed                  CEU015
      *                                                                   CEU015
     C                     CALL 'AOSARDR0'                                CEU015
     C                     PARM *BLANKS   @RTCD   7                       CEU015
     C                     PARM '*VERIFY' @OPTN   7                       CEU015
     C                     PARM 'CEU015'  @SARD   6                       CEU015
      *                                                                   CEU015
     C           @RTCD     IFNE *BLANKS                                   CEU015
     C           @RTCD     ANDNE'*NRF   '                  **********     CEU015
     C                     MOVEL'SCSARDPD'DBFILE           *  50    *     CEU015
     C                     MOVEL'050'     DBASE            **********     CEU015
     C                     MOVEL'CEU015'  DBKEY                           CEU015
     C                     EXSR #Z                                        CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
     C           @RTCD     IFEQ *BLANKS                                   CEU015
     C                     MOVE 'Y'       CEU015  1                       CEU015
     C                     ELSE                                           CEU015
     C                     MOVE 'N'       CEU015                          CEU015
     C                     ENDIF                                          CEU015
     C/COPY WNCPYSRC,MMH00193
      *                                                                   CEU015
      ** CALL ACCESS PROG. FOR GENERAL DETAILS.                           CEU015
      *                                                                   CEU015
     C**********           CALL 'AOGELRR0'                                             CEU015 CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       CEU015
     C                     PARM '*FIRST ' @OPTN   7                       CEU015
     C********** SDGELR    PARM SDGELR    DSFDY                                        CEU015 CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
      *                                                                   CEU015
     C           @RTCD     IFNE *BLANK                                    CEU015
     C                     MOVEL'SDGELRPD'DBFILE           **********     CEU015
     C                     MOVEL'051'     DBASE            *  51    *     CEU015
     C                     MOVEL@OPTN     DBOPTN           **********     CEU015
     C                     EXSR #Z                                        CEU015
     C                     ENDIF                                          CEU015
     C*                                                                   S01319
     C**  READ DTAARA/RUNDAT to access MULTI-BRANCHING flag.              S01117
     C           *NAMVAR   DEFN           RUNDAT                          S01117
     C                     IN   RUNDAT                                    S01117
     C*
     C***CALL S/R TO ACCESS ICD FILE                                      S01194
     C*******              EXSR ZA0150                                    S01194
     C*******                                                             S01194
     C****CHECK FOR DATABASE ERROR                                        S01194
     C*******    *IN80     CASEQ'1'       #Z                              S01194
     C*******              END                                            S01194
     C*******                                                             S01194
     C***Set*up key to obtain format TABTB11F '01        11'              S01194
     C*******              MOVEL'01'      SS0150                          S01194
     C*******              MOVE '11'      SS0150                          S01194
     C*******                                                             S01194
     C***CHAIN TO FILE FDICDRLL                                           S01194
     C*******    SS0150    CHAINFDICDRLL             61                   S01194
     C*******    *IN61     IFEQ '1'                        B1             S01194
     C*******    RECI      ORNE 'D'                        ***************S01194
     C*********            MOVEL'FDICDRLL'DBFILE           *             *S01194
     C*********            MOVEL'901'     DBASE            * DBERROR 901 *S01194
     C*********            MOVELSS0150    DBKEY            *             *S01194
     C*********            EXSR #Z                         *              S01194
     C*********            END                             ***************S01194
     C*********                                                           S01194
     C***Set*up key to obtain format TABTB10F '01        20'              S01194
     C*********            MOVEL'01'      SS0150                          S01194
     C*********            MOVE '20'      SS0150                          S01194
     C*********                                                           S01194
     C***CHAIN*TO FILE FDICDRLL                                           S01194
     C*********  SS0150    CHAINFDICDRLL             61                   S01194
     C*********  *IN61     IFEQ '1'                        B1             S01194
     C*********  RECI      ORNE 'D'                        ***************S01194
     C*********            MOVEL'FDICDRLL'DBFILE           *             *S01194
     C*********            MOVEL'902'     DBASE            * DBERROR 902 *S01194
     C*********            MOVELSS0150    DBKEY            *             *S01194
     C*********            EXSR #Z                         *              S01194
     C*********            END                             ***************S01194
     C*
     C**  INITIALISE DATA STRUCTURE NUMERIC FIELDS
     C                     Z-ADD*ZERO     HKORCM
     C                     Z-ADD*ZERO     HLORCM
     C                     Z-ADD*ZERO     HMORCM
     C                     Z-ADD*ZERO     HKMOPM
     C                     Z-ADD*ZERO     HLMOPM
     C                     Z-ADD*ZERO     HNMOPM
     C*
     C*******              Z-ADD*ZERO     I1BRKI                          E14377
     C*******              Z-ADD*ZERO     I1BRKD                          E14377
     C*********************MOVE**ALL'9'***I1BRKI********************E14377S01319
     C*********************MOVE**ALL'9'***I1BRKD********************E14377S01319
     C********************************************************************S01319
     C*********************Z-ADD*ZERO*****I1IMTI**************************S01319
     C*********************Z-ADD*ZERO*****I1IMTD**************************S01319
     C********************************************************************S01319
     C*********************Z-ADD*ZERO*****I1AMNI**************************S01319
     C*********************Z-ADD*ZERO*****I1AMND**************************S01319
     C********************************************************************S01319
     C*********************Z-ADD*ZERO*****@NUM1***************************S01319
     C*********************Z-ADD*ZERO*****@NUM2***************************S01319
     C*********************Z-ADD*ZERO*****@NUM3***************************S01319
     C*********************Z-ADD*ZERO*****@NUM4***************************S01319
     C*********************Z-ADD*ZERO*****@I1IAY**************************S01319
     C*********************Z-ADD*ZERO*****@I1DDY**************************S01319
     C*********************Z-ADD*ZERO*****@I1DTY**************************S01319
     C*********************Z-ADD*ZERO*****@I1VDY**************************S01319
     C*
     C                     Z-ADD*ZERO     @HMNIY
     C                     Z-ADD*ZERO     @HMLIY
     C                     Z-ADD*ZERO     @HMMDY
     C*
     C                     Z-ADD*ZERO     @HNVDY
     C                     Z-ADD*ZERO     @HNDTY
     C                     Z-ADD*ZERO     @NDMDY
     C*
     C*********************Z-ADD*ZERO*****I2AMNI**************************S01319
     C*********************Z-ADD*ZERO*****I2AMND**************************S01319
     C********************************************************************S01319
     C*********************Z-ADD*ZERO*****@I2VDY**************************S01319
     C*********************Z-ADD*ZERO*****@I2DTY**************************S01319
     C*********************Z-ADD*ZERO*****@I2DDY**************************S01319
     C*********************Z-ADD*ZERO*****@I2OSY**************************S01319
     C*********************Z-ADD*ZERO*****@I2OMY**************************S01319
     C*
      *                                                                                       CDL013
      ***   Check if CAR CDL013 is installed                                                  CDL013
      *                                                                                       CDL013
     C                     CALL 'AOSARDR0'                                                    CDL013
     C                     PARM *BLANKS   @RTCD   7                                           CDL013
     C                     PARM '*VERIFY' @OPTN   7                                           CDL013
     C                     PARM 'CDL013'  @SARD   6                                           CDL013
     C                     PARM           DSFDY                                               CDL013
      *                                                                                       CDL013
      ***   CAR CDL013 is installed                                                           CDL013
      *                                                                                       CDL013
     C           @RTCD     IFEQ *BLANKS                                                       CDL013
     C                     MOVE '1'       CDL013  1                                           CDL013
     C                     OPEN SDSTAAL1                                                      CDL013
      *                                                                                       CDL013
      ***   CAR CDL013 is not installed                                                       CDL013
      *                                                                                       CDL013
     C                     ELSE                                                               CDL013
     C                     MOVE '0'       CDL013                                              CDL013
     C                     END                                                                CDL013
      *                                                                                       CDL013
      ** Check if CDL081 is installed                                                         CDL081
      *                                                                                       CDL081
     C                     MOVE 'N'       CDL081  1                                           CDL081
     C                     CALL 'AOSARDR0'                                                    CDL081
     C                     PARM *BLANKS   PRTCD   7                                           CDL081
     C                     PARM '*VERIFY' POPTN   7                                           CDL081
     C                     PARM 'CDL081'  PSARD   6                                           CDL081
     C           SCSARD    PARM SCSARD    DSFDY                                               CDL081
      *                                                                                       CDL081
     C           PRTCD     IFNE *BLANKS                                                       CDL081
     C           PRTCD     ANDNE'*NRF   '                                                     CDL081
     C                     MOVEL'075'     DBASE                                               CDL081
     C                     MOVEL'SCSARDPD'DBFILE                                              CDL081
     C                     MOVEL'CDL081'  DBKEY                                               CDL081
     C                     EXSR #Z                                                            CDL081
     C                     END                                                                CDL081
      *                                                                                       CDL081
     C           PRTCD     IFEQ *BLANKS                                                       CDL081
     C                     MOVE 'Y'       CDL081                                              CDL081
     C                     ENDIF                                                              CDL081
      *                                                                                       CDL081
      ** Access withholding tax round down system values if CDL081 is on                      CDL081
      *                                                                                       CDL081
     C           CDL081    IFEQ 'Y'                                                           CDL081
     C                     CALL 'AOSVALR0'                                                    CDL081
     C                     PARM *BLANKS   PRTCD                                               CDL081
     C                     PARM C#BASE    SVALK1 20                                           CDL081
     C                     PARM           SVAL1 200                                           CDL081
     C                     PARM C#NBAS    SVALK2 20                                           CDL081
     C                     PARM           SVAL2 200                                           CDL081
     C                     PARM *BLANK    SVALK3 20                                           CDL081
     C                     PARM           SVAL3 200                                           CDL081
     C                     PARM *BLANK    SVALK4 20                                           CDL081
     C                     PARM           SVAL4 200                                           CDL081
     C                     PARM *BLANK    SVALK5 20                                           CDL081
     C                     PARM           SVAL5 200                                           CDL081
     C                     PARM *BLANK    SVALK6 20                                           CDL081
     C                     PARM           SVAL6 200                                           CDL081
     C                     PARM *BLANK    SVALK7 20                                           CDL081
     C                     PARM           SVAL7 200                                           CDL081
     C                     PARM *BLANK    SVALK8 20                                           CDL081
     C                     PARM           SVAL8 200                                           CDL081
     C                     PARM *BLANK    SVALK9 20                                           CDL081
     C                     PARM           SVAL9 200                                           CDL081
     C                     PARM *BLANK    SVALK0 20                                           CDL081
     C                     PARM           SVAL10200                                           CDL081
      *                                                                                       CDL081
     C           PRTCD     IFNE *BLANKS                                                       CDL081
     C                     MOVEL'076'     DBASE                                               CDL081
     C                     MOVEL'SDSVALPD'DBFILE                                              CDL081
     C           SVAL1     IFEQ '*NRF'                                                        CDL081
     C                     MOVELSVALK1    DBKEY                                               CDL081
     C                     ENDIF                                                              CDL081
     C           SVAL2     IFEQ '*NRF'                                                        CDL081
     C                     MOVELSVALK2    DBKEY                                               CDL081
     C                     ENDIF                                                              CDL081
     C                     EXSR #Z                                                            CDL081
     C                     ENDIF                                                              CDL081
      *                                                                                       CDL081
      ** Setup tax amount rounding down indicators                                            CDL081
      *                                                                                       CDL081
     C                     MOVELSVAL1     W#BSRD  1                                           CDL081
     C                     MOVELSVAL2     W#NBRD  1                                           CDL081
     C                     ENDIF                                                              CDL081
      *                                                                                     MD035545
      ** Retrieve system value setting                                                      MD035545
      *                                                                                     MD035545
     C                     MOVELWPARML    P@OP01                                            MD035545
     C                     CALL 'AOSVALR0'                                                  MD035545
     C                     PARM *BLANKS   W0RTCD  7                                         MD035545
     C                     PARM           P@OP01 20                                         MD035545
     C                     PARM           P@VL01200                                         MD035545
     C                     PARM           P@OP02 20                                         MD035545
     C                     PARM           P@VL02200                                         MD035545
     C                     PARM           P@OP03 20                                         MD035545
     C                     PARM           P@VL03200                                         MD035545
     C                     PARM           P@OP04 20                                         MD035545
     C                     PARM           P@VL04200                                         MD035545
     C                     PARM           P@OP05 20                                         MD035545
     C                     PARM           P@VL05200                                         MD035545
     C                     PARM           P@OP06 20                                         MD035545
     C                     PARM           P@VL06200                                         MD035545
     C                     PARM           P@OP07 20                                         MD035545
     C                     PARM           P@VL07200                                         MD035545
     C                     PARM           P@OP08 20                                         MD035545
     C                     PARM           P@VL08200                                         MD035545
     C                     PARM           P@OP09 20                                         MD035545
     C                     PARM           P@VL09200                                         MD035545
     C                     PARM           P@OP10 20                                         MD035545
     C                     PARM           P@VL10200                                         MD035545
      *                                                                                     MD035545
      ** If system value is not found then default value to 'N'                             MD035545
      *                                                                                     MD035545
     C           W0RTCD    IFNE '       '                                                   MD035545
     C                     MOVE 'N'       WCALC6                                            MD035545
     C                     ELSE                                                             MD035545
     C                     MOVELP@VL01    WCALC6                                            MD035545
     C********** WCALC6    IFEQ 'Y'                                                MD035545 MD047993
     C********** BKALDI    ANDEQ'Y'                                                MD035545 MD047993
     C**********           MOVE 'Y'       WCALC6                                   MD035545 MD047993
     C**********           ELSE                                                    MD035545 MD047993
     C**********           MOVE 'N'       WCALC6                                   MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
     C                     ENDIF                                                            MD035545
     C*                                                                   S01408
     C/COPY WNCPYSRC,MM0078CEIP                                           S01408
     C*                                                                   S01408
     C           #A9       ENDSR                           ***#A9***
     C*
     C/EJECT
     C*****************************************************************
     C***********                                                     *   S01194
     C***SUBROUTINE ZA0150 - THIS SUBROUTINE CHAINS TO FILE LF        *   S01194
     C***FDICDRLL*TO GET THE INSTALLATION CONTROL DETAILS RECORD 1    *   S01194
     C***(HELD*ON*PF/TABTB10)                                         *   S01194
     C***INDICATOR 80 IS SET ON IF THE CHAIN FAILS OR THE RECORD IS   *   S01194
     C***FLAGGED*FOR DELETION.                                        *   S01194
     C***IF*INDICATOR 80 IS SET ON DETAIL                             *   S01194
     C***ARE*PLACED IN THE LDA.                                       *   S01194
     C*********                                                       *   S01194
     C***FIELDS*USED : SS0150 - KEY USED TO ACCESS FDICDRLL           *   S01194
     C*********                                                       *   S01194
     C*****************************************************************   S01194
     C*********                                                           S01194
     C*********  ZA0150    BEGSR                                          S01194
     C*********                                                           S01194
     C***Set up key to obtain format TABTB10F '01        10'              S01194
     C*********            MOVEL'01'      SS0150 12                       S01194
     C*********            MOVE '10'      SS0150                          S01194
     C*********                                                           S01194
     C***CHAIN TO FILE FDICDRLL                                           S01194
     C*********  SS0150    CHAINFDICDRLL             80                   S01194
     C*********  RECI      IFNE 'D'                        B1             S01194
     C*********            MOVE '1'       *IN80            *1             S01194
     C*********            END                             E1             S01194
     C*********                                                           S01194
     C***DEAL WITH DATA BASE ERROR                                        S01194
     C*********  *IN80     IFEQ '1'                        ***************S01194
     C*********            MOVEL'FDICDRLL'DBFILE           *             *S01194
     C*********            MOVEL'900'     DBASE            * DBERROR 900 *S01194
     C*********            MOVELSS0150    DBKEY            *             *S01194
     C*********            END                             ***************S01194
     C*********                                                           S01194
     C*********  ZA0159    ENDSR                                          S01194
     C/EJECT
     C*****************************************************
     C*                                                   *
     C*   EXCEPTION ERROR SUBROUTINE                      *
     C*                                                   *
     C*   SUBROUTINE CALLED: EXECUTES WHENEVER            *
     C*   A DATABASE FILE ERROR OCCURS                    *
     C*                                                   *
     C*   SUBROUTINE CALLS : NO OTHER SUBROUTINES         *
     C*                                                   *
     C*****************************************************
     C           #Z        BEGSR
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE 'E'       @TERM
     C                     MOVEL'MM0078'  DBPGM
     C                     MOVE '1'       *INLR
     C                     DUMP
     C*
     C**  TERMINATE THE PROGRAM
     C                     RETRN
     C*
     C                     ENDSR                           ***#Z***
     C/EJECT
     C*****************************************************
     C*                                                   *
     C*   EXCEPTION ERROR SUBROUTINE                      *
     C*                                                   *
     C*   SUBROUTINE CALLED: EXECUTES WHENEVER            *
     C*   A PROGRAM ERROR OCCURS                          *
     C*                                                   *
     C*   SUBROUTINE CALLS : NO OTHER SUBROUTINES         *
     C*                                                   *
     C*****************************************************
     C           *PSSR     BEGSR
     C*
     C**  SET @ERR1 TO 'Y' TO PREVENT LOOPING IF FURTHER ERRORS
     C           @ERR1     IFNE 'Y'                        B1
     C                     MOVE 'Y'       @ERR1   1        *1
     C                     MOVE '1'       *INU6            *1
     C                     MOVE 'E'       @TERM            *1
     C*
     C**  SET UP FIELDS IN LOCAL DATA AREA
     C                     MOVEL'MM0078'  DBPGM            *1
     C                     MOVE '991'     DBASE            *1
     C*
     C                     MOVE '1'       *INLR
     C                     DUMP                            *1
     C                     END                             E1
     C*
     C**  TERMINATE THE PROGRAM
     C                     RETRN
     C*
     C                     ENDSR                           ****PSSR****
     C/EJECT
     C*****************************************************
     C*                                                   *
     C*   EXCEPTION ERROR SUBROUTINE                      *
     C*                                                   *
     C*   SUBROUTINE CALLED: EXECUTES WHENEVER            *
     C*   A FILE ERROR OCCURS                             *
     C*                                                   *
     C*   SUBROUTINE CALLS : NO OTHER SUBROUTINES         *
     C*                                                   *
     C*****************************************************
     C           INFSR     BEGSR
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE 'E'       @TERM
     C*
     C**  SET UP FIELDS IN LOCAL DATA AREA
     C                     MOVEL'MM0078'  DBPGM
     C                     MOVE '992'     DBASE
     C                     MOVE @FILE     DBFILE
     C*
     C                     MOVE '1'       *INLR
     C                     DUMP
     C*
     C**  TERMINATE THE PROGRAM
     C                     RETRN
     C*
     C                     ENDSR                           ***INFSR***
     C/EJECT
      *****************************************************************   056095
      *   The array @YD and @MD are now being used by SR. ZDATE9      *   056095
      *   before they are being used by SR. ZA0680.  The actual       *   056095
      *   changes were only made on the text, ZA0680 was changed      *   056095
      *   to ZDATE9.                                                  *   056095
      *****************************************************************   056095
**
(c) Finastra International Limited 2001
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
**  TAB3  TAB4
IT IT
IP IP
TD TD
TL TI
CT CD
CP CL
CI CI
CL LN
DL DL
IL IL                                                                     S01354
ID ID                                                                     S01354
C1BC1
C1SCS
C2BC2
C2SCS
BOBBP
BOSBS
BIBBD
BISBR
TBBTB
TBSTS
BABDA
BASRA
TABTA
TASTR
** @M  USED BY SR. MM1004 - DAYS IN A MONTH
312831303130313130313031
