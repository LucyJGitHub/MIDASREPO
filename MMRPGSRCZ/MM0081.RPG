     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas MM Deals update')                                *
     F*****************************************************************
     F*                                                               *
     F*  Midas - MM Dealer Module                                     *
     F*                                                               *
     F*     This program will be made redundant at DBA R4.00          *
     F*     In the interim please check the new ILE RPG versions      *
     F*     and apply any new fixes if they are appropriate.          *
     F*                                                               *
     F*  MM0081 - MIDAS DEALS UPDATE                                  *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. MD047993           Date 23Sep17               *
      *  Prev Amend No. MD035545           Date 11Sep15               *
      *                 CGL165             Date 17Feb15               *
      *                 CDL096             Date 22Sep14               *
      *                 AR996895           Date 25Nov12               *
      *                 CRE073             Date 06Dec10               *
      *                 263666             Date 01Feb10               *
      *                 CER059             Date 19Jul10               *
      *                 CER054             Date 07Apr09               *
      *                 CER016A            Date 19May08               *
      *                 CER048             Date 19May08               *
      *                 CER020             Date 19May08               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 255251             Date 03Jul08               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 246141             Date 26Mar07               *
      *                 164847             Date 30Nov06               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242286             Date 25Sep06               *
      *                 CSD031             Date 10Apr06               *
      *                 CDL049             Date 11Jul06               *
      *                 CSD027             Date 09Dec05               *
      *                 CIR013             Date 25Apr05               *
      *                 CAS009             Date 16May05               *
      *                 CDL038             Date 10May05               *
      *                 CDL033             Date 10Feb05               *
      *                 CGL014             Date 20Oct03               *
      *                 CDL022             Date 03Feb04               *
      *                 CDL020             Date 03Feb04               *
      *                 CDL019             Date 03Feb04               *
      *                 CDL018             Date 03Feb04               *
      *                 CDL017             Date 03Feb04               *
      *                 CDL016             Date 03Feb04               *
      *                 CGL029             Date 01Sep03               *
      *                 222727             Date 05Nov03               *
      *                 CAS005             Date 16Dec02               *
      *                 CDL010             Date 02Aug02               *
      *                 073399             Date 17Nov94               *
      *                 CAS004             Date 26Jun02               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CSD006             Date 15May01               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 154018             Date 31Oct00               *
      *                 CDL008             Date 02May00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CSW200             Date 21Aug00               *
      *                 CIR004             Date 20Jan00               *
      * Midas DBA 3.02 -----------------------------------------------*
     F*                 CPB001             DATE 18Jun99               *
     F*                 143058             Date 05Oct99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 163136             Date 07Jul99               *
     F*                 145001             Date 19Oct98               *
     F*                 CEU015             Date 19Jun98               *
     F*                 123133             Date 16Jun98               *
     F*                 CEU003             DATE 29Mar98               *
     F*                 116730             DATE 26FEB98               *
     F*                 106071             DATE 24Feb98               *
     F*                 109994             DATE 28JAN98               *
     F*                 079592             DATE 29DEC94               *
     F*                 079589             DATE 14JAN98              *
     F*                 S01408             DATE 29SEP97               *
     F*                 097885             DATE 03FEB97               *
     F*                 S01408             DATE 30AUG96               *
     F*                 S01408             DATE 23AUG96               *
     F*                 098319             DATE 30JUL96               *
     F*                 CAC001             DATE 01FEB96               *
     F*                 102286             DATE 13JUN96               *
     F*                 096087             DATE 17JAN96               *
     F*                 095244             DATE 01NOV95               *
     F*                 095238             DATE 31OCT95               *
     F*                 091448             DATE 17AUG95               *
     F*                 S01408             DATE 20OCT95               *
     F*                 085624             DATE 21JUN95               *
     F*                 085621             DATE 21JUN95               *
     F*                 083201             DATE 20APR95               *
     F*                 082908             DATE 09MAR95               *
     F*                 080587             DATE 17FEB95               *
     F*                 079140             DATE 20DEC94               *
     F*                 081540             DATE 01FEB95               *
     F*                 080570             DATE 26JAN95               *
     F*                 S01486             DATE 28OCT94               *
     F*                 060712             DATE 13JUL94               *
     F*                 058890             DATE 16MAY94               *
     F*                 051496             DATE 04MAY94               *
     F*                 056211             DATE 01FEB94               *
     F*                 055272             DATE 27JAN94               *
     F*                 051154             DATE 26JAN94               *
     F*                 056121             DATE 04NOV93               *
     F*                 057349             DATE 28OCT93               *
     F*                 061426             DATE 30SEP93               *
     F*                 S01434             DATE 20AUG93               *
     F*                 S01408             DATE 22JUL93               *
     F*                 056095             DATE 07JUN93               *
     F*                 048458             DATE 23APR93               *
     F*                 E38449             DATE 16FEB93               *
     F*                 E50740             DATE 10FEB93               *
     F*                 E49965             DATE 01FEB93               *
     F*                 E34538             DATE 11DEC92               *
     F*                 E29678             DATE 24NOV92               *
     F*                 E29097             DATE 24NOV92               *
     F*                 S01378             DATE 09APR92               *
     F*                 S01392             DATE 20JUL92               *
     F*                 AUS007             DATE 13JUL92               *
     F*                 S01383             DATE 27APR92               *
     F*                 E28506             DATE 29JAN92               *
     F*                 S01354             DATE 10JAN92               *
     F*                 BH1086             DATE 27AUG91               *
     F*                 BH1069             DATE 27AUG91               *
     F*                 E26971             DATE 13AUG91               *
     F*                 E25356             DATE 12AUG91               *
     F*                 E24202             DATE 29JUL91               *
     F*                 E24311             DATE 29JUL91               *
     F*                 E25199             DATE 02JUL91               *
     F*                 RT0150             DATE 12JUN91               *
     F*                 BHF910             DATE 10JAN91               *
     F*                 BHF893             DATE 01NOV90               *
     F*                 DT0058             DATE 04APR91               *
     F*                 DT0015             DATE 20MAR91               *
     F*                 E23850             DATE 11OCT90               *
     F*                 E22147             DATE 09OCT90               *
     F*                 E22475             DATE 31AUG90               *
     F*                 E21316             DATE 21AUG90               *
     F*                 E21923             DATE 22JUL90               *
     F*                 E21206             DATE 29JUN90               *
     F*                 E18239             DATE 29JUN90               *
     F*                 BHF772             DATE 05OCT90               *
     F*                 BHF750             DATE 05OCT90               *
     F*                 BHF706             DATE 27SEP90               *
     F*                 E22405             DATE 16AUG90               *
     F*                 E19602             DATE 23OCT89               *
     F*                 E19013             DATE 23OCT89               *
     F*                 E16044             DATE 23OCT89               *
     F*                 S01127             DATE 23/10/89              *
     F*                 S01176             DATE 23/10/89              *
     F*                 E18497             DATE 23/10/89              *
     F*                 E18380             DATE 23/10/89              *
     F*                 E16046             DATE 06/03/89              *
     F*                 S01194             DATE 12/09/89              *
     F*                 S01117             DATE 05/06/89              *
     F*                 S01195             DATE 05/06/89              *
     F*                 S01177             DATE 05/06/89              *
     F*                 E14393             DATE 17/10/88              *
     F*                 E14368             DATE 03/08/88              *
     F*                 E14377             DATE 02/08/88              *
     F*                 E14356             DATE 27/07/88              *
     F*                 E14026             DATE 05/07/88              *
     F*                 S01165             DATE 05/10/88              *
     F*                 E12564             DATE 12/04/88              *
     F*                 E12189             DATE 22/02/88              *
     F*                 E12279             DATE 28/03/88              *
     F*                 S01136             DATE 29/10/87              *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  MD047993 - Modified MD035545. Removed dependency on Accrue   *
      *             on Last Day indicator.                            *
      *  MD035545 - LE: Interest Calculation in Leap year. Consider   *
      *             Accrue on Last Day Indicator for method 6.        *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  AR996895 - Incorrect accrual interest calculation            *
      *             (Child:AR996897) (Recompile)                      *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER054 - German Features - Church Tax (Recompile)            *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *           to Midas Plus                                       *
      *  CER048 - German Features - Taxes (Recompile)                 *
      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
      *           Midas Plus (Recompile)                              *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  255251 - Deal amendment written with wrong sign on           *
      *           amendment amount. Should not use @S for             *
      *           conditioning sign of amount, this is used only      *
      *           for determining pay/receive details.                *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over ZINTDY.                              *
      *  CAS009 - EIR/AC Accounting (Recompile)                       *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CDL033 - Floating Rate CDs Issued                            *
      *  CGL014 - Collaterals Processing (Recompile)                  *
      *  CDL022 - Deal Amendment Changes (Recompile)                  *
      *  CDL020 - Apply Base Rate at Value Date (Recompile)           *
      *  CDL019 - Allow Base Rate Changes on Fixed Deposits/Loans     *
      *           (Recompile)                                         *
      *  CDL018 - Multiple Settlement Accounts on Loans/Deposits      *
      *           (Recompile)                                         *
      *  CDL017 - Penalty Fee & Early Maturity of Fixed Term Loan/Dep *
      *           (Recompile)                                         *
      *  CDL016 - Automatic rollover of Fixed Term Loans/Deposits     *
      *           (Recompile)                                         *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222727 - Release 5.0 errors  (Recompile)                     *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *           (Recompile)                                         *
      *  CDL010 - Prevent last user that actioned the trade from      *
      *           authorising it.Recompile due to changes in MMDEAMPP *
      *           , MMDELDPP, MMDENBPP AND MMDENSPP .                 *
      *  073399 - Remove fix 022147.                                  *
      *  CAS004 - Hedge Accounting Phase A (Recompile)                *
      *  CSD006 - Use long DS with SDBSRTPD.                          *
      *  154018 - Incorrect Forward Sales for Money Market Deals.     *
      *           Addendum to fix 116730, incorrect forward sale was  *
      *           caused on the truncation of the parcel size during  *
      *           re-authorisation.                                   *
      *  CDL008 - Continuous Linked Settlement (recompile DEALSDB)    *
     F*  CSW200 - SWIFT2000 enhancement                               *
      *  CIR004 - Dealing Calculation Method Change                   *
      *         - Recompiled due to ZINTDY changes                    *
     F*  CPB001 - 'Private Banking' Module                            *
     F*  143058 - Applied fix 109681:                                 *
     F*           Set 'confirmation required' indicator always to 'Y' *
     F*           for cancellation, even if 'insert' confirmation     *
     F*           not yet printed                                     *
     F*  163136 - Interest Calculation Method '6'  showing incorrect -*
     F*           ZERO - amount . Addition to Core #126017 which dealt*
     F*           with the issue. It introduced an additional  INT6DY *
     F*           field in s-routine ZINTDY in  /COPY ZSRSRC/ZINTDYZ2 *
     F*           which in turn is usually called from GLINTC s-routine
     F*           in /COPY  ZSRSRC/ GLINTCZ1 .  However, there are at *
     F*           least a dozen other pgms that use ZINTDY but do     *
     F*           GLINTC-processing within the pgms calculation specs *
     F*  145001 - CEU015 fix: Update the RBDA of the rolled over deal *
     F*           by IKORDA ('IN' Ccy equivalent of IKAMNP) rather    *
     F*           than principal amt (IKAMNP) of the rollover deal.   *
     F*  CEU015 - Amended to write the new field 'Rollover to/from    *
     F*           Currency' to DEALSDC for rollover deals.            *
     F*  123133 - Don't set Customer Number to BICN for CI Deals.     *
     F*  CEU003 - EMU Dealing Settlement Ccy conversion.              *
     F*  116730 - IF MORE THAN 2 DEAL AMENDMENTS EXIST FOR ONE SAME   *
     F*           DEAL I.E (SAME VALUE DATE) IN DEAMSDI , THE PROGRAM *
     F*           UPDATED LAWAYS THE FIRST LIVE DEAL AMENDEMENT AND   *
     F*           NOT THE PREVIOUS ONE AS INDICATED IN THE PROGRAM .  *
     F*           (APPLY FIX E4398)                                   *
     F*                                                               *
     F*  079592 - 'New' Confirmation not printed for Internal Funding *
     F*           deals, because settlement method is always '00'.    *
     F*           'Amend' confirmation is produced correctly. Fix is  *
     F*           to set CNRQ to 'Y' in pgm for IL/ID daels.          *
     F*  106071 - Parcel size > 999 truncated to 3 right most digits. *
     F*  109994 - If a rollover deal is deleted then reset the        *
     F*           rollover warning indicator on the maturing deal     *
     F*           to ensure it is reported on MM5530 Rollover         *
     F*           Warning report.                                     *
     F*  079589 - No confirmation after amending settlement from      *
     F*           SWIFT to retail account, and SWIFT cancellation     *
     F*           message not produces, if deal required re-authoris'n*
     F*           after amendment. Fix is to check whether Confs and  *
     F*           Pay/Receives required before updating the back      *
     F*           office files, so that on authorisation the correct  *
     F*           values are accessed.                                *
     F*  S01408 - Hooks MM0081CCP6 and MM0081C016 were in the wrong   *
     F*           position in DBA2. To avoid upgrade problems they    *
     F*           were repositioned in DBA2 to match the original     *
     F*           positions in 10.6 the extra hooks inserted to fill  *
     F*           the gaps.                                           *
     F*         - Apply Core Hook MM0081C020                          *
     F*         - Apply Core Hook MM0081C021                          *
     F*         - Apply Core Hook MM0081C022                          *
     F*  097885 - Recompiled for wrong calculation of number of day   *
     F*           interest (ZINTDYZ2).                                *
     F*  S01408 - Apply Core Hook MM0081CCP7                          *
     F*         - Apply Core Hook MM0081CCP8                          *
     F*         - Apply Core Hook MM0081CCP9                          *
     F*         - Apply Core Hook MM0081CP10                          *
     F*         - Apply Core Hook MM0081CP11                          *
     F*         - Apply Core Hook MM0081CP12                          *
     F*         - Apply Core Hook MM0081CP13                          *
     F*         - Apply Core Hook MM0081CP14                          *
     F*         - Apply Core Hook MM0081CP15                          *
     F*         - Apply Core Hook MM0081CP16                          *
     F*         - Apply Core Hook MM0081EEP1                          *
     F*  S01408 - Apply Core Hook MM0081CPP6                          *
     F*  098319 - NA sold deal should get the related deal purchased  *
     F*           account sequence number                             *
     F*  CAC001 - Profit Centre Accounting Development:               *
     F*           The Midas deals files will be updated w/ the new    *
     F*           fields required for PCA.                            *
     F*  102286 - Reversal of a rollover deal causes DL6305 to fail   *
     F*           with d/b error at 001 in DEALS2 at 001, caused by   *
     F*           rollover deal number being zeroized on reversal.    *
     F*           Fix is to stop removal of RDNO in MM0081, and       *
     F*           ignore reversed deals in DL0110 and DL6305.         *
     F*  096087 - Array index error in ZF2C (RECOMPILE OVER ZF2C)     *
     F*  095244 - Recompiled for Calculation method 3                 *
     F*  095238 - Recompiled for Calculation method 3                 *
     F*  091448 - Interest Calculation incorrect for Dealing and      *
     F*           SWIFT confirmation when maturity date of deal       *
     F*           was amended                                         *
     F*  S01408 - Apply Core Hooks MM0081FFP1                         *
     F*                            MM0081CCP1                         *
     F*                            MM0081CCP2                         *
     F*                            MM0081CCP3                         *
     F*                            MM0081CCP4                         *
     F*                            MM0081CCP5                         *
     F*  085624 - IKROBY should be checked against *BLANKS            *
     F*  085621 - The conditioning of the maturity date of a deal and *
     F*           the telex notice days should apply to all deal types*
     F*           not just rollovers                                  *
     F*  083201 - Rolled over deal number must be set to 0 if deal    *
     F*           is reversed.                                        *
     F*  082908 - For deal amendments extend check introduced by      *
     F*           080570 (to regenerate pay/receives for deal         *
     F*           amendments only if settlement instructions have     *
     F*           changed) to include more settlement fields.         *
     F*           Also ensures that CVMR is updated for an amendment  *
     F*           to a deal amendment and is included in above check. *
     F*  080587 - Maturity swift payment messages are being produced  *
     F*           early. This is because PRI3 on DTRIXDD is being set *
     F*           on for any loan(@THDL=L) which is not automatically *
     F*           rolled over(IKAURO=N) and which has a maturity date *
     F*           after original entry date(ICMATD>=ORED. Code added  *
     F*           for enhanced rollovers does not work for all loans. *
     F*  079140 - WHEN SETING OFF PAY/RECEIVE INDICATORS, IF DEAL     *
     F*           IS A ROLLOVER WAS USING VALUE DATE OF ROLLED OVER   *
     F*           DEAL NOT VALUE DATE OF ROLLOVER DEAL                *
     F*  081540 - CVMR not being updated for deal amendment. E22405   *
     F*           applied incorrectly in SR #BD (after wrong ENDIF) - *
     F*           not updated for Pay Settlement Intruction           *
     F*  080570 - For Amendment to a deal amend ensure that deal      *
     F*           amendment indicator, field DAIN on DEAMSDI, is      *
     F*           reinitialised (all BITS off) for an amendment to a  *
     F*           deal amendment,so that DL1705 extracts a pay/receive*
     F*           record relating to this amendment                   *
     F*  S01486 - Portfolio Management Upgrade to Release 10.         *
     F*  060712 - Recompiled due to change in copy source ZF2C.       *
     F*  058890 - If currency is not equal to base ccy and telex      *
     F*           notice days are zero, payment messages are still    *
     F*           produced too early.                                 *
     F*  051496 - Assign processing sequence on insertion             *
     F*  056211 - Database error caused by rollover deal no being     *
     F*           entered as 000000.  Ignore rollover deal no if equal*
     F*           to zero.                                            *
     F*  055272 - Maturity date cannot be amended on date of input    *
     F*           as no history records exist which cause DBASE ERR.  *
     F*           Remove dbase processing.                            *
     F*  051154 - When deal maturity date is amended it is not        *
     F*           reflected on the interest history statements/       *
     F*           enquiry.                                            *
     F*  056121 - Pattern MM1030 subroutine with that of the MM0089   *
     F*           version.                                            *
     F*  057349 - Sale price of NA Sold was reflected as an "Inte-    *
     F*           rest Commitment" in Current Net Trading report      *
     F*           on dealt date.                                      *
     F*  061426 - Recompile after ZDATE9 correction                   *
     F*  S01434 - ENHANCED ROLLOVER PROCESSING                        *
     F*  S01408 - Core hook MM0081CPG added                           *
     F*  056095 - Interest not calculated consistently in MM.         *
     F*           SR. MM1009 was externally defined as ZINTDY,        *
     F*           while SR. ZA0710 and ZA0680 were replaced by        *
     F*           the externally defined standard SR. ZDATE9 and      *
     F*           ZDAT10, respectively.  Seventeen MM programs        *
     F*           were amended.                                       *
     F*  048458 - Update Base currency exchange rate when Amend       *
     F*  E38449 - When interest payment date is changed,              *
     F*           interest base date (IBDT) is not changed and        *
     F*           indicator (TLXI) bit 2 is not reset to 0 to         *
     F*           regenerate swift message for the new interest       *
     F*           date made if swift message had been produced        *
     F*           already for the old interest date.                  *
     F*  E50740 - DATABASE ERROR ON PRINCIPAL INCREASE OF DEPOSIT     *
     F*           TAKEN. RECEIVE ACCOUNT IS DEFINED, PAY IS NOT.      *
     F*  E49965 - BOOKING BRANCH ADDED TO DEAMSDI/MMDEAMPP            *
     F*  E34538 - Only create Pay/Receive messages for future         *
     F*           events ( thus being consistent with FX0380).        *
     F*  E29678 - Continuation of E29097.  Apply same logic for       *
     F*           NAS (PRI3 rather than PRI1) and do fix for          *
     F*           backvalued maturity and interest messages.          *
     F*           Also allow I/C maturity msgs for CD, CL & DL.       *
     F*  E29097 - If deal is backvalued, do not produce S.W.I.F.T     *
     F*           messages. (Also incorporates error fixes            *
     F*           ABS439 ABS341 from CBA).                            *
     F*  S01378 - Facilitates the partial sale of a parcel            *
     F*           of negotiable instruments which have been           *
     F*           previously input to the system as a single          *
     F*           transaction (was MOF53). Update Midas deals         *
     F*           files with parcel details                           *
     F*  S01392 - JAP.SUB-MODULE INCORPORATION (CORE)                 *
     F*  AUS007 - AUSTRALIAN PRODUCT - AUSTRALIAN BROKERAGE           *
     F*  S01383 - BASIC RATE TAX INCORPORATION                        *
     F*  E28506 - DEAMSDI INCORRECTLY UPDATED FOR SI AMENDMENT        *
     F*  S01354 - Process New Internal Deal types 'IL' & 'ID'         *
     F*  BH1086 - INTEREST DAY IS NOT UPDATED ON DEALSDD WHEN         *
     F*           IT IS AMENDED FOR A N.A. PURCHASED                  *
     F*  BH1069 - INCORRECT SEQ. NUMBER OUTPUT TO DTRIXDD WHEN        *
     F*           YOU DELETE A DEAL AMENDMENT AND THERE ARE           *
     F*           OTHER DEAL AMENDMENTS ON MMDEAMPP WITH A            *
     F*           NAAD = VDAT OF THIS AMENDMENT.  CAUSED COB          *
     F*           TO FALL OVER WITH FILE CONTROLS OUT OF BAL.         *
     F*  E26971 - If the Beneficiary field is not entered, it         *
     F*           should default to the same value as the             *
     F*           counterparty of the deal; in the case of            *
     F*           negotiable assets, however, Beneficiary is          *
     F*           always set to blanks; this can cause database       *
     F*           errors in DL1810.                                   *
     F*  E25356 - Amendment to prevent pay/receives being             *
     F*           generated if deals are backvalued.                  *
     F*           This change includes some duplication of            *
     F*           BHF706, and some new lines; the duplicated          *
     F*           lines were left as BHF706.                          *
     F*  E24202 - Interest Frequency & Day In Month are now           *
     F*           amendable for some deal types.  (This fix is to     *
     F*           make complete E22903 in MM0089.)                    *
     F*  E24311 - CONFIRMATION LETTERS NOT GENERATED FOR MONEY        *
     F*           MARKET (LOANS/DEPOSITS) DEALS AMENDMENTS.           *
     F*  E25199 - Update of Pay Frequency and Freq.Day not being      *
     F*           done on Pf/Dealsdc                                  *
     F*  RT0150 - RECOMPILE PROGRAM FOR CHANGE IN MMSTDSPP            *
     F*  BHF910 - WRONG FIELD MOVED INTO BTB1, CAUSING FIELD          *
     F*           72 TO BE BLANK WHEN AMEND SETTLE INSTRUCTIONS       *
     F*  BHF893 - BIT 2 NOT SET ON FOR FED FUNDS.  FED FUNDS WAS      *
     F*           NOT SHOWING UP ON DEAL CONFIRMATION AND ENQUIRY     *
     F*  DT0058 - UNABLE TO SETTLE INTEREST ON A CALL LOAN OR A       *
     F*           CALL DEPOSIT                                        *
     F*  DT0015 - RECOMPILED                                          *
     F*  E23850 - Allow deletion of deams other than those of         *
     F*           loans/deposits.                                     *
     F*  E22147 - Print ordinary and swift confirmations after        *
     F*           amendment.                                          *
     F*  E22475 - On reversing a deal which is already amended        *
     F*           the fields DAVD and DASN are not correctly          *
     F*           updated, resulting in a database error during       *
     F*           EOD.                                                *
     F*  E21316 - When negative interest indicator is 'Y',            *
     F*           program updates field INTR on DEALSDC as            *
     F*           a negative number, and RTSP as positive.            *
     F*  E21923 - Seton Pay/Receive Indicator if Event Date is        *
     F*           less than or equal to (Date of next working         *
     F*           day minus one plus Telex Notice Days).              *
     F*  E21206 - ERROR E16046 SHOULD ALSO COMPARE AGAINST            *
     F*           DEAL NUMBER '000000', AS DEALS TAKEON WILL HAVE     *
     F*           '000000' IN ASSOCIATED DEAL NUMBER FIELD.           *
     F*  E18239 - ERROR E14368 USED WRONG FIELD, SHOULD HAVE USED     *
     F*           ICDVSD AND NOT ILDVSD                               *
     F*  BHF772 - 'PAYMENT BY' ON RECEIVE SIDE OF CONFIRMATION        *
     F*           SAYS 'WE AWAIT YOU ADVICE' EVEN IF AN               *
     F*           INTERMEDIARY IS ENTERED ON THE RECEIVE SIDE OF      *
     F*           THE PAYMENT INSTRUCTIONS.                           *
     F*  BHF750 - START AND MATURITY COUNTERPARTY NOSTROS HAD THE     *
     F*           PAY AND RECEIVE INSTRUCTIONS CROSSED BETWEEN        *
     F*           TAKINGS AND PLACINGS. ERROR NOTICED WHILE DOING     *
     F*           CHIPS MESSAGE PRODUCTION.                           *
     F*  BHF706 - DEAL START DATE PRODUCING PAYMENT MESSAGE           *
     F*           FOR BACKVALUED START DATE DEALS.                    *
     F*  E22405 - Add new field to Extended Settlements.(Cover        *
     F*           MT202 required).                                    *
     F*  E19602 - IN #BA FIELD RODA NOW CORRECTLY FILLED BY           *
     F*           IKRBAT(RELATED DEAL AMOUNT FOR ROLL-OVER            *
     F*           DEAL).                                              *
     F*  E19013 - CHAIN TO  DEALSDC IN #BI NOW ALLOWS FOR CHAIN       *
     F*           FAIL WHEN A DELETED DEAL'S ROLLOVER IS ALSO         *
     F*           DELETED. (DB ERROR NOW REMOVED)                     *
     F*  E16044 - Notice day now changed to -999 in DEALSDC when      *
     F*           maturity date entered for call deals.               *
     F*  S01127 - Amended to include BILL-DEPOT ID field on           *
     F*           PF / DEALSDD for Financial Futures and Options      *
     F*           Module.                                             *
     F*  S01176 - Two new fields added (DRID and DDMR) onto the       *
     F*           Deals files.Securities Trading 3.1                  *
     F*  E18497 - When the pay/receive indicator is 'R', write        *
     F*           the special instructions to DEAMSDI                 *
     F*  E18380 - Program was recompiled with new formats for the     *
     F*           standard deal files. This stops the book code       *
     F*           and linked reference number fields from being       *
     F*           overwritten.                                        *
     F*  E16046 - TO STOP THE PRINCIPAL UPDATINGB THE ROLLOVER        *
     F*           AMOUNT WHEN THE DEAL IS NOT A ROLLOVER DEAL         *
     F*           (SUPERSEDED BY S01177)                              *
     F*  S01194 - AMENDMENT TO USE ACCESS OBJECTS                     *
     F*  S01117 - MULTIBRANCHING/R10                                  *
     F*  S01195 - NEW STANDING DATA - HOLIDAY PROCESSING              *
     F*  S01177 - NEW SETTLEMENT FIELDS ADDED                         *
     F*  E14393 - Update PMDT (related purchase maturity date)        *
     F*           on DEALSDE with the value in ILRMTD (related        *
     F*           deal maturity date) from MMSTDSPP.                  *
     F*           (Fix requires addition of Standard SR ZA0680).      *
     F*  E14368 - Pay/Receive indicator PRIX for deam types 'PD'      *
     F*           'SI' & 'PI' processed as in midas program DL0070    *
     F*  E14377 - If brokerage is to be calculated (ie. 9's           *
     F*           sent) set Midas Deals file brokerage to zero        *
     F*           and set on bit to indicate calculation needed.      *
     F*  E14356 - IF DATABASE ERROR SET UP FIELDS ON THE LDA.         *
     F*  E14026 - Rename RECI for DTRIX to DXRECI so that file        *
     F*           records are not updated with the value of RECI      *
     F*           from FDCCYTLL accessed in #CA.                      *
     F*  S01165 - TWO NEW FIELDS (BOOK CODE AND LINKED REFERENCE      *
     F*           NUMBER) HAVE BEEN ADDED TO DEALS.                   *
     F*  E12564 - RATE/SPREAD FIELD(RTSP) ON DEALSDC SHOULD BE        *
     F*           UPDATED WITH INPUT INTEREST RATE(IKIIRT) FROM       *
     F*           STANDARD DEALS FILE IF BASE RATE CODE IS BLANK      *
     F*  E12189 - 22/02/88 - FXTB40LL OPENED INCONSISTENTLY           *
     F*           BETWEEN MM AND FX WITH SHARED ACCESS PATH.          *
     F*           CHANGE BY USING 'KEY' AND NOT RECORD NUMBER.        *
     F*  E12279 - 28/03/88 - FILE LOCKING FIXES                       *
     F*  S01136 - FEDERAL FUNDS PROCESSING ADDED (DRS INCORP)         *
     F*         - DEALSDE DOES NOT CONTAIN SOME OF FIELDS LOADED      *
     F*           IN THIS PROGRAM THESE HAVE BEEN COMMENTED OUT.      *
     F*                                                               *
     F*****************************************************************
     F/EJECT
     F****************************************************************
     FBKRAT   UF  E           K        DISK         KINFSR INFSR A    UC  AUS007
     F                                              KCOMIT                AUS007
     F*EAMS** UF  E           K        DISK         KINFSR INFSR A    UC
     FMMDEMULLUF  E           K        DISK         KINFSR INFSR A    UC
     F                                              KCOMIT
     F*EALS** UF  E           K        DISK         KINFSR INFSR A    UC
     FMMDELULLUF  E           K        DISK         KINFSR INFSR A    UC
     F                                              KCOMIT
     F            DEALSDBF                          KIGNORE
     F                                              KINFDS @DLSDS
     FSDTIX   UF  E           K        DISK         KINFSR INFSR A    UC
     F                                              KCOMIT
     FMMDEALLLIF  E           K        DISK         KINFSR INFSR      UC
     F                                              KINFDS @MMDDS
     FMMDEAMLLIF  E           K        DISK         KINFSR INFSR      UC
     F*FDICDRLLIF  E           K        DISK         KINFSR INFSR      UC S01194
     F*****        TABTB20F                          KIGNORE              S01194
     F*XTB40LLIF  E                    DISK         KINFSR INFSR      UC  E12189
     F*FXTB40LLIF  E           K        DISK         KINFSR INFSR      UC S01194
     F*FDBSRULLIF  E           K        DISK         KINFSR INFSR      UC S01194
     F*FDTBLILLIF  E           K        DISK         KINFSR INFSR      UC S01194
     F*FDCCYTLLIF  E           K        DISK         KINFSR INFSR      UC S01194
     F*FDBRNCLLIF  E           K        DISK         KINFSR INFSR      UC S01194
     F*DTABJLLIF**E***********K********DISK         KINFSR INFSR      UC  S01195
      *                                                                   S01408
     F/COPY WNCPYSRC,MM0081FFP1                                           S01408
      *                                                                   S01408
     FHIST1   UF  E           K        DISK         KINFSR *PSSR          051154
      *
     F/COPY WNCPYSRC,MM0081F001
     E                    CPY@    1   1 80                                S01194
      *                                                                   S01194
      ****USED*BY*SR.*ZA0830*- CURRENCY RECORDS                           S01195
     E********************@CY        50  3                                S01195
     E/COPY ZSRSRC,ZHOLE                                                  S01195
     E*                                                                   S01195
     E/COPY ZSRSRC,ZF2CE                                                  S01195
     E*
     E**  Array for aligning integer/decimal portions of amount
     E                    @ID        18  1
     E*
     E****ARRAY*FOR*SR.*ZA0680*-*CUMULATIVE*DAYS*IN*YEAR*FOR*4*YEAR*E14393056095
     E***********         @YD     4   4  5 0A                       E14393056095
     E*                                                                   E14393
     E****ARRAY*FOR*SR.*ZA0680*-*CUMULATIVE*DAYS*IN*YEAR*PER*MONTH**E14393056095
     E***********         @MD    13  13  5 0A                       E14393056095
     E*                                                                   056095
     E/COPY ZSRSRC,ZDATE9Z1                                               056095
     E**  Array for SR. ZDATE9                                            056095
     E*                                                                   051496
     E** Array for allocating processing sequence                         051496
     E*                                                                   051496
     E                    TABTYP  7   7  2   TABSEQ  1                    051496
     E/COPY WNCPYSRC,MM0081EEP1                                           S01408
      *
     IDTRIXDF                                                             E14026
     I              RECI                            DXRECI                E14026
     IHISTSAAF                                                            051154
     I              CNUM                            HCNUM                 051154
     I              EDAT                            HEDAT                 051154
     I              DLNO                            HDLNO                 051154
     I              PCPL                            HPCPL                 051154
     I              NRAT                            HNRAT                 051154
     I              ORAT                            HORAT                 051154
     I              TERM                            HTERM                 051154
     I              DTYP                            HDTYP                 051154
     I              DLST                            HDLST                 051154
     I              BRCA                            HBRCA                 051154
     I              SQNO                            HSQNO                 051154
     I              MDAT                            HMDAT                 051154
     I              SECI                            HSECI                 051154
     I              CCY                             HCCY                  051154
     I              INTC                            HINTC                 051154
     I              EAMT                            HEAMT                 051154
     I              CHQI                            HCHQI                 051154
     I              ICBS                            HICBS                 051154
      *
     I            DS
      ****USED*BY SR. ZA0830 - ARRAY DATA STRUCTURE                       S01195
     I*********                               1 150 @CY                   S01195
     I*********                               1  75 @@CY1                 S01195
     I*********                              76 150 @@CY2                 S01195
     E*                                                                   S01195
     E/COPY ZSRSRC,ZHOLI                                                  S01195
     E*                                                                   S01195
     E/COPY ZSRSRC,ZF2CI                                                  S01195
     I*********** DS                                                S01392056095
     I****Data*Structure*for*SR.*MM1009*-*date*field*YYYYMMDD.******S01392056095
     I***********                             1   80@@DATA          S01392056095
     I***********                             1   40@@YY1           S01392056095
     I***********                             5   60@@MM1           S01392056095
     I***********                             7   80@@DD1           S01392056095
     I*********** DS                                                S01392056095
     I****Data*Structure*for*SR.*MM1009*-*date*field*YYYYMMDD.******S01392056095
     I***********                             1   80@@DATB          S01392056095
     I***********                             1   40@@YY2           S01392056095
     I***********                             5   60@@MM2           S01392056095
     I***********                             7   80@@DD2           S01392056095
     I*                                                                   056095
     I/COPY ZSRSRC,ZINTDYZ1                                               056095
     I**  Data Structure for SR. ZINTDY                                   056095
     I*                                                                   056095
     I*********** DS                                                S01392056095
     I****Data*structure*for*SR.*ZA0710*-*field*is*@@Z71Y***********S01392056095
     I***********                             1   40@@Z71Y          S01392056095
     I***********                             1   10@@SSY1          S01392056095
     I***********                             2   20@@SSY2          S01392056095
     I***********                             3   30@@SSY3          S01392056095
     I***********                             4   40@@SSY4          S01392056095
     I*********** DS                                                S01392056095
     I****Data*structure*for*SR.*ZA0710*-*field*is*@@VDT************S01392056095
     I***********                             1   80@@VDT           S01392056095
     I***********                             1   40@@YR            S01392056095
     I***********                             5   60@@Z71M          S01392056095
     I***********                             7   80@@Z71D          S01392056095
     I*                                                                   056095
     I/COPY ZSRSRC,ZDATE9Z2                                               056095
     I**  Data structure for SR. ZDATE9                                   056095
     I*                                                                   056095
     IPSDS       SDS
     I/COPY WNCPYSRC,MM0081I002
      **  PROGRAM STATUS DATA STRUCTURE.
      *
      **  Field containing file in process.
     I                                      201 208 @FILE
      **  Field containing workstation  ID.
     I                                      244 253 @JOB
      **  Field containing user ID.
     I                                      254 263 @USER
      *
     I           UDS
      **  LOCAL DATA AREA FOR DATA BASE ERRORS.
      *
      **  Field containing name of database file in error.
     I                                      134 141 DBFILE
      **  Field containing key value causing database error.
     I                                      142 170 DBKEY
      **  Field containing name of program causing database error.
     I                                      171 180 DBPGM
      **  Field containing number of database error.
     I                                      181 183 DBASE
      *
      **  Data structures passed as parameters to this program.
      *
     I@DEALB    E DSMMSTDBPP
     I                                      273 2750IHFCLT
     I                                      276 2770IHFCLN
     I@DEALL    E DSMMSTDLPP
     I              QQDORI                          QQDOR1                                    CGL029
     I              QQMORI                          QQMOR1                                    CGL029
     I              QQDOPI                          QQDOP1                                    CGL029
     I              QQMOPI                          QQMOP1                                    CGL029
     I              QQBORI                          QQBOR1                                    CGL029
     I              QQBOPI                          QQBOP1                                    CGL029
     I              QQRONS                          QQRON1                                    CGL029
     I              QQPONS                          QQPON1                                    CGL029
     I                                      263 2650IKFCLT
     I                                      266 2670IKFCLN
     I@DEALS    E DSMMSTDSPP
     I              QQDORI                          QQDOR2                                    CGL029
     I              QQMORI                          QQMOR2                                    CGL029
     I              QQBORI                          QQBOR2                                    CGL029
     I              QQBOPI                          QQBOP2                                    CGL029
     I              QQRORI                          QQROR2                                    CGL029
     I              QQROPI                          QQROP2                                    CGL029
     I              QQRONS                          QQRON2                                    CGL029
     I              QQPONS                          QQPON2                                    CGL029
     I                                      216 2180ILFCLT
     I                                      219 2200ILFCLN
     I@DEALA    E DSMMSTDAPP
     I***@DEALC    E DSDEALSDC                                      E22475E23850
     I              QQDORI                          QQDOR3                                    CGL029
     I              QQMORI                          QQMOR3                                    CGL029
     I              QQDOPI                          QQDOP3                                    CGL029
     I              QQMOPI                          QQMOP3                                    CGL029
     I              QQBORI                          QQBOR3                                    CGL029
     I              QQBOPI                          QQBOP3                                    CGL029
     I              QQRORI                          QQROR3                                    CGL029
     I              QQROPI                          QQROP3                                    CGL029
     I              QQRONS                          QQRON3                                    CGL029
     I              QQPONS                          QQPON3                                    CGL029
     I***@DELLC      DS                            420              E22475E23850
      *
      *****Table Files Key                                                S01194
     I*****       DS                             12                       S01194
     I*****                                   1  12 KEY                   S01194
     I*****                                   1   2 @PRF                  S01194
      *****Key to Branch Codes File                                       S01194
     I*****                                  10  12 @BNO                  S01194
      *****Key to Currency Codes File                                     S01194
     I*****                                   9  11 @CUR                  S01194
     I*****                                  12  12 @SUF                  S01194
      *
      *    Work fields definitions
     I            DS
     I                                        1   1 @RDLIN
     I                                        2   2 @RDMIN
     I                                        3   3 @RP
     I                                        4   4 @S
      **  Information data structure for MMDEALLL.
     I@MMDDS      DS
     I                                     *RECORD  @FORM
      **  Information data structure for DEALS .
     I@DLSDS      DS
     I                                     *RECORD  @FORMM
      **  Time data structure for DTRIX.
     I            DS
     I                                        1   60@TIME
     I                                        1   40TIM
      *                                                               *
      **  Data Structure for aligning integer/decimal purchase amount
     I            DS                             18
     I                                        1  150@INT
     I                                       16  180@DEC
     I                                        1  18 @ID
      *
     I****DATA*STRUCTURE*FOR*SR.*ZA0680*-*DATE*INPUT*TO*SUBROUTINE**E14393056095
     I*********** DS                                                E14393056095
     I***********                             1   80@@DTIN          E14393056095
     I***********                             1   40@@YYYY          E14393056095
     I***********                             3   40@@YY            E14393056095
     I***********                             1   20@@CC            E14393056095
     I***********                             5   60@@MTH           E14393056095
     I***********                             7   80@@DAY           E14393056095
     I*                                                                   056095
     I/COPY ZSRSRC,ZDAT10Z1                                               056095
     I**  Data structure for SR. ZDAT10                                   056095
     I*
     ISDBANK    E DSSDBANKPD                                              S01194
     I** External DS for BANK Details                                     S01194
     I*                                                                   S01194
     ISDTRAD    E DSSDTRADPD                                              S01194
     I** External DS for TRADE Details                                    S01194
     I*                                                                   S01194
     ISDBSRT    E DSSDBSRTPD                                              S01194
     I** External DS for BASE RATE Details                                S01194
     I*                                                                   S01194
     ISDNOST    E DSSDNOSTPD                                              S01194
     I** External DS for NOSTRO Details                                   S01194
     I              QQACCD                          QQACD4                                    CGL029
     I*                                                                   S01194
     ISDCURR    E DSSDCURRPD                                              S01194
     I** External DS for CURRENCY Details                                 S01194
     I*                                                                   S01194
     I***SDBRCH    E DSSDBRCHPD                                     S01194123133
     I** External DS for BRANCH Details                                   S01194
     I*                                                                   AUS007
     ISCSARD    E DSSCSARDPD                                              AUS007
     I** EXTERNAL DS FOR SAR DETAILS                                      AUS007
     I*
     ISDMMOD    E DSSDMMODPD                                              S01486
     I** Portfolio Management ICD                                         S01486
     I*                                                                   S01486
     ISDGELR    E DSSDGELRPD                                              CEU015
     I* GENERAL LEDGER DETAILS ACCESSED VIA ACCESS PROGRAM                CEU015
     I              QQACCD                          QQACD5                                    CGL029
      *                                                                   CEU015
     IDSFDY     E DSDSFDY                                                 S01194
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01194
     I*                                                                   S01117
     IDSSDY     E DSDSSDY                                                 S01194
     I* SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE                S01194
     I*                                                                   S01194
     I              'LECalcBasis6LeapYear'C         WPARML                                  MD035545
     I/COPY WNCPYSRC,MM0081I001
      /EJECT
      *
      *                                                                   S01194
      **  Initial processing.
     I/COPY WNCPYSRC,MM0081I003
     C           @TERM     IFNE 'T'                        B*1
     C                     EXSR #A                          *1
      **  Main processing 1
      *
     C           @TERM     IFNE 'E'                        B*2
     C                     EXSR #B                          *2
     C                     END                             E*2
      **  Main processing 2
      *
     C           @TERM     IFNE 'E'                        B*2
     C                     EXSR #C                          *2
     C                     END                             E*2
      *
     C                     END                             E*1
      **  Termination processing
      *
     C                     EXSR #D
      *
      /EJECT
      *****************************************************************
      *
      *  Index to subroutines - Order of listing due to frequency of
      *  ------------------------------------------------------------
      *                         usage.
      *                         ------
      *
      *      #A     -   Initial processing.
      *      #B     -   Main processing 1
      *      #C     -   Main processing 2
      *      #D     -   Termination processing
      *
      *      #BA    -   Insert loan/deposit
      *      #BB    -   Insert bought N/A
      *      #BC    -   Insert sold N/A
      *      #BD    -   Insert deam
      *      #BE    -   Amend loan/deposit
      *      #BF    -   Amend bought N/A
      *      #BG    -   Amend sold N/A
      *      #BH    -   Amend deam
      *      #BI    -   Delete loan/deposit
      *      #BJ    -   Delete bought N/A
      *      #BK    -   Delete sold N/A
      *      #BL    -   Delete deam
      *
      *      #ZA    -   Calculate bit settings for confirmation
      *                    indicators.
      *      #ZB    -   Determine whether settlement is pay or receive.
      *      #ZC    -   Update trailer record for loan/deposit,
      *                    bought N/A or sold N/A
      *      #ZD    -   Update trailer record for deal amendment.
      *      INFSR  -   File error handling sub- routine.
      *      *PSSR  -   Program error handling sub- routine.
      *                                                               *
      *                                                               *
      *  External programs called.
      *  -------------------------
      *                                                               *
      *             **  NONE  **
      *                                                               *
      *                                                               *
      *****************************************************************
      *
      *  Indicator usage.
      *  ----------------
      *
      *      60     -   File error.
      *      61     -   General work indicator.
      *      62     -   Type 'B' field has been changed.
      *      99     -   Dummy indicator for referencing DTRIXHF           E12279
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *  SUBROUTINE: #B     - Main Processing 1
      *                                                               *
      *  FIELDS USED:        ICMACT   -   Common MIDAS action code.   *
      *                                                               *
      *                                                               *
      *  CALLED BY : MAIN PROGRAM                                     *
      *  CALLS     :
      *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           #B        BEGSR
      *
      **  Ascertain MIDAS action code & this-deal-indicator, &
      **  process accordingly.
      *
      ** 1/ Insertions.
      *  --------------
     C           ICMACT    IFEQ 'I'                        B*1
      *
     C           @THDL     CASEQ'L'       #BA               *1
     C           @THDL     CASEQ'B'       #BB               *1
     C           @THDL     CASEQ'S'       #BC               *1
     C           @THDL     CASEQ'A'       #BD               *1
     C                     END                              *1
      *
      ** 2/ Amendments.
      *  --------------
     C                     ELSE                            X*1
     C           ICMACT    IFEQ 'A'                        B*2
      *
     C           @THDL     CASEQ'L'       #BE               *2
     C           @THDL     CASEQ'B'       #BF               *2
     C           @THDL     CASEQ'S'       #BG               *2
     C           @THDL     CASEQ'A'       #BH               *2
     C                     END                              *2
      *
      ** 3/ Deletions (ie Reversals)
      *  ---------------------------
      *
     C                     ELSE                            X*2
     C           ICMACT    IFEQ 'R'                        B*3
      *
     C           @THDL     CASEQ'L'       #BI               *3
     C           @THDL     CASEQ'B'       #BJ               *3
     C           @THDL     CASEQ'S'       #BK               *3
     C           @THDL     CASEQ'A'       #BL               *3
     C                     END                              *3
      *
     C                     END                             E*3
     C                     END                             E*2
     C                     END                             E*1
      *
     C           #B9       ENDSR                           **#B9**
      /EJECT
      *****************************************************************
      *                                                               *
      *  SUBROUTINE: #C     - Main Processing 2                       *
      *                                                               *
      *  FIELDS USED:        ICMACT   -   Common MIDAS action code.   *
      *                                                               *
      *  CALLED BY : MAIN PROGRAM                                     *
      *                                                               *
      *  CALLS     :                                                  *
      *                                                               *
      *****************************************************************
      *
     C           #C        BEGSR
      *
      **  Write a new DTRIXDD record.
      *   ---------------------------
     C**********           MOVE 'D'       RECI                            E14026
     C                     MOVE 'D'       DXRECI                          E14026
     C                     Z-ADDICDN38    DLNO
     C                     MOVE 'N'       CNPR
     C                     MOVE ' '       REPR
     C                     TIME           @TIME
     C                     Z-ADD0         ICIN
      *
      ** Check if any live deal amendments exist.
     C                     MOVE 'N'       DADI
     C           @THDL     IFNE 'A'                        B*1
     C           ICMACT    ANDEQ'A'                        B*1
     C           DLNO      CHAINMMDEAMLL             61     *1
      *
     C           *IN61     DOWNE'1'                        B*2
     C           HNDLTF    IFEQ *BLANK                     B*3
     C           HNDDLT    ANDEQ*BLANK                     B*3
     C                     MOVE '1'       *IN61             *3
     C                     MOVE 'Y'       DADI              *3
     C                     ELSE                            X*3
     C           DLNO      READEMMDEAMLL                 61 *3
     C                     END                             E*3
     C                     END                             E*2
      *
     C                     END                             E*1
      *
      ** Ascertain values of pay/receive indicators.
     C                     EXSR #CA
      *
      ** This deal is an amendment.
     C           @THDL     IFEQ 'A'                        B*1
     C                     MOVE 'N'       CNRQ              *1
     C                     MOVE 'A'       RCDT              *1
     C                     Z-ADDICDVSD    VDAT              *1
     C           ICMACT    IFEQ 'R'                                       BH1069
     C                     Z-ADDSEQDTR    DASN                            BH1069
     C                     ELSE                                           BH1069
     C                     Z-ADDIGDS38    DASN              *1
     C                     END                                            BH1069
      *
      ** Access MM deals file to pick up branch code.
     C           DLNO      CHAINMMDEALLL             60     *1
      *
     C           *IN60     IFEQ '1'                        B*2
     C                     MOVE '001'     DBASE             *2
     C*                                                                   E14356
     C** SET UP DASE ERROR FIELDS                                         E14356
     C                     MOVEL'MMDEALLL'DBFILE            *2            E14356
     C                     MOVELDLNO      DBKEY             *2            E14356
     C*                                                                   E14356
     C                     EXSR INFSR                       *2
     C                     END                             E*2
      *
     C           @FORM     IFEQ 'MMDELDP0'                 B*2
     C*********************Z-ADDHKBRCD    BRCD              *2            S01117
     C                     MOVELHKBRCA    BRCA              *2            S01117
     C                     ELSE                            X*2
     C           @FORM     IFEQ 'MMDENSP0'                 B*3
     C*********************Z-ADDHMBRCD    BRCD              *3            S01117
     C                     MOVELHMBRCA    BRCA              *3            S01117
     C                     ELSE                            X*3
     C           @FORM     IFEQ 'MMDENBP0'                 B*4
     C*********************Z-ADDHLBRCD    BRCD              *4            S01117
     C                     MOVELHLBRCA    BRCA              *4            S01117
     C                     END                             E*4
     C                     END                             E*3
     C                     END                             E*2
      *
      ** This deal is other than an amendment.
     C                     ELSE                            X*1
      *
     C                     MOVE @CNRQ     CNRQ              *1
     C                     MOVE 'D'       RCDT              *1
     C                     Z-ADD*ZERO     VDAHLD  50                      E29097
     C                     Z-ADDVDAT      VDAHLD                          E29097
     C                     Z-ADD*ZERO     VDAT              *1
     C                     Z-ADD*ZERO     DASN              *1
     C*********************Z-ADDICBRCD    BRCD              *1            S01117
     C                     MOVELICBRCA    BRCA              *1            S01117
     C                     END                             E*1
      *
     C                     MOVE ICMACT    CHTP
     C*                                                                   E29097
     C** Setof Pay/Receive indicators if deal is backvalued or was        E29097
     C** originally backvalued.                                           E29097
     C*                                                                   E29097
     C           @THDL     IFNE 'A'                                       E29097
     C*                                                                   E29097
     C** Not deal amendment                                               E29097
     C*                                                                   E29097
     C           ICMACT    IFEQ 'I'                                       E29097
     C*                                                                   E29097
     C** If insert, use BJRDNB else use original entry date               E29097
     C*                                                                   E29097
     C           VDAHLD    ANDLTBJRDNB                                    E29097
     C           ICMACT    ORNE 'I'                                       E29097
     C           VDAHLD    ANDLTORED                                      E29097
     C           @THDL     IFEQ 'S'                                       E29678
     C*                                                                   E29678
     C** Deal NAS                                                         E29678
     C*                                                                   E29678
     C/COPY WNCPYSRC,MM0081C001
     C                     Z-ADD0         PRI3                            E29678
     C/COPY WNCPYSRC,MM0081C002
     C                     ELSE                                           E29678
     C*                                                                   E29678
     C** Not deal NAS                                                     E29678
     C*                                                                   E29678
     C/COPY WNCPYSRC,MM0081C003
     C                     Z-ADD0         PRI1                            E29678
     C/COPY WNCPYSRC,MM0081C004
     C                     END                                            E29678
     C                     END                                            E29097
     C*                                                                   E29097
     C                     ELSE                                           E29097
     C*                                                                   E29097
     C** Deal amendment                                                   E29097
     C*                                                                   E29097
     C           ICMACT    IFEQ 'I'                                       E29097
     C*                                                                   E29097
     C** If insert, use BJRDNB else use original entry date               E29097
     C*                                                                   E29097
     C           VDAT      ANDLTBJRDNB                                    E29097
     C           ICMACT    ORNE 'I'                                       E29097
     C           VDAT      ANDLTORED                                      E29097
     C/COPY WNCPYSRC,MM0081C005
     C                     Z-ADD0         PRI1                            E29097
     C/COPY WNCPYSRC,MM0081C006
     C                     END                                            E29097
     C*                                                                   E29097
     C                     END                                            E29097
     C/COPY WNCPYSRC,MM0081C017
     C                     WRITEDTRIXDF                60
     C           *IN60     IFEQ '1'                        B*1
     C                     MOVE '002'     DBASE             *1
     C                     MOVEL'DTRIX'   DBFILE            *1            E14356
     C                     EXSR INFSR                       *1
     C                     END                             E*1
     C/COPY WNCPYSRC,MM0081C023
      *                                                                   E12279
      ** Dummy access of DTRIXHF                                          E12279
      *                                                                   E12279
     C                     SETOF                     99                   E12279
     C           *IN99     IFEQ '1'                        B1             E12279
     C           *IN99     ANDNE'1'                        B1             E12279
     C           DLNO      CHAINDTRIXHF              60    *1             E12279
     C                     UPDATDTRIXHF                60  *1             E12279
     C                     END                             E1             E12279
      *
      ** Update header record.
     C**************       Z-ADD*ZERO     DLNO                            E12279
     C*********  DLNO      CHAINDTRIXHF              60                   E12279
     C*********  *IN60     IFEQ '1'                        B*1            E12279
     C*********            MOVE '003'     DBASE             *1            E12279
     C*********            EXSR INFSR                       *1            E12279
     C*********            END                             E*1            E12279
      *                                                                   E12279
     C*********  @THDL     IFEQ 'A'                        B*1            E12279
     C*********            ADD  1         NDAR              *1            E12279
     C*********            ELSE                            X*1            E12279
     C*********            ADD  1         NDLR              *             E12279
     C*********            END                             E*1            E12279
      *                                                                   E12279
     C*********            UPDATDTRIXHF                60                 E12279
     C*********  *IN60     IFEQ '1'                        B*1            E12279
     C*********            MOVE '004'     DBASE             *1            E12279
     C*********            EXSR INFSR                       *1            E12279
     C*********            END                             E*1            E12279
      *
     C           #C9       ENDSR                           **#B9**        E12279
      /EJECT
      *****************************************************************
      *                                                               *
      *  SUBROUTINE: #BA    - Insert a loan/deposit (insert a new     *
      *                       record on DEALSDC).                     *
      *                                                               *
      *  FIELDS USED:      @IKAMN - Negative amount indicator         *   S01136
      *                                                               *
      *                                                               *
      *  CALLED BY :  #B
      *  CALLS     :
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           #BA       BEGSR
      *
     C                     Z-ADDIKDN38    DLNO
     C                     MOVE 'C'       RCDT
      *
     C           IKMTYP    IFEQ 'IT'                       B*1
     C           IKMTYP    OREQ 'TD'                       B*1
     C           IKMTYP    OREQ 'CD'                       B*1
     C           IKMTYP    OREQ 'CI'                       B*1
     C           IKMTYP    OREQ 'BB'                       B*1              2933
     C           IKMTYP    OREQ 'CO'                       B*1              2933
     C           IKMTYP    OREQ 'ID'                       B*1            S01354
     C                     Z-ADD16        RCDC              *1
     C                     ELSE                            X*1
     C                     Z-ADD15        RCDC              *1
     C                     END                             E*1
      *
     C***********IKMTYP    IFEQ 'CI'                       B*1            123133
      *
      ** Access branch code record to pick up branch internal
      ** customer number.
     C*****                MOVE *BLANKS   KEY                             S01194
     C*********************MOVE IKBRCD    @BNO              *1            S01117
     C*****                MOVE IKBRCA    @BNO              *1     S01117 S01194
     C*****                MOVE '10'      @PRF              *1            S01194
     C*****      KEY       CHAINFDBRNCLL             60     *1            S01194
      *****                                                               S01194
      ***If no record found, terminate with error.                        S01194
     C*****      *IN60     IFEQ '1'                        B*2            S01194
     C*****                MOVE '005'     DBASE             *2            S01194
     C*****                                                        E14356 S01194
     C***SET UP DASE ERROR FIELDS                                  E14356 S01194
     C*****                MOVEL'FDBRNCLL'DBFILE            *2     E14356 S01194
     C*****                MOVELKEY       DBKEY             *2     E14356 S01194
     C*****                                                        E14356 S01194
     C*****                EXSR INFSR                       *2            S01194
     C*****                END                             E*2            S01194
      *
     C***********          CALL 'AOBRCHR0'                         S01194 123133
     C***********          PARM '*MSG   ' @RTCD   7                S01194 123133
     C***********          PARM '*KEY   ' @OPTN   7                S01194 123133
     C***********          PARM IKBRCA    @DSNB   3                S01194 123133
     C***********SDBRCH    PARM SDBRCH    DSFDY                    S01194 123133
     C***********                                                  S01194 123133
     C***********@RTCD     IFNE *BLANK                     B*2     S01194 123133
     C***********          MOVEL@DSNB     DBKEY            ********S01194 123133
     C***********          MOVEL'SDBRCHPD'DBFILE           * DBERR*S01194 123133
     C***********          MOVE '005'     DBASE            ********S01194 123133
     C***********          EXSR INFSR                       *2     S01194 123133
     C***********          END                             E*2     S01194 123133
      *                                                                   S01194
     C*****                Z-ADDBICN      CNUM              *1            S01194
     C***********          MOVE A8BICN    CNUM              *1      S01194123133
      *
     C***********          ELSE                            X*1            123133
     C**********           Z-ADDIKCNUM    CNUM              *1                                CSD027
     C                     MOVE IKCNUM    CNUM              *1                                CSD027
      *
     C***********          END                             E*1            123133
     C/COPY WNCPYSRC,MM0081C019
      *
     C*********************Z-ADDIKBRCD    BRCD                            S01117
     C                     MOVELIKBRCA    BRCA                            S01117
     C                     MOVE IKMTYP    DTYP
     C                     MOVE IKSTYP    DLST
     C                     Z-ADDIKDDND    DDAT
     C                     Z-ADDIKDVSD    VDAT
     C                     Z-ADDIKMATD    MDAT
     C                     Z-ADDIKACSQ    CDAS
     C                     MOVE IKBKCD    BRKC
     C           IKBRKG    IFEQ *ALL'9'                    B1             E14377
     C                     Z-ADD0         BAGE             *1             E14377
     C                     ELSE                            X1             E14377
     C                     Z-ADDIKBRKG    BAGE             *1
     C                     END                             E1             E14377
     C                     MOVE IKCCY     CCY
     C                     Z-ADDIKAMNP    PCPL
      *
     C                     MOVE IKCPTI    INTC
     C           IKMTYP    IFEQ 'BB'                       B1               2933
     C           IKMTYP    OREQ 'CO'                       B1               2933
     C                     Z-ADD0         BAGE             *1               2933
     C                     Z-ADDIKBRKG    PCPL             *1               2933
     C                     END                             E1               2933
      *
     C           IKBSRC    IFEQ *BLANK                     B*1
     C                     Z-ADD*ZERO     BRTT              *1
     C                     Z-ADD*ZERO     BRTE              *1
     C                     ELSE                            X*1
     C                     MOVE IKBSRC    BRTT              *1
      *
      ** Access base rate record to pick up base rate.
     C*****                MOVE IKDBSR    FSRT              *1            S01194
     C*****      @BSRKY    CHAINFDBSRULL             60     *1            S01194
      *****                                                               S01194
      ***If no record found, terminate with error.                        S01194
     C*****      *IN60     IFEQ '1'                        B*2            S01194
     C*****                MOVE '006'     DBASE             *2            S01194
     C*****                                                        E14356 S01194
     C***SET UP DASE ERROR FIELDS                                  E14356 S01194
     C*****                MOVEL'FDBSRULL'DBFILE            *2     E14356 S01194
     C*****                MOVELCCY       @DBFD   8         *2     E14356 S01194
     C*****                MOVE FSRT      @DBFD             *2     E14356 S01194
     C*****                MOVEL@DBFD     DBKEY             *2     E14356 S01194
     C*****                                                        E14356 S01194
     C*****                EXSR INFSR                       *2            S01194
     C*****                END                             E*2            S01194
      *
      ** Access base rate record to pick up base rate.
     C                     CALL 'AOBSRTR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM CCY       @AJCD   3                       S01194
     C                     PARM IKBSRC    @DWNB   2                       S01194
     C********** SDBSRT    PARM SDBSRT    DSFDY                     S01194CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                           CSD006
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANK                     B*2            S01194
     C                     MOVELCCY       @DBFD   8         *2            S01194
     C                     MOVE IKBSRC    @DBFD             *2            S01194
     C                     MOVEL@DBFD     DBKEY            ***************S01194
     C                     MOVEL'SDBSRTPD'DBFILE           * DBERROR 006 *S01194
     C                     MOVE '006'     DBASE            ***************S01194
     C                     EXSR INFSR                       *2            S01194
     C                     END                             E*2            S01194
      *                                                                   S01194
     C                     Z-ADDBACBSR    BRTE                            S01194
      *                                                                   S01194
      ** If record found compare deal value date & next rate value date
     C*****      IKDVSD    IFLT VDNR                       B*2            S01194
     C           IKDVSD    IFLT BAVDNR                     B*2            S01194
     C                     Z-ADDBRTE      BRTE              *2
     C                     ELSE                            X*2
     C*****                Z-ADDNBRT      BRTE              *2            S01194
     C                     Z-ADDBANBRT    BRTE              *2            S01194
     C                     END                             E*2
      *
     C                     END                             E*1
      *
     C*                                                                   E12564
     C**UPDATE RTSP WITH INPUT INTEREST RATE IF NO BASE RATE CODE         E11256
     C*                                                                   E12564
     C           IKBSRC    IFEQ *BLANK                     B*1            E12564
     C*                                                                   E21316
     C           IKNGVI    IFEQ 'Y'                        B*2            E21316
     C                     Z-SUBIKIIRT    RTSP             **2            E21316
     C                     ELSE                            X*2            E21316
     C                     Z-ADDIKIIRT    RTSP             **1            E12564
     C                     END                             E*2            E21316
     C*                                                                   E21316
     C                     ELSE                            **1            E12564
     C                     Z-ADDIKSPRD    RTSP             **1
     C                     END                             E*1            E12564
     C*                                                                   E12564
     C           IKMTYP    IFEQ 'BB'                       B1               2933
     C           IKMTYP    OREQ 'CO'                       B1               2933
     C                     Z-ADD0         RTSP             *1               2933
     C                     END                             E1               2933
     C*                                                                     2933
     C           IKNGVI    IFEQ 'Y'                        B1             E21316
     C                     Z-SUBIKINTR    INTR             *1             E21316
     C                     ELSE                            X1             E21316
     C                     Z-ADDIKINTR    INTR             *1
     C                     END                             E1             E21316
     C*                                                                   E21316
     C                     Z-ADDIKNTCE    NOTD
     C                     MOVE IKCDRF    RNNA
     C**********           Z-ADDIKMCDH    CHNA                                                CSD027
     C                     MOVE IKMCDH    CHNA                                                CSD027
     C                     Z-ADDIKFCLT    FACT
     C                     Z-ADDIKFCLN    FCNO
      *
     C           IKMTYP    IFEQ 'CD'                       B*1
     C           IKMTYP    OREQ 'CL'                       B*1
     C           IKMTYP    OREQ 'DL'                       B*1
     C           IKMTYP    OREQ 'CO'                       B*1              2933
     C           IKMTYP    OREQ 'BB'                       B*1              2933
     C           IKMTYP    OREQ 'IL'                       B*1            S01354
     C           IKMTYP    OREQ 'ID'                       B*1            S01354
     C                     Z-ADDIKAMNP    OPAM              *1
     C                     ELSE                            X*1
     C                     Z-ADD*ZERO     OPAM              *1
     C                     END                             E*1
      *
      *
     C                     Z-ADDIKBRAT    BCXR
      *
      ** Access currency details using deal currency.
     C*****                MOVE *BLANKS   KEY                             S01194
     C*****                MOVE '20'      @PRF                            S01194
     C*****                MOVE CCY       @CUR                            S01194
     C*****                MOVE '1'       @SUF                            S01194
     C*****      KEY       CHAINFDCCYTLL             60                   S01194
      *****                                                               S01194
      ***If no record found, terminate with error.                        S01194
     C*****      *IN60     IFEQ '1'                        B*1            S01194
     C*****                MOVE '007'     DBASE             *1            S01194
     C***                                                          E14356 S01194
     C***SET UP DASE ERROR FIELDS                                  E14356 S01194
     C*****                MOVEL'FDCCYTLL'DBFILE            *1     E14356 S01194
     C*****                MOVELKEY       DBKEY             *1     E14356 S01194
     C*                                                            E14356 S01194
     C*****                EXSR INFSR                       *1            S01194
     C*****                END                             E*1            S01194
      *
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM CCY       @AJCD   3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANK                     B1             S01194
     C                     MOVE '007'     DBASE            ***************S01194
     C                     MOVEL'SDCURRPD'DBFILE           * DBERROR 007 *S01194
     C                     MOVEL@AJCD     DBKEY            ***************S01194
     C                     EXSR INFSR                      *1             S01194
     C                     END                             E1             S01194
     C*                                                                   S01194
     C*****                Z-ADDERLC      LCXR                            S01194
     C                     Z-ADDA6ERLC    LCXR                            S01194
      *
      *  The following 6 fields (Start & maturity instructions)
      *  depend on whether the deal is for a receipt or a payment.
      *
     C           IKMTYP    IFEQ 'IT'                       B*1
     C           IKMTYP    OREQ 'TD'                       B*1
     C           IKMTYP    OREQ 'CD'                       B*1
     C           IKMTYP    OREQ 'CI'                       B*1
     C           IKMTYP    OREQ 'ID'                       B*1            S01354
     C/COPY WNCPYSRC,MM0081C024
      *
     C                     Z-ADDIKBRAT    BCXR              *1            048458
     C                     Z-ADDIKORCM    SDST              *1
     C                     MOVE IKMORI    OSDA              *1
     C**********           MOVE IKMCPI    TSTN              *1            BHF750
     C**********           MOVE IKMCRI    TSTN              *1     BHF750 BHF772
     C                     MOVE *BLANKS   TSTN                            BHF772
     C                     MOVELIKRIBN    TSTN                            BHF772
     C                     Z-ADDIKMOPM    MDST              *1
     C                     MOVE IKMOPI    OMDA              *1
     C**********           MOVE IKMCRI    TMAN              *1            BHF750
     C                     MOVE IKMCPI    TMAN              *1            BHF750
      *
     C                     ELSE                            X*1
     C                     Z-ADDIKMOPM    SDST              *1
     C                     MOVE IKMOPI    OSDA              *1
     C**********           MOVE IKMCRI    TSTN              *1            BHF750
     C                     MOVE IKMCPI    TSTN              *1            BHF750
     C                     Z-ADDIKORCM    MDST              *1
     C                     MOVE IKMORI    OMDA              *1
     C**********           MOVE IKMCPI    TMAN              *1            BHF750
     C**********           MOVE IKMCRI    TMAN              *1     BHF750 BHF772
     C                     MOVE *BLANKS   TMAN                            BHF772
     C                     MOVELIKRIBN    TMAN                            BHF772
      *
     C                     END                             E*1
      *
     C                     MOVE 'D'       RECI
     C                     Z-ADD*ZERO     RODA                            S01354
     C                     MOVE *BLANK    RODN                            S01354
     C           IKMTYP    IFNE 'ID'                       B1             S01354
     C           IKMTYP    ANDNE'IL'                       B1             S01354
     C                     MOVE IKDADN    RODN
     C*
     C**  IF DEAL ASSOCIATED NUMBER = ZERO, ROLLOVER OF DEAL
     C**  AMOUNT = ZERO
     C****       IKDADN    IFEQ '0'                        B1             S01177
     C           IKDADN    IFEQ *BLANKS                    B1             S01177
     C           IKDADN    OREQ '000000'                   B1             E21206
     C                     Z-ADD*ZERO     RODA             *1
     C                     ELSE                            X1
     C*****                Z-ADDIKAMNP    RODA             *1             E19602
     C                     Z-ADDIKRBAT    RODA             *1             E19602
     C                     END                             E1
     C                     END                             E1             S01354
     C*
     C                     MOVE *ZERO     RBDN
     C                     Z-ADD*ZERO     RBDA
     C                     MOVE IKICMT    ICBS
     C                     MOVE IKIPFQ    IPFR
     C                     Z-ADDIKMTTI    TOTI
     C                     Z-ADDIKNIPD    NIDT
     C                     Z-ADDIKNIPD    IBDT
     C                     Z-ADDIKDVSD    SLID
     C                     Z-ADD*ZERO     AIPD
     C                     Z-ADD*ZERO     DLRC
     C                     Z-ADDIKIACD    IACD
     C                     Z-ADD*ZERO     AITC
     C                     Z-ADD*ZERO     AIAN
     C                     Z-ADD*ZERO     AIAP
     C*                                                                   S01392
     C* IF FIRST & LAST DAY INTEREST = Y                                  S01392
     C* CALCULATE THE ONE DAY'S INTEREST DIFFERENCE, AND PUT IT IN AIAN   S01392
     C*                                                                   S01392
     C           IKFLID    IFEQ 'Y'                                       S01392
     C*                                                                   S01392
     C* START DATE = VALUE DATE,    END DATE = MATURITY DATE              S01392
     C*                                                                   S01392
     C***********          Z-ADDIKDVSD    @@BEG                     S01392056095
     C***********          Z-ADDIKMATD    @@END                     S01392056095
     C                     Z-ADDIKDVSD    ZZBEG                           056095
     C                     Z-ADDIKMATD    ZZEND                           056095
     C*                                                                   S01392
     C* PRINCIPAL, RATE, CALCULATION METHOD, ROUND DOWN INTEREST IND.     S01392
     C*                                                                   S01392
     C                     Z-ADDIKAMNP    @@AMT  150                      S01392
     C                     Z-ADDIKINTR    @@RATE 117                      S01392
     C***********          MOVE IKICMT    @@CALC                    S01392056095
     C                     MOVE IKICMT    ZZCALC                          056095
     C                     MOVE IKRDFC    @@RDFC  1                       S01392
     C*                                                                   S01392
     C* CALCULATE INTEREST FROM VALUE DATE TO MATURITY DATE               S01392
     C*                                                                   S01392
     C                     EXSR MM1030                                    S01392
     C                     Z-SUB@@INTR    AIAN                            S01392
     C*                                                                   S01392
     C* CALCULATE INTEREST FROM VALUE DATE TO MATURITY DATE + 1           S01392
     C*                                                                   S01392
     C***********          ADD  1         @@END                     S01392056095
     C                     ADD  1         ZZEND                           056095
     C                     EXSR MM1030                                    S01392
     C                     ADD  @@INTR    AIAN                            S01392
     C                     END                                            S01392
     C                     Z-ADD*ZERO     IPRD
     C                     Z-ADD*ZERO     IPRM
     C                     Z-ADD*ZERO     ICTD
     C                     Z-ADD*ZERO     DAVD
     C                     Z-ADD*ZERO     DASN
     C                     MOVE IKMFAO    FACO
     C                     MOVE IKSPEC    SPI
     C                     Z-ADDIKIPDM    INTF
     C*****                MOVE IKMMDI    MDIN                            S01194
     C                     MOVE IKMMDI    A6MDIN                          S01194
     C                     MOVE IKMTAX    TAXI
     C                     Z-ADD*ZERO     TAXD
     C                     Z-ADD*ZERO     TAXM
     C                     Z-ADDIKRSTM    RSTM                            S01177
     C                     MOVE IKRONS    RONS                            S01177
     C                     MOVE IKRIBN    RIBN                            S01177
     C                     MOVE IKRIBA    RIBA                            S01177
     C**********           Z-ADDIKROBN    ROBN                                         S01177 CSD027
     C**********           Z-ADDIKROCN    ROCN                                         S01177 CSD027
     C                     MOVE IKROBN    ROBN                                                CSD027
     C                     MOVE IKROCN    ROCN                                                CSD027
     C                     Z-ADDIKPSTM    PSTM                            S01177
     C                     MOVE IKPONS    PONS                            S01177
     C                     MOVE IKPIBN    PIBN                            S01177
     C                     MOVE IKPIBA    PIBA                            S01177
     C**********           Z-ADDIKPOBN    POBN                                         S01177 CSD027
     C**********           Z-ADDIKPOCN    POCN                                         S01177 CSD027
     C                     MOVE IKPOBN    POBN                                                CSD027
     C                     MOVE IKPOCN    POCN                                                CSD027
     C                     MOVE IKRCRN    RCRN                            S01177
     C                     MOVE IKRCRA    RCRA                            S01177
     C                     MOVE IKRVNO    RVNO                            S01177
     C                     MOVE IKAWBN    AWBN                            S01177
     C                     MOVE IKAWBA    AWBA                            S01177
     C                     MOVE IKBENN    BENN                            S01177
     C                     MOVE IKBENA    BENA                            S01177
     C                     MOVE IKDTP1    DTP1                            S01177
     C                     MOVE IKDTP2    DTP2                            S01177
     C                     MOVE IKDTP3    DTP3                            S01177
     C                     MOVE IKDTP4    DTP4                            S01177
     C                     MOVE IKDCHG    DCHG                            S01177
     C                     MOVE IKBTB1    BTB1                            S01177
     C                     MOVE IKBTB2    BTB2                            S01177
     C                     MOVE IKBTB3    BTB3                            S01177
     C                     MOVE IKBTB4    BTB4                            S01177
     C                     MOVE IKBTB5    BTB5                            S01177
     C                     MOVE IKBTB6    BTB6                            S01177
     C           IKCVMR    IFNE 'Y'                        B1             E22405
     C                     MOVE 'N'       CVMR             *1             E22405
     C                     ELSE                            X1             E22405
     C                     MOVE 'Y'       CVMR             *1             E22405
     C                     END                             E1             E22405
     C                     MOVE IKRDFC    JRDFC                           S01392
     C                     MOVE IKFLID    JFLID                           S01392
     C                     MOVE IKFUID    FUID                            S01392
      *
      ** Ascertain bit settings for static and non static indicators.
     C                     BITOF'01234567'DNSI
     C                     BITOF'01234567'DSTI
     C                     BITOF'01234567'ACEI
     C                     BITOF'01234567'TLXI
      *
     C           IKMTYP    IFNE 'IT'                       B*1
     C           IKMTYP    ANDNE'TD'                       B*1
     C           IKMTYP    ANDNE'CD'                       B*1
     C           IKMTYP    ANDNE'CI'                       B*1
     C           IKMTYP    ANDNE'ID'                       B*1            S01354
     C                     BITON'0'       DNSI              *1
     C                     ELSE                            X*1
     C                     BITOF'0'       DNSI              *1
     C                     END                             E*1
      *
     C           IKBSRC    IFNE *BLANK                     B*1
     C           IKMTYP    OREQ 'CD'                       B*1
     C           IKMTYP    OREQ 'CL'                       B*1
     C           IKMTYP    OREQ 'DL'                       B*1
     C           IKMTYP    OREQ 'IL'                       B*1            S01354
     C           IKMTYP    OREQ 'ID'                       B*1            S01354
     C           IKFLID    OREQ 'Y'                                       S01392
     C                     BITON'2'       DNSI              *1
     C                     ELSE                            X*1
     C                     BITOF'2'       DNSI              *1
     C                     END                             E*1
      *Hook MM0081C016 moved to match original position in R10.6          S01408
      *New hook MM0081C023 inserted for 10.6                              S01408
     C/COPY WNCPYSRC,MM0081C016                                           S01408
      *
     C                     BITOF'5'       DNSI
      *
     C                     BITOF'0'       DSTI                            E14377
     C           IKBKCD    IFNE 'TELX'                     B*1
     C           IKBKCD    ANDNE'MAIL'                     B*1
     C           IKBKCD    ANDNE'PHON'                     B*1
     C           IKBKCD    ANDNE*BLANK                     B*1            E14377
     C********** IKBRKG    ANDEQ*ZERO                      B*1            E14377
     C           IKBRKG    IFEQ *ALL'9'                    B**2           E14377
     C                     BITON'0'       DSTI             ***2           E14377
     C**********           ELSE                            X*1            E14377
     C**********           BITOF'0'       DSTI              *1            E14377
     C                     END                             E**2           E14377
     C                     END                             E*1
      *
     C           IKNGVI    IFEQ 'Y'                        B*1
     C                     BITON'1'       DSTI              *1
     C                     ELSE                            X*1
     C                     BITOF'1'       DSTI              *1
     C                     END                             E*1
      *
     C           IKFEDF    IFEQ 'Y'                        B*1
     C*****      IKCCY     ANDEQUSCY                        *1     S01136 S01194
     C           IKCCY     ANDEQBLUSCY                      *1            S01194
     C********** @IKAMN    ANDEQ'N'                         *1      S01136BHF893
     C                     BITON'2'       DSTI              *1
     C                     ELSE                            X*1
     C                     BITOF'2'       DSTI              *1
     C                     END                             E*1
      *Hook MM0081C016 moved to match original position in R10.6          S01408
      *New hook MM0081C022 inserted for DBA2.                             S01408
     C/COPY WNCPYSRC,MM0081C022                                           S01408
     C*C*PY*WNC*YS*C*MM0081C016                                           S01408
      *
     C           IKFEDF    IFEQ 'Y'                        B*1            S01136
     C*****      IKCCY     ANDEQUSCY                        *1     S01136 S01194
     C           IKCCY     ANDEQBLUSCY                      *1            S01194
     C           @IKAMN    ANDEQ'Y'                         *1            S01136
     C                     BITON'3'       DSTI              *1            S01136
     C                     ELSE                            X*1            S01136
     C                     BITOF'3'       DSTI              *1            S01136
     C                     END                             E*1            S01136
      *                                                                   S01486
      ** Portfolio Reference                                              S01486
      *                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C                     MOVE IKPTFR    PTFR                            S01486
     C                     ENDIF                                          S01486
      *
      ** Find out which bit settings are needed for confirmation
      ** indicators.
     C                     EXSR #ZA
      *
      ** BOOK CODE AND LINKED REFERENCE NUMBER                            S01165
     C                     MOVE IKBOKC    BOKC                            S01165
     C                     MOVE IKLNKN    LNKDN                           S01165
      *                                                                   S01176
      ** REPO/PLEDGE INDICATOR AND NUMBER                                 S01176
     C                     MOVE IKDRID    DRID                            S01176
     C                     MOVE IKDDMR    DDMR                            S01176
      *                                                                   S01176
     C                     Z-ADD*ZERO     LSWC
     C                     Z-ADD*ZERO     LSWS
     C*****                Z-ADDRUND      ORED                            S01194
     C*****                Z-ADDRUND      LCD                             S01194
     C                     Z-ADDBJRDNB    ORED                            S01194
     C                     Z-ADDBJRDNB    LCD                             S01194
     C                     MOVE ICMACT    CHTP
      *                                                                   S01117
      ** Set up the multibranching fields                                 S01117
     C                     MOVELIKORBR    ORBR                            S01117
     C                     MOVELIKPRFC    PRFC                            S01117
     C                     MOVELIKROBR    ROBR                            S01117
     C                     MOVELIKPOBR    POBR                            S01117
     C*                                                                   S01434
     C** Set up the enhanced rollover processing fields                   S01434
     C*                                                                   S01434
     C                     MOVELIKAURO    AURO                            S01434
     C                     MOVELIKIPDS    IPDS                            S01434
     C                     MOVELIKROFQ    ROFQ                            S01434
     C                     MOVELIKRLDN    RLDN                            S01434
     C                     MOVELIKCNNA    CNNA                            S01434
     C                     MOVELIKIMET    IMET                            S01434
     C                     MOVELIKINSA    INSA                            S01434
     C                     MOVELIKINOS    INOS                            S01434
     C                     MOVELIKWRPI    WRPI                            S01434
      *                                                                   CEU003
      ** If SAR CEU003 is installed move fields, else blank out.          CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C                     MOVELIKSTCY    STCY                            CEU003
     C                     MOVELIKIC72    IC72                            CEU003
     C                     MOVELIKISCY    ISCY                            CEU003
     C                     MOVELIKII72    II72                            CEU003
     C                     ELSE                                           CEU003
     C                     MOVE *BLANKS   STCY                            CEU003
     C                     MOVE *BLANKS   IC72                            CEU003
     C                     MOVE *BLANKS   ISCY                            CEU003
     C                     MOVE *BLANKS   II72                            CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CAC001
      **  Set up funding information fields                               CAC001
      *                                                                   CAC001
     C                     Z-ADDIKFSRP    FSRP                            CAC001
     C                     MOVE IKFSGN    FSGN                            CAC001
     C                     MOVE IKFPRC    FPRC                            CAC001
     C                     Z-ADDIKFCTD    FCTD                            CAC001
     C                     Z-ADD0         TCOF                            CAC001
     C                     Z-ADD0         ACPD                            CAC001
     C                     Z-ADD0         ACDA                            CAC001
     C                     Z-ADD0         ACAP                            CAC001
     C                     Z-ADD0         ACAN                            CAC001
     C                     Z-ADD0         COFD                            CAC001
     C                     Z-ADD0         COFM                            CAC001
     C                     Z-ADD0         CFCD                            CAC001
      *                                                                   CAC001
      **  If first & last day interest = Y, calculate the one day's       CAC001
      **  interest defference and put it in ACAN                          CAC001
      *                                                                   CAC001
     C           IKFLID    IFEQ 'Y'                                       CAC001
      *                                                                   CAC001
      **  Start date = Value date,    End date = Maturity date            CAC001
      *                                                                   CAC001
     C                     Z-ADDIKDVSD    ZZBEG                           CAC001
     C                     Z-ADDIKMATD    ZZEND                           CAC001
      *                                                                   CAC001
      **  Principal, Calculation method, Round down interest ind          CAC001
      *                                                                   CAC001
     C                     Z-ADDIKAMNP    @@AMT                           CAC001
     C                     MOVE IKICMT    ZZCALC                          CAC001
     C                     MOVE IKRDFC    @@RDFC                          CAC001
      *                                                                   CAC001
      **  Determine Effective interest rate                               CAC001
      *                                                                   CAC001
     C                     SELEC                                          CAC001
     C           IKFSGN    WHEQ ' '                                       CAC001
     C                     Z-ADDIKFSRP    @@RATE                          CAC001
     C           IKFSGN    WHEQ '+'                                       CAC001
     C           IKINTR    ADD  IKFSRP    @@RATE                          CAC001
     C           IKFSGN    WHEQ '-'                                       CAC001
     C           IKINTR    SUB  IKFSRP    @@RATE                          CAC001
     C                     ENDSL                                          CAC001
      *                                                                   CAC001
      **  Calculate interest from value date to maturity date             CAC001
      *                                                                   CAC001
     C                     EXSR MM1030                                    CAC001
     C                     Z-SUB@@INTR    ACAN                            CAC001
      *                                                                   CAC001
      **  Calculate interest from value date to maturity date + 1         CAC001
      *                                                                   CAC001
     C                     ADD  1         ZZEND                           CAC001
     C                     EXSR MM1030                                    CAC001
     C                     ADD  @@INTR    ACAN                            CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CEU015
     C                     MOVE IKRTFC    RTFC                            CEU015
      *
     C                     WRITEDEALSDCF               60
      *
     C           AUS007    IFEQ 'Y'                                       AUS007
     C           @RACD     ANDNE' '                                       AUS007
     C                     EXSR #RACD                                     AUS007
     C                     END                                            AUS007
     C*                                                                   AUS007
     C           *IN60     IFEQ '1'                        B*1
     C                     MOVE '008'     DBASE             *1
     C                     MOVEL'DEALSDC' DBFILE            *1            E14356
     C                     EXSR INFSR                       *1
     C                     END                             E*1
     C/COPY WNCPYSRC,MM0081C029
      *
      ** Update associated record, if there is one.
     C           IKDADN    IFNE *BLANK                     B*1
     C           IKDADN    ANDNE*ZEROS                                    056211
     C           IKMTYP    ANDNE'ID'                       B*1            S01354
     C           IKMTYP    ANDNE'IL'                       B*1            S01354
     C                     MOVE IKDADN    DLNO              *1
     C           DLNO      CHAINDEALSDCF             60     *1
      *
     C           *IN60     IFEQ '1'                        B*2
     C                     MOVE '009'     DBASE             *2
     C*                                                                   E14356
     C** SET UP DASE ERROR FIELDS                                         E14356
     C                     MOVEL'DEALSDC' DBFILE            *2            E14356
     C                     MOVELDLNO      DBKEY             *2            E14356
     C*                                                                   E14356
     C                     EXSR INFSR                       *2
     C                     END                             E*2
      *
     C                     Z-ADDIKDN38    RBDN              *1
     C                     Z-ADDIKAMNP    RBDA              *1
     C                     MOVE 'Y'       WRPI                            S01434
     C*****                Z-ADDRUND      LCD               *1            S01194
     C                     Z-ADDBJRDNB    LCD               *1            S01194
     C                     MOVE 'A'       CHTP              *1
      *                                                                   CEU015
     C           CEU015    IFEQ 'Y'                                       CEU015
     C           IKCCY     ANDEQBKEURO                                    CEU015
     C           IKRTFC    ANDNE*BLANKS                                   CEU015
     C                     MOVE IKCCY     RTFC                            CEU015
      *                                                                   145001
     C           IKORDA    IFLT *ZERO                                     145001
     C                     Z-SUBIKORDA    IKORDA                          145001
     C                     ENDIF                                          145001
      *                                                                   145001
     C                     Z-ADDIKORDA    RBDA                            145001
      *                                                                   145001
     C                     ELSE                                           CEU015
     C                     MOVE *BLANKS   RTFC                            CEU015
     C                     ENDIF                                          CEU015
      *
     C                     UPDATDEALSDCF               60   *1
      *
     C           *IN60     IFEQ '1'                        B*2
     C                     MOVE '010'     DBASE             *2
     C                     MOVEL'DEALSDC' DBFILE            *1            E14356
     C                     EXSR INFSR                       *2
     C                     END                             E*2
      *                                                                   079140
     C           RBDN      CHAINDEALSDCF             60     *1            079140
      *                                                                   079140
     C           *IN60     IFEQ '1'                        B*2            079140
     C                     MOVE '009'     DBASE             *2            079140
     C*                                                                   079140
     C** SET UP DASE ERROR FIELDS                                         079140
     C                     MOVEL'DEALSDC' DBFILE            *2            079140
     C                     MOVELRBDN      DBKEY             *2            079140
     C                     EXSR INFSR                       *2            079140
     C                     END                             E*2            079140
      *
     C                     END                             E*1
      *
      ** Update trailer record.
     C***************      EXSR #ZC                                       E12279
      *
     C           #BA9      ENDSR                           **#BA9**
      /EJECT
      *****************************************************************
      *                                                               *
      *  SUBROUTINE: #BB    - Insert a bought N/A (insert a new       *
      *                       record on DEALSDD).                     *
      *                                                               *
      *  FIELDS USED:       @IHAMN  -  Negative amount indicator      *   S01136
      *                                                               *
      *                                                               *
      *  CALLED BY :  #B
      *  CALLS     :
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           #BB       BEGSR
      *
     C                     Z-ADDIHDN38    DLNO
     C                     MOVE 'D'       RCDT
     C                     Z-ADD17        RCDC
     C**********           Z-ADDIHISCN    ISCN              *1                                CSD027
     C                     MOVE IHISCN    ISCN              *1                                CSD027
     C*********************Z-ADDIHBRCD    BRCD                            S01117
     C                     MOVELIHBRCA    BRCA                            S01117
     C                     MOVE IHMTYP    DTYP
     C                     MOVE IHSTYP    DLST
     C                     Z-ADDIHDDND    DDAT
     C                     Z-ADDIHDVSD    VDAT
     C                     Z-ADDIHMATD    MDAT
     C                     Z-ADDIHACSQ    IDAS
     C                     MOVE IHBKCD    BRKC
     C           IHBRKG    IFEQ *ALL'9'                    B1             E14377
     C                     Z-ADD0         BAGE             *1             E14377
     C                     ELSE                            X1             E14377
     C                     Z-ADDIHBRKG    BAGE
     C                     END                             E1             E14377
     C                     MOVE IHCCY     CCY
      *
     C           IHMTYP    IFEQ 'C1'                       B*1
     C           IHMTYP    OREQ 'C2'                        *1
     C           IHMTYP    OREQ 'BP'                        *1
     C           IHMTYP    OREQ 'BD'                        *1
     C                     Z-ADDIHAMNP    PUPR              *1
     C                     Z-ADDIHINTR    YRAT              *1
     C                     ELSE                            X*1
     C                     Z-ADDIHAMNP    PUPR              *1
     C                     Z-ADDIHDCRT    YRAT              *1
     C                     END                             E*1
      *
     C/COPY WNCPYSRC,MM0081C026
     C                     Z-ADDIHFRAT    RTSP
     C/COPY WNCPYSRC,MM0081C027
     C                     Z-ADDIHFRAT    INTR
     C                     MOVE IHCDRF    RNNA
     C**********           Z-ADDIHCNUM    CNUM                                                CSD027
     C                     MOVE IHCNUM    CNUM                                                CSD027
     C                     Z-ADDIHFCLT    FACT
     C                     Z-ADDIHFCLN    FCNO
     C                     Z-ADDIHFVAL    FVAL
     C                     Z-ADDIHBRAT    BCXR
      *
      ** Access currency details using deal currency.
     C*****                MOVE *BLANKS   KEY                             S01194
     C*****                MOVE '20'      @PRF                            S01194
     C*****                MOVE CCY       @CUR                            S01194
     C*****                MOVE '1'       @SUF                            S01194
     C*****      KEY       CHAINFDCCYTLL             60                   S01194
      *****                                                               S01194
      ***If no record found, terminate with error.                        S01194
     C*****      *IN60     IFEQ '1'                        B*1            S01194
     C*****                MOVE '011'     DBASE             *1            S01194
     C*****                                                        E14356 S01194
     C***SET UP DASE ERROR FIELDS                                  E14356 S01194
     C*****                MOVEL'FDCCYTLL'DBFILE            *1     E14356 S01194
     C*****                MOVELKEY       DBKEY             *1     E14356 S01194
     C*****                                                        E14356 S01194
     C*****                EXSR INFSR                       *1            S01194
     C*****                END                             E*1            S01194
      *
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM CCY       @AJCD   3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANK                     B1             S01194
     C                     MOVE '011'     DBASE            ***************S01194
     C                     MOVEL'SDCURRPD'DBFILE           * DBERROR 011 *S01194
     C                     MOVEL@AJCD     DBKEY            ***************S01194
     C                     EXSR INFSR                      *1             S01194
     C                     END                             E1             S01194
     C*                                                                   S01194
     C*****                Z-ADDERLC      LCXR                            S01194
     C                     Z-ADDA6ERLC    LCXR                            S01194
      *
     C                     MOVE 'D'       RECI
     C                     Z-ADDIHMOPM    SDST              *1
     C                     MOVE IHMOPI    OSDA              *1
     C                     MOVE IHMCRI    TSTN              *1
     C                     Z-ADDIHORCM    MDST              *1
     C                     MOVE IHMORI    OMDA              *1
     C                     MOVE IHMCPI    TMAN              *1
     C                     Z-ADDIHDCAM    DISA
     C                     Z-ADD*ZERO     DPTD
     C                     MOVE IHICMT    ICBS
     C                     MOVE IHIPFQ    IPFR
     C                     Z-ADDIHMTTI    TOTI
     C                     Z-ADDIHNIPD    NIDT
     C                     Z-ADDIHNIPD    IBDT
      *
     C           IHMTYP    IFEQ 'C1'                       B*1
     C                     Z-ADDIHDVSD    SLID              *1
     C                     ELSE                            X*1
     C                     Z-ADDIHSLID    SLID              *1
     C                     END                             E*1
      *
     C                     Z-ADD*ZERO     AIPD
     C                     Z-ADD*ZERO     DLRC
     C                     Z-ADDIHIACD    IACD
     C                     Z-ADD*ZERO     AITC
     C                     Z-ADD*ZERO     AIAN
     C                     Z-ADD*ZERO     AIAP
     C*                                                                   S01392
     C* CALCULATE IF ANY INTEREST DIFFERENCE BETWEEN FIGURE FOR SLID-NIDT S01392
     C* AND THAT FOR (SLID-VDAT + VDAT-NIDT) AND PUT IT IN AIAN.          S01392
     C*                                                                   S01392
     C           IHMTYP    IFEQ 'C2'                        B1            S01392
     C           IHMTYP    OREQ 'BP'                        *1            S01392
     C           IHMTYP    OREQ 'BD'                        *1            S01392
     C*                                                                   S01392
     C* PRINCIPAL, RATE, CALCULATION METHOD, ROUND DOWN INTEREST IND.     S01392
     C*                                                                   S01392
     C                     Z-ADDIHFVAL    @@AMT                           S01392
     C                     Z-ADDIHFRAT    @@RATE                          S01392
     C***********          MOVE IHICMT    @@CALC                    S01392056095
     C                     MOVE IHICMT    ZZCALC                          056095
     C                     MOVE IHRDFC    @@RDFC                          S01392
     C*                                                                   S01392
     C* START DATE = LAST INT.PAY DATE, END DATE = NEXT INT. PAY DATE     S01392
     C*                                                                   S01392
     C***********          Z-ADDSLID      @@BEG                     S01392056095
     C***********          Z-ADDNIDT      @@END                     S01392056095
     C***********@@END     IFEQ *ZERO                               S01392056095
     C***********          Z-ADDMDAT      @@END                     S01392056095
     C                     Z-ADDSLID      ZZBEG                           056095
     C                     Z-ADDNIDT      ZZEND                           056095
     C           ZZEND     IFEQ *ZERO                                     056095
     C                     Z-ADDMDAT      ZZEND                           056095
     C                     END                                            S01392
     C                     EXSR MM1030                                    S01392
     C                     Z-ADD@@INTR    AIAN                            S01392
     C*                                                                   S01392
     C* START DATE = LAST INT.PAY DATE, END DATE = VALUE DATE             S01392
     C*                                                                   S01392
     C***********          Z-ADDSLID      @@BEG                     S01392056095
     C***********          Z-ADDVDAT      @@END                     S01392056095
     C                     Z-ADDSLID      ZZBEG                           056095
     C                     Z-ADDVDAT      ZZEND                           056095
     C                     EXSR MM1030                                    S01392
     C                     SUB  @@INTR    AIAN                            S01392
     C*                                                                   S01392
     C* START DATE = VALUE DATE, END DATE = NEXT INT. PAY DATE            S01392
     C*                                                                   S01392
     C***********          Z-ADDVDAT      @@BEG                     S01392056095
     C***********          Z-ADDNIDT      @@END                     S01392056095
     C***********@@END     IFEQ *ZERO                               S01392056095
     C***********          Z-ADDMDAT      @@END                     S01392056095
     C                     Z-ADDVDAT      ZZBEG                           056095
     C                     Z-ADDNIDT      ZZEND                           056095
     C           ZZEND     IFEQ *ZERO                                     056095
     C                     Z-ADDMDAT      ZZEND                           056095
     C                     END                                            S01392
     C                     EXSR MM1030                                    S01392
     C                     SUB  @@INTR    AIAN                            S01392
     C                     END                                            S01392
     C                     Z-ADD*ZERO     IPRD
     C                     Z-ADD*ZERO     IPRM
     C                     Z-ADD*ZERO     SAPR
     C                     Z-ADD*ZERO     DAVD
     C                     Z-ADD*ZERO     DASN
     C                     MOVE IHMFAO    FACO
     C                     Z-ADD*ZERO     ASDN
     C                     Z-ADD*ZERO     SADT
     C                     MOVE IHSPEC    SPI
     C                     Z-ADDIHIPDM    INTF
     C                     MOVE IHMMDI    MDBX
     C                     Z-ADDIHMPIT    PINT1
     C                     Z-ADDIHRSTM    RSTM                            S01177
     C                     MOVE IHRONS    RONS                            S01177
     C                     MOVE IHRIBN    RIBN                            S01177
     C                     MOVE IHRIBA    RIBA                            S01177
     C**********           Z-ADDIHROBN    ROBN                                         S01177 CSD027
     C**********           Z-ADDIHROCN    ROCN                                         S01177 CSD027
     C                     MOVE IHROBN    ROBN                                                CSD027
     C                     MOVE IHROCN    ROCN                                                CSD027
     C                     Z-ADDIHPSTM    PSTM                            S01177
     C                     MOVE IHPONS    PONS                            S01177
     C                     MOVE IHPIBN    PIBN                            S01177
     C                     MOVE IHPIBA    PIBA                            S01177
     C**********           Z-ADDIHPOBN    POBN                                         S01177 CSD027
     C**********           Z-ADDIHPOCN    POCN                                         S01177 CSD027
     C                     MOVE IHPOBN    POBN                                                CSD027
     C                     MOVE IHPOCN    POCN                                                CSD027
     C                     MOVE IHRCRN    RCRN                            S01177
     C                     MOVE IHRCRA    RCRA                            S01177
     C                     MOVE IHRVNO    RVNO                            S01177
     C                     MOVE IHAWBN    AWBN                            S01177
     C                     MOVE IHAWBA    AWBA                            S01177
     C                     MOVE IHBENN    BENN                            S01177
     C                     MOVE IHBENA    BENA                            S01177
     C                     MOVE IHDTP1    DTP1                            S01177
     C                     MOVE IHDTP2    DTP2                            S01177
     C                     MOVE IHDTP3    DTP3                            S01177
     C                     MOVE IHDTP4    DTP4                            S01177
     C                     MOVE IHDCHG    DCHG                            S01177
     C                     MOVE IHBTB1    BTB1                            S01177
     C                     MOVE IHBTB2    BTB2                            S01177
     C                     MOVE IHBTB3    BTB3                            S01177
     C                     MOVE IHBTB4    BTB4                            S01177
     C                     MOVE IHBTB5    BTB5                            S01177
     C                     MOVE IHBTB6    BTB6                            S01177
     C           IHCVMR    IFNE 'Y'                        B1             E22405
     C                     MOVE 'N'       CVMR             *1             E22405
     C                     ELSE                            X1             E22405
     C                     MOVE 'Y'       CVMR             *1             E22405
     C                     END                             E1             E22405
      *
     C                     BITOF'01234567'DNSI
     C                     BITOF'01234567'DSTI
     C                     BITOF'01234567'ACEI
     C                     BITOF'01234567'TLXI
      *
     C                     BITON'0'       DNSI
     C                     BITOF'5'       DNSI
      *
     C/COPY WNCPYSRC,MM0081C028
     C           IHMTYP    IFEQ 'C1'                       B*1
     C                     BITOF'2'       DNSI              *1
     C                     ELSE                            X*1
     C                     BITON'2'       DNSI              *1
     C                     END                             E*1
      *
     C                     BITOF'0'       DSTI                            E14377
     C           IHBKCD    IFNE 'TELX'                     B*1
     C           IHBKCD    ANDNE'MAIL'                     B*1
     C           IHBKCD    ANDNE'PHON'                     B*1
     C           IHBKCD    ANDNE*BLANK                     B*1            E14377
     C********** IHBRKG    ANDEQ*ZERO                      B*1            E14377
     C           IHBRKG    IFEQ *ALL'9'                    B**2           E14377
     C                     BITON'0'       DSTI             ***2
     C**********           ELSE                            X*1            E14377
     C**********           BITOF'0'       DSTI              *1            E14377
     C                     END                             E**2           E14377
     C                     END                             E*1
      *
     C           IHFEDF    IFEQ 'Y'                        B*1
     C*****      IHCCY     ANDEQUSCY                        *1     S01136 S01194
     C           IHCCY     ANDEQBLUSCY                      *1            S01194
     C********** @IHAMN    ANDEQ'N'                         *1      S01136BHF893
     C                     BITON'2'       DSTI              *1
     C                     ELSE                            X*1
     C                     BITOF'2'       DSTI              *1
     C                     END                             E*1
      *
     C           IHFEDF    IFEQ 'Y'                        B*1            S01136
     C*****      IHCCY     ANDEQUSCY                        *1     S01136 S01194
     C           IHCCY     ANDEQBLUSCY                      *1            S01194
     C           @IHAMN    ANDEQ'Y'                         *1            S01136
     C                     BITON'3'       DSTI              *1            S01136
     C                     ELSE                            X*1            S01136
     C                     BITOF'3'       DSTI              *1            S01136
     C                     END                             E*1            S01136
      *
      ** Find out which bit settings are needed for confirmation
      ** indicators.
     C                     EXSR #ZA
      *
      ** BOOK CODE AND LINKED REFERENCE NUMBER                            S01165
     C                     MOVE IHBOKC    BOKC                            S01165
     C                     MOVE IHLNKN    LNKDN                           S01165
      *                                                                   S01127
      ** Bill Depot ID                                                    S01127
     C           IHMTYP    IFEQ 'TB'                                      S01127
     C**********           Z-ADDIHBDID    BDID                                         S01127 CSD027
     C                     MOVELIHBDID    BDID                                                CSD027
     C                     ELSE                                           S01127
     C**********           Z-ADD*ZEROS    BDID                                         S01127 CSD027
     C                     MOVE *BLANKS   BDID                                                CSD027
     C                     END                                            S01127
      *                                                                   S01127
     C                     Z-ADD*ZERO     LSWC
     C                     Z-ADD*ZERO     LSWS
     C*****                Z-ADDRUND      ORED                            S01194
     C*****                Z-ADDRUND      LCD                             S01194
     C                     Z-ADDBJRDNB    ORED                            S01194
     C                     Z-ADDBJRDNB    LCD                             S01194
     C                     MOVE ICMACT    CHTP
      *                                                                   S01117
      ** Set up the multibranching fields                                 S01117
     C                     MOVELIHORBR    ORBR                            S01117
     C                     MOVELIHPRFC    PRFC                            S01117
     C                     MOVELIHROBR    ROBR                            S01117
     C                     MOVELIHPOBR    POBR                            S01117
      *                                                                   S01378
      ** Setup parcel size and indicator, no. sold/unsold, original       S01378
      ** purchase price. Must not include sold parcels because            S01378
      ** the authorisation/insert of the NA's sold will update the        S01378
      ** NAB record on DEALSDD - see #BC)                                 S01378
     C                     MOVE IHPCLI    PCLI                            S01378
     C                     Z-ADDIHPSZE    PSZE                            S01378
     C                     Z-ADDIHOPUP    OPUP                            S01378
     C                     Z-ADD*ZERO     NSLD                            S01378
     C                     Z-ADDIHPSZE    NSDD                            S01378
     C* Round Down Facility Ind.                                          S01392
     C                     MOVELIHRDFC    JRDFC                           S01392
      *                                                                   CEU003
      ** If SAR CEU003 is installed move fields, else blank out.          CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C                     MOVELIHSTCY    STCY                            CEU003
     C                     MOVELIHIC72    IC72                            CEU003
     C                     ELSE                                           CEU003
     C                     MOVE *BLANKS   STCY                            CEU003
     C                     MOVE *BLANKS   IC72                            CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CAC001
      **  Set up funding information fields                               CAC001
      *                                                                   CAC001
     C                     Z-ADDIHFSRP    FSRP                            CAC001
     C                     MOVE IHFSGN    FSGN                            CAC001
     C                     MOVE IHFPRC    FPRC                            CAC001
     C                     Z-ADDIHTCOF    TCOF                            CAC001
     C                     Z-ADD0         ACPD                            CAC001
     C                     Z-ADD0         ACDA                            CAC001
     C                     Z-ADD0         ACAP                            CAC001
     C                     Z-ADD0         ACAN                            CAC001
     C                     Z-ADD0         COFD                            CAC001
     C                     Z-ADD0         COFM                            CAC001
      *                                                                   CAC001
      **  Calculate if any int diff between figure for SLID-NIDT          CAC001
      **  and that for (SLID-VDAT + VDAT-NIDT) and put it in ACAN         CAC001
     C*                                                                   CAC001
     C           IHMTYP    IFEQ 'C2'                                      CAC001
     C           IHMTYP    OREQ 'BP'                                      CAC001
     C           IHMTYP    OREQ 'BD'                                      CAC001
      *                                                                   CAC001
      **  Principal, Rate, Calc method, Round down int ind                CAC001
      *                                                                   CAC001
     C                     Z-ADDIHFVAL    @@AMT                           CAC001
     C                     Z-ADDIHFSRP    @@RATE                          CAC001
     C                     MOVE IHICMT    ZZCALC                          CAC001
     C                     MOVE IHRDFC    @@RDFC                          CAC001
      *                                                                   CAC001
      **  Start date = Last int pay date, End date = Next int pay date    CAC001
      *                                                                   CAC001
     C                     Z-ADDSLID      ZZBEG                           CAC001
     C                     Z-ADDNIDT      ZZEND                           CAC001
     C           ZZEND     IFEQ *ZERO                                     CAC001
     C                     Z-ADDMDAT      ZZEND                           CAC001
     C                     ENDIF                                          CAC001
     C                     EXSR MM1030                                    CAC001
     C                     Z-ADD@@INTR    ACAN                            CAC001
      *                                                                   CAC001
      **  Start date = Last int pay date, End date = Value date           CAC001
      *                                                                   CAC001
     C                     Z-ADDSLID      ZZBEG                           CAC001
     C                     Z-ADDVDAT      ZZEND                           CAC001
     C                     EXSR MM1030                                    CAC001
     C                     SUB  @@INTR    ACAN                            CAC001
      *                                                                   CAC001
      **  Start date = Value date, End date = Next int pay date           CAC001
      *                                                                   CAC001
     C                     Z-ADDVDAT      ZZBEG                           CAC001
     C                     Z-ADDNIDT      ZZEND                           CAC001
     C           ZZEND     IFEQ *ZERO                                     CAC001
     C                     Z-ADDMDAT      ZZEND                           CAC001
     C                     ENDIF                                          CAC001
     C                     EXSR MM1030                                    CAC001
     C                     SUB  @@INTR    ACAN                            CAC001
     C                     ENDIF                                          CAC001
      *
     C                     WRITEDEALSDDF               60
      *
     C           *IN60     IFEQ '1'                        B*1
     C                     MOVE '012'     DBASE             *1
     C                     MOVEL'DEALSDD' DBFILE            *1            E14356
     C                     EXSR INFSR                       *1
     C                     END                             E*1
      *
      ** Update trailer record.
     C******************   EXSR #ZC                                       E12279
      *
     C           #BB9      ENDSR                           **#BB9**
      /EJECT
      *****************************************************************
      *                                                               *
      *  SUBROUTINE: #BC    - Insert a sold N/A (insert a new         *
      *                       record on DEALSDE).                     *
      *                                                               *
      *  FIELDS USED:                                                 *
      *                                                               *
      *                                                               *
      *  CALLED BY :  #B
      *  CALLS     :
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           #BC       BEGSR
      *
     C                     Z-ADD*ZERO     HLACSQ
     C                     Z-ADD*ZERO     HLAMNP
      *
      ** Access related deal purchase record.
     C           ILDADN    IFNE *BLANK                     B*1
     C                     MOVE ILDADN    HLDN38            *1
     C           HLDN38    CHAINMMDENBP0             60     *1
     C           *IN60     IFEQ '1'                        B*2
     C                     MOVE '013'     DBASE             *2
     C*                                                                   E14356
     C** SET UP DASE ERROR FIELDS                                         E14356
     C                     MOVEL'MMDENBPP'DBFILE            *2            E14356
     C                     MOVELHLDN38    DBKEY             *2            E14356
     C*                                                                   E14356
     C                     EXSR INFSR                       *2
     C                     END                             E*2
     C                     END                             E*1
      *
     C                     Z-ADDILDN38    DLNO
     C                     MOVE 'E'       RCDT
     C                     Z-ADD18        RCDC
     C**********           Z-ADDILCNUM    SCUS                                                CSD027
     C                     MOVE ILCNUM    SCUS                                                CSD027
     C*********************Z-ADDILBRCD    BRCD                            S01117
     C                     MOVELILBRCA    BRCA                            S01117
     C                     MOVE ILMTYP    DTYP
     C                     MOVE ILSTYP    DLST
     C                     Z-ADDILDDND    DDAT
     C                     Z-ADDILDVSD    VDAT
     C****************     Z-ADD*ZERO     MTYD                            S01136
      *
     C******************   Z-ADDHLACSQ    ACSQ                            S01136
     C                     MOVE HLACSQ    ZZ005                           098319
     C                     MOVE ILBKCD    BRKC
     C           ILBRKG    IFEQ *ALL'9'                    B1             E14377
     C                     Z-ADD0         BAGE             *1             E14377
     C                     ELSE                            X1             E14377
     C                     Z-ADDILBRKG    BAGE
     C                     END                             E1             E14377
     C                     MOVE ILCCY     CCY
      *
      *
     C                     Z-ADDILAMNP    SAPR
     C                     Z-ADDILINTR    YRAT
     C*******************  Z-ADD*ZERO     ZZ0063                          S01136
     C*******************  MOVE *BLANK    ZZ0065                          S01136
     C                     Z-ADDILFRAT    INTR
     C                     MOVE ILCDRF    RNNA
     C**********           Z-ADDILISCN    ISCN                                                CSD027
     C                     MOVE ILISCN    ISCN                                                CSD027
     C*******************  Z-ADD*ZERO     FCLT                            S01136
     C*******************  Z-ADD*ZERO     FCNO                            S01136
     C                     Z-ADDILFVAL    FVAL
     C                     Z-ADDILBRAT    BCXR
      *
      ** Access currency details using deal currency.
     C*****                MOVE *BLANKS   KEY                             S01194
     C*****                MOVE '20'      @PRF                            S01194
     C*****                MOVE CCY       @CUR                            S01194
     C*****                MOVE '1'       @SUF                            S01194
     C*****      KEY       CHAINFDCCYTLL             60                   S01194
      *****                                                               S01194
      ***If no record found, terminate with error.                        S01194
     C*****      *IN60     IFEQ '1'                        B*1            S01194
     C*****                MOVE '014'     DBASE             *1            S01194
     C*****                                                        E14356 S01194
     C***SET UP DASE ERROR FIELDS                                  E14356 S01194
     C*****                MOVEL'FDCCYTLL'DBFILE            *2     E14356 S01194
     C*****                MOVELKEY       DBKEY             *2     E14356 S01194
     C*****                                                        E14356 S01194
     C*****                EXSR INFSR                       *1            S01194
     C*****                END                             E*1            S01194
      *
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM CCY       @AJCD   3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANK                     B1             S01194
     C                     MOVE '014'     DBASE            ***************S01194
     C                     MOVEL'SDCURRPD'DBFILE           * DBERROR 014 *S01194
     C                     MOVEL@AJCD     DBKEY            ***************S01194
     C                     EXSR INFSR                      *1             S01194
     C                     END                             E1             S01194
     C*                                                                   S01194
     C                     MOVE 'D'       RECI
     C*****                Z-ADDERLC      LCXR                            S01194
     C                     Z-ADDA6ERLC    LCXR                            S01194
     C                     Z-ADDILORCM    SETP
     C                     MOVE ILMORI    OSAC
     C                     MOVE ILMCPI    TSEN
     C                     Z-ADDILRSTM    RSTM                            S01177
     C                     MOVE ILRONS    RONS                            S01177
     C                     MOVE ILRIBN    RIBN                            S01177
     C                     MOVE ILRIBA    RIBA                            S01177
     C**********           Z-ADDILROBN    ROBN                                         S01177 CSD027
     C**********           Z-ADDILROCN    ROCN                                         S01177 CSD027
     C                     MOVE ILROBN    ROBN                                                CSD027
     C                     MOVE ILROCN    ROCN                                                CSD027
     C           ILCVMR    IFNE 'Y'                        B1             E22405
     C                     MOVE 'N'       CVMR             *1             E22405
     C                     ELSE                            X1             E22405
     C                     MOVE 'Y'       CVMR             *1             E22405
     C                     END                             E1             E22405
     C                     Z-ADD0         PSTM                            S01177
     C                     MOVE *BLANKS   PONS                            S01177
     C                     MOVE *BLANK    PIBN                            S01177
     C                     MOVE *BLANK    PIBA                            S01177
     C**********           Z-ADD*ZERO     POBN                                         S01177 CSD027
     C**********           Z-ADD*ZERO     POCN                                         S01177 CSD027
     C                     MOVE *BLANKS   POBN                                                CSD027
     C                     MOVE *BLANKS   POCN                                                CSD027
     C                     MOVE *BLANK    RCRN                            S01177
     C                     MOVE *BLANK    RCRA                            S01177
     C                     MOVE *BLANK    RVNO                            S01177
     C                     MOVE *BLANK    AWBN                            S01177
     C                     MOVE *BLANK    AWBA                            S01177
     C***********          MOVE *BLANK    BENN                      S01177E26971
     C                     MOVE ILBENN    BENN                            E26971
     C                     MOVE *BLANK    BENA                            S01177
     C                     MOVE *BLANK    DTP1                            S01177
     C                     MOVE *BLANK    DTP2                            S01177
     C                     MOVE *BLANK    DTP3                            S01177
     C                     MOVE *BLANK    DTP4                            S01177
     C                     MOVE *BLANK    DCHG                            S01177
     C                     MOVE *BLANK    BTB1                            S01177
     C                     MOVE *BLANK    BTB2                            S01177
     C                     MOVE *BLANK    BTB3                            S01177
     C                     MOVE *BLANK    BTB4                            S01177
     C                     MOVE *BLANK    BTB5                            S01177
     C                     MOVE *BLANK    BTB6                            S01177
     C*******************  MOVE ILICMT    ICMD                            S01136
     C*******************  Z-ADD*ZERO     TOTI                            S01136
     C*******************  Z-ADD*ZERO     NIPD                            S01136
     C*******************  Z-ADD*ZERO     IBRT                            S01136
     C*******************  Z-ADD*ZERO     SLID                            S01136
     C*******************  Z-ADD*ZERO     AIPD                            S01136
     C*******************  Z-ADD*ZERO     DLRC                            S01136
     C*******************  Z-ADD*ZERO     IADT                            S01136
     C*******************  Z-ADD*ZERO     AICD                            S01136
     C*******************  Z-ADD*ZERO     AIAN                            S01136
     C*******************  Z-ADD*ZERO     AIAP                            S01136
     C*******************  Z-ADD*ZERO     IPRD                            S01136
     C*******************  Z-ADD*ZERO     IPRM                            S01136
     C*******************  Z-ADDHLAMNP    RPPC                            S01136
     C*******************  Z-ADD*ZERO     DMVD                            S01136
     C*******************  Z-ADD*ZERO     DM38                            S01136
     C                     MOVE ILDADN    RPDN
     C**********           Z-ADDILMATD    PMDT                            E14393
     C***********          Z-ADDILRMTD    @@DTIN                    E14393056095
     C***********          EXSR ZA0680                              E14393056095
     C***********          Z-ADD@@MDNO    PMDT                      E14393056095
     C                     Z-ADDILRMTD    ZZDTIN                          056095
     C                     EXSR ZDAT10                                    056095
     C                     Z-ADDZZMDNO    PMDT                            056095
      *
     C                     BITOF'01234567'DNSI
     C                     BITOF'01234567'DSTI
     C                     BITOF'01234567'ACEI
     C                     BITOF'01234567'TLXI
      *
     C                     BITOF'0'       DNSI
      *
     C                     BITOF'0'       DSTI                            E14377
     C           ILBKCD    IFNE 'TELX'                     B*1
     C           ILBKCD    ANDNE'MAIL'                     B*1
     C           ILBKCD    ANDNE'PHON'                     B*1
     C           ILBKCD    ANDNE*BLANK                     B*1            E14377
     C********** ILBRKG    ANDEQ*ZERO                      B*1            E14377
     C           ILBRKG    IFEQ *ALL'9'                    B**2           E14377
     C                     BITON'0'       DSTI             ***2
     C**********           ELSE                            X*1            E14377
     C**********           BITOF'0'       DSTI              *1            E14377
     C                     END                             E**2           E14377
     C                     END                             E*1
      *
     C           ILFEDF    IFEQ 'Y'                        B*1
     C*****      ILCCY     ANDEQUSCY                        *1     S01136 S01194
     C           ILCCY     ANDEQBLUSCY                      *1            S01194
     C********** ILAMNP    ANDGE0                           *1      S01136BHF893
     C                     BITON'2'       DSTI              *1
     C                     ELSE                            X*1
     C                     BITOF'2'       DSTI              *1
     C                     END                             E*1
      *
     C           ILFEDF    IFEQ 'Y'                        B*1            S01136
     C*****      ILCCY     ANDEQUSCY                        *1     S01136 S01194
     C           ILCCY     ANDEQBLUSCY                      *1            S01194
     C           ILAMNP    ANDLT0                           *1            S01136
     C                     BITON'3'       DSTI              *1            S01136
     C                     ELSE                            X*1            S01136
     C                     BITOF'3'       DSTI              *1            S01136
     C                     END                             E*1            S01136
      *
      ** Find out which bit settings are needed for confirmation
      ** indicators.
     C                     EXSR #ZA
      *
      ** BOOK CODE AND LINKED REFERENCE NUMBER                            S01165
     C                     MOVE ILBOKC    BOKC                            S01165
     C                     MOVE ILLNKN    LNKDN                           S01165
     C                     Z-ADD*ZERO     LSWC
     C                     Z-ADD*ZERO     LSWS
     C*****                Z-ADDRUND      ORED                            S01194
     C*****                Z-ADDRUND      LCD                             S01194
     C                     Z-ADDBJRDNB    ORED                            S01194
     C                     Z-ADDBJRDNB    LCD                             S01194
     C                     MOVE ICMACT    CHTP
      *                                                                   S01117
      ** Set up the multibranching fields                                 S01117
     C                     MOVELILORBR    ORBR                            S01117
     C                     MOVELILPRFC    PRFC                            S01117
     C                     MOVELILROBR    ROBR                            S01117
     C*******************  MOVELILPOBR    POBR                            S01117
      *                                                                   S01378
      ** Parcel size and indicator                                        S01378
     C                     Z-ADD0         @PUSZ                           S01378
     C           ILPCLI    IFEQ 'P'                                       S01378
      * if NA is parcelled                                                S01378
     C                     MOVE ILPCLI    PCLI                            S01378
     C                     Z-ADDILPSZE    PSZE                            S01378
      *                                                                   S01378
      ** Save field for update of purchase record later                   S01378
     C**************       Z-ADDILPSZE    @PUSZ   30                S01378106071
     C                     Z-ADDILPSZE    @PUSZ   50                      106071
     C*                                                                   057349
     C** If NA is parcelled, purchase price must be updated.              057349
     C                     Z-SUBHLAMNP    @WRK1  150                      057349
     C           @WRK1     DIV  HLPSZE    @WRK1  150                      057349
     C           @WRK1     MULT ILPSZE    @WRK1                           057349
     C                     Z-ADD@WRK1     PUPR                            057349
     C                     ELSE                                           S01378
      * else NA not parcelled                                             S01378
     C                     MOVE ' '       PCLI                            S01378
     C                     Z-ADD0         PSZE                            S01378
     C*                                                                   057349
     C** Move NAB purchased price to NAS purchase price.                  057349
     C                     Z-SUBHLAMNP    PUPR                            057349
     C                     END                                            S01378
      *                                                                   CEU003
      ** If SAR CEU003 is installed move fields, else blank out.          CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C                     MOVELILSTCY    STCY                            CEU003
     C                     MOVELILIC72    IC72                            CEU003
     C                     ELSE                                           CEU003
     C                     MOVE *BLANKS   STCY                            CEU003
     C                     MOVE *BLANKS   IC72                            CEU003
     C                     ENDIF                                          CEU003
      *
     C                     WRITEDEALSDEF               60
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0081CCP1                                           S01408
      *                                                                   S01408
      *
     C           *IN60     IFEQ '1'                        B*1
     C                     MOVE '015'     DBASE             *1
     C                     MOVEL'DEALSDE' DBFILE            *1            E14356
     C                     EXSR INFSR                       *1
     C                     END                             E*1
      *
      ** Update associated bought record, if there is one.
     C           ILDADN    IFNE *BLANK                     B*1
     C                     MOVE ILDADN    DLNO              *1
     C           DLNO      CHAINDEALSDDF             60     *1
      *
     C           *IN60     IFEQ '1'                        B*2
     C                     MOVE '016'     DBASE             *2
     C*                                                                   E14356
     C** SET UP DASE ERROR FIELDS                                         E14356
     C                     MOVEL'DEALSDD' DBFILE            *2            E14356
     C                     MOVELDLNO      DBKEY             *2            E14356
     C*                                                                   E14356
     C                     EXSR INFSR                       *2
     C                     END                             E*2
      *
      ** Update number of sold N/A in purchase record                     S01378
      ** Note that the NA purchase record (DEALSDE) is updated during     S01378
      ** CoB by DL0280 to reduce Parcel size, PSZE by the number          S01378
      ** of sold parcels, and the purchase amount by the sold             S01378
      ** purchase amount                                                  S01378
     C           ILPCLI    IFEQ 'P'                                       S01378
      ** If parcelled do not update related deal fields because           S01378
      ** there may be more than one                                       S01378
     C           @PUSZ     IFNE 0                                         S01378
     C                     ADD  @PUSZ     NSLD                            S01378
     C                     SUB  @PUSZ     NSDD                            S01378
     C                     END                                            S01378
     C                     ELSE                                           S01378
      ** Else unparcelled, update amounts as normal                       S01378
     C                     Z-ADDILAMNP    SAPR              *1
     C                     Z-ADDILDN38    ASDN              *1
     C                     Z-ADDILDVSD    SADT              *1
     C                     END                                            S01378
     C*****                Z-ADDRUND      LCD               *1            S01194
     C                     Z-ADDBJRDNB    LCD               *1            S01194
     C                     MOVE 'A'       CHTP              *1
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0081CCP2                                           S01408
      *                                                                   S01408
      *
     C                     UPDATDEALSDDF               60
      *
     C           *IN60     IFEQ '1'                        B*2
     C                     MOVE '017'     DBASE             *2
     C                     MOVEL'DEALSDD' DBFILE            *1            E14356
     C                     EXSR INFSR                       *2
     C                     END                             E*2
      *
     C                     END                             E*1
      *
      ** Update trailer record.
     C*************        EXSR #ZC                                       E12279
      *
     C           #BC9      ENDSR                           **#BC9**
      /EJECT
      *****************************************************************
      *                                                               *
      *  SUBROUTINE: #BD    - Insert a deam (insert a new record      *
      *                        on DEAMSDI).                           *
      *                                                               *
      *  FIELDS USED:                                                 *
      *                                                               *
      *                                                               *
      *  CALLED BY :  #B                                              *
      *  CALLS     :                                                  *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           #BD       BEGSR
      *
      ** Ascertain file linkages  -  Process: MMP0228
      *
     C                     EXSR #BDA
      *
      ** Access related MM deal record.
     C           IGDA38    CHAINMMDEALLL             60
     C           *IN60     IFEQ '1'                        B*1
     C                     MOVE '018'     DBASE             *1
     C*                                                                   E14356
     C** SET UP DASE ERROR FIELDS                                         E14356
     C                     MOVEL'MMDEALLL'DBFILE            *2            E14356
     C                     MOVELIGDA38    DBKEY             *2            E14356
     C*                                                                   E14356
     C                     EXSR INFSR                       *1
     C                     END                             E*1
      *
     C                     MOVE 'D'       RECI
     C                     Z-ADDIGDA38    DLNO
     C                     Z-ADDIGDVSD    VDAT
     C                     Z-ADDIGDS38    DASN
     C                     MOVE IGOMDT    DTYP
      *
      ** Use subtype field from related deal record.
     C           @FORM     IFEQ 'MMDELDP0'                 B*1
     C                     MOVE HKSTYP    DLST              *1
     C                     ELSE                            X*1
     C           @FORM     IFEQ 'MMDENBP0'                 B*2
     C                     MOVE HLSTYP    DLST              *2
     C                     END                             E*2
     C                     END                             E*1
      *
     C                     MOVE IGMTYP    AMTP
     C*                                                                   051496
     C** Allocate processing sequence                                     051496
     C*                                                                   051496
     C                     Z-ADD*ZERO     PSEQ
     C/COPY WNCPYSRC,MM0081CCP7                                           S01408
     C           AMTP      LOKUPTABTYP    TABSEQ         61               051496
     C/COPY WNCPYSRC,MM0081CCP8                                           S01408
     C           *IN61     IFEQ '1'                                       051496
     C                     MOVELTABSEQ    PSEQ                            051496
     C                     ENDIF                                          051496
     C                     Z-ADD*ZERO     BRTT
     C                     Z-ADDIGINTR    RTSP
     C                     MOVE IGCCY     CCY
     C                     MOVE 'M'       MOGI
     C**********           Z-ADDIGCNUM    CNUM                                                CSD027
     C                     MOVE IGCNUM    CNUM                                                CSD027
      *
      ** Ascertain whether settlement is pay or receive.
     C                     EXSR #ZB
      *
      * Settlement is receive  -  Set up approriate fields.
     C           @RP       IFEQ 'R'                        B*1
      *
     C                     Z-ADDIGORCM    SETP              *1
     C                     MOVE IGMORI    OSAC              *1
     C                     MOVE IGMCPI    TSEN              *1
     C                     Z-ADDIGRSTM    RSTM                            S01177
     C                     MOVE IGRONS    RONS                            S01177
     C                     MOVE IGRIBN    RIBN                            S01177
     C                     MOVE IGRIBA    RIBA                            S01177
     C**********           Z-ADDIGROBN    ROBN                                         S01177 CSD027
     C**********           Z-ADDIGROCN    ROCN                                         S01177 CSD027
     C                     MOVE IGROBN    ROBN                                                CSD027
     C                     MOVE IGROCN    ROCN                                                CSD027
     C                     Z-ADD*ZERO     PSTM                            S01177
     C                     MOVE *BLANK    FACO              *1
     C*****                MOVE *BLANK    SPI               *1            E18497
     C                     MOVE IGSPEC    SPI               *1            E18497
     C                     MOVE *BLANK    PONS                            S01177
     C                     MOVE *BLANK    PIBN                            S01177
     C                     MOVE *BLANK    PIBA                            S01177
     C**********           Z-ADD*ZERO     POBN                                         S01177 CSD027
     C**********           Z-ADD*ZERO     POCN                                         S01177 CSD027
     C                     MOVE *BLANKS   POBN                                                CSD027
     C                     MOVE *BLANKS   POCN                                                CSD027
     C                     MOVE *BLANK    RCRN                            S01177
     C                     MOVE *BLANK    RCRA                            S01177
     C                     MOVE *BLANK    RVNO                            S01177
     C                     MOVE *BLANK    AWBN                            S01177
     C                     MOVE *BLANK    AWBA                            S01177
     C                     MOVE *BLANK    BENN                            S01177
     C                     MOVE *BLANK    BENA                            S01177
     C                     MOVE *BLANK    DTP1                            S01177
     C                     MOVE *BLANK    DTP2                            S01177
     C                     MOVE *BLANK    DTP3                            S01177
     C                     MOVE *BLANK    DTP4                            S01177
     C                     MOVE *BLANK    DCHG                            S01177
     C*****                MOVE *BLANK    BTB1                     S01177 E18497
     C*****                MOVE *BLANK    BTB2                     S01177 E18497
     C*****                MOVE *BLANK    BTB3                     S01177 E18497
     C*****                MOVE *BLANK    BTB4                     S01177 E18497
     C*****                MOVE *BLANK    BTB5                     S01177 E18497
     C*****                MOVE *BLANK    BTB6                     S01177 E18497
     C                     MOVE IGBTB1    BTB1                            E18497
     C                     MOVE IGBTB2    BTB2                            E18497
     C                     MOVE IGBTB3    BTB3                            E18497
     C                     MOVE IGBTB4    BTB4                            E18497
     C                     MOVE IGBTB5    BTB5                            E18497
     C                     MOVE IGBTB6    BTB6                            E18497
      *
     C                     ELSE                            X*1
     C           @RP       IFEQ 'P'                        B*2
      *
     C                     Z-ADDIGMOPM    SETP              *2
     C                     MOVE IGMOPI    OSAC              *2
     C                     MOVE IGMCRI    TSEN              *2
     C                     MOVE IGMFAO    FACO              *2
     C                     MOVE IGSPEC    SPI               *2
     C                     Z-ADDIGRSTM    RSTM                            S01177
     C                     MOVE IGRONS    RONS                            S01177
     C                     MOVE IGRIBN    RIBN                            S01177
     C                     MOVE IGRIBA    RIBA                            S01177
     C**********           Z-ADDIGROBN    ROBN                                         S01177 CSD027
     C**********           Z-ADDIGROCN    ROCN                                         S01177 CSD027
     C                     MOVE IGROBN    ROBN                                                CSD027
     C                     MOVE IGROCN    ROCN                                                CSD027
     C                     Z-ADDIGPSTM    PSTM                            S01177
     C                     MOVE IGPONS    PONS                            S01177
     C                     MOVE IGPIBN    PIBN                            S01177
     C                     MOVE IGPIBA    PIBA                            S01177
     C**********           Z-ADDIGROBN    ROBN                                         S01177 CSD027
     C**********           Z-ADDIGROCN    ROCN                                         S01177 CSD027
     C                     MOVE IGROBN    ROBN                                                CSD027
     C                     MOVE IGROCN    ROCN                                                CSD027
     C                     MOVE IGRCRN    RCRN                            S01177
     C                     MOVE IGRCRA    RCRA                            S01177
     C                     MOVE IGRVNO    RVNO                            S01177
     C                     MOVE IGAWBN    AWBN                            S01177
     C                     MOVE IGAWBA    AWBA                            S01177
     C                     MOVE IGBENN    BENN                            S01177
     C                     MOVE IGBENA    BENA                            S01177
     C                     MOVE IGDTP1    DTP1                            S01177
     C                     MOVE IGDTP2    DTP2                            S01177
     C                     MOVE IGDTP3    DTP3                            S01177
     C                     MOVE IGDTP4    DTP4                            S01177
     C                     MOVE IGDCHG    DCHG                            S01177
     C                     MOVE IGBTB1    BTB1                            S01177
     C                     MOVE IGBTB2    BTB2                            S01177
     C                     MOVE IGBTB3    BTB3                            S01177
     C                     MOVE IGBTB4    BTB4                            S01177
     C                     MOVE IGBTB5    BTB5                            S01177
     C                     MOVE IGBTB6    BTB6                            S01177
      *
     C                     ELSE                            X*2
     C                     Z-ADD*ZERO     SETP              *2
     C                     MOVE *BLANK    OSAC              *2
     C                     MOVE *BLANK    TSEN              *2
     C                     MOVE *BLANK    FACO              *2
     C*****                MOVE *BLANK    SPI               *2            E18497
     C                     MOVE IGSPEC    SPI               *2            E18497
     C                     Z-ADD*ZERO     RSTM                            S01177
     C                     MOVE *BLANK    RONS                            S01177
     C                     MOVE *BLANK    RIBN                            S01177
     C                     MOVE *BLANK    RIBA                            S01177
     C**********           Z-ADD*ZERO     ROBN                                         S01177 CSD027
     C**********           Z-ADD*ZERO     ROCN                                         S01177 CSD027
     C                     MOVE *BLANKS   ROBN                                                CSD027
     C                     MOVE *BLANKS   ROCN                                                CSD027
     C                     MOVE IGROBN    ROBN                                                CSD027
     C                     MOVE IGROCN    ROCN                                                CSD027
     C                     Z-ADD*ZERO     PSTM                            S01177
     C                     MOVE *BLANK    PONS                            S01177
     C                     MOVE *BLANK    PIBN                            S01177
     C                     MOVE *BLANK    PIBA                            S01177
     C**********           Z-ADDIGPOBN    POBN                                         S01177 CSD027
     C**********           Z-ADDIGPOCN    POCN                                         S01177 CSD027
     C                     MOVE IGPOBN    POBN                                                CSD027
     C                     MOVE IGPOCN    POCN                                                CSD027
     C                     MOVE *BLANK    RCRN                            S01177
     C                     MOVE *BLANK    RCRA                            S01177
     C                     MOVE *BLANK    RVNO                            S01177
     C                     MOVE *BLANK    AWBN                            S01177
     C                     MOVE *BLANK    AWBA                            S01177
     C                     MOVE *BLANK    BENN                            S01177
     C                     MOVE *BLANK    BENA                            S01177
     C                     MOVE *BLANK    DTP1                            S01177
     C                     MOVE *BLANK    DTP2                            S01177
     C                     MOVE *BLANK    DTP3                            S01177
     C                     MOVE *BLANK    DTP4                            S01177
     C                     MOVE *BLANK    DCHG                            S01177
     C*****                MOVE *BLANK    BTB1                     S01177 E18497
     C*****                MOVE *BLANK    BTB2                     S01177 E18497
     C*****                MOVE *BLANK    BTB3                     S01177 E18497
     C*****                MOVE *BLANK    BTB4                     S01177 E18497
     C*****                MOVE *BLANK    BTB5                     S01177 E18497
     C*****                MOVE *BLANK    BTB6                     S01177 E18497
     C                     MOVE IGBTB1    BTB1                            E18497
     C                     MOVE IGBTB2    BTB2                            E18497
     C                     MOVE IGBTB3    BTB3                            E18497
     C                     MOVE IGBTB4    BTB4                            E18497
     C                     MOVE IGBTB5    BTB5                            E18497
     C                     MOVE IGBTB6    BTB6                            E18497
      **********                                                    E22405081540
     C********** IGCVMR    IFNE 'Y'                        B1       E22405081540
     C**********           MOVE 'N'       CVMR             *1       E22405081540
     C**********           ELSE                            X1       E22405081540
     C**********           MOVE 'Y'       CVMR             *1       E22405081540
     C**********           END                             E1       E22405081540
      *
     C                     END                             E*2
      *                                                                   081540
     C           IGCVMR    IFNE 'Y'                        B2             081540
     C                     MOVE 'N'       CVMR             *2             081540
     C                     ELSE                            X2             081540
     C                     MOVE 'Y'       CVMR             *2             081540
     C                     END                             E2             081540
     C                     END                             E*1
      *
      * Set up amount as Positive or negative according to @S.
     C********** @S        IFEQ 'P'                        B*1                                255251
      *                                                                                       255251
      ** Set sign as per MMDEAMUPD otherwise for CD PD for example the amount                 255251
      ** written to DEAMSDI is negative                                                       255251
      *                                                                                       255251
     C           IGAMNP    IFGE 0                          B*1                                255251
     C                     Z-ADDIGAMNP    DAAM              *1
     C                     ELSE                            X*1
     C                     Z-SUBIGAMNP    DAAM              *1
     C                     END                             E*1
      *
     C                     Z-ADD@NAAD     NAAD
     C                     Z-ADD@NASN     NASN
      *
     C                     BITOF'01234567'DAIN
     C                     Z-ADD*ZERO     LSWC
     C*****                Z-ADDRUND      ORED                            S01194
     C*****                Z-ADDRUND      LCD                             S01194
     C                     Z-ADDBJRDNB    ORED                            S01194
     C                     Z-ADDBJRDNB    LCD                             S01194
     C                     MOVE ICMACT    CHTP
      *                                                                   S01117
      ** Set up the multibranching field - Our Settlement Branch          S01117
     C                     MOVELIGOSBR    OSBR                            S01117
     C                     MOVELIGBRCA    BRCA                            E49965
      *                                                                   CEU003
      ** If SAR CEU003 is installed move fields, else blank out.          CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C                     MOVELIGSTCY    STCY                            CEU003
     C                     MOVELIGIC72    IC72                            CEU003
     C                     ELSE                                           CEU003
     C                     MOVE *BLANKS   STCY                            CEU003
     C                     MOVE *BLANKS   IC72                            CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CAC001
      **  Set up funding information fields                               CAC001
      *                                                                   CAC001
     C                     Z-ADDIGFSRP    FSRP                            CAC001
     C                     MOVE IGIRCF    IRCF                            CAC001
     C                     MOVE IGFRCF    FRCF                            CAC001
      *
     C                     WRITEDEAMSDIF               60
     C/COPY WNCPYSRC,MM0081CCP9                                           S01408
      *
     C           *IN60     IFEQ '1'                        B*1
     C                     MOVE '019'     DBASE             *1
     C                     MOVEL'DEAMSDI' DBFILE            *1            E14356
     C                     EXSR INFSR                       *1
     C                     END                             E*1
      *
     C           @RDMIN    CASEQ'Y'       #BDB
     C                     END
      *
     C           @RDLIN    CASEQ'Y'       #BDC
     C                     END
      *
      ** Update trailer record.
     C*************        EXSR #ZD                                       E12279
      *
     C           #BD9      ENDSR                           **#BD9**
      /EJECT
      *****************************************************************
      *                                                               *
      *  SUBROUTINE: #BE    - Amend a loan/deposit (Update DEALSDC).  *
      *                                                               *
      *  FIELDS USED:    @IKAMN - Negative amount indicator           *   S01136
      *                                                               *
      *                                                               *
      *  CALLED BY :  #B
      *  CALLS     :
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           #BE       BEGSR
      *
     C           IKDN38    CHAINDEALSDCF             60
     C           *IN60     IFEQ '1'                        B*1
     C                     MOVE '020'     DBASE             *1
     C*                                                                   E14356
     C** SET UP DASE ERROR FIELDS                                         E14356
     C                     MOVEL'DEALSDC' DBFILE            *2            E14356
     C                     MOVELIKDN38    DBKEY             *2            E14356
     C*                                                                   E14356
     C                     EXSR INFSR                       *1
     C                     END                             E*1
     C*                                                                   079589
      ** Calculate bit settings for confirmation indicators.              079589
     C                     EXSR #ZA                                       079589
      *
      ** Store old fields without before-update equivalent on the
      ** standard deal, which will later need comparing.
     C                     Z-ADDNIDT      @NIDT
     C                     MOVE FACO      @FACO
     C                     MOVE SPI       @SPI
     C                     Z-ADDMDAT      @MDAT
     C                     MOVE IKIPFQ    IPFR                            E24202
     C                     Z-ADDIKIPDM    INTF                            E24202
      *                                                                   CEU003
     C                     MOVE *BLANKS   @STCY   3                       CEU003
     C                     MOVE *BLANKS   @IC72   3                       CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C                     MOVE STCY      @STCY                           CEU003
     C                     MOVE IC72      @IC72                           CEU003
     C                     ENDIF                                          CEU003
      *
      ** Find out if total interest indicator bit of non-static
      ** indicator needs to be set on.
     C           IKMTYP    IFNE 'CD'                       B*1
     C           IKMTYP    ANDNE'CL'                       B*1
     C           IKMTYP    ANDNE'DL'                       B*1
     C           IKMTYP    ANDNE'IL'                       B*1            S01354
     C           IKMTYP    ANDNE'ID'                       B*1            S01354
     C           IKMATD    ANDNEMDAT                       B*1
     C                     BITON'2'       DNSI              *1
     C*                                                                   091448
     C** When maturity date has been amended, update TOTI to be           091448
     C** consistent with IKMTTI of MMDELDPP as this will still            091448
     C** be recomputed during COB                                         091448
     C*                                                                   091448
     C                     Z-ADDIKMTTI    TOTI              *1            091448
     C                     END                             E*1
      *
     C                     Z-ADDIKMATD    MDAT
     C                     Z-ADDIKNIPD    NIDT
     C*                                                                   E38449
     C** If interest date has been changed, update interest base date     E38449
     C** also and reset tlx ind bit 2 to 0                                E38449
     C*                                                                   E38449
     C           IKNIPD    IFNE @NIDT                                     E38449
     C                     Z-ADDIKNIPD    IBDT                            E38449
     C                     BITOF'2'       TLXI                            E38449
     C                     END                                            E38449
     C*                                                                   E38449
     C                     MOVE IKCDRF    RNNA
     C**********           Z-ADDIKMCDH    CHNA                                                CSD027
     C                     MOVE IKMCDH    CHNA                                                CSD027
     C                     Z-ADDIKNTCE    NOTD                            E16044
     C                     MOVE IKIPFQ    IPFR                            E25199
     C                     MOVE IKIPDM    INTF                            E25199
      *                                                                   S01383
      ** BRT SAR - taxable indicator is now an amendable field            S01383
      *                                                                   S01383
     C                     MOVE IKMTAX    TAXI                            S01383
      *
      ** The following 6 fields (Start & maturity instructions)
      ** depend on whether the deal is for a receipt or a payment.
     C           IKMTYP    IFEQ 'IT'                       B*1
     C           IKMTYP    OREQ 'TD'                       B*1
     C           IKMTYP    OREQ 'CD'                       B*1
     C           IKMTYP    OREQ 'CI'                       B*1
     C           IKMTYP    OREQ 'ID'                       B*1            S01354
     C/COPY WNCPYSRC,MM0081C025
      *
     C                     Z-ADDIKORCM    SDST              *1
     C                     MOVE IKMORI    OSDA              *1
     C**********           MOVE IKMCPI    TSTN              *1            BHF750
     C**********           MOVE IKMCRI    TSTN              *1     BHF750 BHF772
     C                     MOVE *BLANKS   TSTN                            BHF772
     C                     MOVELIKRIBN    TSTN                            BHF772
     C                     Z-ADDIKMOPM    MDST              *1
     C                     MOVE IKMOPI    OMDA              *1
     C**********           MOVE IKMCRI    TMAN              *1            BHF750
     C                     MOVE IKMCPI    TMAN              *1            BHF750
      *
     C                     ELSE                            X*1
     C                     Z-ADDIKMOPM    SDST              *1
     C                     MOVE IKMOPI    OSDA              *1
     C**********           MOVE IKMCRI    TSTN              *1            BHF750
     C                     MOVE IKMCPI    TSTN              *1            BHF750
     C                     Z-ADDIKORCM    MDST              *1
     C                     MOVE IKMORI    OMDA              *1
     C**********           MOVE IKMCPI    TMAN              *1            BHF750
     C**********           MOVE IKMCRI    TMAN              *1     BHF750 BHF772
     C                     MOVE *BLANKS   TMAN                            BHF772
     C                     MOVELIKRIBN    TMAN                            BHF772
      *
     C                     END                             E*1
      *
     C                     MOVE IKMFAO    FACO
     C                     MOVE IKSPEC    SPI
     C                     Z-ADDIKRSTM    RSTM                            S01177
     C                     MOVE IKRONS    RONS                            S01177
     C                     MOVE IKRIBN    RIBN                            S01177
     C                     MOVE IKRIBA    RIBA                            S01177
     C**********           Z-ADDIKROBN    ROBN                                         S01177 CSD027
     C**********           Z-ADDIKROCN    ROCN                                         S01177 CSD027
     C                     MOVE IKROBN    ROBN                                                CSD027
     C                     MOVE IKROCN    ROCN                                                CSD027
     C                     Z-ADDIKPSTM    PSTM                            S01177
     C                     MOVE IKPONS    PONS                            S01177
     C                     MOVE IKPIBN    PIBN                            S01177
     C                     MOVE IKPIBA    PIBA                            S01177
     C**********           Z-ADDIKPOBN    POBN                                         S01177 CSD027
     C**********           Z-ADDIKPOCN    POCN                                         S01177 CSD027
     C                     MOVE IKPOBN    POBN                                                CSD027
     C                     MOVE IKPOCN    POCN                                                CSD027
     C                     MOVE IKRCRN    RCRN                            S01177
     C                     MOVE IKRCRA    RCRA                            S01177
     C                     MOVE IKRVNO    RVNO                            S01177
     C                     MOVE IKAWBN    AWBN                            S01177
     C                     MOVE IKAWBA    AWBA                            S01177
     C                     MOVE IKBENN    BENN                            S01177
     C                     MOVE IKBENA    BENA                            S01177
     C                     MOVE IKDTP1    DTP1                            S01177
     C                     MOVE IKDTP2    DTP2                            S01177
     C                     MOVE IKDTP3    DTP3                            S01177
     C                     MOVE IKDTP4    DTP4                            S01177
     C                     MOVE IKDCHG    DCHG                            S01177
     C*********************MOVE IKBTB2    BTB1                      S01177BHF910
     C                     MOVE IKBTB1    BTB1                            BHF910
     C                     MOVE IKBTB2    BTB2                            S01177
     C                     MOVE IKBTB3    BTB3                            S01177
     C                     MOVE IKBTB4    BTB4                            S01177
     C                     MOVE IKBTB5    BTB5                            S01177
     C                     MOVE IKBTB6    BTB6                            S01177
     C           IKCVMR    IFNE 'Y'                        B1             E22405
     C                     MOVE 'N'       CVMR             *1             E22405
     C                     ELSE                            X1             E22405
     C                     MOVE 'Y'       CVMR             *1             E22405
     C                     END                             E1             E22405
     C                     MOVE IKRDFC    JRDFC                           S01392
     C                     MOVE IKFLID    JFLID                           S01392
     C                     MOVE IKFUID    FUID                            S01392
      *                                                                   S01136
     C           IKFEDF    IFEQ 'Y'                        B*1            S01136
     C*****      IKCCY     ANDEQUSCY                        *1     S01136 S01194
     C           IKCCY     ANDEQBLUSCY                      *1            S01194
     C********** @IKAMN    ANDEQ'N'                         *1      S01136BHF893
     C                     BITON'2'       DSTI              *1            S01136
     C                     ELSE                            X*1            S01136
     C                     BITOF'2'       DSTI              *1            S01136
     C                     END                             E*1            S01136
      *                                                                   S01136
     C           IKFEDF    IFEQ 'Y'                        B*1            S01136
     C*****      IKCCY     ANDEQUSCY                        *1     S01136 S01194
     C           IKCCY     ANDEQBLUSCY                      *1            S01194
     C           @IKAMN    ANDEQ'Y'                         *1            S01136
     C                     BITON'3'       DSTI              *1            S01136
     C                     ELSE                            X*1            S01136
     C                     BITOF'3'       DSTI              *1            S01136
     C                     END                             E*1            S01136
      *                                                                   S01486
      ** Portfolio Reference                                              S01486
      *                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C                     MOVE IKPTFR    PTFR                            S01486
     C                     ENDIF                                          S01486
      *
      ***Calculate*bit*settings*for*confirmation*indicators.**************079589
     C***********          EXSR #ZA                                       079589
      *
      ** BOOK CODE AND LINKED REFERENCE NUMBER                            S01165
     C                     MOVE IKBOKC    BOKC                            S01165
     C                     MOVE IKLNKN    LNKDN                           S01165
      *                                                                   S01176
      ** REPO/PLEDGE INDICATOR AND NUMBER                                 S01176
     C                     MOVE IKDRID    DRID                            S01176
     C                     MOVE IKDDMR    DDMR                            S01176
      *                                                                   S01176
     C*****                Z-ADDRUND      LCD                             S01194
     C                     Z-ADDBJRDNB    LCD                             S01194
     C                     MOVE 'A'       CHTP
      *                                                                   S01117
      ** Set up the multibranching fields                                 S01117
     C                     MOVELIKORBR    ORBR                            S01117
     C                     MOVELIKPRFC    PRFC                            S01117
     C                     MOVELIKROBR    ROBR                            S01117
     C                     MOVELIKPOBR    POBR                            S01117
     C*                                                                   S01434
     C** Set up the enhanced rollover processing fields                   S01434
     C*                                                                   S01434
     C                     MOVELIKAURO    AURO                            S01434
     C                     MOVELIKIPDS    IPDS                            S01434
     C                     MOVELIKROFQ    ROFQ                            S01434
     C                     MOVELIKRLDN    RLDN                            S01434
     C                     MOVELIKCNNA    CNNA                            S01434
     C                     MOVELIKIMET    IMET                            S01434
     C                     MOVELIKINSA    INSA                            S01434
     C                     MOVELIKINOS    INOS                            S01434
     C                     MOVELIKWRPI    WRPI                            S01434
      *                                                                   CAC001
      **  Set up funding information fields                               CAC001
      *                                                                   CAC001
     C                     Z-ADDIKFSRP    FSRP                            CAC001
     C                     MOVE IKFSGN    FSGN                            CAC001
     C                     MOVE IKFPRC    FPRC                            CAC001
     C                     Z-ADDIKFCTD    FCTD                            CAC001
     C                     Z-ADD0         ACAN                            CAC001
      *                                                                   CAC001
      **  If first & last day interest = Y, calculate the one day's       CAC001
      **  interest defference and put it in ACAN                          CAC001
      *                                                                   CAC001
     C           IKFLID    IFEQ 'Y'                                       CAC001
      *                                                                   CAC001
      **  Start date = Value date,    End date = Maturity date            CAC001
      *                                                                   CAC001
     C                     Z-ADDIKDVSD    ZZBEG                           CAC001
     C                     Z-ADDIKMATD    ZZEND                           CAC001
      *                                                                   CAC001
      **  Principal, Calculation method, Round down interest ind          CAC001
      *                                                                   CAC001
     C                     Z-ADDIKAMNP    @@AMT                           CAC001
     C                     MOVE IKICMT    ZZCALC                          CAC001
     C                     MOVE IKRDFC    @@RDFC                          CAC001
      *                                                                   CAC001
      **  Determine Effective interest rate                               CAC001
      *                                                                   CAC001
     C                     SELEC                                          CAC001
     C           IKFSGN    WHEQ ' '                                       CAC001
     C                     Z-ADDIKFSRP    @@RATE                          CAC001
     C           IKFSGN    WHEQ '+'                                       CAC001
     C           IKINTR    ADD  IKFSRP    @@RATE                          CAC001
     C           IKFSGN    WHEQ '-'                                       CAC001
     C           IKINTR    SUB  IKFSRP    @@RATE                          CAC001
     C                     ENDSL                                          CAC001
      *                                                                   CAC001
      **  Calculate interest from value date to maturity date             CAC001
      *                                                                   CAC001
     C                     EXSR MM1030                                    CAC001
     C                     Z-SUB@@INTR    ACAN                            CAC001
      *                                                                   CAC001
      **  Calculate interest from value date to maturity date + 1         CAC001
      *                                                                   CAC001
     C                     ADD  1         ZZEND                           CAC001
     C                     EXSR MM1030                                    CAC001
     C                     ADD  @@INTR    ACAN                            CAC001
     C                     ENDIF                                          CAC001
     C*                                                                   E24311
     C** RESET BIT 0 OF CONFIRMATION INDICATORS FOR EACH UPDATE           E24311
     C**   ON THE DEALS FILE DUE TO AMENDMENTS                            E24311
     C                     BITOF'0'       CNFI                            E24311
      *                                                                   CEU003
      ** If SAR CEU003 is installed move fields, else blank out.          CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C                     MOVELIKSTCY    STCY                            CEU003
     C                     MOVELIKIC72    IC72                            CEU003
     C                     MOVELIKISCY    ISCY                            CEU003
     C                     MOVELIKII72    II72                            CEU003
     C                     ELSE                                           CEU003
     C                     MOVE *BLANKS   STCY                            CEU003
     C                     MOVE *BLANKS   IC72                            CEU003
     C                     MOVE *BLANKS   ISCY                            CEU003
     C                     MOVE *BLANKS   II72                            CEU003
     C                     ENDIF                                          CEU003
      *
     C                     UPDATDEALSDCF               60
     C*                                                                   E24311
     C** FOR AMENDMENTS ON LOANS/DEPOSITS, CONFIRMATION                   E24311
     C**   REQUESTED SHOULD BE 'Y'                                        E24311
     C                     MOVE 'Y'       @CNRQ                           E24311
      *
     C           *IN60     IFEQ '1'                        B*1
     C                     MOVE '021'     DBASE             *1
     C                     MOVEL'DEALSDC' DBFILE            *1            E14356
     C                     EXSR INFSR                       *1
     C/COPY WNCPYSRC,MM0081C030
     C*                                                                   051154
     C                     ELSE                            X*1            051154
     C*                                                                   051154
     C** For amendment of maturity date update appropriate record         051154
     C** on history file                                                  051154
     C*                                                                   051154
     C           MDAT      IFNE @MDAT                      B*2            051154
     C           IKDN38    SETLLHIST1                    65               051154
     C************IN65     IFEQ '0'                        B*3     051154 055272
     C***********          MOVE '030'     DBASE                    051154 055272
     C***********                                                  051154 055272
     C***Set*up*dbase*error*fields*********************************051154 055272
     C***********                                                  051154 055272
     C***********          MOVEL'HISTSAA' DBFILE                   051154 055272
     C***********          MOVELIKDN38    DBKEY                    051154 055272
     C***********          EXSR INFSR                              051154 055272
     C***********          ELSE                            X*3     051154 055272
     C           *IN65     IFEQ '1'                        B*3            055272
     C*                                                                   051154
     C** Read through history records till OB(Opening Balance) or         051154
     C** LD(Lodgement) record found check if maturity date is             051154
     C** different, if so update history record.                          051154
     C*                                                                   051154
     C                     SETOF                     65                   051154
     C                     READ HIST1                    65               051154
     C           *IN65     DOWEQ'0'                        B*4            051154
     C           RTYP      IFEQ 'OB'                       B*5            051154
     C           RTYP      OREQ 'LD'                        *5            051154
     C/COPY WNCPYSRC,MM0081CP13                                           S01408
     C           MDAT      IFNE HMDAT                      B*6            051154
     C/COPY WNCPYSRC,MM0081CP14                                           S01408
     C                     Z-ADDMDAT      HMDAT                           051154
     C/COPY WNCPYSRC,MM0081CP15                                           S01408
     C                     UPDATHISTSAAF                                  051154
     C                     END                             E*6            051154
     C                     END                             E*5            051154
     C           IKDN38    READEHIST1                    65               051154
     C                     END                             E*4            051154
     C                     END                             E*3            051154
     C                     END                             E*2            051154
     C                     END                             E*1
      *
     C           #BE9      ENDSR                           **#BE9**
      /EJECT
      *****************************************************************
      *                                                               *
      *  SUBROUTINE: #BF    - Amend a bought N/A (Update DEALSDD).    *
      *                                                               *
      *  FIELDS USED:       @IHAMN - Negative amount indicator        *   S01136
      *                                                               *
      *                                                               *
      *  CALLED BY :  #B
      *  CALLS     :
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           #BF       BEGSR
      *
     C           IHDN38    CHAINDEALSDDF             60
     C           *IN60     IFEQ '1'                        B*1
     C                     MOVE '022'     DBASE             *1
     C*                                                                   E14356
     C** SET UP DASE ERROR FIELDS                                         E14356
     C                     MOVEL'DEALSDD' DBFILE            *2            E14356
     C                     MOVELIHDN38    DBKEY             *2            E14356
     C*                                                                   E14356
     C                     EXSR INFSR                       *1
     C                     END                             E*1
      *                                                                   079589
      ** Find out which bit settings are needed for confirmation          079589
      ** indicators.                                                      079589
     C                     EXSR #ZA                                       079589
      *
      ** Store old fields without before-update equivalent on the
      ** standard deal, which will later need comparing.
     C                     Z-ADDNIDT      @NIDT
     C                     Z-ADDMDAT      @MDAT
      *
     C                     Z-ADDIHIPDM    INTF                            BH1086
     C                     Z-ADDIHNIPD    NIDT
     C                     MOVE IHCDRF    RNNA
     C                     Z-ADDIHMOPM    SDST              *1
     C                     MOVE IHMOPI    OSDA              *1
     C                     MOVE IHMCRI    TSTN              *1
     C                     Z-ADDIHORCM    MDST              *1
     C                     MOVE IHMORI    OMDA              *1
     C                     MOVE IHMCPI    TMAN              *1
     C                     MOVE IHMFAO    FACO
     C                     MOVE IHSPEC    SPI
     C/COPY WNCPYSRC,MM0081C032
     C                     Z-ADDIHRSTM    RSTM                            S01177
     C                     MOVE IHRONS    RONS                            S01177
     C                     MOVE IHRIBN    RIBN                            S01177
     C                     MOVE IHRIBA    RIBA                            S01177
     C**********           Z-ADDIHROBN    ROBN                                         S01177 CSD027
     C**********           Z-ADDIHROCN    ROCN                                         S01177 CSD027
     C                     MOVE IHROBN    ROBN                                                CSD027
     C                     MOVE IHROCN    ROCN                                                CSD027
     C                     Z-ADDIHPSTM    PSTM                            S01177
     C                     MOVE IHPONS    PONS                            S01177
     C                     MOVE IHPIBN    PIBN                            S01177
     C                     MOVE IHPIBA    PIBA                            S01177
     C**********           Z-ADDIHPOBN    POBN                                         S01177 CSD027
     C**********           Z-ADDIHPOCN    POCN                                         S01177 CSD027
     C                     MOVE IHPOBN    POBN                                                CSD027
     C                     MOVE IHPOCN    POCN                                                CSD027
     C                     MOVE IHRCRN    RCRN                            S01177
     C                     MOVE IHRCRA    RCRA                            S01177
     C                     MOVE IHRVNO    RVNO                            S01177
     C                     MOVE IHAWBN    AWBN                            S01177
     C                     MOVE IHAWBA    AWBA                            S01177
     C                     MOVE IHBENN    BENN                            S01177
     C                     MOVE IHBENA    BENA                            S01177
     C                     MOVE IHDTP1    DTP1                            S01177
     C                     MOVE IHDTP2    DTP2                            S01177
     C                     MOVE IHDTP3    DTP3                            S01177
     C                     MOVE IHDTP4    DTP4                            S01177
     C                     MOVE IHDCHG    DCHG                            S01177
     C                     MOVE IHBTB1    BTB1                            S01177
     C                     MOVE IHBTB2    BTB2                            S01177
     C                     MOVE IHBTB3    BTB3                            S01177
     C                     MOVE IHBTB4    BTB4                            S01177
     C                     MOVE IHBTB5    BTB5                            S01177
     C                     MOVE IHBTB6    BTB6                            S01177
      *                                                                   CEU003
     C                     MOVE *BLANKS   @STCY                           CEU003
     C                     MOVE *BLANKS   @IC72                           CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C                     MOVE STCY      @STCY                           CEU003
     C                     MOVE IC72      @IC72                           CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C           IHCVMR    IFNE 'Y'                        B1             E22405
     C                     MOVE 'N'       CVMR             *1             E22405
     C                     ELSE                            X1             E22405
     C                     MOVE 'Y'       CVMR             *1             E22405
     C                     END                             E1             E22405
      *
     C           IHFEDF    IFEQ 'Y'                        B*1            S01136
     C*****      IHCCY     ANDEQUSCY                        *1     S01136 S01194
     C           IHCCY     ANDEQBLUSCY                      *1            S01194
     C********** @IHAMN    ANDEQ'N'                         *1      S01136BHF893
     C                     BITON'2'       DSTI              *1            S01136
     C                     ELSE                            X*1            S01136
     C                     BITOF'2'       DSTI              *1            S01136
     C                     END                             E*1            S01136
      *                                                                   S01136
     C           IHFEDF    IFEQ 'Y'                        B*1            S01136
     C*****      IHCCY     ANDEQUSCY                        *1     S01136 S01194
     C           IHCCY     ANDEQBLUSCY                      *1            S01194
     C           @IHAMN    ANDEQ'Y'                         *1            S01136
     C                     BITON'3'       DSTI              *1            S01136
     C                     ELSE                            X*1            S01136
     C                     BITOF'3'       DSTI              *1            S01136
     C                     END                             E*1            S01136
      ********************************************************************079589
      ***Find*out*which*bit*settings*are*needed*for*confirmation**********079589
      ***indicators.******************************************************079589
     C***********          EXSR #ZA                                       079589
      ** BOOK CODE AND LINKED REFERENCE NUMBER                            S01165
     C                     MOVE IHBOKC    BOKC                            S01165
     C                     MOVE IHLNKN    LNKDN                           S01165
     C/COPY WNCPYSRC,MM0081C033
      *                                                                   S01127
      ** Bill Depot ID                                                    S01127
     C           IHMTYP    IFEQ 'TB'                                      S01127
     C**********           Z-ADDIHBDID    BDID                                         S01127 CSD027
     C                     MOVELIHBDID    BDID                                                CSD027
     C                     ELSE                                           S01127
     C**********           Z-ADD*ZEROS    BDID                                         S01127 CSD027
     C                     MOVE *BLANKS   BDID                                                CSD027
     C                     END                                            S01127
      *                                                                   S01127
     C*****                Z-ADDRUND      LCD                             S01194
     C                     Z-ADDBJRDNB    LCD                             S01194
     C                     MOVE 'A'       CHTP
      *                                                                   S01117
      ** Set up the multibranching fields                                 S01117
     C                     MOVELIHORBR    ORBR                            S01117
     C                     MOVELIHPRFC    PRFC                            S01117
     C                     MOVELIHROBR    ROBR                            S01117
     C                     MOVELIHPOBR    POBR                            S01117
      *                                                                   S01378
      ** Parcel size and indicator                                        S01378
     C                     MOVE IHPCLI    PCLI                            S01378
     C                     Z-ADDIHPSZE    PSZE                            S01378
     C                     Z-ADDIHNSDD    NSDD                            S01378
     C* Round Down Facility Ind.                                          S01392
     C                     MOVELIHRDFC    JRDFC                           S01392
      *                                                                   CEU003
      ** If SAR CEU003 is installed move fields, else blank out.          CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C                     MOVELIHSTCY    STCY                            CEU003
     C                     MOVELIHIC72    IC72                            CEU003
     C                     ELSE                                           CEU003
     C                     MOVE *BLANKS   STCY                            CEU003
     C                     MOVE *BLANKS   IC72                            CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CAC001
      **  Set up funding information fields                               CAC001
      *                                                                   CAC001
     C                     Z-ADDIHFSRP    FSRP                            CAC001
     C                     MOVE IHFSGN    FSGN                            CAC001
     C                     MOVE IHFPRC    FPRC                            CAC001
     C                     Z-ADDIHTCOF    TCOF                            CAC001
     C                     Z-ADD0         ACAN                            CAC001
      *                                                                   CAC001
      **  Calculate if any int diff between figure for SLID-NIDT          CAC001
      **  and that for (SLID-VDAT + VDAT-NIDT) and put it in ACAN         CAC001
     C*                                                                   CAC001
     C           IHMTYP    IFEQ 'C2'                                      CAC001
     C           IHMTYP    OREQ 'BP'                                      CAC001
     C           IHMTYP    OREQ 'BD'                                      CAC001
      *                                                                   CAC001
      **  Principal, Rate, Calc method, Round down int ind                CAC001
      *                                                                   CAC001
     C                     Z-ADDIHFVAL    @@AMT                           CAC001
     C                     Z-ADDIHFSRP    @@RATE                          CAC001
     C                     MOVE IHICMT    ZZCALC                          CAC001
     C                     MOVE IHRDFC    @@RDFC                          CAC001
      *                                                                   CAC001
      **  Start date = Last int pay date, End date = Next int pay date    CAC001
      *                                                                   CAC001
     C                     Z-ADDIHSLID    ZZBEG                           CAC001
     C                     Z-ADDIHNIPD    ZZEND                           CAC001
     C           ZZEND     IFEQ *ZERO                                     CAC001
     C                     Z-ADDIHMATD    ZZEND                           CAC001
     C                     ENDIF                                          CAC001
     C                     EXSR MM1030                                    CAC001
     C                     Z-ADD@@INTR    ACAN                            CAC001
      *                                                                   CAC001
      **  Start date = Last int pay date, End date = Value date           CAC001
      *                                                                   CAC001
     C                     Z-ADDIHSLID    ZZBEG                           CAC001
     C                     Z-ADDIHDVSD    ZZEND                           CAC001
     C                     EXSR MM1030                                    CAC001
     C                     SUB  @@INTR    ACAN                            CAC001
      *                                                                   CAC001
      **  Start date = Value date, End date = Next int pay date           CAC001
      *                                                                   CAC001
     C                     Z-ADDIHDVSD    ZZBEG                           CAC001
     C                     Z-ADDIHNIPD    ZZEND                           CAC001
     C           ZZEND     IFEQ *ZERO                                     CAC001
     C                     Z-ADDIHMATD    ZZEND                           CAC001
     C                     ENDIF                                          CAC001
     C                     EXSR MM1030                                    CAC001
     C                     SUB  @@INTR    ACAN                            CAC001
     C                     ENDIF                                          CAC001
      *
     C                     UPDATDEALSDDF               60
      *
     C           *IN60     IFEQ '1'                        B*1
     C                     MOVE '023'     DBASE             *1
     C                     MOVEL'DEALSDD' DBFILE            *1            E14356
     C                     EXSR INFSR                       *1
     C                     END                             E*1
      *
     C           #BF9      ENDSR                           **#BF9**
      /EJECT
      *****************************************************************
      *                                                               *
      *  SUBROUTINE: #BG    - Amend a sold N/A (Update DEALSDE).      *
      *                                                               *
      *  FIELDS USED:                                                 *
      *                                                               *
      *                                                               *
      *  CALLED BY :  #B
      *  CALLS     :
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           #BG       BEGSR
      *
     C           ILDN38    CHAINDEALSDEF             60
     C           *IN60     IFEQ '1'                        B*1
     C                     MOVE '024'     DBASE             *1
     C*                                                                   E14356
     C** SET UP DASE ERROR FIELDS                                         E14356
     C                     MOVEL'DEALSDE' DBFILE            *2            E14356
     C                     MOVELILDN38    DBKEY             *2            E14356
     C*                                                                   E14356
     C                     EXSR INFSR                       *1
     C                     END                             E*1
      *                                                                   CEU003
     C                     MOVE *BLANKS   @STCY                           CEU003
     C                     MOVE *BLANKS   @IC72                           CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C                     MOVE STCY      @STCY                           CEU003
     C                     MOVE IC72      @IC72                           CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
      *                                                                   079589
      ** Find out which bit settings are needed for confirmation          079589
      ** indicators.                                                      079589
     C                     EXSR #ZA                                       079589
      *
      *  Save up original sold size of parcel                             S01378
     C**********           Z-ADDPSZE      @SSIZE  30               S01378 154018
     C                     Z-ADDPSZE      @SSIZE  50                      154018
      *                                                                   S01378
     C                     Z-ADDILORCM    SETP
     C                     MOVE ILMORI    OSAC
     C                     MOVE ILMCPI    TSEN
     C                     Z-ADDILRSTM    RSTM                            S01177
     C                     MOVE ILRONS    RONS                            S01177
     C                     MOVE ILRIBN    RIBN                            S01177
     C                     MOVE ILRIBA    RIBA                            S01177
     C**********           Z-ADDILROBN    ROBN                                         S01177 CSD027
     C**********           Z-ADDILROCN    ROCN                                         S01177 CSD027
     C                     MOVE ILROBN    ROBN                                                CSD027
     C                     MOVE ILROCN    ROCN                                                CSD027
     C           ILCVMR    IFNE 'Y'                        B1             E22405
     C                     MOVE 'N'       CVMR             *1             E22405
     C                     ELSE                            X1             E22405
     C                     MOVE 'Y'       CVMR             *1             E22405
     C                     END                             E1             E22405
     C                     Z-ADD0         PSTM                            S01177
     C                     MOVE *BLANK    PONS                            S01177
     C                     MOVE *BLANK    PIBN                            S01177
     C                     MOVE *BLANK    PIBA                            S01177
     C**********           Z-ADD*ZERO     POBN                                         S01177 CSD027
     C**********           Z-ADD*ZERO     POCN                                         S01177 CSD027
     C                     MOVE *BLANKS   POBN                                                CSD027
     C                     MOVE *BLANKS   POCN                                                CSD027
     C                     MOVE *BLANK    RCRN                            S01177
     C                     MOVE *BLANK    RCRA                            S01177
     C                     MOVE *BLANK    RVNO                            S01177
     C                     MOVE *BLANK    AWBN                            S01177
     C                     MOVE *BLANK    AWBA                            S01177
     C***********          MOVE *BLANK    BENN                      S01177E26971
     C                     MOVE ILBENN    BENN                            E26971
     C                     MOVE *BLANK    BENA                            S01177
     C                     MOVE *BLANK    DTP1                            S01177
     C                     MOVE *BLANK    DTP2                            S01177
     C                     MOVE *BLANK    DTP3                            S01177
     C                     MOVE *BLANK    DTP4                            S01177
     C                     MOVE *BLANK    DCHG                            S01177
     C                     MOVE *BLANK    BTB1                            S01177
     C                     MOVE *BLANK    BTB2                            S01177
     C                     MOVE *BLANK    BTB3                            S01177
     C                     MOVE *BLANK    BTB4                            S01177
     C                     MOVE *BLANK    BTB5                            S01177
     C                     MOVE *BLANK    BTB6                            S01177
      *                                                                   S01136
     C           ILFEDF    IFEQ 'Y'                        B*1            S01136
     C*****      ILCCY     ANDEQUSCY                        *1     S01136 S01194
     C           ILCCY     ANDEQBLUSCY                      *1            S01194
     C********** ILAMNP    ANDGE0                           *1      S01136BHF893
     C                     BITON'2'       DSTI              *1            S01136
     C                     ELSE                            X*1            S01136
     C                     BITOF'2'       DSTI              *1            S01136
     C                     END                             E*1            S01136
      *                                                                   S01136
     C           ILFEDF    IFEQ 'Y'                        B*1            S01136
     C*****      ILCCY     ANDEQUSCY                        *1     S01136 S01194
     C           ILCCY     ANDEQBLUSCY                      *1            S01194
     C           ILAMNP    ANDLT0                           *1            S01136
     C                     BITON'3'       DSTI              *1            S01136
     C                     ELSE                            X*1            S01136
     C                     BITOF'3'       DSTI              *1            S01136
     C                     END                             E*1            S01136
     C*                                                                   E22405
     C           IGCVMR    IFNE 'Y'                        B1             E22405
     C                     MOVE 'N'       CVMR             *1             E22405
     C                     ELSE                            X1             E22405
     C                     MOVE 'Y'       CVMR             *1             E22405
     C                     END                             E1             E22405
      ********************************************************************079589
      ***Find*out*which*bit*settings*are*needed*for*confirmation**********079589
      ***indicators.******************************************************079589
     C***********          EXSR #ZA                                       079589
      *
      ** BOOK CODE AND LINKED REFERENCE NUMBER                            S01165
     C                     MOVE ILBOKC    BOKC                            S01165
     C                     MOVE ILLNKN    LNKDN                           S01165
     C*****                Z-ADDRUND      LCD                             S01194
     C                     Z-ADDBJRDNB    LCD                             S01194
     C                     MOVE 'A'       CHTP
      *                                                                   S01117
      ** Set up the multibranching fields                                 S01117
     C                     MOVELILORBR    ORBR                            S01117
     C                     MOVELILPRFC    PRFC                            S01117
     C                     MOVELILROBR    ROBR                            S01117
     C*******************  MOVELILPOBR    POBR                            S01117
      *                                                                   S01378
      ** Parcel size and indicator                                        S01378
     C                     MOVE ILPCLI    PCLI                            S01378
     C                     Z-ADDILPSZE    PSZE                            S01378
      *                                                                   CEU003
      ** If SAR CEU003 is installed move fields, else blank out.          CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C                     MOVELILSTCY    STCY                            CEU003
     C                     MOVELILIC72    IC72                            CEU003
     C                     ELSE                                           CEU003
     C                     MOVE *BLANKS   STCY                            CEU003
     C                     MOVE *BLANKS   IC72                            CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
      *                                                                   S01117
     C                     UPDATDEALSDEF               60
      *
     C           *IN60     IFEQ '1'                        B*1
     C                     MOVE '025'     DBASE             *1
     C                     MOVEL'DEALSDE' DBFILE            *1            E14356
     C                     EXSR INFSR                       *1
     C                     END                             E*1
      *
      ** Update associated bought record, if there is one.                S01378
     C           ILDADN    IFNE *BLANK                     B1             S01378
     C                     MOVE ILDADN    DLNO             *1             S01378
     C           DLNO      CHAINDEALSDDF             60    *1             S01378
      *                                                                   S01378
     C           *IN60     IFEQ '1'                        B*2            S01378
     C                     MOVE '047'     DBASE            **2            S01378
     C*                                                                   S01378
     C** SET UP DASE ERROR FIELDS                                         S01378
     C                     MOVEL'DEALSDD' DBFILE           **2            S01378
     C                     MOVELDLNO      DBKEY            **2            S01378
     C*                                                                   S01378
     C                     EXSR INFSR                      **2            S01378
     C                     END                             E*2            S01378
      *                                                                   S01378
      **                                                                  S01378
      ** Update number of UNsold N/A in purchase record                   S01378
      ** (total UNsold N/A + previous UNsold N/A in sold record) -        S01378
      ** amended UNsold N/A                                               S01378
     C           ILPCLI    IFEQ 'P'                        B*2            S01378
     C                     SUB  @SSIZE    NSLD             **2            S01378
     C                     ADD  ILPSZE    NSLD             **2            S01378
     C                     ADD  @SSIZE    NSDD             **2            S01378
     C                     SUB  ILPSZE    NSDD             **2            S01378
     C                     END                             E*2            S01378
     C                     Z-ADDBJRDNB    LCD              *1             S01378
     C                     MOVE 'A'       CHTP             *1             S01378
      *                                                                   S01378
     C                     UPDATDEALSDDF               60  *1             S01378
      *                                                                   S01378
     C           *IN60     IFEQ '1'                        B*2            S01378
     C                     MOVE '030'     DBASE            **2            S01378
     C                     MOVEL'DEALSDD' DBFILE           **2            S01378
     C                     EXSR INFSR                      **2            S01378
     C                     END                             E*2            S01378
     C                     END                             E1             S01378
      *                                                                   S01378
     C           #BG9      ENDSR                           **#BG9**
      /EJECT
      *****************************************************************
      *                                                               *
      *  SUBROUTINE: #BH    - Amend a deam (Update DEAMSDI)           *
      *                                                               *
      *  FIELDS USED:                                                 *
      *                                                               *
      *                                                               *
      *  CALLED BY :  #B                                              *
      *  CALLS     :                                                  *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           #BH       BEGSR
      *
     C           DEAMKY    CHAINDEAMSDIF             60
     C           *IN60     IFEQ '1'                        B*1
     C                     MOVE '026'     DBASE             *1
     C*                                                                   E14356
     C** SET UP DASE ERROR FIELDS                                         E14356
     C                     MOVEL'DEAMSDI' DBFILE            *2            E14356
     C                     MOVELIGDA38    @DB1   110        *2            E14356
     C                     MOVE IGDVSD    @DB1              *2            E14356
     C                     MOVEL@DB1      DBKEY             *2            E14356
     C                     MOVE IGDS38    DBKEY             *2            E14356
     C*                                                                   E14356
     C                     EXSR INFSR                       *1
     C                     END                             E*1
      *
      ** Ascertain whether settlement is pay or receive.
     C                     EXSR #ZB
      *
     C                     Z-ADDSETP      @SETP                           080570
     C                     MOVELOSAC      @OSAC                           080570
     C                     MOVELTSEN      @TSEN                           080570
     C                     MOVELFACO      @FACO                           082908
     C                     MOVELSPI       @SPI                            082908
     C                     MOVE RSTM      @RSTM                           082908
     C                     MOVELRONS      @RONS                           082908
     C                     MOVELRIBN      @RIBN                           082908
     C                     MOVELRIBA      @RIBA                           082908
     C                     MOVE ROBN      @ROBN                           082908
     C                     MOVE ROCN      @ROCN                           082908
     C                     MOVE PSTM      @PSTM                           082908
     C                     MOVELPONS      @PONS                           082908
     C                     MOVELPIBN      @PIBN                           082908
     C                     MOVELPIBA      @PIBA                           082908
     C                     MOVE POBN      @POBN                           082908
     C                     MOVE POCN      @POCN                           082908
     C                     MOVELRCRN      @RCRN                           082908
     C                     MOVELRCRA      @RCRA                           082908
     C                     MOVELRVNO      @RVNO                           082908
     C                     MOVELAWBN      @AWBN                           082908
     C                     MOVELAWBA      @AWBA                           082908
     C                     MOVELBENN      @BENN                           082908
     C                     MOVELBENA      @BENA                           082908
     C                     MOVELDTP1      @DTP1                           082908
     C                     MOVELDTP2      @DTP2                           082908
     C                     MOVELDTP3      @DTP3                           082908
     C                     MOVELDTP4      @DTP4                           082908
     C                     MOVELDCHG      @DCHG                           082908
     C                     MOVELBTB1      @BTB1                           082908
     C                     MOVELBTB2      @BTB2                           082908
     C                     MOVELBTB3      @BTB3                           082908
     C                     MOVELBTB4      @BTB4                           082908
     C                     MOVELBTB5      @BTB5                           082908
     C                     MOVELBTB6      @BTB6                           082908
     C                     MOVELCVMR      @CVMR                           082908
      *                                                                   082908
      * Settlement is receive  -  Set up approriate fields.
     C           @RP       IFEQ 'R'
      *
     C                     Z-ADDIGORCM    SETP
     C                     MOVE IGMORI    OSAC
     C                     MOVE IGMCPI    TSEN
     C                     Z-ADDIGRSTM    RSTM                            S01177
     C                     MOVE IGRONS    RONS                            S01177
     C                     MOVE IGRIBN    RIBN                            S01177
     C                     MOVE IGRIBA    RIBA                            S01177
     C**********           Z-ADDIGROBN    ROBN                                         S01177 CSD027
     C**********           Z-ADDIGROCN    ROCN                                         S01177 CSD027
     C                     MOVE IGROBN    ROBN                                                CSD027
     C                     MOVE IGROCN    ROCN                                                CSD027
     C                     Z-ADD0         PSTM                            S01177
     C                     MOVE *BLANK    PONS                            S01177
     C                     MOVE *BLANK    FACO
     C*****                MOVE *BLANK    SPI                             E18497
     C                     MOVE IGSPEC    SPI                             E18497
     C                     MOVE *BLANK    PIBN                            S01177
     C                     MOVE *BLANK    PIBA                            S01177
     C**********           Z-ADD*ZERO     POBN                                         S01177 CSD027
     C**********           Z-ADD*ZERO     POCN                                         S01177 CSD027
     C                     MOVE *BLANKS   POBN                                                CSD027
     C                     MOVE *BLANKS   POCN                                                CSD027
     C                     MOVE *BLANK    RCRN                            S01177
     C                     MOVE *BLANK    RCRA                            S01177
     C                     MOVE *BLANK    RVNO                            S01177
     C                     MOVE *BLANK    AWBN                            S01177
     C                     MOVE *BLANK    AWBA                            S01177
     C                     MOVE *BLANK    BENN                            S01177
     C                     MOVE *BLANK    BENA                            S01177
     C                     MOVE *BLANK    DTP1                            S01177
     C                     MOVE *BLANK    DTP2                            S01177
     C                     MOVE *BLANK    DTP3                            S01177
     C                     MOVE *BLANK    DTP4                            S01177
     C                     MOVE *BLANK    DCHG                            S01177
     C*****                MOVE *BLANK    BTB1                     S01177 E18497
     C*****                MOVE *BLANK    BTB2                     S01177 E18497
     C*****                MOVE *BLANK    BTB3                     S01177 E18497
     C*****                MOVE *BLANK    BTB4                     S01177 E18497
     C*****                MOVE *BLANK    BTB5                     S01177 E18497
     C*****                MOVE *BLANK    BTB6                     S01177 E18497
     C                     MOVE IGBTB1    BTB1                            E18497
     C                     MOVE IGBTB2    BTB2                            E18497
     C                     MOVE IGBTB3    BTB3                            E18497
     C                     MOVE IGBTB4    BTB4                            E18497
     C                     MOVE IGBTB5    BTB5                            E18497
     C                     MOVE IGBTB6    BTB6                            E18497
      *
     C                     ELSE
     C           @RP       IFEQ 'P'
      *
     C                     Z-ADDIGMOPM    SETP
     C                     MOVE IGMOPI    OSAC
     C                     MOVE IGMCRI    TSEN
     C                     MOVE IGMFAO    FACO
     C                     MOVE IGSPEC    SPI
     C                     Z-ADD*ZERO     RSTM                            S01177
     C                     MOVE *BLANK    RONS                            S01177
     C                     MOVE *BLANK    RIBN                            S01177
     C                     MOVE *BLANK    RIBA                            S01177
     C**********           Z-ADD*ZERO     ROBN                                         S01177 CSD027
     C**********           Z-ADD*ZERO     ROCN                                         S01177 CSD027
     C                     MOVE *BLANKS   ROBN                                                CSD027
     C                     MOVE *BLANKS   ROCN                                                CSD027
     C                     Z-ADDIGPSTM    PSTM                            S01177
     C                     MOVE IGPONS    PONS                            S01177
     C                     MOVE IGPIBN    PIBN                            S01177
     C                     MOVE IGPIBA    PIBA                            S01177
     C**********           Z-ADDIGPOBN    POBN                                         S01177 CSD027
     C**********           Z-ADDIGPOCN    POCN                                         S01177 CSD027
     C                     MOVE IGPOBN    POBN                                                CSD027
     C                     MOVE IGPOCN    POCN                                                CSD027
     C                     MOVE IGRCRN    RCRN                            S01177
     C                     MOVE IGRCRA    RCRA                            S01177
     C                     MOVE IGRVNO    RVNO                            S01177
     C                     MOVE IGAWBN    AWBN                            S01177
     C                     MOVE IGAWBA    AWBA                            S01177
     C                     MOVE IGBENN    BENN                            S01177
     C                     MOVE IGBENA    BENA                            S01177
     C                     MOVE IGDTP1    DTP1                            S01177
     C                     MOVE IGDTP2    DTP2                            S01177
     C                     MOVE IGDTP3    DTP3                            S01177
     C                     MOVE IGDTP4    DTP4                            S01177
     C                     MOVE IGDCHG    DCHG                            S01177
     C                     MOVE IGBTB1    BTB1                            S01177
     C                     MOVE IGBTB2    BTB2                            S01177
     C                     MOVE IGBTB3    BTB3                            S01177
     C                     MOVE IGBTB4    BTB4                            S01177
     C                     MOVE IGBTB5    BTB5                            S01177
     C                     MOVE IGBTB6    BTB6                            S01177
      *
     C                     ELSE
     C                     Z-ADD*ZERO     SETP
     C                     MOVE *BLANK    OSAC
     C                     MOVE *BLANK    TSEN
     C                     MOVE *BLANK    FACO
     C*****                MOVE *BLANK    SPI                             E18497
     C                     MOVE IGSPEC    SPI                             E18497
     C                     Z-ADD*ZERO     RSTM                            S01177
     C                     MOVE *BLANK    RONS                            S01177
     C                     MOVE *BLANK    RIBN                            S01177
     C                     MOVE *BLANK    RIBA                            S01177
     C**********           Z-ADD*ZERO     ROBN                                         S01177 CSD027
     C**********           Z-ADD*ZERO     ROCN                                         S01177 CSD027
     C                     MOVE *BLANKS   ROBN                                                CSD027
     C                     MOVE *BLANKS   ROCN                                                CSD027
     C                     Z-ADD*ZERO     PSTM                            S01177
     C                     MOVE *BLANK    PONS                            S01177
     C                     MOVE *BLANK    PIBN                            S01177
     C                     MOVE *BLANK    PIBA                            S01177
     C**********           Z-ADD*ZERO     POBN                                         S01177 CSD027
     C**********           Z-ADD*ZERO     POCN                                         S01177 CSD027
     C                     MOVE *BLANKS   POBN                                                CSD027
     C                     MOVE *BLANKS   POCN                                                CSD027
     C                     MOVE *BLANK    RCRN                            S01177
     C                     MOVE *BLANK    RCRA                            S01177
     C                     MOVE *BLANK    RVNO                            S01177
     C                     MOVE *BLANK    AWBN                            S01177
     C                     MOVE *BLANK    AWBA                            S01177
     C                     MOVE *BLANK    BENN                            S01177
     C                     MOVE *BLANK    BENA                            S01177
     C                     MOVE *BLANK    DTP1                            S01177
     C                     MOVE *BLANK    DTP2                            S01177
     C                     MOVE *BLANK    DTP3                            S01177
     C                     MOVE *BLANK    DTP4                            S01177
     C                     MOVE *BLANK    DCHG                            S01177
     C*****                MOVE *BLANK    BTB1                     S01177 E18497
     C*****                MOVE *BLANK    BTB2                     S01177 E18497
     C*****                MOVE *BLANK    BTB3                     S01177 E18497
     C*****                MOVE *BLANK    BTB4                     S01177 E18497
     C*****                MOVE *BLANK    BTB5                     S01177 E18497
     C*****                MOVE *BLANK    BTB6                     S01177 E18497
     C                     MOVE IGBTB1    BTB1                            E18497
     C                     MOVE IGBTB2    BTB2                            E18497
     C                     MOVE IGBTB3    BTB3                            E18497
     C                     MOVE IGBTB4    BTB4                            E18497
     C                     MOVE IGBTB5    BTB5                            E18497
     C                     MOVE IGBTB6    BTB6                            E18497
      *
     C                     END
     C           IGCVMR    IFNE 'Y'                                       082908
     C                     MOVE 'N'       CVMR                            082908
     C                     ELSE                                           082908
     C                     MOVE 'Y'       CVMR                            082908
     C                     END                                            082908
     C                     END
      *
      ** Find out which bit settings are needed for confirmation
      ** indicators.
     C                     EXSR #ZA
     C*****                Z-ADDRUND      LCD                             S01194
     C                     Z-ADDBJRDNB    LCD                             S01194
     C                     MOVE 'A'       CHTP
      *                                                                   S01117
      ** Set up the multibranching fields - Our Settlement Branch         S01117
     C                     MOVELIGOSBR    OSBR                            S01117
      *
     C*Allow Pay/Receives to be regenerated (by DL1705) if settlement     080570
     C*instructions for the amendment have been changed                   080570
     C           SETP      IFNE @SETP                                     080570
     C           TSEN      ORNE @TSEN                                     080570
     C           OSAC      ORNE @OSAC                                     080570
     C           FACO      ORNE @FACO                                     082908
     C           SPI       ORNE @SPI                                      082908
     C           RSTM      ORNE @RSTM                                     082908
     C           RONS      ORNE @RONS                                     082908
     C           RIBN      ORNE @RIBA                                     082908
     C           ROBN      ORNE @ROBN                                     082908
     C           ROCN      ORNE @ROCN                                     082908
     C           PSTM      ORNE @PSTM                                     082908
     C           PONS      ORNE @PONS                                     082908
     C           PIBN      ORNE @PIBN                                     082908
     C           PIBA      ORNE @PIBA                                     082908
     C           POBN      ORNE @POBN                                     082908
     C           POCN      ORNE @POCN                                     082908
     C           RCRN      ORNE @RCRN                                     082908
     C           RCRA      ORNE @RCRA                                     082908
     C           RVNO      ORNE @RVNO                                     082908
     C           AWBN      ORNE @AWBN                                     082908
     C           AWBA      ORNE @AWBA                                     082908
     C           BENN      ORNE @BENN                                     082908
     C           BENA      ORNE @BENA                                     082908
     C           DTP1      ORNE @DTP1                                     082908
     C           DTP2      ORNE @DTP2                                     082908
     C           DTP3      ORNE @DTP3                                     082908
     C           DTP4      ORNE @DTP4                                     082908
     C           DCHG      ORNE @DCHG                                     082908
     C           BTB1      ORNE @BTB1                                     082908
     C           BTB2      ORNE @BTB2                                     082908
     C           BTB3      ORNE @BTB3                                     082908
     C           BTB4      ORNE @BTB4                                     082908
     C           BTB5      ORNE @BTB5                                     082908
     C           BTB6      ORNE @BTB6                                     082908
     C           CVMR      ORNE @CVMR                                     082908
     C           IGSTCY    ORNE @STCY                                     CEU003
     C           IGIC72    ORNE @IC72                                     CEU003
     C                     BITOF'01234567'DAIN                            080570
     C                     ENDIF                                          080570
      *                                                                   CEU003
      ** If SAR CEU003 is installed move fields, else blank out.          CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C                     MOVELIGSTCY    STCY                            CEU003
     C                     MOVELIGIC72    IC72                            CEU003
     C                     ELSE                                           CEU003
     C                     MOVE *BLANKS   STCY                            CEU003
     C                     MOVE *BLANKS   IC72                            CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
      *                                                                   CAC001
      **  Set up funding information fields                               CAC001
      *                                                                   CAC001
     C                     Z-ADDIGFSRP    FSRP                            CAC001
     C                     MOVE IGIRCF    IRCF                            CAC001
     C                     MOVE IGFRCF    FRCF                            CAC001
      *                                                                   080570
     C                     UPDATDEAMSDIF               60
     C/COPY WNCPYSRC,MM0081CP10                                           S01408
      *
     C           *IN60     IFEQ '1'                        B*1
     C                     MOVE '027'     DBASE             *1
     C                     MOVEL'DEAMDI'  DBFILE            *1            E14356
     C                     EXSR INFSR                       *1
     C                     END                             E*1
      *
     C           #BH9      ENDSR                           **#BH9**
      /EJECT
      *****************************************************************
      *                                                               *
      *  SUBROUTINE: #BI    - Delete a loan deposit.                  *
      *                                                               *
      *  FIELDS USED:                                                 *
      *                                                               *
      *                                                               *
      *  CALLED BY :  #B                                              *
      *  CALLS     :                                                  *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           #BI       BEGSR
      *
     C           IKDN38    CHAINDEALSDCF             60
     C           *IN60     IFEQ '1'                        B*1
     C                     MOVE '028'     DBASE             *1
     C*                                                                   E14356
     C** SET UP DASE ERROR FIELDS                                         E14356
     C                     MOVEL'DEALSDC' DBFILE            *2            E14356
     C                     MOVELIKDN38    DBKEY             *2            E14356
     C*                                                                   E14356
     C                     EXSR INFSR                       *1
     C                     END                             E*1
      *
     C                     MOVE 'R'       RECI
      *
      ** Find out which bit settings are needed for confirmation
      ** indicators.
     C                     EXSR #ZA                         *1
      *
     C*****                Z-ADDRUND      LCD                             S01194
     C                     Z-ADDBJRDNB    LCD                             S01194
     C                     MOVE 'R'       CHTP
     C*********************Z-ADD0         RODN                      083201102286
      *
     C                     UPDATDEALSDCF               60
      *                                                                   AUS007
     C           AUS007    IFEQ 'Y'                                       AUS007
     C           @RACD     ANDNE' '                                       AUS007
     C                     EXSR #RACD                                     AUS007
     C                     END                                            AUS007
      *
     C           *IN60     IFEQ '1'                        B*1
     C                     MOVE '029'     DBASE             *1
     C                     MOVEL'DEALSDC' DBFILE            *1            E14356
     C                     EXSR INFSR                       *1
     C                     END                             E*1
     C/COPY WNCPYSRC,MM0081C031
      *
      ** If the associated deal number on the standard deal is
      ** non-zero, use the number to access the related deal record
      ** on DEALSDC.
     C           IKDADN    IFNE *BLANK                     B*1
     C           IKMTYP    ANDNE'ID'                       B*1            S01354
     C           IKMTYP    ANDNE'IL'                       B*1            S01354
     C                     MOVE IKDADN    DLNO              *1
     C           DLNO      CHAINDEALSDCF             60     *1
      *
     C*****      *IN60     IFEQ '1'                        B*2            E19013
     C*****                MOVE '030'     DBASE             *2            E19013
     C*****                                                        E14356 E19013
     C***SET UP DASE ERROR FIELDS                                  E14356 E19013
     C*****                MOVEL'DEALSDC' DBFILE            *2     E14356 E19013
     C*****                MOVELDLNO      DBKEY             *2     E14356 E19013
     C*****                                                        E14356 E19013
     C*****                EXSR INFSR                       *2            E19013
     C*****                END                             E*2            E19013
      *
     C           *IN60     IFNE '1'                        B*2            E19013
     C                     Z-ADD*ZERO     RBDN              *2
     C                     Z-ADD*ZERO     RBDA              *2
     C                     MOVE *BLANKS   WRPI                            109994
     C*****                Z-ADDRUND      LCD               *2            S01194
     C                     Z-ADDBJRDNB    LCD               *2            S01194
     C                     MOVE 'A'       CHTP              *2
     C                     MOVE *BLANKS   RTFC              *2            CEU015
      *
     C                     UPDATDEALSDCF               60   *2
      *
     C           *IN60     IFEQ '1'                        B*3
     C                     MOVE '031'     DBASE             *3
     C                     MOVEL'DEALSDC' DBFILE            *3            E14356
     C                     EXSR INFSR                       *3
     C                     END                             E*3
      *
     C                     END                             E*2            E19013
     C                     END                             E*1
      *
      ** Update trailer record.
     C*****************    EXSR #ZC                                       E12279
      *
     C           #BI9      ENDSR                           **#BJ9**
      /EJECT
      *****************************************************************
      *                                                               *
      *  SUBROUTINE: #BJ    - Delete a bought negotiable asset.       *
      *                                                               *
      *  FIELDS USED:                                                 *
      *                                                               *
      *                                                               *
      *  CALLED BY :  #B
      *  CALLS     :
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           #BJ       BEGSR
      *
     C           IHDN38    CHAINDEALSDDF             60
     C           *IN60     IFEQ '1'                        B*1
     C                     MOVE '032'     DBASE             *1
     C*                                                                   E14356
     C** SET UP DASE ERROR FIELDS                                         E14356
     C                     MOVEL'DEALSDD' DBFILE            *2            E14356
     C                     MOVELIHDN38    DBKEY             *2            E14356
     C*                                                                   E14356
     C                     EXSR INFSR                       *1
     C                     END                             E*1
      *
     C                     MOVE 'R'       RECI
      *
     C*****                Z-ADDRUND      LCD                             S01194
     C                     Z-ADDBJRDNB    LCD                             S01194
     C                     MOVE 'R'       CHTP
      *
      ** Find out which bit settings are needed for confirmation
      ** indicators.
     C                     EXSR #ZA                         *1
      *
     C                     UPDATDEALSDDF               60
      *
     C           *IN60     IFEQ '1'                        B*1
     C                     MOVE '033'     DBASE             *1
     C                     MOVEL'DEALSDD' DBFILE            *1            E14356
     C                     EXSR INFSR                       *1
     C                     END                             E*1
      *
      ** Update trailer record.
     C*****************    EXSR #ZC                                       E12279
      *
     C           #BJ9      ENDSR                           **#BJ9**
      /EJECT
      *****************************************************************
      *                                                               *
      *  SUBROUTINE: #BK    - Delete a sold N/A.                      *
      *                                                               *
      *  FIELDS USED:                                                 *
      *                                                               *
      *                                                               *
      *  CALLED BY :  #B                                              *
      *  CALLS     :                                                  *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           #BK       BEGSR
      *
     C           ILDN38    CHAINDEALSDEF             60
     C           *IN60     IFEQ '1'                        B*1
     C                     MOVE '034'     DBASE             *1
     C*                                                                   E14356
     C** SET UP DASE ERROR FIELDS                                         E14356
     C                     MOVEL'DEALSDE' DBFILE            *2            E14356
     C                     MOVELILDN38    DBKEY             *2            E14356
     C*                                                                   E14356
     C                     EXSR INFSR                       *1
     C                     END                             E*1
      *
     C                     MOVE 'R'       RECI
     C*****                Z-ADDRUND      LCD                             S01194
     C                     Z-ADDBJRDNB    LCD                             S01194
     C                     MOVE 'R'       CHTP
      *                                                                   S01378
      *  Save N/A sold for subtraction from number sold in associated     S01378
      *  deal later                                                       S01378
     C                     Z-ADD0         @SOSZ                           S01378
     C           PCLI      IFEQ 'P'                                       S01378
     C           PSZE      ANDNE0                                         S01378
     C**********           Z-ADDPSZE      @SOSZ   30               S01378 154018
     C                     Z-ADDPSZE      @SOSZ   50                      154018
     C                     END                                            S01378
      *
      ** Find out which bit settings are needed for confirmation
      ** indicators.
     C                     EXSR #ZA                         *1
      *
     C                     UPDATDEALSDEF               60
      *
     C           *IN60     IFEQ '1'                        B*1
     C                     MOVE '035'     DBASE             *1
     C                     MOVEL'DEALSDE' DBFILE            *1            E14356
     C                     EXSR INFSR                       *1
     C                     END                             E*1
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0081CCP3                                           S01408
      *                                                                   S01408
      *
      ** If the associated deal number on the standard deal is
      ** non-zero, use the number to access the related deal record
      ** on DEALSDD.
      *
     C           ILDADN    IFNE *BLANK                     B*1
     C                     MOVE ILDADN    DLNO
     C           DLNO      CHAINDEALSDDF             60     *1
      *
     C           *IN60     IFEQ '1'                        B*2
     C                     MOVE '036'     DBASE             *2
     C*                                                                   E14356
     C** SET UP DASE ERROR FIELDS                                         E14356
     C                     MOVEL'DEALSDD' DBFILE            *2            E14356
     C                     MOVELDLNO      DBKEY             *2            E14356
     C*                                                                   E14356
     C                     EXSR INFSR                       *2
     C                     END                             E*2
      *
      *  Subtract N/A sold from related deal record                       S01378
     C           @SOSZ     IFNE 0                          B**2           S01378
     C                     SUB  @SOSZ     NSLD             ***2           S01378
     C                     ADD  @SOSZ     NSDD             ***2           S01378
     C                     END                             E**2           S01378
      *                                                                   S01378
      ** If NA is not parcelled                                           S01378
      ** (note that related deal fields are only maintained for NON       S01378
      ** parcelled NA's because parcelled NA's may have more than         S01378
      ** one related deal).                                               S01378
     C           ILPCLI    IFNE 'P'                         *1            S01378
     C                     Z-ADD*ZERO     SAPR              *1
     C                     Z-ADD*ZERO     ASDN              *1
     C                     Z-ADD*ZERO     SADT              *1
     C                     END                              *1            S01378
     C*****                Z-ADDRUND      LCD               *1            S01194
     C                     Z-ADDBJRDNB    LCD               *1            S01194
     C                     MOVE 'A'       CHTP              *1
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0081CCP4                                           S01408
      *                                                                   S01408
      *
     C                     UPDATDEALSDDF               60   *1
      *
     C           *IN60     IFEQ '1'                        B*2
     C                     MOVE '037'     DBASE             *2
     C                     MOVEL'DEALSDD' DBFILE            *1            E14356
     C                     EXSR INFSR                       *2
     C                     END                             E*2
      *
     C                     END                             E*1
      *
      ** Update trailer record.
     C*************        EXSR #ZC                                       E12279
      *
     C           #BK9      ENDSR                           **#BK9**
      /EJECT
      *****************************************************************
      *                                                               *
      *  SUBROUTINE: #BL    - Delete a deam                           *
      *                                                               *
      *  FIELDS USED:                                                 *
      *                                                               *
      *                                                               *
      *  CALLED BY :  #B                                              *
      *  CALLS     :                                                  *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           #BL       BEGSR
      *
     C           DEAMKY    CHAINDEAMSDIF             60
     C           *IN60     IFEQ '1'                        B*1
     C                     MOVE '038'     DBASE             *1
     C*                                                                   E14356
     C** SET UP DASE ERROR FIELDS                                         E14356
     C                     MOVEL'DEAMSDI' DBFILE            *1            E14356
     C                     MOVELIGDA38    @DB1   110        *1            E14356
     C                     MOVE IGDVSD    @DB1              *1            E14356
     C                     MOVEL@DB1      DBKEY             *1            E14356
     C                     MOVE IGDS38    DBKEY             *1            E14356
     C*                                                                   E14356
     C                     EXSR INFSR                       *1
     C                     END                             E*1
      * Save the values of NAAD and NASN for future use.                  E22475
     C                     Z-ADDNAAD      TAAD    50                      E22475
     C                     Z-ADDNASN      TASN    30                      E22475
      * ALSO SAVE THE VALUE OF IGDS38 FOR USE IN UPDATING DTRIXDD         BH1069
     C                     Z-ADDIGDS38    SEQDTR  30                      BH1069
      *
     C                     MOVE 'R'       RECI
     C*****                Z-ADDRUND      LCD                             S01194
     C                     Z-ADDBJRDNB    LCD                             S01194
     C                     MOVE 'R'       CHTP
     C                     BITOF'01234567'DAIN
      *
     C                     UPDATDEAMSDIF               60
     C/COPY WNCPYSRC,MM0081CP11                                           S01408
      *
     C           *IN60     IFEQ '1'                        B*1
     C                     MOVE '039'     DBASE             *1
     C                     MOVEL'DEAMSDI' DBFILE            *1            E14356
     C                     EXSR INFSR                       *1
     C                     END                             E*1
      *                                                                   E22475
     C/COPY WNCPYSRC,MM0081C018
      ** Read Deals File Record.                                          E22475
     C                     Z-ADDIGDS38    TDS38   30                      E22475
     C***********ICDN38    CHAINDEALSDCF             60             E22475E23850
     C           ICDN38    CHAINMMDELULL             60                   E23850
     C           *IN60     IFEQ '1'                        B*1            E22475
     C                     MOVE '055'     DBASE             *1            E22475
     C*********************MOVE 'DEALSDC' DBFILE            *1      E22475E23850
     C                     MOVE 'MMDELULL'DBFILE            *1            E23850
     C                     MOVELICDN38    DBKEY             *1            E22475
     C                     EXSR INFSR                       *1            E22475
     C                     END                             E*1            E22475
     C*********************MOVE @DEALC    @DELLC                    E22475E23850
      ** Position deal amendment file to first live amendment record      E22475
     C                     MOVE ICDN38    IGDA38                          E22475
     C                     MOVE DAVD      IGDVSD                          E22475
     C                     MOVE DASN      IGDS38                          E22475
     C           DEAMKY    CHAINDEAMSDIF             60                   E22475
     C           *IN60     IFEQ '1'                        B*1            E22475
     C                     MOVE '056'     DBASE             *1            E22475
     C                     MOVE 'DEAMSDI' DBFILE            *1            E22475
     C                     MOVELIGDA38    @DB1              *1            E22475
     C                     MOVE IGDVSD    @DB1              *1            E22475
     C                     MOVEL@DB1      DBKEY             *1            E22475
     C                     MOVE IGDS38    DBKEY             *1            E22475
     C                     EXSR INFSR                       *1            E22475
     C                     END                             B*1            E22475
      ** Update deals file record                                         E22475
     C           ICDVSD    IFEQ DAVD                       B*1            E22475
     C           TDS38     ANDEQDASN                        *1            E22475
     C*********************MOVE @DELLC    @DEALC            *1      E22475E23850
     C           ICDN38    CHAINMMDELULL             60     *1            E23850
     C           *IN60     IFEQ '1'                        B**2           E23850
     C                     MOVE '060'     DBASE             **2           E23850
     C                     MOVE 'MMDELULL'DBFILE            **2           E23850
     C                     MOVELICDN38    DBKEY             **2           E23850
     C                     EXSR INFSR                       **2           E23850
     C                     END                             E**2           E23850
     C*                                                                   E23850
     C                     Z-ADDTAAD      DAVD              *1            E22475
     C                     Z-ADDTASN      DASN              *1            E22475
     C*********************UPDATDEALSDCF               60   *1      E22475E23850
     C*                                                                   E23850
     C           @FORMM    IFEQ 'DEALSDCF'                 B**2           E23850
     C                     UPDATDEALSDCF               60   **2           E23850
     C                     END                             E**2           E23850
     C*                                                                   E23850
     C           @FORMM    IFEQ 'DEALSDDF'                 B**2           E23850
     C                     UPDATDEALSDDF               60   **2           E23850
     C                     END                             E**2           E23850
     C*                                                                   E23850
     C           @FORMM    IFEQ 'DEALSDEF'                 B**2           E23850
     C                     UPDATDEALSDEF               60   **2           E23850
     C                     END                             E**2           E23850
     C*                                                                   E23850
     C           *IN60     IFEQ '1'                        B**2           E22475
     C                     MOVE '057'     DBASE             **2           E22475
     C*********************MOVEL'DEALSDC' DBFILE            **2     E22475E23850
     C                     MOVEL'MMDELULL'DBFILE            **2           E23850
     C                     EXSR INFSR                       **2           E22475
     C                     END                             E**2           E22475
     C*                                                                   E23850
     C*********************GOTO UPDHDR                      *1      E22475E23850
     C                     GOTO #BL9                        *1            E23850
     C                     END                             E*1            E22475
      ** Update Previous Deal Amendment to Point to Next Live Deal        E22475
     C           ICDVSD    DOWNENAAD                       B*1            E22475
     C***********TDS38     ANDNENASN                        *1     E22475 116730
     C           TDS38     ORNE NASN                        *1            116730
     C                     MOVE ICDN38    IGDA38            *1            E22475
     C                     MOVE NAAD      IGDVSD            *1            E22475
     C                     MOVE NASN      IGDS38            *1            E22475
     C           DEAMKY    CHAINDEAMSDIF             60     *1            E22475
     C           *IN60     IFEQ '1'                        B**2           E22475
     C                     MOVE '058'     DBASE             **2           E22475
     C                     MOVEL'DEAMSDI' DBFILE            **2           E22475
     C                     MOVELIGDA38    @DB1              **2           E22475
     C                     MOVE ICDVSD    @DB1              **2           E22475
     C                     MOVEL@DB1      DBKEY             **2           E22475
     C                     MOVE IGDS38    DBKEY             **2           E22475
     C                     EXSR INFSR                       **2           E22475
     C                     END                             B**2           E22475
     C                     END                             E*1            E22475
     C                     Z-ADDTAAD      NAAD                            E22475
     C                     Z-ADDTASN      NASN                            E22475
     C                     UPDATDEAMSDIF               60                 E22475
     C           *IN60     IFEQ '1'                        B*1            E22475
     C                     MOVE '059'     DBASE             *1            E22475
     C                     MOVEL'DEAMSDI' DBFILE            *1            E22475
     C                     EXSR INFSR                       *1            E22475
     C                     END                             B*1            E22475
      *
      ** Update trailer record.
     C***********UPDHDR    TAG                                      E22475E23850
     C*************        EXSR #ZD                                       E12279
      *
     C           #BL9      ENDSR                           **#BL9**
      /EJECT
      *****************************************************************
      *                                                               *
      *  SUBROUTINE: #CA    - Determine pay/receive indicators:       *
      *                            MMP0348                            *
      *                                                               *
      *  FIELDS USED:                                                 *
      *                                                               *
      *                                                               *
      *  CALLED BY :  #C                                              *
      *  CALLS     :                                                  *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           #CA       BEGSR
      *
     C                     Z-ADD*ZERO     PRI1
     C                     Z-ADD*ZERO     PRI2
     C                     Z-ADD*ZERO     PRI3
      *
      ** Access currency details using deal currency, to get
      ** telex notice days for deal currency.
     C*****                MOVE *BLANKS   KEY                             S01194
     C*****                MOVE '20'      @PRF                            S01194
     C*****                MOVE ICCCY     @CUR                            S01194
     C*****                MOVE '1'       @SUF                            S01194
      *****                                                               S01194
     C*****      KEY       CHAINFDCCYTLL             60                   S01194
     C*****      *IN60     IFEQ '1'                        B*1            S01194
     C*****                MOVE '040'     DBASE             *1            S01194
     C*****                                                        E14356 S01194
     C***SET UP DASE ERROR FIELDS                                  E14356 S01194
     C*****                MOVEL'FDCCYTLL'DBFILE            *1     E14356 S01194
     C*****                MOVELKEY       DBKEY             *1     E14356 S01194
     C*****                                                        E14356 S01194
     C*****                EXSR INFSR                       *1            S01194
     C*****                END                             E*1            S01194
      *
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM ICCCY     @AJCD   3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANK                     B1             S01194
     C                     MOVE '040'     DBASE            ***************S01194
     C                     MOVEL'SDCURRPD'DBFILE           * DBERROR 040 *S01194
     C                     MOVEL@AJCD     DBKEY            ***************S01194
     C                     EXSR INFSR                      *1             S01194
     C                     END                             E1             S01194
     C*                                                                   S01194
     C*****                Z-ADDTNOT      TNOTD
     C                     Z-ADDA6TXND    TNOTD
      *
      ** Access currency details using local currency, to get
      ** telex notice days for local currency.
     C*****                MOVE LOCY      @CUR                            S01194
     C*****                MOVE BJBPCD    @CUR                            S01194
      *
     C*****      KEY       CHAINFDCCYTLL             60                   S01194
     C*****      *IN60     IFEQ '1'                        B*1            S01194
     C*****                MOVE '041'     DBASE             *1            S01194
     C*****                                                        E14356 S01194
     C***SET UP DASE ERROR FIELDS                                  E14356 S01194
     C*****                MOVEL'FDCCYTLL'DBFILE            *1     E14356 S01194
     C*****                MOVELKEY       DBKEY             *1     E14356 S01194
     C*****                                                        E14356 S01194
     C*****                EXSR INFSR                       *1            S01194
     C*****                END                             E*1            S01194
      *
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM BJLCCY    @AJCD   3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANK                     B1             S01194
     C                     MOVE '041'     DBASE            ***************S01194
     C                     MOVEL'SDCURRPD'DBFILE           * DBERROR 041 *S01194
     C                     MOVEL@AJCD     DBKEY            ***************S01194
     C                     EXSR INFSR                      *1             S01194
     C                     END                             E1             S01194
     C*                                                                   S01194
     C*****                Z-ADDTNOT      TNOTL                           S01194
     C                     Z-ADDA6TXND    TNOTL                           S01194
      *
      * PAY/RECEIVE INDICATOR 1.
      * ------------------------
      ** This deal is an amendment
     C           @THDL     IFEQ 'A'                        B*1
      *
     C           ICMTYP    IFEQ 'PI'                       B*2
      *                                                                   E14368
     C***********ICMOPM    IFNE *ZEROS                             E29097 E50740
     C           ICMOPM    IFEQ 01                         B**3           E14368
     C           ICMOPM    OREQ 02                         B**3           E14368
     C           ICMOPM    OREQ 07                         B**3           E14368
     C           ICMOPM    OREQ 08                         B**3           E14368
     C           ICMOPM    OREQ 12                         B**3           E14368
     C                     MOVE '1'       *IN70             **3           E14368
     C                     MOVELICPONS    @ONOS   2         **3           S01195
     C*********************END                                     E29097 E50740
     C                     END                             E**3           E14368
      *                                                                   E14368
     C***********ICMOPM    IFEQ *ZEROS                             E29097 E50740
     C           ICORCM    IFEQ 01                                        E29097
     C           ICORCM    OREQ 02                                        E29097
     C           ICORCM    OREQ 07                                        E29097
     C           ICORCM    OREQ 08                                        E29097
     C           ICORCM    OREQ 12                                        E29097
     C                     MOVE '1'       *IN70                           E29097
     C                     MOVELICRONS    @ONOS                           E50740
     C                     END                                            E29097
     C*********************END                                     E29097 E50740
      ** Deal currency applies.                                           E14368
     C           *IN70     IFEQ '1'                        B**3           E14368
     C*****                Z-ADDRUND      @@MNO             **3     E14368S01195
     C*****                MOVE ICCCY     @@CCY             **3     E14368S01195
     C*****                Z-ADDTNOTD     @@FWD   50        **3     E14368S01195
     C*********************Z-ADDBJRDNB    ZDAYNO            **3     S01194E21923
     C           BJDNWD    SUB  1         ZDAYNO            **3           E21923
     C                     MOVE ICCCY     ZCCY1             **3           S01195
     C**      (set location of first ccy, ZLOC1, to nostro location)      S01195
     C                     EXSR #CAA                        **3           S01195
     C                     Z-ADDTNOTD     ZNRDYS            **3           S01195
      *                                                                   E14368
      ** Local currency applies.                                          E14368
     C                     ELSE                            X**3           E14368
     C*****                Z-ADDRUND      @@MNO             **3           S01195
     C*****                MOVE LOCY      @@CCY             **3           S01195
     C*****                Z-ADDTNOTL     @@FWD             **3           S01195
     C*********************Z-ADDBJRDNB    ZDAYNO            **3     S01194E21923
     C           BJDNWD    SUB  1         ZDAYNO            **3           E21923
     C                     MOVE BJLCCY    ZCCY1             **3           S01194
     C**      (set location of first ccy to system location)              S01195
     C                     MOVE BJSLCD    ZLOC1             **3           S01194
     C                     Z-ADDTNOTL     ZNRDYS            **3           S01195
      *                                                                   E14368
     C                     END                             E**3           E14368
      *                                                                   E14368
      *                                                                   E14368
      ** Execute common routine to calculate test days.                   E14368
      *                                                                   E14368
     C*********************EXSR MM1005                     **2      E14368S01195
     C**      (set location of second ccy to system location)             S01195
     C                     MOVE BJSLCD    ZLOC2            **2            S01194
     C                     MOVE BJLCCY    ZCCY2            **2            S01194
     C                     Z-ADDZDAYNO    ZDYNBR                          058890
      *                                                                   S01408
      *Hook MM0081CCP6 moved to match original position in R10.6          S01408
      *New hook MM0081C020 inserted for DBA2.                             S01408
     C*COPY*WNCPYSRC*MM0081CCP6****************************************   S01408
     C/COPY WNCPYSRC,MM0081C020                                           S01408
      *                                                                   S01408
     C           ZNRDYS    IFNE 0                                         058890
     C                     EXSR ZF2C                       **2            S01195
     C                     END                                            058890
      *                                                                   E14368
     C*****      ILDVSD    IFGE RUND                       B**3    E14368 S01194
     C***********ILDVSD    ANDLE@@FDAT                     B**3    E14368 S01195
     C***********ILDVSD    IFGE BJRDNB                     B**3     S01194E18239
     C***********ILDVSD    ANDLEZDYNBR                     B**3     S01195E18239
     C           ICDVSD    IFGE BJRDNB                     B**3           E18239
     C           ICDVSD    ANDLEZDYNBR                     B**3           E18239
     C/COPY WNCPYSRC,MM0081C007
     C                     Z-ADD1         PRI1              **3
     C                     END                             E**3           E14368
      *                                                                   E14368
     C                     END                             E*2
      *
     C                     GOTO #CA1                        *1
     C                     END                             E*1
      *
      ** This deal is an loan/deposit or N/A bought.
     C           @THDL     IFEQ 'L'                        B*1
     C           @THDL     OREQ 'B'                        B*1
      *
      **   Deal type  = IT/TD/CD & receive method  = 01/07/08
      **or/Deal type <> IT/TD/CD &     pay method  = 01/07/08
      *
     C                     MOVE '0'       *IN70
      *
     C           ICMTYP    IFEQ 'IT'                       B*2
     C           ICMTYP    OREQ 'TD'                       B*2
     C           ICMTYP    OREQ 'CD'                       B*2
      *
     C           ICORCM    IFEQ 01                         B*3
     C           ICORCM    OREQ 07                         B*3
     C           ICORCM    OREQ 08                         B*3
     C                     MOVE '1'       *IN70             *3
     C                     MOVELICRONS    @ONOS            **3            S01195
     C                     END                             E*3
      *
     C                     ELSE                            X*2
      *
     C           ICMOPM    IFEQ 01                         B*3
     C           ICMOPM    OREQ 07                         B*3
     C           ICMOPM    OREQ 08                         B*3
     C                     MOVE '1'       *IN70             *3
     C                     MOVELICPONS    @ONOS            **3            S01195
     C                     END                             E*3
      *
     C                     END                             E*2
      *
      ** Deal currency applies.
     C           *IN70     IFEQ '1'                        B*2
     C*****                Z-ADDRUND      @@MNO             *2            S01195
     C*****                MOVE ICCCY     @@CCY             *2            S01195
     C*****                Z-ADDTNOTD     @@FWD   50        *2            S01195
     C*********************Z-ADDBJRDNB    ZDAYNO            *2      S01194E21923
     C           BJDNWD    SUB  1         ZDAYNO            *2            E21923
     C                     MOVE ICCCY     ZCCY1             *2            S01195
     C**      (set location of first ccy, ZLOC1, to nostro location)      S01195
     C                     EXSR #CAA                        **3           S01195
     C                     Z-ADDTNOTD     ZNRDYS            *2            S01195
      *
      ** Local currency applies.
     C                     ELSE                            X*2
     C*****                Z-ADDRUND      @@MNO             *2            S01195
     C*****                MOVE LOCY      @@CCY             *2            S01195
     C*****                Z-ADDTNOTL     @@FWD             *2            S01195
     C*********************Z-ADDBJRDNB    ZDAYNO            *2      S01194E21923
     C           BJDNWD    SUB  1         ZDAYNO            *2            E21923
     C                     MOVE BJLCCY    ZCCY1             *2            S01194
     C**      (set location of first ccy to system location)              S01195
     C                     MOVE BJSLCD    ZLOC1             *2            S01194
     C                     Z-ADDTNOTL     ZNRDYS            *2            S01195
      *
     C                     END                             E*2
      *
      ** Execute common routine to calculate test days.
      *
     C*********************EXSR MM1005                      *1            S01195
     C**      (set location of second ccy to system location)             S01195
     C                     MOVE BJSLCD    ZLOC2             *1            S01194
     C                     MOVE BJLCCY    ZCCY2             *1            S01194
     C                     Z-ADDZDAYNO    ZDYNBR                          058890
     C           ZNRDYS    IFNE 0                                         058890
     C                     EXSR ZF2C                        *1            S01195
     C                     END                                            058890
      *
     C*****      ICDVSD    IFGE RUND                       B*2            S01177
     C*****      ICDVSD    ANDLE@@FDAT                     B*2            S01177
     C*****      ICDVSD    IFLE @@FDAT                     B*2      S01177S01195
     C********** ICDVSD    IFLE ZDYNBR                     B*2      S01195BHF706
     C           ICDVSD    IFGE BJRDNB                     B*2            BHF706
     C           ICDVSD    ANDLEZDYNBR                      *2            BHF706
     C/COPY WNCPYSRC,MM0081C008
     C                     Z-ADD1         PRI1              *2
     C                     END                             E*2
      *
     C                     END                             E*1
      *
      ** PAY/RECEIVE INDICATOR 2.
      *  -----------------------
     C           #CA1      TAG                             **#CA1**
      *
      ** This deal is an amendment
     C           @THDL     IFEQ 'A'                        B*1
      *
     C           ICMTYP    IFEQ 'SI'                       B*2
      *                                                                   E14368
     C           ICMOPM    IFEQ 01                         B**3           E14368
     C           ICMOPM    OREQ 02                         B**3           E14368
     C           ICMOPM    OREQ 07                         B**3           E14368
     C           ICMOPM    OREQ 08                         B**3           E14368
     C           ICMOPM    OREQ 12                         B**3           E14368
     C                     MOVE '1'       *IN70             **3           E14368
     C                     MOVELICPONS    @ONOS             **3           S01195
     C                     END                             E**3           E14368
      *                                                                   E14368
      ** Deal currency applies.                                           E14368
     C           *IN70     IFEQ '1'                        B**3           E14368
     C*****                Z-ADDRUND      @@MNO             **3     E14368S01195
     C*****                MOVE ICCCY     @@CCY             **3     E14368S01195
     C*****                Z-ADDTNOTD     @@FWD   50        **3     E14368S01195
     C*********************Z-ADDBJRDNB    ZDAYNO            **3     S01194E21923
     C           BJDNWD    SUB  1         ZDAYNO            **3           E21923
     C                     MOVE ICCCY     ZCCY1             **3           S01195
     C**      (set location of first ccy, ZLOC1, to nostro location)      S01195
     C                     EXSR #CAA                        **3           S01195
     C                     Z-ADDTNOTD     ZNRDYS            **3           S01195
      *                                                                   E14368
      ** Local currency applies.                                          E14368
     C                     ELSE                            X**3           E14368
     C*****                Z-ADDRUND      @@MNO             **3     E14368S01195
     C*****                MOVE LOCY      @@CCY             **3     E14368S01195
     C*****                Z-ADDTNOTL     @@FWD             **3     E14368S01195
     C*********************Z-ADDBJRDNB    ZDAYNO            **3     S01194E21923
     C           BJDNWD    SUB  1         ZDAYNO            **3           E21923
     C                     MOVE BJLCCY    ZCCY1             **3           S01194
     C**      (set location of first ccy to system location)              S01195
     C                     MOVE BJSLCD    ZLOC1             **3           S01194
     C                     Z-ADDTNOTL     ZNRDYS            **3           S01195
      *                                                                   E14368
     C                     END                             E**3           E14368
      *                                                                   E14368
      *                                                                   E14368
      ** Execute common routine to calculate test days.                   E14368
      *                                                                   E14368
     C*********************EXSR MM1005                     **2      E14368S01195
     C**      (set location of second ccy to system location)             S01195
     C                     MOVE BJSLCD    ZLOC2            **2            S01194
     C                     MOVE BJLCCY    ZCCY2            **2            S01194
     C                     Z-ADDZDAYNO    ZDYNBR                          058890
     C           ZNRDYS    IFNE 0                                         058890
     C                     EXSR ZF2C                       **2            S01195
     C                     END                                            058890
      *                                                                   E14368
     C*****      ILDVSD    IFGE RUND                       B**3     E14368S01194
     C***********ILDVSD    ANDLE@@FDAT                     B**3     E14368S01195
     C***********ILDVSD    IFGE BJRDNB                     B**3     S01194E18239
     C***********ILDVSD    ANDLEZDYNBR                     B**3     S01195E18239
     C           ICDVSD    IFGE BJRDNB                     B**3           E18239
     C           ICDVSD    ANDLEZDYNBR                     B**3           E18239
     C/COPY WNCPYSRC,MM0081C009
     C                     Z-ADD1         PRI2              **3
     C                     END                             E**3           E14368
      *                                                                   E14368
     C                     END                             E*2
      *
     C                     GOTO #CA2                        *1
     C                     END                             E*1
      *
      ** This deal is an loan/deposit or N/A bought.
     C           @THDL     IFEQ 'L'                        B*1
     C           @THDL     OREQ 'B'                        B*1
      *
      **   Deal type  = IT/TD/CD & pay     method  = 01/07/08
      **or/Deal type <> IT/TD/CD & receive method  = 01/07/08
      *
     C                     MOVE '0'       *IN70
      *
     C           ICMTYP    IFEQ 'IT'                       B*2
     C           ICMTYP    OREQ 'TD'                       B*2
     C           ICMTYP    OREQ 'CD'                       B*2
      *
     C           ICMOPM    IFEQ 01                         B*3
     C           ICMOPM    OREQ 07                         B*3
     C           ICMOPM    OREQ 08                         B*3
     C                     MOVE '1'       *IN70             *3
     C                     MOVELICPONS    @ONOS             *3            S01195
     C                     END                             E*3
      *
     C                     ELSE                            X*2
      *
     C           ICORCM    IFEQ 01                         B*3
     C           ICORCM    OREQ 07                         B*3
     C           ICORCM    OREQ 08                         B*3
     C                     MOVE '1'       *IN70             *3
     C                     MOVELICRONS    @ONOS             *3            S01195
     C                     END                             E*3
      *
     C                     END                             E*2
      *
      ** Deal currency applies.
     C           *IN70     IFEQ '1'                        B*2
     C*****                Z-ADDRUND      @@MNO             *2            S01195
     C*****                MOVE ICCCY     @@CCY             *2            S01195
     C*****                Z-ADDTNOTD     @@FWD   50        *2            S01195
     C*********************Z-ADDBJRDNB    ZDAYNO            *2      S01194E21923
     C           BJDNWD    SUB  1         ZDAYNO            *2            E21923
     C                     MOVE ICCCY     ZCCY1             *2            S01195
     C**      (set location of first ccy, ZLOC1, to nostro location)      S01195
     C                     EXSR #CAA                        *2            S01195
     C                     Z-ADDTNOTD     ZNRDYS            *2            S01195
      *
      ** Local currency applies.
     C                     ELSE                            X*2
     C*****                Z-ADDRUND      @@MNO             *2            S01195
     C*****                MOVE LOCY      @@CCY             *2            S01195
     C*****                Z-ADDTNOTL     @@FWD             *2            S01195
     C*********************Z-ADDBJRDNB    ZDAYNO            *2      S01194E21923
     C           BJDNWD    SUB  1         ZDAYNO            *2            E21923
     C                     MOVE BJLCCY    ZCCY1             *2            S01194
     C**      (set location of first ccy to system location)              S01195
     C                     MOVE BJSLCD    ZLOC1             *2            S01195
     C                     Z-ADDTNOTL     ZNRDYS            *2            S01195
      *
     C                     END                             E*2
      *
      ** Execute common routine to calculate test days.
      *
     C*********************EXSR MM1005                      *1            S01195
     C**      (set location of second ccy to system location)             S01195
     C                     MOVE BJSLCD    ZLOC2            **2            S01194
     C                     MOVE BJLCCY    ZCCY2            **2            S01194
     C                     Z-ADDZDAYNO    ZDYNBR                          058890
      *                                                                   S01408
      *Hook MM0081CCP6 moved to match original position in R10.6          S01408
      *New hook MM0081C021 inserted for R10.6                             S01408
     C/COPY WNCPYSRC,MM0081C021                                           S01408
     C/COPY WNCPYSRC,MM0081CCP6                                           S01408
      *                                                                   S01408
     C           ZNRDYS    IFNE 0                                         058890
     C                     EXSR ZF2C                       **2            S01195
     C                     END                                            058890
      *
     C           ICNIPD    IFNE *ZERO                      B*2
     C*****      ICNIPD    ANDGERUND                       B*2            S01177
     C*****      ICNIPD    ANDLE@@FDAT                     B*2            S01195
     C           ICNIPD    ANDGEBJRDNB                     B*2            E25356
     C           ICNIPD    ANDLEZDYNBR                     B*2            S01195
     C/COPY WNCPYSRC,MM0081C010
     C                     Z-ADD1         PRI2              *2
     C                     END                             E*2
      *
     C                     END                             E*1
      *
      ** PAY/RECEIVE INDICATOR 3.
      *  -----------------------
     C           #CA2      TAG                             **#CA1**
      *                                                                   E14368
     C                     MOVE '0'       *IN70                           E14368
      *
      ** This deal is an amendment
     C           @THDL     IFEQ 'A'                        B*1
      *
     C           ICMTYP    IFEQ 'PD'                       B*2
      *                                                                   E14368
     C           ICMOPM    IFEQ 01                         B**3           E14368
     C           ICMOPM    OREQ 02                         B**3           E14368
     C           ICMOPM    OREQ 07                         B**3           E14368
     C           ICMOPM    OREQ 08                         B**3           E14368
     C           ICMOPM    OREQ 12                         B**3           E14368
     C                     MOVE '1'       *IN70             **3           E14368
     C                     MOVELICPONS    @ONOS             *2            S01195
     C                     END                             E**3           E14368
      *                                                                   E14368
      ** Deal currency applies.                                           E14368
     C           *IN70     IFEQ '1'                        B**3           E14368
     C*****                Z-ADDRUND      @@MNO             **3     E14368S01195
     C*****                MOVE ICCCY     @@CCY             **3     E14368S01195
     C*****                Z-ADDTNOTD     @@FWD   50        **3     E14368S01195
     C*********************Z-ADDBJRDNB    ZDAYNO            **3     S01194E21923
     C           BJDNWD    SUB  1         ZDAYNO            **3           E21923
     C                     MOVE ICCCY     ZCCY1             **3           S01195
     C**      (set location of first ccy, ZLOC1, to nostro location)      S01195
     C                     EXSR #CAA                        **3           S01195
     C                     Z-ADDTNOTD     ZNRDYS            **3           S01195
      *                                                                   E14368
      ** Local currency applies.                                          E14368
     C                     ELSE                            X**3           E14368
     C*****                Z-ADDRUND      @@MNO             **3     E14368S01195
     C*****                MOVE LOCY      @@CCY             **3     E14368S01195
     C*****                Z-ADDTNOTL     @@FWD             **3     E14368S01195
     C*********************Z-ADDBJRDNB    ZDAYNO            **3     S01194E21923
     C           BJDNWD    SUB  1         ZDAYNO            **3           E21923
     C                     MOVE BJLCCY    ZCCY1             **3           S01194
     C**      (set location of first ccy to system location)              S01195
     C                     MOVE BJSLCD    ZLOC1             **3           S01194
     C                     Z-ADDTNOTL     ZNRDYS            **3           S01195
      *                                                                   E14368
     C                     END                             E**3           E14368
      *                                                                   E14368
      *                                                                   E14368
      ** Execute common routine to calculate test days.                   E14368
      *                                                                   E14368
     C*********************EXSR MM1005                     **2      E14368S01195
     C**      (set location of second ccy to system location)             S01195
     C                     MOVE BJSLCD    ZLOC2            **2            S01194
     C                     MOVE BJLCCY    ZCCY2            **2            S01194
     C                     Z-ADDZDAYNO    ZDYNBR                          058890
     C           ZNRDYS    IFNE 0                                         058890
     C                     EXSR ZF2C                       **2            S01195
     C                     END                                            058890
      *                                                                   E14368
     C*****      ILDVSD    IFGE RUND                       B**3     E14368S01194
     C*****      ILDVSD    ANDLE@@FDAT                     B**3     E14368S01195
     C***********ILDVSD    IFGE BJRDNB                     B**3     S01194E18239
     C***********ILDVSD    ANDLEZDYNBR                     B**3     S01195E18239
     C           ICDVSD    IFGE BJRDNB                     B**3           E18239
     C           ICDVSD    ANDLEZDYNBR                     B**3           E18239
     C/COPY WNCPYSRC,MM0081C011
     C                     Z-ADD1         PRI3              **3
     C                     END                             E**3           E14368
      *                                                                   E14368
     C                     END                             E*2
      *
     C                     GOTO #CA9                        *1
     C                     END                             E*1
      *
      ** This deal is other than an amendment.
      *
      **   Deal type  = IT/TD/CD & pay     method  = 01/07/08
      **or/Deal type <> IT/TD/CD & receive method  = 01/07/08
      *
     C                     MOVE '0'       *IN70
      *
     C           ICMTYP    IFEQ 'IT'                       B*1
     C           ICMTYP    OREQ 'TD'                       B*1
     C           ICMTYP    OREQ 'CD'                       B*1
      *
     C           ICMOPM    IFEQ 01                         B*2
     C           ICMOPM    OREQ 07                         B*2
     C           ICMOPM    OREQ 08                         B*2
     C                     MOVE '1'       *IN70             *2
     C                     MOVELICPONS    @ONOS             *2            S01195
     C                     END                             E*2
      *
     C                     ELSE                            X*1
      *
     C           ICORCM    IFEQ 01                         B*2
     C           ICORCM    OREQ 07                         B*2
     C           ICORCM    OREQ 08                         B*2
     C                     MOVE '1'       *IN70             *2
     C                     MOVELICRONS    @ONOS             *2            S01195
     C                     END                             E*2
      *
     C                     END                             E*1
      *
      ** Deal currency applies.
     C           *IN70     IFEQ '1'                        B*2
     C*****                Z-ADDRUND      @@MNO             *2            S01195
     C*****                MOVE ICCCY     @@CCY             *2            S01195
     C*****                Z-ADDTNOTD     @@FWD   50        *2            S01195
     C*********************Z-ADDBJRDNB    ZDAYNO            *2      S01194E21923
     C           BJDNWD    SUB  1         ZDAYNO            *2            E21923
     C                     MOVE ICCCY     ZCCY1             *2            S01195
     C**      (set location of first ccy, ZLOC1, to nostro location)      S01195
     C                     EXSR #CAA                        *2            S01195
     C                     Z-ADDTNOTD     ZNRDYS            *2            S01195
      *
      ** Local currency applies.
     C                     ELSE                            X*2
     C*****                Z-ADDRUND      @@MNO             *2            S01195
     C*****                MOVE LOCY      @@CCY             *2            S01195
     C*****                Z-ADDTNOTL     @@FWD             *2            S01195
     C*********************Z-ADDBJRDNB    ZDAYNO            *2      S01194E21923
     C           BJDNWD    SUB  1         ZDAYNO            *2            E21923
     C                     MOVE BJLCCY    ZCCY1             *2            S01194
     C**      (set location of first ccy to system location)              S01195
     C                     MOVE BJSLCD    ZLOC1             *2            S01194
     C                     Z-ADDTNOTL     ZNRDYS            *2            S01195
      *
     C                     END                             E*2
      *
      *
      ** Execute common routine to calculate test days.
      *
     C*********************EXSR MM1005                                    S01195
     C**      (set location of second ccy to system location)             S01195
     C                     MOVE BJSLCD    ZLOC2            **2            S01194
     C                     MOVE BJLCCY    ZCCY2            **2            S01194
     C                     Z-ADDZDAYNO    ZDYNBR                          058890
     C           ZNRDYS    IFNE 0                                         058890
     C                     EXSR ZF2C                       **2            S01195
     C                     END                                            058890
      *
      ** This deal is a loan/deposit or N/A bought.
     C           @THDL     IFEQ 'L'                        B*1
     C           @THDL     OREQ 'B'                        B*1
      *
     C***********ICMTYP    IFNE 'CD'                       B*2            E29678
     C***********ICMTYP    ANDNE'CL'                       B*2            E29678
     C***********ICMTYP    ANDNE'DL'                       B*2            E29678
     C           ICMATD    IFGE ORED                                      E29678
     C           ICMTYP    ANDNE'IL'                       B*2            S01354
     C           ICMTYP    ANDNE'ID'                       B*2            S01354
     C*****      ICMATD    ANDGERUND                       B*2            S01177
     C*****      ICMATD    ANDLE@@FDAT                     B*2      S01177S01195
     C***********@THDL     IFEQ 'B'                                S01434 085621
     C***********ICMATD    ANDGEBJRDNB                             080587 085621
     C***********ICMATD    ANDLEZDYNBR                             080587 085621
     C***********@THDL     OREQ 'L'                                S01434 085621
     C***********IKAURO    ANDNE'Y'                                S01434 085621
     C***********ICMATD    ANDGEBJRDNB                             080587 085621
     C***********ICMATD    ANDLEZDYNBR                             080587 085621
     C***********@THDL     OREQ 'L'                                S01434 085621
     C***********IKAURO    ANDEQ'Y'                                S01434 085621
     C***********IKROBY    ANDNE*ZEROS                             S01434 085621
     C           ICMATD    ANDGEBJRDNB                     B*2            E34538
     C           ICMATD    ANDLEZDYNBR                     B*2            S01195
     C/COPY WNCPYSRC,MM0081C012
     C           @THDL     IFEQ 'B'                                       085621
     C           @THDL     OREQ 'L'                                       085621
     C           IKAURO    ANDNE'Y'                                       085621
     C           @THDL     OREQ 'L'                                       085621
     C           IKAURO    ANDEQ'Y'                                       085621
     C***********IKROBY    ANDNE*ZEROS                             085621 085624
     C           IKROBY    ANDNE*BLANKS                                   085624
     C                     Z-ADD1         PRI3              *2
     C                     ENDIF                                          S01434
     C                     END                             E*2
      *
     C                     GOTO #CA9                        *1
     C                     END                             E*1
      *
      ** This deal is a N/A sold.
     C           @THDL     IFEQ 'S'                        B*1
      *
     C*****      ILDVSD    IFGE RUND                       B*2            S01177
     C*****      ILDVSD    ANDLE@@FDAT                     B*2            S01177
     C*****      ILDVSD    IFLE @@FDAT                     B*2      S01177S01195
     C           ILDVSD    IFLE ZDYNBR                     B*2            S01195
     C           ILDVSD    ANDGEBJRDNB                     B*2            E25356
     C/COPY WNCPYSRC,MM0081C013
     C                     Z-ADD1         PRI3              *2
     C                     END                             E*2
      *
     C                     END                             E*1
      *
     C           #CA9      ENDSR                           **#BL9**
      /EJECT                                                              S01195
      *****************************************************************   S01195
      *                                                               *   S01195
      *  SUBROUTINE: #CAA   - Determine Nostro Location to use        *   S01195
      *                                                               *   S01195
      *  FIELDS USED:   @ONOS  - OUR NOSTRO (DEPENDING ON PAY/RECEIVE)*   S01195
      *                 ZLOC   - INPUT PARM TO ZF2C                   *   S01195
      *                                                               *   S01195
      *  CALLED BY :  #CA                                             *   S01195
      *                                                               *   S01195
      *  CALLS     :                                                  *   S01195
      *                                                               *   S01195
      *****************************************************************   S01195
      *                                                                   S01195
     C           #CAA      BEGSR                                          S01195
      *                                                                   S01195
      ***Set up key to chain to Nostro file for Nostro Location           S01195
     C                     CALL 'AONOSTR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM *BLANKS   @CUST   6                       S01194
     C                     PARM ZCCY1     @CYCD   3                       S01194
     C**********           PARM *BLANKS   @ACCD   4                                    S01194 CGL029
     C                     PARM *BLANKS   @ACCD  10                                           CGL029
     C                     PARM *BLANKS   @ACSN   2                       S01194
     C                     PARM @ONOS     @NONB   2                       S01194
     C                     PARM *BLANKS   @BRCD   3                       S01194
     C                     PARM *BLANKS   @CSSN  10                       S01194
     C                     PARM *BLANKS   @PNOI   1                       S01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANK                     B*2            S01194
     C                     MOVE '055'     DBASE            ***************S01194
     C                     MOVEL'SDNOSTPD'DBFILE           * DBERROR 055 *S01194
     C                     MOVEL@CYCD     @ZKEY   5        ***************S01194
     C                     MOVE @NONB     @ZKEY            **2            S01194
     C                     MOVEL@ZKEY     DBKEY            **2            S01194
     C                     EXSR INFSR                      **2            S01194
     C                     END                             E*2            S01194
     C*                                                                   S01194
     C** MOVE LOCATION (LAST 3 CHARACTERS OF SHORTNAME) INTO ZLOC         S01195
     C                     MOVE A7NOSN    ZLOC                            S01195
     C*                                                                   S01195
     C           #CAA9     ENDSR                                          S01195
      /EJECT
      *****************************************************************
      *                                                               *
      *  SUBROUTINE: #BDA   - Ascertain file linkages  -  Process     *
      *                       MMP0228.                                *
      *                                                               *
      *  FIELDS USED:                                                 *
      *               @RDMIN  -  Related DEAM indicator               *
      *               @RDLIN  -  Related DEAL indicator               *
      *               @DLNO |                                         *
      *               @VDAT | -  Related DEAM key                     *
      *               @DASNK|                                         *
      *               @DAVD   -  DEAM value date                      *
      *               @DASN   -  DEAM sequence number                 *
      *               @NAAD   -  Next amendment action date           *
      *                            for DEAM being inserted            *
      *               @NASN   -  Next amendment sequence number       *
      *                            for DEAM being inserted            *
      *               @NAADR  -  Next amendment action date           *
      *                            for related DEAM                   *
      *               @NASNR  -  Next amendment sequence number       *
      *                            for related DEAM
      *                                                               *
      *                                                               *
      *  CALLED BY :  #BD                                             *
      *  CALLS     :                                                  *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           #BDA      BEGSR
      *
      ** Access the deal record from DEALSDC or DEALSDD.
     C***        IGDA38    CHAINDEALS                60
     C           IGDA38    CHAINMMDELULL             60
     C           *IN60     IFEQ '1'                        B*1
     C                     MOVE '042'     DBASE             *1
     C*                                                                   E14356
     C** SET UP DASE ERROR FIELDS                                         E14356
     C                     MOVEL'MMDELULL'DBFILE            *1            E14356
     C                     MOVELIGDA38    DBKEY             *1            E14356
     C*                                                                   E14356
     C                     EXSR INFSR                       *1
     C                     END                             E*1
      *
      ** Store DEALS value date & SEQ no. in common fields.
     C           @FORMM    IFEQ 'DEALSDEF'                 B*1
     C*********************Z-ADDDMVD      DAVD              *1
     C*********************Z-ADDDM38      DASN              *1
     C                     END                             E*1
      *
      ** Set output data to defaults.
     C                     MOVE *BLANK    @RDLIN
     C                     MOVE *BLANK    @RDMIN
     C                     Z-ADD*ZERO     @DLNO
     C                     Z-ADD*ZERO     @VDAT
     C                     Z-ADD*ZERO     @DASNK
     C                     Z-ADD*ZERO     @DAVD
     C                     Z-ADD*ZERO     @DASN
     C                     Z-ADD*ZERO     @NAAD
     C                     Z-ADD*ZERO     @NASN
     C                     Z-ADD*ZERO     @NAADR
     C                     Z-ADD*ZERO     @NASNR
      *
      ** Deal amendment value date on deal record is zero.
     C           DAVD      IFEQ *ZERO
     C                     MOVE 'Y'       @RDLIN
     C                     Z-ADDIGDVSD    @DAVD
     C                     Z-ADDIGDS38    @DASN
     C                     Z-ADD*ZERO     @NAAD
     C                     Z-ADD*ZERO     @NASN
     C                     GOTO #BDA9
     C                     END
      *
      ** Deal amendment value date on deal record is non-zero,
      ** and greater than the input value date.
     C           DAVD      IFGT IGDVSD
     C                     MOVE 'Y'       @RDLIN
     C                     Z-ADDDAVD      @NAAD
     C                     Z-ADDDASN      @NASN
     C                     Z-ADDIGDVSD    @DAVD
     C                     Z-ADDIGDS38    @DASN
     C                     GOTO #BDA9
     C                     END
      *
      ** Deal amendment value date on deal record is non-zero,
      ** and less than or equal to the input value date.
      *
      * Set up DEAMSDI key.
      * -------------------
     C                     Z-ADDIGDA38    DLNO
     C                     Z-ADDDAVD      VDAT
     C                     Z-ADDDASN      DASN
      *
     C           NAAD      DOUEQ*ZERO                      B*1
     C           NAAD      ORGT IGDVSD                     B*1
      *
     C           @DIKEY    CHAINDEAMSDIF             60     *1
     C           *IN60     IFEQ '1'                        B*2
     C                     MOVE '043'     DBASE             *2
     C*                                                                   E14356
     C** SET UP DASE ERROR FIELDS                                         E14356
     C                     MOVEL'DEAMSDI' DBFILE            *2            E14356
     C                     MOVELDLNO      @DB1              *2            E14356
     C                     MOVE VDAT      @DB1              *2            E14356
     C                     MOVEL@DB1      DBKEY             *2            E14356
     C                     MOVE DASN      DBKEY             *2            E14356
     C*                                                                   E14356
     C                     EXSR INFSR                       *2
     C                     END                             E*2
      *
     C           NAAD      IFNE *ZERO                      B*2
     C           NAAD      ANDLEIGDVSD                     B*2
     C                     MOVE NAAD      VDAT              *2
     C                     Z-ADDNASN      DASN              *2
     C                     END                             E*2
      *
     C                     END                             E*1
      *
      ** Next amendment action date on DEAMSDI record is zero.
     C           NAAD      IFEQ *ZERO                      B*1
     C                     MOVE 'Y'       @RDMIN            *1
     C                     Z-ADDDLNO      @DLNO             *1
     C                     Z-ADDVDAT      @VDAT             *1
     C                     Z-ADDDASN      @DASNK            *1
     C                     Z-ADDIGDVSD    @NAADR            *1
     C                     Z-ADDIGDS38    @NASNR            *1
     C                     Z-ADD*ZERO     @NAAD             *1
     C                     Z-ADD*ZERO     @NASN             *1
     C                     GOTO #BDA9                       *1
     C                     END                             E*1
      *
      ** Next amendment action date on DEAMSDI record is greater
      ** than the input value date.
     C           NAAD      IFGT IGDVSD                     B*1
     C                     MOVE 'Y'       @RDMIN            *1
     C                     Z-ADDDLNO      @DLNO             *1
     C                     Z-ADDVDAT      @VDAT             *1
     C                     Z-ADDDASN      @DASNK            *1
     C                     Z-ADDNAAD      @NAAD             *1
     C                     Z-ADDNASN      @NASN             *1
     C                     Z-ADDIGDVSD    @NAADR            *1
     C                     Z-ADDIGDS38    @NASNR            *1
     C                     END                             E*1
      *
     C           #BDA9     ENDSR                           **#BDA9**
      /EJECT
      *****************************************************************
      *                                                               *
      *  SUBROUTINE: #BDB   - Update related deal amendment record    *
      *                       on DEAMSDI.                             *
      *                                                               *
      *  FIELDS USED:                                                 *
      *                                                               *
      *                                                               *
      *  CALLED BY :  #BD
      *  CALLS     :
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           #BDB      BEGSR
      *
      ** Set up key to DEAMSDI from values calculated in #BDA.
     C                     Z-ADD@DLNO     DLNO
     C                     Z-ADD@VDAT     VDAT
     C                     Z-ADD@DASNK    DASN
      *
     C           @DIKEY    CHAINDEAMSDIF             60
      *
     C           *IN60     IFEQ '1'                        B*1
     C                     MOVE '044'     DBASE             *1
     C*                                                                   E14356
     C** SET UP DASE ERROR FIELDS                                         E14356
     C                     MOVEL'DEAMSDI' DBFILE            *1            E14356
     C                     MOVELDLNO      @DB1              *1            E14356
     C                     MOVE VDAT      @DB1              *1            E14356
     C                     MOVEL@DB1      DBKEY             *1            E14356
     C                     MOVE DASN      DBKEY             *1            E14356
     C*                                                                   E14356
     C                     EXSR INFSR                       *1
     C                     END                             E*1
      *
     C                     Z-ADD@NAADR    NAAD
     C                     Z-ADD@NASNR    NASN
     C*****                Z-ADDRUND      LCD                             S01194
     C                     Z-ADDBJRDNB    LCD                             S01194
     C                     MOVE 'A'       CHTP
      *
     C                     UPDATDEAMSDIF               60
      *
     C           *IN60     IFEQ '1'                        B*1
     C                     MOVE '045'     DBASE             *1
     C                     MOVEL'DEAMSDI' DBFILE            *1            E14356
     C                     EXSR INFSR                       *1
     C                     END                             E*1
      *
     C           #BDB9     ENDSR                           **#BDB9**
      /EJECT
      *****************************************************************
      *                                                               *
      *  SUBROUTINE: #BDC   - Update related deal record on           *
      *                        DEALSDC/DEALSDD                        *
      *  FIELDS USED:                                                 *
      *                                                               *
      *                                                               *
      *  CALLED BY :  #BD                                             *
      *  CALLS     :                                                  *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           #BDC      BEGSR
      *
     C***        DLNO      CHAINDEALS                60
     C           DLNO      CHAINMMDELULL             60
     C           *IN60     IFEQ '1'                        B*1
     C                     MOVE '046'     DBASE             *1
     C*                                                                   E14356
     C** SET UP DASE ERROR FIELDS                                         E14356
     C                     MOVEL'MMDELULL'DBFILE            *1            E14356
     C                     MOVELDLNO      DBKEY             *1            E14356
     C*                                                                   E14356
     C                     EXSR INFSR                       *1
     C                     END                             E*1
      *
     C                     Z-ADD@DAVD     DAVD
     C                     Z-ADD@DASN     DASN
      *
     C           IGMTYP    IFEQ 'SI'                       B*1
     C           IGMTYP    OREQ 'CI'                        *1
     C                     BITON'5'       DNSI              *1
     C                     END                             E*1
      *
     C                     BITOF'1'       CNFI
     C           NIDT      IFNE *ZERO                      B*1
     C           IGDVSD    ANDLENIDT                       B*1
     C                     BITOF'2'       CNFI              *1
     C                     END                             E*1
      *
     C*****                Z-ADDRUND      LCD                             S01194
     C                     Z-ADDBJRDNB    LCD                             S01194
     C                     MOVE 'A'       CHTP
      *
     C           @FORMM    IFEQ 'DEALSDCF'                 B*1
     C                     UPDATDEALSDCF                    *1
     C                     ELSE                            X*1
     C           @FORMM    IFEQ 'DEALSDDF'                 B*2
     C                     UPDATDEALSDDF                    *2
     C                     END                             E*2
     C                     END                             E*1
      *
     C           #BDC9     ENDSR                           **#BDC9**
      /EJECT
      *****************************************************************
      *                                                               *
      *  SUBROUTINE: #ZA    -  Calculate bit settings for             *
      *                        confirmation indicators.               *
      *                                                               *
      *  FIELDS USED:                                                 *
      *                                                               *
      *                                                               *
      *  CALLED BY :  #BA
      *  CALLS     :
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           #ZA       BEGSR
      *
     C                     MOVE 'N'       @CNRQ
      *
      ** INSERTS
      ** -------
     C           ICMACT    IFEQ 'I'                        B*1
     C                     BITOF'01234567'CNFI              *1
      *
     C           ICORCM    IFNE *ZERO                      B*2
     C           ICMOPM    ORNE *ZERO                      B*2
     C*****      TLII      OREQ 'N'                        B*2            S01194
     C           BLL2II    OREQ 'N'                        B*2            S01194
     C           IKMTYP    OREQ 'IL'                       B*2            079592
     C           IKMTYP    OREQ 'ID'                       B*2            079592
     C                     MOVE 'Y'       @CNRQ             *2
     C                     END                             E2
      *
     C                     GOTO #ZA9                        *1
     C                     END                             E*1
      *
      ** DELETIONS
      ** ---------
     C           ICMACT    IFEQ 'R'                        B*1
     C* UDC will produce 'insert' confirmation even if deal deleted       143058
     C* in the meantime. Therefore cancellation confirmation should       143058
     C* also be produced.                                                 143058
     C**********           TESTB'7'       CNFI           99 *1            143058
     C********** *IN99     IFEQ '1'                        B*2            143058
     C                     BITOF'0'       CNFI              *2
     C                     MOVE 'Y'       @CNRQ             *2
     C**********           END                             E*2            143058
     C                     GOTO #ZA9                        *1
     C                     END                             E*1
      *
      ** AMENDMENTS
      ** ----------
     C           ICMACT    IFEQ 'A'                        B*1
      *
      ** Check to see whether any of the MIDAS pay/receive,
      ** before/after update settlement methods = non-zero:
     C                     MOVE '0'       *IN61
      *
      ** 1/ Loans/deposits.
     C           @THDL     IFEQ 'L'                        B*2
      *
     C           IKORCM    IFNE 00                         B*3
     C           IKMOPM    ORNE 00                         B*3
     C           IKBORM    ORNE 00                         B*3
     C           IKBOPM    ORNE 00                         B*3
     C           IKSTCY    ORNE @STCY                                     CEU003
     C           IKIC72    ORNE @IC72                                     CEU003
     C                     MOVE '1'       *IN61             *3
     C                     END                             E*3
      *
     C                     GOTO #ZA1                        *2
     C                     END                             E*2
      *
      ** 2/ Negotiable assets  -  bought.
     C           @THDL     IFEQ 'B'                        B*2
      *
     C           IHORCM    IFNE 00                         B*3
     C           IHMOPM    ORNE 00                         B*3
     C           IHSTCY    ORNE @STCY                                     CEU003
     C           IHIC72    ORNE @IC72                                     CEU003
     C                     MOVE '1'       *IN61             *3
     C                     END                             E*3
      *
     C                     GOTO #ZA1                        *2
     C                     END                             E*2
      *
      ** 3/ Negotiable assets  -  sold.
     C           @THDL     IFEQ 'S'                        B*2
      *
     C           ILORCM    IFNE 00                         B*3
     C           ILBORM    ORNE 00                         B*3
     C           ILSTCY    ORNE @STCY                                     CEU003
     C           ILIC72    ORNE @IC72                                     CEU003
     C                     MOVE '1'       *IN61             *3
     C                     END                             E*3
      *
     C                     END                             E*2
      *
     C           #ZA1      TAG                             ***#ZA1***
      *
     C*****      TLII      IFEQ 'N'                        B*2            S01194
     C           BLL2II    IFEQ 'N'                        B*2            S01194
     C           *IN61     OREQ '1'                        B*2
     C*****      RUND      ORNE ORED                       B*2            S01194
     C           BJRDNB    ORNE ORED                       B*2            S01194
      *
      ** Check to see whether any of the MIDAS pay/receive,
      ** before/after update settlement methods = other than 04:
      *
     C                     MOVE '0'       *IN61
      *
      ** 1/ Loans/deposits.
     C           @THDL     IFEQ 'L'                        B*3
      *
     C           IKORCM    IFNE 04                         B*4
     C           IKMOPM    ORNE 04                         B*4
     C           IKBORM    ORNE 04                         B*4
     C           IKBOPM    ORNE 04                         B*4
     C                     MOVE '1'       *IN61             *4
     C                     END                             E*4
      *
     C                     GOTO #ZA2                        *3
     C                     END                             E*3
      *
      ** 2/ Negotiable assets  -  bought.
     C           @THDL     IFEQ 'B'                        B*3
      *
     C           IHORCM    IFNE 04                         B*4
     C           IHMOPM    ORNE 04                         B*4
     C           IHSTCY    ORNE @STCY                                     CEU003
     C           IHIC72    ORNE @IC72                                     CEU003
     C                     MOVE '1'       *IN61             *4
     C                     END                             E*4
      *
     C                     GOTO #ZA2                        *3
     C                     END                             E*3
      *
      ** 3/ Negotiable assets  -  sold.
     C           @THDL     IFEQ 'S'                        B*3
      *
     C           ILORCM    IFNE 04                         B*4
     C           ILBORM    ORNE 04                         B*4
     C           ILSTCY    ORNE @STCY                                     CEU003
     C           ILIC72    ORNE @IC72                                     CEU003
     C                     MOVE '1'       *IN61             *4
     C                     END                             E*4
      *
     C                     END                             E*3
      *
     C           #ZA2      TAG                             ***#ZA2***
      *
     C           *IN61     IFEQ '1'                        B*3
      *
      ** Check to see whether any fields of either type A or type B
      ** has been changed.
      *
     C                     MOVE '0'       *IN61             *3
     C                     MOVE '0'       *IN62             *3
      *
      ** 1/ Loans/deposits.
     C           @THDL     IFEQ 'L'                        B*4
      *
      ** Type 'A' fields:
     C***********IKMOPM    IFNE IKBOPM                     B*5            079589
     C***********IKMOPI    ORNE IKBOPI                     B*5            079589
     C***********IKMCPI    ORNE IKBCPI                     B*5            079589
     C***********IKORCM    ORNE IKBORM                     B*5            079589
     C***********IKMORI    ORNE IKBORI                     B*5            079589
     C***********IKMCRI    ORNE IKBCRI                     B*5            079589
     C***********FACO      ORNE @FACO                      B*5            079589
     C***********SPI       ORNE @SPI                       B*5            079589
     C***********          MOVE '1'       *IN61             *5            079589
     C***********          END                             E*5            079589
     C           IKMTYP    IFEQ 'IT'                                      079589
     C           IKMTYP    OREQ 'TD'                                      079589
     C           IKMTYP    OREQ 'CD'                                      079589
     C           IKMTYP    OREQ 'CI'                                      079589
     C           IKMTYP    OREQ 'ID'                                      079589
      *                                                                   079589
     C           IKMOPM    IFNE MDST                                      079589
     C           IKMOPI    ORNE OMDA                                      079589
     C           IKMCPI    ORNE TMAN                                      079589
     C           IKORCM    ORNE SDST                                      079589
     C           IKMORI    ORNE OSDA                                      079589
     C           IKMFAO    ORNE FACO                                      079589
     C           IKSPEC    ORNE SPI                                       079589
     C           IKSTCY    ORNE @STCY                                     CEU003
     C           IKIC72    ORNE @IC72                                     CEU003
     C                     MOVE '1'       *IN61                           079589
     C                     END                                            079589
      *                                                                   079589
     C                     ELSE                                           079589
      *                                                                   079589
     C           IKMOPM    IFNE SDST                                      079589
     C           IKMOPI    ORNE OSDA                                      079589
     C           IKMCPI    ORNE TSTN                                      079589
     C           IKORCM    ORNE MDST                                      079589
     C           IKMORI    ORNE OMDA                                      079589
     C           IKMFAO    ORNE FACO                                      079589
     C           IKSPEC    ORNE SPI                                       079589
     C                     MOVE '1'       *IN61                           079589
     C                     END                                            079589
      *                                                                   079589
     C                     END                                            079589
      *
      ** Type 'B' fields:
     C***********MDAT      IFNE @MDAT                      B*5            079589
     C***********NIDT      ORNE @NIDT                      B*5            079589
     C***********IPFR      ORNE IKBIPF                     B*5            079589
     C***********INTF      ORNE IKBIDM                     B*5            079589
     C           MDAT      IFNE IKMATD                                    079589
     C           NIDT      ORNE IKNIPD                                    079589
     C           IPFR      ORNE IKIPFQ                                    079589
     C           INTF      ORNE IKIPDM                                    079589
     C                     MOVE '1'       *IN61             *5
     C                     MOVE '1'       *IN62             *5
     C                     END                             E*5
      *
     C                     GOTO #ZA3                        *4
      *
     C                     END                             E*4
      *
      ** 2/ Negotiable assets  -  Bought.
     C           @THDL     IFEQ 'B'                        B*4
      *
      ** Type 'A' fields:
     C***********SDST      IFNE IHBOPM                     B*5            079589
     C***********OSDA      ORNE IHBOPI                     B*5            079589
     C***********TSTN      ORNE IHBCRI                     B*5            079589
     C           SDST      IFNE IHMOPM                                    079589
     C           OSDA      ORNE IHMOPI                                    079589
     C           TSTN      ORNE IHMCRI                                    079589
     C           @STCY     ORNE IHSTCY                                    CEU003
     C           @IC72     ORNE IHIC72                                    CEU003
     C                     MOVE '1'       *IN61             *5
     C                     END                             E*5
      *
      ** Type 'B' fields:
     C***********MDAT      IFNE @MDAT                      B*5            079589
     C***********NIDT      ORNE @NIDT                      B*5            079589
     C***********IPFR      ORNE IHBIPF                     B*5            079589
     C***********INTF      ORNE IHBIDM                     B*5            079589
     C           MDAT      IFNE IHMATD                                    079589
     C           NIDT      ORNE IHNIPD                                    079589
     C           IPFR      ORNE IHIPFQ                                    079589
     C           INTF      ORNE IHIPDM                                    079589
     C                     MOVE '1'       *IN61             *5
     C                     MOVE '1'       *IN62             *5
     C                     END                             E*5
      *
     C                     GOTO #ZA3                        *4
      *
     C                     END                             E*4
      *
      ** 3/ Negotiable assets  -  Sold.
     C           @THDL     IFEQ 'S'                        B*4
      *
      ** Type 'A' fields:
     C***********SETP      IFNE ILBORM                     B*5            079589
     C***********OSAC      ORNE ILBORI                     B*5            079589
     C***********TSEN      ORNE ILBCPI                     B*5            079589
     C           SETP      IFNE ILORCM                                    079589
     C           OSAC      ORNE ILMORI                                    079589
     C           TSEN      ORNE ILMCPI                                    079589
     C           @STCY     ORNE ILSTCY                                    CEU003
     C           @IC72     ORNE ILIC72                                    CEU003
     C                     MOVE '1'       *IN61             *5
     C                     END                             E*5
      *
      ** (Type 'B' fields do not apply to N/A sold.)
      *
     C                     END                             E*4
      *
     C           #ZA3      TAG                             **#ZA3**
     C           *IN61     IFEQ '1'                        B*4
     C*
     C*****      ORED      CABEQRUND      #ZA4              *             S01194
     C*****      ORED      IFLT RUND                       B*5            S01194
     C*****      RUND      ANDLEVDAT                       B*5            S01194
     C***********ORED      CABEQBJRDNB    #ZA4              *       S01194E22147
     C***********ORED      IFLT BJRDNB                     B*5      S01194E22147
     C***********BJRDNB    ANDLEVDAT                       B*5      S01194E22417
     C           ORED      CABEQBJRDNB    #ZA4              *                                 073399
     C           ORED      IFLT BJRDNB                     B*5                                073399
     C           BJRDNB    ANDLEVDAT                       B*5                                073399
      *
     C           #ZA4      TAG                             **#ZA4**
     C                     BITOF'0'       CNFI              *5
     C                     MOVE 'Y'       @CNRQ             *5
      *
     C***********          END                             E*5            E22147
     C                     END                             E*4
     C                     END                             E*5                                073399
      *
     C           *IN62     IFEQ '1'                        B*4
     C*****      ORED      ANDLTRUND                       B*4            S01194
     C*****      RUND      ANDGTVDAT                       B*4            S01194
     C           ORED      ANDLTBJRDNB                     B*4            S01194
     C           BJRDNB    ANDGTVDAT                       B*4            S01194
      *
      ** Check that maturity & interest indicator bits are not both on.
     C                     TESTB'12'      CNFI           61**4
      *
     C           *IN61     IFEQ '0'                        B*5
     C                     BITOF'0'       CNFI              *5
     C                     MOVE 'Y'       @CNRQ             *2
     C                     END                             E*5
      *
     C                     END                             E*4
      *
     C*****      ORED      IFLT RUND                       B*4            S01194
     C*****      RUND      ANDGTVDAT                       B*4            S01194
     C           ORED      IFLT BJRDNB                     B*4            S01194
     C           BJRDNB    ANDGTVDAT                       B*4            S01194
      *
     C           CSW200    IFNE 'CSW200'                    *4            CSW200
     C                     BITOF'12'      CNFI              *4
     C                     ELSE                             *4            CSW200
      *                                                                   CSW200
     C           IKMTYP    IFEQ 'IP'                        *4            CSW200
     C           IKMTYP    OREQ 'IT'                        *4            CSW200
     C           IKMTYP    OREQ 'TI'                        *4            CSW200
     C           IKMTYP    OREQ 'TD'                        *4            CSW200
     C                     BITOF'2'       CNFI              *4            CSW200
     C                     ELSE                             *4            CSW200
     C                     BITOF'12'      CNFI              *4            CSW200
     C                     ENDIF                            *4            CSW200
      *                                                                   CSW200
     C                     ENDIF                            *4            CSW200
      *
     C                     END                             E*4
     C                     END                             E*3
     C                     END                             E*2
     C                     END                             E*1
      *
     C           #ZA9      ENDSR                           **#ZA9**
      /EJECT
      *****************************************************************
      *                                                               *
      *  SUBROUTINE: #ZB    -  Find out whether an amendment sett.    *
      *                        is pay or receive, using table         *
      *                        MMT0015.                               *
      *                                                               *
      *  FIELDS USED:                                                 *
      *                  @RP    -  Receipt/payment indicator
      *                  @S     -  Sign of amount
      *                                                               *
      *                                                               *
      *  CALLED BY :  #BA
      *  CALLS     :
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           #ZB       BEGSR
      *
      ** Original MIDAS type is CD.
     C           IGOMDT    IFEQ 'CD'                       B*1
     C           IGOMDT    OREQ 'ID'                       B*1            S01354
      *
     C           IGTYPE    IFEQ 'PI'                       B*2
     C                     MOVE 'R'       @RP               *2
     C                     MOVE 'P'       @S                *2
     C                     ELSE                            X*2
     C           IGTYPE    IFEQ 'PD'                       B*3
     C                     MOVE 'P'       @RP               *3
     C                     MOVE 'N'       @S                *3
     C                     END                             E*3
     C                     END                             E*2
     C           IGTYPE    IFEQ 'SI'                                      DT0058
     C***********          MOVE 'R'       @RP                      DT0058 E28506
     C***********          MOVE 'P'       @S                       DT0058 E28506
     C                     MOVE 'P'       @RP                             E28506
     C                     MOVE 'N'       @S                              E28506
     C                     END                                            DT0058
      *
     C                     GOTO #ZB9                        *1
     C                     END                             E*1
      *
      ** Original MIDAS type is CL or DL.
     C           IGOMDT    IFEQ 'CL'                       B*1
     C           IGOMDT    OREQ 'DL'                       B*1
     C           IGOMDT    OREQ 'IL'                       B*1            S01354
      *
     C           IGTYPE    IFEQ 'PD'                       B*2
     C                     MOVE 'R'       @RP               *2
     C                     MOVE 'P'       @S                *2
     C                     ELSE                            X*2
     C           IGTYPE    IFEQ 'PI'                       B*3
     C                     MOVE 'P'       @RP               *3
     C                     MOVE 'N'       @S                *3
     C                     END                             E*3
     C                     END                             E*2
     C           IGTYPE    IFEQ 'SI'                                      DT0058
     C                     MOVE 'R'       @RP                             DT0058
     C                     MOVE 'P'       @S                              DT0058
     C                     END                                            DT0058
      *
     C                     GOTO #ZB9                        *1
     C                     END                             E*1
      *
      ** Original MIDAS type is IT,TD or CI.
     C           IGOMDT    IFEQ 'IT'                       B*1
     C           IGOMDT    OREQ 'TD'                       B*1
     C           IGOMDT    OREQ 'CI'                       B*1
      *
     C           IGTYPE    IFEQ 'SI'                       B*2
     C                     MOVE 'P'       @RP               *2
     C                     MOVE 'N'       @S                *2
     C                     END                             E*2
      *
     C                     GOTO #ZB9                        *1
     C                     END                             E*1
      *
      ** Original MIDAS type is IP,TI,LN,C1,C2,BP or BD.
     C           IGOMDT    IFEQ 'IP'                       B*1
     C           IGOMDT    OREQ 'TI'                       B*1
     C           IGOMDT    OREQ 'LN'                       B*1
     C           IGOMDT    OREQ 'C1'                       B*1
     C           IGOMDT    OREQ 'C2'                       B*1
     C           IGOMDT    OREQ 'BP'                       B*1
     C           IGOMDT    OREQ 'BD'                       B*1
      *
     C           IGTYPE    IFEQ 'SI'                       B*2
     C                     MOVE 'R'       @RP               *2
     C                     MOVE 'P'       @S                *2
     C                     END                             E*2
      *
     C                     GOTO #ZB9                        *1
     C                     END                             E*1
      *
      ** Original MIDAS type is other than above.
     C                     MOVE ' '       @RP
     C                     MOVE 'P'       @S
      *
     C           #ZB9      ENDSR                           **#ZB9**
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SUBROUTINE: #ZC    - Update trailer record for loan/deposit, *
      *                       bought N/A or sold N/A (update DEALSDF).*
      *                                                               *
      *  FIELDS USED:                                                 *
      *                                                               *
      *                                                               *
      *  CALLED BY :  #B
      *  CALLS     :
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C*********  #ZC       BEGSR                                          E12279
      *                                                                   E12279
     C*********  999999    CHAINDEALSDFF             60                   E12279
     C*********  *IN60     IFEQ '1'                        B*1            E12279
     C*********            MOVE '047'     DBASE             *1            E12279
     C*********            EXSR INFSR                       *1            E12279
     C*********            END                             E*1            E12279
      *
      ** Loans/deposits - INSERTS
     C********** @THDL     IFEQ 'L'                        B*1            E12279
     C********** ICMACT    ANDEQ'I'                        B*1            E12279
     C**********           Z-ADDIKAMNP    WSAMNP 150        *1            E12279
     C**********           EXSR #ZE                         *1            E12279
     C**********           ADD  1         NORE              *1            E12279
     C***********          ADD  1         NINS              *1            E12279
     C**********           ADD  1         NLRA              *1            E12279
      *
     C**********           Z-ADDVRIF      @HINT             *1            E12279
     C**********           Z-ADDVRIL      @HDEC             *1            E12279
     C**********           EXSR #ZEA                        *1            E12279
     C**********           Z-ADD@HINT     VRIF              *1            E12279
     C**********           Z-ADD@HDEC     VRIL              *1            E12278
      *
     C**********           Z-ADDVLAF      @HINT             *1            E12279
     C**********           Z-ADDVLAL      @HDEC             *1            E12279
     C**********           EXSR #ZEA                        *1            E12279
     C**********           Z-ADD@HINT     VLAF              *1            E12279
     C**********           Z-ADD@HDEC     VLAL              *1            ME2359
     C**********           GOTO #ZC1                        *1            E12279
     C**********           END                             E*1            E12279
      *
      ** Loans/deposits - DELETIONS
     C********** @THDL     IFEQ 'L'                        B*1            E12279
     C********** ICMACT    ANDEQ'R'                        B*1            E12279
     C**********           Z-ADDIKAMNP    WSAMNP            *1            E12279
     C**********           EXSR #ZE                         *1            E12279
     C**********           ADD  1         NDEL              *1            E12279
     C**********           SUB  1         NLRA              *1            E12279
     C**********           Z-ADDVRDF      @HINT             *1            E12279
     C**********           Z-ADDVRDL      @DEC              *1            E12279
     C**********           EXSR #ZEA                        *1            E12279
     C**********           Z-ADD@HINT     VRDF              *1            E12279
     C**********           Z-ADD@HDEC     VRDL              *1            E12279
      *
     C**********           Z-ADDVLAF      @HINT             *1            E12279
     C**********           Z-ADDVLAL      @DEC              *1            E12279
     C***********          EXSR #ZEB                        *1            E12279
     C**********           Z-ADD@HINT     VLAF              *1            E12279
     C**********           Z-ADD@HDEC     VLAL              *1            E12279
     C**********           GOTO #ZC1                        *1            E12279
     C**********           END                             E*1            E12279
      *
      ** N/A Bought - INSERTS
     C********** @THDL     IFEQ 'B'                        B*1            E12279
     C********** ICMACT    ANDEQ'I'                        B*1            E12279
      *
     C********** IHMTYP    IFNE 'C1'                       B*2            E12279
     C**********           Z-ADDIHAMNP    WSAMNP            *2            E12279
     C**********           ELSE                            X*2            E12279
     C**********           Z-ADDIHFVAL    WSAMNP            *2            E12279
     C**********           END                             E*2            E12279
     C**********           EXSR #ZE                                       E12279
      *
     C**********           ADD  1         NORE              *1            E12279
     C**********           ADD  1         NINS              *1            E12279
     C**********           ADD  1         NLRA              *1            E12279
      *
     C**********           Z-ADDVRIF      @HINT             *1            E12279
     C**********           Z-ADDVRIL      @HDEC             *1            E12279
     C**********           EXSR #ZEA                        *1            E12279
     C**********           Z-ADD@HINT     VRIF              *1            E12279
     C**********           Z-ADD@HDEC     VRIL              *1            E12279
      *
     C**********           Z-ADDVLAF      @HINT             *1            E12279
     C**********           Z-ADDVLAL      @HDEC             *1            E12279
     C**********           EXSR #ZEA                        *1            E12279
     C**********           Z-ADD@HINT     VLAF              *1            E12279
     C**********           Z-ADD@HDEC     VLAL              *1            E12279
      *
     C**********           GOTO #ZC1                        *1            E12279
     C**********           END                             E*1            E12279
      *
      ** N/A Bought - DELETIONS
     C********** @THDL     IFEQ 'B'                        B*1            E12279
     C********** ICMACT    ANDEQ'R'                        B*1            E12279
      *
     C********** IHMTYP    IFNE 'C1'                       B*2            E12279
     C**********           Z-ADDIHAMNP    WSAMNP            *2            E12279
     C**********           ELSE                            X*2            E12279
     C**********           Z-ADDIHFVAL    WSAMNP            *2            E12279
     C**********           END                             E*2            E12279
     C**********           EXSR #ZE                                       E12279
      *
     C**********           ADD  1         NDEL              *1            E12279
     C**********           SUB  1         NLRA              *1            E12279
     C**********           Z-ADDVRDF      @HINT             *1            E12279
     C**********           Z-ADDVRDL      @DEC              *1            E12279
     C**********           EXSR #ZEA                        *1            E12279
     C**********           Z-ADD@HINT     VRDF              *1            E12279
     C**********           Z-ADD@HDEC     VRDL              *1            E12279
     C**********           Z-ADDVLAF      @HINT             *1            E12279
     C**********           Z-ADDVLAL      @DEC              *1            E12279
     C**********           EXSR #ZEB                        *1            E12279
     C**********           Z-ADD@HINT     VLAF              *1            E12279
     C**********           Z-ADD@HDEC     VLAL              *1            E12279
     C**********           GOTO #ZC1                        *1            E12279
     C**********           END                             E*1            E12279
      *
      *
      ** N/A Sold - INSERTS
     C*********  @THDL     IFEQ 'S'                        B*1            E12279
     C********** ICMACT    ANDEQ'I'                        B*1            E12279
     C**********           Z-ADDILAMNP    WSAMNP            *1            E12279
     C**********           EXSR #ZE                         *1            E12279
     C**********           ADD  1         NORE              *1            E12279
     C***********          ADD  1         NINS              *1            E12279
     C**********           ADD  1         NLRA              *1            E12279
      *
     C**********           Z-ADDVRIF      @HINT             *1            E12279
     C**********           Z-ADDVRIL      @HDEC             *1            E12279
     C**********           EXSR #ZEA                        *1            E12279
     C**********           Z-ADD@HINT     VRIF              *1            E12279
     C**********           Z-ADD@HDEC     VRIL              *1            E12279
     C**********           Z-ADDVLAF      @HINT             *1            E12279
     C**********           Z-ADDVLAL      @HDEC             *1            E12279
     C**********           EXSR #ZEA                        *1            E12279
     C**********           Z-ADD@HINT     VLAF              *1            E12279
     C**********           Z-ADD@HDEC     VLAL              *1            E12279
     C**********           GOTO #ZC1                        *1            E12279
     C**********           END                             E*1            E12279
      *
      ** N/A Sold - DELETIONS
     C********** @THDL     IFEQ 'S'                        B*1            E12279
     C********** ICMACT    ANDEQ'R'                        B*1            E12279
     C**********           Z-ADDILAMNP    WSAMNP            *1            E12279
     C**********           EXSR #ZE                         *1            E12279
     C**********           ADD  1         NDEL              *1            E12279
     C**********           SUB  1         NLRA              *1            E12279
     C**********           Z-ADDVRDF      @HINT             *1            E12279
     C**********           Z-ADDVRDL      @DEC              *1            E12279
     C**********           EXSR #ZEA                        *1            E12279
     C**********           Z-ADD@HINT     VRDF              *1            E12279
     C**********           Z-ADD@HDEC     VRDL              *1            E12279
     C**********           Z-ADDVLAF      @HINT             *1            E12279
     C**********           Z-ADDVLAL      @DEC              *1            E12279
     C**********           EXSR #ZEB                        *1            E12279
     C**********           Z-ADD@HINT     VLAF              *1            E12279
     C**********           Z-ADD@HDEC     VLAL              *1            E12279
     C**********           END                             E*1            E12279
      *
     C********** #ZC1      TAG                             **#ZC1**       E12279
      *                                                                   ME1393
     C**********           MOVE 'T'       RECI                      E12279ME1393
      *
      ** Fields common to all deal and action types.
     C**********           Z-ADDRUND      LCD                             E12279
     C**********           MOVE ICMACT    CHTP                            E12279
      *
     C**********           UPDATDEALSDFF               60                 E12279
      *
     C********** *IN60     IFEQ '1'                        B*1            E12279
     C**********           MOVE '048'     DBASE             *1            E12279
     C**********           EXSR INFSR                       *1            E12279
     C**********           END                             E*1            E12279
      *
     C********** #ZC9      ENDSR                           **#ZC9**       E12279
      /EJECT
      *****************************************************************
      *                                                               *
      *  SUBROUTINE: #ZD    - Update trailer record for deal          *
      *                       amendment (update DEAMSDJ).             *
      *                                                               *
      *  FIELDS USED:                                                 *
      *                                                               *
      *                                                               *
      *  CALLED BY :  #B
      *  CALLS     :
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C*********  #ZD       BEGSR                                          E12279
      *
     C*********  999999    CHAINDEAMSDJF             60                   E12279
     C*********  *IN60     IFEQ '1'                        B*1            E12279
     C*********            MOVE '049'     DBASE             *1            E12279
     C*********            EXSR INFSR                       *1            E12279
     C*********            END                             E*1            E12279
      *
     C*********            Z-ADDIGAMNP    WSAMNP                          E12279
     C*********            EXSR #ZE                                       E12279
      *
      ** Inserts  -  GENERAL
     C*********  ICMACT    IFEQ 'I'                        B*1            E12279
     C*********            ADD  1         NORE              *1            E12279
     C*********            ADD  1         NINS              *1            E12279
     C*********            ADD  1         NLRA              *1            E12279
     C*********            ELSE                            X*1            E12279
      *
      ** Deletions  -  GENERAL
     C*********  ICMACT    IFEQ 'R'                        B*2            E12279
     C*********            ADD  1         NDEL              *2            E12279
     C*********            SUB  1         NLRA              *2            E12279
     C*********            END                             E*2            E12279
     C*********            END                             E*1            E12279
      *
      *
      ** Inserts  -  AMENDMENT TYPE PI
     C*********  ICMACT    IFEQ 'I'                        B*1            E12279
     C*********  IGMTYP    ANDEQ'PI'                       B*1            E12279
     C*********            ADD  1         NIPR              *1            E12279
     C*********            Z-ADDVRIF      @HINT             *1            E12279
     C*********            Z-ADDVRIL      @HDEC             *1            E12279
     C*********            EXSR #ZEA                        *1            E12279
     C*********            Z-ADD@HINT     VRIF              *1            E12279
     C*********            Z-ADD@DEC      VRIL              *1            E12279
     C*********            Z-ADDVIPF      @HINT             *1            E12279
     C*********            Z-ADDVIPL      @HDEC             *1            E12279
     C*********            EXSR #ZEA                        *1            E12279
     C*********            Z-ADD@HINT     VIPF              *1            E12279
     C*********            Z-ADD@DEC      VIPL              *1            E12279
     C*********            Z-ADDVLAF      @HINT             *1            E12279
     C*********            Z-ADDVLAL      @HDEC             *1            E12279
     C*********            EXSR #ZEA                        *1            E12279
     C*********            Z-ADD@HINT     VLAF              *1            E12279
     C*********            Z-ADD@DEC      VLAL              *1            E12279
     C*********            GOTO #ZD1                        *1            E12279
     C*********            END                             E*1            E12279
      *
      ** Inserts  -  AMENDMENT TYPE PD
     C*********  ICMACT    IFEQ 'I'                        B*1            E12279
     C*********  IGMTYP    ANDEQ'PD'                       B*1            E12279
     C*********            ADD  1         NDPR              *1            E12279
     C*********            Z-ADDVRIF      @HINT             *1            E12279
     C*********            Z-ADDVRIL      @HDEC             *1            E12279
     C*********            EXSR #ZEA                        *1            E12279
     C*********            Z-ADD@HINT     VRIF              *1            E12279
     C*********            Z-ADD@DEC      VRIL              *1            E12279
     C*********            Z-ADDVDPF      @HINT             *1            E12279
     C*********            Z-ADDVDPL      @HDEC             *1            E12279
     C*********            EXSR #ZEA                        *1            E12279
     C*********            Z-ADD@HINT     VDPF              *1            E12279
     C*********            Z-ADD@DEC      VDPL              *1            E12279
     C*********            Z-ADDVLAF      @HINT             *1            E12279
     C*********            Z-ADDVLAL      @HDEC             *1            E12279
     C*********            EXSR #ZEA                        *1            E12279
     C*********            Z-ADD@HINT     VLAF              *1            E12279
     C*********            Z-ADD@DEC      VLAL              *1            E12279
     C*********            GOTO #ZD1                        *1            E12279
     C*********            END                             E*1            E12279
      *
      ** Deletions  -  AMENDMENT TYPE PI
     C********** ICMACT    IFEQ 'R'                        B*1            E12279
     C********** IGMTYP    ANDEQ'PI'                       B*1            E12279
     C**********           SUB  1         NIPR              *1            E12279
     C**********           Z-ADDVRDF      @HINT             *1            E12279
     C**********           Z-ADDVRDL      @DEC              *1            E12279
     C**********           EXSR #ZEA                        *1            E12279
     C**********           Z-ADD@HINT     VRDF              *1            E12279
     C**********           Z-ADD@DEC      VRDL              *1            E12279
     C**********           Z-ADDVIPF      @HINT             *1            E12279
     C**********           Z-ADDVIPL      @DEC              *1            E12279
     C**********           EXSR #ZEB                        *1            E12279
     C**********           Z-ADD@HINT     VIPF              *1            E12279
     C**********           Z-ADD@DEC      VIPL              *1            E12279
     C**********           Z-ADDVLAF      @HINT             *1            E12279
     C**********           Z-ADDVLAL      @DEC              *1            E12279
     C**********           EXSR #ZEB                        *1            E12279
     C**********           Z-ADD@HINT     VLAF              *1            E12279
     C**********           Z-ADD@DEC      VLAL              *1            E12279
     C**********           GOTO #ZD1                        *1            E12279
     C**********           END                             E*1            E12279
      *                                                                   E12279
      ** Deletions  -  AMENDMENT TYPE PD                                  E12279
     C********** ICMACT    IFEQ 'R'                        B*1            E12279
     C********** IGMTYP    ANDEQ'PD'                       B*1            E12279
     C**********           SUB  1         NDPR              *1            E12279
     C**********           Z-ADDVRDF      @HINT             *1            E12279
     C**********           Z-ADDVRDL      @DEC              *1            E12279
     C**********           EXSR #ZEA                        *1            E12279
     C**********           Z-ADD@HINT     VRDF              *1            E12279
     C**********           Z-ADD@DEC      VRDL              *1            E12279
     C**********           Z-ADDVDPF      @HINT             *1            E12279
     C**********           Z-ADDVDPL      @DEC              *1            E12279
     C**********           EXSR #ZEB                        *1            E12279
     C**********           Z-ADD@HINT     VIPF              *1            E12279
     C**********           Z-ADD@DEC      VIPL              *1            E12279
     C**********           Z-ADDVLAF      @HINT             *1            E12279
     C**********           Z-ADDVLAL      @DEC              *1            E12279
     C**********           EXSR #ZEB                        *1            E12279
     C**********           Z-ADD@HINT     VLAF              *1            E12279
     C**********           Z-ADD@DEC      VLAL              *1            E12279
     C**********           END                             E*1            E12279
      *                                                                   E12279
     C********** #ZD1      TAG                             **#ZD1**       E12279
      *                                                                   E12279
      ** Fields common to all deal and action types.                      E12279
     C***********          Z-ADDRUND      LCD                             E12279
     C***********          MOVE 'A'       CHTP                            E12279
     C***********          MOVE 'T'       RECI                            E12279
      *                                                                   E12279
     C***********          UPDATDEAMSDJF               60                 E12279
      *                                                                   E12279
     C********** *IN60     IFEQ '1'                        B*1            E12279
     C**********           MOVE '050'     DBASE             *1            E12279
     C**********           EXSR INFSR                       *1            E12279
     C**********           END                             E*1            E12279
      *                                                                   E12279
     C********** #ZD9      ENDSR                           **#ZD9**       E12279
      /EJECT                                                              E12279
     C*****************************************************************   AUS007
     C*                                                               *   AUS007
     C* #RACD      Update BKRAT FILE                                  *   AUS007
     C*                                                               *   AUS007
     C* CALLS             -                                           *   AUS007
     C*                                                               *   AUS007
     C* CALLED BY  #BAA   - Loans Deposits Inserts                    *   AUS007
     C*            #BAC   - Loans Deposits Deletes                    *   AUS007
     C*                                                               *   AUS007
     C*                                                               *   AUS007
     C*****************************************************************   AUS007
     C           #RACD     BEGSR                                          AUS007
     C*                                                                   AUS007
     C                     MOVE RECI      RECIWF  1                       AUS007
     C           DLNO      CHAINBKRAT                61                   AUS007
     C           *IN61     IFEQ '0'                                       AUS007
     C           ICMACT    IFEQ 'I'                                       AUS007
     C                     MOVE 'D'       RECI                            AUS007
     C                     MOVE @RACD     RACD                            AUS007
     C                     ELSE                                           AUS007
     C                     MOVE 'R'       RECI                            AUS007
     C                     END                                            AUS007
     C                     UPDATBKRATAAF                                  AUS007
     C                     ELSE                                           AUS007
     C                     Z-ADD0         BACD                            AUS007
     C                     Z-ADD0         BRPD                            AUS007
     C                     Z-ADD0         BAPD                            AUS007
     C                     MOVE 'D'       RECI                            AUS007
     C                     MOVE @RACD     RACD                            AUS007
     C                     WRITEBKRATAAF                                  AUS007
     C                     END                                            AUS007
     C                     MOVE RECIWF    RECI                            AUS007
     C*                                                                   AUS007
     C                     ENDSR                                          AUS007
     C/EJECT                                                              AUS007
      *****************************************************************
      *                                                               *
      *  SUBROUTINE: #ZE    - Break amount down into 2 fields,        *
      *                        15 & 3 long respectively.              *
      *                                                               *
      *  FIELDS USED:                                                 *
      *                                                               *
      *                                                               *
      *  CALLED BY :  #ZC & #ZD                                       *
      *  CALLS     :                                                  *
      *                                                               *
      *                                                               *
      *  N.B.  -  Taken straight from FX0380, the FX version of       *
      *           MIDAS deals updates.                                *
      *                                                               *
      *****************************************************************
      *
     C*********  #ZE       BEGSR                                          E12279
     C*                                                                   E12279
     C**    Set up purchase amount in @INT/@DEC (Integer/decimal)
     C*
     C*
     C**********           MOVE *BLANKS   KEY                             E12279
     C**********           MOVE '20'      @PRF                            E12279
     C**********           MOVE ICCCY     @CUR                            E12279
     C**********           MOVE '1'       @SUF                            E12279
     C********** KEY       CHAINFDCCYTLL             60                   E12279
      *                                                                   E12279
      ** If no record found, terminate with error.
     C*********  *IN60     IFEQ '1'                        B*1            E12279
     C*********            MOVE '051'     DBASE             *1            E12279
     C*********            EXSR INFSR                       *1            E12279
     C*********            END                             E*1            E12279
      *
     C*********            Z-ADD*ZERO     @DEC                            E12279
     C*********            MOVE WSAMNP    @X15   15                       E12279
     C*
     C*********            Z-ADD4         @N      20                      E12279
     C*********            MOVEA@X15      @ID,@N                          E12279
     C*
     C*********  @DEC      IFLT *ZERO                      B1             E12279
     C*********            Z-SUB@INT      @INT             *1             E12279
     C*********            END                             E1             E12279
      *
     C*********            ENDSR                                          E12279
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *        SR.#ZEA - ADD AMOUNT TO HASH TRAILER                   *
      *                                                               *
      *        @HINT - CURRENT HASH INTEGER (15,0)                    *
      *        @HDEC - CURRENT HASH DECIMAL (3,0)                     *
      *        @INT  - INTEGER AMOUNT                                 *
      *        @DEC  - DECIMAL AMOUNT                                 *
      *                                                               *
      *****************************************************************
      *
     C********** #ZEA      BEGSR                                          E12279
      *
     C**********           ADD  @INT      @HINT  150                      E12279
      *
     C***********          Z-ADD@HDEC     @WK4N   40                      E12279
     C***********          ADD  @DEC      @WK4N                           E12279
      *
     C********** @WK4N     IFGT 999                                       E12279
     C**********           ADD  1         @HINT                           E12279
     C**********           END                                            E12279
      *
     C**********           Z-ADD@WK4N     @HDEC   30                      E12279
      *
     C**********           ENDSR                                          E12279
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *        SR.#ZEB - SUB AMOUNT FROM HASH TRAILER                 *
      *                                                               *
      *        @HINT - CURRENT HASH INTEGER (15,0)                    *
      *        @HDEC - CURRENT HASH DECIMAL (3,0)                     *
      *        @INT  - INTEGER AMOUNT                                 *
      *        @DEC  - DECIMAL AMOUNT                                 *
      *                                                               *
      *****************************************************************
      *
     C********** #ZEB      BEGSR                                          E12279
      *
     C**********           SUB  @INT      @HINT  150                      E12279
      *
     C**********           Z-ADD@HDEC     @WK3N   30                      E12279
     C**********           ADD  @DEC      @WK3N                           E12279
      *
     C********** @WK3N     IFLT 0                                         E12279
     C**********           SUB  1         @HINT                           E12279
     C********** @WK3N     ADD  1000      @WK4N                           E12279
     C**********           Z-ADD@WK4N     @HDEC                           E12279
     C**********           ELSE                                           E12279
     C**********           Z-ADD@WK4N     @HDEC                           E12279
     C**********           END                                            E12279
      *
      *
     C**********           ENDSR                                          E12279
      *****************************************************************
      /EJECT
      *****************************************************************
      /COPY ZSRSRC,ZF2C                                                   S01195
      *****************************************************************   S01195
      /EJECT                                                              S01195
      *****************************************************************   S01195
      /COPY ZSRSRC,ZACCH                                                  S01195
      *****************************************************************   S01195
      /EJECT                                                              S01195
      *****************************************************************   S01195
      ******                                                          *   S01195
      ***COMMON SUBROUTINE: MM1005                                        S01195
      *DICDRLLIF  E           K        DISK         KINFSR INFSR      UC  S01195
      ******      TABTB10F                          KIGNORE               S01195
      ******      TABTB20F                          KIGNORE               S01195
      ********************************************************************S01195
      ******                                                              S01195
      **MM1005 - THIS SUBROUTINE FINDS OUT THE NUMBER OF WORKING DAYS     S01195
      ******     FORWARD FOR A SPECIFIC CURRENCY AGAINST A LOCAL          S01195
      ******     CURRENCY.                                                S01195
      ******                                                              S01195
      **CALLED BY :                                                       S01195
      ******                                                              S01195
      **CALLS :  ZA0830, A COMMON ROUTINE TO DETERMINE WHETHER A DATE     S01195
      ******     IS A WORKING DAY OR A HOLIDAY.                           S01195
      ******                                                              S01195
      **INPUT  : @@MNO  MIDAS DAY NUMBER 5N                               S01195
      ******     @@CCY  CURRENCY CODE 3A                                  S01195
      ******     @@FWD  NO. OF WORKING DAYS FORWARD 5N                    S01195
      ******                                                              S01195
      **OUTPUT : @@FDAT FORWARD DATE (MIDAS DAY NUMBER) 5N                S01195
      ******                                                              S01195
      **USES :   @@MNO  MIDAS DAY NUMBER                                  S01195
      ******     @@CCY  CURRENCY CODE                                     S01195
      ******     @@WF2  WORK FIELD 5N                                     S01195
      ******     @@HIND HOLIDAY/WORKING DAY INDICATOR  1A                 S01195
      ******     @@FWD  NUMBER OF WORKING DAYS FORWARD TO LOOK 5N         S01195
      ******                                                              S01195
      **FILES : THIS PROGRAM EXPECTS FILE FCICDRLL TO HAVE BEEN           S01195
      ******    DEFINED AND ALREADY ACCESSED WITH A KEY OF                S01195
      ******    '01        11'.                                           S01195
      ******                                                              S01195
      ********************************************************************S01195
     C******     MM1005    BEGSR                                          S01195
      ***INITIALISE FIELDS                                                S01195
     C******               Z-ADD@@MNO     @@MNO   50                      S01195
     C******               Z-ADD*ZEROS    @@WF2   50                      S01195
      ******                                                              S01195
      ****LOOP TO PROCESS INPUT PARAMETERS                                S01195
      ******                                                              S01195
     C******     @@WF2     DOWLT@@FWD                      *** B 1        S01195
      ***INCREMENT NUMBER OF WORK DAYS                                    S01195
     C******               ADD  1         @@WF2                           S01195
      ***INCREMENT DATE                                                   S01195
     C******               ADD  1         @@MNO                           S01195
      ***LOOP TO OBTAIN FIRST WORKING DAY                                 S01195
     C******     @@HIND    DOUEQ'W'                        *** B 2        S01195
      ***CALL COMMON ROUTINE TO DETERMINE IF WORKING DAY                  S01195
     C******               EXSR ZA0830                                    S01195
      ***INCREMENT NUMBER OF WORK DAYS - IF FOUND TO BE HOLIDAY           S01195
     C******     @@HIND    IFEQ 'H'                        *** B 3        S01195
     C******               ADD  1         @@MNO                           S01195
     C******               END                             *** E 3        S01195
      ******               +                                              S01195
     C******               END                             *** E 2        S01195
      ******               ++                                             S01195
      ***TEST IF WORKING DAY FOR LOCALS                                   S01195
     C******               MOVE @@CCY     @@WA3   3                       S01195
     C******               MOVE LCCY      @@CCY   3                       S01195
     C******               MOVE *BLANKS   @@HIND  1                       S01195
      ******                                                              S01195
      ***CALL COMMON ROUTINE AGAIN                                        S01195
     C******               EXSR ZA0830                                    S01195
      ***RESTORE FIELD TO ORIGINAL VALUE                                  S01195
     C******               MOVE @@WA3     @@CCY   3                       S01195
      ***IF LOCAL HOLIDAY DECREMENT COUNTER                               S01195
     C******     @@HIND    IFEQ 'H'                        *** B 2        S01195
     C******               SUB  1         @@WF2                           S01195
     C******               END                             *** E 2        S01195
      ******               +                                              S01195
     C******               END                             *** E 1        S01195
      ******               ++                                             S01195
      ***LOAD OUTPUT FIELD                                                S01195
     C******               Z-ADD@@MNO     @@FDAT  50                      S01195
      ******                                                              S01195
     C******     M10059    ENDSR                                          S01195
      *****************************************************************   S01195
      *EJECT                                                              S01195
      *****************************************************************   S01195
      ***COMMON*SUBROUTINE: ZA0830   -   CALLED BY COMMON ROUTINE         S01195
      ******                                              MM1005          S01195
      ********************************************************************S01195
      ******                                                              S01195
      **ZA0830 - THIS SUBROUTINE FINDS OUT WHETHER A PARTICULAR DAY       S01195
      ******     IS A HOLIDAY IN A PARTICULAR CURRENCY                    S01195
      ******                                                              S01195
      **CALLED BY :                                                       S01195
      ******                                                              S01195
      **CALLS :                                                           S01195
      ******                                                              S01195
      **INPUT  : @@MNO  MIDAS DAY NUMBER 5N                               S01195
      ******     @@CCY  CURRENCY CODE 3A                                  S01195
      ******                                                              S01195
      **OUTPUT : @@HIND HOLIDAY/WORKING DAY INDICATOR 1A                  S01195
      ******                                                              S01195
      **USES :   @@MNO  MIDAS DAY NUMBER                                  S01195
      ******     @@CCY  CURRENCY CODE                                     S01195
      ******     @@ONCE FIRST TIME THROUGH INDICATOR                      S01195
      ******     @@CY1  FIRST HALF OF CURRENCY ARRAY                      S01195
      ******     @@CY2  SECOND HALF OF CURRENCY ARRAY                     S01195
      ******     @@MNO6 MIDAS NUMBER WITH TRAILING BLANK                  S01195
      ******     @@HIND HOLIDAY/WORKING DAY INDICATOR                     S01195
      ******     @@INEX INCLUDE/EXCLUDE INDICATOR                         S01195
      ******                                                              S01195
      ******     INDICATORS                                               S01195
      ******     80 RECORD NOT FOUND                                      S01195
      ******     81 CURRENCY NOT FOUND ON RECORD                          S01195
      ******                                                              S01195
      ********************************************************************S01195
     C******     ZA0830    BEGSR                                          S01195
      ******                                                              S01195
      ***OPEN CURRENCY/HOLIDAY FILE IF FIRST TIME THROUGH                 S01195
     C******     @@ONCE    IFNE 'Y'                        B1             S01195
     C******               OPEN FDTABJLL                   *1             S01195
     C******               MOVE 'Y'       @@ONCE  1        *1             S01195
     C******               END                             E1             S01195
      ******                                                              S01195
      ***BLANK OUT ARRAY                                                  S01195
     C******               MOVE *BLANKS   @@CY1                           S01195
     C******               MOVE *BLANKS   @@CY2                           S01195
      ******                                                              S01195
      ***ACCESS TABLE ON FIRST KEY                                        S01195
     C******               MOVEL@@MNO     @@MNO6  6                       S01195
     C******               MOVE @@MNO6    @@0830 12                       S01195
     C******               MOVEL'22    '  @@0830                          S01195
     C******               MOVE '1'       @@0830                          S01195
     C******     @@0830    CHAINTABLETJF             80                   S01195
      ******                                                              S01195
      ***IF*RECORD NOT FOUND OR DELETED                                   S01195
     C******     *IN80     IFEQ '1'                        B1             S01195
     C******     RECI      OREQ '*'                        *1             S01195
     C******               MOVE 'W'       @@HIND           *1             S01195
     C******               GOTO ZA0839                     *1             S01195
     C******               END                             E1             S01195
      ******                                                              S01195
      ***MOVE FIRST 25 CURRENCIES TO ARRAY                                S01195
     C******               MOVE HCCY      @@CY1                           S01195
      ******                                                              S01195
      ***ACCESS TABLE ON SECOND KEY                                       S01195
     C******               MOVE '2'       @@0830                          S01195
     C******     @@0830    CHAINTABLETJF             80                   S01195
      ******                                                              S01195
      ***IF*SECOND RECORD FOUND AND NOT DELETED                           S01195
     C******     *IN80     IFEQ '0'                        B1             S01195
     C******     RECI      ANDNE'*'                        *1             S01195
     C******               MOVE HCCY      @@CY2            *1             S01195
     C******               END                             E1             S01195
      ******                                                              S01195
      ***SEARCH ARRAY FOR INPUT CURRENCY                                  S01195
     C******     @@CCY     LOKUP@CY                      81               S01195
      ******                                                              S01195
      ***IF*INPUT CURRENCY IS IN ARRAY                                    S01195
     C******     *IN81     IFEQ '1'                        B1             S01195
      ******                                                              S01195
      ***IF*INCLUDE/EXCLUDE INDICATOR EQ 'E'                              S01195
     C******     INEX      IFEQ 'E'                        B*2            S01195
     C******               MOVE 'W'       @@HIND  1        **2            S01195
     C******               ELSE                            X*2            S01195
     C******               MOVE 'H'       @@HIND           **2            S01195
     C******               END                             E*2            S01195
     C******               END                             E1             S01195
      ******                                                              S01195
      ***IF*INPUT CURRENCY IS NOT IN ARRAY                                S01195
     C******     *IN81     IFEQ '0'                        B1             S01195
      ******                                                              S01195
      ***IF*INCLUDE/EXCLUDE INDICATOR EQ 'I'                              S01195
     C******     INEX      IFEQ 'I'                        B*2            S01195
     C******               MOVE 'W'       @@HIND           **2            S01195
     C******               ELSE                            X*2            S01195
     C******               MOVE 'H'       @@HIND           **2            S01195
     C******               END                             E*2            S01195
     C******               END                             E1             S01195
     C******     ZA0839    ENDSR                                          S01195
      /EJECT
     C*                                                                   056095
     C/COPY ZSRSRC,ZDAT10Z2                                               056095
     C******************************************************************* E14393
     C***********                                                   E14393056095
     C**ZA0680*-*THIS SUBROUTINE CONVERTS YYYYMMDD FORMAT DATE TO   E14393056095
     C***********MIDAS DAY NUMBER FORMAT (NO. DAYS FROM 31/12/71)   E14393056095
     C***********                                                   E14393056095
     C**CALLED*BY :                                                 E14393056095
     C***********                                                   E14393056095
     C**CALLS*:**                                                   E14393056095
     C***********                                                   E14393056095
     C**INPUT**:*@@DTIN DATE (YYYYMMDD) - IN DATA STRUCTURE (SIZE : E14393056095
     C***********                                                   E14393056095
     C**OUTPUT*:*@@MDNO MIDAS DAY NUMBER  (SIZE : 5N)               E14393056095
     C***********                                                   E14393056095
     C**USES*:***@@CC   NUMBER OF CENTURIES IN DATE                 E14393056095
     C***********@@DAY  DAY NUMBER                                  E14393056095
     C***********@@REM  REMAINDER FROM DIVIDE                       E14393056095
     C***********@@MTH  MONTH NUMBER                                E14393056095
     C***********@MD    COMPILATION TIME ARRAY FOR CUMULATIVE DAYS IE14393056095
     C***********       MONTH                                       E14393056095
     C***********@@WK2  WORK FIELD (2,0)                            E14393056095
     C***********@@WK5  WORK FIELD (5,0)                            E14393056095
     C***********@@YYYY YEAR (4 CHARACTER)                          E14393056095
     C***********@@YY   YEAR (2 CHARACTER)                          E14393056095
     C***********@YD    COMPILATION TIME ARRAY FOR CUMULATIVE DAYS IE14393056095
     C***********       A FOUR YEAR PERIOD                          E14393056095
     C***********                                                   E14393056095
     C**************************************************************E14393056095
     C***********                                                   E14393056095
     C***********ZA0680    BEGSR                                    E14393056095
     C***********                                                   E14393056095
     C****CLEAR*OUT ANY 'OLD' DATA IN FIELD                         E14393056095
     C***********          Z-ADD0         @@MDNO  50                E14393056095
     C***********                                                   E14393056095
     C*****IF*DATE GREATER THAN 31/12/2071 NEED EXTRA PROCESSING    E14393056095
     C***********@@YYYY    IFGE 2072                       B1       E14393056095
     C***********                                                   E14393056095
     C******MULTIPLY BY NUMBER OF DAYS IN CENTURY (SINCE 1971)      E14393056095
     C***********@@CC      SUB  19        @@WK2   20       *1       E14393056095
     C***********@@WK2     MULT 36524     @@MDNO           *1       E14393056095
     C***********                                                   E14393056095
     C****YEAR*2000 IS A LEAP YEAR MUST ALLOW EXTRA DAY             E14393056095
     C***********          ADD  1         @@MDNO           *1       E14393056095
     C***********          END                             E1       E14393056095
     C***********                                                   E14393056095
     C***********@@YYYY    ADD  28        @@WK2                     E14393056095
     C***********                                                   E14393056095
     C***********@@WK2     DIV  4         @@WK2                     E14393056095
     C***********          MVR            @@REM   10                E14393056095
     C***********                                                   E14393056095
     C******MULTIPLY BY NUMBER OF DAYS IN FOUR YEAR PERIOD          E14393056095
     C***********@@WK2     MULT 1461      @@WK5   50                E14393056095
     C***********          ADD  @@WK5     @@MDNO                    E14393056095
     C***********                                                   E14393056095
     C****CHECK*REMAINDER AND MONTH NUMBER                          E14393056095
     C***********@@REM     IFEQ 0                          B1       E14393056095
     C***********@@MTH     ANDGT2                          B1       E14393056095
     C***********          ADD  1         @@MDNO           *1       E14393056095
     C***********          END                             E1       E14393056095
     C***********                                                   E14393056095
     C****YEAR*NOT LEAP YEAR,  ADD CUMULATIVE DAYS FOR YEAR         E14393056095
     C***********@@REM     IFNE 0                          B1       E14393056095
     C***********          ADD  @YD,@@REM @@MDNO           *1       E14393056095
     C***********          END                             E1       E14393056095
     C***********                                                   E14393056095
     C****ADD*MONTHS THIS YEAR                                      E14393056095
     C***********          ADD  @MD,@@MTH @@MDNO                    E14393056095
     C***********                                                   E14393056095
     C****ADD*DAYS THIS MONTH                                       E14393056095
     C***********          ADD  @@DAY     @@MDNO                    E14393056095
     C***********                                                   E14393056095
     C***********ZA0689    ENDSR                           **ZA0689 E14393056095
     C*****************************************************************   E14393
     C/EJECT                                                              S01392
     C*****************************************************************   S01392
     C*   MM1030 - CALCULATE INTEREST                                 *   S01392
     C*            (MM1030 INCLUDES ADJUSTMENT FOR ERROR IN DIVISION) *   S01392
     C*                                                               *   S01392
     C*  CALLED BY    -                                               *   S01392
     C*                                                               *   S01392
     C***CALLS********-***MM1009*CALCULATE*NO.*OF*INTEREST*DAYS*****S01392056095
     C*  CALLS        -   ZINTDY CALCULATE NO. OF INTEREST DAYS       *   056095
     C*                                                               *   S01392
     C***FIELDS*INPUT*@@BEG**-*START*DATE*OF*PERIOD*****************S01392056095
     C****************@@END**-*END*DATE*OF*PERIOD*******************S01392056095
     C****************@@CALC*-*INTEREST*CALCULATION*METHOD**********S01392056095
     C*  FIELDS INPUT ZZBEG  - START DATE OF PERIOD                   *   056095
     C*               ZZEND  - END DATE OF PERIOD                     *   056095
     C*               ZZCALC - INTEREST CALCULATION METHOD            *   056095
     C*               @@AMT  - PRINCIPAL AMOUNT  15N                  *   S01392
     C*               @@RATE - INTEREST RATE 11,7                     *   S01392
     C*               @@RDFC - ROUND DOWN FACILITY IND 1              *   056121
     C*                                                               *   S01392
     C*  FIELDS OUTPUT @@INTR - INTEREST 15,0                         *   S01392
     C*                                                               *   S01392
     C***WORK*FIELDS***@@W155*-*15,5*******************************S01392 056121
     C*  WORK FIELDS   @@W157 - 15,7                                  *   056121
     C*                @@W210 - 21,0                                  *   056121
     C*                @@YEAR - (NUMBER OF DAYS IN YEAR) x 100        *   S01392
     C*****************@@WDIV*-*15,5**HOLDS*RESULT*OF*DIVISION*****S01392 056121
     C*****************@@ERR**-*15,9**ROUNDING*ERROR***************S01392 056121
     C************@@AMTR*-*15,1**AMOUNT*FROM*ROUNDING*ERROR*CALC.**S01392 056121
     C***********************CAN*BE*15,1*SINCE*IT*IS*NOT*POSSIBLE**S01392 056121
     C**************************TO*INPUT*15*BYTE*FIELDS*IN*DRS.****S01392 056121
     C*                                                               *   S01392
     C*****************************************************************   S01392
     C           MM1030    BEGSR                                          S01392
     C*                                                                   S01392
     C*   CALCULATE NUMBER OF INTEREST DAYS                               S01392
     C/COPY WNCPYSRC,MM0081C014
     C***********          EXSR MM1009                              S01392056095
     C                     EXSR ZINTDY                                    056095
     C*                                                                   S01392
     C***********@@CALC    IFEQ '2'                        *** B 1  S01392056095
     C***********@@CALC    OREQ '3'                                 S01392056095
     C***********@@CALC    OREQ '5'                                 S01392056095
     C           ZZCALC    IFEQ '2'                        *** B 1        056095
     C           ZZCALC    OREQ '3'                                       056095
     C           ZZCALC    OREQ '5'                                       056095
     C           ZZCALC    OREQ '0'                                                          CER016A
     C***********@@AMT     DIV  36000     @@WDIV 155               S01392 056121
     C                     Z-ADD36000     @@YEAR  50                      S01392
     C                     END                             *** E 1        S01392
     C*                                                                   S01392
     C***********@@CALC    IFEQ '1'                        *** B 1  S01392056095
     C***********@@CALC    OREQ '4'                                 S01392056095
     C           ZZCALC    IFEQ '1'                        *** B 1        056095
     C           ZZCALC    OREQ '4'                                       056095
     C***********@@AMT     DIV  36500     @@WDIV                   S01392 056121
     C                     Z-ADD36500     @@YEAR                          S01392
     C                     END                              *** E 1       S01392
     C*                                                                   S01392
     C***********@@CALC    IFEQ '6'                         *** B 1 S01392056095
     C           ZZCALC    IFEQ '6'                         *** B 1       056095
     C***********@@AMT     DIV  36600     @@WDIV                   S01392 056121
     C                     Z-ADD36600     @@YEAR                          S01392
     C                     END                              *** E 1       S01392
     C*                                                                   S01392
     C           ZZCALC    IFEQ '6'                                       163136
     C           INT6DY    MULT @@RATE    @@W157                          163136
     C                     ELSE                                           163136
      *                                                                   163136
     C***********@@WDIV    MULT @@RATE    @@W155 155               S01392 056121
     C           ZZINDY    MULT @@RATE    @@W157 157                      056121
      *                                                                   163136
     C                     END                                            163136
      *                                                                   163136
     C           @@W157    MULT @@AMT     @@W210 210H                     056121
     C*                                                                   S01392
     C*MULTIPLY*@@WDIV*BY*@@YEAR*TO*GET*ORIGINALAMOUNT.THE*RESULT**S01392 056121
     C****COULD*DIFFER*FROM*THE*ORIGINAL*DUE*TO*ROUNDING*ERROR*ON**S01392 056121
     C****DIVISION.************************************************S01392 056121
     C***********@@WDIV    MULT @@YEAR    @@AMTR 151               S01392 056121
     C***********                                                  S01392 056121
     C*CALCULATE*THE*ERROR*AND*DO*SAME*ARITHMETICALOPERATIONSASON**S01392 056121
     C****@@AMT*ABOVE.*********************************************S01392 056121
     C***********@@AMT     SUB  @@AMTR    @@ERR  159               S01392 056121
     C***********          MULT @@RATE    @@ERR                    S01392 056121
     C***********          DIV  @@YEAR    @@ERR                    S01392 056121
     C***********                                                  S01392 056121
     C*ADD*RESULT*FROM*ERROR*CALCULATIONS*BACK*TO*THE*RESULT*FROM**S01392 056121
     C****CALCULATIONS*ON*PRINCIPAL*AMOUNT.************************S01392 056121
     C***********          ADD  @@ERR     @@W155                   S01392 056121
     C***********                                                  S01392 056121
     C****MULTIPLY*BY*THE*PERIOD*TO*OBTAIN*THE*INTEREST.***********S01392 056121
     C****(ROUNDING*DOWN*IF*ROUND*DOWN*INDICATOR*IS*'Y'************S01392 056121
     C*                                                                   S01392
     C**  ROUND DOWN IF ROUND DOWN INDICATOR IS 'Y'.                      056121
     C           @@RDFC    IFEQ 'Y'                                       S01392
     C***********@@W155    MULT @@INDY    @@INTR                    S01392056095
     C***********@@W155    MULT ZZINDY    @@INTR                   056095 056121
     C           @@W210    DIV  @@YEAR    @@INTR                          056121
     C                     ELSE                                           S01392
     C***********@@W155    MULT @@INDY    @@INTR 150H               S01392056095
     C***********@@W155    MULT ZZINDY    @@INTR 150H              056095 056121
     C           @@W210    DIV  @@YEAR    @@INTR 150H                     056121
     C                     END                                            S01392
     C/COPY WNCPYSRC,MM0081C015
     C*                                                                   S01392
     C           M10309    ENDSR                                          S01392
     C*****************************************************************   S01392
      /EJECT                                                              S01392
     C*                                                                   056095
     C/COPY ZSRSRC,ZINTDYZ2                                               056095
     C*****************************************************************   S01392
     C****MM1009*- CALCULATE THE NUMBER OF INTEREST DAYS            S01392056095
     C***********                                                   S01392056095
     C***CALLED*BY    -                                             S01392056095
     C***********                                                   S01392056095
     C***CALLS***     -   ZA0710 CONVERT MIDAS DAY NUMBER TO YMD DATS01392056095
     C***********                                                   S01392056095
     C***FIELDS*INPUT @@BEG  - START DATE OF PERIOD                 S01392056095
     C***********     @@END  - END DATE OF PERIOD                   S01392056095
     C***********     @@CALC - INTEREST CALCULATION METHOD          S01392056095
     C***********                                                   S01392056095
     C***FIELDS*OUTPUT @@INDY - NO. OF INTEREST DAYS                S01392056095
     C***********                                                   S01392056095
     C***WORKFIELDS   @@WN5   - WORK FIELD 5N                       S01392056095
     C***********     @@WN5A  - WORK FIELD 5N                       S01392056095
     C***********     @@WDAT  - WORK FIELD 5N                       S01392056095
     C***********     @@DAYN  - WORK FIELD 5N                       S01392056095
     C***********     @@P1    - WORK FIELD 5N                       S01392056095
     C***********     @@P2    - WORK FIELD 5N                       S01392056095
     C***********     @@P3    - WORK FIELD 5N                       S01392056095
     C***********     @@LPNM  - WORKFIELD USED IN SETTING UP @@TG10 S01392056095
     C***********                                                   S01392056095
     C**************************************************************S01392056095
     C***********MM1009    BEGSR                                    S01392056095
     C***********                                                   S01392056095
     C***********          MOVE @@BEG     @@BEG   50                S01392056095
     C***********          MOVE @@END     @@END   50                S01392056095
     C***********          MOVE @@CALC    @@CALC  1                 S01392056095
     C***********          Z-ADD*ZEROS    @@INDY                    S01392056095
     C***********          Z-ADD*ZEROS    @@LPNM                    S01392056095
     C***********                                                   S01392056095
     C***FIND*NUMBER OF DAYS DIFFERENCE BETWEEN DATES               S01392056095
     C***********                                                   S01392056095
     C***********@@END     SUB  @@BEG     @@WDAT  50                S01392056095
     C***********                                                   S01392056095
     C*****FOR*CALCULATION METHODS 3,4 OR 5.                        S01392056095
     C***********                                                   S01392056095
     C***********@@CALC    IFEQ '3'                        **** B 1 S01392056095
     C***********@@CALC    OREQ '4'                                 S01392056095
     C***********@@CALC    OREQ '5'                                 S01392056095
     C***********                                                   S01392056095
     C***********          Z-ADD@@BEG     @@DAYN  50                S01392056095
     C***********          EXSR ZA0710                              S01392056095
     C***********          Z-ADD@@VDT     @@DATA                    S01392056095
     C***********                                                   S01392056095
     C***********          Z-ADD@@END     @@DAYN                    S01392056095
     C***********          EXSR ZA0710                              S01392056095
     C***********          Z-ADD@@VDT     @@DATB                    S01392056095
     C***IF*IN*SAME MONTH                                           S01392056095
     C***********@@YY1     IFEQ @@YY2                      **** B 2 S01392056095
     C***********@@MM1     IFEQ @@MM2                      **** B 3 S01392056095
     C***********@@DD2     SUB  @@DD1     @@INDY                    S01392056095
     C***********          GOTO M10099                     ---------S01392056095
     C***********          END                             **** E 3 S01392056095
     C***********          END                             **** E 2 S01392056095
     C***********                                                   S01392056095
     C***********          ELSE                            **** X   S01392056095
     C**IF*NOT*3,4 OR 5    ****                                     S01392056095
     C**EXIT*PROCESSING                                             S01392056095
     C***********          Z-ADD@@WDAT    @@INDY  50       - LOAD OUS01392056095
     C***********          GOTO M10099                     ---------S01392056095
     C***********          END                             **** E 1 S01392056095
     C***********                                                   S01392056095
     C***********@@CALC    IFEQ '3'                        **** B 1 S01392056095
     C***CALC*NO. DAYS IN FIRST MONTH                               S01392056095
     C***********30        SUB  @@DD1     @@P1    50   80           S01392056095
     C***IF*<*0,*INITIALISE TO 0                                    S01392056095
     C***80******          Z-ADD*ZEROS    @@P1                      S01392056095
     C***********                                                   S01392056095
     C***CALC.*NO. DAYS IN LAST MONTH                               S01392056095
     C***********@@DD2     IFLE 30                         **** B 2 S01392056095
     C***********          Z-ADD@@DD2     @@P2    50                S01392056095
     C***********          ELSE                            **** X   S01392056095
     C***********          ****                                     S01392056095
     C***********          Z-ADD30        @@P2                      S01392056095
     C***********          END                             **** E 2 S01392056095
     C***CALC*NO. DAYS IN INTERVENING MONTHS                        S01392056095
     C***********@@YY2     IFEQ @@YY1                      **** B 2 S01392056095
     C***********@@MM2     SUB  @@MM1     @@P3    50                S01392056095
     C***********          SUB  1         @@P3                      S01392056095
     C***********          MULT 30        @@P3                      S01392056095
     C***********          ELSE                            **** X   S01392056095
     C***********          ****                                     S01392056095
     C***********@@YY2     SUB  @@YY1     @@P3                      S01392056095
     C***********          SUB  1         @@P3                      S01392056095
     C***********          MULT 360       @@P3                      S01392056095
     C***********                                                   S01392056095
     C**FIND*NO.*OF MONTHS FOR THE TWO PARTIAL YEARS                S01392056095
     C***********12        SUB  @@MM1     @@WN5A  50                S01392056095
     C***********          MULT 30        @@WN5A                    S01392056095
     C***********                                                   S01392056095
     C***********@@MM2     SUB  1         @@WN5                     S01392056095
     C***********@@WN5     MULT 30        @@WN5                     S01392056095
     C***ACCUMULATE                                                 S01392056095
     C***********@@WN5A    ADD  @@WN5     @@WN5A                    S01392056095
     C***********@@P3      ADD  @@WN5A    @@P3                      S01392056095
     C***********          END                             **** E 2 S01392056095
     C***FINAL*SUM                                                  S01392056095
     C***********                                                   S01392056095
     C***********@@P1      ADD  @@P2      @@INDY                    S01392056095
     C***********          ADD  @@P3      @@INDY                    S01392056095
     C***********          END                             **** E 1 S01392056095
     C***FOR*METHODS 4 AND 5                                        S01392056095
     C***********                                                   S01392056095
     C***********@@CALC    IFEQ '4'                        **** B 1 S01392056095
     C***********@@CALC    OREQ '5'                                 S01392056095
     C****CALCULATE NUMBER OF LEAP YEARS BETWEEN START AND END DATESS01392056095
     C***********@@MM1     IFLE 2                          **** B 2 S01392056095
     C***********@@YY1     DIV  4         @@WN5   50                S01392056095
     C***********          MVR            @@WN5          80         S01392056095
     C***ADD*1*IF LEAP YEAR                                         S01392056095
     C***80******          ADD  1         @@LPNM  50                S01392056095
     C***********          END                             **** E 3 S01392056095
     C***BYPASS*IF YEARS ARE THE SAME                               S01392056095
     C***********@@YY1     IFEQ @@YY2                      **** B 3 S01392056095
     C***********@@WDAT    SUB  @@LPNM    @@INDY                    S01392056095
     C***********          GOTO M10099                     ---------S01392056095
     C***********          END                             **** E 2 S01392056095
     C***LOOP*TO*CALCULATE NO. LEAP YEARS                           S01392056095
     C***********@@YY1     DOWNE@@YY2                      **** B 2 S01392056095
     C***INCREMENT START YEAR                                       S01392056095
     C***********          ADD  1         @@YY1                     S01392056095
     C***********                                                   S01392056095
     C***********@@YY1     IFEQ @@YY2                      **** B 3 S01392056095
     C***********@@MM2     IFGT 2                          **** B 4 S01392056095
     C***********@@YY2     DIV  4         @@WN5                     S01392056095
     C***********          MVR            @@WN5          80         S01392056095
     C***INCREMENT IF LEAP YEAR                                     S01392056095
     C***80******          ADD  1         @@LPNM                    S01392056095
     C***********          END                              **** E 4S01392056095
     C***********@@WDAT    SUB  @@LPNM    @@INDY                    S01392056095
     C***********          END                              **** E 3S01392056095
     C***********@@YY1     IFNE @@YY2                       **** B 3S01392056095
     C***********@@YY1     DIV  4         @@WN5                     S01392056095
     C***********          MVR            @@WN5          80         S01392056095
     C***ADD*1*IF LEAP YEAR                                         S01392056095
     C***80******          ADD  1         @@LPNM                    S01392056095
     C***********          END                              **** E 3S01392056095
     C***********          END                              **** E 2S01392056095
     C***********          END                              **** E 1S01392056095
     C***********                                                   S01392056095
     C***********M10099    ENDSR                           ***M10099S01392056095
      /EJECT                                                              S01392
     C*                                                                   056095
     C/COPY ZSRSRC,ZDATE9Z3                                               056095
     C*****************************************************************   S01392
     C***********                                                   S01392056095
     C********TITLE:CALCULATE MIDAS DAY NO. TO DRS (YYYYMMDD) FORMATS01392056095
     C***********                                                   S01392056095
     C********SUBROUTINE                                            S01392056095
     C********PASSED TO IT IN 5,0 FORMAT.IF THE ABOVE FIELD IS LESS S01392056095
     C********THAN 1 IT RETURNS 1 IN FIELD '@@RTN'.THE MAIN PROGRAM S01392056095
     C********SHOULD CHECK FOR THIS CONDITION AND DO THE NECESSARY. S01392056095
     C********IF*'@@RTN' IS NOT EQUAL TO 1 IT RETURNS THE FIELD     S01392056095
     C********'@@VDT'  IN 'YYYYMMDD' FORMAT.                        S01392056095
     C***********                                                   S01392056095
     C**NOTE:*FIELD TO BE DEFINED BY EXTERNAL ROUTINE IS            S01392056095
     C***********                                                   S01392056095
     C********1)*@@DAYN   LENGTH 5,0.                               S01392056095
     C***********                                                   S01392056095
     C********FIELDS USED AND ALREADY DEFINED IN THE ROUTINE ARE:   S01392056095
     C***********                                                   S01392056095
     C********1)*@@VDT    LENGTH 8,0 DEFINED BY A DS.               S01392056095
     C********2)*@@RTN    LENGTH 1,0.                               S01392056095
     C********3)*@@I      LENGTH 2,0 USED TO ACCESS ARRAY @YD       S01392056095
     C********4)*@@J      LENGTH 2,0 USED TO ACCESS ARRAY @MD       S01392056095
     C********5)*@@Z71Y   LENGTH 4,0 DEFINED BY A DS.               S01392056095
     C********6)*@@RDAY   LENGTH 5,0.                               S01392056095
     C********7)*@@LEAP   LENGTH 1,0.                               S01392056095
     C***********                                                   S01392056095
     C********INDICATORS USED ARE:                                  S01392056095
     C***********                                                   S01392056095
     C********1)*80       CHECK FOR LOW AND EQUAL ON ARRAY @YD      S01392056095
     C********2)*81       CHECK FOR LOW ON ARRAY @MD.               S01392056095
     C***********                                                   S01392056095
     C**INPUT*FIELD:       @@DAYN                                   S01392056095
     C***********                                                   S01392056095
     C**OUTPUT*FIELD:      @@VDT                                    S01392056095
     C***********                                                   S01392056095
     C**WORK*FIELDS:       @@RTN                                    S01392056095
     C***********          @@Z71Y                                   S01392056095
     C***********          @@RDAY                                   S01392056095
     C***********          @@LEAP                                   S01392056095
     C***********          @@I                                      S01392056095
     C***********          @@J                                      S01392056095
     C***********                                                   S01392056095
     C**ARRAYS*USED:       @YD COMPILE TIME ARRAY.                  S01392056095
     C***********          @MD COMPILE TIME ARRAY.                  S01392056095
     C***********                                                   S01392056095
     C**************************************************************S01392056095
     C***********                                                   S01392056095
     C***********ZA0710    BEGSR                                    S01392056095
     C***********                                                   S01392056095
     C***********          SETOF                     8081           S01392056095
     C***********          Z-ADD0         @@RTN   10                S01392056095
     C***********          Z-ADD0         @@VDT                     S01392056095
     C***********          Z-ADD1         @@I     20                S01392056095
     C***********          Z-ADD1         @@J     20                S01392056095
     C***********          Z-ADD1         @@LEAP  10                S01392056095
     C***********                                                   S01392056095
     C***********@@DAYN    CABEQ0         ZA0719                    S01392056095
     C***********                                                   S01392056095
     C***********@@DAYN    IFLT 1                                   S01392056095
     C***********          Z-ADD1         @@RTN                     S01392056095
     C***********          GOTO ZA0719                              S01392056095
     C***********          END                                      S01392056095
     C***********                                                   S01392056095
     C**DIVISION*TO DETERMINE WETHER LEAP YEAR.                     S01392056095
     C***********                                                   S01392056095
     C***********@@DAYN    DIV  1461      @@Z71Y                    S01392056095
     C***********          MVR            @@RDAY  50                S01392056095
     C***********                                                   S01392056095
     C**CALCULATING YEAR.                                           S01392056095
     C***********                                                   S01392056095
     C***********@@Z71Y    MULT 4         @@Z71Y                    S01392056095
     C***********          ADD  1972      @@Z71Y                    S01392056095
     C***********                                                   S01392056095
     C**CHECKING*IF YEAR IS GREATER THAN OR EQUAL TO 2100           S01392056095
     C***********                                                   S01392056095
     C***********@@Z71Y    IFGE 2100                                S01392056095
     C***********          ADD  @@SSY2    @@RDAY                    S01392056095
     C***********          END                                      S01392056095
     C***********                                                   S01392056095
     C**LOKUP*ARRAY @YD TO SEE HOW MANY YEARS OF A FOUR YEAR CYCLE  S01392056095
     C**HAVE*PASSED.                                                S01392056095
     C***********                                                   S01392056095
     C***********@@RDAY    LOKUP@YD,@@I                8080         S01392056095
     C***********                                                   S01392056095
     C**IF*YEAR*IS A LEAP YEAR SSLEAP IS SET TO ZERO.               S01392056095
     C***********                                                   S01392056095
     C************IN80     IFEQ '0'                                 S01392056095
     C***********          Z-ADD0         @@LEAP                    S01392056095
     C***********          END                                      S01392056095
     C***********                                                   S01392056095
     C**ADD*INDEX TO YEAR TO GIVE CORRECT YEAR AND ADJUST '@@RDAY'. S01392056095
     C***********                                                   S01392056095
     C***********@@LEAP    IFEQ 1                                   S01392056095
     C***********@@RDAY    SUB  @YD,@@I   @@RDAY                    S01392056095
     C***********          ADD  @@I       @@Z71Y                    S01392056095
     C***********          END                                      S01392056095
     C***********                                                   S01392056095
     C**PROCESSING FOR A LEAP YEAR.                                 S01392056095
     C***********                                                   S01392056095
     C***********@@LEAP    IFEQ 0                                   S01392056095
     C***********                                                   S01392056095
     C**IF*'@@RDAY' = 60 DATE MUST BE 29TH OF FEBRUARY.             S01392056095
     C***********                                                   S01392056095
     C***********@@RDAY    IFEQ 60                                  S01392056095
     C***********          Z-ADD29        @@Z71D                    S01392056095
     C***********          Z-ADD2         @@Z71M                    S01392056095
     C***********          GOTO ZA0711                              S01392056095
     C***********          END                                      S01392056095
     C***********                                                   S01392056095
     C**IF*'@@RDAY' > 60 DATE IS AFTER 29TH OF FEBRUARY,CONVERSION CS01392056095
     C**PROCEED*AS USUAL AFTER SUBTRACTING THE EXTRA DAY FOR THE LEAS01392056095
     C**YEAR.*NOTE : '@@RDAY' < 60 CONVERSION PROCEEDS AS USUAL.    S01392056095
     C***********                                                   S01392056095
     C***********@@RDAY    IFGT 60                                  S01392056095
     C***********@@RDAY    SUB  1         @@RDAY                    S01392056095
     C***********          END                                      S01392056095
     C***********                                                   S01392056095
     C***********          END                                      S01392056095
     C***********                                                   S01392056095
     C**IF*DAY*'@@DAYN' IS EXACTLY DIVISIBLE BY 1461 (NUMBER OF DAYSS01392056095
     C**IN*4*YEARS) THEN DATE MUST BE LAST DAY OF PREVIOUS FOUR YEARS01392056095
     C**GROUP.***                                                   S01392056095
     C***********                                                   S01392056095
     C***********@@RDAY    IFEQ 0                                   S01392056095
     C***********          Z-ADD31        @@Z71D                    S01392056095
     C***********          Z-ADD12        @@Z71M                    S01392056095
     C***********          SUB  1         @@Z71Y                    S01392056095
     C***********          GOTO ZA0711                              S01392056095
     C***********          END                                      S01392056095
     C***********                                                   S01392056095
     C**LOOK*UP*ARRAY ARRAY @MD TO DETERMINE WHICH MONTH '@@RDAY'   S01392056095
     C**OCCURS*IN                                                   S01392056095
     C***********                                                   S01392056095
     C***********@@RDAY    LOKUP@MD,@@J                81           S01392056095
     C***********          Z-ADD@@J       @@Z71M                    S01392056095
     C***********@@RDAY    SUB  @MD,@@J   @@Z71D                    S01392056095
     C***********                                                   S01392056095
     C**DS*@@VDT* IS RETURNED IN YYYYMMDD FORMAT                    S01392056095
     C***********                                                   S01392056095
     C***********ZA0711    TAG                                      S01392056095
     C***********                                                   S01392056095
     C***********          MOVE @@Z71Y    @@YR                      S01392056095
     C***********                                                   S01392056095
     C***********ZA0719    ENDSR                                    S01392056095
      /EJECT
      *****************************************************************
      *                                                               *
      *  SUBROUTINE:  #A  - Initial processing                        *
      *                                                               *
      *  FIELDS USED:        ICMACT   -   Common MIDA action code.    *
      *                      @IHAMN   -   Negative amount indicator   *   S01136
      *                      @IKAMN   -   Negative amount indicator   *   S01136
      *                                                               *
      *  CALLED BY :  MAIN PROGRAM                                    *
      *                                                               *
      *  CALLS     :
      *                                                               *
      *****************************************************************
      *
     C           #A        BEGSR
      *
     C                     MOVEACPY@      BIS@   80                       S01194
     C/COPY WNCPYSRC,MM0081C035
      ** Non-executable code.
     C           *ENTRY    PLIST
     C                     PARM           @TERM   1
     C                     PARM           @THDL   1
     C                     PARM           @DEALL
     C                     PARM           @DEALB
     C                     PARM           @DEALS
     C                     PARM           @DEALA
     C                     PARM           @RACD   1                       AUS007
     C/COPY WNCPYSRC,MM0081CP12                                           S01408
      *                                                                                       CDL033
      ** FRCD Issued Extension details before update                                          CDL033
      *                                                                                       CDL033
     C                     PARM           PBFRCD100                                           CDL033
      *                                                                                       CDL033
      ** FRCD Issued Extension details after update                                           CDL033
      *                                                                                       CDL033
     C                     PARM           PAFRCD100                                           CDL033
      *
     C           DEAMKY    KLIST
     C                     KFLD           IGDA38
     C                     KFLD           IGDVSD
     C                     KFLD           IGDS38
      *
     C           @DIKEY    KLIST
     C                     KFLD           DLNO
     C                     KFLD           VDAT
     C                     KFLD           DASN
      *
     C*****      @BSRKY    KLIST                                          S01194
     C*****                KFLD           CCY                             S01194
     C*****                KFLD           FSRT                            S01194
      *
      *    Work fields definitions
     C           *LIKE     DEFN DAVD      @DAVD
     C           *LIKE     DEFN DASN      @DASN
     C           *LIKE     DEFN DASN      @DASNK
     C           *LIKE     DEFN NAAD      @NAAD
     C           *LIKE     DEFN NAAD      @NAADR
     C           *LIKE     DEFN NASN      @NASN
     C           *LIKE     DEFN NASN      @NASNR
     C           *LIKE     DEFN NIDT      @NIDT
     C           *LIKE     DEFN MDAT      @MDAT
     C           *LIKE     DEFN VDAT      @VDAT
     C           *LIKE     DEFN FACO      @FACO
     C           *LIKE     DEFN SPI       @SPI
     C           *LIKE     DEFN DLNO      @DLNO
     C           *LIKE     DEFN IGMTYP    ICMTYP
     C           *LIKE     DEFN IGORCM    ICORCM
     C           *LIKE     DEFN IGMOPM    ICMOPM
     C           *LIKE     DEFN CNRQ      @CNRQ
     C           *LIKE     DEFN IGDVSD    ICDVSD
     C           *LIKE     DEFN IGDA38    ICDN38
     C           *LIKE     DEFN IGCCY     ICCCY
     C           *LIKE     DEFN IKNIPD    ICNIPD
     C           *LIKE     DEFN IKMATD    ICMATD
     C           *LIKE     DEFN IKMACT    ICMACT
     C************LIKE     DEFN IKBRCD    ICBRCD                          S01117
     C           *LIKE     DEFN IKBRCA    ICBRCA                          S01117
     C           *LIKE     DEFN IKRONS    ICRONS                          S01117
     C           *LIKE     DEFN IKPONS    ICPONS                          S01117
     C*****      *LIKE     DEFN TNOT      TNOTD                           S01194
     C*****      *LIKE     DEFN TNOT      TNOTL                           S01194
     C           *LIKE     DEFN A6TXND    TNOTD                           S01194
     C           *LIKE     DEFN A6TXND    TNOTL                           S01194
     C           *LIKE     DEFN SETP      @SETP                           080570
     C           *LIKE     DEFN TSEN      @TSEN                           080570
     C           *LIKE     DEFN OSAC      @OSAC                           080570
     C           *LIKE     DEFN RSTM      @RSTM                           082908
     C           *LIKE     DEFN RONS      @RONS                           082908
     C           *LIKE     DEFN RIBN      @RIBN                           082908
     C           *LIKE     DEFN RIBA      @RIBA                           082908
     C           *LIKE     DEFN ROBN      @ROBN                           082908
     C           *LIKE     DEFN ROCN      @ROCN                           082908
     C           *LIKE     DEFN PSTM      @PSTM                           082908
     C           *LIKE     DEFN PONS      @PONS                           082908
     C           *LIKE     DEFN PIBN      @PIBN                           082908
     C           *LIKE     DEFN PIBA      @PIBA                           082908
     C           *LIKE     DEFN POBN      @POBN                           082908
     C           *LIKE     DEFN POCN      @POCN                           082908
     C           *LIKE     DEFN RCRN      @RCRN                           082908
     C           *LIKE     DEFN RCRA      @RCRA                           082908
     C           *LIKE     DEFN RVNO      @RVNO                           082908
     C           *LIKE     DEFN AWBN      @AWBN                           082908
     C           *LIKE     DEFN AWBA      @AWBA                           082908
     C           *LIKE     DEFN BENN      @BENN                           082908
     C           *LIKE     DEFN BENA      @BENA                           082908
     C           *LIKE     DEFN DTP1      @DTP1                           082908
     C           *LIKE     DEFN DTP2      @DTP2                           082908
     C           *LIKE     DEFN DTP3      @DTP3                           082908
     C           *LIKE     DEFN DTP4      @DTP4                           082908
     C           *LIKE     DEFN DCHG      @DCHG                           082908
     C           *LIKE     DEFN BTB1      @BTB1                           082908
     C           *LIKE     DEFN BTB2      @BTB2                           082908
     C           *LIKE     DEFN BTB3      @BTB3                           082908
     C           *LIKE     DEFN BTB4      @BTB4                           082908
     C           *LIKE     DEFN BTB5      @BTB5                           082908
     C           *LIKE     DEFN BTB6      @BTB6                           082908
     C           *LIKE     DEFN CVMR      @CVMR                           082908
     C/COPY WNCPYSRC,MM0081C034
      *
      ** Validate this deal indicator.
      *
     C           @TERM     IFEQ 'T'                        B*1
     C                     MOVE '1'       *INLR             *1
     C                     GOTO #A9                         *1
     C                     END                             E*1
     C/COPY WNCPYSRC,MM0081CP16                                           S01408
     C*                                                                   AUS007
     C** Access SAR details file to determine if Australian Brokerage     AUS007
     C** is switched on                                                   AUS007
     C*                                                                   AUS007
     C                     CALL 'AOSARDR0'                                AUS007
     C                     PARM *BLANKS   @RTCD                           AUS007
     C                     PARM '*VERIFY' @OPTN                           AUS007
     C                     PARM 'AUS007'  @SARD   6                       AUS007
     C           SCSARD    PARM SCSARD    DSFDY                           AUS007
     C           @RTCD     IFNE *BLANKS                                   AUS007
     C           @RTCD     ANDNE'*NRF   '                                 AUS007
     C                     MOVEL'SCSARDPD'DBFILE           ***************AUS007
     C                     MOVEL'060'     DBASE            * DBERROR 060 *AUS007
     C                     MOVEL'AUS007'  DBKEY            ***************AUS007
     C                     SETON                     U7U8LR               AUS007
     C                     EXSR #C                                        AUS007
     C                     END                                            AUS007
     C           @RTCD     IFEQ *BLANK                                    AUS007
     C                     MOVEL'Y'       AUS007  1                       AUS007
     C                     ELSE                                           AUS007
     C                     MOVEL'N'       AUS007                          AUS007
     C                     END                                            AUS007
      *                                                                   CEU003
      ** Check if CEU003 is switched *ON.                                 CEU003
      *                                                                   CEU003
     C                     CALL 'AOSARDR0'                                CEU003
     C                     PARM *BLANKS   @RTCD   7                       CEU003
     C                     PARM '*VERIFY' @OPTN   7                       CEU003
     C                     PARM 'CEU003'  @SARD   6                       CEU003
     C           SCSARD    PARM SCSARD    DSFDY                           CEU003
      *                                                                   CEU003
     C           @RTCD     IFEQ *BLANKS                                   CEU003
     C                     MOVE 'Y'       CEU003  1                       CEU003
     C                     ELSE                                           CEU003
     C                     MOVE 'N'       CEU003                          CEU003
      *                                                                   CEU003
     C           @RTCD     IFNE '*NRF   '                                 CEU003
     C                     MOVEL'SCSARDPD'DBFILE                          CEU003
     C                     MOVEL'CEU003  'DBKEY                           CEU003
     C                     MOVEL'061'     DBASE                           CEU003
     C                     SETON                     U7U8LR               CEU003
     C                     EXSR INFSR                                     CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
      ** Setup effective-currency-workfield                               CEU003
      *                                                                   CEU003
     C                     MOVE *BLANKS   WESCY   3                       CEU003
      *
      ** Check if SWIFT 2000 is on.                                       CSW200
      *                                                                   CSW200
     C                     CALL 'SWIF2000'                                CSW200
     C                     PARM *BLANKS   CSW200  6                       CSW200
      *                                                                   CSW200
      ** As unable to rename various fields, as they are
      ** subfields in 4 different data structures, move to
      ** separate fields to simplify processing.
      *
     C           @THDL     IFEQ 'L'                        B*1
     C                     MOVE IKMACT    ICMACT            *1
     C                     MOVE IKMTYP    ICMTYP            *1
     C                     Z-ADDIKORCM    ICORCM            *1
     C                     Z-ADDIKMOPM    ICMOPM            *1
     C                     Z-ADDIKDVSD    ICDVSD            *1
     C                     Z-ADDIKDN38    ICDN38            *1
     C***********          MOVE IKCCY     ICCCY             *1            CEU003
     C                     Z-ADDIKNIPD    ICNIPD            *1
     C                     Z-ADDIKMATD    ICMATD            *1
     C*********************Z-ADDIKBRCD    ICBRCD            *1            S01117
     C                     MOVELIKBRCA    ICBRCA            *1            S01117
     C                     MOVELIKRONS    ICRONS            *1            S01195
     C                     MOVELIKPONS    ICPONS            *1            S01195
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           IKSTCY    ANDNE*BLANKS                                   CEU003
     C                     MOVELIKSTCY    WEFSCY  3                       CEU003
     C                     ELSE                                           CEU003
     C                     MOVELIKCCY     WEFSCY                          CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C                     ELSE                            X*1
     C           @THDL     IFEQ 'B'                        B*2
     C                     MOVE IHMACT    ICMACT            *2
     C                     MOVE IHMTYP    ICMTYP            *2
     C                     Z-ADDIHORCM    ICORCM            *1
     C                     Z-ADDIHMOPM    ICMOPM            *1
     C                     Z-ADDIHDVSD    ICDVSD            *1
     C                     Z-ADDIHDN38    ICDN38            *1
     C***********          MOVE IHCCY     ICCCY             *1            CEU003
     C                     Z-ADDIHNIPD    ICNIPD            *1
     C                     Z-ADDIHMATD    ICMATD            *1
     C*********************Z-ADDIHBRCD    ICBRCD            *1            S01117
     C                     MOVELIHBRCA    ICBRCA            *1            S01117
     C                     MOVELIHRONS    ICRONS            *1            S01195
     C                     MOVELIHPONS    ICPONS            *1            S01195
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           IHSTCY    ANDNE*BLANKS                                   CEU003
     C                     MOVELIHSTCY    WEFSCY                          CEU003
     C                     ELSE                                           CEU003
     C                     MOVELIHCCY     WEFSCY                          CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C                     ELSE                            X*2
     C           @THDL     IFEQ 'S'                        B*3
     C                     MOVE ILMACT    ICMACT            *3
     C                     MOVE ILMTYP    ICMTYP            *3
     C                     Z-ADDILORCM    ICORCM            *1
     C                     Z-ADD*ZERO     ICMOPM            *1
     C                     Z-ADDILDVSD    ICDVSD            *1
     C                     Z-ADDILDN38    ICDN38            *1
     C***********          MOVE ILCCY     ICCCY             *1            CEU003
     C                     Z-ADD*ZERO     ICNIPD            *1
     C                     Z-ADD*ZERO     ICMATD            *1
     C*********************Z-ADDILBRCD    ICBRCD            *1            S01117
     C                     MOVELILBRCA    ICBRCA            *1            S01117
     C                     MOVELILRONS    ICRONS            *1            S01195
     C                     MOVELILPONS    ICPONS            *1            S01195
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           ILSTCY    ANDNE*BLANKS                                   CEU003
     C                     MOVELILSTCY    WEFSCY                          CEU003
     C                     ELSE                                           CEU003
     C                     MOVELILCCY     WEFSCY                          CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C                     ELSE                            X*3
     C           @THDL     IFEQ 'A'                        B*4
     C                     MOVE IGMACT    ICMACT            *4
     C                     MOVE IGMTYP    ICMTYP            *4
     C                     MOVE IGORCM    ICORCM            *1
     C                     MOVE IGMOPM    ICMOPM            *1
     C                     Z-ADDIGDVSD    ICDVSD            *1
     C                     Z-ADDIGDA38    ICDN38            *1
     C***********          MOVE IGCCY     ICCCY             *1            CEU003
     C                     Z-ADD*ZERO     ICNIPD            *1
     C                     Z-ADD*ZERO     ICMATD            *1
     C*********************Z-ADD*ZERO     ICBRCD            *1            S01117
     C                     MOVEL*BLANKS   ICBRCA            *1            S01117
     C                     MOVELIGRONS    ICRONS            *1            S01195
     C                     MOVELIGPONS    ICPONS            *1            S01195
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           IGSTCY    ANDNE*BLANKS                                   CEU003
     C                     MOVELIGSTCY    WEFSCY                          CEU003
     C                     ELSE                                           CEU003
     C                     MOVELIGCCY     WEFSCY                          CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C                     END                             E*4
     C                     END                             E*3
     C                     END                             E*2
     C                     END                             E*1
      *                                                                   CEU003
      ** Replace ICCCY with the effective-settlement-currency             CEU003
      *                                                                   CEU003
     C                     MOVELWEFSCY    ICCCY                           CEU003
      *
      **  Open files.
     C           @ONCE     IFNE 'Y'                        B*1
     C***                  OPEN DEALS                       *1
     C***                  OPEN DEAMS                       *1
     C                     OPEN MMDELULL                    *1
     C                     OPEN MMDEMULL                    *1
     C                     OPEN SDTIX                       *1
     C                     OPEN MMDEALLL                    *1
     C                     OPEN MMDEAMLL                    *1
     C*****                OPEN FXTB40LL                    *1            S01194
     C*****                OPEN FDICDRLL                    *1            S01194
     C*****                OPEN FDBRNCLL                    *1            S01194
     C*****                OPEN FDBSRULL                    *1            S01194
     C*****                OPEN FDCCYTLL                    *1            S01194
     C           AUS007    IFEQ 'Y'                                       AUS007
     C                     OPEN BKRAT                       *1            AUS007
     C                     END                                            AUS007
      *                                                                   S01408
     C/COPY WNCPYSRC,MM0081CCP5                                           S01408
      *                                                                   S01408
     C                     MOVE 'Y'       @ONCE   1         *1
     C                     END                             E*1
     C*                                                                   E12279
      *
      *** Read the TABTB40 record                                         S01194
     C*****      *LOVAL    SETLLFXTB40LL                           E12189 S01194
     C*****                READ FXTB40LL               6060        E12189 S01194
     C*****      *IN60     IFEQ '1'                        B*1            S01194
     C*****                MOVE '052'     DBASE             *1            S01194
     C*****                MOVEL'FXTB40LL'DBFILE            *1     E14356 S01194
     C*****                EXSR INFSR                       *1            S01194
     C*****                END                             E*1            S01194
      *
     C** Obtain TRADE details via access program                          S01194
     C                     CALL 'AOTRADR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDTRAD    PARM SDTRAD    DSFDY                           S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C                     MOVEL'SDTRADPD'DBFILE           ************   S01194
     C                     MOVEL@OPTN     DBKEY            * DBERR 52 *   S01194
     C                     MOVE '052'     DBASE            ************   S01194
     C                     EXSR INFSR                                     S01194
     C                     END                             E*1            S01194
      *                                                                   S01194
      *
      ****Read the TABTB10 record                                         S01194
     C*****                MOVEL'01'      ICDKEY 12                       S01194
     C*****                MOVE '10'      ICDKEY                          S01194
     C*****      ICDKEY    CHAINFDICDRLL             60                   S01194
     C*****      *IN60     IFEQ '1'                        B*1            S01194
     C*****                MOVE '053'     DBASE             *1            S01194
     C*****                                                        E14356 S01194
     C***SET UP DASE ERROR FIELDS                                  E14356 S01194
     C*****                MOVEL'FDICDRLL'DBFILE            *1     E14356 S01194
     C*****                MOVELICDKEY    DBKEY             *1     E14356 S01194
     C*****                                                        E14356 S01194
     C*****                EXSR INFSR                       *1            S01194
     C*****                END                             E*1            S01194
      *                                                                   S01194
     C** Obtain BANK details via access program                           S01194
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C                     MOVEL'SDBANKPD'DBFILE           ************   S01194
     C                     MOVEL@OPTN     DBKEY            * DBERR 53 *   S01194
     C                     MOVE '053'     DBASE            ************   S01194
     C                     EXSR INFSR                                     S01194
     C                     END                             E*1            S01194
      *                                                                   S01194
      *** Read the TABTB11 record                                         S01194
     C*****                MOVE '11'      ICDKEY                          S01194
     C*****      ICDKEY    CHAINFDICDRLL             60                   S01194
     C*****      *IN60     IFEQ '1'                        B*1            S01194
     C*****                MOVE '054'     DBASE             *1            S01194
     C*****                                                        E14356 S01194
     C***SET UP DASE ERROR FIELDS                                  E14356 S01194
     C*****                MOVEL'FDICDRLL'DBFILE            *1     E14356 S01194
     C*****                MOVELICDKEY    DBKEY             *1     E14356 S01194
     C*****                                                        E14356 S01194
     C*****                EXSR INFSR                       *1            S01194
     C*****                END                             E*1            S01194
     C*
     C**  IF THE AMOUNT/RATE FIELDS ON STANDARD DEALS FILE FOR
     C**  LOANS/DEPOSITS AND NAS BOUGHT ARE NEGATIVE, REVERSE THE
     C**  SIGN AND MAKE THEM POSITIVE
     C           IHAMNP    IFLT 0                          B1
     C                     Z-SUBIHAMNP    IHAMNP           *1
     C                     MOVE 'Y'       @IHAMN  1        *1             S01136
     C                     ELSE                            X1             S01136
     C                     MOVE 'N'       @IHAMN           *1             S01136
     C                     END                             E1
     C*
     C           IHINTR    IFLT 0                          B1
     C                     Z-SUBIHINTR    IHINTR           *1
     C                     END                             E1
     C*
     C           IHMTTI    IFLT 0                          B1
     C                     Z-SUBIHMTTI    IHMTTI           *1
     C                     END                             E1
     C*
     C           IKAMNP    IFLT 0                          B1
     C                     Z-SUBIKAMNP    IKAMNP           *1
     C                     MOVE 'Y'       @IKAMN  1        *1             S01136
     C                     ELSE                            X1             S01136
     C                     MOVE 'N'       @IKAMN           *1             S01136
     C                     END                             E1
     C*
     C           IKINTR    IFLT 0                          B1
     C                     Z-SUBIKINTR    IKINTR           *1
     C                     END                             E1
     C*
     C           IKMTTI    IFLT 0                          B1
     C                     Z-SUBIKMTTI    IKMTTI           *1
     C                     END                             E1
     C*
     C**  Make amounts & rates of before update fields positive if
     C**  this is an amendment.
     C           IHLACT    IFEQ 'A'                        B1
     C           IHBAMT    IFLT 0                          B*2
     C                     Z-SUBIHBAMT    IHBAMT           **2
     C                     END                             E*2
     C*
     C           IHBIRT    IFLT 0                          B*2
     C                     Z-SUBIHBIRT    IHBIRT           **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C           IKLACT    IFEQ 'A'                        B1
     C           IKBAMT    IFLT 0                          B*2
     C                     Z-SUBIKBAMT    IKBAMT           **2
     C                     END                             E*2
     C*
     C           IKBIRT    IFLT 0                          B*2
     C                     Z-SUBIKBIRT    IKBIRT           **2
     C                     END                             E*2
     C                     END                             E1
      *                                                                   S01486
      ** Access Module details.                                           S01486
      *                                                                   S01486
     C                     CALL 'AOMMODR0'                                S01486
     C                     PARM '*DBERR ' @RTCD   7                       S01486
     C                     PARM '*FIRST ' @OPTN   7                       S01486
     C           SDMMOD    PARM SDMMOD    DSFDY                           S01486
      *                                                                   S01486
     C           @RTCD     IFNE *BLANKS                                   S01486
     C                     MOVEL'SDMMODPD'DBFILE           ***************S01486
     C                     MOVEL'011'     DBASE            * DBERROR 011 *S01486
     C                     MOVEL'*FIRST'  DBKEY            ***************S01486
     C                     EXSR INFSR                                     S01486
     C                     ENDIF                                          S01486
      *                                                                   CEU015
      ** Access AOSARDR0 to check if CEU015 is installed                  CEU015
      *                                                                   CEU015
     C                     CALL 'AOSARDR0'                                CEU015
     C                     PARM *BLANKS   @RTCD   7                       CEU015
     C                     PARM '*VERIFY' @OPTN   7                       CEU015
     C                     PARM 'CEU015'  @SARD   6                       CEU015
      *                                                                   CEU015
     C           @RTCD     IFNE *BLANKS                                   CEU015
     C           @RTCD     ANDNE'*NRF   '                  **********     CEU015
     C                     MOVEL'SCSARDPD'DBFILE           * 061    *     CEU015
     C                     MOVEL'061'     DBASE            **********     CEU015
     C                     MOVEL'CEU015'  DBKEY                           CEU015
     C                     EXSR INFSR                                     CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
     C           @RTCD     IFEQ *BLANKS                                   CEU015
     C                     MOVE 'Y'       CEU015  1                       CEU015
     C                     ELSE                                           CEU015
     C                     MOVE 'N'       CEU015                          CEU015
     C                     ENDIF                                          CEU015
      *                                                                   CEU015
      ** CALL ACCESS PROG. FOR GENERAL DETAILS.                           CEU015
      *                                                                   CEU015
     C**********           CALL 'AOGELRR0'                                             CEU015 CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       CEU015
     C                     PARM '*FIRST ' @OPTN   7                       CEU015
     C********** SDGELR    PARM SDGELR    DSFDY                                        CEU015 CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
      *                                                                   CEU015
     C           @RTCD     IFNE *BLANK                                    CEU015
     C                     MOVEL'SDGELRPD'DBFILE           **********  *  CEU015
     C                     MOVEL'062'     DBASE            *  62    *  *  CEU015
     C                     MOVEL@OPTN     DBKEY            **********  *  CEU015
     C                     EXSR INFSR                                     CEU015
     C                     ENDIF                                          CEU015
      *                                                                                     MD035545
      ** Retrieve system value setting                                                      MD035545
      *                                                                                     MD035545
     C                     MOVELWPARML    P@OP01                                            MD035545
     C                     CALL 'AOSVALR0'                                                  MD035545
     C                     PARM *BLANKS   W0RTCD  7                                         MD035545
     C                     PARM           P@OP01 20                                         MD035545
     C                     PARM           P@VL01200                                         MD035545
     C                     PARM           P@OP02 20                                         MD035545
     C                     PARM           P@VL02200                                         MD035545
     C                     PARM           P@OP03 20                                         MD035545
     C                     PARM           P@VL03200                                         MD035545
     C                     PARM           P@OP04 20                                         MD035545
     C                     PARM           P@VL04200                                         MD035545
     C                     PARM           P@OP05 20                                         MD035545
     C                     PARM           P@VL05200                                         MD035545
     C                     PARM           P@OP06 20                                         MD035545
     C                     PARM           P@VL06200                                         MD035545
     C                     PARM           P@OP07 20                                         MD035545
     C                     PARM           P@VL07200                                         MD035545
     C                     PARM           P@OP08 20                                         MD035545
     C                     PARM           P@VL08200                                         MD035545
     C                     PARM           P@OP09 20                                         MD035545
     C                     PARM           P@VL09200                                         MD035545
     C                     PARM           P@OP10 20                                         MD035545
     C                     PARM           P@VL10200                                         MD035545
      *                                                                                     MD035545
      ** If system value is not found then default value to 'N'                             MD035545
      *                                                                                     MD035545
     C           W0RTCD    IFNE '       '                                                   MD035545
     C                     MOVE 'N'       WCALC6                                            MD035545
     C                     ELSE                                                             MD035545
     C                     MOVELP@VL01    WCALC6                                            MD035545
     C********** WCALC6    IFEQ 'Y'                                                MD035545 MD047993
     C********** BKALDI    ANDEQ'Y'                                                MD035545 MD047993
     C**********           MOVE 'Y'       WCALC6                                   MD035545 MD047993
     C**********           ELSE                                                    MD035545 MD047993
     C**********           MOVE 'N'       WCALC6                                   MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
     C                     ENDIF                                                            MD035545
      *
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,MM0081CPG                                            S01408
      *
     C           #A9       ENDSR                           **#A9**
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SUBROUTINE: #D     - Terminates program.                     *
      *                                                               *
      *  FIELDS USED:                                                 *
      *                                                               *
      *  CALLED BY : Main processing                                  *
      *
      *  CALLS     :                                                  *
      *                                                               *
      *****************************************************************
      *
     C           #D        BEGSR
      *
      **  If a database error has occured, move program name into local
      **  data area, inform calling program, and seton LR.
      *
     C           *INU7     IFEQ '1'                        B1
     C                     MOVEL'MM0081'  DBPGM            *1
     C                     MOVE '1'       *INLR            *1
     C                     MOVE 'E'       @TERM            *1
     C                     END                             E1
      *
     C                     RETRN
      *
     C           #D9       ENDSR                           **#C9**
     C*****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SUBROUTINE: *INFSR -- File Error handling subroutine.        *
      *                                                               *
      *  FIELDS USED:                                                 *
      *                                                               *
      *  CALLED BY : This routine is called if there are any          *
      *                file errors.                                   *
      *
      *  CALLS :                                                      *
      *                                                               *
      *****************************************************************
      *
     C           INFSR     BEGSR
      *
      ** Set @ERR2 to 'Y' to prevent looping if further errors.
     C           @ERR2     IFNE 'Y'                        B1
     C                     MOVE 'Y'       @ERR2   1        *1
      *
     C                     MOVE '1'       *INU7            *1
     C                     MOVE '1'       *INU8            *1
      *
      ** Terminate the program,setting up LDA & producing a dump.
     C                     MOVE '1'       *INLR             *1
     C                     MOVE 'E'       @TERM             *1
     C*                                                                   E14356
     C** Removed as @FILE field only  updated when errors occurs in FILE  E14356
     C********             MOVE @FILE     DBFILE            *1            E14356
     C                     MOVEL'MM0081'  DBPGM             *1
      *
     C                     DUMP                             *1
     C                     END                             E*1
      *
     C                     RETRN
      *
     C           INFSR9    ENDSR                            ***INFSR9*
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SUBROUTINE: *PSSR - Error handling subroutine.               *
      *                                                               *
      *  FIELDS USED:                                                 *
      *                                                               *
      *  CALLED BY : This routine is called if there are any program  *
      *                errors.                                        *
      *  CALLS :                                                      *
      *                                                               *
      *****************************************************************
      *
     C           *PSSR     BEGSR
      *
      **  Set @ERR1 to 'Y' to prevent looping if further errors.
     C           @ERR1     IFNE 'Y'                        B*1
     C                     MOVE 'Y'       @ERR1   1         *1
      *
     C                     MOVEL'MM0081'  DBPGM             *1
     C                     MOVE '1'       *INU6             *1
     C                     MOVE '991'     DBASE             *1
      *
     C                     DUMP                             *1
     C                     MOVE 'E'       @TERM             *1
     C                     END                             E*1
      *
     C                     MOVE '1'       *INLR
      *
     C                     RETRN
      *
     C           #PSSR9    ENDSR                            ***PSSR9**
      *
      *****************************************************************
      *****************************************************************   056095
      *   The array @YD and @MD are now being used by SR. ZDATE9      *   056095
      *   before they are being used by SR. ZA0680.  The actual       *   056095
      *   changes were only made on the text, ZA0680 was changed      *   056095
      *   to ZDATE9.                                                  *   056095
      *****************************************************************   056095
** CPY@   **      OBJECT COPYRIGHT
(c) Misys International Banking Systems Ltd. 2001
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
** TABTYP/TABSEQ Amendment types/processing sequence
CI1SI1PI2PD3SC4BR5CO9
     X/COPY WNCPYSRC,MM0081X001
